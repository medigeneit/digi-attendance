import{G as oe,x as v,q as E,c as p,o as l,a as t,N as te,w as se,s as _,d as le,k as ae,v as ne,f as be,u as xe,D as de,h as fe,j as I,i as we,l as B,m as U,t as m,b as re,F as R,e as M}from"./index-BteeEovh.js";import{L as De}from"./LoaderView-BP4m4Vhy.js";import{_ as Ie}from"./EmployeeFilter-DOhNoM_z.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as _e,b as L}from"./datetime-BEfC2TVK.js";import{u as he}from"./company-CEEzrARe.js";import{u as Se}from"./department-CXiUJXQX.js";import{u as ke}from"./useTodoDateStore-BuphZ8Ri.js";import"./EmployeeDropdownInput-EQh5NHrx.js";import"./SelectDropdown-BOBsDN-2.js";import"./UserChip-C5abLe8f.js";import"./url-CePbr-gY.js";const Te={class:"px-4 py-4 md:py-3 bg-white rounded-md border"},$e={class:"flex flex-wrap items-center gap-3"},Ce=["disabled"],Ne={class:"print-hide"},Re={class:"flex flex-col md:flex-row flex-wrap items-end md:ml-auto w-full md:w-auto gap-x-3 gap-y-4 print-hide"},Ee={class:"flex items-center justify-between w-full md:w-auto gap-3"},Ae={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Ue={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Le={__name:"TodoReportHeading",props:{loading:{type:Boolean,default:!1},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},employeeId:{type:[String,Number],default:""},lineType:{type:String,default:"all"},startDate:{type:String,default:""},endDate:{type:String,default:""}},emits:["reloadClick","change"],setup(h,{emit:u}){const o=h,f=u,d=oe({companyId:String(o.companyId||""),departmentId:o.departmentId!==""&&o.departmentId!=null?String(o.departmentId):"",employeeId:String(o.employeeId||""),lineType:o.lineType||"all",startDate:o.startDate||"",endDate:o.endDate||""}),S=v(()=>({companyId:d.companyId,departmentId:d.departmentId,employeeId:d.employeeId,lineType:d.lineType,startDate:d.startDate,endDate:d.endDate}));function A(){f("change",{...S.value})}return E(()=>[o.companyId,o.departmentId,o.employeeId,o.lineType,o.startDate,o.endDate],()=>{d.companyId=String(o.companyId||""),d.departmentId=o.departmentId!==""&&o.departmentId!=null?String(o.departmentId):"",d.employeeId=String(o.employeeId||""),d.lineType=o.lineType||"all",d.startDate=o.startDate||"",d.endDate=o.endDate||""}),E(S,A,{deep:!0}),(k,s)=>(l(),p("div",Te,[t("div",$e,[te(k.$slots,"before",{},void 0,!0),t("button",{class:_(["btn-icon print-hide",{"animate-spin !bg-opacity-0":h.loading}]),onClick:s[0]||(s[0]=se(e=>f("reloadClick"),["prevent"])),disabled:h.loading,title:"Reload"},[t("i",{class:_(["fas fa-redo",[h.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,Ce),t("span",Ne,[te(k.$slots,"after",{},void 0,!0)]),t("div",Re,[le(Ie,{company_id:d.companyId,"onUpdate:company_id":s[1]||(s[1]=e=>d.companyId=e),department_id:d.departmentId,"onUpdate:department_id":s[2]||(s[2]=e=>d.departmentId=e),employee_id:d.employeeId,"onUpdate:employee_id":s[3]||(s[3]=e=>d.employeeId=e),line_type:d.lineType,"onUpdate:line_type":s[4]||(s[4]=e=>d.lineType=e),"with-type":!0,class:"flex-1 gap-y-4 md:flex items-center justify-between w-full md:w-auto"},null,8,["company_id","department_id","employee_id","line_type"]),t("div",Ee,[t("div",Ae,[s[7]||(s[7]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Start Date",-1)),ae(t("input",{type:"date","onUpdate:modelValue":s[5]||(s[5]=e=>d.startDate=e),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ne,d.startDate]])]),t("div",Ue,[s[8]||(s[8]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"End Date",-1)),ae(t("input",{type:"date","onUpdate:modelValue":s[6]||(s[6]=e=>d.endDate=e),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ne,d.endDate]])])])])])]))}},Oe=ve(Le,[["__scopeId","data-v-ee9b6763"]]),Ve={class:"container print:flex-grow mx-auto print:w-full px-4 py-6 print:px-0 print:py-0"},Be=["disabled"],Me={key:0,class:"bg-white border rounded-md mb-2 p-4 text-sm print:border-0 print:mb-2 print:px-0 print:w-full"},je={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-y-2 gap-x-6"},Fe={class:"font-medium text-gray-800"},ze={class:"col-span-2"},Pe={class:"font-medium text-gray-800"},He={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Je={key:3,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Ke={key:4,class:"overflow-x-auto md:overflow-clip bg-white border border-t-0 rounded-md shadow-sm print:shadow-none print:rounded-none print:border-gray-400"},Qe={class:"min-w-full text-left text-sm border-separate border-spacing-0"},We={class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},Ye={class:"border-y print:border-gray-400 sticky top-[58px]"},Xe={key:0,class:"px-4 py-3 border bg-white bg-opacity-70 backdrop-blur-sm"},Ze={class:"divide-y divide-gray-200"},Ge=["rowspan"],qe=["rowspan"],et={key:0,class:"text-xs text-gray-500"},tt={key:1,class:"text-[11px] text-gray-400"},at=["rowspan"],nt={class:"px-4 py-3 text-gray-800 border-l border-t"},dt={class:"font-medium"},rt={class:"text-gray-400 mr-2"},ot={class:"text-xs text-gray-500"},st={class:"px-4 py-3 border-l border-t border-r text-center"},Dt={__name:"TodoReportView",setup(h){var F,z,P,H,J,K;const u=be(),o=xe(),f=ke(),d=he(),S=Se(),{companies:A}=de(d),{departments:k}=de(S),s=_e(new Date),e=oe({companyId:((F=u.query)==null?void 0:F.company_id)||"",departmentId:((z=u.query)==null?void 0:z.department_id)||"",employeeId:((P=u.query)==null?void 0:P.employee_id)||"",lineType:((H=u.query)==null?void 0:H.line_type)||"all",startDate:((J=u.query)==null?void 0:J.start_date)||s,endDate:((K=u.query)==null?void 0:K.end_date)||s}),O=v(()=>{const a={};return f.todo_dates.forEach(n=>{var i;const r=((i=n.user)==null?void 0:i.id)||`unknown-${n.id}`,y=n.date||"unknown-date";a[r]||(a[r]={user:n.user,dates:{}}),a[r].dates[y]||(a[r].dates[y]={date:y,todos:[]}),a[r].dates[y].todos.push(n)}),Object.values(a).map(n=>{const r=Object.values(n.dates).map(i=>({...i,rowSpan:i.todos.length})).sort((i,b)=>new Date(i.date)-new Date(b.date)),y=r.reduce((i,b)=>i+b.rowSpan,0);return{user:n.user,dates:r,rowSpan:y}}).sort((n,r)=>{var y,i;return(((y=n.user)==null?void 0:y.name)||"").localeCompare(((i=r.user)==null?void 0:i.name)||"")})}),ie=v(()=>{if(!e.startDate||!e.endDate)return"";const a=L(e.startDate,{weekDay:"long"}),n=L(e.endDate,{weekDay:"long"});return`${a} ~ ${n}`}),pe=v(()=>d.employees||[]),me={all:"All Types",executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},w=v(()=>{var i,b,T,c,$,x,D,C;const a=e.companyId&&((i=A.value)!=null&&i.length)?(b=A.value.find(g=>String(g.id)===String(e.companyId)))==null?void 0:b.name:null,n=e.departmentId&&((T=k.value)!=null&&T.length)?(c=k.value.find(g=>String(g.id)===String(e.departmentId)))==null?void 0:c.name:null;let r=null;e.employeeId&&(r=((x=($=pe.value)==null?void 0:$.find(g=>String(g.id)===String(e.employeeId)))==null?void 0:x.name)||((C=(D=O.value.find(g=>{var N;return String(((N=g.user)==null?void 0:N.id)||"")===String(e.employeeId)}))==null?void 0:D.user)==null?void 0:C.name)||null);const y=e.startDate===e.endDate&&e.startDate?L(e.startDate,{weekDay:"long"}):ie.value||"-";return{company:a||(e.companyId?`#${e.companyId}`:"All Companies"),department:n||(e.departmentId?`#${e.departmentId}`:"All Departments"),employee:r||(e.employeeId?`#${e.employeeId}`:"All Employees"),lineType:me[e.lineType]||e.lineType||"All Types",dateRange:y}}),ye=a=>a==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":a==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":a==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200";function ue(){o.replace({query:{...u.query,company_id:e.companyId||void 0,department_id:e.departmentId||void 0,employee_id:e.employeeId||void 0,line_type:e.lineType||void 0,start_date:e.startDate||void 0,end_date:e.endDate||void 0}})}async function V(){!e.companyId||!e.startDate||!e.endDate||await f.fetchTodoDates({"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate})}function ce(a){e.companyId=a.companyId||"",e.departmentId=a.departmentId||"",e.employeeId=a.employeeId||"",e.lineType=a.lineType||"all",e.startDate=a.startDate||"",e.endDate=a.endDate||""}function ge(){window.print()}const j=v(()=>e.startDate===e.endDate);return E(()=>e.companyId,a=>{a&&(S.fetchDepartments(a),d.fetchEmployee(a))},{immediate:!0}),E(()=>({...e}),(a,n)=>{JSON.stringify(a)!==JSON.stringify(n)&&(ue(),V())},{deep:!0}),E(()=>u.query,a=>{e.companyId=(a==null?void 0:a.company_id)||e.companyId,e.departmentId=(a==null?void 0:a.department_id)||e.departmentId,e.employeeId=(a==null?void 0:a.employee_id)||e.employeeId,e.lineType=(a==null?void 0:a.line_type)||e.lineType,e.startDate=(a==null?void 0:a.start_date)||e.startDate,e.endDate=(a==null?void 0:a.end_date)||e.endDate}),fe(()=>{d.fetchCompanies({ignore_permission:!0}),V()}),(a,n)=>(l(),p("div",Ve,[le(Oe,{"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate,loading:U(f).loading,class:"mb-4 print:px-0 print:py-0 print:mb-2 print:border-0 print:border-b print:border-gray-400 print:rounded-none print:w-full",onChange:ce,onReloadClick:V},{before:B(()=>n[0]||(n[0]=[t("div",null,[t("h1",{class:"text-xl font-semibold text-gray-800"},"Todo Report")],-1)])),after:B(()=>[t("button",{type:"button",class:"btn-icon print-hide disabled:opacity-35 cursor-pointer disabled:cursor-not-allowed",onClick:se(ge,["prevent"]),disabled:U(f).loading},n[1]||(n[1]=[t("i",{class:"fas fa-print"},null,-1)]),8,Be)]),_:1},8,["company-id","department-id","employee-id","line-type","start-date","end-date","loading"]),e.companyId&&e.startDate&&e.endDate?(l(),p("div",Me,[t("div",je,[t("div",null,[n[2]||(n[2]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Company",-1)),t("div",Fe,m(w.value.company),1)]),t("div",null,[n[3]||(n[3]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Department",-1)),t("div",{class:_(["font-medium",[w.value.department=="All Departments"?"text-gray-400":"text-gray-800"]])},m(w.value.department),3)]),t("div",null,[n[4]||(n[4]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Line Type",-1)),t("div",{class:_(["font-medium",[w.value.lineType=="All Types"?"text-gray-400":"text-gray-800"]])},m(w.value.lineType),3)]),t("div",null,[n[5]||(n[5]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Employee",-1)),t("div",{class:_(["font-medium",[w.value.employee=="All Employees"?"text-gray-400":"text-gray-800"]])},m(w.value.employee),3)]),t("div",ze,[n[6]||(n[6]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Date",-1)),t("div",Pe,m(w.value.dateRange),1)])])])):I("",!0),!e.companyId||!e.startDate||!e.endDate?(l(),p("div",He,n[7]||(n[7]=[t("p",{class:"text-red-500"},"Select company and date range to view the report.",-1)]))):U(f).loading?(l(),we(De,{key:2},{default:B(()=>n[8]||(n[8]=[re("Loading report...")])),_:1,__:[8]})):O.value.length===0?(l(),p("div",Je,n[9]||(n[9]=[t("div",null,[t("i",{class:"fas fa-tasks fa-2x text-gray-300 mb-2"})],-1),t("div",null,"No todos.",-1)]))):(l(),p("div",Ke,[t("table",Qe,[t("thead",We,[t("tr",Ye,[n[10]||(n[10]=t("th",{class:"px-4 py-3 border w-[10px] bg-white bg-opacity-70 backdrop-blur-sm"},"sl",-1)),n[11]||(n[11]=t("th",{class:"px-4 py-3 border w-[300px] print:border-l print:border-l-gray-400 bg-white bg-opacity-70 backdrop-blur-sm"}," Name ",-1)),j.value?I("",!0):(l(),p("th",Xe," Date ")),n[12]||(n[12]=t("th",{class:"px-4 py-3 border bg-white"},"Todo",-1)),n[13]||(n[13]=t("th",{class:"px-4 py-3 border print:border-r print:border-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center"}," Status ",-1))])]),t("tbody",Ze,[(l(!0),p(R,null,M(O.value,(r,y)=>{var i,b,T;return l(),p(R,{key:((i=r.user)==null?void 0:i.id)||(((T=(b=r.dates[0])==null?void 0:b.todos[0])==null?void 0:T.id)??Math.random())},[(l(!0),p(R,null,M(r.dates,c=>{var $;return l(),p(R,{key:`${(($=r.user)==null?void 0:$.id)||"u"}-${c.date}`},[(l(!0),p(R,null,M(c.todos,(x,D)=>{var C,g,N,Q,W,Y,X,Z,G,q,ee;return l(),p("tr",{key:x.id,class:"hover:bg-gray-50 border"},[c===r.dates[0]&&D===0?(l(),p("td",{key:0,rowspan:r.rowSpan,class:"px-4 py-3 align-top font-bold text-xl text-gray-800 whitespace-nowrap border-l border-t"},m(y+1),9,Ge)):I("",!0),c===r.dates[0]&&D===0?(l(),p("td",{key:1,rowspan:r.rowSpan,class:"px-4 py-3 align-top font-medium text-gray-800 whitespace-nowrap border-l border-t"},[t("div",null,m(((C=r.user)==null?void 0:C.name)||"Unknown user"),1),(N=(g=r.user)==null?void 0:g.department)!=null&&N.name?(l(),p("div",et,m((W=(Q=r.user)==null?void 0:Q.department)==null?void 0:W.name),1)):I("",!0),(X=(Y=r.user)==null?void 0:Y.company)!=null&&X.name?(l(),p("div",tt,m((G=(Z=r.user)==null?void 0:Z.company)==null?void 0:G.name),1)):I("",!0)],8,qe)):I("",!0),D===0&&!j.value?(l(),p("td",{key:2,rowspan:c.rowSpan,class:"px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap border-l border-t"},m(U(L)(c.date)||c.date||"-"),9,at)):I("",!0),t("td",nt,[t("div",dt,[t("span",rt,m(D+1)+".",1),re(" "+m(x.title),1)]),t("div",ot,m(((q=x.todoable)==null?void 0:q.title)||((ee=x.todoable_type)==null?void 0:ee.split("\\").pop())||""),1)]),t("td",st,[t("span",{class:_(["text-xs font-semibold px-2.5 py-1 rounded-full",ye(x.status)])},m(x.status||"N/A"),3)])])}),128))],64)}),128))],64)}),128))])])]))]))}};export{Dt as default};
