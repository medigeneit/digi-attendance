import{u as q}from"./designation-CHtQrl8Q.js";import{r as g,y as L,i as A,o as r,c as d,a as e,t as p,w as j,d as x,z as F,F as M,q as S,h as V,v as $,e as B,x as T,n as I,b as N,k as w}from"./index-AYxz4H6X.js";import{_ as G,a as O}from"./HeaderWithButtons-djbODhEw.js";import{u as z}from"./company-D-wy9W2F.js";import{L as H}from"./LoaderView-CtV-Y6Be.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={key:0,class:"modal-bg"},K={class:"modal-card"},P={class:"text-lg font-semibold mb-4"},Q={class:"mb-4"},R=["value"],W={class:"mb-4"},X={class:"mb-4"},Y={class:"mb-4"},Z={class:"mb-4"},ee={class:"flex justify-end"},te={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},se={__name:"DesignationModal",props:{show:{type:Boolean,required:!0},designation:{type:Object,default:null}},emits:["close","save"],setup(k,{emit:c}){const i=k,u=c,m=z(),a=g(!1),h=g(!1),s=L({id:null,company_id:"",title:"",grade:"",description:"",status:"Active"}),v=()=>{a.value=!1,s.id=null,s.company_id="",s.title="",s.grade="",s.description="",s.status="Active"};A(()=>i.designation,l=>{l&&Object.keys(l).length>0?(a.value=!0,s.id=l.id||null,s.company_id=l.company_id||"",s.title=l.title||"",s.grade=l.grade||"",s.description=l.description||"",s.status=l.status||"Active"):v()},{immediate:!0,deep:!0}),A(()=>i.show,async l=>{l&&!h.value&&await C()});const D=()=>{u("save",{...s}),v(),b()},b=()=>{v(),u("close")},C=async()=>{try{await m.fetchCompanies(),h.value=!0}catch(l){console.error("Failed to fetch companies:",l)}};return(l,o)=>k.show?(r(),d("div",J,[e("div",K,[e("h2",P,p(a.value?"Edit Designation":"Add Designation"),1),e("form",{onSubmit:j(D,["prevent"])},[e("div",Q,[o[6]||(o[6]=e("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),x(e("select",{id:"company_id","onUpdate:modelValue":o[0]||(o[0]=t=>s.company_id=t),class:"w-full border rounded px-3 py-2",required:""},[o[5]||(o[5]=e("option",{value:"",disabled:""},"Select a company",-1)),(r(!0),d(M,null,S(V(m).companies,t=>(r(),d("option",{key:t.id,value:t.id},p(t.name),9,R))),128))],512),[[F,s.company_id]])]),e("div",W,[o[7]||(o[7]=e("label",{for:"title",class:"block text-sm font-medium mb-2"},"Title",-1)),x(e("input",{id:"title","onUpdate:modelValue":o[1]||(o[1]=t=>s.title=t),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter designation title",required:""},null,512),[[$,s.title]])]),e("div",X,[o[8]||(o[8]=e("label",{for:"grade",class:"block text-sm font-medium mb-2"},"Grade",-1)),x(e("input",{id:"grade","onUpdate:modelValue":o[2]||(o[2]=t=>s.grade=t),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter grade (optional)"},null,512),[[$,s.grade]])]),e("div",Y,[o[9]||(o[9]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),x(e("textarea",{id:"description","onUpdate:modelValue":o[3]||(o[3]=t=>s.description=t),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[$,s.description]])]),e("div",Z,[o[11]||(o[11]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),x(e("select",{id:"status","onUpdate:modelValue":o[4]||(o[4]=t=>s.status=t),class:"w-full border rounded px-3 py-2",required:""},o[10]||(o[10]=[e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)]),512),[[F,s.status]])]),e("div",ee,[e("button",{type:"button",onClick:b,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",te,p(a.value?"Update":"Create"),1)])],32)])])):B("",!0)}},oe={class:"my-container space-y-4"},le={key:0,class:"text-center py-4"},ae={key:1,class:"space-y-4"},ne={class:"title-md"},ie={class:"overflow-x-auto"},re={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},de={class:"text-gray-600 text-sm"},ce={class:"py-3 px-2 text-left"},ue={class:"py-3 px-2 text-left whitespace-nowrap"},pe={class:"py-3 px-2 text-center"},me={class:"py-3 px-2 text-center"},fe={class:"flex item-center justify-center gap-4"},ye=["onClick"],ve=["onClick"],ke={__name:"DesignationList",setup(k){const c=q(),i=T(),u=g(!1),m=g(!1),a=g(null),h=()=>{a.value=null,u.value=!0},s=()=>{u.value=!1},v=t=>{a.value=t,u.value=!0},D=t=>{a.value=t,m.value=!0},b=()=>{m.value=!1},C=async t=>{try{t.id?(await c.updateDesignation(t.id,t),i.success("Designation updated successfully!")):(await c.createDesignation(t),i.success("Designation added successfully!"))}catch(n){i.error("Failed to save designation!"),console.error("Error handling save:",n)}finally{s()}},l=async()=>{if(!a.value||!a.value.id){i.error("Invalid designation selected for deletion!");return}try{await c.deleteDesignation(a.value.id),i.success("Designation deleted successfully!")}catch(t){i.error("Failed to delete designation!"),console.error("Error deleting designation:",t)}finally{b()}},o=I(()=>{const t={};return c.designations.forEach(n=>{var _;const f=((_=n==null?void 0:n.company)==null?void 0:_.name)||"Unknown Company";t[f]||(t[f]=[]),t[f].push(n)}),t});return N(async()=>{try{await c.fetchDesignations()}catch(t){i.error("Failed to fetch designations!"),console.error("Error fetching designations:",t)}}),(t,n)=>{var f;return r(),d("div",oe,[w(O,{title:"Designation List",onAdd:h}),V(c).loading?(r(),d("div",le,[w(H)])):(r(),d("div",ae,[(r(!0),d(M,null,S(o.value,(_,E)=>(r(),d("div",{key:E},[e("h2",ne,p(E),1),e("div",ie,[e("table",re,[n[2]||(n[2]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-left"},"Title"),e("th",{class:"py-3 px-2 text-left"},"Grade"),e("th",{class:"py-3 px-2 text-center"},"Status"),e("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),e("tbody",de,[(r(!0),d(M,null,S(_,y=>(r(),d("tr",{key:y.id,class:"border-b border-gray-200 hover:bg-gray-100"},[e("td",ce,p(y.title),1),e("td",ue,p(y.grade),1),e("td",pe,p(y.status),1),e("td",me,[e("div",fe,[e("button",{onClick:U=>v(y),class:"text-blue-600 hover:text-blue-800"},n[0]||(n[0]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ye),e("button",{onClick:U=>D(y),class:"text-red-600 hover:text-red-800"},n[1]||(n[1]=[e("i",{class:"fas fa-trash"},null,-1)]),8,ve)])])]))),128))])])])]))),128))])),w(se,{show:u.value,designation:a.value,onClose:s,onSave:C},null,8,["show","designation"]),w(G,{show:m.value,title:"Delete Designation",message:`Are you sure you want to delete ${(f=a.value)==null?void 0:f.title}?`,onClose:b,onConfirm:l},null,8,["show","message"])])}}};export{ke as default};
