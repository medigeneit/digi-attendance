import{c as o,o as n,F as V,x as j,m as _,p as C,I as F,G as K,q as y,a as t,y as S,z as Q,n as b,t as h,k as H,b as W,r as z,A as X,f as g,w as B,l as $,h as Z}from"./index-Di2G5o7k.js";import{_ as ee}from"./UserChip-DksBsthZ.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"mt-3"},se={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(e,{emit:d}){const a=d;return(f,u)=>(n(),o("div",te,[(n(!0),o(V,null,j(e.childrenTasks,(c,k)=>(n(),_(Ie,{key:c.id,index:k,task:c,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:u[0]||(u[0]=l=>a("editClick",l)),onAddClick:u[1]||(u[1]=l=>a("addClick",l))},{"item-end":C(({task:l,level:r})=>[F(f.$slots,"treeItemEnd",{task:l,level:r})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ae=K({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:d}){const a=e,f=y(function(){if(a.task.children_tasks.length===0)return a.task.status==="COMPLETED"?1:0;const k=l=>{let r=0;for(let m=0;m<l.length;m++){const p=l[m];if(p.children_tasks.length===0)p.status==="COMPLETED"&&(r+=1);else{const L=p.children_tasks.length;k(p.children_tasks)===L&&(r+=1)}}return r};return k(a.task.children_tasks)}),u=y(()=>a.task.children_tasks.length===0?a.task.status==="COMPLETED"?100:0:f.value/a.task.children_tasks.length*100),c=y(()=>{const k=u.value;let l,r,m;return k===100?(l="bg-green-50",r="bg-green-200",m="text-green-600 "):k<100&&(l="bg-red-50",r="bg-red-200",m="text-red-600 "),{container:l,bar:r,text:m}});return d({completedPercentage:u.value,completedSubTaskCount:f.value}),(k,l)=>(n(),o("div",null,[t("div",{class:S(["rounded-full border py-0.5 relative overflow-hidden h-6",c.value.container]),style:{width:"180px"}},[t("div",{class:S(["z-10 absolute top-0 bottom-0",c.value.bar]),style:Q(`width: ${u.value}%`)},null,6),t("span",{class:S(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",c.value.text])},[t("span",null,[t("span",null,h(f.value),1),l[0]||(l[0]=b(" / ")),t("span",null,h(k.task.children_tasks.length||1),1)])],2)],2)]))}}),J=e=>{if(!e)return"";try{const d=new Date(e);if(isNaN(d))return"";const a=String(d.getDate()).padStart(2,"0"),u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()],c=d.getFullYear();return`${a}-${u}-${c}`}catch{return""}},ne={},re={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function le(e,d){return n(),o("span",re,"IMPORTANT")}const oe=U(ne,[["render",le]]),ie={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(d,a)=>{const f=H("RouterLink");return n(),_(f,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:C(()=>[t("div",null,h(e.task.title),1)]),_:1},8,["to"])}}},de={},ue={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function ce(e,d){return n(),o("span",ue,"URGENT")}const ke=U(de,[["render",ce]]),ge={class:"flex w-full"},fe={key:0,class:"border-l border-gray-200 last:border-l-0"},me={class:"items-start grid grid-cols-3 group"},he={class:"flex gap-4 items-center"},xe={key:0,class:"text-xl font-semibold text-sky-500"},ve={class:"text-gray-500 text-sm"},pe={class:"flex items-center gap-2"},be={key:0,class:"text-sm text-gray-500 mt-2"},ye={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},_e={class:"flex items-center flex-wrap gap-3"},Ce={key:0,class:"text-gray-500 text-xs"},Te={class:"flex justify-end items-center gap-2"},we={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200"},$e={class:"mt-4"},Se={class:"flex items-center"},Le={key:0,class:"fas fa-caret-down text-gray-400 group-hover:text-sky-400"},Ne={key:1,class:"fas fa-caret-right text-gray-400 group-hover:text-sky-400"},Be=["href"],De={class:"ml-auto text-right text-sm"},Ae={key:0,class:"text-gray-500"},Ee={class:"font-semibold text-green-800"},Re={key:1,class:"ml-4 text-gray-500"},Oe={class:"text-red-500 font-semibold"},Me={key:0,class:"flex gap-2 ml-4 items-center text-xs"},Pe=["href"],qe={class:"ml-0"},Ie={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick"],setup(e,{emit:d}){const a=e,f=W(),u=z(null),c=d;function k(i){c("addClick",i)}function l(i){c("editClick",i)}const r=z([]),m=localStorage.getItem("sub_task_opened_list");if(m)try{r.value=JSON.parse(m)}catch{r.value=[]}const p=y(()=>J(a.task.started_at)),L=y(()=>J(a.task.deadline)),T=y({get:()=>r.value.includes(a.task.id),set:i=>{const s=r.value.includes(a.task.id);i&&!s?r.value.push(a.task.id):!i&&s&&(r.value=r.value.filter(v=>v!==a.task.id))}});X(r,i=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(i))},{deep:!0});const G=y(()=>{var i,s,v,w;return{"hover:underline hover:text-sky-400 cursor-pointer":((s=(i=a.task)==null?void 0:i.children_tasks)==null?void 0:s.length)>0,"cursor-default pointer-none":((w=(v=a.task)==null?void 0:v.children_tasks)==null?void 0:w.length)===0}});function Y(){a.task.children_tasks.length>0&&(T.value=!T.value)}return(i,s)=>{var w,D,A,E,R,O,M,P,q,I;const v=H("RouterLink");return n(),o("div",ge,[e.treeLevel>0?(n(),o("div",fe,s[3]||(s[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):g("",!0),t("div",{class:S(["flex-grow border rounded py-3 px-3",{"bg-green-100  ":((w=u.value)==null?void 0:w.completedPercentage)===100,"bg-white hover:bg-gray-50":((D=u.value)==null?void 0:D.completedPercentage)<100,"shadow-sm":e.treeLevel>0}])},[t("div",me,[t("div",null,[t("div",null,[t("div",he,[e.index!==void 0?(n(),o("div",xe,h(e.index+1),1)):g("",!0),e.showDraggableHandle?(n(),o("button",{key:1,onMousedown:s[0]||(s[0]=B((...x)=>i.handleDragging&&i.handleDragging(...x),["stop"])),class:"handle"},s[4]||(s[4]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):g("",!0),t("span",ve," #"+h(e.task.id),1)]),t("div",pe,[$(ie,{task:e.task},null,8,["task"])])]),(A=e.task)!=null&&A.requirement?(n(),o("p",be," Requirement: "+h((R=(E=e.task)==null?void 0:E.requirement)==null?void 0:R.title),1)):g("",!0),t("div",ye,[(O=e.task)!=null&&O.is_important?(n(),_(oe,{key:0})):g("",!0),(M=e.task)!=null&&M.is_urgent?(n(),_(ke,{key:1})):g("",!0)])]),t("div",_e,[(n(!0),o(V,null,j(e.task.users,(x,N)=>(n(),_(v,{key:N,to:{name:"TaskList",query:{...Z(f).query,view:"userwise","company-id":x.company_id,"user-ids":x.id}}},{default:C(()=>[$(ee,{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",user:x},null,8,["user"])]),_:2},1032,["to"]))),128)),e.task.users.length===0?(n(),o("div",Ce," Not Assigned To Anyone ")):g("",!0),$(v,{to:{name:"TaskUserAssign",params:{id:(P=e.task)==null?void 0:P.id}},title:"Assign user",class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},{default:C(()=>s[5]||(s[5]=[t("i",{class:"fas fa-user-plus"},null,-1)])),_:1},8,["to"])]),t("div",Te,[t("span",we,h(e.task.status),1),$(ae,{task:e.task,ref_key:"progress",ref:u,class:"text-sm"},null,8,["task"])])]),t("div",$e,[t("div",Se,[t("div",{class:"flex gap-3 group items-center",onClick:Y},[T.value?(n(),o("i",Le)):(n(),o("i",Ne)),t("span",{class:S([G.value,"text-xs text-gray-500"])},[b(" Sub Tasks ("+h((q=e.task.children_tasks)==null?void 0:q.length)+") ",1),t("a",{href:`/tasks/add?parent_id=${a.task.id}`,class:"hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border border-transparent ml-2",onClick:s[1]||(s[1]=B(x=>c("addClick",a.task.id),["stop","prevent"]))},s[6]||(s[6]=[t("i",{class:"fas fa-plus"},null,-1),b(" Add Sub Task ")]),8,Be)],2)]),t("div",De,[p.value?(n(),o("span",Ae,[s[7]||(s[7]=b(" Started: ")),t("span",Ee,h(p.value),1)])):g("",!0),L.value?(n(),o("span",Re,[s[8]||(s[8]=b(" Deadline: ")),t("span",Oe,h(L.value),1)])):g("",!0)]),e.hideButtons?g("",!0):(n(),o("div",Me,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:s[2]||(s[2]=B(x=>c("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},s[9]||(s[9]=[t("i",{class:"fas fa-edit"},null,-1),b(" Edit ")]),8,Pe),$(v,{to:{name:"TaskReports",params:{id:(I=e.task)==null?void 0:I.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:C(()=>s[10]||(s[10]=[t("i",{class:"far fa-file-alt"},null,-1),b(" Reports ")])),_:1},8,["to"])]))]),t("div",qe,[T.value?(n(),_(se,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:l,onAddClick:k},{"tree-item-end":C(({task:x,level:N})=>[F(i.$slots,"item-end",{level:N,task:x})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):g("",!0)])])],2)])}}};export{Ie as _,ae as a,J as g};
