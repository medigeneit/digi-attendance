import{B as V,r as i,x as m,C as v,ab as j,Q as A,q as B,c as E,o as D,a as e,d as k,l as T,j as q,w as L,z as O,t as b,s as H,k as z,v as K,T as Q,F as R}from"./index-CTTU2Cjr.js";import{_ as G}from"./TimePickerAsFloatHour-GAeyBBNN.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W=V("paycut",()=>{const f=i([]),h=i(null),c=i(!1),o=i(null),w=i(new Date().toISOString().substring(0,7)),d=m(()=>new Date(w.value).toLocaleString("default",{month:"long",year:"numeric"})),I=async(a={})=>{var s,u,t;c.value=!0,o.value=null;try{const r=await v.get("/paycuts",{params:a});f.value=((s=r==null?void 0:r.data)==null?void 0:s.data)||(r==null?void 0:r.data)||[]}catch(r){o.value=((t=(u=r.response)==null?void 0:u.data)==null?void 0:t.message)||"Failed to fetch paycuts",console.error("Error fetching paycuts:",r)}finally{c.value=!1}},x=async(a,s)=>{var u,t;c.value=!0,o.value=null;try{const r=await v.get(`/paycuts/${a}/${s}`);h.value=r.data}catch(r){o.value=((t=(u=r.response)==null?void 0:u.data)==null?void 0:t.message)||"Failed to fetch paycuts",console.error("Error fetching paycuts:",r)}finally{c.value=!1}},_=async(a={})=>{var s,u;c.value=!0,o.value=null;try{const t=await v.post("/paycuts",a);return f.value.push(t.data),t.data}catch(t){throw o.value=((u=(s=t.response)==null?void 0:s.data)==null?void 0:u.message)||"Failed to create paycut",console.error("Error creating paycut:",t),new Error(o.value)}finally{c.value=!1}},y=async a=>{var s,u;c.value=!0,o.value=null;try{const t=await v.get(`/paycuts/${a}`);return h.value=t.data||{},await j().fetchApprovalPermissions("paycut_applications",h.value.id),h.value}catch(t){throw o.value=((u=(s=t.response)==null?void 0:s.data)==null?void 0:u.message)||`Failed to fetch paycut (ID: ${a})`,console.error(`Error fetching paycut with id ${a}:`,t),new Error(o.value)}finally{c.value=!1}};return{paycuts:f,paycut:h,loading:c,error:o,selectedMonth:w,selectedMonthDisplay:d,fetchPaycuts:I,fetchUserMonthlyPaycuts:x,fetchPaycutById:y,createPaycut:_,updatePaycut:async(a,s)=>{var u,t;c.value=!0,o.value=null;try{return(await v.put(`/paycuts/${a}`,s)).data}catch(r){throw o.value=((t=(u=r.response)==null?void 0:u.data)==null?void 0:t.message)||`Failed to update paycut (ID: ${a})`,console.error(`Error updating paycut with id ${a}:`,r),new Error(o.value)}finally{c.value=!1}},deletePaycut:async a=>{var s,u;c.value=!0,o.value=null;try{await v.delete(`/paycuts/${a}`),f.value=f.value.filter(t=>t.id!==a)}catch(t){throw o.value=((u=(s=t.response)==null?void 0:s.data)==null?void 0:u.message)||`Failed to delete paycut (ID: ${a})`,console.error(`Error deleting paycut with id ${a}:`,t),new Error(o.value)}finally{c.value=!1}},approvePaycut:async a=>{var s,u;try{await v.post(`/paycuts/${a}/approve`),await y(a)}catch(t){throw o.value=((u=(s=t.response)==null?void 0:s.data)==null?void 0:u.message)||`Failed to approve paycut (ID: ${a})`,console.error(t),new Error(o.value)}},rejectPaycut:async a=>{var s,u;try{await v.post(`/paycuts/${a}/reject`),await y(a)}catch(t){throw o.value=((u=(s=t.response)==null?void 0:s.data)==null?void 0:u.message)||`Failed to reject paycut (ID: ${a})`,console.error(t),new Error(o.value)}}}}),X={class:"modal-card max-w-lg"},Y={class:"modal-card__head"},Z={id:"paycut-modal-title",class:"modal-card__title"},ee={class:"modal-card__subtitle"},ae={class:"modal-card__meta"},te={class:"meta-value"},se={class:"meta-value"},le={class:"modal-card__body"},oe={class:"field-control flex flex-col gap-2"},ue={class:"flex flex-col gap-2"},re={class:"modal-card__footer"},ne={class:"footer-status"},ce={class:"modal-card__actions"},ie=["disabled","aria-busy"],de={key:0,class:"loading-dots"},pe={key:1},ye={__name:"UpdateOrCreate",props:{userId:{type:[String,Number],required:!0},month:{type:String,required:!0},show:Boolean},emits:["updated"],setup(f,{emit:h}){const c=A(),o=i(0),w=i(54),d=f,I=h,x=m(()=>p.value>=o.value&&p.value<=w.value),_=W(),y=i(!1),P=i(!1),p=i(""),g=i(""),S=i(""),a=i(null),s=m(()=>{var n;return!!((n=a.value)!=null&&n.id)}),u=m(()=>s.value?"Update Paycut":"Create Paycut"),t=m(()=>s.value?"Save changes":"Create paycut"),r=m(()=>x.value&&p.value!==""),M=m(()=>{if(!d.month)return"";const[n,l]=d.month.split("-");return!n||!l?d.month:new Date(Number(n),Number(l)-1).toLocaleString("en",{month:"long",year:"numeric"})});m(()=>`Allowed: ${o.value}h - ${w.value}h per cycle`);const F=async()=>{try{await _.fetchUserMonthlyPaycuts(d.userId,d.month);const n=_.paycut;a.value=n||null,p.value=Number((n==null?void 0:n.paycut_hours)||0)||0,g.value=(n==null?void 0:n.reason)||"",S.value=(n==null?void 0:n.note)||"",console.log({record:n})}catch(n){console.error("Failed to fetch paycut:",n),a.value=null,p.value="",g.value="",S.value=""}};B(()=>[d.userId,d.month],async()=>{y.value&&await F()});const N=async()=>{if(!x.value)return c.error(`Paycut hour must be between ${o.value} and ${w.value}`);if(window.confirm(s.value?"Are you sure you want to update this paycut? This can only be done once.":"Are you sure you want to create this paycut?"))try{P.value=!0,s.value?await _.updatePaycut(a.value.id,{paycut_hours:p.value,reason:g.value,note:S.value}):await _.createPaycut({paycut_hours:p.value,reason:g.value,note:S.value,user_id:d.userId,month:d.month}),I("updated"),$()}catch(l){alert("Failed to submit paycut: "+l.message)}finally{P.value=!1}},$=()=>{y.value=!1},U=async()=>{y.value=!0,await F()};return(n,l)=>(D(),E(R,null,[e("button",{type:"button",class:"paycut-trigger",onClick:U,title:"Adjust paycut hours"},l[2]||(l[2]=[e("i",{class:"far fa-edit"},null,-1)])),k(Q,{name:"fade-scale"},{default:T(()=>[y.value?(D(),E("div",{key:0,class:"modal-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"paycut-modal-title",onKeydown:O($,["esc"]),onClick:L($,["self"])},[e("div",X,[e("header",Y,[l[4]||(l[4]=e("div",{class:"icon-circle"},[e("i",{class:"fal fa-wallet"})],-1)),e("div",null,[e("p",Z,b(u.value),1),e("p",ee,b(s.value?"Adjust existing deduction for this period.":"Create a one-off deduction."),1)]),e("button",{class:"icon-button",type:"button",onClick:$},l[3]||(l[3]=[e("i",{class:"far fa-times"},null,-1)]))]),e("section",ae,[e("div",null,[l[5]||(l[5]=e("p",{class:"meta-label"},"Month",-1)),e("p",te,b(M.value),1)]),e("div",null,[l[6]||(l[6]=e("p",{class:"meta-label"},"User ID",-1)),e("p",se,"#"+b(d.userId),1)]),e("div",null,[l[7]||(l[7]=e("p",{class:"meta-label"},"Status",-1)),e("span",{class:H(["status-badge",s.value?"status-badge--warn":"status-badge--fresh"])},b(s.value?"Existing":"New"),3)])]),e("section",le,[e("div",oe,[l[8]||(l[8]=e("label",{class:"field-label"},"Paycut hours",-1)),k(G,{modelValue:p.value,"onUpdate:modelValue":l[0]||(l[0]=C=>p.value=C),"minute-interval":5,required:!0,"hour-min":o.value,"hour-max":w.value},null,8,["modelValue","hour-min","hour-max"])]),e("div",ue,[l[9]||(l[9]=e("label",{class:"field-label"},"Reason",-1)),z(e("textarea",{class:"input-1",rows:"3","onUpdate:modelValue":l[1]||(l[1]=C=>g.value=C),placeholder:"Share context that explains the deduction..."},null,512),[[K,g.value]])])]),e("footer",re,[e("div",ne,[l[10]||(l[10]=e("i",{class:"fal fa-info-circle"},null,-1)),e("span",null,b(r.value?"Double-check before saving - this impacts payout immediately.":"Fill the required fields to continue."),1)]),e("div",ce,[e("button",{class:"btn-3",type:"button",onClick:$},"Cancel"),e("button",{class:"btn-2-green",type:"button",disabled:!r.value||P.value,"aria-busy":P.value,onClick:N},[P.value?(D(),E("span",de,"Saving...")):(D(),E("span",pe,b(t.value),1))],8,ie)])])])],32)):q("",!0)]),_:1})],64))}},he=J(ye,[["__scopeId","data-v-52762c32"]]);export{he as U,W as u};
