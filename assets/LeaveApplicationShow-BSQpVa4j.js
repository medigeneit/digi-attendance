import{_ as f}from"./ApprovalItem-D7_sibve.js";import{L as at}from"./LoaderView-U_w1q7GS.js";import{_ as st}from"./ShareComponent-huPCvbzx.js";import{g as lt,u as ot,f as nt,x as w,r as y,h as rt,c as r,o as n,a as e,i as it,d as g,b as i,t as l,F as D,e as R,j as c,s as T}from"./index-BXiBRMZd.js";import{u as dt}from"./leave-application-DuVaXVJ7.js";import"./AcceptAndRejectHandler-DXXMqbE5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ut={class:"my-container max-w-3xl space-y-6"},ct={key:1,class:"card-bg p-4 md:p-8 print:text-black"},pt={class:"title-lg text-center"},vt={class:"text-center text-sm"},bt={class:"space-y-4"},mt={class:"grid md:grid-cols-2 print:grid-cols-2 gap-8"},yt={class:"text-sm"},gt={class:"pt-6"},ft={key:0},_t={key:1,class:"font-semibold"},xt={class:"flex justify-end gap-4"},kt={class:"table-auto border border-black bg-white text-xs"},ht={class:"border border-black px-2"},wt={class:"border border-black px-2"},Dt={class:"border border-black px-2"},At={class:"font-bold"},Lt={class:"border border-black px-2"},jt={class:"table-auto border border-black bg-white text-xs"},Rt={class:"border border-black"},Tt={colspan:"2",class:"border border-black px-2 w-32"},Bt={class:"border border-black px-2"},St={class:"border border-black px-2"},Ct={class:"font-bold"},Ft={class:"border border-black px-2"},Mt={class:"grid print:grid-cols-2 md:grid-cols-2 text-sm list-none px-2"},Ut={class:"text-sm"},Et={class:"whitespace-pre-line"},Wt={class:"pt-8 grid grid-cols-2"},Nt={class:"text-sm"},Pt={class:"font-bold"},It={class:"text-blue-700 print:text-black"},$t={class:"overflow-x-auto"},zt={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},Gt={class:"border border-gray-500 px-4 py-0.5 text-left"},Ot={class:"border border-gray-500 px-4 py-0.5 text-center"},Vt={class:"border border-gray-500 px-4 py-0.5 text-center"},Ht={class:"space-y-14"},Jt={class:"flex items-center gap-4 justify-center"},qt={key:0},Xt={key:0,class:"text-xs text-slate-600"},Yt={class:"grid md:grid-cols-3 print:grid-cols-3 gap-4 text-sm items-end"},Zt={class:"flex justify-evenly text-sm items-end"},Kt={class:"mt-10 print:hidden space-y-3"},Qt={key:0,class:"border rounded-lg bg-white p-3 flex items-center gap-3"},ea={class:"shrink-0"},ta=["src"],aa={key:1,class:"h-16 w-16 grid place-items-center rounded-md border text-slate-500"},sa={class:"min-w-0 flex-1"},la={class:"text-sm font-medium truncate"},oa=["href"],na={key:0,class:"flex gap-2"},ra=["disabled"],ia=["disabled"],da=["disabled"],ua=["accept"],ca={key:0,class:"mt-3 text-sm inline-flex items-center gap-2"},pa={key:2,class:"text-green-600 text-sm"},va={key:3,class:"text-red-600 text-sm"},ze="JPG, PNG, WEBP, PDF",F=10,ha={__name:"LeaveApplicationShow",setup(ba){const B=lt(),_=dt(),Ge=ot(),Oe=nt(),S=w(()=>Oe.params.id),M=y(!0),p=y(!1),x=y(""),k=y(""),A=y(null),L=y(!1),U=y(null),E=["image/jpeg","image/png","image/webp","application/pdf"],a=w(()=>_.leaveApplication),W=w(()=>{var s;return typeof((s=a.value)==null?void 0:s.attachment)=="string"&&a.value.attachment.length>0}),N=w(()=>{var s,t;return((s=a.value)==null?void 0:s.user_id)===((t=B==null?void 0:B.user)==null?void 0:t.id)});rt(async()=>{try{await _.fetchLeaveApplicationById(S.value)}catch(s){console.error("Failed to load leave application:",s)}finally{M.value=!1}});const Ve=()=>Ge.go(-1),He=()=>window.print(),v=s=>{if(!s)return"";const t=new Date(s),d=t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),b=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${d} , ${b}`},j=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",Je=s=>/\.(png|jpe?g|webp|gif)$/i.test(s||""),qe=s=>{try{const t=new URL(s);return decodeURIComponent(t.pathname.split("/").pop()||"attachment")}catch{return(s||"").split("/").pop()||"attachment"}},C=s=>{x.value=s,k.value="",setTimeout(()=>x.value="",2500)},h=s=>{k.value=s,x.value="",setTimeout(()=>k.value="",3500)},P=w(()=>{const s=a.value;if(!s||!s.last_working_date||!s.resumption_date)return 0;const t=new Date(s.last_working_date),d=new Date(s.resumption_date);return Math.ceil((d-t)/(1e3*60*60*24))-1}),m=async()=>{await _.fetchLeaveApplicationById(S.value)},Xe=s=>E.includes(s.type)?s.size/(1024*1024)>F?(h(`Max file size ${F} MB`),!1):!0:(h(`Only ${ze} allowed`),!1),I=async s=>{await _.uploadLeaveApplicationAttachment(S.value,{attachment:s}),await m()},$=async s=>{if(!(!s||!Xe(s))){p.value=!0;try{const t=new FormData;t.append("file",s),t.append("folder","leave-application");const d=await _.fetchFileUpload(t);U.value=d==null?void 0:d.url,await I(U.value),C("Attachment uploaded")}catch(t){console.error("Upload failed:",t),h("Upload failed. Try again.")}finally{p.value=!1,A.value&&(A.value.value="")}}},Ye=async s=>{var d;const t=(d=s.target.files)==null?void 0:d[0];t&&await $(t)},Ze=s=>{s.preventDefault(),L.value=!0},Ke=s=>{s.preventDefault(),L.value=!1},Qe=async s=>{var d,b;s.preventDefault(),L.value=!1;const t=(b=(d=s.dataTransfer)==null?void 0:d.files)==null?void 0:b[0];t&&await $(t)},z=()=>{var s;return(s=A.value)==null?void 0:s.click()},et=async()=>{var s;try{await navigator.clipboard.writeText(((s=a.value)==null?void 0:s.attachment)||""),C("Link copied")}catch{h("Copy failed")}},tt=async()=>{if(W.value&&confirm("Remove current attachment?")){p.value=!0;try{await I(null),C("Attachment removed")}catch(s){console.error("Remove failed:",s),h("Failed to remove attachment")}finally{p.value=!1}}};return(s,t)=>{var d,b,G,O,V,H,J,q,X,Y,Z,K,Q,ee,te,ae,se,le,oe,ne,re,ie,de,ue,ce,pe,ve,be,me,ye,ge,fe,_e,xe,ke,he,we,De,Ae,Le,je,Re,Te,Be,Se,Ce,Fe,Me,Ue,Ee,We,Ne,Pe,Ie,$e;return n(),r("div",ut,[e("div",{class:"flex items-center justify-between gap-2 print:hidden"},[e("button",{class:"btn-3",onClick:Ve},t[0]||(t[0]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[2]||(t[2]=e("h1",{class:"title-md md:title-xl flex-wrap text-center"},"Leave Application",-1)),e("button",{class:"btn-2",onClick:He},t[1]||(t[1]=[e("i",{class:"far fa-print"},null,-1),i(" Print")]))]),M.value?(n(),it(at,{key:0})):(n(),r("div",ct,[e("div",null,[e("h1",pt,l((G=(b=(d=a.value)==null?void 0:d.user)==null?void 0:b.company)==null?void 0:G.name),1),e("p",vt,l((V=(O=a.value)==null?void 0:O.user)==null?void 0:V.company.address),1)]),e("div",bt,[e("div",mt,[e("div",null,[t[5]||(t[5]=e("p",null,"To",-1)),t[6]||(t[6]=e("p",{class:"font-bold"},"Managing Director",-1)),e("p",null,l((q=(J=(H=a.value)==null?void 0:H.user)==null?void 0:J.company)==null?void 0:q.name),1),e("p",yt,l((Y=(X=a.value)==null?void 0:X.user)==null?void 0:Y.company.address),1),e("p",gt,[t[3]||(t[3]=e("b",null,"Subject:",-1)),t[4]||(t[4]=i(" Leave Application for ")),(n(!0),r(D,null,R((Z=a.value)==null?void 0:Z.leave_types,(o,u)=>(n(),r(D,{key:u},[u&&o.days?(n(),r("span",ft,", ")):c("",!0),o.days?(n(),r("span",_t,l(o.type),1)):c("",!0)],64))),128))])]),e("div",xt,[e("div",null,[t[10]||(t[10]=e("h1",{class:"font-semibold"},"Summary",-1)),e("table",kt,[t[9]||(t[9]=e("thead",null,[e("tr",{class:"bg-gray-200 border border-black"},[e("th",{class:"border border-black px-2"},"Type"),e("th",{class:"border border-black px-2"},"Days")])],-1)),e("tbody",null,[(n(!0),r(D,null,R((K=a.value)==null?void 0:K.leave_types,(o,u)=>(n(),r("tr",{key:u,class:"border border-black"},[e("td",ht,l(o.type),1),e("td",wt,l(o.days),1)]))),128)),e("tr",null,[t[7]||(t[7]=e("td",{class:"border-black px-2"},"WL/GHD",-1)),e("td",Dt,l(P.value-((ee=(Q=a.value)==null?void 0:Q.leave_days)==null?void 0:ee.length)),1)]),e("tr",At,[t[8]||(t[8]=e("td",{class:"border border-black px-2"},"Total",-1)),e("td",Lt,l(P.value),1)])])])]),e("div",null,[t[14]||(t[14]=e("h1",{class:"font-semibold"},"Last Leave",-1)),e("table",jt,[e("thead",null,[t[11]||(t[11]=e("tr",{class:"bg-gray-200 border border-black"},[e("th",{colspan:"2",class:"border border-black px-2"},"Date")],-1)),e("tr",Rt,[e("td",Tt,l(j((ae=(te=a.value)==null?void 0:te.last_leave)==null?void 0:ae.date)||"N/A"),1)]),t[12]||(t[12]=e("tr",{class:"bg-gray-200 border border-black"},[e("th",{class:"border border-black px-2"},"Type"),e("th",{class:"border border-black px-2"},"Days")],-1))]),e("tbody",null,[(n(!0),r(D,null,R((le=(se=a.value)==null?void 0:se.last_leave)==null?void 0:le.types,(o,u)=>(n(),r("tr",{key:u,class:"border border-black"},[e("td",Bt,l(o==null?void 0:o.type),1),e("td",St,l(o==null?void 0:o.days),1)]))),128)),e("tr",Ct,[t[13]||(t[13]=e("td",{class:"border border-black px-2"},"Total",-1)),e("td",Ft,l((ne=(oe=a.value)==null?void 0:oe.last_leave)!=null&&ne.types?a.value.last_leave.types.reduce((o,u)=>o+u.days,0):0),1)])])])])])]),e("div",null,[t[22]||(t[22]=e("h3",{class:"font-bold"},"Leave Details:",-1)),e("div",Mt,[e("li",null,[t[15]||(t[15]=e("strong",null,"Reason: ",-1)),i(l(((re=a.value)==null?void 0:re.reason)||"No reason provided"),1)]),e("li",null,[t[16]||(t[16]=e("strong",null,"Leave Days:",-1)),i(" "+l((ie=a.value)==null?void 0:ie.leave_period),1)]),e("li",null,[t[17]||(t[17]=e("strong",null,"Total Days:",-1)),i(" "+l((de=a.value)==null?void 0:de.total_leave_days),1)]),e("li",null,[t[18]||(t[18]=e("strong",null,"Weekends:",-1)),i(" "+l((ve=(pe=(ce=(ue=a.value)==null?void 0:ue.user)==null?void 0:ce.assign_weekend)==null?void 0:pe.weekends)==null?void 0:ve.join(", ")),1)]),e("li",null,[t[19]||(t[19]=e("strong",null,"Last Working Date:",-1)),i(" "+l(j((be=a.value)==null?void 0:be.last_working_date)),1)]),e("li",null,[t[20]||(t[20]=e("strong",null,"Resumption Date:",-1)),i(" "+l(j((me=a.value)==null?void 0:me.resumption_date)),1)]),e("li",null,[t[21]||(t[21]=e("strong",null,"Create Date:",-1)),i(" "+l(v((ye=a.value)==null?void 0:ye.created_at)),1)])])]),e("div",Ut,[e("p",Et,[t[23]||(t[23]=e("strong",null,"Works in Hand: ",-1)),i(l(((ge=a.value)==null?void 0:ge.works_in_hand)||"No details provided"),1)])]),e("div",Wt,[e("div",Nt,[t[29]||(t[29]=e("hr",{class:"w-44 border-black hidden print:block my-1"},null,-1)),e("p",Pt,[t[24]||(t[24]=e("strong",null,"Applicant: ",-1)),e("span",It,l((_e=(fe=a.value)==null?void 0:fe.user)==null?void 0:_e.name),1)]),e("p",null,[t[25]||(t[25]=e("strong",null,"Designation:",-1)),i(" "+l((he=(ke=(xe=a.value)==null?void 0:xe.user)==null?void 0:ke.designation)==null?void 0:he.title),1)]),e("p",null,[t[26]||(t[26]=e("strong",null,"Department:",-1)),i(" "+l((Ae=(De=(we=a.value)==null?void 0:we.user)==null?void 0:De.department)==null?void 0:Ae.name),1)]),e("p",null,[t[27]||(t[27]=e("strong",null,"Phone:",-1)),i(" "+l((je=(Le=a.value)==null?void 0:Le.user)==null?void 0:je.phone),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"Joining Date:",-1)),i(" "+l(j((Te=(Re=a.value)==null?void 0:Re.user)==null?void 0:Te.joining_date)),1)])]),g(f,{application:a.value,type:"leave_applications",item:"handover",date:v(a.value.handover_set_at),onAction:m},null,8,["application","date"])]),e("div",null,[t[31]||(t[31]=e("h1",{class:"font-bold"},"Leave Balance",-1)),e("div",$t,[e("table",zt,[t[30]||(t[30]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-500 px-4 py-0.5 text-left"},"Leave Type"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Total Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Used Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Remaining Days")])],-1)),e("tbody",null,[(n(!0),r(D,null,R((Be=a.value)==null?void 0:Be.leave_balance,(o,u)=>(n(),r("tr",{key:u,class:"hover:bg-blue-200"},[e("td",Gt,l(o.leave_type),1),e("td",Ot,l(o==null?void 0:o.annual_quota),1),e("td",Vt,l(o.used_days),1),e("td",{class:T(["border border-gray-500 px-4 py-0.5 text-center",{"text-green-600 font-bold":o.remaining_days>0,"text-red-600 font-bold":o.remaining_days===0}])},l(o.remaining_days),3)]))),128))])])])])]),e("div",Ht,[e("div",Jt,[t[32]||(t[32]=e("span",{class:"text-sm font-semibold"},"Leave Application Status : ",-1)),e("span",{class:T(["inline-flex items-center gap-2 px-3 py-1.5 font-semibold rounded-full text-xs ring-1",{"bg-yellow-50  text-yellow-800 ring-yellow-200":((Se=a.value)==null?void 0:Se.status)==="Pending","bg-green-50 text-green-700 ring-green-200":((Ce=a.value)==null?void 0:Ce.status)==="Approved","bg-red-50 text-red-700 ring-red-200":((Fe=a.value)==null?void 0:Fe.status)==="Rejected"}])},[e("span",{class:T(["h-1.5 w-1.5 rounded-full",{"bg-yellow-500":((Me=a.value)==null?void 0:Me.status)==="Pending","bg-green-600":((Ue=a.value)==null?void 0:Ue.status)==="Approved","bg-red-600":((Ee=a.value)==null?void 0:Ee.status)==="Rejected"}])},null,2),i(" "+l(((We=a.value)==null?void 0:We.status)||"N/A"),1)],2)]),((Ne=a.value)==null?void 0:Ne.status)==="Rejected"?(n(),r("div",qt,[e("p",null,[t[33]||(t[33]=e("b",null,"Rejected by: ",-1)),i(" "+l((Ie=(Pe=a.value)==null?void 0:Pe.rejected_by_user)==null?void 0:Ie.name),1)]),e("p",null,[t[34]||(t[34]=e("b",null,"Rejection Reason: ",-1)),i(" "+l(a.value.rejection_reason),1)]),($e=a.value)!=null&&$e.rejected_at?(n(),r("p",Xt,[t[35]||(t[35]=e("i",{class:"far fa-clock"},null,-1)),i(" "+l(v(a.value.rejected_at)),1)])):c("",!0)])):c("",!0),e("div",Yt,[g(f,{application:a.value,type:"leave_applications",item:"in_charge",date:v(a.value.in_charge_set_at),onAction:m},null,8,["application","date"]),g(f,{application:a.value,type:"leave_applications",item:"coordinator",date:v(a.value.coordinator_set_at),onAction:m},null,8,["application","date"]),g(f,{application:a.value,type:"leave_applications",item:"operational_admin",date:v(a.value.operational_admin_set_at),onAction:m},null,8,["application","date"])]),e("div",Zt,[g(f,{application:a.value,type:"leave_applications",item:"recommend_by",date:v(a.value.recommended_at),onAction:m},null,8,["application","date"]),g(f,{application:a.value,type:"leave_applications",item:"approved_by",date:v(a.value.approved_at),onAction:m},null,8,["application","date"])])])])),e("section",Kt,[W.value?(n(),r("div",Qt,[e("div",ea,[Je(a.value.attachment)?(n(),r("img",{key:0,src:a.value.attachment,alt:"Attachment preview",class:"h-16 w-16 object-cover rounded-md border"},null,8,ta)):(n(),r("div",aa,t[36]||(t[36]=[e("i",{class:"far fa-file text-2xl"},null,-1)])))]),e("div",sa,[e("p",la,l(qe(a.value.attachment)),1),e("a",{href:a.value.attachment,target:"_blank",class:"text-blue-600 underline text-xs"},"Open link",8,oa)]),N.value?(n(),r("div",na,[e("button",{class:"px-3 py-1.5 rounded-md border text-sm",onClick:et,disabled:p.value},"Copy link",8,ra),e("button",{class:"px-3 py-1.5 rounded-md border text-sm",onClick:z,disabled:p.value},"Replace",8,ia),e("button",{class:"px-3 py-1.5 rounded-md border text-sm text-red-600",onClick:tt,disabled:p.value},"Remove",8,da)])):c("",!0)])):c("",!0),N.value?(n(),r("div",{key:1,class:T(["rounded-xl border-2 border-dashed p-6 transition grid place-items-center text-center",[L.value?"border-blue-500 bg-blue-50":"border-slate-300 hover:border-slate-400",p.value?"opacity-60 pointer-events-none":""]]),onDragover:Ze,onDragleave:Ke,onDrop:Qe},[e("div",{class:"space-y-2"},[t[38]||(t[38]=e("i",{class:"far fa-cloud-upload-alt text-3xl"},null,-1)),e("p",{class:"text-sm text-slate-600"},[t[37]||(t[37]=i(" Drag & drop your file here, or ")),e("button",{class:"text-blue-700 underline font-medium",type:"button",onClick:z},"browse")]),e("p",{class:"text-xs text-slate-500"}," Allowed: "+l(ze)+" • Max "+l(F)+" MB ")]),e("input",{ref_key:"fileInput",ref:A,class:"hidden",type:"file",accept:E.join(","),onChange:Ye},null,40,ua),p.value?(n(),r("div",ca,t[39]||(t[39]=[e("i",{class:"far fa-circle-notch fa-spin"},null,-1),i(" Uploading… ")]))):c("",!0)],34)):c("",!0),x.value?(n(),r("p",pa,l(x.value),1)):c("",!0),k.value?(n(),r("p",va,l(k.value),1)):c("",!0)]),g(st)])}}};export{ha as default};
