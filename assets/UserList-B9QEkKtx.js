import{r as y,q as F,A as w,s as L,c as r,f as H,o as p,a as e,n as I,t as f,h as b,g as k,C as A,F as U,x as q,v as B,u as ee,b as te,e as se,k as oe,l as S,p as C,i as le,y as ae,X as ne}from"./index-lbbj0ndd.js";import{L as ie}from"./LoaderView-B16wzc9G.js";import{u as z}from"./shift-C-dghi1r.js";import{d as R}from"./dayjs.min-Cbbdfn5l.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as re}from"./MultiselectDropdown-DjZWd_kB.js";import{_ as pe}from"./UserChip-BB6ufnKO.js";import{u as ce}from"./company-ChLCCD8V.js";import{u as ue}from"./department-Dh9y6TG4.js";import{u as fe}from"./user-DuKEuSTt.js";const me={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},ye={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},ve={class:"text-lg font-semibold mb-4"},_e={class:"mb-4"},be=["value"],he={class:"mb-4"},xe={class:"mb-4"},ge={class:"flex justify-end gap-3 mt-4"},Se={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(M,{emit:D}){const $=D,i=M,l=y({shift_id:"",employee_id:i.employee.id,start_date:"",end_date:""}),v=F(()=>{const u=Object.keys(i.shifts)[0];return i.shifts[u]||[]});w(()=>i.employee,u=>{l.value.employee_id=(u==null?void 0:u.id)||0},{immediate:!0,deep:!0}),w(()=>i.isOpen,u=>{var n;u&&(i.hasShift?(l.value.shift_id=i.hasShift.shift_id||"",l.value.start_date=i.hasShift.start_date?R(i.hasShift.start_date).format("YYYY-MM-DD"):"",l.value.end_date=i.hasShift.end_date?R(i.hasShift.end_date).format("YYYY-MM-DD"):"",l.value.employee_id=((n=i.employee)==null?void 0:n.id)||""):(l.value.shift_id="",l.value.start_date="",l.value.end_date=""))},{immediate:!0});const m=()=>{$("close",!1)},_=z(),{message:h}=L(_),x=async()=>{if(!l.value.shift_id||!l.value.start_date||!l.value.employee_id){alert("All fields are required!");return}try{const u={...l.value},n=await _.shiftAssign(u);console.log("Shift assigned successfully:",n),alert(i.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),m()}catch(u){console.error("Failed to assign shift:",u),alert("Failed to assign shift.")}};return(u,n)=>M.isOpen?(p(),r("div",me,[e("div",ye,[e("h2",ve,f(i.hasShift?"Update Shift for":"Assign Shift to")+" "+f(M.employee.name),1),I(" "+f(b(h))+" ",1),e("div",_e,[n[4]||(n[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),k(e("select",{"onUpdate:modelValue":n[0]||(n[0]=d=>l.value.shift_id=d),class:"w-full p-2 border rounded"},[n[3]||(n[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(p(!0),r(U,null,q(v.value,d=>(p(),r("option",{key:d==null?void 0:d.id,value:d==null?void 0:d.id},f(d==null?void 0:d.name),9,be))),128))],512),[[A,l.value.shift_id]])]),e("div",he,[n[5]||(n[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),k(e("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=d=>l.value.start_date=d),class:"w-full border rounded p-2"},null,512),[[B,l.value.start_date]])]),e("div",xe,[n[6]||(n[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),k(e("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=d=>l.value.end_date=d),class:"w-full border rounded p-2"},null,512),[[B,l.value.end_date]])]),e("div",ge,[e("button",{onClick:m,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:x,class:"px-4 py-2 bg-green-600 text-white rounded"},f(i.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:m,class:"absolute top-2 right-2 text-red-500 text-xl"},n[7]||(n[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):H("",!0)}},ke=de(Se,[["__scopeId","data-v-c3e70801"]]),we={class:"space-y-2 px-4"},Ce={class:"flex items-center justify-between gap-2"},Ae={class:"flex gap-4"},Ue={class:"flex flex-wrap items-center gap-4"},qe=["value"],Me=["value"],De={key:0,class:"text-center py-4"},Le={key:1,class:"space-y-4"},$e={class:"title-md"},Ee={class:"overflow-x-auto"},je={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},Ve={class:"border border-gray-300 px-2"},Te=["innerHTML"],Ne=["innerHTML"],Oe={class:"border border-gray-300 px-2"},Ye={class:"border border-gray-300 px-2 py-3"},Be={class:"flex justify-center items-center gap-4"},Re={class:"text-sm text-gray-700"},Fe={key:0,class:"text-green-600"},He={key:1,class:"text-red-500 italic"},Ie=["onClick"],ze={key:0},Pe={key:1},We={key:0},Ke={class:"border border-gray-300 px-2"},Xe={class:"border border-gray-300 px-2"},Ge={class:"border border-gray-300 px-2"},Je={key:0,class:"text-green-500"},Qe={key:1,class:"text-red-500"},Ze={class:"border border-gray-300 px-2"},et={class:"flex gap-2"},ut={__name:"UserList",setup(M){const D=z(),{shifts:$}=L(D),i=ee(),l=te(),v=fe();y([]);const m=y(l.query.company||"all"),_=y(l.query.department||"all"),h=y(l.query.line_type||"all"),x=y(l.query.status||"active"),u=y(""),n=y(""),d=y(!1),E=ue(),j=ce(),{companies:P}=L(j),{departments:W}=L(E);se(()=>{v.fetchUsers(),j.fetchCompanies(),V(m.value)});const K=()=>{i.go(-1)};w(m,o=>{V(o),i.push({query:{...l.query,company:o}})}),w(_,o=>{i.push({query:{...l.query,department:o}})}),w(h,o=>{i.push({query:{...l.query,line_type:o}})}),w(x,o=>{i.push({query:{...l.query,status:o}})});const V=async o=>{await E.fetchDepartments(o)},X=F(()=>{var g;let o=[...(v==null?void 0:v.users)||[]];if(m.value!=="all"&&(o=o.filter(t=>{var c;return((c=t==null?void 0:t.company)==null?void 0:c.id)==m.value})),_.value!=="all"&&(o=o.filter(t=>{var c;return((c=t==null?void 0:t.department)==null?void 0:c.id)==_.value})),h.value!=="all"&&(o=o.filter(t=>(t==null?void 0:t.type)==h.value)),x.value){const t=x.value==="active"?1:0;o=o.filter(c=>(c==null?void 0:c.is_active)==t)}(g=u.value)!=null&&g.id&&(o=o.filter(t=>(t==null?void 0:t.id)==u.value.id));const s={};return o.forEach(t=>{var a;const c=((a=t==null?void 0:t.company)==null?void 0:a.name)||"Unknown Company";s[c]||(s[c]=[]),s[c].push(t)}),s}),T=y("");function G(o){T.value=o.id,n.value=o,(o==null?void 0:o.company_id)!==void 0&&(D.fetchShifts(o==null?void 0:o.company_id),d.value=!d.value)}function J(){d.value=!1}async function Q(){await v.fetchUsersExcelExport({data:{company_id:m.value,department_id:_.value,line_type:h.value,status:x.value}})}const N=o=>{if(o){const s=o.split(" "),g=s.slice(0,2).join(" "),t=s.length>2?`<br>${s.slice(2).join(" ")}`:"";return g+t}return""};return(o,s)=>{const g=oe("RouterLink");return p(),r("div",we,[e("div",Ce,[e("button",{class:"btn-3",onClick:K},s[5]||(s[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),s[8]||(s[8]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),e("div",Ae,[S(g,{to:{name:"UserAdd",query:{company:b(l).query.company}},class:"btn-2"},{default:C(()=>s[6]||(s[6]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[6]},8,["to"]),e("button",{type:"button",onClick:Q,class:"btn-3"},s[7]||(s[7]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),I("Excel ")]))])]),e("div",Ue,[e("div",null,[k(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>m.value=t),class:"input-1"},[s[9]||(s[9]=e("option",{value:"all",selected:""},"All Company",-1)),(p(!0),r(U,null,q(b(P),(t,c)=>(p(),r("option",{key:c,value:t.id},f(t==null?void 0:t.name),9,qe))),128))],512),[[A,m.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>_.value=t),class:"input-1"},[s[10]||(s[10]=e("option",{value:"all",selected:""},"All Department",-1)),(p(!0),r(U,null,q(b(W),(t,c)=>(p(),r("option",{key:c,value:t.id},f(t==null?void 0:t.name),9,Me))),128))],512),[[A,_.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>h.value=t),class:"input-1"},s[11]||(s[11]=[le('<option value="all">All Category</option><option value="executive">Executive</option><option value="support_staff">Support Staff</option><option value="doctor">Doctor</option><option value="academy_body">Academy Body</option>',5)]),512),[[A,h.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>x.value=t),class:"input-1"},s[12]||(s[12]=[e("option",{value:"active"},"Active",-1),e("option",{value:"in_active"},"In Active",-1)]),512),[[A,x.value]])]),S(re,{modelValue:u.value,"onUpdate:modelValue":s[4]||(s[4]=t=>u.value=t),options:b(v).users,multiple:!1,label:"name","label-prefix":"employee_id",class:"w-1/3",placeholder:"Select user"},{option:C(({option:t})=>[S(pe,{user:t,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"])]),b(v).isLoading?(p(),r("div",De,[S(ie)])):(p(),r("div",Le,[(p(!0),r(U,null,q(X.value,(t,c)=>(p(),r("div",{key:c},[e("h2",$e,f(c)+" ("+f(t.length)+")",1),e("div",Ee,[e("table",je,[s[17]||(s[17]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(p(!0),r(U,null,q(t,(a,Z)=>{var O,Y;return p(),r("tr",{key:a.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",Ve,f(Z+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:N(a==null?void 0:a.name)},null,8,Te),e("td",{class:"border border-gray-300 px-2",innerHTML:N((O=a==null?void 0:a.designation)==null?void 0:O.title)},null,8,Ne),e("td",Oe,f(a.role),1),e("td",Ye,[e("div",Be,[e("div",Re,[(Y=a.current_shift)!=null&&Y.shift.name?(p(),r("span",Fe,f(a.current_shift.shift.name),1)):(p(),r("span",He,"Not Assigned"))]),e("button",{type:"button",onClick:tt=>G(a),class:ae(["px-3 py-1 rounded text-white text-xs transition-all duration-150",a!=null&&a.current_shift?"btn-1":"btn-2"])},[a!=null&&a.current_shift?(p(),r("span",ze,s[13]||(s[13]=[e("i",{class:"far fa-repeat-alt text-yellow-500 hover:text-yellow-600"},null,-1)]))):(p(),r("span",Pe,s[14]||(s[14]=[e("i",{class:"far fa-plus"},null,-1)])))],10,Ie)]),S(ne,{name:"fade"},{default:C(()=>[T.value===a.id&&d.value?(p(),r("div",We,[S(ke,{isOpen:d.value,shifts:b($),hasShift:a==null?void 0:a.current_shift,employee:{id:n.value.id,name:n.value.name},onClose:J},null,8,["isOpen","shifts","hasShift","employee"])])):H("",!0)]),_:2},1024)]),e("td",Ke,f(a.phone),1),e("td",Xe,f(a.email||"নেই"),1),e("td",Ge,[a.is_active?(p(),r("span",Je,"Active")):(p(),r("span",Qe,"Inactive"))]),e("td",Ze,[e("div",et,[S(g,{to:{name:"UserShow",params:{id:a.id},query:{company:b(l).query.company}},class:"btn-icon"},{default:C(()=>s[15]||(s[15]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[15]},1032,["to"]),S(g,{to:{name:"UserEdit",params:{id:a.id},query:{company:b(l).query.company}},class:"btn-icon"},{default:C(()=>s[16]||(s[16]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[16]},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{ut as default};
