import{s as j,r as _,G as q,q as U,A as k,c as i,g as L,o as c,a as e,t as p,w as B,h as x,C as N,F as E,x as V,k as A,p as g,v as M,m as T,e as O}from"./index-CwHJBxMl.js";import{_ as G}from"./MultiselectDropdown-DzQlwBuS.js";import{u as R}from"./company-BMq7ZAHX.js";import{_ as z,a as H}from"./HeaderWithButtons-oKedXc1l.js";import{L as J}from"./LoaderView-Cqw8cbFW.js";import{u as K}from"./department-DiPxM4TR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const P={key:0,class:"modal-bg"},Q={class:"modal-card"},W={class:"text-lg font-semibold mb-4"},X={class:"mb-4"},Y=["value"],Z={class:"mb-4"},ee={class:"mb-4"},te={class:"mb-4"},se={class:"mb-4"},oe={class:"mb-4"},ae={class:"flex justify-end"},le={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},ne={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup(C,{emit:u}){const r=C,v=u,f=R(),{companies:m,employees:$}=j(f),y=_(""),h=_(!1),w=_(!1),s=q({id:null,company_id:"",incharge_id:"",name:"",short_name:"",description:"",status:"Active"}),D=U(()=>y.value?y.value.id:null);k(D,o=>{s.incharge_id=o});const b=()=>{h.value=!1,s.id=null,s.company_id="",s.incharge_id="",s.name="",s.short_name="",s.description="",s.status="Active"};k(()=>r.department,o=>{var t;o&&typeof o=="object"&&Object.keys(o).length>0?(h.value=!0,s.id=o.id||null,s.company_id=o.company_id||"",s.incharge_id=((t=o.in_charge)==null?void 0:t.id)||"",s.name=o.name||"",s.short_name=o.short_name||"",s.description=o.description||"",s.status=o.status||"Active"):b()},{immediate:!0,deep:!0}),k(()=>r.show,async o=>{o&&!w.value&&await n()}),k(()=>s.company_id,async o=>{o&&(await f.fetchEmployee(o),y.value=f.employees.find(t=>{var l,d;return t.id===((d=(l=r.department)==null?void 0:l.in_charge)==null?void 0:d.id)}))});const S=()=>{v("save",{...s}),b(),a()},a=()=>{b(),v("close")},n=async()=>{try{await f.fetchCompanies(),w.value=!0}catch(o){console.error("Failed to fetch companies:",o)}};return(o,t)=>C.show?(c(),i("div",P,[e("div",Q,[e("h2",W,p(h.value?"Edit Department":"Add Department"),1),e("form",{onSubmit:B(S,["prevent"])},[e("div",X,[t[7]||(t[7]=e("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),x(e("select",{id:"company_id","onUpdate:modelValue":t[0]||(t[0]=l=>s.company_id=l),class:"w-full border rounded px-3 py-2",required:""},[t[6]||(t[6]=e("option",{value:"",disabled:""},"Select a company",-1)),(c(!0),i(E,null,V(A(m),l=>(c(),i("option",{key:l.id,value:l.id},p(l.name),9,Y))),128))],512),[[N,s.company_id]])]),e("div",Z,[t[8]||(t[8]=e("label",{for:"incharge_id",class:"block text-sm font-medium mb-2"},"In Chare",-1)),g(G,{options:A($),modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=l=>y.value=l),label:"label",multiple:!1},null,8,["options","modelValue"])]),e("div",ee,[t[9]||(t[9]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),x(e("input",{id:"name","onUpdate:modelValue":t[2]||(t[2]=l=>s.name=l),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[M,s.name]])]),e("div",te,[t[10]||(t[10]=e("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),x(e("input",{id:"short_name","onUpdate:modelValue":t[3]||(t[3]=l=>s.short_name=l),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[M,s.short_name]])]),e("div",se,[t[11]||(t[11]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),x(e("textarea",{id:"description","onUpdate:modelValue":t[4]||(t[4]=l=>s.description=l),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[M,s.description]])]),e("div",oe,[t[13]||(t[13]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),x(e("select",{id:"status","onUpdate:modelValue":t[5]||(t[5]=l=>s.status=l),class:"w-full border rounded px-3 py-2",required:""},t[12]||(t[12]=[e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)]),512),[[N,s.status]])]),e("div",ae,[e("button",{type:"button",onClick:a,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",le,p(h.value?"Update":"Create"),1)])],32)])])):L("",!0)}},re={class:"my-container space-y-4"},de={key:0,class:"text-center py-4"},ie={key:1,class:"space-y-4"},ce={class:"title-md"},ue={class:"overflow-x-auto"},me={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},pe={class:"text-gray-600 text-sm"},fe={class:"py-3 px-2 text-left"},ye={class:"py-3 px-2 text-left"},ve={class:"py-3 px-2 text-left whitespace-nowrap"},he={class:"py-3 px-2 text-center"},_e={class:"py-3 px-2 text-center"},be={class:"py-3 px-2 text-center"},xe={class:"flex item-center justify-center gap-4"},ge=["onClick"],we=["onClick"],Ve={__name:"DepartmentList",setup(C){const u=K(),r=T(),v=_(!1),f=_(!1),m=_(null),$=()=>{m.value=null,v.value=!0},y=()=>{v.value=!1},h=a=>{m.value=a,v.value=!0},w=a=>{m.value=a,f.value=!0},s=()=>{f.value=!1},D=async a=>{try{a.id?(await u.updateDepartment(a.id,a),r.success("Department updated successfully!"),await u.fetchDepartments()):(await u.createDepartment(a),r.success("Department added successfully!"))}catch(n){r.error("Failed to save department!"),console.error("Error handling save:",n)}finally{y()}},b=async()=>{var a;if(!((a=m.value)!=null&&a.id)){r.error("Invalid department selected for deletion!");return}try{await u.deleteDepartment(m.value.id),r.success("Department deleted successfully!")}catch(n){r.error("Failed to delete department!"),console.error("Error deleting department:",n)}finally{s()}},S=U(()=>{const a={};return u.departments.forEach(n=>{var t;const o=((t=n.company)==null?void 0:t.name)||"Unknown Company";a[o]||(a[o]=[]),a[o].push(n)}),a});return O(async()=>{try{await u.fetchDepartments()}catch(a){r.error("Failed to fetch departments!"),console.error("Error fetching departments:",a)}}),(a,n)=>{var o;return c(),i("div",re,[g(z,{title:"Department List",onAdd:$}),A(u).loading?(c(),i("div",de,[g(J)])):(c(),i("div",ie,[(c(!0),i(E,null,V(S.value,(t,l)=>(c(),i("div",{key:l},[e("h2",ce,p(l),1),e("div",ue,[e("table",me,[n[2]||(n[2]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-left"},"#"),e("th",{class:"py-3 px-2 text-left"},"Name"),e("th",{class:"py-3 px-2 text-left"},"Short Name"),e("th",{class:"py-3 px-2 text-center"},"Employee Number"),e("th",{class:"py-3 px-2 text-center"},"Status"),e("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),e("tbody",pe,[(c(!0),i(E,null,V(t,(d,F)=>(c(),i("tr",{key:F,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",fe,p(F+=1),1),e("td",ye,p(d.name),1),e("td",ve,p(d.short_name),1),e("td",he,p(d==null?void 0:d.users_count),1),e("td",_e,p(d.status),1),e("td",be,[e("div",xe,[e("button",{onClick:I=>h(d),class:"text-blue-600 hover:text-blue-800"},n[0]||(n[0]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ge),e("button",{onClick:I=>w(d),class:"text-red-600 hover:text-red-800"},n[1]||(n[1]=[e("i",{class:"fas fa-trash"},null,-1)]),8,we)])])]))),128))])])])]))),128))])),g(ne,{show:v.value,department:m.value,onClose:y,onSave:D},null,8,["show","department"]),g(H,{show:f.value,title:"Delete Department",message:`Are you sure you want to delete ${(o=m.value)==null?void 0:o.name}?`,onClose:s,onConfirm:b},null,8,["show","message"])])}}};export{Ve as default};
