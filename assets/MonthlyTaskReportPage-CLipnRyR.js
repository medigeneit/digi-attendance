import{C as q,r as y,h as E,q as U,c as r,o,a as e,j as v,i as G,b as _,t as h,F as k,e as z,s as A,m as w,G as H,w as b,k as I,v as J,d as K}from"./index-BkGzuPlq.js";import{e as Q,g as D}from"./datetime-BEfC2TVK.js";import{L as W}from"./LoaderView-C3NdoaC7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";async function X(p){return q.get("/my-monthly-task-reports",{params:p})}const Z={class:"relative"},tt={class:"mb-2 text-center text-sm"},et={class:"text-blue-500"},at={class:"text-blue-500"},st={key:0,class:"text-center py-4 text-red-500"},nt={class:"overflow-x-auto w-full"},lt={class:"min-w-full bg-white border overflow-hidden table table-fixed"},ot=["rowspan"],it={class:"text-gray-800 text-sm"},rt={key:0,colspan:"20",class:"border text-center text-gray-300 text-sm"},ct={class:"px-4 py-2 border-r"},dt={key:0,style:{"font-family":"monospace"}},ut={key:0,style:{"font-family":"monospace"}},ht={class:"px-4 py-2"},yt={__name:"MonthlyTaskReport",props:{startDate:{type:String,default:null},endDate:{type:String,default:null}},setup(p){const c=p,l=y([]),d=y(""),u=y(""),m=y(""),x=y("");async function g(){var n,s,i;if(c.startDate||c.endDate)try{d.value="loading";const t=((n=await X({start_date:c.startDate,end_date:c.endDate}))==null?void 0:n.data)||{};m.value=t.start,x.value=t.end,l.value=t.reports||[]}catch(t){u.value=((i=(s=t.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed load task report"}finally{d.value=""}}E(()=>{g()}),U(()=>[c.startDate,c.endDate],()=>{g()});function a(n){return l.value.filter(s=>D(n)==s.report_date)}return(n,s)=>(o(),r("div",Z,[e("div",tt,[s[0]||(s[0]=_(" Task Report from ")),e("span",et,h(m.value),1),s[1]||(s[1]=_(" to ")),e("span",at,h(x.value),1)]),u.value?(o(),r("div",st,h(u.value),1)):v("",!0),e("div",nt,[e("table",lt,[s[3]||(s[3]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"px-4 py-2 text-center whitespace-nowrap w-32"},"Report Date"),e("th",{class:"px-4 py-2 text-left whitespace-nowrap"},"Task"),e("th",{class:"px-4 py-2 text-left whitespace-nowrap"},"Report"),e("th",{class:"px-4 py-2 text-center whitespace-nowrap"},"Actions")])],-1)),e("tbody",null,[(o(!0),r(k,null,z(w(Q)(p.startDate,p.endDate),i=>(o(),r(k,{key:i},[e("tr",null,[e("td",{class:"px-4 py-2 text-center whitespace-nowrap border",rowspan:a(i).length+1},[e("div",it,h(new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)],8,ot),a(i).length===0?(o(),r("td",rt," No Report Provided ")):v("",!0)]),a(i).length?(o(!0),r(k,{key:0},z(a(i),t=>{var f,M,C,R,T,N,S,$,V,F,B,L,O,P,j,Y;return o(),r("tr",{key:t.id,class:"border-t"},[e("td",ct,[e("div",{class:A({"text-gray-500 text-xs":(C=(M=(f=t==null?void 0:t.task)==null?void 0:f.parent)==null?void 0:M.parent)==null?void 0:C.title})},h((N=(T=(R=t==null?void 0:t.task)==null?void 0:R.parent)==null?void 0:T.parent)==null?void 0:N.title),3),e("div",{class:A({"text-gray-500 text-xs":($=(S=t==null?void 0:t.task)==null?void 0:S.parent)==null?void 0:$.title})},[(B=(F=(V=t==null?void 0:t.task)==null?void 0:V.parent)==null?void 0:F.parent)!=null&&B.title?(o(),r("span",dt,"-")):v("",!0),_(" "+h((O=(L=t==null?void 0:t.task)==null?void 0:L.parent)==null?void 0:O.title),1)],2),e("div",null,[(j=(P=t==null?void 0:t.task)==null?void 0:P.parent)!=null&&j.title?(o(),r("span",ut,"--")):v("",!0),_(" "+h((Y=t==null?void 0:t.task)==null?void 0:Y.title),1)])]),e("td",ht,h(t.title),1),s[2]||(s[2]=e("td",{class:"px-4 py-2 text-center"},[e("div",{class:"flex gap-4 items-center justify-center"})],-1))])}),128)):v("",!0)],64))),128))])])]),d.value==="loading"?(o(),G(W,{key:1,class:"absolute inset-0 flex items-center justify-center z-20 bg-opacity-70"})):v("",!0)]))}},pt={class:"border container mx-auto"},vt={class:"px-4 py-2 flex items-center bg-gray-50 group"},mt={class:"ml-4 md:ml-auto flex items-center gap-2"},xt={class:"bg-gray-300 bg-opacity-90 relative"},gt={class:"bg-white p-4 border-t"},wt={__name:"MonthlyTaskReportPage",setup(p){const c=H({month:null,year:null}),l=y();y("loading");const d=y([]);function u(a){return!a instanceof Date?"":`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`}E(()=>{const a=new Date;l.value=u(a)}),U(l,a=>{const[n,s,i]=a.split("-").map(Number),t=new Date(n,s-1,1),f=new Date(n,s,0);d.value=[t,f],c.month=s,c.year=n});function m(){const a=new Date;l.value=u(a)}function x(){const a=new Date(l.value);a.setMonth(a.getMonth()+1),l.value=u(a)}function g(){const a=new Date(l.value);a.setMonth(a.getMonth()-1),l.value=u(a)}return(a,n)=>(o(),r("div",pt,[e("div",vt,[n[1]||(n[1]=e("h2",{class:"leading-none font-semibold text-lg"},"Monthly Task Report",-1)),e("button",{class:"btn-3 mx-4 h-7",onClick:b(m,["prevent"])}," Current Month "),e("div",mt,[e("button",{class:"btn-2 h-7",onClick:b(g,["prevent"])}," Previous Month "),e("button",{class:"btn-2 h-7",onClick:b(x,["prevent"])},"Next Month"),I(e("input",{type:"month","onUpdate:modelValue":n[0]||(n[0]=s=>l.value=s),class:"border px-2 rounded"},null,512),[[J,l.value]])])]),e("div",xt,[e("div",gt,[K(yt,{"start-date":d.value.length>=1?w(D)(d.value[0]):null,"end-date":d.value.length==2?w(D)(d.value[1]):null},null,8,["start-date","end-date"])])])]))}};export{wt as default};
