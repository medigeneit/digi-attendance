import{M as Se,r as x,e as te,c as l,o as a,a as e,f as D,g as m,F as V,t as g,w as j,d as Re,m as H,n as De,y as X,p as w,i as C,j as E,x as U,k as J,N as je,J as Ne,h as Le,v as Be,I as Ae,b as Ee,u as Oe,z as Z}from"./index-Bs3LfB-o.js";import{L as ie}from"./LoaderView-DWI7rqNX.js";import{O as Y}from"./OverlyModal-BG5PdbLh.js";import{_ as Me}from"./ShareComponent-BArTUul0.js";import{_ as Te}from"./DepartmentChip-wQJ-OSGK.js";import{_ as ee}from"./DescriptionView-BxHKmz5J.js";import{o as Ue}from"./url-CePbr-gY.js";import{u as Ve}from"./user-ChxuDTqQ.js";import{_ as Es,a as Pe}from"./TaskUserAssignForm-SopFCRu9.js";import{f as ne,b as Fe,s as ze}from"./requirement-B4amnKkz.js";import{_ as He}from"./TextEditor-CC4hkNBi.js";import{u as Ge}from"./useTaskStore-BVOsGH1b.js";import{_ as Ke}from"./TaskSelectionInput-D8VDOkUA.js";import{_ as Qe}from"./TaskAddForm-DnCTYVqb.js";import{_ as We}from"./TaskEditForm-BjymR7cL.js";import{_ as Ye}from"./TaskTableRow-DmWrS5fZ.js";import{T as se}from"./TextWithHr-Cs09x042.js";import{_ as ae}from"./UserChip-SuhlBVHY.js";import{d as re}from"./datetime-BEfC2TVK.js";import{_ as Je}from"./ApproveAndReject-oA6DFQnt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-W0-bxCJM.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-Cq099FBv.js";import"./SelectDropdown-DWEV84tD.js";import"./TaskTitle-BJcraNUm.js";import"./RequiredIcon-C7-G256j.js";import"./company-B2VMbbgk.js";import"./CompanyDepartmentSelectInput-CD0CfFqB.js";import"./SectionLoading-PtIAQhSH.js";import"./tags-ftH7E69u.js";import"./MultiselectDropdown-BaI5xW0C.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-CyM5GnNB.js";import"./TaskUrgentBadge-CGQ8puWb.js";import"./TaskAssignedUsers-DpbSRP2e.js";import"./TaskIsClosedBadge-n54IA9Sn.js";async function Xe(S,R,{params:i={}}={}){return Se.get(`/requirements/${S}/details/${R}`,{params:i})}async function Ze(S,R,{params:i={}}={}){const p=Ue(i);return Se.delete(`/requirements/${S}/details/${R}${p?"?"+p:""}`)}const et={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},tt={class:"mb-4"},st={class:"font-semibold"},rt={class:"mb-4"},nt={class:"line-clamp-2"},at={key:1,class:"min-h-40"},it={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ot={key:0,class:"mb-4 text-red-500 font-medium"},lt={key:1,class:"mb-4"},dt={class:"flex items-center justify-between gap-4"},ut=["disabled"],mt={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(S,{emit:R}){const i=S,p=R,T=Ve(),y=x(null),u=x(""),s=x(),b=x([]);async function _(){var o,r;u.value="submitting";try{const n=await Ze(i.requirementId,i.detailId);p("delete",n),u.value="create"}catch(n){u.value="error",s.value=((r=(o=n.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to update requirement detail: "+n,p("error",s.value)}}return te(async()=>{var o,r,n;u.value="loading";try{b.value=await T.fetchDepartmentWiseEmployees(),y.value=(o=(await Xe(i.requirementId,i.detailId)).data)==null?void 0:o.detail}catch(d){s.value=((n=(r=d.response)==null?void 0:r.data)==null?void 0:n.message)||"Failed to fetch requirement detail"}finally{u.value=""}}),(o,r)=>{var n,d;return a(),l("div",et,[r[4]||(r[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:j(_,["prevent"]),class:"z-0"},[u.value!=="loading"?(a(),l(V,{key:0},[e("div",tt,[r[1]||(r[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",st,g((n=y.value)==null?void 0:n.title),1)]),e("div",rt,[r[2]||(r[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",nt,g((d=y.value)==null?void 0:d.description),1)]),r[3]||(r[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(a(),l("div",at)),e("div",it,[s.value?(a(),l("div",ot,g(s.value),1)):m("",!0),s.value?(a(),l("hr",lt)):m("",!0),e("div",dt,[e("button",{type:"button",onClick:r[0]||(r[0]=j(v=>p("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:u.value=="loading"||u.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},g(u.value=="submitting"?"Deleting...":"Delete"),9,ut)])])],32),u.value==="loading"||u.value==="submitting"?(a(),D(ie,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):m("",!0)])}}};const pt={class:"sticky top-0 pt-4 bg-white z-10"},ct={class:"mb-4"},vt={class:"mb-4"},ft={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},bt={key:0,class:"mb-4 text-red-500 font-medium"},xt={key:1,class:"mb-4"},yt={class:"flex items-center justify-between gap-4"},gt=["disabled"],_t={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(S,{emit:R}){const i=S,p=R,T=x(),y=x(null),u=x(""),s=x(),b=x({feedback:""});async function _(){var o,r;u.value="submitting";try{const n=await Fe(i.requirementId,b.value.feedback);p("update",n),u.value="create"}catch(n){u.value="error",s.value=((r=(o=n.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to update requirement requirement",p("error",s.value)}}return te(async()=>{var o,r,n,d;u.value="loading";try{await ne(i.requirementId),y.value=(o=(await ne(i.requirementId)).data)==null?void 0:o.requirement,b.value={feedback:(r=y.value)==null?void 0:r.feedback}}catch(v){s.value=((d=(n=v.response)==null?void 0:n.data)==null?void 0:d.message)||"Failed to fetch requirement requirement"}finally{u.value=""}}),(o,r)=>{var n;return a(),l("div",{ref_key:"formContainerRef",ref:T,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",pt,[r[3]||(r[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),r[4]||(r[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=j(d=>p("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:j(_,["prevent"]),class:"z-0"},[u.value!=="loading"?(a(),l(V,{key:0},[e("div",ct,[r[5]||(r[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),w(ee,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:C(()=>{var d;return[E(g((d=y.value)==null?void 0:d.title),1)]}),_:1})]),e("div",vt,[r[6]||(r[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),w(He,{modelValue:b.value.feedback,"onUpdate:modelValue":r[1]||(r[1]=d=>b.value.feedback=d)},null,8,["modelValue"])])],64)):m("",!0),e("div",ft,[s.value?(a(),l("div",bt,g(s.value),1)):m("",!0),s.value?(a(),l("hr",xt)):m("",!0),e("div",yt,[e("button",{type:"button",onClick:r[2]||(r[2]=j(d=>p("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:u.value=="loading"||u.value=="submitting",type:"submit",class:"btn-2"},g(u.value=="submitting"?"Saving...":(n=y.value)!=null&&n.feedback?"Update Feedback":"Add Feedback"),9,gt)])])],32),u.value==="loading"||u.value==="submitting"?(a(),D(ie,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):m("",!0)],512)}}},kt={class:"flex justify-center items-center"},ht={class:"modal-card"},wt=["required"],qt={class:"flex"},$t={class:"flex justify-between gap-2 mt-4"},Ct=["disabled"],Tt=["disabled"],It={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(S,{emit:R}){const i=S,p=R,T=x(255),y=H(()=>T.value-o.value.length),u=je(),s=x(null),b=x(null),_=x(null),o=x(""),r=x(!1),n=H(()=>_.value!==null);function d(I){_.value=I,o.value="",$()}function v(){_.value=null,o.value=""}async function k(){var I,q;if(_.value==="reject"&&!o.value)return u.error("Rejection Reason is required!");if(typeof i.onSubmit=="function")return i.onSubmit({note:o.value,action:_.value});p("loading",!0),r.value=!0;try{await ze(i.requirementId,{note:o.value}),p("success"),v()}catch(A){return p("error",A),u.error(((q=(I=A==null?void 0:A.response)==null?void 0:I.data)==null?void 0:q.message)||"Submission failed!")}finally{p("loading",!1),r.value=!1}}function N(I){var q,A;n.value&&(I.key==="ArrowLeft"?(q=b.value)==null||q.focus():I.key==="ArrowRight"&&((A=s.value)==null||A.focus()))}function $(){Ae(()=>{var I;(I=s.value)==null||I.focus()})}return te(()=>{window.addEventListener("keydown",N)}),Ne(()=>{window.removeEventListener("keydown",N)}),(I,q)=>(a(),l("div",null,[e("div",kt,[e("button",{onClick:q[0]||(q[0]=A=>d("accept"))},q[3]||(q[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),n.value?(a(),l("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:j(v,["self"])},[e("div",ht,[q[4]||(q[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Le(e("textarea",{"onUpdate:modelValue":q[1]||(q[1]=A=>o.value=A),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:_.value==="reject",onInput:q[2]||(q[2]=A=>o.value.length>T.value?o.value=o.value.slice(0,T.value):null)},null,40,wt),[[Be,o.value]]),e("div",qt,[e("div",{class:U(["ml-auto inline-block text-sm text-gray-500",o.value.length>=T.value?"text-red-500":""])}," left "+g(y.value)+"/"+g(T.value)+" words ",3)])]),e("div",$t,[e("button",{ref_key:"cancelBtnRef",ref:b,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:v,disabled:r.value}," Cancel ",8,Ct),e("button",{ref_key:"confirmBtnRef",ref:s,class:U(["focus:ring-2 ring-offset-2 disabled:opacity-30",_.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:k,disabled:r.value}," Confirm Submission ",10,Tt)])])])):m("",!0)]))}},St={class:"flex items-center gap-6 justify-center my-16"},Rt={key:0,class:"border rounded-md"},Nt={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(S,{emit:R}){const i=S,p=R,T=Ge(),y=x(""),u=x(null),s=x(""),b=x(!1);async function _(){await T.setTaskRequirement(s.value,i.requirement.id),p("assignTask")}return(o,r)=>(a(),l("div",{class:U(["text-left p-4",[y.value&&!u.value?"min-h-[400px]":""]])},[e("div",St,[e("button",{onClick:r[0]||(r[0]=j(n=>p("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),r[5]||(r[5]=e("span",null,"or",-1)),e("button",{class:U({"btn-3":y.value!=="direct-assign","btn-2":y.value=="direct-assign"}),onClick:r[1]||(r[1]=j(()=>y.value="direct-assign",["prevent"]))}," Assign Task ",2)]),y.value&&!u.value?(a(),l("div",Rt,[e("form",{onSubmit:j(_,["prevent"]),class:"p-4 flex items-end"},[w(Ke,{class:"flex-grow mr-4 h-12",taskId:s.value,"onUpdate:taskId":r[2]||(r[2]=n=>s.value=n),show:b.value,"onUpdate:show":r[3]||(r[3]=n=>b.value=n),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":S.fromDepartmentId},filterTasks:n=>!n.requirement_id,onAddNewTaskClick:r[4]||(r[4]=n=>p("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),r[6]||(r[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):m("",!0)],2))}},At={class:"flex flex-col items-center gax-x-1 justify-end"},Dt={key:0},jt={key:1},Lt={class:"text-sm text-gray-600"},Bt={class:"text-base text-gray-900 font-semibold"},Et={class:"ml-2"},Ot={key:0,class:"text-green-600 ml-2"},Mt={key:1,class:"ml-2 text-yellow-700"},Ie={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(S,{emit:R}){const i=S,p=R,T=Re(),y=H(()=>{var o,r,n,d,v;return{from_in_charge:!!((o=i.requirement)!=null&&o.status&&((r=i.requirement)!=null&&r.submission_date)),from_coordinator:!!((n=i.requirement)!=null&&n.from_coordinator),to_in_charge:!!((d=i.requirement)!=null&&d.to_incharge),to_coordinator:!!((v=i.requirement)!=null&&v.to_coordinator)}}),u=H(()=>{var o,r,n,d,v,k,N,$;return{from_in_charge:(r=(o=i.requirement)==null?void 0:o.from_department)==null?void 0:r.in_charge,from_coordinator:(d=(n=i.requirement)==null?void 0:n.from_department)==null?void 0:d.coordinator,to_in_charge:(k=(v=i.requirement)==null?void 0:v.to_department)==null?void 0:k.in_charge,to_coordinator:($=(N=i.requirement)==null?void 0:N.to_department)==null?void 0:$.coordinator}}),s=H(()=>{var d;const o=Object.keys(y.value),r=o.indexOf(i.approvalType);let n=!0;for(let v=r-1;v>=0;v--){const k=o[v];n=n&&(u.value[k]?(d=y.value)==null?void 0:d[k]:!0)}return n}),b=H(()=>{var v,k,N,$,I,q,A,f,P,F,h,t,L,O,M;let o=null,r=null,n="",d="";return i.approvalType==="from_in_charge"&&(o=(v=i.requirement)==null?void 0:v.from_department,r=(N=(k=i.requirement)==null?void 0:k.from_department)==null?void 0:N.in_charge,n="In Charge",d=($=i.requirement)==null?void 0:$.from_incharge_note),i.approvalType==="from_coordinator"&&(o=(I=i.requirement)==null?void 0:I.from_department,r=(q=i.requirement)==null?void 0:q.from_coordinator,n="Coordinator",d=(A=i.requirement)==null?void 0:A.from_coordinator_note),i.approvalType==="to_in_charge"&&(o=(f=i.requirement)==null?void 0:f.to_department,r=(P=i.requirement)==null?void 0:P.to_in_charge,n="In Charge",d=(F=i.requirement)==null?void 0:F.to_incharge_note),i.approvalType==="to_coordinator"&&(o=(h=i.requirement)==null?void 0:h.to_department,r=(t=i.requirement)==null?void 0:t.to_coordinator,n="Coordinator",d=(L=i.requirement)==null?void 0:L.to_coordinator_note),{department:o,department_user:(O=u.value)==null?void 0:O[i.approvalType],approved:(M=y.value)==null?void 0:M[i.approvalType],approval_user:r,userType:n,approval_note:d}});function _(){p("updateApproval")}return(o,r)=>{var n,d,v,k,N,$;return a(),l("div",At,[b.value.department_user?(a(),l("div",Dt,[w(ae,{user:b.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(a(),l("div",jt,r[0]||(r[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",Lt,g(b.value.approval_note),1),r[2]||(r[2]=e("hr",{class:"my-2 border-gray-600 w-64"},null,-1)),e("div",Bt,[e("span",null,g(((n=b.value.department)==null?void 0:n.short_name)||((d=b.value.department)==null?void 0:d.name)),1),e("span",Et,g(b.value.userType),1),b.value.department_user?(a(),l(V,{key:0},[b.value.approved?(a(),l("span",Ot,"(âœ”)")):(a(),l("span",Mt,r[1]||(r[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):m("",!0),!b.value.approved&&s.value&&((v=J(T).user)==null?void 0:v.id)==((N=(k=b.value)==null?void 0:k.department_user)==null?void 0:N.id)?(a(),D(Je,{key:1,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:($=i.requirement)==null?void 0:$.id,onSuccess:_,variant:1},null,8,["applicationId"])):m("",!0)])])}}},Ut={class:"container mx-auto print:p-0 w-full print:max-w-full"},Vt={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},Pt={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},Ft={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},zt={class:"text-center text-xl font-bold mb-2 flex items-center"},Ht={class:"mb-8"},Gt={class:"text-lg font-semibold mb-2"},Kt={class:"flex gap-4 items-center text-gray-500"},Qt={class:"text-sm"},Wt={key:0,class:"flex items-center gap-1"},Yt={key:0,class:"mb-5"},Jt=["innerHTML"],Xt={class:"mb-8"},Zt={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},es={class:"w-full border-collapse"},ts={key:0},ss={class:"mb-8"},rs={class:"font-semibold text-lg px-2"},ns={key:0},as=["innerHTML"];const is={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},os={class:"flex flex-col items-end"},ls={key:2,class:"mt-6 mb-8 break-before-avoid-page"},ds={class:"whitespace-nowrap border-gray-200 grid grid-cols-2 items-stretch"},us={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-2 gap-2 items-stretch"},ms={class:"border col-span-3 p-3 rounded-md"},ps={class:"flex items-center gap-2 mb-4"},cs={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},vs={class:"flex items-center gap-2 mb-4"},fs={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},bs={class:"font-bold print:text-gray-900"},xs={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},ys={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},gs={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},_s={class:"print:text-gray-900"},ks={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},hs={class:"print:text-gray-900"},ws={class:"flex justify-between items-center mb-4"},qs={class:"mb-6"},$s={class:"flex justify-between items-center"},Cs={key:1,class:"text-red-600"},Ts={class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},ur={__name:"RequirementShow",setup(S){const R=Ee(),i=Oe(),p=x(""),T=Re(),y=x(),u=x(),s=x(null),b=Z({detail:null,open:!1}),_=Z({detail:null,open:!1}),o=Z({detail:null,open:!1}),r=x(!1),n=()=>r.value=!0,d=()=>r.value=!1,v=x(),k=x({isOpen:!1,taskId:null});te(async()=>{await $(),window.addEventListener("beforeprint",n),window.addEventListener("afterprint",d),window.addEventListener("resize",N),await Ae(),N()});function N(){var L;const h=y.value,t=(L=u.value)==null?void 0:L.$el;h&&t&&(h!=null&&h.offsetHeight)&&(t.style.top=`${(h==null?void 0:h.offsetHeight)+90}px`)}Ne(()=>{window.removeEventListener("beforeprint",n),window.removeEventListener("afterprint",d),window.removeEventListener("resize",N)});async function $(){var h;p.value="loading",s.value=(h=(await ne(R.params.id)).data)==null?void 0:h.requirement,p.value=""}function I(){var h,t,L,O,M,G,K,Q,W;if(T.user.role!=="super_admin"&&((h=T.user)==null?void 0:h.id)!==((L=(t=s.value)==null?void 0:t.to_department)==null?void 0:L.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(M=(O=s.value)==null?void 0:O.to_department)==null?void 0:M.name}'s In charge can create or assign.`);console.log({requirement:s}),f.modalShown=!0,f.from_department_id=s.value.from_department_id,f.to_department_id=s.value.to_department_id,f.taskDefaultValues={title:"",description:"",from_department_id:s.value.from_department_id,to_department_id:s.value.to_department_id,is_important:((G=s.value)==null?void 0:G.priority)=="IMPORTANT",is_urgent:((K=s.value)==null?void 0:K.priority)=="URGENT",supervisor_ids:(Q=s.value)!=null&&Q.supervisor_id?[(W=s.value)==null?void 0:W.supervisor_id]:[]},f.requirement=s.value}function q(h){b.open=!0,b.detail=h}function A(h){o.open=!0,o.detail=h}const f=Z({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function P(){v.value=null,await $()}async function F(){f.modalShown=!1,f.requirement=null,f.creating=!1}return(h,t)=>{var O,M,G,K,Q,W,oe,le,de,ue,me,pe,ce,ve,fe,be,xe,ye,ge,_e,ke,he,we,qe,$e;const L=De("RouterLink");return a(),l("div",Ut,[_.open?(a(),D(Y,{key:0},{default:C(()=>{var c;return[w(_t,{requirementId:s.value.id,detailId:(c=_.requirement.value)==null?void 0:c.id,onCloseClick:t[0]||(t[0]=B=>_.open=!1),onUpdate:t[1]||(t[1]=async()=>{_.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):m("",!0),o.open?(a(),D(Y,{key:1},{default:C(()=>{var c;return[w(mt,{requirementId:s.value.id,detailId:(c=o.requirement.value)==null?void 0:c.id,onCloseClick:t[2]||(t[2]=B=>o.open=!1),onDelete:t[3]||(t[3]=async()=>{o.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):m("",!0),f.modalShown?(a(),D(Y,{key:2,class:"*:relative"},{default:C(()=>{var c,B;return[e("button",{onClick:j(F,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},t[14]||(t[14]=[e("i",{class:"fas fa-times-circle"},null,-1)])),f!=null&&f.creating?m("",!0):(a(),D(Nt,{key:0,"from-department-id":(c=s.value)==null?void 0:c.from_department_id,requirement:f==null?void 0:f.requirement,onCancelClick:F,onAddNewTaskClick:t[4]||(t[4]=()=>{f.modalShown=!0,f.creating=!0}),onAssignTask:P},null,8,["from-department-id","requirement"])),f!=null&&f.creating?(a(),D(Qe,{key:1,requirementDetailId:(B=f==null?void 0:f.requirement.value)==null?void 0:B.id,requirementId:s.value.id,onClose:F,onTaskCreated:P,defaultValues:f.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):m("",!0)]}),_:1})):m("",!0),v.value?(a(),D(Y,{key:3},{default:C(()=>[w(We,{taskId:v.value,onClose:t[5]||(t[5]=c=>v.value=null),onUpdated:P},null,8,["taskId"])]),_:1})):m("",!0),k.value.isOpen?(a(),D(Y,{key:4,class:"*:max-w-4xl"},{default:C(()=>[w(Pe,{taskId:k.value.taskId,onCancelClick:t[6]||(t[6]=()=>{k.value.isOpen=!1,k.value.taskId=0}),onSuccess:t[7]||(t[7]=()=>{k.value.isOpen=!1,k.value.taskId=0,p.value="loading",$()})},null,8,["taskId"])]),_:1})):m("",!0),e("div",Vt,[s.value?(a(),l("div",Pt,[e("div",Ft,[e("div",zt,[e("button",{class:"btn-3 h-8 px-4",onClick:t[8]||(t[8]=j(()=>J(i).back(),["prevent"]))},"Back"),t[15]||(t[15]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),t[29]||(t[29]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",Ht,[e("div",null,[e("div",Gt,[w(ee,{"line-clamp":"3",class:"mb-2"},{default:C(()=>[E(g(s.value.title),1)]),btnText:C(({lineClampClass:c})=>[E(g(c?"More":"Less"),1)]),_:1}),e("div",Kt,[e("div",Qt,[t[16]||(t[16]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),E(" "+g(J(re)(s.value.created_at)),1)]),s.value.created_by?(a(),l("div",Wt,[t[17]||(t[17]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),w(ae,{"avatar-size":"xsmall",user:s.value.created_by,class:"border-sky-300"},null,8,["user"])])):m("",!0)])]),s.value.description?(a(),l("div",Yt,[t[18]||(t[18]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),w(ee,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:C(()=>[e("p",{innerHTML:s.value.description,class:"text-justify"},null,8,Jt)]),_:1})])):m("",!0)])]),e("div",Xt,[w(se,{class:"mb-4"},{default:C(()=>t[19]||(t[19]=[e("h2",{class:"font-semibold text-lg px-2"},"Task List",-1)])),_:1,__:[19]}),e("div",Zt,[e("table",es,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[p.value!="loading"&&((M=(O=s.value)==null?void 0:O.tasks)==null?void 0:M.length)===0?(a(),l("tr",ts,t[20]||(t[20]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(a(!0),l(V,{key:1},X(((G=s.value)==null?void 0:G.tasks)||[],(c,B)=>(a(),D(Ye,{key:c.id,task:c,indexing:B+1,class:"*:py-3 *:border-b-0",onEditClick:t[9]||(t[9]=z=>v.value=z),onEmployeeAssignClick:t[10]||(t[10]=z=>{k.value.isOpen=!0,k.value.taskId=z})},null,8,["task","indexing"]))),128))])])])]),e("div",ss,[w(se,{class:"mb-4"},{default:C(()=>{var c,B,z,Ce;return[e("h2",rs," '"+g(((B=(c=s.value)==null?void 0:c.to_department)==null?void 0:B.short_name)||((Ce=(z=s.value)==null?void 0:z.to_department)==null?void 0:Ce.name))+"' Feedback ",1)]}),_:1}),e("div",{class:U(["px-3 border border-dashed rounded-lg border-sky-600",[(K=s.value)!=null&&K.feedback?"py-3":"py-8"]]),colspan:"5"},[p.value!="loading"&&((Q=s.value)!=null&&Q.status)?(a(),l("div",ns,[String((W=s.value)==null?void 0:W.feedback).trim().length>0?(a(),D(ee,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:C(()=>{var c;return[e("p",{class:"text-sm text-justify",innerHTML:(c=s.value)==null?void 0:c.feedback},null,8,as)]}),_:1})):m("",!0),e("div",{class:U([((oe=s.value)!=null&&oe.feedback,"w-full flex justify-center")])},[e("button",{class:"btn-3 print:hidden",onClick:t[11]||(t[11]=j(()=>{_.open=!0,_.requirement=s.value},["prevent"]))},g(s.value.feedback?"Update Feedback":"Add feedback"),1)],2)])):m("",!0)],2)]),(s.value,m("",!0)),p.value!="loading"&&!((le=s.value)!=null&&le.status)?(a(),l("div",is,[e("div",os,[w(It,{"requirement-id":(de=s.value)==null?void 0:de.id,onSuccess:$},{heading:C(()=>t[25]||(t[25]=[E(" Requirement Submission ")])),acceptButtonLabel:C(()=>t[26]||(t[26]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),E("Submit Requirement ")],-1)])),submitButtonLabel:C(()=>t[27]||(t[27]=[E(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):m("",!0),(ue=s.value)!=null&&ue.status?(a(),l("div",ls,[w(se,null,{default:C(()=>t[28]||(t[28]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[28]}),e("div",ds,[(a(),l(V,null,X(["from_in_charge","from_coordinator"],c=>w(Ie,{class:"pt-12",key:c,requirement:s.value,"approval-type":c,onUpdateApproval:t[12]||(t[12]=()=>$())},null,8,["requirement","approval-type"])),64))]),((me=s.value)==null?void 0:me.from_department_id)!==((pe=s.value)==null?void 0:pe.to_department_id)?(a(),l("div",us,[(a(),l(V,null,X(["to_in_charge","to_coordinator"],c=>w(Ie,{class:"pt-12",key:c,requirement:s.value,"approval-type":c,onUpdateApproval:t[13]||(t[13]=()=>$())},null,8,["requirement","approval-type"])),64))])):m("",!0)])):m("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 space-y-4 sticky top-[74px] bg-white shadow rounded-lg p-4 break-before-avoid-page",ref_key:"sidebarTop",ref:y},[e("div",ms,[e("div",null,[e("div",ps,[t[30]||(t[30]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),w(Te,{department:(ce=s.value)==null?void 0:ce.from_department,"short-name":!0},null,8,["department"])]),t[31]||(t[31]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",cs,[(ve=s.value)!=null&&ve.supervisor?(a(),D(ae,{key:0,user:(fe=s.value)==null?void 0:fe.supervisor},null,8,["user"])):m("",!0)])]),t[33]||(t[33]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",vs,[t[32]||(t[32]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),w(Te,{department:(be=s.value)==null?void 0:be.to_department,"short-name":!0},null,8,["department"])])])]),e("div",fs,[t[34]||(t[34]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",bs,g((xe=s.value)==null?void 0:xe.id),1)]),((ge=(ye=s.value)==null?void 0:ye.website_tags)==null?void 0:ge.length)>0?(a(),l("div",xs,[t[35]||(t[35]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",ys,[(a(!0),l(V,null,X(((_e=s.value)==null?void 0:_e.website_tags)||[],c=>(a(),l("div",{key:c.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},g(c.name),1))),128))])])):m("",!0),(ke=s.value)!=null&&ke.submission_date?(a(),l("div",gs,[t[36]||(t[36]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",_s,g(J(re)((he=s.value)==null?void 0:he.submission_date)),1)])):m("",!0),(we=s.value)!=null&&we.better_to_complete_on?(a(),l("div",ks,[t[37]||(t[37]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",hs,g(J(re)((qe=s.value)==null?void 0:qe.better_to_complete_on)),1)])):m("",!0),e("div",null,[e("div",ws,[t[38]||(t[38]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:U(["font-semibold text-sm",{"text-yellow-600 ":s.value.priority=="IMPORTANT","text-red-700 ":s.value.priority=="URGENT"}])},g(s.value.priority||"NORMAL"),3)])]),e("div",qs,[e("div",$s,[t[39]||(t[39]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),s.value.status?(a(),l("span",{key:0,class:U(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":s.value.status!="approved","bg-green-300 text-green-700 border-green-400":s.value.status=="approved"}])},g(String(s.value.status).toUpperCase()),3)):(a(),l("span",Cs,"..."))])]),t[42]||(t[42]=e("hr",{class:"mb-3"},null,-1)),e("div",Ts,[s.value.status=="approved"?(a(),l("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:j(I,["prevent"])},t[40]||(t[40]=[e("i",{class:"fas fa-plus text-sm"},null,-1),E(" Add/Assign Task ")]))):m("",!0),w(L,{class:"btn-2 h-8",to:`/requirements/edit/${($e=s.value)==null?void 0:$e.id}`},{default:C(()=>t[41]||(t[41]=[E(" Edit ")])),_:1,__:[41]},8,["to"])])])],512),w(Me,{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 md:sticky",ref_key:"shareComponent",ref:u},null,512)])):m("",!0),p.value==="loading"?(a(),D(ie,{key:1,class:"absolute inset-0 bg-opacity-90"})):m("",!0)])])}}};export{ur as default};
