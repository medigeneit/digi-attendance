import{f as O,r as $,h as j,x as z,p as U,c as l,o,a as e,t as c,j as h,k as d,n as a,m as g,b as x,F as M,e as E,w as G,s as F,d as H}from"./index-CwEtSTV9.js";import{_ as J}from"./UserChip-D2UpoEGM.js";import{b as K}from"./datetime-Du_mcDA9.js";import{s as Q}from"./dom-Bic1TNqD.js";import{u as W}from"./useTaskReportStore-DxHzuaUr.js";import{u as X}from"./useTaskStore-BdXw0j5R.js";import"./user-YnH05nQv.js";import"./requirement-peD_nbRi.js";const Y={class:"mt-4",id:"task-reports"},Z={class:"bg-white"},tt={class:"flex mb-2 items-end"},et={class:"overflow-auto w-full"},st={key:0,class:"min-w-full bg-white shadow rounded-lg overflow-hidden"},ot={class:"bg-gray-100"},rt={key:0,class:"px-4 py-2 text-left md:w-[100px] lg:w-[220px] xl:w-[320px] border"},at={key:0},nt={class:"px-4 py-4 font-medium text-gray-500 text-center border h-28",colspan:"10"},lt=["onClick"],it={class:"px-4 py-2 text-center border font-semibold text-gray-600"},dt={key:0,class:"px-4 py-2 font-medium border-r border-b"},ut={key:0,style:{"font-family":"monospace"}},ct={class:"ml-1"},mt={class:"font-medium py-2 px-4 border"},pt={class:"border rounded-md bg-gray-50"},kt={class:"text-sm flex items-center px-3 py-3"},_t={class:"text-gray-600 text-sm ml-auto whitespace-nowrap"},yt={key:1,class:"text-center border py-4 text-gray-500"},Ct={__name:"TaskReports",setup(ft){const b=W(),n=X(),p=O(),v=p.params.id,k=$();j(async()=>{k.value="loading",await n.fetchTask(v),await b.fetchTaskReports({task_id:v}),k.value="",setTimeout(()=>Q("#task-reports",66),0)});function w(u,t=[]){const i=[];for(const r of u){const _=[...t,r.title];r.children_tasks.length===0?i.push(...r.reports.map(m=>({...m,task_id:r.id,task_title:r.title,task_parents:t,user:r.users.find(y=>y.id===m.user_id)}))):i.push(...w(r.children_tasks,_))}return i}function T(u,t){try{const i=new Date(u.report_date).getTime(),r=new Date(t.report_date).getTime();return r===i?t.id-u.id:r-i}catch{return-1}}const R=z(()=>k.value=="loading"?[]:n.task.children_task_count===0?[...b.task_reports].sort(T):[...w(n.tasks)].sort(T));return(u,t)=>{var r,_,m,y,C,S,D,q;const i=U("RouterLink");return o(),l("div",Y,[t[8]||(t[8]=e("hr",{class:"mb-2"},null,-1)),e("div",Z,[e("pre",null,c(u.usersTaskProgress),1),e("div",tt,[t[3]||(t[3]=e("h3",{class:"text-sm font-semibold text-gray-600 uppercase mt-4"},"Task Reports",-1)),((r=a(n).task)==null?void 0:r.children_task_count)===0&&!((_=a(n).task)!=null&&_.closed_at)?(o(),h(i,{key:0,to:{name:"TaskReportAdd",params:{id:(m=a(n).task)==null?void 0:m.id},query:a(p).query},onClick:t[0]||(t[0]=s=>s.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:g(()=>t[2]||(t[2]=[x("Add Report")])),_:1,__:[2]},8,["to"])):d("",!0)]),e("div",et,[k.value!=="loading"?(o(),l("table",st,[e("thead",ot,[e("tr",null,[t[4]||(t[4]=e("th",{class:"px-4 py-2 text-center w-2 border"},"#",-1)),a(n).task.children_task_count>0?(o(),l("th",rt," Task ")):d("",!0),t[5]||(t[5]=e("th",{class:"px-4 py-2 text-left lg:w-[540px] border"},"User Report",-1))])]),e("tbody",null,[((y=R.value)==null?void 0:y.length)===0?(o(),l("tr",at,[e("td",nt,[t[7]||(t[7]=e("div",null,"NO REPORTS",-1)),e("div",null,[((C=a(n).task)==null?void 0:C.children_task_count)===0&&!((S=a(n).task)!=null&&S.closed_at)?(o(),h(i,{key:0,to:{name:"TaskReportAdd",params:{id:(D=a(n).task)==null?void 0:D.id},query:{id:(q=a(n).task)==null?void 0:q.id,...a(p).query}},onClick:t[1]||(t[1]=s=>s.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:g(()=>t[6]||(t[6]=[x("Add Report")])),_:1,__:[6]},8,["to"])):d("",!0)])])])):d("",!0),(o(!0),l(M,null,E(R.value,(s,I)=>{var B,L,N,A,P;return o(),l("tr",{key:s.id,class:"border-t hover:bg-gray-50 cursor-pointer",onClick:G(V=>u.goToShow(s.id),["prevent"]),role:"button"},[e("td",it,c(I+1),1),a(n).task.children_task_count>0?(o(),l("td",dt,[e("div",null,[(o(!0),l(M,null,E(s.task_parents.reverse(),(V,f)=>(o(),l("div",{class:F(["text-gray-400 text-sm line-clamp-1",{"-ml-1":f==0}]),key:f},[f>0?(o(),l("span",ut,"↳")):d("",!0),e("span",ct,c(V),1)],2))),128)),e("div",null,[((B=s.task_parents)==null?void 0:B.length)>0?(o(),l("span",{key:0,style:{"font-family":"monospace"},class:F({"ml-2":((L=s.task_parents)==null?void 0:L.length)==1,"ml-4":((N=s.task_parents)==null?void 0:N.length)==2,"ml-6":((A=s.task_parents)==null?void 0:A.length)==3,"ml-8":((P=s.task_parents)==null?void 0:P.length)==4})},"↳",2)):d("",!0),H(i,{to:{name:a(p).query["is-my-task"]?"MyTaskShow":"TaskShow",params:{id:s.task_id}},class:"ml-1 hover:underline hover:blue-800"},{default:g(()=>[x(c(s.task_title),1)]),_:2},1032,["to"])])])])):d("",!0),e("td",mt,[e("div",pt,[s.user?(o(),h(J,{key:0,user:s.user,class:"inline-block w-full !rounded-sm"},null,8,["user"])):d("",!0),e("div",kt,[e("div",null,c(s.title),1),e("div",_t,c(a(K)(s.report_date)),1)])])])],8,lt)}),128))])])):(o(),l("div",yt,"Loading..."))])])])}}};export{Ct as default};
