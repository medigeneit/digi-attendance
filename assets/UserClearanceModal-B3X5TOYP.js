import{Q as J,r as x,N as Q,m as k,s as X,A as F,K as Z,c,o as p,g as h,x as M,a as s,t as l,l as ee,j as B,k as G,F as H,y as te,J as se}from"./index-D46ic68_.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re=J("userClearance",()=>{const v=x(null),N=x(null),d=x([]),S=x(!1),_=x(""),u=x({total:0,by_status:{},by_handover_to:{}}),i=x({by:"created_at",dir:"desc"}),y=x({search:"",status:"",department_id:"",template_item_id:"",handover_to:""});function D(b){v.value=b}async function o(){var b,L;if(v.value){S.value=!0,_.value="";try{const{data:n}=await Q.get(`/users/${v.value}/clearance-items`,{params:{include:"department,templateItem,clearedBy",sort:i.value.by,order:i.value.dir,search:y.value.search||void 0,status:y.value.status||void 0,department_id:y.value.department_id||void 0,template_item_id:y.value.template_item_id||void 0,handover_to:y.value.handover_to||void 0}}),C=Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n)?n:[];d.value=C;const f=(n==null?void 0:n.meta)||{},P=(n==null?void 0:n.extra)||{},w=f.summary||P.summary||{};u.value={total:Number(w.total??C.length)||0,by_status:w.by_status||{},by_handover_to:w.by_handover_to||{}},f.user&&(N.value=f.user)}catch(n){console.error(n),_.value=((L=(b=n==null?void 0:n.response)==null?void 0:b.data)==null?void 0:L.message)||"Failed to load",d.value=[],u.value={total:0,by_status:{},by_handover_to:{}},N.value=null}finally{S.value=!1}}}function R(b){i.value.by===b?i.value.dir=i.value.dir==="asc"?"desc":"asc":(i.value.by=b,i.value.dir="desc")}function I(){y.value={search:"",status:"",department_id:"",template_item_id:"",handover_to:""}}return{currentUserId:v,currentUserInfo:N,items:d,loading:S,error:_,summary:u,sort:i,filters:y,setUser:D,fetch:o,setSort:R,resetFilters:I}}),ne={key:1,class:"fixed inset-0 z-50 print:static print:z-auto"},oe={class:"absolute inset-0 flex items-start justify-center overflow-y-auto print:block print:overflow-visible"},le={class:"modal-print mt-6 mb-10 w-[1150px] max-w-[96vw] rounded-2xl bg-white shadow-2xl print:w-[210mm] print:max-w-[210mm] print:rounded-none print:shadow-none print:m-0 print:mt-0"},de={class:"px-6 pt-6 pb-4 border-b print:px-[12mm] print:pt-[10mm] print:pb-[4mm]"},ie={class:"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm print:text-[12px]"},ce={class:"flex gap-2"},pe={class:"font-medium"},ue={key:0,class:"value-extra"},me={class:"flex gap-2"},_e={class:"value"},ye={class:"value-text"},be={class:"flex gap-2"},ve={class:"value"},ge={class:"value-text"},xe={class:"px-6 pb-6 print:px-[12mm] print:pb-[12mm] overflow-x-auto print:overflow-visible"},he={class:"w-full border border-gray-800 text-[13px] print:text-[12px]",style:{"border-collapse":"collapse"}},fe={key:0},ke={key:1},Ce={colspan:"6",class:"border border-gray-800 text-center py-6 text-red-600"},Ne={key:2},Se={class:"border border-gray-800 px-2 py-1 align-top tabular-nums"},we=["rowspan"],Ee={class:"text-xs"},Te={class:"border border-gray-800 px-2 py-1"},De={class:"font-medium"},Ie={class:"text-[11px] text-gray-700 mt-0.5"},Le={key:0,class:"text-gray-500 print:hidden"},Pe={key:1,class:"ml-2 text-amber-700"},Re={class:"border border-gray-800 px-2 py-1"},Ae={class:"inline-block min-w-[22mm] text-center font-semibold"},Me={class:"border border-gray-800 px-2 py-1"},Be={class:"whitespace-pre-line"},Ge={class:"border border-gray-800 px-2 py-1"},Ve={key:0,class:"text-[11px] text-gray-600 mt-0.5"},Oe={class:"border border-gray-800 px-2 py-1 print:hidden"},Fe=["title","aria-label"],He={__name:"UserClearanceModal",props:{user:{type:Object,required:!0},open:{type:Boolean,default:!1},buttonClass:{type:String,default:"px-3 py-1.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700"},hideTrigger:{type:Boolean,default:!1}},emits:["update:open"],setup(v,{emit:N}){const d=v,S=N,_=k({get:()=>d.open,set:e=>S("update:open",e)}),u=re(),{items:i,loading:y,error:D,currentUserInfo:o}=X(u),R=k(()=>{var e,t,r;return((e=o==null?void 0:o.value)==null?void 0:e.name)||((t=d.user)==null?void 0:t.name)||`#${(r=d.user)==null?void 0:r.id}`}),I=k(()=>{var e,t;return((e=o==null?void 0:o.value)==null?void 0:e.employee_id)||((t=d.user)==null?void 0:t.employee_id)||""}),b=k(()=>{var e,t;return((e=o==null?void 0:o.value)==null?void 0:e.department_name)||((t=d.user)==null?void 0:t.department_name)||""}),L=k(()=>{var e,t,r;return((e=o==null?void 0:o.value)==null?void 0:e.post)||((t=o==null?void 0:o.value)==null?void 0:t.designation)||((r=d.user)==null?void 0:r.post)||""});function n(){_.value=!0}function C(){_.value=!1}function f(e){e.key==="Escape"&&C()}const P=async()=>{var e,t,r;(e=d.user)!=null&&e.id&&((t=u.setUser)==null||t.call(u,d.user.id),await((r=u.fetch)==null?void 0:r.call(u)))};F(_,e=>{e?(P(),window.addEventListener("keydown",f)):window.removeEventListener("keydown",f)},{immediate:!0}),F(()=>{var e;return(e=d.user)==null?void 0:e.id},(e,t)=>{e&&e!==t&&_.value&&P()}),Z(()=>window.removeEventListener("keydown",f));function w(e={}){const t=e.latest||null,r=(t==null?void 0:t.cleared_by)||null;return{id:e.template_item_id??e.id,template_item_id:e.template_item_id??e.id,label:e.label||e.template_item_name||e.item_key||`#${e.template_item_id??e.id}`,order_no:e.order_no??e.template_order_no??0,handover_to:e.handover_to||"departmental_incharge",handover_by:e.handover_user||"departmental_incharge",show_receiver:!!e.show_receiver,is_cleared:!!e.is_cleared,missing:!!e.missing,status:(t==null?void 0:t.status)??null,handover_status:(t==null?void 0:t.handover_status)??null,present_condition:(t==null?void 0:t.present_condition)??"",receiver_name:e.show_receiver?(t==null?void 0:t.receiver_name)??"":"",remarks:(t==null?void 0:t.remarks)??"",cleared_by_user:r?{id:r.id,name:r.name}:null,cleared_at:(t==null?void 0:t.cleared_at)||null}}const U={departmental_incharge:"Departmental In-charge",technical_support_team:"Technical Support Team",it_incharge:"IT In-charge",hr_department:"HR Department",inventory_incharge:"Inventory In-charge"},V=["Departmental In-charge","Technical Support Team","IT In-charge","HR Department","Inventory In-charge"];function j(e){const t=String((e==null?void 0:e.handover_to)||"").toLowerCase();return U[t]||"Departmental In-charge"}const K=k(()=>(Array.isArray(i==null?void 0:i.value)?i.value:[]).map(w)),O=k(()=>{var T;const e=new Map(V.map(a=>[a,[]]));for(const a of K.value)(T=e.get(j(a)))==null||T.push(a);for(const[,a]of e.entries())a.sort((m,g)=>(m.order_no??m.template_item_id??m.id??0)-(g.order_no??g.template_item_id??g.id??0));const t=[];let r=1;for(const a of V){const m=e.get(a)||[];m.length&&m.forEach((g,q)=>t.push({sl:r++,group:a,isGroupFirst:q===0,groupSpan:m.length,row:g}))}return t});function z(e){const t=String(e??"").trim().toLowerCase();return["y","yes","true","1","done","cleared","complete","completed","yes.","yes,"].includes(t)?"Yes":["n","no","false","0","pending","not done","incomplete","no.","no,","rejected"].includes(t)?"No":"—"}async function Y(){document.body.classList.add("print-modal"),await se(),window.print(),setTimeout(()=>document.body.classList.remove("print-modal"),0)}const E={PENDING:{label:"Pending",pill:"bg-amber-50 text-amber-800 border-amber-200",dot:"bg-amber-500"},WORKING:{label:"Working",pill:"bg-sky-50 text-sky-800 border-sky-200",dot:"bg-sky-500"},COMPLETED:{label:"Completed",pill:"bg-emerald-50 text-emerald-800 border-emerald-200",dot:"bg-emerald-500"}};function A(e){var r;if(e!=null&&e.missing)return"Pending";const t=String((e==null?void 0:e.status)||"").toUpperCase();return((r=E[t])==null?void 0:r.label)||(e==null?void 0:e.status)||"—"}function $(e){var r;if(e!=null&&e.missing)return E.PENDING.pill;const t=String((e==null?void 0:e.status)||"").toUpperCase();return((r=E[t])==null?void 0:r.pill)||"bg-slate-50 text-slate-700 border-slate-200"}function W(e){var r;if(e!=null&&e.missing)return E.PENDING.dot;const t=String((e==null?void 0:e.status)||"").toUpperCase();return((r=E[t])==null?void 0:r.dot)||"bg-slate-400"}return(e,t)=>{var r,T;return p(),c(H,null,[v.hideTrigger?h("",!0):(p(),c("button",{key:0,class:M(v.buttonClass),onClick:n},"View Clearance",2)),_.value?(p(),c("div",ne,[s("div",{class:"absolute inset-0 bg-black/50 print:hidden",onClick:C}),s("div",oe,[s("div",le,[s("div",de,[t[3]||(t[3]=s("div",{class:"text-center"},[s("h1",{class:"text-2xl font-extrabold tracking-wide print:text-[20px]"},"GENESIS PG ORIENTATION CENTRE"),s("p",{class:"text-sm text-gray-600 print:text-[12px]"},"230, New Elephant Road, Katabon Mor, Dhaka-1205")],-1)),s("div",ie,[s("div",ce,[t[0]||(t[0]=s("span",{class:"label"},"Name:",-1)),s("span",null,[s("span",pe,l(R.value),1),I.value?(p(),c("span",ue,"(ID: "+l(I.value)+")",1)):h("",!0)])]),s("div",me,[t[1]||(t[1]=s("span",{class:"label"},"Department:",-1)),s("span",_e,[s("span",ye,l(b.value||"—"),1)])]),s("div",be,[t[2]||(t[2]=s("span",{class:"label"},"Post:",-1)),s("span",ve,[s("span",ge,l(L.value||"—"),1)])])]),t[4]||(t[4]=s("div",{class:"mt-4 text-center"},[s("h2",{class:"inline-block text-base font-semibold px-4 py-1 border rounded print:text-[13px]"}," Employment Resignation Checklist ")],-1))]),s("div",{class:"px-6 py-3 flex justify-end gap-2 print:hidden"},[s("button",{class:"rounded border px-3 py-1.5 hover:bg-gray-50",onClick:Y},"Print"),s("button",{class:"rounded bg-gray-900 px-3 py-1.5 text-white hover:bg-gray-800",onClick:C},"Close")]),s("div",xe,[s("table",he,[t[8]||(t[8]=s("thead",null,[s("tr",{class:"bg-gray-100"},[s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[14mm]"},"S. L."),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[30mm]"},"Handover To"),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[70mm]"},[B(" Particulars "),s("span",{class:"block text-[11px] text-gray-600"},"Cleared by")]),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[30mm]"},"Handed over (Yes/No)"),s("th",{class:"border border-gray-800 text-left px-2 py-1"},"Present Conditions (note please)"),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[42mm]"},"Receiver’s Name"),s("th",{class:"border border-gray-800 text-left px-2 py-1 print:hidden"},"Status")])],-1)),s("tbody",null,[(r=G(y))!=null&&r.value?(p(),c("tr",fe,t[5]||(t[5]=[s("td",{colspan:"6",class:"border border-gray-800 text-center py-6 text-gray-600"},"Loading…",-1)]))):(T=G(D))!=null&&T.value?(p(),c("tr",ke,[s("td",Ce,l(G(D).value),1)])):O.value.length?h("",!0):(p(),c("tr",Ne,t[6]||(t[6]=[s("td",{colspan:"6",class:"border border-gray-800 text-center py-6 text-gray-600"},"No items found",-1)]))),(p(!0),c(H,null,te(O.value,a=>{var m,g;return p(),c("tr",{key:a.row.template_item_id,class:"align-top"},[s("td",Se,l(a.sl)+".",1),a.isGroupFirst?(p(),c("td",{key:0,rowspan:a.groupSpan,class:"border border-gray-800 px-2 py-1 align-top font-medium"},[s("span",Ee,l(a.group),1)],8,we)):h("",!0),s("td",Te,[s("div",De,l(a.row.label),1),s("div",Ie,[t[7]||(t[7]=B(" Cleared by: ")),s("strong",null,l(((m=a.row.cleared_by_user)==null?void 0:m.name)||((g=a.row.cleared_by_user)!=null&&g.id?"#"+a.row.cleared_by_user.id:"—")),1),a.row.cleared_at?(p(),c("span",Le," ("+l(new Date(a.row.cleared_at).toLocaleString())+") ",1)):h("",!0),a.row.missing?(p(),c("span",Pe,"(pending)")):h("",!0)])]),s("td",Re,[s("span",Ae,l(z(a.row.handover_status)),1)]),s("td",Me,[s("div",Be,l(a.row.present_condition||"—"),1)]),s("td",Ge,[s("div",null,l(a.row.show_receiver&&a.row.receiver_name||"—"),1),a.row.remarks?(p(),c("div",Ve,l(a.row.remarks),1)):h("",!0)]),s("td",Oe,[s("span",{class:M(["inline-flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-xs font-medium print:bg-white print:text-black print:border-black",$(a.row)]),title:a.row.missing?"Not cleared yet":"Status: "+A(a.row),"aria-label":A(a.row)},[s("span",{class:M(["h-1.5 w-1.5 rounded-full",W(a.row)])},null,2),B(" "+l(A(a.row)),1)],10,Fe)])])}),128))])]),t[9]||(t[9]=ee('<div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm print:text-[12px]" data-v-65a604ca><div class="border-gray-800 pt-6 text-center" data-v-65a604ca><div class="font-medium" data-v-65a604ca>User Signature</div></div><div class="border-gray-800 pt-6 text-center" data-v-65a604ca><div class="font-medium" data-v-65a604ca>Received by Head of HR</div></div><div class="border-gray-800 pt-6 text-center" data-v-65a604ca><div class="font-medium" data-v-65a604ca>Verified by ACC/CC</div></div></div>',1))])])])])):h("",!0)],64)}}},Ke=ae(He,[["__scopeId","data-v-65a604ca"]]);export{Ke as U};
