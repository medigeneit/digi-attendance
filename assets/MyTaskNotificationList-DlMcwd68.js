import{L as V}from"./LoaderView-IUgDT-Ei.js";import{G as z,r as g,z as U,H as M,p as C,I as D,e as q,J as E,c as o,o as n,a as e,g as p,n as R,w as K,t as k,h as G,v as J,j as L,K as O,b as Z,B as P,q as Q,C as W,f as X,k as _,F as j,x as A,y as B,i as Y}from"./index-uPs6BKob.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H=z("task-notification",()=>{const f=g([]),i=g(),c=g(!1),b=U({"pending-requirements":0,"pending-tasks":0}),v={"pending-requirements":"ðŸ“œ","pending-tasks":"ðŸ“œ"};async function d(x){var m,l,a;i.value=null,c.value=!0;try{const t=await M.get(`/task-notifications/${x}`);return f.value=(m=t==null?void 0:t.data)==null?void 0:m.notifications,t==null?void 0:t.data}catch(t){throw i.value=((a=(l=t.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to fetch notifications",t}finally{c.value=!1}}async function T(x,m,l,a){var t,s,h;i.value=null;try{const u=await M.put(`/task-notifications/${x}/${m}/${l}`,{note:a});return f.value=(t=u==null?void 0:u.data)==null?void 0:t.notifications,u==null?void 0:u.data}catch(u){throw i.value=((h=(s=u.response)==null?void 0:s.data)==null?void 0:h.message)||"Failed to update notifications",u}}return{fetchTaskNotification:d,updateNotification:T,loading:c,notifications:f,notification_count:b,error:i,icons:v}}),ee={key:0,class:"font-bold text-lg text-green-600"},te={key:1,class:"btn-2"},ae={key:0,class:"text-base"},se={key:1,class:"btn-1"},ne={class:"modal-card"},ie={class:"title-lg"},oe=["placeholder","required"],le={class:"flex"},re={class:"flex justify-between gap-2 mt-4"},ce=["disabled"],ue=["disabled"],de={class:"capitalize hidden md:inline"},pe={__name:"ApproveAndReject",props:{notificationType:{type:String,required:!0},applicationId:{type:[String,Number],required:!0},onSuccess:{type:Function,default:null},onSubmit:{type:Function,default:null},variant:{type:Number,default:1}},emits:["loading"],setup(f,{emit:i}){const c=f,b=i,v=g(255),d=C(()=>v.value-t.value.length),T=D(),x=H(),m=g(null),l=g(null),a=g(null),t=g(""),s=g(!1),h=C(()=>a.value!==null),u=C(()=>a.value==="accept"?"Accept Application":"Reject Application");function $(y){(y==="accept"||y==="reject")&&(a.value=y,t.value="",I())}function N(){a.value=null,t.value=""}async function F(){if(!x.loading){if(a.value==="reject"&&!t.value)return T.error("Rejection Reason is required!");if(typeof c.onSubmit=="function")return c.onSubmit({note:t.value,action:a.value});b("loading",!0),s.value=!0;try{await x.updateNotification(c.notificationType,c.applicationId,a.value,t.value)}finally{b("loading",!1),s.value=!1}typeof c.onSuccess=="function"?c.onSuccess():x.fetchTaskNotification(),N()}}function S(y){var r,w;h.value&&(y.key==="ArrowLeft"?(r=l.value)==null||r.focus():y.key==="ArrowRight"&&((w=m.value)==null||w.focus()))}function I(){O(()=>{var y;(y=m.value)==null||y.focus()})}return q(()=>{window.addEventListener("keydown",S)}),E(()=>{window.removeEventListener("keydown",S)}),(y,r)=>(n(),o("div",null,[e("div",{class:R(["flex justify-center items-center",f.variant===1?"gap-5":"gap-2"])},[e("button",{onClick:r[0]||(r[0]=w=>$("accept"))},[f.variant===1?(n(),o("span",ee,"âœ”")):p("",!0),f.variant===2?(n(),o("span",te,r[4]||(r[4]=[e("span",{class:"text-base scale-110"},"âœ”",-1),e("span",{class:"hidden md:inline"},"Approve",-1)]))):p("",!0)]),e("button",{onClick:r[1]||(r[1]=w=>$("reject"))},[f.variant===1?(n(),o("span",ae,"âŒ")):p("",!0),f.variant===2?(n(),o("span",se,r[5]||(r[5]=[e("span",{class:"text-base"},"âŒ",-1),e("span",{class:"hidden md:inline"},"Reject",-1)]))):p("",!0)])],2),h.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:K(N,["self"])},[e("div",ne,[e("h3",ie,k(u.value),1),e("div",null,[G(e("textarea",{"onUpdate:modelValue":r[2]||(r[2]=w=>t.value=w),rows:"7",placeholder:a.value==="accept"?"Accept Note...":"Rejection Reason...",class:"w-full border rounded-lg p-2 text-gray-700",required:a.value==="reject",onInput:r[3]||(r[3]=w=>t.value.length>v.value?t.value=t.value.slice(0,v.value):null)},null,40,oe),[[J,t.value]]),e("div",le,[e("div",{class:R(["ml-auto inline-block text-sm text-gray-500",t.value.length>=v.value?"text-red-500":""])}," left "+k(d.value)+"/"+k(v.value)+" words ",3)])]),e("div",re,[e("button",{ref_key:"cancelBtnRef",ref:l,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:N,disabled:s.value}," Cancel ",8,ce),e("button",{ref_key:"confirmBtnRef",ref:m,class:R(["focus:ring-2 ring-offset-2 disabled:opacity-30",a.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:F,disabled:s.value},[r[6]||(r[6]=L(" Confirm ")),e("span",de,k(a.value),1)],10,ue)])])])):p("",!0)]))}},fe={class:"my-container space-y-4 px-4 py-4 relative"},ve={class:"md:text-2xl font-semibold capitalize text-gray-700"},me={key:0,class:"ml-auto text-xs bg-red-500 text-white rounded-full px-2 py-0.5 font-semibold"},ye={key:1,class:"space-y-4"},ge={class:"flex gap-2 md:gap-3 items-center"},xe={class:"shrink grow font-semibold text-sm md:text-base"},he=["innerHTML"],_e={class:"ml-auto shrink-0 grow-0 flex gap-2 md:gap-3 items-center"},ke=["innerHTML"],be={key:0,class:"flex flex-wrap gap-y-1 gap-x-3 items-center text-xs md:text-sm lg:text-base"},we={key:0},Te={class:"flex gap-3 items-center"},$e={class:"flex items-center gap-8"},Ce={key:0,class:"flex flex-wrap flex-col md:flex-row gap-x-1 text-xs md:text-sm text-left"},Ne={key:0,class:"hidden md:inline font-bold"},Re=["innerHTML"],je={key:2,class:"h-[80vh] flex items-center justify-center border rounded-md bg-white/50 text-gray-400"},Ae={__name:"MyTaskNotificationList",setup(f){const i=Z(),c=H(),{notifications:b,notification_count:v}=P(c),d=g(!1);q(async()=>{i.params.type&&(d.value=!0,await c.fetchTaskNotification(i.params.type),d.value=!1)});async function T(){d.value=!0,await c.fetchTaskNotification(i.params.type),d.value=!1}Q(()=>i.params.type,async(l,a)=>{l&&l!==a&&(d.value=!0,await c.fetchTaskNotification(l),d.value=!1)});const x=l=>{if(i.params.type=="pending-requirements")return{name:"RequirementShow",params:{id:l.application_id}}},m=C(()=>i.params.type?i.params.type.replace(/[_-]/g," ").replace(/([A-Z])/g," $1").replace(/\s+/g," ").trim().split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "):"");return(l,a)=>{const t=W("RouterLink");return n(),o("div",fe,[e("h2",ve,[L(k(m.value||"Notifications")+" ",1),_(v)[_(i).params.type]?(n(),o("span",me,k(_(v)[_(i).params.type]),1)):p("",!0)]),d.value||_(c).loading?(n(),X(V,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-80 !shadow-none min-h-[80vh]"})):p("",!0),_(b).length>0?(n(),o("div",ye,[(n(!0),o(j,null,A(_(b),s=>{var h;return n(),o("div",{key:s.application_id,class:"bg-white p-3 md:p-4 rounded-xl shadow border grid gap-2"},[e("div",ge,[e("div",xe,[e("div",{class:"flex items-center text-green-600 text-xs md:text-sm lg:text-base",innerHTML:s.title},null,8,he),e("div",null,k(s.user_name),1)]),e("div",_e,[B(t,{to:x(s),class:"btn-1 px-3"},{default:Y(()=>a[1]||(a[1]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[1]},1032,["to"])])]),e("div",{class:"text-red-600 text-xs md:text-sm lg:text-base line-clamp-1 pr-12",innerHTML:s.description},null,8,ke),s.type?(n(),o("div",be,[s.type?(n(),o("div",we,[a[2]||(a[2]=e("span",{class:"text-gray-400"},"Type:",-1)),L(" "+k(s.type),1)])):p("",!0)])):p("",!0),e("div",Te,[e("div",$e,[(h=s.messages)!=null&&h.length?(n(),o("p",Ce,[(n(!0),o(j,null,A(s.messages,(u,$)=>(n(),o(j,{key:$},[$?(n(),o("span",Ne,"|")):p("",!0),e("span",{innerHTML:u,class:"text-black"},null,8,Re)],64))),128))])):p("",!0)]),B(pe,{class:"ml-auto",notificationType:_(i).params.type,applicationId:s==null?void 0:s.application_id,onSuccess:T,variant:2,onLoading:a[0]||(a[0]=u=>d.value=u)},null,8,["notificationType","applicationId"])])])}),128))])):d.value?p("",!0):(n(),o("div",je," No notifications found. "))])}}};export{Ae as default};
