import{J as O,r as d,q as f,K as o}from"./index-8Bo2pF8s.js";const x=O("task",()=>{const i=d([]),v=d(null),n=d(!1),u=d(null),p=async(a,s)=>{var e,t;n.value=!0,u.value=null;try{await o.post(`/tasks/${a}/assign-users`,{user_ids:s}),await y(a)}catch(l){throw u.value=((t=(e=l.response)==null?void 0:e.data)==null?void 0:t.message)||"Assign users failed",l}finally{n.value=!1}},w=async(a,{loadingBeforeFetch:s=!0})=>{var e,t,l;s&&(n.value=!0),u.value=null;try{const r=await o.get("/tasks",{params:a});return i.value=((e=r.data)==null?void 0:e.tasks)||[],r.data}catch(r){u.value=((l=(t=r.response)==null?void 0:t.data)==null?void 0:l.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",r)}finally{n.value=!1}};function k(a,s=0){return Array.isArray(a)===!1||a.length===0?[]:a.filter(e=>e.parent_id===s).map(e=>({...e,children_tasks:k(a,e.id)}))}function h(){return k(i.value,0)}function T(){const a=[],s=(e,t=0,l="")=>{e.forEach(r=>{a.push({...r,depth:t,idPath:l+r.id}),r.children_tasks&&r.children_tasks.length&&s(r.children_tasks,t+1,l+r.id+"-")})};return s(h()),a}const y=async(a,s={},e={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,l,r;e.fetchOnly||(n.value=!0),u.value=null;try{const c=await o.get(`/tasks/${a}`,{params:s});return e.fetchOnly||(v.value=((t=c.data)==null?void 0:t.task)||{}),c.data}catch(c){const g=((r=(l=c.response)==null?void 0:l.data)==null?void 0:r.message)||`টাস্ক (ID: ${a}) লোড করতে ব্যর্থ হয়েছে।`;return e.fetchOnly||(u.value=g),g}finally{e.fetchOnly||(n.value=!1)}},m=async(a,s={loadingBeforeCreate:!1})=>{var e,t,l,r;s.loadingBeforeCreate&&(n.value=!0),u.value=null;try{const c=await o.post("/tasks",a);return(e=c.data)!=null&&e.data&&i.value.push((t=c.data)==null?void 0:t.data),c.data.data}catch(c){throw u.value=((r=(l=c.response)==null?void 0:l.data)==null?void 0:r.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",c),c}finally{s.loadingBeforeCreate&&(n.value=!1)}},$=async(a,s,{loadingBeforeFetch:e=!0})=>{e&&(n.value=!0),u.value=null;try{const t=await o.put(`/tasks/${a}`,s),l=i.value.findIndex(r=>r.id===a);return l!==-1&&(i.value[l]=t.data.data),t.data.data}catch(t){throw console.error(`Error updating task with id ${a}:`,t),t}finally{e&&(n.value=!1)}},_=async(a,s)=>(await o.put(`/tasks/${a}/update-priorities`,{task_ids:s})).data,E=async a=>{var s,e;n.value=!0,u.value=null;try{await o.delete(`/tasks/${a}`),i.value=i.value.filter(t=>t.id!==a)}catch(t){u.value=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||`টাস্ক (ID: ${a}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${a}:`,t)}finally{n.value=!1}};return{tasks:f(()=>i.value),task:f(()=>v.value),loading:f(()=>n.value),error:f(()=>u.value),taskListTree:f(h),flattenedTasks:f(T),fetchTasks:w,fetchTask:y,createTask:m,updateTask:$,deleteTask:E,assignUsers:p,updateTaskPriorities:_}});export{x as u};
