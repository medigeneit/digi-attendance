import{u as N,M as C,s as L,r as h,b as B,p as I,o as s,c as v,d as O,v as q,a as r,e as _,t as A,h as k,F as U,x as F,y as V,j as R,m as E,g as z,f as G,n as Z}from"./index-KVAyDX70.js";import{u as D}from"./leave-application-r3tc-tJ1.js";import{u as K}from"./exchange-GrPCALGQ.js";import{u as P}from"./short-leave-CXcN1LpS.js";const Q={key:0,class:"text-center space-y-2 print:hidden"},W={key:0,class:"mt-2"},X={class:"flex justify-end gap-2 pt-2"},Y={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(S){const y=N(),p=C(),f=K(),{user:w}=L(y),m=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(m.application))});const u=h(!1),l=h(""),n=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{await f.handoverAccept(a),alert("Handover approved!"),await c()},condition:()=>{var a,o;return!((a=t.value)!=null&&a.status)&&((o=t.value)==null?void 0:o.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{await f.inChargeAccept(a),alert("In-Charge approved!"),await c()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{await f.recommendByAccept(a),alert("Recommendation approved!"),await c()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{await f.approvedByAccept(a),alert("Final approval successful!"),await c()}}],i=I(()=>n.find(a=>{var o,d,b,x;return t.value?a.key==="handover"?a.condition():((o=t.value)==null?void 0:o.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((b=t.value)!=null&&b[a.approved_field])&&((x=t.value)==null?void 0:x[a.approved_by_field])===w.value.id:!1})),g=()=>{u.value&&l.value?(e(),u.value=!1):u.value=!0};async function e(){try{await f.rejectExchange(t.value.id,l.value),alert("Exchange application rejected!"),l.value="",await c(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function c(a){await p.markAsRead(m.notificationId)}return(a,o)=>i.value&&t.value?(s(),v("div",Q,[u.value?(s(),v("div",W,[O(r("textarea",{"onUpdate:modelValue":o[0]||(o[0]=d=>l.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,l.value]])])):_("",!0),r("div",X,[r("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:o[1]||(o[1]=d=>i.value.action(t.value.id))}," Approve "),r("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:g}," Reject ")])])):_("",!0)}},M={key:0,class:"text-center space-y-2 print:hidden"},ee={key:0,class:"mt-2"},ae={class:"flex justify-end gap-2 pt-2"},te={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(S){const y=N(),p=D(),f=C(),{user:w}=L(y),m=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(m.application))});const u=h(!1),l=h(""),n=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{await p.acceptHandover(a),alert("Handover approved!"),await c()},condition:()=>{var a,o;return!((a=t.value)!=null&&a.status)&&((o=t.value)==null?void 0:o.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{await p.acceptInCharge(a),alert("In-Charge approved!"),await c()}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async a=>{await p.acceptCoordinator(a),alert("Coordinator approved!"),await c()}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async a=>{await p.acceptOperationalAdmin(a),alert("Operational Admin approved!"),await c()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{await p.acceptRecommendBy(a),alert("Recommendation approved!"),await c()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{await p.acceptApprovedBy(a),alert("Final approval successful!"),await c()}}],i=I(()=>n.find(a=>{var b,x,j,$;if(!t.value)return!1;if(a.key==="handover")return a.condition();const o=!!((b=t.value)!=null&&b[a.approved_field]),d=((x=t.value)==null?void 0:x[a.approved_by_field])===w.value.id;return((j=t.value)==null?void 0:j.status)!=="Rejected"&&(($=t.value)==null?void 0:$.status)!=="Approved"&&!o&&d})),g=()=>{u.value&&l.value?(e(),u.value=!1):u.value=!0};async function e(){try{await p.rejectLeaveApplication(t.value.id,{rejection_reason:l.value}),alert("Application rejected!"),l.value="",await c(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function c(a){await f.markAsRead(m.notificationId)}return(a,o)=>i.value&&t.value?(s(),v("div",M,[u.value?(s(),v("div",ee,[O(r("textarea",{"onUpdate:modelValue":o[0]||(o[0]=d=>l.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,l.value]])])):_("",!0),r("div",ae,[r("button",{class:"btn-2",onClick:o[1]||(o[1]=d=>i.value.action(t.value.id))},"Approve"),r("button",{class:"btn-1",onClick:g},"Reject")])])):_("",!0)}},oe={key:0,class:"text-center space-y-2 print:hidden"},ne={key:0,class:"mt-2"},re={class:"flex justify-end gap-2 pt-2"},se={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(S){const y=N(),p=P(),f=C(),{user:w}=L(y),m=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(m.application))});const u=h(!1),l=h(""),n=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{await p.handoverAccept(a),alert("Handover approved!"),await c()},condition:()=>{var a,o;return!((a=t.value)!=null&&a.status)&&((o=t.value)==null?void 0:o.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{await p.inChargeAccept(a),alert("In-Charge approved!"),await c()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{await p.recommendByAccept(a),alert("Recommendation approved!"),await c()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{await p.approvedByAccept(a),alert("Final approval successful!"),await c()}}],i=I(()=>n.find(a=>{var o,d,b,x;return t.value?a.key==="handover"?a.condition():((o=t.value)==null?void 0:o.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((b=t.value)!=null&&b[a.approved_field])&&((x=t.value)==null?void 0:x[a.approved_by_field])===w.value.id:!1})),g=()=>{u.value&&l.value?(e(),u.value=!1):u.value=!0};async function e(){try{await p.rejectShortLeave(t.value.id,l.value),alert("Application rejected!"),l.value="",await c(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function c(a){await f.markAsRead(m.notificationId)}return(a,o)=>i.value&&t.value?(s(),v("div",oe,[u.value?(s(),v("div",ne,[O(r("textarea",{"onUpdate:modelValue":o[0]||(o[0]=d=>l.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,l.value]])])):_("",!0),r("div",re,[u.value?_("",!0):(s(),v("button",{key:0,class:"btn-2",onClick:o[1]||(o[1]=d=>i.value.action(t.value.id))}," Approve ")),r("button",{class:"btn-1",onClick:g},A(u.value?"Submit":"Reject"),1)])])):_("",!0)}},ie={class:"space-y-6 px-4 py-4"},le={class:"text-2xl font-semibold capitalize text-gray-700"},ce={key:0,class:"space-y-4"},de={class:"flex items-start gap-4"},pe={class:"text-2xl text-blue-500"},ue={class:"flex-1"},_e={class:"text-gray-800 font-medium"},ve={class:"text-gray-800 font-medium"},ye={class:"text-red-600 text-sm"},fe={key:0,class:"text-xs text-gray-400"},he={key:0,class:"grid gap-2"},ge={class:"flex items-center gap-4"},be=["href"],xe={class:"grow-0 w-full"},we={key:0,class:"text-xs font-semibold"},me={class:"text-xs text-gray-400"},ke={key:1,class:"text-center text-red-500 py-10"},$e={__name:"NotificationList",setup(S){z();const y=G(),p=C(),{notifications:f}=L(p);D();const w=N();L(w),h(!1),h({}),h({}),B(()=>{p.fetchNotifications()});const m=(n,i)=>{if(!n)return"No application details";switch(i){case"leaveApplication":return`Last Office ( ${n.last_working_date} ) → Join Date ( ${n.resumption_date} )`;case"shortLeave":return`Short Leave on ${n.date} form ${l(n.start_time)??"N/A"} to ${n.end_time?l(n.end_time):"N/A"}`;case"exchange":return n.exchange_type==="offday"?`Exchange (Offday): ${n.exchange_date} → ${n.current_date}`:n.exchange_type==="shift"?`Exchange (${n.exchange_type}) on ${n.current_date} (${(n==null?void 0:n.shift_name)??"No Shift"})`:`Exchange (${n.exchange_type})`;default:return"Unknown Event"}},t=n=>{switch(n){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"exchange":return"fas fa-random";default:return"fas fa-bell"}},u=n=>new Date(n).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=n=>{const[i,g]=n.split(":").map(Number),e=new Date;return e.setHours(i,g),e.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(n,i)=>{const g=Z("RouterLink");return s(),v("div",ie,[r("h2",le,A(k(y).query.type.replace(/([A-Z])/g," $1")),1),k(f)[k(y).query.type]?(s(),v("div",ce,[(s(!0),v(U,null,F(k(f)[k(y).query.type],(e,c)=>{var a,o,d,b,x,j,$,H,J,T;return s(),v("div",{key:e.id,class:"bg-white p-4 rounded-xl shadow border"},[r("div",de,[r("div",pe,[r("i",{class:V(t(e.event_type))},null,2)]),r("div",ue,[r("p",_e,A((a=e.event_model)==null?void 0:a.user_name),1),r("p",ve,"Reason: "+A((o=e.event_model)==null?void 0:o.reason),1),r("p",ye,A(m(e.event_model,e.event_type)),1),(d=e==null?void 0:e.event_model)!=null&&d.total_leave_days_without_week?(s(),v("p",fe," Total Leave: "+A(e==null?void 0:e.event_model.total_leave_days_without_week)+" days ",1)):_("",!0)]),e!=null&&e.event_model?(s(),v("div",he,[r("div",ge,[e!=null&&e.event_model.attachment?(s(),v("a",{key:0,href:(b=e==null?void 0:e.event_model)==null?void 0:b.attachment,target:"_blank",class:"text-blue-500 underline"},i[0]||(i[0]=[r("i",{class:"fad fa-link"},null,-1)]),8,be)):_("",!0),k(y).query.type==="leaveApplication"?(s(),R(g,{key:1,to:{name:"LeaveApplicationShow",params:{id:(x=e==null?void 0:e.event_model)==null?void 0:x.id}},class:"btn-icon"},{default:E(()=>i[1]||(i[1]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),k(y).query.type==="shortLeave"?(s(),R(g,{key:2,to:{name:"ShortLeaveShow",params:{id:(j=e==null?void 0:e.event_model)==null?void 0:j.id}},class:"btn-icon"},{default:E(()=>i[2]||(i[2]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),k(y).query.type==="exchange"?(s(),R(g,{key:3,to:{name:(($=e==null?void 0:e.event_model)==null?void 0:$.exchange_type)=="offday"?"ExchangeOffdayShow":"ExchangeShiftShow",params:{id:(H=e==null?void 0:e.event_model)==null?void 0:H.id}},class:"btn-icon"},{default:E(()=>i[3]||(i[3]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0)]),r("div",xe,[(J=e==null?void 0:e.event_model)!=null&&J.type?(s(),v("p",we," Type : "+A((T=e==null?void 0:e.event_model)==null?void 0:T.type),1)):_("",!0),r("p",me,A(u(e.created_at)),1)])])):_("",!0)]),e!=null&&e.event_model&&e.event_type==="leaveApplication"?(s(),R(te,{key:0,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):_("",!0),e!=null&&e.event_model&&e.event_type==="shortLeave"?(s(),R(se,{key:1,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):_("",!0),e!=null&&e.event_model&&e.event_type==="exchange"?(s(),R(Y,{key:2,application:e.event_model,notificationId:e.id},null,8,["application","notificationId"])):_("",!0)])}),128))])):(s(),v("div",ke,"No notifications found."))])}}};export{$e as default};
