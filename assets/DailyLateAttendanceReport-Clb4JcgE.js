import{_ as M}from"./EmployeeFilter-NybK3Oul.js";import{_ as Q}from"./FlexibleDatePicker-BMALC9St.js";import{L as W}from"./LoaderView-zUiiYSQ1.js";import{u as Y}from"./attendance-DBPmJni6.js";import{u as G}from"./company-NKACOxIs.js";import{u as H}from"./department-C6x03isn.js";import{u as J,f as I,D as w,r,q as S,h as X,c as p,o as m,a,d as k,m as Z,n as D,k as ee,F as te,e as ae,t as o,b as d,s as z}from"./index-DP_M0nuB.js";import{S as le}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./EmployeeDropdownInput-ziAoih_p.js";import"./SelectDropdown-DJ6Fvb30.js";import"./UserChip-BDtb7tV6.js";import"./user-D9wyUoTV.js";const ne={class:"space-y-4 px-4"},se={class:"rounded-xl border border-zinc-200 bg-white shadow-sm"},ie={class:"flex flex-wrap gap-3 p-4"},oe={class:"relative"},de={key:0,class:"py-10 text-center"},ue={key:1,class:"overflow-hidden rounded-xl border border-zinc-200 bg-white shadow-sm"},pe={class:"overflow-x-auto"},me={class:"min-w-full text-sm"},ce={class:"px-3 py-2 align-top"},ye={class:"px-3 py-2 align-top"},re={class:"inline-flex items-center gap-1 rounded-full bg-zinc-100 px-2 py-0.5 text-xs text-zinc-700"},fe={class:"px-3 py-2 align-top"},_e={class:"inline-flex items-center gap-1 rounded-full bg-blue-50 text-blue-700 px-2 py-0.5 text-xs"},ve={class:"px-3 py-2 align-top"},xe={class:"max-w-[220px] truncate font-medium text-zinc-800"},ge={class:"px-3 py-2 align-top"},he={class:"max-w-[220px] truncate text-zinc-700"},be={class:"px-3 py-2 align-top"},we={class:"max-w-[220px] truncate text-zinc-700"},Se={class:"px-3 py-2 align-top"},ke={class:"inline-flex items-center gap-1 rounded-md bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-700"},De={class:"px-3 py-2 align-top"},ze={class:"px-3 py-2 align-top"},Ce={key:1,class:"text-xs italic text-zinc-400"},Ee={class:"px-3 py-2 align-top"},qe={class:"inline-flex items-center gap-1 rounded-full bg-indigo-50 text-indigo-700 px-2 py-0.5 text-xs"},Le={key:0},Ye={__name:"DailyLateAttendanceReport",setup(Ne){const _=J(),y=I(),v=Y(),c=G(),C=H(),{dailyLateLogs:E,isLoading:F,selectedDate:x}=w(v),{companies:Te}=w(c),{departments:Ae}=w(C),e=r({company_id:y.query.company_id||"",department_id:y.query.department_id||"",line_type:y.query.line_type||"all",employee_id:y.query.employee_id||"",date:y.query.date||""});["company_id","department_id","employee_id","date"].forEach(n=>{e.value[n]=e.value[n]?String(e.value[n]):""}),e.value.line_type=e.value.line_type||"all";const q=n=>String(n||"").padStart(2,"0"),g=r((n=>{if(!n){const i=new Date;return{year:i.getFullYear(),month:i.getMonth()+1,day:i.getDate()}}const[l="0",s="1",t="1"]=n.split("-");return{year:Number(l)||new Date().getFullYear(),month:Number(s)||1,day:Number(t)||1}})(e.value.date||x.value));S(g,n=>{if(!n)return;const l=`${n.year}-${q(n.month)}-${q(n.day)}`;e.value.date!==l&&(e.value.date=l)},{deep:!0});const u=r(null),f=r([]);x.value=e.value.date||"";function L(){u.value&&u.value.id?e.value.employee_id=String(u.value.id):u.value||(e.value.employee_id=e.value.employee_id||"")}async function R(){await v.getDailyLateReport(e.value.company_id||"",e.value.department_id||"",e.value.line_type||"all",e.value.employee_id||"",e.value.date||"","daily")}async function U(n){if(!n){f.value=[],u.value=null,e.value.department_id="";return}if(await Promise.all([C.fetchDepartments(n),c.fetchEmployee(n)]),f.value=c.employees||[],e.value.department_id&&((c.employees||[]).some(s=>String(s.department_id)===String(e.value.department_id))||(e.value.department_id="")),e.value.employee_id){const l=(c.employees||[]).find(s=>String(s.id)===String(e.value.employee_id));u.value=l||null,L()}}function V(){if(!e.value.company_id){f.value=[],u.value=null,e.value.employee_id="";return}const n=c.employees||[],l=e.value.department_id,s=e.value.line_type;let t=n;l&&(t=t.filter(i=>String(i.department_id)===String(l))),s&&s!=="all"&&(t=t.filter(i=>String(i.type)===String(s))),f.value=t,e.value.employee_id&&(t.some(K=>String(K.id)===String(e.value.employee_id))||(u.value=null,e.value.employee_id=""))}let h=null;function B(){h&&clearTimeout(h),h=setTimeout(()=>{const n={};e.value.company_id&&(n.company_id=String(e.value.company_id)),e.value.department_id&&(n.department_id=String(e.value.department_id)),e.value.employee_id&&(n.employee_id=String(e.value.employee_id)),e.value.line_type&&e.value.line_type!=="all"&&(n.line_type=String(e.value.line_type)),e.value.date&&(n.date=String(e.value.date)),_.replace({query:n}).catch(()=>{})},120)}let b=null;const N=r(e.value.company_id||""),T=r("");async function $(){(e.value.company_id||"")!==(N.value||"")&&(await U(e.value.company_id||""),N.value=e.value.company_id||""),e.value.company_id?V():(f.value=[],u.value=null);const n=JSON.stringify({c:e.value.company_id||"",d:e.value.department_id||"",t:e.value.line_type||"all",e:e.value.employee_id||"",dt:e.value.date||""});n!==T.value&&(await R(),T.value=n),B()}function A(){b&&clearTimeout(b),b=setTimeout($,200)}S(()=>({...e.value}),()=>{L(),A()},{deep:!0}),S(()=>e.value.date,n=>{x.value=n||""}),X(async()=>{await c.fetchCompanies(),A()});async function O(){try{console.log("sdf"),await v.lateReportDownloadExcel(e.value.company_id||"",e.value.department_id||"",e.value.line_type||"all",e.value.employee_id||"",e.value.date||"","daily")}catch{le.fire({icon:"warning",title:"Heads up",text:"Exporting all companies may be restricted by backend.",confirmButtonText:"OK"})}}const P=()=>{const n={company_id:e.value.company_id,department_id:e.value.department_id,line_type:e.value.line_type,employee_id:e.value.employee_id};Object.entries(n).some(([s,t])=>y.query[s]!==String(t))&&_.replace({query:n})};function j(){_.go(-1)}return(n,l)=>{var s;return m(),p("div",ne,[a("div",{class:"flex flex-wrap items-center justify-between gap-3"},[a("button",{class:"btn-3 inline-flex items-center gap-2",onClick:j,"aria-label":"Go back"},l[5]||(l[5]=[a("i",{class:"fas fa-arrow-left"},null,-1),a("span",{class:"hidden md:inline"},"Back",-1)])),l[7]||(l[7]=a("h1",{class:"title-md md:title-lg text-center flex-1"}," Daily Late Reports ",-1)),a("div",{class:"flex items-center gap-2"},[a("button",{type:"button",onClick:O,class:"btn-1"},l[6]||(l[6]=[a("i",{class:"fas fa-file-excel text-green-600"},null,-1),a("span",{class:"hidden sm:inline"},"Export",-1)]))])]),a("div",se,[a("div",ie,[k(M,{company_id:e.value.company_id,"onUpdate:company_id":l[1]||(l[1]=t=>e.value.company_id=t),department_id:e.value.department_id,"onUpdate:department_id":l[2]||(l[2]=t=>e.value.department_id=t),employee_id:e.value.employee_id,"onUpdate:employee_id":l[3]||(l[3]=t=>e.value.employee_id=t),line_type:e.value.line_type,"onUpdate:line_type":l[4]||(l[4]=t=>e.value.line_type=t),"initial-value":n.$route.query,onFilterChange:P},{default:Z(()=>[a("div",oe,[l[8]||(l[8]=a("label",{class:"top-label"},"Date",-1)),k(Q,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=t=>g.value=t),"show-year":!1,"show-month":!1,"show-date":!0},null,8,["modelValue"])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])])]),D(F)?(m(),p("div",de,[k(W)])):(m(),p("div",ue,[a("div",pe,[a("table",me,[l[18]||(l[18]=a("thead",{class:"bg-zinc-50 sticky top-0 z-10"},[a("tr",{class:"text-left text-zinc-700"},[a("th",{class:"px-3 py-2.5"},"#"),a("th",{class:"px-3 py-2.5"},"Date"),a("th",{class:"px-3 py-2.5"},"Weekday"),a("th",{class:"px-3 py-2.5"},"Employee"),a("th",{class:"px-3 py-2.5"},"Company"),a("th",{class:"px-3 py-2.5"},"Department"),a("th",{class:"px-3 py-2.5"},"Entry Time"),a("th",{class:"px-3 py-2.5"},"Late Duration"),a("th",{class:"px-3 py-2.5"},"Application"),a("th",{class:"px-3 py-2.5"},"Shift")])],-1)),a("tbody",null,[(m(!0),p(te,null,ae(D(E),(t,i)=>(m(),p("tr",{key:t.id||i,class:"border-t border-zinc-100 odd:bg-white even:bg-zinc-50 hover:bg-sky-50 transition-colors"},[a("td",ce,o(i+1),1),a("td",ye,[a("span",re,[l[9]||(l[9]=a("i",{class:"far fa-calendar-alt"},null,-1)),d(" "+o((t==null?void 0:t.date)||"-"),1)])]),a("td",fe,[a("span",_e,[l[10]||(l[10]=a("i",{class:"far fa-calendar-check"},null,-1)),d(" "+o((t==null?void 0:t.weekday)||"-"),1)])]),a("td",ve,[a("div",xe,[l[11]||(l[11]=a("i",{class:"far fa-user mr-1 text-zinc-500"},null,-1)),d(o((t==null?void 0:t.user_name)||"Unknown"),1)])]),a("td",ge,[a("div",he,[l[12]||(l[12]=a("i",{class:"far fa-building mr-1 text-zinc-500"},null,-1)),d(o((t==null?void 0:t.company_name)||"Unknown"),1)])]),a("td",be,[a("div",we,[l[13]||(l[13]=a("i",{class:"far fa-sitemap mr-1 text-zinc-500"},null,-1)),d(o((t==null?void 0:t.department_name)||"Unknown"),1)])]),a("td",Se,[a("span",ke,[l[14]||(l[14]=a("i",{class:"far fa-clock"},null,-1)),d(o((t==null?void 0:t.entry_time)||"-"),1)])]),a("td",De,[a("span",{class:z(["inline-flex items-center gap-1 rounded-md px-2 py-0.5 text-xs font-semibold",((t==null?void 0:t.late_duration)||"").trim()?"bg-rose-50 text-rose-700":"bg-zinc-100 text-zinc-500"])},[l[15]||(l[15]=a("i",{class:"fas fa-stopwatch"},null,-1)),d(o((t==null?void 0:t.late_duration)||"â€”"),1)],2)]),a("td",ze,[t!=null&&t.short_leave?(m(),p("span",{key:0,class:z(["inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium",{"bg-green-50 text-green-700":t.short_leave.status==="Approved","bg-yellow-50 text-yellow-700":t.short_leave.status==="Pending","bg-rose-50 text-rose-700":t.short_leave.status!=="Approved"&&t.short_leave.status!=="Pending"}])},[a("i",{class:z([t.short_leave.status==="Approved"?"fas fa-check-circle":t.short_leave.status==="Pending"?"fas fa-hourglass-half":"fas fa-times-circle"])},null,2),d(" "+o(t.short_leave.status||"Waiting"),1)],2)):(m(),p("span",Ce,"No Application"))]),a("td",Ee,[a("span",qe,[l[16]||(l[16]=a("i",{class:"far fa-moon"},null,-1)),d(o((t==null?void 0:t.shift_name)||"-"),1)])])]))),128)),(s=D(E))!=null&&s.length?ee("",!0):(m(),p("tr",Le,l[17]||(l[17]=[a("td",{colspan:"10",class:"px-3 py-8 text-center text-zinc-500"},[a("i",{class:"far fa-folder-open mr-2"}),d("No late entries found for the selected filters. ")],-1)])))])])])]))])}}};export{Ye as default};
