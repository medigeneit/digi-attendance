import{Q as we,r as w,x as Ae,c as v,o as u,a as s,j as E,t as o,s as xe,k as j,v as $,b as y,F as U,e as S,G as Fe,q as Ne,w as Oe,H as Pe,h as qe,d as A,i as _e,m as L}from"./index-BSTa_RIz.js";import{u as ke}from"./zk-device-CPEP0xe2.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ze}from"./DeleteModal-eAc84O2N.js";import{_ as Ge}from"./HeaderWithButtons-D1wt2XWl.js";import{L as He}from"./LoaderView-CEzKhcxX.js";const Qe={class:"relative rounded-2xl border border-slate-200 bg-white shadow-sm hover:shadow-md transition"},We={class:"rounded-t-2xl bg-gradient-to-r from-blue-900 to-blue-700 px-4 py-3 text-white"},Je={class:"flex items-center justify-between"},Ke={class:"flex items-center gap-3"},Xe={class:"text-sm font-semibold leading-tight"},Ye={class:"text-[11px] text-white/70 leading-tight"},Ze={key:0,class:"absolute inset-0 bg-white/70 grid place-items-center rounded-2xl z-10"},es={class:"flex items-center gap-2 text-slate-700"},ss={class:"text-sm capitalize"},ts={class:"p-4"},ls={class:"grid grid-cols-2 sm:grid-cols-3 gap-2"},as=["disabled"],os=["disabled"],is=["disabled"],ns=["disabled"],rs=["disabled"],ds=["disabled"],us=["disabled"],cs=["disabled"],ms=["disabled"],ps=["disabled"],vs={class:"btn-tile cursor-pointer"},fs=["disabled"],bs=["disabled"],gs={key:1,class:"modal-bg"},ys={class:"modal-card"},xs={class:"flex items-center justify-between px-4 py-3 border-b"},_s={class:"p-4 space-y-3"},ws={class:"flex justify-end gap-2 pt-2"},ks=["disabled"],hs={key:2,class:"modal-bg"},Cs={class:"modal-card"},Ds={class:"flex items-center justify-between px-4 py-3 border-b"},Es={class:"font-semibold"},js={class:"max-h-[70vh] overflow-auto text-sm"},Us={key:0,class:"space-y-3"},$s={class:"flex items-center justify-between"},Ss={class:"text-[13px] text-slate-700"},Vs={class:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-[13px]"},Ts={class:"sm:col-span-3"},Is={key:0},Ls={class:"overflow-auto max-h-[40vh]"},Ms={class:"w-full text-[12px]"},Rs={class:"pr-2 py-1 uppercase"},As={class:"pr-2 py-1"},Fs={class:"py-1"},Ns={key:0},Os={key:1,class:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-[13px]"},Ps={class:"sm:col-span-2"},qs={key:2},Bs={class:"mb-2 text-[13px] text-slate-600"},zs={class:"overflow-auto max-h-[55vh]"},Gs={class:"w-full text-[12px]"},Hs={class:"pr-2 py-1"},Qs={class:"pr-2 py-1"},Ws={class:"pr-2 py-1"},Js={class:"pr-2 py-1"},Ks={class:"py-1"},Xs={key:3,class:"space-y-3"},Ys={class:"flex flex-wrap gap-2 text-[12px]"},Zs={class:"px-2 py-0.5 rounded bg-gray-100"},et={class:"px-2 py-0.5 rounded bg-gray-100"},st={class:"px-2 py-0.5 rounded bg-emerald-100"},tt={class:"px-2 py-0.5 rounded bg-amber-100"},lt={class:"px-2 py-0.5 rounded bg-rose-100"},at={class:"list-disc ml-6 text-[12px]"},ot={class:"list-disc ml-6 text-[12px]"},it={class:"list-disc ml-6 text-[12px]"},nt={__name:"DeviceCard",props:{device:{type:Object,required:!0}},emits:["edit","delete","refresh"],setup(k,{emit:x}){const f=k,_=x,r=we(),a=ke(),b=w(!1),D=w(""),l=w({open:!1,title:"",view:"json",data:null});function n(t,e,i){l.value={open:!0,title:t,view:e,data:i}}function d(){l.value.open=!1,l.value.data=null}function c(t){b.value=!0,D.value=t}function m(){b.value=!1,D.value=""}const C=Ae(()=>{const t=f.device.status;return t==="active"?"bg-green-50 text-green-700 ring-1 ring-green-200":t==="inactive"?"bg-gray-50 text-gray-700 ring-1 ring-gray-200":"bg-rose-50 text-rose-700 ring-1 ring-rose-200"});function T(t){let e=[];return Array.isArray(t)?e=t:Array.isArray(t==null?void 0:t.data)?e=t.data:t!=null&&t.data&&typeof t.data=="object"?e=Object.values(t.data):t&&typeof t=="object"&&(e=Object.values(t)),e.map(i=>Array.isArray(i)?{userid:i[0]??"",name:i[1]??"",cardno:i[2]??"",uid:i[3]??"",role:i[4]??""}:{userid:i.userid??i.user_id??i.enroll??i.id??"",name:i.name??"",role:i.role??"",cardno:i.cardno??i.card??"",uid:i.uid??i.device_uid??""})}function I(t){if(!t)return"";const e=t.replace("T"," ");return e.length===16?`${e}:00`:e}function F(t,e){const i=URL.createObjectURL(t),h=document.createElement("a");h.href=i,h.download=e,h.click(),URL.revokeObjectURL(i)}const V=w(!1),M=w("");async function he(){var t;try{c("checking");const e=await a.ping(f.device.id);n("Connection Result","connection",e),r.success("Connection checked")}catch(e){n("Connection Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:(e==null?void 0:e.message)||"Failed"}),r.error((e==null?void 0:e.message)||"Connection check failed")}finally{m()}}async function Ce(){var t;try{c("loading info");const e=await a.info(f.device.id),i=(e==null?void 0:e.data)||e;n("Device Info","kv",i)}catch(e){n("Device Info — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Failed to load device info")}finally{m()}}async function De(){var t;try{c("enabling");const e=await a.enable(f.device.id);n("Enable Device","json",e),r[e.ok?"success":"error"](e.message||(e.ok?"Enabled":"Enable failed")),_("refresh")}catch(e){n("Enable Device — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Enable failed")}finally{m()}}async function Ee(){var t;try{c("disabling");const e=await a.disable(f.device.id);n("Disable Device","json",e),r[e.ok?"success":"error"](e.message||(e.ok?"Disabled":"Disable failed")),_("refresh")}catch(e){n("Disable Device — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Disable failed")}finally{m()}}async function je(){var t;try{c("restarting");const e=await a.restart(f.device.id);n("Restart Device","json",e),r[e.ok?"success":"error"](e.message||(e.ok?"Restart sent":"Restart failed"))}catch(e){n("Restart Device — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Restart failed")}finally{m()}}async function Ue(){var t;try{c("shutting down");const e=await a.shutdown(f.device.id);n("Shutdown Device","json",e),r[e.ok?"success":"error"](e.message||(e.ok?"Shutdown sent":"Shutdown failed"))}catch(e){n("Shutdown Device — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Shutdown failed")}finally{m()}}async function $e(){var t;try{c("testing voice");const e=await a.testVoice(f.device.id);n("Test Voice","json",e),r[e.ok?"success":"error"](e.message||(e.ok?"Voice test sent":"Voice test failed"))}catch(e){n("Test Voice — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Voice test failed")}finally{m()}}async function Se(){var t;try{const e=I(M.value);if(!e)return r.error("Pick a date & time first");c("setting time");const i=await a.setTime(f.device.id,{datetime:e});n("Set Device Time","json",i),r[i.ok?"success":"error"](i.message||(i.ok?"Time set":"Failed to set time")),V.value=!1}catch(e){n("Set Device Time — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Failed to set time")}finally{m()}}async function Ve(){var t;try{c("users-live");const e=await a.usersLive(f.device.id),i=T(e);n(`Live Users (${i.length})`,"users",i)}catch(e){n("Live Users — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Failed to load users")}finally{m()}}async function Te(){var t;try{c("diff users");const e=await a.usersDiff(f.device.id,{include_inactive:!1});n("Users Diff","diff",e)}catch(e){n("Users Diff — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Failed to diff users")}finally{m()}}async function Ie(t){var i,h;const e=(i=t.target.files)==null?void 0:i[0];if(e)try{c("importing users");const g=await a.importUsers(f.device.id,e,{pushNow:!0});n("Import Users","json",g),r.success(`Imported: ${g.imported_users??0}`)}catch(g){n("Import Users — Error","json",((h=g==null?void 0:g.response)==null?void 0:h.data)||{message:g==null?void 0:g.message}),r.error((g==null?void 0:g.message)||"Import failed")}finally{t.target.value="",m()}}async function Le(){var t;try{c("exporting users");const e=await a.exportUsers(f.device.id),i=`device_${f.device.id}_users.csv`;F(e,i),n("Export Users","json",{ok:!0,message:`CSV downloaded as ${i}`}),r.success("Exported users CSV")}catch(e){n("Export Users — Error","json",((t=e==null?void 0:e.response)==null?void 0:t.data)||{message:e==null?void 0:e.message}),r.error((e==null?void 0:e.message)||"Export failed")}finally{m()}}function Me(){_("edit",f.device)}function Re(){_("delete",f.device)}return(t,e)=>{var i,h,g,N,O,P,q,B,z,G,H,Q,W,J,K,X,Y,Z,ee,se,te,le,ae,oe,ie,ne,re,de,ue,ce,me,pe,ve,fe,be,ge,ye;return u(),v("div",Qe,[s("div",We,[s("div",Je,[s("div",Ke,[e[4]||(e[4]=s("div",{class:"h-9 w-9 grid place-items-center rounded-lg bg-white/10"},[s("i",{class:"fas fa-microchip text-white/90"})],-1)),s("div",null,[s("div",Xe,o(k.device.name),1),s("div",Ye,o(k.device.ip_address)+" : "+o(k.device.port),1)])]),s("span",{class:xe(["text-[11px] px-2 py-0.5 rounded-full font-medium",C.value])},o(k.device.status),3)])]),b.value?(u(),v("div",Ze,[s("div",es,[e[5]||(e[5]=s("i",{class:"fas fa-circle-notch fa-spin"},null,-1)),s("span",ss,o(D.value),1)])])):E("",!0),s("div",ts,[s("div",ls,[s("button",{class:"btn-tile",disabled:b.value,onClick:he},e[6]||(e[6]=[s("i",{class:"fas fa-plug"},null,-1),s("span",null,"Check",-1)]),8,as),s("button",{class:"btn-tile",disabled:b.value,onClick:Ce},e[7]||(e[7]=[s("i",{class:"fas fa-info-circle"},null,-1),s("span",null,"Info",-1)]),8,os),s("button",{class:"btn-tile text-emerald-700 ring-emerald-200 bg-emerald-50",disabled:b.value,onClick:De},e[8]||(e[8]=[s("i",{class:"fas fa-toggle-on"},null,-1),s("span",null,"Enable",-1)]),8,is),s("button",{class:"btn-tile text-amber-700 ring-amber-200 bg-amber-50",disabled:b.value,onClick:Ee},e[9]||(e[9]=[s("i",{class:"fas fa-toggle-off"},null,-1),s("span",null,"Disable",-1)]),8,ns),s("button",{class:"btn-tile text-indigo-700 ring-indigo-200 bg-indigo-50",disabled:b.value,onClick:je},e[10]||(e[10]=[s("i",{class:"fas fa-undo"},null,-1),s("span",null,"Restart",-1)]),8,rs),s("button",{class:"btn-tile text-rose-700 ring-rose-200 bg-rose-50",disabled:b.value,onClick:Ue},e[11]||(e[11]=[s("i",{class:"fas fa-power-off"},null,-1),s("span",null,"Shutdown",-1)]),8,ds),s("button",{class:"btn-tile text-purple-700 ring-purple-200 bg-purple-50",disabled:b.value,onClick:$e},e[12]||(e[12]=[s("i",{class:"fas fa-volume-up"},null,-1),s("span",null,"Test Voice",-1)]),8,us),s("button",{class:"btn-tile",disabled:b.value,onClick:e[0]||(e[0]=p=>V.value=!0)},e[13]||(e[13]=[s("i",{class:"far fa-clock"},null,-1),s("span",null,"Set Time",-1)]),8,cs),s("button",{class:"btn-tile",disabled:b.value,onClick:Ve},e[14]||(e[14]=[s("i",{class:"fas fa-users"},null,-1),s("span",null,"Users (Live)",-1)]),8,ms),s("button",{class:"btn-tile",disabled:b.value,onClick:Te},e[15]||(e[15]=[s("i",{class:"fas fa-code-branch"},null,-1),s("span",null,"Users Diff",-1)]),8,ps),s("label",vs,[e[16]||(e[16]=s("i",{class:"fas fa-file-import"},null,-1)),e[17]||(e[17]=s("span",null,"Import CSV",-1)),s("input",{type:"file",accept:".csv,text/csv",class:"hidden",onChange:Ie},null,32)]),s("button",{class:"btn-tile",disabled:b.value,onClick:Le},e[18]||(e[18]=[s("i",{class:"fas fa-file-export"},null,-1),s("span",null,"Export CSV",-1)]),8,fs),s("button",{class:"btn-tile col-span-2 sm:col-span-1 text-blue-700 ring-blue-200 bg-blue-50",onClick:Me},e[19]||(e[19]=[s("i",{class:"fas fa-edit"},null,-1),s("span",null,"Edit",-1)])),s("button",{class:"btn-tile col-span-2 sm:col-span-1 text-rose-700 ring-rose-200 bg-rose-50",disabled:b.value,onClick:Re},e[20]||(e[20]=[s("i",{class:"fas fa-trash"},null,-1),s("span",null,"Delete",-1)]),8,bs)])]),V.value?(u(),v("div",gs,[s("div",ys,[s("div",xs,[e[22]||(e[22]=s("div",{class:"font-semibold"},"Set Device Time",-1)),s("button",{class:"text-slate-500 hover:text-slate-800",onClick:e[1]||(e[1]=p=>V.value=!1)},e[21]||(e[21]=[s("i",{class:"fas fa-times"},null,-1)]))]),s("div",_s,[e[23]||(e[23]=s("label",{class:"text-sm text-slate-600"},"Pick date & time",-1)),j(s("input",{type:"datetime-local","onUpdate:modelValue":e[2]||(e[2]=p=>M.value=p),class:"w-full border rounded px-3 py-2 text-sm"},null,512),[[$,M.value]]),s("div",ws,[s("button",{class:"px-3 py-1.5 text-sm rounded border",onClick:e[3]||(e[3]=p=>V.value=!1)}," Cancel "),s("button",{class:"px-3 py-1.5 text-sm rounded bg-slate-900 text-white",disabled:b.value,onClick:Se}," Apply ",8,ks)])])])])):E("",!0),l.value.open?(u(),v("div",hs,[s("div",Cs,[s("div",Ds,[s("div",Es,o(l.value.title),1),s("button",{class:"text-slate-500 hover:text-slate-800",onClick:d},e[24]||(e[24]=[s("i",{class:"fas fa-times"},null,-1)]))]),s("div",js,[l.value.view==="connection"?(u(),v("div",Us,[s("div",$s,[s("div",Ss,[e[25]||(e[25]=s("b",null,"Device:",-1)),y(" "+o((i=l.value.data)==null?void 0:i.device_name)+" (ID: "+o((h=l.value.data)==null?void 0:h.device_id)+") ",1)]),s("span",{class:xe(["px-2 py-0.5 rounded-full text-[12px] font-medium",((g=l.value.data)==null?void 0:g.success)??((N=l.value.data)==null?void 0:N.online)?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":"bg-rose-50 text-rose-700 ring-1 ring-rose-200"])},o(((O=l.value.data)==null?void 0:O.success)??((P=l.value.data)==null?void 0:P.online)?"Online":"Offline"),3)]),s("div",Vs,[s("div",null,[e[26]||(e[26]=s("b",null,"Method:",-1)),y(" "+o(((q=l.value.data)==null?void 0:q.method)||"-"),1)]),s("div",null,[e[27]||(e[27]=s("b",null,"Latency:",-1)),y(" "+o((B=l.value.data)!=null&&B.latency_ms?l.value.data.latency_ms+" ms":"-"),1)]),s("div",Ts,[e[28]||(e[28]=s("b",null,"IP:Port:",-1)),y(" "+o((z=l.value.data)==null?void 0:z.ip_address)+" : "+o((G=l.value.data)==null?void 0:G.port),1)])]),((H=l.value.data)==null?void 0:H.success)??((Q=l.value.data)==null?void 0:Q.online)?E("",!0):(u(),v("div",Is,[e[31]||(e[31]=s("div",{class:"text-[12px] text-slate-600 font-medium mb-1"},"Errors",-1)),s("div",Ls,[s("table",Ms,[e[30]||(e[30]=s("thead",{class:"text-left sticky top-0 bg-white"},[s("tr",null,[s("th",{class:"pr-2 py-1 border-b"},"Mode"),s("th",{class:"pr-2 py-1 border-b"},"Error"),s("th",{class:"py-1 border-b"},"Latency")])],-1)),s("tbody",null,[(u(!0),v(U,null,S(((W=l.value.data)==null?void 0:W.errors)||[],(p,R)=>(u(),v("tr",{key:R,class:"border-b"},[s("td",Rs,o(p.mode),1),s("td",As,o(p.error),1),s("td",Fs,o(p.latency_ms?p.latency_ms+" ms":"-"),1)]))),128)),(((J=l.value.data)==null?void 0:J.errors)||[]).length?E("",!0):(u(),v("tr",Ns,e[29]||(e[29]=[s("td",{class:"py-2 text-slate-500 text-center",colspan:"3"},"No error details",-1)])))])])])]))])):l.value.view==="kv"?(u(),v("div",Os,[s("div",null,[e[32]||(e[32]=s("b",null,"Name:",-1)),y(" "+o((K=l.value.data)==null?void 0:K.device_name),1)]),s("div",null,[e[33]||(e[33]=s("b",null,"Version:",-1)),y(" "+o((X=l.value.data)==null?void 0:X.version),1)]),s("div",null,[e[34]||(e[34]=s("b",null,"OS:",-1)),y(" "+o((Y=l.value.data)==null?void 0:Y.os_version),1)]),s("div",null,[e[35]||(e[35]=s("b",null,"Platform:",-1)),y(" "+o((Z=l.value.data)==null?void 0:Z.platform),1)]),s("div",null,[e[36]||(e[36]=s("b",null,"FM:",-1)),y(" "+o((ee=l.value.data)==null?void 0:ee.fm_version),1)]),s("div",null,[e[37]||(e[37]=s("b",null,"Serial:",-1)),y(" "+o((se=l.value.data)==null?void 0:se.serial),1)]),s("div",null,[e[38]||(e[38]=s("b",null,"Pin Width:",-1)),y(" "+o((te=l.value.data)==null?void 0:te.pin_width),1)]),s("div",null,[e[39]||(e[39]=s("b",null,"Time:",-1)),y(" "+o((le=l.value.data)==null?void 0:le.time),1)]),s("div",Ps,[e[40]||(e[40]=s("b",null,"IP:Port:",-1)),y(" "+o((ae=l.value.data)==null?void 0:ae.ip)+" : "+o((oe=l.value.data)==null?void 0:oe.port),1)])])):l.value.view==="users"?(u(),v("div",qs,[s("div",Bs," Total: "+o((l.value.data||[]).length),1),s("div",zs,[s("table",Gs,[e[41]||(e[41]=s("thead",{class:"text-left sticky top-0 bg-white"},[s("tr",null,[s("th",{class:"pr-2 py-1 border-b"},"UserID"),s("th",{class:"pr-2 py-1 border-b"},"Name"),s("th",{class:"pr-2 py-1 border-b"},"Role"),s("th",{class:"pr-2 py-1 border-b"},"Card"),s("th",{class:"py-1 border-b"},"UID")])],-1)),s("tbody",null,[(u(!0),v(U,null,S(l.value.data,(p,R)=>(u(),v("tr",{key:p.userid||R,class:"border-b"},[s("td",Hs,o(p.userid),1),s("td",Qs,o(p.name),1),s("td",Ws,o(p.role),1),s("td",Js,o(p.cardno),1),s("td",Ks,o(p.uid),1)]))),128))])])])])):l.value.view==="diff"?(u(),v("div",Xs,[s("div",Ys,[s("span",Zs,"Device: "+o((ne=(ie=l.value.data)==null?void 0:ie.summary)==null?void 0:ne.device_total),1),s("span",et,"Central: "+o((de=(re=l.value.data)==null?void 0:re.summary)==null?void 0:de.central_total),1),s("span",st,"Create: "+o((ce=(ue=l.value.data)==null?void 0:ue.summary)==null?void 0:ce.create),1),s("span",tt,"Update: "+o((pe=(me=l.value.data)==null?void 0:me.summary)==null?void 0:pe.update),1),s("span",lt,"Remove: "+o((fe=(ve=l.value.data)==null?void 0:ve.summary)==null?void 0:fe.remove),1)]),s("details",null,[e[42]||(e[42]=s("summary",{class:"cursor-pointer font-medium"},"Create",-1)),s("ul",at,[(u(!0),v(U,null,S(((be=l.value.data)==null?void 0:be.create)||[],p=>(u(),v("li",{key:`c-${p.userid}`},o(p.userid)+" — "+o(p.name),1))),128))])]),s("details",null,[e[43]||(e[43]=s("summary",{class:"cursor-pointer font-medium"},"Update",-1)),s("ul",ot,[(u(!0),v(U,null,S(((ge=l.value.data)==null?void 0:ge.update)||[],p=>(u(),v("li",{key:`u-${p.userid}`},o(p.userid),1))),128))])]),s("details",null,[e[44]||(e[44]=s("summary",{class:"cursor-pointer font-medium"},"Remove",-1)),s("ul",it,[(u(!0),v(U,null,S(((ye=l.value.data)==null?void 0:ye.remove)||[],p=>(u(),v("li",{key:`r-${p.userid}`},o(p.userid),1))),128))])])])):E("",!0)]),s("div",{class:"flex justify-end gap-2 px-4 py-3 border-t"},[s("button",{class:"px-3 py-1.5 text-sm rounded bg-slate-900 text-white",onClick:d}," Close ")])])])):E("",!0)])}}},rt=Be(nt,[["__scopeId","data-v-e1e6bf44"]]),dt={key:0,class:"modal-bg"},ut={class:"modal-card"},ct={class:"text-lg font-semibold mb-4"},mt={class:"mb-4"},pt={class:"mb-4"},vt={class:"mb-4"},ft={class:"mb-4"},bt={class:"mb-4"},gt={class:"mb-4"},yt={class:"flex justify-end"},xt={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},_t={__name:"DeviceModal",props:{show:{type:Boolean,required:!0},device:{type:Object,default:null}},emits:["close","save"],setup(k,{emit:x}){const f=k,_=x,r=w(!1),a=Fe({id:null,name:"",ip_address:"",port:"",serial_number:"",firmware:"",status:"active"}),b=()=>{r.value=!1,a.id=null,a.name="",a.ip_address="",a.port="",a.serial_number="",a.firmware="",a.status="active"};Ne(()=>f.device,n=>{n&&typeof n=="object"&&Object.keys(n).length>0?(r.value=!0,a.id=n.id||null,a.name=n.name||"",a.ip_address=n.ip_address||"",a.port=n.port||"",a.serial_number=n.serial_number||"",a.firmware=n.firmware||"",a.status=n.status||"active"):b()},{immediate:!0,deep:!0});const D=()=>{_("save",{...a}),l()},l=()=>{_("close")};return(n,d)=>k.show?(u(),v("div",dt,[s("div",ut,[s("h2",ct,o(r.value?"Edit Device":"Add Device"),1),s("form",{onSubmit:Oe(D,["prevent"])},[s("div",mt,[d[6]||(d[6]=s("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),j(s("input",{id:"name","onUpdate:modelValue":d[0]||(d[0]=c=>a.name=c),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter device name",required:""},null,512),[[$,a.name]])]),s("div",pt,[d[7]||(d[7]=s("label",{for:"ip_address",class:"block text-sm font-medium mb-2"},"IP Address",-1)),j(s("input",{id:"ip_address","onUpdate:modelValue":d[1]||(d[1]=c=>a.ip_address=c),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter IP address",required:""},null,512),[[$,a.ip_address]])]),s("div",vt,[d[8]||(d[8]=s("label",{for:"port",class:"block text-sm font-medium mb-2"},"Port",-1)),j(s("input",{id:"port","onUpdate:modelValue":d[2]||(d[2]=c=>a.port=c),type:"number",class:"w-full border rounded px-3 py-2",placeholder:"Enter port",required:""},null,512),[[$,a.port]])]),s("div",ft,[d[9]||(d[9]=s("label",{for:"serial_number",class:"block text-sm font-medium mb-2"},"Serial Number",-1)),j(s("input",{id:"serial_number","onUpdate:modelValue":d[3]||(d[3]=c=>a.serial_number=c),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter serial number (optional)"},null,512),[[$,a.serial_number]])]),s("div",bt,[d[10]||(d[10]=s("label",{for:"firmware",class:"block text-sm font-medium mb-2"},"Firmware",-1)),j(s("input",{id:"firmware","onUpdate:modelValue":d[4]||(d[4]=c=>a.firmware=c),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter firmware version (optional)"},null,512),[[$,a.firmware]])]),s("div",gt,[d[12]||(d[12]=s("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),j(s("select",{id:"status","onUpdate:modelValue":d[5]||(d[5]=c=>a.status=c),class:"w-full border rounded px-3 py-2",required:""},d[11]||(d[11]=[s("option",{value:"active"},"Active",-1),s("option",{value:"inactive"},"Inactive",-1),s("option",{value:"error"},"Error",-1)]),512),[[Pe,a.status]])]),s("div",yt,[s("button",{type:"button",onClick:l,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),s("button",xt,o(r.value?"Update":"Create"),1)])],32)])])):E("",!0)}},wt={class:"my-container space-y-2"},kt={key:1},ht={key:0,class:"grid gap-4 md:grid-cols-2"},Ct={key:1,class:"text-center text-red-500 py-8"},Vt={__name:"DeviceList",setup(k){const x=ke(),f=we(),_=w(!1),r=w(null),a=w(!1),b=w(null);qe(async()=>{await x.fetchDevices()});function D(){r.value=null,_.value=!0}function l(m){r.value=m,_.value=!0}function n(){_.value=!1}async function d(m){try{m.id?(await x.updateDevice(m.id,m),f.success("Device updated")):(await x.createDevice(m),f.success("Device added")),await x.fetchDevices()}catch(C){f.error((C==null?void 0:C.message)||"Save failed")}finally{n()}}function c(m){b.value=m,a.value=!0}return(m,C)=>{var T;return u(),v(U,null,[s("div",wt,[A(Ge,{title:"Device List",onAdd:D}),L(x).loading?(u(),_e(He,{key:0})):(u(),v("div",kt,[(T=L(x).devices)!=null&&T.length?(u(),v("div",ht,[(u(!0),v(U,null,S(L(x).devices,I=>(u(),_e(rt,{key:I.id,device:I,onEdit:l,onDelete:c,onRefresh:C[0]||(C[0]=F=>L(x).fetchDevices())},null,8,["device"]))),128))])):(u(),v("div",Ct,"No devices found"))]))]),A(_t,{show:_.value,device:r.value,onClose:n,onSave:d},null,8,["show","device"]),A(ze,{show:a.value,title:m.confirmTitle,message:m.confirmMessage,onClose:m.closeConfirmModal,onConfirm:m.handleConfirm},null,8,["show","title","message","onClose","onConfirm"])],64)}}};export{Vt as default};
