import{L as G}from"./LoaderView-GhfkLam1.js";import{O as P}from"./OverlyModal-B9fxe26k.js";import{_ as K}from"./DepartmentChip-B6dTBDQQ.js";import{_ as ee}from"./TaskAddForm-CrrQz864.js";import{_ as te}from"./TaskEditForm-CA3A2DSU.js";import{_ as se}from"./TaskHeader-DpMmEnZM.js";import{_ as re}from"./TaskUserAssignForm-Lzqh1qgT.js";import{m as S,c as a,o,g as l,a as e,F as $,y as A,x as E,t as v,p as y,j as U,k as f,f as w,w as J,b as oe,u as ie,r as L,z as Q,e as ae,A as ne,i as F,I as le}from"./index-CgNX-fih.js";import{u as de}from"./task-priority-DUD5HV8N.js";import{u as ue}from"./useRequirementStore-liuJ7wEa.js";import{u as ce}from"./useTaskStore-CbABIZQb.js";import{_ as me,T as pe,a as ye,b as fe}from"./TaskUrgentBadge-D-CJ-a7_.js";import{_ as ge}from"./TaskAssignedUsers-BkmvRiHS.js";import{T as xe}from"./TaskIsClosedBadge-BBO_Gx0w.js";import{_ as _e}from"./TaskStatus-utHtETXm.js";import{d as ke,b as ve}from"./datetime-DcVwRp76.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-BkW3gBNE.js";import"./company-MWDHzsbN.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-DMMB8STQ.js";import"./SelectDropdown-HPJaYBPU.js";import"./SectionLoading-DYdioZ2O.js";import"./TextWithHr-BpEYBkLn.js";import"./TaskUrgencyInput-CAB3IY8_.js";import"./tags-Df-1TpLS.js";import"./MultiselectDropdown-1bhmTNE_.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-OGV3k1fV.js";import"./task-R6FQordU.js";import"./EmployeeDropdownInput-CBd-F32O.js";import"./UserChip-BsQZaWiB.js";import"./SearchInput-CrKr4xgm.js";import"./user-qv-Kousv.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-DGRL5ne8.js";import"./TaskUserChip-ByRq6HA3.js";import"./requirement-BG8AAHtt.js";const be={class:"w-full p-1"},he={key:0,class:"w-full"},we={key:0,class:""},Te={class:"line-clamp-1"},Ce={class:"border text-center py-2 px-1 border-gray-200"},$e={key:0,class:"text-base font-semibold text-purple-600"},Ie={class:"border px-3 py-1 border-gray-200 relative"},qe={class:"flex items-center justify-between gap-2"},Le={class:"flex items-center gap-3"},Ae={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Me={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},Be={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},De={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},ze={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},Se=["href","onClick"],Ee={class:"border px-3 py-1 border-gray-200"},Oe={class:"flex gap-2 justify-between items-center relative w-full"},Pe={class:"shrink-0"},Ue=["href","onClick"],Fe={class:"border px-3 py-1 border-gray-200 text-center"},Ve={key:0,class:"ml-4 text-gray-500 text-sm"},je={class:"text-blue-500 font-semibold whitespace-nowrap"},Ne={class:"border px-3 border-gray-200 sticky right-0 border-l bg-sky-50"},Re={class:"flex justify-end flex-wrap gap-2 py-2"},W={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick"],setup(T,{emit:g}){const M=T,x=S(()=>M.tasks.reduce((p,r)=>{var t;const _=((t=r.requirement_detail)==null?void 0:t.id)||"-",d=[...p],u=d.find(b=>(b==null?void 0:b.key)==_);return u?u.tasks=[...u.tasks,r]:d.push({key:_,position:r!=null&&r.requirement_detail?0:1,...(r==null?void 0:r.requirement_detail)||{title:"(Other tasks)",id:0},tasks:[r]}),d},[]).sort((p,r)=>p.position-r.position)),B=g;return(p,r)=>{var _;return o(),a("div",be,[((_=T.tasks)==null?void 0:_.length)>0?(o(),a("table",he,[r[5]||(r[5]=e("thead",null,[e("tr",null,[e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(o(!0),a($,null,A(x.value,(d,u)=>(o(),a($,{key:d.id},[x.value.length>1?(o(),a("tr",we,[e("th",{colspan:"10",class:E(["font-semibold border",[(u>0,"")]])},[e("div",{class:E(["text-left pt-4 pb-1 px-2",[d.id===0?"text-gray-500":"text-sky-800"]])},[e("div",Te,v(d==null?void 0:d.title),1)],2)],2)])):l("",!0),(o(!0),a($,null,A(d.tasks,(t,b)=>{var D,I;return o(),a("tr",{key:t.id,class:E(["group/sub-task-row",{" bg-green-400/20":t.status=="COMPLETED"," bg-white hover:bg-slate-50":t.status!=="COMPLETED"}])},[e("td",Ce,[b!==void 0?(o(),a("div",$e,v(b+1)+". ",1)):l("",!0)]),e("td",Ie,[e("div",qe,[e("div",null,[e("div",Le,[y(me,{titleClass:"text-sm",task:t,"sub-tasks-open":!1,isMyTask:T.isMyTask,to:T.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",Ae,[e("div",Me,[r[0]||(r[0]=e("i",{class:"fas fa-clock"},null,-1)),U(" "+v(f(ke)(t.created_at)),1)]),e("div",Be,[t!=null&&t.is_important?(o(),w(pe,{key:0})):l("",!0),t!=null&&t.is_urgent?(o(),w(ye,{key:1})):l("",!0)]),e("div",De,[r[1]||(r[1]=e("i",{class:"fas fa-tasks"},null,-1)),U(" "+v(t==null?void 0:t.todos_count),1)]),e("div",ze,[r[2]||(r[2]=e("i",{class:"fas fa-book"},null,-1)),U(" "+v((D=t==null?void 0:t.requirement_detail)==null?void 0:D.id),1)])])]),!t.is_closed&&!T.hideButtons?(o(),a("a",{key:0,href:`/tasks/edit/${t.id}`,onClick:J(q=>B("editClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},r[3]||(r[3]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Se)):l("",!0)])]),e("td",Ee,[e("div",Oe,[y(ge,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:t.users||[],isTargetTask:t.is_target,maxItem:1,"route-to":q=>`/tasks?status=not-completed&view=userwise&user-ids=${q.id}`},null,8,["users","isTargetTask","route-to"]),e("div",Pe,[!t.is_closed&&!T.hideButtons?(o(),a("a",{key:0,href:`/tasks/${t.id}/assign-users`,onClick:J(q=>B("employeeAssignClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},r[4]||(r[4]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,Ue)):l("",!0)])])]),e("td",Fe,[t.deadline?(o(),a("span",Ve,[e("span",je,v(f(ve)(t.deadline)),1)])):l("",!0)]),e("td",Ne,[e("div",Re,[t.closed_at?(o(),w(xe,{key:0})):l("",!0),y(_e,{status:t==null?void 0:t.status,progressPercent:(t==null?void 0:t.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((I=t==null?void 0:t.children_tasks)==null?void 0:I.length)>0?(o(),w(fe,{key:1,ref_for:!0,ref:"progress",task:t,class:"text-sm w-full"},null,8,["task"])):l("",!0)])])],2)}),128))],64))),128))])])):l("",!0)])}}},He={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},Ke={class:"mb-4"},Je={key:4,class:"text-center py-4 text-red-500"},Qe={class:"relative min-h-[20vh]"},We={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},Xe={class:"font-semibold flex items-center gap-2"},Ye={class:"text-white text-base"},Ze={class:"rounded-b-md overflow-y-auto"},Ge={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},et={class:"font-semibold flex items-center gap-2"},tt={class:"rounded-b-md overflow-y-auto"},st={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},Ut={__name:"RequirementTaskList",setup(T){const g=ce(),M=ue(),x=oe(),B=ie(),p=L(""),r=L(null),_=L(!1),d=Q({parentId:0,requirementId:0}),u=Q({taskId:0,isOpen:!1}),t=S(()=>{const n=x.query["user-ids"]||null,s=(g.tasks||[]).flatMap(c=>{var k;return n?(k=c.users)==null?void 0:k.filter(z=>n.includes(z.id)):c.users});return[...new Map(s.map(c=>[c.id,c])).values()].sort((c,k)=>c.id-k.id)}),b=S(()=>(g.tasks||[]).reduce((n,s)=>{const h=`${s.from_department_id}-${s.to_department_id}`,c=n.find(k=>k.key==h);return c?c.tasks=[...c.tasks,s]:n.push({key:h,from_department:s.from_department,to_department:s.to_department,tasks:[s]}),n},[])),D=L(null),I=L([]),{saveTaskPriority:q,listHasRearranged:V}=de(()=>g.taskListTree,0);ae(()=>{console.log("Task List Mounted"),p.value="loading",C()});async function C(){await g.fetchAllTasks({...x.query,page:1}),p.value="",I.value=[]}const O=n=>{_.value=!0,d.parentId=n},j=n=>{u.taskId=n,u.isOpen=!0};async function N(){r.value=null,_.value=!1,d.parentId=0,p.value="loading",await C()}async function X(){_.value=!1,d.parentId=0,await C()}async function Y(){p.value="loading",await q()&&await C()}function Z(n){return g.tasks.filter(s=>(s.users||[]).some(h=>h.id===n))}ne(()=>({...x.query}),async()=>{try{g.resetTaskList(),p.value="loading",await C()}catch(n){console.warn(n)}});const R=S({get(){return{...x.query}},set(n){localStorage.removeItem("sub_task_opened_list"),B.push({query:{...n}})}});return(n,s)=>{var h,c,k,z,H;return o(),a("div",He,[r.value?(o(),w(P,{key:0},{default:F(()=>[y(te,{taskId:r.value,onClose:s[0]||(s[0]=m=>r.value=null),onUpdated:N},null,8,["taskId"])]),_:1})):l("",!0),_.value?(o(),w(P,{key:1},{default:F(()=>[y(ee,{parentTaskId:d.parentId,requirementId:d.requirementId,onClose:X,onTaskCreated:N},null,8,["parentTaskId","requirementId"])]),_:1})):l("",!0),u.isOpen?(o(),w(P,{key:2,class:"*:max-w-4xl"},{default:F(()=>[y(re,{taskId:u.taskId,onCancelClick:s[1]||(s[1]=()=>{u.isOpen=!1,u.taskId=0}),onSuccess:s[2]||(s[2]=()=>{u.isOpen=!1,u.taskId=0,p.value="loading",C()})},null,8,["taskId"])]),_:1})):l("",!0),y(se,{modelValue:R.value,"onUpdate:modelValue":s[3]||(s[3]=m=>R.value=m),onClickAddTask:O,onClickPrioritySave:Y,onClickPriorityDiscard:s[4]||(s[4]=()=>f(V)?D.value.resetItems:null),"list-has-rearranged":f(V),isMyTask:f(x).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((c=(h=f(x))==null?void 0:h.query)==null?void 0:c["query-log"])=="true"?(o(!0),a($,{key:3},A(I.value,(m,i)=>(o(),a("div",{key:i,class:"text-xs text-gray-500"},[e("div",Ke,v(m.raw_query),1)]))),128)):l("",!0),f(M).error?(o(),a("div",Je,v(f(M).error),1)):l("",!0),e("div",Qe,[((k=f(x).query)==null?void 0:k.view)==="userwise"?(o(!0),a($,{key:0},A(t.value,m=>(o(),a("div",{key:m.id,class:"mt-8 rounded-md border-2 border-sky-300"},[e("div",We,[e("div",Xe,[y(le,{user:m},null,8,["user"]),e("div",Ye,v(m.label),1)])]),e("div",Ze,[y(W,{tasks:Z(m.id),onEditClick:s[5]||(s[5]=i=>r.value=i),onAddClick:s[6]||(s[6]=i=>O(i)),onEmployeeAssignClick:s[7]||(s[7]=i=>j(i)),taskLinkTo:i=>({name:"RequirementTaskShow",params:{id:(i==null?void 0:i.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128)):(o(!0),a($,{key:1},A(b.value,m=>(o(),a("div",{key:m.key,class:"mt-8 rounded-md border-2 border-sky-300"},[e("div",Ge,[e("div",et,[s[11]||(s[11]=e("span",{class:"text-white text-sm"},"From",-1)),y(K,{department:m.from_department},null,8,["department"]),s[12]||(s[12]=e("span",{class:"text-white text-sm"},"To",-1)),y(K,{department:m.to_department},null,8,["department"])])]),e("div",tt,[y(W,{tasks:m.tasks,groupBy:"requirement_details",onEditClick:s[8]||(s[8]=i=>r.value=i),onAddClick:s[9]||(s[9]=i=>O(i)),onEmployeeAssignClick:s[10]||(s[10]=i=>j(i)),taskLinkTo:i=>({name:"RequirementTaskShow",params:{id:(i==null?void 0:i.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128)),p.value!=="loading"&&((z=f(g).tasks)==null?void 0:z.length)===0?(o(),a("div",st," No tasks ")):l("",!0),p.value==="loading"?(o(),w(G,{key:3,class:E(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((H=f(g).tasks)==null?void 0:H.length)===0?"justify-center":""]])},null,8,["class"])):l("",!0)])])}}};export{Ut as default};
