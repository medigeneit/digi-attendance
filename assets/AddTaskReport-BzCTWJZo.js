import{b as G,d as P,r as d,u as Y,e as $,q as A,A as j,k as q,c as u,o as i,a as s,t as b,h as _,n as r,w as K,g,l as x,C as L,F as R,x as N,v as M,p as H}from"./index-CDEsTfJ1.js";import{R as S}from"./RequiredIcon-DA6zBTvW.js";import{u as z}from"./useTaskReportStore-Dug_9-OD.js";import{u as J}from"./useTaskStore-BFAbfBnq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"mt-6"},W={class:"max-w-xl w-full mx-auto bg-white border p-4 rounded-md shadow"},X={class:"col-span-full text-red-800 font-semibold"},Z={key:0,class:"w-full flex items-center justify-center h-40 text-red-500 text-xl text-center"},tt={key:0,class:"col-span-full"},st={class:"font-semibold"},et={key:1,class:"col-span-full"},ot={class:"block text-gray-600 text-sm mb-1 font-medium"},lt=["value"],at={class:"col-span-full"},nt={class:"col-span-2"},rt={class:"block text-gray-600 text-sm mb-1 font-medium"},ut={class:"col-span-2"},it={for:"report_date",class:"block text-gray-600 text-sm mb-1 font-medium"},dt={class:"flex justify-between col-span-full"},bt={__name:"AddTaskReport",setup(pt){const V=G(),h=z(),a=J(),T=P(),y=V.params.id,f=d(""),D=d(0),k=d(O()),C=d(0),B=d(0),p=d(""),c=d(""),I=Y();$(async()=>{await a.fetchTask(y),a.task.children_task_count==0&&(c.value=a.task.status)});function E(o,t=[]){const n=[];for(const l of o){const v=[...t,l.title];l.children_tasks.length===0?l.users.some(e=>{var m;return e.id==((m=T.user)==null?void 0:m.id)})&&n.push({id:l.id,title:l.title,status:l.status,task_parents:t,user_ids:l.users.map(e=>e.id)}):n.push(...E(l.children_tasks,v))}return n}const w=A(()=>a.task.children_task_count>0?E(a.tasks):[]),F=async()=>{var n;const o=D.value*60+C.value,t={c_length:a.task.children_task_count,task_id:a.task.children_task_count>0?p.value:(n=a.task)==null?void 0:n.id,title:f.value,report_date:k.value,progress:B.value,status:c.value,duration:o};console.log({payload:t});try{const l=await h.createTaskReport(t);console.log("Submitted:",l.data),f.value="",k.value="",D.value=0,C.value=0,I.push({name:"TaskReports",params:{id:y}})}catch(l){console.error("Error submitting report:",l)}};function O(){const o=new Date;return`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`}j(()=>p.value,function(){const o=w.value.find(t=>t.id==p.value);console.log({selectedTask:o}),o&&(c.value=o.status)});const U=A(()=>{var o;return a.task.children_task_count>0&&w.value.length>0||a.task.children_task_count===0&&(((o=a.task)==null?void 0:o.users)||[]).some(t=>{var n;return t.id==((n=T.user)==null?void 0:n.id)})});return(o,t)=>{var l,v;const n=q("RouterLink");return i(),u("div",Q,[s("div",W,[s("div",X,b((l=_(h))==null?void 0:l.error),1),U.value?(i(),u("form",{key:1,onSubmit:K(F,["prevent"]),class:"grid gap-x-4 gap-y-6 grid-cols-4"},[t[15]||(t[15]=s("h2",{class:"text-2xl font-bold col-span-full border-b pb-1"},"Add Report",-1)),_(a).task.children_task_count===0?(i(),u("div",tt,[t[5]||(t[5]=r(" Add Report on ")),s("span",st,b((v=_(a).task)==null?void 0:v.title),1),t[6]||(t[6]=s("hr",{class:"mt-1"},null,-1))])):(i(),u("div",et,[s("label",ot,[t[7]||(t[7]=r(" Task ")),x(S)]),g(s("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e)},[t[8]||(t[8]=s("option",{value:""},"--select---",-1)),(i(!0),u(R,null,N(w.value,e=>(i(),u("option",{key:e.id,class:"w-full",value:e.id},[r(b(e.title)+" ",1),(i(!0),u(R,null,N(e.task_parents,m=>(i(),u(R,{key:m},[r(" â†µ "+b(m),1)],64))),128))],8,lt))),128))],512),[[L,p.value]])])),s("div",at,[t[9]||(t[9]=s("label",{for:"title",class:"block text-gray-600 text-sm mb-1 font-medium"},[r("Report "),s("span",{class:"text-gray-400"},"(optional)")],-1)),g(s("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),type:"text",class:"border rounded p-2 w-full",placeholder:"Enter report title"},null,512),[[M,f.value]])]),s("div",nt,[s("label",rt,[t[10]||(t[10]=r(" Status ")),x(S)]),g(s("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[2]||(t[2]=e=>c.value=e)},t[11]||(t[11]=[s("option",{value:""},"--select---",-1),s("option",null,"PENDING",-1),s("option",null,"IN_PROGRESS",-1),s("option",null,"COMPLETED",-1),s("option",null,"BLOCKED",-1),s("option",null,"CANCELLED",-1),s("option",null,"BACK_LOG",-1)]),512),[[L,c.value]])]),s("div",ut,[s("label",it,[t[12]||(t[12]=r(" Report Date ")),x(S)]),g(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>k.value=e),id:"report_date",type:"date",class:"border rounded p-2 w-full"},null,512),[[M,k.value]])]),t[16]||(t[16]=s("hr",{class:"col-span-full border-dashed"},null,-1)),s("div",dt,[t[14]||(t[14]=s("button",{type:"submit",class:"btn-2"},"Submit",-1)),x(n,{type:"submit",class:"btn-3",to:{name:"TaskReports",params:{id:_(y)}}},{default:H(()=>t[13]||(t[13]=[r("Cancel")])),_:1,__:[13]},8,["to"])])],32)):(i(),u("div",Z,t[4]||(t[4]=[r(" You Are Not Assigned to this task. "),s("br",null,null,-1),r("You cannot add a report. ")])))])])}}};export{bt as default};
