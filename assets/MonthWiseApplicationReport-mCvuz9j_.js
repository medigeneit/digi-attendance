import{b as ot,u as nt,r as h,A as E,m as N,e as it,c as n,o,a as l,f as dt,g as d,j as f,t as i,h as x,T as b,p as pt,v as G,x as v,F as _,y as rt}from"./index-DWJR6Q_F.js";import{u as ut}from"./leave-application-obWl4lgE.js";import{_ as ct}from"./EmployeeFilter-j5jtPgni.js";import{L as vt}from"./LoaderView-DNVHXELL.js";import{_ as _t}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-gp7cn4hL.js";import"./department-Bw8---bZ.js";import"./EmployeeDropdownInput-CyPd8ifN.js";import"./SelectDropdown-CDaXby98.js";import"./UserChip-BELT4agW.js";const mt={class:"px-3 space-y-4"},ht={class:"flex flex-wrap items-center gap-2"},xt={class:"min-w-[200px]"},yt={class:"text-[11px] text-slate-500 -mt-0.5"},ft={class:"hidden md:flex items-center gap-2 rounded-lg border bg-white p-1"},bt={class:"cols-chk"},gt={class:"cols-chk"},kt={class:"cols-chk"},wt={class:"cols-chk"},St={class:"cols-chk"},Lt={class:"flex flex-wrap items-end gap-3 rounded-lg border bg-white p-2"},At={class:"flex items-center gap-2 ml-auto"},Mt={class:"relative"},Tt={class:"flex items-center gap-1 text-[11px] text-slate-600"},Ot={class:"flex items-center gap-1 text-[11px] text-slate-600"},Rt={key:1,class:"p-2 rounded bg-red-50 text-red-700 text-[12px] border border-red-200"},qt={class:"w-full text-[12px] print:text-[11px] leading-tight"},Ct={key:0,span:"3",style:{width:"96px"}},Ut={key:1,span:"4",style:{width:"96px"}},Vt={key:2,span:"2",style:{width:"102px"}},Et={key:3,span:"2",style:{width:"96px"}},Nt={key:4,span:"1",style:{width:"96px"}},$t={class:"sticky top-0 z-20 bg-white/95 backdrop-blur"},jt={class:"*:px-2.5 *:py-1.5 *:text-center *:border-b *:border-slate-200 text-slate-700"},zt=["colspan"],Bt=["colspan"],It=["colspan"],Dt=["colspan"],Pt=["colspan"],Wt={class:"*:px-2.5 *:py-1 *:text-center *:border-b *:border-slate-200"},Ft={key:4,class:"th-col th-manual",title:"Manual Adjustments"},Ht={class:"divide-y divide-slate-100"},Jt={class:"px-2.5 text-left sticky left-0 z-20 bg-white"},Zt={class:"px-2.5 sticky left-[34px] z-20 bg-white"},Kt={class:"flex items-center gap-2"},Yt={class:"font-medium text-slate-800 truncate max-w-[180px]"},Gt={key:0,class:"text-[10px] text-slate-400"},Qt={key:0,class:"text-[10px] text-slate-500 -mt-0.5 truncate max-w-[200px]"},Xt={class:"text-center whitespace-nowrap"},te=["title"],ee={class:"text-center whitespace-nowrap"},le=["title"],se={class:"text-center"},ae={class:"text-center"},oe={class:"text-center"},ne={class:"text-center"},ie={class:"text-center font-medium"},de={class:"text-center"},pe={class:"text-center"},re={class:"text-center"},ue={class:"text-center"},ce={key:4,class:"text-center"},ve={class:"bg-gradient-to-r from-slate-100 to-slate-50 *:px-2.5 *:py-1.5 font-semibold border-t sticky bottom-0 z-10"},_e={class:"text-slate-700"},me={class:"text-center"},he={class:"text-center"},xe={class:"text-center"},ye={class:"text-center"},fe={class:"text-center"},be={class:"text-center"},ge={class:"text-center"},ke={class:"text-center"},we={class:"text-center"},Se={class:"text-center"},Le={class:"text-center"},Ae={key:4,class:"text-center"},Me={key:3,class:"text-center text-slate-500 py-8"},Q="monthly_application_cols_v2",Te={__name:"MonthWiseApplicationReport",setup(Oe){const g=ot(),$=nt(),X=ut(),S=h(!1),T=h(null),j=h([]),q=h(""),y=h(g.query.date||new Date().toISOString().slice(0,7)),u=h({company_id:g.query.company_id||"",department_id:g.query.department_id||"all",line_type:g.query.line_type||"all"}),C=h(""),O=h(!0),U=h(!1),a=h({ot:!0,leave:!0,ex:!1,sl:!0,manual:!0});try{const s=JSON.parse(localStorage.getItem(Q)||"{}");Object.assign(a.value,s)}catch{}E(a,s=>localStorage.setItem(Q,JSON.stringify(s)),{deep:!0});const r=s=>Number.isFinite(+s)?+s:0,z=s=>{const t=Number(s)||0,e=Math.floor(t),c=Math.round((t-e)*60);return`${e}h ${String(c).padStart(2,"0")}m`},R=s=>{const t=Number(s)||0,e=Math.floor(t),c=Math.round((t-e)*60);return`${e}:${String(c).padStart(2,"0")}`},tt=s=>!s||typeof s!="object"?{CL:0,ML:0,SL:0,WPL:0}:{CL:r(s.CL),ML:r(s.ML),SL:r(s.SL),WPL:r(s.WPL)},et=(s={})=>Object.values(s).some(t=>r(t)>0),lt=N(()=>(j.value||[]).map(s=>{var e,c,M,k,p,w,B,I,D,P,W,F,H,J,Z,K,Y;const t=tt((e=s==null?void 0:s.leave)==null?void 0:e.by_code);return{...s,_leaveBy:t,_cl:r(t.CL),_ml:r(t.ML),_sl:r(t.SL),_leaveTotal:r((c=s==null?void 0:s.leave)==null?void 0:c.total_days),_otReq:r((M=s==null?void 0:s.overtime)==null?void 0:M.requested_hours),_otAppr:r((k=s==null?void 0:s.overtime)==null?void 0:k.approved_hours),_otApps:r((p=s==null?void 0:s.overtime)==null?void 0:p.count),_exOff:r((B=(w=s==null?void 0:s.exchanges)==null?void 0:w.offday)==null?void 0:B.total),_exShift:r((D=(I=s==null?void 0:s.exchanges)==null?void 0:I.shift)==null?void 0:D.total),_slTotal:r((W=(P=s==null?void 0:s.short_leave)==null?void 0:P.totals)==null?void 0:W.count),_slMinutesApproved:r((H=(F=s==null?void 0:s.short_leave)==null?void 0:F.totals)==null?void 0:H.approved_minutes),_slMinutesPending:r((Z=(J=s==null?void 0:s.short_leave)==null?void 0:J.totals)==null?void 0:Z.pending_minutes),_slMinutes:r((Y=(K=s==null?void 0:s.short_leave)==null?void 0:K.totals)==null?void 0:Y.approved_minutes),_manual:r(s==null?void 0:s.manual_attendance)}})),L=N(()=>{const s=(C.value||"").toLowerCase().trim();let t=lt.value;return s&&(t=t.filter(e=>String(e.user_name||"").toLowerCase().includes(s)||String(e.employee_id||"").toLowerCase().includes(s)||String(e.designation||"").toLowerCase().includes(s))),U.value&&(t=t.filter(e=>{const c={_cl:e._cl,_ml:e._ml,_sl:e._sl,_leaveTotal:e._leaveTotal,_otReq:e._otReq,_otAppr:e._otAppr,_otApps:e._otApps,_exOff:e._exOff,_exShift:e._exShift,_slTotal:e._slTotal,_slMinutes:e._slMinutes,_manual:e._manual};return!et(c)})),t}),m=N(()=>{const s={cl:0,ml:0,sl:0,leaveTotal:0,otReq:0,otAppr:0,otApps:0,exOff:0,exShift:0,slTotal:0,slMinutes:0,manual:0};for(const t of L.value)s.cl+=t._cl,s.ml+=t._ml,s.sl+=t._sl,s.leaveTotal+=t._leaveTotal,s.otReq+=t._otReq,s.otAppr+=t._otAppr,s.otApps+=t._otApps,s.exOff+=t._exOff,s.exShift+=t._exShift,s.slTotal+=t._slTotal,s.slMinutes+=t._slMinutes,s.manual+=t._manual;return s}),A=s=>s==="ot"?a.value.ot?3:0:s==="leave"?a.value.leave?4:0:s==="ex"?a.value.ex?2:0:s==="sl"?a.value.sl?2:0:s==="manual"&&a.value.manual?1:0,V=async()=>{var s,t;S.value=!0,T.value=null;try{const e=await X.getMonthlyApplicationSummary({month:y.value,companyId:u.value.company_id||null,departmentId:!u.value.department_id||u.value.department_id==="all"?null:u.value.department_id,includeEmpty:!0}),c=Array.isArray(e==null?void 0:e.results)?e.results:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e)?e:[];j.value=c,q.value=(e==null?void 0:e.month)||y.value}catch(e){console.error(e),T.value=((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Failed to load monthly application summary."}finally{S.value=!1}};it(V),E(y,s=>{$.replace({query:{...g.query,date:s}}),V()}),E(()=>[u.value.company_id,u.value.department_id,u.value.line_type],()=>{$.replace({query:{...g.query,company_id:u.value.company_id||"",department_id:u.value.department_id||"all",line_type:u.value.line_type||"all"}}),V()});const st=()=>{const s=["#","Employee",...a.value.ot?["OT Req(h)","OT Appr(h)","OT Apps"]:[],...a.value.leave?["CL","ML","SL","Leave Total"]:[],...a.value.ex?["Offday Exch","Shift Exch"]:[],...a.value.sl?["SL Total","SL Minutes (Approved)"]:[],...a.value.manual?["Manual"]:[]],t=L.value.map((p,w)=>[w+1,`${p.user_name}${p.employee_id?` (#${p.employee_id})`:""}`,...a.value.ot?[p._otReq,p._otAppr,p._otApps]:[],...a.value.leave?[p._cl,p._ml,p._sl,p._leaveTotal]:[],...a.value.ex?[p._exOff,p._exShift]:[],...a.value.sl?[p._slTotal,p._slMinutes]:[],...a.value.manual?[p._manual]:[]]),e=[s,...t].map(p=>p.map(w=>`"${String(w).replace(/"/g,'""')}"`).join(",")).join(`
`),c=new Blob([e],{type:"text/csv;charset=utf-8;"}),M=URL.createObjectURL(c),k=document.createElement("a");k.href=M,k.download=`monthly-application-${q.value||y.value}.csv`,k.click(),URL.revokeObjectURL(M)},at=()=>window.print();return(s,t)=>(o(),n("div",mt,[l("div",ht,[l("div",xt,[t[13]||(t[13]=l("h1",{class:"text-base font-semibold text-slate-800 leading-tight"},"Monthly Application Summary",-1)),l("p",yt,[t[12]||(t[12]=f("Month: ")),l("b",null,i(q.value||y.value),1)])]),t[20]||(t[20]=l("div",{class:"flex-1"},null,-1)),l("div",ft,[t[19]||(t[19]=l("span",{class:"px-2 py-0.5 text-[11px] text-slate-500"},"Cols:",-1)),l("label",bt,[x(l("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>a.value.ot=e)},null,512),[[b,a.value.ot]]),t[14]||(t[14]=f(" OT"))]),l("label",gt,[x(l("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>a.value.leave=e)},null,512),[[b,a.value.leave]]),t[15]||(t[15]=f(" Leave"))]),l("label",kt,[x(l("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>a.value.ex=e)},null,512),[[b,a.value.ex]]),t[16]||(t[16]=f(" Exch"))]),l("label",wt,[x(l("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>a.value.sl=e)},null,512),[[b,a.value.sl]]),t[17]||(t[17]=f(" Short"))]),l("label",St,[x(l("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>a.value.manual=e)},null,512),[[b,a.value.manual]]),t[18]||(t[18]=f(" Manual"))])]),l("button",{class:"btn-secondary",onClick:st},"Export CSV"),l("button",{class:"btn-secondary",onClick:at},"Print")]),l("div",Lt,[pt(ct,{company_id:u.value.company_id,"onUpdate:company_id":t[5]||(t[5]=e=>u.value.company_id=e),department_id:u.value.department_id,"onUpdate:department_id":t[6]||(t[6]=e=>u.value.department_id=e),line_type:u.value.line_type,"onUpdate:line_type":t[7]||(t[7]=e=>u.value.line_type=e),"with-type":!0,"initial-value":s.$route.query},null,8,["company_id","department_id","line_type","initial-value"]),l("div",null,[t[21]||(t[21]=l("label",{class:"block text-[11px] text-gray-500 mb-0.5"},"Month",-1)),x(l("input",{type:"month","onUpdate:modelValue":t[8]||(t[8]=e=>y.value=e),class:"input-1 py-1 h-8"},null,512),[[G,y.value]])]),l("div",At,[l("div",Mt,[x(l("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>C.value=e),type:"search",placeholder:"Search employee / ID / designation",class:"input-1 w-64 pl-8 h-8"},null,512),[[G,C.value]]),t[22]||(t[22]=l("span",{class:"absolute left-2 top-1.5 text-slate-400 select-none"},"🔎",-1))]),l("label",Tt,[x(l("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>O.value=e)},null,512),[[b,O.value]]),t[23]||(t[23]=f(" Compact "))]),l("label",Ot,[x(l("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>U.value=e)},null,512),[[b,U.value]]),t[24]||(t[24]=f(" Zero-only "))])])]),S.value?(o(),dt(vt,{key:0})):d("",!0),T.value?(o(),n("div",Rt,i(T.value),1)):d("",!0),S.value?d("",!0):(o(),n("div",{key:2,class:v(["table-wrap group bg-white border rounded-xl shadow-sm overflow-auto print:overflow-visible",O.value?"max-h-[74vh]":"max-h-[80vh]"])},[l("table",qt,[l("colgroup",null,[t[25]||(t[25]=l("col",{style:{width:"34px"}},null,-1)),t[26]||(t[26]=l("col",{style:{width:"220px"}},null,-1)),a.value.ot?(o(),n("col",Ct)):d("",!0),a.value.leave?(o(),n("col",Ut)):d("",!0),a.value.ex?(o(),n("col",Vt)):d("",!0),a.value.sl?(o(),n("col",Et)):d("",!0),a.value.manual?(o(),n("col",Nt)):d("",!0)]),l("thead",$t,[l("tr",jt,[t[27]||(t[27]=l("th",{rowspan:"2",class:"text-left sticky left-0 z-30 bg-white/95"},"#",-1)),t[28]||(t[28]=l("th",{rowspan:"2",class:"text-left sticky left-[34px] z-30 bg-white/95"},"Employee",-1)),a.value.ot?(o(),n("th",{key:0,colspan:A("ot"),class:"th-group th-ot"},"Overtime",8,zt)):d("",!0),a.value.leave?(o(),n("th",{key:1,colspan:A("leave"),class:"th-group th-leave"},"Leave Day",8,Bt)):d("",!0),a.value.ex?(o(),n("th",{key:2,colspan:A("ex"),class:"th-group th-ex"},"Shift Exchange",8,It)):d("",!0),a.value.sl?(o(),n("th",{key:3,colspan:A("sl"),class:"th-group th-sl"},"Short Leave",8,Dt)):d("",!0),a.value.manual?(o(),n("th",{key:4,colspan:A("manual"),class:"th-group th-manual"},"Manual",8,Pt)):d("",!0)]),l("tr",Wt,[a.value.ot?(o(),n(_,{key:0},[t[29]||(t[29]=l("th",{class:"th-col th-ot",title:"Requested Hours"},"Req",-1)),t[30]||(t[30]=l("th",{class:"th-col th-ot",title:"Approved Hours"},"Appr",-1)),t[31]||(t[31]=l("th",{class:"th-col th-ot",title:"Applications Count"},"Apps",-1))],64)):d("",!0),a.value.leave?(o(),n(_,{key:1},[t[32]||(t[32]=l("th",{class:"th-col th-leave",title:"Casual Leave"},"CL",-1)),t[33]||(t[33]=l("th",{class:"th-col th-leave",title:"Medical Leave"},"ML",-1)),t[34]||(t[34]=l("th",{class:"th-col th-leave",title:"Sick Leave"},"SL",-1)),t[35]||(t[35]=l("th",{class:"th-col th-leave",title:"Total Leave Days"},"Total",-1))],64)):d("",!0),a.value.ex?(o(),n(_,{key:2},[t[36]||(t[36]=l("th",{class:"th-col th-ex",title:"Offday Exchange"},"Offday",-1)),t[37]||(t[37]=l("th",{class:"th-col th-ex",title:"Shift Exchange"},"Shift",-1))],64)):d("",!0),a.value.sl?(o(),n(_,{key:3},[t[38]||(t[38]=l("th",{class:"th-col th-sl",title:"Short Leave Applications"},"Total",-1)),t[39]||(t[39]=l("th",{class:"th-col th-sl",title:"Short Leave Minutes"},"Minutes",-1))],64)):d("",!0),a.value.manual?(o(),n("th",Ft,"Count")):d("",!0)])]),l("tbody",Ht,[(o(!0),n(_,null,rt(L.value,(e,c)=>(o(),n("tr",{key:e.user_id||c,class:v(["hover:bg-slate-50/80",O.value?"h-9":"h-11"])},[l("td",Jt,i(c+1),1),l("td",Zt,[l("div",Kt,[l("span",Yt,i(e.user_name),1),e.employee_id?(o(),n("span",Gt,"#"+i(e.employee_id),1)):d("",!0)]),e.designation?(o(),n("div",Qt,i(e.designation),1)):d("",!0)]),a.value.ot?(o(),n(_,{key:0},[l("td",Xt,[l("span",{class:v(e._otReq>0?"badge":"muted"),title:z(e._otReq)},i(R(e._otReq)),11,te)]),l("td",ee,[l("span",{class:v(e._otAppr>0?"badge":"muted"),title:z(e._otAppr)},i(R(e._otAppr)),11,le)]),l("td",se,[l("span",{class:v(e._otApps>0?"badge":"muted")},i(e._otApps),3)])],64)):d("",!0),a.value.leave?(o(),n(_,{key:1},[l("td",ae,[l("span",{class:v(e._cl>0?"badge-soft-emerald":"muted")},i(e._cl),3)]),l("td",oe,[l("span",{class:v(e._ml>0?"badge-soft-emerald":"muted")},i(e._ml),3)]),l("td",ne,[l("span",{class:v(e._sl>0?"badge-soft-emerald":"muted")},i(e._sl),3)]),l("td",ie,[l("span",{class:v(e._leaveTotal>0?"badge-strong":"muted")},i(e._leaveTotal),3)])],64)):d("",!0),a.value.ex?(o(),n(_,{key:2},[l("td",de,[l("span",{class:v(e._exOff>0?"badge-soft-indigo":"muted")},i(e._exOff),3)]),l("td",pe,[l("span",{class:v(e._exShift>0?"badge-soft-indigo":"muted")},i(e._exShift),3)])],64)):d("",!0),a.value.sl?(o(),n(_,{key:3},[l("td",re,[l("span",{class:v(e._slTotal>0?"badge-soft-amber":"muted")},i(e._slTotal),3)]),l("td",ue,[l("span",{class:v(e._slMinutes>0?"badge-soft-amber":"muted")},i(e._slMinutes),3)])],64)):d("",!0),a.value.manual?(o(),n("td",ce,[l("span",{class:v(e._manual>0?"badge-soft-slate":"muted")},i(e._manual),3)])):d("",!0)],2))),128)),l("tr",ve,[t[40]||(t[40]=l("td",null,null,-1)),l("td",_e,"Totals ("+i(L.value.length)+" emp)",1),a.value.ot?(o(),n(_,{key:0},[l("td",me,i(R(m.value.otReq)),1),l("td",he,i(R(m.value.otAppr)),1),l("td",xe,i(m.value.otApps),1)],64)):d("",!0),a.value.leave?(o(),n(_,{key:1},[l("td",ye,i(m.value.cl),1),l("td",fe,i(m.value.ml),1),l("td",be,i(m.value.sl),1),l("td",ge,i(m.value.leaveTotal),1)],64)):d("",!0),a.value.ex?(o(),n(_,{key:2},[l("td",ke,i(m.value.exOff),1),l("td",we,i(m.value.exShift),1)],64)):d("",!0),a.value.sl?(o(),n(_,{key:3},[l("td",Se,i(m.value.slTotal),1),l("td",Le,i(m.value.slMinutes),1)],64)):d("",!0),a.value.manual?(o(),n("td",Ae,i(m.value.manual),1)):d("",!0)])])]),t[41]||(t[41]=l("div",{class:"scroll-shadow-left"},null,-1)),t[42]||(t[42]=l("div",{class:"scroll-shadow-right"},null,-1))],2)),!S.value&&L.value.length===0?(o(),n("div",Me," No records for "+i(y.value)+". ",1)):d("",!0)]))}},Be=_t(Te,[["__scopeId","data-v-c3f56d6f"]]);export{Be as default};
