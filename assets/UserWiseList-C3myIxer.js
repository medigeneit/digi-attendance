import{q as v,s as N,A as R,e as z,c,o as f,a as t,f as S,w as _,g as T,C as $,F as V,x as E,t as F,h as L,l as h,p as H,E as A,v as j,r as B,y as G}from"./index-CYZ0Clfd.js";import{_ as q}from"./MultiselectDropdown-CX3LRzUo.js";import{u as O}from"./company-CVCEd1Pi.js";import{_ as P}from"./UserChip-yypHS3Ww.js";import{_ as W}from"./TaskTreeView-CUzimtXC.js";const J={class:"mb-3 task-header"},K={class:"flex justify-between items-center"},Q={class:"ml-auto flex gap-6 items-center"},X={key:0,class:"flex gap-2 items-center"},Y={class:"flex flex-wrap items-center gap-2 mt-3"},Z={class:"flex flex-wrap gap-4 w-full"},ee={class:"text-gray-600 w-full md:w-64 relative"},te=["value"],se={class:"relative w-full md:w-72"},le={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},ae={class:"text-gray-600 w-40 relative"},oe={class:"flex gap-4 items-center flex-shrink-0"},ne={class:"flex gap-2"},ie={class:"flex gap-2"},re={class:"flex gap-2"},de={class:"text-gray-600 w-full md:w-40 md:ml-auto relative"},ye={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(k,{emit:g}){const u=k,b=v(d("company-id")),y=v(d("user-ids")),w=v(d("month")),p=v(d("status")),l=v(d("is-important")),s=v(d("is-urgent")),n=v(d("is-target")),i=g,o=O(),{companies:x,employees:m}=N(o);function d(r){return{get:()=>u.modelValue[r]||"",set:e=>{console.log("---SETTING modelValue: ",{key:r,value:e}),i("update:modelValue",{...u.modelValue,[r]:e||void 0})}}}const C=v(()=>D(y.value));async function U(r){r&&await o.fetchEmployee(r)}R(()=>b.value,U),z(async()=>{var r,e;await o.fetchCompanies(),(r=u.modelValue)!=null&&r["company-id"]&&await U((e=u.modelValue)==null?void 0:e["company-id"])});function D(r){return Array.isArray(m.value)&&m.value.find(e=>e.id==r)||null}function I(r){y.value=(r==null?void 0:r.id)||""}function M(){y.value=""}return(r,e)=>(f(),c("div",J,[t("div",K,[e[10]||(e[10]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",Q,[k.listHasRearranged?(f(),c("div",X,[e[9]||(e[9]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=_(a=>i("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=_(a=>i("clickPriorityDiscard"),["prevent"]))},"Discard")])):S("",!0),t("button",{onClick:e[2]||(e[2]=a=>i("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",Y,[t("div",Z,[t("div",ee,[e[12]||(e[12]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Company",-1)),T(t("select",{id:"company-filter","onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),class:"input-1"},[e[11]||(e[11]=t("option",{value:""},"All Company",-1)),(f(!0),c(V,null,E(L(x),a=>(f(),c("option",{key:a.id,value:a.id},F(a.name),9,te))),128))],512),[[$,b.value]])]),t("div",se,[h(q,{modelValue:C.value,onSelect:I,onRemove:M,options:L(m),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employees",class:"text-gray-600 w-full"},{option:H(({option:a})=>[h(P,{user:a,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),C.value?(f(),c("div",le,[t("button",{onClick:_(M,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):S("",!0),e[13]||(e[13]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"},"Employee",-1))]),t("div",ae,[e[15]||(e[15]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),T(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>p.value=a),class:"input-1"},e[14]||(e[14]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[$,p.value]])]),t("div",oe,[t("label",ne,[T(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=a=>l.value=a)},null,512),[[A,l.value]]),e[16]||(e[16]=t("span",null,"Important",-1))]),t("label",ie,[T(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=a=>s.value=a)},null,512),[[A,s.value]]),e[17]||(e[17]=t("span",null,"Urgent",-1))]),t("label",re,[T(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=a=>n.value=a)},null,512),[[A,n.value]]),e[18]||(e[18]=t("span",null,"Is Target",-1))])]),t("div",de,[e[19]||(e[19]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),T(t("input",{id:"month-filter","onUpdate:modelValue":e[8]||(e[8]=a=>w.value=a),type:"month",class:"input-1",placeholder:"All month"},null,512),[[j,w.value]])])])])]))}},ue=()=>{const k=B(),g=B(0);function u(p,l){k.value=p,g.value=l}function b(){const p=[],l=(s,n=0,i="")=>{s.forEach(o=>{p.push({...o,depth:n,idPath:i+o.id}),o.children_tasks&&o.children_tasks.length&&l(o.children_tasks,n+1,i+o.id+"-")})};return l(w()),p}function y(p,l=0){return Array.isArray(p)===!1||p.length===0?[]:p.filter(s=>s.parent_id===l).map(s=>({...s,children_tasks:y(p,s.id)}))}function w(){return y(k.value,g.value)}return{getTaskListTree:w,getFlattenedTasks:b,setTaskList:u}},pe=(k,g)=>{const u=ue();return u.setTaskList(k,g),u.getTaskListTree()},me={class:"w-full bg-white rounded"},ce=["rowspan"],xe={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(k,{emit:g}){const u=k,b=g,y=v(()=>u.tasks.reduce((l,s)=>(l.push(...s.users.filter(n=>!l.find(i=>i.id==n.id&&n.id))),l),[]).filter(l=>u.selectedUserId?l.id==u.selectedUserId:!0)),w=l=>{const s=u.tasks,n=new Map(s.map(m=>[m.id,m])),i=new Set,o=[],x=s.filter(m=>m.users.some(d=>d.id===l));for(const m of x){i.has(m.id)||(i.add(m.id),o.push(m));let d=m.parent_id;for(;d&&n.has(d)&&!i.has(d);){const C=n.get(d);i.add(C.id),o.push(C),d=C.parent_id}}return o},p=v(()=>y.value.map(l=>{const s=pe(w(l.id),0);return{...l,tasks:s}}));return(l,s)=>(f(),c("div",null,[t("table",me,[t("tbody",null,[(f(!0),c(V,null,E(p.value,n=>(f(),c(V,{key:n.id},[(f(!0),c(V,null,E(n.tasks,(i,o)=>(f(),c("tr",{key:i.id},[o==0?(f(),c("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(n.tasks.length,1)},[h(P,{user:n,class:"sticky top-[80px]"},null,8,["user"])],8,ce)):S("",!0),t("td",{class:G(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":o==0,"border-b":n.tasks.length-1===o}])},[h(W,{task:i,class:"!border-0 my-0",index:o,onCommentButtonClick:s[0]||(s[0]=x=>b("commentButtonClick",l.item.id)),onEditClick:s[1]||(s[1]=x=>b("editClick",x)),onAddClick:s[2]||(s[2]=x=>b("addClick",x))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}};export{ye as _,xe as a};
