import{S as L,r as f,m as h,Q as c}from"./index-D_dgf00N.js";import{u as N}from"./useTodoDateStore-Ch0ZKKtn.js";const b=L("todo",()=>{const g=f(null),u=f(!1),m=f(!1),s=f(null),l=f([]),T=N(),w=async t=>{var e,r,o;l.value=[],u.value=!0,s.value=null;try{const a=await c.get("/todos",{params:t});l.value=((e=a.data)==null?void 0:e.todos)||[],y()}catch(a){throw s.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todos load failed",a}finally{u.value=!1}};function y(){l.value=[...l.value.sort((t,e)=>(t==null?void 0:t.user_id)!==(e==null?void 0:e.user_id)?(t==null?void 0:t.user_id)-(e==null?void 0:e.user_id):t.priority!==e.priority?t.priority-e.priority:e.id-t.id)]}const _=async t=>{var e,r,o;u.value=!0,s.value=null;try{const a=await c.get("/my-todos",{params:t});l.value=((e=a.data)==null?void 0:e.todos)||[],y()}catch(a){throw s.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todos load failed",a}finally{u.value=!1}},S=t=>{var e;return(e=l.value)==null?void 0:e.filter(r=>r.date==t)},D=async t=>{var e,r;u.value=!0,s.value=null;try{const o=await c.get(`/todos/${t}`);g.value=o.data}catch(o){throw s.value=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||"Todo load failed",o}finally{u.value=!1}},$=async(t,{returnWith:e}={})=>{var r,o,a,n,v;u.value=!0,s.value=null;try{const d=await c.post("/todos",t,{params:{return_with:e}});return l.value=[...l.value,(r=d.data)==null?void 0:r.todo],(o=d==null?void 0:d.data)!=null&&o.todo_date&&T.setNewTodoDate((a=d==null?void 0:d.data)==null?void 0:a.todo_date),y(),d.data}catch(d){throw s.value=((v=(n=d.response)==null?void 0:n.data)==null?void 0:v.message)||"Todo create failed",d}finally{u.value=!1}},M=async(t,e)=>{var r,o;u.value=!0,s.value=null;try{const a=await c.put(`/todos/${t}`,e);return l.value=l.value.map(n=>{var v,d,i,p;return n.id==((d=(v=a.data)==null?void 0:v.todo)==null?void 0:d.id)?n.user?{...(i=a.data)==null?void 0:i.todo,user:{...n.user}}:{...(p=a.data)==null?void 0:p.todo}:{...n}}),a.data}catch(a){throw s.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todo update failed",a}finally{u.value=!1}},x=async(t,e)=>{var r,o;u.value=!0,s.value=null;try{await c.put(`/todos/status/${t}`,{status:e}),l.value=l.value.map(a=>a.id===t?{...a,status:e}:{...a})}catch(a){throw s.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to update todo status",a}finally{u.value=!1}},C=async(t,{date:e}={})=>{var r,o;u.value=!0,m.value=!0,s.value=null;try{const a=await c.put("/my-todos/rearrange",{ids:t,date:e});l.value=l.value.map(n=>{var i;const d=(((i=a.data)==null?void 0:i.changes)||[]).find(p=>p.id==n.id);return d?{...n,priority:d.priority}:n}),y()}catch(a){throw s.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todo rearranging failed",a}finally{m.value=!0,u.value=!1}},F=async t=>{var e,r;u.value=!0,s.value=null;try{await c.delete(`/todos/${t}`),l.value=l.value.filter(o=>o.id!==t)}catch(o){throw s.value=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||"Todo delete failed",o}finally{u.value=!1}};return{todos:h(()=>l.value),todo:h(()=>g.value),loading:h(()=>u.value),error:h(()=>s.value),fetchTodos:w,fetchTodo:D,createTodo:$,updateTodo:M,rearrangeMyTodos:C,deleteTodo:F,fetchMyTodos:_,updateTodoStatus:x,getTodosByDate:S}});export{b as u};
