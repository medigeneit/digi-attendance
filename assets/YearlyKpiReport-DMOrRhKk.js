import{D as Re,f as Le,x as f,G as Ae,r as j,q as De,h as Te,c as o,o as a,a as e,d as q,b,t as n,l as Z,k as ee,m as $,F as h,e as w,H as _e,v as Fe,j as p,s as I,z as me,T as be}from"./index-C3PUeovd.js";import{L as ze}from"./LoaderView-B4JevdRx.js";import{_ as Ge}from"./EmployeeFilter-BC-bD_bA.js";import{u as Pe}from"./kpi-report-CPBXSrcb.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-kMoY_UDO.js";import"./department-BaP5FKKK.js";import"./EmployeeDropdownInput-Dobjs6rj.js";import"./SelectDropdown-DfvLm5kt.js";import"./UserChip-BbV9Zc_x.js";const Ye={class:"space-y-4 px-4 print:px-0"},Ee={class:"hidden print:block mx-auto text-center mb-3"},Me={class:"text-sm text-gray-600"},Ve={class:"font-medium"},Ke={class:"font-medium"},Ue={class:"flex flex-wrap items-end gap-3 sticky top-0 z-10 bg-white/80 backdrop-blur print:hidden p-2 -mx-2 rounded-xl border border-gray-100"},qe={class:"w-full flex items-start gap-3"},Ie={class:"flex items-center gap-2"},Oe=["disabled"],Be=["value"],Je={class:"flex flex-wrap items-center gap-2 w-full"},He=["value"],We=["disabled"],Qe={key:0,class:"py-10 text-center"},Xe={key:1,class:"rounded-xl border border-red-200 bg-red-50 p-3 text-red-700",role:"alert"},Ze={class:"rounded-2xl border border-gray-200 bg-white shadow-sm p-4 print:hidden"},et={class:"flex flex-wrap items-start justify-between gap-3"},tt={class:"text-xs font-semibold uppercase tracking-[0.18em] text-indigo-500"},st={class:"mt-1 text-lg font-semibold text-slate-900"},lt={class:"mt-1 flex flex-wrap gap-2 text-xs text-slate-600"},nt={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},ot={class:"text-slate-900"},at={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},rt={class:"text-slate-900"},it={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},dt={class:"text-slate-900"},ut={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},pt={class:"text-slate-900"},ct={key:0,class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},_t={class:"text-slate-900"},mt={class:"text-xs text-slate-500"},bt={class:"space-y-3 md:hidden"},yt={class:"flex items-start justify-between gap-3"},xt={class:"min-w-0"},gt=["title"],vt={class:"mt-0.5 text-[11px] text-slate-500"},ft={key:0},ht={key:1},wt={key:2},kt={key:3},Nt={class:"shrink-0"},St={key:0,class:"mt-2 grid grid-cols-4 gap-2"},jt=["title"],Ct={class:"mt-1 flex flex-col items-center gap-1"},Rt={class:"mt-3 flex items-center justify-between gap-3"},Lt=["onClick"],At={key:0,class:"px-3 py-8 text-center text-gray-600"},Dt={class:"hidden md:block overflow-x-auto rounded-2xl border bg-white shadow-sm"},Tt={class:"w-full text-sm"},Ft={class:"sticky top-0 z-[5] bg-gray-100/95 backdrop-blur"},zt={class:"text-xs font-semibold text-slate-700"},Gt={class:"sticky left-0 z-[4] border-r bg-inherit px-3 py-2 text-center"},Pt={class:"sticky z-[4] border-r bg-inherit px-3 py-2",style:{left:"3rem"}},$t={class:"max-w-[17rem]"},Yt=["title"],Et={class:"text-[11px] text-slate-500 truncate"},Mt={key:0},Vt={key:1},Kt={key:2},Ut={key:3},qt={class:"border-r px-3 py-2 text-center"},It={class:"flex flex-col items-center gap-1"},Ot={class:"border-r px-3 py-2 text-center"},Bt={class:"inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[12px] font-semibold text-slate-700"},Jt={class:"px-3 py-2"},Ht={class:"space-y-1 text-[11px] text-slate-600"},Wt={class:"mt-2 flex items-center justify-between gap-3"},Qt=["onClick"],Xt={key:0},Zt={class:"relative max-w-2xl w-full rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true","aria-label":"Latest review details"},es={class:"flex items-start justify-between gap-4"},ts={class:"text-lg font-semibold text-slate-900"},ss={class:"text-xs text-slate-500"},ls={key:0},ns={key:1},os={class:"text-xs text-slate-500"},as={class:"mt-4 space-y-4 text-slate-700"},rs={class:"rounded-xl border border-slate-200 bg-slate-50 p-4"},is={class:"mt-3 space-y-2 text-xs text-slate-700"},ds={key:0},us={class:"mt-1 text-slate-600"},ps={key:1},cs={class:"mt-1 text-slate-600"},_s={key:2},ms={class:"mt-1 text-slate-600"},bs={key:3,class:"text-slate-500"},ys={class:"relative max-w-3xl w-full rounded-2xl border border-slate-200 bg-white shadow-xl overflow-hidden",role:"dialog","aria-modal":"true","aria-label":"All reviewer comments"},xs={class:"p-5 border-b border-slate-200 bg-white"},gs={class:"flex items-start justify-between gap-4"},vs={class:"min-w-0"},fs={class:"text-lg font-semibold text-slate-900 truncate"},hs={class:"mt-0.5 text-xs text-slate-500"},ws={key:0},ks={key:1},Ns={class:"mt-2 flex flex-wrap gap-2 text-[11px] text-slate-600"},Ss={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},js={class:"text-slate-900"},Cs={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},Rs={class:"text-slate-900"},Ls={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},As={class:"text-slate-900"},Ds={class:"max-h-[75vh] overflow-y-auto p-5 space-y-4"},Ts={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Fs={class:"px-4 py-3 bg-slate-50 border-b border-slate-200 flex flex-wrap items-center justify-between gap-2"},zs={class:"flex items-center gap-2 min-w-0"},Gs=["title"],Ps={class:"text-[11px] text-slate-500 truncate"},$s={class:"flex flex-wrap gap-2 text-[11px] text-slate-600"},Ys={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},Es={class:"text-slate-900"},Ms={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},Vs={class:"text-slate-900"},Ks={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},Us={class:"text-slate-900"},qs={class:"p-4 space-y-3"},Is={class:"flex flex-wrap items-start justify-between gap-2"},Os={class:"min-w-0"},Bs={class:"text-sm font-semibold text-slate-900 truncate"},Js={class:"mt-0.5 text-[11px] text-slate-500"},Hs={key:0},Ws={class:"flex flex-wrap gap-2"},Qs={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] font-semibold text-slate-700"},Xs={key:0,class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] font-semibold text-slate-700"},Zs={class:"mt-3 space-y-2 text-xs text-slate-700"},el={key:0},tl={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},sl={key:1},ll={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},nl={key:2},ol={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},al={key:3,class:"text-slate-500"},rl={key:0,class:"text-sm text-slate-500"},il={__name:"YearlyKpiReport",setup(dl){const O=Pe(),{reports:ye,isLoading:B,error:te}=Re(O),F=Le(),L=f(()=>({company_id:F.query.company_id??"",department_id:F.query.department_id??"",employee_id:F.query.employee_id??"",line_type:F.query.line_type??"executive"})),_=Ae({company_id:L.value.company_id,department_id:L.value.department_id,employee_id:L.value.employee_id,line_type:L.value.line_type}),se=j(!1),le=new Date().getFullYear(),k=j(Number(F.query.year??le)),ne=j([]);function xe(s=2020,t=le+1){const i=[];for(let r=t;r>=s;r--)i.push(r);ne.value=i}const C=f(()=>ye.value||{}),J=f(()=>{var s;return((s=C.value)==null?void 0:s.cycle)||{}}),oe=f(()=>{var s;return((s=C.value)==null?void 0:s.filters)||{}}),N=f(()=>{var t;return[...Array.isArray((t=C.value)==null?void 0:t.lane_definitions)?C.value.lane_definitions:[]].sort((i,r)=>Number(i.rank||0)-Number(r.rank||0))}),Y=f(()=>{var s;return((s=C.value)==null?void 0:s.summary)||{}}),ge=f(()=>{var s;return Array.isArray((s=C.value)==null?void 0:s.data)?C.value.data:[]}),E=f(()=>{var t;if(N.value.length)return N.value.length;const s=Number(((t=J.value)==null?void 0:t.lane_count)??0);return Number.isFinite(s)&&s>0?s:0});function A(s){const t=Number(s);return Number.isFinite(t)?`${Math.round(t)}%`:"0%"}function D(s,t="-"){const i=(s??"").toString().trim();return i||t}function ae(s){if(!s)return null;const t=new Date(s);return Number.isNaN(t.getTime())?null:t.toLocaleDateString()}function ve(){return new Date().toLocaleString()}function T(s){return!Array.isArray(s)||s.length===0?null:s.join("; ")}function H(s){return Array.isArray(s)?s.map(t=>typeof t=="string"?t.trim():"").filter(t=>t!==""):typeof s=="string"?s.split(/[\r\n;]+/).map(t=>t.trim()).filter(t=>t!==""):[]}function re(s){var r;const t=Number(((r=s==null?void 0:s.progress)==null?void 0:r.lanes_reviewed)??0),i=Number(E.value??0);return i?t>=i?"bg-emerald-50 text-emerald-700 border-emerald-200":t>0?"bg-amber-50 text-amber-700 border-amber-200":"bg-rose-50 text-rose-700 border-rose-200":"bg-slate-50 text-slate-600 border-slate-200"}function W(s){var r;const t=Number(((r=s==null?void 0:s.progress)==null?void 0:r.lanes_reviewed)??0),i=Number(E.value??0);return i?`${t}/${i}`:`${t}`}function fe(s){if(!s)return"No reviews submitted yet";const t=s.reviewer_name||"Latest reviewer",i=s.reviewer_lane?` (${s.reviewer_lane})`:"",r=s.obtained_total??null,c=s.max_total??null,y=Number.isFinite(Number(r))&&Number.isFinite(Number(c))?`${Number(r)}/${Number(c)}`:r!==null?`${r}`:null,v=ae(s.submitted_at),x=[`${t}${i}`];return y&&x.push(y),v&&x.push(v),x.join(" • ")}function M(s,t){var v;const r=(Array.isArray(s==null?void 0:s.lanes)?s.lanes:[]).find(x=>(x==null?void 0:x.key)===t)||null;if(!r)return{text:"-",cls:"bg-slate-50 text-slate-500 border border-slate-200",percentText:"--"};const c=r.submitted_at||r.submittedAt||((v=r.review)==null?void 0:v.submitted_at),g=!!(r.completed??r.is_completed??r.review_submitted??c),y=r.average_marks??0;return g?{text:y,cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:y,cls:"bg-amber-50 text-amber-700 border-amber-200"}}const ie=f(()=>ge.value.map(s=>{var c,g,y;const t=s.employee||{},i=s.latest_review||null,r=s.comments||{};return{...s,_name:D(t.name),_company:D(t.company,""),_dept:D(t.department,""),_joining:ae(t.joining_date),_type:D(t.type,""),latestReviewSummary:fe(i),latestReviewStrengths:T(i==null?void 0:i.strengths)||null,latestReviewGaps:T(i==null?void 0:i.gaps)||null,latestReviewSuggestions:T(i==null?void 0:i.suggestions)||null,aggregatedStrengthsList:H(r==null?void 0:r.strengths),aggregatedGapsList:H(r==null?void 0:r.gaps),aggregatedSuggestionsList:H(r==null?void 0:r.suggestions),aggregatedStrengths:T(r==null?void 0:r.strengths),aggregatedGaps:T(r==null?void 0:r.gaps),aggregatedSuggestions:T(r==null?void 0:r.suggestions),finalPercent:((c=s==null?void 0:s.kpi_result)==null?void 0:c.final_percent)??((g=s==null?void 0:s.kpi_result)==null?void 0:g.final_percentage)??((y=s==null?void 0:s.kpi_result)==null?void 0:y.final)??null}})),Q=j(""),X=j("all"),he=[{value:"all",label:"Any comment"},{value:"strengths",label:"Strengths"},{value:"gaps",label:"Gaps"},{value:"suggestions",label:"Suggestions"}],we=f(()=>Q.value.trim().toLowerCase()),ke=f(()=>{const s=we.value;return s?ie.value.filter(t=>{const i=X.value,r=[];return(i==="all"||i==="strengths")&&r.push(t.aggregatedStrengthsList||[]),(i==="all"||i==="gaps")&&r.push(t.aggregatedGapsList||[]),(i==="all"||i==="suggestions")&&r.push(t.aggregatedSuggestionsList||[]),r.some(c=>c.some(g=>g.toLowerCase().includes(s)))}):ie.value}),V=f(()=>ke.value),u=j(null),K=j(!1);function de(s){u.value=s,K.value=!0}function R(){K.value=!1,u.value=null}const U=j(!1);function Ne(){return{year:Number(k.value),company_id:_.company_id||void 0,department_id:_.department_id||void 0,employee_id:_.employee_id||void 0,line_type:_.line_type||void 0,flag:"excel"}}async function Se(){U.value=!0;try{await O.exportYearly(Ne())}catch(s){console.error("exportYearly failed:",s)}finally{U.value=!1}}async function ue(){try{_.company_id&&await O.fetchYearlyExecutive({year:Number(k.value),company_id:_.company_id||void 0,department_id:_.department_id||void 0,employee_id:_.employee_id||void 0,line_type:_.line_type||void 0})}catch(s){console.error("fetchYearlyExecutive failed:",s)}}function je(s={}){_.company_id=s.company_id??"",_.department_id=s.department_id??"",_.employee_id=s.employee_id??"",_.line_type=s.line_type??L.value.line_type??"executive",se.value=!0,ue()}De(k,()=>{const s=Number(k.value);!Number.isInteger(s)||s<2e3||s>2100||se.value&&ue()}),Te(()=>{xe()});function pe(s){if(!s)return null;const t=new Date(s);return Number.isNaN(t.getTime())?null:t.toLocaleString()}const ce=f(()=>{const s=u.value,t=Array.isArray(s==null?void 0:s.lanes)?s.lanes:[],i=new Map(N.value.map(c=>[c.key,Number(c.rank??0)]));return[...t].sort((c,g)=>{const y=i.get(c.key)??9999,v=i.get(g.key)??9999;return y-v}).map(c=>{var v;const y=[...Array.isArray(c.reviewers)?c.reviewers:[]].sort((x,z)=>{const l=new Date(x.submitted_at||x.updated_at||0).getTime();return new Date(z.submitted_at||z.updated_at||0).getTime()-l});return{...c,label:((v=N.value.find(x=>x.key===c.key))==null?void 0:v.label)||c.key,reviewers:y}})});return(s,t)=>{var i,r,c,g,y,v,x,z;return a(),o("div",Ye,[e("div",Ee,[t[10]||(t[10]=e("h1",{class:"text-xl font-semibold text-gray-900"},"Yearly KPI Report",-1)),e("div",Me,[t[7]||(t[7]=b(" Cycle: ")),e("span",Ve,n(((i=J.value)==null?void 0:i.slug)||"-"),1),t[8]||(t[8]=b(" • Year: ")),e("span",Ke,n(k.value),1),t[9]||(t[9]=b(" • Generated: ")),e("span",null,n(ve()),1)])]),e("div",Ue,[e("div",qe,[q(Ge,{company_id:_.company_id,"onUpdate:company_id":t[1]||(t[1]=l=>_.company_id=l),department_id:_.department_id,"onUpdate:department_id":t[2]||(t[2]=l=>_.department_id=l),employee_id:_.employee_id,"onUpdate:employee_id":t[3]||(t[3]=l=>_.employee_id=l),line_type:_.line_type,"onUpdate:line_type":t[4]||(t[4]=l=>_.line_type=l),"initial-value":L.value,class:"w-full",onFilterChange:je},{default:Z(()=>[e("div",Ie,[ee(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>k.value=l),class:"w-32 rounded-lg border border-gray-300 bg-white px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50 disabled:opacity-60",disabled:$(B),"aria-label":"Select year"},[(a(!0),o(h,null,w(ne.value,l=>(a(),o("option",{key:l,value:l},n(l),9,Be))),128))],8,Oe),[[_e,k.value,void 0,{number:!0}]])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])]),e("div",Je,[ee(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>Q.value=l),type:"search",placeholder:"Search gaps/strengths/suggestions",class:"flex-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"},null,512),[[Fe,Q.value]]),ee(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>X.value=l),class:"rounded-lg border border-gray-300 bg-white px-2 py-1 text-sm focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"},[(a(),o(h,null,w(he,l=>e("option",{key:l.value,value:l.value},n(l.label),9,He)),64))],512),[[_e,X.value]]),e("button",{class:"btn-1",onClick:Se,disabled:U.value||$(B)},[t[11]||(t[11]=e("i",{class:"far fa-file-excel mr-1"},null,-1)),b(" "+n(U.value?"Preparing...":"Download Excel"),1)],8,We)])]),$(B)?(a(),o("div",Qe,[q(ze)])):$(te)?(a(),o("div",Xe,n($(te)),1)):(a(),o(h,{key:2},[e("div",Ze,[e("div",et,[e("div",null,[e("div",tt," KPI Cycle • "+n(D((r=J.value)==null?void 0:r.slug)),1),e("h2",st," Year "+n(k.value)+" • "+n(D(_.line_type)),1),e("div",lt,[e("span",nt,[t[12]||(t[12]=b(" Employees: ")),e("b",ot,n(((c=Y.value)==null?void 0:c.total_employees)??0),1)]),e("span",at,[t[13]||(t[13]=b(" With results: ")),e("b",rt,n(((g=Y.value)==null?void 0:g.with_results)??0),1)]),e("span",it,[t[14]||(t[14]=b(" Avg final: ")),e("b",dt,n(A(((y=Y.value)==null?void 0:y.avg_final_percent)??0)),1)]),e("span",ut,[t[15]||(t[15]=b(" Completion: ")),e("b",pt,n(A(((v=Y.value)==null?void 0:v.review_completion_percent)??0)),1)]),E.value?(a(),o("span",ct,[t[16]||(t[16]=b(" Lanes: ")),e("b",_t,n(E.value),1)])):p("",!0)])]),e("div",mt,[t[17]||(t[17]=e("div",null,[e("b",{class:"text-slate-700"},"API Filters")],-1)),e("div",null,"line_type: "+n(((x=oe.value)==null?void 0:x.line_type)??"-"),1),e("div",null,"submitted_only: "+n((z=oe.value)!=null&&z.submitted_only?"true":"false"),1)])])]),e("div",bt,[(a(!0),o(h,null,w(V.value,(l,m)=>{var S;return a(),o("div",{key:"m-"+(((S=l.employee)==null?void 0:S.id)??m),class:"rounded-2xl border border-gray-200 bg-white shadow-sm p-3"},[e("div",yt,[e("div",xt,[e("div",{class:"text-sm font-semibold text-slate-900 truncate",title:l._name},n(m+1)+". "+n(l._name),9,gt),e("div",vt,[l._dept?(a(),o("span",ft,n(l._dept),1)):p("",!0),l._dept&&l._company?(a(),o("span",ht," • ")):p("",!0),l._company?(a(),o("span",wt,n(l._company),1)):p("",!0),l._joining?(a(),o("span",kt," • Joined "+n(l._joining),1)):p("",!0)])]),e("div",Nt,[e("span",{class:I(["inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] font-semibold",re(l)])},n(W(l)),3)])]),N.value.length?(a(),o("div",St,[(a(!0),o(h,null,w(N.value,d=>(a(),o("div",{key:"m-lane-"+d.key,class:"rounded-xl border p-2 text-center"},[e("div",{class:"text-[10px] font-medium text-slate-600 truncate",title:d.label},n(d.label),9,jt),e("div",Ct,[e("span",{class:I(["inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-[11px] font-semibold",M(l,d.key).cls])},n(M(l,d.key).text),3)])]))),128))])):p("",!0),e("div",Rt,[e("button",{type:"button",class:"text-xs font-semibold text-sky-600 hover:text-sky-800",onClick:d=>de(l)}," Open review modal ",8,Lt)])])}),128)),V.value.length===0?(a(),o("div",At,"No data")):p("",!0)]),e("div",Dt,[e("table",Tt,[e("thead",Ft,[e("tr",null,[t[18]||(t[18]=e("th",{class:"sticky left-0 z-[6] border-b border-r bg-gray-100/95 px-3 py-2 text-center",style:{"min-width":"3rem",width:"3rem"}}," SL ",-1)),t[19]||(t[19]=e("th",{class:"sticky z-[6] border-b border-r bg-gray-100/95 px-3 py-2 text-left",style:{left:"3rem",minWidth:"18rem",width:"18rem"}}," Employee ",-1)),t[20]||(t[20]=e("th",{class:"border-b border-r px-3 py-2 text-center",style:{"min-width":"7rem"}}," Progress ",-1)),(a(!0),o(h,null,w(N.value,l=>(a(),o("th",{key:"lane-head-"+l.key,class:"border-b border-r px-2 py-2 text-center",style:{"min-width":"6.5rem"}},[e("span",zt,n(l.label),1)]))),128)),t[21]||(t[21]=e("th",{class:"border-b border-r px-3 py-2 text-center",style:{"min-width":"8rem"}}," Final ",-1)),t[22]||(t[22]=e("th",{class:"border-b px-3 py-2 text-left"}," All comments ",-1))])]),e("tbody",null,[(a(!0),o(h,null,w(V.value,(l,m)=>{var S;return a(),o("tr",{key:"d-"+(((S=l.employee)==null?void 0:S.id)??m),class:"border-t hover:bg-slate-50/80 transition-colors"},[e("td",Gt,n(m+1),1),e("td",Pt,[e("div",$t,[e("div",{class:"font-semibold text-slate-900 truncate",title:l._name},n(l._name),9,Yt),e("div",Et,[l._dept?(a(),o("span",Mt,n(l._dept),1)):p("",!0),l._dept&&l._company?(a(),o("span",Vt," • ")):p("",!0),l._company?(a(),o("span",Kt,n(l._company),1)):p("",!0),l._joining?(a(),o("span",Ut," • Joined "+n(l._joining),1)):p("",!0)])])]),e("td",qt,[e("span",{class:I(["inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-[12px] font-semibold",re(l)])},n(W(l)),3)]),(a(!0),o(h,null,w(N.value,d=>(a(),o("td",{key:"lane-"+d.key+"-"+m,class:"border-r px-2 py-2 text-center"},[e("div",It,[e("span",{class:I(["inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-[11px] font-semibold",M(l,d.key).cls])},n(M(l,d.key).text),3)])]))),128)),e("td",Ot,[e("span",Bt,n(l.finalPercent==null?"—":A(l.finalPercent)),1)]),e("td",Jt,[e("div",Ht,[e("div",Wt,[e("button",{type:"button",class:"text-[11px] font-semibold text-sky-600 hover:text-sky-800",onClick:d=>de(l)}," Open review modal ",8,Qt)])])])])}),128)),V.value.length===0?(a(),o("tr",Xt,t[23]||(t[23]=[e("td",{colspan:"100",class:"px-3 py-8 text-center text-gray-600"},"No data",-1)]))):p("",!0)])])]),q(be,{name:"fade-scale"},{default:Z(()=>[K.value&&u.value?(a(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:me(R,["escape","window"])},[e("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:R}),e("div",Zt,[e("div",es,[e("div",null,[e("p",ts,n(u.value._name),1),e("p",ss,[b(n(u.value._dept||"Department unknown")+" ",1),u.value._company?(a(),o("span",ls," • "+n(u.value._company),1)):p("",!0),u.value._joining?(a(),o("span",ns," • Joined "+n(u.value._joining),1)):p("",!0)]),e("p",os,"Line type: "+n(u.value._type),1)]),e("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")]),e("div",as,[e("article",rs,[e("div",is,[u.value.latestReviewStrengths?(a(),o("div",ds,[t[24]||(t[24]=e("span",{class:"font-semibold text-slate-800"},"Strengths:",-1)),e("div",us,n(u.value.latestReviewStrengths),1)])):p("",!0),u.value.latestReviewGaps?(a(),o("div",ps,[t[25]||(t[25]=e("span",{class:"font-semibold text-slate-800"},"Gaps:",-1)),e("div",cs,n(u.value.latestReviewGaps),1)])):p("",!0),u.value.latestReviewSuggestions?(a(),o("div",_s,[t[26]||(t[26]=e("span",{class:"font-semibold text-slate-800"},"Suggestions:",-1)),e("div",ms,n(u.value.latestReviewSuggestions),1)])):p("",!0),!u.value.latestReviewStrengths&&!u.value.latestReviewGaps&&!u.value.latestReviewSuggestions?(a(),o("div",bs," No latest review comments ")):p("",!0)])])])])],32)):p("",!0)]),_:1})],64)),q(be,{name:"fade-scale"},{default:Z(()=>{var l;return[K.value&&u.value?(a(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:me(R,["escape","window"])},[e("div",{class:"absolute inset-0","aria-hidden":"true",onClick:R}),e("div",ys,[e("div",xs,[e("div",gs,[e("div",vs,[e("p",fs,n(u.value._name),1),e("p",hs,[b(n(u.value._dept||"Department unknown")+" ",1),u.value._company?(a(),o("span",ws," • "+n(u.value._company),1)):p("",!0),u.value._joining?(a(),o("span",ks," • Joined "+n(u.value._joining),1)):p("",!0)]),e("div",Ns,[e("span",Ss,[t[27]||(t[27]=b(" Progress: ")),e("b",js,n(W(u.value)),1)]),e("span",Cs,[t[28]||(t[28]=b(" Final: ")),e("b",Rs,n(u.value.finalPercent==null?"—":A(u.value.finalPercent)),1)]),e("span",Ls,[t[29]||(t[29]=b(" Reviews: ")),e("b",As,n(((l=u.value.progress)==null?void 0:l.review_count)??0),1)])])]),e("button",{type:"button",class:"shrink-0 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")])]),e("div",Ds,[ce.value.length?p("",!0):(a(),o("div",Ts," No reviews found for this employee. ")),(a(!0),o(h,null,w(ce.value,m=>{var S;return a(),o("div",{key:"lane-group-"+m.key,class:"rounded-2xl border border-slate-200 bg-white overflow-hidden"},[e("div",Fs,[e("div",zs,[e("span",{class:"text-sm font-semibold text-slate-900 truncate",title:m.label},n(m.label),9,Gs),e("span",Ps," (key: "+n(m.key)+") ",1)]),e("div",$s,[e("span",Ys,[t[30]||(t[30]=b(" Count: ")),e("b",Es,n(m.count??((S=m.reviewers)==null?void 0:S.length)??0),1)]),e("span",Ms,[t[31]||(t[31]=b(" Avg: ")),e("b",Vs,n(m.average_marks==null?"—":A(m.average_marks)),1)]),e("span",Ks,[t[32]||(t[32]=b(" Latest: ")),e("b",Us,n(pe(m.latest_review_at)||"—"),1)])])]),e("div",qs,[(a(!0),o(h,null,w(m.reviewers||[],(d,Ce)=>(a(),o("div",{key:"rv-"+m.key+"-"+Ce+"-"+(d.id??"x"),class:"rounded-xl border border-slate-200 bg-white p-3"},[e("div",Is,[e("div",Os,[e("div",Bs,n(d.name||"Reviewer"),1),e("div",Js,[b(" Lane: "+n(d.lane||m.key)+" ",1),d.submitted_at||d.updated_at?(a(),o("span",Hs," • "+n(pe(d.submitted_at||d.updated_at)),1)):p("",!0)])]),e("div",Ws,[e("span",Qs,n(d.percent==null?"—":A(d.percent)),1),d.obtained_total!=null&&d.max_total!=null?(a(),o("span",Xs,n(d.obtained_total),1)):p("",!0)])]),e("div",Zs,[d.strengths&&d.strengths.length?(a(),o("div",el,[t[33]||(t[33]=e("div",{class:"font-semibold text-slate-900"},"Strengths",-1)),e("ul",tl,[(a(!0),o(h,null,w(d.strengths,(G,P)=>(a(),o("li",{key:"s-"+P},n(G),1))),128))])])):p("",!0),d.gaps&&d.gaps.length?(a(),o("div",sl,[t[34]||(t[34]=e("div",{class:"font-semibold text-slate-900"},"Gaps",-1)),e("ul",ll,[(a(!0),o(h,null,w(d.gaps,(G,P)=>(a(),o("li",{key:"g-"+P},n(G),1))),128))])])):p("",!0),d.suggestions&&d.suggestions.length?(a(),o("div",nl,[t[35]||(t[35]=e("div",{class:"font-semibold text-slate-900"},"Suggestions",-1)),e("ul",ol,[(a(!0),o(h,null,w(d.suggestions,(G,P)=>(a(),o("li",{key:"u-"+P},n(G),1))),128))])])):p("",!0),(!d.strengths||!d.strengths.length)&&(!d.gaps||!d.gaps.length)&&(!d.suggestions||!d.suggestions.length)?(a(),o("div",al," No comments in this review. ")):p("",!0)])]))),128)),!m.reviewers||m.reviewers.length===0?(a(),o("div",rl," No reviewers found in this lane. ")):p("",!0)])])}),128))]),e("div",{class:"p-4 border-t border-slate-200 bg-white flex items-center justify-end gap-2"},[e("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")])])],32)):p("",!0)]}),_:1})])}}},fl=$e(il,[["__scopeId","data-v-8401f331"]]);export{fl as default};
