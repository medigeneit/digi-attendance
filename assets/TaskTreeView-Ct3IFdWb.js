import{c as l,o as s,F as L,x as A,m as w,p as T,I as W,G as te,q as y,f as m,y as b,a as t,z as se,n as h,t as k,R as re,l as v,L as le,M as ne,B as F,k as X,b as ae,r as H,A as oe,w as _,h as $}from"./index-wfbTXXw4.js";import{g as J}from"./datetime-q3Sn87-f.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as K}from"./UserChip-Cb0m4LL_.js";const ie={class:"mt-3"},de={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick","employeeAssignClick"],setup(e,{emit:a}){const n=a;return(i,o)=>(s(),l("div",ie,[(s(!0),l(L,null,A(e.childrenTasks,(d,g)=>(s(),w(ct,{key:d.id,index:g,task:d,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:o[0]||(o[0]=f=>n("editClick",f)),onAddClick:o[1]||(o[1]=f=>n("addClick",f)),onEmployeeAssignClick:o[2]||(o[2]=f=>n("employeeAssignClick",f))},{"item-end":T(({task:f,level:x})=>[W(i.$slots,"treeItemEnd",{task:f,level:x})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ue=te({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:a}){const n=e,i=y(function(){return n.task.completed_count}),o=y(()=>n.task.children_task_count===0?n.task.status==="COMPLETED"?100:0:i.value/n.task.children_task_count*100),d=y(()=>{const g=o.value;let f,x,u;return g===100?(f="bg-green-50",x="bg-green-200",u="text-green-600 "):g<100&&(f="bg-red-50",x="bg-red-200",u="text-red-600 "),{container:f,bar:x,text:u}});return a({completedPercentage:o.value,completedSubTaskCount:i.value}),(g,f)=>(s(),l("div",null,[g.task.children_task_count>0?(s(),l("div",{key:0,class:b(["rounded-full border py-0.5 relative overflow-hidden h-6",d.value.container]),style:{width:"180px"}},[t("div",{class:b(["z-10 absolute top-0 bottom-0",d.value.bar]),style:se(`width: ${o.value}%`)},null,6),t("span",{class:b(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",d.value.text])},[t("span",null,[t("span",null,k(i.value),1),f[0]||(f[0]=h(" / ")),t("span",null,k(g.task.children_task_count),1)])],2)],2)):m("",!0)]))}}),ce={key:0},fe={__name:"TaskStatus",props:{status:{type:String,required:!0},progressPercent:{type:Number,required:!0}},setup(e){const a=e,n=y(()=>{switch(a.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),i=y(()=>{switch(a.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(o,d)=>(s(),l("div",{class:b(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",n.value])},[t("i",{class:b(i.value)},null,2),t("span",null,k(e.status),1),e.progressPercent!==null||e.progressPercent!==void 0?(s(),l("span",ce,k(e.progressPercent)+"% ",1)):m("",!0)],2))}};function me(e){return Object.entries(e).map(a=>`${a[0]}=${a[1]}`).join("&")}const ke={},ge={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function xe(e,a){return s(),l("span",ge,"IMPORTANT")}const ye=Y(ke,[["render",xe]]),be={class:"relative"},pe={key:0,class:"text-gray-500 text-xs"},ve={class:"border rounded-full size-6 flex justify-center items-center border-blue-300 bg-blue-100"},he={key:0,class:"fas fa-user-cowboy text-blue-500"},we={key:1,class:"fas fa-user-crown text-blue-300"},Te={key:2,class:"text-sm text-gray-500 group/users"},Ce={class:"cursor-pointer hover:underline text-blue-600"},_e={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg z-30"},Q={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:null},isTargetTask:{Boolean,default:!1},listType:{String,default:"employee"}},setup(e){const a=e,n=y(()=>a.users.slice(0,2)),i=y(()=>a.users.slice(2));function o(g){return typeof a.routeTo=="function"?a.routeTo(g):{}}const d=y(()=>typeof a.routeTo=="function"?re:"div");return(g,f)=>(s(),l("div",be,[a.users.length===0?(s(),l("div",pe,k(e.listType=="supervisors"?"No Supervisor assigned":"Not Assigned To Anyone"),1)):(s(!0),l(L,{key:1},A(n.value,(x,u)=>(s(),w(F(d.value),ne({key:u},{ref_for:!0},{...typeof a.routeTo=="function"?{to:o(x)}:{}}),{default:T(()=>[v(K,{class:b(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask," !bg-blue-100":!e.isTargetTask&&e.listType=="employee"&&u===0}]),user:x},le({_:2},[u===0||e.listType=="supervisors"?{name:"after",fn:T(()=>[t("div",ve,[e.listType=="supervisors"?(s(),l("i",he)):(s(),l("i",we))])]),key:"0"}:void 0]),1032,["class","user"])]),_:2},1040))),128)),i.value.length>0?(s(),l("div",Te,[t("div",Ce," + "+k(i.value.length)+" more "+k(e.listType=="employee"?"users":e.listType=="supervisors"?"supervisor":""),1),t("div",_e,[(s(!0),l(L,null,A(i.value,(x,u)=>(s(),w(F(d.value),{key:u,to:o(x),class:"w-full block mb-2"},{default:T(()=>[v(K,{class:b(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:x},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):m("",!0)]))}},$e={class:"col-span-full flex flex-col md:flex-row items-stretched my-2 lg:my-0 justify-center flex-wrap gap-x-1 gap-y-4"},Se={class:"flex flex-col items-center justify-center gap-2 border border-dashed border-blue-100 rounded shadow shadow-blue-50 bg-sky-50 p-3"},Le={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-sky-500 text-white"},Ae={class:"flex flex-col items-center justify-center gap-2 border border-dashed border-blue-100 rounded shadow shadow-blue-50 bg-sky-50 p-3"},Ee={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-blue-500 text-white"},Ne={__name:"TaskSupervisorAndEmployee",props:{treeLevel:{type:Number,required:!0},task:{type:Object,required:!0},employeeRouteTo:{type:Function,default:()=>null}},setup(e){return(a,n)=>{var i,o,d,g;return s(),l("div",$e,[t("div",Se,[e.treeLevel===0?(s(),l("div",Le,k(((o=(i=e.task)==null?void 0:i.from_department)==null?void 0:o.name)||"--"),1)):m("",!0),v(Q,{class:"flex items-center justify-center flex-wrap gap-x-3",users:e.task.supervisors||[],listType:"supervisors"},null,8,["users"])]),n[0]||(n[0]=t("div",null,[t("span",{class:"flex md:hidden text-2xl text-gray-200 items-center justify-center h-full"},[t("i",{class:"fas fa-arrow-alt-down"})]),t("span",{class:"hidden md:flex text-2xl text-gray-200 items-center justify-center h-full"},[t("i",{class:"fas fa-arrow-alt-right"})])],-1)),t("div",Ae,[e.treeLevel===0?(s(),l("div",Ee,k(((g=(d=e.task)==null?void 0:d.to_department)==null?void 0:g.name)||"--"),1)):m("",!0),v(Q,{class:"flex items-center justify-center flex-wrap gap-x-3",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:e.employeeRouteTo},null,8,["users","isTargetTask","routeTo"])])])}}},Re={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(a,n)=>{const i=X("RouterLink");return s(),w(i,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:T(()=>[t("div",null,k(e.task.title),1)]),_:1},8,["to"])}}},je={},Pe={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function Be(e,a){return s(),l("span",Pe,"URGENT")}const qe=Y(je,[["render",Be]]),De={class:"flex w-full"},Oe={key:0,class:"border-l border-gray-200 last:border-l-0"},Ie={class:"items-start grid grid-cols-4 gap-4 group"},Me={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},ze={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},Ue={key:0,class:"text-xl font-semibold text-sky-500"},Ge={key:1,class:"text-sm text-gray-500 mt-2"},Ve={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Fe={class:"flex items-center gap-6 flex-none lg:w-full order-0 lg:order-1"},He={class:"flex gap-4 items-center"},Je={class:"text-gray-500 text-sm"},Ke={class:"text-red-500 text-sm"},Qe={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},We={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4 mt-4"},Xe={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Ye={key:1,class:"text-gray-500"},Ze={class:"font-semibold text-green-800"},et={key:2,class:"ml-4 text-gray-500"},tt={class:"text-red-500 font-semibold"},st={class:"mt-4 col-span-full"},rt={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},lt={class:"text-xs text-gray-500 flex gap-3 order-1 sm:order-0"},nt=["href"],at={class:"flex items-center sm:ml-auto order-0 sm:order-1"},ot={key:0,class:"flex gap-2 ml-4 items-center text-xs"},it=["href"],dt=["href"],ut={class:"ml-0"},ct={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(e,{emit:a}){const n=e,i=ae(),o=H(null),d=a;function g(c){d("addClick",c)}function f(c){d("editClick",c)}function x(c){d("employeeAssignClick",c)}const u=H([]),E=localStorage.getItem("sub_task_opened_list");if(E)try{u.value=JSON.parse(E)}catch{u.value=[]}const N=y(()=>J(n.task.started_at)),R=y(()=>J(n.task.deadline)),C=y({get:()=>u.value.includes(n.task.id),set:c=>{const r=u.value.includes(n.task.id);c&&!r?u.value.push(n.task.id):!c&&r&&(u.value=u.value.filter(S=>S!==n.task.id))}});oe(u,c=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(c))},{deep:!0});const j=y(()=>{var c,r;return((r=(c=n.task)==null?void 0:c.children_tasks)==null?void 0:r.length)>0});function Z(){n.task.children_tasks.length>0&&(C.value=!C.value)}return(c,r)=>{var P,B,q,D,O,I,M,z,U,G,V;const S=X("RouterLink");return s(),l("div",De,[e.treeLevel>0?(s(),l("div",Oe,r[4]||(r[4]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):m("",!0),t("div",{class:b(["flex-grow border-2 rounded py-3 px-3",{"bg-green-100  ":((P=o.value)==null?void 0:P.completedPercentage)===100,"bg-white hover:bg-gray-50":((B=o.value)==null?void 0:B.completedPercentage)<100,"shadow-sm":e.treeLevel>0,"border-sky-500":e.index%2===0,"border-pink-300":e.index%2===1}])},[t("div",Ie,[t("div",Me,[t("div",ze,[e.index!==void 0?(s(),l("div",Ue,k(e.index+1)+". ",1)):m("",!0),v(Re,{task:e.task},null,8,["task"]),(q=e.task)!=null&&q.requirement?(s(),l("p",Ge," Requirement: "+k((O=(D=e.task)==null?void 0:D.requirement)==null?void 0:O.title),1)):m("",!0)]),t("div",Ve,[v(fe,{status:(I=e.task)==null?void 0:I.status,progressPercent:((M=e.task)==null?void 0:M.progress_percent)||0},null,8,["status","progressPercent"]),v(ue,{task:e.task,ref_key:"progress",ref:o,class:"text-sm"},null,8,["task"])]),t("div",Fe,[t("div",He,[e.showDraggableHandle?(s(),l("button",{key:0,onMousedown:r[0]||(r[0]=_((...p)=>c.handleDragging&&c.handleDragging(...p),["stop"])),class:"handle"},r[5]||(r[5]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):m("",!0),t("span",Je," #"+k(e.task.id),1),t("div",Ke,k(e.treeLevel),1)]),t("div",Qe,[(z=e.task)!=null&&z.is_important?(s(),w(ye,{key:0})):m("",!0),(U=e.task)!=null&&U.is_urgent?(s(),w(qe,{key:1})):m("",!0)])])]),v(Ne,{task:e.task,"tree-level":e.treeLevel,"employee-route-to":p=>({query:{...$(i).query,view:"userwise","company-id":p.company_id,"user-ids":p.id}})},null,8,["task","tree-level","employee-route-to"])]),t("div",We,[e.task.is_target?(s(),l("div",Xe," TARGET TASK ")):m("",!0),N.value?(s(),l("span",Ye,[r[6]||(r[6]=h(" Started: ")),t("span",Ze,k(N.value),1)])):m("",!0),R.value?(s(),l("span",et,[r[7]||(r[7]=h(" Deadline: ")),t("span",tt,k(R.value),1)])):m("",!0)]),t("div",st,[t("div",rt,[t("div",lt,[t("button",{class:b([{"text-yellow-600 font-semibold  inline-block  ":j.value},"flex items-center gap-1 group"]),onClick:Z},[t("i",{class:b([C.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:b(j.value?"group-hover:underline":"")}," Sub Tasks ("+k((G=e.task.children_tasks)==null?void 0:G.length)+") ",3)],2),e.treeLevel<2?(s(),l("a",{key:0,href:`/tasks/add?parent_id=${n.task.id}&back-to=${encodeURIComponent($(i).path+"?"+$(me)($(i).query)).toLowerCase()}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:r[1]||(r[1]=_(p=>d("addClick",n.task.id),["stop","prevent"]))},r[8]||(r[8]=[t("i",{class:"fas fa-plus"},null,-1),h(" Add Sub Task ")]),8,nt)):m("",!0)]),t("div",at,[e.hideButtons?m("",!0):(s(),l("div",ot,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:r[2]||(r[2]=_(p=>d("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},r[9]||(r[9]=[t("i",{class:"fas fa-edit"},null,-1),h(" Edit ")]),8,it),t("a",{href:`/tasks/${e.task.id}/assign-users`,onClick:r[3]||(r[3]=_(p=>d("employeeAssignClick",e.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},r[10]||(r[10]=[t("i",{class:"fas fa-users-cog"},null,-1),h(" Manage Employee & Supervisor ")]),8,dt),v(S,{to:{name:"TaskReports",params:{id:(V=e.task)==null?void 0:V.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:T(()=>r[11]||(r[11]=[t("i",{class:"far fa-file-alt"},null,-1),h(" Reports ")])),_:1,__:[11]},8,["to"])]))])]),t("div",ut,[C.value?(s(),w(de,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:f,onAddClick:g,onEmployeeAssignClick:x},{"tree-item-end":T(({task:p,level:ee})=>[W(c.$slots,"item-end",{level:ee,task:p})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):m("",!0)])])],2)])}}};export{ct as _,fe as a,ue as b,Ne as c};
