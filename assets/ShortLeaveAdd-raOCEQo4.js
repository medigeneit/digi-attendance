import{u as H,r as f,p as M,b as R,c as l,a as t,l as T,m as h,w as E,d as r,v as u,A as _,e as y,F as I,x as N,h as $,t as g,f as P,n as j,o as n,k as O,g as W}from"./index-D0JB0D2q.js";import{u as z}from"./short-leave-aTnww5-s.js";import{u as G}from"./user-CFZlRffC.js";import{L as J}from"./LoaderView-C4HG2KBN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"max-w-3xl mx-auto p-4 space-y-4"},Q={class:"flex items-center justify-between gap-2"},X={key:0,class:"text-center"},Y={key:0},Z={key:1},ee=["value"],te={key:2,class:"text-red-500 text-sm"},ie={__name:"ShortLeaveAdd",setup(se){const V=P(),w=W(),D=z(),k=G(),m=H(),{type:p,start_time:b,end_time:x}=V.query,c=new Date().toISOString().split("T")[0],a=f({date:"",start_time:"",end_time:"",reason:"",works_in_hand:"",handover_user_id:"",type:""}),v=f(!1),d=f(null),q=M(()=>{if(a.value.start_time&&a.value.end_time){const o=new Date(`1970-01-01T${a.value.start_time}:00`),i=new Date(`1970-01-01T${a.value.end_time}:00`)-o;return Math.round(i/(1e3*60))}return 0}),S=M(()=>q.value>30),F=async()=>{var o;v.value=!0,d.value=null;try{const e={user_id:(o=m==null?void 0:m.user)==null?void 0:o.id,...a.value},i=await D.createShortLeave(e);w.push({name:"ShortLeaveShow",params:{id:i.id}})}catch(e){d.value=e.message||"Failed to submit short leave application"}finally{v.value=!1}},A=o=>o?o.split(" ")[0]:c,L=o=>{if(!o)return null;const e=o.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!e)return null;let[i,s,B,U]=e;return s=parseInt(s,10),U.toUpperCase()==="PM"&&s<12&&(s+=12),U.toUpperCase()==="AM"&&s===12&&(s=0),`${s.toString().padStart(2,"0")}:${B}`};R(()=>{k.fetchUsers(),a.value.date=A(p==="First"?b:p==="Last"?x:c),a.value.type=p||"",a.value.start_time=L(b)||"",a.value.end_time=L(x)||""});const C=()=>{w.go(-1)};return(o,e)=>{const i=j("RouterLink");return n(),l("div",K,[t("div",Q,[t("button",{class:"btn-3",onClick:C},e[7]||(e[7]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[9]||(e[9]=t("h1",{class:"title-lg flex-wrap text-center"},"Short Leave Application Form",-1)),t("div",null,[T(i,{to:"/my-applications",class:"btn-2"},{default:h(()=>e[8]||(e[8]=[O("Home")])),_:1})])]),v.value?(n(),l("div",X,[T(J)])):(n(),l("form",{key:1,onSubmit:E(F,["prevent"]),class:"space-y-4 card-bg md:p-8 p-4"},[t("div",null,[e[10]||(e[10]=t("label",{for:"date",class:"block text-sm font-medium"},"Date",-1)),r(t("input",{type:"date",id:"date","onUpdate:modelValue":e[0]||(e[0]=s=>a.value.date=s),class:"input-1 w-full",required:""},null,512),[[u,a.value.date]])]),t("div",null,[e[12]||(e[12]=t("label",{for:"type",class:"block text-sm font-medium"},"Type",-1)),r(t("select",{id:"type","onUpdate:modelValue":e[1]||(e[1]=s=>a.value.type=s),class:"input-1 w-full",required:""},e[11]||(e[11]=[t("option",{value:""},"Select Type",-1),t("option",{value:"First"},"First",-1),t("option",{value:"Middle"},"Middle",-1),t("option",{value:"Last"},"Last",-1)]),512),[[_,a.value.type]])]),t("div",null,[e[13]||(e[13]=t("label",{for:"start-time",class:"block text-sm font-medium"},"Start Time",-1)),r(t("input",{type:"time",id:"start-time","onUpdate:modelValue":e[2]||(e[2]=s=>a.value.start_time=s),class:"input-1 w-full",required:""},null,512),[[u,a.value.start_time]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"end-time",class:"block text-sm font-medium"},"End Time",-1)),r(t("input",{type:"time",id:"end-time","onUpdate:modelValue":e[3]||(e[3]=s=>a.value.end_time=s),class:"input-1 w-full",required:""},null,512),[[u,a.value.end_time]])]),t("div",null,[e[15]||(e[15]=t("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),r(t("textarea",{id:"reason","onUpdate:modelValue":e[4]||(e[4]=s=>a.value.reason=s),class:"input-1 w-full",placeholder:"Enter your reason for leave",required:""},null,512),[[u,a.value.reason]])]),S.value?(n(),l("div",Y,[e[16]||(e[16]=t("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),r(t("textarea",{id:"works-in-hand","onUpdate:modelValue":e[5]||(e[5]=s=>a.value.works_in_hand=s),class:"input-1 w-full",placeholder:"Enter details of works in hand"},null,512),[[u,a.value.works_in_hand]])])):y("",!0),S.value?(n(),l("div",Z,[e[18]||(e[18]=t("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),r(t("select",{id:"handover-user","onUpdate:modelValue":e[6]||(e[6]=s=>a.value.handover_user_id=s),class:"input-1 w-full",required:""},[e[17]||(e[17]=t("option",{value:""},"Select Handover User",-1)),(n(!0),l(I,null,N($(k).users,s=>(n(),l("option",{key:s.id,value:s.id},g(s.name),9,ee))),128))],512),[[_,a.value.handover_user_id]])])):y("",!0),d.value?(n(),l("div",te,g(d.value),1)):y("",!0),e[19]||(e[19]=t("div",{class:"flex justify-center"},[t("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{ie as default};
