import{G as j,r as S,x as m,q as z,h as K,c as i,o as l,a as e,i as Y,j as w,t as r,m as k,w as q,d as T,l as D,k as H,v as J,b as E,F as U,e as F,M as Q,s as X}from"./index-BS4VCvrg.js";import{_ as Z}from"./EmployeeFilter-Bsaqbing.js";import{L as ee}from"./LoaderView-CuCscPZh.js";import{U as te}from"./UserHoverBubble-Bx28nfd6.js";import{g as V,m as se,c as oe,b as I,a as ne}from"./datetime-Du_mcDA9.js";import{u as ae}from"./useTodoDateStore-BB7n_pgZ.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-D5IUgxDd.js";import"./department-mK39Hopa.js";import"./EmployeeDropdownInput-4Z5vra6P.js";import"./SelectDropdown-C3FyrMf1.js";import"./UserChip-iO4wpQC2.js";import"./user-BOX6SVvJ.js";import"./url-CePbr-gY.js";const de={class:"container mx-auto print:w-full print:px-0 print:py-0"},le={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},ie={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},pe={key:0,class:"text-gray-400"},me=["disabled"],ue={class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0"},ce={class:"relative h-[32px]"},xe={key:0,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},ye={key:2,class:"space-y-4"},ge={class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},be={class:"text-sm text-gray-700"},ve={class:"font-semibold"},fe={class:"text-sm text-gray-700"},_e={class:"font-semibold"},he={class:"text-sm text-gray-700"},we={class:"font-semibold text-green-600"},ke={class:"text-sm text-gray-700"},Te={class:"font-semibold text-blue-600"},De={class:"text-sm text-gray-700"},Ie={class:"font-semibold text-amber-600"},Ne={key:0,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Me={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},Pe={class:"flex items-center gap-3"},Ce={class:"font-semibold text-gray-800"},Le={class:"text-xs text-gray-500"},Re={class:"text-[11px] text-gray-400"},Se={key:0},Ee={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},Ue={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},Fe={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},Ve={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},$e={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},Ae={class:"overflow-x-auto"},Be={class:"min-w-full text-left text-sm border-separate border-spacing-0"},Ge={key:0},Oe={class:"px-4 py-3 text-center border"},We={class:"px-4 py-3 border"},je={class:"font-semibold text-gray-800"},ze={class:"text-xs text-gray-500"},Ke={class:"px-4 py-3 border text-xs text-gray-700"},Ye={class:"px-4 py-3 border text-center"},qe={__name:"PersonalActivityReportView",setup(He){const g=ae(),a=j({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),u=S(""),N=S(null),x=m(()=>{if(!u.value)return"";const[s,t]=u.value.split("-").map(Number);return!s||!t?"":V(new Date(s,t-1,1))}),y=m(()=>{if(!u.value)return"";const[s,t]=u.value.split("-").map(Number);return!s||!t?"":V(se(new Date(s,t-1,1)))}),M=m(()=>u.value?oe(`${u.value}-01`):""),b=m(()=>x.value&&y.value?`${I(x.value)} ~ ${I(y.value)}`:""),P=m(()=>!!a.companyId&&!!x.value&&!!y.value),$=m(()=>g.todo_dates||[]);function A(s){a.companyId=s.company_id||"",a.departmentId=s.department_id||"",a.employeeId=s.employee_id||"",a.lineType=s.line_type||"all"}function B(s){return s==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":s==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":s==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"}function C(s){var t,n;return s.todo_id||s.todoId||((t=s.todo)==null?void 0:t.id)||((n=s.todo)==null?void 0:n.todo_id)||s.id||`${s.title}-${s.date}`}const L=m(()=>{var s;return((s=N.value)==null?void 0:s.employees)||[]}),G=m(()=>a.employeeId?L.value.filter(s=>String(s.id)===String(a.employeeId)):L.value),v=m(()=>G.value.map(s=>{const t=$.value.filter(o=>{var d;return String(((d=o.user)==null?void 0:d.id)??o.user_id)===String(s.id)}),n={};for(const o of t){const d=C(o),c=n[d],h=new Date(o.date),R=c?new Date(c.date):null;(!c||R&&h>R)&&(n[d]=o)}const p=Object.values(n).sort((o,d)=>new Date(d.date).getTime()-new Date(o.date).getTime()),_={total:p.length,completed:p.filter(o=>o.status==="COMPLETED").length,working:p.filter(o=>o.status==="WORKING").length,pending:p.filter(o=>o.status==="PENDING").length};return{user:s,latestTodos:p,totals:_}}).sort((s,t)=>{var n,p;return(((n=s.user)==null?void 0:n.name)||"").localeCompare(((p=t.user)==null?void 0:p.name)||"")})),f=m(()=>v.value.reduce((s,t)=>({totalTodos:s.totalTodos+t.totals.total,completed:s.completed+t.totals.completed,working:s.working+t.totals.working,pending:s.pending+t.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));async function O(){P.value&&await g.fetchTodoDates({"company-id":a.companyId,"department-id":a.departmentId,"employee-id":a.employeeId,"line-type":a.lineType,"start-date":x.value,"end-date":y.value})}z(()=>[a.companyId,a.departmentId,a.employeeId,a.lineType,x.value,y.value],()=>{O()}),K(()=>{u.value=ne(new Date)});function W(){window.print()}return(s,t)=>(l(),i("div",de,[e("div",le,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),e("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),e("span",ie,[t[5]||(t[5]=e("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),e("span",null,r(M.value),1),b.value?(l(),i("span",pe,"("+r(b.value)+")",1)):w("",!0)]),e("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:q(W,["prevent"]),disabled:k(g).loading,title:"Print"},t[6]||(t[6]=[e("i",{class:"fas fa-print"},null,-1)]),8,me)]),e("div",ue,[T(Z,{ref_key:"employeeFilterRef",ref:N,company_id:a.companyId,"onUpdate:company_id":t[1]||(t[1]=n=>a.companyId=n),department_id:a.departmentId,"onUpdate:department_id":t[2]||(t[2]=n=>a.departmentId=n),employee_id:a.employeeId,"onUpdate:employee_id":t[3]||(t[3]=n=>a.employeeId=n),line_type:a.lineType,"onUpdate:line_type":t[4]||(t[4]=n=>a.lineType=n),onFilterChange:A},{default:D(()=>[e("div",ce,[t[8]||(t[8]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),H(e("input",{id:"month",type:"month","onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[J,u.value]])])]),_:1},8,["company_id","department_id","employee_id","line_type"])]),P.value?k(g).loading?(l(),Y(ee,{key:1},{default:D(()=>t[10]||(t[10]=[E("Loading report...")])),_:1,__:[10]})):(l(),i("div",ye,[e("div",ge,[e("div",be,[t[11]||(t[11]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",ve,r(v.value.length),1)]),e("div",fe,[t[12]||(t[12]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),e("div",_e,r(f.value.totalTodos),1)]),e("div",he,[t[13]||(t[13]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),e("div",we,r(f.value.completed),1)]),e("div",ke,[t[14]||(t[14]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),e("div",Te,r(f.value.working),1)]),e("div",De,[t[15]||(t[15]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),e("div",Ie,r(f.value.pending),1)])]),v.value.length===0?(l(),i("div",Ne," No data available for the selected month. ")):w("",!0),(l(!0),i(U,null,F(v.value,(n,p)=>{var _;return l(),i("div",{key:((_=n.user)==null?void 0:_.id)||p,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[e("div",Me,[T(te,{user:n.user},{trigger:D(({user:o})=>{var d;return[e("div",Pe,[T(Q,{user:o,size:"medium"},null,8,["user"]),e("div",null,[e("div",Ce,r((o==null?void 0:o.name)||"Unknown user"),1),e("div",Le,r(((d=o==null?void 0:o.department)==null?void 0:d.name)||"-"),1),e("div",Re,[E(" Month: "+r(M.value)+" ",1),b.value?(l(),i("span",Se,"("+r(b.value)+")",1)):w("",!0)])])])]}),_:2},1032,["user"]),e("div",Ee,[e("span",Ue," Total "+r(n.totals.total),1),e("span",Fe," Done "+r(n.totals.completed),1),e("span",Ve," Working "+r(n.totals.working),1),e("span",$e," Pending "+r(n.totals.pending),1)])]),e("div",Ae,[e("table",Be,[t[17]||(t[17]=e("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[e("tr",{class:"border-b"},[e("th",{class:"px-4 py-3 border text-center w-12"},"sl"),e("th",{class:"px-4 py-3 border text-left"},"Todo"),e("th",{class:"px-4 py-3 border text-left"},"Last Activity Date"),e("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),e("tbody",null,[n.latestTodos.length===0?(l(),i("tr",Ge,t[16]||(t[16]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-400"}," No activity recorded for this month. ",-1)]))):w("",!0),(l(!0),i(U,null,F(n.latestTodos,(o,d)=>{var c,h;return l(),i("tr",{key:C(o),class:"border-b"},[e("td",Oe,r(d+1),1),e("td",We,[e("div",je,r(o.title),1),e("div",ze,r(((h=(c=o.todo)==null?void 0:c.todoable)==null?void 0:h.title)||""),1)]),e("td",Ke,r(k(I)(o.date)||o.date),1),e("td",Ye,[e("span",{class:X(["text-xs font-semibold px-2.5 py-1 rounded-full",B(o.status)])},r(o.status||"N/A"),3)])])}),128))])])])])}),128))])):(l(),i("div",xe,t[9]||(t[9]=[e("i",{class:"fad fa-tasks text-4xl"},null,-1),e("div",{class:"empty-state glass-panel"},[e("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),e("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)])))]))}},pt=re(qe,[["__scopeId","data-v-4d45fd4c"]]);export{pt as default};
