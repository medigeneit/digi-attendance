import{d as F,u as U,b as B,r as y,y as w,e as D,c as r,o as s,a as t,f as S,k as c,s as L,h as M,v as V,F as $,q as I,t as p,g as R}from"./index-Dxc5EEcs.js";import{_ as E}from"./EmployeeFilter-CYDqYjva.js";import{L as O}from"./LoaderView-BcM1hLIT.js";import{u as Q,_ as j}from"./UpdateOrCreate-DQXF3Qe6.js";import"./company-ED4wwEHa.js";import"./department-DTxlX0oD.js";import"./SelectDropdown-BOLxy_Jy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-EBDAdyaN.js";import"./TimePickerAsFloatHour-D6ZImAZD.js";const H={class:"px-4 space-y-4"},J={class:"flex items-center justify-between gap-2"},K={class:"flex flex-wrap gap-4 items-center"},z={key:1},G={class:"table-auto w-full border mt-4 text-sm"},W={class:"p-2"},X={class:"p-2"},Y={class:"p-2"},Z={class:"p-2"},ee={class:"p-2"},te={class:"p-2 text-center flex gap-2"},ae=["onClick"],le={key:2,class:"text-red-500 text-sm text-center"},ne={key:3,class:"text-gray-400 text-sm text-center"},ve={__name:"PayCutList",setup(oe){const P=F(),g=U(),i=B(),d=Q(),o=y(i.query.month||new Date().toISOString().slice(0,7)),e=y({company_id:i.query.company_id||"",department_id:i.query.department_id||"",type:i.query.type||"all",employee_id:i.query.employee_id||""}),m=y(!1);async function _(){if(!o.value||!e.value.company_id){d.paycuts=[];return}const l={month:o.value,company_id:String(e.value.company_id)};e.value.employee_id&&(l.user_id=String(e.value.employee_id)),m.value=!0;try{await d.fetchPaycuts(l)}finally{m.value=!1}}function q(){const l={};return o.value&&(l.month=String(o.value)),e.value.company_id&&(l.company_id=String(e.value.company_id)),e.value.department_id&&(l.department_id=String(e.value.department_id)),e.value.employee_id&&(l.employee_id=String(e.value.employee_id)),e.value.type&&e.value.type!=="all"&&(l.type=String(e.value.type)),l}let f=null;function C(){f&&clearTimeout(f),f=setTimeout(()=>{const l=q();g.replace({query:l}).catch(()=>{})},120)}let v=null;const x=y("");async function N(){C();const l=JSON.stringify({m:o.value||"",c:e.value.company_id||"",d:e.value.department_id||"",t:e.value.type||"all",e:e.value.employee_id||""});l!==x.value&&(await _(),x.value=l)}function h(){v&&clearTimeout(v),v=setTimeout(N,200)}w(()=>({...e.value,month:o.value}),()=>h(),{deep:!0}),w(()=>i.query,l=>{const a=l.month||"";a!==o.value&&(o.value=a);const n={company_id:l.company_id||"",department_id:l.department_id||"",type:l.type||"all",employee_id:l.employee_id||""},u=e.value;(n.company_id!==u.company_id||n.department_id!==u.department_id||n.type!==u.type||n.employee_id!==u.employee_id)&&(e.value=n)}),D(async()=>{h()});function T(){h()}async function A(l){confirm("Are you sure you want to delete this paycut?")&&(await d.deletePaycut(l),await _())}return(l,a)=>(s(),r("div",H,[t("div",J,[t("button",{type:"button",class:"btn-3",onClick:a[0]||(a[0]=n=>c(g).go(-1))},a[6]||(a[6]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),a[7]||(a[7]=t("h1",{class:"title-md md:title-lg text-center"},"Monthly Paycut",-1)),a[8]||(a[8]=t("div",null,null,-1))]),t("div",K,[L(E,{company_id:e.value.company_id,"onUpdate:company_id":a[1]||(a[1]=n=>e.value.company_id=n),department_id:e.value.department_id,"onUpdate:department_id":a[2]||(a[2]=n=>e.value.department_id=n),employee_id:e.value.employee_id,"onUpdate:employee_id":a[3]||(a[3]=n=>e.value.employee_id=n),category:e.value.type,"onUpdate:category":a[4]||(a[4]=n=>e.value.type=n),"with-type":!0,"initial-value":l.$route.query,onFilterChange:T,class:"w-full"},null,8,["company_id","department_id","employee_id","category","initial-value"]),t("div",null,[M(t("input",{type:"month","onUpdate:modelValue":a[5]||(a[5]=n=>o.value=n),class:"input-1"},null,512),[[V,o.value]])])]),m.value?(s(),S(O,{key:0})):c(d).paycuts.length?(s(),r("div",z,[t("table",G,[a[10]||(a[10]=t("thead",{class:"bg-gray-100 text-left"},[t("tr",null,[t("th",{class:"p-2"},"#"),t("th",{class:"p-2"},"Employee"),t("th",{class:"p-2"},"Paycut Hours"),t("th",{class:"p-2"},"Reason"),t("th",{class:"p-2"},"Note"),t("th",{class:"p-2 text-center"},"Actions")])],-1)),t("tbody",null,[(s(!0),r($,null,I(c(d).paycuts,(n,u)=>{var b,k;return s(),r("tr",{key:n.id,class:"border-t"},[t("td",W,p(u+1),1),t("td",X,p(((b=n.user)==null?void 0:b.name)||"N/A"),1),t("td",Y,p(n.paycut_hours),1),t("td",Z,p(n.reason||"-"),1),t("td",ee,p(n.note||"-"),1),t("td",te,[((k=c(P).user)==null?void 0:k.id)===8?(s(),S(j,{key:0,userId:n.user_id,month:o.value,onUpdated:_},null,8,["userId","month"])):R("",!0),t("button",{type:"button",class:"text-red-500",onClick:se=>A(n.id)},a[9]||(a[9]=[t("i",{class:"fa fa-trash"},null,-1)]),8,ae)])])}),128))])])])):e.value.company_id?(s(),r("p",ne," No paycuts found for the selected filters. ")):(s(),r("p",le," Please select a company to load paycut data. "))]))}};export{ve as default};
