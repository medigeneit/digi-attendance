import{d as tt,b as et,m as w,r as A,c as n,o as s,a as t,g as v,G as Q,F as q,k as u,w as E,t as g,q as C,i as U,s as Y,f as I,h as st,C as Tt,H as xt,e as at,I as $t,x as nt,j as P,v as gt,n as J,J as St,D as ft,p as O,u as Ct,z as yt}from"./index-DNfawfJ5.js";import{L as X}from"./LoaderView-2C0aCiI3.js";import{O as W}from"./OverlyModal-Ce98cjCd.js";import{u as wt,m as Dt,r as It,d as Et,a as Pt}from"./task-priority-Cgzikst2.js";import{_ as Lt}from"./TaskAddForm-CMoezqM3.js";import{_ as Ut}from"./TaskEditForm-pZ5iHpCw.js";import{_ as At}from"./TaskTreeView-BGwbStAf.js";import{a as Mt,_ as Nt}from"./TaskUserAssignForm-DIftXVQa.js";import{b as Ot,c as jt,e as Rt,T as Ft,d as Bt}from"./TaskUrgentBadge-B76YyUIo.js";import{a as Z,g as Gt,b as Vt}from"./datetime-DLUp6MRA.js";import{_ as vt}from"./UserChip-Dr_UQVgQ.js";import{u as qt}from"./useTaskStore-BWtMmsZ8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./url-CePbr-gY.js";import"./RequiredIcon-LppvgGY-.js";import"./company-DELGivwR.js";import"./useRequirementStore-Di9KYLwU.js";import"./requirement-BAlHvb89.js";import"./CompanyDepartmentSelectInput-CwSN4Hpx.js";import"./SectionLoading-BML7c2_c.js";import"./TextWithHr-CKvWtGES.js";import"./TaskUrgencyInput-BVTKBE8m.js";import"./tags-Cb8ud4Ud.js";import"./MultiselectDropdown-CP_C8vM6.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-D_Gvm7oL.js";import"./TaskUserChip-CQQS2EOp.js";const Ht={class:"mb-3"},zt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Wt={key:1,class:"text-center py-4 text-gray-500"},Zt={key:2,class:"text-center py-4 text-red-500"},Kt={key:3,class:"space-y-4"},Jt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(m,{emit:a}){const e=m,c=tt(),i=et(),o=w(()=>{var f;return!!(((f=c==null?void 0:c.user)==null?void 0:f.role)!=="employee"&&(c!=null&&c.isAdminMood))}),b=a,x=A(null),{handleItemsPriorityUpdate:l,saveTaskPriority:p,listHasRearranged:k}=wt(()=>e.tasks,e.parentId),T=async()=>{await p(),b("updatePriority")};return(f,_)=>(s(),n("div",null,[t("div",Ht,[Q(f.$slots,"task:header")]),o.value?(s(),n(q,{key:0},[u(k)?(s(),n("div",zt,[_[4]||(_[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:E(T,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:_[0]||(_[0]=E((...$)=>x.value.resetItems&&x.value.resetItems(...$),["prevent"]))},"Discard")])):v("",!0)],64)):v("",!0),m.loading?(s(),n("div",Wt,"Loading tasks...")):m.error?(s(),n("div",Zt,g(m.error),1)):(s(),n("div",Kt,[C(Mt,{items:m.tasks,handle:"handle",onItemsUpdate:u(l),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:x},{item:U(({item:$,index:M})=>[C(At,{isMyTask:u(i).name=="MyTaskShow",index:M,task:$,showDraggableHandle:o.value,"tree-level":m.treeLevel,class:"!border-0",onCommentButtonClick:D=>b("commentButtonClick",$.id),onEditClick:_[1]||(_[1]=D=>b("editClick",D)),onAddClick:_[2]||(_[2]=D=>b("addClick",D)),onEmployeeAssignClick:_[3]||(_[3]=D=>b("employeeAssignClick",D))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Yt={class:"flex justify-between mt-5"},Qt={class:"flex justify-between items-center"},Xt={class:"w-32 relative h-8 mx-4"},te={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},ee={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(m,{emit:a}){const e=m,c=et(),i=tt(),o=Y({taskId:0,isOpen:!1}),b=A("not-completed"),x=a,l=A(),p=Y({show:!1,parentId:e.parentId,requirementId:null}),k=D=>{p.show=!0,p.parentId=D,console.log({addForm:p})};function T(){p.show=!1,p.parentId=e.parentId,x("created")}function f(){x("assignUser")}function _(){l.value=!1,x("updated")}function $(){p.show=!1,p.parentId=e.parentId}const M=w(()=>{var D;return Array.isArray(e.subTasks)?Dt(e.subTasks,{status:b.value,...c.name=="MyTaskShow"?{"user-ids":(D=i==null?void 0:i.user)==null?void 0:D.id}:{}}):[]});return(D,y)=>(s(),n("div",null,[l.value?(s(),I(W,{key:0},{default:U(()=>[C(Ut,{taskId:l.value,onClose:y[0]||(y[0]=r=>l.value=null),onUpdated:_},null,8,["taskId"])]),_:1})):v("",!0),p.show?(s(),I(W,{key:1},{default:U(()=>[C(Lt,{parentTaskId:p.parentId,requirementId:p.requirementId,onTaskCreated:T,onError:D.handleTaskError,onClose:$},null,8,["parentTaskId","requirementId","onError"])]),_:1})):v("",!0),o.isOpen?(s(),I(W,{key:2},{default:U(()=>[C(Nt,{taskId:o.taskId,onCancelClick:y[1]||(y[1]=()=>{o.isOpen=!1,o.taskId=0}),onSuccess:y[2]||(y[2]=()=>{o.isOpen=!1,o.taskId=0,f()})},null,8,["taskId"])]),_:1})):v("",!0),C(Jt,{tasks:M.value,parentId:m.parentId,treeLevel:m.treeLevel,onAddClick:y[5]||(y[5]=r=>k(r)),onEditClick:y[6]||(y[6]=r=>l.value=r),onUpdatePriority:y[7]||(y[7]=r=>x("updatePriority")),onEmployeeAssignClick:y[8]||(y[8]=r=>{o.taskId=r,o.isOpen=!0})},{"task:header":U(()=>[t("div",Yt,[t("div",Qt,[y[11]||(y[11]=t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks",-1)),t("div",Xt,[y[10]||(y[10]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),st(t("select",{"onUpdate:modelValue":y[3]||(y[3]=r=>b.value=r),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},y[9]||(y[9]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[Tt,b.value]])])]),m.subTaskIsCreatable?(s(),n("div",te,[t("button",{class:"btn-1 ml-auto",onClick:y[4]||(y[4]=E(()=>k(m.parentId),["prevent"]))}," Add Sub Task ")])):v("",!0)])]),_:1},8,["tasks","parentId","treeLevel"])]))}},se={key:0},ae={key:0},ne={key:1},le={key:2},oe={key:3},re={key:1},ie=xt({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(m){const a=m;let e=0;const c=A(b());let i;function o(){return a.millisecond&&typeof a.millisecond=="number"}function b(){o()?e&&(e-=1e3):e=new Date(a.targetDateTime).getTime()-new Date().getTime();const f=Math.floor(e/1e3%60),_=Math.floor(e/1e3/60%60),$=Math.floor(e/(1e3*60*60)%24),M=Math.floor(e/(1e3*60*60*24));return{total:e,days:M,hours:$,minutes:_,seconds:f}}function x(){c.value=b()}at(()=>{o()&&(e=a.millisecond),console.log("MOUNTED"),x(),i=setInterval(()=>{x(),c.value.total<=0&&clearInterval(i)},1e3)}),$t(()=>clearInterval(i)),nt(()=>a.targetDateTime,()=>{x(),clearInterval(i)});const l=w(()=>c.value.days.toString().padStart(2,"0")),p=w(()=>c.value.hours.toString().padStart(2,"0")),k=w(()=>c.value.minutes.toString().padStart(2,"0")),T=w(()=>c.value.seconds.toString().padStart(2,"0"));return(f,_)=>c.value.total>0?(s(),n("span",se,[!f.hideIfZeroValue||l.value!="00"?(s(),n("span",ae,g(l.value)+"d : ",1)):v("",!0),!f.hideIfZeroValue||p.value!="00"?(s(),n("span",ne,g(p.value)+"h : ",1)):v("",!0),!f.hideIfZeroValue||k.value!="00"?(s(),n("span",le,g(k.value)+"m : ",1)):v("",!0),!f.hideIfZeroValue||T.value!="00"?(s(),n("span",oe,g(T.value)+"s",1)):v("",!0)])):(s(),n("span",re,[Q(f.$slots,"expired")]))}}),de={class:"mb-2 mt-6"},ue={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},ce={class:"flex justify-center"},pe={class:"py-6 w-full text-center"},ke={class:"block mb-2"},me={class:"font-semibold text-red-600 mx-2 text-xl"},fe={class:"mt-2"},ye={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},ve={class:"flex justify-between items-center"},be={key:0,class:"btn-2-red"},xe={key:1,class:"btn-2-red"},bt=5e3,ge={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(m,{emit:a}){const e=m,c=A(""),i=A(""),o=a,b=A("");let x=0;async function l(){var T,f;if(!c.value)return b.value="Type the task title on input box";clearTimeout(x);try{b.value="",i.value==="deleted"?(i.value="restoring",await It(e.task.id),i.value="restored"):(i.value="deleting",await Et(e.task.id,{params:{security_check:c.value}}),i.value="deleted"),i.value=="deleted"?x=setTimeout(()=>{k()},bt):o("closeClick")}catch(_){i.value="error",b.value=((f=(T=_.response)==null?void 0:T.data)==null?void 0:f.message)||`Failed to update ${e.type}`}}function p(){i.value==="deleted"&&k(),o("closeClick")}function k(){i.value="",o("delete")}return(T,f)=>{var _,$;return s(),n("form",{class:"p-4 relative",onSubmit:E(l,["prevent"])},[f[7]||(f[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",de,[f[1]||(f[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,g((_=m.task)==null?void 0:_.title),1)]),i.value=="deleted"?(s(),n("div",ue,f[2]||(f[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(s(),n(q,{key:1},[t("div",ce,[t("div",pe,[t("label",ke,[f[3]||(f[3]=P(" Type ")),t("span",me,g(($=m.task)==null?void 0:$.title),1),f[4]||(f[4]=P(" and submit to delete "))]),st(t("input",{type:"text","onUpdate:modelValue":f[0]||(f[0]=M=>c.value=M),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[gt,c.value]])])]),f[5]||(f[5]=t("hr",null,null,-1)),t("div",fe,[b.value?(s(),n("div",ye,g(b.value),1)):v("",!0)])],64)),t("div",ve,[t("button",{class:"btn-3",type:"button",onClick:E(p,["prevent"])},"Close"),i.value=="deleted"?(s(),n("button",be,[f[6]||(f[6]=P(" Undo Delete in ")),i.value=="deleted"?(s(),I(ie,{key:0,"hide-if-zero-value":!0,millisecond:bt})):v("",!0)])):(s(),n("button",xe,"Delete"))]),i.value=="deleting"||i.value=="restoring"?(s(),I(X,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:U(()=>[P(g(String(i.value).charAt(0).toUpperCase()+String(i.value).slice(1)),1)]),_:1})):v("",!0)],32)}}},_e=m=>m==null?void 0:m.reduce((a,e)=>a+e.task_weight,0),_t=(m,a)=>{const e=_e(m);return m.map(c=>{const i=a.filter(o=>o.user_id===c.id).reduce((o,b)=>o+b.progress,0);return{...c,task_progress:Math.floor(i*(c.task_weight/e)),user_progress:i}})},he=(m,a)=>{let e=0;const c=[],i=x=>x.status==="COMPLETED",o=x=>x.users.some(l=>l.id===a),b=(x,l)=>{x.forEach(p=>{const k=o(p);c[l]=c[l]||{user_id:a,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const T=k&&p.children_tasks.length===0;c[l].total_assigned+=k?1:0,c[l].total_assigned_on_leaf_task+=T?1:0,e+=T?1:0,k&&i(p)&&(c[l].completed_count++,p.children_tasks.length),p.children_tasks.length>0&&b(p.children_tasks,l+1)})};return b(m,0),{sub_task_infos:c,assigned_on_any_leaf_task:e>0}},Te=(m,a)=>m.map(e=>({...e,...he(a,e.id)})),$e={key:0,class:"min-w-full bg-white rounded overflow-hidden"},Se={class:"py-0.5 text-bg font-semibold"},Ce={class:"bg-gray-50"},we={class:"px-2 py-1 border-y"},De={class:"px-2 py-1 border-y"},Ie={key:0,class:"text-sm text-gray-400"},Ee={key:1},Pe={key:1,class:"min-w-full bg-white rounded overflow-hidden"},Le={class:"py-0.5 text-bg font-semibold"},Ue={class:"px-2 py-1 border-y text-center"},Ae={class:"px-2 py-1 border-y border-r"},Me={class:"px-2 py-1 border-y text-center"},Ne={class:"px-2 py-1 border-y text-center"},Oe=xt({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(m){const a=m,e=w(()=>_t(a.task.users,a.task.task_reports||[])),c=w(()=>Te(a.task.users,a.subTasks));return(i,o)=>{var b,x;return a.task.children_task_count>0?(s(),n("table",$e,[t("caption",Se,[Q(i.$slots,"caption",{},()=>[o[0]||(o[0]=P("Progress"))])]),t("thead",Ce,[t("tr",null,[o[1]||(o[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),o[2]||(o[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(s(!0),n(q,null,J(((x=(b=c.value[0]||{})==null?void 0:b.sub_task_infos)==null?void 0:x.length)||1,l=>(s(),n("th",{key:l,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},g(l===1?"Completed Sub Task":"")+" "+g(l===2?"Completed Sub Sub Task":"")+" "+g(l===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(s(!0),n(q,null,J(c.value,(l,p)=>(s(),n("tr",{key:l.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",we,g(p+1),1),t("td",De,[C(vt,{user:l},null,8,["user"])]),(s(!0),n(q,null,J(l.sub_task_infos,(k,T)=>(s(),n("td",{class:"px-2 py-1 border-y text-center",key:T},[k.total_assigned===0||!l.assigned_on_any_leaf_task?(s(),n("div",Ie," Not Assigned To Any Task ")):(s(),n("div",Ee,g(k.completed_count)+" / "+g(k.total_assigned),1))]))),128))]))),128))])])):(s(),n("table",Pe,[t("caption",Le,[Q(i.$slots,"caption",{},()=>[o[3]||(o[3]=P("Progress"))])]),o[4]||(o[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(s(!0),n(q,null,J(e.value,(l,p)=>(s(),n("tr",{key:l.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ue,g(p+1),1),t("td",Ae,[C(vt,{user:l},null,8,["user"])]),t("td",Me,g(u(Z)(l.task_started_at)),1),t("td",Ne,g(u(Z)(l.task_finished_at)),1)]))),128))])]))}}}),je=St("task-user",()=>({updateUserStartDate:async(e,c,i)=>await ft.patch(`/task-user/task/${e}/user/${c}/update-start-date/${i}`),updateUserFinishDate:async(e,c,i)=>await ft.patch(`/task-user/task/${e}/user/${c}/update-finish-date/${i}`)})),Re={class:"border-b text-center"},Fe={key:0},Be={key:1},Ge={class:"text-center font-semibold text-blue-800 my-4"},Ve={class:"flex justify-center w-full"},qe={class:"py-6 w-4/12"},He={class:"block text-xs font-semibold"},ze={class:"mt-3"},We={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Ze={class:"flex justify-between items-center"},ht={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(m,{emit:a}){const e=m,c=a,i=je(),o=A(""),b=A("");async function x(){var p,k;console.log({date:o.value});try{e.type=="start-date"?await i.updateUserStartDate(e.task.id,e.user.id,o.value||"0"):e.type=="finish-date"&&await i.updateUserFinishDate(e.task.id,e.user.id,o.value||"0"),c("updateDate")}catch(T){b.value=((k=(p=T.response)==null?void 0:p.data)==null?void 0:k.message)||`Failed to update ${e.type}`}}function l(p){if(p){const k=e.type==="start-date"?p.started_at:p.completed_at;o.value=Gt(k)}}return nt(()=>e.task,p=>{l(p)},{immediate:!0}),at(()=>{l(e.task)}),(p,k)=>(s(),n("form",{class:"p-4",onSubmit:E(x,["prevent"])},[t("div",Re,[m.type=="start-date"?(s(),n("h2",Fe,"Edit Start Date")):m.type=="finish-date"?(s(),n("h2",Be,"Edit Completed Date")):v("",!0)]),t("div",Ge,g(m.task.title),1),t("div",Ve,[t("div",qe,[t("label",He,g(m.type=="start-date"?"Start date":"Completed date"),1),st(t("input",{type:"date","onUpdate:modelValue":k[0]||(k[0]=T=>o.value=T),class:"border py-2 px-4 rounded-md w-full"},null,512),[[gt,o.value]])])]),k[3]||(k[3]=t("hr",{class:"mt-4"},null,-1)),t("div",ze,[b.value?(s(),n("div",We,g(b.value),1)):v("",!0)]),t("div",Ze,[t("button",{class:"btn-3",onClick:k[1]||(k[1]=E(T=>c("closeClick"),["prevent"]))},"Close"),k[2]||(k[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},Ke={key:0},Je={key:1,class:"flex"},Ye={class:"border-r-2 border-dashed pr-6 border-gray-300"},Qe={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Xe={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},ts={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},es={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},ss={key:0},as=["disabled"],ns=["disabled"],ls={class:"text-lg font-semibold text-gray-700"},os={class:"text-sm text-gray-500"},rs={class:"flex flex-grow justify-center items-center"},is={key:0,class:"flex flex-col justify-center items-center"},ds={key:1},us={key:1},cs={key:2,class:"flex justify-center items-center flex-col"},ps={key:3,class:"flex flex-col justify-center items-center"},ks={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},ms={class:"my-6"},fs={class:"text-center font-semibold text-blue-800 mb-4"},ys={class:"text-center my-1"},vs={class:"border px-2 rounded-md bg-gray-50"},bs={class:"text-red-600 text-center mt-2 text-sm"},xs={class:"flex justify-between mt-3"},gs={class:"btn-2"},_s={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(m,{emit:a}){const e=m,c=a,i=tt(),o=A(""),b=A(),x=A(),l=Y({user:null,type:""});function p(S){l.user=i.user,l.type=S}const k={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},T=w(()=>(k==null?void 0:k[_.value])||0),f=w(()=>{var S;return{"bg-yellow-50":_.value==="IN_PROGRESS","bg-green-50":_.value==="COMPLETED","bg-red-50":_.value==="PENDING","bg-blue-50":(S=e.task)==null?void 0:S.closed_at}}),_=w(()=>{var S;return(S=e.task)==null?void 0:S.status}),$=w(()=>_.value=="PENDING"?"Start":_.value=="IN_PROGRESS"?"Finish":_.value=="COMPLETED"?"Close":""),M=w(()=>$.value=="Start"?"Start Task":$.value=="Finish"?"Finish Task":$.value=="Close"?"Close Task":"");async function D(){var S,d;b.value="submitting";try{await Pt(e.task.id,{status:o.value}),o.value="",c("updateStatus")}catch(N){x.value=(d=(S=N.response)==null?void 0:S.data)==null?void 0:d.message,c("error")}finally{b.value=""}}const y=w(()=>$.value=="Start"?"fas fa-play-circle text-blue-500":$.value=="Finish"?"fas fa-stop-circle text-blue-500":""),r=w(()=>{var S,d,N,j,R,F,h,B,G,V;return[{date:Z(((S=e.task)==null?void 0:S.assigned_at)||((d=e.task)==null?void 0:d.created_at)),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((N=e.task)!=null&&N.assigned_at)||!!((j=e.task)!=null&&j.created_at)},{date:Z((R=e.task)==null?void 0:R.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((F=e.task)!=null&&F.started_at)||T.value>=k.IN_PROGRESS},{date:Z((h=e.task)==null?void 0:h.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((B=e.task)!=null&&B.completed_at)||T.value>=k.COMPLETED},{date:Z((G=e.task)==null?void 0:G.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((V=e.task)!=null&&V.deadline)}].sort((H,z)=>H.date===null||z.date===null||new Date(H.date)==new Date(z.date)?H.serial-z.serial:new Date(H.date)-new Date(z.date))});return(S,d)=>{var N,j,R,F;return s(),n("div",{class:O(["border py-8 px-4 rounded",f.value])},[_.value==="BLOCKED"?(s(),n("div",Ke,d[8]||(d[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(s(),n("div",Je,[t("div",Ye,[(N=e.task)!=null&&N.is_target?(s(),n("div",Qe,d[9]||(d[9]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),P(" TARGET TASK ")]))):v("",!0),t("ol",Xe,[(s(!0),n(q,null,J(r.value,(h,B)=>{var G,V;return s(),n("li",{class:"ml-5",key:B},[t("div",ts,[h.active?(s(),n("i",{key:0,class:O([h.icon,"text-xs"])},null,2)):v("",!0)]),t("div",{class:O({"opacity-30":!h.active})},[t("div",es,[h.date?(s(),n("span",ss,g(h.date),1)):v("",!0),((G=e.task)==null?void 0:G.children_task_count)===0&&h.status==="started"&&h.active?(s(),n("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:d[0]||(d[0]=E(()=>p("start-date"),["prevent"])),disabled:!!e.task.closed_at},g(h.date?"Edit":"Set Date"),9,as)):v("",!0),((V=e.task)==null?void 0:V.children_task_count)===0&&h.active&&h.status==="completed"?(s(),n("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:d[1]||(d[1]=E(()=>p("finish-date"),["prevent"])),disabled:!!e.task.closed_at},g(h.date?"Edit":"Set Date"),9,ns)):v("",!0)]),t("h3",ls,g(h.title),1),t("p",os,g(h.description),1)],2)])}),128))])]),t("div",rs,[(j=m.task)!=null&&j.closed_at?(s(),n("div",is,d[10]||(d[10]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):_.value==="PENDING"?(s(),n("div",ds,[((R=m.task)==null?void 0:R.children_task_count)===0?(s(),n("button",{key:0,class:"btn-3 mt-2",onClick:d[2]||(d[2]=E(h=>o.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(s(),n("div",us,d[11]||(d[11]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),t("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):_.value==="IN_PROGRESS"?(s(),n("div",cs,[d[12]||(d[12]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),d[13]||(d[13]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((F=m.task)==null?void 0:F.children_task_count)===0?(s(),n("button",{key:0,class:"btn-3",onClick:d[3]||(d[3]=E(h=>o.value="COMPLETED",["prevent"]))}," Finish Task ")):v("",!0)])):_.value==="COMPLETED"?(s(),n("div",ps,[d[14]||(d[14]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),d[15]||(d[15]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:d[4]||(d[4]=E(h=>o.value="CLOSED",["prevent"]))},"Close Task")])):v("",!0)])])),o.value?(s(),I(W,{key:2},{default:U(()=>{var h;return[t("form",{class:"p-4 rounded relative",onSubmit:E(D,["prevent"])},[b.value==="submitting"?(s(),I(X,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:U(()=>d[16]||(d[16]=[P("Submitting!")])),_:1,__:[16]})):v("",!0),t("h3",ks,g(M.value),1),t("div",ms,[t("div",fs,g((h=m.task)==null?void 0:h.title),1),d[19]||(d[19]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",ys,[d[17]||(d[17]=P(" Want to ")),t("span",vs,[t("i",{class:O(["text-sm",y.value])},null,2),P(" "+g($.value),1)]),d[18]||(d[18]=P(" the task? "))])]),d[20]||(d[20]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",bs,g(x.value),1),t("div",xs,[t("button",{class:"btn-3",onClick:d[5]||(d[5]=E(B=>o.value="",["prevent"]))},"Cancel"),t("button",gs,[t("i",{class:O(["text-xl text-white",y.value])},null,2),P(" "+g($.value)+" Task ",1)])])])],32)]}),_:1})):v("",!0),l!=null&&l.user?(s(),I(W,{key:3},{default:U(()=>[C(ht,{task:e.task,user:l.user,type:l.type,onCloseClick:d[6]||(d[6]=h=>l.user=null),onUpdateDate:d[7]||(d[7]=()=>{l.user=null,l.type=null,c("updateStatus")})},null,8,["task","user","type"])]),_:1})):v("",!0)],2)}}},hs={class:"container mx-auto p-6"},Ts={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},$s={class:"grid grid-cols-4"},Ss={class:"mb-4 flex col-span-full"},Cs={class:"font-medium text-xl"},ws={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},Ds={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-2 py-[2px] rounded-full border border-green-200 opacity-80"},Is={class:"text-gray-400 text-xs mt-2 col-span-full"},Es={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},Ps={class:"col-span-full mb-4"},Ls=["innerHTML"],Us={key:0,class:"mt-4 col-span-full mb-6"},As={class:"mt-6 py-2 flex justify-center items-center gap-2 col-span-full"},Ms=["disabled"],Ns={class:"ml-auto flex gap-4"},Os={key:0},js={key:1},Rs={key:1,class:"text-center py-4 text-red-500"},pa={__name:"TaskShow",setup(m){const a=qt(),e=et(),c=Ct(),i=A(""),o=w(()=>a.tasks),b=A({}),x=Y({open:!1,task:null}),l=A(!0);at(async()=>{i.value="loading",await k(e.params.id),i.value=""});const p=Y({user:null,type:""});async function k(y){await a.fetchTask(y)}const T=w(()=>_t(a.task.users,a.task.task_reports||[]));async function f(){await k(e.params.id),p.user=null,p.type=""}const _=y=>{c.push({name:"TaskEdit",params:{id:y}})},$=w(()=>{var y,r;return a.task?((y=a.task)==null?void 0:y.parent_id)==0?{name:e.name==="MyTaskShow"?"MyTaskList":"TaskList"}:{params:{id:(r=a.task)==null?void 0:r.parent_id}}:null});function M(){x.open=!0,x.task=a.task}function D(){x.open=!1,console.log({STATE:"Deleted",backLink:$.value}),c.push($.value)}return nt(()=>e.params.id,async y=>{i.value="changing",await k(y),i.value=""}),(y,r)=>{var N,j,R,F,h,B,G,V,H,z,lt,ot,rt,it,dt,ut,ct,pt,kt;const S=yt("RouterLink"),d=yt("router-view");return s(),n("div",hs,[p.user?(s(),I(W,{key:0},{default:U(()=>[C(ht,{task:u(a).task,user:p.user,type:p.type,onCloseClick:r[0]||(r[0]=L=>p.user=null),onUpdateDate:f},null,8,["task","user","type"])]),_:1})):v("",!0),x.open?(s(),I(W,{key:1},{default:U(()=>[C(ge,{onCloseClick:r[1]||(r[1]=L=>x.open=!1),task:x.task,onDelete:D},null,8,["task"])]),_:1})):v("",!0),i.value==="loading"?(s(),I(X,{key:2})):(s(),n("div",Ts,[u(a).task?(s(),n(q,{key:0},[t("section",$s,[t("div",Ss,[t("div",null,[t("h2",Cs,g(u(a).task.title),1),t("div",ws,[u(a).task.parent_id==0?(s(),n("div",Ds," MAIN TASK ")):v("",!0),(N=u(a).task)!=null&&N.is_important?(s(),I(Ft,{key:1})):v("",!0),(j=u(a).task)!=null&&j.is_urgent?(s(),I(Bt,{key:2})):v("",!0)]),t("div",Is,[r[13]||(r[13]=t("i",{class:"fas fa-clock"},null,-1)),P(" "+g(u(Vt)(u(a).task.created_at)),1)])]),t("div",Es,[C(Ot,{status:(R=u(a).task)==null?void 0:R.status,progressPercent:(F=u(a).task)==null?void 0:F.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),u(a).task?(s(),I(jt,{key:0,task:u(a).task,ref_key:"progress",ref:b,class:"!text-lg"},null,8,["task"])):v("",!0)])]),t("div",Ps,[t("p",{innerHTML:(h=u(a).task)==null?void 0:h.description,class:O(["text-gray-700",{"line-clamp-3":l.value}])},null,10,Ls),((G=(B=u(a).task)==null?void 0:B.description)==null?void 0:G.length)>=600?(s(),n("button",{key:0,class:"text-blue-500 mt-2",onClick:r[2]||(r[2]=E(L=>l.value=!l.value,["prevent"]))}," Show "+g(l.value?"More":"Less"),1)):v("",!0)]),C(Rt,{task:(V=u(a))==null?void 0:V.task,"tree-level":(z=(H=u(a))==null?void 0:H.task)==null?void 0:z.level},null,8,["task","tree-level"]),u(a).task.children_task_count>0?(s(),n("section",Us,[C(Oe,{"task-users":((lt=u(a).task)==null?void 0:lt.users)||[],task:u(a).task,"sub-tasks":u(a).tasks,"progress-users":T.value},{caption:U(()=>r[14]||(r[14]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):v("",!0),(ot=u(a))!=null&&ot.task?(s(),I(_s,{key:1,task:((rt=u(a))==null?void 0:rt.task)||{},class:"col-span-full mt-4",onUpdateStatus:r[3]||(r[3]=L=>{var K,mt;return k((mt=(K=u(a))==null?void 0:K.task)==null?void 0:mt.id)})},null,8,["task"])):v("",!0),t("div",As,[t("button",{onClick:r[4]||(r[4]=E(L=>{var K;return _((K=u(a).task)==null?void 0:K.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!u(a).task.closed_at}," Edit ",8,Ms),C(S,{to:{name:"TaskUserAssign",params:{id:(it=u(a).task)==null?void 0:it.id}},class:O(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",u(a).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:r[5]||(r[5]=L=>L.stopPropagation())},{default:U(()=>r[15]||(r[15]=[t("i",{class:"fas fa-user-plus"},null,-1),P(" Assign Users ")])),_:1,__:[15]},8,["to","class"]),C(S,{to:$.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none",onClick:r[6]||(r[6]=L=>L.stopPropagation())},{default:U(()=>r[16]||(r[16]=[t("i",{class:"fas fa-arrow-left"},null,-1),P(" Back ")])),_:1,__:[16]},8,["to"]),t("div",Ns,[((dt=u(a).task)==null?void 0:dt.children_task_count)===0&&((ut=u(a).task)==null?void 0:ut.status)==="PENDING"?(s(),n("button",{key:0,class:"btn-2-red h-8",onClick:E(M,["prevent"])}," Delete ")):v("",!0),o.value.length>0?(s(),I(S,{key:1,to:{name:"TaskShow",params:{id:(ct=u(a).task)==null?void 0:ct.id}},onClick:r[7]||(r[7]=L=>L.stopPropagation()),class:O(["py-0.5 btn-3 ml-auto text-sm h-8",{"bg-blue-500 text-white":u(e).name=="TaskShow"||u(e).name==="MyTaskShow"}])},{default:U(()=>r[17]||(r[17]=[t("i",{class:"fal fa-list-ul"},null,-1),P(" Sub Tasks ")])),_:1,__:[17]},8,["to","class"])):v("",!0),C(S,{to:{name:"TaskReports",params:{id:(pt=u(a).task)==null?void 0:pt.id}},onClick:r[8]||(r[8]=L=>L.stopPropagation()),class:O(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":u(e).name=="TaskReports"}])},{default:U(()=>r[18]||(r[18]=[t("i",{class:"fal fa-file-alt"},null,-1),P(" Reports ")])),_:1,__:[18]},8,["to","class"])])])]),(u(e).name=="TaskShow"||u(e).name==="MyTaskShow")&&((kt=u(a).task)==null?void 0:kt.level)<=2?(s(),n("section",Os,[C(ee,{subTasks:o.value,"parent-id":u(e).params.id,"tree-level":u(a).task.level+1,onCreated:r[9]||(r[9]=L=>k(u(e).params.id)),onUpdated:r[10]||(r[10]=L=>k(u(e).params.id)),onUpdatePriority:r[11]||(r[11]=L=>k(u(e).params.id)),onAssignUser:r[12]||(r[12]=L=>k(u(e).params.id)),"sub-task-is-creatable":!u(a).task.closed_at},null,8,["subTasks","parent-id","tree-level","sub-task-is-creatable"])])):(s(),n("section",js,[C(d)]))],64)):(s(),n("div",Rs,g(u(a).error),1)),i.value==="changing"?(s(),I(X,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):v("",!0)]))])}}};export{pa as default};
