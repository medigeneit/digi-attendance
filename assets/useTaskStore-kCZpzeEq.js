import{J as C,r as d,q as o,K as f}from"./index-Duuy0F5A.js";const x=C("task",()=>{const c=d([]),v=d(null),u=d(!1),i=d(null),p=async(a,r,{updateStoreData:e=!0})=>{var s,n;e==!0&&(u.value=!0,i.value=null);try{await f.post(`/tasks/${a}/assign-users`,{user_ids:r}),await y(a)}catch(l){throw e==!0&&(i.value=((n=(s=l.response)==null?void 0:s.data)==null?void 0:n.message)||"Assign users failed"),l}finally{e==!0&&(u.value=!1)}},w=async(a,{loadingBeforeFetch:r=!0,newList:e=!1}={})=>{var s,n,l;r&&(u.value=!0),i.value=null;try{let t;return e?t=await f.get("/tasks2",{params:a}):t=await f.get("/tasks",{params:a}),c.value=((s=t.data)==null?void 0:s.tasks)||[],t.data}catch(t){i.value=((l=(n=t.response)==null?void 0:n.data)==null?void 0:l.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",t)}finally{u.value=!1}};function k(a,r=0){return Array.isArray(a)===!1||a.length===0?[]:a.filter(e=>e.parent_id===r).map(e=>({...e,children_tasks:k(a,e.id)}))}function h(){return k(c.value,0)}function T(){const a=[],r=(e,s=0,n="")=>{e.forEach(l=>{a.push({...l,depth:s,idPath:n+l.id}),l.children_tasks&&l.children_tasks.length&&r(l.children_tasks,s+1,n+l.id+"-")})};return r(h()),a}const y=async(a,r={},e={loadingBeforeFetch:!0,fetchOnly:!1})=>{var s,n,l;e.fetchOnly||(u.value=!0),i.value=null;try{const t=await f.get(`/tasks/${a}`,{params:r});return e.fetchOnly||(v.value=((s=t.data)==null?void 0:s.task)||{},c.value=t.data.sub_tasks||[]),t.data}catch(t){const g=((l=(n=t.response)==null?void 0:n.data)==null?void 0:l.message)||`টাস্ক (ID: ${a}) লোড করতে ব্যর্থ হয়েছে।`;return e.fetchOnly||(i.value=g),g}finally{e.fetchOnly||(u.value=!1)}},m=async(a,r={loadingBeforeCreate:!1})=>{var e,s,n,l;r.loadingBeforeCreate&&(u.value=!0),i.value=null;try{const t=await f.post("/tasks",a);return(e=t.data)!=null&&e.data&&c.value.push((s=t.data)==null?void 0:s.data),t.data.data}catch(t){throw i.value=((l=(n=t.response)==null?void 0:n.data)==null?void 0:l.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",t),t}finally{r.loadingBeforeCreate&&(u.value=!1)}},$=async(a,r,{loadingBeforeFetch:e=!0})=>{e&&(u.value=!0),i.value=null;try{const s=await f.put(`/tasks/${a}`,r),n=c.value.findIndex(l=>l.id===a);return n!==-1&&(c.value[n]=s.data.data),s.data.data}catch(s){throw s}finally{e&&(u.value=!1)}},_=async(a,r)=>(await f.put(`/tasks/${a}/update-priorities`,{task_ids:r})).data,O=async a=>{var r,e;u.value=!0,i.value=null;try{await f.delete(`/tasks/${a}`),c.value=c.value.filter(s=>s.id!==a)}catch(s){i.value=((e=(r=s.response)==null?void 0:r.data)==null?void 0:e.message)||`টাস্ক (ID: ${a}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${a}:`,s)}finally{u.value=!1}};return{tasks:o(()=>c.value),task:o(()=>v.value),loading:o(()=>u.value),error:o(()=>i.value),taskListTree:o(h),flattenedTasks:o(T),fetchTasks:w,fetchTask:y,createTask:m,updateTask:$,deleteTask:O,assignUsers:p,updateTaskPriorities:_}});export{x as u};
