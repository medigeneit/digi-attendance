import{x,c as n,o as l,a as t,k as h,t as o,F as S,e as C,f as vs,g as xs,r as _,q as Z,d as ms,s as Be,l as me,H as ps,v as Se,j as Qe,n as pe,b as B,P as Ke,i as bs,m as fs,z as gs,T as ys,C as Mt}from"./index-D2z9I5Tg.js";import{u as hs}from"./kpi-BP6LoK4U.js";const _s={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},ks={class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2.5"},ws={class:"text-sm font-semibold text-slate-800"},$s={key:0,class:"text-xs text-slate-500"},Fs={key:1,class:"flex items-center gap-2"},Ns={class:"inline-flex items-center rounded-xl border bg-white p-1 shadow-sm"},Ss=["disabled"],Ls=["disabled"],Cs=["disabled"],Ms={class:"overflow-auto"},As={key:0,class:"min-w-[980px] w-full text-sm"},Es={class:"bg-slate-50 sticky top-0 z-10"},js={class:"text-slate-700"},Gs={class:"text-left px-3 py-2 w-[20%] font-medium"},Ts={class:"font-medium"},Is={class:"text-[11px] text-slate-500 flex flex-col items-center"},Ps={key:0,class:"mt-0.5 inline-flex items-center gap-1 rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-semibold text-blue-700 border border-blue-200"},Rs={class:"bg-slate-100/80 border-t"},Hs=["colspan"],Ds={class:"px-3 py-2 text-center text-slate-500"},Bs={class:"px-3 py-2 align-top"},Ks={class:"font-medium text-slate-800"},Qs={class:"mt-1"},Vs={class:"inline-flex items-center rounded-lg border bg-white p-0.5 shadow-sm opacity-0 group-hover:opacity-100 transition"},zs=["disabled","onClick"],Os=["disabled","onClick"],qs=["disabled","onClick"],Us=["disabled","onClick"],Ys=["disabled","onClick"],Ws={class:"px-3 py-2 text-center text-slate-700"},Js={key:0,class:"flex items-center justify-center"},Xs=["max","value","onInput","onBlur"],Zs={key:1,class:"text-slate-700 text-sm"},el={key:2,class:"text-slate-300 text-sm"},tl={class:"bg-slate-50 border-t"},sl={class:"px-3 py-2 text-center font-semibold text-slate-800"},ll=["colspan"],al={class:"font-semibold text-slate-900"},nl={class:"text-slate-500"},ol={key:1,class:"w-full text-sm"},rl={class:"sticky top-0 bg-white z-10"},il={class:"bg-slate-100 text-slate-700"},ul={class:"text-left px-3 py-2 w-[30%] font-medium"},dl={class:"px-3 py-2 text-center text-slate-500"},cl={class:"px-3 py-2"},vl={class:"font-medium text-slate-800"},xl={class:"px-3 py-2 text-center text-slate-700"},ml={class:"px-3 py-2 text-center"},pl=["max","value","onInput","onBlur"],bl={key:1,class:"text-slate-700 text-sm"},fl={class:"bg-slate-50 border-t"},gl={class:"px-3 py-2 text-center font-semibold text-slate-800"},yl={class:"px-3 py-2 text-center text-sm"},At={__name:"KpiGroupTable",props:{group:{type:Object,required:!0},isPersonal:{type:Boolean,default:!1},lanes:{type:Array,default:()=>[]},editableLaneKey:{type:String,default:null},canEdit:{type:Boolean,default:!1},marks:{type:Object,default:()=>({})},headerLabel:{type:String,default:""},itemLabel:{type:String,default:"Item"},helperText:{type:String,default:""},showQuickFillGroup:{type:Boolean,default:!1},autoFillLabel:{type:String,default:""},autoFillVisible:{type:Boolean,default:!1},onAutoFill:{type:Function,default:null},serialMap:{type:Object,default:()=>({})},getLaneMark:{type:Function,default:()=>""},getHrMark:{type:Function,default:()=>""},onMarkChange:{type:Function,default:null},onCap:{type:Function,default:null},onQuickFillItem:{type:Function,default:null},onQuickFillGroup:{type:Function,default:null}},setup(r){const E=r,R=x(()=>{var f;return((f=E.group)==null?void 0:f.items)??[]}),L=x(()=>R.value.reduce((f,m)=>f+Number((m==null?void 0:m.max)||0),0)),O=x(()=>R.value.reduce((f,m)=>{var w;const v=(w=E.marks)==null?void 0:w[m.id],y=v===""||v==null?0:Number(v);return f+Math.min(Math.max(y||0,0),Number((m==null?void 0:m.max)||0))},0)),j=(f,m)=>{var v;return((v=E.serialMap)==null?void 0:v[f.id])??m+1},be=f=>(f==null?void 0:f.key)===E.editableLaneKey&&(f==null?void 0:f.can_current_user_review),q=(f,m)=>{var y;const v=m===""?"":Number(m);m!==""&&Number.isNaN(v)||(y=E.onMarkChange)==null||y.call(E,f,v)},k=(f,m)=>{var v;return(v=E.onCap)==null?void 0:v.call(E,f,m)};return(f,m)=>(l(),n("section",_s,[t("div",ks,[t("div",ws,o(r.headerLabel),1),r.helperText?(l(),n("div",$s,o(r.helperText),1)):r.showQuickFillGroup?(l(),n("div",Fs,[m[4]||(m[4]=t("span",{class:"text-xs font-medium text-slate-500"},"Quick fill",-1)),t("div",Ns,[t("button",{type:"button",class:"px-3 py-1.5 text-xs font-semibold rounded-lg text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40",onClick:m[0]||(m[0]=v=>{var y;return(y=r.onQuickFillGroup)==null?void 0:y.call(r,r.group,"half")}),disabled:!r.canEdit,title:"Fill all items with 50%"}," All 1/2 ",8,Ss),t("button",{type:"button",class:"px-3 py-1.5 text-xs font-semibold rounded-lg text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40",onClick:m[1]||(m[1]=v=>{var y;return(y=r.onQuickFillGroup)==null?void 0:y.call(r,r.group,"threeQuarter")}),disabled:!r.canEdit,title:"Fill all items with 75%"}," All 3/4 ",8,Ls),t("button",{type:"button",class:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-slate-900 text-white hover:bg-slate-800 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-300 disabled:opacity-40",onClick:m[2]||(m[2]=v=>{var y;return(y=r.onQuickFillGroup)==null?void 0:y.call(r,r.group,"full")}),disabled:!r.canEdit,title:"Fill all items with 100%"}," All Full ",8,Cs)]),r.autoFillVisible?(l(),n("button",{key:0,type:"button",class:"rounded-full border border-slate-300 bg-white px-2.5 py-1 text-[10px] font-semibold text-slate-600 hover:border-slate-400 hover:text-slate-800",onClick:m[3]||(m[3]=v=>{var y;return(y=r.onAutoFill)==null?void 0:y.call(r)})},o(r.autoFillLabel),1)):h("",!0)])):h("",!0)]),t("div",Ms,[r.isPersonal?(l(),n("table",As,[t("thead",Es,[t("tr",js,[m[5]||(m[5]=t("th",{class:"px-3 py-2 w-[40px] text-center font-medium"},"#",-1)),t("th",Gs,o(r.itemLabel),1),m[6]||(m[6]=t("th",{class:"px-3 py-2 text-center font-medium"},"Max",-1)),(l(!0),n(S,null,C(r.lanes,v=>(l(),n("th",{key:v.key,class:"px-3 py-2 text-center font-medium"},[t("div",Ts,o(v.label||v.key),1),t("div",Is,[t("span",null,o(v.assigned_user_name||"-"),1),be(v)?(l(),n("span",Ps," ✎ You can edit ")):h("",!0)])]))),128))])]),t("tbody",null,[t("tr",Rs,[t("td",{colspan:3+r.lanes.length,class:"px-3 py-2 font-medium text-slate-800"},o(r.group.label||"Personal"),9,Hs)]),(l(!0),n(S,null,C(R.value,(v,y)=>(l(),n("tr",{key:v.id,class:"border-t hover:bg-slate-50/60 group"},[t("td",Ds,o(j(v,y)),1),t("td",Bs,[t("div",Ks,o(v.label),1),t("div",Qs,[t("div",Vs,[t("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!r.canEdit,onClick:w=>{var $;return r.canEdit&&(($=r.onQuickFillItem)==null?void 0:$.call(r,v.id,v.max,"zero"))},title:"Set 0"}," 0 ",8,zs),t("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!r.canEdit,onClick:w=>{var $;return r.canEdit&&(($=r.onQuickFillItem)==null?void 0:$.call(r,v.id,v.max,"quarter"))},title:"Set 25%"}," ¼ ",8,Os),t("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!r.canEdit,onClick:w=>{var $;return r.canEdit&&(($=r.onQuickFillItem)==null?void 0:$.call(r,v.id,v.max,"half"))},title:"Set 50%"}," ½ ",8,qs),t("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!r.canEdit,onClick:w=>{var $;return r.canEdit&&(($=r.onQuickFillItem)==null?void 0:$.call(r,v.id,v.max,"threeQuarter"))},title:"Set 75%"}," ¾ ",8,Us),t("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md bg-emerald-600 text-white hover:bg-emerald-700 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!r.canEdit,onClick:w=>{var $;return r.canEdit&&(($=r.onQuickFillItem)==null?void 0:$.call(r,v.id,v.max,"full"))},title:"Set 100%"}," Full ",8,Ys)])])]),t("td",Ws,o(v.max),1),(l(!0),n(S,null,C(r.lanes,w=>(l(),n("td",{key:w.key,class:"px-3 py-2 text-center"},[be(w)?(l(),n("div",Js,[t("input",{type:"number",step:"0.1",min:"0",max:v.max,value:r.marks[v.id]??"",onInput:$=>q(v.id,$.target.value),onBlur:$=>k(v.id,v.max),inputmode:"decimal",class:"w-24 text-right rounded-lg border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200"},null,40,Xs)])):w.can_view_marks?(l(),n("div",Zs,o(r.getLaneMark(w.key,v.id)),1)):(l(),n("div",el,"—"))]))),128))]))),128)),t("tr",tl,[m[7]||(m[7]=t("td",null,null,-1)),m[8]||(m[8]=t("td",{class:"px-3 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),t("td",sl,o(L.value.toFixed(2)),1),t("td",{colspan:r.lanes.length,class:"px-3 py-2 text-center text-sm"},[t("span",al,o(O.value.toFixed(2)),1),t("span",nl,"/ "+o(L.value.toFixed(2)),1)],8,ll)])])])):(l(),n("table",ol,[t("thead",rl,[t("tr",il,[m[9]||(m[9]=t("th",{class:"px-3 py-2 w-[40px] text-center font-medium"},"#",-1)),t("th",ul,o(r.itemLabel),1),m[10]||(m[10]=t("th",{class:"px-3 py-2 text-center w-[40px] font-medium"},"Max",-1)),m[11]||(m[11]=t("th",{class:"px-3 py-2 text-center w-[80px] font-medium"},"HR Score",-1))])]),t("tbody",null,[(l(!0),n(S,null,C(R.value,(v,y)=>(l(),n("tr",{key:v.id,class:"border-t hover:bg-slate-50/60 group"},[t("td",dl,o(y+1),1),t("td",cl,[t("div",vl,o(v.label),1)]),t("td",xl,o(v.max),1),t("td",ml,[r.canEdit?(l(),n("input",{key:0,type:"number",step:"0.1",min:"0",max:v.max,value:r.marks[v.id]??"",onInput:w=>q(v.id,w.target.value),onBlur:w=>k(v.id,v.max),inputmode:"decimal",class:"w-24 text-right rounded-lg border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200"},null,40,pl)):(l(),n("p",bl,o(r.getHrMark(v.id)||"—"),1))])]))),128)),t("tr",fl,[m[12]||(m[12]=t("td",null,null,-1)),m[13]||(m[13]=t("td",{class:"px-3 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),t("td",gl,o(L.value.toFixed(2)),1),t("td",yl,o(O.value.toFixed(2)),1)])])]))])]))}},hl={key:0,class:"space-y-4"},_l={class:"flex items-start justify-between gap-3"},kl={class:"text-sm font-semibold text-slate-900"},wl={class:"text-xs text-slate-500"},$l={key:0,class:"text-xs text-slate-400"},Fl={class:"flex flex-wrap items-center gap-2"},Nl=["onClick"],Sl={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Ll={key:1,class:"rounded-xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-700"},Cl={key:2,class:"space-y-3"},Ml={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Al={key:1,class:"space-y-3"},El={class:"flex items-start justify-between gap-3"},jl={class:"min-w-0"},Gl=["title"],Tl={class:"mt-0.5 text-[11px] text-slate-500"},Il={key:0},Pl={key:1},Rl={class:"shrink-0"},Hl=["onUpdate:modelValue"],Dl=["value"],Bl={class:"mt-2"},Kl=["onUpdate:modelValue"],Ql={class:"flex items-center justify-end gap-2 pt-2"},Vl=["disabled"],zl=["disabled"],Ol={key:1,class:"max-w-7xl mx-auto px-4 py-6 space-y-6"},ql={class:"border rounded-2xl bg-white/80 backdrop-blur px-4 py-3 shadow-sm"},Ul={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},Yl={class:"space-y-1"},Wl={class:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1"},Jl={class:"text-xs text-indigo-900"},Xl={class:"text-sm text-slate-600"},Zl={class:"font-medium text-slate-800"},ea={class:"flex flex-wrap gap-2 text-xs mt-0.5"},ta={key:0,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},sa={class:"ml-1 font-medium text-slate-800"},la={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},aa={class:"ml-1 font-medium text-slate-800"},na={class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},oa={key:0,class:"ml-1 inline-flex items-center gap-1"},ra={key:1,class:"ml-1 font-semibold text-slate-800"},ia={class:"flex items-end gap-4"},ua={class:"text-right"},da={class:"text-lg font-bold text-slate-900"},ca={class:"text-slate-400"},va={class:"text-xs text-slate-500"},xa={key:0},ma={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},pa={key:0,class:"p-4 text-sm font-bold text-slate-500"},ba=["innerHTML"],fa={class:"mt-2"},ga={class:"grid gap-4 lg:grid-cols-5"},ya={key:0,class:"space-y-4 lg:col-span-3"},ha={key:0,class:"sticky top-6 border rounded-2xl bg-white shadow-sm"},_a={class:"flex flex-wrap items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},ka={class:"flex flex-wrap items-center gap-2 text-[11px] text-slate-500"},wa={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},$a={key:0,class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Fa={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Na={class:"p-4 space-y-4 max-h-[360px] overflow-y-auto"},Sa={class:"flex flex-wrap gap-2 border-b border-slate-100 pb-3"},La=["onClick"],Ca={class:"space-y-4"},Ma={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},Aa={class:"rounded-xl border bg-slate-50 p-3"},Ea={class:"flex items-center justify-between"},ja={class:"text-[11px] px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200"},Ga={class:"mt-1 text-sm font-semibold text-slate-900"},Ta={class:"text-xs text-slate-500"},Ia={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},Pa={class:"rounded-xl border bg-slate-50 p-3"},Ra={class:"flex items-center justify-between"},Ha={class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-200"},Da={class:"mt-1 text-sm font-semibold text-slate-900"},Ba={class:"text-xs text-slate-500"},Ka={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},Qa={class:"rounded-xl border bg-slate-50 p-3 sm:col-span-2"},Va={class:"flex items-center justify-between"},za={class:"text-[11px] px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 border border-emerald-200"},Oa={class:"mt-1 text-sm font-semibold text-slate-900"},qa={class:"text-xs text-slate-500"},Ua={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},Ya={class:"border-t pt-2 text-xs"},Wa={key:0,class:"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs space-y-2"},Ja={class:"grid grid-cols-2 gap-2"},Xa={class:"font-medium text-slate-800"},Za={class:"font-medium text-slate-800"},en={class:"font-medium text-slate-800"},tn={class:"font-medium text-slate-800"},sn={class:"font-medium text-slate-800"},ln={class:"font-medium text-slate-800"},an={class:"font-medium text-slate-800"},nn={class:"font-medium text-slate-800"},on={class:"font-medium text-slate-800"},rn={key:1,class:"border rounded-2xl bg-white shadow-sm"},un={class:"flex items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},dn={class:"text-[11px] text-slate-500"},cn={class:"p-4 space-y-3"},vn={class:"max-h-96 overflow-auto border rounded-xl"},xn={class:"min-w-full text-xs text-left"},mn={class:"px-2 py-2"},pn={class:"font-semibold text-slate-700"},bn={key:0,class:"mt-0.5 text-[11px] text-slate-400"},fn={class:"px-2 py-2 text-right"},gn=["onClick"],yn={key:2,class:"rounded-2xl bg-white border shadow-sm px-4 py-4 space-y-4"},hn={class:"grid gap-4 md:grid-cols-3"},_n={class:"space-y-3"},kn={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},wn={key:0,class:"text-[11px] text-emerald-600"},$n={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},Fn={class:"flex flex-wrap gap-1.5"},Nn=["onClick","disabled"],Sn={key:1,class:"text-[11px] text-slate-400"},Ln={class:"space-y-1"},Cn={class:"space-y-3"},Mn={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},An={key:0,class:"text-[11px] text-amber-600"},En={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},jn={class:"flex flex-wrap gap-1.5"},Gn=["onClick","disabled"],Tn={key:1,class:"text-[11px] text-slate-400"},In={class:"space-y-1"},Pn={class:"space-y-3"},Rn={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},Hn={key:0,class:"text-[11px] text-sky-600"},Dn={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},Bn={class:"flex flex-wrap gap-1.5"},Kn=["onClick","disabled"],Qn={class:"space-y-1"},Vn={class:"mt-2 flex flex-col gap-3 border-t pt-3 md:flex-row md:items-center md:justify-between"},zn={class:"text-sm text-slate-600"},On={class:"text-slate-900"},qn={class:"text-slate-400"},Un=["disabled"],Yn={class:"relative w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true"},Wn={class:"flex items-start justify-between gap-3"},Jn={class:"text-lg font-semibold text-slate-900"},Xn={class:"text-xs text-slate-500"},Zn={key:0,class:"text-xs text-slate-400 mt-1"},eo={class:"mt-5 space-y-4 text-sm text-slate-700"},to={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},so={key:0},lo={key:1,class:"text-slate-400"},ao={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},no={key:0},oo={key:1,class:"text-slate-400"},ro={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},io={key:0},uo={key:1,class:"text-slate-400"},co={__name:"KpiReviewForm",props:{mode:{type:String,default:"full"},allowedLanes:{type:Array,default:()=>["supv_director","da"]},groupFilter:{type:String,default:null},initialLane:{type:String,default:""},employeeId:{type:[Number,String],default:null},employeeName:{type:String,default:""},year:{type:Number,default:null}},emits:["saved"],setup(r,{emit:E}){const R=vs(),L=hs(),O=xs(),j=r,be=E,q=x(()=>j.mode==="compact"),k=_({}),f=_({}),m=_(""),v=_(""),y=_(""),w=_(null),$=_(null),ee=_(!1),te=x(()=>{const s=Number(j.employeeId);return Number.isFinite(s)&&s>0?s:null}),U=x(()=>{const s=Number(j.year);return Number.isFinite(s)&&s>0?s:new Date().getFullYear()}),se=x(()=>j.groupFilter?String(j.groupFilter):"personal"),Le=x(()=>{const s=Array.isArray(j.allowedLanes)?j.allowedLanes.filter(Boolean):[];return s.length?s:["supv_director","da"]}),G=_(j.initialLane||Le.value[0]||""),K=_([]),le=_({}),ae=_({}),ne=_(!1),Y=_(!1),W=_(""),Et=x(()=>{var s;return j.employeeName||((s=f.value)==null?void 0:s.name)||"Employee"}),jt={supv_director:"Supv. Director",da:"DA"},Ve=s=>jt[s]||s,Gt=x(()=>se.value?se.value.replace(/_/g," "):"personal");function Tt(s){return Array.isArray(s)?s.map((e,a)=>{const i=(e==null?void 0:e.id)??(e==null?void 0:e.item_id)??(e==null?void 0:e.kpi_item_id)??(e==null?void 0:e.kpi_id)??a,d=(e==null?void 0:e.title)??(e==null?void 0:e.name)??(e==null?void 0:e.label)??`Item ${a+1}`,c=(e==null?void 0:e.weight)??(e==null?void 0:e.weightage)??(e==null?void 0:e.weight_value)??(e==null?void 0:e.score_weight)??null,p=(e==null?void 0:e.max_score)??(e==null?void 0:e.max)??(e==null?void 0:e.max_marks)??(e==null?void 0:e.score_max)??0,b=(e==null?void 0:e.score)??(e==null?void 0:e.mark)??(e==null?void 0:e.obtained)??(e==null?void 0:e.value)??null,N=(e==null?void 0:e.comment)??(e==null?void 0:e.note)??(e==null?void 0:e.remark)??"";return{id:i,title:d,weight:c,maxScore:p,score:b,comment:N}}):[]}function It(s){const e=Number(s);if(!Number.isFinite(e)||e<=0)return[0];const a=Number.isInteger(e)?1:.5,i=[];for(let d=0;d<=e+1e-4;d+=a){const c=a===1?Math.round(d):Number(d.toFixed(1));i.push(c)}return i[i.length-1]!==e&&i.push(e),i}async function Pt(){var s,e,a,i;if(q.value&&!(!te.value||!U.value||!G.value)){ne.value=!0,W.value="";try{const{data:d}=await Mt.get(`/kpi/yearly/${U.value}/employees/${te.value}/marking-form`,{params:{lane:G.value,group:se.value}}),c=(d==null?void 0:d.data)??d??{},p=(c==null?void 0:c.items)||((s=c==null?void 0:c.form)==null?void 0:s.items)||((e=c==null?void 0:c.group)==null?void 0:e.items)||(c==null?void 0:c.data)||[],b=Tt(p),N={},M={};b.forEach(P=>{var de,ce;const $e=(de=c==null?void 0:c.marks)==null?void 0:de[P.id],Fe=(ce=c==null?void 0:c.comments)==null?void 0:ce[P.id],X=P.score??$e??0,Ne=P.comment??Fe??"";N[P.id]=X===""||X==null?0:Number(X),M[P.id]=Ne??""}),K.value=b,le.value=N,ae.value=M}catch(d){W.value=((i=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to load KPI marking form.",K.value=[]}finally{ne.value=!1}}}async function ze(s){var e,a;if(!(!te.value||!U.value||!G.value)){Y.value=!0,W.value="";try{const i=K.value.map(c=>({item_id:c.id,score:Number(le.value[c.id]??0),comment:ae.value[c.id]??""})),d={lane:G.value,group:se.value,submit:!!s,items:i,marks:{...le.value},comments:{...ae.value}};await Mt.post(`/kpi/yearly/${U.value}/employees/${te.value}/marking-form`,d),be("saved")}catch(i){W.value=((a=(e=i==null?void 0:i.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to save KPI marking form."}finally{Y.value=!1}}}Z(()=>j.initialLane,s=>{s&&(G.value=s)}),Z(Le,s=>{s.length&&(s.includes(G.value)||(G.value=s[0]))},{immediate:!0}),Z([q,G,te,U,se],([s,e,a,i,d])=>{!s||!e||!a||!i||!d||Pt()},{immediate:!0});const Oe=_([]),qe=_({}),Ce=_(!1),Me=x(()=>{var s;return((s=L.cycle)==null?void 0:s.groups_json)||[]}),Rt=x(()=>{var i;const s=L.cycle||{},e=Array.isArray(s==null?void 0:s.groups_json)?s.groups_json:[];return(s==null?void 0:s.slug)==="support_staff"&&e.length===1&&((i=e[0])==null?void 0:i.id)==="personal"?"staff":"executive"}),Q=x(()=>Rt.value==="staff"),Ue=s=>(s==null?void 0:s.id)==="personal",oe=x(()=>Me.value.find(Ue)||null),V=x(()=>Q.value?[]:Me.value.filter(s=>!Ue(s))),Ht=(s,e)=>(s==null?void 0:s.label)||`Group ${e+1}`,Dt=s=>/^hr\d*$/i.test(s)||s==="hr",Ye=s=>Dt((s==null?void 0:s.key)||"")||(s==null?void 0:s.is_hr_lane)===!0,fe=x(()=>[...Oe.value||[]].sort((s,e)=>(s.rank??999)-(e.rank??999))),Ae=x(()=>fe.value.filter(Ye)),We=x(()=>fe.value.filter(s=>!Ye(s))),Ee=x(()=>Q.value?fe.value:We.value),z=x(()=>{var s;return((s=Ee.value.find(e=>e.can_current_user_review))==null?void 0:s.key)||null}),Bt=x(()=>Ee.value.find(s=>s.key===z.value)||null),Kt=x(()=>{var s;return((s=Bt.value)==null?void 0:s.rank)??null}),Qt=x(()=>{var s;return Number(((s=O==null?void 0:O.user)==null?void 0:s.id)||0)}),je=x(()=>{const s=Qt.value;if(!s)return null;const e=Ae.value.find(a=>Number(a.assigned_user_id)===s);return e||Ae.value.find(a=>a.can_current_user_review)||null}),H=x(()=>{var s;return((s=je.value)==null?void 0:s.key)||null}),Vt=x(()=>!!(je.value&&je.value.can_current_user_review)),D=x(()=>!!(Ce.value||Vt.value)),Ge=x(()=>!!z.value),ge=x(()=>Q.value?z.value:D.value&&H.value?H.value:z.value),Je=x(()=>!!(ge.value&&H.value&&ge.value===H.value));function re(s){var i;const e=(i=qe.value)==null?void 0:i[s];return e?(Array.isArray(e)?e:[e]).reduce((d,c)=>{if(!c)return d;if(!d)return c;const p=new Date(c.submitted_at||0).getTime(),b=new Date(d.submitted_at||0).getTime();return p>b?c:d},null):null}function Xe(s,e){var i;const a=re(s);return((i=a==null?void 0:a.marks)==null?void 0:i[e])??""}function Ze(s){var a,i,d;if(H.value){const c=re(H.value),p=(a=c==null?void 0:c.marks)==null?void 0:a[s];if(p!=null)return p}let e=null;for(const c of Ae.value){const p=re(c.key);if(!p||((i=p==null?void 0:p.marks)==null?void 0:i[s])==null)continue;if(!e){e=p;continue}const b=new Date(p.submitted_at||0).getTime(),N=new Date(e.submitted_at||0).getTime();b>N&&(e=p)}return((d=e==null?void 0:e.marks)==null?void 0:d[s])??""}function et(s,e){k.value[s]=e===""?"":Number(e)}function ie(s,e){const a=Number(k.value[s]??0);a<0&&(k.value[s]=0),a>Number(e)&&(k.value[s]=Number(e))}function tt(s,e,a){a==="zero"?k.value[s]=0:a==="quarter"?k.value[s]=Number(e)/4:a==="half"?k.value[s]=Number(e)/2:a==="threeQuarter"?k.value[s]=Number((Number(e)*.75).toFixed(1)):a==="full"&&(k.value[s]=Number(e)),ie(s,e)}function zt(s,e){s.items.forEach(a=>tt(a.id,a.max,e))}const ue=x(()=>{let s=0,e=0;const a=oe.value;a&&a.items.forEach(d=>{s+=Number(d.max||0);const c=Number(k.value[d.id]||0);e+=Math.min(Math.max(c,0),Number(d.max||0))});const i=s>0?e/s*100:0;return{max:Number(s.toFixed(2)),got:Number(e.toFixed(2)),percent:Number(i.toFixed(2))}}),Ot=x(()=>!!w.value&&typeof w.value=="object"),qt=x(()=>{var s;return((s=w.value)==null?void 0:s.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),Ut=x(()=>{var s;return((s=w.value)==null?void 0:s.year)??null}),Yt=x(()=>{var s;return((s=$.value)==null?void 0:s.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),Wt=x(()=>{var s;return((s=$.value)==null?void 0:s.year)??null}),T=_("target"),Te=[{key:"target",label:"Annual Target"},{key:"performance",label:"Annual Performance"}],st=x(()=>{var s;return((s=w.value)==null?void 0:s.months_total_form)??0}),Jt=x(()=>{var s;return((s=$.value)==null?void 0:s.months_total_form)??st.value}),g=x(()=>T.value==="target"?qt.value:Yt.value),lt=x(()=>{var s,e;return Number(((e=(s=g.value)==null?void 0:s.per_form_yearly)==null?void 0:e.final)||0)}),at=x(()=>{var s,e;return Number(((e=(s=g.value)==null?void 0:s.per_scored_month)==null?void 0:e.max)||0)}),Xt=x(()=>at.value?Math.round(lt.value/at.value*100):0),nt=x(()=>D.value&&!Q.value),Ie=x(()=>T.value==="target"?Ut.value:Wt.value),ot=x(()=>T.value==="target"?st.value:Jt.value),Pe=x(()=>{var s;return((s=Te.find(e=>e.key===T.value))==null?void 0:s.label)||"Annual Target"}),Zt={target:"target",performance:"regular_activities_of_the_department"},es=x(()=>{const s=Zt[T.value];return s&&V.value.find(e=>e.id===s)||null}),ts=x(()=>{var s;return((s=es.value)==null?void 0:s.label)||Pe.value}),ss=s=>{Te.some(e=>e.key===s)&&(T.value=s)};Z(T,()=>{ee.value=!1});const rt=s=>String(s||"").toLowerCase(),it=(s,e)=>s?e==="target"?s.id==="monthly_target"?!0:rt(s.label).includes("monthly target"):e==="performance"?s.id==="execution"?!0:rt(s.label).includes("execution")||String(s.label||"").includes("কার্যসম্পাদন"):!1:!1,ls=s=>V.value.find(e=>it(e,s))||null,ut=(s,{overwrite:e}={overwrite:!1})=>{if(!nt.value)return;const a=ls(s);if(!a||!Array.isArray(a.items)||a.items.length===0)return;const i=a.items,d=i.every(b=>Number(k.value[b.id]||0)===0);if(!e&&!d)return;const c=lt.value,p=i.reduce((b,N)=>b+Number(N.max||0),0);if(p){if(i.length===1){const b=i[0];k.value[b.id]=Math.min(c,Number(b.max||0)),ie(b.id,b.max);return}i.forEach(b=>{const N=Number(b.max||0)/p*c,M=Number(N.toFixed(1));k.value[b.id]=M,ie(b.id,b.max)})}},as=x(()=>`Auto: ${T.value==="target"?"Annual Target":"Annual Performance"} (${Xt.value}%)`);Z(T,s=>{ut(s,{overwrite:!1})},{immediate:!0});const ye=x(()=>{const s=Q.value?fe.value:We.value,e=[],a=Je.value||D.value?1/0:Kt.value??null,i=d=>{if(!d)return[];const c=[];if(Array.isArray(d))c.push(...d);else if(typeof d=="string"&&d.trim())c.push(d.trim());else return[];const p=new Set;return c.reduce((b,N)=>{const M=typeof N=="string"?N.trim():"";return!M||p.has(M)||(p.add(M),b.push(M)),b},[])};return s.forEach(d=>{const c=d.key;if(!c||a!=null&&(d.rank??999)>a)return;const p=re(c);if(!p)return;const b=i(p.strengths),N=i(p.gaps),M=i(p.suggestions);!b.length&&!N.length&&!M.length||e.push({key:c,lane:c,label:d.label||(p==null?void 0:p.lane_label)||c,reviewer_id:p.reviewer_id,reviewer_name:p.reviewer_name,strengths:b,gaps:N,suggestions:M,submitted_at:p.submitted_at??null})}),e}),ns=s=>{const e=new Set;return ye.value.forEach(a=>{(Array.isArray(a[s])?a[s]:[]).forEach(d=>{const c=typeof d=="string"?d.trim():"";c&&e.add(c)})}),Array.from(e)},dt=s=>{if(!Array.isArray(s))return[];const e=new Set;return s.forEach(a=>{const i=typeof a=="string"?a.trim():"";i&&e.add(i)}),Array.from(e)},he=x(()=>dt(L.strengths)),_e=x(()=>dt(L.gaps)),ke=x(()=>ns("suggestions"));_([]),_([]),_([]);const Re=_(!1),A=_(null);function os(s){A.value=s,Re.value=!0}function He(){Re.value=!1,A.value=null}const ct={strengths:m,gaps:v,suggestions:y};function rs(s,e){const a=(e||"").trim();return a?s!=null&&s.trim()?`${s.trim()}
${a}`:a:s}const is=x(()=>{const s={};let e=1;const a=oe.value;return a&&a.items.forEach(i=>{s[i.id]=e++}),s}),us=x(()=>Number(R.params.employeeId)),ds=s=>{var e;if(f.value=s.employee,w.value=(s==null?void 0:s.annual_target_avg_marks)||null,$.value=(s==null?void 0:s.annual_performance_avg_marks)||null,Oe.value=s.lanes||[],qe.value=s.reviews_by_lane||{},Ce.value=!!(((e=s==null?void 0:s.meta)==null?void 0:e.is_hr)??(s==null?void 0:s.hr)??!1),k.value={},Me.value.forEach(a=>a.items.forEach(i=>{k.value[i.id]=0})),z.value){const a=re(z.value);a!=null&&a.marks&&Object.assign(k.value,a.marks)}D.value&&V.value.length&&V.value.forEach(a=>{a.items.forEach(i=>{let d=H.value?Xe(H.value,i.id):"";(d===""||d==null)&&(d=Ze(i.id)),d!==""&&d!=null&&(k.value[i.id]=Number(d))})})};Z(us,async(s,e)=>{if(!s||e&&s===e)return;await L.fetchActiveCycle(s);const a=await L.fetchLanes(L.cycle.id,s);ds(a)},{immediate:!0});async function cs(){const s=ge.value;if(!s){alert("Unable to determine reviewer lane.");return}await L.submitReview({cycle_id:L.cycle.id,employee_id:Number(R.params.employeeId),reviewer_lane:s,marks:k.value,strengths:m.value,gaps:v.value,suggestions:y.value}),alert("Submitted")}function I(s){const e=Number(s??0);return isNaN(e)?"0.00":e.toFixed(2)}function J(s,e){const a=Number(s??0),i=Number(e??0);return i>0?Math.round(a/i*100):0}function we(s,e){const a=ct[s];if(!a)return!1;const i=(a.value||"").split(`
`).map(c=>c.trim()).filter(Boolean),d=(e||"").trim();return d?i.includes(d):!1}function De(s,e){const a=ct[s];if(!a)return;const i=typeof e=="string"?e.trim():"";i&&(we(s,i)||(a.value=rs(a.value,i)))}return(s,e)=>{var a,i,d,c,p,b,N,M,P,$e,Fe,X,Ne,de,ce,vt,xt,mt,pt,bt,ft,gt,yt,ht,_t,kt,wt,$t,Ft,Nt,St,Lt;return l(),n(S,null,[q.value?(l(),n("div",hl,[t("div",_l,[t("div",null,[t("div",kl,o(Et.value),1),t("div",wl," Year "+o(U.value)+" / Group "+o(Gt.value),1)]),G.value?(l(),n("div",$l," Lane: "+o(Ve(G.value)),1)):h("",!0)]),t("div",Fl,[(l(!0),n(S,null,C(Le.value,u=>(l(),n("button",{key:u,type:"button",class:Be(["rounded-full border px-3 py-1 text-xs font-semibold transition",u===G.value?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-600 border-slate-200 hover:border-slate-300"]),onClick:F=>G.value=u},o(Ve(u)),11,Nl))),128))]),ne.value?(l(),n("div",Sl," Loading KPI items... ")):W.value?(l(),n("div",Ll,o(W.value),1)):(l(),n("div",Cl,[K.value.length?(l(),n("div",Al,[(l(!0),n(S,null,C(K.value,u=>(l(),n("div",{key:u.id,class:"rounded-xl border border-slate-200 bg-white p-3"},[t("div",El,[t("div",jl,[t("div",{class:"text-sm font-semibold text-slate-900 truncate",title:u.title},o(u.title),9,Gl),t("div",Tl,[u.weight!=null?(l(),n("span",Il,"Weight: "+o(u.weight),1)):h("",!0),u.maxScore!=null?(l(),n("span",Pl," / Max: "+o(u.maxScore),1)):h("",!0)])]),t("div",Rl,[me(t("select",{"onUpdate:modelValue":F=>le.value[u.id]=F,class:"rounded-lg border border-slate-300 bg-white px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50"},[(l(!0),n(S,null,C(It(u.maxScore),F=>(l(),n("option",{key:F,value:F},o(F),9,Dl))),128))],8,Hl),[[ps,le.value[u.id],void 0,{number:!0}]])])]),t("div",Bl,[e[7]||(e[7]=t("label",{class:"block text-[11px] font-medium text-slate-500"},"Comment (optional)",-1)),me(t("textarea",{"onUpdate:modelValue":F=>ae.value[u.id]=F,rows:"2",class:"mt-1 w-full rounded-lg border border-slate-200 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/40",placeholder:"Add a note if needed"},null,8,Kl),[[Se,ae.value[u.id]]])])]))),128))])):(l(),n("div",Ml," No KPI items found for this lane. "))])),t("div",Ql,[t("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50 disabled:opacity-50",disabled:Y.value||ne.value||!K.value.length,onClick:e[0]||(e[0]=u=>ze(!1))},o(Y.value?"Saving...":"Save Draft"),9,Vl),t("button",{type:"button",class:"rounded-lg bg-emerald-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-emerald-700 disabled:opacity-50",disabled:Y.value||ne.value||!K.value.length,onClick:e[1]||(e[1]=u=>ze(!0))},o(Y.value?"Saving...":"Submit"),9,zl)])])):(l(),n("div",Ol,[t("header",ql,[t("div",Ul,[t("div",Yl,[t("div",Wl,[e[8]||(e[8]=t("span",{class:"text-xs font-semibold text-indigo-700"},"KPI Cycle",-1)),t("span",Jl,o((a=pe(L).cycle)==null?void 0:a.title),1)]),t("div",Xl,[t("div",Zl,o(((i=f.value)==null?void 0:i.name)||"Employee"),1),t("div",ea,[(c=(d=f.value)==null?void 0:d.designation)!=null&&c.title?(l(),n("span",ta,[e[9]||(e[9]=B(" Designation: ")),t("span",sa,o(f.value.designation.title),1)])):h("",!0),(b=(p=f.value)==null?void 0:p.department)!=null&&b.name?(l(),n("span",la,[e[10]||(e[10]=B(" Department: ")),t("span",aa,o(f.value.department.name),1)])):h("",!0),t("span",na,[e[12]||(e[12]=B(" Reviewing as: ")),Je.value?(l(),n("span",oa,e[11]||(e[11]=[t("span",{class:"font-semibold text-emerald-700"},"HR",-1),t("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," HR mode ",-1)]))):(l(),n("span",ra,o(ge.value||"No lane"),1))])])])]),t("div",ia,[t("div",ua,[e[13]||(e[13]=t("div",{class:"text-[11px] uppercase tracking-wide text-slate-500"}," Personal group total ",-1)),t("div",da,[B(o(ue.value.got.toFixed(2))+" ",1),t("span",ca,"/ "+o(ue.value.max.toFixed(2)),1)]),t("div",va,o(ue.value.percent.toFixed(2))+"% achieved ",1)]),Ce.value?(l(),n("button",{key:0,onClick:e[2]||(e[2]=u=>pe(L).submitFinalResult(pe(L).cycle.id,pe(R).params.employeeId)),class:"inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-medium text-white shadow hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-300 focus:outline-none"},e[14]||(e[14]=[t("span",null,"Finalize & Lock",-1)]))):h("",!0)])])]),(N=f.value)!=null&&N.active_criteria?(l(),n("div",xa,[t("section",ma,[e[15]||(e[15]=t("div",{class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2"},[t("div",{class:"text-sm font-semibold text-slate-800"},"কার্যসম্পাদন বিষয়")],-1)),((P=(M=f.value)==null?void 0:M.active_criteria)==null?void 0:P.length)===0?(l(),n("div",pa," -- ")):h("",!0),(l(!0),n(S,null,C(f.value.active_criteria,u=>(l(),n("div",{class:"p-4 text-sm text-slate-700",key:u.id},[t("div",{class:"print:block richtext print:break-inside-avoid",innerHTML:u==null?void 0:u.description},null,8,ba)]))),128))])])):h("",!0),pe(L).cycle&&oe.value?(l(),Qe(At,{key:1,group:oe.value,"is-personal":!0,lanes:Ee.value,"editable-lane-key":z.value,"can-edit":Ge.value,marks:k.value,"header-label":"Personal Evaluation","item-label":(($e=oe.value)==null?void 0:$e.label)||"Personal","helper-text":Q.value?"All reviewer lanes score the Personal table.":"Fill only your lane; others appear as read-only.","serial-map":is.value,"get-lane-mark":Xe,"on-mark-change":et,"on-cap":ie,"on-quick-fill-item":tt},null,8,["group","lanes","editable-lane-key","can-edit","marks","item-label","helper-text","serial-map"])):h("",!0),t("section",fa,[t("div",ga,[V.value.length?(l(),n("div",ya,[(l(!0),n(S,null,C(V.value,(u,F)=>(l(),Qe(At,{key:F,group:u,"is-personal":!1,"can-edit":D.value,marks:k.value,"header-label":`Group ${F+1} - ${Ht(u,F)}`,"item-label":"Item","show-quick-fill-group":!0,"auto-fill-visible":nt.value&&it(u,T.value),"auto-fill-label":as.value,"on-auto-fill":()=>ut(T.value,{overwrite:!0}),"get-hr-mark":Ze,"on-mark-change":et,"on-cap":ie,"on-quick-fill-group":zt},null,8,["group","can-edit","marks","header-label","auto-fill-visible","auto-fill-label","on-auto-fill"]))),128))])):h("",!0),t("aside",{class:Be(["space-y-4 sticky top-10 z-50",[V.value.length===0?"lg:col-span-full":"lg:col-span-2"]])},[!Q.value&&Ot.value&&D.value?(l(),n("section",ha,[t("header",_a,[e[16]||(e[16]=t("span",null,"Annual Summary",-1)),t("div",ka,[t("span",wa,o(Pe.value),1),Ie.value?(l(),n("span",$a," Year "+o(Ie.value),1)):h("",!0),t("span",Fa,o(ot.value)+" month(s) ",1)])]),t("div",Na,[t("div",Sa,[(l(),n(S,null,C(Te,u=>t("button",{key:u.key,type:"button",onClick:F=>ss(u.key),class:Be(["px-3 py-1 rounded-full text-xs font-semibold transition",T.value===u.key?"bg-slate-900 text-white shadow":"border border-slate-200 text-slate-700 bg-white hover:border-slate-400"])},o(u.label),11,La)),64))]),t("div",Ca,[t("div",Ma,[t("div",Aa,[t("div",Ea,[e[17]||(e[17]=t("span",{class:"text-xs font-medium text-slate-600"},"Incharge",-1)),t("span",ja,o(J((Fe=g.value.per_scored_month)==null?void 0:Fe.incharge,(X=g.value.per_scored_month)==null?void 0:X.max))+"% ",1)]),t("div",Ga,[B(o(I((Ne=g.value.per_scored_month)==null?void 0:Ne.incharge))+" ",1),t("span",Ta,"/ "+o(I((de=g.value.per_scored_month)==null?void 0:de.max)),1)]),t("div",Ia,[t("div",{class:"h-2 bg-blue-500",style:Ke({width:J((ce=g.value.per_scored_month)==null?void 0:ce.incharge,(vt=g.value.per_scored_month)==null?void 0:vt.max)+"%"})},null,4)])]),t("div",Pa,[t("div",Ra,[e[18]||(e[18]=t("span",{class:"text-xs font-medium text-slate-600"},"Coordinator",-1)),t("span",Ha,o(J((xt=g.value.per_scored_month)==null?void 0:xt.coordinator,(mt=g.value.per_scored_month)==null?void 0:mt.max))+"% ",1)]),t("div",Da,[B(o(I((pt=g.value.per_scored_month)==null?void 0:pt.coordinator))+" ",1),t("span",Ba,"/ "+o(I((bt=g.value.per_scored_month)==null?void 0:bt.max)),1)]),t("div",Ka,[t("div",{class:"h-2 bg-violet-500",style:Ke({width:J((ft=g.value.per_scored_month)==null?void 0:ft.coordinator,(gt=g.value.per_scored_month)==null?void 0:gt.max)+"%"})},null,4)])]),t("div",Qa,[t("div",Va,[e[19]||(e[19]=t("span",{class:"text-xs font-medium text-slate-600"},"Final",-1)),t("span",za,o(J((yt=g.value.per_form_yearly)==null?void 0:yt.final,(ht=g.value.per_scored_month)==null?void 0:ht.max))+"% ",1)]),t("div",Oa,[B(o(I((_t=g.value.per_form_yearly)==null?void 0:_t.final))+" ",1),t("span",qa,"/ "+o(I((kt=g.value.per_scored_month)==null?void 0:kt.max)),1)]),t("div",Ua,[t("div",{class:"h-2 bg-emerald-500",style:Ke({width:J((wt=g.value.per_form_yearly)==null?void 0:wt.final,($t=g.value.per_scored_month)==null?void 0:$t.max)+"%"})},null,4)])])]),t("div",Ya,[t("button",{class:"text-xs px-3 py-1.5 rounded-md border hover:bg-slate-50",onClick:e[3]||(e[3]=u=>ee.value=!ee.value)},o(ee.value?"Hide details":"Show "+Pe.value+" details"),1),ee.value?(l(),n("div",Wa,[t("div",Ja,[e[20]||(e[20]=t("div",{class:"text-slate-500"},"Year",-1)),t("div",Xa,o(Ie.value||"-"),1),e[21]||(e[21]=t("div",{class:"text-slate-500"},"Months counted",-1)),t("div",Za,o(ot.value),1),e[22]||(e[22]=t("div",{class:"text-slate-500"},"Group",-1)),t("div",en,o(ts.value),1),e[23]||(e[23]=t("div",{class:"text-slate-500"},"Max (denominator)",-1)),t("div",tn,o(I((Ft=g.value.per_scored_month)==null?void 0:Ft.max)),1),e[24]||(e[24]=t("div",{class:"text-slate-500"},"Incharge avg",-1)),t("div",sn,o(I((Nt=g.value.per_form_yearly)==null?void 0:Nt.incharge)),1),e[25]||(e[25]=t("div",{class:"text-slate-500"},"Coordinator avg",-1)),t("div",ln,o(I((St=g.value.per_form_yearly)==null?void 0:St.coordinator)),1),e[26]||(e[26]=t("div",{class:"text-slate-500"},"Final avg",-1)),t("div",an,o(I((Lt=g.value.per_form_yearly)==null?void 0:Lt.final)),1),e[27]||(e[27]=t("div",{class:"text-slate-500"},"Percent (simple)",-1)),t("div",nn,o(I(g.value.percent_simple))+"% ",1),e[28]||(e[28]=t("div",{class:"text-slate-500"},"Percent (weighted)",-1)),t("div",on,o(I(g.value.percent_weighted))+"% ",1)])])):h("",!0)])])])])):h("",!0),ye.value.length?(l(),n("section",rn,[t("header",un,[e[29]||(e[29]=t("span",null,"Review Comments",-1)),t("span",dn,o(ye.value.length)+" lane(s) ",1)]),t("div",cn,[t("div",vn,[t("table",xn,[e[31]||(e[31]=t("thead",{class:"text-[11px] text-slate-600 uppercase tracking-wide bg-slate-50"},[t("tr",null,[t("th",{class:"px-2 py-2 w-[140px]"},"Lane"),t("th",{class:"px-2 py-2 text-right"},"Details")])],-1)),t("tbody",null,[(l(!0),n(S,null,C(ye.value,u=>(l(),n("tr",{key:u.key,class:"border-t hover:bg-slate-50/60 align-top"},[t("td",mn,[t("div",pn,o(u.label),1),u.submitted_at?(l(),n("div",bn,o(new Date(u.submitted_at).toLocaleDateString()),1)):h("",!0)]),t("td",fn,[t("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:F=>os(u)},e[30]||(e[30]=[t("span",null,"View comments",-1),t("span",{class:"text-[10px] text-slate-400"},"Strengths · Gaps · Suggestions",-1)]),8,gn)])]))),128))])])])])])):h("",!0)],2)])]),Ge.value||D.value?(l(),n("section",yn,[e[38]||(e[38]=bs('<header class="flex items-center justify-between mb-1"><div><h2 class="text-sm font-semibold text-slate-800">Overall Review Notes</h2><p class="text-[11px] text-slate-500"> Use saved hints or write your own detailed comments. </p></div><div class="hidden md:flex items-center gap-2 text-[11px] text-slate-500"><span class="inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 border border-emerald-100"><span class="text-xs">●</span> Strengths </span><span class="inline-flex items-center gap-1 rounded-full bg-amber-50 px-2 py-0.5 border border-amber-100"><span class="text-xs">●</span> Gaps </span><span class="inline-flex items-center gap-1 rounded-full bg-sky-50 px-2 py-0.5 border border-sky-100"><span class="text-xs">●</span> Suggestions </span></div></header>',1)),t("div",hn,[t("div",_n,[t("header",kn,[e[32]||(e[32]=t("div",{class:"flex items-center gap-1"},[t("span",{class:"text-emerald-500 text-base leading-none"},"★"),t("span",null,"Strengths")],-1)),he.value.length?(l(),n("span",wn,o(he.value.length)+" saved hint(s) ",1)):h("",!0)]),he.value.length?(l(),n("div",$n,[t("div",Fn,[(l(!0),n(S,null,C(he.value,u=>(l(),n("button",{key:u,type:"button",onClick:F=>De("strengths",u),disabled:we("strengths",u),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-800 disabled:opacity-40 disabled:cursor-not-allowed"},o(u),9,Nn))),128))])])):(l(),n("p",Sn," No historical strengths yet. Write your own notes below. ")),t("div",Ln,[e[33]||(e[33]=t("label",{class:"text-[11px] font-medium text-slate-500"}," Key Strength(s) ",-1)),me(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=u=>m.value=u),placeholder:"e.g. Strong ownership, proactive problem solving…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[Se,m.value]])])]),t("div",Cn,[t("header",Mn,[e[34]||(e[34]=t("div",{class:"flex items-center gap-1"},[t("span",{class:"text-amber-500 text-base leading-none"},"!"),t("span",null,"Gaps")],-1)),_e.value.length?(l(),n("span",An,o(_e.value.length)+" saved hint(s) ",1)):h("",!0)]),_e.value.length?(l(),n("div",En,[t("div",jn,[(l(!0),n(S,null,C(_e.value,u=>(l(),n("button",{key:u,type:"button",onClick:F=>De("gaps",u),disabled:we("gaps",u),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-amber-300 hover:bg-amber-50 hover:text-amber-800 disabled:opacity-40 disabled:cursor-not-allowed"},o(u),9,Gn))),128))])])):(l(),n("p",Tn,"No historical gaps yet.")),t("div",In,[e[35]||(e[35]=t("label",{class:"text-[11px] font-medium text-slate-500"},"GAP(s)",-1)),me(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=u=>v.value=u),placeholder:"e.g. Needs improvement in documentation, communication…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-amber-200"},null,512),[[Se,v.value]])])]),t("div",Pn,[t("header",Rn,[e[36]||(e[36]=t("div",{class:"flex items-center gap-1"},[t("span",{class:"text-sky-500 text-base leading-none"},"✱"),t("span",null,"Suggestions / Training")],-1)),ke.value.length?(l(),n("span",Hn,o(ke.value.length)+" common suggestion(s) ",1)):h("",!0)]),ke.value.length?(l(),n("div",Dn,[t("div",Bn,[(l(!0),n(S,null,C(ke.value,u=>(l(),n("button",{key:u,type:"button",onClick:F=>De("suggestions",u),disabled:we("suggestions",u),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-sky-300 hover:bg-sky-50 hover:text-sky-800 disabled:opacity-40 disabled:cursor-not-allowed"},o(u),9,Kn))),128))])])):h("",!0),t("div",Qn,[e[37]||(e[37]=t("label",{class:"text-[11px] font-medium text-slate-500"}," Suggestions / Development plan ",-1)),me(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=u=>y.value=u),placeholder:"Specific actions, training plans, timeline and expectations…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-sky-200"},null,512),[[Se,y.value]])])])])])):h("",!0),t("div",Vn,[t("div",zn,[e[39]||(e[39]=B(" My (Personal) Total: ")),t("b",On,o(ue.value.got.toFixed(2)),1),t("span",qn,"/ "+o(ue.value.max.toFixed(2)),1)]),t("button",{onClick:cs,disabled:!(D.value||Ge.value),class:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-emerald-700 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-emerald-300"}," Submit ",8,Un)])])),ms(ys,{name:"fade-scale"},{default:fs(()=>{var u,F,Ct;return[Re.value&&A.value?(l(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:gs(He,["escape","window"])},[t("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:He}),t("div",Yn,[t("div",Wn,[t("div",null,[t("p",Jn,o(A.value.label),1),t("p",Xn," Lane: "+o(A.value.lane)+" - Reviewed by "+o(A.value.reviewer_name||"––"),1),A.value.submitted_at?(l(),n("p",Zn,o(new Date(A.value.submitted_at).toLocaleString()),1)):h("",!0)]),t("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:He}," Close ")]),t("div",eo,[t("div",null,[e[40]||(e[40]=t("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[t("span",null,"Strengths")],-1)),t("div",to,[(u=A.value.strengths)!=null&&u.length?(l(),n("div",so,[(l(!0),n(S,null,C(A.value.strengths,(ve,xe)=>(l(),n("p",{key:"modal-strength-"+xe}," - "+o(ve),1))),128))])):(l(),n("p",lo,"No strengths entered."))])]),t("div",null,[e[41]||(e[41]=t("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[t("span",null,"Gaps")],-1)),t("div",ao,[(F=A.value.gaps)!=null&&F.length?(l(),n("div",no,[(l(!0),n(S,null,C(A.value.gaps,(ve,xe)=>(l(),n("p",{key:"modal-gap-"+xe}," - "+o(ve),1))),128))])):(l(),n("p",oo,"No gaps recorded."))])]),t("div",null,[e[42]||(e[42]=t("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[t("span",null,"Suggestions")],-1)),t("div",ro,[(Ct=A.value.suggestions)!=null&&Ct.length?(l(),n("div",io,[(l(!0),n(S,null,C(A.value.suggestions,(ve,xe)=>(l(),n("p",{key:"modal-sug-"+xe}," - "+o(ve),1))),128))])):(l(),n("p",uo,"No suggestions provided."))])])])])],32)):h("",!0)]}),_:1})],64)}}},mo={__name:"KpiReviewPage",setup(r){return(E,R)=>(l(),Qe(co))}};export{mo as default};
