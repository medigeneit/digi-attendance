import{y as S,c as d,o,a as s,F as q,x as V,f as b,l as _,_ as K,t as x,s as X,b as Y,u as Z,r as v,D as ee,e as se,A as M,m as $,p as A,g as te,C as ae,h as p,w as H}from"./index-CTe6av8Q.js";import{_ as ne}from"./CommentModal-JJGffWSO.js";import{g as oe,u as le,O as N,_ as re}from"./task-priority-B8zTVFa6.js";import{_ as ie}from"./MultiselectDropdown-gsFmRC7L.js";import{_ as de}from"./TaskAddForm-COdXGsHb.js";import{_ as ue}from"./TaskEditForm-BiFrc87V.js";import{_ as O}from"./TaskTreeView-BWsN5kwA.js";import{u as ce}from"./company-8-75UPnY.js";import{u as me}from"./useTaskStore-BMTRq8ip.js";import"./useCommentStore-CQZTqOCF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-BCg1dR7J.js";import"./useRequirementStore-CsDqlXWw.js";import"./SectionLoading-9W_fHs3j.js";const pe={class:"w-full bg-white rounded"},fe=["rowspan"],ye={class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm"},ve={class:"text-xs text-gray-700 mr-2 hidden md:inline"},_e={class:"border p-4"},ke={class:""},he={__name:"UserWiseList",props:{tasks:Array},setup(B){const u=B,k=S(()=>u.tasks.reduce((t,f)=>(t.push(...f.users.filter(a=>!t.find(r=>r.id==a.id))),t),[])),L=t=>{const f=u.tasks,a=new Map(f.map(l=>[l.id,l])),r=new Set,c=[],C=f.filter(l=>l.users.some(m=>m.id===t));for(const l of C){r.has(l.id)||(r.add(l.id),c.push(l));let m=l.parent_id;for(;m&&a.has(m)&&!r.has(m);){const y=a.get(m);r.add(y.id),c.push(y),m=y.parent_id}}return c},T=S(()=>k.value.map(t=>{const f=oe(L(t.id),0);return{...t,tasks:f}}));return(t,f)=>(o(),d("div",null,[s("table",pe,[s("tbody",null,[(o(!0),d(q,null,V(T.value,a=>(o(),d(q,{key:a.id},[(o(!0),d(q,null,V(a.tasks,(r,c)=>(o(),d("tr",{key:r.id},[c==0?(o(),d("td",{key:0,class:"border p-4 align-top",rowspan:Math.max(a.tasks.length,1)},[s("div",ye,[_(K,{user:a,class:"w-6 h-6 !text-xs"},null,8,["user"]),s("span",ve,x(a.id)+" - "+x(a==null?void 0:a.name),1)])],8,fe)):b("",!0),s("td",_e,x(c+1),1),s("td",ke,[_(O,{task:r,class:"!border-0"},null,8,["task"])])]))),128))],64))),128))])])]))}},ge={class:"container mx-auto p-6 relative"},we={class:"mb-3"},be={class:"flex flex-wrap items-center gap-2 mt-3"},xe={class:"flex gap-4"},Te={class:"flex-shrink-0 w-full md:w-64 text-gray-600"},Ce=["value"],Ie={class:"ml-auto flex gap-6 items-center"},$e={key:0,class:"flex gap-2 items-center"},qe={key:2,class:"text-center py-4 text-red-500"},Se={class:"space-y-4"},Le=1,Ge={__name:"TaskList",setup(B){const u=me(),k=ce(),{companies:L,employees:T}=X(k),t=Y(),f=Z(),a=v(!1),r=v(null),c=S(E("company-id")),C=S(E("user-id")),l=v(),m=v(!1),y=v(null),I=v(!1),h=ee({parentId:0,requirementId:0}),D=v(null);se(async()=>{await k.fetchCompanies(),await g()});const P=n=>{I.value=!0,h.parentId=n};function E(n){return{set:e=>{f.push({query:{...t.query,[n]:e||void 0}})},get:()=>t.query[n]||""}}const U=n=>{r.value=n,a.value=!0},j=()=>{a.value=!1,r.value=null};M(()=>c.value,async n=>{n&&(await k.fetchEmployee(n),l.value=T.value.find(e=>e.id==C.value)||null)},{initial:!0,immediate:!0}),M(()=>({"user-id":t.query["user-id"],"company-id":t.query["company-id"]}),async()=>{g()});async function g(){m.value=!!t.query["user-id"],await u.fetchTasks({user_ids:t.query["user-id"]||void 0,company_id:t.query["company-id"]||void 0},{loadingBeforeFetch:!0})}async function F(){y.value=null,I.value=!1,h.parentId=0,await g()}async function G(){I.value=!1,h.parentId=0,await g()}M(l,n=>{C.value=n==null?void 0:n.id});const{handleItemsPriorityUpdate:Q,saveTaskPriority:W,listHasRearranged:z}=le(()=>u.taskListTree,0);async function J(){W()&&await g()}return(n,e)=>{var R;return o(),d("div",ge,[y.value?(o(),$(N,{key:0},{default:A(()=>[_(ue,{taskId:y.value,class:"rounded-full",onClose:e[0]||(e[0]=i=>y.value=null),onUpdated:F},null,8,["taskId"])]),_:1})):b("",!0),I.value?(o(),$(N,{key:1},{default:A(()=>[_(de,{parentTaskId:h.parentId,requirementId:h.requirementId,class:"rounded-full",onClose:G,onTaskCreated:F},null,8,["parentTaskId","requirementId"])]),_:1})):b("",!0),s("div",we,[e[9]||(e[9]=s("div",{class:"flex justify-between items-center"},[s("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),s("div",be,[s("div",xe,[s("div",Te,[te(s("select",{id:"company-filter","onUpdate:modelValue":e[1]||(e[1]=i=>c.value=i),class:"input-1 h-full"},[e[7]||(e[7]=s("option",{value:""},"Select Company",-1)),(o(!0),d(q,null,V(p(L),i=>(o(),d("option",{key:i.id,value:i.id},x(i.name),9,Ce))),128))],512),[[ae,c.value]])]),_(ie,{modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=i=>l.value=i),options:p(T),multiple:!1,label:"name","label-prefix":"id",placeholder:"Please select employee...",class:"w-full md:w-64 text-gray-600"},null,8,["modelValue","options"])]),s("div",Ie,[p(z)?(o(),d("div",$e,[e[8]||(e[8]=s("span",{class:"text-red-500"},"Priority Changed",-1)),s("button",{class:"btn-3",onClick:H(J,["prevent"])},"Save"),s("button",{class:"btn-3",onClick:e[3]||(e[3]=H((...i)=>D.value.resetItems&&D.value.resetItems(...i),["prevent"]))},"Discard")])):b("",!0),s("button",{onClick:P,class:"btn-1"},"Add Task")])])]),p(u).error?(o(),d("div",qe,x(p(u).error),1)):b("",!0),s("div",Se,[((R=p(t).query)==null?void 0:R.view)=="userwise"?(o(),$(he,{key:0,tasks:p(u).tasks},null,8,["tasks"])):(o(),$(re,{key:1,items:p(u).taskListTree,handle:"handle",onItemsUpdate:p(Q),class:"space-y-4",ref_key:"draggableTaskList",ref:D},{item:A(({item:i})=>[_(O,{task:i,class:"!border-0",onCommentButtonClick:e[4]||(e[4]=w=>U(w,n.task.id)),onEditClick:e[5]||(e[5]=w=>y.value=w),onAddClick:e[6]||(e[6]=w=>P(w)),showDraggableHandle:!m.value},null,8,["task","showDraggableHandle"])]),_:1},8,["items","onItemsUpdate"]))]),_(ne,{show:a.value,"commentable-id":r.value,"commentable-type":"task","user-id":Le,"on-close":j,onSubmitted:p(u).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Ge as default};
