import{N as j,u as A,b as T,r as v,x as k,z as K,e as I,K as R,A as q,m as D,c as i,o as l,a as e,n as S,t as d,i as V,j as u,h as y,g as c,B as O,v as x,w as P}from"./index-DjV6lDov.js";import{u as $}from"./monthly-kpi-forms-DrM3QGoV.js";const z={class:"my-container mx-auto max-w-4xl px-4 py-6"},G={class:"mb-6 flex items-center justify-between"},H={class:"text-xl font-semibold text-gray-900"},J={class:"grid gap-6"},Q={key:0,class:"mt-1 text-sm text-red-600"},W={class:"grid gap-4 md:grid-cols-2"},X={key:0,class:"mt-1 text-sm text-red-600"},Y={key:0,class:"mt-1 text-sm text-red-600"},Z={class:"grid gap-4 md:grid-cols-2"},tt={key:0,class:"mt-1 text-sm text-red-600"},et={key:0,class:"mt-1 text-sm text-red-600"},ot={class:"mt-8 flex items-center justify-end gap-3"},rt=["disabled"],st={key:0,class:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none"},lt={__name:"MonthlyKpiFormForm",setup(nt){const _=j(),C=A(),L=T(),p=$(),U=v([]),b=k(()=>{var t;const s=Number((t=L.params)==null?void 0:t.id);return Number.isFinite(s)&&s>0?s:null}),m=k(()=>!!b.value),o=K({type:"staff",start_month:"",end_month:"",performance_mark:25,target_marks:25}),f=v(!1),g=v(!1),n=K({type:"",start_month:"",end_month:"",performance_mark:"",target_marks:""}),w=k(()=>{var t,r;const s=((t=o.start_month)==null?void 0:t.match(/^\d{4}-\d{2}$/))&&(!o.end_month||((r=o.end_month)==null?void 0:r.match(/^\d{4}-\d{2}$/)));return!f.value&&s});function M(){Object.keys(n).forEach(s=>n[s]="")}async function B(){var s,t;if(m.value){g.value=!0,M();try{const r=await p.fetchOne(b.value);o.type=r.type||"staff",o.start_month=r.start_month||"",o.end_month=r.end_month||"",o.performance_mark=r.performance_mark??25,o.target_marks=r.target_marks??0}catch(r){_.error(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load form")}finally{g.value=!1}}}async function F(){var s;if(w.value){f.value=!0,M();try{m.value?(await p.updateForm(b.value,{...o}),_.success("Form updated successfully")):(await p.createForm({...o}),_.success("Form created successfully")),await p.fetchList(),C.replace({name:"MonthlyKpiFormList"})}catch(t){const r=(s=t==null?void 0:t.response)==null?void 0:s.data;if(r!=null&&r.errors)for(const[a,h]of Object.entries(r.errors))n[a]=Array.isArray(h)?h[0]:String(h);_.error((r==null?void 0:r.message)||(m.value?"Failed to update":"Failed to create"))}finally{f.value=!1}}}function E(s){(s.ctrlKey||s.metaKey)&&s.key==="Enter"&&(s.preventDefault(),F())}I(async()=>{window.addEventListener("keydown",E),B(),U.value=await p.fetchAvailableCriteria()}),R(()=>window.removeEventListener("keydown",E));const N=v(!1);return q(()=>[o.type,o.start_month,o.end_month,o.performance_mark,o.target_marks],()=>{N.value=!0}),(s,t)=>{const r=D("RouterLink");return l(),i("div",z,[e("div",G,[e("h1",H,d(m.value?"Edit Monthly KPI Form":"Create Monthly KPI Form"),1),S(r,{to:{name:"MonthlyKpiFormList"},class:"inline-flex items-center rounded-lg border px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:V(()=>t[5]||(t[5]=[u(" Back to list ")])),_:1,__:[5]})]),e("form",{onSubmit:P(F,["prevent"]),class:"card-bg rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",novalidate:""},[e("div",J,[e("div",null,[t[7]||(t[7]=e("label",{class:"mb-1 block text-sm font-medium text-gray-700"},[u("Type "),e("span",{class:"text-red-500"},"*")],-1)),y(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.type=a),class:"w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"},t[6]||(t[6]=[e("option",{value:"admin"},"Admin",-1),e("option",{value:"executive"},"Executive",-1),e("option",{value:"staff"},"Staff",-1)]),512),[[O,o.type]]),n.type?(l(),i("p",Q,d(n.type),1)):c("",!0)]),e("div",W,[e("div",null,[t[8]||(t[8]=e("label",{for:"start_month",class:"mb-1 block text-sm font-medium text-gray-700"},[u("Start Month "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{id:"start_month",type:"month","onUpdate:modelValue":t[1]||(t[1]=a=>o.start_month=a),class:"w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",required:""},null,512),[[x,o.start_month]]),n.start_month?(l(),i("p",X,d(n.start_month),1)):c("",!0)]),e("div",null,[t[9]||(t[9]=e("label",{for:"end_month",class:"mb-1 block text-sm font-medium text-gray-700"},"End Month",-1)),y(e("input",{id:"end_month",type:"month","onUpdate:modelValue":t[2]||(t[2]=a=>o.end_month=a),class:"w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"},null,512),[[x,o.end_month]]),n.end_month?(l(),i("p",Y,d(n.end_month),1)):c("",!0)])]),e("div",Z,[e("div",null,[t[10]||(t[10]=e("label",{for:"performance_mark",class:"mb-1 block text-sm font-medium text-gray-700"},[u("Performance Mark "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{id:"performance_mark",type:"number",min:"1",step:"1","onUpdate:modelValue":t[3]||(t[3]=a=>o.performance_mark=a),class:"w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",required:""},null,512),[[x,o.performance_mark,void 0,{number:!0}]]),n.performance_mark?(l(),i("p",tt,d(n.performance_mark),1)):c("",!0)]),e("div",null,[t[11]||(t[11]=e("label",{for:"target_marks",class:"mb-1 block text-sm font-medium text-gray-700"},[u("Target Marks "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{id:"target_marks",type:"number",min:"0",step:"1","onUpdate:modelValue":t[4]||(t[4]=a=>o.target_marks=a),class:"w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",required:""},null,512),[[x,o.target_marks,void 0,{number:!0}]]),n.target_marks?(l(),i("p",et,d(n.target_marks),1)):c("",!0)])])]),e("div",ot,[S(r,{to:{name:"MonthlyKpiFormList"},class:"inline-flex items-center rounded-lg border px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:V(()=>t[12]||(t[12]=[u(" Cancel ")])),_:1,__:[12]}),e("button",{type:"submit",disabled:!w.value||g.value,class:"inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 disabled:opacity-50 disabled:cursor-not-allowed"},[f.value||g.value?(l(),i("svg",st,t[13]||(t[13]=[e("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",opacity:"0.25"},null,-1),e("path",{d:"M22 12a10 10 0 0 1-10 10",stroke:"currentColor","stroke-width":"4"},null,-1)]))):c("",!0),e("span",null,d(f.value||g.value?m.value?"Updating…":"Saving…":m.value?"Update":"Save"),1)],8,rt)])],32)])}}};export{lt as default};
