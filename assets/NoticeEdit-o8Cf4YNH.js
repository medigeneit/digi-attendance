import{z as I,i as P,r as x,s as C,p as U,b as z,q as F,c as i,a as l,j as G,w as $,d as n,A as E,F as H,x as J,h as p,v as _,e as y,C as L,k as V,l as c,t as M,m as K,f as O,g as Q,n as W,o as d}from"./index-X8p7xWov.js";import{L as X}from"./LoaderView-7Koipl9q.js";import{_ as Y}from"./TextEditor-_nivI3da.js";import{u as Z}from"./company-Drd-f5hn.js";import{u as ee}from"./department-Db3uOT5f.js";import{u as te}from"./notice-Ba2LEjZ1.js";import{s as T}from"./vue-multiselect.esm-DWzPe2bs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"my-container space-y-2"},se={class:"card-bg md:p-8 p-4 mx-4"},oe={class:"grid gap-4"},ae={class:"border p-4 rounded-md bg-gray-100"},de={class:"grid md:grid-cols-2 gap-4"},ie=["value"],ne={key:0},re={key:1},pe={class:"col-span-3 flex justify-between gap-8"},ue={class:"w-full"},me={class:"w-full"},fe={key:0,class:"mb-2"},ye=["href"],ce={key:1,class:"text-sm text-gray-600 mt-1"},be={class:"col-span-full"},ve={class:"flex justify-center gap-4"},Ce={__name:"NoticeEdit",setup(ge){const s=I({title:"",type:"",description:"",published_at:"",expired_at:"",company_id:"all",department_id:"",file:"",all_departments:!1,all_employees:!1}),b=te(),v=Z(),u=ee(),g=P(),w=O(),k=Q(),m=x(!1);C(v);const{employees:A}=C(u),r=x([]),N=U(()=>r.value.map(o=>o.id)),f=x([]),D=U(()=>f.value.map(o=>o.id)),h=()=>{s.value.all_departments&&(N.value=[])},R=()=>{s.value.all_employees&&(D.value=[])};z(async()=>{m.value=!0,await v.fetchCompanies(),await j(),m.value=!1}),F(()=>s.company_id,async o=>{o&&(await u.fetchDepartments(o),m.value=!1)});const B=async o=>{const e=o.target.files[0];if(e){const a=new FormData;a.append("file",e);const t=await b.fetchFileUpload(a);console.log({response:t==null?void 0:t.url}),s.file=t==null?void 0:t.url}},S=o=>{if(!o)return;const e=o.split(" ")[0];if(!e.includes("-")){formattedDate.value="Invalid Date Format";return}return e},j=async()=>{var o,e;try{const a=w.params.id,t=await b.fetchNotice(a);s.title=t.title,s.type=t.type,s.file=t.file,s.published_at=S(t.published_at),s.expired_at=S(t.expired_at),s.description=t.description,s.company_id=t.company_id??"all",s.department_id=t.department_id,r.value=t.departments,f.value=t.employees}catch(a){const t=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to load notice data";g.error(t),k.push({name:"NoticeList"})}},q=async()=>{var o,e;try{const a={...s,department_ids:N.value,employee_ids:D.value};await b.updateNotice(w.params.id,a),g.success("Notice updated successfully"),k.push({name:"NoticeShow",params:{id:w.params.id}})}catch(a){const t=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to update notice";g.error(t)}};return F(r,o=>{const e=o.map(a=>a.id);u.fetchDepartmentEmployee(e)}),(o,e)=>{const a=W("RouterLink");return d(),i("div",le,[l("div",se,[e[25]||(e[25]=l("h2",{class:"title-lg text-center"},"Edit Notice",-1)),m.value?(d(),G(X,{key:0,class:"bg-gray-100 border shadow-none"})):(d(),i("form",{key:1,onSubmit:$(q,["prevent"]),class:"space-y-4"},[l("div",oe,[l("div",ae,[e[21]||(e[21]=l("p",{class:"title-md"},"Notice Info",-1)),e[22]||(e[22]=l("hr",{class:"my-2"},null,-1)),l("div",de,[l("div",null,[e[11]||(e[11]=l("label",null,"Company",-1)),n(l("select",{id:"company_id","onUpdate:modelValue":e[0]||(e[0]=t=>s.company_id=t),class:"w-full border rounded px-3 py-2",required:""},[e[10]||(e[10]=l("option",{value:"all"},"All Company",-1)),(d(!0),i(H,null,J(p(v).companies,t=>(d(),i("option",{key:t==null?void 0:t.id,value:t==null?void 0:t.id},M(t==null?void 0:t.name),9,ie))),128))],512),[[E,s.company_id]])]),l("div",null,[e[13]||(e[13]=l("label",null,"Type*",-1)),n(l("select",{id:"type","onUpdate:modelValue":e[1]||(e[1]=t=>s.type=t),class:"w-full border rounded px-3 py-2",required:""},e[12]||(e[12]=[l("option",{value:"1"},"General",-1),l("option",{value:"2"},"Policy",-1)]),512),[[E,s.type]])]),s.type!=="2"?(d(),i("div",ne,[e[14]||(e[14]=l("label",null,"Publish Date",-1)),n(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.published_at=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[_,s.published_at]])])):y("",!0),s.type!=="2"?(d(),i("div",re,[e[15]||(e[15]=l("label",null,"Expire Date",-1)),n(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.expired_at=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[_,s.expired_at]])])):y("",!0),l("div",pe,[l("div",ue,[l("label",null,[n(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>s.all_departments=t),onChange:h},null,544),[[L,s.all_departments]]),e[16]||(e[16]=V(" Select All Departments "))]),c(p(T),{modelValue:r.value,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value=t),options:p(u).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",class:"w-full p-2 border rounded",disabled:s.all_departments},null,8,["modelValue","options","disabled"])]),l("div",me,[l("label",null,[n(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=t=>s.all_employees=t),onChange:R},null,544),[[L,s.all_employees]]),e[17]||(e[17]=V(" Select All Employees "))]),c(p(T),{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=t=>f.value=t),options:p(A),multiple:!0,searchable:!0,placeholder:"Select Employee","track-by":"id",label:"name",class:"w-full p-2 border rounded",disabled:s.all_employees},null,8,["modelValue","options","disabled"])])]),l("div",null,[e[18]||(e[18]=l("label",null,"Title*",-1)),n(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>s.title=t),type:"text",class:"w-full p-2 border rounded"},null,512),[[_,s.title]])]),l("div",null,[e[19]||(e[19]=l("label",null,"File",-1)),s.file&&typeof s.file=="string"?(d(),i("div",fe,[l("a",{href:s.file,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,ye)])):y("",!0),l("input",{type:"file",onChange:B,class:"w-full p-2 border rounded"},null,32),o.fileName?(d(),i("p",ce," Selected File: "+M(o.fileName),1)):y("",!0)]),l("div",be,[e[20]||(e[20]=l("label",null,"Description",-1)),c(Y,{modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=t=>s.description=t),cols:"30",rows:"10",class:"w-full px-4 py-2"},null,8,["modelValue"])])])])]),l("div",ve,[c(a,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:K(()=>e[23]||(e[23]=[V(" Cancel ")])),_:1}),e[24]||(e[24]=l("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32))])])}}};export{Ce as default};
