import{r as _,e as W,c,o as r,a as e,f as D,g as f,w as k,F as R,h as T,j as E,y as C,v as L,i as S,A as ae,t as y,p as de,C as ue,x as B,n as U,q as xe,k as me,b as ye,u as ge,z as P}from"./index-a28d4SfU.js";import{L as H}from"./LoaderView-DrzrmSgJ.js";import{O as z}from"./OverlyModal-sH69os91.js";import{R as pe}from"./RequiredIcon-CZPEQy0a.js";import{f as J}from"./requirement-CTCwVp8r.js";import{a as ke,f as ce,d as we,u as _e,_ as he}from"./TaskAddForm-k6n5XVaK.js";import{u as be}from"./department-rjMU2MUj.js";import{S as ve}from"./SelectDropdown-d0rp2LPa.js";import{_ as G}from"./UserChip-C7PCJUu1.js";import{u as fe}from"./user-Cx_6g2MT.js";import{_ as $e}from"./TaskUserChip-BWg_xdg0.js";import{u as qe}from"./useTaskStore-CCJWdNCj.js";import{_ as oe}from"./TaskStatus-5MAsWm-T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-D9Lh1qmZ.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-Ct-iJoUS.js";import"./SectionLoading-xA1mHifX.js";import"./TextWithHr-DfpA9pc8.js";import"./TaskUrgencyInput-Dnv0Gdkf.js";const Ce={class:"sticky top-0 pt-4 bg-white z-10"},De={class:"mb-4"},Ie={class:"block text-gray-600 text-sm mb-1 font-medium"},Se={class:"mb-4"},Re={class:"mb-4"},Te={class:"mb-4"},Ee={class:"mb-4"},Ve={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Ne={key:0,class:"mb-4 text-red-500 font-medium"},Ae={key:1,class:"mb-4"},Ue={class:"flex items-center justify-between gap-4"},Le=["disabled"],Fe={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["create","closeClick","error"],setup(g,{emit:I}){const w=g,x=I,a=be(),v=_(),d=_(""),b=_(),l=_({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),h=_([]);async function i(){var s,o;d.value="submitting";const u={...l.value};console.log({payload:u});try{const p=await ke(w.requirementId,u);x("create",p),d.value="create"}catch(p){d.value="error",b.value=((o=(s=p.response)==null?void 0:s.data)==null?void 0:o.message)||"Failed to create requirement detail",x("error",b.value)}}return W(async()=>{var s;const u=((s=(await J(w.requirementId)).data)==null?void 0:s.requirement)||{};h.value=await a.fetchDepartmentEmployee([u.from_department_id])}),(u,s)=>(r(),c("div",{class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative",ref_key:"formContainerRef",ref:v},[e("div",Ce,[s[7]||(s[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement",-1)),s[8]||(s[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:s[0]||(s[0]=k(o=>x("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:k(i,["prevent"]),class:"z-0"},[d.value!=="loading"?(r(),c(R,{key:0},[e("div",De,[e("label",Ie,[s[9]||(s[9]=E("Title ")),C(pe)]),T(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>l.value.title=o),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,l.value.title]])]),e("div",Se,[s[10]||(s[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Details",-1)),T(e("textarea",{rows:"10","onUpdate:modelValue":s[2]||(s[2]=o=>l.value.description=o),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,l.value.description]])]),e("div",Re,[s[12]||(s[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),C(ve,{modelValue:l.value.supervisor_id,"onUpdate:modelValue":s[3]||(s[3]=o=>l.value.supervisor_id=o),options:h.value,placeholder:"--NO SUPERVISOR--",containment:v.value,clearable:"",class:"h-10"},{"list-header":S(()=>s[11]||(s[11]=[e("div",{class:"px-3 pt-2 pb-1 shadow-md text-xs uppercase bg-gray-50 text-gray-500"}," Employees ",-1)])),option:S(({option:o})=>[C(G,{user:o||{},class:"pr-5 -mx-1"},null,8,["user"])]),"selected-option":S(({option:o})=>[o?(r(),D(G,{key:0,user:o||{},class:"pr-4"},null,8,["user"])):f("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",Te,[s[14]||(s[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),T(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":s[4]||(s[4]=o=>l.value.priority=o)},s[13]||(s[13]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ae,l.value.priority]])]),e("div",Ee,[s[15]||(s[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),T(e("input",{type:"date","onUpdate:modelValue":s[5]||(s[5]=o=>l.value.better_to_complete_on=o),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,l.value.better_to_complete_on]])])],64)):f("",!0),e("div",Ve,[b.value?(r(),c("div",Ne,y(b.value),1)):f("",!0),b.value?(r(),c("hr",Ae)):f("",!0),e("div",Ue,[e("button",{type:"button",onClick:s[6]||(s[6]=k(o=>x("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:d.value=="loading"||d.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},y(d.value=="submitting"?"Saving...":"Add Requirement"),9,Le)])])],32),d.value==="loading"||d.value==="submitting"?(r(),D(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):f("",!0)],512))}},Oe={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Me={class:"mb-4"},je={class:"font-semibold"},Pe={class:"mb-4"},ze={class:"line-clamp-2"},Be={key:1,class:"min-h-40"},Ge={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},We={key:0,class:"mb-4 text-red-500 font-medium"},He={key:1,class:"mb-4"},Je={class:"flex items-center justify-between gap-4"},Ke=["disabled"],Qe={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(g,{emit:I}){const w=g,x=I,a=fe(),v=_(null),d=_(""),b=_(),l=_([]);async function h(){var i,u;d.value="submitting";try{const s=await we(w.requirementId,w.detailId);x("delete",s),d.value="create"}catch(s){d.value="error",b.value=((u=(i=s.response)==null?void 0:i.data)==null?void 0:u.message)||"Failed to update requirement detail: "+s,x("error",b.value)}}return W(async()=>{var i,u,s;d.value="loading";try{l.value=await a.fetchDepartmentWiseEmployees(),v.value=(i=(await ce(w.requirementId,w.detailId)).data)==null?void 0:i.detail}catch(o){b.value=((s=(u=o.response)==null?void 0:u.data)==null?void 0:s.message)||"Failed to fetch requirement detail"}finally{d.value=""}}),(i,u)=>{var s,o;return r(),c("div",Oe,[u[4]||(u[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:k(h,["prevent"]),class:"z-0"},[d.value!=="loading"?(r(),c(R,{key:0},[e("div",Me,[u[1]||(u[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",je,y((s=v.value)==null?void 0:s.title),1)]),e("div",Pe,[u[2]||(u[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",ze,y((o=v.value)==null?void 0:o.description),1)]),u[3]||(u[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(r(),c("div",Be)),e("div",Ge,[b.value?(r(),c("div",We,y(b.value),1)):f("",!0),b.value?(r(),c("hr",He)):f("",!0),e("div",Je,[e("button",{type:"button",onClick:u[0]||(u[0]=k(p=>x("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:d.value=="loading"||d.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},y(d.value=="submitting"?"Deleting...":"Delete"),9,Ke)])])],32),d.value==="loading"||d.value==="submitting"?(r(),D(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):f("",!0)])}}},Xe={class:"sticky top-0 pt-4 bg-white z-10"},Ye={class:"mb-4"},Ze={class:"block text-gray-600 text-sm mb-1 font-medium"},et={class:"mb-4"},tt={class:"mb-4"},st={key:0,class:"relative w-full"},lt={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},rt={class:"mb-4"},it={class:"mb-4"},nt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ot={key:0,class:"mb-4 text-red-500 font-medium"},at={key:1,class:"mb-4"},dt={class:"flex items-center justify-between gap-4"},ut=["disabled"],mt={__name:"RequirementDetailEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(g,{emit:I}){const w=g,x=I,a=_(),v=fe(),d=be(),b=_(null),l=_(""),h=_(),i=_({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),u=_([]),s=_([]);async function o(){var n,$;l.value="submitting";const p={...i.value};try{const m=await _e(w.requirementId,w.detailId,p);x("update",m),l.value="create"}catch(m){l.value="error",h.value=(($=(n=m.response)==null?void 0:n.data)==null?void 0:$.message)||"Failed to update requirement detail",x("error",h.value)}}return W(async()=>{var p,n,$,m,t,V,F,O;l.value="loading";try{u.value=await v.fetchDepartmentWiseEmployees();const N=((p=(await J(w.requirementId)).data)==null?void 0:p.requirement)||{};s.value=await d.fetchDepartmentEmployee([N.from_department_id]),b.value=(n=(await ce(w.requirementId,w.detailId)).data)==null?void 0:n.detail,i.value={title:($=b.value)==null?void 0:$.title,description:(m=b.value)==null?void 0:m.description,priority:(t=b.value)==null?void 0:t.priority,supervisor_id:(V=b.value)==null?void 0:V.supervisor_id};const M=new Date(b.value.better_to_complete_on);i.value.better_to_complete_on=M.toISOString().split("T")[0]}catch(N){h.value=((O=(F=N.response)==null?void 0:F.data)==null?void 0:O.message)||"Failed to fetch requirement detail"}finally{l.value=""}}),(p,n)=>{var $;return r(),c("div",{ref_key:"formContainerRef",ref:a,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Xe,[n[8]||(n[8]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),n[9]||(n[9]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:n[0]||(n[0]=k(m=>x("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:k(o,["prevent"]),class:"z-0"},[l.value!=="loading"?(r(),c(R,{key:0},[e("div",Ye,[e("label",Ze,[n[10]||(n[10]=E("Title ")),C(pe)]),T(e("input",{"onUpdate:modelValue":n[1]||(n[1]=m=>i.value.title=m),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,i.value.title]])]),e("div",et,[n[11]||(n[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),T(e("textarea",{rows:"10","onUpdate:modelValue":n[2]||(n[2]=m=>i.value.description=m),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,i.value.description]])]),e("div",tt,[n[12]||(n[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),C(ve,{modelValue:i.value.supervisor_id,"onUpdate:modelValue":n[4]||(n[4]=m=>i.value.supervisor_id=m),options:[...s.value,...s.value.find(m=>{var t,V;return m.id==((V=(t=b.value)==null?void 0:t.supervisor)==null?void 0:V.id)})?[]:[($=b.value)==null?void 0:$.supervisor]],containment:a.value,placeholder:"--NO SUPERVISOR--",class:"h-10"},{option:S(({option:m})=>[C(G,{user:m||{}},null,8,["user"])]),"selected-option":S(({option:m})=>[m?(r(),c("div",st,[C(G,{user:m||{}},null,8,["user"]),i.value.supervisor_id?(r(),c("div",lt,[e("button",{onClick:n[3]||(n[3]=k(t=>i.value.supervisor_id=null,["prevent"])),class:"text-gray-6 font-semibold 00 hover:text-red-700"}," Ã— ")])):f("",!0)])):f("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",rt,[n[14]||(n[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),T(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":n[5]||(n[5]=m=>i.value.priority=m)},n[13]||(n[13]=[e("option",{value:null},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ae,i.value.priority]])]),e("div",it,[n[15]||(n[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),T(e("input",{type:"date","onUpdate:modelValue":n[6]||(n[6]=m=>i.value.better_to_complete_on=m),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,i.value.better_to_complete_on]])])],64)):f("",!0),e("div",nt,[h.value?(r(),c("div",ot,y(h.value),1)):f("",!0),h.value?(r(),c("hr",at)):f("",!0),e("div",dt,[e("button",{type:"button",onClick:n[7]||(n[7]=k(m=>x("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},y(l.value=="submitting"?"Saving...":"Edit Detail"),9,ut)])])],32),l.value==="loading"||l.value==="submitting"?(r(),D(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):f("",!0)],512)}}},pt=["rowspan"],ct={class:"text-2xl font-medium"},bt=["rowspan"],vt={class:"text-lg font-semibold mb-2"},ft={class:"mb-5"},xt={class:"text-justify"},yt=["innerHTML"],gt={class:"flex items-end"},kt={class:"flex items-center gap-1 mb-3"},wt={class:"text-blue-400 font-semibold"},_t={class:"ml-auto flex gap-6 items-center"},ht=["rowspan"],$t={class:"border-2 border-gray-700 p-3 text-center"},qt=["title"],Ct={class:"border-2 border-gray-700 p-3"},Dt={class:"whitespace-nowrap text-center print:whitespace-break-spaces"},It={key:0},St={key:1,class:"text-gray-500"},Rt={key:2,colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Tt={__name:"RequirementDetailTableRow",props:{detail:{type:Object},serial:{type:Number}},emits:["editClick","deleteClick","taskCreateClick"],setup(g,{emit:I}){const w=g,x=I,a=_("line-clamp-2");function v(){a.value=a.value?"":"line-clamp-2"}const d=de(()=>{var b,l,h;return((l=(b=w.detail)==null?void 0:b.tasks)==null?void 0:l.length)>0?(h=w.detail)==null?void 0:h.tasks:[{id:0}]});return(b,l)=>{const h=ue("RouterLink");return r(!0),c(R,null,B(d.value,(i,u)=>{var s,o,p,n,$,m;return r(),c("tr",{key:i.id,class:"group/item border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},[u===0?(r(),c(R,{key:0},[e("td",{class:"border-2 border-gray-700 p-3 align-top",rowspan:((o=(s=g.detail)==null?void 0:s.tasks)==null?void 0:o.length)||1},[e("span",ct,y(g.serial),1)],8,pt),e("td",{class:"border-2 border-gray-700 p-3",rowspan:((n=(p=g.detail)==null?void 0:p.tasks)==null?void 0:n.length)||1},[e("div",null,[e("div",vt,[e("span",null,y(g.detail.title),1)]),l[4]||(l[4]=e("hr",{class:"mb-4 -mx-4"},null,-1)),e("div",ft,[l[3]||(l[3]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),e("div",xt,[e("p",{class:U(["print:line-clamp-none",a.value]),innerHTML:g.detail.description},null,10,yt),e("button",{class:"text-blue-500 group-hover/item:underline hover:text-sky-400 ml-auto text-sm print:hidden",onClick:k(v,["prevent"])},y(a.value?"Show More":"Show Less"),1)])])]),e("div",gt,[e("div",null,[e("div",kt,[l[5]||(l[5]=e("span",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Supervisor:",-1)),g.detail.supervisor?(r(),D($e,{key:0,user:g.detail.supervisor},null,8,["user"])):f("",!0)]),e("div",null,[l[6]||(l[6]=e("span",{class:"text-gray-500 mr-2 text-xs uppercase font-semibold"},"Priority:",-1)),e("span",wt,y(g.detail.priority),1)])]),e("div",_t,[e("button",{class:"btn-2",onClick:l[0]||(l[0]=k(t=>x("editClick",g.detail),["prevent"]))},l[7]||(l[7]=[e("i",{class:"fas fa-edit"},null,-1),E("Edit ")])),e("button",{class:"btn-2-red",onClick:l[1]||(l[1]=k(t=>x("deleteClick",g.detail),["prevent"]))},l[8]||(l[8]=[e("i",{class:"fas fa-trash-alt"},null,-1),E("Delete ")]))])])],8,bt),e("td",{class:"border-2 border-gray-700 p-3 whitespace-nowrap print:whitespace-break-spaces print:px-0 text-center",rowspan:((m=($=g.detail)==null?void 0:$.tasks)==null?void 0:m.length)||1},[e("div",null,y(new Date(g.detail.better_to_complete_on).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)],8,ht)],64)):f("",!0),i.id?(r(),c(R,{key:1},[e("td",$t,[C(h,{to:{name:"TaskShow",params:{id:i.id}},class:"hover:underline text-gray-900 hover:text-blue-600 whitespace-nowrap block",target:"_blank"},{default:S(()=>[E(y(i.id)+" ",1),e("i",{title:i.status,class:U(["ml-1",{"fad fa-exclamation-circle text-red-600":i.status=="PENDING","fad fa-exclamation-square text-yellow-600":i.status=="IN_PROGRESS","fad fa-check-circle text-green-600":i.status=="COMPLETED"}])},null,10,qt)]),_:2},1032,["to"])]),e("td",Ct,[e("div",Dt,[i.deadline?(r(),c("div",It,y(new Date(i.deadline).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)):(r(),c("div",St,"-"))])])],64)):(r(),c("td",Rt,[e("button",{onClick:l[2]||(l[2]=k(t=>x("taskCreateClick",g.detail),["prevent"])),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"}," Create / Assign Task ")]))])}),128)}}},Et={class:"text-left p-4"},Vt={class:"flex items-center gap-6 justify-center my-16"},Nt={key:0},At={class:"bg-blue-50 px-6 py-4 rounded text-blue-500"},Ut={class:"text-left text-base w-full font-semibold group flex items-center gap-2 mb-5 border-b border-blue-100 py-4"},Lt={class:"flex items-center w-full"},Ft={class:"grow"},Ot={class:"text-center text-red-500 text-sm font-semibold mb-4"},Mt={class:"flex items-center justify-between"},jt={key:1,class:"border rounded-md"},Pt={class:"flex flex-col justify-start items-start min-h-28 max-h-[70vh] overflow-y-auto"},zt=["onClick"],Bt={class:"flex items-center w-full"},Gt={class:"grow"},Wt={class:"line-clamp-1"},Ht={key:0,class:"text-red-400 text-xs font-normal mt-1"},Jt={__name:"TaskParentIdSelector",props:{fromDepartmentId:{type:Number},requirementDetail:{type:Object}},emits:["parentIdSelect","cancelClick","assignTask"],setup(g,{emit:I}){const w=g,x=I,a=qe(),v=_(""),d=_(null);xe(()=>v.value,i=>{["sub-task","direct-assign"].includes(i)&&a.fetchTasks({"from-department-id":w.fromDepartmentId})},{immediate:!0});function b(i){v.value=="sub-task"?x("parentIdSelect",i.id):(i.requirement_detail_id,d.value=i)}async function l(){await a.setTaskRequirement(d.value.id,w.requirementDetail.id)}const h=de(()=>{var i;return(i=a.tasks)==null?void 0:i.filter(u=>u.requirement_detail_id)});return(i,u)=>{var s;return r(),c("div",Et,[e("div",Vt,[e("button",{onClick:u[0]||(u[0]=k(o=>x("parentIdSelect",0,v.value),["prevent"])),class:"btn-3"}," Add as Main Task "),e("button",{class:U({"btn-3":v.value!=="sub-task","btn-2":v.value=="sub-task"}),onClick:u[1]||(u[1]=k(()=>{v.value="sub-task",d.value=null},["prevent"]))}," Add as Sub Task ",2),e("button",{class:U({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:u[2]||(u[2]=k(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value=="direct-assign"&&d.value?(r(),c("div",Nt,[e("div",At,[e("div",Ut,[e("i",{class:U(["fad text-xl group:hover-text-white",((s=d.value)==null?void 0:s.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",Lt,[e("div",Ft,y(d.value.title),1),C(oe,{status:d.value.status,class:"ml-auto"},null,8,["status"])])]),e("div",Ot,y(me(a).error),1),e("div",Mt,[e("button",{onClick:k(l,["prevent"]),class:"btn-2"},"Assign"),e("button",{onClick:u[3]||(u[3]=k(o=>x("cancelClick"),["prevent"])),class:"btn-3"},"Cancel")])])])):f("",!0),v.value&&!d.value?(r(),c("div",jt,[u[4]||(u[4]=e("div",{class:"py-2 px-4 font-bold text-center border-b shadow"},"Click to select task",-1)),e("div",Pt,[(r(!0),c(R,null,B(h.value,o=>(r(),c("div",{key:o.id,class:"w-full mb-2"},[e("button",{type:"button",class:"text-left text-base w-full bg-blue-50 px-2 hover:bg-blue-500 hover:text-white py-2 text-blue-500 font-semibold group flex items-center gap-2",onClick:k(()=>b(o),["prevent"])},[e("i",{class:U(["fad text-xl group:hover-text-white",(o==null?void 0:o.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",Bt,[e("div",Gt,[e("div",Wt,y(o.title),1),o.requirement_detail_id&&v.value=="direct-assign"?(r(),c("div",Ht," Already assigned to a requirement ")):f("",!0)]),C(oe,{status:o.status,class:"ml-auto"},null,8,["status"])])],8,zt)]))),128))])])):f("",!0)])}}},Kt={class:"container mx-auto p-6 print:p-0 w-full print:max-w-full"},Qt={class:"bg-white rounded shadow print:shadow-none p-4 print:p-0 relative"},Xt={class:"flex items-start"},Yt={class:"mb-4 text-lg print:black print:font-bold"},Zt={class:"ml-auto print:hidden flex gap-2 items-center"},es={class:"mb-4 flex items-center gap-1 print:mb-1"},ts={class:"font-bold print:text-gray-900"},ss={class:"mb-3 flex items-center gap-3 print:mb-1"},ls={class:"print:text-gray-900"},rs={key:0,class:"mb-3 flex items-center gap-3 print:mb-1"},is={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},ns={class:"mb-3 flex items-center gap-3 print:mb-1"},os={class:"print:text-gray-900"},as={key:0,class:"overflow-x-auto print:overflow-visible"},ds={class:"w-full table-auto print:table-fixed"},us={colspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap px-3 py-1 print:whitespace-normal w-[25%]"},ms={class:"whitespace-nowrap print:whitespace-break-spaces print:px-0 p-3 text-center border-2 border-gray-800"},ps={class:"text-gray-900 text-base"},cs={class:"mt-8 border rounded-md p-8 flex items-center justify-center bg-gray-50"},Ns={__name:"RequirementShow",setup(g){const I=ye(),w=ge(),x=_(""),a=_(null),v=P({open:!1}),d=P({detail:null,open:!1}),b=P({detail:null,open:!1});W(async()=>{await l()});async function l(){var m;x.value="loading",a.value=(m=(await J(I.params.id)).data)==null?void 0:m.requirement,x.value=""}function h(m){console.log({detail:m}),p.modalShown=!0,p.from_department_id=a.value.from_department_id,p.to_department_id=a.value.to_department_id,p.taskDefaultValues={title:m.title,description:m.description,from_department_id:a.value.from_department_id,to_department_id:a.value.to_department_id},p.requirementDetail=m}function i(){v.open=!0}function u(m){d.open=!0,d.detail=m}function s(m){b.open=!0,b.detail=m}function o(){window.print()}const p=P({parentId:null,modalShown:!1,requirementId:0,taskDefaultValues:{},requirementDetail:null});async function n(){p.parentId=0,p.parentId=null,p.modalShown=!1,p.requirementDetail=null,x.value="loading",await l()}async function $(){p.parentId=null,p.modalShown=!1,p.requirementDetail=null}return(m,t)=>{var F,O,N,M,K,Q,X,Y,Z,ee,te,se,le,re,ie;const V=ue("RouterLink");return r(),c("div",Kt,[v.open?(r(),D(z,{key:0,class:"*:max-w-4xl"},{default:S(()=>[C(Fe,{requirementId:a.value.id,onCloseClick:t[0]||(t[0]=q=>v.open=!1),onCreate:t[1]||(t[1]=async()=>{v.open=!1,await l()})},null,8,["requirementId"])]),_:1})):f("",!0),d.open?(r(),D(z,{key:1},{default:S(()=>{var q;return[C(mt,{requirementId:a.value.id,detailId:(q=d.detail)==null?void 0:q.id,onCloseClick:t[2]||(t[2]=A=>d.open=!1),onUpdate:t[3]||(t[3]=async()=>{d.open=!1,await l()})},null,8,["requirementId","detailId"])]}),_:1})):f("",!0),b.open?(r(),D(z,{key:2},{default:S(()=>{var q;return[C(Qe,{requirementId:a.value.id,detailId:(q=b.detail)==null?void 0:q.id,onCloseClick:t[4]||(t[4]=A=>b.open=!1),onDelete:t[5]||(t[5]=async()=>{b.open=!1,await l()})},null,8,["requirementId","detailId"])]}),_:1})):f("",!0),p.modalShown?(r(),D(z,{key:3,class:"*:relative"},{default:S(()=>{var q,A;return[e("button",{onClick:k($,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},t[8]||(t[8]=[e("i",{class:"fas fa-times-circle"},null,-1)])),p.parentId===null?(r(),D(Jt,{key:0,"from-department-id":(q=a.value)==null?void 0:q.from_department_id,requirementDetail:p==null?void 0:p.requirementDetail,onParentIdSelect:t[6]||(t[6]=j=>p.parentId=j),onCancelClick:$,onAssignTask:n},null,8,["from-department-id","requirementDetail"])):(r(),D(he,{key:1,parentTaskId:p.parentId,requirementDetailId:(A=p==null?void 0:p.requirementDetail)==null?void 0:A.id,requirementId:a.value.id,onClose:$,onTaskCreated:n,defaultValues:p.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["parentTaskId","requirementDetailId","requirementId","defaultValues"]))]}),_:1})):f("",!0),e("div",Qt,[e("div",Xt,[e("div",Yt,[t[9]||(t[9]=e("div",{class:"text-gray-800 leading-none"},"To",-1)),e("div",null,y((O=(F=a.value)==null?void 0:F.to_department)==null?void 0:O.name),1)]),e("div",Zt,[(((N=a.value)==null?void 0:N.details)||[]).length>0?(r(),c("button",{key:0,class:"btn-3 font-semibold !pl-2 !pr-4",onClick:k(o,["prevent"])},t[10]||(t[10]=[e("i",{class:"fad fa-print text-xl"},null,-1),E("Print ")]))):f("",!0),e("button",{class:"btn-3",onClick:t[7]||(t[7]=k(()=>me(w).back(),["prevent"]))},"Back"),C(V,{class:"btn-2",to:`/requirements/edit/${(M=a.value)==null?void 0:M.id}`},{default:S(()=>t[11]||(t[11]=[E("Edit")])),_:1,__:[11]},8,["to"])])]),t[24]||(t[24]=e("div",{class:"text-center text-xl font-bold mb-2 underline"},"Requirement Form",-1)),e("div",es,[t[12]||(t[12]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",ts,y((K=a.value)==null?void 0:K.id),1)]),e("div",ss,[t[13]||(t[13]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),e("div",ls,y((X=(Q=a.value)==null?void 0:Q.from_department)==null?void 0:X.name),1)]),((Z=(Y=a.value)==null?void 0:Y.website_tags)==null?void 0:Z.length)>0?(r(),c("div",rs,[t[14]||(t[14]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",is,[(r(!0),c(R,null,B(((ee=a.value)==null?void 0:ee.website_tags)||[],q=>(r(),c("div",{key:q.id,class:"border px-2 rounded-md bg-gray-50 shadow-sm whitespace-nowrap"},y(q.name),1))),128))])])):f("",!0),e("div",ns,[t[15]||(t[15]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",os,y(new Date((te=a.value)==null?void 0:te.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)]),t[25]||(t[25]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[t[23]||(t[23]=e("div",{class:"flex items-end mb-3"},[e("h2",{class:"text-xl font-semibold"},"Requirements"),e("div",{class:"ml-auto print:hidden flex gap-2 text-sm"})],-1)),(((se=a.value)==null?void 0:se.details)||[]).length>0?(r(),c("div",as,[e("table",ds,[e("thead",null,[e("tr",null,[t[16]||(t[16]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-left px-4 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[15%]"}," SL ",-1)),t[17]||(t[17]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap w-[65%]"}," Requirement Details ",-1)),t[18]||(t[18]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Better To Complete ",-1)),e("th",us," For '"+y(((le=a.value.to_department)==null?void 0:le.short_name)||((re=a.value.to_department)==null?void 0:re.name))+"' Use ",1)]),t[19]||(t[19]=e("tr",null,[e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal"}," Issue No "),e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal print:p-0"}," Expected Date ")],-1))]),e("tbody",null,[(r(!0),c(R,null,B(((ie=a.value)==null?void 0:ie.details)||[],(q,A)=>{var j,ne;return r(),c(R,{key:q.id},[C(Tt,{detail:q,serial:A+1,onEditClick:u,onDeleteClick:s,onTaskCreateClick:h},null,8,["detail","serial"]),e("tr",null,[e("td",ms,[e("div",ps," For '"+y(((j=a.value.to_department)==null?void 0:j.short_name)||((ne=a.value.to_department)==null?void 0:ne.name))+"' Use ",1),t[20]||(t[20]=e("div",{class:"text-gray-800 text-xs"},"(Feedback)",-1))]),t[21]||(t[21]=e("td",{class:"whitespace-nowrap p-3 text-center border-2 border-gray-800",colspan:"4"},null,-1))])],64)}),128))])])])):f("",!0),e("div",cs,[e("button",{class:"btn-2 pl-2 text-base",onClick:k(i,["prevent"])},t[22]||(t[22]=[e("i",{class:"fad fa-plus-circle text-2xl mr-2"},null,-1),E("Add Requirement ")]))])]),x.value==="loading"?(r(),D(H,{key:1,class:"absolute inset-0 bg-opacity-90"})):f("",!0)])])}}};export{Ns as default};
