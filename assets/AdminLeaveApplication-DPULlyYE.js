import{g as oe,D as z,r as g,x as E,ad as Z,q as W,h as te,c as u,o as r,a as e,i as O,w as se,j as k,k as x,v as D,P as ne,t as _,F as j,e as F,s as re,m as B,ae as N,d as T,u as de,f as ue,p as ie,l as ee,Y as ce}from"./index-DbNEqQpS.js";import{L as ae}from"./LoaderView-CHne0pue.js";import{_ as ye}from"./MultiselectDropdown-BAOQQ9SZ.js";import{u as ve}from"./holiday-BbOysFwH.js";import{u as le}from"./leave-application-CEvmv8p1.js";import{u as pe}from"./leave-type-B8wOEGqK.js";import{u as P}from"./user-C9q0JgiJ.js";import{_ as me}from"./EmployeeFilter-DD_ar8SE.js";import{S as _e}from"./SelectedEmployeeCard-C9xhw7rY.js";import{u as fe}from"./company-Bl_aJul4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DNLgMQHa.js";import"./department-DkdwilM4.js";import"./EmployeeDropdownInput-BHbczV3C.js";import"./SelectDropdown-FoeexD5Z.js";import"./UserChip-CMdlR1yX.js";const be={class:"space-y-4 p-2 md:p-4"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe={class:"inline-flex items-center space-x-2"},he={key:0},we={class:"text-blue-600 font-medium"},ke={key:1,class:"bg-gray-100 p-2 rounded-md"},Le={class:"font-semibold"},$e={class:"flex flex-wrap gap-2"},Se=["name","value","onUpdate:modelValue","disabled"],Ue={class:"flex items-center space-x-1"},Ae=["name","onUpdate:modelValue"],De={class:"flex items-center space-x-1"},Ce=["name","onUpdate:modelValue"],qe={key:2},Ve={key:3},Te={key:4,class:"text-red-500 text-sm"},Be={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(C,{emit:M}){const n=C,h=M,A=le();pe();const w=P(),L=oe(),U=ve(),{userLeaveBalance:q}=z(w),V=g(""),$=g(!0),l=g({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),a=g([]),i=g(!1),S=g(null),f=E(()=>{var c,t,d;return((t=(c=n==null?void 0:n.userInfo)==null?void 0:c.assign_weekend)==null?void 0:t.weekends)||((d=n==null?void 0:n.userInfo)==null?void 0:d.weekends)}),b=E(()=>{const c=l.value.last_working_date,t=l.value.resumption_date;if(!c||!t)return[];const d=new Date(c),v=new Date(t);if(v<=d)return[];const m=[];let y=new Date(d);for(y.setDate(y.getDate()+1);y<v;){const p=y.getFullYear(),o=(y.getMonth()+1).toString().padStart(2,"0"),R=y.getDate().toString().padStart(2,"0");m.push(`${p}-${o}-${R}`),y.setDate(y.getDate()+1)}return m}),Y=E(()=>{if(!l.value.last_working_date||!l.value.resumption_date)return"";const c=new Date(l.value.last_working_date);return new Date(l.value.resumption_date)<=c?"Resumption date must be after Last Working Date.":b.value.length===0?"No leave days between the selected dates.":`Total leave days: ${b.value.length}`});Z(async()=>{var c;b.value.length&&q.value.length&&(await U.fetchHolidays({company_id:(c=L==null?void 0:L.user)==null?void 0:c.company_id,start_date:b.value[0],end_date:b.value[b.value.length-1]}),b.value.forEach(async(t,d)=>{const v=new Date(t).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),m=v.charAt(0).toUpperCase()+v.slice(1);f.value.includes(m)&&(a.value[d]="weekend"),U.holidayDates.includes(t)&&(a.value[d]="holiday")}))}),W(()=>V.value,c=>{l.value.handover_user_id=c==null?void 0:c.id});const H=async()=>{var c;i.value=!0,S.value=null;try{const t=b.value.map((y,p)=>({date:y,leave_type_id:a.value[p]!=="weekend"&&a.value[p]!=="holiday"?a.value[p]:null})).filter(y=>y.leave_type_id!==null),d=b.value.map((y,p)=>({date:y,leave_type_id:a.value[p]||""})).filter(y=>y.leave_type_id!==null),v={user_id:(c=n==null?void 0:n.userInfo)==null?void 0:c.id,last_working_date:l.value.last_working_date,resumption_date:l.value.resumption_date,reason:l.value.reason,works_in_hand:l.value.works_in_hand,handover_user_id:$.value?null:l.value.handover_user_id,leave_days:t,json_data:d,is_direct_approve:$.value};await A.storeAdminLeaveApplication(v)&&h("formSuccessClosed")}catch(t){S.value=t.message||"Failed to submit leave application"}finally{i.value=!1}};return te(async()=>{Z(()=>{var t;const c=(t=n==null?void 0:n.userInfo)==null?void 0:t.id;c&&w.fetchUserLeaveBalances(c)}),await w.fetchTypeWiseEmployees({except:"auth"})}),(c,t)=>(r(),u("div",be,[t[16]||(t[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),i.value?(r(),O(ae,{key:0})):(r(),u("form",{key:1,onSubmit:se(H,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",ge,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=d=>l.value.last_working_date=d),class:"input-1 w-full",required:""},null,512),[[D,l.value.last_working_date]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=d=>l.value.resumption_date=d),class:"input-1 w-full",required:""},null,512),[[D,l.value.resumption_date]])])]),e("div",null,[e("label",xe,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=d=>$.value=d),class:"form-checkbox text-blue-600"},null,512),[[ne,$.value]]),t[8]||(t[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),l.value.last_working_date&&l.value.resumption_date?(r(),u("div",he,[e("p",we,_(Y.value),1)])):k("",!0),b.value.length?(r(),u("div",ke,[t[11]||(t[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),(r(!0),u(j,null,F(b.value,(d,v)=>(r(),u("div",{key:v,class:re(["flex gap-4 mb-2 bg-white p-2 rounded-md",{"!bg-red-500":a.value[v]==="Weekend"}])},[e("div",Le,_(d),1),e("div",$e,[(r(!0),u(j,null,F(B(q),m=>(r(),u("label",{key:m.id,class:"flex items-center space-x-1"},[x(e("input",{type:"radio",name:"leaveType-"+v,value:m.id,"onUpdate:modelValue":y=>a.value[v]=y,disabled:a.value.filter(y=>y===m.id).length>=m.remaining_days},null,8,Se),[[N,a.value[v]]]),e("span",null,_(m.leave_type),1)]))),128)),e("label",Ue,[x(e("input",{type:"radio",name:"leaveType-"+v,value:"weekend","onUpdate:modelValue":m=>a.value[v]=m},null,8,Ae),[[N,a.value[v]]]),t[9]||(t[9]=e("span",null,"Weekend",-1))]),e("label",De,[x(e("input",{type:"radio",name:"leaveType-"+v,value:"holiday","onUpdate:modelValue":m=>a.value[v]=m},null,8,Ce),[[N,a.value[v]]]),t[10]||(t[10]=e("span",null,"Holiday",-1))])])],2))),128))])):k("",!0),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),x(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=d=>l.value.reason=d),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[D,l.value.reason]])]),$.value?k("",!0):(r(),u("div",qe,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),T(ye,{modelValue:V.value,"onUpdate:modelValue":t[4]||(t[4]=d=>V.value=d),options:B(w).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),$.value?k("",!0):(r(),u("div",Ve,[t[14]||(t[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),x(e("textarea",{id:"works-in-hand","onUpdate:modelValue":t[5]||(t[5]=d=>l.value.works_in_hand=d),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[D,l.value.works_in_hand]])])),S.value?(r(),u("div",Te,_(S.value),1)):k("",!0),t[15]||(t[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Me={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},je={class:"bg-white rounded-lg shadow-lg w-full max-w-3xl"},Fe={class:"px-6 py-4 border-b"},Re={class:"text-lg font-bold"},Ie={class:"table-auto w-full border"},Ee={class:"p-2"},We=["onUpdate:modelValue"],Ye=["onUpdate:modelValue"],He={class:"p-2"},Ne=["onUpdate:modelValue"],ze={class:"p-2"},Oe=["onUpdate:modelValue"],Pe={__name:"UserLeaveBalanceModal",props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0}},emits:["close"],setup(C,{emit:M}){const n=C,h=M,A=fe(),w=P(),L=g([]),U=g(!1);W(()=>n.show,async l=>{var a;l&&((a=n.user)!=null&&a.id)&&!U.value&&(await q(),U.value=!0)}),W(()=>{var l;return(l=n.user)==null?void 0:l.id},()=>{U.value=!1,L.value=[]});const q=async()=>{try{const l=await w.fetchUserLeaveTypes(n.user.id);if(l!=null&&l.length)L.value=l;else{const a=await A.fetchCompanyLeaveTypes(n.user.company_id);L.value=a.data.map(i=>({id:i.id,name:i.name,annual_quota:i.annual_quota||0,max_consecutive_days:i.max_consecutive_days||null,type:i.type||"Paid"}))}}catch(l){console.error("Failed to load leave balances or fallback types:",l)}},V=async()=>{try{await w.saveLeaveBalances(n.user.id,L.value),h("close")}catch(l){console.error("Failed to save leave balances:",l)}},$=()=>{h("close")};return(l,a)=>C.show&&C.user?(r(),u("div",Me,[e("div",je,[e("div",Fe,[e("h3",Re,"Set Leave Balances for "+_(C.user.name),1)]),e("form",{onSubmit:se(V,["prevent"]),class:"p-6 space-y-4"},[e("table",Ie,[a[0]||(a[0]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"p-2"},"Leave Type"),e("th",{class:"p-2"},"Annual Quota"),e("th",{class:"p-2"},"Max Consecutive Days")])],-1)),e("tbody",null,[(r(!0),u(j,null,F(L.value,(i,S)=>(r(),u("tr",{key:S},[e("td",Ee,[x(e("input",{type:"hidden","onUpdate:modelValue":f=>i.id=f,class:"input-1 w-full"},null,8,We),[[D,i.id]]),x(e("input",{"onUpdate:modelValue":f=>i.name=f,class:"input-1 w-full",disabled:""},null,8,Ye),[[D,i.name]])]),e("td",He,[x(e("input",{"onUpdate:modelValue":f=>i.annual_quota=f,type:"number",min:"0",class:"input-1 w-full"},null,8,Ne),[[D,i.annual_quota,void 0,{number:!0}]])]),e("td",ze,[x(e("input",{"onUpdate:modelValue":f=>i.max_consecutive_days=f,type:"number",min:"0",class:"input-1 w-full"},null,8,Oe),[[D,i.max_consecutive_days,void 0,{number:!0}]])])]))),128))])]),e("div",{class:"flex justify-end gap-2 pt-4 border-t"},[e("button",{type:"button",onClick:$,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancel "),a[1]||(a[1]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," Save ",-1))])],32)])])):k("",!0)}},Je={class:"space-y-2 px-4"},Qe={class:"flex flex-wrap gap-2 py-4"},Ge={key:0,class:"text-center py-4"},Ke={key:1,class:"space-y-4"},Xe={key:0,class:"bg-sky-100/30 p-4 rounded-lg shadow mb-6 space-y-6"},Ze={class:"grid md:grid-cols-2 gap-6"},et={class:"bg-white border rounded-lg p-4 shadow"},tt={class:"overflow-x-auto"},st={class:"min-w-full text-sm text-left text-gray-700 border"},at={class:"px-4 py-1 text-center font-medium"},lt={class:"px-4 py-1 text-center"},ot={class:"px-4 py-1 text-center"},nt={class:"px-4 py-1 text-center"},rt={class:"overflow-x-auto"},dt={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},ut={class:"border border-gray-300 px-2 py-2"},it={class:"border border-gray-300 px-2 py-2 text-center"},ct={class:"border border-gray-300 px-2 py-2 text-center"},yt={class:"border border-gray-300 px-2 py-2"},vt={class:"border border-gray-300 px-2 py-2"},pt=["innerHTML"],mt={class:"border border-gray-300 px-2 py-2 text-center"},_t={class:"border border-gray-300 px-2 py-2"},ft={class:"border border-gray-300 px-2"},bt={class:"flex justify-center gap-2"},gt=["onClick"],xt={key:0},ht={key:0},wt={class:"text-center py-2",colspan:"6"},kt={key:0,class:"fixed inset-0 z-[1000] bg-black bg-opacity-50 flex items-center justify-center"},Lt={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},Wt={__name:"AdminLeaveApplication",setup(C){const M=de(),n=ue(),h=le(),A=P(),{user:w,leave_balances:L,leaveApplications:U,loading:q}=z(h),{userLeaveBalance:V}=z(A),$=g(n.query.year||h.selectedYear),l=g(n.query.search||""),a=g({company_id:n.query.company_id||"",department_id:n.query.department_id||"all",line_type:n.query.line_type||"all",employee_id:n.query.employee_id||""}),i=g(!1),S=g(!1),f=async()=>{const p={selectedYear:$.value,selectedStatus:h.selectedStatus,query:l.value};a.value.employee_id?(p.user_id=a.value.employee_id,q.value=!0,await h.fetchYearlyUserLeaveApplications(p),q.value=!1):U.value=[]};te(async()=>{await f(),n.query.employee_id&&await A.fetchUserLeaveBalances(n.query.employee_id)}),W(()=>n.query.employee_id,async p=>{p&&await A.fetchUserLeaveBalances(p)});const b=E(()=>U.value||[]),Y=()=>M.go(-1),H=async()=>{M.replace({query:{...n.query,company_id:a.value.company_id,department_id:a.value.department_id,line_type:a.value.line_type,employee_id:a.value.employee_id}}),await f()},c=()=>{S.value=!0},t=async()=>{i.value=!1,await f()},d=new Date().getFullYear(),v=g([]);for(let p=2023;p<=d;p++)v.value.push(p);const m=async p=>{confirm("Are you sure to delete this application?")&&(await h.deleteLeaveApplication(p),await f())},y=()=>{S.value=!1,A.fetchUserLeaveBalances(n.query.employee_id)};return(p,o)=>{var J,Q;const R=ie("RouterLink");return r(),u(j,null,[e("div",Je,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:Y},o[7]||(o[7]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),o[8]||(o[8]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Annual Leave Applications",-1)),o[9]||(o[9]=e("div",null,null,-1))]),e("div",Qe,[T(me,{company_id:a.value.company_id,"onUpdate:company_id":o[0]||(o[0]=s=>a.value.company_id=s),department_id:a.value.department_id,"onUpdate:department_id":o[1]||(o[1]=s=>a.value.department_id=s),employee_id:a.value.employee_id,"onUpdate:employee_id":o[2]||(o[2]=s=>a.value.employee_id=s),line_type:a.value.line_type,"onUpdate:line_type":o[3]||(o[3]=s=>a.value.line_type=s),"with-type":!0,"initial-value":p.$route.query,onFilterChange:H},null,8,["company_id","department_id","employee_id","line_type","initial-value"])]),B(h).loading?(r(),u("div",Ge,[T(ae)])):(r(),u("div",Ke,[(J=a.value)!=null&&J.employee_id?(r(),u("div",Xe,[e("div",Ze,[T(_e,{user:B(w)},null,8,["user"]),e("div",et,[e("div",{class:"flex justify-between items-start"},[o[10]||(o[10]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Leave Balance",-1)),e("button",{onClick:c,type:"button",class:"btn-2"},"Set Leave Balance")]),e("div",tt,[e("table",st,[o[11]||(o[11]=e("thead",{class:"bg-gray-100 text-xs uppercase"},[e("tr",null,[e("th",{class:"px-4 py-2 text-center"},"Type"),e("th",{class:"px-4 py-2 text-center"},"Total"),e("th",{class:"px-4 py-2 text-center"},"Used"),e("th",{class:"px-4 py-2 text-center"},"Remaining")])],-1)),e("tbody",null,[(r(!0),u(j,null,F(B(V),s=>(r(),u("tr",{key:s.id,class:"border-t hover:bg-gray-50"},[e("td",at,_(s.leave_type),1),e("td",lt,_(s.annual_quota),1),e("td",ot,_(s.used_days),1),e("td",nt,_(s.remaining_days),1)]))),128))])])])])])])):k("",!0),e("div",rt,[e("table",dt,[o[16]||(o[16]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Type"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")])],-1)),e("tbody",null,[(r(!0),u(j,null,F(b.value,(s,G)=>{var K;return r(),u("tr",{key:G,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ut,_(G+1),1),e("td",it,_(s==null?void 0:s.last_working_date),1),e("td",ct,_(s==null?void 0:s.resumption_date),1),e("td",yt,_(s==null?void 0:s.leave_period),1),e("td",vt,[e("div",{innerHTML:(s==null?void 0:s.duration)||(s==null?void 0:s.total_leave_days)},null,8,pt)]),e("td",mt,_([...new Set((K=s==null?void 0:s.leave_days)==null?void 0:K.map(I=>{var X;return(X=I==null?void 0:I.leave_type)==null?void 0:X.name}))].join(",")),1),e("td",_t,_((s==null?void 0:s.status)||"N/A"),1),e("td",ft,[e("div",bt,[T(R,{to:{name:"LeaveApplicationShow",params:{id:s==null?void 0:s.id}},class:"btn-icon",target:"_blank"},{default:ee(()=>o[12]||(o[12]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[12]},1032,["to"]),["Approved","Rejected"].includes(s==null?void 0:s.status)?k("",!0):(r(),O(R,{key:0,to:{name:"LeaveApplicationEdit",params:{id:s==null?void 0:s.id}},class:"btn-icon",target:"_blank"},{default:ee(()=>o[13]||(o[13]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[13]},1032,["to"])),e("button",{onClick:I=>m(s==null?void 0:s.id),class:"btn-icon text-red-500"},o[14]||(o[14]=[e("i",{class:"far fa-trash"},null,-1)]),8,gt)])])])}),128)),b.value.length?k("",!0):(r(),u("tr",xt,o[15]||(o[15]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(Q=a.value)!=null&&Q.employee_id?(r(),u("tr",ht,[e("th",wt,[e("button",{onClick:o[4]||(o[4]=s=>i.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):k("",!0)])])])]))]),T(Pe,{show:S.value,user:B(w),onClose:y},null,8,["show","user"]),(r(),O(ce,{to:"body"},[i.value?(r(),u("div",kt,[e("div",Lt,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:o[5]||(o[5]=s=>i.value=!1)}," Ã— "),T(Be,{userInfo:B(w),onClose:o[6]||(o[6]=s=>i.value=!1),onFormSuccessClosed:t},null,8,["userInfo"])])])):k("",!0)]))],64)}}};export{Wt as default};
