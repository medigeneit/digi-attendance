import{Q as pe,r as $,N as Q,m as U,e as ee,J as ne,A as te,f as me,o as i,i as ge,c as u,g as C,w as ye,a as e,t as p,h as T,j as K,M as de,v as Y,x as P,F as H,y as F,ae as ie,a6 as _e,I as ae,b as he,p as be,B as ue,k as A}from"./index-CdkQxAKq.js";import{u as fe}from"./user-BwAhDQ60.js";const xe=pe("templateItems",()=>{const m=$([]),q=$(!1),w=$(!1),l=$("");function O(){m.value.sort((y,d)=>(y.order_no??0)-(d.order_no??0)||y.id-d.id)}async function B(y){var d,n,v,k;q.value=!0,l.value="";try{const{data:_}=await Q.get(`/checklist-templates/${y}/items`);m.value=((_==null?void 0:_.data)||[]).map(f=>({...f})),O()}catch(_){l.value=((n=(d=_==null?void 0:_.response)==null?void 0:d.data)==null?void 0:n.message)||"Failed to load items",(k=(v=window==null?void 0:window.notify)==null?void 0:v.error)==null||k.call(v,l.value)}finally{q.value=!1}}async function L(y,d){var n,v,k,_,f,h;w.value=!0,l.value="";try{const{data:x}=await Q.post(`/checklist-templates/${y}/items`,d),M=(x==null?void 0:x.data)||{};return m.value.push(M),O(),(v=(n=window==null?void 0:window.notify)==null?void 0:n.success)==null||v.call(n,"Item added"),M}catch(x){throw l.value=((_=(k=x==null?void 0:x.response)==null?void 0:k.data)==null?void 0:_.message)||"Failed to add item",(h=(f=window==null?void 0:window.notify)==null?void 0:f.error)==null||h.call(f,l.value),x}finally{w.value=!1}}async function V(y,d){var k,_,f,h;w.value=!0,l.value="";const n=m.value.findIndex(x=>x.id===y),v=n>=0?{...m.value[n]}:null;n>=0&&(m.value[n]={...m.value[n],...d});try{const{data:x}=await Q.patch(`/checklist-template-items/${y}`,d),M=(x==null?void 0:x.data)||{};return n>=0&&(m.value[n]={...M}),O(),M}catch(x){throw n>=0&&v&&(m.value[n]=v),l.value=((_=(k=x==null?void 0:x.response)==null?void 0:k.data)==null?void 0:_.message)||"Failed to update item",(h=(f=window==null?void 0:window.notify)==null?void 0:f.error)==null||h.call(f,l.value),x}finally{w.value=!1}}async function s(y){var v,k,_,f,h,x;w.value=!0,l.value="";const d=m.value.findIndex(M=>M.id===y),n=d>=0?{...m.value[d]}:null;d>=0&&m.value.splice(d,1);try{await Q.delete(`/checklist-template-items/${y}`),(k=(v=window==null?void 0:window.notify)==null?void 0:v.success)==null||k.call(v,"Item deleted")}catch(M){throw d>=0&&n&&m.value.splice(d,0,n),l.value=((f=(_=M==null?void 0:M.response)==null?void 0:_.data)==null?void 0:f.message)||"Failed to delete item",(x=(h=window==null?void 0:window.notify)==null?void 0:h.error)==null||x.call(h,l.value),M}finally{w.value=!1}}function b(y){const d=m.value.findIndex(n=>n.id===y);if(d>0){const n=m.value[d-1],v=m.value[d],k=n.order_no;n.order_no=v.order_no,v.order_no=k,m.value[d-1]=v,m.value[d]=n}}function S(y){const d=m.value.findIndex(n=>n.id===y);if(d>=0&&d<m.value.length-1){const n=m.value[d+1],v=m.value[d],k=n.order_no;n.order_no=v.order_no,v.order_no=k,m.value[d+1]=v,m.value[d]=n}}async function D(){var y,d,n,v;w.value=!0;try{const k=m.value.map((_,f)=>{const h=f;return(_.order_no??0)!==h?(_.order_no=h,Q.patch(`/checklist-template-items/${_.id}`,h)):Promise.resolve()});await Promise.allSettled(k),(d=(y=window==null?void 0:window.notify)==null?void 0:y.success)==null||d.call(y,"Order saved")}catch{throw(v=(n=window==null?void 0:window.notify)==null?void 0:n.error)==null||v.call(n,"Failed to save order"),new Error("Failed to save order")}finally{w.value=!1,O()}}return{items:m,loading:q,saving:w,error:l,fetch:B,add:L,update:V,remove:s,moveUp:b,moveDown:S,saveOrder:D}}),ke=["aria-label"],we={class:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl ring-1 ring-black/5 dark:bg-gray-900 dark:text-gray-100"},Ce={class:"sticky top-0 z-10 flex items-center justify-between gap-3 border-b border-gray-100 px-4 py-3 bg-white/80 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},$e={class:"text-base md:text-lg font-semibold tracking-tight"},Ie={class:"px-4 py-3 space-y-2"},Me={class:"rounded-xl border border-gray-100 dark:border-gray-800"},Ee={class:"p-3 grid grid-cols-1 gap-3 sm:grid-cols-2"},Oe={key:0},Le={class:"flex items-center justify-between"},Te={class:"flex items-center gap-2 text-xs text-gray-600"},Se={class:"relative"},De=["readonly"],Re={class:"pointer-events-none absolute right-2 top-2 text-[11px] text-gray-400"},Ue={class:"mt-1 text-xs text-gray-500"},Be={key:0,class:"text-xs text-rose-600"},Ne={key:0,class:"mt-1 text-xs text-rose-600"},qe={class:"rounded-xl border border-gray-100 dark:border-gray-800"},Ve={class:"p-3"},je={class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},Ae={class:"flex items-center gap-2"},Ke=["innerHTML"],Pe=["value"],He={key:0,class:"mt-2 flex items-center gap-2 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-800 dark:border-amber-700 dark:bg-amber-900/20 dark:text-amber-200"},Fe={key:1,class:"mt-2 text-xs text-rose-600"},ze={class:"p-3"},Ge={key:0,class:"mb-2 inline-flex items-center gap-2 rounded-full border px-2.5 py-1.5 text-sm dark:border-gray-700"},Je={class:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700"},Qe=["src"],Ye={key:1,class:"text-[11px] font-semibold text-gray-600 dark:text-gray-200"},We={class:"font-medium"},Xe={key:0,class:"ml-1 rounded bg-gray-100 px-1.5 py-0.5 text-[11px] text-gray-600 dark:bg-gray-800 dark:text-gray-300"},Ze={class:"relative"},et={class:"mt-1 flex items-center gap-2 rounded-lg border px-2 py-1.5 dark:bg-gray-900 dark:border-gray-700"},tt={key:0,class:"absolute z-50 mt-1 w-full overflow-hidden rounded-xl border border-gray-100 bg-white shadow-xl dark:border-gray-800 dark:bg-gray-900"},at={class:"max-h-64 overflow-auto"},rt=["onClick"],st={class:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700"},ot=["src"],lt={key:1,class:"text-xs font-semibold text-gray-600 dark:text-gray-200"},nt={class:"flex min-w-0 flex-col"},dt={class:"truncate text-sm font-medium"},it={class:"truncate text-[12px] text-gray-500"},ut={class:"ml-auto flex items-center gap-1"},ct={key:0,class:"rounded bg-gray-100 px-1.5 py-0.5 text-[11px] text-gray-600 dark:bg-gray-800 dark:text-gray-300"},vt={key:1,class:"rounded bg-emerald-50 px-1.5 py-0.5 text-[11px] text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300"},pt={key:1,class:"px-3 py-6 text-center text-sm text-gray-500 dark:text-gray-400"},mt={key:1,class:"mt-2 text-xs text-rose-600"},gt={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},yt={class:"rounded-xl border border-gray-100 dark:border-gray-800"},_t={class:"px-3 py-2 grid grid-cols-1 gap-3"},ht={class:"inline-flex items-center gap-2"},bt={key:0,class:"mt-1 text-xs text-rose-600"},ft={class:"rounded-xl border border-gray-100 dark:border-gray-800"},xt={class:"px-3 py-2"},kt={class:"flex flex-wrap gap-2"},wt=["value"],Ct={class:"inline-flex items-center gap-1"},$t={key:0,class:"mt-2 text-xs text-rose-600"},It={class:"sticky bottom-0 flex items-center justify-end gap-2 border-t border-gray-100 px-4 py-3 bg-white/80 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},Mt=["disabled"],Et=["disabled"],Ot={key:0,class:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none"},Z=80,Lt={__name:"AddEditItemModal",props:{open:{type:Boolean,default:!1},mode:{type:String,default:"add"},model:{type:Object,default:()=>({})},nextOrder:{type:Number,default:0}},emits:["close","submit"],setup(m,{emit:q}){const w=fe(),l=m,O=q,B=[{value:"BLOCKED",label:"Blocked"},{value:"COMPLETED",label:"Completed"}],L=[{value:"departmental_incharge",label:"Departmental In-charge",icon:"building"},{value:"technical_support_team",label:"Technical Support Team",icon:"wrench"},{value:"it_incharge",label:"IT In-charge",icon:"chip"},{value:"hr_department",label:"HR Department",icon:"users"},{value:"inventory_incharge",label:"Inventory In-charge",icon:"users"}],V={departmental_incharge:"DEPT_INCHARGE",technical_support_team:"TECH_SUPPORT",it_incharge:"IT_INCHARGE",hr_department:"HR",inventory_incharge:"INVENTORY_KEEPER"},s=$({item_key:"",label:"",required:!1,order_no:0,status:"BLOCKED",handover_to:"departmental_incharge",handover_to_id:""}),b=$({}),S=$(!1),D=$(!0),y=$(null),d=$(null),n=U(()=>s.value.handover_to!=="departmental_incharge"),v=U(()=>w.users??w.items??[]),k=$(null),_=$(!1),f=$(""),h=U(()=>v.value.find(o=>String(o==null?void 0:o.id)===String(s.value.handover_to_id))),x=U(()=>{let o=v.value||[];const a=V[s.value.handover_to];a&&(o=o.filter(t=>{const I=t.roles||t.role_names||t.roleKeys||[],N=t.role_key||t.primary_role||null;return Array.isArray(I)&&I.includes(a)||N===a||!(I!=null&&I.length)}));const E=f.value.trim().toLowerCase();return E&&(o=o.filter(t=>{var J;const I=(t.name||"").toLowerCase(),N=(t.email||"").toLowerCase(),G=(t.phone||t.phone_number||"").toLowerCase(),X=(((J=t.department)==null?void 0:J.name)||t.dept_name||"").toLowerCase();return I.includes(E)||N.includes(E)||G.includes(E)||X.includes(E)})),o.slice(0,50)});function M(o){s.value.handover_to_id=o.id,f.value=o.name||`#${o.id}`,_.value=!1}function g(){s.value.handover_to_id="",f.value="",ae(()=>c())}function c(){var o;n.value&&(_.value=!0,!f.value&&((o=h.value)!=null&&o.name)&&(f.value=h.value.name))}function r(o){l.open&&k.value&&!k.value.contains(o.target)&&(_.value=!1)}ee(()=>document.addEventListener("click",r,{capture:!0})),ne(()=>document.removeEventListener("click",r,{capture:!0}));function j(o){return(o??"").toLowerCase().trim().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"").slice(0,Z)}const z=U(()=>l.mode==="edit"?"Edit Checklist Item":"Add Checklist Item"),R=U(()=>l.mode==="edit"),re=U(()=>S.value);te(()=>l.open,async o=>{var a,E,t,I,N,G,X,J;o&&(R.value?(s.value={item_key:((a=l.model)==null?void 0:a.item_key)??"",label:((E=l.model)==null?void 0:E.label)??"",required:!!((t=l.model)!=null&&t.required),order_no:Number(((I=l.model)==null?void 0:I.order_no)??0),status:((N=l.model)==null?void 0:N.status)??"BLOCKED",handover_to:((G=l.model)==null?void 0:G.handover_to)??"departmental_incharge",handover_to_id:((X=l.model)==null?void 0:X.handover_to_id)??""},D.value=!1):(s.value={item_key:"",label:"",required:!1,order_no:Number(l.nextOrder??0),status:"BLOCKED",handover_to:"departmental_incharge",handover_to_id:""},D.value=!0),b.value={},S.value=!1,await ae(),(J=y.value)==null||J.focus())},{immediate:!0}),te(()=>s.value.label,o=>{!R.value&&D.value&&(s.value.item_key=j(o))}),te(()=>s.value.handover_to,()=>{s.value.handover_to_id="",f.value="",_.value=!1});function ce(){const o={};return R.value||(s.value.item_key.trim()?s.value.item_key.length>Z?o.item_key=`Max ${Z} characters`:/^[a-z0-9_]+$/.test(s.value.item_key)||(o.item_key="Use lowercase letters, numbers, underscores only"):o.item_key="Item key is required"),s.value.label.trim()||(o.label="Label is required"),(s.value.order_no==null||isNaN(s.value.order_no)||s.value.order_no<0)&&(o.order_no="Order must be 0 or a positive number"),B.some(a=>a.value===s.value.status)||(o.status="Invalid status"),L.some(a=>a.value===s.value.handover_to)||(o.handover_to="Select a valid handover target"),n.value&&!String(s.value.handover_to_id||"").trim()&&(o.handover_to_id="Please select the receiver user"),b.value=o,Object.keys(o).length===0}function W(){S.value||O("close")}function se(o){l.open&&(o.key==="Escape"&&(o.stopPropagation(),W()),(o.ctrlKey||o.metaKey)&&o.key.toLowerCase()==="enter"&&(o.preventDefault(),oe()))}ee(()=>window.addEventListener("keydown",se)),ne(()=>window.removeEventListener("keydown",se)),ee(()=>{var o;try{(o=w.fetchUsers)==null||o.call(w)}catch{}});async function oe(){var o,a;if(!ce()){await ae();const E=Object.keys(b.value)[0];if(E){const t=document.querySelector(`[data-field="${E}"]`);(o=t==null?void 0:t.focus)==null||o.call(t),(a=d.value)==null||a.scrollIntoView({behavior:"smooth",block:"center"})}return}S.value=!0;try{O("submit",{...s.value,handover_to_id:n.value&&s.value.handover_to_id?Number(s.value.handover_to_id):null})}finally{S.value=!1}}function ve({name:o}){switch(o){case"building":return`
      <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.8">
        <path d="M3 21h18M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16M9 8h6M9 12h6M9 16h6"/>
      </svg>`;case"wrench":return`
      <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.8">
        <path d="M14.7 6.3a4 4 0 1 0-5.66 5.66l7.07 7.07a2 2 0 0 0 2.83-2.83L11.87 9.13"/>
      </svg>`;case"chip":return`
      <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.8">
        <rect x="7" y="7" width="10" height="10" rx="2"/>
        <path d="M7 2v3M12 2v3M17 2v3M7 19v3M12 19v3M17 19v3M2 7h3M2 12h3M2 17h3M19 7h3M19 12h3M19 17h3"/>
      </svg>`;case"users":return`
      <svg viewBox="0 0 24 24" class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="1.8">
        <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="3"/>
        <path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a3 3 0 0 1 0 5.74"/>
      </svg>`;default:return""}}function le(o=""){return String(o).trim().split(/\s+/).slice(0,2).map(E=>{var t;return((t=E[0])==null?void 0:t.toUpperCase())||""}).join("")}return(o,a)=>(i(),me(_e,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:ge(()=>{var E;return[m.open?(i(),u("div",{key:0,class:"fixed inset-0 top-10 z-50 flex items-start md:items-center justify-center bg-black/40 backdrop-blur-[2px] p-4",onClick:ye(W,["self"]),"aria-modal":"true",role:"dialog","aria-label":z.value},[e("div",we,[e("div",Ce,[e("h3",$e,p(z.value),1),e("button",{class:"inline-flex h-8 w-8 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-300 dark:hover:bg-gray-800",onClick:W,title:"Close (Esc)"},"✕")]),Object.keys(b.value).length?(i(),u("div",{key:0,ref_key:"errorSummaryRef",ref:d,class:"mx-4 mt-3 rounded-lg border border-rose-200 bg-rose-50 px-3 py-2.5 text-rose-700 text-sm dark:bg-rose-950/30 dark:border-rose-900"}," Please fix the highlighted fields. ",512)):C("",!0),e("div",Ie,[e("div",Me,[a[12]||(a[12]=e("div",{class:"border-b px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 dark:border-gray-800"},"Basics",-1)),e("div",Ee,[R.value?C("",!0):(i(),u("div",Oe,[e("div",Le,[a[9]||(a[9]=e("label",{for:"item_key",class:"block text-sm font-medium"},"Item Key",-1)),e("label",Te,[T(e("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=t=>D.value=t),class:"h-4 w-4"},null,512),[[de,D.value]]),a[8]||(a[8]=K(" Auto "))])]),e("div",Se,[T(e("input",{ref_key:"firstInputRef",ref:y,id:"item_key","onUpdate:modelValue":a[1]||(a[1]=t=>s.value.item_key=t),readonly:D.value,maxlength:"80",type:"text","data-field":"item_key",class:"mt-1 w-full rounded-lg border px-3 py-2 outline-none transition focus:ring-2 focus:ring-gray-900/20 dark:bg-gray-900 dark:border-gray-700",placeholder:"e.g., nid_copy","aria-invalid":"true"},null,8,De),[[Y,s.value.item_key,void 0,{trim:!0}]]),e("div",Re,p(s.value.item_key.length)+"/"+p(Z),1)]),e("p",Ue,[a[10]||(a[10]=K("Preview: ")),e("code",null,"checklist."+p(s.value.item_key||"..."),1)]),b.value.item_key?(i(),u("p",Be,p(b.value.item_key),1)):C("",!0)])),e("div",{class:P(R.value?"sm:col-span-2":"")},[a[11]||(a[11]=e("label",{for:"label",class:"block text-sm font-medium"},"Label",-1)),T(e("input",{id:"label","onUpdate:modelValue":a[2]||(a[2]=t=>s.value.label=t),type:"text","data-field":"label",class:"mt-1 w-full rounded-lg border px-3 py-2 outline-none transition focus:ring-2 focus:ring-gray-900/20 dark:bg-gray-900 dark:border-gray-700",placeholder:"e.g., National ID Copy"},null,512),[[Y,s.value.label,void 0,{trim:!0}]]),b.value.label?(i(),u("p",Ne,p(b.value.label),1)):C("",!0)],2)])]),e("div",qe,[a[14]||(a[14]=e("div",{class:"border-b px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 dark:border-gray-800"},"Handover To",-1)),e("div",Ve,[e("div",je,[(i(),u(H,null,F(L,t=>e("label",{key:t.value,class:P(["group inline-flex items-center justify-between gap-3 rounded-xl border px-3 py-2 text-sm cursor-pointer transition hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",s.value.handover_to===t.value?"ring-2 ring-gray-900/20 bg-gray-50 dark:bg-gray-800":""])},[e("div",Ae,[e("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-gray-100 text-gray-700 group-hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-200",innerHTML:ve({name:t.icon})},null,8,Ke),e("span",null,p(t.label),1)]),T(e("input",{"onUpdate:modelValue":a[3]||(a[3]=I=>s.value.handover_to=I),type:"radio",value:t.value,class:"h-4 w-4","data-field":"handover_to"},null,8,Pe),[[ie,s.value.handover_to]])],2)),64))]),n.value?C("",!0):(i(),u("div",He,a[13]||(a[13]=[e("span",{class:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-amber-100 text-amber-800 dark:bg-amber-800/60 dark:text-amber-100"},"★",-1),K(" Receiver will be resolved automatically to the Department In-charge during checklist generation. ")]))),b.value.handover_to?(i(),u("p",Fe,p(b.value.handover_to),1)):C("",!0)])]),n.value?(i(),u("div",{key:0,class:"rounded-xl border border-gray-100 dark:border-gray-800",ref_key:"userBoxRef",ref:k},[a[17]||(a[17]=e("div",{class:"border-b px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 dark:border-gray-800"},"Receiver User",-1)),e("div",ze,[h.value?(i(),u("div",Ge,[e("span",Je,[h.value.photo||h.value.avatar_url?(i(),u("img",{key:0,src:h.value.photo||h.value.avatar_url,alt:"",class:"h-6 w-6 rounded-full object-cover"},null,8,Qe)):(i(),u("span",Ye,p(le(h.value.name)),1))]),e("span",We,p(h.value.name),1),(E=h.value.department)!=null&&E.name?(i(),u("span",Xe,p(h.value.department.name),1)):C("",!0),e("button",{class:"ml-1 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",onClick:g,title:"Clear"},"✕")])):C("",!0),e("div",Ze,[a[16]||(a[16]=e("label",{for:"handover_user",class:"block text-sm font-medium"},"Search & Select Receiver",-1)),e("div",et,[a[15]||(a[15]=e("svg",{class:"h-4 w-4 opacity-60",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},[e("circle",{cx:"11",cy:"11",r:"7"}),e("path",{d:"M21 21l-3.5-3.5"})],-1)),T(e("input",{id:"handover_user","onUpdate:modelValue":a[4]||(a[4]=t=>f.value=t),onFocus:c,onInput:c,type:"text",autocomplete:"off",placeholder:"Type name, email, phone or department...",class:"w-full bg-transparent outline-none","data-field":"handover_to_id"},null,544),[[Y,f.value]]),s.value.handover_to_id?(i(),u("button",{key:0,onClick:g,class:"rounded-md px-2 py-1 text-xs text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-800",type:"button",title:"Clear"},"Clear")):C("",!0)]),_.value?(i(),u("div",tt,[e("div",at,[x.value.length?(i(!0),u(H,{key:0},F(x.value,t=>{var I,N;return i(),u("button",{key:t.id,type:"button",class:"flex w-full items-center gap-3 px-3 py-2 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:G=>M(t)},[e("span",st,[t.photo||t.avatar_url?(i(),u("img",{key:0,src:t.photo||t.avatar_url,alt:"",class:"h-8 w-8 rounded-full object-cover"},null,8,ot)):(i(),u("span",lt,p(le(t.name)),1))]),e("span",nt,[e("span",dt,p(t.name||"#"+t.id),1),e("span",it,p(t.email||"—")+" • "+p(t.phone||t.phone_number||"—"),1)]),e("span",ut,[(I=t.department)!=null&&I.name?(i(),u("span",ct,p(t.department.name),1)):C("",!0),t.role_key||t.roles&&t.roles[0]?(i(),u("span",vt,p(t.role_key||((N=t.roles)==null?void 0:N[0])),1)):C("",!0)])],8,rt)}),128)):(i(),u("div",pt," No users found. Refine your search. "))])])):C("",!0)]),b.value.handover_to_id?(i(),u("p",mt,p(b.value.handover_to_id),1)):C("",!0)])],512)):C("",!0),e("div",gt,[e("div",yt,[a[20]||(a[20]=e("div",{class:"border-b px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 dark:border-gray-800"},"Display & Order",-1)),e("div",_t,[e("label",ht,[T(e("input",{"onUpdate:modelValue":a[5]||(a[5]=t=>s.value.required=t),type:"checkbox",class:"h-4 w-4","data-field":"required"},null,512),[[de,s.value.required]]),a[18]||(a[18]=e("span",{class:"text-sm"},"Required",-1))]),e("div",null,[a[19]||(a[19]=e("label",{for:"order_no",class:"block text-sm font-medium"},"Order",-1)),T(e("input",{id:"order_no","onUpdate:modelValue":a[6]||(a[6]=t=>s.value.order_no=t),type:"number",min:"0","data-field":"order_no",class:"mt-1 w-full rounded-lg border px-3 py-2 outline-none transition focus:ring-2 focus:ring-gray-900/20 dark:bg-gray-900 dark:border-gray-700",placeholder:"0"},null,512),[[Y,s.value.order_no,void 0,{number:!0}]]),b.value.order_no?(i(),u("p",bt,p(b.value.order_no),1)):C("",!0)])])]),e("div",ft,[a[21]||(a[21]=e("div",{class:"border-b px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 dark:border-gray-800"},"Status",-1)),e("div",xt,[e("div",kt,[(i(),u(H,null,F(B,t=>e("label",{key:t.value,class:P(["inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm cursor-pointer transition hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",s.value.status===t.value?"ring-2 ring-gray-900/20":""])},[T(e("input",{"onUpdate:modelValue":a[7]||(a[7]=I=>s.value.status=I),type:"radio",value:t.value,class:"h-4 w-4","data-field":"status"},null,8,wt),[[ie,s.value.status]]),e("span",Ct,[e("span",{class:P(["inline-block h-2.5 w-2.5 rounded-full",{"bg-amber-500":t.value==="BLOCKED","bg-emerald-500":t.value==="COMPLETED"}])},null,2),K(" "+p(t.label),1)])],2)),64))]),b.value.status?(i(),u("p",$t,p(b.value.status),1)):C("",!0)])])])]),e("div",It,[e("button",{class:"rounded-lg border px-3 py-2 text-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-300 dark:border-gray-700 dark:hover:bg-gray-800",onClick:W,disabled:re.value}," Cancel ",8,Mt),e("button",{class:"inline-flex items-center gap-2 rounded-lg bg-gray-900 px-3 py-2 text-sm text-white transition hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-300 disabled:opacity-60",onClick:oe,disabled:re.value,title:"Submit (Ctrl+Enter)"},[S.value?(i(),u("svg",Ot,a[22]||(a[22]=[e("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",opacity:"0.25"},null,-1),e("path",{d:"M22 12a10 10 0 0 1-10 10",stroke:"currentColor","stroke-width":"4","stroke-linecap":"round"},null,-1)]))):C("",!0),K(" "+p(R.value?"Update":"Create"),1)],8,Et)])])],8,ke)):C("",!0)]}),_:1}))}},Tt={class:"mx-auto max-w-7xl p-4"},St={class:"mb-4 flex items-center gap-2"},Dt={class:"flex-1"},Rt={class:"text-sm text-gray-500"},Ut={class:"font-medium"},Bt={class:"mb-3 flex flex-wrap items-center gap-2"},Nt=["value"],qt=["value"],Vt={class:"ml-auto flex items-center gap-2"},jt=["disabled"],At={class:"overflow-hidden rounded-xl border bg-white"},Kt={class:"min-w-full text-sm"},Pt={key:0},Ht={class:"px-3 py-2"},Ft={class:"flex items-center gap-1"},zt=["disabled","onClick"],Gt=["disabled","onClick"],Jt={class:"ml-2 tabular-nums text-gray-500"},Qt={class:"px-3 py-2"},Yt={class:"truncate"},Wt={class:"px-3 py-2"},Xt=["title"],Zt={class:"px-3 py-2"},ea={class:"inline-flex cursor-pointer items-center gap-2"},ta=["checked","disabled","onChange"],aa={class:"text-xs"},ra={class:"px-3 py-2"},sa={class:"px-3 py-2"},oa={class:"flex items-center gap-2"},la=["onClick"],na={key:1},da={key:0,class:"mt-3 text-sm text-gray-500"},ca={__name:"TemplateItemsManager",setup(m){const q=he(),w=U(()=>Number(q.params.id||q.query.template_id)),l=xe(),O=$(!1),B=$("add"),L=$(null),V=$(""),s=$({handover_to:"",status:""}),b={departmental_incharge:"Departmental In-charge",technical_support_team:"Technical Support Team",it_incharge:"IT In-charge",hr_department:"HR Department",inventory_incharge:"Inventory Incharge"},S=[{value:"",label:"All handovers"},{value:"departmental_incharge",label:b.departmental_incharge},{value:"technical_support_team",label:b.technical_support_team},{value:"it_incharge",label:b.it_incharge},{value:"hr_department",label:b.hr_department},{value:"inventory_incharge",label:b.inventory_incharge}],D=[{value:"",label:"All status"},{value:"BLOCKED",label:"Blocked"},{value:"COMPLETED",label:"Completed"}],y=U(()=>{const g=(V.value||"").toLowerCase().trim();return(Array.isArray(l.items)?l.items:[]).filter(r=>!(g&&!((r.item_key||"")+" "+(r.label||"")+" "+(b[r.handover_to]||"")+" "+(r.status||"")).toLowerCase().includes(g)||s.value.handover_to&&r.handover_to!==s.value.handover_to||s.value.status&&r.status!==s.value.status)).sort((r,j)=>(r.order_no??0)-(j.order_no??0))}),d=U(()=>{var g;return((g=l.items)==null?void 0:g.length)||0});ee(async()=>{w.value&&await l.fetch(w.value)}),te(w,async(g,c)=>{g&&g!==c&&await l.fetch(g)});function n(){B.value="add",L.value=null,O.value=!0}function v(g){B.value="edit",L.value={...g},O.value=!0}async function k(g){var c;try{if(B.value==="add")await l.add(w.value,g);else if((c=L.value)!=null&&c.id){const r={label:g.label,status:g.status,required:!!g.required,order_no:g.order_no??L.value.order_no,handover_to:g.handover_to,handover_to_id:g.handover_to_id};await l.update(L.value.id,r)}O.value=!1}catch{}}async function _(g){var c,r;try{await l.update(g.id,{required:!g.required}),(r=(c=window==null?void 0:window.notify)==null?void 0:c.success)==null||r.call(c,"Required updated")}catch{}}function f(g){l.moveUp(g.id)}function h(g){l.moveDown(g.id)}async function x(){await l.saveOrder()}function M(){V.value="",s.value={handover_to:"",status:""}}return(g,c)=>(i(),u("div",Tt,[e("div",St,[e("div",Dt,[c[5]||(c[5]=e("h2",{class:"text-xl font-semibold"},"Checklist Template Items",-1)),e("p",Rt,[c[4]||(c[4]=K(" Template: ")),e("span",Ut,p(w.value==1?"Joining Checklist Items":"Exit Checklist Items"),1)])]),e("button",{class:"rounded-lg bg-gray-900 px-3 py-2 text-white shadow hover:bg-gray-800",onClick:n}," + Add Item ")]),e("div",Bt,[T(e("input",{"onUpdate:modelValue":c[0]||(c[0]=r=>V.value=r),type:"text",placeholder:"Search key/label/hand-over/status…",class:"w-64 rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/20"},null,512),[[Y,V.value]]),T(e("select",{"onUpdate:modelValue":c[1]||(c[1]=r=>s.value.handover_to=r),class:"rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/20",title:"Filter by Handover target"},[(i(),u(H,null,F(S,r=>e("option",{key:r.value,value:r.value},p(r.label),9,Nt)),64))],512),[[ue,s.value.handover_to]]),T(e("select",{"onUpdate:modelValue":c[2]||(c[2]=r=>s.value.status=r),class:"rounded-lg border px-3 py-2 focus:outline-none focus:ring-2 focus:ring-gray-900/20",title:"Filter by Status"},[(i(),u(H,null,F(D,r=>e("option",{key:r.value,value:r.value},p(r.label),9,qt)),64))],512),[[ue,s.value.status]]),e("button",{class:"rounded-lg border px-3 py-2 hover:bg-gray-50",onClick:M,title:"Reset filters"}," Reset "),e("div",Vt,[e("button",{class:"rounded-lg border px-3 py-2 hover:bg-gray-50",disabled:A(l).saving,onClick:x,title:"Persist current order"}," Save Order ",8,jt)])]),e("div",At,[e("table",Kt,[c[8]||(c[8]=e("thead",{class:"bg-gray-50 text-left"},[e("tr",null,[e("th",{class:"px-3 py-2 w-20"},"Order"),e("th",{class:"px-3 py-2"},"Label"),e("th",{class:"px-3 py-2"},"Handover To"),e("th",{class:"px-3 py-2"},"Handover By"),e("th",{class:"px-3 py-2 w-28"},"Required"),e("th",{class:"px-3 py-2 w-28"},"Status"),e("th",{class:"px-3 py-2 w-40"},"Actions")])],-1)),e("tbody",null,[A(l).loading?(i(),u("tr",Pt,c[6]||(c[6]=[e("td",{colspan:"7",class:"px-3 py-4"},[e("div",{class:"h-4 w-full animate-pulse rounded bg-gray-100"})],-1)]))):C("",!0),(i(!0),u(H,null,F(y.value,(r,j)=>{var z;return i(),u("tr",{key:r.id,class:"border-t hover:bg-gray-50"},[e("td",Ht,[e("div",Ft,[e("button",{class:"rounded border px-2 py-1 text-xs hover:bg-gray-50 disabled:opacity-50",disabled:j===0||A(l).saving,onClick:R=>f(r),title:"Move up"},"↑",8,zt),e("button",{class:"rounded border px-2 py-1 text-xs hover:bg-gray-50 disabled:opacity-50",disabled:j===y.value.length-1||A(l).saving,onClick:R=>h(r),title:"Move down"},"↓",8,Gt),e("span",Jt,p(r.order_no??j),1)])]),e("td",Qt,[e("div",Yt,p(r.label),1)]),e("td",Wt,[e("span",{class:P(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",{"bg-gray-100 text-gray-700":!r.handover_to,"bg-sky-100 text-sky-700":r.handover_to==="departmental_incharge","bg-amber-100 text-amber-800":r.handover_to==="technical_support_team","bg-indigo-100 text-indigo-700":r.handover_to==="it_incharge","bg-emerald-100 text-emerald-700":r.handover_to==="hr_department","bg-emerald-700 text-emerald-50":r.handover_to==="inventory_incharge"}]),title:b[r.handover_to]||"—"},p(b[r.handover_to]||"—"),11,Xt)]),e("td",null,[e("span",null,p((z=r==null?void 0:r.handover_user)==null?void 0:z.name),1)]),e("td",Zt,[e("label",ea,[e("input",{type:"checkbox",class:"h-4 w-4",checked:!!r.required,disabled:A(l).saving,onChange:R=>_(r)},null,40,ta),e("span",aa,p(r.required?"Yes":"No"),1)])]),e("td",ra,[e("span",{class:P(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",{"bg-amber-100 text-amber-800":r.status==="BLOCKED","bg-emerald-100 text-emerald-700":r.status==="COMPLETED","bg-gray-100 text-gray-700":!r.status}])},p(r.status||"—"),3)]),e("td",sa,[e("div",oa,[e("button",{class:"rounded-lg border px-2.5 py-1 text-sm hover:bg-gray-50",onClick:R=>v(r)}," Edit ",8,la)])])])}),128)),!A(l).loading&&y.value.length===0?(i(),u("tr",na,c[7]||(c[7]=[e("td",{colspan:"7",class:"px-3 py-10 text-center text-gray-500"}," No items found. Try adjusting filters or add a new item. ",-1)]))):C("",!0)])])]),A(l).saving?(i(),u("div",da,"Saving…")):C("",!0),be(Lt,{open:O.value,mode:B.value,model:L.value,"next-order":d.value,onClose:c[3]||(c[3]=r=>O.value=!1),onSubmit:k},null,8,["open","mode","model","next-order"])]))}};export{ca as default};
