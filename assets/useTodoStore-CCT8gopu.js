import{L as D,r as i,x as y,M as d}from"./index-DfRzlAF0.js";const P=D("todo",()=>{const h=i(null),u=i(!1),T=i(!1),s=i(null),l=i([]),m=async()=>{var a,e,t;u.value=!0,s.value=null;try{const r=await d.get("/todos");l.value=((a=r.data)==null?void 0:a.todos)||[],f()}catch(r){throw s.value=((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"Todos load failed",r}finally{u.value=!1}};function f(){l.value=[...l.value.sort((a,e)=>(a==null?void 0:a.user_id)!==(e==null?void 0:e.user_id)?(a==null?void 0:a.user_id)-(e==null?void 0:e.user_id):a.priority!==e.priority?a.priority-e.priority:e.id-a.id)]}const w=async()=>{var a,e,t;u.value=!0,s.value=null;try{const r=await d.get("/my-todos");l.value=((a=r.data)==null?void 0:a.todos)||[],f()}catch(r){throw s.value=((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"Todos load failed",r}finally{u.value=!1}},_=a=>{var e;return(e=l.value)==null?void 0:e.filter(t=>t.date==a)},$=async a=>{var e,t;u.value=!0,s.value=null;try{const r=await d.get(`/todos/${a}`);h.value=r.data,h.value=l.value.find(o=>o.id==a)}catch(r){throw s.value=((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"Todo load failed",r}finally{u.value=!1}},M=async(a,{returnWith:e}={})=>{var t,r,o;u.value=!0,s.value=null;try{const n=await d.post("/todos",a,{params:{return_with:e}});return l.value=[...l.value,(t=n.data)==null?void 0:t.todo],f(),n.data}catch(n){throw s.value=((o=(r=n.response)==null?void 0:r.data)==null?void 0:o.message)||"Todo create failed",n}finally{u.value=!1}},S=async(a,e)=>{var t,r;u.value=!0,s.value=null;try{const o=await d.put(`/todos/${a}`,e);return l.value=l.value.map(n=>{var g,c,v,p;return n.id==((c=(g=o.data)==null?void 0:g.todo)==null?void 0:c.id)?n.user?{...(v=o.data)==null?void 0:v.todo,user:{...n.user}}:{...(p=o.data)==null?void 0:p.todo}:{...n}}),o.data}catch(o){throw s.value=((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.message)||"Todo update failed",o}finally{u.value=!1}},x=async(a,e)=>{var t,r;u.value=!0,s.value=null;try{await d.put(`/todos/status/${a}`,{status:e}),l.value=l.value.map(o=>o.id===a?{...o,status:e}:{...o})}catch(o){throw s.value=((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update todo status",o}finally{u.value=!1}},L=async(a,{date:e}={})=>{var t,r;u.value=!0,T.value=!0,s.value=null;try{const o=await d.put("/my-todos/rearrange",{ids:a,date:e});l.value=l.value.map(n=>{var v;const c=(((v=o.data)==null?void 0:v.changes)||[]).find(p=>p.id==n.id);return c?{...n,priority:c.priority}:n}),f()}catch(o){throw s.value=((r=(t=o.response)==null?void 0:t.data)==null?void 0:r.message)||"Todo rearranging failed",o}finally{T.value=!0,u.value=!1}},C=async a=>{var e,t;u.value=!0,s.value=null;try{await d.delete(`/todos/${a}`),l.value=l.value.filter(r=>r.id!==a)}catch(r){throw s.value=((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"Todo delete failed",r}finally{u.value=!1}};return{todos:y(()=>l.value),todo:y(()=>h.value),loading:y(()=>u.value),error:y(()=>s.value),fetchTodos:m,fetchTodo:$,createTodo:M,updateTodo:S,rearrangeMyTodos:L,deleteTodo:C,fetchMyTodos:w,updateTodoStatus:x,getTodosByDate:_}});export{P as u};
