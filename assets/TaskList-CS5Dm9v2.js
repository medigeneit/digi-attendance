import{_ as Te}from"./CommentModal-Sa8myWTw.js";import{_ as $e,a as _e}from"./TaskUserAssignForm-ZBwAzIiE.js";import{L as Ae}from"./LoaderView-DblqJ2A9.js";import{O as ae}from"./OverlyModal-0BiE2I0O.js";import{_ as Ie}from"./TaskAddForm-Dvq-4ivY.js";import{_ as Le}from"./TaskEditForm-Cy2FIvkh.js";import{d as me,b as se,m as b,r as O,e as ce,x as le,z as pe,c as o,o as s,a as e,g as n,w as N,f as V,F as H,q as C,h as Z,C as re,n as ee,t as I,k as c,i as j,E as oe,v as Se,j as P,p as Q,G as Me,u as De,s as ie}from"./index-7lk-PY7p.js";import{_ as Ve}from"./MultiselectDropdown-CcmjVgL0.js";import{_ as de,g as qe,m as ye,u as Ee}from"./task-priority-CVL32G46.js";import{u as Ue}from"./company-CytWi64A.js";import{_ as ue}from"./CompanyDepartmentSelectInput-C_PQ5YIr.js";import{_ as xe}from"./UserChip-BZ-C4OSl.js";import{_ as fe,a as Be,b as ge,c as ke,T as ve,d as be,e as Pe}from"./TaskUrgentBadge-DJlyurnO.js";import{b as we,a as Y}from"./datetime-DLUp6MRA.js";import{o as Oe}from"./url-CePbr-gY.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ne}from"./useTaskStore-BDEyHX_B.js";import"./useCommentStore-C3P7URKk.js";import"./TextWithHr-C_pomVru.js";import"./TaskUrgencyInput-DAEL-kRK.js";import"./TaskUserChip-BSiff7nl.js";import"./RequiredIcon-CVUTMQOS.js";import"./useRequirementStore-CvG4PBf1.js";import"./requirement-0aoEjWDC.js";import"./SectionLoading-BQE4LQAf.js";import"./tags-BEQs8We8.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-C95AKBIZ.js";const Re={class:"mb-3 task-header"},Fe={class:"flex justify-between items-start mb-4"},ze={key:0,class:"ml-auto flex gap-6 items-center"},He={key:0,class:"flex gap-2 items-center"},We={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ge={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Je={class:"relative w-full md:w-48 flex-grow"},Ke=["value"],Ye={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Qe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Xe={class:"w-32 relative h-8"},Ze={class:"flex gap-4 items-center flex-shrink-0"},et={class:"flex gap-2"},tt={class:"flex gap-2"},st={class:"flex gap-2"},lt={class:"text-gray-600 w-full md:w-32 relative"},at={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},ot={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},nt={key:0,class:"text-[9px] text-green-800"},rt=["onClick"],it={key:1,class:"flex justify-end gap-5"},dt={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(l,{emit:T}){const m=l,f=me(),h=se(),k=b(A("company-id")),M=b(A("from-department-id")),L=b(A("to-department-id")),p=b(A("user-ids")),y=b(A("month")),u=b(A("status")),v=b(A("is-important")),a=b(A("is-urgent")),$=b(A("is-target")),U=b(A("search")),_=T,r=Ue(),B=O([]);function A(w){return{get:()=>m.modelValue[w]||"",set:t=>{_("update:modelValue",{...m.modelValue,[w]:t||void 0})}}}const R=b(()=>K(p.value));async function W(){var w,t,x;if(!m.isMyTask){const i=(w=m.modelValue)==null?void 0:w["company-id"],S=L.value,q={...i?{company_id:i}:{},...S?{department_ids:[S]}:{}};B.value=((x=(t=await qe({params:q}))==null?void 0:t.data)==null?void 0:x.employees)||[]}}ce(async()=>{await W(),await r.fetchCompanies({with:"departments",ignore_permission:!0}),await r.fetchMyCompanies({with:"departments"})});function K(w){return Array.isArray(B.value)&&B.value.find(t=>t.id==w)||null}function X(w){p.value=(w==null?void 0:w.id)||""}function G(){p.value=""}le(()=>L.value,W),le(()=>k.value,()=>{L.value!==""?L.value="":W()});function F(w,t,{value:x,id:i,label:S,onCancel:q}={}){if(!w)return[];const D=Array.isArray(t)?t.find(g=>(g==null?void 0:g[i])==w):null;return D?[{label:S,value:D==null?void 0:D[x],id:D==null?void 0:D[i],onCancel:q}]:[]}const E=b(()=>{var i;const w=r.companies.reduce((S,q)=>[...S,...q.departments],[]),t=(S,{label:q,value:D,id:g,onCancel:J})=>S?[{label:q,value:D,id:g,onCancel:J}]:[],x=(S,{label:q,onCancel:D})=>{if(!S)return[];const g=new Date(S);return[{label:q,value:g.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:S,onCancel:D}]};return[...F(k.value,r.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{k.value=""}}),...F(M.value,w,{label:"From",value:"short_name",id:"id",onCancel:()=>{M.value=""}}),...F(L.value,w,{label:"To",value:"short_name",id:"id",onCancel:()=>{L.value=""}}),...F((i=R.value)==null?void 0:i.id,B.value,{label:"Employee",value:"name",id:"id",onCancel:G}),...F(u.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{u.value=""}}),...t(v.value,{label:"",value:"Important ",id:!0,onCancel:()=>{v.value=""}}),...t(a.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{a.value=""}}),...t($.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{$.value=""}}),...x(y.value,{label:"",onCancel:()=>{y.value=""}})]});return(w,t)=>{var i,S,q,D,g,J,z,ne;const x=pe("RouterLink");return s(),o(H,null,[e("div",Re,[e("div",Fe,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),l.isMyTask?n("",!0):(s(),o("div",ze,[l.listHasRearranged?(s(),o("div",He,[t[13]||(t[13]=e("span",{class:"text-red-500"},"Priority Changed",-1)),e("button",{class:"btn-3",onClick:t[0]||(t[0]=N(d=>_("clickPrioritySave"),["prevent"]))},"Save"),e("button",{class:"btn-3",onClick:t[1]||(t[1]=N(d=>_("clickPriorityDiscard"),["prevent"]))},"Discard")])):n("",!0),e("button",{onClick:t[2]||(t[2]=d=>_("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),e("div",We,[e("div",Ge,[l.isMyTask?n("",!0):(s(),o(H,{key:0},[e("div",Je,[t[16]||(t[16]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),Z(e("select",{"onUpdate:modelValue":t[3]||(t[3]=d=>k.value=d),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[t[15]||(t[15]=e("option",{value:""},"--ALL COMPANY--",-1)),(s(!0),o(H,null,ee((i=c(r))==null?void 0:i.myCompanies,d=>(s(),o("option",{key:d.id,value:d.id},I(d.name),9,Ke))),128))],512),[[re,k.value]])]),C(ue,{modelValue:M.value,"onUpdate:modelValue":t[4]||(t[4]=d=>M.value=d),companies:((S=c(r))==null?void 0:S.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:j(()=>t[17]||(t[17]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),c(h).name!=="MyTaskList"?(s(),V(ue,{key:0,modelValue:L.value,"onUpdate:modelValue":t[5]||(t[5]=d=>L.value=d),companies:((q=c(r))==null?void 0:q.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:j(()=>t[18]||(t[18]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):n("",!0),c(f).isAdminMood&&((g=(D=c(f))==null?void 0:D.user)==null?void 0:g.role)!=="employee"?(s(),o("div",Ye,[C(Ve,{modelValue:R.value,onSelect:X,onRemove:G,options:B.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:j(({option:d})=>[C(xe,{user:d,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),R.value?(s(),o("div",Qe,[e("button",{onClick:N(G,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):n("",!0),t[19]||(t[19]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):n("",!0)],64)),e("div",Xe,[t[21]||(t[21]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),Z(e("select",{"onUpdate:modelValue":t[6]||(t[6]=d=>u.value=d),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},t[20]||(t[20]=[e("option",{value:""},"--ALL TASKS--",-1),e("option",{value:"not-completed"},"Not Completed",-1),e("option",{value:"only-completed"},"Completed",-1)]),512),[[re,u.value]])]),e("div",Ze,[e("label",et,[Z(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=d=>v.value=d)},null,512),[[oe,v.value]]),t[22]||(t[22]=e("span",null,"Important",-1))]),e("label",tt,[Z(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=d=>a.value=d)},null,512),[[oe,a.value]]),t[23]||(t[23]=e("span",null,"Urgent",-1))]),e("label",st,[Z(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=d=>$.value=d)},null,512),[[oe,$.value]]),t[24]||(t[24]=e("span",null,"Is Target",-1))])]),e("div",lt,[t[25]||(t[25]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),Z(e("input",{id:"month-filter","onUpdate:modelValue":t[10]||(t[10]=d=>y.value=d),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[Se,y.value]])])]),l.isMyTask?(s(),V(de,{key:0,modelValue:U.value,"onUpdate:modelValue":t[11]||(t[11]=d=>U.value=d),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):n("",!0)])]),e("div",at,[l.isMyTask?n("",!0):(s(),V(de,{key:0,modelValue:U.value,"onUpdate:modelValue":t[12]||(t[12]=d=>U.value=d),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),e("div",ot,[(s(!0),o(H,null,ee(E.value,d=>(s(),o("div",{key:d.label||d.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[e("div",null,[d.label?(s(),o("span",nt,I(d.label)+": ",1)):n("",!0),P(I(d.value),1)]),e("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:N(d.onCancel,["prevent"])},t[26]||(t[26]=[e("i",{class:"fas fa-times-circle"},null,-1)]),8,rt)]))),128))]),l.isMyTask?n("",!0):(s(),o("div",it,[C(x,{class:Q(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((J=c(h).query)==null?void 0:J.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...c(h).query,view:"userwise"}}},{default:j(()=>t[27]||(t[27]=[P(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),C(x,{class:Q(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((z=c(h).query)==null?void 0:z.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ne=c(h))==null?void 0:ne.query)||{}).filter(d=>{var te;return((te=c(h))==null?void 0:te.query[d])!=="userwise"}).reduce((d,te)=>({...d,[te]:c(h).query[te]}),{})}}},{default:j(()=>t[28]||(t[28]=[P(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},ut={},mt={class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"};function ct(l,T){return s(),o("div",mt,T[0]||(T[0]=[e("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),P("CLOSED ")]))}const he=je(ut,[["render",ct]]),pt={class:"-mx-3"},yt={key:0,class:"w-full"},xt={class:"border text-center py-2 border-gray-200"},ft={key:0,class:"text-base font-semibold text-purple-600"},gt={class:"border px-3 py-1 border-gray-200 relative"},kt={class:"flex items-center justify-between"},vt={class:"flex items-center gap-3"},bt={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},wt={class:"text-gray-400 text-xs mr-4"},ht={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ct=["href","onClick"],Tt={class:"border px-3 py-1 border-gray-200"},$t={class:"flex justify-center items-center relative"},_t={class:"absolute right-0"},At=["href","onClick"],It={class:"border px-3 py-1 border-gray-200 text-center"},Lt={key:0,class:"text-gray-500 text-sm"},St={class:"font-semibold text-blue-800"},Mt={class:"border px-3 py-1 border-gray-200 text-center"},Dt={key:0,class:"ml-4 text-gray-500 text-sm"},Vt={class:"text-blue-500 font-semibold"},qt={class:"border px-3 py-1 border-gray-200 text-center"},Et={key:0,class:"text-gray-500 text-sm"},Ut={class:"font-semibold text-blue-800"},Bt={class:"border px-3 py-1 border-gray-200"},Pt={class:"flex justify-end gap-2"},Ot={class:"flex gap-1 items-center mt-2 mb-1 text-sm"},jt={key:1,class:"text-red-800 italic"},Nt=["href"],Rt={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},parentTask:{type:Object},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5}},emits:["editClick","addClick","employeeAssignClick"],setup(l,{emit:T}){const m=l,f=O(!1),h=se(),k=b(()=>f.value?m.childrenTasks:m.childrenTasks.slice(0,m.maxItem)),M=b(()=>f.value?[]:m.childrenTasks.slice(m.maxItem));function L(){f.value=!f.value}const p=T;return(y,u)=>{var v;return s(),o("div",pt,[((v=l.childrenTasks)==null?void 0:v.length)>0?(s(),o("table",yt,[u[4]||(u[4]=e("thead",null,[e("tr",null,[e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50 w-[30px]"},"SL"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Sub Task"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Assign Person"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Assign Date"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Deadline"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Started"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Status")])],-1)),e("tbody",null,[(s(!0),o(H,null,ee(k.value,(a,$)=>(s(),o("tr",{key:a.id,class:Q(["group/sub-task-row",{" bg-green-400/20":a.status=="COMPLETED"," bg-white hover:bg-slate-50":a.status!=="COMPLETED"}])},[e("td",xt,[$!==void 0?(s(),o("div",ft,I($+1)+". ",1)):n("",!0)]),e("td",gt,[e("div",kt,[e("div",null,[e("div",vt,[C(fe,{titleClass:"text-sm",task:a,"sub-tasks-open":!1,"is-my-task":y.isMyTask},null,8,["task","is-my-task"])]),e("div",bt,[e("div",wt,[u[1]||(u[1]=e("i",{class:"fas fa-clock"},null,-1)),P(" "+I(c(we)(a.created_at)),1)]),e("div",ht,[a!=null&&a.is_important?(s(),V(ve,{key:0})):n("",!0),a!=null&&a.is_urgent?(s(),V(be,{key:1})):n("",!0)])])]),a.is_closed?n("",!0):(s(),o("a",{key:0,href:`/tasks/edit/${a.id}`,onClick:N(U=>p("editClick",a.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},u[2]||(u[2]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ct))])]),e("td",Tt,[e("div",$t,[C(Be,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:a.users||[],isTargetTask:a.is_target,maxItem:1,"route-to":U=>`/tasks?status=not-completed&view=userwise&user-ids=${U.id}`},null,8,["users","isTargetTask","route-to"]),e("div",_t,[a.is_closed?n("",!0):(s(),o("a",{key:0,href:`/tasks/${a.id}/assign-users`,onClick:N(U=>p("employeeAssignClick",a.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},u[3]||(u[3]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,At))])])]),e("td",It,[a.assigned_at?(s(),o("span",Lt,[e("span",St,I(c(Y)(a.assigned_at)),1)])):n("",!0)]),e("td",Mt,[a.deadline?(s(),o("span",Dt,[e("span",Vt,I(c(Y)(a.deadline)),1)])):n("",!0)]),e("td",qt,[a.started_at?(s(),o("span",Et,[e("span",Ut,I(c(Y)(a.started_at)),1)])):n("",!0)]),e("td",Bt,[e("div",Pt,[a.closed_at?(s(),V(he,{key:0})):n("",!0),C(ge,{status:a==null?void 0:a.status,progressPercent:(a==null?void 0:a.progress_percent)||0},null,8,["status","progressPercent"]),C(ke,{ref_for:!0,ref:"progress",task:a,class:"text-sm"},null,8,["task"])])])],2))),128))])])):n("",!0),e("div",Ot,[l.childrenTasks.length>0?(s(),o(H,{key:0},[M.value.length>0||f.value?(s(),o("button",{key:0,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border ml-2",onClick:N(L,["prevent","stop"])},I(f.value?"Hide":"Show")+" All ",1)):n("",!0),M.value.length>0?(s(),o("span",jt,I(M.value.length)+" More sub task"+I(M.value.length>1?"s":""),1)):n("",!0)],64)):n("",!0),l.parentTask.level<2?(s(),o("a",{key:1,href:`/tasks/add?parent_id=${l.parentTask.id}&back-to=${encodeURIComponent(c(h).path+"?"+c(Oe)(c(h).query)).toLowerCase()}`,class:Q(["hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-indigo-300",{"ml-2":l.childrenTasks.length===0,"ml-3":l.childrenTasks.length>0}]),onClick:u[0]||(u[0]=N(a=>p("addClick",l.parentTask.id),["stop","prevent"]))},u[5]||(u[5]=[e("i",{class:"fas fa-plus"},null,-1),P(" Add Sub Task ")]),10,Nt)):n("",!0)])])}}},Ft={class:"flex w-full text-gray-800 bg-white"},zt={key:0,class:"border-l border-gray-200 last:border-l-0"},Ht={class:"items-start group"},Wt={class:"flex items-start gap-6 w-full pb-4"},Gt={class:"flex-grow w-6/12"},Jt={class:"flex gap-2"},Kt={key:0,class:"text-xl font-semibold text-blue-500"},Yt={class:"flex items-center mb-2"},Qt={key:0,class:"flex gap-4 items-center mr-3"},Xt={key:1,class:"text-gray-500 text-sm"},Zt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},es={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},ts={class:"text-xs text-gray-400 whitespace-nowrap"},ss={class:"justify-end items-center gap-2 ml-auto flex flex-wrap w-[350px]"},ls={class:"ml-0 col-span-full"},as={class:"flex gap-3 items-center"},os={class:"text-right text-sm flex gap-2 mt-2 opacity-80"},ns={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},rs={key:1,class:"text-sm"},is={class:"font-semibold text-blue-800"},ds={key:2,class:"text-gray-500"},us={key:3,class:"text-sm"},ms={class:"text-blue-500 font-semibold"},cs={key:4,class:"text-sm md:ml-10"},ps={class:"font-semibold text-blue-500"},ys={key:5,class:"text-gray-500"},xs={key:6,class:"text-sm"},fs={class:"font-semibold text-green-500"},gs={class:"flex items-center sm:ml-auto order-0 sm:order-1"},ks={key:0,class:"flex gap-2 ml-4 items-center text-xs"},vs=["href"],bs=["href"],Ce={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(l,{emit:T}){const m=l,f=se(),h=O(null),k=T;function M(_){k("editClick",_)}function L(_){k("employeeAssignClick",_)}const p=O([]),y=localStorage.getItem("sub_task_opened_list");if(y)try{p.value=JSON.parse(y)}catch{p.value=[]}const u=b(()=>Y(m.task.assigned_at)),v=b(()=>Y(m.task.deadline)),a=b(()=>Y(m.task.started_at)),$=b(()=>Y(m.task.completed_at)),U=b({get:()=>p.value.includes(m.task.id),set:_=>{const r=p.value.includes(m.task.id);_&&!r?p.value.push(m.task.id):!_&&r&&(p.value=p.value.filter(B=>B!==m.task.id))}});return le(p,_=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(_))},{deep:!0}),(_,r)=>{var A,R,W,K,X,G,F;const B=pe("RouterLink");return s(),o("div",Ft,[l.treeLevel>0?(s(),o("div",zt,r[4]||(r[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):n("",!0),e("div",{class:Q(["flex-grow border-2 rounded pb-3 px-3",{"border-blue-500":l.index%2===0,"border-pink-300":l.index%2===1}])},[e("div",Ht,[e("div",{class:Q(["-mx-3 px-3 pt-3 shadow-slate-100 flex flex-wrap z-30",{"bg-blue-100/30  ":l.task.closed_at,"bg-green-100  ":((A=h.value)==null?void 0:A.completedPercentage)===100,"bg-white hover:bg-gray-50":((R=h.value)==null?void 0:R.completedPercentage)<100&&!l.task.closed_at,"shadow-sm":l.treeLevel>0}])},[e("div",Wt,[e("div",Gt,[e("div",Jt,[l.index!==void 0?(s(),o("div",Kt,I(l.index+1)+". ",1)):n("",!0),C(fe,{task:l.task,"sub-tasks-open":U.value,"is-my-task":l.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",Yt,[l.showDraggableHandle||l.task.serial?(s(),o("div",Qt,[l.showDraggableHandle?(s(),o("button",{key:0,onMousedown:r[0]||(r[0]=N((...E)=>_.handleDragging&&_.handleDragging(...E),["stop"])),class:"handle"},r[5]||(r[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):n("",!0),l.task.serial?(s(),o("span",Xt," #"+I(l.task.serial),1)):n("",!0)])):n("",!0),e("div",Zt,[l.treeLevel===0?(s(),o("div",es," Main ")):n("",!0),(W=l.task)!=null&&W.is_important?(s(),V(ve,{key:1,class:"flex-none"})):n("",!0),(K=l.task)!=null&&K.is_urgent?(s(),V(be,{key:2,class:"flex-none"})):n("",!0)])]),e("div",ts,[r[6]||(r[6]=e("i",{class:"fas fa-clock"},null,-1)),P(" "+I(c(we)(l.task.created_at)),1)])]),l.hideAssignedUsers?n("",!0):(s(),V(Pe,{key:0,task:l.task,"tree-level":l.treeLevel,class:"flex-nowrap w-1/2","employee-route-to":E=>({query:{...c(f).query,view:"userwise","company-id":E.company_id,"user-ids":E.id}})},null,8,["task","tree-level","employee-route-to"])),e("div",ss,[l.task.closed_at?(s(),V(he,{key:0})):n("",!0),C(ge,{status:(X=l.task)==null?void 0:X.status,progressPercent:((G=l.task)==null?void 0:G.progress_percent)||0,class:"w-[150px] text-center !border-2"},null,8,["status","progressPercent"]),C(ke,{ref_key:"progress",ref:h,task:l.task,class:"text-sm w-[150px] text-center"},null,8,["task"])])])],2),e("div",ls,[C(Rt,{childrenTasks:l.task.children_tasks,parentTask:l.task,"hide-buttons":l.hideButtons,"hide-assigned-users":l.hideAssignedUsers,"parent-tree-level":l.treeLevel,onEditClick:M,onAddClick:r[1]||(r[1]=E=>k("addClick",E)),onEmployeeAssignClick:L},{"tree-item-end":j(({task:E,level:w})=>[Me(_.$slots,"item-end",{level:w,task:E})]),_:3},8,["childrenTasks","parentTask","hide-buttons","hide-assigned-users","parent-tree-level"])])]),e("div",null,[e("div",as,[e("div",os,[l.task.is_target?(s(),o("div",ns,r[7]||(r[7]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),P(" TARGET TASK ")]))):n("",!0),u.value?(s(),o("span",rs,[r[8]||(r[8]=e("span",{class:"italic text-gray-500"},"Assign: ",-1)),e("span",is,I(u.value),1)])):n("",!0),v.value?(s(),o("span",ds," ...... ")):n("",!0),v.value?(s(),o("span",us,[r[9]||(r[9]=e("span",{class:"italic text-gray-500"},"Deadline: ",-1)),e("span",ms,I(v.value),1)])):n("",!0),a.value?(s(),o("span",cs,[r[10]||(r[10]=e("span",{class:"italic text-gray-500"},"Started: ",-1)),e("span",ps,I(a.value),1)])):n("",!0),$.value?(s(),o("span",ys,"......")):n("",!0),$.value?(s(),o("span",xs,[r[12]||(r[12]=e("span",{class:"italic text-gray-500"},"Completed: ",-1)),e("span",fs,[P(I($.value)+" ",1),r[11]||(r[11]=e("i",{class:"fas fa-check-circle"},null,-1))])])):n("",!0)]),e("div",gs,[l.hideButtons?n("",!0):(s(),o("div",ks,[l.task.is_closed?n("",!0):(s(),o("a",{key:0,href:`/tasks/edit/${l.task.id}`,onClick:r[2]||(r[2]=N(E=>k("editClick",l.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},r[13]||(r[13]=[e("i",{class:"fas fa-edit"},null,-1),P(" Edit ")]),8,vs)),l.task.is_closed?n("",!0):(s(),o("a",{key:1,href:`/tasks/${l.task.id}/assign-users`,onClick:r[3]||(r[3]=N(E=>k("employeeAssignClick",l.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},r[14]||(r[14]=[e("i",{class:"fas fa-users-cog"},null,-1),P(" Manage Employee & Supervisor ")]),8,bs)),C(B,{to:{name:"TaskReports",params:{id:(F=l.task)==null?void 0:F.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:j(()=>r[15]||(r[15]=[e("i",{class:"far fa-file-alt"},null,-1),P(" Reports ")])),_:1,__:[15]},8,["to"])]))])])])],2)])}}},ws={class:"w-full bg-white rounded"},hs=["rowspan"],Cs={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(l,{emit:T}){const m=l,f=se(),h=T,k=b(()=>m.tasks.reduce((p,y)=>(p.push(...y.users.filter(u=>!p.find(v=>v.id==u.id&&u.id))),p),[]).filter(p=>m.selectedUserId?p.id==m.selectedUserId:!0)),M=p=>{const u=m.tasks.filter(v=>v.users.some(a=>a.id===p));return ye(u,{...f.query,"user-ids":p})},L=b(()=>k.value.map(p=>{const y=M(p.id);return{...p,tasks:y}}));return(p,y)=>(s(),o("div",null,[e("table",ws,[e("tbody",null,[(s(!0),o(H,null,ee(L.value,u=>(s(),o(H,{key:u.id},[(s(!0),o(H,null,ee(u.tasks,(v,a)=>(s(),o("tr",{key:v.id},[a==0?(s(),o("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(u.tasks.length,1)},[C(xe,{user:u,class:"sticky top-[8rem]"},null,8,["user"])],8,hs)):n("",!0),e("td",{class:Q(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":a==0,"border-b":u.tasks.length-1===a}])},[C(Ce,{task:v,class:"!border-0 my-0",index:a,onCommentButtonClick:y[0]||(y[0]=$=>h("commentButtonClick",p.item.id)),onEditClick:y[1]||(y[1]=$=>h("editClick",$)),onAddClick:y[2]||(y[2]=$=>h("addClick",$)),onEmployeeAssignClick:y[3]||(y[3]=$=>h("employeeAssignClick",$))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Ts={class:"max-w-full mx-4 p-6 mt-2 relative bg-white rounded-md shadow-md"},$s={class:"mb-4"},_s={class:"relative min-h-[30vh]"},As={key:0,class:"text-center py-4 text-red-500"},Is={key:1},Ls={class:"flex items-stretched"},Ss={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},Ms=1,ol={__name:"TaskList",setup(l){const T=Ne(),m=me(),f=se(),h=De(),k=O(""),M=O(!1),L=O(null),p=b(()=>{var x;return((x=m==null?void 0:m.user)==null?void 0:x.role)==="employee"||!(m!=null&&m.isAdminMood)?!0:!!f.query["user-ids"]}),y=O(null),u=O(!1),v=ie({parentId:0,requirementId:0}),a=ie({taskId:0,isOpen:!1}),$=O(null),U=O([]),{handleItemsPriorityUpdate:_,saveTaskPriority:r,listHasRearranged:B}=Ee(()=>T.taskListTree,0);ce(async()=>{k.value="loading",f.query.status?await A():h.push({query:{...f.query,status:"not-completed"}})});async function A(){let x;f.name==="MyTaskList"?x=await T.fetchMyTasks({...f.query,page:1}):x=await T.fetchTasks({...f.query,page:1},{infiniteScrolling:!1}),k.value="",U.value=x.query_log||[]}const R=x=>{u.value=!0,v.parentId=x},W=x=>{a.taskId=x,a.isOpen=!0},K=x=>{L.value=x,M.value=!0},X=()=>{M.value=!1,L.value=null};async function G(){y.value=null,u.value=!1,v.parentId=0,k.value="loading",await A()}async function F(){u.value=!1,v.parentId=0,await A()}async function E(){k.value="loading",await r()&&await A()}le(()=>({...f.query}),async()=>{T.resetTaskList(),k.value="loading",await A()});const w=b({get(){return{...f.query}},set(x){localStorage.removeItem("sub_task_opened_list"),h.push({query:{...x}})}}),t=b(()=>{var i;const x={...f.query};return f.name=="MyTaskList"&&(x["user-ids"]=(i=m==null?void 0:m.user)==null?void 0:i.id),Array.isArray(T.tasks)?ye(T.tasks,x):[]});return(x,i)=>{var S,q,D;return s(),o("div",Ts,[y.value?(s(),V(ae,{key:0},{default:j(()=>[C(Le,{taskId:y.value,onClose:i[0]||(i[0]=g=>y.value=null),onUpdated:G},null,8,["taskId"])]),_:1})):n("",!0),u.value?(s(),V(ae,{key:1},{default:j(()=>[C(Ie,{parentTaskId:v.parentId,requirementId:v.requirementId,onClose:F,onTaskCreated:G},null,8,["parentTaskId","requirementId"])]),_:1})):n("",!0),a.isOpen?(s(),V(ae,{key:2,class:"*:max-w-4xl"},{default:j(()=>[C($e,{taskId:a.taskId,onCancelClick:i[1]||(i[1]=()=>{a.isOpen=!1,a.taskId=0}),onSuccess:i[2]||(i[2]=()=>{a.isOpen=!1,a.taskId=0,k.value="loading",A()})},null,8,["taskId"])]),_:1})):n("",!0),C(dt,{modelValue:w.value,"onUpdate:modelValue":i[3]||(i[3]=g=>w.value=g),onClickAddTask:R,onClickPrioritySave:E,onClickPriorityDiscard:i[4]||(i[4]=()=>c(B)?$.value.resetItems:null),"list-has-rearranged":c(B),isMyTask:c(f).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((q=(S=c(f))==null?void 0:S.query)==null?void 0:q["query-log"])=="true"?(s(!0),o(H,{key:3},ee(U.value,(g,J)=>(s(),o("div",{key:J,class:"text-xs text-gray-500"},[e("div",$s,I(g.raw_query),1)]))),128)):n("",!0),e("div",_s,[c(T).error?(s(),o("div",As,I(c(T).error),1)):c(T).tasks.length>0?(s(),o("div",Is,[((D=c(f).query)==null?void 0:D.view)=="userwise"?(s(),V(Cs,{key:0,tasks:t.value,selectedUserId:c(f).query["user-ids"],onCommentButtonClick:i[5]||(i[5]=g=>K(g,x.task.id)),onEditClick:i[6]||(i[6]=g=>y.value=g),onAddClick:i[7]||(i[7]=g=>R(g)),onEmployeeAssignClick:i[8]||(i[8]=g=>W(g))},null,8,["tasks","selectedUserId"])):(s(),V(_e,{key:1,items:t.value,handle:"handle",onItemsUpdate:c(_),class:"space-y-6",ref_key:"draggableTaskList",ref:$},{item:j(({item:g,index:J})=>[e("div",Ls,[C(Ce,{"is-my-task":c(f).name==="MyTaskList",task:g,index:J,showDraggableHandle:!p.value,onCommentButtonClick:i[9]||(i[9]=z=>K(z,x.task.id)),onEditClick:i[10]||(i[10]=z=>y.value=z),onAddClick:i[11]||(i[11]=z=>R(z)),onEmployeeAssignClick:i[12]||(i[12]=z=>W(z)),class:"!border-0 shadow hover:shadow-md"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):k.value!=="loading"?(s(),o("div",Ss," No tasks found. ")):n("",!0),k.value==="loading"?(s(),V(Ae,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):n("",!0)]),C(Te,{show:M.value,"commentable-id":L.value,"commentable-type":"task","user-id":Ms,"on-close":X,onSubmitted:c(T).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{ol as default};
