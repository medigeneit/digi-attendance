import{_ as ye}from"./CommentModal-DcPKXi1F.js";import{_ as ke,a as ce}from"./TaskUserAssignForm-BJNuB38x.js";import{L as fe}from"./LoaderView-BeATYaUy.js";import{O as J}from"./OverlyModal-CgSCNH-1.js";import{_ as se,a as ve}from"./TaskAddForm-yppoCFRa.js";import{_ as be}from"./TaskEditForm-toPAX2sH.js";import{r as U,q as f,c as u,o as s,a as t,h as P,v as re,g as b,w as W,d as ie,b as ue,e as de,A as X,n as ge,f as E,p as w,F as _,C as le,x as Y,t as Z,k as r,i as L,D as Q,j as ae,y as ee,u as xe,E as oe}from"./index-DHx-UfKa.js";import{_ as we}from"./MultiselectDropdown-Bf0QNcxk.js";import{g as Te,u as Ce}from"./task-priority-BRqeqwma.js";import{u as Ie}from"./company-3gOofpLF.js";import{_ as me}from"./UserChip-h0Pj2UiL.js";import{_ as pe}from"./TaskTreeView-DR_6Rz3o.js";import{u as Ve}from"./useTaskStore-CrjXEO7e.js";import"./useCommentStore-XsP9Hm9O.js";import"./datetime-q3Sn87-f.js";import"./TaskUrgencyInput-BmZLVmaW.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-yDKmISYz.js";import"./useRequirementStore-C_5RV1wr.js";import"./SectionLoading-B6EZT737.js";const Ae={class:"text-gray-600 relative"},Me={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},ne={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(C,{emit:v}){const m=C,d=U(),g=v,T=o=>{g("update:modelValue",o||void 0)};let V=0;const i=f({get(){return m.modelValue},set(o){clearTimeout(V),V=setTimeout(T,500,o)}});return(o,n)=>(s(),u("div",Ae,[n[3]||(n[3]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),P(t("input",{ref_key:"searchInput",ref:d,id:"search","onUpdate:modelValue":n[0]||(n[0]=y=>i.value=y),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[re,i.value]]),t("div",Me,[i.value?(s(),u("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:n[1]||(n[1]=W(()=>{T(""),d.value.focus()},["prevent"]))})):b("",!0),n[2]||(n[2]=t("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},qe={class:"mb-3 task-header"},Le={class:"flex justify-between items-start mb-4"},$e={key:0,class:"ml-auto flex gap-6 items-center"},Se={key:0,class:"flex gap-2 items-center"},Ue={class:"flex flex-wrap items-center gap-2 mt-3"},Ee={class:"flex flex-wrap gap-4"},_e={class:"relative w-full md:w-48"},De=["value"],Pe={key:1,class:"relative w-full md:w-72"},Oe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Be={class:"text-gray-600 w-40 relative"},he={class:"flex gap-4 items-center flex-shrink-0"},Ne={class:"flex gap-2"},Re={class:"flex gap-2"},Fe={class:"flex gap-2"},je={class:"text-gray-600 w-full md:w-40 relative"},He={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-5 gap-2"},ze={key:1,class:"w-full flex justify-end gap-5 mt-4"},We={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(C,{emit:v}){const m=C,d=ie(),g=ue(),T=f(x("company-id")),V=f(x("from-department-id")),i=f(x("to-department-id")),o=f(x("user-ids")),n=f(x("month")),y=f(x("status")),p=f(x("is-important")),I=f(x("is-urgent")),R=f(x("is-target")),O=f(x("search")),B=v,q=Ie(),A=U([]);function x(k){return{get:()=>m.modelValue[k]||"",set:e=>{B("update:modelValue",{...m.modelValue,[k]:e||void 0})}}}const F=f(()=>G(o.value));async function h(){var k,e,l;if(!m.isMyTask){const $=(k=m.modelValue)==null?void 0:k["company-id"],S=i.value,D={...$?{company_id:$}:{},...S?{department_ids:[S]}:{}};A.value=((l=(e=await Te({params:D}))==null?void 0:e.data)==null?void 0:l.employees)||[]}}de(async()=>{await h(),await q.fetchCompanies({with:"departments"})});function G(k){return Array.isArray(A.value)&&A.value.find(e=>e.id==k)||null}function H(k){o.value=(k==null?void 0:k.id)||""}function z(){o.value=""}const K=f(()=>q==null?void 0:q.companies.filter(k=>k.id==T.value));return X(()=>i.value,h),X(()=>T.value,()=>{i.value!==""?i.value="":h()}),(k,e)=>{var $,S,D,c,N,M,te;const l=ge("RouterLink");return s(),u(_,null,[t("div",qe,[t("div",Le,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),C.isMyTask?b("",!0):(s(),u("div",$e,[C.listHasRearranged?(s(),u("div",Se,[e[13]||(e[13]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=W(a=>B("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=W(a=>B("clickPriorityDiscard"),["prevent"]))},"Discard")])):b("",!0),t("button",{onClick:e[2]||(e[2]=a=>B("clickAddTask")),class:"btn-1"},"Add Task")]))]),t("div",Ue,[t("div",Ee,[C.isMyTask?b("",!0):(s(),u(_,{key:0},[t("div",_e,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),P(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>T.value=a),class:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[15]||(e[15]=t("option",{value:""},"--ALL COMPANY--",-1)),(s(!0),u(_,null,Y(($=r(q))==null?void 0:$.companies,a=>(s(),u("option",{key:a.id,value:a.id},Z(a.name),9,De))),128))],512),[[le,T.value]])]),r(g).name!=="MyTaskList"?(s(),E(se,{key:0,modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value=a),companies:K.value||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:L(()=>e[17]||(e[17]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):b("",!0),r(d).isAdminMood&&((D=(S=r(d))==null?void 0:S.user)==null?void 0:D.role)!=="employee"?(s(),u("div",Pe,[w(we,{modelValue:F.value,onSelect:H,onRemove:z,options:A.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full"},{option:L(({option:a})=>[w(me,{user:a,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),F.value?(s(),u("div",Oe,[t("button",{onClick:W(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):b("",!0),e[18]||(e[18]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):b("",!0)],64)),w(se,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a),companies:((c=r(q))==null?void 0:c.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:L(()=>e[19]||(e[19]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),t("div",Be,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),P(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>y.value=a),class:"input-1"},e[20]||(e[20]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[le,y.value]])]),t("div",he,[t("label",Ne,[P(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=a=>p.value=a)},null,512),[[Q,p.value]]),e[22]||(e[22]=t("span",null,"Important",-1))]),t("label",Re,[P(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=a=>I.value=a)},null,512),[[Q,I.value]]),e[23]||(e[23]=t("span",null,"Urgent",-1))]),t("label",Fe,[P(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=a=>R.value=a)},null,512),[[Q,R.value]]),e[24]||(e[24]=t("span",null,"Is Target",-1))])]),t("div",je,[e[25]||(e[25]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),P(t("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=a=>n.value=a),type:"month",class:"input-1",placeholder:"All month"},null,512),[[re,n.value]])])]),C.isMyTask?(s(),E(ne,{key:0,modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=a=>O.value=a),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):b("",!0)])]),t("div",He,[C.isMyTask?b("",!0):(s(),E(ne,{key:0,modelValue:O.value,"onUpdate:modelValue":e[12]||(e[12]=a=>O.value=a),class:"w-full md:w-64 lg:w-96 md:ml-auto"},null,8,["modelValue"])),C.isMyTask?b("",!0):(s(),u("div",ze,[w(l,{class:ee(["text-xs sm:text-sm btn-3 py-0.5",((N=r(g).query)==null?void 0:N.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...r(g).query,view:"userwise"}}},{default:L(()=>e[26]||(e[26]=[ae(" User Wise List ")])),_:1,__:[26]},8,["class","to"]),w(l,{class:ee(["text-xs sm:text-sm btn-3 py-0.5",((M=r(g).query)==null?void 0:M.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((te=r(g))==null?void 0:te.query)||{}).filter(a=>{var j;return((j=r(g))==null?void 0:j.query[a])!=="userwise"}).reduce((a,j)=>({...a,[j]:r(g).query[j]}),{})}}},{default:L(()=>e[27]||(e[27]=[ae(" TaskWise List ")])),_:1,__:[27]},8,["class","to"])]))])],64)}}},Ye={class:"w-full bg-white rounded"},Ge=["rowspan"],Ke={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(C,{emit:v}){const m=C,d=v,g=f(()=>m.tasks.reduce((i,o)=>(i.push(...o.users.filter(n=>!i.find(y=>y.id==n.id&&n.id))),i),[]).filter(i=>m.selectedUserId?i.id==m.selectedUserId:!0)),T=i=>m.tasks.filter(y=>y.users.some(p=>p.id===i)),V=f(()=>g.value.map(i=>{const o=T(i.id);return{...i,tasks:o}}));return(i,o)=>(s(),u("div",null,[t("table",Ye,[t("tbody",null,[(s(!0),u(_,null,Y(V.value,n=>(s(),u(_,{key:n.id},[(s(!0),u(_,null,Y(n.tasks,(y,p)=>(s(),u("tr",{key:y.id},[p==0?(s(),u("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(n.tasks.length,1)},[w(me,{user:n,class:"sticky top-[80px]"},null,8,["user"])],8,Ge)):b("",!0),t("td",{class:ee(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":p==0,"border-b":n.tasks.length-1===p}])},[w(pe,{task:y,class:"!border-0 my-0",index:p,onCommentButtonClick:o[0]||(o[0]=I=>d("commentButtonClick",i.item.id)),onEditClick:o[1]||(o[1]=I=>d("editClick",I)),onAddClick:o[2]||(o[2]=I=>d("addClick",I)),onEmployeeAssignClick:o[3]||(o[3]=I=>d("employeeAssignClick",I))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Je={class:"container mx-auto p-6 mt-2 relative bg-white rounded-md shadow-md"},Qe={class:"mb-4"},Xe={key:4},Ze={key:0,class:"text-center py-4 text-red-500"},et={key:1},tt={class:"flex items-stretched"},st={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},lt=1,It={__name:"TaskList",setup(C){const v=Ve(),m=ie(),d=ue(),g=xe(),T=U(!1),V=U(null),i=f(()=>{var e;return((e=m==null?void 0:m.user)==null?void 0:e.role)==="employee"||!(m!=null&&m.isAdminMood)?!0:!!d.query["user-ids"]}),o=U(null),n=U(!1),y=oe({parentId:0,requirementId:0}),p=oe({taskId:0,isOpen:!1}),I=U(null),R=U([]),{handleItemsPriorityUpdate:O,saveTaskPriority:B,listHasRearranged:q}=Ce(()=>v.taskListTree,0);de(async()=>{d.query.status||g.push({query:{...d.query,status:"not-completed"}}),await A()});async function A(){let e;d.name==="MyTaskList"?e=await v.fetchMyTasks({...d.query}):e=await v.fetchTasks({...d.query}),R.value=e.query_log||[]}const x=e=>{n.value=!0,y.parentId=e},F=e=>{p.taskId=e,p.isOpen=!0},h=e=>{V.value=e,T.value=!0},G=()=>{T.value=!1,V.value=null};async function H(){o.value=null,n.value=!1,y.parentId=0,await A()}async function z(){n.value=!1,y.parentId=0,await A()}async function K(){B()&&await A()}X(()=>({...d.query}),async()=>{await A()});const k=f({get(){return{...d.query}},set(e){localStorage.removeItem("sub_task_opened_list"),g.push({query:{...e}})}});return(e,l)=>{var $,S,D;return s(),u("div",Je,[o.value?(s(),E(J,{key:0},{default:L(()=>[w(be,{taskId:o.value,onClose:l[0]||(l[0]=c=>o.value=null),onUpdated:H},null,8,["taskId"])]),_:1})):b("",!0),n.value?(s(),E(J,{key:1},{default:L(()=>[w(ve,{parentTaskId:y.parentId,requirementId:y.requirementId,onClose:z,onTaskCreated:H},null,8,["parentTaskId","requirementId"])]),_:1})):b("",!0),p.isOpen?(s(),E(J,{key:2,class:"*:max-w-4xl"},{default:L(()=>[w(ke,{taskId:p.taskId,onCancelClick:l[1]||(l[1]=()=>{p.isOpen=!1,p.taskId=0}),onSuccess:l[2]||(l[2]=()=>{p.isOpen=!1,p.taskId=0,A()})},null,8,["taskId"])]),_:1})):b("",!0),w(We,{modelValue:k.value,"onUpdate:modelValue":l[3]||(l[3]=c=>k.value=c),onClickAddTask:x,onClickPrioritySave:K,onClickPriorityDiscard:l[4]||(l[4]=()=>r(q)?I.value.resetItems:null),"list-has-rearranged":r(q),isMyTask:r(d).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((S=($=r(d))==null?void 0:$.query)==null?void 0:S["query-log"])=="true"?(s(!0),u(_,{key:3},Y(R.value,(c,N)=>(s(),u("div",{key:N,class:"text-xs text-gray-500"},[t("div",Qe,Z(c.raw_query),1)]))),128)):b("",!0),r(v).loading?(s(),u("div",Xe,[w(fe)])):(s(),u(_,{key:5},[r(v).error?(s(),u("div",Ze,Z(r(v).error),1)):r(v).tasks.length>0?(s(),u("div",et,[((D=r(d).query)==null?void 0:D.view)=="userwise"?(s(),E(Ke,{key:0,tasks:r(v).tasks,selectedUserId:r(d).query["user-ids"],onCommentButtonClick:l[5]||(l[5]=c=>h(c,e.task.id)),onEditClick:l[6]||(l[6]=c=>o.value=c),onAddClick:l[7]||(l[7]=c=>x(c)),onEmployeeAssignClick:l[8]||(l[8]=c=>F(c))},null,8,["tasks","selectedUserId"])):(s(),E(ce,{key:1,items:r(v).tasks,handle:"handle",onItemsUpdate:r(O),class:"space-y-4",ref_key:"draggableTaskList",ref:I},{item:L(({item:c,index:N})=>[t("div",tt,[w(pe,{"is-my-task":r(d).name==="MyTaskList",task:c,index:N,showDraggableHandle:!i.value,onCommentButtonClick:l[9]||(l[9]=M=>h(M,e.task.id)),onEditClick:l[10]||(l[10]=M=>o.value=M),onAddClick:l[11]||(l[11]=M=>x(M)),onEmployeeAssignClick:l[12]||(l[12]=M=>F(M)),class:"!border-0"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(s(),u("div",st," No tasks found. "))],64)),w(ye,{show:T.value,"commentable-id":V.value,"commentable-type":"task","user-id":lt,"on-close":G,onSubmitted:r(v).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{It as default};
