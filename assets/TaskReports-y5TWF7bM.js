import{b as N,e as V,m as P,z,c as a,o as n,a as t,t as c,f as A,g as u,k as d,i as E,j as F,F as D,n as S,w as M,p as B,q as O}from"./index-CwnVGsJ2.js";import{_ as $}from"./UserChip-DHAKK7KP.js";import{a as j}from"./datetime-JHBtYVYZ.js";import{u as q}from"./useTaskReportStore-CBZPW8BW.js";import{u as I}from"./useTaskStore-HdVVMkbe.js";const U={class:"mt-4"},G={class:"bg-white"},H={class:"flex mb-2 items-end"},J={class:"overflow-auto w-full"},K={key:0,class:"min-w-full bg-white shadow rounded-lg overflow-hidden"},Q={class:"bg-gray-100"},W={key:0,class:"px-4 py-2 text-left md:w-[100px] lg:w-[220px] xl:w-[320px]"},X={key:0},Y=["onClick"],Z={class:"px-4 py-2 border-b"},tt={key:0,class:"px-4 py-2 font-medium border-r border-b"},st={key:0,style:{"font-family":"monospace"}},et={class:"ml-1"},ot={class:"ml-1"},nt={class:"font-medium py-2 px-4 border"},at={class:"border rounded-md bg-gray-50"},rt={class:"text-sm flex items-center px-3 py-3"},lt={class:"text-gray-600 text-sm ml-auto whitespace-nowrap"},it={key:1,class:"text-center border py-4 text-gray-500"},ft={__name:"TaskReports",setup(dt){const k=q(),l=I(),h=N().params.id;V(async()=>{await l.fetchTask(h),await k.fetchTaskReports({task_id:h})});function y(i,s=[]){const r=[];for(const o of i){const m=[...s,o.title];o.children_tasks.length===0?r.push(...o.reports.map(p=>({...p,task_id:o.id,task_title:o.title,task_parents:s,user:o.users.find(_=>_.id===p.user_id)}))):r.push(...y(o.children_tasks,m))}return r}function g(i,s){try{const r=new Date(i.report_date).getTime(),o=new Date(s.report_date).getTime();return o===r?s.id-i.id:o-r}catch{return-1}}const x=P(()=>l.task.children_task_count===0?[...k.task_reports].sort(g):[...y(l.tasks)].sort(g));return(i,s)=>{var o,m,p,_;const r=z("RouterLink");return n(),a("div",U,[s[6]||(s[6]=t("hr",{class:"mb-2"},null,-1)),t("div",G,[t("pre",null,c(i.usersTaskProgress),1),t("div",H,[s[2]||(s[2]=t("h3",{class:"text-sm font-semibold text-gray-600 uppercase mt-4"},"Task Reports",-1)),((o=d(l).task)==null?void 0:o.children_task_count)===0&&!((m=d(l).task)!=null&&m.closed_at)?(n(),A(r,{key:0,to:{name:"TaskReportAdd",params:{id:(p=d(l).task)==null?void 0:p.id}},onClick:s[0]||(s[0]=e=>e.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:E(()=>s[1]||(s[1]=[F("Add Report")])),_:1,__:[1]},8,["to"])):u("",!0)]),t("div",J,[d(k).loading?(n(),a("div",it,"Loading...")):(n(),a("table",K,[t("thead",Q,[t("tr",null,[s[3]||(s[3]=t("th",{class:"px-4 py-2 text-left w-2"},"#",-1)),d(l).task.children_task_count>0?(n(),a("th",W," Task ")):u("",!0),s[4]||(s[4]=t("th",{class:"px-4 py-2 text-left lg:w-[540px]"},"User Report",-1))])]),t("tbody",null,[((_=x.value)==null?void 0:_.length)===0?(n(),a("tr",X,s[5]||(s[5]=[t("td",{class:"px-4 py-4 font-medium text-gray-500 text-center",colspan:"10"}," NO REPORTS ",-1)]))):u("",!0),(n(!0),a(D,null,S(x.value,(e,L)=>{var w,b,v,R,T;return n(),a("tr",{key:e.id,class:"border-t hover:bg-gray-50 cursor-pointer",onClick:M(C=>i.goToShow(e.id),["prevent"]),role:"button"},[t("td",Z,c(L+1),1),d(l).task.children_task_count>0?(n(),a("td",tt,[t("div",null,[(n(!0),a(D,null,S(e.task_parents.reverse(),(C,f)=>(n(),a("div",{class:B(["text-gray-400 text-sm line-clamp-1",{"-ml-1":f==0}]),key:f},[f>0?(n(),a("span",st,"↳")):u("",!0),t("span",et,c(C),1)],2))),128)),t("div",null,[((w=e.task_parents)==null?void 0:w.length)>0?(n(),a("span",{key:0,style:{"font-family":"monospace"},class:B({"ml-2":((b=e.task_parents)==null?void 0:b.length)==1,"ml-4":((v=e.task_parents)==null?void 0:v.length)==2,"ml-6":((R=e.task_parents)==null?void 0:R.length)==3,"ml-8":((T=e.task_parents)==null?void 0:T.length)==4})},"↳",2)):u("",!0),t("span",ot,c(e.task_title),1)])])])):u("",!0),t("td",nt,[t("div",at,[O($,{user:e.user,class:"inline-block w-full !rounded-sm"},null,8,["user"]),t("div",rt,[t("div",null,c(e.title),1),t("div",lt," on "+c(d(j)(e.report_date)),1)])])])],8,Y)}),128))])]))])])])}}};export{ft as default};
