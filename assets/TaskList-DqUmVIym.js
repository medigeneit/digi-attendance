import{_ as ue}from"./CommentModal-BcXVifrE.js";import{_ as me}from"./DraggableList.vue_vue_type_script_setup_true_lang-DboRVxxZ.js";import{L as pe}from"./LoaderView-Dxx5X6ZT.js";import{O as X}from"./OverlyModal-DxhW2Sdp.js";import{_ as ye}from"./TaskAddForm-BMt22IkQ.js";import{_ as ce}from"./TaskEditForm-De9NIXVJ.js";import{d as ne,b as te,x as g,r as P,e as re,A as ee,m as ve,c as d,o,a as l,g as _,f as S,F as R,n as h,i as E,t as z,k as r,h as j,B as ke,Q as Y,v as fe,y as J,j as Z,w as ge,q as se,u as be,z as le,S as xe}from"./index-B3qRgfav.js";import{g as we}from"./task-BvXfmoEe.js";import{u as Te}from"./company-BRc96NYi.js";import{_ as ae}from"./CompanyDepartmentSelectInput-BmWNGGJR.js";import{_ as Ce}from"./EmployeeDropdownInput-BH_534Oq.js";import{_ as oe,m as ie}from"./task-tree-DUnojasz.js";import{S as _e}from"./SelectDropdown-DLPjcSw2.js";import{_ as de}from"./TaskTreeViewWithSubTable-D6Qe9mOg.js";import{_ as Ie}from"./TaskUserAssignForm-Beq7lBTh.js";import{_ as Me}from"./UserChip-B0EVheIQ.js";import{u as Ve}from"./task-priority-B1hx0uC5.js";import{u as Ae}from"./useTaskStore-BgppsYBJ.js";import"./useCommentStore-D79R-wgz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-CAWPUA_y.js";import"./url-CePbr-gY.js";import"./SectionLoading-NoqJfwjE.js";import"./TextWithHr-CmDQnxo-.js";import"./TaskUrgencyInput-Ceo325l2.js";import"./datetime-DcVwRp76.js";import"./tags-1QRIEOWV.js";import"./MultiselectDropdown-jAnRr37I.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BCtSVIxu.js";import"./TaskSupervisorAndEmployee-5C_BTt9A.js";import"./TaskStatus-BXwrThY_.js";import"./user-jBjinETP.js";import"./TaskUserChip-D2WJSoFC.js";const qe={class:"mb-3 task-header"},Ue={class:"flex justify-between items-start"},he={key:0,class:"ml-auto flex gap-6 items-center"},Le={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},$e={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Se={class:"relative"},De=["title"],Ee={key:0},Be={key:1,class:"text-gray-500 whitespace-nowrap"},Oe={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Pe={class:"relative"},Fe={class:"w-32 relative h-10"},Ne={class:"flex gap-4 items-center flex-shrink-0"},je={class:"flex gap-2"},ze={class:"flex gap-2"},Re={class:"flex gap-2"},He={class:"text-gray-600 w-full md:w-32 relative"},We={class:"flex flex-col md:flex-row mb-2 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80"},Ge={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},Ke={key:0,class:"text-[9px] text-green-800"},Qe=["onClick"],Je={key:1,class:"flex justify-end gap-5"},Xe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup($,{emit:w}){const m=$,i=ne(),T=te(),c=g(x("company-id")),L=g(x("from-department-id")),V=g(x("to-department-id")),u=g(x("user-ids")),n=g(x("month")),p=g(x("status")),b=g(x("is-important")),v=g(x("is-urgent")),D=g(x("is-target")),I=g(x("search")),H=w,A=Te(),B=P([]);function x(k){return{get:()=>m.modelValue[k]||"",set:e=>{H("update:modelValue",{...m.modelValue,[k]:e||void 0})}}}const O=g(()=>W(u.value));async function N(){var k,e,M;if(!m.isMyTask){const a=(k=m.modelValue)==null?void 0:k["company-id"],t=V.value,C={...a?{company_id:a}:{},...t?{department_ids:[t]}:{}};B.value=((M=(e=await we({params:C}))==null?void 0:e.data)==null?void 0:M.employees)||[]}}re(async()=>{await A.fetchCompanies({with:"departments",ignore_permission:!0}),await A.fetchMyCompanies({with:"departments"}),await N()});function W(k){return Array.isArray(B.value)&&B.value.find(e=>e.id==k)||null}function G(){u.value=""}ee(()=>V.value,N),ee(()=>c.value,()=>{L.value="",V.value=""});function F(k,e,{value:M,id:a,label:t,onCancel:C}={}){if(!k)return[];const f=Array.isArray(e)?e.find(q=>(q==null?void 0:q[a])==k):null;return f?[{label:t,value:typeof M=="function"?M(f):f==null?void 0:f[M],id:f==null?void 0:f[a],onCancel:C}]:[]}const K=g(()=>{var a;const k=A.companies.reduce((t,C)=>[...t,...C.departments],[]),e=(t,{label:C,value:f,id:q,onCancel:y})=>t?[{label:C,value:f,id:q,onCancel:y}]:[],M=(t,{label:C,onCancel:f})=>{if(!t)return[];const q=new Date(t);return[{label:C,value:q.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:t,onCancel:f}]};return[...F(c.value,A.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{c.value=""}}),...F(L.value,k,{id:"id",label:"From",value:t=>t.short_name||t.name,onCancel:()=>{L.value=""}}),...F(V.value,k,{id:"id",label:"To",value:t=>t.short_name||t.name,onCancel:()=>{V.value=""}}),...F((a=O.value)==null?void 0:a.id,B.value,{label:"Employee",value:"name",id:"id",onCancel:G}),...F(p.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{p.value=""}}),...e(b.value,{label:"",value:"Important ",id:!0,onCancel:()=>{b.value=""}}),...e(v.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{v.value=""}}),...e(D.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{D.value=""}}),...M(n.value,{label:"",onCancel:()=>{n.value=""}})]}),Q=g(()=>c.value?A==null?void 0:A.companies.filter(k=>k.id==c.value):A==null?void 0:A.companies);return(k,e)=>{var a,t,C,f,q,y;const M=ve("RouterLink");return o(),d("div",null,[l("div",qe,[l("div",Ue,[e[12]||(e[12]=l("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),$.isMyTask?_("",!0):(o(),d("div",he,[l("button",{onClick:e[0]||(e[0]=s=>H("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),l("div",Le,[l("div",$e,[$.isMyTask?_("",!0):(o(),d(R,{key:0},[l("div",Se,[h(_e,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),options:((a=r(A))==null?void 0:a.companies)||[],label:"name",id:"id",class:"border-2 border-gray-300 rounded h-[40px] w-full md:w-48 bg-white text-sm",clearable:""},{"selected-option":E(({option:s})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:s==null?void 0:s.name},[s!=null&&s.name?(o(),d("span",Ee,z(s==null?void 0:s.name),1)):(o(),d("span",Be,"--Select Company--"))],8,De)]),_:1},8,["modelValue","options"]),e[13]||(e[13]=l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),h(ae,{modelValue:L.value,"onUpdate:modelValue":e[2]||(e[2]=s=>L.value=s),companies:Q.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300"},defaultOption:"--ALL DEPARTMENT--"},{label:E(()=>e[14]||(e[14]=[l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),r(T).name!=="MyTaskList"?(o(),S(ae,{key:0,modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=s=>V.value=s),companies:Q.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300  "},defaultOption:"--ALL DEPARTMENT--"},{label:E(()=>e[15]||(e[15]=[l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):_("",!0),r(i).isAdminMood&&((C=(t=r(i))==null?void 0:t.user)==null?void 0:C.role)!=="employee"?(o(),d("div",Oe,[l("div",Pe,[h(Ce,{employees:B.value,modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),class:"border-2 border-gray-300 rounded h-[40px] w-full bg-white !text-sm"},null,8,["employees","modelValue"]),e[16]||(e[16]=l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))]),e[17]||(e[17]=l("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):_("",!0)],64)),l("div",Fe,[e[19]||(e[19]=l("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),j(l("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>p.value=s),class:"h-full text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[18]||(e[18]=[l("option",{value:""},"--ALL TASKS--",-1),l("option",{value:"not-completed"},"Not Completed",-1),l("option",{value:"only-completed"},"Completed",-1)]),512),[[ke,p.value]])]),l("div",Ne,[l("label",je,[j(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>b.value=s)},null,512),[[Y,b.value]]),e[20]||(e[20]=l("span",null,"Important",-1))]),l("label",ze,[j(l("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>v.value=s)},null,512),[[Y,v.value]]),e[21]||(e[21]=l("span",null,"Urgent",-1))]),l("label",Re,[j(l("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>D.value=s)},null,512),[[Y,D.value]]),e[22]||(e[22]=l("span",null,"Is Target",-1))])]),l("div",He,[e[23]||(e[23]=l("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),j(l("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=s=>n.value=s),type:"month",class:"h-10 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[fe,n.value]])])]),$.isMyTask?(o(),S(oe,{key:0,modelValue:I.value,"onUpdate:modelValue":e[10]||(e[10]=s=>I.value=s),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):_("",!0)])]),l("div",We,[$.isMyTask?_("",!0):(o(),S(oe,{key:0,modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=s=>I.value=s),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),l("div",Ge,[(o(!0),d(R,null,J(K.value,s=>(o(),d("div",{key:s.label||s.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[l("div",null,[s.label?(o(),d("span",Ke,z(s.label)+": ",1)):_("",!0),Z(z(s.value),1)]),l("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:ge(s.onCancel,["prevent"])},e[24]||(e[24]=[l("i",{class:"fas fa-times-circle"},null,-1)]),8,Qe)]))),128))]),$.isMyTask?_("",!0):(o(),d("div",Je,[h(M,{class:se(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((f=r(T).query)==null?void 0:f.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...r(T).query,view:"userwise"}}},{default:E(()=>e[25]||(e[25]=[Z(" User Wise List ")])),_:1,__:[25]},8,["class","to"]),h(M,{class:se(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((q=r(T).query)==null?void 0:q.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((y=r(T))==null?void 0:y.query)||{}).filter(s=>{var U;return((U=r(T))==null?void 0:U.query[s])!=="userwise"}).reduce((s,U)=>({...s,[U]:r(T).query[U]}),{})}}},{default:E(()=>e[26]||(e[26]=[Z(" TaskWise List ")])),_:1,__:[26]},8,["class","to"])]))])])}}},Ye={class:"w-full"},Ze={class:"w-full table-fixed bg-white rounded-md"},et={class:"border rounded-md align-top bg-blue-50"},tt={key:0,class:"sticky top-16 py-2 px-2 z-40 bg-blue-100/70"},st={class:"space-y-4 mt-4"},lt={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup($,{emit:w}){const m=$,i=te(),T=w,c=g(()=>m.tasks.reduce((u,n)=>(u.push(...n.users.filter(p=>!u.find(b=>b.id==p.id&&p.id))),u),[]).filter(u=>m.selectedUserId?u.id==m.selectedUserId:!0)),L=u=>{const p=m.tasks.filter(b=>b.users.some(v=>v.id===u));return ie(p,{...i.query,"user-ids":u})},V=g(()=>c.value.map(u=>{const n=L(u.id);return{...u,tasks:n}}));return(u,n)=>(o(),d("div",Ye,[l("table",Ze,[l("tbody",null,[(o(!0),d(R,null,J(V.value,p=>{var b;return o(),d("tr",{key:p.id},[l("td",et,[l("div",null,[((b=p.tasks)==null?void 0:b.length)>0?(o(),d("div",tt,[h(Me,{user:p,class:""},null,8,["user"])])):_("",!0),l("div",st,[(o(!0),d(R,null,J(p.tasks,(v,D)=>(o(),S(de,{key:v.id,task:v,class:"!border-0",index:D,isMyTask:$.isMyTask,onCommentButtonClick:n[0]||(n[0]=I=>T("commentButtonClick",u.item.id)),onEditClick:n[1]||(n[1]=I=>T("editClick",I)),onAddClick:n[2]||(n[2]=I=>T("addClick",I)),onEmployeeAssignClick:n[3]||(n[3]=I=>T("employeeAssignClick",I))},null,8,["task","index","isMyTask"]))),128))])])])])}),128))])])]))}},at={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},ot={class:"mb-4"},nt={class:"relative min-h-[26vh]"},rt={key:0,class:"text-center py-4 text-red-500"},it={key:1},dt={class:"flex items-stretched"},ut={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},mt=1,Ht={__name:"TaskList",setup($){const w=Ae(),m=ne(),i=te(),T=be(),c=P(""),L=P(!1),V=P(null),u=g(()=>{var a;return((a=m==null?void 0:m.user)==null?void 0:a.role)==="employee"||!(m!=null&&m.isAdminMood)?!0:!!i.query["user-ids"]}),n=P(null),p=P(!1),b=le({parentId:0,requirementId:0}),v=le({taskId:0,isOpen:!1}),D=P(null),I=P([]),{handleItemsPriorityUpdate:H,saveTaskPriority:A,listHasRearranged:B}=Ve(()=>w.taskListTree,0);re(async()=>{console.log("Task List Mounted"),c.value="loading",i.query.status||T.push({query:{...i.query,status:"not-completed"}}),await O()});let x;async function O(){let a;x=new AbortController,console.log({taskAbortController:x}),i.name==="MyTaskList"?a=await w.fetchMyTasks({...i.query,page:1},{signal:x.signal}):a=await w.fetchTasks({...i.query,page:1},{signal:x.signal}),c.value="",I.value=a.query_log||[]}const N=a=>{p.value=!0,b.parentId=a},W=a=>{v.taskId=a,v.isOpen=!0},G=a=>{V.value=a,L.value=!0},F=()=>{L.value=!1,V.value=null};async function K(){n.value=null,p.value=!1,b.parentId=0,c.value="loading",await O()}async function Q(){p.value=!1,b.parentId=0,await O()}async function k(){c.value="loading",await A()&&await O()}ee(()=>({...i.query}),async()=>{try{w.resetTaskList(),c.value="loading",await O()}catch{console.warn("...")}});const e=g({get(){return{...i.query}},set(a){localStorage.removeItem("sub_task_opened_list"),T.push({query:{...a}})}}),M=g(()=>{var t;const a={...i.query};return i.name=="MyTaskList"&&(a["user-ids"]=(t=m==null?void 0:m.user)==null?void 0:t.id),Array.isArray(w.tasks)?ie(w.tasks,a):[]});return xe(()=>{w.tasks.value=null,x&&x.abort()}),(a,t)=>{var C,f,q;return o(),d("div",at,[n.value?(o(),S(X,{key:0},{default:E(()=>[h(ce,{taskId:n.value,onClose:t[0]||(t[0]=y=>n.value=null),onUpdated:K},null,8,["taskId"])]),_:1})):_("",!0),p.value?(o(),S(X,{key:1},{default:E(()=>[h(ye,{parentTaskId:b.parentId,requirementId:b.requirementId,onClose:Q,onTaskCreated:K},null,8,["parentTaskId","requirementId"])]),_:1})):_("",!0),v.isOpen?(o(),S(X,{key:2,class:"*:max-w-4xl"},{default:E(()=>[h(Ie,{taskId:v.taskId,onCancelClick:t[1]||(t[1]=()=>{v.isOpen=!1,v.taskId=0}),onSuccess:t[2]||(t[2]=()=>{v.isOpen=!1,v.taskId=0,c.value="loading",O()})},null,8,["taskId"])]),_:1})):_("",!0),h(Xe,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=y=>e.value=y),onClickAddTask:N,onClickPrioritySave:k,onClickPriorityDiscard:t[4]||(t[4]=()=>r(B)?D.value.resetItems:null),"list-has-rearranged":r(B),isMyTask:r(i).name==="MyTaskList"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((f=(C=r(i))==null?void 0:C.query)==null?void 0:f["query-log"])=="true"?(o(!0),d(R,{key:3},J(I.value,(y,s)=>(o(),d("div",{key:s,class:"text-xs text-gray-500"},[l("div",ot,z(y.raw_query),1)]))),128)):_("",!0),l("div",nt,[r(w).error?(o(),d("div",rt,z(r(w).error),1)):r(w).tasks.length>0?(o(),d("div",it,[((q=r(i).query)==null?void 0:q.view)=="userwise"?(o(),S(lt,{key:0,tasks:M.value,selectedUserId:r(i).query["user-ids"],isMyTask:r(i).name==="MyTaskList",onCommentButtonClick:t[5]||(t[5]=y=>G(y,a.task.id)),onEditClick:t[6]||(t[6]=y=>n.value=y),onAddClick:t[7]||(t[7]=y=>N(y)),onEmployeeAssignClick:t[8]||(t[8]=y=>W(y))},null,8,["tasks","selectedUserId","isMyTask"])):(o(),S(me,{key:1,items:M.value,handle:"handle",onItemsUpdate:r(H),class:"space-y-6",ref_key:"draggableTaskList",ref:D},{item:E(({item:y,index:s})=>[l("div",dt,[h(de,{isMyTask:r(i).name==="MyTaskList",task:y,index:s,showDraggableHandle:!u.value,onCommentButtonClick:t[9]||(t[9]=U=>G(U,a.task.id)),onEditClick:t[10]||(t[10]=U=>n.value=U),onAddClick:t[11]||(t[11]=U=>N(U)),onEmployeeAssignClick:t[12]||(t[12]=U=>W(U)),class:"!border-0 shadow hover:shadow-md"},null,8,["isMyTask","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):c.value!=="loading"?(o(),d("div",ut," No tasks found. ")):_("",!0),c.value==="loading"?(o(),S(pe,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):_("",!0)]),h(ue,{show:L.value,"commentable-id":V.value,"commentable-type":"task","user-id":mt,"on-close":F,onSubmitted:r(w).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Ht as default};
