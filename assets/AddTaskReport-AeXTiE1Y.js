import{f as j,g as q,r as d,u as H,h as L,x as A,q as z,c as n,o as u,a as s,b as i,w as M,n as k,t as v,l as g,d as V,H as G,F as x,e as F,v as N}from"./index-Co0Xcbt-.js";import{R as $}from"./RequiredIcon-YWmg4mnc.js";import{u as J}from"./useTaskReportStore-ChQjQBNr.js";import{u as K}from"./useTaskStore-jgwjYJer.js";import"./requirement-A3C1Ccbk.js";const O={class:"mt-6"},P={class:"max-w-xl w-full mx-auto bg-white border p-4 rounded-md shadow"},Q={key:0,class:"w-full flex items-center justify-center h-40 text-red-500 text-xl text-center"},W={key:0,class:"col-span-full"},X={class:"font-semibold"},Z={key:1,class:"col-span-full"},tt={class:"block text-gray-600 text-sm mb-1 font-medium"},st=["value"],et={class:"col-span-full"},ot={class:"col-span-2"},lt={for:"report_date",class:"block text-gray-600 text-sm mb-1 font-medium"},at={class:"flex justify-between items-center col-span-full"},rt={class:"col-span-full text-red-800 font-semibold"},ft={__name:"AddTaskReport",setup(nt){const B=j(),y=J(),o=K(),h=q(),C=B.params.id,f=d(""),w=d(0),m=d(U()),S=d(0),E=d(0),p=d(""),b=d(""),R=H();L(async()=>{await o.fetchTask(C),o.task.children_task_count==0&&(b.value=o.task.status)});function T(e,t=[]){const r=[];for(const l of e){const a=[...t,l.title];l.children_tasks.length===0?l.users.some(c=>{var D;return c.id==((D=h.user)==null?void 0:D.id)})&&r.push({id:l.id,title:l.title,status:l.status,task_parents:t,user_ids:l.users.map(c=>c.id)}):r.push(...T(l.children_tasks,a))}return r}const _=A(()=>o.task.children_task_count>0?T(o.tasks):[]),I=async()=>{var r;const e=w.value*60+S.value,t={c_length:o.task.children_task_count,task_id:o.task.children_task_count>0?p.value:(r=o.task)==null?void 0:r.id,title:f.value,report_date:m.value,progress:E.value,status:b.value,duration:e};console.log({payload:t});try{await y.createTaskReport(t),f.value="",m.value="",w.value=0,S.value=0,R.back()}catch(l){console.error("Error submitting report:",l)}};function U(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}z(()=>p.value,function(){const e=_.value.find(t=>t.id==p.value);console.log({selectedTask:e}),e&&(b.value=e.status)});const Y=A(()=>{var e;return o.task.children_task_count>0&&_.value.length>0||o.task.children_task_count===0&&(((e=o.task)==null?void 0:e.users)||[]).some(t=>{var r;return t.id==((r=h.user)==null?void 0:r.id)})});return(e,t)=>{var r,l;return u(),n("div",O,[s("div",P,[Y.value?(u(),n("form",{key:1,onSubmit:M(I,["prevent"]),class:"grid gap-x-4 gap-y-6 grid-cols-4"},[t[12]||(t[12]=s("h2",{class:"text-2xl font-bold col-span-full border-b pb-1"},"Add Report",-1)),k(o).task.children_task_count===0?(u(),n("div",W,[t[5]||(t[5]=i(" Add Report on ")),s("span",X,v((r=k(o).task)==null?void 0:r.title),1),t[6]||(t[6]=s("hr",{class:"mt-1"},null,-1))])):(u(),n("div",Z,[s("label",tt,[t[7]||(t[7]=i(" Task ")),V($)]),g(s("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a)},[t[8]||(t[8]=s("option",{value:""},"--select---",-1)),(u(!0),n(x,null,F(_.value,a=>(u(),n("option",{key:a.id,class:"w-full",value:a.id},[i(v(a.title)+" ",1),(u(!0),n(x,null,F(a.task_parents,c=>(u(),n(x,{key:c},[i(" â†µ "+v(c),1)],64))),128))],8,st))),128))],512),[[G,p.value]])])),s("div",et,[t[9]||(t[9]=s("label",{for:"title",class:"block text-gray-600 text-sm mb-1 font-medium"},"Report Title",-1)),g(s("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),type:"text",class:"border rounded p-2 w-full",placeholder:"Enter report title"},null,512),[[N,f.value]])]),s("div",ot,[s("label",lt,[t[10]||(t[10]=i(" Report Date ")),V($)]),g(s("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>m.value=a),id:"report_date",type:"date",class:"border rounded p-2 w-full"},null,512),[[N,m.value]])]),t[13]||(t[13]=s("hr",{class:"col-span-full border-dashed"},null,-1)),s("div",at,[t[11]||(t[11]=s("button",{type:"submit",class:"btn-2"},"Submit",-1)),s("div",rt,v((l=k(y))==null?void 0:l.error),1),s("button",{class:"btn-3",onClick:t[3]||(t[3]=M(a=>k(R).back(),["prevent"]))},"Cancel")])],32)):(u(),n("div",Q,t[4]||(t[4]=[i(" You Are Not Assigned to this task. "),s("br",null,null,-1),i("You cannot add a report. ")])))])])}}};export{ft as default};
