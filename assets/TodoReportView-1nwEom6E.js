import{G as ee,x as N,q as v,c as l,o as i,a,N as X,w as te,s as C,d as ae,k as Z,v as G,f as se,u as re,h as oe,l as q,b as le,j as D,t as u,m as S,F as w,e as k}from"./index-DUG-Uvq3.js";import{_ as ie}from"./EmployeeFilter-BgQEC6LF.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as ye,b as $}from"./datetime-BEfC2TVK.js";import{u as me}from"./useTodoDateStore-B9OnJrdI.js";import"./company-DReT6JAr.js";import"./department-DNhJ0JwG.js";import"./EmployeeDropdownInput-BvA1wJrx.js";import"./SelectDropdown-BQ695BpH.js";import"./UserChip-CFRgW0dG.js";import"./url-CePbr-gY.js";const ce={class:"px-4 py-3 bg-gray-50"},ue={class:"flex flex-wrap items-end gap-3"},ge=["disabled"],xe={class:"print-hide"},fe={class:"flex flex-wrap items-end gap-3 flex-1 print-hide"},_e={class:"flex items-end gap-3"},Ie={class:"relative w-[150px] sm:w-[170px]"},be={class:"relative w-[150px] sm:w-[170px]"},De={__name:"TodoReportHeading",props:{loading:{type:Boolean,default:!1},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},employeeId:{type:[String,Number],default:""},lineType:{type:String,default:"all"},startDate:{type:String,default:""},endDate:{type:String,default:""}},emits:["reloadClick","change"],setup(I,{emit:c}){const d=I,g=c,n=ee({companyId:String(d.companyId||""),departmentId:d.departmentId!==""&&d.departmentId!=null?String(d.departmentId):"",employeeId:String(d.employeeId||""),lineType:d.lineType||"all",startDate:d.startDate||"",endDate:d.endDate||""}),e=N(()=>({companyId:n.companyId,departmentId:n.departmentId,employeeId:n.employeeId,lineType:n.lineType,startDate:n.startDate,endDate:n.endDate}));function h(){g("change",{...e.value})}return v(()=>[d.companyId,d.departmentId,d.employeeId,d.lineType,d.startDate,d.endDate],()=>{n.companyId=String(d.companyId||""),n.departmentId=d.departmentId!==""&&d.departmentId!=null?String(d.departmentId):"",n.employeeId=String(d.employeeId||""),n.lineType=d.lineType||"all",n.startDate=d.startDate||"",n.endDate=d.endDate||""}),v(e,h,{deep:!0}),(b,o)=>(i(),l("div",ce,[a("div",ue,[X(b.$slots,"before",{},void 0,!0),a("button",{class:C(["px-2 py-2 disabled:text-gray-300 border size-[32px] flex items-center justify-center rounded-full print-hide",{"animate-spin !bg-opacity-0":I.loading}]),onClick:o[0]||(o[0]=te(y=>g("reloadClick"),["prevent"])),disabled:I.loading,title:"Reload"},[a("i",{class:C(["fas fa-redo",[I.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,ge),a("span",xe,[X(b.$slots,"after",{},void 0,!0)]),a("div",fe,[ae(ie,{company_id:n.companyId,"onUpdate:company_id":o[1]||(o[1]=y=>n.companyId=y),department_id:n.departmentId,"onUpdate:department_id":o[2]||(o[2]=y=>n.departmentId=y),employee_id:n.employeeId,"onUpdate:employee_id":o[3]||(o[3]=y=>n.employeeId=y),line_type:n.lineType,"onUpdate:line_type":o[4]||(o[4]=y=>n.lineType=y),"with-type":!0,class:"!grid-cols-1 sm:!grid-cols-2 lg:!grid-cols-4 xl:!grid-cols-5 flex-1"},null,8,["company_id","department_id","employee_id","line_type"]),a("div",_e,[a("div",Ie,[o[7]||(o[7]=a("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Start Date",-1)),Z(a("input",{type:"date","onUpdate:modelValue":o[5]||(o[5]=y=>n.startDate=y),class:"border-2 border-gray-300 rounded px-3 py-2 text-sm w-full bg-white"},null,512),[[G,n.startDate]])]),a("div",be,[o[8]||(o[8]=a("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"End Date",-1)),Z(a("input",{type:"date","onUpdate:modelValue":o[6]||(o[6]=y=>n.endDate=y),class:"border-2 border-gray-300 rounded px-3 py-2 text-sm w-full bg-white"},null,512),[[G,n.endDate]])])])])])]))}},we=pe(De,[["__scopeId","data-v-344ab059"]]),he={class:"container mx-auto px-4 py-6"},ve={key:0,class:"text-xs text-gray-500"},Te={key:0,class:"text-center text-gray-500 py-12"},Se={key:1,class:"text-center text-gray-500 py-8"},ke={key:2,class:"text-center text-gray-500 py-12"},$e={key:3,class:"overflow-x-auto bg-white border rounded-md shadow-sm"},Ne={class:"min-w-full text-left text-sm"},Ce={class:"divide-y divide-gray-100"},Re=["rowspan"],Ue={key:0,class:"text-xs text-gray-500"},Ve={key:1,class:"text-[11px] text-gray-400"},Ee=["rowspan"],Me={class:"px-4 py-3 text-gray-800"},Oe={class:"font-medium"},Be={class:"text-xs text-gray-500"},je={class:"px-4 py-3"},Xe={__name:"TodoReportView",setup(I){var R,U,V,E,M,O;const c=se(),d=re(),g=me(),n=ye(new Date),e=ee({companyId:((R=c.query)==null?void 0:R.company_id)||"",departmentId:((U=c.query)==null?void 0:U.department_id)||"",employeeId:((V=c.query)==null?void 0:V.employee_id)||"",lineType:((E=c.query)==null?void 0:E.line_type)||"all",startDate:((M=c.query)==null?void 0:M.start_date)||n,endDate:((O=c.query)==null?void 0:O.end_date)||n}),h=N(()=>{const t={};return g.todo_dates.forEach(r=>{var p;const s=((p=r.user)==null?void 0:p.id)||`unknown-${r.id}`,m=r.date||"unknown-date";t[s]||(t[s]={user:r.user,dates:{}}),t[s].dates[m]||(t[s].dates[m]={date:m,todos:[]}),t[s].dates[m].todos.push(r)}),Object.values(t).map(r=>{const s=Object.values(r.dates).map(p=>({...p,rowSpan:p.todos.length})).sort((p,x)=>new Date(p.date)-new Date(x.date)),m=s.reduce((p,x)=>p+x.rowSpan,0);return{user:r.user,dates:s,rowSpan:m}}).sort((r,s)=>{var m,p;return(((m=r.user)==null?void 0:m.name)||"").localeCompare(((p=s.user)==null?void 0:p.name)||"")})}),b=N(()=>{if(!e.startDate||!e.endDate)return"";const t=$(e.startDate,{weekDay:"long"}),r=$(e.endDate,{weekDay:"long"});return`${t} ~ ${r}`}),o=t=>t==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":t==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":t==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200";function y(){d.replace({query:{...c.query,company_id:e.companyId||void 0,department_id:e.departmentId||void 0,employee_id:e.employeeId||void 0,line_type:e.lineType||void 0,start_date:e.startDate||void 0,end_date:e.endDate||void 0}})}async function T(){!e.companyId||!e.startDate||!e.endDate||await g.fetchTodoDates({"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate})}function ne(t){e.companyId=t.companyId||"",e.departmentId=t.departmentId||"",e.employeeId=t.employeeId||"",e.lineType=t.lineType||"all",e.startDate=t.startDate||"",e.endDate=t.endDate||""}function de(){window.print()}return v(()=>({...e}),(t,r)=>{JSON.stringify(t)!==JSON.stringify(r)&&(y(),T())},{deep:!0}),v(()=>c.query,t=>{e.companyId=(t==null?void 0:t.company_id)||e.companyId,e.departmentId=(t==null?void 0:t.department_id)||e.departmentId,e.employeeId=(t==null?void 0:t.employee_id)||e.employeeId,e.lineType=(t==null?void 0:t.line_type)||e.lineType,e.startDate=(t==null?void 0:t.start_date)||e.startDate,e.endDate=(t==null?void 0:t.end_date)||e.endDate}),oe(()=>{T()}),(t,r)=>(i(),l("div",he,[ae(we,{"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate,loading:S(g).loading,class:"mb-6",onChange:ne,onReloadClick:T},{before:q(()=>[a("div",null,[r[0]||(r[0]=a("h1",{class:"text-xl font-semibold text-gray-800"},"Todo Report",-1)),b.value?(i(),l("p",ve,"Showing "+u(b.value),1)):D("",!0)])]),after:q(()=>[a("button",{type:"button",class:"border px-3 py-2 rounded text-sm text-gray-700 bg-white hover:bg-gray-100",onClick:te(de,["prevent"])},r[1]||(r[1]=[a("i",{class:"fas fa-print mr-1"},null,-1),le(" Print ")]))]),_:1},8,["company-id","department-id","employee-id","line-type","start-date","end-date","loading"]),!e.companyId||!e.startDate||!e.endDate?(i(),l("div",Te," Select company and date range to view the report. ")):S(g).loading?(i(),l("div",Se," Loading report... ")):h.value.length===0?(i(),l("div",ke," No todos found for this date. ")):(i(),l("div",$e,[a("table",Ne,[r[2]||(r[2]=a("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[a("tr",null,[a("th",{class:"px-4 py-3"},"Name"),a("th",{class:"px-4 py-3"},"Date"),a("th",{class:"px-4 py-3"},"Todo"),a("th",{class:"px-4 py-3"},"Status")])],-1)),a("tbody",Ce,[(i(!0),l(w,null,k(h.value,s=>{var m,p,x;return i(),l(w,{key:((m=s.user)==null?void 0:m.id)||(((x=(p=s.dates[0])==null?void 0:p.todos[0])==null?void 0:x.id)??Math.random())},[(i(!0),l(w,null,k(s.dates,f=>{var B;return i(),l(w,{key:`${((B=s.user)==null?void 0:B.id)||"u"}-${f.date}`},[(i(!0),l(w,null,k(f.todos,(_,j)=>{var z,F,P,L,H,J,K,A,Q,W,Y;return i(),l("tr",{key:_.id,class:"hover:bg-gray-50"},[f===s.dates[0]&&j===0?(i(),l("td",{key:0,rowspan:s.rowSpan,class:"px-4 py-3 align-top font-medium text-gray-800 whitespace-nowrap"},[a("div",null,u(((z=s.user)==null?void 0:z.name)||"Unknown user"),1),(P=(F=s.user)==null?void 0:F.department)!=null&&P.name?(i(),l("div",Ue,u((H=(L=s.user)==null?void 0:L.department)==null?void 0:H.name),1)):D("",!0),(K=(J=s.user)==null?void 0:J.company)!=null&&K.name?(i(),l("div",Ve,u((Q=(A=s.user)==null?void 0:A.company)==null?void 0:Q.name),1)):D("",!0)],8,Re)):D("",!0),j===0?(i(),l("td",{key:1,rowspan:f.rowSpan,class:"px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap"},u(S($)(f.date)||f.date||"-"),9,Ee)):D("",!0),a("td",Me,[a("div",Oe,u(_.title),1),a("div",Be,u(((W=_.todoable)==null?void 0:W.title)||((Y=_.todoable_type)==null?void 0:Y.split("\\").pop())||""),1)]),a("td",je,[a("span",{class:C(["text-xs font-semibold px-2.5 py-1 rounded-full",o(_.status)])},u(_.status||"N/A"),3)])])}),128))],64)}),128))],64)}),128))])])]))]))}};export{Xe as default};
