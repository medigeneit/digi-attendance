import{D as Y,r as $,E as H,q as B,h as G,c as _,k as J,o as p,a as e,t as a,w as Z,d as T,l as K,v as Q,n as A,F as R,e as z,A as W,u as ee,x as I,R as te,S as se,O as oe}from"./index-DGmPUdou.js";import{_ as P}from"./MultiselectDropdown-Bk5aU0gQ.js";import{u as re}from"./department-n0LjhjOS.js";import{u as ne}from"./user-BRI8BXWx.js";import{_ as le}from"./DeleteModal-D-Cs3oVS.js";import{_ as de}from"./HeaderWithButtons-6QK69_1W.js";import{L as ae}from"./LoaderView-Bj3MfTwY.js";import{u as ie}from"./leave-approval-Ax_ODKwE.js";const ue={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},ce={class:"bg-white rounded-lg shadow-lg w-full max-w-lg"},_e={class:"px-6 py-4 border-b"},pe={class:"text-lg font-bold capitalize"},me={class:"flex justify-end space-x-4"},ye={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"},be={__name:"LeaveApprovalModal",props:{show:{type:Boolean,required:!0},leaveApproval:{type:Object,default:null},approvalType:{type:String,default:"leave"}},emits:["close","save"],setup(L,{emit:q}){const u=L,h=q,x=ne(),N=re(),{departments:j}=Y(N),m=$(!1),c=$(null),i=H({id:null,name:"",department_id:null,in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null,type:u.approvalType}),f=H({in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null}),M=()=>{Object.keys(f).forEach(o=>{f[o]=x.users.find(d=>d.id===i[o])||null})};Object.keys(f).forEach(o=>{B(()=>f[o],d=>{i[o]=d?d.id:null})});const V=()=>{Object.assign(i,{id:null,name:"",department_id:null,in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null,type:u.approvalType}),Object.assign(f,{in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null}),c.value=null,m.value=!1},S=async()=>{var y,v;await W();const o=i.department_id||((y=u.leaveApproval)==null?void 0:y.department_id)||null;if(!o){c.value=null;return}const d=(j.value||[]).find(E=>E.id===o);c.value=d||((v=u.leaveApproval)==null?void 0:v.department)||null};B(()=>u.leaveApproval,async o=>{var d;o?(m.value=!0,Object.assign(i,{id:o.id??null,name:o.name??"",department_id:o.department_id??((d=o.department)==null?void 0:d.id)??null,in_charge_user_id:o.in_charge_user_id??null,coordinator_user_id:o.coordinator_user_id??null,operational_admin_user_id:o.operational_admin_user_id??null,recommend_by_user_id:o.recommend_by_user_id??null,approved_by_user_id:o.approved_by_user_id??null,type:o.type??u.approvalType}),M(),await S()):V()},{immediate:!0}),B(()=>c.value,o=>{i.department_id=(o==null?void 0:o.id)||null}),B(()=>j.value,async()=>{u.leaveApproval&&await S()},{deep:!0});const F=()=>{if(!i.name||!i.approved_by_user_id){alert("Name and Approved By are required!");return}h("save",{...i,type:i.type||u.approvalType}),D()};B(()=>u.approvalType,o=>{u.leaveApproval||(i.type=o)});const D=()=>{V(),h("close")};return G(async()=>{await Promise.all([x.fetchUsers(),N.fetchDepartments()]),await S()}),(o,d)=>L.show?(p(),_("div",ue,[e("div",ce,[e("div",_e,[e("h3",pe,a(m.value?"Edit":"Add")+" "+a(L.approvalType)+" Approval ",1)]),e("form",{onSubmit:Z(F,["prevent"]),class:"p-6 space-y-4"},[e("div",null,[d[2]||(d[2]=e("label",{for:"name",class:"block text-sm font-medium"},"Approval Name",-1)),K(e("input",{id:"name","onUpdate:modelValue":d[0]||(d[0]=y=>i.name=y),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter approval name",required:""},null,512),[[Q,i.name]])]),T(P,{modelValue:c.value,"onUpdate:modelValue":d[1]||(d[1]=y=>c.value=y),multiple:!1,label:"name","top-label":"Select Department",options:A(j),placeholder:"Choose department"},null,8,["modelValue","options"]),(p(),_(R,null,z({in_charge_user_id:"In-Charge",coordinator_user_id:"Coordinator",operational_admin_user_id:"Operational Admin",recommend_by_user_id:"Recommend By",approved_by_user_id:"Approved By"},(y,v)=>e("div",{key:v},[T(P,{modelValue:f[v],"onUpdate:modelValue":E=>f[v]=E,multiple:!1,label:"name","top-label":`Select ${y}`,"label-prefix":"employee_id",options:A(x).users},null,8,["modelValue","onUpdate:modelValue","top-label","options"])])),64)),e("div",me,[e("button",{type:"button",onClick:D,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400"}," Cancel "),e("button",ye,a(m.value?"Update":"Create"),1)])],32)])])):J("",!0)}},ge={class:"my-container space-y-4"},fe={class:"p-3 space-y-4"},xe={class:"flex flex-col md:flex-row md:items-center gap-3"},he={class:"flex-1"},ve={class:"relative"},we={class:"flex items-center gap-2 text-sm text-gray-600"},ke={class:"space-y-2"},Ce={key:0,class:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm flex justify-center"},$e={key:1,class:"space-y-2"},Ne={class:"min-w-0"},je={class:"text-lg font-semibold text-gray-900 truncate"},Se={class:"overflow-hidden rounded-b-xl"},Te={class:"md:hidden px-4 py-4 space-y-3"},Me={class:"flex items-start justify-between gap-3"},De={class:"min-w-0"},Ee={class:"font-semibold text-gray-900 truncate"},Ue={class:"text-sm text-gray-500 truncate"},Be={class:"flex gap-2"},Le=["onClick"],Ve=["onClick"],Oe={class:"mt-3 grid grid-cols-1 gap-2 text-sm"},Re={class:"flex justify-between gap-2"},ze={class:"text-gray-900"},qe={class:"flex justify-between gap-2"},Fe={class:"text-gray-900"},Ie={class:"flex justify-between gap-2"},Ae={class:"text-gray-900"},He={class:"flex justify-between gap-2"},Pe={class:"text-gray-900"},Ge={class:"flex justify-between gap-2"},Je={class:"text-gray-900"},Ke={class:"hidden md:block"},Qe={class:"overflow-x-auto overflow-y-visible"},We={class:"min-w-full text-sm"},Xe={class:"divide-y divide-gray-100"},Ye={class:"py-3 px-4 text-gray-700"},Ze={class:"py-3 px-4 font-medium text-gray-900"},et={class:"py-3 px-4 text-gray-700"},tt={class:"py-3 px-4 text-gray-700"},st={class:"py-3 px-4 text-gray-700"},ot={class:"py-3 px-4 text-gray-700"},rt={class:"py-3 px-4 text-gray-700"},nt={class:"py-3 px-4"},lt={class:"flex justify-center gap-2"},dt=["onClick"],at=["onClick"],it={key:2,class:"bg-white rounded-xl border border-dashed border-gray-300 shadow-sm p-6 text-center"},ut={class:"text-sm text-gray-500"},xt={__name:"LeaveApprovalList",setup(L){const q=ee(),u=I(()=>q.currentRoute.value.name==="LeaveApprovalList"?"leave":"other"),h=ie(),x=te(),N=$(!1),j=$(!1),m=$(null),c=$(""),i=$(null),f=$(0),M=async()=>{await W(),f.value=i.value?Math.ceil(i.value.getBoundingClientRect().height):0},V=I(()=>{const l=c.value.trim().toLowerCase(),s=h.leaveApprovals||[];return l?s.filter(r=>{var t,b,g,w,k,C;return[r==null?void 0:r.name,(t=r==null?void 0:r.department)==null?void 0:t.name,(b=r==null?void 0:r.in_charge_user)==null?void 0:b.name,(g=r==null?void 0:r.coordinator_user)==null?void 0:g.name,(w=r==null?void 0:r.operational_admin_user)==null?void 0:w.name,(k=r==null?void 0:r.recommend_by_user)==null?void 0:k.name,(C=r==null?void 0:r.approved_by_user)==null?void 0:C.name].filter(Boolean).join(" ").toLowerCase().includes(l)}):s}),S=I(()=>{const s=(V.value||[]).reduce((n,t)=>{var g;const b=((g=t==null?void 0:t.department)==null?void 0:g.name)||"Unassigned Department";return n[b]||(n[b]=[]),n[b].push(t),n},{}),r=Object.entries(s);return r.sort((n,t)=>n[0]==="Unassigned Department"?1:t[0]==="Unassigned Department"?-1:n[0].localeCompare(t[0])),r.map(([n,t])=>({department:n,approvals:t}))}),F=()=>{m.value=null,N.value=!0},D=l=>{m.value={...l},N.value=!0},o=()=>{N.value=!1},d=l=>{m.value=l,j.value=!0},y=()=>{j.value=!1},v=async()=>{var l;if(!((l=m.value)!=null&&l.id)){x.error("Invalid leave approval selected for deletion!");return}try{await h.deleteLeaveApproval(m.value.id),x.success("Leave approval deleted successfully!")}catch(s){x.error("Failed to delete leave approval!"),console.error("Error deleting leave approval:",s)}finally{y()}},E=async l=>{l.id||(l={...l,type:u.value});const s=l.id?"updateLeaveApproval":"createLeaveApproval",r=l.id?"Leave approval updated successfully!":"Leave approval added successfully!";try{await h[s](l.id||l,l),x.success(r)}catch(n){x.error("Failed to save leave approval!"),console.error("Error saving leave approval:",n)}finally{o()}};return G(async()=>{h.fetchLeaveApprovals({type:u.value}),await M(),window.addEventListener("resize",M)}),se(()=>{window.removeEventListener("resize",M)}),(l,s)=>{var r;return p(),_("div",ge,[e("div",{ref_key:"toolbarRef",ref:i,class:"sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-gray-200"},[e("div",fe,[T(de,{title:`${u.value} Approvals`,onAdd:F},null,8,["title"]),e("div",xe,[e("div",he,[e("div",ve,[s[2]||(s[2]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"},"ðŸ”Ž",-1)),K(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>c.value=n),type:"text",placeholder:"Search by name / dept / approver...",class:"w-full pl-9 pr-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-200"},null,512),[[Q,c.value]])])]),e("div",we,[c.value?(p(),_("button",{key:0,onClick:s[1]||(s[1]=n=>c.value=""),class:"px-3 py-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-gray-700"}," Clear ")):J("",!0)])])])],512),e("div",ke,[A(h).loading?(p(),_("div",Ce,[T(ae,{class:"shadow-none"})])):S.value.length?(p(),_("div",$e,[(p(!0),_(R,null,z(S.value,n=>(p(),_("section",{key:n.department,class:"bg-white rounded-xl border border-gray-100 shadow-sm"},[e("div",{class:"sticky z-40 px-4 py-1 rounded border-b border-gray-200 bg-white/95 backdrop-blur flex flex-wrap gap-3 items-center justify-between",style:oe({top:f.value+"px"})},[e("div",Ne,[e("p",je,a(n.department),1)])],4),e("div",Se,[e("div",Te,[(p(!0),_(R,null,z(n.approvals,(t,b)=>{var g,w,k,C,U,O;return p(),_("div",{key:(t==null?void 0:t.id)??`mobile-${n.department}-${b}`,class:"bg-gray-50 rounded-xl border border-gray-100 p-4 shadow-sm"},[e("div",Me,[e("div",De,[e("div",Ee,a((t==null?void 0:t.name)||"N/A"),1),e("div",Ue,a(((g=t==null?void 0:t.department)==null?void 0:g.name)||"N/A"),1)]),e("div",Be,[e("button",{onClick:X=>D(t),class:"px-3 py-2 rounded-lg border border-blue-200 text-blue-700 hover:bg-blue-50",title:"Edit"}," âœï¸ ",8,Le),e("button",{onClick:X=>d(t),class:"px-3 py-2 rounded-lg border border-red-200 text-red-700 hover:bg-red-50",title:"Delete"}," ðŸ—‘ï¸ ",8,Ve)])]),e("div",Oe,[e("div",Re,[s[3]||(s[3]=e("span",{class:"text-gray-500"},"In-Charge",-1)),e("span",ze,a(((w=t==null?void 0:t.in_charge_user)==null?void 0:w.name)||"N/A"),1)]),e("div",qe,[s[4]||(s[4]=e("span",{class:"text-gray-500"},"Coordinator",-1)),e("span",Fe,a(((k=t==null?void 0:t.coordinator_user)==null?void 0:k.name)||"N/A"),1)]),e("div",Ie,[s[5]||(s[5]=e("span",{class:"text-gray-500"},"Operational Admin",-1)),e("span",Ae,a(((C=t==null?void 0:t.operational_admin_user)==null?void 0:C.name)||"N/A"),1)]),e("div",He,[s[6]||(s[6]=e("span",{class:"text-gray-500"},"Recommend By",-1)),e("span",Pe,a(((U=t==null?void 0:t.recommend_by_user)==null?void 0:U.name)||"N/A"),1)]),e("div",Ge,[s[7]||(s[7]=e("span",{class:"text-gray-500"},"Approved By",-1)),e("span",Je,a(((O=t==null?void 0:t.approved_by_user)==null?void 0:O.name)||"N/A"),1)])])])}),128))]),e("div",Ke,[e("div",Qe,[e("table",We,[s[9]||(s[9]=e("thead",{class:"bg-gray-50 text-gray-600 text-xs uppercase tracking-wide"},[e("tr",null,[e("th",{class:"py-3 px-4 text-left w-12"},"#"),e("th",{class:"py-3 px-4 text-left"},"Name"),e("th",{class:"py-3 px-4 text-left"},"In-Charge"),e("th",{class:"py-3 px-4 text-left"},"Coordinator"),e("th",{class:"py-3 px-4 text-left"},"Operational Admin"),e("th",{class:"py-3 px-4 text-left"},"Recommend By"),e("th",{class:"py-3 px-4 text-left"},"Approved By"),e("th",{class:"py-3 px-4 text-center w-28"},"Actions")])],-1)),e("tbody",Xe,[(p(!0),_(R,null,z(n.approvals,(t,b)=>{var g,w,k,C,U;return p(),_("tr",{key:(t==null?void 0:t.id)??`desktop-${n.department}-${b}`,class:"hover:bg-blue-50"},[e("td",Ye,a(b+1),1),e("td",Ze,a((t==null?void 0:t.name)||"N/A"),1),e("td",et,a(((g=t==null?void 0:t.in_charge_user)==null?void 0:g.name)||"N/A"),1),e("td",tt,a(((w=t==null?void 0:t.coordinator_user)==null?void 0:w.name)||"N/A"),1),e("td",st,a(((k=t==null?void 0:t.operational_admin_user)==null?void 0:k.name)||"N/A"),1),e("td",ot,a(((C=t==null?void 0:t.recommend_by_user)==null?void 0:C.name)||"N/A"),1),e("td",rt,a(((U=t==null?void 0:t.approved_by_user)==null?void 0:U.name)||"N/A"),1),e("td",nt,[e("div",lt,[e("button",{onClick:O=>D(t),class:"px-3 py-2 rounded-lg border border-blue-200 text-blue-700 hover:bg-blue-50",title:"Edit"}," âœï¸ ",8,dt),e("button",{onClick:O=>d(t),class:"px-3 py-2 rounded-lg border border-red-200 text-red-700 hover:bg-red-50",title:"Delete"},s[8]||(s[8]=[e("i",{class:"fas fa-trash"},null,-1)]),8,at)])])])}),128))])])])])])]))),128))])):(p(),_("div",it,[s[10]||(s[10]=e("div",{class:"text-3xl"},"ðŸ“­",-1)),s[11]||(s[11]=e("div",{class:"mt-2 font-semibold text-gray-900"},"No leave approvals found",-1)),e("div",ut,a(c.value?"Try adjusting your search terms.":"Add a leave approval using the + button."),1)]))]),T(be,{show:N.value,leaveApproval:m.value,approvalType:u.value,onClose:o,onSave:E},null,8,["show","leaveApproval","approvalType"]),T(le,{show:j.value,title:`Delete ${u.value} Approval`,message:`Are you sure you want to delete ${(r=m.value)==null?void 0:r.name}?`,onClose:y,onConfirm:v},null,8,["show","title","message"])])}}};export{xt as default};
