import{S as lt,r as q,q as T,h as he,x as h,y as dt,i as rt,o as c,d as A,l as V,c as p,j as w,a as e,T as Oe,t as o,F as K,e as H,b as j,k as be,H as ct,v as Be,Z as pt,A as ge,u as mt,f as _t,D as Q,G as ft,p as ut,m as S,w as J,s as z}from"./index-vfsYf8tT.js";import{_ as yt}from"./EmployeeFilter-BGTHT7K-.js";import{L as ht}from"./LoaderView-CHF2jPBx.js";import{d as Re}from"./dayjs.min-B6UenGj7.js";import{u as Ke}from"./shift-CQVO3tS8.js";import{S as bt}from"./WeekendAssignModal-Dip980Ub.js";import{C as gt}from"./CriteriaAssignModal-7EKIvrVc.js";import{u as vt}from"./company-DtFGY7nT.js";import{u as xt}from"./department-XIk8MNpZ.js";import{u as kt}from"./user-BA4PQQ21.js";import{u as wt}from"./userClearance-Cv-gJC0B.js";import"./EmployeeDropdownInput-BgvCPwi4.js";import"./SelectDropdown-BbcpwSvb.js";import"./UserChip-CIeTIAtg.js";import"./monthly-kpi-assignments-B27F4nBu.js";const Ct={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},St={class:"relative w-full max-w-xl rounded-2xl bg-white shadow-xl ring-1 ring-black/5 p-5"},zt={class:"flex items-start justify-between mb-4"},At={class:"flex items-center gap-3"},$t={class:"h-10 w-10 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center font-semibold"},qt={class:"text-base font-semibold text-gray-900"},Dt={class:"text-xs text-gray-500"},Nt={class:"flex flex-col gap-2"},Ut={class:"md:col-span-5"},It={class:"rounded-lg border bg-white p-2"},jt={class:"flex items-center justify-between mb-2"},Vt={class:"text-xs text-gray-500"},Tt={key:0,class:"text-sm text-gray-500"},Lt={key:1},Mt=["checked"],Et={class:"flex-1"},Pt={class:"flex items-center gap-2"},Wt={class:"text-sm text-gray-900"},Ot={key:0,class:"inline-flex items-center text-xs font-medium rounded-full bg-green-100 text-green-700 px-2 py-0.5"},Rt={key:1,class:"inline-flex items-center text-xs font-medium rounded-full bg-gray-100 text-gray-700 px-2 py-0.5"},Bt={class:"mt-0.5 text-xs text-gray-600"},Kt={key:0,class:"ml-2 text-gray-400"},Ht={class:"rounded-lg border bg-white p-4"},Ft={class:"grid gap-4 md:grid-cols-12"},Gt={class:"md:col-span-12"},Yt=["disabled"],Qt=["value"],Jt={key:0,class:"mt-1 text-xs text-gray-500"},Zt={class:"md:col-span-6"},Xt={class:"mt-4 flex justify-end gap-2"},en=["disabled"],tn=["disabled"],nn={key:0},sn={key:1},an={__name:"ShiftAssignmentModal",props:{modelValue:{type:Boolean,default:!1},isOpen:{type:Boolean,default:!1},employee:{type:Object,default:()=>({id:0,name:""})},shifts:{type:[Array,Object],default:()=>[]},hasShift:{type:Object,default:null},current_shift:{type:Object,default:null},shift_history:{type:[Object,Array,null],default:null}},emits:["update:modelValue","saved","close"],setup(Z,{emit:X}){var G;const m=Z,W=X,D=lt(),L=Ke(),x=q(!1);T(()=>m.modelValue,i=>{i!==x.value&&(x.value=i)}),T(()=>m.isOpen,i=>{i!==x.value&&(x.value=i)}),he(()=>{x.value=!!(m.modelValue||m.isOpen)});function g(){x.value&&(x.value=!1,W("update:modelValue",!1),W("close",!1))}const b=q({shift_id:"",employee_id:((G=m.employee)==null?void 0:G.id)||0,start_date:"",end_date:""});T(()=>m.employee,i=>{b.value.employee_id=(i==null?void 0:i.id)||0},{immediate:!0,deep:!0});const ve=h(()=>{var v,_,E,se;const i=((v=m.employee)==null?void 0:v.name)||String(((_=m.employee)==null?void 0:_.id)||""),d=i.trim().split(/\s+/);return((((E=d[0])==null?void 0:E[0])||"")+(((se=d[1])==null?void 0:se[0])||"")||i[0]||"#").toUpperCase().slice(0,2)});function I(i){return i?typeof i=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(i)?i:Re(i).isValid()?Re(i).format("YYYY-MM-DD"):"":""}const O=h(()=>{const i=m.shifts;return Array.isArray(i)?i:i&&typeof i=="object"?Object.values(i).flat().filter(Boolean):[]}),de=h(()=>{const i=m.shift_history;return i&&typeof i=="object"&&Array.isArray(i.history)?i.history:Array.isArray(i)?i:i?[i]:[]}),M=h(()=>de.value.map(i=>{var d,y;return{id:i.id??null,name:((d=i==null?void 0:i.shift)==null?void 0:d.name)||(i==null?void 0:i.name)||`#${(i==null?void 0:i.shift_id)||(i==null?void 0:i.id)||"—"}`,shift_id:((y=i==null?void 0:i.shift)==null?void 0:y.id)??(i==null?void 0:i.shift_id)??null,start_date:I(i.start_date),end_date:I(i.end_date),status:i.status||(i.end_date?"ended":"active"),days:i.days??null,active:!i.end_date||i.status==="active",created_at:i.created_at?new Date(i.created_at).getTime():0}}).sort((i,d)=>i.active!==d.active?i.active?-1:1:(d.start_date||"").localeCompare(i.start_date||""))),F=h(()=>{const i=m.shift_history;return i&&typeof i=="object"&&typeof i.count=="number"?i.count:M.value.length}),C=h(()=>{var y,v;const i=M.value.find(_=>_.active);if(i)return i;const d=m.current_shift||m.hasShift;return d?{id:d.id??null,name:((y=d==null?void 0:d.shift)==null?void 0:y.name)||(d==null?void 0:d.name)||`#${(d==null?void 0:d.shift_id)||(d==null?void 0:d.id)||"—"}`,shift_id:((v=d==null?void 0:d.shift)==null?void 0:v.id)??(d==null?void 0:d.shift_id)??null,start_date:I(d.start_date),end_date:I(d.end_date),active:!d.end_date}:null});async function ee(){const i=C.value;i?(b.value.shift_id=String(i.shift_id||""),b.value.start_date=I(i.start_date)||"",b.value.end_date=I(i.end_date)||""):(b.value.shift_id="",b.value.start_date="",b.value.end_date="")}T(x,(i,d)=>{i&&!d&&ge(ee)}),T([C,()=>m.shift_history],()=>{x.value&&ge(ee)});const a=q(!1),R=h(()=>!!b.value.employee_id&&!!b.value.shift_id&&!!b.value.start_date&&!a.value);async function te(){var i,d;try{if(!R.value){D.error("All required fields must be filled");return}a.value=!0;const y={employee_id:Number(b.value.employee_id),shift_id:Number(b.value.shift_id),start_date:b.value.start_date,end_date:b.value.end_date||null},v=await L.shiftAssign(y);D.success(C.value?"Shift updated":"Shift assigned"),W("saved",v),g()}catch(y){const v=((d=(i=y==null?void 0:y.response)==null?void 0:i.data)==null?void 0:d.message)||"Failed to assign shift";D.error(v)}finally{a.value=!1}}function ne(i){x.value&&(i.key==="Escape"&&g(),(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="enter"&&R.value&&te())}return he(()=>window.addEventListener("keydown",ne)),dt(()=>window.removeEventListener("keydown",ne)),(i,d)=>(c(),rt(pt,{to:"body"},[A(Oe,{name:"fade"},{default:V(()=>[x.value?(c(),p("div",Ct,[e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:g}),A(Oe,{name:"pop"},{default:V(()=>{var y,v;return[e("div",St,[e("div",zt,[e("div",At,[e("div",$t,o(ve.value),1),e("div",null,[e("h3",qt,o(C.value?"Update Shift":"Assign Shift"),1),e("p",Dt,o(((y=Z.employee)==null?void 0:y.name)||"#"+(((v=Z.employee)==null?void 0:v.id)||"")),1)])]),e("button",{class:"btn-icon",onClick:g,"aria-label":"Close"},"✕")]),e("div",Nt,[e("div",Ut,[e("div",It,[e("div",jt,[d[2]||(d[2]=e("h4",{class:"text-sm font-semibold text-gray-800"},"Shift history",-1)),e("span",Vt,o(F.value)+" item(s)",1)]),M.value.length?(c(),p("ul",Lt,[(c(!0),p(K,null,H(M.value,(_,E)=>(c(),p("li",{key:_.id??E,class:"flex items-start gap-3"},[e("input",{type:"checkbox",class:"mt-1 rounded border-gray-300",checked:_.active,disabled:""},null,8,Mt),e("div",Et,[e("div",Pt,[e("span",Wt,o(_.name),1),_.active?(c(),p("span",Ot,"Active")):(c(),p("span",Rt,"Closed"))]),e("div",Bt,[j(" Period: "+o(_.start_date||"—")+" → "+o(_.end_date||"present")+" ",1),_.days?(c(),p("span",Kt,"("+o(_.days)+" days)",1)):w("",!0)])])]))),128))])):(c(),p("div",Tt," No history found "))])]),e("div",Ht,[e("div",Ft,[e("div",Gt,[d[4]||(d[4]=e("label",{class:"block text-sm font-medium text-gray-700"},"Select Shift",-1)),be(e("select",{"onUpdate:modelValue":d[0]||(d[0]=_=>b.value.shift_id=_),class:"mt-1 w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",disabled:!O.value.length},[d[3]||(d[3]=e("option",{value:""},"Choose a shift…",-1)),(c(!0),p(K,null,H(O.value,_=>(c(),p("option",{key:_==null?void 0:_.id,value:_==null?void 0:_.id},o(_==null?void 0:_.name),9,Qt))),128))],8,Yt),[[ct,b.value.shift_id]]),O.value.length?w("",!0):(c(),p("p",Jt,"No shifts found"))]),e("div",Zt,[d[5]||(d[5]=e("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),be(e("input",{"onUpdate:modelValue":d[1]||(d[1]=_=>b.value.start_date=_),type:"date",class:"mt-1 w-full rounded-md border px-3 py-2"},null,512),[[Be,b.value.start_date]])])]),e("div",Xt,[e("button",{class:"btn-3",onClick:g,disabled:a.value},"Cancel",8,en),e("button",{class:"btn-2",onClick:te,disabled:!R.value},[a.value?(c(),p("span",sn,"Processing…")):(c(),p("span",nn,o(C.value?"Update":"Assign"),1))],8,tn)])])])])]}),_:1})])):w("",!0)]),_:1})]))}},on={class:"space-y-3 p-5"},ln={class:"flex items-center justify-between gap-2"},dn={class:"flex gap-3"},rn={key:0,class:"rounded-md border border-indigo-200 bg-indigo-50 p-3 text-sm text-indigo-800"},cn={class:"sticky top-14 z-40 -mx-5 px-5 py-3 bg-white/90 supports-[backdrop-filter]:bg-white/70 backdrop-blur border-b border-zinc-200"},pn={class:"flex flex-col md:flex-row md:items-end gap-2"},mn={class:"flex items-center gap-1"},_n={class:"flex items-center gap-2 w-full md:w-auto"},fn={class:"mt-2 flex flex-wrap gap-2 text-[12px]"},un={class:"px-2 py-1 rounded-full bg-zinc-100 text-zinc-700"},yn={class:"px-2 py-1 rounded-full bg-emerald-100 text-emerald-700"},hn={class:"px-2 py-1 rounded-full bg-rose-100 text-rose-700"},bn={class:"px-2 py-1 rounded-full bg-amber-100 text-amber-800"},gn={class:"px-2 py-1 rounded-full bg-zinc-100 text-zinc-700"},vn={class:"px-2 py-1 rounded-full bg-emerald-100 text-emerald-800"},xn={class:"px-2 py-1 rounded-full bg-zinc-100 text-zinc-700"},kn={key:1,class:"text-center py-6"},wn={key:2,class:"space-y-4"},Cn={key:0,class:"text-center py-6 text-lg italic text-gray-500"},Sn={class:"flex items-center justify-between"},zn={class:"title-md"},An={class:"grid grid-cols-1 gap-2 md:hidden"},$n={class:"flex items-start gap-3"},qn={class:"h-10 w-10 shrink-0 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold"},Dn={class:"min-w-0"},Nn={class:"font-medium leading-5 truncate"},Un={class:"text-[12px] text-zinc-500"},In={class:"mt-1 text-[12px] text-zinc-600"},jn={class:"text-[12px] text-zinc-600"},Vn={class:"mt-1 text-[12px]"},Tn=["href"],Ln=["href"],Mn={class:"mt-2 flex gap-1"},En=["onClick"],Pn=["onClick"],Wn=["onClick"],On=["onClick"],Rn={class:"overflow-x-auto hidden md:block"},Bn={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},Kn={class:"border border-gray-100 px-2 py-2"},Hn={class:"border border-gray-100 px-3 py-2"},Fn={class:"flex items-start gap-2"},Gn={key:0,class:"h-8 w-8 shrink-0 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold"},Yn=["src","alt"],Qn={key:1,class:"h-8 w-8 shrink-0 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold"},Jn={class:"min-w-0"},Zn={class:"font-medium truncate max-w-[220px]"},Xn={class:"text-[11px] text-zinc-500"},es={class:"text-[11px] text-zinc-500"},ts={class:"text-[11px] text-zinc-500"},ns={class:"border border-gray-100 px-2 py-2"},ss={class:"flex items-center gap-2"},is=["href"],as={class:"flex items-center gap-2"},os=["href"],ls={class:"border border-gray-100 px-2 py-2 whitespace-nowrap"},ds={class:"border border-gray-100 px-2 py-2 whitespace-nowrap"},rs={class:"border border-gray-100 px-2 py-2 whitespace-nowrap"},cs={class:"border border-gray-100 px-3 py-2 whitespace-nowrap"},ps=["onClick","title"],ms={class:"ml-1 hidden lg:inline"},_s={class:"mt-1 text-[11px] text-gray-500"},fs={class:"border border-gray-100 px-3 py-2 whitespace-nowrap"},us=["onClick","title"],ys={class:"ml-1 hidden lg:inline"},hs={class:"mt-1 text-[11px] text-gray-500"},bs={class:"border border-gray-100 px-2 py-2"},gs={class:"border border-gray-100 px-3 py-2 whitespace-nowrap"},vs=["onClick","title"],xs={class:"ml-1 hidden lg:inline"},ks={class:"border border-gray-100 px-2 py-2"},ws={class:"flex gap-2"},Cs=["onClick"],Ss={key:3,class:"fixed inset-0 z-[9999]"},zs={class:"absolute right-0 top-0 h-full w-full max-w-4xl bg-white shadow-xl overflow-y-auto"},As={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-4 py-3"},$s={key:0,class:"text-xs text-zinc-500"},qs={key:0},Ds={class:"flex items-center gap-2 print:hidden"},Ns=["disabled"],Us={class:"p-4 space-y-4"},Is={id:"print-clearance",class:"space-y-4"},js={class:"rounded-lg border border-zinc-200 bg-white p-4"},Vs={class:"text-center"},Ts={class:"text-xs text-zinc-500"},Ls={class:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm"},Ms={class:"font-medium text-zinc-900"},Es={class:"font-medium text-zinc-900"},Ps={class:"font-medium text-zinc-900"},Ws={class:"font-medium text-zinc-900"},Os={key:0,class:"rounded-md border border-zinc-200 bg-zinc-50 p-4 text-sm text-zinc-600"},Rs={key:1,class:"rounded-md border border-rose-200 bg-rose-50 p-4 text-sm text-rose-700"},Bs={key:2,class:"rounded-md border border-dashed border-zinc-300 bg-zinc-50 p-4 text-sm text-zinc-600"},Ks={key:3,class:"overflow-x-auto"},Hs={class:"min-w-full border border-zinc-300 text-[13px]",style:{"border-collapse":"collapse"}},Fs={class:"border border-zinc-300 px-2 py-1 align-top tabular-nums"},Gs=["rowspan"],Ys={class:"text-xs"},Qs={class:"border border-zinc-300 px-2 py-1"},Js={class:"font-medium text-zinc-900"},Zs={class:"text-[11px] text-zinc-600 mt-0.5"},Xs={class:"font-semibold text-zinc-700"},ei={key:0,class:"text-zinc-400"},ti={key:1,class:"ml-2 text-amber-700"},ni={class:"border border-zinc-300 px-2 py-1 text-center font-semibold"},si={class:"border border-zinc-300 px-2 py-1"},ii={class:"whitespace-pre-line"},ai={class:"border border-zinc-300 px-2 py-1"},oi={key:0,class:"text-[11px] text-zinc-500 mt-0.5"},li={class:"border border-zinc-300 px-2 py-1"},di=["title","aria-label"],ri={key:4,class:"mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm"},Si={__name:"UserList",setup(Z){const X=mt(),m=_t(),W=vt(),D=xt(),L=kt(),x=Ke(),g=wt(),{companies:b}=Q(W),{departments:ve}=Q(D),{shifts:I}=Q(x),{users:O,isLoading:de}=Q(L),{items:M,loading:F,error:C,currentUserInfo:ee}=Q(g),a=ft({company:String(m.query.company??"all"),department:String(m.query.department??"all"),line_type:String(m.query.line_type??"all"),status:String(m.query.status??"active"),employee_id:String(m.query.employee_id??""),q:String(m.query.q??"")});let R=null;const te=h(()=>{const n={};return a.company&&a.company!=="all"&&(n.company=a.company),a.department&&a.department!=="all"&&(n.department=a.department),a.line_type&&a.line_type!=="all"&&(n.line_type=a.line_type),a.status&&a.status!=="all"&&(n.status=a.status),a.employee_id&&(n.employee_id=a.employee_id),a.q&&(n.q=a.q),m.query.action&&(n.action=m.query.action),n});function ne(){clearTimeout(R),R=setTimeout(()=>{X.replace({query:{...te.value}})},250)}T(a,ne,{deep:!0}),he(async()=>{await W.fetchCompanies(),a.company&&a.company!=="all"&&await D.fetchDepartments(a.company),G()}),T(()=>m.query,()=>G(),{deep:!0});function G(){L.fetchUsers({company_id:m.query.company,department_id:m.query.department,line_type:m.query.line_type,status:m.query.status,user_id:m.query.employee_id,q:m.query.q})}T(()=>a.company,async(n,t)=>{var r;n!==t&&(n&&n!=="all"?await D.fetchDepartments(n):(r=D.$reset)==null||r.call(D))});const i=()=>X.go(-1),d=h(()=>m.query.action==="clearance"),y=n=>{var t,r;return!!((r=(t=n==null?void 0:n.current_shift)==null?void 0:t.shift)!=null&&r.name)},v=n=>{var t,r;return((r=(t=n==null?void 0:n.current_shift)==null?void 0:t.shift)==null?void 0:r.name)||"Not Assigned"},_=n=>{var t;return Array.isArray((t=n==null?void 0:n.assign_weekend)==null?void 0:t.weekends)&&n.assign_weekend.weekends.length>0},E=n=>_(n)?n.assign_weekend.weekends.join(", "):"Not Assigned",se=(n,t)=>{var l,f,u;if(!t)return!0;const r=t.toLowerCase();return[n==null?void 0:n.name,n==null?void 0:n.phone,n==null?void 0:n.employee_id,(l=n==null?void 0:n.company)==null?void 0:l.name,(f=n==null?void 0:n.department)==null?void 0:f.name,(u=n==null?void 0:n.designation)==null?void 0:u.title].some(N=>String(N||"").toLowerCase().includes(r))},He=n=>{if(a.status==="all")return!0;const t=a.status==="active"?1:0;return Number((n==null?void 0:n.is_active)??0)===t},xe=h(()=>(Array.isArray(O.value)?O.value:[]).filter(t=>{var r;return!(a.company!=="all"&&String((r=t==null?void 0:t.company)==null?void 0:r.id)!==String(a.company)||a.line_type!=="all"&&String(t==null?void 0:t.type)!==String(a.line_type)||a.employee_id&&String(t==null?void 0:t.id)!==String(a.employee_id)||!He(t)||!se(t,a.q))})),P=h(()=>{const n=xe.value,t=n.length,r=n.filter(u=>Number((u==null?void 0:u.is_active)??0)===1).length,l=n.filter(u=>y(u)).length,f=n.filter(u=>_(u)).length;return{total:t,active:r,inactive:t-r,withShift:l,withoutShift:t-l,withWeekend:f,withoutWeekend:t-f}}),ke=h(()=>{var t;const n={};for(const r of xe.value){const l=((t=r==null?void 0:r.company)==null?void 0:t.name)||"Unknown Company";(n[l]??(n[l]=[])).push(r)}return n}),$=q(null),re=q(!1),ie=h(()=>{var t;const n=ee.value;return n!=null&&n.id&&((t=$.value)!=null&&t.id)&&n.id!==$.value.id?$.value:n||$.value||{}}),ce=h(()=>{var n,t;return((n=ie.value)==null?void 0:n.name)||((t=$.value)==null?void 0:t.name)||""}),pe=h(()=>{var n,t;return((n=ie.value)==null?void 0:n.employee_id)||((t=$.value)==null?void 0:t.employee_id)||""}),Fe=h(()=>{var n,t,r,l;return((t=(n=ie.value)==null?void 0:n.department)==null?void 0:t.name)||((l=(r=$.value)==null?void 0:r.department)==null?void 0:l.name)||""}),Ge=h(()=>{var n,t,r,l,f;return((t=(n=ie.value)==null?void 0:n.designation)==null?void 0:t.title)||((l=(r=$.value)==null?void 0:r.designation)==null?void 0:l.title)||((f=$.value)==null?void 0:f.post)||""}),Ye=h(()=>new Date().toLocaleDateString("en-GB"));function Qe(n={}){const t=n.latest||null,r=(t==null?void 0:t.cleared_by)||null;return{id:n.template_item_id??n.id,template_item_id:n.template_item_id??n.id,label:n.label||n.template_item_name||n.item_key||`#${n.template_item_id??n.id}`,order_no:n.order_no??n.template_order_no??0,handover_to:n.handover_to||"departmental_incharge",handover_by:n.handover_user||"departmental_incharge",show_receiver:!!n.show_receiver,is_cleared:!!n.is_cleared,missing:!!n.missing,status:(t==null?void 0:t.status)??null,handover_status:(t==null?void 0:t.handover_status)??null,present_condition:(t==null?void 0:t.present_condition)??"",receiver_name:n.show_receiver?(t==null?void 0:t.receiver_name)??"":"",remarks:(t==null?void 0:t.remarks)??"",cleared_by_user:r?{id:r.id,name:r.name}:null,cleared_at:(t==null?void 0:t.cleared_at)||null}}const Je={departmental_incharge:"Departmental In-charge",technical_support_team:"Technical Support Team",it_incharge:"IT In-charge",hr_department:"HR Department",inventory_incharge:"Inventory In-charge"},we=["Departmental In-charge","Technical Support Team","IT In-charge","HR Department","Inventory In-charge"];function Ze(n){const t=String((n==null?void 0:n.handover_to)||"").toLowerCase();return Je[t]||"Departmental In-charge"}const Xe=h(()=>(Array.isArray(M.value)?M.value:[]).map(Qe)),me=h(()=>{var l;const n=new Map(we.map(f=>[f,[]]));for(const f of Xe.value)(l=n.get(Ze(f)))==null||l.push(f);for(const[,f]of n.entries())f.sort((u,N)=>(u.order_no??u.template_item_id??u.id??0)-(N.order_no??N.template_item_id??N.id??0));const t=[];let r=1;for(const f of we){const u=n.get(f)||[];u.length&&u.forEach((N,le)=>t.push({sl:r++,group:f,isGroupFirst:le===0,groupSpan:u.length,row:N}))}return t});function et(n){const t=String(n??"").trim().toLowerCase();return["y","yes","true","1","done","cleared","complete","completed"].includes(t)?"Yes":["n","no","false","0","pending","not done","incomplete","rejected"].includes(t)?"No":"N/A"}const Y={PENDING:{label:"Pending",pill:"bg-amber-50 text-amber-800 border-amber-200",dot:"bg-amber-500"},WORKING:{label:"Working",pill:"bg-sky-50 text-sky-800 border-sky-200",dot:"bg-sky-500"},COMPLETED:{label:"Completed",pill:"bg-emerald-50 text-emerald-800 border-emerald-200",dot:"bg-emerald-500"}};function _e(n){var r;if(n!=null&&n.missing)return"Pending";const t=String((n==null?void 0:n.status)||"").toUpperCase();return((r=Y[t])==null?void 0:r.label)||(n==null?void 0:n.status)||"N/A"}function tt(n){var r;if(n!=null&&n.missing)return Y.PENDING.pill;const t=String((n==null?void 0:n.status)||"").toUpperCase();return((r=Y[t])==null?void 0:r.pill)||"bg-slate-50 text-slate-700 border-slate-200"}function nt(n){var r;if(n!=null&&n.missing)return Y.PENDING.dot;const t=String((n==null?void 0:n.status)||"").toUpperCase();return((r=Y[t])==null?void 0:r.dot)||"bg-slate-400"}const k=q(null),fe=q(null),Ce=q(null),ae=q(!1),ue=q(!1),oe=q(!1);async function Se(n){if(k.value=n,n!=null&&n.company_id){const t=await L.fetchUserShifts(n.id);Ce.value=t,await x.fetchShifts(n.company_id)}ae.value=!0}async function ze(n){k.value=n,ue.value=!0;try{const t=await L.fetchUserWeekends(n.id);fe.value=t}catch{fe.value={history:[],current:null}}}function Ae(n){k.value=n,oe.value=!0}async function $e(n){var t,r,l;if(n!=null&&n.id){$.value=n,re.value=!0,C.value="",(t=g.resetFilters)==null||t.call(g),(r=g.setUser)==null||r.call(g,n.id);try{await((l=g.fetch)==null?void 0:l.call(g))}catch{C.value=C.value||"Failed to load clearance data"}}}function qe(){re.value=!1,$.value=null}async function st(){typeof window>"u"||!(document!=null&&document.body)||(document.body.classList.add("printing-clearance"),await ge(),window.print(),setTimeout(()=>document.body.classList.remove("printing-clearance"),0))}async function it(){await L.fetchUsersExcelExport({data:{company_id:a.company!=="all"?a.company:void 0,department_id:a.department!=="all"?a.department:void 0,line_type:a.line_type!=="all"?a.line_type:void 0,status:a.status!=="all"?a.status:void 0,employee_id:a.employee_id||void 0,q:a.q||void 0}})}function at(){oe.value=!1}function ot(){a.company="all",a.department="all",a.line_type="all",a.status="active",a.employee_id="",a.q=""}return(n,t)=>{const r=ut("RouterLink");return c(),p("div",on,[e("div",ln,[e("button",{class:"btn-3",onClick:i},t[15]||(t[15]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[18]||(t[18]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),e("div",dn,[A(r,{to:{name:"UserAdd",query:{company:S(m).query.company}},class:"btn-2"},{default:V(()=>t[16]||(t[16]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[16]},8,["to"]),e("button",{type:"button",onClick:it,class:"btn-3"},t[17]||(t[17]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),j("Excel ")]))])]),d.value?(c(),p("div",rn," Select a user to view clearance & print. ")):w("",!0),e("div",cn,[e("div",pn,[A(yt,{company_id:a.company,"onUpdate:company_id":t[3]||(t[3]=l=>a.company=l),department_id:a.department,"onUpdate:department_id":t[4]||(t[4]=l=>a.department=l),employee_id:a.employee_id,"onUpdate:employee_id":t[5]||(t[5]=l=>a.employee_id=l),line_type:a.line_type,"onUpdate:line_type":t[6]||(t[6]=l=>a.line_type=l),"with-type":!0,"initial-value":n.$route.query,class:"w-full"},{default:V(()=>[e("div",mn,[e("button",{class:z(["h-8 px-3 text-xs rounded-l-md border transition",a.status==="all"?"bg-zinc-800 text-white border-zinc-800":"bg-white border-zinc-300 hover:bg-zinc-50"]),onClick:t[0]||(t[0]=J(l=>a.status="all",["prevent"]))},"All",2),e("button",{class:z(["h-8 px-3 text-xs border-y transition",a.status==="active"?"bg-emerald-600 text-white border-emerald-600":"bg-white border-zinc-300 hover:bg-zinc-50"]),onClick:t[1]||(t[1]=J(l=>a.status="active",["prevent"]))},"Active",2),e("button",{class:z(["h-8 px-3 text-xs rounded-r-md border transition",a.status==="in_active"?"bg-rose-600 text-white border-rose-600":"bg-white border-zinc-300 hover:bg-zinc-50"]),onClick:t[2]||(t[2]=J(l=>a.status="in_active",["prevent"]))},"Inactive",2)])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),e("div",_n,[be(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>a.q=l),type:"text",placeholder:"Search name / phone / ID",class:"input-1 h-8 text-sm w-full md:w-64"},null,512),[[Be,a.q,void 0,{trim:!0}]]),e("button",{type:"button",onClick:ot,class:"inline-flex h-8 items-center rounded-md border border-zinc-300 bg-zinc-50 px-3 text-[12px] font-medium text-zinc-700 hover:bg-white active:scale-[.99]",title:"Reset filters"},t[19]||(t[19]=[e("i",{class:"far fa-undo mr-1"},null,-1),j(" Reset ")]))])]),e("div",fn,[e("span",un,"Total: "+o(P.value.total),1),e("span",yn,"Active: "+o(P.value.active),1),e("span",hn,"Inactive: "+o(P.value.inactive),1),e("span",bn,"With Shift: "+o(P.value.withShift),1),e("span",gn,"No Shift: "+o(P.value.withoutShift),1),e("span",vn,"With Weekend: "+o(P.value.withWeekend),1),e("span",xn,"No Weekend: "+o(P.value.withoutWeekend),1)])]),S(de)?(c(),p("div",kn,[A(ht)])):(c(),p("div",wn,[Object.keys(ke.value).length===0?(c(),p("div",Cn," No users found ")):w("",!0),(c(!0),p(K,null,H(ke.value,(l,f)=>{var u,N,le,De,Ne,Ue,Ie,je;return c(),p("div",{key:f,class:"space-y-2"},[e("div",Sn,[e("h2",zn,o(f)+" ("+o(l.length)+")",1)]),e("div",An,[(c(!0),p(K,null,H(l,s=>{var U;return c(),p("div",{key:s.id,class:"rounded-lg border border-zinc-200 bg-white p-3 shadow-sm"},[e("div",$n,[e("div",qn,o(((s==null?void 0:s.name)||"?").charAt(0).toUpperCase()),1),e("div",Dn,[e("div",Nn,o(s==null?void 0:s.name),1),e("div",Un,"ID: "+o(s==null?void 0:s.employee_id)+" • "+o(((U=s==null?void 0:s.designation)==null?void 0:U.title)||"—"),1),e("div",In,"Shift: "+o(v(s)),1),e("div",jn,"Weekend: "+o(E(s)),1),e("div",Vn,[e("a",{class:"underline",href:"tel:"+(s==null?void 0:s.phone),onClick:t[8]||(t[8]=J(()=>{},["stop"]))},o((s==null?void 0:s.phone)||"—"),9,Tn),t[20]||(t[20]=e("span",{class:"mx-1"},"•",-1)),e("a",{class:"underline",href:"mailto:"+((s==null?void 0:s.email)||""),onClick:t[9]||(t[9]=J(()=>{},["stop"]))},o((s==null?void 0:s.email)||"নেই"),9,Ln)]),e("div",Mn,[e("button",{class:"btn-3 !px-2 !py-1",onClick:B=>Se(s)},"Shift",8,En),e("button",{class:"btn-3 !px-2 !py-1",onClick:B=>ze(s)},"Weekend",8,Pn),e("button",{class:"btn-3 !px-2 !py-1",onClick:B=>Ae(s)},"KPI",8,Wn),e("button",{class:"btn-3 !px-2 !py-1",onClick:B=>$e(s)},"Clearance",8,On),A(r,{to:{name:"UserShow",params:{id:s.id},query:{company:S(m).query.company}},class:"btn-3 !px-2 !py-1"},{default:V(()=>t[21]||(t[21]=[j("View")])),_:2,__:[21]},1032,["to"])])])])])}),128))]),e("div",Rn,[e("table",Bn,[t[25]||(t[25]=e("thead",null,[e("tr",{class:"bg-gray-100 text-sm font-medium text-gray-700"},[e("th",{class:"border border-gray-200 px-2 py-2 text-left"},"#"),e("th",{class:"border border-gray-200 px-3 py-2 text-left"},"Name"),e("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Phone & Email"),e("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Finger ID"),e("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Joining"),e("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Role"),e("th",{class:"border border-gray-200 px-3 py-2 text-left"},"Shift"),e("th",{class:"border border-gray-200 px-3 py-2 text-left"},"Weekend"),e("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Status"),e("th",{class:"border border-gray-200 px-3 py-2 text-left"},"KPI Criteria"),e("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Action")])],-1)),e("tbody",null,[(c(!0),p(K,null,H(l,(s,U)=>{var B,Ve,Te,Le,Me,Ee,Pe,We;return c(),p("tr",{key:s.id,class:"border-b text-sm border-gray-100 hover:bg-indigo-50/50"},[e("td",Kn,o(U+1),1),e("td",Hn,[e("div",Fn,[s.photo?(c(),p("div",Gn,[e("img",{src:s.photo,alt:s==null?void 0:s.name,class:"h-8 w-8 rounded-full object-cover"},null,8,Yn)])):(c(),p("div",Qn,o(((s==null?void 0:s.name)||"?").charAt(0).toUpperCase()),1)),e("div",Jn,[e("div",Zn,o(s==null?void 0:s.name),1),e("div",Xn,o(s==null?void 0:s.bn_name),1),e("div",es,o(((B=s==null?void 0:s.designation)==null?void 0:B.title)||"—"),1),e("div",ts,"ID: "+o(s==null?void 0:s.employee_id),1)])])]),e("td",ns,[e("div",ss,[e("a",{class:"underline",href:"tel:"+(s==null?void 0:s.phone)},o((s==null?void 0:s.phone)||"—"),9,is)]),e("div",as,[e("a",{class:"underline",href:"mailto:"+((s==null?void 0:s.email)||"")},o((s==null?void 0:s.email)||"নেই"),9,os)])]),e("td",ls,o(s==null?void 0:s.device_user_id),1),e("td",ds,o(s==null?void 0:s.joining_date),1),e("td",rs,o(s==null?void 0:s.role),1),e("td",cs,[e("button",{onClick:ye=>Se(s),title:y(s)?"Manage Shift":"Assign Shift",class:z(["group inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium transition","focus:outline-none focus:ring-2 focus:ring-offset-1",y(s)?"border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-100 focus:ring-amber-300":"border-slate-200 bg-slate-50 text-slate-600 hover:bg-white focus:ring-slate-300"])},[e("span",ms,o(y(s)?"Manage":"Assign"),1),e("span",{class:z(["ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full px-1 text-[10px] font-semibold",y(s)?"bg-amber-600 text-white":"bg-slate-200 text-slate-700"])},o((s==null?void 0:s.shifts_count)||(y(s)?1:0)),3)],10,ps),e("div",_s,o(v(s)),1)]),e("td",fs,[e("button",{onClick:ye=>ze(s),title:_(s)?"Manage Weekend":"Assign Weekend",class:z(["group inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium transition","focus:outline-none focus:ring-2 focus:ring-offset-1",_(s)?"border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 focus:ring-emerald-300":"border-slate-200 bg-slate-50 text-slate-600 hover:bg-white focus:ring-slate-300"])},[e("span",ys,o(_(s)?"Manage":"Assign"),1),e("span",{class:z(["ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full px-1 text-[10px] font-semibold",_(s)?"bg-emerald-600 text-white":"bg-slate-200 text-slate-700"])},o((s==null?void 0:s.assign_weekends_count)||_(s)&&((Te=(Ve=s==null?void 0:s.assign_weekend)==null?void 0:Ve.weekends)==null?void 0:Te.length)||0),3)],10,us),e("div",hs,o(E(s)),1)]),e("td",bs,[e("span",{class:z(s!=null&&s.is_active?"text-emerald-600":"text-rose-500")},o(s!=null&&s.is_active?"Active":"Inactive"),3)]),e("td",gs,[e("button",{onClick:ye=>Ae(s),title:(((Le=s==null?void 0:s.criteria_assignments)==null?void 0:Le.length)||0)>0?"Manage KPI criteria":"Assign KPI criteria",class:z(["group inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium transition","focus:outline-none focus:ring-2 focus:ring-offset-1",(((Me=s==null?void 0:s.criteria_assignments)==null?void 0:Me.length)||0)>0?"border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 focus:ring-indigo-300":"border-slate-200 bg-slate-50 text-slate-600 hover:bg-white focus:ring-slate-300"])},[e("span",xs,o((((Ee=s==null?void 0:s.criteria_assignments)==null?void 0:Ee.length)||0)>0?"Manage":"Assign"),1),e("span",{class:z(["ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full px-1 text-[10px] font-semibold",(((Pe=s==null?void 0:s.criteria_assignments)==null?void 0:Pe.length)||0)>0?"bg-indigo-600 text-white":"bg-slate-200 text-slate-700"])},o(((We=s==null?void 0:s.criteria_assignments)==null?void 0:We.length)||0),3)],10,vs)]),e("td",ks,[e("div",ws,[A(r,{to:{name:"UserShow",params:{id:s.id},query:{company:S(m).query.company}},class:"btn-icon",title:"View"},{default:V(()=>t[22]||(t[22]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[22]},1032,["to"]),A(r,{to:{name:"UserEdit",params:{id:s.id},query:{company:S(m).query.company}},class:"btn-icon",title:"Edit"},{default:V(()=>t[23]||(t[23]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[23]},1032,["to"]),A(r,{to:{name:"KpiReview",params:{employeeId:s.id}},class:"btn-icon",title:"KPI"},{default:V(()=>t[24]||(t[24]=[j(" KPI ")])),_:2,__:[24]},1032,["to"]),e("button",{type:"button",class:"btn-1 !px-2 !py-1 !text-xs",onClick:ye=>$e(s),title:"Clearance"}," Clearance ",8,Cs)])])])}),128))])])]),A(gt,{modelValue:oe.value,"onUpdate:modelValue":t[10]||(t[10]=s=>oe.value=s),"user-id":(u=k.value)==null?void 0:u.id,"user-label":(N=k.value)==null?void 0:N.name,criteria_assignments:(le=k.value)==null?void 0:le.criteria_assignments,onAssigned:at},null,8,["modelValue","user-id","user-label","criteria_assignments"]),A(bt,{modelValue:ue.value,"onUpdate:modelValue":t[11]||(t[11]=s=>ue.value=s),"user-id":(De=k.value)==null?void 0:De.id,"user-label":(Ne=k.value)==null?void 0:Ne.name,assign_weekends:fe.value,onSaved:t[12]||(t[12]=s=>{const U=s==null?void 0:s.current;U&&k.value&&(k.value.assign_weekend={weekends:U.weekends||[],start_month:U.start_month,end_month:U.end_month})})},null,8,["modelValue","user-id","user-label","assign_weekends"]),A(an,{modelValue:ae.value,"onUpdate:modelValue":t[13]||(t[13]=s=>ae.value=s),shifts:S(I),employee:{id:(Ue=k.value)==null?void 0:Ue.id,name:(Ie=k.value)==null?void 0:Ie.name},"has-shift":(je=k.value)==null?void 0:je.current_shift,shift_history:Ce.value,onClose:t[14]||(t[14]=s=>ae.value=!1)},null,8,["modelValue","shifts","employee","has-shift","shift_history"])])}),128))])),re.value?(c(),p("div",Ss,[e("div",{class:"absolute inset-0 bg-black/40",onClick:qe}),e("div",zs,[e("div",As,[e("div",null,[t[26]||(t[26]=e("h2",{class:"text-lg font-semibold text-zinc-900"},"User Clearance",-1)),ce.value?(c(),p("p",$s,[j(" Viewing: "+o(ce.value)+" ",1),pe.value?(c(),p("span",qs," (ID: "+o(pe.value)+")",1)):w("",!0)])):w("",!0)]),e("div",Ds,[e("button",{type:"button",class:"btn-3",onClick:st,disabled:S(F)}," Print ",8,Ns),e("button",{type:"button",class:"btn-1",onClick:qe},"Close")])]),e("div",Us,[e("div",Is,[e("div",js,[e("div",Vs,[t[27]||(t[27]=e("h3",{class:"text-lg font-semibold text-zinc-900"},"Clearance Sheet",-1)),e("p",Ts,"Date: "+o(Ye.value),1)]),e("div",Ls,[e("div",null,[t[28]||(t[28]=e("span",{class:"text-zinc-500"},"Name:",-1)),e("span",Ms,o(ce.value||"N/A"),1)]),e("div",null,[t[29]||(t[29]=e("span",{class:"text-zinc-500"},"Employee ID:",-1)),e("span",Es,o(pe.value||"N/A"),1)]),e("div",null,[t[30]||(t[30]=e("span",{class:"text-zinc-500"},"Department:",-1)),e("span",Ps,o(Fe.value||"N/A"),1)]),e("div",null,[t[31]||(t[31]=e("span",{class:"text-zinc-500"},"Designation:",-1)),e("span",Ws,o(Ge.value||"N/A"),1)])])]),S(F)?(c(),p("div",Os," Loading clearance... ")):S(C)?(c(),p("div",Rs,o(S(C)),1)):me.value.length?(c(),p("div",Ks,[e("table",Hs,[t[33]||(t[33]=e("thead",null,[e("tr",{class:"bg-zinc-100 text-zinc-700"},[e("th",{class:"border border-zinc-300 px-2 py-1 text-left w-12"},"S. L."),e("th",{class:"border border-zinc-300 px-2 py-1 text-left w-[120px]"},"Handover To"),e("th",{class:"border border-zinc-300 px-2 py-1 text-left"},"Particulars"),e("th",{class:"border border-zinc-300 px-2 py-1 text-left w-[110px]"},"Handed over"),e("th",{class:"border border-zinc-300 px-2 py-1 text-left"},"Present Condition"),e("th",{class:"border border-zinc-300 px-2 py-1 text-left w-[140px]"},"Receiver Name"),e("th",{class:"border border-zinc-300 px-2 py-1 text-left w-[110px]"},"Status")])],-1)),e("tbody",null,[(c(!0),p(K,null,H(me.value,l=>{var f,u;return c(),p("tr",{key:l.row.template_item_id,class:"align-top"},[e("td",Fs,o(l.sl)+". ",1),l.isGroupFirst?(c(),p("td",{key:0,rowspan:l.groupSpan,class:"border border-zinc-300 px-2 py-1 align-top font-medium"},[e("span",Ys,o(l.group),1)],8,Gs)):w("",!0),e("td",Qs,[e("div",Js,o(l.row.label),1),e("div",Zs,[t[32]||(t[32]=j(" Cleared by: ")),e("span",Xs,o(((f=l.row.cleared_by_user)==null?void 0:f.name)||((u=l.row.cleared_by_user)!=null&&u.id?"#"+l.row.cleared_by_user.id:"N/A")),1),l.row.cleared_at?(c(),p("span",ei," ("+o(new Date(l.row.cleared_at).toLocaleString())+") ",1)):w("",!0),l.row.missing?(c(),p("span",ti,"(pending)")):w("",!0)])]),e("td",ni,o(et(l.row.handover_status)),1),e("td",si,[e("div",ii,o(l.row.present_condition||"N/A"),1)]),e("td",ai,[e("div",null,o(l.row.receiver_name||"N/A"),1),l.row.remarks?(c(),p("div",oi,o(l.row.remarks),1)):w("",!0)]),e("td",li,[e("span",{class:z(["inline-flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-xs font-medium",tt(l.row)]),title:l.row.missing?"Not cleared yet":"Status: "+_e(l.row),"aria-label":_e(l.row)},[e("span",{class:z(["h-1.5 w-1.5 rounded-full",nt(l.row)])},null,2),j(" "+o(_e(l.row)),1)],10,di)])])}),128))])])])):(c(),p("div",Bs," No clearance data found. ")),!S(F)&&!S(C)&&me.value.length?(c(),p("div",ri,t[34]||(t[34]=[e("div",{class:"pt-6 text-center border-t border-zinc-300 text-zinc-700"},"User Signature",-1),e("div",{class:"pt-6 text-center border-t border-zinc-300 text-zinc-700"},"Head of HR",-1),e("div",{class:"pt-6 text-center border-t border-zinc-300 text-zinc-700"},"Verified by ACC/CC",-1)]))):w("",!0)])])])])):w("",!0)])}}};export{Si as default};
