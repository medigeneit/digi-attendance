import{u as Q,b as Y,r as v,A as z,e as G,I,m as X,n as Z,c as f,o as d,a as t,p as S,g as b,f as V,h as O,i as J,v as ee,j as p,t as u,k as r,D as te}from"./index-Bs3LfB-o.js";import{_ as se}from"./AttendanceTable-a3zQDSnB.js";import{_ as ne}from"./EmployeeFilter-D_yTOk02.js";import{L as oe}from"./LoaderView-DWI7rqNX.js";import{S as le}from"./SelectedEmployeeCard-Bb5zKNh7.js";import{u as ae}from"./attendance-SodNHjjT.js";import{u as re}from"./user-ChxuDTqQ.js";import"./datetime-BEfC2TVK.js";import"./company-B2VMbbgk.js";import"./department--0oIb3PZ.js";import"./EmployeeDropdownInput-Bdofpc6E.js";import"./SelectDropdown-DWEV84tD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-SuhlBVHY.js";const ie={class:"px-4 space-y-4"},de={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl"},pe={class:"grid md:grid-cols-2 gap-4 text-sm mt-2"},ue={key:1,class:"card-bg p-4 gap-1"},me={class:"flex justify-between items-center"},ce={class:"px-1 pt-1 pb-0.5 overflow-hidden"},ye={class:"-mx-1 flex items-center gap-2 overflow-x-auto px-1"},fe={key:0,class:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-0.5 text-[11px] font-medium text-emerald-700 whitespace-nowrap"},xe={class:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2.5 py-0.5 text-[11px] font-medium text-amber-700 whitespace-nowrap"},ge={class:"inline-flex items-center gap-1 rounded-full border border-red-200 bg-red-50 px-2.5 py-0.5 text-[11px] font-medium text-red-700 whitespace-nowrap"},_e={class:"inline-flex items-center gap-1 rounded-full border border-sky-200 bg-sky-50 px-2.5 py-0.5 text-[11px] font-medium text-sky-700 whitespace-nowrap"},ve={class:"grid md:grid-cols-3 gap-2 mt-1"},be={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},we={class:"text-sm text-zinc-900"},ke={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},he={class:"text-sm text-zinc-900"},ze={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Se={class:"text-sm text-zinc-900"},$e={key:0},Ae={key:2,class:"space-y-4"},Ve={__name:"EmployeeAttendance",setup(Ue){const $=Q(),A=Y(),o=ae(),U=re(),x=s=>{if(!s)return"";if(typeof s=="string"){if(/^\d{4}-\d{2}$/.test(s))return s;const e=s.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(s),l=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0");return`${l}-${c}`}catch{return""}},y=A.query,i=v(x(y.date)||x(o.selectedMonth)||x(new Date)),n=v({company_id:y.company_id||"",department_id:y.department_id||"all",line_type:y.line_type||"all",employee_id:y.employee_id||""}),m=v(null);let w=null;const g=(s={})=>{w&&clearTimeout(w),w=setTimeout(()=>{const e={...A.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:i.value||"",...s};Object.keys(e).forEach(l=>{(e[l]===""||e[l]===void 0||e[l]===null)&&delete e[l]}),$.replace({query:e}).catch(()=>{})},150)},C=async s=>{if(!s){m.value=null;return}try{await U.fetchUser(s),m.value=U.user||null}catch(e){console.error("fetchUser error:",e),m.value=null}},_=v(""),k=async()=>{const s=n.value.employee_id,e=i.value;if(!s||!e)return;const l=`${s}|${e}`;if(l!==_.value){_.value=l;try{await o.getMonthlyAttendanceByShift(s,e)}catch(c){console.error("fetchAttendance error:",c),_.value=""}}};z(()=>i.value,s=>{i.value=x(s),g({date:i.value})}),z(()=>({...n.value}),()=>{g()}),z(()=>n.value.employee_id,async(s,e)=>{s&&s!==e&&(await C(s),await k()),s||(m.value=null,_.value="")}),G(async()=>{n.value.employee_id&&await C(n.value.employee_id),n.value.employee_id&&i.value&&await k(),await I(),g()});const K=()=>$.go(-1),P=()=>{g()},h=X(()=>!!n.value.employee_id);return(s,e)=>{var c,M,q,T,j,B,D,L,E,F,H,N,W,R;const l=Z("router-link");return d(),f("div",ie,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:K},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Job Card",-1)),e[7]||(e[7]=t("div",null,null,-1))]),S(ne,{company_id:n.value.company_id,"onUpdate:company_id":e[1]||(e[1]=a=>n.value.company_id=a),department_id:n.value.department_id,"onUpdate:department_id":e[2]||(e[2]=a=>n.value.department_id=a),employee_id:n.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=a=>n.value.employee_id=a),line_type:n.value.line_type,"onUpdate:line_type":e[4]||(e[4]=a=>n.value.line_type=a),"with-type":!0,"initial-value":s.$route.query,onFilterChange:P,class:"w-full"},{default:J(()=>[O(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),onChange:k,class:"input-1 py-0.5","aria-label":"Select month"},null,544),[[ee,i.value]])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",de,[t("div",pe,[h.value?(d(),V(le,{key:0,user:m.value},null,8,["user"])):b("",!0),h.value?(d(),f("div",ue,[t("div",me,[e[9]||(e[9]=t("h2",{class:"text-sm md:text-base font-semibold text-zinc-900"},"Attendance Summary",-1)),S(l,{to:{name:"MonthWiseApplicationLog",query:{...s.$route.query}},class:"inline-flex items-center gap-1 rounded-md border border-zinc-200 bg-white px-2.5 py-1 text-[12px] font-medium text-zinc-700 hover:bg-zinc-50 active:scale-[.99]",target:"_blank",rel:"noopener noreferrer"},{default:J(()=>e[8]||(e[8]=[t("i",{class:"far fa-clock text-[12px]"},null,-1),t("span",{class:"hidden sm:inline"},"Application History",-1),t("span",{class:"sm:hidden"},"History",-1)])),_:1,__:[8]},8,["to"])]),e[21]||(e[21]=t("div",{class:"h-px w-full bg-gradient-to-r from-indigo-500/70 via-sky-400/70 to-cyan-400/70"},null,-1)),t("div",ce,[t("div",ye,[s.presentRate!==null?(d(),f("span",fe,[e[10]||(e[10]=t("i",{class:"far fa-check-circle text-[11px]"},null,-1)),e[11]||(e[11]=p(" Present ")),t("strong",null,u(((M=(c=r(o))==null?void 0:c.summary)==null?void 0:M.total_present_days)||0)+"d",1)])):b("",!0),t("span",xe,[e[12]||(e[12]=t("i",{class:"far fa-clock text-[11px]"},null,-1)),e[13]||(e[13]=p(" Late ")),t("strong",null,u((T=(q=r(o))==null?void 0:q.summary)==null?void 0:T.actual_late_day)+"d",1)]),t("span",ge,[e[14]||(e[14]=t("i",{class:"far fa-user-times text-[11px]"},null,-1)),e[15]||(e[15]=p(" Absent ")),t("strong",null,u(((B=(j=r(o))==null?void 0:j.summary)==null?void 0:B.total_absent_days)||0)+"d",1)]),t("span",_e,[e[16]||(e[16]=t("i",{class:"far fa-bolt text-[11px]"},null,-1)),e[17]||(e[17]=p(" Total Weekends ")),t("strong",null,u((L=(D=r(o))==null?void 0:D.summary)==null?void 0:L.total_weekend_days)+"d",1)])])]),t("div",ve,[t("div",be,[e[18]||(e[18]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-briefcase text-[12px]"}),p(" Total Working Days ")],-1)),t("strong",we,u(((F=(E=r(o))==null?void 0:E.summary)==null?void 0:F.total_working_days)||0),1)]),t("div",ke,[e[19]||(e[19]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-hourglass-half text-[12px]"}),p(" Working Hours ")],-1)),t("strong",he,u((((N=(H=r(o))==null?void 0:H.summary)==null?void 0:N.total_working_hours)??"").toString().trim()||"—"),1)]),t("div",ze,[e[20]||(e[20]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-bolt text-[12px]"}),p(" Overtime Hours ")],-1)),t("strong",Se,u(((R=(W=r(o))==null?void 0:W.summary)==null?void 0:R.total_overtime_hours)||"—"),1)])])])):b("",!0)])]),m.value?b("",!0):(d(),f("div",$e,e[22]||(e[22]=[t("p",{class:"text-gray-400 text-center text-2xl italic"},"Select an employee, please.",-1)]))),r(o).isLoading?(d(),V(oe,{key:1})):O((d(),f("div",Ae,[S(se,{logs:r(o).monthlyLogs},null,8,["logs"])],512)),[[te,h.value]])])}}};export{Ve as default};
