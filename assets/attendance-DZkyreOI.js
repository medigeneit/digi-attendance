import{B as z,r as p,C as y}from"./index-BK8pOcb9.js";const V=z("attendance",()=>{const g=p([]),w=p([]),h=p([]),f=p([]),v=p([]),b=p(null),S=p(null),$=p(new Date().toISOString().substring(0,7)),E=p(new Date().toISOString().substring(0,10)),l=p(null),c=p(!1),D=p(null),x=async(a,n)=>{const e=C(n);return g.value.find(t=>t.date===e)},C=a=>{const n=new Date(a),e=String(n.getDate()).padStart(2,"0"),t=n.toLocaleString("en-US",{month:"short"}),o=n.getFullYear();return`${e} ${t} ${o}`},U=async(a,n)=>{var e,t;if(!a||!n){l.value="Invalid user ID or month";return}c.value=!0;try{const o=await y.get(`/user/${a}/attendance/monthly/${n}/log`);w.value=o.data.attendance_logs}catch(o){l.value=((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},A=async(a,n,e,t,o,r=!1)=>{var s,d;if(!e||!a||!n){l.value="Company, Start Date, and End Date are required";return}c.value=!0;try{return(await y.get("/attendance/date-range-summary",{params:{company_id:e,line_type:t||"all",start_date:a,end_date:n,employee_id:o||void 0,ignore_permission:r?"true":"false"}})).data}catch(u){return l.value=((d=(s=u.response)==null?void 0:s.data)==null?void 0:d.message)||"Something went wrong",console.error(l.value),null}finally{c.value=!1}},k=async(a,n,e,t="all",o=null)=>{var u;if(!e||!a||!n){l.value="Company, Start Date, and End Date are required";return}const r=(u=y.defaults.baseURL)==null?void 0:u.replace(/\/$/,"");let s=`flag=excel&company_id=${e}&start_date=${a}&end_date=${n}`;o&&(s+=`&employee_id=${o}`),t&&(s+=`&line_type=${t}`);const d=`${r}/attendance/date-range-summary?${s}`;console.log("ðŸ“ Opening Excel Download URL:",d),window.open(d,"_blank")},P=(a,n,e,t,o=null,r="")=>{if(!e||!a||!n){l.value="Company, Start Date, and End Date are required";return}const s=new URLSearchParams({flag:"pdf",company_id:e,line_type:t,start_date:a,end_date:n});o&&s.append("employee_id",o),r&&s.append("category",r);const d=`/attendance/date-range-summary?${s.toString()}`;window.open(d,"_blank")},M=async(a,n)=>{var e,t;if(!a||!n){l.value="Invalid user ID or month";return}c.value=!0;try{const o=await y.get(`/user/${a}/attendance/monthly/${n}`);g.value=o.data.monthly_logs,b.value=o.data.summary,l.value=null}catch(o){l.value=((t=(e=o.response)==null?void 0:e.data)==null?void 0:t.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},O=async(a={})=>{var n,e;c.value=!0;try{const t=await y.get("/attendance/today",{params:a});h.value=t.data,l.value=null}catch(t){l.value=((e=(n=t.response)==null?void 0:n.data)==null?void 0:e.message)||"Something went wrong",console.error("[Attendance Error]",l.value)}finally{c.value=!1}},q=async(a,n=null,e=null,t=null,o,r)=>{var s,d;c.value=!0;try{const u={company_id:a,department_id:n,category:e,employee_id:t,type:r,...r==="daily"?{date:o}:{month:o}},i=await y.get("/monthly/attendance/late-reports",{params:u});r==="daily"?f.value=i.data:r==="monthly"&&(v.value=i.data),l.value=null}catch(u){l.value=((d=(s=u.response)==null?void 0:s.data)==null?void 0:d.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},B=async(a,n=null,e=null,t=null,o,r)=>{var s,d;c.value=!0;try{const u={company_id:a,department_id:n,line_type:e,employee_id:t,type:r,...r==="daily"?{date:o}:{month:o}},i=await y.get("/attendance/late-reports",{params:u});r==="daily"?f.value=i.data:r==="monthly"&&(v.value=i.data),l.value=null}catch(u){l.value=((d=(s=u.response)==null?void 0:s.data)==null?void 0:d.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},T=async(a,n,e,t,o)=>{var r,s,d,u;if(!a||!o){l.value="Company & month are required";return}c.value=!0;try{const i={company_id:a,department_id:n,month:o,line_type:e||"",employee_id:t||""},m=await y.get("/attendance/monthly-summary-reports",{params:i});S.value=((r=m.data)==null?void 0:r.data)??m.data,D.value=((s=m.data)==null?void 0:s.meta)||null,l.value=null}catch(i){l.value=((u=(d=i==null?void 0:i.response)==null?void 0:d.data)==null?void 0:u.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},j=async a=>{var n,e;c.value=!0,l.value=null;try{return(await y.post("/add-on",a)).data}catch(t){throw l.value=((e=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:e.message)||"Something went wrong",console.error(l.value),t}finally{c.value=!1}},F=async(a,n)=>{var e,t;if(!a){const o="Payroll period id is required";throw l.value=o,new Error(o)}c.value=!0,l.value=null;try{return(await y.put(`/add-on/${a}`,n)).data}catch(o){throw l.value=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message)||"Something went wrong",console.error(l.value),o}finally{c.value=!1}},L=a=>{const n={};return Object.entries(a).forEach(([e,t])=>{t==null||t===""||(n[e]=t)}),n},R=(a,n)=>{if(!a||!n){const e="Company & month are required";throw l.value=e,new Error(e)}},_=(a,n="Something went wrong")=>{var t,o;const e=((o=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:o.message)||(a==null?void 0:a.message)||n;throw l.value=e,console.error(e,a),a};return{monthlyLogs:g,dailyLateLogs:f,monthlyLateLogs:v,summary:b,monthly_company_summary:S,selectedMonth:$,selectedDate:E,error:l,isLoading:c,dailyLogs:h,attendanceLogs:w,reportMeta:D,getUserDailyLogsByDate:x,getMonthlyAttendanceByShift:M,getTodayAttendanceReport:O,getAttendanceLateReport:q,getMonthlyAttendanceSummaryReport:T,postPayrollPeriods:j,updatePayrollPeriod:F,downloadExcel:async(a,n,e)=>{var t,o;if(!a||!e){l.value="Invalid company ID or month";return}c.value=!0;try{const r={company_id:a,line_type:n,month:e},s=await y.get("/attendance/monthly-summary-reports?flag=excel",{params:r,responseType:"blob"}),d=window.URL.createObjectURL(new Blob([s.data])),u=document.createElement("a");u.href=d,u.setAttribute("download",`${e} attendance_summary.xlsx`),document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(r){l.value=((o=(t=r.response)==null?void 0:t.data)==null?void 0:o.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},downloadPDF:async(a,n,e,t=0)=>{var o,r;if(!a||!e){l.value="Invalid user ID or month";return}c.value=!0;try{const s={company_id:a,category:n,month:e},d=await y.get("/attendance/monthly-summary-reports?flag=pdf",{params:s,responseType:"blob"}),u=window.URL.createObjectURL(new Blob([d.data])),i=document.createElement("a");i.href=u,i.setAttribute("download",`${e} attendance_summary.pdf`),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(s){l.value=((r=(o=s.response)==null?void 0:o.data)==null?void 0:r.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},attendanceDownloadExcel:async(a,n,e,t,o)=>{var r,s;c.value=!0;try{const d={companyId:a,employee_id:n,line_type:e,month:t,status:o},u=await y.get("/attendance/today?flag=excel",{params:d,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([u.data])),m=document.createElement("a");m.href=i,m.setAttribute("download",`${t} attendance_summary.xlsx`),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(d){l.value=((s=(r=d.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},attendanceDownloadPdf:async(a,n,e,t,o)=>{var r,s;c.value=!0;try{const d={companyId:a,employee_id:n,category:e,month:t,status:o},u=await y.get("/attendance/today?flag=pdf",{params:d,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([u.data])),m=document.createElement("a");m.href=i,m.setAttribute("download",`${t} attendance_summary.pdf`),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(d){l.value=((s=(r=d.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},lateReportDownloadExcel:async(a,n,e,t)=>{var o,r;if(!a){l.value="Invalid company ID or date/month";return}c.value=!0;try{const s={company_id:a,...n?{employee_id:n}:{},type:t,...t==="daily"?{date:e}:{month:e}},d=await y.get("/monthly/attendance/late-reports?flag=excel",{params:s,responseType:"blob"}),u=window.URL.createObjectURL(new Blob([d.data])),i=document.createElement("a");i.href=u;const m=`${e}-late-attendance.xlsx`;i.setAttribute("download",m),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(s){l.value=((r=(o=s.response)==null?void 0:o.data)==null?void 0:r.message)||"Something went wrong",console.error(l.value)}finally{c.value=!1}},getMonthlyAttendanceLog:U,getDateRangeAttendanceSummary:A,downloadDateRangeExcel:k,downloadDateRangePdf:P,getDailyLateReport:B,recalculateMonthlySnapshot:async(a,n,e,t,o)=>{R(a,o),c.value=!0,l.value=null;try{const r=L({company_id:a,month:o,department_id:n||void 0,employee_id:t||void 0,line_type:e&&e!=="all"?e:void 0});return(await y.post("/attendance/monthly-snapshot/recalculate",r)).data}catch(r){_(r,"Failed to recalculate monthly snapshot")}finally{c.value=!1}},finalizeMonthlySnapshot:async(a,n,e,t,o="finalize")=>{R(a,t),c.value=!0,l.value=null;try{const r=L({company_id:a,month:t,action:o,employee_id:e||void 0,line_type:n&&n!=="all"?n:void 0});return(await y.post("/attendance/monthly-snapshot/finalize",r)).data}catch(r){_(r,"Failed to finalize monthly snapshot")}finally{c.value=!1}}}});export{V as u};
