import{r as h,e as W,c as p,o as r,a as e,f as D,g as x,w as k,F as T,h as E,j as V,y as C,v as F,i as S,A as ae,t as y,d as xe,p as de,C as ue,x as B,n as L,q as ye,k as me,b as ge,u as ke,z as P}from"./index-DoaYLDnl.js";import{L as H}from"./LoaderView-6UU3qFqb.js";import{O as z}from"./OverlyModal-CtLAf2hD.js";import{R as pe}from"./RequiredIcon-BxMsIOqW.js";import{f as Y}from"./requirement-caOhmZpB.js";import{a as _e,f as ce,d as we,u as he,_ as $e}from"./TaskAddForm-cTxZkYsd.js";import{u as be}from"./department-Drb7UDeQ.js";import{S as ve}from"./SelectDropdown-3ynlREzU.js";import{_ as G}from"./UserChip-B3JaviHw.js";import{u as fe}from"./user-BePlq3ig.js";import{_ as qe}from"./TaskUserChip-DaxPHnsQ.js";import{u as Ce}from"./useTaskStore-CqP3lXy9.js";import{_ as oe}from"./TaskStatus-NSK9xlrm.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-A2snuAgX.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-nMr9R13i.js";import"./SectionLoading-rkQ8wbCj.js";import"./TextWithHr-Bb4C3UlI.js";import"./TaskUrgencyInput-vTyNyXV_.js";const De={class:"sticky top-0 pt-4 bg-white z-10"},Ie={class:"mb-4"},Se={class:"block text-gray-600 text-sm mb-1 font-medium"},Re={class:"mb-4"},Te={class:"mb-4"},Ee={class:"mb-4"},Ve={class:"mb-4"},Ae={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Ne={key:0,class:"mb-4 text-red-500 font-medium"},Ue={key:1,class:"mb-4"},Le={class:"flex items-center justify-between gap-4"},Fe=["disabled"],Oe={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["create","closeClick","error"],setup(_,{emit:I}){const g=_,f=I,o=be(),v=h(),a=h(""),b=h(),c=h({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),w=h([]);async function l(){var t,d;a.value="submitting";const i={...c.value};console.log({payload:i});try{const m=await _e(g.requirementId,i);f("create",m),a.value="create"}catch(m){a.value="error",b.value=((d=(t=m.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to create requirement detail",f("error",b.value)}}return W(async()=>{var t;const i=((t=(await Y(g.requirementId)).data)==null?void 0:t.requirement)||{};w.value=await o.fetchDepartmentEmployee([i.from_department_id])}),(i,t)=>(r(),p("div",{class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative",ref_key:"formContainerRef",ref:v},[e("div",De,[t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement",-1)),t[8]||(t[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=k(d=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:k(l,["prevent"]),class:"z-0"},[a.value!=="loading"?(r(),p(T,{key:0},[e("div",Ie,[e("label",Se,[t[9]||(t[9]=V("Title ")),C(pe)]),E(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>c.value.title=d),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,c.value.title]])]),e("div",Re,[t[10]||(t[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Details",-1)),E(e("textarea",{rows:"10","onUpdate:modelValue":t[2]||(t[2]=d=>c.value.description=d),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,c.value.description]])]),e("div",Te,[t[12]||(t[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),C(ve,{modelValue:c.value.supervisor_id,"onUpdate:modelValue":t[3]||(t[3]=d=>c.value.supervisor_id=d),options:w.value,placeholder:"--NO SUPERVISOR--",containment:v.value,clearable:"",class:"h-10"},{"list-header":S(()=>t[11]||(t[11]=[e("div",{class:"px-3 pt-2 pb-1 shadow-md text-xs uppercase bg-gray-50 text-gray-500"}," Employees ",-1)])),option:S(({option:d})=>[C(G,{user:d||{},class:"pr-5 -mx-1"},null,8,["user"])]),"selected-option":S(({option:d})=>[d?(r(),D(G,{key:0,user:d||{},class:"pr-4"},null,8,["user"])):x("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",Ee,[t[14]||(t[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),E(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[4]||(t[4]=d=>c.value.priority=d)},t[13]||(t[13]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ae,c.value.priority]])]),e("div",Ve,[t[15]||(t[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),E(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=d=>c.value.better_to_complete_on=d),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,c.value.better_to_complete_on]])])],64)):x("",!0),e("div",Ae,[b.value?(r(),p("div",Ne,y(b.value),1)):x("",!0),b.value?(r(),p("hr",Ue)):x("",!0),e("div",Le,[e("button",{type:"button",onClick:t[6]||(t[6]=k(d=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},y(a.value=="submitting"?"Saving...":"Add Requirement"),9,Fe)])])],32),a.value==="loading"||a.value==="submitting"?(r(),D(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):x("",!0)],512))}},je={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Me={class:"mb-4"},Pe={class:"font-semibold"},ze={class:"mb-4"},Be={class:"line-clamp-2"},Ge={key:1,class:"min-h-40"},We={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},He={key:0,class:"mb-4 text-red-500 font-medium"},Ye={key:1,class:"mb-4"},Je={class:"flex items-center justify-between gap-4"},Ke=["disabled"],Qe={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(_,{emit:I}){const g=_,f=I,o=fe(),v=h(null),a=h(""),b=h(),c=h([]);async function w(){var l,i;a.value="submitting";try{const t=await we(g.requirementId,g.detailId);f("delete",t),a.value="create"}catch(t){a.value="error",b.value=((i=(l=t.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to update requirement detail: "+t,f("error",b.value)}}return W(async()=>{var l,i,t;a.value="loading";try{c.value=await o.fetchDepartmentWiseEmployees(),v.value=(l=(await ce(g.requirementId,g.detailId)).data)==null?void 0:l.detail}catch(d){b.value=((t=(i=d.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to fetch requirement detail"}finally{a.value=""}}),(l,i)=>{var t,d;return r(),p("div",je,[i[4]||(i[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:k(w,["prevent"]),class:"z-0"},[a.value!=="loading"?(r(),p(T,{key:0},[e("div",Me,[i[1]||(i[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Pe,y((t=v.value)==null?void 0:t.title),1)]),e("div",ze,[i[2]||(i[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",Be,y((d=v.value)==null?void 0:d.description),1)]),i[3]||(i[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(r(),p("div",Ge)),e("div",We,[b.value?(r(),p("div",He,y(b.value),1)):x("",!0),b.value?(r(),p("hr",Ye)):x("",!0),e("div",Je,[e("button",{type:"button",onClick:i[0]||(i[0]=k(m=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},y(a.value=="submitting"?"Deleting...":"Delete"),9,Ke)])])],32),a.value==="loading"||a.value==="submitting"?(r(),D(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):x("",!0)])}}},Xe={class:"sticky top-0 pt-4 bg-white z-10"},Ze={class:"mb-4"},et={class:"block text-gray-600 text-sm mb-1 font-medium"},tt={class:"mb-4"},st={class:"mb-4"},lt={key:0,class:"relative w-full"},rt={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},it={class:"mb-4"},nt={class:"mb-4"},ot={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},at={key:0,class:"mb-4 text-red-500 font-medium"},dt={key:1,class:"mb-4"},ut={class:"flex items-center justify-between gap-4"},mt=["disabled"],pt={__name:"RequirementDetailEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(_,{emit:I}){const g=_,f=I,o=h(),v=fe(),a=be(),b=h(null),c=h(""),w=h(),l=h({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),i=h([]),t=h([]);async function d(){var n,$;c.value="submitting";const m={...l.value};try{const u=await he(g.requirementId,g.detailId,m);f("update",u),c.value="create"}catch(u){c.value="error",w.value=(($=(n=u.response)==null?void 0:n.data)==null?void 0:$.message)||"Failed to update requirement detail",f("error",w.value)}}return W(async()=>{var m,n,$,u,s,R,A,O;c.value="loading";try{i.value=await v.fetchDepartmentWiseEmployees();const N=((m=(await Y(g.requirementId)).data)==null?void 0:m.requirement)||{};t.value=await a.fetchDepartmentEmployee([N.from_department_id]),b.value=(n=(await ce(g.requirementId,g.detailId)).data)==null?void 0:n.detail,l.value={title:($=b.value)==null?void 0:$.title,description:(u=b.value)==null?void 0:u.description,priority:(s=b.value)==null?void 0:s.priority,supervisor_id:(R=b.value)==null?void 0:R.supervisor_id};const j=new Date(b.value.better_to_complete_on);l.value.better_to_complete_on=j.toISOString().split("T")[0]}catch(N){w.value=((O=(A=N.response)==null?void 0:A.data)==null?void 0:O.message)||"Failed to fetch requirement detail"}finally{c.value=""}}),(m,n)=>{var $;return r(),p("div",{ref_key:"formContainerRef",ref:o,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Xe,[n[8]||(n[8]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),n[9]||(n[9]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:n[0]||(n[0]=k(u=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:k(d,["prevent"]),class:"z-0"},[c.value!=="loading"?(r(),p(T,{key:0},[e("div",Ze,[e("label",et,[n[10]||(n[10]=V("Title ")),C(pe)]),E(e("input",{"onUpdate:modelValue":n[1]||(n[1]=u=>l.value.title=u),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,l.value.title]])]),e("div",tt,[n[11]||(n[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),E(e("textarea",{rows:"10","onUpdate:modelValue":n[2]||(n[2]=u=>l.value.description=u),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,l.value.description]])]),e("div",st,[n[12]||(n[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),C(ve,{modelValue:l.value.supervisor_id,"onUpdate:modelValue":n[4]||(n[4]=u=>l.value.supervisor_id=u),options:[...t.value,...t.value.find(u=>{var s,R;return u.id==((R=(s=b.value)==null?void 0:s.supervisor)==null?void 0:R.id)})?[]:[($=b.value)==null?void 0:$.supervisor]],containment:o.value,placeholder:"--NO SUPERVISOR--",class:"h-10"},{option:S(({option:u})=>[C(G,{user:u||{}},null,8,["user"])]),"selected-option":S(({option:u})=>[u?(r(),p("div",lt,[C(G,{user:u||{}},null,8,["user"]),l.value.supervisor_id?(r(),p("div",rt,[e("button",{onClick:n[3]||(n[3]=k(s=>l.value.supervisor_id=null,["prevent"])),class:"text-gray-6 font-semibold 00 hover:text-red-700"}," Ã— ")])):x("",!0)])):x("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",it,[n[14]||(n[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),E(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":n[5]||(n[5]=u=>l.value.priority=u)},n[13]||(n[13]=[e("option",{value:null},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ae,l.value.priority]])]),e("div",nt,[n[15]||(n[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),E(e("input",{type:"date","onUpdate:modelValue":n[6]||(n[6]=u=>l.value.better_to_complete_on=u),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,l.value.better_to_complete_on]])])],64)):x("",!0),e("div",ot,[w.value?(r(),p("div",at,y(w.value),1)):x("",!0),w.value?(r(),p("hr",dt)):x("",!0),e("div",ut,[e("button",{type:"button",onClick:n[7]||(n[7]=k(u=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:c.value=="loading"||c.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},y(c.value=="submitting"?"Saving...":"Edit Detail"),9,mt)])])],32),c.value==="loading"||c.value==="submitting"?(r(),D(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):x("",!0)],512)}}},ct=["rowspan"],bt={class:"text-2xl font-medium"},vt=["rowspan"],ft={class:"text-lg font-semibold mb-2"},xt={class:"mb-5"},yt={class:"text-justify"},gt=["innerHTML"],kt={class:"flex items-end"},_t={class:"flex items-center gap-1 mb-3"},wt={class:"text-blue-400 font-semibold"},ht={class:"ml-auto flex gap-6 items-center"},$t=["rowspan"],qt={class:"border-2 border-gray-700 p-3 text-center"},Ct=["title"],Dt={class:"border-2 border-gray-700 p-3"},It={class:"whitespace-nowrap text-center print:whitespace-break-spaces"},St={key:0},Rt={key:1,class:"text-gray-500"},Tt={key:2,colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Et={__name:"RequirementDetailTableRow",props:{detail:{type:Object},requirement:{type:Object},serial:{type:Number}},emits:["editClick","deleteClick","taskCreateClick"],setup(_,{emit:I}){const g=_,f=I,o=xe(),v=h("line-clamp-2");function a(){v.value=v.value?"":"line-clamp-2"}const b=de(()=>{var w,l,i;return((l=(w=g.detail)==null?void 0:w.tasks)==null?void 0:l.length)>0?(i=g.detail)==null?void 0:i.tasks:[{id:0}]});function c(){var w,l,i,t;if(((w=o.user)==null?void 0:w.department_id)!==((l=g.requirement)==null?void 0:l.to_department_id))return alert(`You can't create or assign task for this requirement. 
Only ${(t=(i=g.requirement)==null?void 0:i.to_department)==null?void 0:t.name}'s user can create or assign.`);f("taskCreateClick",g.detail)}return(w,l)=>{const i=ue("RouterLink");return r(!0),p(T,null,B(b.value,(t,d)=>{var m,n,$,u,s,R;return r(),p("tr",{key:t.id,class:"group/item border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},[d===0?(r(),p(T,{key:0},[e("td",{class:"border-2 border-gray-700 p-3 align-top",rowspan:((n=(m=_.detail)==null?void 0:m.tasks)==null?void 0:n.length)||1},[e("span",bt,y(_.serial),1)],8,ct),e("td",{class:"border-2 border-gray-700 p-3",rowspan:((u=($=_.detail)==null?void 0:$.tasks)==null?void 0:u.length)||1},[e("div",null,[e("div",ft,[e("span",null,y(_.detail.title),1)]),l[3]||(l[3]=e("hr",{class:"mb-4 -mx-4"},null,-1)),e("div",xt,[l[2]||(l[2]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),e("div",yt,[e("p",{class:L(["print:line-clamp-none",v.value]),innerHTML:_.detail.description},null,10,gt),e("button",{class:"text-blue-500 group-hover/item:underline hover:text-sky-400 ml-auto text-sm print:hidden",onClick:k(a,["prevent"])},y(v.value?"Show More":"Show Less"),1)])])]),e("div",kt,[e("div",null,[e("div",_t,[l[4]||(l[4]=e("span",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Supervisor:",-1)),_.detail.supervisor?(r(),D(qe,{key:0,user:_.detail.supervisor},null,8,["user"])):x("",!0)]),e("div",null,[l[5]||(l[5]=e("span",{class:"text-gray-500 mr-2 text-xs uppercase font-semibold"},"Priority:",-1)),e("span",wt,y(_.detail.priority),1)])]),e("div",ht,[e("button",{class:"btn-2",onClick:l[0]||(l[0]=k(A=>f("editClick",_.detail),["prevent"]))},l[6]||(l[6]=[e("i",{class:"fas fa-edit"},null,-1),V("Edit ")])),e("button",{class:"btn-2-red",onClick:l[1]||(l[1]=k(A=>f("deleteClick",_.detail),["prevent"]))},l[7]||(l[7]=[e("i",{class:"fas fa-trash-alt"},null,-1),V("Delete ")]))])])],8,vt),e("td",{class:"border-2 border-gray-700 p-3 whitespace-nowrap print:whitespace-break-spaces print:px-0 text-center",rowspan:((R=(s=_.detail)==null?void 0:s.tasks)==null?void 0:R.length)||1},[e("div",null,y(new Date(_.detail.better_to_complete_on).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)],8,$t)],64)):x("",!0),t.id?(r(),p(T,{key:1},[e("td",qt,[C(i,{to:{name:"TaskShow",params:{id:t.id}},class:"hover:underline text-gray-900 hover:text-blue-600 whitespace-nowrap block",target:"_blank"},{default:S(()=>[V(y(t.id)+" ",1),e("i",{title:t.status,class:L(["ml-1",{"fad fa-exclamation-circle text-red-600":t.status=="PENDING","fad fa-exclamation-square text-yellow-600":t.status=="IN_PROGRESS","fad fa-check-circle text-green-600":t.status=="COMPLETED"}])},null,10,Ct)]),_:2},1032,["to"])]),e("td",Dt,[e("div",It,[t.deadline?(r(),p("div",St,y(new Date(t.deadline).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)):(r(),p("div",Rt,"-"))])])],64)):(r(),p("td",Tt,[e("button",{onClick:k(c,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"}," Create / Assign Task ")]))])}),128)}}},Vt={class:"text-left p-4"},At={class:"flex items-center gap-6 justify-center my-16"},Nt={key:0},Ut={class:"bg-blue-50 px-6 py-4 rounded text-blue-500"},Lt={class:"text-left text-base w-full font-semibold group flex items-center gap-2 mb-5 border-b border-blue-100 py-4"},Ft={class:"flex items-center w-full"},Ot={class:"grow"},jt={class:"text-center text-red-500 text-sm font-semibold mb-4"},Mt={class:"flex items-center justify-between"},Pt={key:1,class:"border rounded-md"},zt={class:"flex flex-col justify-start items-start min-h-28 max-h-[70vh] overflow-y-auto"},Bt=["onClick"],Gt={class:"flex items-center w-full"},Wt={class:"grow"},Ht={class:"line-clamp-1"},Yt={key:0,class:"text-red-400 text-xs font-normal mt-1"},Jt={__name:"TaskParentIdSelector",props:{fromDepartmentId:{type:Number},requirementDetail:{type:Object}},emits:["parentIdSelect","cancelClick","assignTask"],setup(_,{emit:I}){const g=_,f=I,o=Ce(),v=h(""),a=h(null);ye(()=>v.value,(l,i)=>{i||o.fetchTasks({"from-department-id":g.fromDepartmentId})},{immediate:!0});function b(l){if(v.value=="sub-task")f("parentIdSelect",l.id);else{if(l.requirement_detail_id)return alert("This task already assigned to another requirement. Can't be assigned.");a.value=l}}async function c(){await o.setTaskRequirement(a.value.id,g.requirementDetail.id),f("assignTask")}const w=de(()=>(o==null?void 0:o.tasks)||[]);return(l,i)=>{var t;return r(),p("div",Vt,[e("div",At,[e("button",{onClick:i[0]||(i[0]=k(d=>f("parentIdSelect",0,v.value),["prevent"])),class:"btn-3"}," Add as Main Task "),e("button",{class:L({"btn-3":v.value!=="sub-task","btn-2":v.value=="sub-task"}),onClick:i[1]||(i[1]=k(()=>{v.value="sub-task",a.value=null},["prevent"]))}," Add as Sub Task ",2),e("button",{class:L({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:i[2]||(i[2]=k(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value=="direct-assign"&&a.value?(r(),p("div",Nt,[e("div",Ut,[e("div",Lt,[e("i",{class:L(["fad text-xl group:hover-text-white",((t=a.value)==null?void 0:t.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",Ft,[e("div",Ot,y(a.value.title),1),C(oe,{status:a.value.status,class:"ml-auto"},null,8,["status"])])]),e("div",jt,y(me(o).error),1),e("div",Mt,[e("button",{onClick:k(c,["prevent"]),class:"btn-2"},"Assign"),e("button",{onClick:i[3]||(i[3]=k(d=>f("cancelClick"),["prevent"])),class:"btn-3"},"Cancel")])])])):x("",!0),v.value&&!a.value?(r(),p("div",Pt,[i[4]||(i[4]=e("div",{class:"py-2 px-4 font-bold text-center border-b shadow"},"Click to select task",-1)),e("div",zt,[(r(!0),p(T,null,B(w.value,d=>(r(),p("div",{key:d.id,class:"w-full mb-2"},[e("button",{type:"button",class:"text-left text-base w-full bg-blue-50 px-2 hover:bg-blue-500 hover:text-white py-2 text-blue-500 font-semibold group flex items-center gap-2",onClick:k(()=>b(d),["prevent"])},[e("i",{class:L(["fad text-xl group:hover-text-white",(d==null?void 0:d.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",Gt,[e("div",Wt,[e("div",Ht,y(d.title),1),d.requirement_detail_id&&v.value=="direct-assign"?(r(),p("div",Yt," Already assigned to a requirement ")):x("",!0)]),C(oe,{status:d.status,class:"ml-auto"},null,8,["status"])])],8,Bt)]))),128))])])):x("",!0)])}}},Kt={class:"container mx-auto p-6 print:p-0 w-full print:max-w-full"},Qt={class:"bg-white rounded shadow print:shadow-none p-4 print:p-0 relative"},Xt={class:"flex items-start"},Zt={class:"mb-4 text-lg print:black print:font-bold"},es={class:"ml-auto print:hidden flex gap-2 items-center"},ts={class:"mb-4 flex items-center gap-1 print:mb-1"},ss={class:"font-bold print:text-gray-900"},ls={class:"mb-3 flex items-center gap-3 print:mb-1"},rs={class:"print:text-gray-900"},is={key:0,class:"mb-3 flex items-center gap-3 print:mb-1"},ns={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},os={class:"mb-3 flex items-center gap-3 print:mb-1"},as={class:"print:text-gray-900"},ds={key:0,class:"overflow-x-auto print:overflow-visible"},us={class:"w-full table-auto print:table-fixed"},ms={colspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap px-3 py-1 print:whitespace-normal w-[25%]"},ps={class:"whitespace-nowrap print:whitespace-break-spaces print:px-0 p-3 text-center border-2 border-gray-800"},cs={class:"text-gray-900 text-base"},bs={class:"mt-8 border rounded-md p-8 flex items-center justify-center bg-gray-50"},Ns={__name:"RequirementShow",setup(_){const I=ge(),g=ke(),f=h(""),o=h(null),v=P({open:!1}),a=P({detail:null,open:!1}),b=P({detail:null,open:!1});W(async()=>{await c()});async function c(){var u;f.value="loading",o.value=(u=(await Y(I.params.id)).data)==null?void 0:u.requirement,f.value=""}function w(u){console.log({detail:u}),m.modalShown=!0,m.from_department_id=o.value.from_department_id,m.to_department_id=o.value.to_department_id,m.taskDefaultValues={title:u.title,description:u.description,from_department_id:o.value.from_department_id,to_department_id:o.value.to_department_id},m.requirementDetail=u}function l(){v.open=!0}function i(u){a.open=!0,a.detail=u}function t(u){b.open=!0,b.detail=u}function d(){window.print()}const m=P({parentId:null,modalShown:!1,requirementId:0,taskDefaultValues:{},requirementDetail:null});async function n(){m.parentId=0,m.parentId=null,m.modalShown=!1,m.requirementDetail=null,f.value="loading",await c()}async function $(){m.parentId=null,m.modalShown=!1,m.requirementDetail=null}return(u,s)=>{var A,O,N,j,J,K,Q,X,Z,ee,te,se,le,re,ie;const R=ue("RouterLink");return r(),p("div",Kt,[v.open?(r(),D(z,{key:0,class:"*:max-w-4xl"},{default:S(()=>[C(Oe,{requirementId:o.value.id,onCloseClick:s[0]||(s[0]=q=>v.open=!1),onCreate:s[1]||(s[1]=async()=>{v.open=!1,await c()})},null,8,["requirementId"])]),_:1})):x("",!0),a.open?(r(),D(z,{key:1},{default:S(()=>{var q;return[C(pt,{requirementId:o.value.id,detailId:(q=a.detail)==null?void 0:q.id,onCloseClick:s[2]||(s[2]=U=>a.open=!1),onUpdate:s[3]||(s[3]=async()=>{a.open=!1,await c()})},null,8,["requirementId","detailId"])]}),_:1})):x("",!0),b.open?(r(),D(z,{key:2},{default:S(()=>{var q;return[C(Qe,{requirementId:o.value.id,detailId:(q=b.detail)==null?void 0:q.id,onCloseClick:s[4]||(s[4]=U=>b.open=!1),onDelete:s[5]||(s[5]=async()=>{b.open=!1,await c()})},null,8,["requirementId","detailId"])]}),_:1})):x("",!0),m.modalShown?(r(),D(z,{key:3,class:"*:relative"},{default:S(()=>{var q,U;return[e("button",{onClick:k($,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},s[8]||(s[8]=[e("i",{class:"fas fa-times-circle"},null,-1)])),m.parentId===null?(r(),D(Jt,{key:0,"from-department-id":(q=o.value)==null?void 0:q.from_department_id,requirementDetail:m==null?void 0:m.requirementDetail,onParentIdSelect:s[6]||(s[6]=M=>m.parentId=M),onCancelClick:$,onAssignTask:n},null,8,["from-department-id","requirementDetail"])):(r(),D($e,{key:1,parentTaskId:m.parentId,requirementDetailId:(U=m==null?void 0:m.requirementDetail)==null?void 0:U.id,requirementId:o.value.id,onClose:$,onTaskCreated:n,defaultValues:m.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["parentTaskId","requirementDetailId","requirementId","defaultValues"]))]}),_:1})):x("",!0),e("div",Qt,[e("div",Xt,[e("div",Zt,[s[9]||(s[9]=e("div",{class:"text-gray-800 leading-none"},"To",-1)),e("div",null,y((O=(A=o.value)==null?void 0:A.to_department)==null?void 0:O.name),1)]),e("div",es,[(((N=o.value)==null?void 0:N.details)||[]).length>0?(r(),p("button",{key:0,class:"btn-3 font-semibold !pl-2 !pr-4",onClick:k(d,["prevent"])},s[10]||(s[10]=[e("i",{class:"fad fa-print text-xl"},null,-1),V("Print ")]))):x("",!0),e("button",{class:"btn-3",onClick:s[7]||(s[7]=k(()=>me(g).back(),["prevent"]))},"Back"),C(R,{class:"btn-2",to:`/requirements/edit/${(j=o.value)==null?void 0:j.id}`},{default:S(()=>s[11]||(s[11]=[V("Edit")])),_:1,__:[11]},8,["to"])])]),s[24]||(s[24]=e("div",{class:"text-center text-xl font-bold mb-2 underline"},"Requirement Form",-1)),e("div",ts,[s[12]||(s[12]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",ss,y((J=o.value)==null?void 0:J.id),1)]),e("div",ls,[s[13]||(s[13]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),e("div",rs,y((Q=(K=o.value)==null?void 0:K.from_department)==null?void 0:Q.name),1)]),((Z=(X=o.value)==null?void 0:X.website_tags)==null?void 0:Z.length)>0?(r(),p("div",is,[s[14]||(s[14]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",ns,[(r(!0),p(T,null,B(((ee=o.value)==null?void 0:ee.website_tags)||[],q=>(r(),p("div",{key:q.id,class:"border px-2 rounded-md bg-gray-50 shadow-sm whitespace-nowrap"},y(q.name),1))),128))])])):x("",!0),e("div",os,[s[15]||(s[15]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",as,y(new Date((te=o.value)==null?void 0:te.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)]),s[25]||(s[25]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[s[23]||(s[23]=e("div",{class:"flex items-end mb-3"},[e("h2",{class:"text-xl font-semibold"},"Requirements"),e("div",{class:"ml-auto print:hidden flex gap-2 text-sm"})],-1)),(((se=o.value)==null?void 0:se.details)||[]).length>0?(r(),p("div",ds,[e("table",us,[e("thead",null,[e("tr",null,[s[16]||(s[16]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-left px-4 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[15%]"}," SL ",-1)),s[17]||(s[17]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap w-[65%]"}," Requirement Details ",-1)),s[18]||(s[18]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Better To Complete ",-1)),e("th",ms," For '"+y(((le=o.value.to_department)==null?void 0:le.short_name)||((re=o.value.to_department)==null?void 0:re.name))+"' Use ",1)]),s[19]||(s[19]=e("tr",null,[e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal"}," Issue No "),e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal print:p-0"}," Expected Date ")],-1))]),e("tbody",null,[(r(!0),p(T,null,B(((ie=o.value)==null?void 0:ie.details)||[],(q,U)=>{var M,ne;return r(),p(T,{key:q.id},[C(Et,{requirement:o.value,detail:q,serial:U+1,onEditClick:i,onDeleteClick:t,onTaskCreateClick:w},null,8,["requirement","detail","serial"]),e("tr",null,[e("td",ps,[e("div",cs," For '"+y(((M=o.value.to_department)==null?void 0:M.short_name)||((ne=o.value.to_department)==null?void 0:ne.name))+"' Use ",1),s[20]||(s[20]=e("div",{class:"text-gray-800 text-xs"},"(Feedback)",-1))]),s[21]||(s[21]=e("td",{class:"whitespace-nowrap p-3 text-center border-2 border-gray-800",colspan:"4"},null,-1))])],64)}),128))])])])):x("",!0),e("div",bs,[e("button",{class:"btn-2 pl-2 text-base",onClick:k(l,["prevent"])},s[22]||(s[22]=[e("i",{class:"fad fa-plus-circle text-2xl mr-2"},null,-1),V("Add Requirement ")]))])]),f.value==="loading"?(r(),D(H,{key:1,class:"absolute inset-0 bg-opacity-90"})):x("",!0)])])}}};export{Ns as default};
