import{L as X}from"./LoaderView-BwtfiCYw.js";import{r as P,x as A,e as B,A as Y,c as y,o as u,J as N,a as t,F as V,y as G,t as T,g as f,w,q as W,n as L,f as F,G as ue,i as E,d as ae,k as x,H as le,j as U,h as J,v as Q,m as ce,T as K,U as H}from"./index-BPxZlJG7.js";import{f as me,b as Z,g as ie}from"./datetime-l2Vm98rT.js";import{u as z}from"./useTodoStore-BqHdOw8m.js";import{_ as ye}from"./DraggableList.vue_vue_type_script_setup_true_lang-kk-bHJ60.js";import{_ as ve}from"./UserChip-Dgw3j-FJ.js";import{O as te}from"./OverlyModal-DTvmStm0.js";const pe={class:"grid grid-cols-7 *:text-center *:p-2 *:border-r *:border-b *:text-blue-800 *:text-sm"},fe={class:"flex flex-col"},ge={key:0,class:"p-2 border-r border-t"},be={__name:"CalenderView",props:{month:{type:String,required:!0,validator:r=>/^\d{4}-(0[1-9]|1[0-2])$/.test(r)}},emits:["change"],setup(r,{emit:S}){const s=r,i=S,c=P(),n=P(),a=P(),m=P(),d=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function C(g,o,p,k){const b=[];for(let I=p-1;I>=0;I--){const v=k-I,_=new Date(g,o-1,v);b.push({date:_,day:_.getDate(),month:_.getMonth()+1,year:_.getFullYear(),isCurrentMonth:!1})}return b}function D(g,o,p){const k=[];for(let b=1;b<=p;b++){const v={date:new Date(g,o,b),day:b,month:o+1,year:g,isCurrentMonth:!0};k.push(v)}return k}function l(g,o,p){const k=[...g],b=Math.ceil(k.length/7)*7,I=1;for(let v=0;k.length<b;v++){const _=new Date(o,p+1,I+v);k.push({date:_,day:_.getDate(),month:_.getMonth()+1,year:_.getFullYear(),isCurrentMonth:!1})}return k}function e(g,o){const p=new Date(g,o,1),b=new Date(g,o+1,0).getDate(),v=(p.getDay()+1)%7,R=new Date(g,o,0).getDate();let O=[];O=[...C(g,o,v,R)];const j=D(g,o,b);return a.value=j[0],m.value=j[j.length-1],O=[...O,...j],O=[...l(O,g,o)],c.value=O[0],n.value=O[O.length-1],O}const $=A(()=>{const[g,o]=s.month.split("-"),p=parseInt(g),k=parseInt(o)-1;return console.log({yearStr:g,monthStr:o}),e(p,k)}),M=A(()=>{const g=$.value,o=[];for(let p=0;p<g.length;p+=7)o.push(g.slice(p,p+7));return o});function h(){i("change",{gridStartDate:c.value,gridEndDate:n.value,startOfMonth:a.value,endOfMonth:m.value})}return B(()=>h()),Y(()=>s.month,h),(g,o)=>(u(),y("div",null,[N(g.$slots,"calender-top"),t("div",pe,[(u(),y(V,null,G(d,p=>t("div",{key:p},T(p),1)),64))]),t("div",fe,[(u(!0),y(V,null,G(M.value,(p,k)=>(u(),y("div",{class:"week grid grid-cols-7 min-h-28 items-stretch",key:k},[(u(!0),y(V,null,G(p,(b,I)=>N(g.$slots,"date",{key:I,day:b.day,month:b.month,year:b.year,weekday:(b.date.getDay()+1)%7,isCurrentMonth:b.isCurrentMonth,yearMonthDate:`${b.year}-${String(b.month).padStart(2,"0")}-${String(b.day).padStart(2,"0")}`},()=>{var v;return[b!=null&&b.date?(u(),y("div",ge,T((v=b==null?void 0:b.date)==null?void 0:v.getDate()),1)):f("",!0)]})),128))]))),128))]),N(g.$slots,"calender-bottom")]))}},he={class:"px-4 py-2 flex items-center bg-gray-50 group gap-2"},ke=["value"],xe=["value"],Ce=["value"],we=["value"],De=["disabled"],$e={key:4,class:"ml-4 md:ml-auto flex items-center gap-2"},Se={key:5,class:"ml-4 md:ml-auto flex items-center gap-2"},Te={__name:"TodoHeading",props:{selected:{type:Object,default:()=>({type:"month-view",month:"",day:"",year:"",week:""})},loading:{type:Boolean,default:!1}},emits:["reloadClick",,"change"],setup(r,{emit:S}){const s=r,i=[{value:"month-view",label:"Monthly"},{value:"day-view",label:"Daily"}],c=S,n=P();function a(o){n.value=o,c("change",{...s.selected,type:o})}Y(()=>{var o;return(o=s.selected)==null?void 0:o.type},o=>a(o),{immediate:!0});const m=A(()=>n.value=="month-view"&&s.selected.year&&s.selected.month?[s.selected.year,s.selected.month-1,1]:n.value=="day-view"&&s.selected.year&&s.selected.month&&s.selected.day?[s.selected.year,s.selected.month-1,s.selected.day]:[new Date().getFullYear(),new Date().getMonth(),new Date().getDate()]);function d(){n.value=="month-view"&&M(new Date)}function C(){if(n.value=="month-view"){const o=new Date(...m.value);o.setMonth(o.getMonth()+1),M(o)}}function D(){if(n.value=="month-view"){const o=new Date(...m.value);o.setMonth(o.getMonth()-1),M(o)}}function l(){n.value=="day-view"&&M(new Date)}function e(){if(n.value=="day-view"){const o=new Date(...m.value);o.setDate(o.getDate()+1),M(o)}}function $(){if(n.value=="day-view"){const o=new Date(...m.value);o.setDate(o.getDate()-1),M(o)}}function M(o){c("change",{type:n.value,month:o.getMonth()+1,day:o.getDate(),year:o.getFullYear(),week:o.getDay()})}const h=A(()=>n.value=="month-view"?`${s.selected.year}-${s.selected.month.toString().padStart(2,"0")}`:n.value=="day-view"?`${s.selected.year}-${s.selected.month.toString().padStart(2,"0")}-${s.selected.day.toString().padStart(2,"0")}`:s.selected),g=o=>{var p,k;if(n.value=="month-view"){const[b,I]=(p=o.target.value)==null?void 0:p.split("-").map(Number),v=new Date(b,I-1,1);M(v)}if(n.value=="day-view"){const b=new Date((k=o.target)==null?void 0:k.value);M(b)}};return(o,p)=>(u(),y("div",null,[t("div",he,[N(o.$slots,"before",{selected:r.selected}),N(o.$slots,"typeSelection",{selected:r.selected,types:i,changeType:a},()=>[t("select",{class:"px-2 h-7 border rounded",value:n.value,onChange:p[0]||(p[0]=k=>a(k.target.value))},[(u(),y(V,null,G(i,k=>t("option",{value:k.value,key:k.id},T(k.label),9,xe)),64))],40,ke)]),n.value=="month-view"?(u(),y("input",{key:0,type:"month",value:h.value,onInput:g,class:"border px-2 rounded"},null,40,Ce)):f("",!0),n.value=="day-view"?(u(),y("input",{key:1,type:"date",value:h.value,onInput:g,class:"border px-2 rounded"},null,40,we)):f("",!0),n.value=="month-view"?(u(),y("button",{key:2,class:"btn-3 mx-4 h-7",onClick:w(d,["prevent"])}," Current Month ")):f("",!0),n.value=="day-view"?(u(),y("button",{key:3,class:"btn-3 mx-4 h-7",onClick:w(l,["prevent"])}," Today ")):f("",!0),t("button",{class:W(["btn-3 px-2 py-2 mx-4 size-7 disabled:text-gray-300 disabled:border-gray-300",{"animate-spin text-gray-300 border-gray-300 !bg-opacity-0":r.loading}]),onClick:p[1]||(p[1]=w(k=>c("reloadClick"),["prevent"])),disabled:r.loading},p[2]||(p[2]=[t("i",{class:"fas fa-redo-alt"},null,-1)]),10,De),n.value=="month-view"?(u(),y("div",$e,[t("button",{class:"btn-2 h-7",onClick:w(D,["prevent"])}," Previous Month "),t("button",{class:"btn-2 h-7",onClick:w(C,["prevent"])},"Next Month")])):f("",!0),n.value=="day-view"?(u(),y("div",Se,[t("button",{class:"btn-2 h-7",onClick:w($,["prevent"])},"Previous Day"),t("button",{class:"btn-2 h-7",onClick:w(e,["prevent"])},"Next Day")])):f("",!0),N(o.$slots,"after",{selected:r.selected})]),N(o.$slots,"bottom",{selected:r.selected})]))}},_e={key:0,class:"fa fa-exclamation-square",title:"Pending"},Me={key:1,class:"fa fa-pause",title:"Working"},Ee={key:2,class:"fa fa-check-square",title:"Completed"},ne={__name:"TodoStatusIcon",props:{todo:{type:Object,required:!0}},setup(r){const S=r,s=A(()=>{switch(S.todo.status){case"PENDING":return"text-red-400";case"WORKING":return"text-yellow-600";case"COMPLETED":return"text-green-400"}return""});return(i,c)=>(u(),y("span",{class:W(s.value)},[r.todo.status=="PENDING"?(u(),y("i",_e)):f("",!0),r.todo.status=="WORKING"?(u(),y("i",Me)):f("",!0),r.todo.status=="COMPLETED"?(u(),y("i",Ee)):f("",!0)],2))}},Ie=["title","onClick"],Oe={class:"line-clamp-1"},Re={key:0,class:"text-purple-600 text-center"},re={__name:"TodosInDate",props:{date:{type:String,required:!0},maxItems:{type:[Number,String],default:3}},emits:["clickTodo"],setup(r,{emit:S}){const s=r,i=S,{getTodosByDate:c}=z(),n=A(()=>{let a=[],m=!1,d=[];if(typeof c=="function"){const C=c(s.date);if(d=Array.isArray(C)?C:[],s.maxItems==="all")return{all:d,items:d,moreItemsCount:0};a=d.slice(0,s.maxItems),m=d.length-a.length}return{all:d,items:a,moreItemsCount:m}});return(a,m)=>(u(),y("div",null,[n.value.items.length===0?N(a.$slots,"noTodos",{key:0},()=>[m[0]||(m[0]=t("div",{class:"text-gray-400 text-center"},"No todos",-1))]):(u(),y(V,{key:1},[N(a.$slots,"todoItems",{todos:n.value.items,allTodos:n.value.items,moreItemsCount:n.value.moreItemsCount},()=>[(u(!0),y(V,null,G(n.value.items,d=>N(a.$slots,"todoItem",{key:d.id,todo:d,moreItemsCount:n.value.moreItemsCount},()=>{var C,D,l,e;return[t("div",{title:`${d==null?void 0:d.title} ${d!=null&&d.user?`
by:`:""} ${(C=d==null?void 0:d.user)==null?void 0:C.name} ${(D=d==null?void 0:d.user)!=null&&D.department?`
DEPT:`:""} ${(e=(l=d.user)==null?void 0:l.department)==null?void 0:e.name}`,class:W(["px-1 mb-2 text-sm rounded cursor-pointer flex items-center gap-2",{"bg-sky-50 text-sky-900 hover:bg-sky-700 hover:text-white border border-sky-300":d.status!=="COMPLETED","bg-green-500 text-white":d.status==="COMPLETED"}]),onClick:w($=>i("clickTodo",d),["prevent","stop"])},[L(ne,{todo:d,class:W(["text-sm",[d.status=="COMPLETED"?"!text-white":""]])},null,8,["todo","class"]),t("div",Oe,T(d.title),1),d.user?(u(),F(ue,{key:0,user:d.user,size:"xsmall",class:"ml-auto"},null,8,["user"])):f("",!0)],10,Ie)]})),128))]),n.value.moreItemsCount>0?(u(),y("div",Re," + "+T(n.value.moreItemsCount)+" more todo"+T(n.value.moreItemsCount>1?"s":""),1)):f("",!0)],64))]))}},Ne={class:"relative"},Pe=["onClick","onKeypress"],Le={class:"flex items-center justify-center"},Ae=["onClick"],Fe={__name:"TodosInCalenderView",props:{month:{type:String,required:!0,validator:r=>/^\d{4}-(0[1-9]|1[0-2])$/.test(r)}},emits:["dateClick","clickTodo","clickDateCell"],setup(r,{emit:S}){const s=S;function i(n,a){n.isTrusted&&n.ctrlKey&&n.which==10&&s("dateClick",a)}function c(n){const[a,m,d]=String(n).split("-").map(Number),C=new Date(a,m-1,d);return me(C)}return(n,a)=>(u(),y("div",Ne,[r.month?(u(),F(be,{key:0,month:r.month,class:"border-t border-blue-200/50 relative"},{date:E(({day:m,yearMonthDate:d,isCurrentMonth:C})=>[t("div",{tabindex:"0",class:W(["border p-4 cursor-pointer group/date relative focus:outline-slate-400",{"bg-sky-50   border-sky-300 focus:bg-sky-50 focus:outline-sky-400":c(d),"hover:bg-slate-50  hover:border-slate-300 focus:bg-slate-50 ":!c(d)}]),onClick:w(D=>s("dateClick",d),["prevent","stop"]),onKeypress:w(D=>i(D,d),["prevent"])},[t("button",{tabindex:"1",class:W([{"text-gray-300":!C,"text-sky-400":C},"text-center mb-2 font-semibold hover:bg-sky-200 w-full rounded"])},T(m),3),t("div",null,[L(re,{date:d,onClickTodo:a[0]||(a[0]=D=>s("clickTodo",D))},{noTodos:E(()=>a[1]||(a[1]=[t("span",null,null,-1)])),_:2},1032,["date"])]),t("div",Le,[t("button",{onClick:w(D=>s("clickDateCell",d),["prevent","stop"]),class:"btn-3 !py-1 invisible group-hover/date:visible text-sm text-red-800/40"},a[2]||(a[2]=[t("i",{class:"fas fa-plus"},null,-1),t("span",{class:"hidden lg:inline whitespace-nowrap"}," Add todo ",-1)]),8,Ae)])],42,Pe)]),_:1},8,["month"])):f("",!0)]))}},je={class:"relative bg-white p-4"},Ue={key:0,class:"text-red-500 text-sm border border-red-300 max-w-6xl mx-auto py-2 gap-2 shadow-sm rounded flex items-center px-3"},Ve={class:"max-w-6xl mx-auto border rounded my-5"},We={class:"mb-4 text-gray-700 border-b py-2 px-4 flex items-center"},qe={class:"text-lg font-semibold"},ze={class:"ml-auto flex items-center gap-2"},Ge={key:0,class:"flex items-center gap-3 mr-6"},Be=["disabled"],Ke=["disabled"],He=["onClick"],Ye={class:"ml-4"},Je={key:0,class:"mt-1 flex items-center gap-2"},Qe={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},Xe={key:0,class:"line-clamp-2 ml-4 text-gray-500"},Ze={class:"ml-auto flex items-center gap-2"},et=["onClick"],tt=["onClick"],nt=["onClick"],ot=["onClick"],st={__name:"TodosInDailyView",props:{date:{type:String,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickAdd","clickEdit","clickDelete","clickChangeStatus","backClick","update"],setup(r,{emit:S}){const s=r,i=P(null),c=S,n=ae(),a=z(),m=A(()=>new Date(s.date));async function d(l){confirm(`Are your sure want to delete todo
'${l==null?void 0:l.title}'`)&&(await a.deleteTodo(l.id),c("update"))}async function C(l,e){confirm(`Are your sure?
want to change status to ${e} 
todo: '${l==null?void 0:l.title}'`)&&(await a.updateTodoStatus(l.id,e),c("update"))}async function D(){var e;const l=(e=i==null?void 0:i.value.items)==null?void 0:e.map($=>$.id);await a.rearrangeMyTodos(l,{date:s.date}),c("update")}return(l,e)=>{var $;return u(),y("div",je,[x(a).error?(u(),y("div",Ue,[e[4]||(e[4]=t("i",{class:"fad fa-exclamation-circle"},null,-1)),t("div",null,T(x(a).error),1)])):f("",!0),t("div",Ve,[t("div",We,[t("button",{class:"fa fa-arrow-left btn-icon mr-2",onClick:e[0]||(e[0]=w(M=>c("backClick"),["prevent"]))}),t("div",qe,T(x(Z)(m.value,{weekDay:"long"}))+" "+T(l.type),1),t("div",ze,[($=i.value)!=null&&$.isItemsChanged?(u(),y("div",Ge,[t("button",{onClick:e[1]||(e[1]=w(()=>D(),["prevent"])),class:"btn-2 disabled:opacity-40 disabled:pointer-events-none",disabled:x(a).updatingPriority}," Save Rearranged ",8,Be),t("button",{onClick:e[2]||(e[2]=w(()=>i.value.resetItems(),["prevent"])),class:"btn-3 disabled:opacity-40 disabled:pointer-events-none",disabled:x(a).updatingPriority}," Discard ",8,Ke)])):f("",!0),t("button",{class:"btn btn-icon",onClick:e[3]||(e[3]=w(M=>c("clickAdd",s.date),["prevent"]))},e[5]||(e[5]=[t("i",{class:"fas fa-plus"},null,-1)]))])]),L(re,{date:r.date,"max-items":"all",class:"my-8 w-full px-4"},{todoItems:E(({allTodos:M})=>[L(ye,{items:M,ref_key:"draggableTodos",ref:i,handle:"handle"},{item:E(({item:h})=>{var g,o,p;return[t("div",{class:W(["border rounded px-4 py-3 my-4 cursor-pointer flex items-center shadow-sm",{"bg-green-100":h.status=="COMPLETED","hover:bg-gray-50":h.status!="COMPLETED"}]),onClick:w(k=>c("clickTodo",h),["prevent"])},[L(ne,{todo:h},null,8,["todo"]),t("div",Ye,[t("div",{class:W(["line-clamp-1",{"text-green-800":h.status=="COMPLETED","text-blue-800":h.status!="COMPLETED"}])},T(h.id)+" - "+T(h.title),3),h.user?(u(),y("div",Je,[L(ve,{user:h.user,"avatar-size":"xsmall"},null,8,["user"]),t("div",Qe,T((o=(g=h.user)==null?void 0:g.department)==null?void 0:o.name),1)])):f("",!0)]),h.todo_type&&h.todo_type_id?(u(),y("div",Xe,T(h.todo_type)+" id: "+T(h.todo_type_id),1)):f("",!0),t("div",Ze,[h.user_id===((p=x(n).user)==null?void 0:p.id)?(u(),y(V,{key:0},[h.status==="WORKING"?(u(),y("button",{key:0,title:"Mark as Completed",class:"btn-icon bg-transparent text-green-400 border-green-400 border hover:bg-green-400 hover:text-white",onClick:w(()=>C(h,"COMPLETED"),["prevent","stop"])},e[6]||(e[6]=[t("i",{class:"fas fa-check"},null,-1)]),8,et)):f("",!0),h.status==="PENDING"?(u(),y("button",{key:1,title:"Start Working",class:"btn-icon bg-transparent text-red-400 border-red-400 border hover:bg-red-400 hover:text-white",onClick:w(()=>C(h,"WORKING"),["prevent","stop"])},e[7]||(e[7]=[t("i",{class:"fas fa-play ml-[4px]"},null,-1)]),8,tt)):f("",!0),t("button",{class:"btn-icon bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:w(k=>c("clickEdit",h),["prevent","stop"])},e[8]||(e[8]=[t("i",{class:"fas fa-pen"},null,-1)]),8,nt),t("button",{class:"btn-icon bg-red-400 text-white hover:bg-red-600 hover:text-white",onClick:w(()=>d(h),["prevent","stop"])},e[9]||(e[9]=[t("i",{class:"fas fa-trash-alt"},null,-1)]),8,ot)],64)):f("",!0),t("button",{onClick:w(()=>null,["stop","prevent"]),class:"btn-icon bg-gray-400 text-white hover:bg-gray-600 hover:text-white handle"},e[10]||(e[10]=[t("i",{class:"fas fa-arrows-alt-v"},null,-1)]))])],10,He)]}),_:2},1032,["items"])]),noTodos:E(()=>e[11]||(e[11]=[t("div",{class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"}," No Todos ",-1)])),_:1},8,["date"])])])}}},at={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md"},lt={key:0,class:"mb-4 text-red-500 font-medium"},it={key:1,class:"mb-4 text-blue-500 font-medium"},rt={class:"flex justify-between items-center gap-4"},dt=["disabled"],de={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(r,{emit:S}){const s=S;return(i,c)=>(u(),y("form",{onSubmit:c[1]||(c[1]=w(n=>s("submit"),["prevent"]))},[N(i.$slots,"default"),t("div",at,[r.error?(u(),y("div",lt,T(r.error),1)):f("",!0),r.isSubmitting?(u(),y("div",it,"Saving changes...")):f("",!0),N(i.$slots,"footer",{},()=>[t("div",rt,[t("button",{type:"button",onClick:c[0]||(c[0]=n=>s("clickCancel")),class:"btn-3"},"Cancel"),t("button",{disabled:r.isSubmitting||r.isLoading,type:"submit",class:"btn-2"},T(r.isSubmitting?"Saving...":"Save"),9,dt)])])])],32))}},ut={class:""},ct={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},mt={class:"mb-2"},yt={class:"mb-4"},vt={class:"mb-4"},pt={__name:"TodoAddForm",props:{date:{type:String,default:ie(new Date)},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(r,{emit:S}){const s=r,i=P(),c=P(),n=z(),a=S,m=P({title:"",date:s.date||"",task_id:""});async function d(){try{i.value="submitting",await n.createTodo(m.value,{returnWith:s.userRole!=="employee"?"user,department,company":""}),a("update")}finally{i.value=""}}const C=A(()=>new Date(s.date));return B(async()=>{var D;await le(),(D=c.value)==null||D.focus()}),(D,l)=>(u(),y("div",ut,[x(n).loading?(u(),F(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:E(()=>l[3]||(l[3]=[U(" Loading... ")])),_:1,__:[3]})):f("",!0),L(de,{onSubmit:d,onClickCancel:l[2]||(l[2]=e=>a("cancelClick")),isSubmitting:i.value=="submitting",error:x(n).error,class:"rounded-md relative"},{default:E(()=>[l[7]||(l[7]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),t("div",ct,[t("div",mt,[l[4]||(l[4]=t("span",{class:"font-semibold"}," Date ",-1)),t("span",null,T(x(Z)(C.value,{weekDay:"long"})),1)]),t("div",yt,[l[5]||(l[5]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),J(t("input",{ref_key:"titleRef",ref:c,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value.title=e),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.title]])]),t("div",vt,[l[6]||(l[6]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),J(t("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>m.value.task_id=e),placeholder:"Enter a task id",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.task_id]])])])]),_:1,__:[7]},8,["isSubmitting","error"])]))}},ft={class:"relative"},gt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},bt={class:"mb-2"},ht={class:"mb-4"},kt={class:"mb-4"},xt={__name:"TodoEditForm",props:{date:{type:String,default:ie(new Date)},todo:{type:Object,default:()=>{}}},emits:["update","cancelClick"],setup(r,{emit:S}){const s=r,i=P(),c=P(),n=z(),a=S,m=P({title:"",todo_type:"task",todo_type_id:""});async function d(){var l,e,$;await n.fetchTodo((l=s.todo)==null?void 0:l.id),m.value.title=(e=n.todo)==null?void 0:e.title,m.value.todo_type_id=($=n.todo)==null?void 0:$.todoable_id}async function C(){i.value="submitting";try{await n.updateTodo(s.todo.id,m.value),a("update")}finally{i.value=""}}const D=A(()=>new Date(s.todo.date));return B(async()=>{var l;await d(),await le(),(l=c.value)==null||l.focus()}),(l,e)=>(u(),y("div",ft,[x(n).loading?(u(),F(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:E(()=>e[3]||(e[3]=[U(" Loading... ")])),_:1,__:[3]})):f("",!0),L(de,{onSubmit:C,onClickCancel:e[2]||(e[2]=$=>a("cancelClick")),isSubmitting:i.value=="submitting",isLoading:x(n).loading,error:x(n).error},{default:E(()=>[e[7]||(e[7]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),t("div",gt,[t("div",bt,[e[4]||(e[4]=t("span",{class:"font-semibold"}," Date ",-1)),t("span",null,T(x(Z)(D.value,{weekDay:"long"})),1)]),t("div",ht,[e[5]||(e[5]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),J(t("input",{ref_key:"titleRef",ref:c,"onUpdate:modelValue":e[0]||(e[0]=$=>m.value.title=$),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.title]])]),t("div",kt,[e[6]||(e[6]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),J(t("input",{"onUpdate:modelValue":e[1]||(e[1]=$=>m.value.todo_type_id=$),placeholder:"Enter a task id",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.todo_type_id]])])])]),_:1,__:[7]},8,["isSubmitting","isLoading","error"])]))}},Ct={class:"relative"},wt={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},Dt={class:"mb-4"},$t={class:"mb-4"},St={key:0,class:"mt-1 flex items-center gap-2"},Tt={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},_t={class:"flex items-center gap-4"},Mt={key:0,class:"flex items-center gap-2"},Et={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},It={key:0,class:"ml-auto flex items-center gap-2"},Ot={__name:"TodoShow",props:{todo:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update"],setup(r,{emit:S}){const s=r,i=z(),c=ae(),n=S;async function a(){var l;await i.fetchTodo((l=s.todo)==null?void 0:l.id)}const m=A(()=>{var l,e;return(l=i.todo)!=null&&l.date?new Date((e=i.todo)==null?void 0:e.date):null}),d=A(()=>{var l;return s.todo.user_id===((l=c.user)==null?void 0:l.id)});async function C(l){var e;confirm(`Are your sure want to delete todo
'${(e=i.todo)==null?void 0:e.title}'`)&&(await i.deleteTodo(l.id),n("update"))}async function D(l,e){var $;confirm(`Are your sure want to compete todo
'${($=i.todo)==null?void 0:$.title}'`)&&(await i.updateTodoStatus(l.id,e),n("update"))}return B(async()=>{await a()}),(l,e)=>{var M,h,g,o,p,k,b,I;const $=ce("UserChip");return u(),y("div",Ct,[x(i).loading?(u(),F(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:E(()=>e[5]||(e[5]=[U(" Loading... ")])),_:1,__:[5]})):f("",!0),t("div",null,[e[11]||(e[11]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),t("div",wt,[t("div",Dt,[e[6]||(e[6]=t("div",{class:"font-semibold text-xs text-gray-500"},"Date",-1)),t("span",null,T(x(Z)(m.value,{weekDay:"long"})),1)]),t("div",$t,[e[7]||(e[7]=t("div",{class:"text-xs text-gray-500"},"Todo",-1)),U(" "+T((M=x(i).todo)==null?void 0:M.title),1)]),r.todo.user?(u(),y("div",St,[L($,{user:r.todo.user,"avatar-size":"xsmall"},null,8,["user"]),t("div",Tt,T((g=(h=r.todo.user)==null?void 0:h.department)==null?void 0:g.name),1)])):f("",!0),t("div",null,[e[10]||(e[10]=t("div",{class:"text-xs text-gray-500"},"Status",-1)),t("div",_t,[t("div",null,[(o=x(i))!=null&&o.todo?(u(),F(ne,{key:0,todo:(p=x(i))==null?void 0:p.todo},null,8,["todo"])):f("",!0),U(" "+T((k=x(i).todo)==null?void 0:k.status),1)]),d.value&&!x(i).loading?(u(),y("div",Mt,[((b=x(i).todo)==null?void 0:b.status)==="PENDING"?(u(),y("button",{key:0,class:"btn-2 from-yellow-700 to-yellow-500 text-white hover:bg-green-600 hover:text-white",onClick:e[0]||(e[0]=w(()=>D(x(i).todo,"WORKING"),["prevent","stop"]))},e[8]||(e[8]=[t("i",{class:"fas fa-exclamation-circle"},null,-1),U(" Change to Working ")]))):f("",!0),((I=x(i).todo)==null?void 0:I.status)==="WORKING"?(u(),y("button",{key:1,class:"btn-2 from-green-700 to-green-300 text-white hover:bg-green-600 hover:text-white",onClick:e[1]||(e[1]=w(()=>D(x(i).todo,"COMPLETED"),["prevent","stop"]))},e[9]||(e[9]=[t("i",{class:"fas fa-check"},null,-1),U(" Make Complete ")]))):f("",!0)])):f("",!0)])])])]),t("div",Et,[t("button",{type:"button",onClick:e[2]||(e[2]=v=>n("cancelClick")),class:"btn-3"},"Cancel"),d.value&&!x(i).loading?(u(),y("div",It,[t("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:e[3]||(e[3]=w(v=>n("clickEdit",x(i).todo),["prevent","stop"]))},e[12]||(e[12]=[t("i",{class:"fas fa-pen"},null,-1),U(" Edit ")])),t("button",{class:"btn-2-red",onClick:e[4]||(e[4]=w(()=>C(x(i).todo),["prevent","stop"]))},e[13]||(e[13]=[t("i",{class:"fas fa-trash-alt"},null,-1),U(" Delete ")]))])):f("",!0)])])}}},Rt={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","update","clickEdit","clickDelete","clickChangeStatus"],setup(r,{emit:S}){const s=S;function i(){s("update")}return(c,n)=>(u(),y(V,null,[r.todoModal.action=="add"?(u(),F(te,{key:0},{default:E(()=>{var a;return[L(pt,{onCancelClick:n[0]||(n[0]=m=>s("cancelClick")),onUpdate:i,date:(a=r.todoModal)==null?void 0:a.date,userRole:r.userRole},null,8,["date","userRole"])]}),_:1})):f("",!0),r.todoModal.action=="edit"?(u(),F(te,{key:1},{default:E(()=>{var a;return[L(xt,{onCancelClick:n[1]||(n[1]=m=>s("cancelClick")),onUpdate:i,todo:(a=r.todoModal)==null?void 0:a.todo,userRole:r.userRole},null,8,["todo","userRole"])]}),_:1})):f("",!0),r.todoModal.action=="show"?(u(),F(te,{key:2},{default:E(()=>{var a;return[L(Ot,{onCancelClick:n[2]||(n[2]=m=>s("cancelClick")),onUpdate:i,onClickEdit:n[3]||(n[3]=m=>s("clickEdit",m)),onClickDelete:n[4]||(n[4]=m=>s("clickDelete",m)),onClickChangeStatus:n[5]||(n[5]=(m,d)=>s("clickChangeStatus",m,d)),todo:(a=r.todoModal)==null?void 0:a.todo,userRole:r.userRole},null,8,["todo","userRole"])]}),_:1})):f("",!0)],64))}},Nt={class:"border bg-white relative"},Wt={__name:"TodoSection",props:{year:{type:Number,default:()=>new Date().getFullYear()},month:{type:Number,default:()=>new Date().getMonth()+1},day:{type:Number,default:()=>new Date().getDate()},week:{type:Number,default:()=>new Date().getDay()},type:{type:String,default:"month-view"},userRole:{type:String,default:"employee"}},emits:["changeInput"],setup(r,{emit:S}){const s=new Date,i=r,c=P({type:"month-view",month:s.getMonth()+1,day:s.getDate(),year:s.getFullYear(),week:s.getDay()}),n=S;Y(()=>({...c.value}),v=>{n("changeInput",v)}),Y(()=>({year:i.year,month:i.month,day:i.day,week:i.week,type:i.type}),v=>{c.value={...v}},{immediate:!0});const a=P({action:null}),m=z();async function d(){await I()}function C(){a.value={...a.value,action:""}}async function D(v,_){await m.updateTodoStatus(v,_)}async function l(v){await m.deleteTodo(v)}function e(){c.value={...c.value,type:"month-view"}}function $(v){c.value={...c.value,...v}}function M(v){const[_,R,O]=v.split("-").map(Number);c.value={...c.value,type:"day-view",year:_,month:R,day:O}}function h(v){a.value={...a.value,action:"show",todo:v}}function g(v){a.value={...a.value,action:"edit",todo:v}}function o(v){a.value={...a.value,action:"add",date:v}}function p(){a.value={action:null,todo:null}}const k=A(()=>{var O,q,j,ee,oe,se;const v=(q=(O=c.value)==null?void 0:O.year)==null?void 0:q.toString(),_=(ee=(j=c.value)==null?void 0:j.month)==null?void 0:ee.toString().padStart(2,"0"),R=(se=(oe=c.value)==null?void 0:oe.day)==null?void 0:se.toString().padStart(2,"0");return`${v}-${_}-${R}`}),b=A(()=>{var R,O,q,j;const v=(O=(R=c.value)==null?void 0:R.year)==null?void 0:O.toString(),_=(j=(q=c.value)==null?void 0:q.month)==null?void 0:j.toString().padStart(2,"0");return`${v}-${_}`});async function I(){i.userRole=="employee"?await m.fetchMyTodos():await m.fetchTodos()}return B(async()=>{await I()}),(v,_)=>(u(),y("div",null,[t("div",Nt,[x(m).loading?(u(),F(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:E(()=>_[0]||(_[0]=[U(" Loading... ")])),_:1,__:[0]})):f("",!0),L(Te,{selected:c.value,class:"border-b shadow z-20",onChange:$,onReloadClick:d},{before:E(R=>[N(v.$slots,"beforeHeader",K(H(R)))]),after:E(R=>[N(v.$slots,"afterHeader",K(H(R)))]),bottom:E(R=>[N(v.$slots,"bottomHeader",K(H(R)))]),typeSelection:E(R=>[N(v.$slots,"typeSelection",K(H(R)))]),_:3},8,["selected"]),c.value.type=="month-view"?(u(),F(Fe,{key:1,month:b.value,class:"bg-white",onDateClick:M,onClickTodo:h,onClickDateCell:o},null,8,["month"])):f("",!0),c.value.type=="day-view"?(u(),F(st,{key:2,date:k.value,userRole:r.userRole,onClickTodo:h,onClickEdit:g,onClickAdd:o,onClickDelete:l,onClickChangeStatus:D,onBackClick:e,onUpdate:C},null,8,["date","userRole"])):f("",!0)]),L(Rt,{todoModal:a.value,userRole:r.userRole,onCancelClick:p,onUpdate:C,onClickEdit:g},null,8,["todoModal","userRole"])]))}};export{be as _,Wt as a};
