import{x as H,c as l,o as n,r as y,h as se,q as He,j as m,a as e,i as D,F,e as Q,t as x,m as V,s as P,d as k,M as ne,l as j,w as N,G as J,p as Le,b as B,k as Oe,v as Ee,C as Be,g as Ue,Q as ze,y as Me,A as Ve,f as Ge,u as We}from"./index-CQpIgpiU.js";import{_ as Fe}from"./TextEditor-ARcAtub0.js";import{s as Ie,_ as Ye}from"./TaskAddForm-CPzv2JJ0.js";import{u as Qe}from"./useCommentStore-DkT_k44f.js";import{O as W}from"./OverlyModal-kfeHtNA2.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{L as re}from"./LoaderView-CFD8gzKE.js";import{_ as Xe}from"./ShareComponent-DiuxoXzS.js";import{_ as De}from"./DepartmentChip-BA4XHd9A.js";import{_ as te}from"./DescriptionView-B7gd_bBn.js";import{i as Je,f as Ne,a as Ze,_ as et,b as tt}from"./TaskTableRow-CpB-dlgy.js";import{b as st,r as rt,c as nt,f as oe,d as at,s as lt}from"./requirement-DppwVAJj.js";import{_ as ot}from"./AttachmentPreview-D5RdrA63.js";import{_ as ee}from"./UserChip-Bl91zrFs.js";import{o as it}from"./url-CePbr-gY.js";import{u as ut}from"./user-CtdgvVq7.js";import{_ as Dn,a as dt}from"./TaskUserAssignForm-DUvBxfkx.js";import{u as mt}from"./useTaskStore-pbYoC6LE.js";import{_ as ct}from"./TaskSelectionInput-DoJpUvTV.js";import{_ as pt}from"./TaskEditForm-D2yyabcg.js";import{T as ae}from"./TextWithHr-6BGd9Mq-.js";import{d as le,b as vt}from"./datetime-BEfC2TVK.js";import{c as bt}from"./dom-Bic1TNqD.js";import{_ as ft}from"./ApproveAndReject-Cia33k1q.js";import"./RequiredIcon-V4d0YXHi.js";import"./company-C9meiv00.js";import"./CompanyDepartmentSelectInput-CiXoWsC6.js";import"./SelectDropdown-DmtO02by.js";import"./SectionLoading-Dzp6wEAh.js";import"./TaskUrgencyInput-C0UPATLQ.js";import"./TaskUrgentBadge-BJ5_qvt5.js";import"./TaskTitle-Dis6g5Jp.js";import"./TaskAssignedUsers-CfcD96x_.js";import"./TaskIsClosedBadge-sqL16Mus.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-BVDyOsfN.js";import"./tags-C70N7ZyH.js";import"./MultiselectDropdown-C9M5v45H.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BUIM1CtL.js";function xt(b){const a=new DOMParser().parseFromString(b,"text/html"),d=/#(\d+)/g;function p(v){v.childNodes.forEach(o=>{if(o.nodeType===Node.TEXT_NODE){const c=o.textContent.replace(d,(s,S)=>`<a href="/requirement-tasks/${S}" class="text-pink-600 hover:underline font-bold">${s}</a>`);if(c!==o.textContent){const s=document.createElement("span");s.innerHTML=c,o.replaceWith(...s.childNodes)}}else p(o)})}return p(a.body),a.body.innerHTML}function yt(b){const a=new DOMParser().parseFromString(b,"text/html"),d=/(https?:\/\/[^\s]+)/g;function p(v){v.childNodes.forEach(o=>{if(o.nodeType===Node.TEXT_NODE){const c=o.textContent.replace(d,s=>`<a href="${s}" target="_blank" class="text-blue-600 hover:underline">
            ${s}
            <i class="fas fa-external-link text-xs text-blue-600"></i>
          </a>`);if(c!==o.textContent){const s=document.createElement("span");s.innerHTML=c,o.replaceWith(...s.childNodes)}}else p(o)})}return p(a.body),a.body.innerHTML}const gt=["innerHTML"],Pe={__name:"HTMLTextBody",props:{message:{type:String,required:!0}},setup(b){const _=b,a=H(()=>yt(xt(_.message)));return(d,p)=>(n(),l("div",{class:"prose prose-sm max-w-none leading-loose text-sm",innerHTML:a.value},null,8,gt))}},_t={class:"space-y-4"},kt={key:0,class:"space-y-2"},ht={class:"text-xs opacity-80"},wt=["onClick"],qt={class:"space-y-4"},$t={key:0,class:"text-sm text-gray-500"},Ct={key:1,class:"text-sm text-gray-500"},Tt={key:0,class:"shrink-0 mt-2"},St={class:"bg-inherit bubble-inner px-4 py-3 rounded-md"},Rt={class:"text-sm font-bold text-gray-800"},jt={class:"text-xs text-gray-400"},It=["onClick"],Dt={key:1,class:"mt-2 space-y-1"},Nt={key:1,class:"shrink-0 mt-2"},At={class:"bg-white rounded-xl shadow-sm border p-4 space-y-3"},Lt={class:"flex items-center gap-2"},Ot={class:"text-sm font-semibold text-gray-700"},Et={class:"flex items-center justify-end gap-2"},Bt=["disabled"],Ut={key:0,class:"text-xs text-red-600"},Mt={class:"bg-white rounded-2xl w-full p-5 space-y-4"},Vt={class:"rounded-xl bg-slate-50 border border-slate-100 p-3 text-sm text-gray-700 max-h-40 overflow-auto"},Ft=["innerHTML"],Pt={__name:"CommentBox",props:{commentableType:{type:String,required:!0},commentableId:{type:[Number,String],required:!0},currentUser:{type:Object,required:!0}},setup(b){const _=b,a=y(!1),d=y(null),p=g=>{d.value=g,a.value=!0},v=()=>{a.value=!1,d.value=null},o=async()=>{if(!d.value)return;const g=d.value.id;v(),await O(g)},c=y([]),s=y({}),S=g=>{g&&c.value.push({id:crypto.randomUUID(),message:g,time:new Date().toISOString()})},u=(g,R)=>{!g||!R||(s.value[g]||(s.value[g]=[]),s.value[g].push(R))},r=g=>{s.value[g]=[]},i=Qe(),f=H(()=>i.comments),h=H(()=>i.loading),w=H(()=>i.error),q=y(""),A=y(!1),$=async()=>{await i.fetchComments({commentable_type:_.commentableType,commentable_id:_.commentableId})},I=async()=>{if(!(!q.value||!Ie(String(q.value)).trim())){A.value=!0;try{await i.createComment({commentable_type:_.commentableType,commentable_id:Number(_.commentableId),user_id:_.currentUser.id,message:q.value}),q.value=""}catch(g){S(g.message)}finally{A.value=!1}}},O=async g=>{var R,L;r(g);try{await i.deleteComment(g)}catch(t){u(g,(L=(R=t.response)==null?void 0:R.data)==null?void 0:L.message)}};se($),He(()=>[_.commentableType,_.commentableId],()=>$());const Z=g=>g?new Date(g).toLocaleString():"",C=g=>(g==null?void 0:g.user_id)===_.currentUser.id,E=g=>(g==null?void 0:g.user_id)===_.currentUser.id;return(g,R)=>{var L;return n(),l("div",_t,[c.value.length?(n(),l("div",kt,[(n(!0),l(F,null,Q(c.value,t=>(n(),l("div",{key:t.id,class:"rounded-xl border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-700 flex items-start justify-between gap-3"},[e("div",null,[R[1]||(R[1]=e("p",{class:"font-semibold"},"Error",-1)),e("p",ht,x(t.message),1)]),e("button",{class:"text-xs text-red-500 hover:underline",onClick:z=>c.value=c.value.filter(U=>U.id!==t.id)}," Dismiss ",8,wt)]))),128))])):m("",!0),e("div",qt,[h.value&&V(i).action=="fetching"?(n(),l("div",$t," Loading comments... ")):f.value.length?m("",!0):(n(),l("div",Ct,"No comments yet.")),(n(!0),l(F,null,Q(f.value,t=>{var z,U;return n(),l("div",{key:t.id,class:P(["flex gap-3",E(t)?"justify-end":"justify-start"])},[E(t)?m("",!0):(n(),l("div",Tt,[k(ne,{user:t.user},null,8,["user"])])),e("div",{class:P(["group relative min-w-[25%] max-w-[90%] rounded-md shadow border bubble-arrow",E(t)?"bubble-right bg-indigo-50 border-indigo-100":"bubble-left bg-white border-gray-100"])},[e("div",St,[e("div",{class:P(["flex items-center gap-2 mb-2 pb-1 border-b border-dashed",E(t)?"justify-end":"justify-start"])},[e("p",Rt,x(E(t)?"You":((z=t.user)==null?void 0:z.name)||"Unknown"),1),R[2]||(R[2]=e("span",{class:"text-xs text-gray-400"},"•",-1)),e("p",jt,x(Z(t.created_at)),1)],2),k(Pe,{message:t.message},null,8,["message"]),C(t)?(n(),l("div",{key:0,class:P(["mt-2 flex",E(t)?"justify-end":"justify-start"])},[e("button",{class:"text-[11px] text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100",onClick:G=>p(t)}," Delete ",8,It)],2)):m("",!0),(U=s.value[t.id])!=null&&U.length?(n(),l("div",Dt,[(n(!0),l(F,null,Q(s.value[t.id],(G,K)=>(n(),l("p",{key:K,class:P(["text-xs text-red-600",E(t)?"text-right":"text-left"])},x(G),3))),128))])):m("",!0)])],2),E(t)?(n(),l("div",Nt,[k(ne,{user:t.user||b.currentUser},null,8,["user"])])):m("",!0)],2)}),128))]),e("div",At,[e("div",Lt,[k(ne,{user:b.currentUser},null,8,["user"]),e("div",Ot,x(((L=b.currentUser)==null?void 0:L.name)||"You"),1)]),k(Fe,{modelValue:q.value,"onUpdate:modelValue":R[0]||(R[0]=t=>q.value=t)},null,8,["modelValue"]),e("div",Et,[e("button",{class:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm disabled:opacity-60",disabled:A.value||!V(Ie)(String(q.value)).trim(),onClick:I},x(A.value?"Posting...":"Post Comment"),9,Bt)]),w.value?(n(),l("p",Ut,x(w.value),1)):m("",!0)]),a.value?(n(),D(W,{key:1},{default:j(()=>{var t;return[e("div",Mt,[R[3]||(R[3]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete comment?",-1)),R[4]||(R[4]=e("p",{class:"text-sm text-gray-600 leading-relaxed"}," আপনি কি নিশ্চিত যে এই কমেন্টটি মুছে ফেলতে চান? মুছে ফেলা কমেন্ট পুনরুদ্ধার করা যাবে না। ",-1)),e("div",Vt,[e("div",{innerHTML:(t=d.value)==null?void 0:t.message},null,8,Ft)]),e("div",{class:"flex items-center justify-end gap-2 pt-2"},[e("button",{class:"px-4 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-50",onClick:v}," Cancel "),e("button",{class:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700",onClick:o}," Yes, Delete ")])])]}),_:1})):m("",!0)])}}},Ht=Ke(Pt,[["__scopeId","data-v-44914bc3"]]),zt={class:"flex items-center border-b w-full pb-2"},Gt={class:""},Wt={class:"mt-4 border h-40 flex items-center flex-col justify-center rounded border-dashed bg-red-50 text-center"},Yt={key:1,class:"text-red-500 text-center mt-2"},Qt={class:"flex items-center justify-between mt-4"},Kt={__name:"RequirementAttachmentForm",props:{requirementId:[String,Number],default:()=>null},emits:["uploaded","error","clickBack"],setup(b,{emit:_}){const a=b,d=y({attachments:[]}),p=y(""),v=y(""),o=_;function c(u){d.value.attachments=[...d.value.attachments,...Array.from(u.target.files)]}function s(u){d.value.attachments.splice(u,1)}async function S(){var r,i,f,h;p.value="submitting";const u=new FormData;for(const w in d.value)w==="attachments"?d.value.attachments.forEach(q=>u.append("attachments[]",q)):u.append(w,d.value[w]);try{const w=await st(a.requirementId,u);d.value.attachments=[],o("uploaded",w),p.value="uploaded"}catch(w){o("error",(i=(r=w.response)==null?void 0:r.data)==null?void 0:i.message),v.value=(h=(f=w.response)==null?void 0:f.data)==null?void 0:h.message,p.value="error"}}return(u,r)=>{var i;return n(),l("form",{class:"p-4 flex flex-col relative",onSubmit:N(S,["prevent"])},[p.value=="submitting"?(n(),D(re,{key:0,class:"absolute inset-0 bg-opacity-80 flex items-center justify-center"})):m("",!0),e("div",zt,[r[3]||(r[3]=e("h3",null,"Requirement Attachment",-1)),e("button",{class:"btn-icon ml-auto",onClick:r[0]||(r[0]=N(()=>{o("clickBack")},["prevent"]))},r[2]||(r[2]=[e("span",{class:"fas fa-times"},null,-1)]))]),e("div",Gt,[e("label",Wt,[r[4]||(r[4]=e("div",{class:"block text-gray-600 font-medium text-sm md:text-xl mb-4"}," Click to Select files or Drop Here ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",class:"border rounded-r-md text-gray-600 bg-gray-50",onChange:c},null,32)])]),k(ot,{files:((i=d.value)==null?void 0:i.attachments)||[],onRemove:s,class:"border p-1 rounded overflow-y-auto flex-grow"},null,8,["files"]),r[6]||(r[6]=e("hr",{class:"mt-4"},null,-1)),v.value?(n(),l("div",Yt,x(v.value),1)):m("",!0),e("div",Qt,[e("button",{class:"btn-3",onClick:r[1]||(r[1]=N(f=>o("clickBack"),["prevent"]))},"Cancel"),r[5]||(r[5]=e("button",{class:"btn-2"},"Save",-1))])],32)}}},Xt={class:"card-bg p-4 pt-2"},Jt={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 w-full"},Zt=["onClick"],es=["src"],ts=["href"],ss={key:2,class:"text-xs text-gray-500 text-center"},rs={__name:"RequirementAttachments",props:{requirement:{type:Array,default:()=>[]}},setup(b){const _=b,a=H(()=>{var v;return((v=_.requirement)==null?void 0:v.attachments)||[]}),d=J({show:!1}),p=J({show:!1,selectedFile:""});return(v,o)=>(n(),l("div",Xt,[e("div",null,[o[6]||(o[6]=e("h4",{class:"text-gray-900 font-semibold mb-3 border-b font-e"},"Attachments",-1)),e("div",Jt,[a.value&&a.value.length?(n(!0),l(F,{key:0},Q(a.value,(c,s)=>(n(),l("div",{key:s,class:"border p-1 rounded aspect-square flex items-center justify-center bg-gray-50 relative",tabindex:"0",onClick:N(()=>{p.show=!0,p.selectedFile=c},["prevent"])},[V(Je)(c)?(n(),l("img",{key:0,src:V(Ne)(c),alt:"attachment",class:"object-cover w-full h-full rounded"},null,8,es)):V(Ze)(c)?(n(),l("a",{key:1,href:V(Ne)(c),target:"_blank",class:"text-xs text-blue-600 text-center break-words hover:underline"},o[4]||(o[4]=[e("i",{class:"fas fa-file-pdf fa-2x mb-1 text-amber-700"},null,-1),e("div",{class:"whitespace-nowrap text-xs mt-1"},"Open PDF",-1)]),8,ts)):(n(),l("span",ss,"Unknown"))],8,Zt))),128)):m("",!0),e("button",{title:"Add Attachments",onClick:o[0]||(o[0]=N(c=>d.show=!d.show,["prevent"])),class:"border rounded aspect-square flex items-center justify-center bg-sky-50 hover:bg-sky-100 relative group/btn"},o[5]||(o[5]=[e("i",{class:"fas fa-plus-circle text-2xl text-blue-300 group-hover/btn:text-blue-500"},null,-1)]))])]),d.show?(n(),D(W,{key:0},{default:j(()=>[k(Kt,{onClickBack:o[1]||(o[1]=c=>d.show=!1),onUploaded:o[2]||(o[2]=c=>d.show=!1),requirementId:b.requirement.id,class:"max-h-[70vh]"},null,8,["requirementId"])]),_:1})):m("",!0),p.show?(n(),D(W,{key:1,class:"*:max-w-4xl *:min-h-[60vh]"},{default:j(()=>[k(et,{attachments:a.value,selected:p.selectedFile,onClickClose:o[3]||(o[3]=c=>p.show=!1)},null,8,["attachments","selected"])]),_:1})):m("",!0)]))}},ns={class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},as={class:"text-sm flex flex-col xl:flex-row items-center mt-2 xl:mt-0 gap-x-2 text-red-400 font-semibold whitespace-nowrap"},ls={class:"mt-[2px]"},os={key:0,class:"text-gray-800 flex items-center gap-2"},is={key:1,class:"text-gray-800 w-full my-2 text-center"},us={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},ds=["innerHTML"],ms={key:1,class:"flex gap-4 items-center justify-center mt-2"},cs={key:2,class:"mb-2"},ps={class:"flex justify-end text-sky-500"},vs={key:3,class:"text-center w-full"},bs={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick","closeClick","showHistoryClick"],setup(b,{emit:_}){const a=_;return(d,p)=>{var v,o;return n(),l("div",ns,[b.requirement.closed_at?(n(),l(F,{key:0},[p[6]||(p[6]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",as,[p[3]||(p[3]=e("span",{class:"flex items-center gap-2 text-gray-600"},[e("span",{class:"fad fa-lock"}),e("span",{class:"mt-[2px]"},"CLOSED AT")],-1)),e("span",ls,x(new Date(b.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),b.requirement.closed_by_user?(n(),l("div",os,[p[4]||(p[4]=e("span",{class:"text-sm"},"Closed by",-1)),k(ee,{user:b.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):m("",!0),b.requirement.closing_note?(n(),l("div",is,[p[5]||(p[5]=e("div",{class:"text-xs text-left"},"Note",-1)),e("div",us,[e("p",{innerHTML:b.requirement.closing_note},null,8,ds)])])):m("",!0)],64)):m("",!0),b.requirement.closed_at?(n(),l("div",ms,[e("button",{class:"btn-2 h-8",onClick:p[0]||(p[0]=N(c=>a("reOpenClick"),["prevent"]))},"Re Open")])):m("",!0),b.requirement.closed_at?m("",!0):(n(),l("div",cs,[e("div",ps,[e("button",{class:"btn-1 border border-sky-800",onClick:p[1]||(p[1]=N(c=>a("closeClick"),["prevent"]))}," Close Requirement ")])])),((o=(v=b.requirement)==null?void 0:v.closing_history)==null?void 0:o.length)>1?(n(),l("div",vs,[e("button",{onClick:p[2]||(p[2]=c=>a("showHistoryClick")),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):m("",!0)])}}},fs={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},xs={class:"my-6"},ys={class:"text-center font-semibold text-blue-800 mb-4"},gs={class:"text-center my-1"},_s={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},ks={class:"mt-4"},hs=["placeholder","required"],ws={class:"flex"},qs={class:"text-red-600 text-center mt-2 text-sm"},$s={class:"flex justify-between mt-3"},Cs=["disabled"],Ts={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(b,{emit:_}){const a=b,d=_,p=H({get:()=>a.loading,set:()=>d("update:loading")}),v=y(""),o=y(""),c=y(255),s=H(()=>c.value-v.value.length);async function S(){var u,r,i;p.value=!0;try{(u=a.requirement)!=null&&u.closed_at?await rt(a.requirement.id,v.value):await nt(a.requirement.id,v.value),d("updateStatus")}catch(f){o.value=(i=(r=f.response)==null?void 0:r.data)==null?void 0:i.message,d("error")}finally{p.value=!1}}return(u,r)=>{var f,h,w,q,A;const i=Le("LoaderView");return n(),l("form",{class:"p-4 rounded relative border",onSubmit:N(S,["prevent"])},[p.value?(n(),D(i,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:j(()=>r[3]||(r[3]=[B(" Submitting! ")])),_:1,__:[3]})):m("",!0),e("h3",fs,x((f=b.requirement)!=null&&f.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",xs,[e("div",ys,x((h=b.requirement)==null?void 0:h.title),1),r[6]||(r[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",gs,[r[4]||(r[4]=B(" Want to ")),e("span",_s,x((w=b.requirement)!=null&&w.closed_at?"Re-Open":"Close"),1),r[5]||(r[5]=B(" the requirement? "))]),e("div",ks,[Oe(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=$=>v.value=$),rows:"4",placeholder:`Write about why are you ${(q=b.requirement)!=null&&q.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:u.currentAction==="reject",onInput:r[1]||(r[1]=$=>v.value.length>c.value?v.value=v.value.slice(0,c.value):null)},null,40,hs),[[Ee,v.value]]),e("div",ws,[e("div",{class:P(["ml-auto inline-block text-sm text-gray-500",v.value.length>=c.value?"text-red-500":""])}," left "+x(s.value)+"/"+x(c.value)+" words ",3)])])]),r[7]||(r[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",qs,x(o.value),1),e("div",$s,[e("button",{class:"btn-3",onClick:r[2]||(r[2]=N($=>d("clickCancel"),["prevent"]))},"Cancel"),e("button",{class:"btn-2 disabled:opacity-45",disabled:v.value.trim().length==0},x((A=b.requirement)!=null&&A.closed_at?"Re-Open Requirement":"Close Requirement"),9,Cs)])])],32)}}};async function Ss(b,_,{params:a={}}={}){return Be.get(`/requirements/${b}/details/${_}`,{params:a})}async function Rs(b,_,{params:a={}}={}){const d=it(a);return Be.delete(`/requirements/${b}/details/${_}${d?"?"+d:""}`)}const js={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Is={class:"mb-4"},Ds={class:"font-semibold"},Ns={class:"mb-4"},As={class:"line-clamp-2"},Ls={key:1,class:"min-h-40"},Os={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Es={key:0,class:"mb-4 text-red-500 font-medium"},Bs={key:1,class:"mb-4"},Us={class:"flex items-center justify-between gap-4"},Ms=["disabled"],Vs={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(b,{emit:_}){const a=b,d=_,p=ut(),v=y(null),o=y(""),c=y(),s=y([]);async function S(){var u,r;o.value="submitting";try{const i=await Rs(a.requirementId,a.detailId);d("delete",i),o.value="create"}catch(i){o.value="error",c.value=((r=(u=i.response)==null?void 0:u.data)==null?void 0:r.message)||"Failed to update requirement detail: "+i,d("error",c.value)}}return se(async()=>{var u,r,i;o.value="loading";try{s.value=await p.fetchDepartmentWiseEmployees(),v.value=(u=(await Ss(a.requirementId,a.detailId)).data)==null?void 0:u.detail}catch(f){c.value=((i=(r=f.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to fetch requirement detail"}finally{o.value=""}}),(u,r)=>{var i,f;return n(),l("div",js,[r[4]||(r[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:N(S,["prevent"]),class:"z-0"},[o.value!=="loading"?(n(),l(F,{key:0},[e("div",Is,[r[1]||(r[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Ds,x((i=v.value)==null?void 0:i.title),1)]),e("div",Ns,[r[2]||(r[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",As,x((f=v.value)==null?void 0:f.description),1)]),r[3]||(r[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),l("div",Ls)),e("div",Os,[c.value?(n(),l("div",Es,x(c.value),1)):m("",!0),c.value?(n(),l("hr",Bs)):m("",!0),e("div",Us,[e("button",{type:"button",onClick:r[0]||(r[0]=N(h=>d("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},x(o.value=="submitting"?"Deleting...":"Delete"),9,Ms)])])],32),o.value==="loading"||o.value==="submitting"?(n(),D(re,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):m("",!0)])}}};const Fs={class:"sticky top-0 pt-4 bg-white z-10"},Ps={class:"mb-4"},Hs={class:"mb-4"},zs={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Gs={key:0,class:"mb-4 text-red-500 font-medium"},Ws={key:1,class:"mb-4"},Ys={class:"flex items-center justify-between gap-4"},Qs=["disabled"],Ks={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(b,{emit:_}){const a=b,d=_,p=y(),v=y(null),o=y(""),c=y(),s=y({feedback:""});async function S(){var u,r;o.value="submitting";try{const i=await at(a.requirementId,s.value.feedback);d("update",i),o.value="create"}catch(i){o.value="error",c.value=((r=(u=i.response)==null?void 0:u.data)==null?void 0:r.message)||"Failed to update requirement requirement",d("error",c.value)}}return se(async()=>{var u,r,i,f;o.value="loading";try{await oe(a.requirementId),v.value=(u=(await oe(a.requirementId)).data)==null?void 0:u.requirement,s.value={feedback:(r=v.value)==null?void 0:r.feedback}}catch(h){c.value=((f=(i=h.response)==null?void 0:i.data)==null?void 0:f.message)||"Failed to fetch requirement requirement"}finally{o.value=""}}),(u,r)=>{var i;return n(),l("div",{ref_key:"formContainerRef",ref:p,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Fs,[r[3]||(r[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),r[4]||(r[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=N(f=>d("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:N(S,["prevent"]),class:"z-0"},[o.value!=="loading"?(n(),l(F,{key:0},[e("div",Ps,[r[5]||(r[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),k(te,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:j(()=>{var f;return[B(x((f=v.value)==null?void 0:f.title),1)]}),_:1})]),e("div",Hs,[r[6]||(r[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),k(Fe,{modelValue:s.value.feedback,"onUpdate:modelValue":r[1]||(r[1]=f=>s.value.feedback=f)},null,8,["modelValue"])])],64)):m("",!0),e("div",zs,[c.value?(n(),l("div",Gs,x(c.value),1)):m("",!0),c.value?(n(),l("hr",Ws)):m("",!0),e("div",Ys,[e("button",{type:"button",onClick:r[2]||(r[2]=N(f=>d("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"btn-2"},x(o.value=="submitting"?"Saving...":(i=v.value)!=null&&i.feedback?"Update Feedback":"Add Feedback"),9,Qs)])])],32),o.value==="loading"||o.value==="submitting"?(n(),D(re,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):m("",!0)],512)}}},Xs={class:"flex justify-center items-center"},Js={class:"modal-card"},Zs=["required"],er={class:"flex"},tr={class:"flex justify-between gap-2 mt-4"},sr=["disabled"],rr=["disabled"],nr={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(b,{emit:_}){const a=b,d=_,p=y(255),v=H(()=>p.value-u.value.length),o=ze(),c=y(null),s=y(null),S=y(null),u=y(""),r=y(!1),i=H(()=>S.value!==null);function f($){S.value=$,u.value="",A()}function h(){S.value=null,u.value=""}async function w(){var $,I;if(S.value==="reject"&&!u.value)return o.error("Rejection Reason is required!");if(typeof a.onSubmit=="function")return a.onSubmit({note:u.value,action:S.value});d("loading",!0),r.value=!0;try{await lt(a.requirementId,{note:u.value}),d("success"),h()}catch(O){return d("error",O),o.error(((I=($=O==null?void 0:O.response)==null?void 0:$.data)==null?void 0:I.message)||"Submission failed!")}finally{d("loading",!1),r.value=!1}}function q($){var I,O;i.value&&($.key==="ArrowLeft"?(I=s.value)==null||I.focus():$.key==="ArrowRight"&&((O=c.value)==null||O.focus()))}function A(){Ve(()=>{var $;($=c.value)==null||$.focus()})}return se(()=>{window.addEventListener("keydown",q)}),Me(()=>{window.removeEventListener("keydown",q)}),($,I)=>(n(),l("div",null,[e("div",Xs,[e("button",{onClick:I[0]||(I[0]=O=>f("accept"))},I[3]||(I[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),i.value?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:N(h,["self"])},[e("div",Js,[I[4]||(I[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Oe(e("textarea",{"onUpdate:modelValue":I[1]||(I[1]=O=>u.value=O),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:S.value==="reject",onInput:I[2]||(I[2]=O=>u.value.length>p.value?u.value=u.value.slice(0,p.value):null)},null,40,Zs),[[Ee,u.value]]),e("div",er,[e("div",{class:P(["ml-auto inline-block text-sm text-gray-500",u.value.length>=p.value?"text-red-500":""])}," left "+x(v.value)+"/"+x(p.value)+" words ",3)])]),e("div",tr,[e("button",{ref_key:"cancelBtnRef",ref:s,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:h,disabled:r.value}," Cancel ",8,sr),e("button",{ref_key:"confirmBtnRef",ref:c,class:P(["focus:ring-2 ring-offset-2 disabled:opacity-30",S.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:w,disabled:r.value}," Confirm Submission ",10,rr)])])])):m("",!0)]))}},ar={class:"flex items-center gap-6 justify-center my-16"},lr={key:0,class:"border rounded-md"},or={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(b,{emit:_}){const a=b,d=_,p=mt(),v=y(""),o=y(null),c=y(""),s=y(!1);async function S(){await p.setTaskRequirement(c.value,a.requirement.id),d("assignTask")}return(u,r)=>(n(),l("div",{class:P(["text-left p-4",[v.value&&!o.value?"min-h-[400px]":""]])},[e("div",ar,[e("button",{onClick:r[0]||(r[0]=N(i=>d("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),r[5]||(r[5]=e("span",null,"or",-1)),e("button",{class:P({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:r[1]||(r[1]=N(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value&&!o.value?(n(),l("div",lr,[e("form",{onSubmit:N(S,["prevent"]),class:"p-4 flex items-end"},[k(ct,{class:"flex-grow mr-4 h-12",taskId:c.value,"onUpdate:taskId":r[2]||(r[2]=i=>c.value=i),show:s.value,"onUpdate:show":r[3]||(r[3]=i=>s.value=i),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":b.fromDepartmentId},filterTasks:i=>!i.requirement_id,onAddNewTaskClick:r[4]||(r[4]=i=>d("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),r[6]||(r[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):m("",!0)],2))}},ir={class:"flex flex-col items-center gax-x-1 justify-end"},ur={key:0},dr={key:1},mr={class:"text-sm text-gray-600 whitespace-normal w-64"},cr={class:"text-gray-900 font-semibold text-sm md:text-base"},pr={class:"ml-2"},vr={key:0,class:"text-red-700 text-sm"},br={key:1,class:"text-green-600 ml-2"},fr={key:2,class:"ml-2 text-yellow-700"},Ae={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(b,{emit:_}){const a=b,d=_,p=Ue(),v=H(()=>{var u,r,i,f,h;return{from_in_charge:!!((u=a.requirement)!=null&&u.status&&((r=a.requirement)!=null&&r.submission_date)),from_coordinator:!!((i=a.requirement)!=null&&i.from_coordinator),to_in_charge:!!((f=a.requirement)!=null&&f.to_incharge),to_coordinator:!!((h=a.requirement)!=null&&h.to_coordinator)}}),o=H(()=>{var u,r,i,f,h,w,q,A;return{from_in_charge:(r=(u=a.requirement)==null?void 0:u.from_department)==null?void 0:r.in_charge,from_coordinator:(f=(i=a.requirement)==null?void 0:i.from_department)==null?void 0:f.coordinator,to_in_charge:(w=(h=a.requirement)==null?void 0:h.to_department)==null?void 0:w.in_charge,to_coordinator:(A=(q=a.requirement)==null?void 0:q.to_department)==null?void 0:A.coordinator}}),c=H(()=>{var f;const u=Object.keys(v.value),r=u.indexOf(a.approvalType);let i=!0;for(let h=r-1;h>=0;h--){const w=u[h];i=i&&(o.value[w]?(f=v.value)==null?void 0:f[w]:!0)}return i}),s=H(()=>{var w,q,A,$,I,O,Z,C,E,g,R,L,t,z,U,G;let u=null,r=null,i="",f="";a.approvalType==="from_in_charge"&&(u=(w=a.requirement)==null?void 0:w.from_department,r=(A=(q=a.requirement)==null?void 0:q.from_department)==null?void 0:A.in_charge,i="In Charge",f=($=a.requirement)==null?void 0:$.from_incharge_note),a.approvalType==="from_coordinator"&&(u=(I=a.requirement)==null?void 0:I.from_department,r=(O=a.requirement)==null?void 0:O.from_coordinator,i="Coordinator",f=(Z=a.requirement)==null?void 0:Z.from_coordinator_note),a.approvalType==="to_in_charge"&&(u=(C=a.requirement)==null?void 0:C.to_department,r=(E=a.requirement)==null?void 0:E.to_in_charge,i="In Charge",f=(g=a.requirement)==null?void 0:g.to_incharge_note),a.approvalType==="to_coordinator"&&(u=(R=a.requirement)==null?void 0:R.to_department,r=(L=a.requirement)==null?void 0:L.to_coordinator,i="Coordinator",f=(t=a.requirement)==null?void 0:t.to_coordinator_note);const h=(z=o.value)==null?void 0:z[a.approvalType];return{department:u,department_user:h,approved:(U=v.value)==null?void 0:U[a.approvalType],approval_user:r,is_rejected:((G=a.requirement)==null?void 0:G.rejected_by_user_id)==(h==null?void 0:h.id),userType:i,approval_note:f}});function S(){d("updateApproval")}return(u,r)=>{var i,f,h,w,q,A;return n(),l("div",ir,[s.value.department_user?(n(),l("div",ur,[k(ee,{user:s.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),l("div",dr,r[0]||(r[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",mr,[s.value.is_rejected?(n(),D(te,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:j(()=>[B(x(b.requirement.rejection_reason),1)]),_:1})):(n(),D(te,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:j(()=>[B(x(s.value.approval_note),1)]),_:1}))]),e("div",null,[!s.value.is_rejected&&!s.value.approved&&c.value&&((i=V(p).user)==null?void 0:i.id)==((h=(f=s.value)==null?void 0:f.department_user)==null?void 0:h.id)?(n(),D(ft,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(w=a.requirement)==null?void 0:w.id,onSuccess:S,variant:1},null,8,["applicationId"])):m("",!0)]),r[2]||(r[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",cr,[e("span",null,x(((q=s.value.department)==null?void 0:q.short_name)||((A=s.value.department)==null?void 0:A.name)),1),e("span",pr,x(s.value.userType),1),s.value.department_user?(n(),l(F,{key:0},[s.value.is_rejected?(n(),l("span",vr," (Rejected)")):s.value.approved?(n(),l("span",br,"(✔)")):(n(),l("span",fr,r[1]||(r[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):m("",!0)])])}}},xr={class:"container mx-auto print:p-0 w-full print:max-w-full"},yr={class:"border-b px-3 py-1 bg-gray-50 flex items-center justify-between rounded-t-md"},gr={key:0,class:"p-3 max-h-[50vh] overflow-auto"},_r={class:"border table-auto w-full"},kr={class:"border-y px-4 py-2 text-right"},hr={class:"border-y pr-4 py-2 whitespace-nowrap"},wr={class:"border-y px-4 py-2"},qr={class:"line-clamp-2 text-sm text-amber-950"},$r={class:"border-y px-4 py-2 text-center"},Cr={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},Tr={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},Sr={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},Rr={class:"text-center text-xl font-bold mb-2 flex items-center"},jr={class:"mb-8"},Ir={class:"text-lg font-semibold mb-2"},Dr={class:"flex gap-4 items-center text-gray-500"},Nr={class:"text-sm"},Ar={key:0,class:"flex items-center gap-1"},Lr={key:0,class:"mb-5"},Or={class:"mb-8"},Er={class:"font-semibold text-lg px-2"},Br={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},Ur={class:"w-full border-collapse"},Mr={key:0},Vr={class:"mb-8"};const Fr={key:2,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Pr={class:"flex flex-col items-end"},Hr={key:3,class:"mt-6 mb-8 break-before-avoid-page"},zr={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},Gr={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},Wr={class:"bg-white shadow rounded-lg space-y-4 p-4 mb-4"},Yr={class:"border col-span-3 p-3 rounded-md"},Qr={class:"flex items-center gap-2 mb-4"},Kr={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},Xr={class:"flex items-center gap-2 mb-4"},Jr={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},Zr={class:"font-bold print:text-gray-900"},en={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},tn={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},sn={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},rn={class:"print:text-gray-900 text-sm text-right"},nn={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},an={class:"print:text-gray-900 text-sm text-right"},ln={class:"flex justify-between items-center mb-4"},on={class:"mb-4"},un={class:"flex justify-between items-center"},dn={key:1,class:"text-red-600"},mn={key:0,class:"mb-2"},cn={class:"flex justify-between items-center"},pn={key:1,class:"mb-4 text-red-700 text-sm flex justify-between"},vn={key:2,class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},ea={__name:"RequirementShow",setup(b){const _=Ge(),a=We(),d=y(""),p=Ue(),v=y(),o=y(!1),c=y(),s=y(null),S=J({detail:null,open:!1}),u=J({detail:null,open:!1}),r=J({detail:null,open:!1}),i=y(!1),f=()=>i.value=!0,h=()=>i.value=!1,w=y(),q=y({isOpen:!1,taskId:null});se(async()=>{await $(),window.addEventListener("beforeprint",f),window.addEventListener("afterprint",h),window.addEventListener("resize",A),await Ve(),bt(v.value,()=>{})});function A(){}Me(()=>{window.removeEventListener("beforeprint",f),window.removeEventListener("afterprint",h),window.removeEventListener("resize",A)});async function $(){var L;d.value="loading",s.value=(L=(await oe(_.params.id)).data)==null?void 0:L.requirement,d.value=""}function I(){var L,t,z,U,G,K,ie,ue,de;if(p.user.role!=="super_admin"&&((L=p.user)==null?void 0:L.id)!==((z=(t=s.value)==null?void 0:t.to_department)==null?void 0:z.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(G=(U=s.value)==null?void 0:U.to_department)==null?void 0:G.name}'s In charge can create or assign.`);console.log({requirement:s}),C.modalShown=!0,C.from_department_id=s.value.from_department_id,C.to_department_id=s.value.to_department_id,C.taskDefaultValues={title:"",description:"",from_department_id:s.value.from_department_id,to_department_id:s.value.to_department_id,is_important:((K=s.value)==null?void 0:K.priority)=="IMPORTANT",is_urgent:((ie=s.value)==null?void 0:ie.priority)=="URGENT",supervisor_ids:(ue=s.value)!=null&&ue.supervisor_id?[(de=s.value)==null?void 0:de.supervisor_id]:[]},C.requirement=s.value}function O(L){S.open=!0,S.detail=L}function Z(L){r.open=!0,r.detail=L}const C=J({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function E(){w.value=null,C.modalShown=!1,await $()}async function g(){C.modalShown=!1,C.requirement=null,C.creating=!1}const R=y({open:!1});return(L,t)=>{var U,G,K,me,ce,pe,ve,be,fe,xe,ye,ge,_e,ke,he,we,qe,$e,Ce,Te,Se,Re;const z=Le("RouterLink");return n(),l("div",xr,[u.open?(n(),D(W,{key:0},{default:j(()=>{var T;return[k(Ks,{requirementId:s.value.id,detailId:(T=u.requirement.value)==null?void 0:T.id,onCloseClick:t[0]||(t[0]=Y=>u.open=!1),onUpdate:t[1]||(t[1]=async()=>{u.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):m("",!0),r.open?(n(),D(W,{key:1},{default:j(()=>{var T;return[k(Vs,{requirementId:s.value.id,detailId:(T=r.requirement.value)==null?void 0:T.id,onCloseClick:t[2]||(t[2]=Y=>r.open=!1),onDelete:t[3]||(t[3]=async()=>{r.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):m("",!0),C.modalShown?(n(),D(W,{key:2,class:"*:relative"},{default:j(()=>{var T,Y;return[e("button",{onClick:N(g,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},t[20]||(t[20]=[e("i",{class:"fas fa-times-circle"},null,-1)])),C!=null&&C.creating?m("",!0):(n(),D(or,{key:0,"from-department-id":(T=s.value)==null?void 0:T.from_department_id,requirement:C==null?void 0:C.requirement,onCancelClick:g,onAddNewTaskClick:t[4]||(t[4]=()=>{C.modalShown=!0,C.creating=!0}),onAssignTask:E},null,8,["from-department-id","requirement"])),C!=null&&C.creating?(n(),D(Ye,{key:1,requirementDetailId:(Y=C==null?void 0:C.requirement.value)==null?void 0:Y.id,requirementId:s.value.id,onClose:g,onTaskCreated:E,defaultValues:C.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):m("",!0)]}),_:1})):m("",!0),w.value?(n(),D(W,{key:3},{default:j(()=>[k(pt,{taskId:w.value,onClose:t[5]||(t[5]=T=>w.value=null),onUpdated:E},null,8,["taskId"])]),_:1})):m("",!0),q.value.isOpen?(n(),D(W,{key:4,class:"*:max-w-4xl"},{default:j(()=>[k(dt,{taskId:q.value.taskId,onCancelClick:t[6]||(t[6]=()=>{q.value.isOpen=!1,q.value.taskId=0}),onSuccess:t[7]||(t[7]=()=>{q.value.isOpen=!1,q.value.taskId=0,d.value="loading",$()})},null,8,["taskId"])]),_:1})):m("",!0),R.value.open?(n(),D(W,{key:5},{default:j(()=>[k(Ts,{requirement:s.value,onClickCancel:t[8]||(t[8]=T=>R.value.open=!1),onUpdateStatus:t[9]||(t[9]=()=>{$(),R.value.open=!1})},null,8,["requirement"])]),_:1})):m("",!0),o.value?(n(),D(W,{key:6},{default:j(()=>{var T,Y,X,je;return[e("div",yr,[t[22]||(t[22]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon size-8",onClick:t[10]||(t[10]=N(M=>o.value=!1,["prevent"]))},t[21]||(t[21]=[e("i",{class:"fas fa-times"},null,-1)]))]),(T=s.value)!=null&&T.closing_history&&((X=(Y=s.value)==null?void 0:Y.closing_history)!=null&&X.length)?(n(),l("div",gr,[e("table",_r,[t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-right"},"Close/Open"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status")])],-1)),e("tbody",null,[(n(!0),l(F,null,Q(((je=s.value)==null?void 0:je.closing_history)||[],M=>(n(),l("tr",{key:M.at,class:"text-sm"},[e("td",kr,x(M==null?void 0:M.type),1),e("td",hr,x(M.at?V(le)(M.at):""),1),e("td",wr,[e("div",qr,x(M==null?void 0:M.closing_note),1)]),e("td",$r,x(M==null?void 0:M.status),1)]))),128))])])])):m("",!0)]}),_:1})):m("",!0),e("div",Cr,[s.value?(n(),l("div",Tr,[e("div",Sr,[e("div",Rr,[e("button",{class:"btn-3 h-8 px-4",onClick:t[11]||(t[11]=N(()=>V(a).back(),["prevent"]))},"Back"),t[24]||(t[24]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),t[39]||(t[39]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",jr,[e("div",null,[e("div",Ir,[k(te,{"line-clamp":"3",class:"mb-2"},{default:j(()=>[B(x(s.value.title),1)]),btnText:j(({lineClampClass:T})=>[B(x(T?"More":"Less"),1)]),_:1}),e("div",Dr,[e("div",Nr,[t[25]||(t[25]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),B(" "+x(V(le)(s.value.created_at)),1)]),s.value.created_by?(n(),l("div",Ar,[t[26]||(t[26]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),k(ee,{"avatar-size":"xsmall",user:s.value.created_by,class:"border-sky-300"},null,8,["user"])])):m("",!0)])]),s.value.description?(n(),l("div",Lr,[t[27]||(t[27]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),k(te,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:j(()=>[k(Pe,{message:s.value.description},null,8,["message"])]),_:1})])):m("",!0)])]),e("div",Or,[k(ae,{class:"mb-4"},{default:j(()=>[e("h2",Er,[t[28]||(t[28]=e("span",null,"Task List ",-1)),s.value.status=="approved"?(n(),l("span",{key:0,class:P(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":s.value.tasks_count>0&&s.value.completed_tasks_count==s.value.tasks_count,"text-red-700 font-semibold":s.value.tasks_count==0||s.value.completed_tasks_count!=s.value.tasks_count}]])}," ("+x(s.value.completed_tasks_count)+"/"+x(s.value.tasks_count)+" task(s) done) ",3)):m("",!0)])]),_:1}),e("div",Br,[e("table",Ur,[t[30]||(t[30]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[d.value!="loading"&&((G=(U=s.value)==null?void 0:U.tasks)==null?void 0:G.length)===0?(n(),l("tr",Mr,t[29]||(t[29]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),l(F,{key:1},Q(((K=s.value)==null?void 0:K.tasks)||[],(T,Y)=>(n(),D(tt,{key:T.id,task:T,indexing:Y+1,class:"*:py-3 *:border-b-0",onEditClick:t[12]||(t[12]=X=>w.value=X),onEmployeeAssignClick:t[13]||(t[13]=X=>{q.value.isOpen=!0,q.value.taskId=X})},null,8,["task","indexing"]))),128))])])])]),e("div",Vr,[k(ae,{class:"mb-4"},{default:j(()=>t[31]||(t[31]=[e("h2",{class:"font-semibold text-lg px-2"},"Comments",-1)])),_:1,__:[31]}),k(Ht,{"commentable-type":"requirement","commentable-id":s.value.id,"current-user":V(p).user},null,8,["commentable-id","current-user"])]),m("",!0),(s.value,m("",!0)),d.value!="loading"&&!((me=s.value)!=null&&me.status)?(n(),l("div",Fr,[e("div",Pr,[k(nr,{"requirement-id":(ce=s.value)==null?void 0:ce.id,onSuccess:$},{heading:j(()=>t[35]||(t[35]=[B(" Requirement Submission ")])),acceptButtonLabel:j(()=>t[36]||(t[36]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),B("Submit Requirement ")],-1)])),submitButtonLabel:j(()=>t[37]||(t[37]=[B(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):m("",!0),(pe=s.value)!=null&&pe.status?(n(),l("div",Hr,[k(ae,null,{default:j(()=>t[38]||(t[38]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[38]}),e("div",zr,[(n(),l(F,null,Q(["from_in_charge","from_coordinator"],T=>k(Ae,{class:"pt-12",key:T,requirement:s.value,"approval-type":T,onUpdateApproval:t[15]||(t[15]=()=>$())},null,8,["requirement","approval-type"])),64))]),((ve=s.value)==null?void 0:ve.from_department_id)!==((be=s.value)==null?void 0:be.to_department_id)?(n(),l("div",Gr,[(n(),l(F,null,Q(["to_in_charge","to_coordinator"],T=>k(Ae,{class:"pt-12",key:T,requirement:s.value,"approval-type":T,onUpdateApproval:t[16]||(t[16]=()=>$())},null,8,["requirement","approval-type"])),64))])):m("",!0)])):m("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:v},[e("div",Wr,[e("div",Yr,[e("div",null,[e("div",Qr,[t[40]||(t[40]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),k(De,{department:(fe=s.value)==null?void 0:fe.from_department,"short-name":!0},null,8,["department"])]),t[41]||(t[41]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",Kr,[(xe=s.value)!=null&&xe.supervisor?(n(),D(ee,{key:0,user:(ye=s.value)==null?void 0:ye.supervisor},null,8,["user"])):m("",!0)])]),t[43]||(t[43]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Xr,[t[42]||(t[42]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),k(De,{department:(ge=s.value)==null?void 0:ge.to_department,"short-name":!0},null,8,["department"])])])]),e("div",Jr,[t[44]||(t[44]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",Zr,x((_e=s.value)==null?void 0:_e.id),1)]),((he=(ke=s.value)==null?void 0:ke.website_tags)==null?void 0:he.length)>0?(n(),l("div",en,[t[45]||(t[45]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",tn,[(n(!0),l(F,null,Q(((we=s.value)==null?void 0:we.website_tags)||[],T=>(n(),l("div",{key:T.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},x(T.name),1))),128))])])):m("",!0),(qe=s.value)!=null&&qe.submission_date?(n(),l("div",sn,[t[46]||(t[46]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",rn,x(V(le)(($e=s.value)==null?void 0:$e.submission_date)),1)])):m("",!0),(Ce=s.value)!=null&&Ce.better_to_complete_on?(n(),l("div",nn,[t[47]||(t[47]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",an,x(V(vt)((Te=s.value)==null?void 0:Te.better_to_complete_on,{weekDay:"long"})),1)])):m("",!0),e("div",null,[e("div",ln,[t[48]||(t[48]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:P(["font-semibold text-sm",{"text-yellow-600 ":s.value.priority=="IMPORTANT","text-red-700 ":s.value.priority=="URGENT"}])},x(s.value.priority||"NORMAL"),3)])]),e("div",on,[e("div",un,[t[49]||(t[49]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),s.value.status?(n(),l("span",{key:0,class:P(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":s.value.status!="approved","bg-green-300 text-green-700 border-green-400":s.value.status=="approved"}])},x(String(s.value.status).toUpperCase()),3)):(n(),l("span",dn,"..."))])]),s.value.rejected_by?(n(),l("div",mn,[e("div",cn,[t[50]||(t[50]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),k(ee,{user:s.value.rejected_by},null,8,["user"])])])):m("",!0),s.value.rejection_reason?(n(),l("div",pn,[t[51]||(t[51]=e("p",{class:"text-gray-600 mb-1"},"Reason:",-1)),e("p",null,x(s.value.rejection_reason),1)])):m("",!0),t[54]||(t[54]=e("hr",{class:"mb-3"},null,-1)),(Se=s.value)!=null&&Se.closed_at?m("",!0):(n(),l("div",vn,[s.value.status=="approved"?(n(),l("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:N(I,["prevent"])},t[52]||(t[52]=[e("i",{class:"fas fa-plus text-sm"},null,-1),B(" Add/Assign Task ")]))):m("",!0),k(z,{class:"btn-2 h-8",to:`/requirements/edit/${(Re=s.value)==null?void 0:Re.id}`},{default:j(()=>t[53]||(t[53]=[B(" Edit ")])),_:1,__:[53]},8,["to"])]))])]),k(bs,{requirement:s.value,onReOpenClick:t[17]||(t[17]=T=>R.value.open=!0),class:"mb-4 card-bg bg-white",onCloseClick:t[18]||(t[18]=T=>R.value.open=!0),onShowHistoryClick:t[19]||(t[19]=T=>o.value=!o.value)},null,8,["requirement"]),k(rs,{requirement:s.value,class:"mb-4"},null,8,["requirement"]),k(Xe,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3",ref_key:"shareComponent",ref:c},null,512)],512)])):m("",!0),d.value==="loading"?(n(),D(re,{key:1,class:"absolute inset-0 bg-opacity-90"})):m("",!0)])])}}};export{ea as default};
