import{r as u,p as _e,q as S,B as $,c as f,g as I,o as r,a as e,j as ge,t as p,k as w,h as O,A as he,F as Y,x as F,v as me,u as Me,b as De,e as je,C as Ee,y as x,i as U,n as k,f as fe,a0 as ye}from"./index-DlGZ0sbT.js";import{_ as $e}from"./EmployeeFilter-DKTk18_G.js";import{L as Ie}from"./LoaderView-Dh3YG4w9.js";import{u as ve}from"./shift-BNcDLn0Y.js";import{d as ue}from"./dayjs.min-Cbbdfn5l.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as Le}from"./WeekendAssignModal-B_ecplJY.js";import{C as Te}from"./CriteriaAssignModal-DsRFbiRO.js";import{u as Be}from"./company-DqxlVtLn.js";import{u as Ne}from"./department-CN5IJYDO.js";import{u as Ye}from"./user-C6crt-o2.js";import"./EmployeeDropdownInput-Bo0M9ffg.js";import"./SelectDropdown-BenhUbVZ.js";import"./UserChip-CTwsdpNd.js";import"./monthly-kpi-assignments-BA_ntEmv.js";const Fe={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},We={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},Re={class:"text-lg font-semibold mb-4"},Pe={class:"mb-4"},He=["value"],Ke={class:"mb-4"},ze={class:"mb-4"},Je={class:"flex justify-end gap-3 mt-4"},Ge={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(M,{emit:q}){const L=q,i=M,o=u({shift_id:"",employee_id:i.employee.id,start_date:"",end_date:""}),h=_e(()=>{const m=Object.keys(i.shifts)[0];return i.shifts[m]||[]});S(()=>i.employee,m=>{o.value.employee_id=(m==null?void 0:m.id)||0},{immediate:!0,deep:!0}),S(()=>i.isOpen,m=>{var l;m&&(i.hasShift?(o.value.shift_id=i.hasShift.shift_id||"",o.value.start_date=i.hasShift.start_date?ue(i.hasShift.start_date).format("YYYY-MM-DD"):"",o.value.end_date=i.hasShift.end_date?ue(i.hasShift.end_date).format("YYYY-MM-DD"):"",o.value.employee_id=((l=i.employee)==null?void 0:l.id)||""):(o.value.shift_id="",o.value.start_date="",o.value.end_date=""))},{immediate:!0});const _=()=>{L("close",!1)},g=ve(),{message:v}=$(g),b=async()=>{if(!o.value.shift_id||!o.value.start_date||!o.value.employee_id){alert("All fields are required!");return}try{const m={...o.value},l=await g.shiftAssign(m);console.log("Shift assigned successfully:",l),alert(i.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),_()}catch(m){console.error("Failed to assign shift:",m),alert("Failed to assign shift.")}};return(m,l)=>M.isOpen?(r(),f("div",Fe,[e("div",We,[e("h2",Re,p(i.hasShift?"Update Shift for":"Assign Shift to")+" "+p(M.employee.name),1),ge(" "+p(w(v))+" ",1),e("div",Pe,[l[4]||(l[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),O(e("select",{"onUpdate:modelValue":l[0]||(l[0]=d=>o.value.shift_id=d),class:"w-full p-2 border rounded"},[l[3]||(l[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(r(!0),f(Y,null,F(h.value,d=>(r(),f("option",{key:d==null?void 0:d.id,value:d==null?void 0:d.id},p(d==null?void 0:d.name),9,He))),128))],512),[[he,o.value.shift_id]])]),e("div",Ke,[l[5]||(l[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),O(e("input",{type:"date","onUpdate:modelValue":l[1]||(l[1]=d=>o.value.start_date=d),class:"w-full border rounded p-2"},null,512),[[me,o.value.start_date]])]),e("div",ze,[l[6]||(l[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),O(e("input",{type:"date","onUpdate:modelValue":l[2]||(l[2]=d=>o.value.end_date=d),class:"w-full border rounded p-2"},null,512),[[me,o.value.end_date]])]),e("div",Je,[e("button",{onClick:_,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:b,class:"px-4 py-2 bg-green-600 text-white rounded"},p(i.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:_,class:"absolute top-2 right-2 text-red-500 text-xl"},l[7]||(l[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):I("",!0)}},Qe=Oe(Ge,[["__scopeId","data-v-c3e70801"]]),Xe={class:"space-y-2 px-4"},Ze={class:"flex items-center justify-between gap-2"},Ve={class:"flex gap-4"},et={class:"flex gap-4 items-center py-2"},tt={key:0,class:"text-center py-4"},st={key:1,class:"space-y-4"},at={key:0,class:"text-center py-2 text-lg italic text-gray-500"},ot={class:"title-md"},nt={class:"overflow-x-auto"},lt={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},it={class:"border border-gray-300 px-2"},dt=["innerHTML"],rt=["innerHTML"],ct={class:"border border-gray-300 px-2"},pt={class:"border border-gray-300 px-2"},mt={class:"border border-gray-300 px-2"},ft={class:"border border-gray-300 px-2"},yt={class:"border border-gray-300 px-3 py-3"},ut={class:"flex items-center justify-between gap-2"},_t={key:0,class:"text-sm font-medium text-green-700"},gt={key:1,class:"text-sm italic text-red-500"},ht=["onClick","title"],vt={class:"border border-gray-300 px-3 py-3"},bt={class:"flex items-center justify-between gap-2"},xt={key:0,class:"text-sm font-medium text-green-700"},kt={key:1,class:"text-sm italic text-red-500"},wt=["onClick","title"],St={class:"border border-gray-300 px-2"},qt={class:"border border-gray-300 px-2"},Ct={class:"border border-gray-300 px-2"},At={key:0,class:"text-green-500"},Ut={key:1,class:"text-red-500"},Mt={class:"px-2 py-1 whitespace-nowrap"},Dt=["onClick","title"],jt={class:"ml-1 hidden lg:inline"},Et={class:"border border-gray-300 px-2"},$t={class:"flex gap-2"},Xt={__name:"UserList",setup(M){const q=ve(),{shifts:L}=$(q),i=Me(),o=De(),h=Ye(),_=u(o.query.company||"all"),g=u(o.query.department||"all"),v=u(o.query.line_type||"all"),b=u(o.query.status||"active"),m=u(""),l=u(""),d=u(!1),C=u(!1),T=Ne(),B=Be(),{companies:It}=$(B),{departments:Ot}=$(T),W=u([]);je(async()=>{await B.fetchCompanies();const t=o.query.company,a=o.query.department;t&&(await H(t),await R(t)),a&&await K(a)});const be=()=>{i.go(-1)},xe=()=>{h.fetchUsers({company_id:o.query.company,department_id:o.query.department,line_type:o.query.line_type,status:o.query.status,user_id:o.query.employee_id})};S(_,async(t,a)=>{!t||t===a||(R(t),H(t),o.query.company!==t&&i.push({query:{...o.query,company:t}}))}),S(g,async(t,a)=>{!t||t===a||(K(t),o.query.department!==t&&i.push({query:{...o.query,department:t}}))}),S(v,t=>{i.push({query:{...o.query,line_type:t}})}),S(b,t=>{i.push({query:{...o.query,status:t}})});const R=async t=>{await T.fetchDepartments(t)},P=_e(()=>{let t=[...(h==null?void 0:h.users)||[]];if(_.value!=="all"&&(t=t.filter(n=>{var c;return((c=n==null?void 0:n.company)==null?void 0:c.id)==_.value})),g.value!=="all"&&(t=t.filter(n=>{var c;return((c=n==null?void 0:n.department)==null?void 0:c.id)==g.value})),v.value!=="all"&&(t=t.filter(n=>(n==null?void 0:n.type)==v.value)),b.value){const n=b.value==="active"?1:0;t=t.filter(c=>(c==null?void 0:c.is_active)==n)}m.value&&(t=t.filter(n=>(n==null?void 0:n.id)==m.value));const a={};return t.forEach(n=>{var A;const c=((A=n==null?void 0:n.company)==null?void 0:A.name)||"Unknown Company";a[c]||(a[c]=[]),a[c].push(n)}),a}),D=u("");function ke(t){D.value=t.id,l.value=t,(t==null?void 0:t.company_id)!==void 0&&(q.fetchShifts(t==null?void 0:t.company_id),d.value=!d.value)}function we(t){D.value=t.id,l.value=t,(t==null?void 0:t.company_id)!==void 0&&(q.fetchShifts(t==null?void 0:t.company_id),C.value=!C.value)}function Se(){d.value=!1}async function qe(){await h.fetchUsersExcelExport({data:{company_id:_.value,department_id:g.value,line_type:v.value,status:b.value}})}const H=async t=>{try{const a=await B.fetchEmployees(t);W.value=a.data}catch(a){console.error("Failed to fetch employees by company:",a)}},K=async t=>{try{const a=await T.fetchDepartmentEmployee({departmentIds:[t]});W.value=a}catch(a){console.error("Failed to fetch employees by department:",a)}},z=t=>{if(t){const a=t.split(" "),n=a.slice(0,2).join(" "),c=a.length>2?`<br>${a.slice(2).join(" ")}`:"";return n+c}return""},j=u(!1),E=u();function Ce(t){E.value=t,j.value=!0}function Ae(){j.value=!1}return(t,a)=>{var c,A,J;const n=Ee("RouterLink");return r(),f("div",Xe,[e("div",Ze,[e("button",{class:"btn-3",onClick:be},a[8]||(a[8]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),a[11]||(a[11]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),e("div",Ve,[x(n,{to:{name:"UserAdd",query:{company:w(o).query.company}},class:"btn-2"},{default:U(()=>a[9]||(a[9]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[9]},8,["to"]),e("button",{type:"button",onClick:qe,class:"btn-3"},a[10]||(a[10]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),ge("Excel ")]))])]),e("div",et,[x($e,{company_id:_.value,"onUpdate:company_id":a[0]||(a[0]=y=>_.value=y),department_id:g.value,"onUpdate:department_id":a[1]||(a[1]=y=>g.value=y),employee_id:m.value,"onUpdate:employee_id":a[2]||(a[2]=y=>m.value=y),line_type:v.value,"onUpdate:line_type":a[3]||(a[3]=y=>v.value=y),"with-type":!0,"initial-value":t.$route.query,class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),O(e("select",{"onUpdate:modelValue":a[4]||(a[4]=y=>b.value=y),class:"input-1 w-auto"},a[12]||(a[12]=[e("option",{value:"active"},"Active",-1),e("option",{value:"in_active"},"In Active",-1)]),512),[[he,b.value]]),e("div",{class:"btn-2",onClick:a[5]||(a[5]=y=>xe())},"Search")]),w(h).isLoading?(r(),f("div",tt,[x(Ie)])):(r(),f("div",st,[Object.keys(P.value).length===0?(r(),f("div",at," User not found ")):I("",!0),(r(!0),f(Y,null,F(P.value,(y,G)=>(r(),f("div",{key:G},[e("h2",ot,p(G)+" ("+p(y.length)+")",1),e("div",nt,[e("table",lt,[a[15]||(a[15]=e("thead",null,[e("tr",{class:"bg-gray-200 text-sm font-medium text-gray-700"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Finger ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Employee ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Joining Date"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Weekend"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"KPI Criteria"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(r(!0),f(Y,null,F(y,(s,Ue)=>{var Q,X,Z,V,ee,te,se,ae,oe,ne,le,ie,de,re,ce,pe;return r(),f("tr",{key:s.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",it,p(Ue+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:z(s==null?void 0:s.name)},null,8,dt),e("td",{class:"border border-gray-300 px-2",innerHTML:z((Q=s==null?void 0:s.designation)==null?void 0:Q.title)},null,8,rt),e("td",ct,p(s==null?void 0:s.device_user_id),1),e("td",pt,p(s==null?void 0:s.employee_id),1),e("td",mt,p(s.joining_date),1),e("td",ft,p(s.role),1),e("td",yt,[e("div",ut,[e("div",null,[(Z=(X=s.current_shift)==null?void 0:X.shift)!=null&&Z.name?(r(),f("span",_t,p(s.current_shift.shift.name),1)):(r(),f("span",gt,"Not Assigned"))]),e("button",{onClick:N=>ke(s),title:s!=null&&s.current_shift?"Change Shift":"Assign Shift",class:k(["p-2 rounded-full transition hover:scale-110 focus:outline-none",s!=null&&s.current_shift?"bg-yellow-100 text-yellow-700":"bg-emerald-600 text-white"])},[e("i",{class:k(s!=null&&s.current_shift?"fas fa-pen":"fas fa-plus")},null,2)],10,ht)]),x(ye,{name:"fade"},{default:U(()=>[D.value===s.id&&d.value?(r(),fe(Qe,{key:0,isOpen:d.value,shifts:w(L),hasShift:s==null?void 0:s.current_shift,employee:{id:l.value.id,name:l.value.name},onClose:Se},null,8,["isOpen","shifts","hasShift","employee"])):I("",!0)]),_:2},1024)]),e("td",vt,[e("div",bt,[e("div",null,[(ee=(V=s==null?void 0:s.assign_weekend)==null?void 0:V.weekends)!=null&&ee.length?(r(),f("span",xt,p(s.assign_weekend.weekends.join(", ")),1)):(r(),f("span",kt,"Not Assigned"))]),e("button",{onClick:N=>we(s),title:(se=(te=s==null?void 0:s.assign_weekend)==null?void 0:te.weekends)!=null&&se.length?"Edit Weekend":"Assign Weekend",class:k(["p-2 rounded-full transition hover:scale-110 focus:outline-none",(oe=(ae=s==null?void 0:s.assign_weekend)==null?void 0:ae.weekends)!=null&&oe.length?"bg-yellow-100 text-yellow-700":"bg-emerald-600 text-white"])},[e("i",{class:k((le=(ne=s==null?void 0:s.assign_weekend)==null?void 0:ne.weekends)!=null&&le.length?"fas fa-pen":"fas fa-plus")},null,2)],10,wt)]),x(ye,{name:"fade"},{default:U(()=>[D.value===s.id&&C.value?(r(),fe(Le,{key:0,isOpen:C.value,assign_weekend:s.assign_weekend,userId:s.id,onClose:a[6]||(a[6]=N=>C.value=!1)},null,8,["isOpen","assign_weekend","userId"])):I("",!0)]),_:2},1024)]),e("td",St,p(s.phone),1),e("td",qt,p(s.email||"নেই"),1),e("td",Ct,[s.is_active?(r(),f("span",At,"Active")):(r(),f("span",Ut,"Inactive"))]),e("td",Mt,[e("button",{onClick:N=>Ce(s),title:(((ie=s.criteria_assignments)==null?void 0:ie.length)||0)>0?"Manage KPI criteria":"Assign KPI criteria",class:k(["group inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium transition","focus:outline-none focus:ring-2 focus:ring-offset-1",(((de=s.criteria_assignments)==null?void 0:de.length)||0)>0?"border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 focus:ring-emerald-300":"border-slate-200 bg-slate-50 text-slate-600 hover:bg-white focus:ring-slate-300"])},[e("span",jt,p((((re=s.criteria_assignments)==null?void 0:re.length)||0)>0?"Manage":"Assign"),1),e("span",{class:k(["ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full px-1 text-[10px] font-semibold",(((ce=s.criteria_assignments)==null?void 0:ce.length)||0)>0?"bg-emerald-600 text-white":"bg-slate-200 text-slate-700"])},p(((pe=s.criteria_assignments)==null?void 0:pe.length)||0),3)],10,Dt)]),e("td",Et,[e("div",$t,[x(n,{to:{name:"UserShow",params:{id:s.id},query:{company:w(o).query.company}},class:"btn-icon"},{default:U(()=>a[13]||(a[13]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[13]},1032,["to"]),x(n,{to:{name:"UserEdit",params:{id:s.id},query:{company:w(o).query.company}},class:"btn-icon"},{default:U(()=>a[14]||(a[14]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[14]},1032,["to"])])])])}),128))])])])]))),128)),x(Te,{modelValue:j.value,"onUpdate:modelValue":a[7]||(a[7]=y=>j.value=y),"user-id":(c=E.value)==null?void 0:c.id,"user-label":(A=E.value)==null?void 0:A.name,criteria_assignments:(J=E.value)==null?void 0:J.criteria_assignments,onAssigned:Ae},null,8,["modelValue","user-id","user-label","criteria_assignments"])]))])}}};export{Xt as default};
