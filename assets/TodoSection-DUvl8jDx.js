import{L as X}from"./LoaderView-ChCoTriE.js";import{r as P,x as j,e as G,A as Y,c as y,o as c,I as R,a as e,F as V,y as B,t as S,g as f,w as D,q as W,n as L,f as F,H as de,i as M,k as w,J as ae,j as U,h as J,v as Q,m as ue,S as K,T as H}from"./index-Box--qr0.js";import{f as ce,b as Z,g as le}from"./datetime-l2Vm98rT.js";import{u as z}from"./useTodoStore-CiDU9bSI.js";import{_ as me}from"./DraggableList.vue_vue_type_script_setup_true_lang-B_pVfAJr.js";import{_ as ye}from"./UserChip-CBk2FrYM.js";import{O as te}from"./OverlyModal-byJpBMBB.js";const ve={class:"grid grid-cols-7 *:text-center *:p-2 *:border-r *:border-b *:text-blue-800 *:text-sm"},pe={class:"flex flex-col"},fe={key:0,class:"p-2 border-r border-t"},ge={__name:"CalenderView",props:{month:{type:String,required:!0,validator:r=>/^\d{4}-(0[1-9]|1[0-2])$/.test(r)}},emits:["change"],setup(r,{emit:$}){const a=r,i=$,u=P(),t=P(),l=P(),m=P(),d=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function b(g,s,h,C){const k=[];for(let O=h-1;O>=0;O--){const p=C-O,_=new Date(g,s-1,p);k.push({date:_,day:_.getDate(),month:_.getMonth()+1,year:_.getFullYear(),isCurrentMonth:!1})}return k}function n(g,s,h){const C=[];for(let k=1;k<=h;k++){const p={date:new Date(g,s,k),day:k,month:s+1,year:g,isCurrentMonth:!0};C.push(p)}return C}function o(g,s,h){const C=[...g],k=Math.ceil(C.length/7)*7,O=1;for(let p=0;C.length<k;p++){const _=new Date(s,h+1,O+p);C.push({date:_,day:_.getDate(),month:_.getMonth()+1,year:_.getFullYear(),isCurrentMonth:!1})}return C}function v(g,s){const h=new Date(g,s,1),k=new Date(g,s+1,0).getDate(),p=(h.getDay()+1)%7,E=new Date(g,s,0).getDate();let I=[];I=[...b(g,s,p,E)];const A=n(g,s,k);return l.value=A[0],m.value=A[A.length-1],I=[...I,...A],I=[...o(I,g,s)],u.value=I[0],t.value=I[I.length-1],I}const T=j(()=>{const[g,s]=a.month.split("-"),h=parseInt(g),C=parseInt(s)-1;return console.log({yearStr:g,monthStr:s}),v(h,C)}),x=j(()=>{const g=T.value,s=[];for(let h=0;h<g.length;h+=7)s.push(g.slice(h,h+7));return s});function N(){i("change",{gridStartDate:u.value,gridEndDate:t.value,startOfMonth:l.value,endOfMonth:m.value})}return G(()=>N()),Y(()=>a.month,N),(g,s)=>(c(),y("div",null,[R(g.$slots,"calender-top"),e("div",ve,[(c(),y(V,null,B(d,h=>e("div",{key:h},S(h),1)),64))]),e("div",pe,[(c(!0),y(V,null,B(x.value,(h,C)=>(c(),y("div",{class:"week grid grid-cols-7 min-h-28 items-stretch",key:C},[(c(!0),y(V,null,B(h,(k,O)=>R(g.$slots,"date",{key:O,day:k.day,month:k.month,year:k.year,weekday:(k.date.getDay()+1)%7,isCurrentMonth:k.isCurrentMonth,yearMonthDate:`${k.year}-${String(k.month).padStart(2,"0")}-${String(k.day).padStart(2,"0")}`},()=>{var p;return[k!=null&&k.date?(c(),y("div",fe,S((p=k==null?void 0:k.date)==null?void 0:p.getDate()),1)):f("",!0)]})),128))]))),128))]),R(g.$slots,"calender-bottom")]))}},be={class:"px-4 py-2 flex items-center bg-gray-50 group gap-2"},he=["value"],ke=["value"],xe=["value"],Ce=["value"],we=["disabled"],De={key:4,class:"ml-4 md:ml-auto flex items-center gap-2"},$e={key:5,class:"ml-4 md:ml-auto flex items-center gap-2"},Se={__name:"TodoHeading",props:{selected:{type:Object,default:()=>({type:"month-view",month:"",day:"",year:"",week:""})},loading:{type:Boolean,default:!1}},emits:["reloadClick",,"change"],setup(r,{emit:$}){const a=r,i=[{value:"month-view",label:"Monthly"},{value:"day-view",label:"Daily"}],u=$,t=P();function l(s){t.value=s,u("change",{...a.selected,type:s})}Y(()=>{var s;return(s=a.selected)==null?void 0:s.type},s=>l(s),{immediate:!0});const m=j(()=>t.value=="month-view"&&a.selected.year&&a.selected.month?[a.selected.year,a.selected.month-1,1]:t.value=="day-view"&&a.selected.year&&a.selected.month&&a.selected.day?[a.selected.year,a.selected.month-1,a.selected.day]:[new Date().getFullYear(),new Date().getMonth(),new Date().getDate()]);function d(){t.value=="month-view"&&x(new Date)}function b(){if(t.value=="month-view"){const s=new Date(...m.value);s.setMonth(s.getMonth()+1),x(s)}}function n(){if(t.value=="month-view"){const s=new Date(...m.value);s.setMonth(s.getMonth()-1),x(s)}}function o(){t.value=="day-view"&&x(new Date)}function v(){if(t.value=="day-view"){const s=new Date(...m.value);s.setDate(s.getDate()+1),x(s)}}function T(){if(t.value=="day-view"){const s=new Date(...m.value);s.setDate(s.getDate()-1),x(s)}}function x(s){u("change",{type:t.value,month:s.getMonth()+1,day:s.getDate(),year:s.getFullYear(),week:s.getDay()})}const N=j(()=>t.value=="month-view"?`${a.selected.year}-${a.selected.month.toString().padStart(2,"0")}`:t.value=="day-view"?`${a.selected.year}-${a.selected.month.toString().padStart(2,"0")}-${a.selected.day.toString().padStart(2,"0")}`:a.selected),g=s=>{var h,C;if(t.value=="month-view"){const[k,O]=(h=s.target.value)==null?void 0:h.split("-").map(Number),p=new Date(k,O-1,1);x(p)}if(t.value=="day-view"){const k=new Date((C=s.target)==null?void 0:C.value);x(k)}};return(s,h)=>(c(),y("div",null,[e("div",be,[R(s.$slots,"before",{selected:r.selected}),R(s.$slots,"typeSelection",{selected:r.selected,types:i,changeType:l},()=>[e("select",{class:"px-2 h-7 border rounded",value:t.value,onChange:h[0]||(h[0]=C=>l(C.target.value))},[(c(),y(V,null,B(i,C=>e("option",{value:C.value,key:C.id},S(C.label),9,ke)),64))],40,he)]),t.value=="month-view"?(c(),y("input",{key:0,type:"month",value:N.value,onInput:g,class:"border px-2 rounded"},null,40,xe)):f("",!0),t.value=="day-view"?(c(),y("input",{key:1,type:"date",value:N.value,onInput:g,class:"border px-2 rounded"},null,40,Ce)):f("",!0),t.value=="month-view"?(c(),y("button",{key:2,class:"btn-3 mx-4 h-7",onClick:D(d,["prevent"])}," Current Month ")):f("",!0),t.value=="day-view"?(c(),y("button",{key:3,class:"btn-3 mx-4 h-7",onClick:D(o,["prevent"])}," Today ")):f("",!0),e("button",{class:W(["btn-3 px-2 py-2 mx-4 size-7 disabled:text-gray-300 disabled:border-gray-300",{"animate-spin text-gray-300 border-gray-300 !bg-opacity-0":r.loading}]),onClick:h[1]||(h[1]=D(C=>u("reloadClick"),["prevent"])),disabled:r.loading},h[2]||(h[2]=[e("i",{class:"fas fa-redo-alt"},null,-1)]),10,we),t.value=="month-view"?(c(),y("div",De,[e("button",{class:"btn-2 h-7",onClick:D(n,["prevent"])}," Previous Month "),e("button",{class:"btn-2 h-7",onClick:D(b,["prevent"])},"Next Month")])):f("",!0),t.value=="day-view"?(c(),y("div",$e,[e("button",{class:"btn-2 h-7",onClick:D(T,["prevent"])},"Previous Day"),e("button",{class:"btn-2 h-7",onClick:D(v,["prevent"])},"Next Day")])):f("",!0),R(s.$slots,"after",{selected:r.selected})]),R(s.$slots,"bottom",{selected:r.selected})]))}},Te={key:0,class:"fa fa-exclamation-circle",title:"Pending"},_e={key:1,class:"fa fa-exclamation-square",title:"Wording"},Me={key:2,class:"fa fa-check-square",title:"Completed"},ne={__name:"TodoStatusIcon",props:{todo:{type:Object,required:!0}},setup(r){const $=r,a=j(()=>{switch($.todo.status){case"PENDING":return"text-red-400";case"WORKING":return"text-yellow-400";case"COMPLETED":return"text-green-400"}return""});return(i,u)=>(c(),y("span",{class:W(a.value)},[r.todo.status=="PENDING"?(c(),y("i",Te)):f("",!0),r.todo.status=="WORKING"?(c(),y("i",_e)):f("",!0),r.todo.status=="COMPLETED"?(c(),y("i",Me)):f("",!0)],2))}},Ie=["title","onClick"],Ee={class:"line-clamp-1"},Re={key:0,class:"text-purple-600 text-center"},ie={__name:"TodosInDate",props:{date:{type:String,required:!0},maxItems:{type:[Number,String],default:3}},emits:["clickTodo"],setup(r,{emit:$}){const a=r,i=$,{getTodosByDate:u}=z(),t=j(()=>{let l=[],m=!1,d=[];if(typeof u=="function"){const b=u(a.date);if(d=Array.isArray(b)?b:[],a.maxItems==="all")return{all:d,items:d,moreItemsCount:0};l=d.slice(0,a.maxItems),m=d.length-l.length}return{all:d,items:l,moreItemsCount:m}});return(l,m)=>(c(),y("div",null,[t.value.items.length===0?R(l.$slots,"noTodos",{key:0},()=>[m[0]||(m[0]=e("div",{class:"text-gray-400 text-center"},"No todos",-1))]):(c(),y(V,{key:1},[R(l.$slots,"todoItems",{todos:t.value.items,allTodos:t.value.items,moreItemsCount:t.value.moreItemsCount},()=>[(c(!0),y(V,null,B(t.value.items,d=>R(l.$slots,"todoItem",{key:d.id,todo:d,moreItemsCount:t.value.moreItemsCount},()=>{var b,n,o,v;return[e("div",{title:`${d==null?void 0:d.title} ${d!=null&&d.user?`
by:`:""} ${(b=d==null?void 0:d.user)==null?void 0:b.name} ${(n=d==null?void 0:d.user)!=null&&n.department?`
DEPT:`:""} ${(v=(o=d.user)==null?void 0:o.department)==null?void 0:v.name}`,class:W(["px-1 mb-2 text-sm rounded cursor-pointer flex items-center gap-2",{"bg-sky-50 text-sky-900 hover:bg-sky-700 hover:text-white border border-sky-300":d.status!=="COMPLETED","bg-green-500 text-white":d.status==="COMPLETED"}]),onClick:D(T=>i("clickTodo",d),["prevent","stop"])},[L(ne,{todo:d,class:W(["text-sm",[d.status=="COMPLETED"?"!text-white":""]])},null,8,["todo","class"]),e("div",Ee,S(d.title),1),d.user?(c(),F(de,{key:0,user:d.user,size:"xsmall",class:"ml-auto"},null,8,["user"])):f("",!0)],10,Ie)]})),128))]),t.value.moreItemsCount>0?(c(),y("div",Re," + "+S(t.value.moreItemsCount)+" more todo"+S(t.value.moreItemsCount>1?"s":""),1)):f("",!0)],64))]))}},Ne={class:"relative"},Oe=["onClick","onKeypress"],Pe={class:"flex items-center justify-center"},Le=["onClick"],Fe={__name:"TodosInCalenderView",props:{month:{type:String,required:!0,validator:r=>/^\d{4}-(0[1-9]|1[0-2])$/.test(r)}},emits:["dateClick","clickTodo","clickDateCell"],setup(r,{emit:$}){const a=$;function i(t,l){t.isTrusted&&t.ctrlKey&&t.which==10&&a("dateClick",l)}function u(t){const[l,m,d]=String(t).split("-").map(Number),b=new Date(l,m-1,d);return ce(b)}return(t,l)=>(c(),y("div",Ne,[r.month?(c(),F(ge,{key:0,month:r.month,class:"border-t border-blue-200/50 relative"},{date:M(({day:m,yearMonthDate:d,isCurrentMonth:b})=>[e("div",{tabindex:"0",class:W(["border p-4 cursor-pointer group/date relative focus:outline-slate-400",{"bg-sky-50   border-sky-300 focus:bg-sky-50 focus:outline-sky-400":u(d),"hover:bg-slate-50  hover:border-slate-300 focus:bg-slate-50 ":!u(d)}]),onClick:D(n=>a("dateClick",d),["prevent","stop"]),onKeypress:D(n=>i(n,d),["prevent"])},[e("button",{tabindex:"1",class:W([{"text-gray-300":!b,"text-sky-400":b},"text-center mb-2 font-semibold hover:bg-sky-200 w-full rounded"])},S(m),3),e("div",null,[L(ie,{date:d,onClickTodo:l[0]||(l[0]=n=>a("clickTodo",n))},{noTodos:M(()=>l[1]||(l[1]=[e("span",null,null,-1)])),_:2},1032,["date"])]),e("div",Pe,[e("button",{onClick:D(n=>a("clickDateCell",d),["prevent","stop"]),class:"btn-3 !py-1 invisible group-hover/date:visible text-sm text-red-800/40"},l[2]||(l[2]=[e("i",{class:"fas fa-plus"},null,-1),e("span",{class:"hidden lg:inline whitespace-nowrap"}," Add todo ",-1)]),8,Le)])],42,Oe)]),_:1},8,["month"])):f("",!0)]))}},je={class:"relative bg-white p-4"},Ae={key:0,class:"text-red-500 text-sm border border-red-300 max-w-6xl mx-auto py-2 gap-2 shadow-sm rounded flex items-center px-3"},Ue={class:"max-w-6xl mx-auto border rounded my-5"},Ve={class:"mb-4 text-gray-700 border-b py-2 px-4 flex items-center"},qe={class:"text-lg font-semibold"},We={class:"ml-auto flex items-center gap-2"},ze={key:0,class:"flex items-center gap-3 mr-6"},Be=["disabled"],Ge=["disabled"],Ke=["onClick"],He={class:"ml-4"},Ye={class:"line-clamp-2"},Je={key:0,class:"mt-1 flex items-center gap-2"},Qe={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},Xe={key:0,class:"line-clamp-2 ml-4 text-gray-500"},Ze={class:"ml-auto flex items-center gap-2"},et=["onClick"],tt=["onClick"],nt=["onClick"],ot=["onClick"],st={__name:"TodosInDailyView",props:{date:{type:String,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickAdd","clickEdit","clickDelete","clickChangeStatus","backClick","update"],setup(r,{emit:$}){const a=r,i=P(null),u=$,t=j(()=>new Date(a.date)),l=z();async function m(n){confirm(`Are your sure want to delete todo
'${n==null?void 0:n.title}'`)&&(await l.deleteTodo(n.id),u("update"))}async function d(n,o){confirm(`Are your sure?
want to change status to ${o} 
todo: '${n==null?void 0:n.title}'`)&&(await l.updateTodoStatus(n.id,o),u("update"))}async function b(){var o;const n=(o=i==null?void 0:i.value.items)==null?void 0:o.map(v=>v.id);await l.rearrangeMyTodos(n,{date:a.date}),u("update")}return(n,o)=>{var v;return c(),y("div",je,[w(l).error?(c(),y("div",Ae,[o[4]||(o[4]=e("i",{class:"fad fa-exclamation-circle"},null,-1)),e("div",null,S(w(l).error),1)])):f("",!0),e("div",Ue,[e("div",Ve,[e("button",{class:"fa fa-arrow-left btn-icon mr-2",onClick:o[0]||(o[0]=D(T=>u("backClick"),["prevent"]))}),e("div",qe,S(w(Z)(t.value,{weekDay:"long"}))+" "+S(n.type),1),e("div",We,[(v=i.value)!=null&&v.isItemsChanged?(c(),y("div",ze,[e("button",{onClick:o[1]||(o[1]=D(()=>b(),["prevent"])),class:"btn-2 disabled:opacity-40 disabled:pointer-events-none",disabled:w(l).updatingPriority}," Save Rearranged ",8,Be),e("button",{onClick:o[2]||(o[2]=D(()=>i.value.resetItems(),["prevent"])),class:"btn-3 disabled:opacity-40 disabled:pointer-events-none",disabled:w(l).updatingPriority}," Discard ",8,Ge)])):f("",!0),e("button",{class:"btn btn-icon",onClick:o[3]||(o[3]=D(T=>u("clickAdd",a.date),["prevent"]))},o[5]||(o[5]=[e("i",{class:"fas fa-plus"},null,-1)]))])]),L(ie,{date:r.date,"max-items":"all",class:"my-8 w-full px-4"},{todoItems:M(({allTodos:T})=>[L(me,{items:T,ref_key:"draggableTodos",ref:i,handle:"handle"},{item:M(({item:x})=>{var N,g;return[e("div",{class:"border rounded px-4 py-3 my-4 hover:bg-sky-50 cursor-pointer flex items-center",onClick:D(s=>u("clickTodo",x),["prevent"])},[L(ne,{todo:x},null,8,["todo"]),e("div",He,[e("div",Ye,S(x.id)+" - "+S(x.title),1),x.user?(c(),y("div",Je,[L(ye,{user:x.user,"avatar-size":"xsmall"},null,8,["user"]),e("div",Qe,S((g=(N=x.user)==null?void 0:N.department)==null?void 0:g.name),1)])):f("",!0)]),x.todo_type&&x.todo_type_id?(c(),y("div",Xe,S(x.todo_type)+" id: "+S(x.todo_type_id),1)):f("",!0),e("div",Ze,[x.status==="WORKING"?(c(),y("button",{key:0,class:"btn-icon bg-green-400 text-white hover:bg-green-600 hover:text-white",onClick:D(()=>d(x,"COMPLETED"),["prevent","stop"])},o[6]||(o[6]=[e("i",{class:"fas fa-check"},null,-1)]),8,et)):f("",!0),x.status==="PENDING"?(c(),y("button",{key:1,class:"btn-icon bg-gray-200 hover:bg-gray-300 hover:text-red-400 text-red-500",onClick:D(()=>d(x,"WORKING"),["prevent","stop"])},o[7]||(o[7]=[e("i",{class:"fas fa-play"},null,-1)]),8,tt)):f("",!0),e("button",{class:"btn-icon bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:D(s=>u("clickEdit",x),["prevent","stop"])},o[8]||(o[8]=[e("i",{class:"fas fa-pen"},null,-1)]),8,nt),e("button",{class:"btn-icon bg-red-400 text-white hover:bg-red-600 hover:text-white",onClick:D(()=>m(x),["prevent","stop"])},o[9]||(o[9]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,ot),r.userRole=="employee"?(c(),y("button",{key:2,onClick:D(()=>null,["stop","prevent"]),class:"btn-icon bg-gray-400 text-white hover:bg-gray-600 hover:text-white handle"},o[10]||(o[10]=[e("i",{class:"fas fa-arrows-alt-v"},null,-1)]))):f("",!0)])],8,Ke)]}),_:2},1032,["items"])]),noTodos:M(()=>o[11]||(o[11]=[e("div",{class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"}," No Todos ",-1)])),_:1},8,["date"])])])}}},at={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md"},lt={key:0,class:"mb-4 text-red-500 font-medium"},it={key:1,class:"mb-4 text-blue-500 font-medium"},rt={class:"flex justify-between items-center gap-4"},dt=["disabled"],re={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(r,{emit:$}){const a=$;return(i,u)=>(c(),y("form",{onSubmit:u[1]||(u[1]=D(t=>a("submit"),["prevent"]))},[R(i.$slots,"default"),e("div",at,[r.error?(c(),y("div",lt,S(r.error),1)):f("",!0),r.isSubmitting?(c(),y("div",it,"Saving changes...")):f("",!0),R(i.$slots,"footer",{},()=>[e("div",rt,[e("button",{type:"button",onClick:u[0]||(u[0]=t=>a("clickCancel")),class:"btn-3"},"Cancel"),e("button",{disabled:r.isSubmitting||r.isLoading,type:"submit",class:"btn-2"},S(r.isSubmitting?"Saving...":"Save"),9,dt)])])])],32))}},ut={class:""},ct={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},mt={class:"mb-2"},yt={class:"mb-4"},vt={class:"mb-4"},pt={__name:"TodoAddForm",props:{date:{type:String,default:le(new Date)},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(r,{emit:$}){const a=r,i=P(),u=P(),t=z(),l=$,m=P({title:"",date:a.date||"",task_id:""});async function d(){try{i.value="submitting",await t.createTodo(m.value,{returnWith:a.userRole!=="employee"?"user,department,company":""}),l("update")}finally{i.value=""}}const b=j(()=>new Date(a.date));return G(async()=>{var n;await ae(),(n=u.value)==null||n.focus()}),(n,o)=>(c(),y("div",ut,[w(t).loading?(c(),F(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>o[3]||(o[3]=[U(" Loading... ")])),_:1,__:[3]})):f("",!0),L(re,{onSubmit:d,onClickCancel:o[2]||(o[2]=v=>l("cancelClick")),isSubmitting:i.value=="submitting",error:w(t).error,class:"rounded-md relative"},{default:M(()=>[o[7]||(o[7]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),e("div",ct,[e("div",mt,[o[4]||(o[4]=e("span",{class:"font-semibold"}," Date ",-1)),e("span",null,S(w(Z)(b.value,{weekDay:"long"})),1)]),e("div",yt,[o[5]||(o[5]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),J(e("input",{ref_key:"titleRef",ref:u,"onUpdate:modelValue":o[0]||(o[0]=v=>m.value.title=v),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.title]])]),e("div",vt,[o[6]||(o[6]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),J(e("input",{"onUpdate:modelValue":o[1]||(o[1]=v=>m.value.task_id=v),placeholder:"Enter a task id",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.task_id]])])])]),_:1,__:[7]},8,["isSubmitting","error"])]))}},ft={class:"relative"},gt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},bt={class:"mb-2"},ht={class:"mb-4"},kt={class:"mb-4"},xt={__name:"TodoEditForm",props:{date:{type:String,default:le(new Date)},todo:{type:Object,default:()=>{}}},emits:["update","cancelClick"],setup(r,{emit:$}){const a=r,i=P(),u=P(),t=z(),l=$,m=P({title:"",todo_type:"task",todo_type_id:""});async function d(){var o,v,T;await t.fetchTodo((o=a.todo)==null?void 0:o.id),m.value.title=(v=t.todo)==null?void 0:v.title,m.value.todo_type_id=(T=t.todo)==null?void 0:T.todoable_id}async function b(){i.value="submitting";try{await t.updateTodo(a.todo.id,m.value),l("update")}finally{i.value=""}}const n=j(()=>new Date(a.todo.date));return G(async()=>{var o;await d(),await ae(),(o=u.value)==null||o.focus()}),(o,v)=>(c(),y("div",ft,[w(t).loading?(c(),F(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>v[3]||(v[3]=[U(" Loading... ")])),_:1,__:[3]})):f("",!0),L(re,{onSubmit:b,onClickCancel:v[2]||(v[2]=T=>l("cancelClick")),isSubmitting:i.value=="submitting",isLoading:w(t).loading,error:w(t).error},{default:M(()=>[v[7]||(v[7]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),e("div",gt,[e("div",bt,[v[4]||(v[4]=e("span",{class:"font-semibold"}," Date ",-1)),e("span",null,S(w(Z)(n.value,{weekDay:"long"})),1)]),e("div",ht,[v[5]||(v[5]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),J(e("input",{ref_key:"titleRef",ref:u,"onUpdate:modelValue":v[0]||(v[0]=T=>m.value.title=T),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.title]])]),e("div",kt,[v[6]||(v[6]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),J(e("input",{"onUpdate:modelValue":v[1]||(v[1]=T=>m.value.todo_type_id=T),placeholder:"Enter a task id",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.todo_type_id]])])])]),_:1,__:[7]},8,["isSubmitting","isLoading","error"])]))}},Ct={class:"relative"},wt={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},Dt={class:"mb-4"},$t={class:"mb-4"},St={key:0,class:"mt-1 flex items-center gap-2"},Tt={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},_t={class:"flex items-center gap-4"},Mt={key:0,class:"flex items-center gap-2"},It={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},Et={class:"ml-auto flex items-center gap-2"},Rt={__name:"TodoShow",props:{todo:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update"],setup(r,{emit:$}){const a=r,i=z(),u=$;async function t(){var b;await i.fetchTodo((b=a.todo)==null?void 0:b.id)}const l=j(()=>{var b,n;return(b=i.todo)!=null&&b.date?new Date((n=i.todo)==null?void 0:n.date):null});async function m(b){var n;confirm(`Are your sure want to delete todo
'${(n=i.todo)==null?void 0:n.title}'`)&&(await i.deleteTodo(b.id),u("update"))}async function d(b,n){var o;confirm(`Are your sure want to compete todo
'${(o=i.todo)==null?void 0:o.title}'`)&&(await i.updateTodoStatus(b.id,n),u("update"))}return G(async()=>{await t()}),(b,n)=>{var v,T,x,N,g,s,h,C;const o=ue("UserChip");return c(),y("div",Ct,[w(i).loading?(c(),F(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>n[5]||(n[5]=[U(" Loading... ")])),_:1,__:[5]})):f("",!0),e("div",null,[n[11]||(n[11]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),e("div",wt,[e("div",Dt,[n[6]||(n[6]=e("div",{class:"font-semibold text-xs text-gray-500"},"Date",-1)),e("span",null,S(w(Z)(l.value,{weekDay:"long"})),1)]),e("div",$t,[n[7]||(n[7]=e("div",{class:"text-xs text-gray-500"},"Todo",-1)),U(" "+S((v=w(i).todo)==null?void 0:v.title),1)]),r.todo.user?(c(),y("div",St,[L(o,{user:r.todo.user,"avatar-size":"xsmall"},null,8,["user"]),e("div",Tt,S((x=(T=r.todo.user)==null?void 0:T.department)==null?void 0:x.name),1)])):f("",!0),e("div",null,[n[10]||(n[10]=e("div",{class:"text-xs text-gray-500"},"Status",-1)),e("div",_t,[e("div",null,[(N=w(i))!=null&&N.todo?(c(),F(ne,{key:0,todo:(g=w(i))==null?void 0:g.todo},null,8,["todo"])):f("",!0),U(" "+S((s=w(i).todo)==null?void 0:s.status),1)]),w(i).loading?f("",!0):(c(),y("div",Mt,[((h=w(i).todo)==null?void 0:h.status)==="PENDING"?(c(),y("button",{key:0,class:"btn-2 from-yellow-700 to-yellow-500 text-white hover:bg-green-600 hover:text-white",onClick:n[0]||(n[0]=D(()=>d(w(i).todo,"WORKING"),["prevent","stop"]))},n[8]||(n[8]=[e("i",{class:"fas fa-exclamation-circle"},null,-1),U(" Change to Working ")]))):f("",!0),((C=w(i).todo)==null?void 0:C.status)==="WORKING"?(c(),y("button",{key:1,class:"btn-2 from-green-700 to-green-300 text-white hover:bg-green-600 hover:text-white",onClick:n[1]||(n[1]=D(()=>d(w(i).todo,"COMPLETED"),["prevent","stop"]))},n[9]||(n[9]=[e("i",{class:"fas fa-check"},null,-1),U(" Make Complete ")]))):f("",!0)]))])])])]),e("div",It,[e("button",{type:"button",onClick:n[2]||(n[2]=k=>u("cancelClick")),class:"btn-3"},"Cancel"),e("div",Et,[e("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:n[3]||(n[3]=D(k=>u("clickEdit",w(i).todo),["prevent","stop"]))},n[12]||(n[12]=[e("i",{class:"fas fa-pen"},null,-1),U(" Edit ")])),e("button",{class:"btn-2-red",onClick:n[4]||(n[4]=D(()=>m(w(i).todo),["prevent","stop"]))},n[13]||(n[13]=[e("i",{class:"fas fa-trash-alt"},null,-1),U(" Delete ")]))])])])}}},Nt={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","update","clickEdit","clickDelete","clickChangeStatus"],setup(r,{emit:$}){const a=$;function i(){a("update")}return(u,t)=>(c(),y(V,null,[r.todoModal.action=="add"?(c(),F(te,{key:0},{default:M(()=>{var l;return[L(pt,{onCancelClick:t[0]||(t[0]=m=>a("cancelClick")),onUpdate:i,date:(l=r.todoModal)==null?void 0:l.date,userRole:r.userRole},null,8,["date","userRole"])]}),_:1})):f("",!0),r.todoModal.action=="edit"?(c(),F(te,{key:1},{default:M(()=>{var l;return[L(xt,{onCancelClick:t[1]||(t[1]=m=>a("cancelClick")),onUpdate:i,todo:(l=r.todoModal)==null?void 0:l.todo,userRole:r.userRole},null,8,["todo","userRole"])]}),_:1})):f("",!0),r.todoModal.action=="show"?(c(),F(te,{key:2},{default:M(()=>{var l;return[L(Rt,{onCancelClick:t[2]||(t[2]=m=>a("cancelClick")),onUpdate:i,onClickEdit:t[3]||(t[3]=m=>a("clickEdit",m)),onClickDelete:t[4]||(t[4]=m=>a("clickDelete",m)),onClickChangeStatus:t[5]||(t[5]=(m,d)=>a("clickChangeStatus",m,d)),todo:(l=r.todoModal)==null?void 0:l.todo,userRole:r.userRole},null,8,["todo","userRole"])]}),_:1})):f("",!0)],64))}},Ot={class:"border bg-white relative"},qt={__name:"TodoSection",props:{year:{type:Number,default:()=>new Date().getFullYear()},month:{type:Number,default:()=>new Date().getMonth()+1},day:{type:Number,default:()=>new Date().getDate()},week:{type:Number,default:()=>new Date().getDay()},type:{type:String,default:"month-view"},userRole:{type:String,default:"employee"}},emits:["changeInput"],setup(r,{emit:$}){const a=new Date,i=r,u=P({type:"month-view",month:a.getMonth()+1,day:a.getDate(),year:a.getFullYear(),week:a.getDay()}),t=$;Y(()=>({...u.value}),p=>{t("changeInput",p)}),Y(()=>({year:i.year,month:i.month,day:i.day,week:i.week,type:i.type}),p=>{u.value={...p}},{immediate:!0});const l=P({action:null}),m=z();async function d(){await O()}function b(){l.value={...l.value,action:""}}async function n(p,_){await m.updateTodoStatus(p,_)}async function o(p){await m.deleteTodo(p)}function v(){u.value={...u.value,type:"month-view"}}function T(p){u.value={...u.value,...p}}function x(p){const[_,E,I]=p.split("-").map(Number);u.value={...u.value,type:"day-view",year:_,month:E,day:I}}function N(p){l.value={...l.value,action:"show",todo:p}}function g(p){l.value={...l.value,action:"edit",todo:p}}function s(p){l.value={...l.value,action:"add",date:p}}function h(){l.value={action:null,todo:null}}const C=j(()=>{var I,q,A,ee,oe,se;const p=(q=(I=u.value)==null?void 0:I.year)==null?void 0:q.toString(),_=(ee=(A=u.value)==null?void 0:A.month)==null?void 0:ee.toString().padStart(2,"0"),E=(se=(oe=u.value)==null?void 0:oe.day)==null?void 0:se.toString().padStart(2,"0");return`${p}-${_}-${E}`}),k=j(()=>{var E,I,q,A;const p=(I=(E=u.value)==null?void 0:E.year)==null?void 0:I.toString(),_=(A=(q=u.value)==null?void 0:q.month)==null?void 0:A.toString().padStart(2,"0");return`${p}-${_}`});async function O(){i.userRole=="employee"?await m.fetchMyTodos():await m.fetchTodos()}return G(async()=>{await O()}),(p,_)=>(c(),y("div",null,[e("div",Ot,[w(m).loading?(c(),F(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>_[0]||(_[0]=[U(" Loading... ")])),_:1,__:[0]})):f("",!0),L(Se,{selected:u.value,class:"border-b shadow z-20",onChange:T,onReloadClick:d},{before:M(E=>[R(p.$slots,"beforeHeader",K(H(E)))]),after:M(E=>[R(p.$slots,"afterHeader",K(H(E)))]),bottom:M(E=>[R(p.$slots,"bottomHeader",K(H(E)))]),typeSelection:M(E=>[R(p.$slots,"typeSelection",K(H(E)))]),_:3},8,["selected"]),u.value.type=="month-view"?(c(),F(Fe,{key:1,month:k.value,class:"bg-white",onDateClick:x,onClickTodo:N,onClickDateCell:s},null,8,["month"])):f("",!0),u.value.type=="day-view"?(c(),F(st,{key:2,date:C.value,userRole:r.userRole,onClickTodo:N,onClickEdit:g,onClickAdd:s,onClickDelete:o,onClickChangeStatus:n,onBackClick:v,onUpdate:b},null,8,["date","userRole"])):f("",!0)]),L(Nt,{todoModal:l.value,userRole:r.userRole,onCancelClick:h,onUpdate:b,onClickEdit:g},null,8,["todoModal","userRole"])]))}};export{ge as _,qt as a};
