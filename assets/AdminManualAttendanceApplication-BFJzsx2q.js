import{u as I,b as K,r as y,e as Q,q as S,p as W,c as n,o as i,a as t,y as C,h as p,v as f,k as q,g as k,n as T,t as F,F as z,x as J,L as B,w as m,A as G,j as X}from"./index-BbhQvqb4.js";import{_ as Y}from"./EmployeeFilter-CD8c9e2j.js";import{L as Z}from"./LoaderView-BXKCzav_.js";import{S as ee}from"./SelectedEmployeeCard-CsQGqrCX.js";import{u as te}from"./manual-attendance-DPWWy7Ix.js";import{u as le}from"./user-CavIPwgc.js";import"./company-BM1HidGp.js";import"./department-DLuSwzcR.js";import"./EmployeeDropdownInput-DbNy_Uyu.js";import"./SelectDropdown-OZFzqdoH.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-YEbxia5G.js";const oe={class:"space-y-2 px-4"},se={class:"flex flex-wrap gap-2"},ae={key:0,class:"text-center py-4"},ne={key:1,class:"space-y-4"},ie={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"overflow-x-auto"},de={key:0,class:"text-red-500 text-sm text-left"},ue={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},pe={class:"bg-gray-200"},ce={class:"border border-gray-300 px-2 text-left py-2"},ye={class:"flex items-center justify-center gap-2"},me=["onClick"],_e={class:"border border-gray-300 px-2 cursor-pointer text-center"},ve=["onUpdate:modelValue"],be={class:"border border-gray-300 px-2"},fe=["onUpdate:modelValue"],ke={class:"border border-gray-300 px-2"},ge=["onUpdate:modelValue"],he={class:"border border-gray-300 px-2"},xe=["onUpdate:modelValue"],we={class:"border border-gray-300 px-2"},Ae=["onUpdate:modelValue"],Se={class:"border border-gray-300 px-2"},Ce=["onUpdate:modelValue","disabled"],Ue={key:0},Ve={key:1},Me={class:"space-y-6"},qe={key:0,class:"text-red-500 text-sm text-left"},Te={class:"flex items-center justify-center gap-2 cursor-pointer"},Fe={class:"flex justify-center"},Be=["disabled"],De={key:0},$e={key:1},Je={__name:"AdminManualAttendanceApplication",setup(Pe){const U=I(),b=K(),r=te(),D=le(),u=y(b.query.date||r.selectedMonth||new Date().toISOString().slice(0,7)),_=y([]),c=y(!1),d=y(null),x=y(!0),o=y({company_id:b.query.company_id||"",department_id:b.query.department_id||"",line_type:b.query.line_type||"all",employee_id:b.query.employee_id||""}),V=async()=>{const s={company_id:o.value.company_id,department_id:o.value.department_id,line_type:o.value.line_type,selectedMonth:u.value,selectedStatus:r.selectedStatus};if(o.value.employee_id){s.user_id=o.value.employee_id,c.value=!0;try{await r.fetchAdminManualAttendances(s)}finally{c.value=!1}}else typeof r.setAttendances=="function"?r.setAttendances([]):r.attendances=[]};function $(){const s={};return u.value&&(s.date=String(u.value)),o.value.company_id&&(s.company_id=String(o.value.company_id)),o.value.department_id&&(s.department_id=String(o.value.department_id)),o.value.line_type&&o.value.line_type!=="all"&&(s.line_type=String(o.value.line_type)),o.value.employee_id&&(s.employee_id=String(o.value.employee_id)),s}let w=null;function P(){w&&clearTimeout(w),w=setTimeout(()=>{U.replace({query:$()}).catch(()=>{})},120)}let A=null;const M=y("");async function j(){P();const s=JSON.stringify({m:u.value||"",c:o.value.company_id||"",d:o.value.department_id||"",t:o.value.line_type||"all",e:o.value.employee_id||""});s!==M.value&&(await V(),M.value=s)}function g(){A&&clearTimeout(A),A=setTimeout(j,200)}Q(async()=>{await D.fetchUsers(),g()});function N(){g()}function O(){U.go(-1)}S(u,()=>{g()}),S(()=>({...o.value,month:u.value}),()=>g(),{deep:!0});const E=W(()=>r.attendances||[]);S(()=>r.attendances,s=>{_.value=[],(s||[]).forEach(e=>{_.value.push({date:e==null?void 0:e.date,type:"Forget Punch",check_in:e==null?void 0:e.entry_time,check_out:e==null?void 0:e.exit_time,description:"",is_check:!1})})},{immediate:!0,deep:!0});function L(){const s=_.value.every(e=>e.is_check);_.value.forEach(e=>{e.is_check=!s})}async function R(){var s;if(c.value=!0,d.value=null,!o.value.employee_id){d.value="Please select an employee.",c.value=!1;return}try{const e=_.value.filter(l=>l.is_check&&(l.check_in||l.check_out));if(!e.length){d.value="Please select at least one row.";return}const h=e.map(l=>({user_id:o.value.employee_id,type:l.type,check_in:l.check_in?`${l.date} ${l.check_in}:00`:null,check_out:l.check_out?`${l.date} ${l.check_out}:00`:null,description:l.description||""})),v=await r.createBulkManualAttendance({records:h,direct_approve:x.value});(s=v==null?void 0:v.data)!=null&&s.length&&await V()}catch(e){d.value=(e==null?void 0:e.message)||"Failed to submit manual attendance requests."}finally{c.value=!1}}return(s,e)=>{var h,v;return i(),n("div",oe,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:O},e[13]||(e[13]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[14]||(e[14]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Admin Bulk Manual Attendance Applications",-1)),e[15]||(e[15]=t("div",null,null,-1))]),t("div",se,[C(Y,{company_id:o.value.company_id,"onUpdate:company_id":e[0]||(e[0]=l=>o.value.company_id=l),department_id:o.value.department_id,"onUpdate:department_id":e[1]||(e[1]=l=>o.value.department_id=l),employee_id:o.value.employee_id,"onUpdate:employee_id":e[2]||(e[2]=l=>o.value.employee_id=l),line_type:o.value.line_type,"onUpdate:line_type":e[3]||(e[3]=l=>o.value.line_type=l),"with-type":!0,"initial-value":s.$route.query,onFilterChange:N},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",null,[p(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[4]||(e[4]=l=>u.value=l),class:"input-1"},null,512),[[f,u.value]])])]),q(r).loading?(i(),n("div",ae,[C(Z)])):(i(),n("div",ne,[(h=o.value)!=null&&h.employee_id?(i(),n("div",ie,[C(ee,{user:q(r).user},null,8,["user"])])):k("",!0),t("div",re,[t("div",{class:T(d.value?"py-2":"")},[d.value?(i(),n("div",de,F(d.value),1)):k("",!0)],2),t("table",ue,[t("thead",null,[t("tr",pe,[t("th",ce,[t("div",ye,[t("input",{id:"allCheck",type:"checkbox",onChange:L,class:"h-5 w-5 accent-blue-600 cursor-pointer"},null,32),e[16]||(e[16]=t("label",{for:"allCheck",class:"text-sm cursor-pointer"},"All Check",-1))])]),e[17]||(e[17]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Date",-1)),e[18]||(e[18]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Type",-1)),e[19]||(e[19]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Check-In",-1)),e[20]||(e[20]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Check-Out",-1)),e[21]||(e[21]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Description",-1))])]),t("tbody",null,[(i(!0),n(z,null,J(_.value,(l,H)=>(i(),n("tr",{key:H,class:T(["border-b border-gray-200 hover:bg-blue-200 cursor-pointer",l.is_check?"bg-yellow-100":""]),onClick:a=>l.is_check=!l.is_check},[t("td",_e,[p(t("input",{type:"checkbox","onUpdate:modelValue":a=>l.is_check=a,class:"h-5 w-5",onClick:e[5]||(e[5]=m(()=>{},["stop"]))},null,8,ve),[[B,l.is_check]])]),t("td",be,[p(t("input",{type:"date","onUpdate:modelValue":a=>l.date=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[6]||(e[6]=m(()=>{},["stop"])),disabled:""},null,8,fe),[[f,l.date]])]),t("td",ke,[p(t("select",{"onUpdate:modelValue":a=>l.type=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[7]||(e[7]=m(()=>{},["stop"]))},e[22]||(e[22]=[t("option",{value:""},"Select Type",-1),t("option",{value:"Home Office"},"Home Office",-1),t("option",{value:"Remote Work"},"Remote Work",-1),t("option",{value:"Forget Punch"},"Forget Punch",-1)]),8,ge),[[G,l.type]])]),t("td",he,[p(t("input",{type:"time","onUpdate:modelValue":a=>l.check_in=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[8]||(e[8]=m(()=>{},["stop"]))},null,8,xe),[[f,l.check_in]])]),t("td",we,[p(t("input",{type:"time","onUpdate:modelValue":a=>l.check_out=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[9]||(e[9]=m(()=>{},["stop"]))},null,8,Ae),[[f,l.check_out]])]),t("td",Se,[p(t("textarea",{"onUpdate:modelValue":a=>l.description=a,onKeyup:e[10]||(e[10]=m(()=>{},["stop"])),onClick:e[11]||(e[11]=m(()=>{},["stop"])),disabled:!l.check_in&&!l.check_out,class:"w-full border border-gray-600 py-1 px-2 rounded-sm disabled:bg-gray-300 disabled:cursor-not-allowed",cols:"1"},null,40,Ce),[[f,l.description]])])],10,me))),128)),E.value.length===0?(i(),n("tr",Ue,e[23]||(e[23]=[t("td",{colspan:"6",class:"p-2 text-center text-red-500"},"Please select any employee",-1)]))):k("",!0)])])]),(v=o.value)!=null&&v.employee_id?(i(),n("div",Ve,[t("div",Me,[d.value?(i(),n("div",qe,F(d.value),1)):k("",!0),t("div",Te,[p(t("input",{id:"directApprove",type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=l=>x.value=l),class:"accent-blue-600 h-6 w-6 cursor-pointer"},null,512),[[B,x.value]]),e[24]||(e[24]=t("label",{for:"directApprove",class:"text-lg cursor-pointer"},"Direct Approve",-1))]),t("div",Fe,[t("button",{type:"button",class:"btn-2",disabled:c.value,onClick:R},[c.value?(i(),n("span",De,e[25]||(e[25]=[t("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),X("Submitting...")]))):(i(),n("span",$e,"Submit All"))],8,Be)])])])):k("",!0)]))])}}};export{Je as default};
