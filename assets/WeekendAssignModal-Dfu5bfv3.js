import{Q as Z,r as T,q as p,h as B,x as m,y as ee,j as te,o as d,a as s,d as I,m as N,l as f,I as O,T as W,t as u,s as x,b as A,c,F as Y,e as K,k as se,P as E,v as P,a6 as ne,A as $}from"./index-javiA15k.js";import{d as ae}from"./dayjs.min-B-sP38Sp.js";import{u as le}from"./user-CuQ922DA.js";const oe={class:"relative flex min-h-full items-center justify-center p-4 sm:p-6"},re={class:"w-full max-w-4xl overflow-hidden rounded-3xl bg-white shadow-2xl ring-1 ring-black/5",role:"dialog","aria-modal":"true"},ie={class:"flex items-start justify-between gap-4 border-b border-slate-200 bg-gradient-to-br from-white to-slate-50 px-6 py-5"},de={class:"flex items-center gap-3 min-w-0"},ue={class:"h-11 w-11 rounded-2xl bg-indigo-50 text-indigo-700 ring-1 ring-indigo-100 flex items-center justify-center font-bold"},ce={class:"min-w-0"},ve={class:"flex flex-wrap items-center gap-2"},me={class:"mt-0.5 truncate text-xs text-slate-500"},pe={class:"grid gap-6 px-6 py-6 lg:grid-cols-2"},fe={class:"rounded-2xl border border-slate-200 bg-white shadow-sm"},xe={class:"flex items-center justify-between px-4 py-4"},ye={class:"text-xs font-semibold text-slate-500"},ge={class:"max-h-[340px] overflow-auto px-4 py-4"},be={key:0,class:"rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center"},he={key:1,class:"space-y-3"},_e={class:"flex items-start gap-3"},we={class:"min-w-0 flex-1"},ke={class:"flex flex-wrap items-center gap-2"},Ae={class:"truncate text-sm font-semibold text-slate-900"},Se={class:"mt-1 text-xs text-slate-500"},Ce={class:"font-semibold text-slate-700"},je={class:"font-semibold text-slate-700"},Te={class:"rounded-2xl border border-slate-200 bg-white shadow-sm"},Ve={class:"space-y-5 px-4 py-4"},Ee={class:"space-y-2"},De={class:"flex items-center justify-between"},Le={class:"grid grid-cols-4 gap-2"},Me=["value"],Fe={class:"flex cursor-pointer items-center justify-center rounded-xl border px-2 py-2 text-xs font-semibold transition border-slate-200 bg-white text-slate-700 hover:bg-slate-50 peer-checked:border-indigo-200 peer-checked:bg-indigo-50 peer-checked:text-indigo-700"},Ue={class:"text-xs text-slate-500"},Be={class:"font-semibold text-slate-700"},Ie={key:0,class:"rounded-2xl border border-sky-200 bg-sky-50 p-3 text-xs text-sky-700"},Ne={key:1,class:"rounded-2xl border border-amber-200 bg-amber-50 p-3 text-xs text-amber-800"},Oe={class:"grid gap-4 sm:grid-cols-2"},We={class:"space-y-1"},Ye={class:"space-y-1"},Ke={class:"flex items-center justify-between"},Pe={class:"inline-flex cursor-pointer items-center gap-2 text-xs font-semibold text-slate-600"},$e={key:1,class:"rounded-xl border border-dashed border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-500"},ze={class:"flex items-center justify-between rounded-2xl border border-slate-200 bg-white px-4 py-3"},Re={class:"flex items-end justify-end gap-3 border-t border-slate-200 bg-slate-50 px-4 py-4"},qe={class:"flex items-center gap-2"},He=["disabled"],Qe=["disabled"],Ge={key:0},Je={key:1},z="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm placeholder:text-slate-400 outline-none transition focus:border-sky-400 focus:ring-4 focus:ring-sky-400/20",Xe="inline-flex h-9 w-9 items-center justify-center rounded-xl text-slate-600 transition hover:bg-slate-100 hover:text-slate-900 focus:outline-none focus:ring-4 focus:ring-slate-900/10",st={__name:"WeekendAssignModal",props:{modelValue:{type:Boolean,default:!1},isOpen:{type:Boolean,default:!1},userId:{type:[Number,String],default:""},userLabel:{type:String,default:""},defaultFrom:{type:String,default:()=>new Date().toISOString().slice(0,7)},defaultTo:{type:String,default:""},assign_weekend:{type:Object,default:null},weekend_assignments:{type:[Object,Array,null],default:null},assign_weekends:{type:Object,default:null}},emits:["update:modelValue","saved","close","update"],setup(V,{emit:R}){const o=V,y=R,g=Z(),q=le(),i=T(!1);p(()=>o.modelValue,t=>{t!==i.value&&(i.value=t)}),p(()=>o.isOpen,t=>{t!==i.value&&(i.value=t)}),B(()=>{i.value=!!(o.modelValue||o.isOpen)}),p(i,t=>{document.documentElement.style.overflow=t?"hidden":""});const b=T(!1),_=T(!1),n=T({weekends:[],start_month:o.defaultFrom,end_month:o.defaultTo,active:!0}),H=m(()=>{var a,v;const t=o.userLabel||String(o.userId||""),e=t.trim().split(/\s+/);return((((a=e[0])==null?void 0:a[0])||"")+(((v=e[1])==null?void 0:v[0])||"")||t[0]||"#").toUpperCase().slice(0,2)});function r(t){return t&&(typeof t=="string"&&/^\d{4}-\d{2}$/.test(t)?t:ae(t).format("YYYY-MM"))||""}function D(t){const e=Array.isArray(t==null?void 0:t.weekends)?t.weekends.join(", "):"",l=r(t==null?void 0:t.start_month),a=r(t==null?void 0:t.end_month);return`${e||"—"} • ${l||"—"} → ${a||"present"}`}const Q=m(()=>{var e;if((e=o.assign_weekends)!=null&&e.history&&Array.isArray(o.assign_weekends.history))return o.assign_weekends.history;const t=o.weekend_assignments??(o.assign_weekend?[o.assign_weekend]:[]);return Array.isArray(t)?t:t?[t]:[]}),w=m(()=>Q.value.map(e=>{const l=r(e.start_month),a=r(e.end_month),v=typeof e.active=="boolean"?e.active:!a;return{id:e.id??null,weekends:Array.isArray(e.weekends)?e.weekends:[],start_month:l,end_month:a,active:v,label:D(e),created_at:e.created_at?new Date(e.created_at).getTime():0}}).sort((e,l)=>e.active!==l.active?e.active?-1:1:(l.start_month||"").localeCompare(e.start_month||""))),S=m(()=>{var e;const t=((e=o.assign_weekends)==null?void 0:e.current)||null;if(t){const l=r(t.end_month);return{id:t.id??null,weekends:Array.isArray(t.weekends)?t.weekends:[],start_month:r(t.start_month),end_month:l,active:typeof t.active=="boolean"?t.active:!l,label:D(t),created_at:t.created_at?new Date(t.created_at).getTime():0}}return w.value.find(l=>l.active)||w.value[0]||null}),h=m(()=>!!S.value&&S.value.active),C=m(()=>{if(!h.value)return!1;const t=S.value,e=(n.value.weekends||[]).slice().sort().join(","),l=(t.weekends||[]).slice().sort().join(",");return e===l&&r(n.value.start_month)===r(t.start_month)&&r(n.value.end_month)===r(t.end_month)}),L=m(()=>{const t=Array.isArray(n.value.weekends)&&n.value.weekends.length>0,e=!!r(n.value.start_month);return!!o.userId&&t&&e&&!b.value&&!C.value}),G=m(()=>{const t=n.value.weekends||[];return t.length?t.join(", "):"—"});function M(){const t=S.value;t&&(n.value.weekends=Array.isArray(t.weekends)?t.weekends.slice():[],n.value.start_month=r(t.start_month)||o.defaultFrom,n.value.end_month=r(t.end_month)||"",n.value.active=!!t.active,_.value=!!r(t.end_month))}p(i,(t,e)=>{t&&!e&&$(M)}),p(()=>o.assign_weekends,()=>{i.value&&$(M)},{deep:!0}),p(n,t=>{y("update",{...t})},{deep:!0});function k(){i.value&&(i.value=!1,y("update:modelValue",!1),y("close",!1))}async function F(){var t,e;try{if(!o.userId)return g.error("Employee নির্বাচন করুন");if(!Array.isArray(n.value.weekends)||n.value.weekends.length===0)return g.error("কমপক্ষে একদিন নির্বাচন করুন");if(!r(n.value.start_month))return g.error("Start month নির্বাচন করুন");if(C.value){g.info("এটা ইতিমধ্যেই Active কনফিগের মতোই আছে");return}b.value=!0;const l={weekends:n.value.weekends,start_month:r(n.value.start_month),end_month:r(n.value.end_month)||"",active:!!n.value.active},a=await q.updateOrCreateWeekend(o.userId,l);i.value=!1,y("update:modelValue",!1),y("close",!1),g.success(h.value?"Reassigned":"Assigned"),y("saved",a),k()}catch(l){const a=((e=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:e.message)||(l==null?void 0:l.message)||"Failed";g.error(a)}finally{b.value=!1}}function U(t){i.value&&(t.key==="Escape"&&k(),(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="enter"&&L.value&&F())}B(()=>window.addEventListener("keydown",U)),ee(()=>{window.removeEventListener("keydown",U),document.documentElement.style.overflow=""});const j=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"],J=t=>t.slice(0,3).toUpperCase();function X(){(n.value.weekends||[]).length===j.length?n.value.weekends=[]:n.value.weekends=j.slice()}return p(_,t=>{t||(n.value.end_month="")}),(t,e)=>(d(),te(ne,{to:"body"},[s("div",{class:x(["fixed inset-0 z-50",i.value?"pointer-events-auto":"pointer-events-none"])},[I(W,{"enter-active-class":"transition-opacity duration-150 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-120 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:N(()=>[f(s("div",{class:"absolute inset-0 backdrop-blur-sm",onClick:k},null,512),[[O,i.value]])]),_:1}),s("div",oe,[I(W,{"enter-active-class":"transition duration-150 ease-out","enter-from-class":"opacity-0 translate-y-2 scale-[0.98]","enter-to-class":"opacity-100 translate-y-0 scale-100","leave-active-class":"transition duration-120 ease-in","leave-from-class":"opacity-100 translate-y-0 scale-100","leave-to-class":"opacity-0 translate-y-2 scale-[0.98]"},{default:N(()=>{var l;return[f(s("div",re,[s("div",ie,[s("div",de,[s("div",ue,u(H.value),1),s("div",ce,[s("div",ve,[e[5]||(e[5]=s("h3",{class:"text-base font-semibold text-slate-900"},"Assign Weekends",-1)),s("span",{class:x(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold ring-1",h.value?"bg-emerald-50 text-emerald-700 ring-emerald-100":"bg-slate-100 text-slate-700 ring-slate-200"])},u(h.value?"Active config exists":"No active config"),3)]),s("p",me,[A(u(V.userLabel||"#"+V.userId)+" ",1),e[6]||(e[6]=s("span",{class:"mx-2 text-slate-300"},"•",-1)),e[7]||(e[7]=s("span",{class:"text-slate-400"},"Esc",-1)),e[8]||(e[8]=s("span",{class:"mx-1 text-slate-300"},"/",-1)),e[9]||(e[9]=s("span",{class:"text-slate-400"},"Ctrl/⌘ + Enter",-1))])])]),s("button",{class:x(Xe),onClick:k,"aria-label":"Close"},e[10]||(e[10]=[s("span",{class:"text-lg leading-none"},"✕",-1)]))]),s("div",pe,[s("section",fe,[s("div",xe,[e[11]||(e[11]=s("div",null,[s("p",{class:"text-sm font-semibold text-slate-900"},"History"),s("p",{class:"text-xs text-slate-500"},"Latest assignments at top")],-1)),s("span",ye,u(w.value.length)+" item(s)",1)]),e[15]||(e[15]=s("div",{class:"h-px bg-slate-200"},null,-1)),s("div",ge,[w.value.length?(d(),c("ol",he,[(d(!0),c(Y,null,K(w.value,(a,v)=>(d(),c("li",{key:a.id??v,class:"rounded-2xl border border-slate-200 bg-white p-4 transition hover:bg-slate-50"},[s("div",_e,[s("div",{class:x(["mt-1 h-3 w-3 rounded-full",a.active?"bg-emerald-500":"bg-slate-300"])},null,2),s("div",we,[s("div",ke,[s("p",Ae,u(a.label),1),s("span",{class:x(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold ring-1",a.active?"bg-emerald-50 text-emerald-700 ring-emerald-100":"bg-slate-100 text-slate-700 ring-slate-200"])},u(a.active?"Active":"Closed"),3)]),s("p",Se,[e[13]||(e[13]=A(" Period: ")),s("span",Ce,u(a.start_month||"—"),1),e[14]||(e[14]=A(" → ")),s("span",je,u(a.end_month||"present"),1)])])])]))),128))])):(d(),c("div",be,e[12]||(e[12]=[s("p",{class:"text-sm font-medium text-slate-700"},"No assignment history",-1),s("p",{class:"mt-1 text-xs text-slate-500"},"Create the first weekend configuration.",-1)])))])]),s("section",Te,[e[22]||(e[22]=s("div",{class:"px-4 py-4"},[s("p",{class:"text-sm font-semibold text-slate-900"},"Configure"),s("p",{class:"text-xs text-slate-500"},"Pick weekend days & effective month")],-1)),e[23]||(e[23]=s("div",{class:"h-px bg-slate-200"},null,-1)),s("div",Ve,[s("div",Ee,[s("div",De,[e[16]||(e[16]=s("label",{class:"text-sm font-semibold text-slate-800"},"Weekend Days",-1)),s("button",{type:"button",class:"text-xs font-semibold text-indigo-600 hover:text-indigo-700",onClick:X},u((n.value.weekends||[]).length===j.length?"Clear all":"Select all"),1)]),s("div",Le,[(d(),c(Y,null,K(j,a=>s("label",{key:a,class:"relative"},[f(s("input",{class:"peer sr-only",type:"checkbox",value:a,"onUpdate:modelValue":e[0]||(e[0]=v=>n.value.weekends=v)},null,8,Me),[[E,n.value.weekends]]),s("span",Fe,u(J(a)),1)])),64))]),s("p",Ue,[e[17]||(e[17]=A(" Selected: ")),s("span",Be,u(G.value),1)])]),C.value?(d(),c("div",Ie," This configuration already matches the active assignment. ")):h.value&&(((l=n.value.weekends)==null?void 0:l.length)||0)>0?(d(),c("div",Ne," Saving will close the current configuration and apply the new one. ")):se("",!0),s("div",Oe,[s("div",We,[e[18]||(e[18]=s("label",{class:"text-sm font-semibold text-slate-800"},"Effective From",-1)),f(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.start_month=a),type:"month",class:x(z)},null,512),[[P,n.value.start_month]])]),s("div",Ye,[s("div",Ke,[e[20]||(e[20]=s("label",{class:"text-sm font-semibold text-slate-800"},"End Month",-1)),s("label",Pe,[f(s("input",{type:"checkbox",class:"rounded border-slate-300","onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a)},null,512),[[E,_.value]]),e[19]||(e[19]=A(" Set end "))])]),_.value?f((d(),c("input",{key:0,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.end_month=a),type:"month",class:x(z)},null,512)),[[P,n.value.end_month]]):(d(),c("div",$e," No end month (present) "))])]),s("label",ze,[e[21]||(e[21]=s("div",null,[s("p",{class:"text-sm font-semibold text-slate-800"},"Active"),s("p",{class:"text-xs text-slate-500"},"Keep this configuration active")],-1)),f(s("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=a=>n.value.active=a),class:"h-5 w-5 rounded border-slate-300"},null,512),[[E,n.value.active]])])]),s("div",Re,[s("div",qe,[s("button",{class:"btn-2-red",onClick:k,disabled:b.value},"Cancel",8,He),s("button",{class:"btn-2",onClick:F,disabled:!L.value||b.value},[b.value?(d(),c("span",Je,"Processing…")):(d(),c("span",Ge,u(h.value?C.value?"Assigned":"Reassign":"Assign"),1))],8,Qe)])])])])],512),[[O,i.value]])]}),_:1})])],2)]))}};export{st as _};
