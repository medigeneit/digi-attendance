import{r as b,x as V,z as O,s as Y,o as i,c,a as e,t as u,k as T,h,d as A,B,F as q,q as M,v as L,e as R,b as G,l as S,m as j,f as K,n as P,p as H,g as J}from"./index-BaZ9nW2H.js";import{L as Q}from"./LoaderView-DvrRsAmr.js";import{u as F}from"./shift-BU404X9Q.js";import{d as N}from"./dayjs.min-Cbbdfn5l.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as X}from"./MultiselectDropdown-CDcWwUe5.js";import{u as Z}from"./user-DLbzh13J.js";import"./vue-multiselect.esm-25boae-2.js";const ee={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},te={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},se={class:"text-lg font-semibold mb-4"},oe={class:"mb-4"},ae=["value"],le={class:"mb-4"},de={class:"mb-4"},ne={class:"flex justify-end gap-3 mt-4"},re={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(C,{emit:U}){const $=U,l=C,s=b({shift_id:"",employee_id:l.employee.id,start_date:"",end_date:""}),_=V(()=>{const d=Object.keys(l.shifts)[0];return l.shifts[d]||[]});O(()=>l.employee,d=>{s.value.employee_id=(d==null?void 0:d.id)||0},{immediate:!0,deep:!0}),O(()=>l.isOpen,d=>{var o;d&&(l.hasShift?(s.value.shift_id=l.hasShift.shift_id||"",s.value.start_date=l.hasShift.start_date?N(l.hasShift.start_date).format("YYYY-MM-DD"):"",s.value.end_date=l.hasShift.end_date?N(l.hasShift.end_date).format("YYYY-MM-DD"):"",s.value.employee_id=((o=l.employee)==null?void 0:o.id)||""):(s.value.shift_id="",s.value.start_date="",s.value.end_date=""))},{immediate:!0});const v=()=>{$("close",!1)},m=F(),{message:g}=Y(m),k=async()=>{if(!s.value.shift_id||!s.value.start_date||!s.value.employee_id){alert("All fields are required!");return}try{const d={...s.value},o=await m.shiftAssign(d);console.log("Shift assigned successfully:",o),alert(l.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),v()}catch(d){console.error("Failed to assign shift:",d),alert("Failed to assign shift.")}};return(d,o)=>C.isOpen?(i(),c("div",ee,[e("div",te,[e("h2",se,u(l.hasShift?"Update Shift for":"Assign Shift to")+" "+u(C.employee.name),1),T(" "+u(h(g))+" ",1),e("div",oe,[o[4]||(o[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),A(e("select",{"onUpdate:modelValue":o[0]||(o[0]=n=>s.value.shift_id=n),class:"w-full p-2 border rounded"},[o[3]||(o[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(i(!0),c(q,null,M(_.value,n=>(i(),c("option",{key:n==null?void 0:n.id,value:n==null?void 0:n.id},u(n==null?void 0:n.name),9,ae))),128))],512),[[B,s.value.shift_id]])]),e("div",le,[o[5]||(o[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),A(e("input",{type:"date","onUpdate:modelValue":o[1]||(o[1]=n=>s.value.start_date=n),class:"w-full border rounded p-2"},null,512),[[L,s.value.start_date]])]),e("div",de,[o[6]||(o[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),A(e("input",{type:"date","onUpdate:modelValue":o[2]||(o[2]=n=>s.value.end_date=n),class:"w-full border rounded p-2"},null,512),[[L,s.value.end_date]])]),e("div",ne,[e("button",{onClick:v,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:k,class:"px-4 py-2 bg-green-600 text-white rounded"},u(l.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:v,class:"absolute top-2 right-2 text-red-500 text-xl"},o[7]||(o[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):R("",!0)}},ie=W(re,[["__scopeId","data-v-c3e70801"]]),ce={class:"space-y-2 px-4"},ue={class:"flex items-center justify-between gap-2"},pe={class:"flex flex-wrap items-center justify-start gap-2"},fe={key:0,class:"text-center py-4"},me={key:1,class:"space-y-4"},ye={class:"title-md"},be={class:"overflow-x-auto"},he={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},_e={class:"border border-gray-300 px-2"},ve={class:"border border-gray-300 px-2"},ge={class:"border border-gray-300 px-2"},xe={class:"border border-gray-300 px-2"},Se={class:"border border-gray-300 px-2"},ke=["onClick"],we={key:0},Ce={class:"border border-gray-300 px-2"},Ue={class:"border border-gray-300 px-2"},Ae={class:"border border-gray-300 px-2"},qe={key:0,class:"text-green-500"},Me={key:1,class:"text-red-500"},$e={class:"border border-gray-300 px-2"},je={class:"flex gap-2"},Re={__name:"UserList",setup(C){const U=F(),{shifts:$}=Y(U),l=J(),s=K(),_=Z(),v=b([]),m=b(s.query.company||"all"),g=b(""),k=b(""),d=b(!1);G(()=>{_.fetchUsers()});const o=()=>{l.go(-1)};O(m,r=>{l.push({query:{...s.query,company:r}})});const n=V(()=>{var p;const r={},a=new Set;_.users.forEach(f=>{var x;const t=((x=f.company)==null?void 0:x.name)||"Unknown Company";r[t]||(r[t]=[]),r[t].push(f),a.add(t)}),v.value=Array.from(a);let y=r;if(m.value!=="all"&&(y={[m.value]:r[m.value]||[]}),(p=g.value)!=null&&p.id){const f={};for(const[t,x]of Object.entries(y)){const w=x.filter(E=>E.id===g.value.id);w.length&&(f[t]=w)}return f}return y}),D=b("");function z(r){D.value=r.id,k.value=r,(r==null?void 0:r.company_id)!==void 0&&(U.fetchShifts(r==null?void 0:r.company_id),d.value=!d.value)}function I(){d.value=!1}return(r,a)=>{const y=P("RouterLink");return i(),c("div",ce,[e("div",ue,[e("button",{class:"btn-3",onClick:o},a[2]||(a[2]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),a[4]||(a[4]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),S(y,{to:{name:"UserAdd",query:{company:h(s).query.company}},class:"btn-2"},{default:j(()=>a[3]||(a[3]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1},8,["to"])]),e("div",pe,[e("div",null,[A(e("select",{"onUpdate:modelValue":a[0]||(a[0]=p=>m.value=p),class:"input-1"},[a[5]||(a[5]=e("option",{value:"all",selected:""},"All Company",-1)),(i(!0),c(q,null,M(v.value,(p,f)=>(i(),c("option",{key:f},u(p),1))),128))],512),[[B,m.value]])]),S(X,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=p=>g.value=p),options:h(_).users,multiple:!1,label:"name",placeholder:"Select user"},null,8,["modelValue","options"])]),h(_).isLoading?(i(),c("div",fe,[S(Q)])):(i(),c("div",me,[(i(!0),c(q,null,M(n.value,(p,f)=>(i(),c("div",{key:f},[e("h2",ye,u(f),1),e("div",be,[e("table",he,[a[8]||(a[8]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(i(!0),c(q,null,M(p,(t,x)=>{var w;return i(),c("tr",{key:t.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",_e,u(x+1),1),e("td",ve,u(t==null?void 0:t.name),1),e("td",ge,u((w=t.designation)==null?void 0:w.title),1),e("td",xe,u(t.role),1),e("td",Se,[e("button",{type:"button",onClick:E=>z(t),class:H(["btn-4 text-sm",t!=null&&t.current_shift?"bg-yellow-500 hover:bg-yellow-600":"btn-4"])},u(t!=null&&t.current_shift?"Change Shift":"Assign Shift"),11,ke),D.value===t.id&&d.value?(i(),c("div",we,[S(ie,{isOpen:d.value,shifts:h($),hasShift:t==null?void 0:t.current_shift,employee:{id:k.value.id,name:k.value.name},onClose:I},null,8,["isOpen","shifts","hasShift","employee"])])):R("",!0)]),e("td",Ce,u(t.phone),1),e("td",Ue,u(t.email||"নেই"),1),e("td",Ae,[t.is_active?(i(),c("span",qe,"Active")):(i(),c("span",Me,"Inactive"))]),e("td",$e,[e("div",je,[S(y,{to:{name:"UserShow",params:{id:t.id},query:{company:h(s).query.company}},class:"btn-icon"},{default:j(()=>a[6]||(a[6]=[e("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"]),S(y,{to:{name:"UserEdit",params:{id:t.id},query:{company:h(s).query.company}},class:"btn-icon"},{default:j(()=>a[7]||(a[7]=[e("i",{class:"far fa-edit"},null,-1)])),_:2},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{Re as default};
