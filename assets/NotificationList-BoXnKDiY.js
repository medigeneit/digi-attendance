import{u as $,M as N,s as C,r as h,b as B,p as E,o as s,c as _,d as O,v as q,a as n,e as v,t as A,h as k,F as U,x as D,y as F,j as R,m as I,g as V,f as z,n as G}from"./index-C7frSrAV.js";import{u as J}from"./leave-application-BFSRDFy7.js";import{u as Z}from"./exchange-D9GdXvLb.js";import{u as K}from"./short-leave-Cyy_Zjdl.js";const P={key:0,class:"text-center space-y-2 print:hidden"},Q={key:0,class:"mt-2"},W={class:"flex justify-end gap-2 pt-2"},X={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(S){const y=$(),p=N(),f=Z(),{user:m}=C(y),w=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(w.application))});const u=h(!1),i=h(""),r=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await f.handoverAccept(e),alert("Handover approved!"),await l()},condition:()=>{var e,o;return!((e=t.value)!=null&&e.status)&&((o=t.value)==null?void 0:o.handover_user_id)===m.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await f.inChargeAccept(e),alert("In-Charge approved!"),await l()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await f.recommendByAccept(e),alert("Recommendation approved!"),await l()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await f.approvedByAccept(e),alert("Final approval successful!"),await l()}}],c=E(()=>r.find(e=>{var o,d,b,x;return t.value?e.key==="handover"?e.condition():((o=t.value)==null?void 0:o.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((b=t.value)!=null&&b[e.approved_field])&&((x=t.value)==null?void 0:x[e.approved_by_field])===m.value.id:!1})),g=()=>{u.value&&i.value?(a(),u.value=!1):u.value=!0};async function a(){try{await f.rejectExchange(t.value.id,i.value),alert("Exchange application rejected!"),i.value="",await l(t.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function l(e){await p.markAsRead(w.notificationId)}return(e,o)=>c.value&&t.value?(s(),_("div",P,[u.value?(s(),_("div",Q,[O(n("textarea",{"onUpdate:modelValue":o[0]||(o[0]=d=>i.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,i.value]])])):v("",!0),n("div",W,[n("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:o[1]||(o[1]=d=>c.value.action(t.value.id))}," Approve "),n("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:g}," Reject ")])])):v("",!0)}},Y={key:0,class:"text-center space-y-2 print:hidden"},M={key:0,class:"mt-2"},ee={class:"flex justify-end gap-2 pt-2"},ae={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(S){const y=$(),p=J(),f=N(),{user:m}=C(y),w=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(w.application))});const u=h(!1),i=h(""),r=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await p.acceptHandover(e),alert("Handover approved!"),await l()},condition:()=>{var e,o;return!((e=t.value)!=null&&e.status)&&((o=t.value)==null?void 0:o.handover_user_id)===m.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await p.acceptInCharge(e),alert("In-Charge approved!"),await l()}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async e=>{await p.acceptCoordinator(e),alert("Coordinator approved!"),await l()}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async e=>{await p.acceptOperationalAdmin(e),alert("Operational Admin approved!"),await l()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await p.acceptRecommendBy(e),alert("Recommendation approved!"),await l()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await p.acceptApprovedBy(e),alert("Final approval successful!"),await l()}}],c=E(()=>r.find(e=>{var b,x,j,L;if(!t.value)return!1;if(e.key==="handover")return e.condition();const o=!!((b=t.value)!=null&&b[e.approved_field]),d=((x=t.value)==null?void 0:x[e.approved_by_field])===m.value.id;return((j=t.value)==null?void 0:j.status)!=="Rejected"&&((L=t.value)==null?void 0:L.status)!=="Approved"&&!o&&d})),g=()=>{u.value&&i.value?(a(),u.value=!1):u.value=!0};async function a(){try{await p.rejectLeaveApplication(t.value.id,{rejection_reason:i.value}),alert("Application rejected!"),i.value="",await l(t.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function l(e){await f.markAsRead(w.notificationId)}return(e,o)=>c.value&&t.value?(s(),_("div",Y,[u.value?(s(),_("div",M,[O(n("textarea",{"onUpdate:modelValue":o[0]||(o[0]=d=>i.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,i.value]])])):v("",!0),n("div",ee,[n("button",{class:"btn-2",onClick:o[1]||(o[1]=d=>c.value.action(t.value.id))},"Approve"),n("button",{class:"btn-1",onClick:g},"Reject")])])):v("",!0)}},te={key:0,class:"text-center space-y-2 print:hidden"},oe={key:0,class:"mt-2"},ne={class:"flex justify-end gap-2 pt-2"},re={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(S){const y=$(),p=K(),f=N(),{user:m}=C(y),w=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(w.application))});const u=h(!1),i=h(""),r=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await p.handoverAccept(e),alert("Handover approved!"),await l()},condition:()=>{var e,o;return!((e=t.value)!=null&&e.status)&&((o=t.value)==null?void 0:o.handover_user_id)===m.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await p.inChargeAccept(e),alert("In-Charge approved!"),await l()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await p.recommendByAccept(e),alert("Recommendation approved!"),await l()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await p.approvedByAccept(e),alert("Final approval successful!"),await l()}}],c=E(()=>r.find(e=>{var o,d,b,x;return t.value?e.key==="handover"?e.condition():((o=t.value)==null?void 0:o.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((b=t.value)!=null&&b[e.approved_field])&&((x=t.value)==null?void 0:x[e.approved_by_field])===m.value.id:!1})),g=()=>{u.value&&i.value?(a(),u.value=!1):u.value=!0};async function a(){try{await p.rejectShortLeave(t.value.id,i.value),alert("Application rejected!"),i.value="",await l(t.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function l(e){await f.markAsRead(w.notificationId)}return(e,o)=>c.value&&t.value?(s(),_("div",te,[u.value?(s(),_("div",oe,[O(n("textarea",{"onUpdate:modelValue":o[0]||(o[0]=d=>i.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,i.value]])])):v("",!0),n("div",ne,[u.value?v("",!0):(s(),_("button",{key:0,class:"btn-2",onClick:o[1]||(o[1]=d=>c.value.action(t.value.id))}," Approve ")),n("button",{class:"btn-1",onClick:g},A(u.value?"Submit":"Reject"),1)])])):v("",!0)}},se={class:"space-y-6 px-4 py-4"},ie={class:"text-2xl font-semibold capitalize text-gray-700"},le={key:0,class:"space-y-4"},ce={class:"flex items-start gap-4"},de={class:"text-2xl text-blue-500"},pe={class:"flex-1"},ue={class:"text-gray-800 font-medium"},ve={class:"text-gray-800 font-medium"},_e={class:"text-gray-600 text-sm"},ye={key:0,class:"text-xs text-gray-400"},fe={key:1,class:"text-xs"},he={class:"text-xs text-gray-400"},ge={key:0,class:"flex items-center justify-between"},be={key:1,class:"text-center text-red-500 py-10"},Ae={__name:"NotificationList",setup(S){V();const y=z(),p=N(),{notifications:f}=C(p);J();const m=$();C(m),h(!1),h({}),h({}),B(()=>{p.fetchNotifications()});const w=(r,c)=>{if(!r)return"No application details";switch(c){case"leaveApplication":return`Leave: ${r.last_working_date} â†’ ${r.resumption_date}`;case"shortLeave":return`Short Leave on ${i(r.start_time)??"N/A"} to 
      ${r.end_time?i(r.end_time):""}`;case"exchange":return`Exchange (${r.exchange_type}) on ${r.exchange_date}`;default:return"Unknown Event"}},t=r=>{switch(r){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"exchange":return"fas fa-random";default:return"fas fa-bell"}},u=r=>new Date(r).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),i=r=>{const[c,g]=r.split(":").map(Number),a=new Date;return a.setHours(c,g),a.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(r,c)=>{const g=G("RouterLink");return s(),_("div",se,[n("h2",ie,A(k(y).query.type.replace(/([A-Z])/g," $1")),1),k(f)[k(y).query.type]?(s(),_("div",le,[(s(!0),_(U,null,D(k(f)[k(y).query.type],(a,l)=>{var e,o,d,b,x,j,L,H,T;return s(),_("div",{key:a.id,class:"bg-white p-4 rounded-xl shadow border"},[n("div",ce,[n("div",de,[n("i",{class:F(t(a.event_type))},null,2)]),n("div",pe,[n("p",ue,A((e=a.event_model)==null?void 0:e.user_name),1),n("p",ve,"Reason: "+A((o=a.event_model)==null?void 0:o.reason),1),n("p",_e,A(w(a.event_model,a.event_type)),1),(d=a==null?void 0:a.event_model)!=null&&d.total_leave?(s(),_("p",ye," Total Leave: "+A(a==null?void 0:a.event_model.total_leave)+" days ",1)):v("",!0),(b=a==null?void 0:a.event_model)!=null&&b.type?(s(),_("p",fe," Type : "+A((x=a==null?void 0:a.event_model)==null?void 0:x.type),1)):v("",!0),n("p",he,A(u(a.created_at)),1)]),a!=null&&a.event_model?(s(),_("div",ge,[k(y).query.type==="leaveApplication"?(s(),R(g,{key:0,to:{name:"LeaveApplicationShow",params:{id:(j=a==null?void 0:a.event_model)==null?void 0:j.id}},class:"btn-icon"},{default:I(()=>c[0]||(c[0]=[n("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):v("",!0),k(y).query.type==="shortLeave"?(s(),R(g,{key:1,to:{name:"ShortLeaveShow",params:{id:(L=a==null?void 0:a.event_model)==null?void 0:L.id}},class:"btn-icon"},{default:I(()=>c[1]||(c[1]=[n("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):v("",!0),k(y).query.type==="exchange"?(s(),R(g,{key:2,to:{name:((H=a==null?void 0:a.event_model)==null?void 0:H.exchange_type)=="offday"?"ExchangeOffdayShow":"ExchangeShiftShow",params:{id:(T=a==null?void 0:a.event_model)==null?void 0:T.id}},class:"btn-icon"},{default:I(()=>c[2]||(c[2]=[n("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):v("",!0)])):v("",!0)]),a!=null&&a.event_model&&a.event_type==="leaveApplication"?(s(),R(ae,{key:0,application:a.event_model,"notification-id":a.id},null,8,["application","notification-id"])):v("",!0),a!=null&&a.event_model&&a.event_type==="shortLeave"?(s(),R(re,{key:1,application:a.event_model,"notification-id":a.id},null,8,["application","notification-id"])):v("",!0),a!=null&&a.event_model&&a.event_type==="exchange"?(s(),R(X,{key:2,application:a.event_model,notificationId:a.id},null,8,["application","notificationId"])):v("",!0)])}),128))])):(s(),_("div",be,"No notifications found."))])}}};export{Ae as default};
