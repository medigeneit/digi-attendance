import{E as A,d as H,c as r,g as I,k as p,o as a,a as e,x as C,F as S,y as L,q as U,j as T,t as M,r as k,A as V,e as N,n as $,h as O,v as B,G as R,u as F,w as K,f as j,l as te,H as z,I as se,J as ne,m as ae,i as Y,b as oe}from"./index-BRcUpGA5.js";import{u as re}from"./company-Aq0ticOI.js";import{u as le}from"./department-DfBzBXZR.js";import{u as ie}from"./user-B4y_9-e2.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={__name:"AddNewButton",setup(l){const t=A(),o=H(),s=()=>{t.openAddModal=!0};return(n,i)=>{var c;return["admin","super_admin","developer"].includes((c=p(o).user)==null?void 0:c.role)?(a(),r("div",{key:0,onClick:s,title:"Add New Conversation",class:"size-10 shrink-0 grow-0 flex justify-center items-center"},i[0]||(i[0]=[e("i",{class:"fas fa-comment-alt-plus text-3xl cursor-pointer text-[#24A1DE]"},null,-1)]))):I("",!0)}}},ue={class:"flex justify-center items-center gap-3"},ce=["onClick"],me={__name:"ConversationTypeSelector",props:{modelValue:{type:String,default:""},onSelect:{tyep:Function,default:()=>{}}},emits:["update:modelValue"],setup(l,{emit:t}){const o=l,s=t,n=C(()=>[{label:"Direct",value:"direct",iconClass:"fas fa-handshake"},{label:"Group",value:"group",iconClass:"fas fa-users"}]);function i(c){s("update:modelValue",c.value),o.onSelect()}return(c,m)=>(a(),r("div",ue,[(a(!0),r(S,null,L(n.value,d=>(a(),r("button",{key:d.value,class:U(["cursor-pointer px-6 py-1 border rounded-lg transition font-bold",l.modelValue===d.value?"bg-sky-600 text-white border-sky-600":"hover:bg-gray-50"]),onClick:g=>i(d)},[e("i",{class:U(d.iconClass)},null,2),T(" "+M(d.label),1)],10,ce))),128))]))}},ve={class:"flex flex-col md:flex-row justify-center md:items-center gap-2"},pe=["value"],fe={__name:"GroupTitleInput",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(l,{emit:t}){return(o,s)=>(a(),r("div",ve,[s[1]||(s[1]=e("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"}," Group Title ",-1)),e("input",{id:"title",value:l.modelValue,onInput:s[0]||(s[0]=n=>o.$emit("update:modelValue",n.target.value)),type:"text",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},null,40,pe)]))}},ye={class:"grid sm:grid-cols-2 gap-4"},xe={class:"flex flex-row justify-center items-center gap-2"},ge=["value"],he=["value"],be={class:"flex flex-row justify-center items-center gap-2"},_e=["value","disabled"],we=["value"],ke={__name:"CompanyDepartmentFilter",props:{companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""}},emits:["update:companyId","update:departmentId"],setup(l,{emit:t}){return(o,s)=>(a(),r("div",ye,[e("div",xe,[s[3]||(s[3]=e("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Company",-1)),e("select",{value:l.companyId,onChange:s[0]||(s[0]=n=>o.$emit("update:companyId",n.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},[s[2]||(s[2]=e("option",{value:""},"-- Company --",-1)),(a(!0),r(S,null,L(l.companies,n=>(a(),r("option",{key:n.id,value:n.id},M(n.name),9,he))),128))],40,ge)]),e("div",be,[s[5]||(s[5]=e("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Department",-1)),e("select",{value:l.departmentId,disabled:!l.companyId,onChange:s[1]||(s[1]=n=>o.$emit("update:departmentId",n.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60"},[s[4]||(s[4]=e("option",{value:""},"-- Department --",-1)),(a(!0),r(S,null,L(l.departments,n=>(a(),r("option",{key:n.id,value:n.id},M(n.name),9,we))),128))],40,_e)])]))}},Ce={class:"grid gap-2"},$e={key:0,class:"flex flex-wrap gap-2"},Ie={class:"font-medium"},Me=["onClick"],Se={class:"flex items-center gap-2"},Ue=["disabled"],Ae={class:"max-h-72 overflow-y-auto rounded-lg rounded-t-none border"},je={key:0,class:"p-4 text-gray-500 text-center"},Le={key:0,class:"p-4 text-center text-gray-600"},De={key:1,class:"divide-y"},Te=["for"],Ee={class:"w-full grow flex items-center gap-3"},Ve=["title"],Ne={class:"leading-tight"},ze={class:"font-medium text-sm md:text-base"},He={class:"text-xs text-gray-500"},Re={class:"w-14 md:w-auto md:shrink-0 inline-flex justify-center items-center text-right"},Oe={key:0,class:"text-gray-500 text-xs text-center"},Be=["id","type","name","checked","onChange"],W={__name:"UserPicker",props:{mode:{type:String,required:!0},users:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},selectedUserIds:{type:Array,default:()=>[]},alreadyAddedUserIds:{type:Array,default:()=>[]}},emits:["update:companyId","update:departmentId","update:selectedUserIds"],setup(l,{emit:t}){const o=l,s=t,n=re(),i=le(),c=ie(),m=H(),d=C({get:()=>o.companyId,set:b=>s("update:companyId",b)}),g=C({get:()=>o.departmentId,set:b=>s("update:departmentId",b)}),u=C({get:()=>o.selectedUserIds,set:b=>s("update:selectedUserIds",b)}),f=C(()=>n.companies||[]),x=C(()=>i.departments||[]),h=C(()=>c.users||[]),v=C(()=>{var b;return(b=o.users)!=null&&b.length?o.users:h.value}),w=k(""),G=C(()=>{if(!w.value.trim())return v.value;const b=w.value.trim().toLowerCase();return v.value.filter(_=>{const y=(_.name||"").toLowerCase(),D=String(_.employee_id||"").toLowerCase(),E=String(_.phone||"").toLowerCase(),P=String(_.email||"").toLowerCase();return y.includes(b)||D.includes(b)||E.includes(b)||P.includes(b)})}),q=C(()=>!d.value);function Z(b){let _=[...u.value];const y=_.indexOf(b.id);o.mode==="direct"?_=y>=0?[]:[b.id]:y>=0?_.splice(y,1):_.push(b.id),u.value=_}function ee(b){var y;const _=(y=v.value)==null?void 0:y.find(D=>parseInt(D.id)==parseInt(b));return _?_.name||_.employee_id||_.id:""}return V(()=>d.value,async(b,_)=>{b!==_&&(g.value="",u.value=[],b&&await i.fetchDepartments(b),await c.fetchUsers({company_id:b||null,department_id:null}))}),V(()=>g.value,async(b,_)=>{b!==_&&(u.value=[],d.value&&await c.fetchUsers({company_id:d.value,department_id:b||null}))}),N(async()=>{!f.value.length&&n.fetchCompanies&&await n.fetchCompanies(),d.value&&(await i.fetchDepartments(d.value),await c.fetchUsers({company_id:d.value,department_id:g.value||null}))}),(b,_)=>(a(),r(S,null,[$(ke,{"company-id":d.value,"onUpdate:companyId":_[0]||(_[0]=y=>d.value=y),"department-id":g.value,"onUpdate:departmentId":_[1]||(_[1]=y=>g.value=y),companies:f.value,departments:x.value},null,8,["company-id","department-id","companies","departments"]),e("div",Ce,[l.mode==="group"&&l.selectedUserIds.length?(a(),r("div",$e,[(a(!0),r(S,null,L(l.selectedUserIds,y=>(a(),r("span",{key:y,class:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm"},[e("span",Ie,M(ee(y)),1),e("button",{type:"button",class:"text-red-600",onClick:D=>u.value=l.selectedUserIds.filter(E=>E!==y)}," ✕ ",8,Me)]))),128))])):I("",!0),e("div",null,[e("div",Se,[O(e("input",{"onUpdate:modelValue":_[2]||(_[2]=y=>w.value=y),type:"search",disabled:q.value,class:"flex-1 px-3 py-2 border rounded-lg rounded-b-none focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60",placeholder:"Search by Name / Employee ID / Phone"},null,8,Ue),[[B,w.value]])]),e("div",Ae,[q.value?(a(),r("div",je,"Company নির্বাচন করুন।")):(a(),r(S,{key:1},[G.value.length?(a(),r("div",De,[(a(!0),r(S,null,L(G.value,y=>{var D,E;return a(),r(S,{key:y.id},[((E=(D=p(m))==null?void 0:D.user)==null?void 0:E.id)!==y.id?(a(),r("label",{key:0,for:`userId${y.id}`,class:"flex items-center justify-between gap-3 p-3 hover:bg-gray-50"},[e("div",Ee,[e("div",{class:"border rounded-full",title:y.name},[$(R,{user:y,size:"medium"},null,8,["user"])],8,Ve),e("div",Ne,[e("div",ze,M(y.name||"User #"+(y.employee_id??y.id)),1),e("div",He,M(y.employee_id||y.phone||y.email||""),1)])]),e("div",Re,[l.alreadyAddedUserIds.includes(y.id)?(a(),r("span",Oe," Already Added ")):(a(),r("input",{key:1,id:`userId${y.id}`,type:l.mode==="direct"?"radio":"checkbox",name:l.mode==="direct"?"direct-user":"group-users",checked:l.selectedUserIds.includes(y.id),onChange:P=>Z(y),class:"size-5"},null,40,Be))])],8,Te)):I("",!0)],64)}),128))])):(a(),r("div",Le," কোন ইউজার পাওয়া যায়নি। "))],64))])])])],64))}},Ge={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},qe={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[100vh] md:max-h-[90%] overflow-y-auto"},Pe={class:"flex flex-col gap-y-2 md:flex-row justify-between items-center"},Fe={key:0,class:"mt-4"},Ke={key:1,class:"text-red-600 text-sm"},Ye={class:"flex justify-between"},Je=["disabled"],We={__name:"AddNewConversationModal",setup(l){const t={DIRECT:"direct",GROUP:"group"},o=A(),s=F(),n=k(""),i=k(""),c=k(""),m=k(""),d=k([]),g=k(""),u=()=>{o.openAddModal=!1,f()};function f(){n.value="",i.value="",c.value="",m.value="",d.value=[],g.value=""}async function x(){var v;if(g.value="",!n.value){g.value="দয়া করে Conversation টাইপ নির্বাচন করুন।";return}if(((v=d.value)==null?void 0:v.length)==0){g.value="User নির্বাচন করুন।";return}const h=await o.createConversation({type:n.value,title:n.value=="group"?m.value:"",user_ids:d.value});o.openAddModal=!1,s.push({name:"Conversation Message",params:{conversationId:h}}),o.showMobileConversationList=!1,o.fetchUserConversations()}return(h,v)=>p(o).openAddModal?(a(),r("div",Ge,[e("div",qe,[e("div",Pe,[v[5]||(v[5]=e("h2",{class:"text-xl text-center font-semibold"},"Add New Conversation",-1)),$(me,{modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=w=>n.value=w),onSelect:()=>d.value=[]},null,8,["modelValue","onSelect"])]),v[9]||(v[9]=e("hr",{class:"mt-4"},null,-1)),n.value?(a(),r("form",{key:1,class:"space-y-3 mt-3",onSubmit:K(x,["prevent"])},[n.value===t.GROUP?(a(),j(fe,{key:0,modelValue:m.value,"onUpdate:modelValue":v[1]||(v[1]=w=>m.value=w)},null,8,["modelValue"])):I("",!0),$(W,{mode:n.value,"company-id":i.value,"onUpdate:companyId":v[2]||(v[2]=w=>i.value=w),"department-id":c.value,"onUpdate:departmentId":v[3]||(v[3]=w=>c.value=w),selectedUserIds:d.value,"onUpdate:selectedUserIds":v[4]||(v[4]=w=>d.value=w)},null,8,["mode","company-id","department-id","selectedUserIds"]),g.value?(a(),r("p",Ke,M(g.value),1)):I("",!0),v[8]||(v[8]=e("hr",null,null,-1)),e("div",Ye,[e("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:u}," Cancel "),e("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:n.value===t.DIRECT?d.value.length!==1:!m.value.trim()||d.value.length<2}," Create ",8,Je)])],32)):(a(),r("div",Fe,[e("div",{class:"rounded-md border border-dashed p-4 text-center text-gray-600"},[v[6]||(v[6]=e("div",{class:"py-4 text-xl leading-loose"},[T(" Conversation টাইপ (Direct / Group) সিলেক্ট করুন, "),e("br"),T(" তারপর নিচে ফিল্টার দেখাবে। ")],-1)),v[7]||(v[7]=e("p",{class:"pb-1"},"অথবা,",-1)),e("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:u}," Cancel ")])]))])])):I("",!0)}},Qe={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},Xe={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90%] overflow-y-auto"},Ze={key:0,class:"text-red-600 text-sm"},et={class:"flex justify-between"},tt=["disabled"],st={__name:"AddNewMemberModal",setup(l){const t=A(),o=H();F();const s=k(""),n=k(""),i=k([]),c=k(""),m=()=>{t.openAddMemberModal=!1,d()};function d(){s.value="",n.value="",i.value=[],c.value=""}async function g(){var u;if(c.value="",((u=i.value)==null?void 0:u.length)==0){c.value="User নির্বাচন করুন।";return}t.activeConversationId&&await t.addConversationMembers(t.activeConversationId,{user_ids:i.value}),t.openAddMemberModal=!1}return N(async()=>{t.activeConversationId&&await t.fetchConversationById(t.activeConversationId)}),(u,f)=>{var x,h;return p(t).openAddMemberModal&&p(t).activeConversationId&&p(t).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((x=p(o).user)==null?void 0:x.role)?(a(),r("div",Qe,[e("div",Xe,[f[4]||(f[4]=te('<div class="flex justify-between items-center"><h2 class="text-xl text-center">Add New Members</h2><button class="bg-sky-600 text-white border-sky-600 cursor-pointer px-6 py-1 border rounded-lg transition font-bold"><i class="fas fa-users"></i> Group </button></div><hr class="mt-4">',2)),e("form",{class:"space-y-3 mt-3",onSubmit:K(g,["prevent"])},[$(W,{mode:"group","company-id":s.value,"onUpdate:companyId":f[0]||(f[0]=v=>s.value=v),"department-id":n.value,"onUpdate:departmentId":f[1]||(f[1]=v=>n.value=v),selectedUserIds:i.value,"onUpdate:selectedUserIds":f[2]||(f[2]=v=>i.value=v),alreadyAddedUserIds:((h=p(t).conversation)==null?void 0:h.user_ids)||[]},null,8,["company-id","department-id","selectedUserIds","alreadyAddedUserIds"]),c.value?(a(),r("p",Ze,M(c.value),1)):I("",!0),f[3]||(f[3]=e("hr",null,null,-1)),e("div",et,[e("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:m}," Cancel "),e("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:i.value.length<1}," Create ",8,tt)])],32)])])):I("",!0)}}},nt={class:"py-px text-xs md:text-sm bg-gray-300 text-black italic font-thin rounded-lg px-4 z-10"},at={__name:"ChatMessageUnreadMarker",setup(l){const t=A(),o=k(!1),s=new Set,n=k(null);let i=null;async function c(){console.log("read calling..."),o.value=!0;try{t.activeConversationId&&await t.readAllForActiveConversation(t.activeConversationId)}catch{}finally{o.value=!1}}const m=C(()=>{var x;return((x=t.activeConversation)==null?void 0:x.id)??null}),d=C(()=>{var x,h;return(((h=(x=t.activeConversation)==null?void 0:x.unread)==null?void 0:h.count)??0)>0}),g=C(()=>{var x,h;return(((h=(x=t.activeConversation)==null?void 0:x.unread)==null?void 0:h.last_read_message_id)??0)===0});function u(){if(!n.value||i)return;const x=document.querySelector("#chatScroll")||null;i=new IntersectionObserver(h=>{const v=h[0];if(v.isIntersecting&&v.intersectionRatio>.6){const w=m.value;w&&!s.has(w)&&(s.add(w),c()),f()}},{root:x,threshold:[0,.6,1]}),i.observe(n.value)}function f(){i&&(i.disconnect(),i=null)}return V([d,m],async([x,h])=>{f(),!(!x||!h||s.has(h))&&(await z(),u())},{immediate:!0}),se(f),(x,h)=>{var v,w;return d.value?(a(),r("div",{key:0,ref_key:"bannerRef",ref:n,class:U(["relative flex justify-center items-center",g.value?"order-1":"order-3"])},[e("p",nt,M((w=(v=p(t).activeConversation)==null?void 0:v.unread)==null?void 0:w.count)+" unread message ",1),h[0]||(h[0]=e("span",{class:"absolute h-2 bg-gray-300 left-0 right-0 top-1/2 -translate-y-1/2 w-full rounded-lg"},null,-1))],2)):I("",!0)}}},ot={class:"px-2 md:px-4 grid gap-4"},rt={key:0,class:"flex flex-wrap gap-x-0.5 md:gap-x-1 items-center justify-center"},lt={class:"text-xs md:text-sm"},it=["innerHTML"],dt={key:1},ut={class:"border rounded-lg max-w-lg w-full min-w-40 md:min-w-80"},ct={class:"grow w-full flex items-center gap-1"},mt={class:"font-semibold sm:inline-block text-sm line-clamp-1"},vt={class:"shrink md:shrink-0 text-[10px] md:text-xs mt-1 text-right"},pt=["innerHTML"],ft={__name:"ChatMessageCard",props:{message:{type:Object,required:!0},index:Number},setup(l){H();const t=A(),o=l,s=C(()=>o.message.is_own_message),n=C(()=>o.message.type==="system"),i=C(()=>{var d;const c=(d=t.activeConversation)==null?void 0:d.unread;if(!(c!=null&&c.count))return!1;const m=c.last_read_message_id??0;return m===0?o.index===0:o.message.id===m});return(c,m)=>{var d,g;return a(),r("div",ot,[e("div",{class:U(["flex order-2",{"justify-end pl-6 md:pl-12":!n.value&&s.value,"justify-start pr-6 md:pr-12":!n.value&&!s.value,"justify-center":n.value}])},[n.value?(a(),r("div",rt,[m[0]||(m[0]=e("i",{class:"far fa-cog text-gray-700 text-xs md:text-base"},null,-1)),e("strong",lt,M(s.value?"You":(d=l.message.sender)==null?void 0:d.name),1),e("div",{innerHTML:l.message.body,class:"block text-xs md:text-sm italic whitespace-pre-wrap break-words leading-relaxed"},null,8,it)])):(a(),r("div",dt,[e("div",ut,[e("div",{class:U(["flex justify-between items-center p-1 rounded-t-lg gap-1 md:gap-4",{"bg-[#24A1DE] text-white":s.value,"bg-gray-200 text-black":!s.value}])},[e("div",ct,[$(R,{user:l.message.sender,size:"small"},null,8,["user"]),e("div",mt,M((g=l.message.sender)==null?void 0:g.name),1)]),e("div",vt,M(l.message.send_at),1)],2),e("div",{class:"block py-1 px-2 rounded-b-lg bg-white text-xs md:text-sm whitespace-pre-wrap break-words leading-relaxed",innerHTML:l.message.body},null,8,pt)]),e("div",{class:U(["flex",{"justify-end":s.value,"justify-start":!s.value}])},[e("div",{class:U(["flex flex-wrap gap-1 max-w-[280px] pt-1",{"justify-end":s.value,"justify-start":!s.value}])},[(a(!0),r(S,null,L(l.message.last_readers,u=>(a(),j(R,{key:u.id,title:u.name,user:u,size:"xsmall"},null,8,["title","user"]))),128))],2)],2)]))],2),i.value?(a(),j(at,{key:0})):I("",!0)])}}},yt={},xt={class:"flex justify-center items-center py-4"};function gt(l,t){return a(),r("div",xt,t[0]||(t[0]=[e("i",{class:"fas fa-spinner fa-spin text-2xl text-[#24A1DE]"},null,-1)]))}const Q=de(yt,[["render",gt]]),ht={key:1,class:"text-red-500 text-center my-4"},bt={key:2,class:"text-center text-gray-500 my-4"},_t={key:0,class:"text-xs text-gray-400 text-center py-2"},wt={__name:"ChatMessageContainer",setup(l){const t=A(),o=k(!1),s=k(null),n=k(!0),i=k(!1),c=(u,f=80)=>u.scrollHeight-u.scrollTop-u.clientHeight<f,m=async(u="auto")=>{await z();const f=s.value;f&&(f.scrollTo({top:f.scrollHeight,behavior:u}),n.value=!0)},d=async()=>{const u=s.value;if(u&&(n.value=c(u),u.scrollTop<=0&&t.hasMore&&!i.value)){i.value=!0;const f=u.scrollHeight,x=u.scrollTop;try{await t.fetchOlderMessages(t.activeConversationId),await z();const h=u.scrollHeight;u.scrollTop=h-(f-x)}catch{}finally{i.value=!1}}},g=async()=>{o.value=!0;try{t.activeConversationId&&(await t.fetchConversationMessages(t.activeConversationId),await m("auto"))}catch{}finally{o.value=!1}};return N(()=>{g()}),V(()=>t.activeConversationId,async(u,f)=>{u&&u!==f&&await g()}),V(()=>t.messages.length,async(u,f)=>{const x=s.value;x&&u>f&&c(x,120)&&await m("smooth")}),C(()=>!n.value&&!!t.activeConversationId),(u,f)=>(a(),r("div",{ref_key:"scrollEl",ref:s,onScroll:d,class:U(["w-full overflow-y-auto h-[calc(100dvh-150px)] scrollbar-hide relative flex flex-col",{"items-center justify-center":!p(t).activeConversationId||p(t).error||o.value}])},[o.value?(a(),j(Q,{key:0})):I("",!0),p(t).error?(a(),r("div",ht,M(p(t).error),1)):p(t).activeConversationId?(a(),r(S,{key:3},[i.value?(a(),r("div",_t,"Loading older…")):I("",!0),(a(!0),r(S,null,L(p(t).messages,(x,h)=>(a(),j(ft,{key:x.id,message:x,class:"w-full my-4",index:h},null,8,["message","index"]))),128))],64)):(a(),r("div",bt," Please select a conversation to view messages. ")),ne(u.$slots,"default")],34))}},kt={key:0},Ct={__name:"AddNewMemberButton",setup(l){const t=A(),o=H();return(s,n)=>{var i;return p(t).activeConversationId&&p(t).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((i=p(o).user)==null?void 0:i.role)?(a(),r("div",kt,[e("div",{class:"size-8 rounded-full text-sm border flex justify-center items-center cursor-pointer",title:"Add New Members",onClick:n[0]||(n[0]=c=>p(t).openAddMemberModal=!0)},n[1]||(n[1]=[e("i",{class:"fas fa-user-plus"},null,-1)]))])):I("",!0)}}},$t={class:"min-w-max size-8 md:size-12 flex justify-center items-center text-[#24A1DE] bg-white rounded-full overflow-hidden border"},It=["src"],Mt={key:0,class:"fas fa-users md:text-3xl"},St={key:1,class:"fas fa-user md:text-3xl"},X={__name:"ConversationAvatar",props:{conversation:{type:Object,required:!0}},setup(l){const t=k(!0);return(o,s)=>{var n,i;return a(),r("div",null,[e("div",$t,[(n=l.conversation)!=null&&n.avatar&&t.value?(a(),r("img",{key:0,onError:s[0]||(s[0]=c=>t.value=!1),src:(i=l.conversation)==null?void 0:i.avatar,alt:"Photo",class:"object-cover w-full h-full aspect-square"},null,40,It)):(a(),r(S,{key:1},[l.conversation.type==="group"?(a(),r("i",Mt)):(a(),r("i",St))],64))])])}}},Ut={class:"bg-[#24A1DE] border-b border-[#24A1DE] text-white h-[48px] md:h-[56px] flex items-center"},At={key:0,class:"w-full flex items-center justify-start gap-2 px-1 py-[3px]"},jt={class:"md:text-lg font-semibold line-clamp-1"},Lt={key:0,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Dt={key:1,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Tt={__name:"ConversationHeader",setup(l){const t=A();return(o,s)=>{var n,i,c;return a(),r("div",Ut,[(i=(n=p(t))==null?void 0:n.activeConversation)!=null&&i.id?(a(),r("div",At,[$(X,{conversation:p(t).activeConversation},null,8,["conversation"]),e("div",null,[e("h3",jt,M((c=p(t).activeConversation)==null?void 0:c.title),1),p(t).activeConversation.type==="group"?(a(),r("div",Lt,s[0]||(s[0]=[e("i",{class:"fas fa-users"},null,-1),e("i",{class:"line-clamp-1"},"Group chatting",-1)]))):(a(),r("div",Dt,s[1]||(s[1]=[e("i",{class:"fas fa-handshake"},null,-1),e("i",{class:"line-clamp-1"},"One to One chatting",-1)])))]),$(Ct,{class:"ml-auto md:mr-3"})])):I("",!0)])}}},Et={class:"flex items-center gap-2 relative"},Vt=["title"],Nt=["innerHTML"],zt={key:0,class:"absolute right-0 top-1/2 -translate-y-1/2"},Ht={class:"flex justify-center items-center size-5 text-[9px] text-white rounded-full bg-red-600"},Rt={__name:"ConversationListItem",props:{conversation:{type:Object,required:!0}},setup(l){const t=A(),o=l,s=C(()=>parseInt(o.conversation.id)===parseInt(t.activeConversationId));return(n,i)=>{var m;const c=ae("RouterLink");return(m=l.conversation)!=null&&m.id?(a(),j(c,{key:0,to:`/chatting/${l.conversation.id}`,class:U(["block p-1.5 md:p-3 border-b cursor-pointer hover:bg-[#24A1DE] hover:text-white group hover:opacity-90",{"bg-[#24A1DE] text-white":s.value}]),onClick:i[0]||(i[0]=d=>p(t).showMobileConversationList=!1)},{default:Y(()=>{var d,g,u,f,x,h;return[e("div",Et,[$(X,{conversation:l.conversation},null,8,["conversation"]),e("div",{class:U([{hidden:!p(t).showMobileConversationList},"md:block"])},[e("h3",{title:l.conversation.title,class:"md:text-lg font-semibold line-clamp-1"},M(l.conversation.title),9,Vt),e("div",{class:U(["text-xs md:text-sm group-hover:text-gray-50 line-clamp-1",{"text-gray-50":s.value,"text-gray-600":!s.value,"font-bold":(g=(d=l.conversation)==null?void 0:d.unread)==null?void 0:g.count}]),innerHTML:l.conversation.subtitle},null,10,Nt)],2),(f=(u=l.conversation)==null?void 0:u.unread)!=null&&f.count?(a(),r("div",zt,[e("span",Ht,M((h=(x=l.conversation)==null?void 0:x.unread)==null?void 0:h.count),1)])):I("",!0)])]}),_:1},8,["to","class"])):I("",!0)}}},Ot={class:"flex flex-col items-center justify-center p-4 text-center text-gray-600"},Bt={__name:"ConversationNotFoundMessage",setup(l){return(t,o)=>(a(),r("div",Ot,[o[0]||(o[0]=e("i",{class:"fas fa-info-circle text-xl"},null,-1)),o[1]||(o[1]=e("p",{class:"mt-2 mb-4"},[T(" No conversations found. "),e("br"),T(" Start a new conversation! ")],-1)),$(J)]))}},Gt={class:"overflow-y-auto h-[calc(100dvh-150px)] scrollbar-hide text-blue-900 bg-white border-0"},qt={__name:"ConversationList",setup(l){const t=A(),o=k(!1);return N(async()=>{o.value=!0,await t.fetchUserConversations(),o.value=!1}),(s,n)=>(a(),r("div",null,[e("div",Gt,[o.value?(a(),j(Q,{key:0})):p(t).conversations.length===0?(a(),j(Bt,{key:1})):(a(!0),r(S,{key:2},L(p(t).filteredConversations,i=>(a(),j(Rt,{key:i.id,conversation:i},null,8,["conversation"]))),128))])]))}},Pt={for:"search",class:"grow shrink relative block"},Ft={__name:"SearchConversation",setup(l){const t=A();return(o,s)=>(a(),r("label",Pt,[s[1]||(s[1]=e("i",{class:"fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-[#24A1DE]"},null,-1)),O(e("input",{id:"search",placeholder:"Search Conversations...",type:"search",class:"input-1 pl-10 pr-2 rounded-b-none border-none outline-[#24a0deb0] py-[11px] md:py-[15px] rounded-none rounded-tl-lg","onUpdate:modelValue":s[0]||(s[0]=n=>p(t).searchText=n)},null,512),[[B,p(t).searchText]])]))}},Kt={class:"flex items-start gap-2"},Yt={class:"w-full border-2 border-blue-100 rounded-xl bg-gray-100 px-1.5 pt-1.5 pb-0"},Jt={__name:"SendMessageBox",setup(l){const t=A(),o=k(""),s=k(null);function n(){const m=s.value;m&&(m.style.height="auto",m.style.height=m.scrollHeight+"px")}async function i(){var g;const m=o.value.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim();if(!t.activeConversationId||!m)return;const d=await t.createConversationMessage(t.activeConversationId,{type:"text",body:m,format:"plain"});o.value="",await z(),n(),(g=t==null?void 0:t.bumpConversationToTop)==null||g.call(t,t.activeConversationId,d)}function c(m){m.isComposing||m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),i())}return N(()=>z(n)),(m,d)=>(a(),r("div",Kt,[d[2]||(d[2]=e("label",{class:"hidden bg-gray-100 text-gray-600 rounded-full px-3 py-2 hover:bg-gray-500 hover:text-white cursor-pointer"},[e("input",{type:"file",class:"hidden",accept:"image/jpg,image/jpeg,image/png,image/gif,application/pdf"}),e("i",{class:"far fa-paperclip text-xl"})],-1)),e("div",Yt,[O(e("textarea",{ref_key:"taRef",ref:s,"onUpdate:modelValue":d[0]||(d[0]=g=>o.value=g),onInput:n,onKeydown:c,name:"body",rows:"1",placeholder:"Write a message…",class:"w-full resize-none overflow-hidden bg-transparent outline-none leading-6 max-h-32 mb-0"},null,544),[[B,o.value]])]),e("button",{type:"button",onClick:i,class:"bg-blue-100 text-blue-600 rounded-full px-3 py-2 hover:bg-blue-600 hover:text-white"},d[1]||(d[1]=[e("i",{class:"far fa-paper-plane text-xl"},null,-1)]))]))}},Wt={class:"my-container"},Qt={class:"flex overflow-hidden border-[#24A1DE] border rounded-lg"},Xt={class:"h-[48px] md:h-[56px] flex justify-center items-center border-b border-[#24A1DE] bg-white rounded-tl-lg"},Zt={key:0,class:"my-8 text-center px-4 grid justify-center items-center gap-2"},os={__name:"ChattingList",setup(l){const t=A(),o=oe();return V(()=>o.params.conversationId,s=>{t.activeConversationId=s},{immediate:!0}),N(()=>{t.showMobileConversationList=!o.params.conversationId}),(s,n)=>(a(),r(S,null,[e("div",Wt,[e("div",Qt,[e("div",{class:U(["min-w-11 md:block grow-0 shrink-0 md:w-[280px] lg:w-[360px] xl:w-[400px] rounded-l-lg",{"w-full":p(t).showMobileConversationList}])},[e("div",Xt,[e("div",{onClick:n[0]||(n[0]=i=>p(t).showMobileConversationList=!0),class:U(["md:hidden flex justify-center items-center text-2xl text-[#24A1DE]",{hidden:p(t).showMobileConversationList}])},n[1]||(n[1]=[e("i",{class:"fas fa-bars"},null,-1)]),2),e("div",{class:U([p(t).showMobileConversationList?"flex":"hidden","w-full md:flex items-center justify-between"])},[$(Ft),$(J)],2)]),$(qt)],2),e("div",{class:U(["md:block relative grow shrink border-l rounded-r-lg overflow-hidden bg-gray-100 border-[#24A1DE]",{hidden:p(t).showMobileConversationList}])},[p(t).activeConversationId?(a(),r(S,{key:1},[$(Tt),$(wt,null,{default:Y(()=>[$(Jt,{class:"bg-white border-t border-[#24A1DE] sticky bottom-0 mt-auto z-10 w-full p-2"})]),_:1})],64)):(a(),r("div",Zt,n[2]||(n[2]=[e("i",{class:"fad text-blue-600 fa-info-circle text-4xl md:text-7xl"},null,-1),e("p",{class:"text-gray-500 md:text-4xl"},[T(" Select a conversation "),e("br"),T(" to start chatting ")],-1)])))],2)])]),$(We),p(t).openAddMemberModal?(a(),j(st,{key:0})):I("",!0)],64))}};export{os as default};
