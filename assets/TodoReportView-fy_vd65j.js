import{G as ne,x as N,q as R,c as i,o as p,a,N as G,w as de,s as O,d as se,k as q,v as ee,f as ue,u as ce,D as te,h as ge,j as $,l as ae,m as L,t as y,F as C,e as M}from"./index-CQpIgpiU.js";import{_ as fe}from"./EmployeeFilter-D0gT_pkj.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as _e,b as U}from"./datetime-BEfC2TVK.js";import{u as be}from"./company-C9meiv00.js";import{u as Ie}from"./department-DlL0SGJx.js";import{u as De}from"./useTodoDateStore-DtdT1GaJ.js";import"./EmployeeDropdownInput-BrQaPJTA.js";import"./SelectDropdown-DmtO02by.js";import"./UserChip-Bl91zrFs.js";import"./url-CePbr-gY.js";const ve={class:"px-4 py-4 md:py-3 bg-white rounded-md border"},we={class:"flex flex-wrap items-center gap-3"},he=["disabled"],Se={class:"print-hide"},Te={class:"flex flex-col md:flex-row flex-wrap items-end md:ml-auto w-full md:w-auto gap-x-3 gap-y-4 print-hide"},ke={class:"flex items-center justify-between w-full md:w-auto gap-3"},$e={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Ce={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Ne={__name:"TodoReportHeading",props:{loading:{type:Boolean,default:!1},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},employeeId:{type:[String,Number],default:""},lineType:{type:String,default:"all"},startDate:{type:String,default:""},endDate:{type:String,default:""}},emits:["reloadClick","change"],setup(b,{emit:u}){const o=b,_=u,d=ne({companyId:String(o.companyId||""),departmentId:o.departmentId!==""&&o.departmentId!=null?String(o.departmentId):"",employeeId:String(o.employeeId||""),lineType:o.lineType||"all",startDate:o.startDate||"",endDate:o.endDate||""}),I=N(()=>({companyId:d.companyId,departmentId:d.departmentId,employeeId:d.employeeId,lineType:d.lineType,startDate:d.startDate,endDate:d.endDate}));function E(){_("change",{...I.value})}return R(()=>[o.companyId,o.departmentId,o.employeeId,o.lineType,o.startDate,o.endDate],()=>{d.companyId=String(o.companyId||""),d.departmentId=o.departmentId!==""&&o.departmentId!=null?String(o.departmentId):"",d.employeeId=String(o.employeeId||""),d.lineType=o.lineType||"all",d.startDate=o.startDate||"",d.endDate=o.endDate||""}),R(I,E,{deep:!0}),(D,r)=>(p(),i("div",ve,[a("div",we,[G(D.$slots,"before",{},void 0,!0),a("button",{class:O(["btn-icon print-hide",{"animate-spin !bg-opacity-0":b.loading}]),onClick:r[0]||(r[0]=de(e=>_("reloadClick"),["prevent"])),disabled:b.loading,title:"Reload"},[a("i",{class:O(["fas fa-redo",[b.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,he),a("span",Se,[G(D.$slots,"after",{},void 0,!0)]),a("div",Te,[se(fe,{company_id:d.companyId,"onUpdate:company_id":r[1]||(r[1]=e=>d.companyId=e),department_id:d.departmentId,"onUpdate:department_id":r[2]||(r[2]=e=>d.departmentId=e),employee_id:d.employeeId,"onUpdate:employee_id":r[3]||(r[3]=e=>d.employeeId=e),line_type:d.lineType,"onUpdate:line_type":r[4]||(r[4]=e=>d.lineType=e),"with-type":!0,class:"flex-1 gap-y-4 md:flex items-center justify-between w-full md:w-auto"},null,8,["company_id","department_id","employee_id","line_type"]),a("div",ke,[a("div",$e,[r[7]||(r[7]=a("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Start Date",-1)),q(a("input",{type:"date","onUpdate:modelValue":r[5]||(r[5]=e=>d.startDate=e),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ee,d.startDate]])]),a("div",Ce,[r[8]||(r[8]=a("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"End Date",-1)),q(a("input",{type:"date","onUpdate:modelValue":r[6]||(r[6]=e=>d.endDate=e),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ee,d.endDate]])])])])])]))}},Re=xe(Ne,[["__scopeId","data-v-ee9b6763"]]),Ee={class:"container mx-auto px-4 py-6"},Ue={key:0,class:"bg-white border rounded-md mb-2 p-4 text-sm print:border-0 print:mb-2"},Ae={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-y-2 gap-x-6"},Be={class:"font-medium text-gray-800"},Le={class:"font-medium text-gray-800"},Me={class:"font-medium text-gray-800"},Oe={class:"font-medium text-gray-800"},Ve={class:"col-span-2"},je={class:"font-medium text-gray-800"},Fe={key:1,class:"text-center text-gray-500 py-12"},ze={key:2,class:"text-center text-gray-500 py-8"},Pe={key:3,class:"text-center text-gray-500 py-12"},He={key:4,class:"overflow-x-auto bg-white border rounded-md shadow-sm"},Je={class:"min-w-full text-left text-sm"},Ke={class:"divide-y divide-gray-200"},Qe=["rowspan"],We={key:0,class:"text-xs text-gray-500"},Ye={key:1,class:"text-[11px] text-gray-400"},Xe=["rowspan"],Ze={class:"px-4 py-3 text-gray-800"},Ge={class:"font-medium"},qe={class:"text-xs text-gray-500"},et={class:"px-4 py-3"},yt={__name:"TodoReportView",setup(b){var V,j,F,z,P,H;const u=ue(),o=ce(),_=De(),d=be(),I=Ie(),{companies:E}=te(d),{departments:D}=te(I),r=_e(new Date),e=ne({companyId:((V=u.query)==null?void 0:V.company_id)||"",departmentId:((j=u.query)==null?void 0:j.department_id)||"",employeeId:((F=u.query)==null?void 0:F.employee_id)||"",lineType:((z=u.query)==null?void 0:z.line_type)||"all",startDate:((P=u.query)==null?void 0:P.start_date)||r,endDate:((H=u.query)==null?void 0:H.end_date)||r}),A=N(()=>{const t={};return _.todo_dates.forEach(n=>{var l;const s=((l=n.user)==null?void 0:l.id)||`unknown-${n.id}`,m=n.date||"unknown-date";t[s]||(t[s]={user:n.user,dates:{}}),t[s].dates[m]||(t[s].dates[m]={date:m,todos:[]}),t[s].dates[m].todos.push(n)}),Object.values(t).map(n=>{const s=Object.values(n.dates).map(l=>({...l,rowSpan:l.todos.length})).sort((l,g)=>new Date(l.date)-new Date(g.date)),m=s.reduce((l,g)=>l+g.rowSpan,0);return{user:n.user,dates:s,rowSpan:m}}).sort((n,s)=>{var m,l;return(((m=n.user)==null?void 0:m.name)||"").localeCompare(((l=s.user)==null?void 0:l.name)||"")})}),oe=N(()=>{if(!e.startDate||!e.endDate)return"";const t=U(e.startDate,{weekDay:"long"}),n=U(e.endDate,{weekDay:"long"});return`${t} ~ ${n}`}),re=N(()=>d.employees||[]),le={all:"All Types",executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},v=N(()=>{var l,g,f,w,x,h,S,T;const t=e.companyId&&((l=E.value)!=null&&l.length)?(g=E.value.find(c=>String(c.id)===String(e.companyId)))==null?void 0:g.name:null,n=e.departmentId&&((f=D.value)!=null&&f.length)?(w=D.value.find(c=>String(c.id)===String(e.departmentId)))==null?void 0:w.name:null;let s=null;e.employeeId&&(s=((h=(x=re.value)==null?void 0:x.find(c=>String(c.id)===String(e.employeeId)))==null?void 0:h.name)||((T=(S=A.value.find(c=>{var k;return String(((k=c.user)==null?void 0:k.id)||"")===String(e.employeeId)}))==null?void 0:S.user)==null?void 0:T.name)||null);const m=e.startDate===e.endDate&&e.startDate?U(e.startDate,{weekDay:"long"}):oe.value||"-";return{company:t||(e.companyId?`#${e.companyId}`:"All Companies"),department:n||(e.departmentId?`#${e.departmentId}`:"All Departments"),employee:s||(e.employeeId?`#${e.employeeId}`:"All Employees"),lineType:le[e.lineType]||e.lineType||"All Types",dateRange:m}}),ie=t=>t==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":t==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":t==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200";function pe(){o.replace({query:{...u.query,company_id:e.companyId||void 0,department_id:e.departmentId||void 0,employee_id:e.employeeId||void 0,line_type:e.lineType||void 0,start_date:e.startDate||void 0,end_date:e.endDate||void 0}})}async function B(){!e.companyId||!e.startDate||!e.endDate||await _.fetchTodoDates({"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate})}function me(t){e.companyId=t.companyId||"",e.departmentId=t.departmentId||"",e.employeeId=t.employeeId||"",e.lineType=t.lineType||"all",e.startDate=t.startDate||"",e.endDate=t.endDate||""}function ye(){window.print()}return R(()=>e.companyId,t=>{t&&(I.fetchDepartments(t),d.fetchEmployee(t))},{immediate:!0}),R(()=>({...e}),(t,n)=>{JSON.stringify(t)!==JSON.stringify(n)&&(pe(),B())},{deep:!0}),R(()=>u.query,t=>{e.companyId=(t==null?void 0:t.company_id)||e.companyId,e.departmentId=(t==null?void 0:t.department_id)||e.departmentId,e.employeeId=(t==null?void 0:t.employee_id)||e.employeeId,e.lineType=(t==null?void 0:t.line_type)||e.lineType,e.startDate=(t==null?void 0:t.start_date)||e.startDate,e.endDate=(t==null?void 0:t.end_date)||e.endDate}),ge(()=>{d.fetchCompanies({ignore_permission:!0}),B()}),(t,n)=>(p(),i("div",Ee,[se(Re,{"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate,loading:L(_).loading,class:"mb-4",onChange:me,onReloadClick:B},{before:ae(()=>n[0]||(n[0]=[a("div",null,[a("h1",{class:"text-xl font-semibold text-gray-800"},"Todo Report")],-1)])),after:ae(()=>[a("button",{type:"button",class:"btn-icon print-hide",onClick:de(ye,["prevent"])},n[1]||(n[1]=[a("i",{class:"fas fa-print"},null,-1)]))]),_:1},8,["company-id","department-id","employee-id","line-type","start-date","end-date","loading"]),e.companyId&&e.startDate&&e.endDate?(p(),i("div",Ue,[a("div",Ae,[a("div",null,[n[2]||(n[2]=a("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Company",-1)),a("div",Be,y(v.value.company),1)]),a("div",null,[n[3]||(n[3]=a("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Department",-1)),a("div",Le,y(v.value.department),1)]),a("div",null,[n[4]||(n[4]=a("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Employee",-1)),a("div",Me,y(v.value.employee),1)]),a("div",null,[n[5]||(n[5]=a("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Line Type",-1)),a("div",Oe,y(v.value.lineType),1)]),a("div",Ve,[n[6]||(n[6]=a("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Date",-1)),a("div",je,y(v.value.dateRange),1)])])])):$("",!0),!e.companyId||!e.startDate||!e.endDate?(p(),i("div",Fe," Select company and date range to view the report. ")):L(_).loading?(p(),i("div",ze," Loading report... ")):A.value.length===0?(p(),i("div",Pe," No todos found for this date. ")):(p(),i("div",He,[a("table",Je,[n[7]||(n[7]=a("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[a("tr",{class:"border-b"},[a("th",{class:"px-4 py-3 border-r"},"Name"),a("th",{class:"px-4 py-3 border-x"},"Date"),a("th",{class:"px-4 py-3 border-l"},"Todo"),a("th",{class:"px-4 py-3"},"Status")])],-1)),a("tbody",Ke,[(p(!0),i(C,null,M(A.value,s=>{var m,l,g;return p(),i(C,{key:((m=s.user)==null?void 0:m.id)||(((g=(l=s.dates[0])==null?void 0:l.todos[0])==null?void 0:g.id)??Math.random())},[(p(!0),i(C,null,M(s.dates,f=>{var w;return p(),i(C,{key:`${((w=s.user)==null?void 0:w.id)||"u"}-${f.date}`},[(p(!0),i(C,null,M(f.todos,(x,h)=>{var S,T,c,k,J,K,Q,W,Y,X,Z;return p(),i("tr",{key:x.id,class:"hover:bg-gray-50"},[f===s.dates[0]&&h===0?(p(),i("td",{key:0,rowspan:s.rowSpan,class:"px-4 py-3 align-top font-medium text-gray-800 whitespace-nowrap border-r"},[a("div",null,y(((S=s.user)==null?void 0:S.name)||"Unknown user"),1),(c=(T=s.user)==null?void 0:T.department)!=null&&c.name?(p(),i("div",We,y((J=(k=s.user)==null?void 0:k.department)==null?void 0:J.name),1)):$("",!0),(Q=(K=s.user)==null?void 0:K.company)!=null&&Q.name?(p(),i("div",Ye,y((Y=(W=s.user)==null?void 0:W.company)==null?void 0:Y.name),1)):$("",!0)],8,Qe)):$("",!0),h===0?(p(),i("td",{key:1,rowspan:f.rowSpan,class:"px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap border-r"},y(L(U)(f.date)||f.date||"-"),9,Xe)):$("",!0),a("td",Ze,[a("div",Ge,y(x.title),1),a("div",qe,y(((X=x.todoable)==null?void 0:X.title)||((Z=x.todoable_type)==null?void 0:Z.split("\\").pop())||""),1)]),a("td",et,[a("span",{class:O(["text-xs font-semibold px-2.5 py-1 rounded-full",ie(x.status)])},y(x.status||"N/A"),3)])])}),128))],64)}),128))],64)}),128))])])]))]))}};export{yt as default};
