import{b as O,e as $,p as j,C as z,c as l,o,a as e,t as c,f as h,g as d,k as r,i as g,j as x,F as V,x as M,w as I,n as E,y as U}from"./index-Dv63NlYr.js";import{_ as G}from"./UserChip-D0kXhYve.js";import{b as H}from"./datetime-C4Yr_jSk.js";import{u as J}from"./useTaskReportStore-ZlXi6cgs.js";import{u as K}from"./useTaskStore-DPC-Iaz5.js";const Q={class:"mt-4",id:"task-reports"},W={class:"bg-white"},X={class:"flex mb-2 items-end"},Y={class:"overflow-auto w-full"},Z={key:0,class:"min-w-full bg-white shadow rounded-lg overflow-hidden"},tt={class:"bg-gray-100"},et={key:0,class:"px-4 py-2 text-left md:w-[100px] lg:w-[220px] xl:w-[320px] border"},st={key:0},ot={class:"px-4 py-4 font-medium text-gray-500 text-center border h-28",colspan:"10"},rt=["onClick"],at={class:"px-4 py-2 text-center border font-semibold text-gray-600"},nt={key:0,class:"px-4 py-2 font-medium border-r border-b"},lt={key:0,style:{"font-family":"monospace"}},it={class:"ml-1"},dt={class:"font-medium py-2 px-4 border"},ut={class:"border rounded-md bg-gray-50"},ct={class:"text-sm flex items-center px-3 py-3"},mt={class:"text-gray-600 text-sm ml-auto whitespace-nowrap"},pt={key:1,class:"text-center border py-4 text-gray-500"},xt={__name:"TaskReports",setup(kt){const y=J(),n=K(),p=O(),b=p.params.id;$(async()=>{await n.fetchTask(b),await y.fetchTaskReports({task_id:b})});function w(u,t=[]){const i=[];for(const a of u){const k=[...t,a.title];a.children_tasks.length===0?i.push(...a.reports.map(m=>({...m,task_id:a.id,task_title:a.title,task_parents:t,user:a.users.find(_=>_.id===m.user_id)}))):i.push(...w(a.children_tasks,k))}return i}function v(u,t){try{const i=new Date(u.report_date).getTime(),a=new Date(t.report_date).getTime();return a===i?t.id-u.id:a-i}catch{return-1}}const R=j(()=>n.task.children_task_count===0?[...y.task_reports].sort(v):[...w(n.tasks)].sort(v));return(u,t)=>{var a,k,m,_,T,C,S,D;const i=z("RouterLink");return o(),l("div",Q,[t[8]||(t[8]=e("hr",{class:"mb-2"},null,-1)),e("div",W,[e("pre",null,c(u.usersTaskProgress),1),e("div",X,[t[3]||(t[3]=e("h3",{class:"text-sm font-semibold text-gray-600 uppercase mt-4"},"Task Reports",-1)),((a=r(n).task)==null?void 0:a.children_task_count)===0&&!((k=r(n).task)!=null&&k.closed_at)?(o(),h(i,{key:0,to:{name:"TaskReportAdd",params:{id:(m=r(n).task)==null?void 0:m.id},query:r(p).query},onClick:t[0]||(t[0]=s=>s.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:g(()=>t[2]||(t[2]=[x("Add Report")])),_:1,__:[2]},8,["to"])):d("",!0)]),e("div",Y,[r(y).loading?(o(),l("div",pt,"Loading...")):(o(),l("table",Z,[e("thead",tt,[e("tr",null,[t[4]||(t[4]=e("th",{class:"px-4 py-2 text-center w-2 border"},"#",-1)),r(n).task.children_task_count>0?(o(),l("th",et," Task ")):d("",!0),t[5]||(t[5]=e("th",{class:"px-4 py-2 text-left lg:w-[540px] border"},"User Report",-1))])]),e("tbody",null,[((_=R.value)==null?void 0:_.length)===0?(o(),l("tr",st,[e("td",ot,[t[7]||(t[7]=e("div",null,"NO REPORTS",-1)),e("div",null,[((T=r(n).task)==null?void 0:T.children_task_count)===0&&!((C=r(n).task)!=null&&C.closed_at)?(o(),h(i,{key:0,to:{name:"TaskReportAdd",params:{id:(S=r(n).task)==null?void 0:S.id},query:{id:(D=r(n).task)==null?void 0:D.id,...r(p).query}},onClick:t[1]||(t[1]=s=>s.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:g(()=>t[6]||(t[6]=[x("Add Report")])),_:1,__:[6]},8,["to"])):d("",!0)])])])):d("",!0),(o(!0),l(V,null,M(R.value,(s,F)=>{var q,B,L,N,A;return o(),l("tr",{key:s.id,class:"border-t hover:bg-gray-50 cursor-pointer",onClick:I(P=>u.goToShow(s.id),["prevent"]),role:"button"},[e("td",at,c(F+1),1),r(n).task.children_task_count>0?(o(),l("td",nt,[e("div",null,[(o(!0),l(V,null,M(s.task_parents.reverse(),(P,f)=>(o(),l("div",{class:E(["text-gray-400 text-sm line-clamp-1",{"-ml-1":f==0}]),key:f},[f>0?(o(),l("span",lt,"↳")):d("",!0),e("span",it,c(P),1)],2))),128)),e("div",null,[((q=s.task_parents)==null?void 0:q.length)>0?(o(),l("span",{key:0,style:{"font-family":"monospace"},class:E({"ml-2":((B=s.task_parents)==null?void 0:B.length)==1,"ml-4":((L=s.task_parents)==null?void 0:L.length)==2,"ml-6":((N=s.task_parents)==null?void 0:N.length)==3,"ml-8":((A=s.task_parents)==null?void 0:A.length)==4})},"↳",2)):d("",!0),U(i,{to:{name:r(p).query["is-my-task"]?"MyTaskShow":"TaskShow",params:{id:s.task_id}},class:"ml-1 hover:underline hover:blue-800"},{default:g(()=>[x(c(s.task_title),1)]),_:2},1032,["to"])])])])):d("",!0),e("td",dt,[e("div",ut,[s.user?(o(),h(G,{key:0,user:s.user,class:"inline-block w-full !rounded-sm"},null,8,["user"])):d("",!0),e("div",ct,[e("div",null,c(s.title),1),e("div",mt," on "+c(r(H)(s.report_date)),1)])])])],8,rt)}),128))])]))])])])}}};export{xt as default};
