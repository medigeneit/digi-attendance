import{G as K,r as I,e as Q,H as ot,A as X,c as p,o as n,f as v,a as t,t as y,I as A,n as $,h as d,w as C,l as b,p as T,E as Y,m as w,F as Z,x as rt,J as lt,K as H,g as it,v as dt,b as ut,u as pt,d as ct,q as D,k as G,y as W}from"./index-B0zs493K.js";import{L as J}from"./LoaderView-lAlFZ1hM.js";import{u as mt,_ as kt,O as L}from"./task-priority-L7-JfVnQ.js";import{a as ft}from"./TaskAddForm-Dn77yQ8x.js";import{_ as yt}from"./TaskEditForm-B_mtcn6O.js";import{_ as vt,a as bt,b as xt}from"./TaskTreeView-BXj5TfEp.js";import{g as P}from"./datetime-BISRKKpq.js";import{_ as tt}from"./UserChip-Umyn4tIf.js";import{u as gt}from"./useTaskStore-DMpUfyCi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-B5fRmOBn.js";import"./company-Z5QJB1cv.js";import"./useRequirementStore-soKEiSQB.js";import"./SectionLoading-DqXrRuf_.js";const _t={key:0},ht={key:0},Tt={key:1},$t=K({__name:"CountdownTimer",props:{targetDateTime:{}},setup(l){const a=l,e=I(u());let o;function u(){const m=new Date(a.targetDateTime).getTime()-new Date().getTime(),g=Math.floor(m/1e3%60),f=Math.floor(m/1e3/60%60),i=Math.floor(m/(1e3*60*60)%24),c=Math.floor(m/(1e3*60*60*24));return{total:m,days:c,hours:i,minutes:f,seconds:g}}function r(){e.value=u()}return Q(()=>{o=setInterval(()=>{r(),e.value.total<=0&&clearInterval(o)},1e3)}),ot(()=>clearInterval(o)),X(()=>a.targetDateTime,()=>{r(),clearInterval(o)}),(m,g)=>e.value.total>0?(n(),p("div",_t,[e.value.days?(n(),p("span",ht,y(e.value.days)+"d ",1)):v("",!0),t("span",null,y(e.value.hours.toString().padStart(2,"0"))+"h :",1),t("span",null,y(e.value.minutes.toString().padStart(2,"0"))+"m :",1),t("span",null,y(e.value.seconds.toString().padStart(2,"0"))+"s",1)])):(n(),p("div",Tt,[A(m.$slots,"expired",{},()=>[g[0]||(g[0]=$("Timeâ€™s up!"))])]))}}),wt={class:"mb-3"},Ct={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},St={key:1,class:"text-center py-4 text-gray-500"},It={key:2,class:"text-center py-4 text-red-500"},Dt={key:3,class:"space-y-4"},Ut={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(l,{emit:a}){const e=l,o=a,u=I(null),{handleItemsPriorityUpdate:r,saveTaskPriority:m,listHasRearranged:g}=mt(()=>e.tasks,e.parentId),f=async()=>{await m(),o("updatePriority")};return(i,c)=>(n(),p("div",null,[t("div",wt,[A(i.$slots,"task:header")]),d(g)?(n(),p("div",Ct,[c[3]||(c[3]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:C(f,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:c[0]||(c[0]=C((...k)=>u.value.resetItems&&u.value.resetItems(...k),["prevent"]))},"Discard")])):v("",!0),l.loading?(n(),p("div",St,"Loading tasks...")):l.error?(n(),p("div",It,y(l.error),1)):(n(),p("div",Dt,[b(kt,{items:l.tasks,handle:"handle",onItemsUpdate:d(r),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:u},{item:T(({item:k,index:h})=>[b(vt,{index:h,task:k,showDraggableHandle:!0,"tree-level":l.treeLevel,class:"!border-0",onCommentButtonClick:S=>o("commentButtonClick",k.id),onEditClick:c[1]||(c[1]=S=>o("editClick",S)),onAddClick:c[2]||(c[2]=S=>o("addClick",S))},null,8,["index","task","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Pt={class:"flex justify-between mt-5"},Lt={class:"flex flex-wrap items-center gap-2 mt-3"},At={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(l,{emit:a}){const e=l,o=a,u=I(),r=Y({show:!1,parentId:e.parentId,requirementId:null}),m=c=>{r.show=!0,r.parentId=c,console.log({addForm:r})};function g(){r.show=!1,r.parentId=e.parentId,o("created")}function f(){u.value=!1,o("updated")}function i(){r.show=!1,r.parentId=e.parentId}return(c,k)=>(n(),p("div",null,[u.value?(n(),w(L,{key:0},{default:T(()=>[b(yt,{taskId:u.value,onClose:k[0]||(k[0]=h=>u.value=null),onUpdated:f},null,8,["taskId"])]),_:1})):v("",!0),r.show?(n(),w(L,{key:1},{default:T(()=>[b(ft,{parentTaskId:r.parentId,requirementId:r.requirementId,onTaskCreated:g,onError:c.handleTaskError,onClose:i},null,8,["parentTaskId","requirementId","onError"])]),_:1})):v("",!0),b(Ut,{tasks:l.subTasks,parentId:l.parentId,treeLevel:l.treeLevel,onAddClick:k[2]||(k[2]=h=>m(h)),onEditClick:k[3]||(k[3]=h=>u.value=h),onUpdatePriority:k[4]||(k[4]=h=>o("updatePriority"))},{"task:header":T(()=>[t("div",Pt,[k[5]||(k[5]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),t("div",Lt,[t("button",{class:"btn-1 ml-auto",onClick:k[1]||(k[1]=C(()=>m(l.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId","treeLevel"])]))}},Et={class:"min-w-full bg-white rounded overflow-hidden"},Mt={class:"py-0.5 text-bg font-semibold"},Bt={class:"px-2 py-1 border-y"},Ft={class:"px-2 py-1 border-y"},Nt={class:"px-2 py-1 border-y text-center"},Rt={class:"px-2 py-1 border-y text-center"},jt={class:"px-2 py-1 border-y text-center"},qt={class:"px-2 py-1 border-y text-center"},Vt=K({__name:"TaskProgressTable",props:{progressUsers:{}},setup(l){return(a,e)=>(n(),p("table",Et,[t("caption",Mt,[A(a.$slots,"caption",{},()=>[e[0]||(e[0]=$("Progress"))])]),e[1]||(e[1]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," User Progress "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," Task Progress ")])],-1)),t("tbody",null,[(n(!0),p(Z,null,rt(a.progressUsers,(o,u)=>(n(),p("tr",{key:o.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Bt,y(u+1),1),t("td",Ft,[b(tt,{user:o},null,8,["user"])]),t("td",Nt,y(d(P)(o.started_at)),1),t("td",Rt,y(d(P)(o.finished_at)),1),t("td",jt,y(o.user_progress)+"%",1),t("td",qt,y(o.task_progress)+"%",1)]))),128))])]))}}),Ot=lt("task-user",()=>({updateUserStartDate:async(e,o,u)=>await H.patch(`/task-user/task/${e}/user/${o}/update-start-date/${u}`),updateUserFinishDate:async(e,o,u)=>await H.patch(`/task-user/task/${e}/user/${o}/update-finish-date/${u}`)})),zt={class:"border-b text-center"},Ht={key:0},Gt={key:1},Wt={class:"mb-2 mt-6"},Jt={class:"flex justify-center"},Kt={class:"py-6"},Qt={class:"mt-2"},Xt={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Yt={class:"flex justify-between items-center"},Zt={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(l,{emit:a}){const e=l,o=a,u=Ot(),r=I(""),m=I("");async function g(){var f,i;console.log({date:r.value});try{e.type=="start-date"?await u.updateUserStartDate(e.task.id,e.user.id,r.value||"0"):e.type=="finish-date"&&await u.updateUserFinishDate(e.task.id,e.user.id,r.value||"0"),o("updateDate")}catch(c){m.value=((i=(f=c.response)==null?void 0:f.data)==null?void 0:i.message)||`Failed to update ${e.type}`}}return(f,i)=>(n(),p("form",{class:"p-4",onSubmit:C(g,["prevent"])},[t("div",zt,[l.type=="start-date"?(n(),p("h2",Ht,"Edit Start Date")):l.type=="finish-date"?(n(),p("h2",Gt,"Edit Finish Date")):v("",!0)]),t("div",Wt,[i[2]||(i[2]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,y(l.task.title),1)]),t("div",null,[i[3]||(i[3]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"User:",-1)),b(tt,{user:l.user},null,8,["user"])]),t("div",Jt,[t("div",Kt,[i[4]||(i[4]=t("label",{class:"block text-xs font-semibold"},"Date",-1)),it(t("input",{type:"date","onUpdate:modelValue":i[0]||(i[0]=c=>r.value=c),class:"border py-2 px-4 rounded-md",size:"8"},null,512),[[dt,r.value]])])]),t("div",Qt,[m.value?(n(),p("div",Xt,y(m.value),1)):v("",!0)]),t("div",Yt,[i[5]||(i[5]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1)),t("button",{class:"btn-3",onClick:i[1]||(i[1]=C(c=>o("closeClick"),["prevent"]))},"Close")])],32))}},te=l=>l==null?void 0:l.reduce((a,e)=>a+e.task_weight,0),ee=(l,a)=>{const e=te(l);return l.map(o=>{const u=a.filter(r=>r.user_id===o.id).reduce((r,m)=>r+m.progress,0);return{...o,task_progress:Math.floor(u*(o.task_weight/e)),user_progress:u}})},se={class:"container mx-auto p-6"},ae={key:2,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},ne={class:"grid grid-cols-4"},oe={class:"mb-4 flex col-span-full"},re={class:"font-medium text-xl"},le={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},ie={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},de={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},ue={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},pe={class:"mt-4 col-span-full mb-6"},ce={class:"ml-auto text-right text-sm col-span-full"},me={key:1,class:"text-gray-500"},ke={class:"font-semibold text-green-800"},fe={key:2,class:"ml-4 text-gray-500"},ye={class:"text-red-500 font-semibold"},ve={class:"py-2 flex justify-center items-center gap-2 col-span-full"},be=["disabled"],xe=["disabled"],ge={class:"ml-auto flex gap-4"},_e={key:0},he={key:1},Te={key:1,class:"text-center py-4 text-red-500"},Ne={__name:"TaskShow",setup(l){const a=gt(),e=ut(),o=pt(),u=ct(),r=I(""),m=D(()=>a.tasks),g=I({});Q(async()=>{r.value="loading",await i(e.params.id),r.value=""});const f=Y({user:null,type:""});async function i(x){await a.fetchTask(x)}const c=D(()=>ee(a.task.users,a.task.task_reports||[])),k=D(()=>c.value.find(x=>{var s;return x.id===((s=u.user)==null?void 0:s.id)})),h=D(()=>P(a.task.started_at)),S=D(()=>P(a.task.deadline));function E(x){f.user=u.user,f.type=x}async function et(){await i(e.params.id),f.user=null,f.type=""}const st=x=>{o.push({name:"TaskEdit",params:{id:x}})},at=D(()=>{var x,s;return a.task?((x=a.task)==null?void 0:x.parent_id)==0?{name:"TaskList"}:{name:"TaskShow",params:{id:(s=a.task)==null?void 0:s.parent_id}}:null});return X(()=>e.params.id,async x=>{r.value="changing",await i(x),r.value=""}),(x,s)=>{var M,B,F,N,R,j,q,V,O;const U=G("RouterLink"),nt=G("router-view");return n(),p("div",se,[f.user?(n(),w(L,{key:0},{default:T(()=>[b(Zt,{task:d(a).task,user:f.user,type:f.type,onCloseClick:s[0]||(s[0]=_=>f.user=null),onUpdateDate:et},null,8,["task","user","type"])]),_:1})):v("",!0),r.value==="loading"?(n(),w(J,{key:1})):(n(),p("div",ae,[d(a).task?(n(),p(Z,{key:0},[t("section",ne,[t("div",oe,[t("div",null,[t("h2",re,y(d(a).task.title),1),t("div",le,[(M=d(a).task)!=null&&M.is_important?(n(),p("span",ie,"IMPORTANT")):v("",!0),(B=d(a).task)!=null&&B.is_urgent?(n(),p("span",de,"URGENT")):v("",!0)])]),t("div",ue,[b(bt,{status:(F=d(a).task)==null?void 0:F.status,class:""},null,8,["status"]),d(a).task?(n(),w(xt,{key:0,task:d(a).task,ref_key:"progress",ref:g,class:"!text-lg"},null,8,["task"])):v("",!0)])]),t("section",pe,[b(Vt,{"progress-users":c.value},{caption:T(()=>s[11]||(s[11]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["progress-users"])]),t("div",ce,[d(a).task.deadline?(n(),w($t,{key:0,targetDateTime:d(a).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):v("",!0),h.value?(n(),p("span",me,[s[12]||(s[12]=$(" Started: ")),t("span",ke,y(h.value),1)])):v("",!0),S.value?(n(),p("span",fe,[s[13]||(s[13]=$(" Deadline: ")),t("span",ye,y(S.value),1)])):v("",!0)]),s[18]||(s[18]=t("hr",{class:"my-3 col-span-full"},null,-1)),t("div",ve,[t("button",{onClick:s[1]||(s[1]=C(_=>{var z;return st((z=d(a).task)==null?void 0:z.id)},["stop"])),class:"btn-2 py-0.5"},"Edit"),b(U,{to:{name:"TaskUserAssign",params:{id:(N=d(a).task)==null?void 0:N.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[2]||(s[2]=_=>_.stopPropagation())},{default:T(()=>s[14]||(s[14]=[t("i",{class:"fas fa-user-plus"},null,-1),$(" Assign Users ")])),_:1,__:[14]},8,["to"]),b(U,{to:at.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[3]||(s[3]=_=>_.stopPropagation())},{default:T(()=>s[15]||(s[15]=[t("i",{class:"fas fa-arrow-left"},null,-1),$(" Back ")])),_:1,__:[15]},8,["to"]),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:s[4]||(s[4]=C(()=>E("start-date"),["prevent"])),disabled:!!((R=k.value)!=null&&R.started_at)}," Set Started Date ",8,be),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:s[5]||(s[5]=C(()=>E("finish-date"),["prevent"])),disabled:!!((j=k.value)!=null&&j.finished_at)}," Set Finish Date ",8,xe),t("div",ge,[m.value.length>0?(n(),w(U,{key:0,to:{name:"TaskShow",params:{id:(q=d(a).task)==null?void 0:q.id}},onClick:s[6]||(s[6]=_=>_.stopPropagation()),class:W(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":d(e).name=="TaskShow"}])},{default:T(()=>s[16]||(s[16]=[t("i",{class:"fal fa-list-ul"},null,-1),$(" Sub Tasks ")])),_:1,__:[16]},8,["to","class"])):v("",!0),b(U,{to:{name:"TaskReports",params:{id:(V=d(a).task)==null?void 0:V.id}},onClick:s[7]||(s[7]=_=>_.stopPropagation()),class:W(["py-1 btn-3",{"bg-blue-500 text-white":d(e).name=="TaskReports"}])},{default:T(()=>s[17]||(s[17]=[t("i",{class:"fal fa-file-alt"},null,-1),$(" Reports ")])),_:1,__:[17]},8,["to","class"])])])]),d(e).name=="TaskShow"&&((O=d(a).task)==null?void 0:O.level)<=2?(n(),p("section",_e,[b(At,{subTasks:m.value,"parent-id":d(e).params.id,"tree-level":d(a).task.level+1,onCreated:s[8]||(s[8]=_=>i(d(e).params.id)),onUpdated:s[9]||(s[9]=_=>i(d(e).params.id)),onUpdatePriority:s[10]||(s[10]=_=>i(d(e).params.id))},null,8,["subTasks","parent-id","tree-level"])])):(n(),p("section",he,[b(nt)]))],64)):(n(),p("div",Te,y(d(a).error),1)),r.value==="changing"?(n(),w(J,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):v("",!0)]))])}}};export{Ne as default};
