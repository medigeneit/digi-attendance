import{_ as Z}from"./CommentModal-DdgUTRnJ.js";import{g as ee,u as te,O as Q,_ as se}from"./task-priority-BnhH8qLx.js";import{_ as le}from"./TaskAddForm-DtflWU4s.js";import{_ as ae}from"./TaskEditForm-7MsUjxMU.js";import{q as b,s as oe,A as J,e as K,c as m,o as n,a as t,f as $,w as F,g as A,C as W,F as E,y as M,t as N,h as p,l as T,p as D,D as z,v as ne,n as re,b as ie,u as de,r as V,E as ue,m as L}from"./index-CoAjNv2r.js";import{_ as me}from"./MultiselectDropdown-Caw3UwVY.js";import{u as ce}from"./company-D6lGxvJL.js";import{_ as X}from"./UserChip-uwdw1amE.js";import{_ as Y}from"./TaskTreeView-B-jSj6k5.js";import{u as pe}from"./useTaskStore-Bket78io.js";import"./useCommentStore-DnACqUH_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-3lS2o4CM.js";import"./SectionLoading-D8itvaz5.js";import"./vue-multiselect.esm-PY59o7Hw.js";const fe={class:"mb-3 task-header"},ke={class:"flex justify-between items-center"},ve={class:"ml-auto flex gap-6 items-center"},ye={key:0,class:"flex gap-2 items-center"},ge={class:"flex flex-wrap items-center gap-2 mt-3"},xe={class:"flex flex-wrap gap-4 w-full"},Ce={class:"text-gray-600 w-full md:w-44"},_e=["value"],be={class:"relative w-full md:w-52"},we={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Te={class:"text-gray-600 w-40"},he={class:"flex gap-4 items-center flex-shrink-0"},Ie={class:"flex gap-2"},Ve={class:"flex gap-2"},$e={class:"text-gray-600 w-full md:w-40 md:ml-auto"},qe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(q,{emit:v}){const d=q,_=b(r("company-id")),w=b(r("user-ids")),h=b(r("month")),I=b(r("status")),s=b(r("is-important")),l=b(r("is-urgent")),a=v,c=ce(),{companies:x,employees:f}=oe(c);function r(o){return{get:()=>d.modelValue[o]||"",set:e=>{console.log("---SETTING modelValue: ",{key:o,value:e}),a("update:modelValue",{...d.modelValue,[o]:e||void 0})}}}const k=b(()=>U(w.value));async function y(o){console.log({newCompanyId:o}),o&&await c.fetchEmployee(o)}J(()=>_.value,y),K(async()=>{var o,e;await c.fetchCompanies(),(o=d.modelValue)!=null&&o["company-id"]&&await y((e=d.modelValue)==null?void 0:e["company-id"])});function U(o){return f.value.find(e=>e.id==o)||null}function P(o){console.log("SELECTED",{emp:o}),w.value=(o==null?void 0:o.id)||""}function B(){w.value=""}return(o,e)=>(n(),m("div",fe,[t("div",ke,[e[9]||(e[9]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",ve,[q.listHasRearranged?(n(),m("div",ye,[e[8]||(e[8]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=F(i=>a("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=F(i=>a("clickPriorityDiscard"),["prevent"]))},"Discard")])):$("",!0),t("button",{onClick:e[2]||(e[2]=i=>a("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",ge,[t("div",xe,[t("div",Ce,[A(t("select",{id:"company-filter","onUpdate:modelValue":e[3]||(e[3]=i=>_.value=i),class:"input-1"},[e[10]||(e[10]=t("option",{value:""},"All Company",-1)),(n(!0),m(E,null,M(p(x),i=>(n(),m("option",{key:i.id,value:i.id},N(i.name),9,_e))),128))],512),[[W,_.value]])]),t("div",be,[T(me,{modelValue:k.value,onSelect:P,onRemove:B,options:p(f),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employee",class:"text-gray-600 w-full"},{option:D(({option:i})=>[T(X,{user:i,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),k.value?(n(),m("div",we,[t("button",{onClick:F(B,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):$("",!0)]),t("div",Te,[A(t("select",{"onUpdate:modelValue":e[4]||(e[4]=i=>I.value=i),class:"input-1"},e[11]||(e[11]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[W,I.value]])]),t("div",he,[t("label",Ie,[A(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=i=>s.value=i),value:"1"},null,512),[[z,s.value]]),e[12]||(e[12]=t("span",null,"Important",-1))]),t("label",Ve,[A(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=i=>l.value=i),value:"1"},null,512),[[z,l.value]]),e[13]||(e[13]=t("span",null,"Urgent",-1))])]),t("div",$e,[A(t("input",{id:"month-filter","onUpdate:modelValue":e[7]||(e[7]=i=>h.value=i),type:"month",class:"input-1"},null,512),[[ne,h.value]])])])])]))}},Ue={class:"w-full bg-white rounded"},Se=["rowspan"],Ae={class:""},Ee={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(q,{emit:v}){const d=q,_=v,w=b(()=>d.tasks.reduce((s,l)=>(s.push(...l.users.filter(a=>!s.find(c=>c.id==a.id&&a.id))),s),[]).filter(s=>d.selectedUserId?s.id==d.selectedUserId:!0)),h=s=>{const l=d.tasks,a=new Map(l.map(r=>[r.id,r])),c=new Set,x=[],f=l.filter(r=>r.users.some(k=>k.id===s));for(const r of f){c.has(r.id)||(c.add(r.id),x.push(r));let k=r.parent_id;for(;k&&a.has(k)&&!c.has(k);){const y=a.get(k);c.add(y.id),x.push(y),k=y.parent_id}}return x},I=b(()=>w.value.map(s=>{const l=ee(h(s.id),0);return{...s,tasks:l}}));return(s,l)=>(n(),m("div",null,[t("table",Ue,[t("tbody",null,[(n(!0),m(E,null,M(I.value,a=>(n(),m(E,{key:a.id},[(n(!0),m(E,null,M(a.tasks,(c,x)=>(n(),m("tr",{key:c.id},[x==0?(n(),m("td",{key:0,class:"border p-4 align-top",rowspan:Math.max(a.tasks.length,1)},[T(X,{user:a,class:"sticky top-[80px]"},null,8,["user"])],8,Se)):$("",!0),t("td",Ae,[T(Y,{task:c,class:"!border-0",index:x,onCommentButtonClick:l[0]||(l[0]=f=>_("commentButtonClick",s.item.id)),onEditClick:l[1]||(l[1]=f=>_("editClick",f)),onAddClick:l[2]||(l[2]=f=>_("addClick",f))},{"item-override":D(({task:f,level:r})=>[re(N({task:f,level:r}),1)]),_:2},1032,["task","index"])])]))),128))],64))),128))])])]))}},De={class:"container mx-auto p-6 relative"},Pe={class:"mb-4"},Be={key:3,class:"text-center py-4 text-red-500"},Le={key:4,class:"space-y-4"},Me={class:"flex items-stretched"},Ne={key:5,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Re=1,st={__name:"TaskList",setup(q){const v=pe(),d=ie(),_=de(),w=V(!1),h=V(null),I=V(!1),s=V(null),l=V(!1),a=ue({parentId:0,requirementId:0}),c=V(null),x=V([]),{handleItemsPriorityUpdate:f,saveTaskPriority:r,listHasRearranged:k}=te(()=>v.taskListTree,0);K(async()=>{d.query.status||_.push({query:{...d.query,status:"not-completed"}}),await y()});async function y(){I.value=!!d.query["user-ids"];const C=await v.fetchTasks({...d.query},{loadingBeforeFetch:!0});console.log({dataQuery:C.query_log}),x.value=C.query_log||[]}const U=C=>{l.value=!0,a.parentId=C},P=C=>{h.value=C,w.value=!0},B=()=>{w.value=!1,h.value=null};async function o(){s.value=null,l.value=!1,a.parentId=0,await y()}async function e(){l.value=!1,a.parentId=0,await y()}async function i(){r()&&await y()}J(()=>({...d.query}),async()=>await y());const H=b({get(){return{...d.query}},set(C){_.push({query:{...C}})}});return(C,u)=>{var j,O,G;return n(),m("div",De,[s.value?(n(),L(Q,{key:0},{default:D(()=>[T(ae,{taskId:s.value,class:"rounded-full",onClose:u[0]||(u[0]=g=>s.value=null),onUpdated:o},null,8,["taskId"])]),_:1})):$("",!0),l.value?(n(),L(Q,{key:1},{default:D(()=>[T(le,{parentTaskId:a.parentId,requirementId:a.requirementId,class:"rounded-full",onClose:e,onTaskCreated:o},null,8,["parentTaskId","requirementId"])]),_:1})):$("",!0),T(qe,{modelValue:H.value,"onUpdate:modelValue":u[1]||(u[1]=g=>H.value=g),onClickAddTask:U,onClickPrioritySave:i,onClickPriorityDiscard:u[2]||(u[2]=()=>p(k)?c.value.resetItems:null),"list-has-rearranged":p(k),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((O=(j=p(d))==null?void 0:j.query)==null?void 0:O["query-log"])=="true"?(n(!0),m(E,{key:2},M(x.value,(g,R)=>(n(),m("div",{key:R,class:"text-xs text-gray-500"},[t("div",Pe,N(g.raw_query),1)]))),128)):$("",!0),p(v).error?(n(),m("div",Be,N(p(v).error),1)):p(v).tasks.length>0?(n(),m("div",Le,[((G=p(d).query)==null?void 0:G.view)=="userwise"?(n(),L(Ee,{key:0,tasks:p(v).tasks,selectedUserId:p(d).query["user-id"],onCommentButtonClick:u[3]||(u[3]=g=>P(g,C.task.id)),onEditClick:u[4]||(u[4]=g=>s.value=g),onAddClick:u[5]||(u[5]=g=>U(g))},null,8,["tasks","selectedUserId"])):(n(),L(se,{key:1,items:p(v).taskListTree,handle:"handle",onItemsUpdate:p(f),class:"space-y-4",ref_key:"draggableTaskList",ref:c},{item:D(({item:g,index:R})=>[t("div",Me,[T(Y,{task:g,index:R,showDraggableHandle:!I.value,onCommentButtonClick:u[6]||(u[6]=S=>P(S,C.task.id)),onEditClick:u[7]||(u[7]=S=>s.value=S),onAddClick:u[8]||(u[8]=S=>U(S)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(n(),m("div",Ne," No tasks found. ")),T(Z,{show:w.value,"commentable-id":h.value,"commentable-type":"task","user-id":Re,"on-close":B,onSubmitted:p(v).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{st as default};
