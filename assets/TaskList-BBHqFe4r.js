import{s as I,r as m,y as B,D as G,b as P,A as T,c as n,k as A,n as V,e as E,a,d as Q,C as z,F as $,x as F,h as r,m as c,t as L,f as H,o,g as J}from"./index-B0zE6B4y.js";import{_ as K}from"./CommentModal-CPzHu9A0.js";import{O as D}from"./OverlyModal-B5cliVC1.js";import{_ as W}from"./MultiselectDropdown-ZU4bhkxv.js";import{_ as X}from"./TaskAddForm-lsqJEm6J.js";import{_ as Y}from"./TaskEditForm-Daek3V9b.js";import{_ as Z}from"./TaskTreeView-ClVqwKhs.js";import{u as ee}from"./attendance-CsUb8f0o.js";import{u as te}from"./company-bJp99g12.js";import{u as se}from"./useTaskStore-pdaarL-Q.js";import"./useCommentStore-VFJfJEog.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-qEQ-Z1CL.js";import"./useRequirementStore-B9KbOG7r.js";const oe={class:"container mx-auto p-6 relative"},ae={class:"mb-3"},le={class:"flex flex-wrap items-center gap-2 mt-3"},ne=["value"],re={key:2,class:"text-center py-4 text-gray-500"},de={key:3,class:"text-center py-4 text-red-500"},ue={key:4,class:"space-y-4"},ie=1,we={__name:"TaskList",setup(me){const l=se(),M=ee(),v=te();I(l);const{companies:U,employees:b}=I(v),d=H(),N=J(),y=m(!1),k=m(null),_=B(x("company-id")),g=B(x("user-id")),p=m();I(M);const u=m(null),C=m(!1),f=G({parentId:0,requirementId:0});P(async()=>{await v.fetchCompanies(),await l.fetchTasks(d.query["user-id"]?{user_ids:d.query["user-id"]}:{})});const h=e=>{C.value=!0,f.parentId=e};function x(e){return{set:t=>{N.push({query:{...d.query,[e]:t}})},get:()=>d.query[e]||void 0}}const O=e=>{k.value=e,y.value=!0},R=()=>{y.value=!1,k.value=null};T(()=>_.value,async e=>{e&&(await v.fetchEmployee(e),p.value=b.value.find(t=>t.id==g.value)||null)},{initial:!0,immediate:!0}),T(()=>({id:d.query["user-id"]}),async e=>{console.log("Selected Employee:",e),w(e.id)});async function w(e){await l.fetchTasks(e?{user_ids:e}:{},{loadingBeforeFetch:!1})}function q(){u.value=null,w(d.query["user-id"])}function j(){C.value=!1,f.parentId=0}return T(p,e=>{g.value=e==null?void 0:e.id}),(e,t)=>{var S;return o(),n("div",oe,[u.value?(o(),A(D,{key:0},{default:V(()=>[c(Y,{taskId:u.value,class:"rounded-full",onClose:t[0]||(t[0]=s=>u.value=null),onUpdated:q},null,8,["taskId"])]),_:1})):E("",!0),C.value?(o(),A(D,{key:1},{default:V(()=>[c(X,{parentTaskId:f.parentId,requirementId:f.requirementId,class:"rounded-full",onClose:j,onCreated:q},null,8,["parentTaskId","requirementId"])]),_:1})):E("",!0),a("div",ae,[t[6]||(t[6]=a("div",{class:"flex justify-between items-center"},[a("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),a("div",le,[a("div",null,[Q(a("select",{id:"company-filter","onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),class:"input-1"},[t[5]||(t[5]=a("option",{value:""},"Select Company",-1)),(o(!0),n($,null,F(r(U),s=>(o(),n("option",{key:s.id,value:s.id},L(s.name),9,ne))),128))],512),[[z,_.value]])]),a("div",null,[c(W,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=s=>p.value=s),options:r(b),multiple:!1,label:"name",placeholder:"Please select employee..."},null,8,["modelValue","options"])]),a("button",{onClick:h,class:"btn-1 ml-auto"},"Add Task")])]),r(l).loading?(o(),n("div",re,"Loading tasks...")):r(l).error?(o(),n("div",de,L(r(l).error),1)):(o(),n("div",ue,[(o(!0),n($,null,F(((S=r(l))==null?void 0:S.taskListTree)||[],s=>(o(),n("div",{key:s.id,class:"rounded-lg border bg-white overflow-hidden"},[c(Z,{task:s,class:"!border-0",onCommentButtonClick:i=>O(i,s.id),onEditClick:t[3]||(t[3]=i=>u.value=i),onAddClick:t[4]||(t[4]=i=>h(i))},null,8,["task","onCommentButtonClick"])]))),128))])),c(K,{show:y.value,"commentable-id":k.value,"commentable-type":"task","user-id":ie,"on-close":R,onSubmitted:r(l).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{we as default};
