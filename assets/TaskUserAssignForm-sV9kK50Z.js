import{d as H,r as v,q as f,e as J,c as r,o,a as t,t as U,w as z,f as u,l as E,p as T,F as K,x as P,m as Q,y as w,g as b,D as h,v as F}from"./index-D3P1gRIA.js";import{_ as W}from"./MultiselectDropdown-06_CFyUf.js";import{_ as B}from"./UserChip-EJlibMOs.js";import{a as I}from"./datetime-q3Sn87-f.js";import{u as X}from"./company-DoZcSpZS.js";import{u as Z}from"./useTaskStore-CDfSA3Sp.js";import{u as ee}from"./user-Bu1R0QmF.js";const te={class:"px-4 max-h-[90vh] overflow-auto rounded"},se={class:"sticky top-0 bg-white z-20"},ae={class:"mb-2 font-semibold text-gray-600 text-sm leading-none"},le={key:0,class:"text-center text-gray-500 py-4"},oe={class:"mb-4"},re={class:"mb-2 flex flex-wrap gap-2"},ie=["onClick"],ne={key:0,class:"my-6 text-center w-full relative"},ue={class:"flex gap-16 items-center mb-8"},de={class:"flex gap-1 items-center"},me=["disabled"],pe={class:"flex gap-1 items-center"},ge={class:"flex gap-1 items-center"},ve={key:1,class:"mt-8"},be={class:"grid grid-cols-2 gap-4 mb-4 mt-12"},ce={key:0,class:"mb-4"},ye={key:1,class:"mb-4"},fe={class:"flex justify-between items-center gap-4 sticky bottom-0 bg-white border-t px-4 -mx-4 py-3"},xe={key:0,class:"mb-4 text-red-500 font-medium"},_e={key:1,class:"mb-4 text-blue-500 font-medium"},ke=["disabled"],Me={__name:"TaskUserAssignForm",props:{taskId:{type:[Number,String],required:!0}},emits:["success","cancelClick"],setup(N,{emit:O}){var A;const V=Z(),$=X(),C=ee(),i=H(),m=v([]),j=f(()=>m.value.map(s=>s.id)),n=v(""),x=v(null),_=v([]),M=N,g=v(null),l=v({...((A=i.user)==null?void 0:A.role)=="employee"?{}:{is_important:!1,is_urgent:!1,is_target:!1,started_at:"",deadline:""}}),D=O;J(async()=>{var e,p,a,y,k,S;n.value="loading";const s=await V.fetchTask(M.taskId,{with_parent:"true"},{loadingBeforeFetch:!1,fetchOnly:!0});g.value=s.task,g.value.parent?_.value=((p=(e=g.value)==null?void 0:e.parent)==null?void 0:p.users)||[]:((a=i.user)==null?void 0:a.role)==="employee"?_.value=((S=(k=await $.fetchEmployees((y=i.user)==null?void 0:y.company_id))==null?void 0:k.data)==null?void 0:S.employees)||[]:(await C.fetchUsers(),_.value=C.users),R(g.value),m.value=g.value.users,n.value=""});const q=f(()=>_.value.filter(s=>!m.value.find(e=>e.id===s.id))),L=async()=>{var s,e;n.value="submitting",x.value=null;try{await V.updateTask(M.taskId,{...l.value,user_ids:j.value},{loadingBeforeFetch:!1}),D("success")}catch(p){x.value=((e=(s=p.response)==null?void 0:s.data)==null?void 0:e.message)||"Assign users failed"}finally{n.value=""}};function R(s){var e;l.value={...((e=i.user)==null?void 0:e.role)=="employee"?{}:{is_important:s.is_important,is_urgent:s.is_urgent,is_target:s.is_target,started_at:I(s.started_at),deadline:I(s.deadline)}}}const Y=f(()=>Object.values(d.value).reduce((s,e)=>e||s,!1)),c=f({set:()=>{l.value.is_important=!1,l.value.is_urgent=!1},get:()=>!(l.value.is_important||l.value.is_urgent)}),d=f(()=>{let s={is_important:!1,is_urgent:!1,is_target:!1,started_at:!1,deadline:!1};return i.user.role==="employee"||(s.is_important=i.isAdminMood,s.is_urgent=i.isAdminMood,s.is_target=i.isAdminMood,s.started_at=i.isAdminMood,s.deadline=i.isAdminMood),s});return(s,e)=>{var p;return o(),r("div",te,[t("div",se,[e[8]||(e[8]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-1 mt-4"},"Manage Employee(s) for Task",-1)),t("h3",ae,U((p=g.value)==null?void 0:p.title),1),e[9]||(e[9]=t("hr",{class:"mb-4 !mt-0"},null,-1))]),n.value==="loading"?(o(),r("div",le,"Loading users...")):(o(),r("form",{key:1,onSubmit:z(L,["prevent"])},[t("div",oe,[e[10]||(e[10]=t("label",{class:"block uppercase text-xs text-gray-600"},"Employees",-1)),E(W,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),options:q.value,multiple:!0,"track-by":"id",label:"label",placeholder:"Select users"},{selection:T(({...a})=>[t("div",re,[(o(!0),r(K,null,P((a==null?void 0:a.values)||[],y=>(o(),Q(B,{key:y.id,user:y},{after:T(({user:k})=>[t("button",{class:"size-6 border rounded-full hover:bg-red-400 hover:text-white",onClick:z(S=>m.value=m.value.filter(G=>G.id!==k.id),["prevent"])}," Ã— ",8,ie)]),_:2},1032,["user"]))),128))])]),option:T(({option:a})=>[E(B,{user:a},null,8,["user"])]),_:1},8,["modelValue","options"])]),Y.value?(o(),r("h3",ne,e[11]||(e[11]=[t("div",{class:"inline-block bg-white px-4"},[t("b",{class:"fas fa-cog text-gray-400"}),t("span",{class:"text-gray-700 ml-2"},"Task Settings for Employee")],-1),t("hr",{class:"bottom-0 border-gray-300 -mt-3"},null,-1)]))):u("",!0),t("div",ue,[d.value.is_important&&d.value.is_urgent?(o(),r("label",{key:0,class:w(["border px-2 py-0.5 rounded cursor-pointer",{"border-blue-500 bg-green-200":c.value,"bg-gray-50 hover:bg-green-50":!c.value}])},[t("div",de,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),class:"size-4",disabled:c.value},null,8,me),[[h,c.value]]),e[12]||(e[12]=t("span",{class:"block text-gray-600 text-base font-medium"},"Regular Task",-1))]),e[13]||(e[13]=t("div",{class:"text-sm text-gray-500"},"Usually: 1-30 Days",-1))],2)):u("",!0),d.value.is_important?(o(),r("label",{key:1,class:w(["border px-2 py-0.5 rounded cursor-pointer",{"border-yellow-500 bg-yellow-200":l.value.is_important,"bg-gray-50 hover:bg-yellow-50":!l.value.is_important}])},[t("div",pe,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>l.value.is_important=a),class:"size-4"},null,512),[[h,l.value.is_important]]),e[14]||(e[14]=t("span",{class:"block text-gray-600 text-base font-medium"},"Important Task",-1))]),e[15]||(e[15]=t("div",{class:"text-sm text-gray-500"},"Usually: 1-7 Days",-1))],2)):u("",!0),d.value.is_urgent?(o(),r("label",{key:2,class:w(["border px-2 py-0.5 rounded cursor-pointer",{"border-red-500 bg-red-200":l.value.is_urgent,"bg-gray-50 hover:bg-red-50":!l.value.is_urgent}])},[t("div",ge,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.is_urgent=a),class:"size-4"},null,512),[[h,l.value.is_urgent]]),e[16]||(e[16]=t("span",{class:"block text-gray-600 text-base font-medium"},"Urgent Task",-1))]),e[17]||(e[17]=t("div",{class:"text-sm text-gray-500"},"Usually: 1-3 Days",-1))],2)):u("",!0)]),d.value.is_target?(o(),r("div",ve,[t("label",{class:w(["flex gap-1 items-center mt-4 border rounded py-2 px-2 cursor-pointer",{"bg-yellow-100/80 border-yellow-300":l.value.is_target}])},[b(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=a=>l.value.is_target=a),class:"size-6"},null,512),[[h,l.value.is_target]]),e[18]||(e[18]=t("span",{class:"block text-gray-600 text-base font-medium"},"Is Target Task",-1))],2)])):u("",!0),t("div",be,[d.value.started_at?(o(),r("div",ce,[e[19]||(e[19]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"}," Start Date ",-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.started_at=a),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,l.value.started_at]])])):u("",!0),d.value.deadline?(o(),r("div",ye,[e[20]||(e[20]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"}," Deadline ",-1)),b(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.deadline=a),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,l.value.deadline]])])):u("",!0)]),t("div",fe,[x.value?(o(),r("div",xe,U(x.value),1)):u("",!0),n.value=="submitting"?(o(),r("div",_e," Saving changes... ")):u("",!0),t("button",{disabled:n.value=="submitting"||n.value=="loading",type:"submit",class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-5 py-2 rounded transition"},U(n.value=="submitting"?"Saving...":"Save"),9,ke),t("button",{type:"button",onClick:e[7]||(e[7]=a=>D("cancelClick")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32))])}}};export{Me as _};
