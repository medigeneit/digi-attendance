import{r as j,G as be,x as w,q as B,c as o,o as r,a as t,N as ye,w as ve,s as R,d as X,k as ce,v as ge,f as Se,u as $e,D as xe,h as fe,y as Ce,j as f,i as Ne,l as Y,m as V,t as i,b as F,F as $,e as z,M as Re}from"./index-Cw805TwX.js";import{L as Ee}from"./LoaderView-D0YRWc3O.js";import{_ as Ae}from"./EmployeeFilter-Dihk_HfE.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as Ue,b as P}from"./datetime-BEfC2TVK.js";import{u as Me}from"./company-DbG_h1mx.js";import{u as ze}from"./department-CLUzq7av.js";import{u as Be}from"./useTodoDateStore-BrSXsidM.js";import"./EmployeeDropdownInput-Dv3_dX3G.js";import"./SelectDropdown-DOX4NvtL.js";import"./UserChip-CNi34DQW.js";import"./url-CePbr-gY.js";const Oe={class:"px-4 py-4 md:py-3 bg-white rounded-md border"},Ve={class:"flex flex-wrap items-center gap-3"},Fe=["disabled"],Pe={class:"print-hide"},je={class:"flex flex-col md:flex-row flex-wrap items-end md:ml-auto w-full md:w-auto gap-x-3 gap-y-4 print-hide"},He={class:"flex items-center justify-between w-full md:w-auto gap-3"},Je={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Ke={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Qe={__name:"TodoReportHeading",props:{loading:{type:Boolean,default:!1},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},employeeId:{type:[String,Number],default:""},lineType:{type:String,default:"all"},startDate:{type:String,default:""},endDate:{type:String,default:""}},emits:["reloadClick","change"],setup(A,{expose:b,emit:H}){const d=A,C=j(null),L=H,l=be({companyId:String(d.companyId||""),departmentId:d.departmentId!==""&&d.departmentId!=null?String(d.departmentId):"",employeeId:String(d.employeeId||""),lineType:d.lineType||"all",startDate:d.startDate||"",endDate:d.endDate||""}),U=w(()=>({companyId:l.companyId,departmentId:l.departmentId,employeeId:l.employeeId,lineType:l.lineType,startDate:l.startDate,endDate:l.endDate}));function O(){L("change",{...U.value})}return B(()=>[d.companyId,d.departmentId,d.employeeId,d.lineType,d.startDate,d.endDate],()=>{l.companyId=String(d.companyId||""),l.departmentId=d.departmentId!==""&&d.departmentId!=null?String(d.departmentId):"",l.employeeId=String(d.employeeId||""),l.lineType=d.lineType||"all",l.startDate=d.startDate||"",l.endDate=d.endDate||""}),B(U,O,{deep:!0}),b({employees:w(()=>{var D;return((D=C.value)==null?void 0:D.employees)||[]})}),(D,e)=>(r(),o("div",Oe,[t("div",Ve,[ye(D.$slots,"before",{},void 0,!0),t("button",{class:R(["btn-icon print-hide",{"animate-spin !bg-opacity-0":A.loading}]),onClick:e[0]||(e[0]=ve(p=>L("reloadClick"),["prevent"])),disabled:A.loading,title:"Reload"},[t("i",{class:R(["fas fa-redo",[A.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,Fe),t("span",Pe,[ye(D.$slots,"after",{},void 0,!0)]),t("div",je,[X(Ae,{ref_key:"employeeFilterRef",ref:C,company_id:l.companyId,"onUpdate:company_id":e[1]||(e[1]=p=>l.companyId=p),department_id:l.departmentId,"onUpdate:department_id":e[2]||(e[2]=p=>l.departmentId=p),employee_id:l.employeeId,"onUpdate:employee_id":e[3]||(e[3]=p=>l.employeeId=p),line_type:l.lineType,"onUpdate:line_type":e[4]||(e[4]=p=>l.lineType=p),"with-type":!0,class:"flex-1 gap-y-4 md:flex items-center justify-between w-full md:w-auto"},null,8,["company_id","department_id","employee_id","line_type"]),t("div",He,[t("div",Je,[e[7]||(e[7]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Start Date",-1)),ce(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=p=>l.startDate=p),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ge,l.startDate]])]),t("div",Ke,[e[8]||(e[8]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"End Date",-1)),ce(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=p=>l.endDate=p),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ge,l.endDate]])])])])])]))}},We=Le(Qe,[["__scopeId","data-v-1bffbf10"]]),Ye={class:"container print:flex-grow mx-auto print:w-full px-4 py-6 print:px-0 print:py-0"},Xe=["disabled"],Ze={key:0,class:"bg-white border rounded-md mb-2 p-4 text-sm print:border-0 print:mb-2 print:px-0 print:w-full relative overflow-visible z-40"},Ge={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-7 gap-y-2 gap-x-6"},qe={class:"font-medium text-gray-800"},et={class:"col-span-2"},tt={class:"font-medium text-gray-800"},nt={class:"inline-flex items-center gap-5 font-bold"},at={class:"text-gray-700"},st={key:0,class:"mt-2 w-[280px] sm:w-[320px] lg:w-[280px] xl:w-[320px] bg-white border border-gray-200 rounded-md p-3 shadow-lg text-left absolute right-0"},rt={class:"flex items-center justify-between mb-2"},dt={class:"text-[11px] text-gray-500"},ot={class:"space-y-3 max-h-56 overflow-auto pr-1 z-50"},lt={class:"pt-2 border-t border-dashed border-gray-200"},it={class:"text-[11px] text-gray-500 uppercase tracking-wide mb-1"},pt={key:0,class:"bg-red-500 rounded-md px-1.5 text-white text-center"},mt={class:"flex flex-wrap gap-2"},ut={key:0,class:"text-xs text-gray-400"},yt=["title"],ct={class:"block max-w-[160px] truncate"},gt={class:"text-[11px] text-gray-500 uppercase tracking-wide mb-1"},xt={key:0,class:"bg-green-500 rounded-md px-1.5 text-white text-center"},ft={class:"flex flex-wrap gap-2"},bt={key:0,class:"text-xs text-gray-400"},vt=["title"],wt={class:"block max-w-[160px] truncate"},ht={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},_t={key:3,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Dt={key:4,class:"overflow-x-auto md:overflow-clip bg-white border border-t-0 rounded-md shadow-sm print:shadow-none print:rounded-none print:border-gray-400"},It={class:"min-w-full text-left text-sm border-separate border-spacing-0"},kt={class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},Tt={class:"border-y print:border-gray-400 sticky md:top-[123px] z-30 rounded-t-md"},St={key:0,class:"px-4 py-3 border bg-white bg-opacity-70 backdrop-blur-sm text-center"},$t={class:"divide-y divide-gray-200"},Ct=["rowspan"],Nt={class:"sticky top-[170px] bg-white text-center"},Rt=["rowspan"],Et={class:"sticky top-[170px] bg-white flex"},At={key:0,class:"text-xs text-gray-500"},Lt=["colspan"],Ut=["rowspan"],Mt={class:"sticky top-[170px] bg-white"},zt={class:"px-4 py-3 text-gray-800 border-l border-t"},Bt={class:"font-medium"},Ot={class:"text-gray-400 mr-2"},Vt={class:"text-xs text-gray-500"},Ft={class:"px-4 py-3 border-l border-t border-r text-center"},en={__name:"TodoReportView",setup(A){var q,ee,te,ne,ae,se;const b=Se(),H=$e(),d=Be(),C=Me(),L=ze(),{companies:l}=xe(C),{departments:U}=xe(L),O=j(null),D=Ue(new Date),e=be({companyId:((q=b.query)==null?void 0:q.company_id)||"",departmentId:((ee=b.query)==null?void 0:ee.department_id)||"",employeeId:((te=b.query)==null?void 0:te.employee_id)||"",lineType:((ne=b.query)==null?void 0:ne.line_type)||"all",startDate:((ae=b.query)==null?void 0:ae.start_date)||D,endDate:((se=b.query)==null?void 0:se.end_date)||D}),p=w(()=>{var a;return[...((a=O.value)==null?void 0:a.employees)||[]].sort((n,u)=>{var c,y;return(((c=n.user)==null?void 0:c.name)||"").localeCompare(((y=u.user)==null?void 0:y.name)||"")}).map(n=>{const u=d.todo_dates.filter(s=>{var m;return String((m=s.user)==null?void 0:m.id)===String(n.id)}),c={};u.forEach(s=>{const m=s.date||"unknown-date";c[m]||(c[m]={date:m,todos:[]}),c[m].todos.push(s)});let y=Object.values(c).map(s=>({...s,rowSpan:s.todos.length})).sort((s,m)=>new Date(s.date)-new Date(m.date));y.length||(y=[{date:null,rowSpan:1,todos:[{id:`empty-${n.id}`,isPlaceholder:!0,title:""}]}]);const v=y.reduce((s,m)=>s+m.rowSpan,0);return{user:n,dates:y,rowSpan:Math.max(1,v)}})}),we=w(()=>{if(!e.startDate||!e.endDate)return"";const a=P(e.startDate,{weekDay:"long"}),n=P(e.endDate,{weekDay:"long"});return`${a} ~ ${n}`}),he=w(()=>C.employees||[]),_e={all:"All Types",executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},I=w(()=>{var y,v,s,m,k,T,S,g;const a=e.companyId&&((y=l.value)!=null&&y.length)?(v=l.value.find(x=>String(x.id)===String(e.companyId)))==null?void 0:v.name:null,n=e.departmentId&&((s=U.value)!=null&&s.length)?(m=U.value.find(x=>String(x.id)===String(e.departmentId)))==null?void 0:m.name:null;let u=null;e.employeeId&&(u=((T=(k=he.value)==null?void 0:k.find(x=>String(x.id)===String(e.employeeId)))==null?void 0:T.name)||((g=(S=p.value.find(x=>{var N;return String(((N=x.user)==null?void 0:N.id)||"")===String(e.employeeId)}))==null?void 0:S.user)==null?void 0:g.name)||null);const c=e.startDate===e.endDate&&e.startDate?P(e.startDate,{weekDay:"long"}):we.value||"-";return{company:a||(e.companyId?`#${e.companyId}`:"All Companies"),department:n||(e.departmentId?`#${e.departmentId}`:"All Departments"),employee:u||(e.employeeId?`#${e.employeeId}`:"All Employees"),lineType:_e[e.lineType]||e.lineType||"All Types",dateRange:c}}),E=j(!1),J=j(null),K=w(()=>{var a;return((a=p.value)==null?void 0:a.length)||0}),Z=w(()=>{var a,n;return Math.max(0,K.value-(((n=(a=h.value)==null?void 0:a.withoutTodos)==null?void 0:n.length)||0))}),G=a=>{E.value&&J.value&&(J.value.contains(a.target)||(E.value=!1))},h=w(()=>{var a;return(a=p.value)!=null&&a.length?p.value.reduce((n,u,c)=>{var s,m,k,T,S,g;const y=u.dates.reduce((x,N)=>x+N.todos.filter(_=>!_.isPlaceholder).length,0),v={id:((s=u.user)==null?void 0:s.id)??((m=u.user)==null?void 0:m.user_id)??((k=u.user)==null?void 0:k.uid)??((T=u.user)==null?void 0:T.email)??`${((S=u.user)==null?void 0:S.name)||"unknown"}-${c}`,name:((g=u.user)==null?void 0:g.name)||"Unknown user"};return y>0?n.withTodos.push(v):n.withoutTodos.push(v),n},{withTodos:[],withoutTodos:[]}):{withTodos:[],withoutTodos:[]}}),De=a=>a==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":a==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":a==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200";function Ie(){H.replace({query:{...b.query,company_id:e.companyId||void 0,department_id:e.departmentId||void 0,employee_id:e.employeeId||void 0,line_type:e.lineType||void 0,start_date:e.startDate||void 0,end_date:e.endDate||void 0}})}async function Q(){!e.companyId||!e.startDate||!e.endDate||await d.fetchTodoDates({"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate})}function ke(a){e.companyId=a.companyId||"",e.departmentId=a.departmentId||"",e.employeeId=a.employeeId||"",e.lineType=a.lineType||"all",e.startDate=a.startDate||"",e.endDate=a.endDate||""}function Te(){window.print()}const W=w(()=>e.startDate===e.endDate);return B(()=>e.companyId,a=>{a&&(L.fetchDepartments(a),C.fetchEmployee(a))},{immediate:!0}),B(()=>({...e}),(a,n)=>{JSON.stringify(a)!==JSON.stringify(n)&&(Ie(),Q())},{deep:!0}),B(()=>b.query,a=>{e.companyId=(a==null?void 0:a.company_id)||e.companyId,e.departmentId=(a==null?void 0:a.department_id)||e.departmentId,e.employeeId=(a==null?void 0:a.employee_id)||e.employeeId,e.lineType=(a==null?void 0:a.line_type)||e.lineType,e.startDate=(a==null?void 0:a.start_date)||e.startDate,e.endDate=(a==null?void 0:a.end_date)||e.endDate}),fe(()=>{C.fetchCompanies({ignore_permission:!0}),Q()}),fe(()=>{document.addEventListener("click",G,!0)}),Ce(()=>{document.removeEventListener("click",G,!0)}),(a,n)=>{var u,c,y,v;return r(),o("div",Ye,[X(We,{ref_key:"headingRef",ref:O,"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate,loading:V(d).loading,class:"mb-4 print:px-0 print:py-0 print:mb-2 print:border-0 print:border-b print:border-gray-400 print:rounded-none print:w-full sticky top-[58px] z-50",onChange:ke,onReloadClick:Q},{before:Y(()=>n[1]||(n[1]=[t("div",null,[t("h1",{class:"text-xl font-semibold text-gray-800"},"Todo Report")],-1)])),after:Y(()=>[t("button",{type:"button",class:"btn-icon print-hide disabled:opacity-35 cursor-pointer disabled:cursor-not-allowed",onClick:ve(Te,["prevent"]),disabled:V(d).loading},n[2]||(n[2]=[t("i",{class:"fas fa-print"},null,-1)]),8,Xe)]),_:1},8,["company-id","department-id","employee-id","line-type","start-date","end-date","loading"]),e.companyId&&e.startDate&&e.endDate?(r(),o("div",Ze,[t("div",Ge,[t("div",null,[n[3]||(n[3]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Company",-1)),t("div",qe,i(I.value.company),1)]),t("div",null,[n[4]||(n[4]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Department",-1)),t("div",{class:R(["font-medium",[I.value.department=="All Departments"?"text-gray-400":"text-gray-800"]])},i(I.value.department),3)]),t("div",null,[n[5]||(n[5]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Line Type",-1)),t("div",{class:R(["font-medium",[I.value.lineType=="All Types"?"text-gray-400":"text-gray-800"]])},i(I.value.lineType),3)]),t("div",null,[n[6]||(n[6]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Employee",-1)),t("div",{class:R(["font-medium",[I.value.employee=="All Employees"?"text-gray-400":"text-gray-800"]])},i(I.value.employee),3)]),t("div",et,[n[7]||(n[7]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Date",-1)),t("div",tt,i(I.value.dateRange),1)]),t("div",{ref_key:"assignmentSummaryRef",ref:J,class:"print-hide relative"},[t("button",{type:"button",class:"px-3 bg-white text-gray-700 hover:bg-gray-50 w-full text-bg text-right",onClick:n[0]||(n[0]=s=>E.value=!E.value)},[n[8]||(n[8]=t("div",{class:"uppercase"},"Todo given",-1)),t("div",nt,[t("div",at,i(Z.value)+" / "+i(K.value),1),t("i",{class:R(["fas",[E.value?"fa-chevron-up":"fa-chevron-down"]])},null,2)])]),E.value?(r(),o("div",st,[t("div",rt,[n[9]||(n[9]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Todo Status",-1)),t("div",dt,i(Z.value)+" given / "+i(K.value)+" selected ",1)]),t("div",ot,[t("div",lt,[t("div",it,[n[10]||(n[10]=F(" Not given todos ")),(u=h.value.withoutTodos)!=null&&u.length?(r(),o("span",pt,i((c=h.value.withoutTodos)==null?void 0:c.length),1)):f("",!0)]),t("div",mt,[h.value.withoutTodos.length?f("",!0):(r(),o("span",ut," Everyone has todos ")),(r(!0),o($,null,z(h.value.withoutTodos,s=>(r(),o("span",{key:`without-${s.id}`,class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-50 text-red-700 border border-red-100 text-xs max-w-full",title:s.name},[n[11]||(n[11]=t("i",{class:"fas fa-exclamation-circle"},null,-1)),t("span",ct,i(s.name),1)],8,yt))),128))])]),t("div",null,[t("div",gt,[n[12]||(n[12]=F(" Given todos ")),(y=h.value.withTodos)!=null&&y.length?(r(),o("span",xt,i((v=h.value.withTodos)==null?void 0:v.length),1)):f("",!0)]),t("div",ft,[h.value.withTodos.length?f("",!0):(r(),o("span",bt," No todos assigned ")),(r(!0),o($,null,z(h.value.withTodos,s=>(r(),o("span",{key:`with-${s.id}`,class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100 text-xs max-w-full",title:s.name},[n[13]||(n[13]=t("i",{class:"fas fa-check-circle"},null,-1)),t("span",wt,i(s.name),1)],8,vt))),128))])])])])):f("",!0)],512)])])):f("",!0),!e.companyId||!e.startDate||!e.endDate?(r(),o("div",ht,n[14]||(n[14]=[t("p",{class:"text-red-500"},"Select company and date range to view the report.",-1)]))):V(d).loading?(r(),Ne(Ee,{key:2},{default:Y(()=>n[15]||(n[15]=[F("Loading report...")])),_:1,__:[15]})):p.value.length===0?(r(),o("div",_t,n[16]||(n[16]=[t("div",null,[t("i",{class:"fas fa-tasks fa-2x text-gray-300 mb-2"})],-1),t("div",null,"No todos.",-1)]))):(r(),o("div",Dt,[t("table",It,[t("thead",kt,[t("tr",Tt,[n[17]||(n[17]=t("th",{class:"px-4 py-3 border w-[10px] bg-white bg-opacity-70 backdrop-blur-sm rounded-tl-md print:rounded-tl-none text-center"}," sl ",-1)),n[18]||(n[18]=t("th",{class:"px-4 py-3 border md:w-[100px] print:w-auto print:border-l print:border-l-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center"}," Employee Name ",-1)),W.value?f("",!0):(r(),o("th",St," Date ")),n[19]||(n[19]=t("th",{class:"px-4 py-3 border bg-white text-center"},"Todo",-1)),n[20]||(n[20]=t("th",{class:"px-4 py-3 border print:border-r print:border-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center rounded-tr-md print:rounded-tr-none"}," Status ",-1))])]),t("tbody",$t,[(r(!0),o($,null,z(p.value,(s,m)=>{var k,T,S;return r(),o($,{key:((k=s.user)==null?void 0:k.id)||(((S=(T=s.dates[0])==null?void 0:T.todos[0])==null?void 0:S.id)??Math.random())},[(r(!0),o($,null,z(s.dates,(g,x)=>{var N;return r(),o($,{key:`${((N=s.user)==null?void 0:N.id)||"u"}-${g.date}`},[(r(!0),o($,null,z(g.todos,(_,M)=>{var re,de,oe,le,ie,pe,me,ue;return r(),o("tr",{key:_.id||`${((re=s.user)==null?void 0:re.id)||"u"}-${g.date||"empty"}-${M}`,class:"border odd:bg-white even:bg-gray-50 hover:bg-gray-100"},[x===0&&M===0?(r(),o("td",{key:0,rowspan:s.rowSpan||1,class:"px-4 py-3 align-top font-bold text-xl text-gray-800 whitespace-nowrap border-l border-t bg-white"},[t("div",Nt,i(m+1),1)],8,Ct)):f("",!0),x===0&&M===0?(r(),o("td",{key:1,rowspan:s.rowSpan||1,class:"px-4 py-3 align-top font-medium text-gray-800 whitespace-nowrap border-l border-t bg-white"},[t("div",Et,[X(Re,{size:"medium",user:s.user,class:"inline-block mr-2 align-middle"},null,8,["user"]),t("div",null,[t("div",null,i(((de=s.user)==null?void 0:de.name)||"Unknown user"),1),(le=(oe=s.user)==null?void 0:oe.department)!=null&&le.name?(r(),o("div",At,i((pe=(ie=s.user)==null?void 0:ie.department)==null?void 0:pe.name),1)):f("",!0)])])],8,Rt)):f("",!0),_.isPlaceholder?(r(),o("td",{key:2,class:"border-l border-t border-r bg-white px-4 py-3 text-center",colspan:W.value?2:3},n[21]||(n[21]=[t("div",{class:"text-red-400"},[t("i",{class:"fas fa-tasks text-red-200 mb-2 mr-1"}),t("span",null,"No todos found for this user. ")],-1)]),8,Lt)):(r(),o($,{key:3},[M===0&&!W.value?(r(),o("td",{key:0,rowspan:g.rowSpan||1,class:"px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap border-l border-t bg-white"},[t("div",Mt,i(V(P)(g.date)||g.date||"-"),1)],8,Ut)):f("",!0),t("td",zt,[t("div",Bt,[t("span",Ot,i(M+1)+".",1),F(" "+i(_.title),1)]),t("div",Vt,i(((me=_.todoable)==null?void 0:me.title)||((ue=_.todoable_type)==null?void 0:ue.split("\\").pop())||""),1)]),t("td",Ft,[t("span",{class:R(["text-xs font-semibold px-2.5 py-1 rounded-full",De(_.status)])},i(_.status||"N/A"),3)])],64))])}),128))],64)}),128))],64)}),128))])])]))])}}};export{en as default};
