import{r as b,s as T,K as E,A as N,b as O,o as p,c as y,a as e,t as d,w as q,d as I,v as z,m as h,h as g,F as D,x as F,e as K,y as G,j as H,g as J}from"./index-BSvjzRT-.js";import{_ as U}from"./MultiselectDropdown-ITZxiAZi.js";import{u as P}from"./department-BuCs8rfX.js";import{u as Q}from"./user-B0So4S0d.js";import{_ as W,a as X}from"./HeaderWithButtons-DntqxFRp.js";import{L as Y}from"./LoaderView-B_xVQ2qo.js";import{u as Z}from"./leave-approval-kSB4LSgB.js";import"./vue-multiselect.esm-mrQpsHqZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const A={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},ee={class:"bg-white rounded-lg shadow-lg w-full max-w-lg"},te={class:"px-6 py-4 border-b"},se={class:"text-lg font-bold"},oe=["for"],ae={class:"flex justify-end space-x-4"},re={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"},ne={__name:"LeaveApprovalModal",props:{show:{type:Boolean,required:!0},leaveApproval:{type:Object,default:null}},emits:["close","save"],setup(w,{emit:k}){const v=w,l=k,i=b(null),u=Q(),f=P(),{departments:c}=T(f),_=b(!1),r=E({id:null,name:"",department_id:"",in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),n=E({in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null}),C=()=>{Object.keys(n).forEach(s=>{n[s]=u.users.find(a=>a.id===r[s])||null})};Object.keys(n).forEach(s=>{N(()=>n[s],a=>{console.log(a),r[s]=a?a.id:null})});const x=()=>{Object.assign(r,{id:null,name:"",department_id:"",in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),_.value=!1},M=()=>{Object.assign(n,{in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),_.value=!1};N(()=>v.leaveApproval,s=>{s?(_.value=!0,Object.assign(r,s),C()):(x(),M())},{immediate:!0,deep:!0}),N(()=>i.value,s=>{r.department_id=(s==null?void 0:s.id)||null});const $=()=>{if(!r.name||!r.approved_by_user_id){alert("Name and Approved By are required!");return}l("save",{...r}),o()},o=()=>{x(),l("close")};return O(()=>{u.fetchUsers(),f.fetchDepartments()}),(s,a)=>w.show?(p(),y("div",A,[e("div",ee,[e("div",te,[e("h3",se,d(_.value?"Edit Leave Approval":"Add Leave Approval"),1)]),e("form",{onSubmit:q($,["prevent"]),class:"p-6 space-y-4"},[e("div",null,[a[2]||(a[2]=e("label",{for:"name",class:"block text-sm font-medium"},"Approval Name",-1)),I(e("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=t=>r.name=t),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter approval name",required:""},null,512),[[z,r.name]])]),h(U,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=t=>i.value=t),multiple:!1,label:"name",options:g(c),placeholder:"Choose department"},null,8,["modelValue","options"]),(p(),y(D,null,F({in_charge_user_id:"In-Charge",coordinator_user_id:"Coordinator",operational_admin_user_id:"Operational Admin",recommend_by_user_id:"Recommend By",approved_by_user_id:"Approved By"},(t,m)=>e("div",{key:m},[e("label",{for:m,class:"block text-sm font-medium"},d(t),9,oe),h(U,{modelValue:n[m],"onUpdate:modelValue":L=>n[m]=L,multiple:!1,label:"name",options:g(u).users},null,8,["modelValue","onUpdate:modelValue","options"])])),64)),e("div",ae,[e("button",{type:"button",onClick:o,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400"}," Cancel "),e("button",re,d(_.value?"Update":"Create"),1)])],32)])])):K("",!0)}},de={class:"my-container space-y-2"},le={class:"overflow-x-auto"},ie={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ce={class:"text-gray-600 text-sm"},ue={key:0},_e={colspan:"8"},me={class:"py-3 px-2 text-left"},pe={class:"py-3 px-2 text-left"},ye={class:"py-3 px-2 text-left"},fe={class:"py-3 px-2 text-left"},he={class:"py-3 px-2 text-left"},xe={class:"py-3 px-2 text-left"},be={class:"py-3 px-2 text-left"},ge={class:"py-3 px-2 text-center"},ve={class:"flex justify-center gap-4"},Le=["onClick"],we=["onClick"],ke={key:2},Ue={__name:"LeaveApprovalList",setup(w){const k=J(),v=G(()=>k.currentRoute.value.name==="LeaveApprovalList"?"leave":"other"),l=Z(),i=H(),u=b(!1),f=b(!1),c=b(null),_=()=>{c.value=null,u.value=!0},r=o=>{c.value={...o},u.value=!0},n=()=>{u.value=!1},C=o=>{c.value=o,f.value=!0},x=()=>{f.value=!1},M=async()=>{var o;if(!((o=c.value)!=null&&o.id)){i.error("Invalid leave approval selected for deletion!");return}try{await l.deleteLeaveApproval(c.value.id),i.success("Leave approval deleted successfully!")}catch(s){i.error("Failed to delete leave approval!"),console.error("Error deleting leave approval:",s)}finally{x()}},$=async o=>{o.id||(o={...o,type:v.value});const s=o.id?"updateLeaveApproval":"createLeaveApproval",a=o.id?"Leave approval updated successfully!":"Leave approval added successfully!";try{await l[s](o.id||o,o),i.success(a)}catch(t){i.error("Failed to save leave approval!"),console.error("Error saving leave approval:",t)}finally{n()}};return O(()=>{l.fetchLeaveApprovals({type:v.value})}),(o,s)=>{var a;return p(),y("div",de,[h(X,{title:"Leave Approvals",onAdd:_}),e("div",le,[e("table",ie,[s[3]||(s[3]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-left"},"Name"),e("th",{class:"py-3 px-2 text-left"},"Department"),e("th",{class:"py-3 px-2 text-left"},"In-Charge"),e("th",{class:"py-3 px-2 text-left"},"Coordinator"),e("th",{class:"py-3 px-2 text-left"},"Operational Admin"),e("th",{class:"py-3 px-2 text-left"},"Recommend By"),e("th",{class:"py-3 px-2 text-left"},"Approved By"),e("th",{class:"py-3 px-2 text-center"},"Actions")])],-1)),e("tbody",ce,[g(l).loading?(p(),y("tr",ue,[e("td",_e,[h(Y,{class:"shadow-none"})])])):g(l).leaveApprovals.length?(p(!0),y(D,{key:1},F(g(l).leaveApprovals,t=>{var m,L,S,j,V,B;return p(),y("tr",{key:t.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",me,d(t==null?void 0:t.name),1),e("td",pe,d((m=t==null?void 0:t.department)==null?void 0:m.name),1),e("td",ye,d(((L=t==null?void 0:t.in_charge_user)==null?void 0:L.name)||"N/A"),1),e("td",fe,d(((S=t==null?void 0:t.coordinator_user)==null?void 0:S.name)||"N/A"),1),e("td",he,d(((j=t==null?void 0:t.operational_admin_user)==null?void 0:j.name)||"N/A"),1),e("td",xe,d(((V=t==null?void 0:t.recommend_by_user)==null?void 0:V.name)||"N/A"),1),e("td",be,d(((B=t==null?void 0:t.approved_by_user)==null?void 0:B.name)||"N/A"),1),e("td",ge,[e("div",ve,[e("button",{onClick:R=>r(t),class:"text-blue-600 hover:text-blue-800"},s[0]||(s[0]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Le),e("button",{onClick:R=>C(t),class:"text-red-600 hover:text-red-800"},s[1]||(s[1]=[e("i",{class:"fas fa-trash"},null,-1)]),8,we)])])])}),128)):(p(),y("tr",ke,s[2]||(s[2]=[e("td",{colspan:"8",class:"text-center text-red-500 py-4"},"No leave approvals found",-1)])))])])]),h(ne,{show:u.value,leaveApproval:c.value,onClose:n,onSave:$},null,8,["show","leaveApproval"]),h(W,{show:f.value,title:"Delete Leave Approval",message:`Are you sure you want to delete ${(a=c.value)==null?void 0:a.name}?`,onClose:x,onConfirm:M},null,8,["show","message"])])}}};export{Ue as default};
