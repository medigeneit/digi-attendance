import{x as p,r as w,c as r,o,a as s,k as h,t as i,O as j,n as ne,F as C,e as M,s as de,f as As,g as Cs,q as be,l as fe,G as Ms,v as He,j as tt,d as Es,b as ue,I as Is,m as Ps,z as Ts,T as js,C as Ut}from"./index-DoDyGwYu.js";import{u as Rs}from"./kpi-C4ARMQft.js";const Gs={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Hs={class:"flex items-center justify-between border-b bg-slate-50 px-3 py-2 gap-2"},zs={class:"flex items-center gap-2 min-w-0"},Bs={class:"text-sm font-semibold text-slate-800 truncate"},Ds={key:0,class:"text-[11px] text-slate-500 truncate"},Ks={key:1,class:"flex items-center gap-2 shrink-0"},Os={class:"inline-flex items-center rounded-xl border bg-white p-1 shadow-sm"},Qs=["disabled"],Vs=["disabled"],qs=["disabled"],Us={class:"overflow-auto"},Ys={key:0,class:"min-w-[980px] w-full text-[11px]"},Ws={class:"bg-slate-50 sticky top-0 z-10"},Js={class:"text-slate-700"},Xs={class:"text-[11px] font-semibold"},Zs={class:"text-[10px] text-slate-500 flex flex-col items-center"},el=["title"],tl={key:0,class:"mt-0.5 inline-flex items-center gap-1 rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-semibold text-blue-700 border border-blue-200"},sl={class:"bg-slate-100/80 border-t"},ll=["colspan"],al={class:"flex items-start justify-between gap-2"},nl=["title"],ol={class:"opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition shrink-0"},rl={class:"inline-flex items-center rounded-lg border bg-white p-0.5 shadow-sm"},il=["disabled","onClick"],ul=["disabled","onClick"],dl=["disabled","onClick"],cl=["disabled","onClick"],vl=["disabled","onClick"],ml={key:0,class:"flex items-center justify-center"},xl=["max","value","onInput","onBlur","aria-label"],pl={key:1,class:"text-slate-700 tabular-nums"},bl={key:2,class:"text-slate-300"},fl={class:"bg-slate-50 border-t"},yl={class:"font-semibold text-slate-900 tabular-nums"},gl={class:"text-[10px] text-slate-500 tabular-nums"},hl={class:"mt-1 h-1 rounded bg-slate-200 overflow-hidden"},_l={key:1,class:"text-slate-300"},kl={key:1,class:"w-full text-[11px]"},wl={class:"sticky top-0 bg-white z-10"},$l={class:"bg-slate-100 text-slate-700"},Fl={class:"text-left px-2 py-2 w-[34%] font-medium"},Ll={class:"px-2 py-2 text-center text-slate-500"},Sl=["title"],Nl={class:"px-2 py-2 text-center text-slate-700 tabular-nums"},Al={class:"px-2 py-2 text-center"},Cl=["max","value","onInput","onBlur"],Ml={key:1,class:"text-slate-700 tabular-nums"},El={class:"bg-slate-50 border-t"},Il={class:"px-2 py-2 text-center font-semibold text-slate-800 tabular-nums"},Pl={class:"px-2 py-2 text-center font-semibold text-slate-900 tabular-nums"},$e=44,ze=320,et=84,Yt=Object.assign({name:"KpiGroupTable"},{__name:"KpiGroupTable",props:{group:{type:Object,required:!0},isPersonal:{type:Boolean,default:!1},lanes:{type:Array,default:()=>[]},editableLaneKey:{type:String,default:null},canEdit:{type:Boolean,default:!1},marks:{type:Object,default:()=>({})},headerLabel:{type:String,default:""},itemLabel:{type:String,default:"Item"},helperText:{type:String,default:""},showQuickFillGroup:{type:Boolean,default:!1},autoFillLabel:{type:String,default:""},autoFillVisible:{type:Boolean,default:!1},onAutoFill:{type:Function,default:null},serialMap:{type:Object,default:()=>({})},getLaneMark:{type:Function,default:()=>""},getHrMark:{type:Function,default:()=>""},onMarkChange:{type:Function,default:null},onCap:{type:Function,default:null},onQuickFillItem:{type:Function,default:null},onQuickFillGroup:{type:Function,default:null}},setup(x){const $=x,te=$e,S=$e+ze,oe=p(()=>Array.isArray($.lanes)?$.lanes:[]),E=p(()=>{var f;return Array.isArray((f=$.group)==null?void 0:f.items)?$.group.items:[]}),Be=p(()=>$.showQuickFillGroup||$.isPersonal&&$.canEdit),ce=f=>{if(f===""||f==null)return null;const u=Number(f);return Number.isFinite(u)?u:null},k=f=>{const u=Number(f);return Number.isFinite(u)?u:0},I=(f,u,n)=>Math.min(Math.max(f,u),n),W=p(()=>E.value.reduce((f,u)=>f+k(u==null?void 0:u.max),0)),se=p(()=>E.value.reduce((f,u)=>{var g;const n=(g=$.marks)==null?void 0:g[u.id],y=n===""||n==null?0:Number(n),_=k(u==null?void 0:u.max);return f+I(k(y),0,_)},0)),le=(f,u)=>{var n;return((n=$.serialMap)==null?void 0:n[f.id])??u+1},G=w(!1),H=f=>(f==null?void 0:f.key)===$.editableLaneKey&&!!(f!=null&&f.can_current_user_review),re=(f,u)=>{var n,y;return!f||!u?null:H(f)?ce((n=$.marks)==null?void 0:n[u.id]):f!=null&&f.can_view_marks?ce((y=$.getLaneMark)==null?void 0:y.call($,f.key,u.id)):null},T=p(()=>{const f={},u=k(W.value);return oe.value.forEach(n=>{const y=H(n)||!!(n!=null&&n.can_view_marks);if(!(n!=null&&n.key))return;let _=0,g=!1;E.value.forEach(K=>{const Le=re(n,K);if(Le==null)return;g=!0;const De=k(K==null?void 0:K.max);_+=I(k(Le),0,De)});const D=u>0?Math.round(_/u*100):0;f[n.key]={got:Number(_.toFixed(2)),max:Number(u.toFixed(2)),percent:D,hasData:g,canShow:y}}),f}),z=p(()=>{const f=oe.value;if(G.value)return f;const u=f.filter(n=>{var y,_;return H(n)?!0:!!((_=(y=T.value)==null?void 0:y[n.key])!=null&&_.hasData)});return u.length?u:f}),ie=f=>{var y;const u=(y=T.value)==null?void 0:y[f];return!u||!u.max?"0%":`${I(u.got/u.max*100,0,100)}%`},B=f=>{var n;if(!$.canEdit)return!1;const u=(n=$.marks)==null?void 0:n[f.id];return u===""||u==null},ae=(f,u)=>{var y;const n=u===""?"":Number(u);u!==""&&Number.isNaN(n)||(y=$.onMarkChange)==null||y.call($,f,n)},Fe=(f,u)=>{var n;return(n=$.onCap)==null?void 0:n.call($,f,u)};return(f,u)=>(o(),r("section",Gs,[s("div",Hs,[s("div",zs,[s("div",Bs,i(x.headerLabel),1),x.isPersonal&&oe.value.length>1?(o(),r("button",{key:0,type:"button",class:"shrink-0 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[10px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:u[0]||(u[0]=n=>G.value=!G.value)},i(G.value?"Show only filled lanes":"Show all lanes"),1)):h("",!0)]),x.helperText?(o(),r("div",Ds,i(x.helperText),1)):h("",!0),Be.value&&x.itemLabel!=="Personal Attributes"?(o(),r("div",Ks,[s("div",Os,[s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg text-slate-700 hover:bg-slate-100 disabled:opacity-40",onClick:u[1]||(u[1]=n=>{var y;return(y=x.onQuickFillGroup)==null?void 0:y.call(x,x.group,"half")}),disabled:!x.canEdit}," All 1/2 ",8,Qs),s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg text-slate-700 hover:bg-slate-100 disabled:opacity-40",onClick:u[2]||(u[2]=n=>{var y;return(y=x.onQuickFillGroup)==null?void 0:y.call(x,x.group,"threeQuarter")}),disabled:!x.canEdit}," All 3/4 ",8,Vs),s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg bg-slate-900 text-white hover:bg-slate-800 disabled:opacity-40",onClick:u[3]||(u[3]=n=>{var y;return(y=x.onQuickFillGroup)==null?void 0:y.call(x,x.group,"full")}),disabled:!x.canEdit}," All Full ",8,qs)]),x.autoFillVisible?(o(),r("button",{key:0,type:"button",class:"rounded-full border border-slate-300 bg-white px-2.5 py-1 text-[10px] font-semibold text-slate-600 hover:border-slate-400",onClick:u[4]||(u[4]=n=>{var y;return(y=x.onAutoFill)==null?void 0:y.call(x)})},i(x.autoFillLabel),1)):h("",!0)])):h("",!0)]),s("div",Us,[x.isPersonal?(o(),r("table",Ys,[s("thead",Ws,[s("tr",Js,[s("th",{class:"sticky left-0 z-20 bg-slate-50 px-2 py-2 text-center font-medium",style:j({width:$e+"px"})}," # ",4),s("th",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-left font-medium",style:j({left:ne(te)+"px",width:ze+"px"})},i(x.itemLabel),5),s("th",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-center font-medium",style:j({left:S+"px",width:et+"px"})}," Max ",4),(o(!0),r(C,null,M(z.value,n=>(o(),r("th",{key:n.key,class:"px-2 py-2 text-center font-medium"},[s("div",Xs,i(n.label||n.key),1),s("div",Zs,[s("span",{class:"truncate max-w-[140px]",title:n.assigned_user_name||""},i(n.assigned_user_name||"-"),9,el),H(n)?(o(),r("span",tl," ✎ You can edit ")):h("",!0)])]))),128))])]),s("tbody",null,[s("tr",sl,[s("td",{colspan:3+z.value.length,class:"px-2 py-2 font-medium text-slate-800"},i(x.group.label||"Personal"),9,ll)]),(o(!0),r(C,null,M(E.value,(n,y)=>(o(),r("tr",{key:n.id,class:de(["border-t hover:bg-slate-50/60 group",B(n)?"bg-rose-50/30 border-l-4 border-rose-400":""])},[s("td",{class:"sticky left-0 z-10 bg-white px-2 py-2 text-center text-slate-500",style:j({width:$e+"px"})},i(le(n,y)),5),s("td",{class:"sticky z-10 bg-white px-2 py-2 align-top",style:j({left:ne(te)+"px",width:ze+"px"})},[s("div",al,[s("div",{class:"font-medium text-slate-800 truncate pr-2",title:n.label},i(n.label),9,nl),s("div",ol,[s("div",rl,[s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,n.id,n.max,"zero"))},title:"Set 0"}," 0 ",8,il),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,n.id,n.max,"quarter"))},title:"Set 25%"}," ¼ ",8,ul),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,n.id,n.max,"half"))},title:"Set 50%"}," ½ ",8,dl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,n.id,n.max,"threeQuarter"))},title:"Set 75%"}," ¾ ",8,cl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,n.id,n.max,"full"))},title:"Set 100%"}," Full ",8,vl)])])])],4),s("td",{class:"sticky z-10 bg-white px-2 py-2 text-center text-slate-700 tabular-nums",style:j({left:S+"px",width:et+"px"})},i(k(n.max).toFixed(1).replace(/\.0$/,"")),5),(o(!0),r(C,null,M(z.value,_=>(o(),r("td",{key:_.key,class:"px-2 py-2 text-center"},[H(_)?(o(),r("div",ml,[s("input",{type:"number",step:"0.1",min:"0",max:n.max,value:x.marks[n.id]??"",onInput:g=>ae(n.id,g.target.value),onBlur:g=>Fe(n.id,n.max),inputmode:"decimal",class:de(["w-16 text-right rounded-md px-2 py-1 text-[11px] focus:outline-none focus:ring-2 focus:ring-indigo-200 border tabular-nums",B(n)?"border-rose-300 bg-rose-50/40":"border-slate-200"]),"aria-label":`Score for ${n.label}`},null,42,xl)])):_.can_view_marks?(o(),r("div",pl,i($.getLaneMark(_.key,n.id)||"—"),1)):(o(),r("div",bl,"—"))]))),128))],2))),128)),s("tr",fl,[s("td",{class:"sticky left-0 z-20 bg-slate-50 px-2 py-2",style:j({width:$e+"px"})},null,4),s("td",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-right font-medium text-slate-700",style:j({left:ne(te)+"px",width:ze+"px"})}," Group Total ",4),s("td",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-center font-semibold text-slate-800 tabular-nums",style:j({left:S+"px",width:et+"px"})},i(W.value.toFixed(2)),5),(o(!0),r(C,null,M(z.value,n=>{var y,_,g,D;return o(),r("td",{key:n.key,class:"px-2 py-2 text-center align-top"},[(_=(y=T.value)==null?void 0:y[n.key])!=null&&_.canShow&&(H(n)||(D=(g=T.value)==null?void 0:g[n.key])!=null&&D.hasData)?(o(),r(C,{key:0},[s("div",yl,i(T.value[n.key].got.toFixed(2)),1),s("div",gl," / "+i(T.value[n.key].max.toFixed(2))+" · "+i(T.value[n.key].percent)+"% ",1),s("div",hl,[s("div",{class:"h-1 bg-slate-900/40",style:j({width:ie(n.key)})},null,4)])],64)):(o(),r("div",_l,"—"))])}),128))])])])):(o(),r("table",kl,[s("thead",wl,[s("tr",$l,[u[5]||(u[5]=s("th",{class:"px-2 py-2 w-[36px] text-center font-medium"},"#",-1)),s("th",Fl,i(x.itemLabel),1),u[6]||(u[6]=s("th",{class:"px-2 py-2 text-center w-[70px] font-medium"},"Max",-1)),u[7]||(u[7]=s("th",{class:"px-2 py-2 text-center w-[90px] font-medium"},"HR Score",-1))])]),s("tbody",null,[(o(!0),r(C,null,M(E.value,(n,y)=>(o(),r("tr",{key:n.id,class:de(["border-t hover:bg-slate-50/60",B(n)?"bg-rose-50/30 border-l-4 border-rose-400":""])},[s("td",Ll,i(y+1),1),s("td",{class:"px-2 py-2 font-medium text-slate-800 truncate",title:n.label},i(n.label),9,Sl),s("td",Nl,i(k(n.max).toFixed(1).replace(/\.0$/,"")),1),s("td",Al,[x.canEdit?(o(),r("input",{key:0,type:"number",step:"0.1",min:"0",max:n.max,value:x.marks[n.id]??"",onInput:_=>ae(n.id,_.target.value),onBlur:_=>Fe(n.id,n.max),class:de(["w-16 text-right rounded-md px-2 py-1 text-[11px] focus:outline-none focus:ring-2 focus:ring-indigo-200 border tabular-nums",B(n)?"border-rose-300 bg-rose-50/40":"border-slate-200"])},null,42,Cl)):(o(),r("span",Ml,i($.getHrMark(n.id)||"—"),1))])],2))),128)),s("tr",El,[u[8]||(u[8]=s("td",null,null,-1)),u[9]||(u[9]=s("td",{class:"px-2 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),s("td",Il,i(W.value.toFixed(2)),1),s("td",Pl,i(se.value.toFixed(2)),1)])])]))])]))}}),Tl={key:0,class:"space-y-4"},jl={class:"flex items-start justify-between gap-3"},Rl={class:"text-sm font-semibold text-slate-900"},Gl={class:"text-xs text-slate-500"},Hl={key:0,class:"text-xs text-slate-400"},zl={class:"flex flex-wrap items-center gap-2"},Bl=["onClick"],Dl={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Kl={key:1,class:"rounded-xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-700"},Ol={key:2,class:"space-y-3"},Ql={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Vl={key:1,class:"space-y-3"},ql={class:"flex items-start justify-between gap-3"},Ul={class:"min-w-0"},Yl=["title"],Wl={class:"mt-0.5 text-[11px] text-slate-500"},Jl={key:0},Xl={key:1},Zl={class:"shrink-0"},ea=["onUpdate:modelValue"],ta=["value"],sa={class:"mt-2"},la=["onUpdate:modelValue"],aa={class:"flex items-center justify-end gap-2 pt-2"},na=["disabled"],oa=["disabled"],ra={key:1,class:"max-w-7xl mx-auto px-4 py-6 space-y-6"},ia={key:0,class:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700"},ua={key:1,class:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-10 text-sm text-slate-600"},da={class:"border rounded-2xl bg-white/80 backdrop-blur px-4 py-3 shadow-sm"},ca={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},va={class:"space-y-1"},ma={class:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1"},xa={class:"text-xs text-indigo-900"},pa={class:"text-sm text-slate-600"},ba={class:"font-medium text-slate-800"},fa={class:"flex flex-wrap gap-2 text-xs mt-0.5"},ya={key:0,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},ga={class:"ml-1 font-medium text-slate-800"},ha={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},_a={class:"ml-1 font-medium text-slate-800"},ka={class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},wa={key:0,class:"ml-1 inline-flex items-center gap-1"},$a={class:"font-semibold text-slate-800"},Fa={class:"font-semibold text-emerald-700"},La={key:1,class:"ml-1 inline-flex items-center gap-1"},Sa={key:2,class:"ml-1 font-semibold text-slate-800"},Na={class:"flex items-end gap-4"},Aa={class:"text-right"},Ca={class:"text-lg font-bold text-slate-900"},Ma={class:"text-slate-400"},Ea={class:"text-xs text-slate-500"},Ia={key:0},Pa={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Ta={class:"text-xs text-slate-500"},ja={key:0,class:"p-4 text-sm font-bold text-slate-500"},Ra=["innerHTML"],Ga={class:"mt-2"},Ha={class:"grid gap-4 lg:grid-cols-5"},za={key:0,class:"space-y-4 lg:col-span-3"},Ba={key:0,class:"sticky top-6 border rounded-2xl bg-white shadow-sm"},Da={class:"flex flex-wrap items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},Ka={class:"flex flex-wrap items-center gap-2 text-[11px] text-slate-500"},Oa={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Qa={key:0,class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Va={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},qa={class:"p-4 space-y-4 max-h-[360px] overflow-y-auto"},Ua={class:"flex flex-wrap gap-2 border-b border-slate-100 pb-3"},Ya=["onClick"],Wa={class:"space-y-4"},Ja={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},Xa={class:"rounded-xl border bg-slate-50 p-3"},Za={class:"flex items-center justify-between"},en={class:"text-[11px] px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200"},tn={class:"mt-1 text-sm font-semibold text-slate-900"},sn={class:"text-xs text-slate-500"},ln={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},an={class:"rounded-xl border bg-slate-50 p-3"},nn={class:"flex items-center justify-between"},on={class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-200"},rn={class:"mt-1 text-sm font-semibold text-slate-900"},un={class:"text-xs text-slate-500"},dn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},cn={class:"rounded-xl border bg-slate-50 p-3 sm:col-span-2"},vn={class:"flex items-center justify-between"},mn={class:"text-[11px] px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 border border-emerald-200"},xn={class:"mt-1 text-sm font-semibold text-slate-900"},pn={class:"text-xs text-slate-500"},bn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},fn={class:"border-t pt-2 text-xs"},yn={key:0,class:"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs space-y-2"},gn={class:"grid grid-cols-2 gap-2"},hn={class:"font-medium text-slate-800"},_n={class:"font-medium text-slate-800"},kn={class:"font-medium text-slate-800"},wn={class:"font-medium text-slate-800"},$n={class:"font-medium text-slate-800"},Fn={class:"font-medium text-slate-800"},Ln={key:1,class:"border rounded-2xl bg-white shadow-sm"},Sn={class:"flex items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},Nn={class:"text-[11px] text-slate-500"},An={class:"p-4 space-y-3"},Cn={class:"max-h-96 overflow-auto border rounded-xl"},Mn={class:"min-w-full text-xs text-left"},En={class:"px-2 py-2"},In={class:"font-semibold text-slate-700"},Pn={key:0,class:"mt-0.5 text-[11px] text-slate-400"},Tn={class:"px-2 py-2 text-right"},jn=["onClick"],Rn={key:2,class:"rounded-2xl bg-white border shadow-sm px-4 py-4 space-y-4"},Gn={class:"grid gap-4 md:grid-cols-3"},Hn={class:"space-y-3"},zn={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},Bn={key:0,class:"text-[11px] text-emerald-600"},Dn={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},Kn={class:"flex flex-wrap gap-1.5"},On=["onClick","disabled"],Qn={class:"space-y-1"},Vn={class:"space-y-3"},qn={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},Un={key:0,class:"text-[11px] text-amber-600"},Yn={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},Wn={class:"flex flex-wrap gap-1.5"},Jn=["onClick","disabled"],Xn={class:"space-y-1"},Zn={class:"space-y-3"},eo={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},to={key:0,class:"text-[11px] text-sky-600"},so={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},lo={class:"flex flex-wrap gap-1.5"},ao=["onClick","disabled"],no={class:"space-y-1"},oo={class:"mt-2 flex flex-col gap-3 border-t pt-3 md:flex-row md:items-center md:justify-between"},ro={class:"flex flex-wrap items-center gap-2"},io=["disabled"],uo=["disabled"],co={class:"relative w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true"},vo={class:"flex items-start justify-between gap-3"},mo={class:"text-lg font-semibold text-slate-900"},xo={class:"text-xs text-slate-500"},po={key:0,class:"text-xs text-slate-400 mt-1"},bo={class:"mt-5 space-y-4 text-sm text-slate-700"},fo={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},yo={key:0},go={key:1,class:"text-slate-400"},ho={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},_o={key:0},ko={key:1,class:"text-slate-400"},wo={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},$o={key:0},Fo={key:1,class:"text-slate-400"},Lo=15e3,So={__name:"KpiReviewForm",props:{mode:{type:String,default:"full"},allowedLanes:{type:Array,default:()=>["supv_director","da"]},groupFilter:{type:String,default:null},initialLane:{type:String,default:""},employeeId:{type:[Number,String],default:null},employeeName:{type:String,default:""},year:{type:Number,default:null}},emits:["saved"],setup(x,{emit:$}){const te=As(),S=Rs(),oe=Cs(),E=x,Be=$,ce=p(()=>E.mode==="compact"),k=w({}),I=w({}),W=w(""),se=w(""),le=w(""),G=w(null),H=w(null),re=w(!1),T=w(!1),z=w(""),ie=p(()=>{const e=Number(E.employeeId);return Number.isFinite(e)&&e>0?e:null}),B=p(()=>{const e=Number(E.year);return Number.isFinite(e)&&e>0?e:new Date().getFullYear()}),ae=p(()=>E.groupFilter?String(E.groupFilter):"personal"),Fe=p(()=>ae.value?ae.value.replace(/_/g," "):"personal"),f=p(()=>{const e=Array.isArray(E.allowedLanes)?E.allowedLanes.filter(Boolean):[];return e.length?e:["supv_director","da"]}),u=w(E.initialLane||f.value[0]||""),n=w([]),y=w({}),_=w({}),g=w(!1),D=w(!1),K=w(""),Le=p(()=>{var e;return E.employeeName||((e=I.value)==null?void 0:e.name)||"Employee"}),De={supv_director:"Supv. Director",da:"DA"},st=e=>De[e]||e;function Wt(e){return Array.isArray(e)?e.map((t,l)=>{const a=(t==null?void 0:t.id)??(t==null?void 0:t.item_id)??(t==null?void 0:t.kpi_item_id)??(t==null?void 0:t.kpi_id)??l,c=(t==null?void 0:t.title)??(t==null?void 0:t.name)??(t==null?void 0:t.label)??`Item ${l+1}`,v=(t==null?void 0:t.weight)??(t==null?void 0:t.weightage)??(t==null?void 0:t.weight_value)??(t==null?void 0:t.score_weight)??null,d=(t==null?void 0:t.max_score)??(t==null?void 0:t.max)??(t==null?void 0:t.max_marks)??(t==null?void 0:t.score_max)??0,b=(t==null?void 0:t.score)??(t==null?void 0:t.mark)??(t==null?void 0:t.obtained)??(t==null?void 0:t.value)??null,L=(t==null?void 0:t.comment)??(t==null?void 0:t.note)??(t==null?void 0:t.remark)??"";return{id:a,title:c,weight:v,maxScore:d,score:b,comment:L}}):[]}function Jt(e){const t=Number(e);if(!Number.isFinite(t)||t<=0)return[0];const l=Number.isInteger(t)?1:.5,a=[];for(let c=0;c<=t+1e-4;c+=l){const v=l===1?Math.round(c):Number(c.toFixed(1));a.push(v)}return a[a.length-1]!==t&&a.push(t),a}async function Xt(){var e,t,l,a;if(ce.value&&!(!ie.value||!B.value||!u.value)){g.value=!0,K.value="";try{const{data:c}=await Ut.get(`/kpi/yearly/${B.value}/employees/${ie.value}/marking-form`,{params:{lane:u.value,group:ae.value}}),v=(c==null?void 0:c.data)??c??{},d=(v==null?void 0:v.items)||((e=v==null?void 0:v.form)==null?void 0:e.items)||((t=v==null?void 0:v.group)==null?void 0:t.items)||(v==null?void 0:v.data)||[],b=Wt(d),L={},N={};b.forEach(R=>{var he,_e;const ee=(he=v==null?void 0:v.marks)==null?void 0:he[R.id],Y=(_e=v==null?void 0:v.comments)==null?void 0:_e[R.id],pe=R.score??ee??0,Ge=R.comment??Y??"";L[R.id]=pe===""||pe==null?0:Number(pe),N[R.id]=Ge??""}),n.value=b,y.value=L,_.value=N}catch(c){K.value=((a=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to load KPI marking form.",n.value=[]}finally{g.value=!1}}}async function lt(e){var t,l;if(!(!ie.value||!B.value||!u.value)){D.value=!0,K.value="";try{const a=n.value.map(v=>({item_id:v.id,score:Number(y.value[v.id]??0),comment:_.value[v.id]??""})),c={lane:u.value,group:ae.value,submit:!!e,items:a,marks:{...y.value},comments:{..._.value}};await Ut.post(`/kpi/yearly/${B.value}/employees/${ie.value}/marking-form`,c),Be("saved")}catch(a){K.value=((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to save KPI marking form."}finally{D.value=!1}}}be(()=>E.initialLane,e=>{e&&(u.value=e)}),be(f,e=>{e.length&&(e.includes(u.value)||(u.value=e[0]))},{immediate:!0}),be([ce,u,ie,B,ae],([e,t,l,a,c])=>{!e||!t||!l||!a||!c||Xt()},{immediate:!0});const at=w([]),nt=w({}),Ke=w(!1),Se=p(()=>{var e;return((e=S.cycle)==null?void 0:e.groups_json)||[]}),Zt=p(()=>{var a;const e=S.cycle||{},t=Array.isArray(e==null?void 0:e.groups_json)?e.groups_json:[];return(e==null?void 0:e.slug)==="support_staff"&&t.length===1&&((a=t[0])==null?void 0:a.id)==="personal"?"staff":"executive"}),O=p(()=>Zt.value==="staff"),ot=e=>{if(!e)return!1;const t=String(e.id||"").toLowerCase(),l=String(e.label||"").toLowerCase();return t==="personal"||t==="personal_evaluation"||t==="personal_eval"?!0:l.includes("personal")},J=p(()=>Se.value.find(ot)||null),Q=p(()=>O.value?[]:Se.value.filter(e=>!ot(e))),es=(e,t)=>(e==null?void 0:e.label)||`Group ${t+1}`,ts=e=>/^hr\d*$/i.test(e)||e==="hr",rt=e=>ts((e==null?void 0:e.key)||"")||(e==null?void 0:e.is_hr_lane)===!0,Ne=p(()=>[...at.value||[]].sort((e,t)=>(e.rank??999)-(t.rank??999))),Oe=p(()=>Ne.value.filter(rt)),it=p(()=>Ne.value.filter(e=>!rt(e))),Qe=p(()=>O.value?Ne.value:it.value),X=p(()=>{var e;return((e=Qe.value.find(t=>t.can_current_user_review))==null?void 0:e.key)||null}),ss=p(()=>Qe.value.find(e=>e.key===X.value)||null),ls=p(()=>{var e;return((e=ss.value)==null?void 0:e.rank)??null}),as=p(()=>{var e;return Number(((e=oe==null?void 0:oe.user)==null?void 0:e.id)||0)}),Ve=p(()=>{const e=as.value;if(!e)return null;const t=Oe.value.find(l=>Number(l.assigned_user_id)===e);return t||Oe.value.find(l=>l.can_current_user_review)||null}),V=p(()=>{var e;return((e=Ve.value)==null?void 0:e.key)||null}),ns=p(()=>!!(Ve.value&&Ve.value.can_current_user_review)),q=p(()=>!!(Ke.value||ns.value)),Ae=p(()=>!!X.value),os=p(()=>{if(O.value||!q.value)return!1;const e=X.value,t=V.value;return!e||!t||e===t?!1:Q.value.length>0}),Ce=p(()=>O.value?X.value:q.value&&V.value?V.value:X.value),ut=p(()=>!!(Ce.value&&V.value&&Ce.value===V.value));function ve(e){var a;const t=(a=nt.value)==null?void 0:a[e];return t?(Array.isArray(t)?t:[t]).reduce((c,v)=>{if(!v)return c;if(!c)return v;const d=new Date(v.submitted_at||0).getTime(),b=new Date(c.submitted_at||0).getTime();return d>b?v:c},null):null}function dt(e,t){var a;const l=ve(e);return((a=l==null?void 0:l.marks)==null?void 0:a[t])??""}function ct(e){var l,a,c;if(V.value){const v=ve(V.value),d=(l=v==null?void 0:v.marks)==null?void 0:l[e];if(d!=null)return d}let t=null;for(const v of Oe.value){const d=ve(v.key);if(!d||((a=d==null?void 0:d.marks)==null?void 0:a[e])==null)continue;if(!t){t=d;continue}const b=new Date(d.submitted_at||0).getTime(),L=new Date(t.submitted_at||0).getTime();b>L&&(t=d)}return((c=t==null?void 0:t.marks)==null?void 0:c[e])??""}function vt(e,t){k.value[e]=t===""?"":Number(t)}function ye(e,t){const l=Number(k.value[e]??0);l<0&&(k.value[e]=0),l>Number(t)&&(k.value[e]=Number(t))}function mt(e,t,l){l==="zero"?k.value[e]=0:l==="quarter"?k.value[e]=Number(t)/4:l==="half"?k.value[e]=Number(t)/2:l==="threeQuarter"?k.value[e]=Number((Number(t)*.75).toFixed(1)):l==="full"&&(k.value[e]=Number(t)),ye(e,t)}function rs(e,t){e.items.forEach(l=>mt(l.id,l.max,t))}const qe=p(()=>{let e=0,t=0;const l=J.value;l&&Array.isArray(l.items)&&l.items.forEach(c=>{e+=Number(c.max||0);const v=Number(k.value[c.id]||0);t+=Math.min(Math.max(v,0),Number(c.max||0))});const a=e>0?t/e*100:0;return{max:Number(e.toFixed(2)),got:Number(t.toFixed(2)),percent:Number(a.toFixed(2))}}),is=p(()=>!!G.value&&typeof G.value=="object"),us=p(()=>{var e;return((e=G.value)==null?void 0:e.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),ds=p(()=>{var e;return((e=G.value)==null?void 0:e.year)??null}),cs=p(()=>{var e;return((e=H.value)==null?void 0:e.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),vs=p(()=>{var e;return((e=H.value)==null?void 0:e.year)??null}),U=w("target"),xt=[{key:"target",label:"Annual Target"},{key:"performance",label:"Annual Performance"}],pt=p(()=>{var e;return((e=G.value)==null?void 0:e.months_total_form)??0}),ms=p(()=>{var e;return((e=H.value)==null?void 0:e.months_total_form)??pt.value}),F=p(()=>U.value==="target"?us.value:cs.value),bt=p(()=>{var e,t;return Number(((t=(e=F.value)==null?void 0:e.per_form_yearly)==null?void 0:t.final)||0)}),ft=p(()=>{var e,t;return Number(((t=(e=F.value)==null?void 0:e.per_scored_month)==null?void 0:t.max)||0)}),xs=p(()=>ft.value?Math.round(bt.value/ft.value*100):0),yt=p(()=>q.value&&!O.value),Ue=p(()=>U.value==="target"?ds.value:vs.value),gt=p(()=>U.value==="target"?pt.value:ms.value),ht=p(()=>{var e;return((e=xt.find(t=>t.key===U.value))==null?void 0:e.label)||"Annual Target"});be(U,()=>{re.value=!1});const _t=e=>String(e||"").toLowerCase(),kt=(e,t)=>e?t==="target"?e.id==="monthly_target"?!0:_t(e.label).includes("monthly target"):t==="performance"?e.id==="execution"?!0:_t(e.label).includes("execution")||String(e.label||"").includes("কার্যসম্পাদন"):!1:!1,ps=e=>Q.value.find(t=>kt(t,e))||null,wt=(e,{overwrite:t}={overwrite:!1})=>{if(!yt.value)return;const l=ps(e);if(!l||!Array.isArray(l.items)||l.items.length===0)return;const a=l.items,c=a.every(b=>Number(k.value[b.id]||0)===0);if(!t&&!c)return;const v=bt.value,d=a.reduce((b,L)=>b+Number(L.max||0),0);if(d){if(a.length===1){const b=a[0];k.value[b.id]=Math.min(v,Number(b.max||0)),ye(b.id,b.max);return}a.forEach(b=>{const L=Number(b.max||0)/d*v,N=Number(L.toFixed(1));k.value[b.id]=N,ye(b.id,b.max)})}},bs=p(()=>`Auto: ${U.value==="target"?"Annual Target":"Annual Performance"} (${xs.value}%)`);be(U,e=>{wt(e,{overwrite:!1})},{immediate:!0});const Me=p(()=>{const e=O.value?Ne.value:it.value,t=[],l=ut.value||q.value?1/0:ls.value??null,a=c=>{if(!c)return[];const v=[];if(Array.isArray(c))v.push(...c);else if(typeof c=="string"&&c.trim())v.push(c.trim());else return[];const d=new Set;return v.reduce((b,L)=>{const N=typeof L=="string"?L.trim():"";return!N||d.has(N)||(d.add(N),b.push(N)),b},[])};return e.forEach(c=>{const v=c.key;if(!v||l!=null&&(c.rank??999)>l)return;const d=ve(v);if(!d)return;const b=a(d.strengths),L=a(d.gaps),N=a(d.suggestions);!b.length&&!L.length&&!N.length||t.push({key:v,lane:v,label:c.label||(d==null?void 0:d.lane_label)||v,reviewer_id:d.reviewer_id,reviewer_name:d.reviewer_name,strengths:b,gaps:L,suggestions:N,submitted_at:d.submitted_at??null})}),t}),fs=e=>{const t=new Set;return Me.value.forEach(l=>{(Array.isArray(l[e])?l[e]:[]).forEach(c=>{const v=typeof c=="string"?c.trim():"";v&&t.add(v)})}),Array.from(t)},$t=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(l=>{const a=typeof l=="string"?l.trim():"";a&&t.add(a)}),Array.from(t)},Ee=p(()=>$t(S.strengths)),Ie=p(()=>$t(S.gaps)),Pe=p(()=>fs("suggestions"));w([]),w([]),w([]);const Ye=w(!1),P=w(null);function ys(e){P.value=e,Ye.value=!0}function We(){Ye.value=!1,P.value=null}const Ft={strengths:W,gaps:se,suggestions:le};function gs(e,t){const l=(t||"").trim();return l?e!=null&&e.trim()?`${e.trim()}
${l}`:l:e}function Te(e,t){const l=Ft[e];if(!l)return!1;const a=(l.value||"").split(`
`).map(v=>v.trim()).filter(Boolean),c=(t||"").trim();return c?a.includes(c):!1}function Je(e,t){const l=Ft[e];if(!l)return;const a=typeof t=="string"?t.trim():"";a&&(Te(e,a)||(l.value=gs(l.value,a)))}const me=w(!1);let ge=null;const hs=()=>{me.value=!me.value,ge&&(clearTimeout(ge),ge=null),me.value&&(ge=setTimeout(()=>{me.value=!1,ge=null},Lo))},_s=p(()=>{const e={};let t=1;const l=J.value;return l&&Array.isArray(l.items)&&l.items.forEach(a=>{e[a.id]=t++}),e});function je(e){return(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(l=>l.id).filter(l=>l!=null)}function Lt(e){const t={};return(Array.isArray(e)?e:[]).forEach(l=>{var a;t[l]=Number(((a=k.value)==null?void 0:a[l])??0)}),t}function St(e){return Lt(je(e))}function Nt(e){const t=[];(Array.isArray(e)?e:[]).forEach(a=>{t.push(...je(a))});const l=Array.from(new Set(t));return Lt(l)}function Xe(e){return Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():"").filter(Boolean).join(`
`):typeof e=="string"?e.trim():""}const ks=p(()=>!X.value||!J.value?!1:Object.keys(St(J.value)).length>0),ws=p(()=>!q.value||!V.value||!Array.isArray(Q.value)||Q.value.length===0?!1:Object.keys(Nt(Q.value)).length>0);function At(e,t){if(!e||!(t!=null&&t.length))return!1;const l=ve(e),a=l==null?void 0:l.marks;if(!a)return!1;let c=!1;return t.forEach(v=>{const d=a==null?void 0:a[v];d!==""&&d!=null&&(k.value[v]=Number(d),c=!0)}),c}const Re=e=>{if(typeof e!="string")return e;const t=e.trim();if(!t)return e;try{return JSON.parse(t)}catch{return e}};function $s(e,t=0){const l=(e==null?void 0:e.key)??(e==null?void 0:e.lane_key)??(e==null?void 0:e.laneKey)??(e==null?void 0:e.lane)??"",a=(e==null?void 0:e.label)??(e==null?void 0:e.lane_label)??(e==null?void 0:e.title)??l,c=(e==null?void 0:e.rank)??(e==null?void 0:e.order)??(e==null?void 0:e.priority)??999,v=(e==null?void 0:e.assigned_user_id)??(e==null?void 0:e.assignee_id)??(e==null?void 0:e.reviewer_id)??null,d=(e==null?void 0:e.assigned_user_name)??(e==null?void 0:e.assignee_name)??(e==null?void 0:e.reviewer_name)??"",b=(e==null?void 0:e.can_current_user_review)??(e==null?void 0:e.can_review)??!1,L=(e==null?void 0:e.can_view_marks)??!0;return{...e,key:String(l),label:String(a),rank:Number(c??999),assigned_user_id:v==null?null:Number(v),assigned_user_name:String(d||""),can_current_user_review:!!b,can_view_marks:!!L,_idx:t}}function Fs(e){const t={},l=e&&typeof e=="object"?e:{};return Object.keys(l).forEach(a=>{const c=l[a],v=Array.isArray(c)?c:c?[c]:[];t[a]=v.map(d=>{const b=Re((d==null?void 0:d.marks)??(d==null?void 0:d.marks_json)??{});return{...d,marks:b&&typeof b=="object"?b:{},strengths:Re(d==null?void 0:d.strengths),gaps:Re(d==null?void 0:d.gaps),suggestions:Re(d==null?void 0:d.suggestions)}})}),t}const Ze=p(()=>Number(te.params.employeeId)),Ct=e=>{var L;I.value=e.employee||{},G.value=(e==null?void 0:e.annual_target_avg_marks)||null,H.value=(e==null?void 0:e.annual_performance_avg_marks)||null,at.value=Array.isArray(e==null?void 0:e.lanes)?e.lanes.map($s):[],nt.value=Fs((e==null?void 0:e.reviews_by_lane)||{}),Ke.value=!!(((L=e==null?void 0:e.meta)==null?void 0:L.is_hr)??(e==null?void 0:e.hr)??!1),k.value={},(Array.isArray(Se.value)?Se.value:[]).forEach(N=>{(Array.isArray(N==null?void 0:N.items)?N.items:[]).forEach(ee=>{k.value[ee.id]=0})});const l=je(J.value),a=X.value,c=V.value;!At(a,l)&&c&&At(c,l),q.value&&Q.value.length&&Q.value.forEach(N=>{je(N).forEach(ee=>{let Y=c?dt(c,ee):"";(Y===""||Y==null)&&(Y=ct(ee)),Y!==""&&Y!=null&&(k.value[ee]=Number(Y))})});const d=Ce.value||a||c||null,b=d?ve(d):null;W.value=Xe(b==null?void 0:b.strengths),se.value=Xe(b==null?void 0:b.gaps),le.value=Xe(b==null?void 0:b.suggestions)},Ls=async e=>{var t,l;if(e){T.value=!0,z.value="";try{await S.fetchActiveCycle(e);const a=await S.fetchLanes(S.cycle.id,e);Ct(a)}catch(a){z.value=((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to load KPI review data."}finally{T.value=!1}}},Mt=async()=>{var e,t,l;if(!(!Ze.value||!((e=S.cycle)!=null&&e.id))){T.value=!0,z.value="";try{const a=await S.fetchLanes(S.cycle.id,Ze.value);Ct(a)}catch(a){z.value=((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to refresh KPI review data."}finally{T.value=!1}}};be(Ze,async(e,t)=>{!e||t&&e===t||await Ls(e)},{immediate:!0});async function Ss(){var a,c,v;const e=Number(te.params.employeeId),t=(a=S.cycle)==null?void 0:a.id,l=X.value;if(!t||!e)return alert("Invalid cycle/employee.");if(!l||!J.value)return alert("Unable to determine personal reviewer lane.");try{await S.submitReview({cycle_id:t,employee_id:e,reviewer_lane:l,marks:St(J.value),strengths:W.value,gaps:se.value,suggestions:le.value}),await Mt(),alert("Personal review submitted")}catch(d){const b=((v=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:v.message)||(d==null?void 0:d.message)||"Failed to submit personal review.";alert(b)}}async function Ns(){var a,c,v;const e=Number(te.params.employeeId),t=(a=S.cycle)==null?void 0:a.id,l=V.value;if(!t||!e)return alert("Invalid cycle/employee.");if(!l)return alert("Unable to determine HR reviewer lane.");try{await S.submitReview({cycle_id:t,employee_id:e,reviewer_lane:l,marks:Nt(Q.value),strengths:W.value,gaps:se.value,suggestions:le.value}),await Mt(),alert("HR review submitted")}catch(d){const b=((v=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:v.message)||(d==null?void 0:d.message)||"Failed to submit HR review.";alert(b)}}function Z(e){const t=Number(e??0);return isNaN(t)?"0.00":t.toFixed(2)}function xe(e,t){const l=Number(e??0),a=Number(t??0);return a>0?Math.round(l/a*100):0}return(e,t)=>{var l,a,c,v,d,b,L,N,R,ee,Y,pe,Ge,he,_e,Et,It,Pt,Tt,jt,Rt,Gt,Ht,zt,Bt,Dt,Kt,Ot,Qt,Vt;return ce.value?(o(),r("div",Tl,[s("div",jl,[s("div",null,[s("div",Rl,i(Le.value),1),s("div",Gl," Year "+i(B.value)+" / Group "+i(Fe.value),1)]),u.value?(o(),r("div",Hl," Lane: "+i(st(u.value)),1)):h("",!0)]),s("div",zl,[(o(!0),r(C,null,M(f.value,m=>(o(),r("button",{key:m,type:"button",class:de(["rounded-full border px-3 py-1 text-xs font-semibold transition",m===u.value?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-600 border-slate-200 hover:border-slate-300"]),onClick:A=>u.value=m},i(st(m)),11,Bl))),128))]),g.value?(o(),r("div",Dl," Loading KPI items... ")):K.value?(o(),r("div",Kl,i(K.value),1)):(o(),r("div",Ol,[n.value.length?(o(),r("div",Vl,[(o(!0),r(C,null,M(n.value,m=>(o(),r("div",{key:m.id,class:"rounded-xl border border-slate-200 bg-white p-3"},[s("div",ql,[s("div",Ul,[s("div",{class:"text-sm font-semibold text-slate-900 truncate",title:m.title},i(m.title),9,Yl),s("div",Wl,[m.weight!=null?(o(),r("span",Jl,"Weight: "+i(m.weight),1)):h("",!0),m.maxScore!=null?(o(),r("span",Xl," / Max: "+i(m.maxScore),1)):h("",!0)])]),s("div",Zl,[fe(s("select",{"onUpdate:modelValue":A=>y.value[m.id]=A,class:"rounded-lg border border-slate-300 bg-white px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50"},[(o(!0),r(C,null,M(Jt(m.maxScore),A=>(o(),r("option",{key:A,value:A},i(A),9,ta))),128))],8,ea),[[Ms,y.value[m.id],void 0,{number:!0}]])])]),s("div",sa,[t[7]||(t[7]=s("label",{class:"block text-[11px] font-medium text-slate-500"},"Comment (optional)",-1)),fe(s("textarea",{"onUpdate:modelValue":A=>_.value[m.id]=A,rows:"2",class:"mt-1 w-full rounded-lg border border-slate-200 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/40",placeholder:"Add a note if needed"},null,8,la),[[He,_.value[m.id]]])])]))),128))])):(o(),r("div",Ql," No KPI items found for this lane. "))])),s("div",aa,[s("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50 disabled:opacity-50",disabled:D.value||g.value||!n.value.length,onClick:t[0]||(t[0]=m=>lt(!1))},i(D.value?"Saving...":"Save Draft"),9,na),s("button",{type:"button",class:"rounded-lg bg-emerald-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-emerald-700 disabled:opacity-50",disabled:D.value||g.value||!n.value.length,onClick:t[1]||(t[1]=m=>lt(!0))},i(D.value?"Saving...":"Submit"),9,oa)])])):(o(),r("div",ra,[z.value?(o(),r("div",ia,i(z.value),1)):h("",!0),T.value?(o(),r("div",ua," Loading KPI review... ")):(o(),r(C,{key:2},[s("header",da,[s("div",ca,[s("div",va,[s("div",ma,[t[8]||(t[8]=s("span",{class:"text-xs font-semibold text-indigo-700"},"KPI Cycle",-1)),s("span",xa,i((l=ne(S).cycle)==null?void 0:l.title),1)]),s("div",pa,[s("div",ba,i(((a=I.value)==null?void 0:a.name)||"Employee"),1),s("div",fa,[(v=(c=I.value)==null?void 0:c.designation)!=null&&v.title?(o(),r("span",ya,[t[9]||(t[9]=ue(" Designation: ")),s("span",ga,i(I.value.designation.title),1)])):h("",!0),(b=(d=I.value)==null?void 0:d.department)!=null&&b.name?(o(),r("span",ha,[t[10]||(t[10]=ue(" Department: ")),s("span",_a,i(I.value.department.name),1)])):h("",!0),s("span",ka,[t[14]||(t[14]=ue(" Reviewing as: ")),os.value?(o(),r("span",wa,[s("span",$a,i(X.value),1),t[11]||(t[11]=s("span",{class:"text-slate-400"},"+",-1)),s("span",Fa,i(V.value),1),t[12]||(t[12]=s("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," dual mode ",-1))])):ut.value?(o(),r("span",La,t[13]||(t[13]=[s("span",{class:"font-semibold text-emerald-700"},"HR",-1),s("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," HR mode ",-1)]))):(o(),r("span",Sa,i(Ce.value||"No lane"),1))])])])]),s("div",Na,[s("div",Aa,[t[15]||(t[15]=s("div",{class:"text-[11px] uppercase tracking-wide text-slate-500"}," Personal group total ",-1)),s("div",Ca,[ue(i(qe.value.got.toFixed(2))+" ",1),s("span",Ma,"/ "+i(qe.value.max.toFixed(2)),1)]),s("div",Ea,i(qe.value.percent.toFixed(2))+"% achieved ",1)]),Ke.value?(o(),r("button",{key:0,onClick:t[2]||(t[2]=m=>ne(S).submitFinalResult(ne(S).cycle.id,ne(te).params.employeeId)),class:"inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-medium text-white shadow hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-300 focus:outline-none"},t[16]||(t[16]=[s("span",null,"Finalize & Lock",-1)]))):h("",!0)])])]),(L=I.value)!=null&&L.active_criteria?(o(),r("div",Ia,[s("section",Pa,[s("button",{type:"button",class:"w-full flex items-center justify-between border-b bg-slate-50 px-4 py-2 text-left",onClick:hs},[t[17]||(t[17]=s("div",{class:"text-sm font-semibold text-slate-800"},"কার্যসম্পাদন বিষয়",-1)),s("div",Ta,i(me.value?"Hide":"Show"),1)]),fe(s("div",null,[((R=(N=I.value)==null?void 0:N.active_criteria)==null?void 0:R.length)===0?(o(),r("div",ja," -- ")):h("",!0),(o(!0),r(C,null,M(I.value.active_criteria,m=>(o(),r("div",{class:"p-4 text-sm text-slate-700",key:m.id},[s("div",{class:"print:block richtext print:break-inside-avoid",innerHTML:m==null?void 0:m.description},null,8,Ra)]))),128))],512),[[Is,me.value]])])])):h("",!0),ne(S).cycle&&J.value?(o(),tt(Yt,{key:1,group:J.value,"is-personal":!0,lanes:Qe.value,"editable-lane-key":X.value,"can-edit":Ae.value,marks:k.value,"header-label":"Personal Evaluation","item-label":((ee=J.value)==null?void 0:ee.label)||"Personal",mode:O.value,"helper-text":O.value?"All reviewer lanes score the Personal table.":Ae.value&&q.value?"Submit Personal and HR reviews separately using the buttons below.":"Fill only your lane; others appear as read-only.","serial-map":_s.value,"get-lane-mark":dt,"on-mark-change":vt,"on-cap":ye,"on-quick-fill-item":mt},null,8,["group","lanes","editable-lane-key","can-edit","marks","item-label","mode","helper-text","serial-map"])):h("",!0),s("section",Ga,[s("div",Ha,[Q.value.length?(o(),r("div",za,[(o(!0),r(C,null,M(Q.value,(m,A)=>(o(),tt(Yt,{key:A,group:m,"is-personal":!1,"can-edit":q.value,marks:k.value,"header-label":`Group ${A+1} - ${es(m,A)}`,"item-label":"Item","show-quick-fill-group":!0,"auto-fill-visible":yt.value&&kt(m,U.value),"auto-fill-label":bs.value,"on-auto-fill":()=>wt(U.value,{overwrite:!0}),"get-hr-mark":ct,"on-mark-change":vt,"on-cap":ye,"on-quick-fill-group":rs},null,8,["group","can-edit","marks","header-label","auto-fill-visible","auto-fill-label","on-auto-fill"]))),128))])):h("",!0),s("aside",{class:de(["space-y-4 sticky top-10 z-50",[Q.value.length===0?"lg:col-span-full":"lg:col-span-2"]])},[!O.value&&is.value&&q.value?(o(),r("section",Ba,[s("header",Da,[t[18]||(t[18]=s("span",null,"Annual Summary",-1)),s("div",Ka,[s("span",Oa,i(ht.value),1),Ue.value?(o(),r("span",Qa," Year "+i(Ue.value),1)):h("",!0),s("span",Va,i(gt.value)+" month(s) ",1)])]),s("div",qa,[s("div",Ua,[(o(),r(C,null,M(xt,m=>s("button",{key:m.key,type:"button",onClick:A=>U.value=m.key,class:de(["px-3 py-1 rounded-full text-xs font-semibold transition",U.value===m.key?"bg-slate-900 text-white shadow":"border border-slate-200 text-slate-700 bg-white hover:border-slate-400"])},i(m.label),11,Ya)),64))]),s("div",Wa,[s("div",Ja,[s("div",Xa,[s("div",Za,[t[19]||(t[19]=s("span",{class:"text-xs font-medium text-slate-600"},"Incharge",-1)),s("span",en,i(xe((Y=F.value.per_scored_month)==null?void 0:Y.incharge,(pe=F.value.per_scored_month)==null?void 0:pe.max))+"% ",1)]),s("div",tn,[ue(i(Z((Ge=F.value.per_scored_month)==null?void 0:Ge.incharge))+" ",1),s("span",sn,"/ "+i(Z((he=F.value.per_scored_month)==null?void 0:he.max)),1)]),s("div",ln,[s("div",{class:"h-2 bg-blue-500",style:j({width:xe((_e=F.value.per_scored_month)==null?void 0:_e.incharge,(Et=F.value.per_scored_month)==null?void 0:Et.max)+"%"})},null,4)])]),s("div",an,[s("div",nn,[t[20]||(t[20]=s("span",{class:"text-xs font-medium text-slate-600"},"Coordinator",-1)),s("span",on,i(xe((It=F.value.per_scored_month)==null?void 0:It.coordinator,(Pt=F.value.per_scored_month)==null?void 0:Pt.max))+"% ",1)]),s("div",rn,[ue(i(Z((Tt=F.value.per_scored_month)==null?void 0:Tt.coordinator))+" ",1),s("span",un,"/ "+i(Z((jt=F.value.per_scored_month)==null?void 0:jt.max)),1)]),s("div",dn,[s("div",{class:"h-2 bg-violet-500",style:j({width:xe((Rt=F.value.per_scored_month)==null?void 0:Rt.coordinator,(Gt=F.value.per_scored_month)==null?void 0:Gt.max)+"%"})},null,4)])]),s("div",cn,[s("div",vn,[t[21]||(t[21]=s("span",{class:"text-xs font-medium text-slate-600"},"Final",-1)),s("span",mn,i(xe((Ht=F.value.per_form_yearly)==null?void 0:Ht.final,(zt=F.value.per_scored_month)==null?void 0:zt.max))+"% ",1)]),s("div",xn,[ue(i(Z((Bt=F.value.per_form_yearly)==null?void 0:Bt.final))+" ",1),s("span",pn,"/ "+i(Z((Dt=F.value.per_scored_month)==null?void 0:Dt.max)),1)]),s("div",bn,[s("div",{class:"h-2 bg-emerald-500",style:j({width:xe((Kt=F.value.per_form_yearly)==null?void 0:Kt.final,(Ot=F.value.per_scored_month)==null?void 0:Ot.max)+"%"})},null,4)])])]),s("div",fn,[s("button",{class:"text-xs px-3 py-1.5 rounded-md border hover:bg-slate-50",onClick:t[3]||(t[3]=m=>re.value=!re.value)},i(re.value?"Hide details":"Show "+ht.value+" details"),1),re.value?(o(),r("div",yn,[s("div",gn,[t[22]||(t[22]=s("div",{class:"text-slate-500"},"Year",-1)),s("div",hn,i(Ue.value||"-"),1),t[23]||(t[23]=s("div",{class:"text-slate-500"},"Months counted",-1)),s("div",_n,i(gt.value),1),t[24]||(t[24]=s("div",{class:"text-slate-500"},"Max",-1)),s("div",kn,i(Z((Qt=F.value.per_scored_month)==null?void 0:Qt.max)),1),t[25]||(t[25]=s("div",{class:"text-slate-500"},"Final avg",-1)),s("div",wn,i(Z((Vt=F.value.per_form_yearly)==null?void 0:Vt.final)),1),t[26]||(t[26]=s("div",{class:"text-slate-500"},"Percent (simple)",-1)),s("div",$n,i(Z(F.value.percent_simple))+"%",1),t[27]||(t[27]=s("div",{class:"text-slate-500"},"Percent (weighted)",-1)),s("div",Fn,i(Z(F.value.percent_weighted))+"%",1)])])):h("",!0)])])])])):h("",!0),Me.value.length?(o(),r("section",Ln,[s("header",Sn,[t[28]||(t[28]=s("span",null,"Review Comments",-1)),s("span",Nn,i(Me.value.length)+" lane(s) ",1)]),s("div",An,[s("div",Cn,[s("table",Mn,[t[30]||(t[30]=s("thead",{class:"text-[11px] text-slate-600 uppercase tracking-wide bg-slate-50"},[s("tr",null,[s("th",{class:"px-2 py-2 w-[140px]"},"Lane"),s("th",{class:"px-2 py-2 text-right"},"Details")])],-1)),s("tbody",null,[(o(!0),r(C,null,M(Me.value,m=>(o(),r("tr",{key:m.key,class:"border-t hover:bg-slate-50/60 align-top"},[s("td",En,[s("div",In,i(m.label),1),m.submitted_at?(o(),r("div",Pn,i(new Date(m.submitted_at).toLocaleDateString()),1)):h("",!0)]),s("td",Tn,[s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:A=>ys(m)},t[29]||(t[29]=[s("span",null,"View comments",-1),s("span",{class:"text-[10px] text-slate-400"},"Strengths · Gaps · Suggestions",-1)]),8,jn)])]))),128))])])])])])):h("",!0)],2)])]),Ae.value||q.value?(o(),r("section",Rn,[t[37]||(t[37]=s("header",{class:"flex items-center justify-between mb-1"},[s("div",null,[s("h2",{class:"text-sm font-semibold text-slate-800"},"Overall Review Notes"),s("p",{class:"text-[11px] text-slate-500"},"Use saved hints or write your own detailed comments.")])],-1)),s("div",Gn,[s("div",Hn,[s("header",zn,[t[31]||(t[31]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-emerald-500 text-base leading-none"},"★"),s("span",null,"Strengths")],-1)),Ee.value.length?(o(),r("span",Bn,i(Ee.value.length)+" saved hint(s) ",1)):h("",!0)]),Ee.value.length?(o(),r("div",Dn,[s("div",Kn,[(o(!0),r(C,null,M(Ee.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("strengths",m),disabled:Te("strengths",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,On))),128))])])):h("",!0),s("div",Qn,[t[32]||(t[32]=s("label",{class:"text-[11px] font-medium text-slate-500"}," Key Strength(s) ",-1)),fe(s("textarea",{"onUpdate:modelValue":t[4]||(t[4]=m=>W.value=m),placeholder:"e.g. Strong ownership, proactive problem solving…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[He,W.value]])])]),s("div",Vn,[s("header",qn,[t[33]||(t[33]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-amber-500 text-base leading-none"},"!"),s("span",null,"Gaps")],-1)),Ie.value.length?(o(),r("span",Un,i(Ie.value.length)+" saved hint(s) ",1)):h("",!0)]),Ie.value.length?(o(),r("div",Yn,[s("div",Wn,[(o(!0),r(C,null,M(Ie.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("gaps",m),disabled:Te("gaps",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-amber-300 hover:bg-amber-50 hover:text-amber-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,Jn))),128))])])):h("",!0),s("div",Xn,[t[34]||(t[34]=s("label",{class:"text-[11px] font-medium text-slate-500"},"GAP(s)",-1)),fe(s("textarea",{"onUpdate:modelValue":t[5]||(t[5]=m=>se.value=m),placeholder:"e.g. Needs improvement in documentation, communication…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-amber-200"},null,512),[[He,se.value]])])]),s("div",Zn,[s("header",eo,[t[35]||(t[35]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-sky-500 text-base leading-none"},"✱"),s("span",null,"Suggestions / Training")],-1)),Pe.value.length?(o(),r("span",to,i(Pe.value.length)+" common suggestion(s) ",1)):h("",!0)]),Pe.value.length?(o(),r("div",so,[s("div",lo,[(o(!0),r(C,null,M(Pe.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("suggestions",m),disabled:Te("suggestions",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-sky-300 hover:bg-sky-50 hover:text-sky-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,ao))),128))])])):h("",!0),s("div",no,[t[36]||(t[36]=s("label",{class:"text-[11px] font-medium text-slate-500"}," Suggestions / Development plan ",-1)),fe(s("textarea",{"onUpdate:modelValue":t[6]||(t[6]=m=>le.value=m),placeholder:"Specific actions, training plans, timeline and expectations…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-sky-200"},null,512),[[He,le.value]])])])])])):h("",!0),s("div",oo,[t[38]||(t[38]=s("div",{class:"text-sm text-slate-600"},null,-1)),s("div",ro,[Ae.value?(o(),r("button",{key:0,onClick:Ss,disabled:!ks.value,class:"inline-flex items-center justify-center rounded-xl bg-slate-900 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-slate-800 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-slate-300"},i(O.value?"Submit & Review":"Submit Personal"),9,io)):h("",!0),q.value&&!O.value?(o(),r("button",{key:1,onClick:Ns,disabled:!ws.value,class:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-emerald-700 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-emerald-300"}," Submit HR Review ",8,uo)):h("",!0)])]),Es(js,{name:"fade-scale"},{default:Ps(()=>{var m,A,qt;return[Ye.value&&P.value?(o(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:Ts(We,["escape","window"])},[s("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:We}),s("div",co,[s("div",vo,[s("div",null,[s("p",mo,i(P.value.label),1),s("p",xo," Lane: "+i(P.value.lane)+" - Reviewed by "+i(P.value.reviewer_name||"––"),1),P.value.submitted_at?(o(),r("p",po,i(new Date(P.value.submitted_at).toLocaleString()),1)):h("",!0)]),s("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:We}," Close ")]),s("div",bo,[s("div",null,[t[39]||(t[39]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Strengths",-1)),s("div",fo,[(m=P.value.strengths)!=null&&m.length?(o(),r("div",yo,[(o(!0),r(C,null,M(P.value.strengths,(ke,we)=>(o(),r("p",{key:"modal-strength-"+we},"- "+i(ke),1))),128))])):(o(),r("p",go,"No strengths entered."))])]),s("div",null,[t[40]||(t[40]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Gaps",-1)),s("div",ho,[(A=P.value.gaps)!=null&&A.length?(o(),r("div",_o,[(o(!0),r(C,null,M(P.value.gaps,(ke,we)=>(o(),r("p",{key:"modal-gap-"+we},"- "+i(ke),1))),128))])):(o(),r("p",ko,"No gaps recorded."))])]),s("div",null,[t[41]||(t[41]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Suggestions",-1)),s("div",wo,[(qt=P.value.suggestions)!=null&&qt.length?(o(),r("div",$o,[(o(!0),r(C,null,M(P.value.suggestions,(ke,we)=>(o(),r("p",{key:"modal-sug-"+we},"- "+i(ke),1))),128))])):(o(),r("p",Fo,"No suggestions provided."))])])])])],32)):h("",!0)]}),_:1})],64))]))}}},Co={__name:"KpiReviewPage",setup(x){return($,te)=>(o(),tt(So))}};export{Co as default};
