import{Q as de,u as ue,D as pe,G as X,r as V,x as c,h as ce,q as h,p as me,c as n,o as i,a as e,b as _,d as w,l as T,s as m,t as a,j as x,F as B,e as P,k as U,v as L,w as ve}from"./index-C1-8eKjz.js";import{_ as R}from"./MultiselectDropdown-GzvSMpj2.js";import{_ as be}from"./TextEditor-CLIYwTzv.js";import{u as xe}from"./company-DY9WDFBn.js";import{u as ye}from"./department-DqZIKgOZ.js";import{u as ge}from"./notice-mLcSXS1N.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-aG0ke5J4.js";const fe={class:"mx-auto max-w-6xl px-3 md:px-6 py-4"},he={class:"flex items-center justify-between mb-5"},_e={class:"hidden md:flex gap-2"},we=["disabled"],ke={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},Ce={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},De={class:"flex items-center justify-between"},je={class:"flex items-center gap-3"},Se={class:"font-semibold"},Ve={key:0,class:"text-[11px] text-gray-500 hidden md:block"},Ae={key:0},Ne={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},Ee={class:"flex items-center justify-between"},$e={class:"flex items-center gap-3"},ze={class:"font-semibold"},Be={key:0,class:"text-[11px] text-gray-500 hidden md:block"},Pe={key:0},Fe={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},Me={class:"flex items-center justify-between"},Te={class:"flex items-center gap-3"},Ue={class:"font-semibold"},Le={key:0,class:"text-[11px] text-gray-500 hidden md:block"},Re={key:0},qe={class:"rounded-2xl border bg-white/70 p-5 shadow-sm"},Oe={class:"flex items-center justify-between"},Ge={class:"inline-flex rounded-xl border overflow-hidden"},He={class:"md:col-span-3 rounded-2xl border bg-white/70 p-5 shadow-sm"},Je={class:"flex flex-wrap gap-2"},Ie=["onClick"],Qe={key:0,class:"text-red-500 text-xs mt-1"},Xe={class:"rounded-2xl border bg-white/70 p-5 shadow-sm space-y-6"},Ke={class:"grid md:grid-cols-3 gap-6"},We={class:"md:col-span-3 flex justify-between gap-4"},Ye={class:"w-full"},Ze={key:0,class:"text-red-500 text-xs mt-1"},et={class:"w-full"},tt={key:0,class:"text-red-500 text-xs mt-1"},st={class:"space-y-2 md:col-span-3"},lt={class:"space-y-2"},ot={class:"flex items-center justify-between"},at={class:"inline-flex rounded-lg border overflow-hidden"},nt={class:"space-y-2"},it={class:"flex items-center justify-between"},rt={class:"inline-flex rounded-lg border overflow-hidden"},dt={class:"space-y-2 md:col-span-3"},ut={class:"flex items-center justify-between"},pt={class:"inline-flex items-center gap-3"},ct={class:"text-xs text-gray-500"},mt={class:"inline-flex rounded-lg border overflow-hidden"},vt={class:"rounded-2xl border bg-white/70 p-5 shadow-sm space-y-6"},bt={key:0,class:"text-red-500 text-xs mt-1"},xt={class:"grid md:grid-cols-2 gap-4 items-start"},yt={class:"space-y-2"},gt={class:"flex items-center justify-between gap-3"},ft={class:"inline-flex items-center"},ht={key:0,class:"mt-3 flex items-center justify-between bg-white rounded-lg border p-2.5"},_t={class:"text-sm truncate"},wt={class:"font-medium"},kt={class:"sticky bottom-0 z-10 bg-white/90 backdrop-blur flex justify-end gap-2 p-3 rounded-2xl border shadow-sm md:hidden"},Ct=["disabled"],Dt={class:"hidden md:flex items-center justify-end gap-2"},jt=["disabled"],Pt={__name:"NoticeAdd",setup(St){const j=de(),K=ue(),q=ge(),O=xe(),v=ye(),{companies:W}=pe(O),s=X({title:"",type:1,description:"",published_at:"",expired_at:"",all_companies:!1,all_departments:!1,all_employees:!1,file:null,receiver_type:"executive"}),Y=[{value:"doctor",label:"Doctor"},{value:"executive",label:"Executive"},{value:"support_staff",label:"Support Staff"},{value:"academic_body",label:"Academic Body"}],y=V([]),b=V([]),r=V([]),A=c(()=>W.value||[]),k=c(()=>v.departments||[]),S=c(()=>v.employees||[]),F=c(()=>y.value.map(l=>l.id)),G=c(()=>b.value.map(l=>l.id)),Z=c(()=>r.value.map(l=>l.id)),C=V(!1),p=X({}),N=c({get:()=>s.all_companies?"all":"custom",set:l=>{s.all_companies=l==="all",y.value=s.all_companies?[...A.value]:[]}}),E=c({get:()=>s.all_departments?"all":"custom",set:l=>{s.all_departments=l==="all",b.value=s.all_departments?[...k.value]:[]}}),$=c({get:()=>s.all_employees?"all":"custom",set:l=>{s.all_employees=l==="all",r.value=s.all_employees?[...S.value]:[]}});ce(async()=>{await O.fetchCompanies()}),h(()=>s.all_companies,async l=>{l?await v.fetchDepartments():await v.fetchDepartments(F.value),v.employees=[],r.value=[]}),h(F,async l=>{s.all_companies||(await v.fetchDepartments(l),v.employees=[],r.value=[])});const ee=c(()=>s.all_departments?(k.value||[]).map(l=>l.id):G.value);h([ee,()=>s.receiver_type],async([l,t])=>{if(!t){v.employees=[],r.value=[];return}Array.isArray(l)&&l.length>0?(r.value=[],await v.fetchDepartmentEmployee(l,t),s.all_employees&&Array.isArray(v.employees)&&(r.value=[...v.employees])):(v.employees=[],r.value=[])},{immediate:!0}),h(k,l=>{s.all_departments&&(b.value=[...l])}),h(S,l=>{s.all_employees&&(r.value=[...l])}),h(y,l=>{s.all_companies=l.length===A.value.length&&l.length>0}),h(b,l=>{s.all_departments=l.length===k.value.length&&l.length>0}),h([r,S],([l,t])=>{const d=Array.isArray(t)?t.length:0;s.all_employees=d>0&&l.length===d});const z=V(!1),te=l=>{var d,u;const t=(u=(d=l==null?void 0:l.target)==null?void 0:d.files)==null?void 0:u[0];H(t)},se=l=>{var d,u;l.preventDefault(),z.value=!1;const t=(u=(d=l.dataTransfer)==null?void 0:d.files)==null?void 0:u[0];H(t)},le=l=>{l.preventDefault(),z.value=!0},oe=()=>{z.value=!1},H=l=>{if(!l){s.file=null;return}if(!["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type)){j.error("Unsupported file type. Allowed: jpg, jpeg, png, pdf, doc, docx."),s.file=null;return}if(l.size>2*1024*1024){j.error("File size must be ≤ 2MB."),s.file=null;return}s.file=l},ae=()=>{s.file=null},g=(l,t="name",d=3)=>{const u=Array.isArray(l)?l:[],o=u.slice(0,d).map(M=>(M==null?void 0:M[t])??"—"),f=Math.max(0,u.length-d);return{head:o,more:f}},J=c(()=>{if(s.type===2||!s.published_at||!s.expired_at)return!0;try{return new Date(s.expired_at)>=new Date(s.published_at)}catch{return!0}}),ne=()=>{var l;return Object.keys(p).forEach(t=>delete p[t]),(l=s.title)!=null&&l.trim()||(p.title="Title is required"),s.type!==2&&!s.published_at&&(p.published_at="Publish date is required"),J.value||(p.expired_at="Expired date must be on/after publish date"),s.receiver_type||(p.receiver_type="Receiver type is required"),Object.keys(p).length===0},D=c(()=>{var l;return!C.value&&!!((l=s.title)!=null&&l.trim())&&(s.type===2||!!s.published_at)&&J.value&&!!s.receiver_type}),I=async()=>{var t,d;if(!ne()){j.error("Please fix the errors and try again.");return}const l={title:s.title,type:s.type,description:s.description,published_at:s.type===2?null:s.published_at,expired_at:s.type===2?null:s.expired_at||null,all_companies:s.all_companies,all_departments:s.all_departments,all_employees:s.all_employees,company_ids:F.value,department_ids:G.value,employee_ids:Z.value,file:s.file,receiver_type:s.receiver_type};console.log(l);try{C.value=!0,await q.createNotice(l),j.success("Notice created successfully"),await q.fetchNotices(),K.replace("/hrd/notice")}catch(u){const o=((d=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to save notice";j.error(o),console.error(u)}finally{C.value=!1}},ie=c(()=>A.value.length),re=c(()=>k.value.length),Q=c(()=>S.value.length);return(l,t)=>{var u;const d=me("RouterLink");return i(),n("div",fe,[e("div",he,[t[16]||(t[16]=e("div",null,[e("h1",{class:"text-2xl md:text-3xl font-semibold tracking-tight"},"Add Notice"),e("p",{class:"text-sm text-gray-500"},[_("Fields marked "),e("span",{class:"text-red-500"},"*"),_(" are required.")])],-1)),e("div",_e,[w(d,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:T(()=>t[15]||(t[15]=[_(" Cancel ")])),_:1,__:[15]}),e("button",{disabled:!D.value,onClick:I,class:m(["px-4 py-2 rounded-xl text-white text-sm",D.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(C.value?"Saving…":"Save"),11,we)])]),e("div",ke,[e("div",Ce,[e("div",De,[e("div",je,[t[18]||(t[18]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-blue-100 to-blue-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-blue-600"},[e("path",{fill:"currentColor",d:"M3 10v10h18V10H3zm9-7l9 7H3l9-7z"})])],-1)),e("div",null,[t[17]||(t[17]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Companies",-1)),e("div",Se,a(s.all_companies?"All":y.value.length)+" / "+a(ie.value),1)])]),!s.all_companies&&y.value.length?(i(),n("div",Ve,[(i(!0),n(B,null,P(g(y.value,"name",3).head,(o,f)=>(i(),n("span",{key:"c"+f,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),g(y.value,"name",3).more?(i(),n("span",Ae,"+"+a(g(y.value,"name",3).more),1)):x("",!0)])):x("",!0)])]),e("div",Ne,[e("div",Ee,[e("div",$e,[t[20]||(t[20]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-purple-100 to-purple-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-purple-600"},[e("path",{fill:"currentColor",d:"M3 5h18v2H3V5zm3 4h12v10H6V9z"})])],-1)),e("div",null,[t[19]||(t[19]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Departments",-1)),e("div",ze,a(s.all_departments?"All":b.value.length)+" / "+a(re.value),1)])]),!s.all_departments&&b.value.length?(i(),n("div",Be,[(i(!0),n(B,null,P(g(b.value,"name",3).head,(o,f)=>(i(),n("span",{key:"d"+f,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),g(b.value,"name",3).more?(i(),n("span",Pe,"+"+a(g(b.value,"name",3).more),1)):x("",!0)])):x("",!0)])]),e("div",Fe,[e("div",Me,[e("div",Te,[t[22]||(t[22]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-emerald-100 to-emerald-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-emerald-600"},[e("path",{fill:"currentColor",d:"M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"})])],-1)),e("div",null,[t[21]||(t[21]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",Ue,a(s.all_employees?"All":r.value.length)+" / "+a(Q.value),1)])]),!s.all_employees&&r.value.length?(i(),n("div",Le,[(i(!0),n(B,null,P(g(r.value,"name",3).head,(o,f)=>(i(),n("span",{key:"e"+f,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),g(r.value,"name",3).more?(i(),n("span",Re,"+"+a(g(r.value,"name",3).more),1)):x("",!0)])):x("",!0)])])]),e("form",{onSubmit:ve(I,["prevent"]),class:"space-y-8"},[e("section",qe,[e("div",Oe,[t[23]||(t[23]=e("h3",{class:"text-base font-semibold"},"Notice Type",-1)),e("div",Ge,[e("button",{type:"button",class:m(["px-4 py-2 text-sm",s.type===1?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[0]||(t[0]=o=>s.type=1)}," General ",2),e("button",{type:"button",class:m(["px-4 py-2 text-sm border-l",s.type===2?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[1]||(t[1]=o=>s.type=2)}," Policy ",2)])]),t[24]||(t[24]=e("p",{class:"text-xs text-gray-500 mt-2"}," Policies usually don’t require publish/expire dates and remain visible until replaced. ",-1))]),e("div",He,[t[25]||(t[25]=e("label",{class:"block font-medium mb-1"},[_(" Send To "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Je,[(i(),n(B,null,P(Y,o=>e("button",{key:o.value,type:"button",class:m(["px-3 py-1.5 rounded-full border text-xs",s.receiver_type===o.value?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 hover:bg-gray-50"]),onClick:f=>s.receiver_type=o.value},a(o.label),11,Ie)),64))]),p.receiver_type?(i(),n("p",Qe,a(p.receiver_type),1)):x("",!0)]),e("section",Xe,[t[31]||(t[31]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-base font-semibold"},"Audience & Scope"),e("span",{class:"text-xs text-gray-500"},"Define who should see this notice")],-1)),e("div",Ke,[e("div",We,[e("div",Ye,[t[26]||(t[26]=e("label",{class:"font-medium"},[_("Publish Date "),e("span",{class:"text-red-500"},"*")],-1)),U(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.published_at=o),type:"date",class:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.published_at]]),p.published_at?(i(),n("p",Ze,a(p.published_at),1)):x("",!0)]),e("div",et,[t[27]||(t[27]=e("label",{class:"font-medium"},"Expire Date",-1)),U(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.expired_at=o),type:"date",class:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.expired_at]]),p.expired_at?(i(),n("p",tt,a(p.expired_at),1)):x("",!0)])]),e("div",st,[e("div",lt,[e("div",ot,[t[28]||(t[28]=e("label",{class:"font-medium"},"Companies",-1)),e("div",at,[e("button",{type:"button",class:m(["px-3 py-1.5 text-xs",N.value==="all"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[4]||(t[4]=o=>N.value="all")},"All",2),e("button",{type:"button",class:m(["px-3 py-1.5 text-xs border-l",N.value==="custom"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[5]||(t[5]=o=>N.value="custom")},"Custom",2)])]),w(R,{modelValue:y.value,"onUpdate:modelValue":t[6]||(t[6]=o=>y.value=o),options:A.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select companies"},null,8,["modelValue","options"])]),e("div",nt,[e("div",it,[t[29]||(t[29]=e("label",{class:"font-medium"},"Departments",-1)),e("div",rt,[e("button",{type:"button",class:m(["px-3 py-1.5 text-xs",E.value==="all"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[7]||(t[7]=o=>E.value="all")},"All",2),e("button",{type:"button",class:m(["px-3 py-1.5 text-xs border-l",E.value==="custom"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[8]||(t[8]=o=>E.value="custom")},"Custom",2)])]),w(R,{modelValue:b.value,"onUpdate:modelValue":t[9]||(t[9]=o=>b.value=o),options:k.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select departments"},null,8,["modelValue","options"])])]),e("div",dt,[e("div",ut,[t[30]||(t[30]=e("label",{class:"font-medium"},"Employees",-1)),e("div",pt,[e("span",ct,"Selected "+a(r.value.length)+" / "+a(Q.value),1),e("div",mt,[e("button",{type:"button",class:m(["px-3 py-1.5 text-xs",$.value==="all"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[10]||(t[10]=o=>$.value="all")},"All",2),e("button",{type:"button",class:m(["px-3 py-1.5 text-xs border-l",$.value==="custom"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[11]||(t[11]=o=>$.value="custom")},"Custom",2)])])]),w(R,{modelValue:r.value,"onUpdate:modelValue":t[12]||(t[12]=o=>r.value=o),options:S.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select employees"},null,8,["modelValue","options"])])])]),e("section",vt,[t[38]||(t[38]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-base font-semibold"},"Notice Content"),e("span",{class:"text-xs text-gray-500"},"Craft the headline & attach relevant docs")],-1)),e("div",null,[t[32]||(t[32]=e("label",{class:"block font-medium mb-1"},[_("Title "),e("span",{class:"text-red-500"},"*")],-1)),U(e("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>s.title=o),type:"text",class:"w-full p-2.5 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.title]]),p.title?(i(),n("p",bt,a(p.title),1)):x("",!0)]),e("div",xt,[e("div",yt,[t[36]||(t[36]=e("label",{class:"block font-medium"},"Attachment",-1)),e("div",{class:m(["rounded-xl border border-dashed p-5 transition relative",z.value?"bg-blue-50 border-blue-300":"hover:bg-gray-50"]),onDragover:le,onDragleave:oe,onDrop:se},[e("div",gt,[t[34]||(t[34]=e("div",{class:"text-sm text-gray-600"},[e("div",{class:"font-medium"},"Drag & drop or click to upload"),e("div",null,"JPG, JPEG, PNG, PDF, DOC, DOCX (≤ 2MB)")],-1)),e("label",ft,[e("input",{type:"file",accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",onChange:te,class:"hidden"},null,32),t[33]||(t[33]=e("span",{class:"px-4 py-2 rounded-lg border bg-white hover:bg-gray-50 cursor-pointer text-sm"}," Browse… ",-1))])]),s.file?(i(),n("div",ht,[e("span",_t,[t[35]||(t[35]=e("span",{class:"text-gray-500 mr-1"},"Selected:",-1)),e("span",wt,a((u=s.file)==null?void 0:u.name),1)]),e("button",{type:"button",class:"px-3 py-1.5 rounded-lg border hover:bg-gray-50 text-sm",onClick:ae}," Remove ")])):x("",!0)],34)])]),e("div",null,[t[37]||(t[37]=e("label",{class:"block font-medium mb-1"},"Description",-1)),w(be,{modelValue:s.description,"onUpdate:modelValue":t[14]||(t[14]=o=>s.description=o),class:"w-full"},null,8,["modelValue"])])]),e("div",kt,[w(d,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:T(()=>t[39]||(t[39]=[_(" Cancel ")])),_:1,__:[39]}),e("button",{disabled:!D.value,type:"submit",class:m(["px-4 py-2 rounded-xl text-white text-sm",D.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(C.value?"Saving…":"Save"),11,Ct)]),e("div",Dt,[w(d,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:T(()=>t[40]||(t[40]=[_(" Cancel ")])),_:1,__:[40]}),e("button",{disabled:!D.value,type:"submit",class:m(["px-4 py-2 rounded-xl text-white text-sm",D.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(C.value?"Saving…":"Save"),11,jt)])],32)])}}};export{Pt as default};
