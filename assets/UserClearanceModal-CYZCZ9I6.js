import{_ as $,x as _,D as J,q as I,y as Q,c as o,o as d,j as m,s as C,a as s,t as n,n as X,b as N,m as S,F as P,e as Z,A as ee}from"./index-vfsYf8tT.js";import{u as te}from"./userClearance-Cv-gJC0B.js";const se={key:1,class:"fixed inset-0 z-50 print:static print:z-auto"},re={class:"absolute inset-0 flex items-start justify-center overflow-y-auto print:block print:overflow-visible"},ae={class:"modal-print mt-6 mb-10 w-[1150px] max-w-[96vw] rounded-2xl bg-white shadow-2xl print:w-[210mm] print:max-w-[210mm] print:rounded-none print:shadow-none print:m-0 print:mt-0"},ne={class:"px-6 pt-6 pb-4 border-b print:px-[12mm] print:pt-[10mm] print:pb-[4mm]"},oe={class:"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm print:text-[12px]"},de={class:"flex gap-2"},le={class:"font-medium"},ie={key:0,class:"value-extra"},pe={class:"flex gap-2"},ce={class:"value"},ue={class:"value-text"},me={class:"flex gap-2"},be={class:"value"},_e={class:"value-text"},ge={class:"px-6 pb-6 print:px-[12mm] print:pb-[12mm] overflow-x-auto print:overflow-visible"},ye={class:"w-full border border-gray-800 text-[13px] print:text-[12px]",style:{"border-collapse":"collapse"}},xe={key:0},ve={key:1},he={colspan:"6",class:"border border-gray-800 text-center py-6 text-red-600"},fe={key:2},ke={class:"border border-gray-800 px-2 py-1 align-top tabular-nums"},Ce=["rowspan"],Ne={class:"text-xs"},Se={class:"border border-gray-800 px-2 py-1"},we={class:"font-medium"},Ee={class:"text-[11px] text-gray-700 mt-0.5"},Te={key:0,class:"text-gray-500 print:hidden"},De={key:1,class:"ml-2 text-amber-700"},Le={class:"border border-gray-800 px-2 py-1"},Ie={class:"inline-block min-w-[22mm] text-center font-semibold"},Pe={class:"border border-gray-800 px-2 py-1"},Re={class:"whitespace-pre-line"},Me={class:"border border-gray-800 px-2 py-1"},Ge={key:0,class:"text-[11px] text-gray-600 mt-0.5"},Ae={class:"border border-gray-800 px-2 py-1 print:hidden"},Be=["title","aria-label"],Ve={__name:"UserClearanceModal",props:{user:{type:Object,required:!0},open:{type:Boolean,default:!1},buttonClass:{type:String,default:"px-3 py-1.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700"},hideTrigger:{type:Boolean,default:!1}},emits:["update:open"],setup(v,{emit:R}){const c=v,M=R,g=_({get:()=>c.open,set:e=>M("update:open",e)}),b=te(),{items:x,loading:G,error:w,currentUserInfo:l}=J(b),A=_(()=>{var e,t,a;return((e=l==null?void 0:l.value)==null?void 0:e.name)||((t=c.user)==null?void 0:t.name)||`#${(a=c.user)==null?void 0:a.id}`}),E=_(()=>{var e,t;return((e=l==null?void 0:l.value)==null?void 0:e.employee_id)||((t=c.user)==null?void 0:t.employee_id)||""}),B=_(()=>{var e,t,a,i;return((t=(e=l==null?void 0:l.value)==null?void 0:e.department)==null?void 0:t.name)||((i=(a=c.user)==null?void 0:a.department)==null?void 0:i.name)||""}),V=_(()=>{var e,t,a,i;return((t=(e=l==null?void 0:l.value)==null?void 0:e.designation)==null?void 0:t.title)||((i=(a=c.user)==null?void 0:a.designation)==null?void 0:i.title)||""});function O(){g.value=!0}function h(){g.value=!1}function f(e){e.key==="Escape"&&h()}const T=async()=>{var e,t,a;(e=c.user)!=null&&e.id&&((t=b.setUser)==null||t.call(b,c.user.id),await((a=b.fetch)==null?void 0:a.call(b)))};I(g,e=>{e?(T(),window.addEventListener("keydown",f)):window.removeEventListener("keydown",f)},{immediate:!0}),I(()=>{var e;return(e=c.user)==null?void 0:e.id},(e,t)=>{e&&e!==t&&g.value&&T()}),Q(()=>window.removeEventListener("keydown",f));function H(e={}){const t=e.latest||null,a=(t==null?void 0:t.cleared_by)||null;return{id:e.template_item_id??e.id,template_item_id:e.template_item_id??e.id,label:e.label||e.template_item_name||e.item_key||`#${e.template_item_id??e.id}`,order_no:e.order_no??e.template_order_no??0,handover_to:e.handover_to||"departmental_incharge",handover_by:e.handover_user||"departmental_incharge",show_receiver:!!e.show_receiver,is_cleared:!!e.is_cleared,missing:!!e.missing,status:(t==null?void 0:t.status)??null,handover_status:(t==null?void 0:t.handover_status)??null,present_condition:(t==null?void 0:t.present_condition)??"",receiver_name:e.show_receiver?(t==null?void 0:t.receiver_name)??"":"",remarks:(t==null?void 0:t.remarks)??"",cleared_by_user:a?{id:a.id,name:a.name}:null,cleared_at:(t==null?void 0:t.cleared_at)||null}}const j={departmental_incharge:"Departmental In-charge",technical_support_team:"Technical Support Team",it_incharge:"IT In-charge",hr_department:"HR Department",inventory_incharge:"Inventory In-charge"},D=["Departmental In-charge","Technical Support Team","IT In-charge","HR Department","Inventory In-charge"];function U(e){const t=String((e==null?void 0:e.handover_to)||"").toLowerCase();return j[t]||"Departmental In-charge"}const F=_(()=>(Array.isArray(x==null?void 0:x.value)?x.value:[]).map(H)),L=_(()=>{var i;const e=new Map(D.map(r=>[r,[]]));for(const r of F.value)(i=e.get(U(r)))==null||i.push(r);for(const[,r]of e.entries())r.sort((p,u)=>(p.order_no??p.template_item_id??p.id??0)-(u.order_no??u.template_item_id??u.id??0));const t=[];let a=1;for(const r of D){const p=e.get(r)||[];p.length&&p.forEach((u,W)=>t.push({sl:a++,group:r,isGroupFirst:W===0,groupSpan:p.length,row:u}))}return t});function K(e){const t=String(e??"").trim().toLowerCase();return["y","yes","true","1","done","cleared","complete","completed","yes.","yes,"].includes(t)?"Yes":["n","no","false","0","pending","not done","incomplete","no.","no,","rejected"].includes(t)?"No":"—"}async function z(){document.body.classList.add("print-modal"),await ee(),window.print(),setTimeout(()=>document.body.classList.remove("print-modal"),0)}const y={PENDING:{label:"Pending",pill:"bg-amber-50 text-amber-800 border-amber-200",dot:"bg-amber-500"},WORKING:{label:"Working",pill:"bg-sky-50 text-sky-800 border-sky-200",dot:"bg-sky-500"},COMPLETED:{label:"Completed",pill:"bg-emerald-50 text-emerald-800 border-emerald-200",dot:"bg-emerald-500"}};function k(e){var a;if(e!=null&&e.missing)return"Pending";const t=String((e==null?void 0:e.status)||"").toUpperCase();return((a=y[t])==null?void 0:a.label)||(e==null?void 0:e.status)||"—"}function Y(e){var a;if(e!=null&&e.missing)return y.PENDING.pill;const t=String((e==null?void 0:e.status)||"").toUpperCase();return((a=y[t])==null?void 0:a.pill)||"bg-slate-50 text-slate-700 border-slate-200"}function q(e){var a;if(e!=null&&e.missing)return y.PENDING.dot;const t=String((e==null?void 0:e.status)||"").toUpperCase();return((a=y[t])==null?void 0:a.dot)||"bg-slate-400"}return(e,t)=>{var a,i;return d(),o(P,null,[v.hideTrigger?m("",!0):(d(),o("button",{key:0,class:C(v.buttonClass),onClick:O},"View Clearance",2)),g.value?(d(),o("div",se,[s("div",{class:"absolute inset-0 bg-black/50 print:hidden",onClick:h}),s("div",re,[s("div",ae,[s("div",ne,[t[3]||(t[3]=s("div",{class:"text-center"},[s("h1",{class:"text-2xl font-extrabold tracking-wide print:text-[20px]"},"GENESIS PG ORIENTATION CENTRE"),s("p",{class:"text-sm text-gray-600 print:text-[12px]"},"230, New Elephant Road, Katabon Mor, Dhaka-1205")],-1)),s("div",oe,[s("div",de,[t[0]||(t[0]=s("span",{class:"label"},"Name:",-1)),s("span",null,[s("span",le,n(A.value),1),E.value?(d(),o("span",ie,"(ID: "+n(E.value)+")",1)):m("",!0)])]),s("div",pe,[t[1]||(t[1]=s("span",{class:"label"},"Department:",-1)),s("span",ce,[s("span",ue,n(B.value||"—"),1)])]),s("div",me,[t[2]||(t[2]=s("span",{class:"label"},"Post:",-1)),s("span",be,[s("span",_e,n(V.value||"—"),1)])])]),t[4]||(t[4]=s("div",{class:"mt-4 text-center"},[s("h2",{class:"inline-block text-base font-semibold px-4 py-1 border rounded print:text-[13px]"}," Employment Resignation Checklist ")],-1))]),s("div",{class:"px-6 py-3 flex justify-end gap-2 print:hidden"},[s("button",{class:"rounded border px-3 py-1.5 hover:bg-gray-50",onClick:z},"Print"),s("button",{class:"rounded bg-gray-900 px-3 py-1.5 text-white hover:bg-gray-800",onClick:h},"Close")]),s("div",ge,[s("table",ye,[t[8]||(t[8]=s("thead",null,[s("tr",{class:"bg-gray-100"},[s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[14mm]"},"S. L."),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[30mm]"},"Handover To"),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[70mm]"},[N(" Particulars "),s("span",{class:"block text-[11px] text-gray-600"},"Cleared by")]),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[30mm]"},"Handed over (Yes/No)"),s("th",{class:"border border-gray-800 text-left px-2 py-1"},"Present Conditions (note please)"),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[42mm]"},"Receiver’s Name"),s("th",{class:"border border-gray-800 text-left px-2 py-1 print:hidden"},"Status")])],-1)),s("tbody",null,[(a=S(G))!=null&&a.value?(d(),o("tr",xe,t[5]||(t[5]=[s("td",{colspan:"6",class:"border border-gray-800 text-center py-6 text-gray-600"},"Loading…",-1)]))):(i=S(w))!=null&&i.value?(d(),o("tr",ve,[s("td",he,n(S(w).value),1)])):L.value.length?m("",!0):(d(),o("tr",fe,t[6]||(t[6]=[s("td",{colspan:"6",class:"border border-gray-800 text-center py-6 text-gray-600"},"No items found",-1)]))),(d(!0),o(P,null,Z(L.value,r=>{var p,u;return d(),o("tr",{key:r.row.template_item_id,class:"align-top"},[s("td",ke,n(r.sl)+".",1),r.isGroupFirst?(d(),o("td",{key:0,rowspan:r.groupSpan,class:"border border-gray-800 px-2 py-1 align-top font-medium"},[s("span",Ne,n(r.group),1)],8,Ce)):m("",!0),s("td",Se,[s("div",we,n(r.row.label),1),s("div",Ee,[t[7]||(t[7]=N(" Cleared by: ")),s("strong",null,n(((p=r.row.cleared_by_user)==null?void 0:p.name)||((u=r.row.cleared_by_user)!=null&&u.id?"#"+r.row.cleared_by_user.id:"—")),1),r.row.cleared_at?(d(),o("span",Te," ("+n(new Date(r.row.cleared_at).toLocaleString())+") ",1)):m("",!0),r.row.missing?(d(),o("span",De,"(pending)")):m("",!0)])]),s("td",Le,[s("span",Ie,n(K(r.row.handover_status)),1)]),s("td",Pe,[s("div",Re,n(r.row.present_condition||"—"),1)]),s("td",Me,[s("div",null,n(r.row.show_receiver&&r.row.receiver_name||"—"),1),r.row.remarks?(d(),o("div",Ge,n(r.row.remarks),1)):m("",!0)]),s("td",Ae,[s("span",{class:C(["inline-flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-xs font-medium print:bg-white print:text-black print:border-black",Y(r.row)]),title:r.row.missing?"Not cleared yet":"Status: "+k(r.row),"aria-label":k(r.row)},[s("span",{class:C(["h-1.5 w-1.5 rounded-full",q(r.row)])},null,2),N(" "+n(k(r.row)),1)],10,Be)])])}),128))])]),t[9]||(t[9]=X('<div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm print:text-[12px]" data-v-56201222><div class="border-gray-800 pt-6 text-center" data-v-56201222><div class="font-medium" data-v-56201222>User Signature</div></div><div class="border-gray-800 pt-6 text-center" data-v-56201222><div class="font-medium" data-v-56201222>Received by Head of HR</div></div><div class="border-gray-800 pt-6 text-center" data-v-56201222><div class="font-medium" data-v-56201222>Verified by ACC/CC</div></div></div>',1))])])])])):m("",!0)],64)}}},je=$(Ve,[["__scopeId","data-v-56201222"]]);export{je as U};
