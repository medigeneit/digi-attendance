import{s as N,r as b,z as j,q as M,o as l,c as n,a as t,t as c,w as q,d as h,A as E,F as w,x as k,h as V,v as A,e as L,i as B,p as I,b as T,l as g}from"./index-rfORStRX.js";import{u as O}from"./company-BP-oSAoD.js";import{_ as z,a as R}from"./HeaderWithButtons-CBtSFRTA.js";import{L as G}from"./LoaderView-fbH3Y_yG.js";import{u as H}from"./department-o8GeS8ZR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={key:0,class:"modal-bg"},K={class:"modal-card"},P={class:"text-lg font-semibold mb-4"},Q={class:"mb-4"},W=["value"],X={class:"mb-4"},Y=["value"],Z={class:"mb-4"},ee={class:"mb-4"},te={class:"mb-4"},se={class:"mb-4"},oe={class:"flex justify-end"},ae={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},le={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup($,{emit:d}){const r=$,u=d,m=O(),{companies:i,employees:C}=N(m),p=b(!1),_=b(!1),o=j({id:null,company_id:"",incharge_id:"",name:"",short_name:"",description:"",status:"Active"}),y=()=>{p.value=!1,o.id=null,o.company_id="",o.incharge_id="",o.name="",o.short_name="",o.description="",o.status="Active"};M(()=>r.department,s=>{var e;s&&typeof s=="object"&&Object.keys(s).length>0?(p.value=!0,o.id=s.id||null,o.company_id=s.company_id||"",o.incharge_id=((e=s.in_charge)==null?void 0:e.id)||"",o.name=s.name||"",o.short_name=s.short_name||"",o.description=s.description||"",o.status=s.status||"Active"):y()},{immediate:!0,deep:!0}),M(()=>r.show,async s=>{s&&!_.value&&await S()}),M(()=>o.company_id,async s=>{s&&await m.fetchEmployee(s)});const D=()=>{u("save",{...o}),y(),x()},x=()=>{y(),u("close")},S=async()=>{try{await m.fetchCompanies(),_.value=!0}catch(s){console.error("Failed to fetch companies:",s)}};return(s,e)=>$.show?(l(),n("div",J,[t("div",K,[t("h2",P,c(p.value?"Edit Department":"Add Department"),1),t("form",{onSubmit:q(D,["prevent"])},[t("div",Q,[e[7]||(e[7]=t("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),h(t("select",{id:"company_id","onUpdate:modelValue":e[0]||(e[0]=a=>o.company_id=a),class:"w-full border rounded px-3 py-2",required:""},[e[6]||(e[6]=t("option",{value:"",disabled:""},"Select a company",-1)),(l(!0),n(w,null,k(V(i),a=>(l(),n("option",{key:a.id,value:a.id},c(a.name),9,W))),128))],512),[[E,o.company_id]])]),t("div",X,[e[9]||(e[9]=t("label",{for:"incharge_id",class:"block text-sm font-medium mb-2"},"In Chare",-1)),h(t("select",{id:"incharge_id","onUpdate:modelValue":e[1]||(e[1]=a=>o.incharge_id=a),class:"w-full border rounded px-3 py-2"},[e[8]||(e[8]=t("option",{value:"",disabled:""},"Select Employee",-1)),(l(!0),n(w,null,k(V(C),(a,f)=>(l(),n("option",{key:f,value:f},c(a),9,Y))),128))],512),[[E,o.incharge_id]])]),t("div",Z,[e[10]||(e[10]=t("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),h(t("input",{id:"name","onUpdate:modelValue":e[2]||(e[2]=a=>o.name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[A,o.name]])]),t("div",ee,[e[11]||(e[11]=t("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),h(t("input",{id:"short_name","onUpdate:modelValue":e[3]||(e[3]=a=>o.short_name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[A,o.short_name]])]),t("div",te,[e[12]||(e[12]=t("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),h(t("textarea",{id:"description","onUpdate:modelValue":e[4]||(e[4]=a=>o.description=a),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[A,o.description]])]),t("div",se,[e[14]||(e[14]=t("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),h(t("select",{id:"status","onUpdate:modelValue":e[5]||(e[5]=a=>o.status=a),class:"w-full border rounded px-3 py-2",required:""},e[13]||(e[13]=[t("option",{value:"Active"},"Active",-1),t("option",{value:"Inactive"},"Inactive",-1)]),512),[[E,o.status]])]),t("div",oe,[t("button",{type:"button",onClick:x,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),t("button",ae,c(p.value?"Update":"Create"),1)])],32)])])):L("",!0)}},ne={class:"my-container space-y-4"},re={key:0,class:"text-center py-4"},de={key:1,class:"space-y-4"},ie={class:"title-md"},ce={class:"overflow-x-auto"},ue={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},me={class:"text-gray-600 text-sm"},pe={class:"py-3 px-2 text-left"},fe={class:"py-3 px-2 text-left whitespace-nowrap"},ye={class:"py-3 px-2 text-center"},ve={class:"py-3 px-2 text-center"},he={class:"flex item-center justify-center gap-4"},be=["onClick"],_e=["onClick"],De={__name:"DepartmentList",setup($){const d=H(),r=B(),u=b(!1),m=b(!1),i=b(null),C=()=>{i.value=null,u.value=!0},p=()=>{u.value=!1},_=s=>{i.value=s,u.value=!0},o=s=>{i.value=s,m.value=!0},y=()=>{m.value=!1},D=async s=>{try{s.id?(await d.updateDepartment(s.id,s),r.success("Department updated successfully!"),await d.fetchDepartments()):(await d.createDepartment(s),r.success("Department added successfully!"))}catch(e){r.error("Failed to save department!"),console.error("Error handling save:",e)}finally{p()}},x=async()=>{var s;if(!((s=i.value)!=null&&s.id)){r.error("Invalid department selected for deletion!");return}try{await d.deleteDepartment(i.value.id),r.success("Department deleted successfully!")}catch(e){r.error("Failed to delete department!"),console.error("Error deleting department:",e)}finally{y()}},S=I(()=>{const s={};return d.departments.forEach(e=>{var f;const a=((f=e.company)==null?void 0:f.name)||"Unknown Company";s[a]||(s[a]=[]),s[a].push(e)}),s});return T(async()=>{try{await d.fetchDepartments()}catch(s){r.error("Failed to fetch departments!"),console.error("Error fetching departments:",s)}}),(s,e)=>{var a;return l(),n("div",ne,[g(R,{title:"Department List",onAdd:C}),V(d).loading?(l(),n("div",re,[g(G)])):(l(),n("div",de,[(l(!0),n(w,null,k(S.value,(f,F)=>(l(),n("div",{key:F},[t("h2",ie,c(F),1),t("div",ce,[t("table",ue,[e[2]||(e[2]=t("thead",null,[t("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[t("th",{class:"py-3 px-2 text-left"},"Name"),t("th",{class:"py-3 px-2 text-left"},"Short Name"),t("th",{class:"py-3 px-2 text-center"},"Status"),t("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),t("tbody",me,[(l(!0),n(w,null,k(f,v=>(l(),n("tr",{key:v.id,class:"border-b border-gray-200 hover:bg-blue-200"},[t("td",pe,c(v.name),1),t("td",fe,c(v.short_name),1),t("td",ye,c(v.status),1),t("td",ve,[t("div",he,[t("button",{onClick:U=>_(v),class:"text-blue-600 hover:text-blue-800"},e[0]||(e[0]=[t("i",{class:"fas fa-edit"},null,-1)]),8,be),t("button",{onClick:U=>o(v),class:"text-red-600 hover:text-red-800"},e[1]||(e[1]=[t("i",{class:"fas fa-trash"},null,-1)]),8,_e)])])]))),128))])])])]))),128))])),g(le,{show:u.value,department:i.value,onClose:p,onSave:D},null,8,["show","department"]),g(z,{show:m.value,title:"Delete Department",message:`Are you sure you want to delete ${(a=i.value)==null?void 0:a.name}?`,onClose:y,onConfirm:x},null,8,["show","message"])])}}};export{De as default};
