import{D as F,x as B,c as r,o as d,a as t,d as L,n as e,k as w,l as _,v as D,H as P,F as j,e as M,t as u,b as V,z as I,w as O,s as E,r as J,q as T,y as Y,Q as q,h as Z,j as tt}from"./index-BjJrN_TD.js";import{useBloodDonorAdminStore as H}from"./bloodDonorAdmin-Btv-JJdH.js";import{_ as Q}from"./EmployeeFilter-1wbbaln4.js";import{u as et}from"./user-4Z8HSwzY.js";import"./company-CjzeC3LU.js";import"./department-BFyyc210.js";import"./EmployeeDropdownInput-CGm90nLT.js";import"./SelectDropdown-BiMC9-mx.js";import"./UserChip-Hp1m0tn_.js";const st={class:"rounded-xl border border-zinc-200 bg-white p-4"},it={class:"mb-4 rounded-lg border border-zinc-200 bg-zinc-50 p-2"},lt={class:"grid grid-cols-1 gap-3 md:grid-cols-4"},nt={class:"space-y-1"},at={class:"space-y-1"},ot={class:"space-y-1"},dt=["value"],rt={class:"space-y-1"},ct={key:0,class:"space-y-1"},pt={class:"space-y-1"},ut={class:"space-y-1"},mt={class:"space-y-1"},xt={class:"flex items-end gap-2"},bt={class:"flex-1 space-y-1"},yt=["disabled"],vt={__name:"BloodDonorFilters",setup(g){const y=H(),{filters:o,loading:f}=F(y),v=B(()=>o.value.availability==="soon"),$=["A+","A-","B+","B-","AB+","AB-","O+","O-"];return(N,l)=>(d(),r("div",st,[t("div",it,[L(Q,{company_id:e(o).company_id,"onUpdate:company_id":l[0]||(l[0]=a=>e(o).company_id=a),department_id:e(o).department_id,"onUpdate:department_id":l[1]||(l[1]=a=>e(o).department_id=a),employee_id:e(o).employee_id,"onUpdate:employee_id":l[2]||(l[2]=a=>e(o).employee_id=a),line_type:e(o).line_type,"onUpdate:line_type":l[3]||(l[3]=a=>e(o).line_type=a),"with-type":!0,"initial-value":e(o),class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"])]),t("div",lt,[t("div",nt,[l[14]||(l[14]=t("label",{class:"text-xs text-zinc-600"},"Search",-1)),_(t("input",{"onUpdate:modelValue":l[4]||(l[4]=a=>e(o).search=a),class:"input-1 h-9 w-full text-sm",placeholder:"Name / phone / ID"},null,512),[[D,e(o).search,void 0,{trim:!0}]])]),t("div",at,[l[15]||(l[15]=t("label",{class:"text-xs text-zinc-600"},"Address",-1)),_(t("input",{"onUpdate:modelValue":l[5]||(l[5]=a=>e(o).address=a),class:"input-1 h-9 w-full text-sm",placeholder:"Street, city, area"},null,512),[[D,e(o).address,void 0,{trim:!0}]])]),t("div",ot,[l[17]||(l[17]=t("label",{class:"text-xs text-zinc-600"},"Blood Group",-1)),_(t("select",{"onUpdate:modelValue":l[6]||(l[6]=a=>e(o).blood_group=a),class:"input-1 h-9 w-full text-sm"},[l[16]||(l[16]=t("option",{value:""},"All",-1)),(d(),r(j,null,M($,a=>t("option",{key:a,value:a},u(a),9,dt)),64))],512),[[P,e(o).blood_group]])]),t("div",rt,[l[19]||(l[19]=t("label",{class:"text-xs text-zinc-600"},"Availability",-1)),_(t("select",{"onUpdate:modelValue":l[7]||(l[7]=a=>e(o).availability=a),class:"input-1 h-9 w-full text-sm"},l[18]||(l[18]=[t("option",{value:"all"},"All",-1),t("option",{value:"available"},"Available",-1),t("option",{value:"not_available"},"Not Available",-1),t("option",{value:"soon"},"Reset in 15 days",-1)]),512),[[P,e(o).availability]])]),v.value?(d(),r("div",ct,[l[20]||(l[20]=t("label",{class:"text-xs text-zinc-600"},"Soon Days",-1)),_(t("input",{"onUpdate:modelValue":l[8]||(l[8]=a=>e(o).soon_days=a),type:"number",min:"1",max:"365",class:"input-1 h-9 w-full text-sm"},null,512),[[D,e(o).soon_days,void 0,{number:!0}]])])):w("",!0),t("div",pt,[l[22]||(l[22]=t("label",{class:"text-xs text-zinc-600"},"Status",-1)),_(t("select",{"onUpdate:modelValue":l[9]||(l[9]=a=>e(o).status=a),class:"input-1 h-9 w-full text-sm"},l[21]||(l[21]=[t("option",{value:""},"All",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1),t("option",{value:"blocked"},"Blocked",-1)]),512),[[P,e(o).status]])]),t("div",ut,[l[23]||(l[23]=t("label",{class:"text-xs text-zinc-600"},"Last Donation From",-1)),_(t("input",{"onUpdate:modelValue":l[10]||(l[10]=a=>e(o).last_donation_from=a),type:"date",class:"input-1 h-9 w-full text-sm"},null,512),[[D,e(o).last_donation_from]])]),t("div",mt,[l[24]||(l[24]=t("label",{class:"text-xs text-zinc-600"},"Last Donation To",-1)),_(t("input",{"onUpdate:modelValue":l[11]||(l[11]=a=>e(o).last_donation_to=a),type:"date",class:"input-1 h-9 w-full text-sm"},null,512),[[D,e(o).last_donation_to]])]),t("div",xt,[t("div",bt,[l[26]||(l[26]=t("label",{class:"text-xs text-zinc-600"},"Per Page",-1)),_(t("select",{"onUpdate:modelValue":l[12]||(l[12]=a=>e(o).per_page=a),class:"input-1 h-9 w-full text-sm"},l[25]||(l[25]=[t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1)]),512),[[P,e(o).per_page,void 0,{number:!0}]])]),t("button",{class:"btn-3 h-9",disabled:e(f),onClick:l[13]||(l[13]=a=>e(y).resetFilters())}," Reset ",8,yt)])])]))}},gt={class:"rounded-xl border border-zinc-200 bg-white shadow-sm"},_t={class:"flex items-start justify-between gap-3 border-b border-zinc-100 px-4 py-3"},ft={class:"shrink-0 text-xs text-zinc-500"},ht={key:0,class:"inline-flex items-center gap-2"},zt={key:1,class:"inline-flex items-center gap-2"},wt={class:"max-h-[70vh] overflow-auto"},kt={class:"w-full table-fixed text-[12px]"},$t={class:"divide-y divide-zinc-100"},At=["onClick","onKeydown"],Nt={class:"sticky left-0 z-10 bg-white group-hover:bg-sky-50 px-4 py-2.5 font-medium text-zinc-900"},Ut={class:"px-4 py-2.5"},Dt={class:"flex items-start gap-3 min-w-0"},Ct=["title"],St={class:"min-w-0"},Bt={class:"flex items-center gap-2 min-w-0"},Vt={class:"truncate font-semibold text-zinc-900"},jt={key:0,class:"shrink-0 text-[11px] text-zinc-400"},Pt={class:"mt-0.5 line-clamp-1 text-[11px] text-zinc-500"},Lt={class:"px-4 py-2.5"},Mt={class:"min-w-0"},Et=["title"],Ot=["title"],Tt={class:"px-4 py-2.5"},Ft={class:"min-w-0"},Ht={class:"font-semibold"},Rt=["href"],Kt={class:"tabular-nums"},Gt={key:1,class:"text-zinc-500"},It=["title"],qt={key:1,class:"mt-0.5 text-[11px] text-zinc-400"},Jt={class:"px-4 py-2.5"},Qt={class:"inline-flex items-center rounded-md bg-zinc-900 px-2 py-1 text-[11px] font-semibold text-white"},Wt={class:"px-4 py-2.5"},Xt={class:"flex items-center gap-2"},Yt={key:0,class:"text-[11px] text-zinc-500"},Zt={class:"px-4 py-2.5 text-zinc-800"},te={class:"font-medium tabular-nums"},ee={class:"px-4 py-2.5"},se={class:"sticky right-0 z-10 bg-white group-hover:bg-sky-50 px-4 py-2.5 border-l border-zinc-100 text-right"},ie=["onClick"],le={key:0},ne={__name:"BloodDonorTable",props:{donors:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},meta:{type:Object,default:()=>({page:1,per_page:25})}},emits:["edit"],setup(g,{emit:y}){const o=g,f=y,v=B(()=>{var i,U;const n=Number(((i=o.meta)==null?void 0:i.page)||1),c=Number(((U=o.meta)==null?void 0:U.per_page)||25);return(n-1)*c}),$=n=>n===!0||n===1||n==="1"||n==="true",N=n=>$(n==null?void 0:n.is_available),l=n=>N(n)?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":"bg-rose-50 text-rose-700 ring-1 ring-rose-200",a=n=>{switch(String(n||"").toLowerCase()){case"active":return"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200";case"inactive":return"bg-amber-50 text-amber-700 ring-1 ring-amber-200";case"blocked":return"bg-rose-50 text-rose-700 ring-1 ring-rose-200";default:return"bg-zinc-50 text-zinc-700 ring-1 ring-zinc-200"}},k=n=>{if(!n)return"—";const c=new Date(n);return Number.isNaN(c.getTime())?"—":c.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})},x=n=>{if(!n)return null;const c=String(n).replace(/[^\d+]/g,"");return c?`tel:${c}`:null},p=n=>{var c,i;return(n==null?void 0:n.company_name)||((c=n==null?void 0:n.company)==null?void 0:c.name)||((i=n==null?void 0:n.organization)==null?void 0:i.name)||"N/A"},h=n=>{var c,i;return(n==null?void 0:n.department_name)||((c=n==null?void 0:n.department)==null?void 0:c.name)||((i=n==null?void 0:n.team)==null?void 0:i.name)||"N/A"},A=n=>{const c=String(n||"").trim();return c?c.split(/\s+/).slice(0,2).map(U=>{var S;return(S=U[0])==null?void 0:S.toUpperCase()}).join(""):"—"},C=n=>f("edit",n);return(n,c)=>(d(),r("div",gt,[t("div",_t,[c[3]||(c[3]=t("div",{class:"min-w-0"},[t("div",{class:"text-sm font-semibold text-zinc-900"},"Donors"),t("div",{class:"mt-0.5 text-xs text-zinc-500"}," Click a row (or History) to update donor history. ")],-1)),t("div",ft,[g.loading?(d(),r("span",ht,c[1]||(c[1]=[t("span",{class:"h-2 w-2 animate-pulse rounded-full bg-zinc-300"},null,-1),V(" Loading… ")]))):(d(),r("span",zt,[c[2]||(c[2]=t("span",{class:"h-2 w-2 rounded-full bg-emerald-400"},null,-1)),V(" "+u(g.donors.length)+" rows ",1)]))])]),t("div",wt,[t("table",kt,[c[7]||(c[7]=t("colgroup",null,[t("col",{class:"w-14"}),t("col",{class:"w-[280px]"}),t("col",{class:"w-[240px]"}),t("col",{class:"w-[220px]"}),t("col",{class:"w-20"}),t("col",{class:"w-[210px]"}),t("col",{class:"w-28"}),t("col",{class:"w-28"}),t("col",{class:"w-24"})],-1)),c[8]||(c[8]=t("thead",{class:"sticky top-0 z-20 bg-zinc-50/95 backdrop-blur"},[t("tr",{class:"text-left text-[10.5px] font-semibold uppercase tracking-wide text-zinc-600"},[t("th",{class:"sticky left-0 z-30 bg-zinc-50/95 px-4 py-2.5"},"SL"),t("th",{class:"px-4 py-2.5"},"Donor"),t("th",{class:"px-4 py-2.5"},"Organization"),t("th",{class:"px-4 py-2.5"},"Contact"),t("th",{class:"px-4 py-2.5"},"Blood"),t("th",{class:"px-4 py-2.5"},"Availability"),t("th",{class:"px-4 py-2.5"},"Last"),t("th",{class:"px-4 py-2.5"},"Status"),t("th",{class:"sticky right-0 z-30 bg-zinc-50/95 px-4 py-2.5 text-right border-l border-zinc-100"}," Action ")])],-1)),t("tbody",$t,[g.loading?(d(),r(j,{key:0},M(10,i=>t("tr",{key:`sk-${i}`,class:"animate-pulse"},c[4]||(c[4]=[t("td",{class:"sticky left-0 z-10 bg-white px-4 py-2.5"},[t("div",{class:"h-3 w-8 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-64 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-56 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-52 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-12 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-44 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-20 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-16 rounded bg-zinc-100"})],-1),t("td",{class:"sticky right-0 z-10 bg-white px-4 py-2.5 border-l border-zinc-100"},[t("div",{class:"ml-auto h-7 w-20 rounded bg-zinc-100"})],-1)]))),64)):(d(),r(j,{key:1},[(d(!0),r(j,null,M(g.donors,(i,U)=>(d(),r("tr",{key:(i==null?void 0:i.id)??U,class:"group cursor-pointer hover:bg-sky-50 focus-within:bg-sky-50",role:"button",tabindex:"0",title:"Open history update",onClick:S=>C(i),onKeydown:[I(O(S=>C(i),["prevent"]),["enter"]),I(O(S=>C(i),["prevent"]),["space"])]},[t("td",Nt,u(v.value+U+1),1),t("td",Ut,[t("div",Dt,[t("div",{class:"mt-0.5 flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-zinc-100 text-[11px] font-bold text-zinc-700",title:(i==null?void 0:i.name)||""},u(A(i==null?void 0:i.name)),9,Ct),t("div",St,[t("div",Bt,[t("div",Vt,u((i==null?void 0:i.name)||"N/A"),1),i!=null&&i.id?(d(),r("span",jt,"#"+u(i.id),1)):w("",!0)]),t("div",Pt,u((i==null?void 0:i.availability_note)||"Ready to support"),1)])])]),t("td",Lt,[t("div",Mt,[t("div",{class:"truncate text-zinc-900",title:p(i)},u(p(i)),9,Et),t("div",{class:"mt-0.5 truncate text-[11px] text-zinc-500",title:h(i)},u(h(i)),9,Ot)])]),t("td",Tt,[t("div",Ft,[t("div",Ht,[x(i==null?void 0:i.phone)?(d(),r("a",{key:0,href:x(i==null?void 0:i.phone),class:"inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-500",onClick:c[0]||(c[0]=O(()=>{},["stop"]))},[c[5]||(c[5]=t("span",{"aria-hidden":"true"},"☎",-1)),t("span",Kt,u(i==null?void 0:i.phone),1)],8,Rt)):(d(),r("span",Gt,u((i==null?void 0:i.phone)||"N/A"),1))]),i!=null&&i.address?(d(),r("div",{key:0,class:"mt-0.5 line-clamp-1 text-[11px] text-zinc-500",title:i.address},u(i.address),9,It)):(d(),r("div",qt,"—"))])]),t("td",Jt,[t("span",Qt,u((i==null?void 0:i.blood)||"N/A"),1)]),t("td",Wt,[t("div",Xt,[t("span",{class:E(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold",l(i)])},u(N(i)?"Available":"Not available"),3),i!=null&&i.available_from?(d(),r("span",Yt,u(k(i.available_from)),1)):w("",!0)])]),t("td",Zt,[t("span",te,u(k(i==null?void 0:i.last_donation_date)),1)]),t("td",ee,[t("span",{class:E(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold capitalize",a(i==null?void 0:i.status)])},u((i==null?void 0:i.status)||"N/A"),3)]),t("td",se,[t("button",{type:"button",class:"inline-flex items-center justify-center rounded-lg border border-zinc-200 bg-white px-2.5 py-1.5 text-[11px] font-semibold text-zinc-700 shadow-sm hover:bg-zinc-50 focus:outline-none focus:ring-2 focus:ring-sky-200",onClick:O(S=>f("edit",i),["stop"])}," History ",8,ie)])],40,At))),128)),g.donors.length===0?(d(),r("tr",le,c[6]||(c[6]=[t("td",{colspan:"9",class:"px-4 py-12 text-center text-sm text-zinc-500"}," No donors found. ",-1)]))):w("",!0)],64))])])])]))}},ae={class:"flex flex-col items-center justify-between gap-2 rounded-lg border border-zinc-200 bg-white px-4 py-3 text-sm md:flex-row"},oe={class:"text-zinc-600"},de={class:"flex items-center gap-1"},re=["disabled"],ce=["onClick"],pe=["disabled"],ue={__name:"PaginationBar",props:{page:{type:Number,default:1},perPage:{type:Number,default:15},total:{type:Number,default:0},lastPage:{type:Number,default:1}},emits:["page-change"],setup(g,{emit:y}){const o=g,f=y,v=B(()=>o.total===0?0:(o.page-1)*o.perPage+1),$=B(()=>o.total===0?0:Math.min(o.total,o.page*o.perPage)),N=B(()=>{const a=Math.max(1,Number(o.lastPage||1)),k=Math.min(a,Math.max(1,Number(o.page||1)));if(a<=7)return Array.from({length:a},(h,A)=>A+1);let x=Math.max(1,k-3),p=x+6;return p>a&&(p=a,x=p-6),Array.from({length:p-x+1},(h,A)=>x+A)}),l=a=>f("page-change",a);return(a,k)=>(d(),r("div",ae,[t("div",oe," Showing "+u(v.value)+"-"+u($.value)+" of "+u(g.total),1),t("div",de,[t("button",{type:"button",class:"h-8 rounded-md border border-zinc-300 px-2 text-xs font-semibold text-zinc-600 hover:bg-zinc-50 disabled:opacity-50",disabled:g.page<=1,onClick:k[0]||(k[0]=x=>l(g.page-1))}," Prev ",8,re),(d(!0),r(j,null,M(N.value,x=>(d(),r("button",{key:x,type:"button",class:E(["h-8 w-8 rounded-md border text-xs font-semibold",x===g.page?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-zinc-300 text-zinc-600 hover:bg-zinc-50"]),onClick:p=>l(x)},u(x),11,ce))),128)),t("button",{type:"button",class:"h-8 rounded-md border border-zinc-300 px-2 text-xs font-semibold text-zinc-600 hover:bg-zinc-50 disabled:opacity-50",disabled:g.page>=g.lastPage,onClick:k[1]||(k[1]=x=>l(g.page+1))}," Next ",8,pe)])]))}},me={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center px-4 py-6 top-4"},xe={class:"relative w-full max-w-6xl overflow-hidden rounded-2xl bg-white shadow-2xl ring-1 ring-black/5"},be={class:"sticky top-0 z-20 flex items-start justify-between gap-3 border-b bg-white/90 px-6 py-4 backdrop-blur"},ye=["disabled"],ve={class:"max-h-[76vh] overflow-y-auto px-6 py-5"},ge={key:0,class:"mb-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700"},_e={class:"mb-5 rounded-2xl border border-zinc-200 bg-white p-4"},fe={class:"mb-2 flex items-start justify-between gap-3"},he={key:0,class:"rounded-full bg-zinc-100 px-2.5 py-1 text-xs text-zinc-700"},ze={class:"font-semibold"},we={class:"grid grid-cols-1 gap-5 lg:grid-cols-12"},ke={class:"lg:col-span-4 space-y-5"},$e={class:"rounded-2xl border border-zinc-200 bg-white p-4"},Ae={key:0,class:"space-y-2 text-sm"},Ne={class:"flex justify-between gap-3"},Ue={class:"font-medium text-zinc-900 text-right"},De={class:"flex justify-between gap-3"},Ce={class:"font-medium text-zinc-900"},Se={class:"flex justify-between gap-3"},Be={class:"font-medium text-zinc-900 text-right"},Ve={key:1,class:"text-sm text-zinc-500"},je={class:"rounded-2xl border border-zinc-200 bg-white p-4"},Pe={class:"mb-3 flex items-start justify-between gap-3"},Le={key:0,class:"text-xs text-zinc-500"},Me={key:0,class:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-3 text-sm text-rose-700"},Ee={key:1,class:"space-y-2"},Oe={key:2,class:"rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-3 text-sm text-zinc-600"},Te={key:3,class:"max-h-[320px] overflow-auto pr-1 space-y-2"},Fe={class:"flex items-start justify-between gap-3"},He={class:"min-w-0"},Re={class:"text-sm font-semibold text-zinc-900"},Ke={class:"mt-0.5 text-xs text-zinc-500"},Ge={key:0,class:"mt-1 line-clamp-2 text-xs text-zinc-600"},Ie={class:"flex flex-col items-end gap-1 shrink-0"},qe={class:"lg:col-span-8 space-y-5"},Je={class:"rounded-2xl border border-zinc-200 bg-white p-4"},Qe={class:"mb-3 flex items-start justify-between gap-3"},We={key:0,class:"text-xs text-zinc-500"},Xe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ye={class:"flex items-center justify-between rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-2"},Ze=["disabled"],ts={class:"flex items-center justify-between rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-2"},es=["disabled"],ss={class:"space-y-1"},is=["disabled"],ls={key:0,class:"text-xs text-rose-600"},ns={class:"space-y-1"},as=["disabled"],os={class:"space-y-1 md:col-span-2"},ds=["disabled"],rs={key:0,class:"space-y-1 md:col-span-2"},cs=["disabled"],ps={class:"rounded-2xl border border-zinc-200 bg-white p-4"},us={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ms={class:"space-y-1"},xs=["disabled"],bs={class:"space-y-1 md:col-span-2"},ys=["disabled"],vs={class:"sticky bottom-0 z-20 flex items-center justify-between border-t bg-zinc-50 px-6 py-3"},gs={class:"flex items-center gap-2"},_s=["disabled"],fs=["disabled"],hs={key:0},zs={key:1},ws={__name:"DonorAdminModal",setup(g){const y=H(),o=et(),{modalOpen:f,saving:v,formError:$,errors:N,selectedUser:l,histories:a,loadingHistories:k,historiesError:x,form:p}=F(y),h=J({company_id:"",department_id:"",employee_id:"",line_type:"all"}),A=B(()=>l.value),C=()=>y.closeModal(),n=b=>{b.key==="Escape"&&C()};T(f,b=>{var s;b?(window.addEventListener("keydown",n),(s=l.value)!=null&&s.id&&(h.value.employee_id=String(l.value.id))):(window.removeEventListener("keydown",n),h.value={company_id:"",department_id:"",employee_id:"",line_type:"all"})},{immediate:!0}),Y(()=>window.removeEventListener("keydown",n)),T(()=>p.value.last_donation_date,b=>y.setLastDonationDate(b)),T(()=>p.value.has_disease,b=>{b||(p.value.disease_note="")});const c=b=>{var z;const s=(z=N.value)==null?void 0:z[b];return s?Array.isArray(s)?s[0]||"":String(s):""},i=b=>b===!0||b===1||b==="1"||b==="true",U=b=>i(b==null?void 0:b.is_available),S=b=>U(b)?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":"bg-rose-50 text-rose-700 ring-1 ring-rose-200",W=b=>b==="active"?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":b==="inactive"?"bg-amber-50 text-amber-700 ring-1 ring-amber-200":b==="blocked"?"bg-rose-50 text-rose-700 ring-1 ring-rose-200":"bg-zinc-50 text-zinc-700 ring-1 ring-zinc-200",R=b=>{if(!b)return"—";const s=new Date(b);return Number.isNaN(s.getTime())?"—":s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})},X=async b=>{if(!b)return;const z=await o.fetchUser(b)||o.user;z!=null&&z.id&&y.openModalForUser({id:z.id,name:z.name,phone:z.phone,blood_group:z.blood_group||z.blood,address:z.address,alternate_phone:z.alternate_phone})};return(b,s)=>{var z,K,G;return e(f)?(d(),r("div",me,[t("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-[2px]",onClick:s[0]||(s[0]=m=>e(v)?null:C)}),t("div",xe,[t("div",be,[s[15]||(s[15]=t("div",{class:"space-y-0.5"},[t("h3",{class:"text-base font-semibold text-zinc-900"},"Update Donor Profile"),t("p",{class:"text-xs text-zinc-500"},"Admin panel • update donor availability & donation entry")],-1)),t("button",{type:"button",class:"inline-flex h-9 w-9 items-center justify-center rounded-full text-zinc-500 hover:bg-zinc-100 hover:text-zinc-700 disabled:opacity-50",onClick:C,disabled:e(v),"aria-label":"Close",title:"Close"},s[14]||(s[14]=[t("i",{class:"far fa-times"},null,-1)]),8,ye)]),t("div",ve,[e($)?(d(),r("div",ge,u(e($)),1)):w("",!0),t("div",_e,[t("div",fe,[s[17]||(s[17]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Select employee"),t("p",{class:"text-xs text-zinc-500"},"Choose who you want to update")],-1)),(z=A.value)!=null&&z.blood_group?(d(),r("span",he,[s[16]||(s[16]=V(" Blood: ")),t("b",ze,u(A.value.blood_group),1)])):w("",!0)]),L(Q,{company_id:h.value.company_id,"onUpdate:company_id":s[1]||(s[1]=m=>h.value.company_id=m),department_id:h.value.department_id,"onUpdate:department_id":s[2]||(s[2]=m=>h.value.department_id=m),employee_id:h.value.employee_id,"onUpdate:employee_id":[s[3]||(s[3]=m=>h.value.employee_id=m),X],line_type:h.value.line_type,"onUpdate:line_type":s[4]||(s[4]=m=>h.value.line_type=m),"with-type":!0,"initial-value":h.value,class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"])]),t("div",we,[t("div",ke,[t("div",$e,[s[21]||(s[21]=t("div",{class:"mb-3"},[t("h4",{class:"text-sm font-semibold text-zinc-900"},"User info")],-1)),A.value?(d(),r("div",Ae,[t("div",Ne,[s[18]||(s[18]=t("span",{class:"text-zinc-500"},"Name",-1)),t("span",Ue,u(A.value.name||"N/A"),1)]),t("div",De,[s[19]||(s[19]=t("span",{class:"text-zinc-500"},"Phone",-1)),t("span",Ce,u(A.value.phone||"N/A"),1)]),t("div",Se,[s[20]||(s[20]=t("span",{class:"text-zinc-500"},"Address",-1)),t("span",Be,u(A.value.address||"N/A"),1)])])):(d(),r("div",Ve,"Select an employee to view details."))]),t("div",je,[t("div",Pe,[s[22]||(s[22]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Donation history")],-1)),(K=e(a))!=null&&K.length?(d(),r("span",Le,u(e(a).length)+" items",1)):w("",!0)]),e(x)?(d(),r("div",Me,u(e(x)),1)):e(k)?(d(),r("div",Ee,s[23]||(s[23]=[t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1),t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1),t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1)]))):(G=e(a))!=null&&G.length?(d(),r("div",Te,[(d(!0),r(j,null,M(e(a),m=>(d(),r("div",{key:m.id,class:"rounded-xl border border-zinc-200 p-3 hover:bg-zinc-50 transition"},[t("div",Fe,[t("div",He,[t("div",Re,u(R(m.last_donation_date)),1),t("div",Ke," Available from: "+u(R(m.available_from)),1),m.availability_note?(d(),r("div",Ge,u(m.availability_note),1)):w("",!0)]),t("div",Ie,[t("span",{class:E(["rounded-full px-2 py-0.5 text-[11px] font-semibold",S(m)])},u(U(m)?"Available":"Not available"),3),t("span",{class:E(["rounded-full px-2 py-0.5 text-[11px] font-semibold",W(m.status)])},u(m.status||"N/A"),3)])])]))),128))])):(d(),r("div",Oe,s[24]||(s[24]=[V(" No donation history yet. "),t("div",{class:"mt-1 text-xs text-zinc-500"},"Create an entry from the form to the right.",-1)])))])]),t("div",qe,[t("div",Je,[t("div",Qe,[s[25]||(s[25]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Availability")],-1)),e(p).user_id?(d(),r("span",We,"User ID: "+u(e(p).user_id),1)):w("",!0)]),t("div",Xe,[t("div",Ye,[s[26]||(s[26]=t("div",null,[t("div",{class:"text-sm font-medium text-zinc-800"},"Available for donation"),t("div",{class:"text-xs text-zinc-500"},"Visible to seekers")],-1)),_(t("input",{"onUpdate:modelValue":s[5]||(s[5]=m=>e(p).is_available=m),type:"checkbox",class:"h-5 w-5",disabled:e(v)},null,8,Ze),[[q,e(p).is_available]])]),t("div",ts,[s[27]||(s[27]=t("div",null,[t("div",{class:"text-sm font-medium text-zinc-800"},"Has disease"),t("div",{class:"text-xs text-zinc-500"},"Optional disclosure")],-1)),_(t("input",{"onUpdate:modelValue":s[6]||(s[6]=m=>e(p).has_disease=m),type:"checkbox",class:"h-5 w-5",disabled:e(v)},null,8,es),[[q,e(p).has_disease]])]),t("div",ss,[s[28]||(s[28]=t("label",{class:"text-xs font-medium text-zinc-600"},"Last donation date *",-1)),_(t("input",{"onUpdate:modelValue":s[7]||(s[7]=m=>e(p).last_donation_date=m),type:"date",class:"input-1 h-10 w-full text-sm",disabled:e(v)},null,8,is),[[D,e(p).last_donation_date]]),c("last_donation_date")?(d(),r("div",ls,u(c("last_donation_date")),1)):w("",!0)]),t("div",ns,[s[29]||(s[29]=t("label",{class:"text-xs font-medium text-zinc-600"},"Available from",-1)),_(t("input",{"onUpdate:modelValue":s[8]||(s[8]=m=>e(p).available_from=m),type:"date",class:"input-1 h-10 w-full text-sm bg-zinc-100",readonly:"",disabled:e(v)},null,8,as),[[D,e(p).available_from]])]),t("div",os,[s[30]||(s[30]=t("label",{class:"text-xs font-medium text-zinc-600"},"Availability note",-1)),_(t("input",{"onUpdate:modelValue":s[9]||(s[9]=m=>e(p).availability_note=m),class:"input-1 h-10 w-full text-sm",disabled:e(v)},null,8,ds),[[D,e(p).availability_note,void 0,{trim:!0}]])]),e(p).has_disease?(d(),r("div",rs,[s[31]||(s[31]=t("label",{class:"text-xs font-medium text-zinc-600"},"Disease note",-1)),_(t("textarea",{"onUpdate:modelValue":s[10]||(s[10]=m=>e(p).disease_note=m),class:"input-1 min-h-[90px] w-full text-sm",disabled:e(v)},null,8,cs),[[D,e(p).disease_note,void 0,{trim:!0}]])])):w("",!0)])]),t("div",ps,[s[35]||(s[35]=t("div",{class:"mb-3"},[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Status & notes"),t("p",{class:"text-xs text-zinc-500"},"Visibility + internal remark")],-1)),t("div",us,[t("div",ms,[s[33]||(s[33]=t("label",{class:"text-xs font-medium text-zinc-600"},"Status",-1)),_(t("select",{"onUpdate:modelValue":s[11]||(s[11]=m=>e(p).status=m),class:"input-1 h-10 w-full text-sm",disabled:e(v)},s[32]||(s[32]=[t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1),t("option",{value:"blocked"},"Blocked",-1)]),8,xs),[[P,e(p).status]])]),t("div",bs,[s[34]||(s[34]=t("label",{class:"text-xs font-medium text-zinc-600"},"Notes",-1)),_(t("textarea",{"onUpdate:modelValue":s[12]||(s[12]=m=>e(p).notes=m),class:"input-1 min-h-[110px] w-full text-sm",disabled:e(v)},null,8,ys),[[D,e(p).notes,void 0,{trim:!0}]])])])])])])]),t("div",vs,[s[36]||(s[36]=t("div",{class:"text-xs text-zinc-500"},[V(" Press "),t("span",{class:"rounded bg-white px-1.5 py-0.5 ring-1 ring-zinc-200"},"Esc"),V(" to close ")],-1)),t("div",gs,[t("button",{type:"button",class:"btn-3",onClick:C,disabled:e(v)},"Cancel",8,_s),t("button",{type:"button",class:"btn-1",disabled:e(v)||!e(p).user_id||!e(p).last_donation_date,onClick:s[13]||(s[13]=m=>e(y).saveHistory())},[e(v)?(d(),r("span",hs,"Saving...")):(d(),r("span",zs,"Save"))],8,fs)])])])])):w("",!0)}}},ks={class:"space-y-4 p-5"},$s={key:0,class:"rounded-md border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700"},As={key:1,class:"rounded-lg border border-dashed border-zinc-300 bg-white p-6 text-center text-sm text-zinc-500"},Ls={__name:"BloodDonorList",setup(g){const y=H(),{donors:o,meta:f,loading:v,error:$}=F(y),N=J(!1);Z(async()=>{N.value=!0,await y.fetchDonors()});const l=B(()=>JSON.stringify(y.filters));T(l,async()=>{N.value&&(y.setPage(1),await y.fetchDonors())});const a=async x=>{y.setPage(x),await y.fetchDonors()},k=x=>{y.openModalForUser({id:x.id,name:x.name,phone:x.phone,blood_group:x.blood,address:x.address,alternate_phone:x.alternate_phone}),y.form.user_id=String(x.id),y.form.is_available=!!Number(x.is_available||0),y.form.status=x.status||"inactive",y.form.availability_note=x.availability_note||"",y.form.notes=x.notes||"",y.form.last_donation_date=x.last_donation_date||"",y.setLastDonationDate(y.form.last_donation_date)};return(x,p)=>(d(),r("div",ks,[p[0]||(p[0]=t("div",{class:"flex items-center justify-between"},[t("h1",{class:"title-md md:title-lg"},"Blood Donors"),t("div",{class:"text-sm text-zinc-500"},"Admin only")],-1)),L(vt),e($)?(d(),r("div",$s,u(e($)),1)):w("",!0),L(ne,{donors:e(o),loading:e(v),meta:e(f),onEdit:k},null,8,["donors","loading","meta"]),!e(v)&&e(o).length===0&&!e($)?(d(),r("div",As," No donors found. Try adjusting the filters. ")):w("",!0),e(f).total>0?(d(),tt(ue,{key:2,page:e(f).page,"per-page":e(f).per_page,total:e(f).total,"last-page":e(f).last_page,onPageChange:a},null,8,["page","per-page","total","last-page"])):w("",!0),L(ws)]))}};export{Ls as default};
