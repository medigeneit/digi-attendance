import{d as X,b as tt,p as D,r as M,c as n,o as s,a as t,g as y,s as J,F as R,k as i,w as A,t as g,y as $,i as P,z as K,f as E,h as et,A as wt,m as _t,e as st,J as Ct,q as Y,j as I,v as ht,x as Z,G as St,H as yt,n as q,u as Dt,C as vt,_ as It}from"./index-Dxu3OBBt.js";import{L as Q}from"./LoaderView-BAi-j2VG.js";import{O as H}from"./OverlyModal-DCmZzptw.js";import{_ as Et}from"./DescriptionView-CUHjw016.js";import{m as Pt,_ as Lt}from"./task-tree-Rlums9sn.js";import{_ as Ut}from"./TaskAddForm-DWCgnx4V.js";import{_ as At}from"./TaskEditForm-CMmsmCqz.js";import{_ as Mt}from"./TaskTreeView-kLnV6Mk4.js";import{a as Nt,_ as Ot}from"./TaskUserAssignForm-DXyXlSQH.js";import{u as jt}from"./task-priority-CraS2uMz.js";import{c as Rt,d as Bt,T as Ft,b as Vt}from"./TaskSupervisorAndEmployee-Md-ttnxN.js";import{r as Gt,d as qt,u as Ht}from"./task-Dx1JpUZ6.js";import{b as z,g as zt,d as Wt}from"./datetime-C4Yr_jSk.js";import{_ as bt}from"./UserChip-BK6JJWhl.js";import{_ as Zt}from"./TaskStatus-DtfGzf5N.js";import{s as xt}from"./dom-BKn8Ftnz.js";import{u as Kt}from"./useTaskStore-BEuvIFmY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-CkS_3CSf.js";import"./company-DlNZ7N0h.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-Bhw2Rx3Z.js";import"./SelectDropdown-CwtsCsoJ.js";import"./SectionLoading-BctZIuVk.js";import"./TextWithHr-CiMl5f4s.js";import"./TaskUrgencyInput-B96ECuSe.js";import"./tags-C01PG7Dr.js";import"./MultiselectDropdown-Dv5HMbU1.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DdTDWeiC.js";import"./user-6I1Cqdy3.js";import"./TaskUserChip-Cfv3kHHr.js";const Jt={class:"mb-3"},Yt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Qt={key:1,class:"text-center py-4 text-gray-500"},Xt={key:2,class:"text-center py-4 text-red-500"},te={key:3,class:"space-y-4"},ee={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(k,{emit:l}){const e=k,u=X(),d=tt(),c=D(()=>{var v;return!!(((v=u==null?void 0:u.user)==null?void 0:v.role)!=="employee"&&(u!=null&&u.isAdminMood))}),b=l,f=M(null),{handleItemsPriorityUpdate:r,saveTaskPriority:m,listHasRearranged:p}=jt(()=>e.tasks,e.parentId),_=async()=>{await m(),b("updatePriority")};return(v,x)=>(s(),n("div",null,[t("div",Jt,[J(v.$slots,"task:header")]),c.value?(s(),n(R,{key:0},[i(p)?(s(),n("div",Yt,[x[4]||(x[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:A(_,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:x[0]||(x[0]=A((...w)=>f.value.resetItems&&f.value.resetItems(...w),["prevent"]))},"Discard")])):y("",!0)],64)):y("",!0),k.loading?(s(),n("div",Qt,"Loading tasks...")):k.error?(s(),n("div",Xt,g(k.error),1)):(s(),n("div",te,[$(Nt,{items:k.tasks,handle:"handle",onItemsUpdate:i(r),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:f},{item:P(({item:w,index:N})=>[$(Mt,{isMyTask:i(d).name=="MyTaskShow",index:N,task:w,showDraggableHandle:c.value,"tree-level":k.treeLevel,class:"!border-0",onCommentButtonClick:U=>b("commentButtonClick",w.id),onEditClick:x[1]||(x[1]=U=>b("editClick",U)),onAddClick:x[2]||(x[2]=U=>b("addClick",U)),onEmployeeAssignClick:x[3]||(x[3]=U=>b("employeeAssignClick",U))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},se={class:"flex justify-between mt-5"},ae={class:"flex justify-between items-center gap-4"},le={class:"w-32 relative h-8 mx-4"},ne={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},oe={key:3,class:"border p-4 rounded text-center text-gray-500 italic"},re={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(k,{emit:l}){const e=k,u=tt(),d=X(),c=M(""),b=M("not-completed"),f=K({taskId:0,isOpen:!1}),r=l,m=M(),p=K({show:!1,parentId:e.parentId,requirementId:null}),_=S=>{p.show=!0,p.parentId=S};function v(){p.show=!1,p.parentId=e.parentId,r("created")}function x(){r("assignUser")}function w(){m.value=!1,r("updated")}function N(){p.show=!1,p.parentId=e.parentId}const U=D(()=>{var S;return Array.isArray(e.subTasks)?Pt(e.subTasks,{status:b.value,...u.name=="MyTaskShow"?{"user-ids":(S=d==null?void 0:d.user)==null?void 0:S.id}:{}}).filter(a=>{var T,o,L;return c.value?(L=(T=a==null?void 0:a.title)==null?void 0:T.toUpperCase())==null?void 0:L.includes((o=c.value)==null?void 0:o.toUpperCase()):!0}):[]});return(S,a)=>{var T;return s(),n("div",null,[m.value?(s(),E(H,{key:0},{default:P(()=>[$(At,{taskId:m.value,onClose:a[0]||(a[0]=o=>m.value=null),onUpdated:w},null,8,["taskId"])]),_:1})):y("",!0),p.show?(s(),E(H,{key:1},{default:P(()=>[$(Ut,{parentTaskId:p.parentId,requirementId:p.requirementId,onTaskCreated:v,onError:S.handleTaskError,onClose:N},null,8,["parentTaskId","requirementId","onError"])]),_:1})):y("",!0),f.isOpen?(s(),E(H,{key:2},{default:P(()=>[$(Ot,{taskId:f.taskId,onCancelClick:a[1]||(a[1]=()=>{f.isOpen=!1,f.taskId=0}),onSuccess:a[2]||(a[2]=()=>{f.isOpen=!1,f.taskId=0,x()})},null,8,["taskId"])]),_:1})):y("",!0),$(ee,{tasks:U.value,parentId:k.parentId,treeLevel:k.treeLevel,onAddClick:a[6]||(a[6]=o=>_(o)),onEditClick:a[7]||(a[7]=o=>m.value=o),onUpdatePriority:a[8]||(a[8]=o=>r("updatePriority")),onEmployeeAssignClick:a[9]||(a[9]=o=>{f.taskId=o,f.isOpen=!0})},{"task:header":P(()=>{var o;return[t("div",se,[t("div",ae,[a[12]||(a[12]=t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks",-1)),((o=e==null?void 0:e.subTasks)==null?void 0:o.length)>0?(s(),n(R,{key:0},[$(Lt,{modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=L=>c.value=L),class:"w-full md:w-48 md:ml-auto h-8","debounce-time":0},null,8,["modelValue"]),t("div",le,[a[11]||(a[11]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),et(t("select",{"onUpdate:modelValue":a[4]||(a[4]=L=>b.value=L),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},a[10]||(a[10]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[wt,b.value]])])],64)):y("",!0)]),k.subTaskIsCreatable?(s(),n("div",ne,[t("button",{class:"btn-1 ml-auto",onClick:a[5]||(a[5]=A(()=>_(k.parentId),["prevent"]))}," Add Sub Task ")])):y("",!0)])]}),_:1},8,["tasks","parentId","treeLevel"]),((T=U.value)==null?void 0:T.length)===0&&k.treeLevel<=2?(s(),n("div",oe," No Sub Tasks ")):y("",!0)])}}},ie={key:0},de={key:0},ue={key:1},ce={key:2},pe={key:3},ke={key:1},me=_t({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(k){const l=k;let e=0;const u=M(b());let d;function c(){return l.millisecond&&typeof l.millisecond=="number"}function b(){c()?e&&(e-=1e3):e=new Date(l.targetDateTime).getTime()-new Date().getTime();const v=Math.floor(e/1e3%60),x=Math.floor(e/1e3/60%60),w=Math.floor(e/(1e3*60*60)%24),N=Math.floor(e/(1e3*60*60*24));return{total:e,days:N,hours:w,minutes:x,seconds:v}}function f(){u.value=b()}st(()=>{c()&&(e=l.millisecond),console.log("MOUNTED"),f(),d=setInterval(()=>{f(),u.value.total<=0&&clearInterval(d)},1e3)}),Ct(()=>clearInterval(d)),Y(()=>l.targetDateTime,()=>{f(),clearInterval(d)});const r=D(()=>u.value.days.toString().padStart(2,"0")),m=D(()=>u.value.hours.toString().padStart(2,"0")),p=D(()=>u.value.minutes.toString().padStart(2,"0")),_=D(()=>u.value.seconds.toString().padStart(2,"0"));return(v,x)=>u.value.total>0?(s(),n("span",ie,[!v.hideIfZeroValue||r.value!="00"?(s(),n("span",de,g(r.value)+"d : ",1)):y("",!0),!v.hideIfZeroValue||m.value!="00"?(s(),n("span",ue,g(m.value)+"h : ",1)):y("",!0),!v.hideIfZeroValue||p.value!="00"?(s(),n("span",ce,g(p.value)+"m : ",1)):y("",!0),!v.hideIfZeroValue||_.value!="00"?(s(),n("span",pe,g(_.value)+"s",1)):y("",!0)])):(s(),n("span",ke,[J(v.$slots,"expired")]))}}),fe={class:"mb-2 mt-6"},ye={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},ve={class:"flex justify-center"},be={class:"py-6 w-full text-center"},xe={class:"block mb-2"},ge={class:"font-semibold text-red-600 mx-2 text-xl"},_e={class:"mt-2"},he={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Te={class:"flex justify-between items-center"},$e={key:1,class:"btn-3"},we={key:2,class:"btn-2 bg-green-600 bg-none"},Ce={key:3,class:"btn-2-red"},gt=5e3,Se={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(k,{emit:l}){const e=k,u=M(""),d=M(""),c=l,b=M("");let f=0;async function r(){var _,v;if(!u.value)return b.value="Type the task title on input box";clearTimeout(f);try{b.value="",d.value==="deleted"?(d.value="restoring",await Gt(e.task.id),d.value="restored"):(d.value="deleting",await qt(e.task.id,{params:{security_check:encodeURIComponent(u.value)}}),d.value="deleted"),d.value=="deleted"?f=setTimeout(()=>{p()},gt):c("closeClick")}catch(x){d.value="error",b.value=((v=(_=x.response)==null?void 0:_.data)==null?void 0:v.message)||`Failed to update ${e.type}`}}function m(){d.value==="deleted"&&p(),c("closeClick")}function p(){d.value="",c("delete")}return(_,v)=>{var x,w;return s(),n("form",{class:"p-4 relative",onSubmit:A(r,["prevent"])},[v[7]||(v[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",fe,[v[1]||(v[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,g((x=k.task)==null?void 0:x.title),1)]),d.value=="deleted"?(s(),n("div",ye,v[2]||(v[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(s(),n(R,{key:1},[t("div",ve,[t("div",be,[t("label",xe,[v[3]||(v[3]=I(" Type ")),t("span",ge,g((w=k.task)==null?void 0:w.title),1),v[4]||(v[4]=I(" and submit to delete "))]),et(t("input",{type:"text","onUpdate:modelValue":v[0]||(v[0]=N=>u.value=N),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[ht,u.value]])])]),v[5]||(v[5]=t("hr",null,null,-1)),t("div",_e,[b.value?(s(),n("div",he,g(b.value),1)):y("",!0)])],64)),t("div",Te,[d.value=="deleted"?(s(),n("button",{key:0,class:"btn-2-red",type:"button",onClick:A(m,["prevent"])}," Delete ")):(s(),n("button",$e,"Close")),d.value=="deleted"?(s(),n("button",we,[v[6]||(v[6]=I(" Undo Delete in ")),d.value=="deleted"?(s(),E(me,{key:0,"hide-if-zero-value":!0,millisecond:gt})):y("",!0)])):(s(),n("button",Ce,"Delete"))]),d.value=="deleting"||d.value=="restoring"?(s(),E(Q,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:P(()=>[I(g(String(d.value).charAt(0).toUpperCase()+String(d.value).slice(1)),1)]),_:1})):y("",!0)],32)}}},De=k=>k==null?void 0:k.reduce((l,e)=>l+e.task_weight,0),Tt=(k,l)=>{const e=De(k);return k.map(u=>{const d=l.filter(c=>c.user_id===u.id).reduce((c,b)=>c+b.progress,0);return{...u,task_progress:Math.floor(d*(u.task_weight/e)),user_progress:d}})},Ie=(k,l)=>{let e=0;const u=[],d=f=>f.status==="COMPLETED",c=f=>f.users.some(r=>r.id===l),b=(f,r)=>{f.forEach(m=>{const p=c(m);u[r]=u[r]||{user_id:l,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const _=p&&m.children_tasks.length===0;u[r].total_assigned+=p?1:0,u[r].total_assigned_on_leaf_task+=_?1:0,e+=_?1:0,p&&d(m)&&(u[r].completed_count++,m.children_tasks.length),m.children_tasks.length>0&&b(m.children_tasks,r+1)})};return b(k,0),{sub_task_infos:u,assigned_on_any_leaf_task:e>0}},Ee=(k,l)=>k.map(e=>({...e,...Ie(l,e.id)})),Pe={key:0,class:"min-w-full bg-white rounded overflow-hidden"},Le={class:"py-0.5 text-bg font-semibold"},Ue={class:"bg-gray-50"},Ae={class:"px-2 py-1 border-y"},Me={class:"px-2 py-1 border-y"},Ne={key:0,class:"text-sm text-gray-400"},Oe={key:1},je={key:1,class:"min-w-full bg-white rounded overflow-hidden"},Re={class:"py-0.5 text-bg font-semibold"},Be={class:"px-2 py-1 border-y text-center"},Fe={class:"px-2 py-1 border-y border-r"},Ve={class:"px-2 py-1 border-y text-center"},Ge={class:"px-2 py-1 border-y text-center"},qe=_t({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(k){const l=k,e=D(()=>Tt(l.task.users,l.task.task_reports||[])),u=D(()=>Ee(l.task.users,l.subTasks));return(d,c)=>{var b,f;return l.task.children_task_count>0?(s(),n("table",Pe,[t("caption",Le,[J(d.$slots,"caption",{},()=>[c[0]||(c[0]=I("Progress"))])]),t("thead",Ue,[t("tr",null,[c[1]||(c[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),c[2]||(c[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(s(!0),n(R,null,Z(((f=(b=u.value[0]||{})==null?void 0:b.sub_task_infos)==null?void 0:f.length)||1,r=>(s(),n("th",{key:r,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},g(r===1?"Completed Sub Task":"")+" "+g(r===2?"Completed Sub Sub Task":"")+" "+g(r===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(s(!0),n(R,null,Z(u.value,(r,m)=>(s(),n("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ae,g(m+1),1),t("td",Me,[$(bt,{user:r},null,8,["user"])]),(s(!0),n(R,null,Z(r.sub_task_infos,(p,_)=>(s(),n("td",{class:"px-2 py-1 border-y text-center",key:_},[p.total_assigned===0||!r.assigned_on_any_leaf_task?(s(),n("div",Ne," Not Assigned To Any Task ")):(s(),n("div",Oe,g(p.completed_count)+" / "+g(p.total_assigned),1))]))),128))]))),128))])])):(s(),n("table",je,[t("caption",Re,[J(d.$slots,"caption",{},()=>[c[3]||(c[3]=I("Progress"))])]),c[4]||(c[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(s(!0),n(R,null,Z(e.value,(r,m)=>(s(),n("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Be,g(m+1),1),t("td",Fe,[$(bt,{user:r},null,8,["user"])]),t("td",Ve,g(i(z)(r.task_started_at)),1),t("td",Ge,g(i(z)(r.task_finished_at)),1)]))),128))])]))}}}),He=St("task-user",()=>({updateUserStartDate:async(e,u,d)=>await yt.patch(`/task-user/task/${e}/user/${u}/update-start-date/${d}`),updateUserFinishDate:async(e,u,d)=>await yt.patch(`/task-user/task/${e}/user/${u}/update-finish-date/${d}`)})),ze={class:"border-b text-center"},We={key:0},Ze={key:1},Ke={class:"text-center font-semibold text-blue-800 my-4"},Je={class:"flex justify-center w-full"},Ye={class:"py-6 w-4/12"},Qe={class:"block text-xs font-semibold"},Xe={class:"mt-3"},ts={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},es={class:"flex justify-between items-center"},$t={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(k,{emit:l}){const e=k,u=l,d=He(),c=M(""),b=M("");async function f(){var m,p;console.log({date:c.value});try{e.type=="start-date"?await d.updateUserStartDate(e.task.id,e.user.id,c.value||"0"):e.type=="finish-date"&&await d.updateUserFinishDate(e.task.id,e.user.id,c.value||"0"),u("updateDate")}catch(_){b.value=((p=(m=_.response)==null?void 0:m.data)==null?void 0:p.message)||`Failed to update ${e.type}`}}function r(m){if(m){const p=e.type==="start-date"?m.started_at:m.completed_at;c.value=zt(p)}}return Y(()=>e.task,m=>{r(m)},{immediate:!0}),st(()=>{r(e.task)}),(m,p)=>(s(),n("form",{class:"p-4",onSubmit:A(f,["prevent"])},[t("div",ze,[k.type=="start-date"?(s(),n("h2",We,"Edit Start Date")):k.type=="finish-date"?(s(),n("h2",Ze,"Edit Completed Date")):y("",!0)]),t("div",Ke,g(k.task.title),1),t("div",Je,[t("div",Ye,[t("label",Qe,g(k.type=="start-date"?"Start date":"Completed date"),1),et(t("input",{type:"date","onUpdate:modelValue":p[0]||(p[0]=_=>c.value=_),class:"border py-2 px-4 rounded-md w-full"},null,512),[[ht,c.value]])])]),p[3]||(p[3]=t("hr",{class:"mt-4"},null,-1)),t("div",Xe,[b.value?(s(),n("div",ts,g(b.value),1)):y("",!0)]),t("div",es,[t("button",{class:"btn-3",onClick:p[1]||(p[1]=A(_=>u("closeClick"),["prevent"]))},"Close"),p[2]||(p[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},ss={key:0},as={key:1,class:"flex"},ls={class:"border-r-2 border-dashed pr-6 border-gray-300"},ns={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},os={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},rs={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},is={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},ds={key:0},us=["disabled"],cs=["disabled"],ps={class:"text-lg font-semibold text-gray-700"},ks={class:"text-sm text-gray-500"},ms={class:"flex flex-grow justify-center items-center"},fs={key:0,class:"flex flex-col justify-center items-center"},ys={key:1},vs={key:1},bs={key:2,class:"flex justify-center items-center flex-col"},xs={key:3,class:"flex flex-col justify-center items-center"},gs={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},_s={class:"my-6"},hs={class:"text-center font-semibold text-blue-800 mb-4"},Ts={class:"text-center my-1"},$s={class:"border px-2 rounded-md bg-gray-50"},ws={class:"text-red-600 text-center mt-2 text-sm"},Cs={class:"flex justify-between mt-3"},Ss={class:"btn-2"},Ds={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(k,{emit:l}){const e=k,u=l,d=X(),c=M(""),b=M(),f=M(),r=K({user:null,type:""});function m(T){r.user=d.user,r.type=T}const p={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},_=D(()=>(p==null?void 0:p[x.value])||0),v=D(()=>{var T;return{"bg-yellow-50":x.value==="IN_PROGRESS","bg-green-50":x.value==="COMPLETED","bg-red-50":x.value==="PENDING","bg-blue-50":(T=e.task)==null?void 0:T.closed_at}}),x=D(()=>{var T;return(T=e.task)==null?void 0:T.status}),w=D(()=>x.value=="PENDING"?"Start":x.value=="IN_PROGRESS"?"Finish":x.value=="COMPLETED"?"Close":""),N=D(()=>w.value=="Start"?"Start Task":w.value=="Finish"?"Finish Task":w.value=="Close"?"Close Task":"");async function U(){var T,o;b.value="submitting";try{await Ht(e.task.id,{status:c.value}),c.value="",u("updateStatus")}catch(L){f.value=(o=(T=L.response)==null?void 0:T.data)==null?void 0:o.message,u("error")}finally{b.value=""}}const S=D(()=>w.value=="Start"?"fas fa-play-circle text-blue-500":w.value=="Finish"?"fas fa-stop-circle text-blue-500":""),a=D(()=>{var T,o,L,B,F,V,h,G;return[{date:z((T=e.task)==null?void 0:T.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((o=e.task)!=null&&o.assigned_at)},{date:z((L=e.task)==null?void 0:L.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((B=e.task)!=null&&B.started_at)||_.value>=p.IN_PROGRESS},{date:z((F=e.task)==null?void 0:F.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((V=e.task)!=null&&V.completed_at)||_.value>=p.COMPLETED},{date:z((h=e.task)==null?void 0:h.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((G=e.task)!=null&&G.deadline)}].sort((O,j)=>O.date===null||j.date===null||new Date(O.date)==new Date(j.date)?O.serial-j.serial:new Date(O.date)-new Date(j.date))});return(T,o)=>{var L,B,F,V;return s(),n("div",{class:q(["border py-8 px-4 rounded",v.value])},[x.value==="BLOCKED"?(s(),n("div",ss,o[8]||(o[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(s(),n("div",as,[t("div",ls,[(L=e.task)!=null&&L.is_target?(s(),n("div",ns,o[9]||(o[9]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),I(" TARGET TASK ")]))):y("",!0),t("ol",os,[(s(!0),n(R,null,Z(a.value,(h,G)=>{var O,j;return s(),n("li",{class:"ml-5",key:G},[t("div",rs,[h.active?(s(),n("i",{key:0,class:q([h.icon,"text-xs"])},null,2)):y("",!0)]),t("div",{class:q({"opacity-30":!h.active})},[t("div",is,[h.date?(s(),n("span",ds,g(h.date),1)):y("",!0),((O=e.task)==null?void 0:O.children_task_count)===0&&h.status==="started"&&h.active?(s(),n("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:o[0]||(o[0]=A(()=>m("start-date"),["prevent"])),disabled:!!e.task.closed_at},g(h.date?"Edit":"Set Date"),9,us)):y("",!0),((j=e.task)==null?void 0:j.children_task_count)===0&&h.active&&h.status==="completed"?(s(),n("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:o[1]||(o[1]=A(()=>m("finish-date"),["prevent"])),disabled:!!e.task.closed_at},g(h.date?"Edit":"Set Date"),9,cs)):y("",!0)]),t("h3",ps,g(h.title),1),t("p",ks,g(h.description),1)],2)])}),128))])]),t("div",ms,[(B=k.task)!=null&&B.closed_at?(s(),n("div",fs,o[10]||(o[10]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):x.value==="PENDING"?(s(),n("div",ys,[((F=k.task)==null?void 0:F.children_task_count)===0?(s(),n("button",{key:0,class:"btn-3 mt-2",onClick:o[2]||(o[2]=A(h=>c.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(s(),n("div",vs,o[11]||(o[11]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),t("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):x.value==="IN_PROGRESS"?(s(),n("div",bs,[o[12]||(o[12]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),o[13]||(o[13]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((V=k.task)==null?void 0:V.children_task_count)===0?(s(),n("button",{key:0,class:"btn-3",onClick:o[3]||(o[3]=A(h=>c.value="COMPLETED",["prevent"]))}," Finish Task ")):y("",!0)])):x.value==="COMPLETED"?(s(),n("div",xs,[o[14]||(o[14]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),o[15]||(o[15]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:o[4]||(o[4]=A(h=>c.value="CLOSED",["prevent"]))},"Close Task")])):y("",!0)])])),c.value?(s(),E(H,{key:2},{default:P(()=>{var h;return[t("form",{class:"p-4 rounded relative",onSubmit:A(U,["prevent"])},[b.value==="submitting"?(s(),E(Q,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:P(()=>o[16]||(o[16]=[I("Submitting!")])),_:1,__:[16]})):y("",!0),t("h3",gs,g(N.value),1),t("div",_s,[t("div",hs,g((h=k.task)==null?void 0:h.title),1),o[19]||(o[19]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",Ts,[o[17]||(o[17]=I(" Want to ")),t("span",$s,[t("i",{class:q(["text-sm",S.value])},null,2),I(" "+g(w.value),1)]),o[18]||(o[18]=I(" the task? "))])]),o[20]||(o[20]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",ws,g(f.value),1),t("div",Cs,[t("button",{class:"btn-3",onClick:o[5]||(o[5]=A(G=>c.value="",["prevent"]))},"Cancel"),t("button",Ss,[t("i",{class:q(["text-xl text-white",S.value])},null,2),I(" "+g(w.value)+" Task ",1)])])])],32)]}),_:1})):y("",!0),r!=null&&r.user?(s(),E(H,{key:3},{default:P(()=>[$($t,{task:e.task,user:r.user,type:r.type,onCloseClick:o[6]||(o[6]=h=>r.user=null),onUpdateDate:o[7]||(o[7]=()=>{r.user=null,r.type=null,u("updateStatus")})},null,8,["task","user","type"])]),_:1})):y("",!0)],2)}}},Is={class:"container mx-auto p-6"},Es={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},Ps={class:"grid grid-cols-4"},Ls={class:"mb-4 flex col-span-full"},Us={class:"font-medium text-xl"},As={class:"flex items-center gap-3 text-xs text-gray-500 mt-2 opacity-80 text-left"},Ms={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-2 py-[2px] rounded-full border border-green-200 opacity-80"},Ns={class:"font-semibold"},Os={class:"mt-2 col-span-full flex items-center"},js={class:"text-gray-400 text-xs"},Rs={class:"flex items-center gap-0.5"},Bs={class:"text-sky-400 text-sm font-semibold"},Fs={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},Vs={class:"col-span-full mb-4"},Gs=["innerHTML"],qs={key:0,class:"mt-4 col-span-full mb-6"},Hs={class:"mt-2 py-2 flex flex-col lg:flex-row gap-y-4 justify-center items-center gap-2 col-span-full"},zs={class:"flex items-center gap-4 flex-wrap justify-center"},Ws=["disabled"],Zs={class:"lg:ml-auto flex gap-4 items-center"},Ks={key:0},Js={key:2},Ys={key:1,class:"text-center py-4 text-red-500"},Ia={__name:"TaskShow",setup(k){const l=Kt(),e=tt(),u=Dt(),d=M(""),c=D(()=>l.tasks),b=M({}),f=K({open:!1,task:null});st(async()=>{d.value="loading",await m(e.params.id),d.value="",e.hash=="#sub-tasks"&&setTimeout(()=>xt(e.hash,66),0)});const r=K({user:null,type:""});async function m(S){await l.fetchTask(S)}const p=D(()=>Tt(l.task.users,l.task.task_reports||[]));async function _(){await m(e.params.id),r.user=null,r.type=""}const v=S=>{u.push({name:"TaskEdit",params:{id:S}})},x=D(()=>{var S,a;return l.task?((S=l.task)==null?void 0:S.parent_id)==0?{name:U.value?"MyTaskList":"TaskList"}:{params:{id:(a=l.task)==null?void 0:a.parent_id},query:{"is-my-task":U.value}}:null});function w(){f.open=!0,f.task=l.task}function N(){f.open=!1,console.log({STATE:"Deleted",backLink:x.value}),u.push(x.value)}const U=D(()=>e.name=="MyTaskShow"||!!e.query["is-my-task"]);return Y(()=>e.params.id,async S=>{d.value="changing",await m(S),d.value=""}),Y(()=>e.hash,async function(){setTimeout(()=>xt(e.hash,66),0)}),(S,a)=>{var L,B,F,V,h,G,O,j,at,lt,nt,ot,rt,it,dt,ut,ct,pt,kt,mt,ft;const T=vt("RouterLink"),o=vt("router-view");return s(),n("div",Is,[r.user?(s(),E(H,{key:0},{default:P(()=>[$($t,{task:i(l).task,user:r.user,type:r.type,onCloseClick:a[0]||(a[0]=C=>r.user=null),onUpdateDate:_},null,8,["task","user","type"])]),_:1})):y("",!0),f.open?(s(),E(H,{key:1},{default:P(()=>[$(Se,{onCloseClick:a[1]||(a[1]=C=>f.open=!1),task:f.task,onDelete:N},null,8,["task"])]),_:1})):y("",!0),d.value==="loading"?(s(),E(Q,{key:2})):(s(),n("div",Es,[i(l).task?(s(),n(R,{key:0},[t("section",Ps,[t("div",Ls,[t("div",null,[t("h2",Us,g(i(l).task.title),1),t("div",As,[i(l).task.parent_id==0?(s(),n("div",Ms," MAIN TASK ")):y("",!0),t("div",Ns,"#"+g((L=i(l).task)==null?void 0:L.serial),1),(B=i(l).task)!=null&&B.is_important?(s(),E(Ft,{key:1})):y("",!0),(F=i(l).task)!=null&&F.is_urgent?(s(),E(Vt,{key:2})):y("",!0)]),t("div",Os,[t("div",js,[a[13]||(a[13]=t("i",{class:"fas fa-clock"},null,-1)),I(" "+g(i(Wt)(i(l).task.created_at)),1)]),(V=i(l).task)!=null&&V.created_by_user?(s(),n(R,{key:0},[a[14]||(a[14]=t("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),t("div",Rs,[$(It,{user:(h=i(l).task)==null?void 0:h.created_by_user,class:"!size-4 ml-1"},null,8,["user"]),t("div",Bs,g((O=(G=i(l).task)==null?void 0:G.created_by_user)==null?void 0:O.label),1)])],64)):y("",!0)])]),t("div",Fs,[$(Zt,{status:(j=i(l).task)==null?void 0:j.status,progressPercent:(at=i(l).task)==null?void 0:at.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),i(l).task?(s(),E(Rt,{key:0,task:i(l).task,ref_key:"progress",ref:b,class:"!text-lg"},null,8,["task"])):y("",!0)])]),t("div",Vs,[$(Et,null,{default:P(()=>{var C;return[t("p",{innerHTML:(C=i(l).task)==null?void 0:C.description,class:"text-justify"},null,8,Gs)]}),_:1})]),$(Bt,{task:(lt=i(l))==null?void 0:lt.task,"tree-level":(ot=(nt=i(l))==null?void 0:nt.task)==null?void 0:ot.level,class:"justify-center border col-span-full border-dashed rounded-lg"},null,8,["task","tree-level"]),i(l).task.children_task_count>0?(s(),n("section",qs,[$(qe,{"task-users":((rt=i(l).task)==null?void 0:rt.users)||[],task:i(l).task,"sub-tasks":i(l).tasks,"progress-users":p.value},{caption:P(()=>a[15]||(a[15]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):y("",!0),(it=i(l))!=null&&it.task?(s(),E(Ds,{key:1,task:((dt=i(l))==null?void 0:dt.task)||{},class:"col-span-full mt-4",onUpdateStatus:a[2]||(a[2]=()=>{var C,W;return m((W=(C=i(l))==null?void 0:C.task)==null?void 0:W.id)})},null,8,["task"])):y("",!0),t("div",Hs,[t("div",zs,[t("button",{onClick:a[3]||(a[3]=A(C=>{var W;return v((W=i(l).task)==null?void 0:W.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!i(l).task.closed_at},a[16]||(a[16]=[t("i",{class:"fas fa-edit"},null,-1),I(" Edit ")]),8,Ws),$(T,{to:{name:"TaskUserAssign",params:{id:(ut=i(l).task)==null?void 0:ut.id}},class:q(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",i(l).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:a[4]||(a[4]=C=>C.stopPropagation())},{default:P(()=>a[17]||(a[17]=[t("i",{class:"fas fa-users-cog"},null,-1),I(" Assign Users ")])),_:1,__:[17]},8,["to","class"]),t("button",{class:"border-2 border-indigo-500 hover:bg-indigo-500 hover:text-white text-indigo-500 font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none whitespace-nowrap",onClick:a[5]||(a[5]=C=>i(u).back())},a[18]||(a[18]=[t("i",{class:"fas fa-arrow-left"},null,-1),I(" Back ")])),$(T,{to:x.value,class:"border-2 border-indigo-500 hover:bg-indigo-500 hover:text-white ml-2 text-indigo-500 font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none whitespace-nowrap",onClick:a[6]||(a[6]=C=>C.stopPropagation())},{default:P(()=>a[19]||(a[19]=[t("i",{class:"fas fa-arrow-left"},null,-1),I(" Parent Task ")])),_:1,__:[19]},8,["to"])]),t("div",Zs,[((ct=i(l).task)==null?void 0:ct.children_task_count)===0&&((pt=i(l).task)==null?void 0:pt.status)==="PENDING"?(s(),n("button",{key:0,class:"btn-2-red h-8",onClick:A(w,["prevent"])}," Delete ")):y("",!0),c.value.length>0?(s(),E(T,{key:1,to:{name:U.value||i(e).query["is-my-task"]?"MyTaskShow":"TaskShow",params:{id:(kt=i(l).task)==null?void 0:kt.id},hash:"#sub-tasks"},onClick:a[7]||(a[7]=C=>C.stopPropagation()),class:q(["py-0.5 btn-3 ml-auto text-sm h-8 whitespace-nowrap",{"bg-blue-500 text-white":i(e).name=="TaskShow"||i(e).name==="MyTaskShow"}])},{default:P(()=>a[20]||(a[20]=[t("i",{class:"fal fa-list-ul"},null,-1),I(" Sub Tasks ")])),_:1,__:[20]},8,["to","class"])):y("",!0),$(T,{to:{name:"TaskReports",params:{id:(mt=i(l).task)==null?void 0:mt.id},query:{"is-my-task":U.value},hash:"#task-reports"},onClick:a[8]||(a[8]=C=>C.stopPropagation()),class:q(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":i(e).name=="TaskReports"}])},{default:P(()=>a[21]||(a[21]=[t("i",{class:"fal fa-file-alt"},null,-1),I(" Reports ")])),_:1,__:[21]},8,["to","class"])])])]),a[22]||(a[22]=t("div",{id:"sub-tasks"},null,-1)),(i(e).name=="TaskShow"||i(e).name==="MyTaskShow")&&((ft=i(l).task)==null?void 0:ft.level)<=2?(s(),n("section",Ks,[$(re,{subTasks:c.value,"parent-id":i(e).params.id,"sub-task-is-creatable":!i(l).task.closed_at,"tree-level":i(l).task.level+1,onCreated:a[9]||(a[9]=C=>m(i(e).params.id)),onUpdated:a[10]||(a[10]=C=>m(i(e).params.id)),onUpdatePriority:a[11]||(a[11]=C=>m(i(e).params.id)),onAssignUser:a[12]||(a[12]=C=>m(i(e).params.id))},null,8,["subTasks","parent-id","sub-task-is-creatable","tree-level"])])):y("",!0),i(e).name==="TaskReportAdd"?(s(),E(H,{key:1,class:"*:bg-transparent"},{default:P(()=>[$(o)]),_:1})):(s(),n("section",Js,[$(o)]))],64)):(s(),n("div",Ys,g(i(l).error),1)),d.value==="changing"?(s(),E(Q,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):y("",!0)]))])}}};export{Ia as default};
