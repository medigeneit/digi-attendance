import{O as H}from"./OverlyModal-B6mOyd3y.js";import{r as F,m as j,e as Y,n as G,c as d,o as n,p as z,a as e,F as O,q as A,t as m,g as I,f as N,s as P,x as k,i as w,k as _,R as J,w as U,y as K,h as Q,v as X,j as b,d as Z,z as V,u as tt,A as et}from"./index-Va8zAUrJ.js";import{u as st}from"./useTaskStore-gVtt_r3s.js";import{_ as at}from"./TaskTreeView-cl6BJADR.js";import{u as nt}from"./user-BCGwlVX1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./datetime-oI5ZP223.js";import"./url-CePbr-gY.js";import"./UserChip-Bd2YN5FE.js";const ot={class:"grid grid-cols-7 *:text-center *:p-2 *:border-r *:border-b *:text-blue-800 *:text-sm"},lt={class:"flex flex-col"},rt={class:"p-2 border-r border-t"},it={__name:"CalenderView",props:{month:{type:String,required:!0,validator:D=>/^\d{4}-(0[1-9]|1[0-2])$/.test(D)}},emits:["change"],setup(D,{emit:M}){const o=D,g=M,C=F(),f=F(),v=F(),y=F(),R=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function x(t,i,c,h){const p=[];for(let $=c-1;$>=0;$--){const S=h-$,T=new Date(t,i-1,S);p.push({date:T,day:T.getDate(),month:T.getMonth()+1,year:T.getFullYear(),isCurrentMonth:!1})}return p}function q(t,i,c){const h=[];for(let p=1;p<=c;p++){const S={date:new Date(t,i,p),day:p,month:i+1,year:t,isCurrentMonth:!0};h.push(S)}return h}function u(t,i,c){const h=[...t],p=Math.ceil(h.length/7)*7,$=1;for(let S=0;h.length<p;S++){const T=new Date(i,c+1,$+S);h.push({date:T,day:T.getDate(),month:T.getMonth()+1,year:T.getFullYear(),isCurrentMonth:!1})}return h}function s(t,i){const c=new Date(t,i,1),p=new Date(t,i+1,0).getDate(),S=(c.getDay()+1)%7,E=new Date(t,i,0).getDate();let L=[];L=[...x(t,i,S,E)];const B=q(t,i,p);return v.value=B[0],y.value=B[B.length-1],L=[...L,...B],L=[...u(L,t,i)],C.value=L[0],f.value=L[L.length-1],L}const a=j(()=>{const[t,i]=o.month.split("-"),c=parseInt(t),h=parseInt(i)-1;return s(c,h)}),r=j(()=>{const t=a.value,i=[];for(let c=0;c<t.length;c+=7)i.push(t.slice(c,c+7));return i});function l(){g("change",{gridStartDate:C.value,gridEndDate:f.value,startOfMonth:v.value,endOfMonth:y.value})}return Y(()=>l()),G(()=>o.month,l),(t,i)=>(n(),d("div",null,[z(t.$slots,"calender-top"),e("div",ot,[(n(),d(O,null,A(R,c=>e("div",{key:c},m(c),1)),64))]),e("div",lt,[(n(!0),d(O,null,A(r.value,(c,h)=>(n(),d("div",{class:"week grid grid-cols-7 min-h-28",key:h},[(n(!0),d(O,null,A(c,(p,$)=>z(t.$slots,"date",{key:$,day:p.day,month:p.month,year:p.year,weekday:(p.date.getDay()+1)%7,isCurrentMonth:p.isCurrentMonth},()=>[e("div",rt,m(p.getDate()),1)])),128))]))),128))]),z(t.$slots,"calender-bottom")]))}},dt={key:0},ut={key:0,class:"fad fa-folder text-xs mr-2"},ct={key:1,class:"fad fa-file-alt text-xs mr-2"},mt={key:2,class:"text-center w-full mt-4 text-xs text-gray-600"},W={__name:"TaskListOnDay",props:{isCurrentMonth:{type:Boolean,default:!1},tasks:{type:Array,default:()=>[]},limit:{type:Number,default:null},tree:{type:Boolean,default:!1}},emits:["clickOnMore"],setup(D,{emit:M}){const o=D,g=M,C=j(()=>{var f;return o.limit?((f=o==null?void 0:o.tasks)==null?void 0:f.slice(0,o.limit))||[]:[...o.tasks]});return(f,v)=>(n(),d("div",null,[D.tree?(n(),d("div",dt,[(n(!0),d(O,null,A(C.value,y=>(n(),N(at,{task:y,key:y.id,class:"mb-6"},null,8,["task"]))),128))])):(n(),d("ul",{key:1,class:P({"text-gray-500 group-hover:text-gray-900":!D.isCurrentMonth})},[(n(!0),d(O,null,A(C.value,y=>(n(),d("li",{class:"mb-2",key:y.id},[k(_(J),{to:`/tasks/${y.id}`,target:"_blank",class:"flex items-center hover:underline hover:text-blue-600"},{default:w(()=>[y.children_task_count>0?(n(),d("i",ut)):I("",!0),y.children_task_count==0?(n(),d("i",ct)):I("",!0),e("span",{class:P(["line-clamp-1",{"text-red-800":y.deadline_crossed}])},m(y.title),3)]),_:2},1032,["to"])]))),128))],2)),D.tasks.length-C.value.length>0?(n(),d("div",mt,[e("button",{onClick:v[0]||(v[0]=U(y=>g("clickOnMore",y),["prevent"])),class:"text-blue-600 hover:underline"}," +"+m(D.tasks.length-C.value.length)+" More Tasks ",1)])):I("",!0)]))}},pt={class:"relative"},yt={class:"px-4 py-2 flex items-center bg-gray-50 group"},ht={class:"ml-auto"},gt=["onClick"],ft={key:0,class:"absolute inset-0 bg-white bg-opacity-90"},xt={class:"absolute inset-16 bg-white border border-blue-500 rounded-md z-20 overflow-y-auto"},bt={class:"text-lg font-semibold mb-4 sticky top-0 border-b border-blue-200 px-4 z-30 py-3 bg-white flex items-center"},vt={__name:"TaskInMonth",setup(D){const M=F("2025-08"),o=K({day:null,month:null,year:null}),g=st();function C(u){u.stopPropagation(),o.day=null,o.month=null,o.year=null}function f(u,s,a,r){u.stopPropagation(),o.day=s,o.month=a,o.year=r}async function v({gridStartDate:u,gridEndDate:s,startOfMonth:a,endOfMonth:r}){console.log({gridStartDate:u,gridEndDate:s,startOfMonth:a,endOfMonth:r}),await g.fetchTasks()}const y=(u,s,a)=>{const r=new Date;return u===r.getDate()&&s===r.getMonth()+1&&a===r.getFullYear()},R=(u,s,a)=>u===o.day&&s===o.month&&a===o.year,x=(u,s,a,r)=>{const l=y(u,s,a);return{"bg-green-100 text-green-900 border-blue-500 border-2 scale-105 z-10":l,"border-r border-t hover:border border-blue-200  hover:scale-105 hover:z-20 hover:bg-blue-50":!l,"bg-gray-50":!r}},q=(u,s,a)=>{const r=new Date(a,s-1,u);return g==null?void 0:g.tasks.filter(l=>{if(!l.users.some(c=>c.id===4))return!1;const t=l.deadline?new Date(l.deadline):null,i=new Date;if(console.log({today:i}),l.assigned_at||l.created_at){let c=new Date(l.assigned_at);if(!l.assigned_at&&l.created_at){const p=new Date(l.created_at);c=new Date(p.getFullYear(),p.getMonth(),p.getDate())}let h=null;return l.completed_at&&(h=new Date(l.completed_at)),c<=r&&(!h||h>=r)&&(!t||t>=r||r<=i)}return!1}).map(l=>{let t=!1;return l.deadline&&(t=new Date(l.deadline)<r),{...l,deadline_crossed:t}})};return(u,s)=>(n(),d("div",pt,[e("div",yt,[s[1]||(s[1]=e("h2",{class:"leading-none font-semibold text-lg"},"Task List",-1)),Q(e("input",{type:"month","onUpdate:modelValue":s[0]||(s[0]=a=>M.value=a),class:"ml-auto border px-2 rounded"},null,512),[[X,M.value]])]),k(it,{month:M.value,class:"border-t border-blue-200/50 relative",onChange:v},{date:w(({day:a,month:r,year:l,isCurrentMonth:t})=>[e("div",{tabindex:"0",class:P(["transition origin-center p-2 outline-blue-600 outline-1 cursor-pointer",x(a,r,l,t)])},[e("div",{class:P(["font-bold w-full flex items-center",{"text-gray-300":!t}])},[e("div",null,m(a),1),e("div",ht,[R(a,r,l)?I("",!0):(n(),d("button",{key:0,class:"btn-icon",onClick:U(i=>f(i,a,r,l),["prevent"])},s[2]||(s[2]=[e("i",{class:"fas fa-expand-arrows text-gray-400 hover:text-gray-600"},null,-1)]),8,gt))])],2),k(W,{"is-current-month":t,tasks:q(a,r,l),limit:"3",class:"text-xs mt-4",onClickOnMore:i=>f(i,a,r,l)},null,8,["is-current-month","tasks","onClickOnMore"])],2)]),"calender-bottom":w(()=>[o.day?(n(),d("div",ft,[e("div",xt,[e("div",bt,[b(" Tasks for "+m(o.day)+"/"+m(o.month)+"/"+m(o.year)+" ",1),e("button",{class:"ml-auto",type:"button",onClick:U(C,["prevent"])},s[3]||(s[3]=[e("i",{class:"fas fa-times"},null,-1)]))]),k(W,{class:"p-4","is-current-month":u.isCurrentMonth,tasks:q(o.day,o.month,o.year),tree:!0},null,8,["is-current-month","tasks"])])])):I("",!0)]),_:1},8,["month"])]))}},_t={class:"container px-6 mx-auto"},wt={key:0,class:"grid gap-4 md:grid-cols-3 mt-4"},kt={class:"text-3xl"},Dt={class:"text-3xl"},Mt={class:"text-3xl"},Ct={class:"text-3xl"},Tt={class:"text-3xl"},$t={class:"text-3xl"},Lt={key:1,class:"w-full mt-4"},St={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ot={class:"bg-white shadow-md rounded-lg p-4"},At={class:"space-y-2"},Pt={class:"flex justify-between items-center px-4 py-2 rounded hover:bg-gray-50 transition-colors"},Rt={class:"font-semibold text-gray-800"},qt={key:0},Ft={key:1},It={key:2},Bt={class:"space-y-3"},jt={class:"flex items-center space-x-4"},zt={class:"absolute top-10 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs rounded py-1 px-2 opacity-0 group-hover:opacity-100 transition pointer-events-none z-10 whitespace-nowrap"},Nt={class:"text-sm font-medium text-gray-900"},Ut={class:"text-xs text-gray-500 mt-0.5"},Vt={class:"text-xl font-bold text-gray-800 flex items-center gap-2 p-4"},Wt={class:"space-y-5 px-4 md:px-6 py-4"},Yt={class:"text-sm text-gray-500 flex items-center gap-2"},Et={class:"flex justify-end gap-3 mt-6"},Ht={class:"bg-white shadow-md rounded-lg"},Gt={class:"overflow-x-auto shadow-md sm:rounded-lg min-h-max"},Jt={class:"min-w-full text-sm text-left text-gray-500"},Kt={class:"px-6 py-4 font-medium text-gray-900"},Qt={class:"px-6 py-4"},Xt={class:"px-6 py-4"},Zt={class:"px-6 py-4"},te={class:"card-bg mt-4 gap-0 shadow-md border border-gray-300"},me={__name:"DashBoard",setup(D){const M=Z(),o=nt(),{dashboardInfo:g,selectedDate:C,userDashboard:f}=V(o),{user:v}=V(M),y=tt(),R=j(()=>{var u;return["admin","super_admin","developer"].includes((u=v==null?void 0:v.value)==null?void 0:u.role)}),x=F(null);Y(async()=>{var s,a;v.value||await M.fetchUser(),await o.fetchUserDashboardData(),R.value&&await o.fetchAdminDashboardData();const u=(a=(s=f.value)==null?void 0:s.notices)==null?void 0:a.find(r=>!r.user_feedback);u&&(x.value=u)});const q=()=>{if(!x.value)return;const u=x.value.type===1?`/notice-details/${x.value.id}`:`/policy-details/${x.value.id}`;y.push(u)};return(u,s)=>{var r,l;const a=et("RouterLink");return n(),d("div",_t,[R.value&&_(M).isAdminMood?(n(),d("div",wt,[k(a,{to:{name:"TodayAttendanceReport",query:{search:"all"}},class:"main-button"},{default:w(()=>{var t;return[e("span",kt,m((t=_(g))==null?void 0:t.totalUsers),1),s[2]||(s[2]=b(" Total Employees "))]}),_:1,__:[2]}),k(a,{to:{name:"TodayAttendanceReport",query:{search:"Present"}},class:"main-button"},{default:w(()=>{var t;return[e("span",Dt,m((t=_(g))==null?void 0:t.todayPresents),1),s[3]||(s[3]=b(" Today Present "))]}),_:1,__:[3]}),k(a,{to:{name:"TodayAttendanceReport",query:{search:"Absent"}},class:"main-button"},{default:w(()=>{var t;return[e("span",Mt,m((t=_(g))==null?void 0:t.todayAbsents),1),s[4]||(s[4]=b(" Today Absent "))]}),_:1,__:[4]}),k(a,{to:{name:"LeaveApplicationList",query:{search:"today"}},class:"main-button"},{default:w(()=>{var t;return[e("span",Ct,m((t=_(g))==null?void 0:t.todayLeaves),1),s[5]||(s[5]=b(" Today Leave "))]}),_:1,__:[5]}),k(a,{to:{name:"LeaveApplicationList",query:{search:"tomorrow"}},class:"main-button"},{default:w(()=>{var t;return[e("span",Tt,m((t=_(g))==null?void 0:t.tomorrowLeaves),1),s[6]||(s[6]=b(" Tomorrow Leave "))]}),_:1,__:[6]}),k(a,{to:{name:"ShortLeaveList",query:{search:_(C)}},class:"main-button"},{default:w(()=>{var t;return[e("span",$t,m((t=_(g))==null?void 0:t.todayShortLeaves),1),s[7]||(s[7]=b(" Today Short Leaves "))]}),_:1,__:[7]},8,["to"])])):(n(),d("div",Lt,[e("div",St,[e("div",Ot,[e("div",At,[s[11]||(s[11]=e("div",{class:"flex items-center"},[e("i",{class:"fas fa-file mr-2 h-5 w-5"}),e("h2",{class:"text-xl font-semibold"},"Applications")],-1)),(n(!0),d(O,null,A((r=_(f))==null?void 0:r.current_month_leave,t=>(n(),N(a,{to:{name:"MyLeaveApplicationShow",params:{id:t.id}},key:t.id},{default:w(()=>[e("div",Pt,[e("h3",Rt," Leave Application #"+m(t.id),1),e("p",{class:P(["text-sm font-medium flex items-center space-x-2",{"bg-gray-500 py-1.5 rounded-full px-4 text-white":t.status===null,"bg-yellow-500 py-1.5 rounded-full px-4 text-white":t.status==="Pending","bg-green-500 py-1.5 rounded-full px-4 text-white":t.status==="approved"}])},[t.status===null?(n(),d("span",qt,s[8]||(s[8]=[e("i",{class:"fas fa-clock mr-2"},null,-1),b(" Wait for Hanover ")]))):t.status==="Pending"?(n(),d("span",Ft,s[9]||(s[9]=[e("i",{class:"fas fa-hourglass-half mr-2"},null,-1),b(" Pending ")]))):(n(),d("span",It,s[10]||(s[10]=[e("i",{class:"fas fa-check-circle mr-2"},null,-1),b(" Approved ")])))],2)])]),_:2},1032,["to"]))),128))]),s[16]||(s[16]=e("div",{class:"flex justify-between items-start mb-4"},[e("div",{class:"flex items-center"},[e("i",{class:"fas fa-file mr-2 h-5 w-5"}),e("h2",{class:"text-xl font-semibold"},"Notices")])],-1)),e("div",Bt,[(n(!0),d(O,null,A(_(f).notices,(t,i)=>(n(),d("div",{key:i,class:"flex items-center justify-between p-4 border rounded-lg shadow-sm hover:shadow transition-all bg-white"},[e("div",jt,[e("div",{class:P([["rounded-full",t.user_feedback?"bg-green-100":"bg-red-100"],"h-8 w-8 flex items-center justify-center rounded-full"])},[e("span",{class:P(["h-3 w-3",t.user_feedback?"bg-green-600":"bg-red-600","rounded-full inline-block"])},null,2),e("div",zt,m(t.user_feedback?"Feedback Submitted":"Feedback Pending"),1)],2),e("div",null,[e("p",Nt,m(t.title),1),e("p",Ut,m(t.published_at),1)])]),k(a,{to:t.type===1?`/notice-details/${t.id}`:`/policy-details/${t.id}`,class:"text-blue-600 hover:text-blue-800 font-semibold text-sm"},{default:w(()=>s[12]||(s[12]=[b(" View ")])),_:2,__:[12]},1032,["to"])]))),128)),x.value?(n(),N(H,{key:0,show:!0,onClose:s[1]||(s[1]=t=>x.value=null)},{default:w(()=>[e("div",Vt,[s[13]||(s[13]=e("i",{class:"fas fa-bell text-blue-500"},null,-1)),b(" "+m(x.value.title),1)]),e("div",Wt,[e("p",Yt,[s[14]||(s[14]=e("i",{class:"fas fa-calendar-alt text-gray-400"},null,-1)),b(" Published: "+m(x.value.published_at),1)]),s[15]||(s[15]=e("p",{class:"text-base text-gray-700 leading-relaxed"}," You must read this notice before proceeding. ",-1)),e("div",Et,[e("button",{onClick:s[0]||(s[0]=t=>x.value=null),class:"bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium px-5 py-2 rounded-lg transition"}," Cancel "),e("button",{onClick:q,class:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2.5 rounded-lg shadow transition"}," Read Details ")])])]),_:1})):I("",!0)])]),e("div",Ht,[s[18]||(s[18]=e("h2",{class:"text-xl font-semibold py-3 px-4"},"Leave Balance",-1)),e("div",Gt,[e("table",Jt,[s[17]||(s[17]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3"},"Type"),e("th",{scope:"col",class:"px-6 py-3"},"Total Days"),e("th",{scope:"col",class:"px-6 py-3"},"Used Days"),e("th",{scope:"col",class:"px-6 py-3"},"Remaining Days")])],-1)),e("tbody",null,[(n(!0),d(O,null,A((l=_(f))==null?void 0:l.leave_balance,t=>(n(),d("tr",{key:t.id,class:"border-b hover:bg-gray-100"},[e("td",Kt,m(t.leave_type),1),e("td",Qt,m(t.annual_quota),1),e("td",Xt,m(t.used_days),1),e("td",Zt,m(t.remaining_days),1)]))),128))])])])])]),e("div",te,[k(vt)])]))])}}};export{me as default};
