import{f as me,r as p,D as ge,x as n,q as V,h as fe,c as a,o,k as v,a as t,t as r,b as f,F as m,e as g,l as A,G as L,v as R,s as O,n as W}from"./index-oQTcVtne.js";import{u as be}from"./notice-Beh4fCWT.js";const ye={class:"space-y-6"},he={key:0,class:"mx-auto max-w-7xl rounded-3xl border border-gray-100 bg-white/90 p-6 shadow"},we={class:"flex flex-wrap items-center justify-between gap-4"},ke={class:"text-xl font-semibold text-gray-900"},_e={class:"text-sm text-gray-500"},Ce={class:"text-sm text-gray-500"},Fe={class:"font-semibold text-gray-900"},Ne={class:"mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},Ae={class:"mt-2 flex flex-wrap gap-2"},Me={key:0,class:"text-xs text-gray-400"},Se={class:"mt-2 flex flex-wrap gap-2"},De={key:0,class:"text-xs text-gray-400"},Pe={class:"mt-2 flex flex-wrap gap-2"},Te={key:0,class:"text-xs text-gray-400"},Ve={class:"text-sm text-gray-700"},je={class:"text-gray-500"},Ee={class:"max-w-7xl mx-auto rounded-3xl border border-gray-100 bg-white/80 p-6 shadow"},Ue={class:"flex flex-col gap-3 pb-4 sm:flex-row sm:items-center sm:justify-between"},Be=["disabled"],Le={key:0,class:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor","stroke-width":"1.8",viewBox:"0 0 24 24"},Re={key:1,class:"mr-2 h-5 w-5 animate-spin text-white",viewBox:"0 0 24 24",fill:"none"},Oe={class:"grid gap-4 md:grid-cols-2 xl:grid-cols-4"},$e={class:"flex flex-col gap-2 text-sm text-gray-600"},qe=["value"],Ge={class:"flex flex-col gap-2 text-sm text-gray-600"},Ie=["value"],Ze={class:"flex flex-col gap-2 text-sm text-gray-600"},Qe={class:"flex flex-col gap-2 text-sm text-gray-600"},ze={class:"mt-4 flex flex-wrap gap-3"},He={class:"relative flex-1"},We={key:0,class:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},Je={class:"mx-auto max-w-7xl space-y-6 rounded-3xl bg-white p-6 shadow-xl"},Ke={class:"flex flex-col gap-2 border-b border-gray-100 pb-4 sm:flex-row sm:items-end"},Xe={class:"text-sm text-gray-500"},Ye={class:"sm:ml-auto flex flex-col gap-2 sm:items-end"},et={class:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-gray-500"},tt=["value"],st={key:0,class:"space-y-4",role:"status","aria-live":"polite"},lt={class:"grid gap-3"},at={key:1},ot={key:0,class:"overflow-hidden rounded-3xl border border-gray-100 shadow-sm ring-1 ring-black/5"},rt={class:"overflow-x-auto"},nt={class:"min-w-full divide-y divide-gray-100 text-left text-sm text-gray-700"},it={class:"divide-y divide-gray-100 bg-white"},dt={class:"px-6 py-4 font-semibold text-gray-900"},ut={class:"px-6 py-4 whitespace-nowrap"},ct={class:"font-medium text-gray-900"},pt={class:"text-xs text-gray-500"},xt={class:"px-6 py-4 whitespace-nowrap"},vt={class:"px-6 py-4 whitespace-nowrap"},mt={class:"px-6 py-4"},gt={class:"text-sm leading-relaxed text-gray-700"},ft={class:"px-6 py-4 whitespace-nowrap text-gray-600"},bt={key:1,class:"flex flex-col items-center justify-center rounded-3xl border border-dashed border-gray-200 bg-gray-50 px-6 py-16 text-center"},yt={key:2,class:"flex flex-col gap-4 border-t border-gray-100 pt-4 sm:flex-row sm:items-center sm:justify-between"},ht={class:"text-sm text-gray-500"},wt={class:"flex flex-wrap gap-2"},kt=["disabled"],_t=["onClick","disabled"],Ct=["disabled"],At={__name:"NoticeFeedbackList",props:{noticeId:{type:[String,Number],required:!0}},setup(J){const j=me(),D=be();function K(l,e=300){let s;return function(...c){clearTimeout(s),s=setTimeout(()=>{l.apply(this,c)},e)}}const X=J,b=p(""),d=p(1),y=p(20),C=p(!1),M=p(!1),h=p("all"),w=p("all"),k=p(""),_=p(""),x=p(!1),Y=Object.freeze([10,20,50,100]),{feedbacks:P,notice:i,totalFeedbacks:E}=ge(D),U=n(()=>{var l;return((l=j==null?void 0:j.params)==null?void 0:l.id)??X.noticeId}),ee=n(()=>b.value.trim().length>0),te=n(()=>(d.value-1)*y.value),se=n(()=>{const l=new Set;return P.value.forEach(e=>{var c;const s=(c=e==null?void 0:e.company)==null?void 0:c.name;s&&l.add(s)}),Array.from(l).sort((e,s)=>e.localeCompare(s))}),le=n(()=>{const l=new Set;return P.value.forEach(e=>{var c;const s=(c=e==null?void 0:e.department)==null?void 0:c.name;s&&l.add(s)}),Array.from(l).sort((e,s)=>e.localeCompare(s))}),T=n(()=>P.value),ae=n(()=>T.value.length),oe=n(()=>!C.value&&!T.value.length),S=n(()=>{const l=Math.ceil((E.value||0)/y.value);return l>0?l:1}),re=n(()=>{const l=[],s=Math.max(1,d.value-2),c=Math.min(S.value,d.value+2);for(let N=s;N<=c;N+=1)l.push(N);return l}),ne=n(()=>d.value<=1),ie=n(()=>d.value>=S.value),$=n(()=>{let l=0;return h.value!=="all"&&(l+=1),w.value!=="all"&&(l+=1),k.value&&(l+=1),_.value&&(l+=1),x.value&&(l+=1),l}),de=n(()=>$.value>0),q=()=>{const l={page:d.value,per_page:y.value},e=b.value.trim();return e&&(l.search=e),h.value!=="all"&&(l.company=h.value),w.value!=="all"&&(l.department=w.value),k.value&&(l.start_date=k.value),_.value&&(l.end_date=_.value),x.value&&(l.has_feedback=!0),l},F=async(l=!1)=>{try{C.value=!0,l&&(P.value=[],d.value=1),await D.fetchFeedbacks(U.value,{params:q()})}catch(e){console.error("Error fetching feedbacks:",e)}finally{C.value=!1}},B=l=>{if(!l)return"--";const e=new Date(l);return Number.isNaN(e.getTime())?"--":e.toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"})},G=l=>l?Array.isArray(l)?l:l.split(",").map(e=>e.trim()).filter(Boolean):[],ue=l=>Number(l)===1?"General":Number(l)===2?"Policy":"Other",u=n(()=>!i.value||!i.value.id?null:{title:i.value.title,type:i.value.type?ue(i.value.type):"Notice",receivers:i.value.receiver_label&&!Array.isArray(i.value.receiver_type)?G(i.value.receiver_label):G(i.value.receiver_type),companies:i.value.companies_notice??[],departments:i.value.departments??[],publishedAt:i.value.published_at,expiredAt:i.value.expired_at,feedbackCount:i.value.user_feedback_count??E.value});V(U,l=>{l&&D.fetchNotice(l)},{immediate:!0});const ce=()=>{b.value&&(b.value="",F(!0))},I=l=>{const e=Math.min(Math.max(1,l),S.value);e!==d.value&&(d.value=e,F())},Z=l=>{I(d.value+l)},pe=()=>{h.value="all",w.value="all",k.value="",_.value="",x.value=!1},xe=K(()=>{F(!0)},400);V(b,()=>{xe()}),V([h,w,k,_,x],()=>{F(!0)}),V(y,()=>{F(!0)}),fe(()=>{F()});const ve=async()=>{try{M.value=!0,await D.downloadFeedbackUserExcel(U.value,q())}catch(l){console.error("Error exporting feedbacks:",l)}finally{M.value=!1}};return(l,e)=>(o(),a("div",ye,[u.value?(o(),a("section",he,[t("div",we,[t("div",null,[e[9]||(e[9]=t("p",{class:"text-xs font-semibold uppercase tracking-widest text-indigo-500"},"Current notice",-1)),t("h2",ke,r(u.value.title||"Untitled notice"),1),t("p",_e,"Type: "+r(u.value.type),1)]),t("div",Ce,[e[10]||(e[10]=f(" Feedbacks: ")),t("span",Fe,r(u.value.feedbackCount||0),1)])]),t("div",Ne,[t("div",null,[e[11]||(e[11]=t("p",{class:"text-xs font-semibold uppercase tracking-wider text-gray-500"},"Receivers",-1)),t("div",Ae,[(o(!0),a(m,null,g(u.value.receivers,s=>(o(),a("span",{key:s,class:"rounded-full bg-blue-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-blue-700"},r(s),1))),128)),u.value.receivers.length?v("",!0):(o(),a("span",Me,"All employees"))])]),t("div",null,[e[12]||(e[12]=t("p",{class:"text-xs font-semibold uppercase tracking-wider text-gray-500"},"Companies",-1)),t("div",Se,[(o(!0),a(m,null,g(u.value.companies,s=>(o(),a("span",{key:s.id,class:"rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-600"},r(s.name),1))),128)),u.value.companies.length?v("",!0):(o(),a("span",De,"Multiple companies"))])]),t("div",null,[e[13]||(e[13]=t("p",{class:"text-xs font-semibold uppercase tracking-wider text-gray-500"},"Departments",-1)),t("div",Pe,[(o(!0),a(m,null,g(u.value.departments,s=>(o(),a("span",{key:s.id,class:"rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-600"},r(s.name),1))),128)),u.value.departments.length?v("",!0):(o(),a("span",Te,"All departments"))])]),t("div",null,[e[14]||(e[14]=t("p",{class:"text-xs font-semibold uppercase tracking-wider text-gray-500"},"Publish window",-1)),t("p",Ve,[f(r(B(u.value.publishedAt))+" – ",1),t("span",je,r(B(u.value.expiredAt)),1)])])])])):v("",!0),t("section",Ee,[t("div",Ue,[e[17]||(e[17]=t("div",null,[t("p",{class:"text-xs font-semibold uppercase tracking-widest text-indigo-500"},"Smart Filters"),t("h4",{class:"text-lg font-semibold text-gray-900"},"Refine by metadata & time")],-1)),t("div",null,[t("button",{onClick:ve,disabled:M.value,class:"group inline-flex items-center justify-center rounded-2xl bg-green-600 px-5 py-3 font-medium text-white shadow-lg shadow-green-200 transition hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-70"},[M.value?(o(),a("svg",Re,e[16]||(e[16]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8v4l3-3-3-3v4a8 8 0 0 0-8 8h3Z"},null,-1)]))):(o(),a("svg",Le,e[15]||(e[15]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3h8v4m-4 7V5m-5 7 5 5 5-5M4 19h16"},null,-1)]))),t("span",null,r(M.value?"Generating…":"Export Excel"),1)],8,Be),de.value?(o(),a("button",{key:0,onClick:pe,class:"inline-flex items-center rounded-full bg-gray-100 px-4 py-2 text-sm font-medium text-gray-600 transition hover:bg-gray-200"}," Clear filters ("+r($.value)+") ",1)):v("",!0)])]),t("div",Oe,[t("label",$e,[e[19]||(e[19]=f(" Company ")),A(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),class:"rounded-2xl border border-gray-200 px-4 py-2.5 text-gray-800 outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},[e[18]||(e[18]=t("option",{value:"all"},"All companies",-1)),(o(!0),a(m,null,g(se.value,s=>(o(),a("option",{key:s,value:s},r(s),9,qe))),128))],512),[[L,h.value]])]),t("label",Ge,[e[21]||(e[21]=f(" Department ")),A(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),class:"rounded-2xl border border-gray-200 px-4 py-2.5 text-gray-800 outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},[e[20]||(e[20]=t("option",{value:"all"},"All departments",-1)),(o(!0),a(m,null,g(le.value,s=>(o(),a("option",{key:s,value:s},r(s),9,Ie))),128))],512),[[L,w.value]])]),t("label",Ze,[e[22]||(e[22]=f(" From date ")),A(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),type:"date",class:"rounded-2xl border border-gray-200 px-4 py-2.5 text-gray-800 outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},null,512),[[R,k.value]])]),t("label",Qe,[e[23]||(e[23]=f(" To date ")),A(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>_.value=s),type:"date",class:"rounded-2xl border border-gray-200 px-4 py-2.5 text-gray-800 outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},null,512),[[R,_.value]])])]),t("div",ze,[t("div",He,[e[24]||(e[24]=t("span",{class:"pointer-events-none absolute inset-y-0 left-4 flex items-center text-gray-400","aria-hidden":"true"},[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-4.35-4.35M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"})])],-1)),A(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>b.value=s),type:"search",class:"w-full rounded-2xl border bg-white/80 px-10 py-3 text-base shadow-inner outline-none transition focus:border-blue-300 focus:bg-white focus:ring-2 focus:ring-blue-200",placeholder:"Search employees, departments, or companies..."},null,512),[[R,b.value]]),ee.value?(o(),a("button",{key:0,onClick:ce,class:"absolute inset-y-0 right-3 flex items-center rounded-full bg-gray-100 px-3 text-xs font-medium text-gray-500 shadow-sm transition hover:bg-gray-200"}," Clear ")):v("",!0)]),t("button",{type:"button",onClick:e[5]||(e[5]=s=>x.value=!x.value),class:O(["inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition",x.value?"bg-blue-600 text-white shadow-lg shadow-blue-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[t("span",{class:O(["flex h-5 w-5 items-center justify-center rounded-full border",x.value?"border-white bg-white/20 text-white":"border-gray-400 bg-white text-gray-500"])},[x.value?(o(),a("svg",We,e[25]||(e[25]=[t("path",{"fill-rule":"evenodd",d:"M16.704 4.153a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06L8.5 11.06l6.97-6.908a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"},null,-1)]))):v("",!0)],2),e[26]||(e[26]=f(" Only entries with written feedback "))],2)])]),t("section",Je,[t("header",Ke,[t("div",null,[e[27]||(e[27]=t("p",{class:"text-sm font-semibold uppercase tracking-widest text-blue-500"},"Feedback",-1)),e[28]||(e[28]=t("h3",{class:"title-md text-2xl font-semibold text-gray-900"},"Employee Feedbacks",-1)),t("p",Xe,r(ae.value)+" of "+r(W(E))+" entries • Updated automatically ",1)]),t("div",Ye,[e[30]||(e[30]=t("span",{class:"inline-flex items-center justify-center rounded-full bg-blue-50 px-3 py-1 text-xs font-semibold uppercase text-blue-600"}," Live Table ",-1)),t("label",et,[e[29]||(e[29]=f(" Rows per page ")),A(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>y.value=s),class:"rounded-full border border-gray-200 px-3 py-1 text-sm font-medium text-gray-700 outline-none focus:border-blue-300 focus:ring-1 focus:ring-blue-200"},[(o(!0),a(m,null,g(W(Y),s=>(o(),a("option",{key:s,value:s},r(s),9,tt))),128))],512),[[L,y.value,void 0,{number:!0}]])])])]),C.value?(o(),a("div",st,[e[31]||(e[31]=t("div",{class:"h-4 w-1/3 animate-pulse rounded-full bg-gray-100"},null,-1)),t("div",lt,[(o(),a(m,null,g(5,s=>t("div",{key:`skeleton-${s}`,class:"h-16 animate-pulse rounded-2xl bg-gray-100"})),64))]),e[32]||(e[32]=t("p",{class:"text-center text-sm text-gray-400"},"Fetching the latest feedback…",-1))])):(o(),a("div",at,[T.value.length?(o(),a("div",ot,[t("div",rt,[t("table",nt,[e[33]||(e[33]=t("thead",{class:"bg-gray-50 text-xs font-semibold uppercase tracking-wider text-gray-500"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-4"},"#"),t("th",{scope:"col",class:"px-6 py-4"},"User"),t("th",{scope:"col",class:"px-6 py-4"},"Company"),t("th",{scope:"col",class:"px-6 py-4"},"Department"),t("th",{scope:"col",class:"px-6 py-4"},"Feedback"),t("th",{scope:"col",class:"px-6 py-4"},"Date")])],-1)),t("tbody",it,[(o(!0),a(m,null,g(T.value,(s,c)=>{var N,Q,z,H;return o(),a("tr",{key:s.id,class:"transition hover:bg-blue-50/60"},[t("td",dt,r(te.value+c+1),1),t("td",ut,[t("p",ct,r((s==null?void 0:s.name)||"--"),1),t("p",pt,r(s==null?void 0:s.email),1)]),t("td",xt,r(((N=s==null?void 0:s.company)==null?void 0:N.name)||"N/A"),1),t("td",vt,r(((Q=s==null?void 0:s.department)==null?void 0:Q.name)||"N/A"),1),t("td",mt,[t("p",gt,r(((z=s==null?void 0:s.feedback)==null?void 0:z.feedback)||"No feedback submitted."),1)]),t("td",ft,r(B((H=s==null?void 0:s.feedback)==null?void 0:H.submitted_at)),1)])}),128))])])])])):oe.value?(o(),a("div",bt,e[34]||(e[34]=[t("svg",{class:"mb-4 h-14 w-14 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 8h10M7 12h6m3.5 8H7a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4h6l6 6v6"})],-1),t("p",{class:"text-lg font-semibold text-gray-700"},"No feedback yet",-1),t("p",{class:"text-sm text-gray-500"}," Try adjusting your search or check back again after more submissions. ",-1)]))):v("",!0),S.value>1?(o(),a("div",yt,[t("div",ht," Page "+r(d.value)+" of "+r(S.value)+" • "+r(y.value)+" per page ",1),t("div",wt,[t("button",{onClick:e[7]||(e[7]=s=>Z(-1)),disabled:ne.value||C.value,class:"inline-flex items-center rounded-full border border-gray-200 px-3 py-1.5 text-sm font-medium text-gray-600 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60"}," Prev ",8,kt),(o(!0),a(m,null,g(re.value,s=>(o(),a("button",{key:s,onClick:c=>I(s),disabled:s===d.value,class:O(["inline-flex items-center rounded-full px-3 py-1.5 text-sm font-semibold transition",s===d.value?"bg-blue-600 text-white shadow":"border border-gray-200 text-gray-600 hover:bg-gray-50"])},r(s),11,_t))),128)),t("button",{onClick:e[8]||(e[8]=s=>Z(1)),disabled:ie.value||C.value,class:"inline-flex items-center rounded-full border border-gray-200 px-3 py-1.5 text-sm font-medium text-gray-600 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60"}," Next ",8,Ct)])])):v("",!0)]))])]))}};export{At as default};
