import{R as E,r as v,q as f,S as i}from"./index-Y58fDv_x.js";const O=E("task",()=>{const c=v([]),k=v(null),u=v(!1),o=v(null),p=async(e,r)=>{var a,s;u.value=!0,o.value=null;try{await i.post(`/tasks/${e}/assign-users`,{user_ids:r}),await y(e)}catch(l){throw o.value=((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Assign users failed",l}finally{u.value=!1}},w=async(e,{loadingBeforeFetch:r=!0})=>{var a,s,l;r&&(u.value=!0),o.value=null;try{const t=await i.get("/tasks",{params:e});c.value=((a=t.data)==null?void 0:a.tasks)||[]}catch(t){o.value=((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",t)}finally{u.value=!1}};function h(e,r=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>a.parent_id===r).map(a=>({...a,children_tasks:h(e,a.id)}))}function g(){return h(c.value,0)}function T(){const e=[],r=(a,s=0,l="")=>{a.forEach(t=>{e.push({...t,depth:s,idPath:l+t.id}),t.children_tasks&&t.children_tasks.length&&r(t.children_tasks,s+1,l+t.id+"-")})};return r(g()),e}const y=async(e,r={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var s,l,t;a.fetchOnly||(u.value=!0),o.value=null;try{const n=await i.get(`/tasks/${e}`,{params:r});return a.fetchOnly||(k.value=((s=n.data)==null?void 0:s.task)||{}),n.data}catch(n){const d=((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(o.value=d),d}finally{a.fetchOnly||(u.value=!1)}},m=async(e,r={loadingBeforeCreate:!1})=>{var a,s,l,t;r.loadingBeforeCreate&&(u.value=!0),o.value=null;try{const n=await i.post("/tasks",e);return(a=n.data)!=null&&a.data&&c.value.push((s=n.data)==null?void 0:s.data),n.data.data}catch(n){throw o.value=((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",n),n}finally{r.loadingBeforeCreate&&(u.value=!1)}},$=async(e,r,a={loadingBeforeFetch:!0})=>{var s,l;a.loadingBeforeFetch&&(u.value=!0),o.value=null;try{const t=await i.put(`/tasks/${e}`,r),n=c.value.findIndex(d=>d.id===e);return n!==-1&&(c.value[n]=t.data.data),t.data.data}catch(t){throw o.value=((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||`টাস্ক (ID: ${e}) আপডেট করতে ব্যর্থ হয়েছে।`,console.error(`Error updating task with id ${e}:`,t),t}finally{a.loadingBeforeFetch&&(u.value=!1)}},B=async(e,r)=>(await i.put(`/tasks/${e}/update-priorities`,{task_ids:r})).data,_=async e=>{var r,a;u.value=!0,o.value=null;try{await i.delete(`/tasks/${e}`),c.value=c.value.filter(s=>s.id!==e)}catch(s){o.value=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,s)}finally{u.value=!1}};return{tasks:f(()=>c.value),task:f(()=>k.value),loading:f(()=>u.value),error:f(()=>o.value),taskListTree:f(g),flattenedTasks:f(T),fetchTasks:w,fetchTask:y,createTask:m,updateTask:$,deleteTask:_,assignUsers:p,updateTaskPriorities:B}});export{O as u};
