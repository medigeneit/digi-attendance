import{r as y,x as z,h as le,q as ze,c as a,o as n,j as u,a as e,i as I,F as H,e as K,t as b,m as P,s as B,d as w,M as de,l as R,w as A,G as X,p as Ue,b as E,k as Be,v as Ee,C as Me,g as Fe,Q as Ge,y as Ve,A as Pe,f as We,u as Ye}from"./index-BSFvUyOI.js";import{u as Qe}from"./useCommentStore-CcqFxBd1.js";import{_ as He}from"./TextEditor-rKkK730W.js";import{O as Y}from"./OverlyModal-DLw5eMXs.js";import{L as ie}from"./LoaderView-fdm0zcJ_.js";import{_ as Ke}from"./ShareComponent-W3KaEWux.js";import{_ as Ne}from"./DepartmentChip-UqNGMzfO.js";import{_ as Z}from"./DescriptionView-BrTGlZ7_.js";import{i as Je,f as Le,a as Xe,_ as Ze,b as et}from"./TaskTableRow-C-SMGmXM.js";import{b as tt,r as st,c as rt,f as me,d as nt,s as at}from"./requirement-BQefwWx0.js";import{_ as lt}from"./AttachmentPreview-B4SV1b3x.js";import{_ as ae}from"./UserChip-kih0ryBi.js";import{o as ot}from"./url-CePbr-gY.js";import{u as it}from"./user-x4Fo4ad0.js";import{_ as In,a as dt}from"./TaskUserAssignForm-CnUUn_AY.js";import{u as ut}from"./useTaskStore-5LuHv0FS.js";import{_ as mt}from"./TaskSelectionInput-Jbf37rnh.js";import{_ as ct}from"./TaskAddForm-1RfxoJqK.js";import{_ as pt}from"./TaskEditForm-C61XtAVf.js";import{T as oe}from"./TextWithHr-CQzSuZIJ.js";import{d as ue,b as vt}from"./datetime-BEfC2TVK.js";import{c as bt}from"./dom-Bic1TNqD.js";import{_ as ft}from"./ApproveAndReject-DKwcf-9r.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgentBadge-D2xl4QpD.js";import"./TaskTitle-D9A0o5-k.js";import"./TaskAssignedUsers-vDDbfhcI.js";import"./TaskIsClosedBadge-CbqP6U67.js";import"./TaskUrgencyInput-0Cpl4dAl.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-C6z6f-zt.js";import"./SelectDropdown-D4CC1MdM.js";import"./RequiredIcon-DAUmytPD.js";import"./company-BQckrdLT.js";import"./CompanyDepartmentSelectInput-ppm-DpK9.js";import"./SectionLoading-CEQAiLhh.js";import"./tags-V4BBjz1s.js";import"./MultiselectDropdown-D9-Ko0fj.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-B5_wWfo8.js";const xt={class:"space-y-4"},yt={key:0,class:"space-y-2"},gt={class:"text-xs opacity-80"},_t=["onClick"],kt={class:"space-y-4"},ht={key:0,class:"text-sm text-gray-500"},wt={key:1,class:"text-sm text-gray-500"},qt={key:0,class:"shrink-0"},$t={class:"text-sm font-semibold text-gray-800"},Ct={class:"text-xs text-gray-400"},Tt=["innerHTML"],St=["onClick"],Rt={key:1,class:"mt-2 space-y-1"},jt={key:1,class:"shrink-0"},It={class:"bg-white rounded-xl shadow-sm border p-4 space-y-3"},Dt={class:"flex items-center gap-2"},At={class:"text-sm font-semibold text-gray-700"},Nt={class:"flex items-center justify-end gap-2"},Lt=["disabled"],Ot={key:0,class:"text-xs text-red-600"},Ut={class:"bg-white rounded-2xl w-full max-w-md p-5 space-y-4"},Bt={class:"rounded-xl bg-slate-50 border border-slate-100 p-3 text-sm text-gray-700 max-h-40 overflow-auto"},Et=["innerHTML"],Mt={__name:"CommentBox",props:{commentableType:{type:String,required:!0},commentableId:{type:[Number,String],required:!0},currentUser:{type:Object,required:!0}},setup(x){const q=x,o=y(!1),m=y(null),f=g=>{m.value=g,o.value=!0},v=()=>{o.value=!1,m.value=null},d=async()=>{if(!m.value)return;const g=m.value.id;v(),await O(g)},c=y([]),s=y({}),j=g=>{g&&c.value.push({id:crypto.randomUUID(),message:g,time:new Date().toISOString()})},i=(g,S)=>{!g||!S||(s.value[g]||(s.value[g]=[]),s.value[g].push(S))},r=g=>{s.value[g]=[]},l=Qe(),p=z(()=>l.comments),k=z(()=>l.loading),h=z(()=>l.error),$=y(""),N=y(!1),C=async()=>{await l.fetchComments({commentable_type:q.commentableType,commentable_id:q.commentableId})},D=async()=>{if(!(!$.value||!$.value.trim())){N.value=!0;try{await l.createComment({commentable_type:q.commentableType,commentable_id:Number(q.commentableId),user_id:q.currentUser.id,message:$.value}),$.value=""}catch(g){j(g.message)}finally{N.value=!1}}},O=async g=>{var S,L;r(g);try{await l.deleteComment(g)}catch(t){i(g,(L=(S=t.response)==null?void 0:S.data)==null?void 0:L.message)}};le(C),ze(()=>[q.commentableType,q.commentableId],()=>C());const ee=g=>g?new Date(g).toLocaleString():"",T=g=>(g==null?void 0:g.user_id)===q.currentUser.id,U=g=>(g==null?void 0:g.user_id)===q.currentUser.id;return(g,S)=>{var L;return n(),a("div",xt,[c.value.length?(n(),a("div",yt,[(n(!0),a(H,null,K(c.value,t=>(n(),a("div",{key:t.id,class:"rounded-xl border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-700 flex items-start justify-between gap-3"},[e("div",null,[S[1]||(S[1]=e("p",{class:"font-semibold"},"Error",-1)),e("p",gt,b(t.message),1)]),e("button",{class:"text-xs text-red-500 hover:underline",onClick:G=>c.value=c.value.filter(M=>M.id!==t.id)}," Dismiss ",8,_t)]))),128))])):u("",!0),e("div",kt,[k.value&&P(l).action=="fetching"?(n(),a("div",ht," Loading comments... ")):p.value.length?u("",!0):(n(),a("div",wt,"No comments yet.")),(n(!0),a(H,null,K(p.value,t=>{var G,M;return n(),a("div",{key:t.id,class:B(["flex gap-3",U(t)?"justify-end":"justify-start"])},[U(t)?u("",!0):(n(),a("div",qt,[w(de,{user:t.user},null,8,["user"])])),e("div",{class:B(["group relative min-w-[50%] max-w-[90%] rounded-md px-4 py-3 shadow-sm border",U(t)?"bg-indigo-50 border-indigo-100":"bg-white border-gray-100"])},[e("div",{class:B(["flex items-center gap-2 mb-1",U(t)?"justify-end":"justify-start"])},[e("p",$t,b(U(t)?"You":((G=t.user)==null?void 0:G.name)||"Unknown"),1),S[2]||(S[2]=e("span",{class:"text-xs text-gray-400"},"•",-1)),e("p",Ct,b(ee(t.created_at)),1)],2),e("div",{class:"prose prose-sm max-w-none text-gray-700 leading-relaxed text-sm",innerHTML:t.message},null,8,Tt),T(t)?(n(),a("div",{key:0,class:B(["mt-2 flex",U(t)?"justify-end":"justify-start"])},[e("button",{class:"text-[11px] text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100",onClick:W=>f(t)}," Delete ",8,St)],2)):u("",!0),(M=s.value[t.id])!=null&&M.length?(n(),a("div",Rt,[(n(!0),a(H,null,K(s.value[t.id],(W,J)=>(n(),a("p",{key:J,class:B(["text-xs text-red-600",U(t)?"text-right":"text-left"])},b(W),3))),128))])):u("",!0)],2),U(t)?(n(),a("div",jt,[w(de,{user:t.user||x.currentUser},null,8,["user"])])):u("",!0)],2)}),128))]),e("div",It,[e("div",Dt,[w(de,{user:x.currentUser},null,8,["user"]),e("div",At,b(((L=x.currentUser)==null?void 0:L.name)||"You"),1)]),w(He,{modelValue:$.value,"onUpdate:modelValue":S[0]||(S[0]=t=>$.value=t)},null,8,["modelValue"]),e("div",Nt,[e("button",{class:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm disabled:opacity-60",disabled:N.value||!$.value.trim(),onClick:D},b(N.value?"Posting...":"Post Comment"),9,Lt)]),h.value?(n(),a("p",Ot,b(h.value),1)):u("",!0)]),o.value?(n(),I(Y,{key:1},{default:R(()=>{var t;return[e("div",Ut,[S[3]||(S[3]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete comment?",-1)),S[4]||(S[4]=e("p",{class:"text-sm text-gray-600 leading-relaxed"}," আপনি কি নিশ্চিত যে এই কমেন্টটি মুছে ফেলতে চান? মুছে ফেলা কমেন্ট পুনরুদ্ধার করা যাবে না। ",-1)),e("div",Bt,[e("div",{innerHTML:(t=m.value)==null?void 0:t.message},null,8,Et)]),e("div",{class:"flex items-center justify-end gap-2 pt-2"},[e("button",{class:"px-4 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-50",onClick:v}," Cancel "),e("button",{class:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700",onClick:d}," Yes, Delete ")])])]}),_:1})):u("",!0)])}}},Ft={class:"flex items-center border-b w-full pb-2"},Vt={class:""},Pt={class:"mt-4 border h-40 flex items-center flex-col justify-center rounded border-dashed bg-red-50 text-center"},Ht={key:1,class:"text-red-500 text-center mt-2"},zt={class:"flex items-center justify-between mt-4"},Gt={__name:"RequirementAttachmentForm",props:{requirementId:[String,Number],default:()=>null},emits:["uploaded","error","clickBack"],setup(x,{emit:q}){const o=x,m=y({attachments:[]}),f=y(""),v=y(""),d=q;function c(i){m.value.attachments=[...m.value.attachments,...Array.from(i.target.files)]}function s(i){m.value.attachments.splice(i,1)}async function j(){var r,l,p,k;f.value="submitting";const i=new FormData;for(const h in m.value)h==="attachments"?m.value.attachments.forEach($=>i.append("attachments[]",$)):i.append(h,m.value[h]);try{const h=await tt(o.requirementId,i);m.value.attachments=[],d("uploaded",h),f.value="uploaded"}catch(h){d("error",(l=(r=h.response)==null?void 0:r.data)==null?void 0:l.message),v.value=(k=(p=h.response)==null?void 0:p.data)==null?void 0:k.message,f.value="error"}}return(i,r)=>{var l;return n(),a("form",{class:"p-4 flex flex-col relative",onSubmit:A(j,["prevent"])},[f.value=="submitting"?(n(),I(ie,{key:0,class:"absolute inset-0 bg-opacity-80 flex items-center justify-center"})):u("",!0),e("div",Ft,[r[3]||(r[3]=e("h3",null,"Requirement Attachment",-1)),e("button",{class:"btn-icon ml-auto",onClick:r[0]||(r[0]=A(()=>{d("clickBack")},["prevent"]))},r[2]||(r[2]=[e("span",{class:"fas fa-times"},null,-1)]))]),e("div",Vt,[e("label",Pt,[r[4]||(r[4]=e("div",{class:"block text-gray-600 font-medium text-sm md:text-xl mb-4"}," Click to Select files or Drop Here ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",class:"border rounded-r-md text-gray-600 bg-gray-50",onChange:c},null,32)])]),w(lt,{files:((l=m.value)==null?void 0:l.attachments)||[],onRemove:s,class:"border p-1 rounded overflow-y-auto flex-grow"},null,8,["files"]),r[6]||(r[6]=e("hr",{class:"mt-4"},null,-1)),v.value?(n(),a("div",Ht,b(v.value),1)):u("",!0),e("div",zt,[e("button",{class:"btn-3",onClick:r[1]||(r[1]=A(p=>d("clickBack"),["prevent"]))},"Cancel"),r[5]||(r[5]=e("button",{class:"btn-2"},"Save",-1))])],32)}}},Wt={class:"card-bg p-4 pt-2"},Yt={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 w-full"},Qt=["onClick"],Kt=["src"],Jt=["href"],Xt={key:2,class:"text-xs text-gray-500 text-center"},Zt={__name:"RequirementAttachments",props:{requirement:{type:Array,default:()=>[]}},setup(x){const q=x,o=z(()=>{var v;return((v=q.requirement)==null?void 0:v.attachments)||[]}),m=X({show:!1}),f=X({show:!1,selectedFile:""});return(v,d)=>(n(),a("div",Wt,[e("div",null,[d[6]||(d[6]=e("h4",{class:"text-gray-900 font-semibold mb-3 border-b font-e"},"Attachments",-1)),e("div",Yt,[o.value&&o.value.length?(n(!0),a(H,{key:0},K(o.value,(c,s)=>(n(),a("div",{key:s,class:"border p-1 rounded aspect-square flex items-center justify-center bg-gray-50 relative",tabindex:"0",onClick:A(()=>{f.show=!0,f.selectedFile=c},["prevent"])},[P(Je)(c)?(n(),a("img",{key:0,src:P(Le)(c),alt:"attachment",class:"object-cover w-full h-full rounded"},null,8,Kt)):P(Xe)(c)?(n(),a("a",{key:1,href:P(Le)(c),target:"_blank",class:"text-xs text-blue-600 text-center break-words hover:underline"},d[4]||(d[4]=[e("i",{class:"fas fa-file-pdf fa-2x mb-1 text-amber-700"},null,-1),e("div",{class:"whitespace-nowrap text-xs mt-1"},"Open PDF",-1)]),8,Jt)):(n(),a("span",Xt,"Unknown"))],8,Qt))),128)):u("",!0),e("button",{title:"Add Attachments",onClick:d[0]||(d[0]=A(c=>m.show=!m.show,["prevent"])),class:"border rounded aspect-square flex items-center justify-center bg-sky-50 hover:bg-sky-100 relative group/btn"},d[5]||(d[5]=[e("i",{class:"fas fa-plus-circle text-2xl text-blue-300 group-hover/btn:text-blue-500"},null,-1)]))])]),m.show?(n(),I(Y,{key:0},{default:R(()=>[w(Gt,{onClickBack:d[1]||(d[1]=c=>m.show=!1),onUploaded:d[2]||(d[2]=c=>m.show=!1),requirementId:x.requirement.id,class:"max-h-[70vh]"},null,8,["requirementId"])]),_:1})):u("",!0),f.show?(n(),I(Y,{key:1,class:"*:max-w-4xl *:min-h-[60vh]"},{default:R(()=>[w(Ze,{attachments:o.value,selected:f.selectedFile,onClickClose:d[3]||(d[3]=c=>f.show=!1)},null,8,["attachments","selected"])]),_:1})):u("",!0)]))}},es={key:0,class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},ts={class:"text-sm flex flex-col xl:flex-row items-center mt-2 xl:mt-0 gap-x-2 text-red-400 font-semibold whitespace-nowrap"},ss={class:"mt-[2px]"},rs={key:0,class:"text-gray-800 flex items-center gap-2"},ns={key:1,class:"text-gray-800 w-full my-2 text-center"},as={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},ls=["innerHTML"],os={class:"flex gap-4 items-center justify-center mt-2"},is={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick"],setup(x,{emit:q}){const o=q;return(m,f)=>{var v;return(v=x.requirement)!=null&&v.closed_at?(n(),a("div",es,[f[4]||(f[4]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",ts,[f[1]||(f[1]=e("span",{class:"flex items-center gap-2 text-gray-600"},[e("span",{class:"fad fa-lock"}),e("span",{class:"mt-[2px]"},"CLOSED AT")],-1)),e("span",ss,b(new Date(x.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),x.requirement.closed_by_user?(n(),a("div",rs,[f[2]||(f[2]=e("span",{class:"text-sm"},"Closed by",-1)),w(ae,{user:x.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):u("",!0),x.requirement.closing_note?(n(),a("div",ns,[f[3]||(f[3]=e("div",{class:"text-x"},"Closing Note",-1)),e("div",as,[e("p",{innerHTML:x.requirement.closing_note},null,8,ls)])])):u("",!0),e("div",os,[e("button",{class:"btn-2 h-8",onClick:f[0]||(f[0]=A(d=>o("reOpenClick"),["prevent"]))},"Re Open")])])):u("",!0)}}},ds={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},us={class:"my-6"},ms={class:"text-center font-semibold text-blue-800 mb-4"},cs={class:"text-center my-1"},ps={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},vs={class:"mt-4"},bs=["placeholder","required"],fs={class:"flex"},xs={class:"text-red-600 text-center mt-2 text-sm"},ys={class:"flex justify-between mt-3"},gs={class:"btn-2"},_s={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(x,{emit:q}){const o=x,m=q,f=z({get:()=>o.loading,set:()=>m("update:loading")}),v=y(""),d=y(""),c=y(255),s=z(()=>c.value-v.value.length);async function j(){var i,r,l;f.value=!0;try{(i=o.requirement)!=null&&i.closed_at?await st(o.requirement.id,v.value):await rt(o.requirement.id,v.value),m("updateStatus")}catch(p){d.value=(l=(r=p.response)==null?void 0:r.data)==null?void 0:l.message,m("error")}finally{f.value=!1}}return(i,r)=>{var p,k,h,$,N;const l=Ue("LoaderView");return n(),a("form",{class:"p-4 rounded relative border",onSubmit:A(j,["prevent"])},[f.value?(n(),I(l,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:R(()=>r[3]||(r[3]=[E(" Submitting! ")])),_:1,__:[3]})):u("",!0),e("h3",ds,b((p=x.requirement)!=null&&p.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",us,[e("div",ms,b((k=x.requirement)==null?void 0:k.title),1),r[6]||(r[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",cs,[r[4]||(r[4]=E(" Want to ")),e("span",ps,b((h=x.requirement)!=null&&h.closed_at?"Re-Open":"Close"),1),r[5]||(r[5]=E(" the requirement? "))]),e("div",vs,[Be(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=C=>v.value=C),rows:"4",placeholder:`Write about why are you ${($=x.requirement)!=null&&$.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:i.currentAction==="reject",onInput:r[1]||(r[1]=C=>v.value.length>c.value?v.value=v.value.slice(0,c.value):null)},null,40,bs),[[Ee,v.value]]),e("div",fs,[e("div",{class:B(["ml-auto inline-block text-sm text-gray-500",v.value.length>=c.value?"text-red-500":""])}," left "+b(s.value)+"/"+b(c.value)+" words ",3)])])]),r[7]||(r[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",xs,b(d.value),1),e("div",ys,[e("button",{class:"btn-3",onClick:r[2]||(r[2]=A(C=>m("clickCancel"),["prevent"]))},"Cancel"),e("button",gs,b((N=x.requirement)!=null&&N.closed_at?"Re-Open":"Close"),1)])])],32)}}};async function ks(x,q,{params:o={}}={}){return Me.get(`/requirements/${x}/details/${q}`,{params:o})}async function hs(x,q,{params:o={}}={}){const m=ot(o);return Me.delete(`/requirements/${x}/details/${q}${m?"?"+m:""}`)}const ws={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},qs={class:"mb-4"},$s={class:"font-semibold"},Cs={class:"mb-4"},Ts={class:"line-clamp-2"},Ss={key:1,class:"min-h-40"},Rs={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},js={key:0,class:"mb-4 text-red-500 font-medium"},Is={key:1,class:"mb-4"},Ds={class:"flex items-center justify-between gap-4"},As=["disabled"],Ns={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(x,{emit:q}){const o=x,m=q,f=it(),v=y(null),d=y(""),c=y(),s=y([]);async function j(){var i,r;d.value="submitting";try{const l=await hs(o.requirementId,o.detailId);m("delete",l),d.value="create"}catch(l){d.value="error",c.value=((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to update requirement detail: "+l,m("error",c.value)}}return le(async()=>{var i,r,l;d.value="loading";try{s.value=await f.fetchDepartmentWiseEmployees(),v.value=(i=(await ks(o.requirementId,o.detailId)).data)==null?void 0:i.detail}catch(p){c.value=((l=(r=p.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to fetch requirement detail"}finally{d.value=""}}),(i,r)=>{var l,p;return n(),a("div",ws,[r[4]||(r[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:A(j,["prevent"]),class:"z-0"},[d.value!=="loading"?(n(),a(H,{key:0},[e("div",qs,[r[1]||(r[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",$s,b((l=v.value)==null?void 0:l.title),1)]),e("div",Cs,[r[2]||(r[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",Ts,b((p=v.value)==null?void 0:p.description),1)]),r[3]||(r[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),a("div",Ss)),e("div",Rs,[c.value?(n(),a("div",js,b(c.value),1)):u("",!0),c.value?(n(),a("hr",Is)):u("",!0),e("div",Ds,[e("button",{type:"button",onClick:r[0]||(r[0]=A(k=>m("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:d.value=="loading"||d.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},b(d.value=="submitting"?"Deleting...":"Delete"),9,As)])])],32),d.value==="loading"||d.value==="submitting"?(n(),I(ie,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):u("",!0)])}}};const Ls={class:"sticky top-0 pt-4 bg-white z-10"},Os={class:"mb-4"},Us={class:"mb-4"},Bs={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Es={key:0,class:"mb-4 text-red-500 font-medium"},Ms={key:1,class:"mb-4"},Fs={class:"flex items-center justify-between gap-4"},Vs=["disabled"],Ps={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(x,{emit:q}){const o=x,m=q,f=y(),v=y(null),d=y(""),c=y(),s=y({feedback:""});async function j(){var i,r;d.value="submitting";try{const l=await nt(o.requirementId,s.value.feedback);m("update",l),d.value="create"}catch(l){d.value="error",c.value=((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to update requirement requirement",m("error",c.value)}}return le(async()=>{var i,r,l,p;d.value="loading";try{await me(o.requirementId),v.value=(i=(await me(o.requirementId)).data)==null?void 0:i.requirement,s.value={feedback:(r=v.value)==null?void 0:r.feedback}}catch(k){c.value=((p=(l=k.response)==null?void 0:l.data)==null?void 0:p.message)||"Failed to fetch requirement requirement"}finally{d.value=""}}),(i,r)=>{var l;return n(),a("div",{ref_key:"formContainerRef",ref:f,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Ls,[r[3]||(r[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),r[4]||(r[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=A(p=>m("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:A(j,["prevent"]),class:"z-0"},[d.value!=="loading"?(n(),a(H,{key:0},[e("div",Os,[r[5]||(r[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),w(Z,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:R(()=>{var p;return[E(b((p=v.value)==null?void 0:p.title),1)]}),_:1})]),e("div",Us,[r[6]||(r[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),w(He,{modelValue:s.value.feedback,"onUpdate:modelValue":r[1]||(r[1]=p=>s.value.feedback=p)},null,8,["modelValue"])])],64)):u("",!0),e("div",Bs,[c.value?(n(),a("div",Es,b(c.value),1)):u("",!0),c.value?(n(),a("hr",Ms)):u("",!0),e("div",Fs,[e("button",{type:"button",onClick:r[2]||(r[2]=A(p=>m("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:d.value=="loading"||d.value=="submitting",type:"submit",class:"btn-2"},b(d.value=="submitting"?"Saving...":(l=v.value)!=null&&l.feedback?"Update Feedback":"Add Feedback"),9,Vs)])])],32),d.value==="loading"||d.value==="submitting"?(n(),I(ie,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):u("",!0)],512)}}},Hs={class:"flex justify-center items-center"},zs={class:"modal-card"},Gs=["required"],Ws={class:"flex"},Ys={class:"flex justify-between gap-2 mt-4"},Qs=["disabled"],Ks=["disabled"],Js={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(x,{emit:q}){const o=x,m=q,f=y(255),v=z(()=>f.value-i.value.length),d=Ge(),c=y(null),s=y(null),j=y(null),i=y(""),r=y(!1),l=z(()=>j.value!==null);function p(C){j.value=C,i.value="",N()}function k(){j.value=null,i.value=""}async function h(){var C,D;if(j.value==="reject"&&!i.value)return d.error("Rejection Reason is required!");if(typeof o.onSubmit=="function")return o.onSubmit({note:i.value,action:j.value});m("loading",!0),r.value=!0;try{await at(o.requirementId,{note:i.value}),m("success"),k()}catch(O){return m("error",O),d.error(((D=(C=O==null?void 0:O.response)==null?void 0:C.data)==null?void 0:D.message)||"Submission failed!")}finally{m("loading",!1),r.value=!1}}function $(C){var D,O;l.value&&(C.key==="ArrowLeft"?(D=s.value)==null||D.focus():C.key==="ArrowRight"&&((O=c.value)==null||O.focus()))}function N(){Pe(()=>{var C;(C=c.value)==null||C.focus()})}return le(()=>{window.addEventListener("keydown",$)}),Ve(()=>{window.removeEventListener("keydown",$)}),(C,D)=>(n(),a("div",null,[e("div",Hs,[e("button",{onClick:D[0]||(D[0]=O=>p("accept"))},D[3]||(D[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),l.value?(n(),a("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:A(k,["self"])},[e("div",zs,[D[4]||(D[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Be(e("textarea",{"onUpdate:modelValue":D[1]||(D[1]=O=>i.value=O),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:j.value==="reject",onInput:D[2]||(D[2]=O=>i.value.length>f.value?i.value=i.value.slice(0,f.value):null)},null,40,Gs),[[Ee,i.value]]),e("div",Ws,[e("div",{class:B(["ml-auto inline-block text-sm text-gray-500",i.value.length>=f.value?"text-red-500":""])}," left "+b(v.value)+"/"+b(f.value)+" words ",3)])]),e("div",Ys,[e("button",{ref_key:"cancelBtnRef",ref:s,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:k,disabled:r.value}," Cancel ",8,Qs),e("button",{ref_key:"confirmBtnRef",ref:c,class:B(["focus:ring-2 ring-offset-2 disabled:opacity-30",j.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:h,disabled:r.value}," Confirm Submission ",10,Ks)])])])):u("",!0)]))}},Xs={class:"flex items-center gap-6 justify-center my-16"},Zs={key:0,class:"border rounded-md"},er={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(x,{emit:q}){const o=x,m=q,f=ut(),v=y(""),d=y(null),c=y(""),s=y(!1);async function j(){await f.setTaskRequirement(c.value,o.requirement.id),m("assignTask")}return(i,r)=>(n(),a("div",{class:B(["text-left p-4",[v.value&&!d.value?"min-h-[400px]":""]])},[e("div",Xs,[e("button",{onClick:r[0]||(r[0]=A(l=>m("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),r[5]||(r[5]=e("span",null,"or",-1)),e("button",{class:B({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:r[1]||(r[1]=A(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value&&!d.value?(n(),a("div",Zs,[e("form",{onSubmit:A(j,["prevent"]),class:"p-4 flex items-end"},[w(mt,{class:"flex-grow mr-4 h-12",taskId:c.value,"onUpdate:taskId":r[2]||(r[2]=l=>c.value=l),show:s.value,"onUpdate:show":r[3]||(r[3]=l=>s.value=l),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":x.fromDepartmentId},filterTasks:l=>!l.requirement_id,onAddNewTaskClick:r[4]||(r[4]=l=>m("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),r[6]||(r[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):u("",!0)],2))}},tr={class:"flex flex-col items-center gax-x-1 justify-end"},sr={key:0},rr={key:1},nr={class:"text-sm text-gray-600 whitespace-normal w-64"},ar={class:"text-gray-900 font-semibold text-sm md:text-base"},lr={class:"ml-2"},or={key:0,class:"text-red-700 text-sm"},ir={key:1,class:"text-green-600 ml-2"},dr={key:2,class:"ml-2 text-yellow-700"},Oe={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(x,{emit:q}){const o=x,m=q,f=Fe(),v=z(()=>{var i,r,l,p,k;return{from_in_charge:!!((i=o.requirement)!=null&&i.status&&((r=o.requirement)!=null&&r.submission_date)),from_coordinator:!!((l=o.requirement)!=null&&l.from_coordinator),to_in_charge:!!((p=o.requirement)!=null&&p.to_incharge),to_coordinator:!!((k=o.requirement)!=null&&k.to_coordinator)}}),d=z(()=>{var i,r,l,p,k,h,$,N;return{from_in_charge:(r=(i=o.requirement)==null?void 0:i.from_department)==null?void 0:r.in_charge,from_coordinator:(p=(l=o.requirement)==null?void 0:l.from_department)==null?void 0:p.coordinator,to_in_charge:(h=(k=o.requirement)==null?void 0:k.to_department)==null?void 0:h.in_charge,to_coordinator:(N=($=o.requirement)==null?void 0:$.to_department)==null?void 0:N.coordinator}}),c=z(()=>{var p;const i=Object.keys(v.value),r=i.indexOf(o.approvalType);let l=!0;for(let k=r-1;k>=0;k--){const h=i[k];l=l&&(d.value[h]?(p=v.value)==null?void 0:p[h]:!0)}return l}),s=z(()=>{var h,$,N,C,D,O,ee,T,U,g,S,L,t,G,M,W;let i=null,r=null,l="",p="";o.approvalType==="from_in_charge"&&(i=(h=o.requirement)==null?void 0:h.from_department,r=(N=($=o.requirement)==null?void 0:$.from_department)==null?void 0:N.in_charge,l="In Charge",p=(C=o.requirement)==null?void 0:C.from_incharge_note),o.approvalType==="from_coordinator"&&(i=(D=o.requirement)==null?void 0:D.from_department,r=(O=o.requirement)==null?void 0:O.from_coordinator,l="Coordinator",p=(ee=o.requirement)==null?void 0:ee.from_coordinator_note),o.approvalType==="to_in_charge"&&(i=(T=o.requirement)==null?void 0:T.to_department,r=(U=o.requirement)==null?void 0:U.to_in_charge,l="In Charge",p=(g=o.requirement)==null?void 0:g.to_incharge_note),o.approvalType==="to_coordinator"&&(i=(S=o.requirement)==null?void 0:S.to_department,r=(L=o.requirement)==null?void 0:L.to_coordinator,l="Coordinator",p=(t=o.requirement)==null?void 0:t.to_coordinator_note);const k=(G=d.value)==null?void 0:G[o.approvalType];return{department:i,department_user:k,approved:(M=v.value)==null?void 0:M[o.approvalType],approval_user:r,is_rejected:((W=o.requirement)==null?void 0:W.rejected_by_user_id)==(k==null?void 0:k.id),userType:l,approval_note:p}});function j(){m("updateApproval")}return(i,r)=>{var l,p,k,h,$,N;return n(),a("div",tr,[s.value.department_user?(n(),a("div",sr,[w(ae,{user:s.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),a("div",rr,r[0]||(r[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",nr,[s.value.is_rejected?(n(),I(Z,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:R(()=>[E(b(x.requirement.rejection_reason),1)]),_:1})):(n(),I(Z,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:R(()=>[E(b(s.value.approval_note),1)]),_:1}))]),e("div",null,[!s.value.is_rejected&&!s.value.approved&&c.value&&((l=P(f).user)==null?void 0:l.id)==((k=(p=s.value)==null?void 0:p.department_user)==null?void 0:k.id)?(n(),I(ft,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(h=o.requirement)==null?void 0:h.id,onSuccess:j,variant:1},null,8,["applicationId"])):u("",!0)]),r[2]||(r[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",ar,[e("span",null,b((($=s.value.department)==null?void 0:$.short_name)||((N=s.value.department)==null?void 0:N.name)),1),e("span",lr,b(s.value.userType),1),s.value.department_user?(n(),a(H,{key:0},[s.value.is_rejected?(n(),a("span",or," (Rejected)")):s.value.approved?(n(),a("span",ir,"(✔)")):(n(),a("span",dr,r[1]||(r[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):u("",!0)])])}}},ur={class:"container mx-auto print:p-0 w-full print:max-w-full"},mr={class:"border-b px-4 py-2 bg-gray-50 flex items-center justify-between rounded-t-md"},cr={key:0},pr={class:"border table-auto w-full"},vr={class:"border-y px-4 py-1"},br={class:"border-y px-4 py-1"},fr={class:"border-y px-4 py-1 text-center"},xr={class:"border-y px-4 py-1 text-center"},yr={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},gr={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},_r={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},kr={class:"text-center text-xl font-bold mb-2 flex items-center"},hr={class:"mb-8"},wr={class:"text-lg font-semibold mb-2"},qr={class:"flex gap-4 items-center text-gray-500"},$r={class:"text-sm"},Cr={key:0,class:"flex items-center gap-1"},Tr={key:0,class:"mb-5"},Sr=["innerHTML"],Rr={class:"mb-8"},jr={class:"font-semibold text-lg px-2"},Ir={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},Dr={class:"w-full border-collapse"},Ar={key:0},Nr={class:"mb-8"},Lr={class:"mb-8"},Or={class:"font-semibold text-lg px-2"},Ur={key:0},Br=["innerHTML"],Er={key:1,class:"text-center my-2 text-gray-400"};const Mr={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Fr={class:"flex flex-col items-end"},Vr={key:2,class:"mt-6 mb-8 break-before-avoid-page"},Pr={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},Hr={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},zr={class:"bg-white shadow rounded-lg space-y-4 p-4"},Gr={class:"border col-span-3 p-3 rounded-md"},Wr={class:"flex items-center gap-2 mb-4"},Yr={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},Qr={class:"flex items-center gap-2 mb-4"},Kr={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},Jr={class:"font-bold print:text-gray-900"},Xr={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},Zr={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},en={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},tn={class:"print:text-gray-900 text-sm text-right"},sn={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},rn={class:"print:text-gray-900 text-sm text-right"},nn={class:"flex justify-between items-center mb-4"},an={class:"mb-6"},ln={class:"flex justify-between items-center"},on={key:1,class:"text-red-600"},dn={key:0,class:"mb-2"},un={class:"flex justify-end text-sky-500"},mn={key:1,class:"text-right w-full mb-4"},cn={key:2,class:"mb-6"},pn={class:"flex justify-between items-center"},vn={key:3,class:"text-center mb-4 text-red-700 mt-8 text-sm"},bn={key:5,class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},ta={__name:"RequirementShow",setup(x){const q=We(),o=Ye(),m=y(""),f=Fe(),v=y(),d=y(!1),c=y(),s=y(null),j=X({detail:null,open:!1}),i=X({detail:null,open:!1}),r=X({detail:null,open:!1}),l=y(!1),p=()=>l.value=!0,k=()=>l.value=!1,h=y(),$=y({isOpen:!1,taskId:null});le(async()=>{await C(),window.addEventListener("beforeprint",p),window.addEventListener("afterprint",k),window.addEventListener("resize",N),await Pe(),bt(v.value,()=>{})});function N(){}Ve(()=>{window.removeEventListener("beforeprint",p),window.removeEventListener("afterprint",k),window.removeEventListener("resize",N)});async function C(){var L;m.value="loading",s.value=(L=(await me(q.params.id)).data)==null?void 0:L.requirement,m.value=""}function D(){var L,t,G,M,W,J,te,se,re;if(f.user.role!=="super_admin"&&((L=f.user)==null?void 0:L.id)!==((G=(t=s.value)==null?void 0:t.to_department)==null?void 0:G.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(W=(M=s.value)==null?void 0:M.to_department)==null?void 0:W.name}'s In charge can create or assign.`);console.log({requirement:s}),T.modalShown=!0,T.from_department_id=s.value.from_department_id,T.to_department_id=s.value.to_department_id,T.taskDefaultValues={title:"",description:"",from_department_id:s.value.from_department_id,to_department_id:s.value.to_department_id,is_important:((J=s.value)==null?void 0:J.priority)=="IMPORTANT",is_urgent:((te=s.value)==null?void 0:te.priority)=="URGENT",supervisor_ids:(se=s.value)!=null&&se.supervisor_id?[(re=s.value)==null?void 0:re.supervisor_id]:[]},T.requirement=s.value}function O(L){j.open=!0,j.detail=L}function ee(L){r.open=!0,r.detail=L}const T=X({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function U(){h.value=null,T.modalShown=!1,await C()}async function g(){T.modalShown=!1,T.requirement=null,T.creating=!1}const S=y({open:!1});return(L,t)=>{var M,W,J,te,se,re,ce,pe,ve,be,fe,xe,ye,ge,_e,ke,he,we,qe,$e,Ce,Te,Se,Re,je,Ie,De,Ae;const G=Ue("RouterLink");return n(),a("div",ur,[i.open?(n(),I(Y,{key:0},{default:R(()=>{var _;return[w(Ps,{requirementId:s.value.id,detailId:(_=i.requirement.value)==null?void 0:_.id,onCloseClick:t[0]||(t[0]=V=>i.open=!1),onUpdate:t[1]||(t[1]=async()=>{i.open=!1,await C()})},null,8,["requirementId","detailId"])]}),_:1})):u("",!0),r.open?(n(),I(Y,{key:1},{default:R(()=>{var _;return[w(Ns,{requirementId:s.value.id,detailId:(_=r.requirement.value)==null?void 0:_.id,onCloseClick:t[2]||(t[2]=V=>r.open=!1),onDelete:t[3]||(t[3]=async()=>{r.open=!1,await C()})},null,8,["requirementId","detailId"])]}),_:1})):u("",!0),T.modalShown?(n(),I(Y,{key:2,class:"*:relative"},{default:R(()=>{var _,V;return[e("button",{onClick:A(g,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},t[20]||(t[20]=[e("i",{class:"fas fa-times-circle"},null,-1)])),T!=null&&T.creating?u("",!0):(n(),I(er,{key:0,"from-department-id":(_=s.value)==null?void 0:_.from_department_id,requirement:T==null?void 0:T.requirement,onCancelClick:g,onAddNewTaskClick:t[4]||(t[4]=()=>{T.modalShown=!0,T.creating=!0}),onAssignTask:U},null,8,["from-department-id","requirement"])),T!=null&&T.creating?(n(),I(ct,{key:1,requirementDetailId:(V=T==null?void 0:T.requirement.value)==null?void 0:V.id,requirementId:s.value.id,onClose:g,onTaskCreated:U,defaultValues:T.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):u("",!0)]}),_:1})):u("",!0),h.value?(n(),I(Y,{key:3},{default:R(()=>[w(pt,{taskId:h.value,onClose:t[5]||(t[5]=_=>h.value=null),onUpdated:U},null,8,["taskId"])]),_:1})):u("",!0),$.value.isOpen?(n(),I(Y,{key:4,class:"*:max-w-4xl"},{default:R(()=>[w(dt,{taskId:$.value.taskId,onCancelClick:t[6]||(t[6]=()=>{$.value.isOpen=!1,$.value.taskId=0}),onSuccess:t[7]||(t[7]=()=>{$.value.isOpen=!1,$.value.taskId=0,m.value="loading",C()})},null,8,["taskId"])]),_:1})):u("",!0),S.value.open?(n(),I(Y,{key:5},{default:R(()=>[w(_s,{requirement:s.value,onClickCancel:t[8]||(t[8]=_=>S.value.open=!1),onUpdateStatus:t[9]||(t[9]=()=>{C(),S.value.open=!1})},null,8,["requirement"])]),_:1})):u("",!0),d.value?(n(),I(Y,{key:6},{default:R(()=>{var _,V,Q,ne;return[e("div",mr,[t[22]||(t[22]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon",onClick:t[10]||(t[10]=A(F=>d.value=!1,["prevent"]))},t[21]||(t[21]=[e("i",{class:"fas fa-times"},null,-1)]))]),(_=s.value)!=null&&_.closing_history&&((Q=(V=s.value)==null?void 0:V.closing_history)!=null&&Q.length)?(n(),a("div",cr,[e("table",pr,[t[23]||(t[23]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Close/Open")])],-1)),e("tbody",null,[(n(!0),a(H,null,K(((ne=s.value)==null?void 0:ne.closing_history)||[],F=>(n(),a("tr",{key:F.at},[e("td",vr,b(F.at?P(ue)(F.at):""),1),e("td",br,b(F==null?void 0:F.closing_note),1),e("td",fr,b(F==null?void 0:F.status),1),e("td",xr,b(F==null?void 0:F.type),1)]))),128))])])])):u("",!0)]}),_:1})):u("",!0),e("div",yr,[s.value?(n(),a("div",gr,[e("div",_r,[e("div",kr,[e("button",{class:"btn-3 h-8 px-4",onClick:t[11]||(t[11]=A(()=>P(o).back(),["prevent"]))},"Back"),t[24]||(t[24]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),t[39]||(t[39]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",hr,[e("div",null,[e("div",wr,[w(Z,{"line-clamp":"3",class:"mb-2"},{default:R(()=>[E(b(s.value.title),1)]),btnText:R(({lineClampClass:_})=>[E(b(_?"More":"Less"),1)]),_:1}),e("div",qr,[e("div",$r,[t[25]||(t[25]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),E(" "+b(P(ue)(s.value.created_at)),1)]),s.value.created_by?(n(),a("div",Cr,[t[26]||(t[26]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),w(ae,{"avatar-size":"xsmall",user:s.value.created_by,class:"border-sky-300"},null,8,["user"])])):u("",!0)])]),s.value.description?(n(),a("div",Tr,[t[27]||(t[27]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),w(Z,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:R(()=>[e("p",{innerHTML:s.value.description,class:"text-justify"},null,8,Sr)]),_:1})])):u("",!0)])]),e("div",Rr,[w(oe,{class:"mb-4"},{default:R(()=>[e("h2",jr,[t[28]||(t[28]=e("span",null,"Task List ",-1)),s.value.status=="approved"?(n(),a("span",{key:0,class:B(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":s.value.tasks_count>0&&s.value.completed_tasks_count==s.value.tasks_count,"text-red-700 font-semibold":s.value.tasks_count==0||s.value.completed_tasks_count!=s.value.tasks_count}]])}," ("+b(s.value.completed_tasks_count)+"/"+b(s.value.tasks_count)+" task(s) done) ",3)):u("",!0)])]),_:1}),e("div",Ir,[e("table",Dr,[t[30]||(t[30]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[m.value!="loading"&&((W=(M=s.value)==null?void 0:M.tasks)==null?void 0:W.length)===0?(n(),a("tr",Ar,t[29]||(t[29]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),a(H,{key:1},K(((J=s.value)==null?void 0:J.tasks)||[],(_,V)=>(n(),I(et,{key:_.id,task:_,indexing:V+1,class:"*:py-3 *:border-b-0",onEditClick:t[12]||(t[12]=Q=>h.value=Q),onEmployeeAssignClick:t[13]||(t[13]=Q=>{$.value.isOpen=!0,$.value.taskId=Q})},null,8,["task","indexing"]))),128))])])])]),e("div",Nr,[w(oe,{class:"mb-4"},{default:R(()=>t[31]||(t[31]=[e("h2",{class:"font-semibold text-lg px-2"},"Comments",-1)])),_:1,__:[31]}),w(Mt,{"commentable-type":"requirement","commentable-id":s.value.id,"current-user":P(f).user},null,8,["commentable-id","current-user"])]),e("div",Lr,[w(oe,{class:"mb-4"},{default:R(()=>{var _,V,Q,ne;return[e("h2",Or," '"+b(((V=(_=s.value)==null?void 0:_.to_department)==null?void 0:V.short_name)||((ne=(Q=s.value)==null?void 0:Q.to_department)==null?void 0:ne.name))+"' Feedback ",1)]}),_:1}),e("div",{class:B(["px-3 border border-dashed rounded-lg border-sky-600",[(te=s.value)!=null&&te.feedback?"py-3":"py-8"]]),colspan:"5"},[m.value!="loading"&&((se=s.value)!=null&&se.status)?(n(),a("div",Ur,[String(((re=s.value)==null?void 0:re.feedback)||"").trim().length>0?(n(),I(Z,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:R(()=>{var _;return[e("p",{class:"text-sm text-justify",innerHTML:(_=s.value)==null?void 0:_.feedback},null,8,Br)]}),_:1})):(n(),a("div",Er,"No Feedback")),e("div",{class:B([((ce=s.value)!=null&&ce.feedback,"w-full flex justify-center")])},[s.value.closed_at?u("",!0):(n(),a("button",{key:0,class:"btn-3 print:hidden",onClick:t[14]||(t[14]=A(()=>{i.open=!0,i.requirement=s.value},["prevent"]))},b(s.value.feedback?"Update Feedback":"Add feedback"),1))],2)])):u("",!0)],2)]),(s.value,u("",!0)),m.value!="loading"&&!((pe=s.value)!=null&&pe.status)?(n(),a("div",Mr,[e("div",Fr,[w(Js,{"requirement-id":(ve=s.value)==null?void 0:ve.id,onSuccess:C},{heading:R(()=>t[35]||(t[35]=[E(" Requirement Submission ")])),acceptButtonLabel:R(()=>t[36]||(t[36]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),E("Submit Requirement ")],-1)])),submitButtonLabel:R(()=>t[37]||(t[37]=[E(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):u("",!0),(be=s.value)!=null&&be.status?(n(),a("div",Vr,[w(oe,null,{default:R(()=>t[38]||(t[38]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[38]}),e("div",Pr,[(n(),a(H,null,K(["from_in_charge","from_coordinator"],_=>w(Oe,{class:"pt-12",key:_,requirement:s.value,"approval-type":_,onUpdateApproval:t[15]||(t[15]=()=>C())},null,8,["requirement","approval-type"])),64))]),((fe=s.value)==null?void 0:fe.from_department_id)!==((xe=s.value)==null?void 0:xe.to_department_id)?(n(),a("div",Hr,[(n(),a(H,null,K(["to_in_charge","to_coordinator"],_=>w(Oe,{class:"pt-12",key:_,requirement:s.value,"approval-type":_,onUpdateApproval:t[16]||(t[16]=()=>C())},null,8,["requirement","approval-type"])),64))])):u("",!0)])):u("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:v},[e("div",zr,[e("div",Gr,[e("div",null,[e("div",Wr,[t[40]||(t[40]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),w(Ne,{department:(ye=s.value)==null?void 0:ye.from_department,"short-name":!0},null,8,["department"])]),t[41]||(t[41]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",Yr,[(ge=s.value)!=null&&ge.supervisor?(n(),I(ae,{key:0,user:(_e=s.value)==null?void 0:_e.supervisor},null,8,["user"])):u("",!0)])]),t[43]||(t[43]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Qr,[t[42]||(t[42]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),w(Ne,{department:(ke=s.value)==null?void 0:ke.to_department,"short-name":!0},null,8,["department"])])])]),e("div",Kr,[t[44]||(t[44]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",Jr,b((he=s.value)==null?void 0:he.id),1)]),((qe=(we=s.value)==null?void 0:we.website_tags)==null?void 0:qe.length)>0?(n(),a("div",Xr,[t[45]||(t[45]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",Zr,[(n(!0),a(H,null,K((($e=s.value)==null?void 0:$e.website_tags)||[],_=>(n(),a("div",{key:_.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},b(_.name),1))),128))])])):u("",!0),(Ce=s.value)!=null&&Ce.submission_date?(n(),a("div",en,[t[46]||(t[46]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",tn,b(P(ue)((Te=s.value)==null?void 0:Te.submission_date)),1)])):u("",!0),(Se=s.value)!=null&&Se.better_to_complete_on?(n(),a("div",sn,[t[47]||(t[47]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",rn,b(P(vt)((Re=s.value)==null?void 0:Re.better_to_complete_on,{weekDay:"long"})),1)])):u("",!0),e("div",null,[e("div",nn,[t[48]||(t[48]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:B(["font-semibold text-sm",{"text-yellow-600 ":s.value.priority=="IMPORTANT","text-red-700 ":s.value.priority=="URGENT"}])},b(s.value.priority||"NORMAL"),3)])]),e("div",an,[e("div",ln,[t[49]||(t[49]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),s.value.status?(n(),a("span",{key:0,class:B(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":s.value.status!="approved","bg-green-300 text-green-700 border-green-400":s.value.status=="approved"}])},b(String(s.value.status).toUpperCase()),3)):(n(),a("span",on,"..."))])]),s.value.closed_at?u("",!0):(n(),a("div",dn,[e("div",un,[e("button",{class:"btn-1 border border-sky-800",onClick:t[17]||(t[17]=A(_=>S.value.open=!0,["prevent"]))}," Close Requirement ")])])),((Ie=(je=s.value)==null?void 0:je.closing_history)==null?void 0:Ie.length)>1?(n(),a("div",mn,[e("button",{onClick:t[18]||(t[18]=_=>d.value=!d.value),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):u("",!0),s.value.rejected_by?(n(),a("div",cn,[e("div",pn,[t[50]||(t[50]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),w(ae,{user:s.value.rejected_by},null,8,["user"])])])):u("",!0),s.value.rejection_reason?(n(),a("div",vn,[t[51]||(t[51]=e("p",{class:"text-gray-600 mb-1 italic"},"Reason",-1)),e("p",null,b(s.value.rejection_reason),1)])):u("",!0),t[54]||(t[54]=e("hr",{class:"mb-3"},null,-1)),(De=s.value)!=null&&De.closed_at?(n(),I(is,{key:4,requirement:s.value,onReOpenClick:t[19]||(t[19]=_=>S.value.open=!0)},null,8,["requirement"])):(n(),a("div",bn,[s.value.status=="approved"?(n(),a("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:A(D,["prevent"])},t[52]||(t[52]=[e("i",{class:"fas fa-plus text-sm"},null,-1),E(" Add/Assign Task ")]))):u("",!0),w(G,{class:"btn-2 h-8",to:`/requirements/edit/${(Ae=s.value)==null?void 0:Ae.id}`},{default:R(()=>t[53]||(t[53]=[E(" Edit ")])),_:1,__:[53]},8,["to"])]))])]),w(Zt,{requirement:s.value,class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3"},null,8,["requirement"]),w(Ke,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3",ref_key:"shareComponent",ref:c},null,512)],512)])):u("",!0),m.value==="loading"?(n(),I(ie,{key:1,class:"absolute inset-0 bg-opacity-90"})):u("",!0)])])}}};export{ta as default};
