import{d as ue,r as _,m as B,a4 as le,z as ie,e as ae,c as u,o as n,a as e,f as W,w as ve,g as b,h as w,v as M,K as me,t as i,F as $,q as V,k as c,a5 as H,p as C,u as ye,b as pe,s as ce,n as ge,B as _e,j as A,i as oe,a6 as fe}from"./index-Bv25wqkJ.js";import{L as ne}from"./LoaderView-Hmc-qWpc.js";import{_ as be}from"./MultiselectDropdown-mQQ5x827.js";import{u as xe}from"./holiday-Dx4odvIg.js";import{u as re}from"./leave-application-DNhAEvJe.js";import{u as we}from"./leave-type-DFbePIMh.js";import{u as de}from"./user-Dr-bebQg.js";import{_ as ke}from"./EmployeeFilter-BQ1B1n0R.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-DgRrVmNn.js";import"./department-McYTm-SK.js";const he={class:"space-y-4 p-2 md:p-4"},Ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De={class:"inline-flex items-center space-x-2"},Le={key:0},Se={class:"text-blue-600 font-medium"},$e={key:1,class:"bg-gray-100 p-2 rounded-md"},Te={class:"font-semibold"},Ue={class:"flex flex-wrap gap-2"},Ce=["name","value","onUpdate:modelValue"],Ve={class:"flex items-center space-x-1"},qe=["name","onUpdate:modelValue"],Re={class:"flex items-center space-x-1"},je=["name","onUpdate:modelValue"],Fe={key:2},Me={key:3},Be={key:4,class:"text-red-500 text-sm"},Ie={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(Y,{emit:q}){const r=Y,k=q,g=re(),S=we(),T=de();ue();const U=xe(),D=_(""),h=_(!0),a=_({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),m=_([]),x=_(!1),L=_(null),I=B(()=>{var d,s,o;return((s=(d=r==null?void 0:r.userInfo)==null?void 0:d.assign_weekend)==null?void 0:s.weekends)||((o=r==null?void 0:r.userInfo)==null?void 0:o.weekends)}),p=B(()=>{const d=a.value.last_working_date,s=a.value.resumption_date;if(!d||!s)return[];const o=new Date(d),t=new Date(s);if(t<=o)return[];const y=[];let v=new Date(o);for(v.setDate(v.getDate()+1);v<t;){const f=v.getFullYear(),R=(v.getMonth()+1).toString().padStart(2,"0"),j=v.getDate().toString().padStart(2,"0");y.push(`${f}-${R}-${j}`),v.setDate(v.getDate()+1)}return y}),N=B(()=>{if(!a.value.last_working_date||!a.value.resumption_date)return"";const d=new Date(a.value.last_working_date);return new Date(a.value.resumption_date)<=d?"Resumption date must be after Last Working Date.":p.value.length===0?"No leave days between the selected dates.":`Total leave days: ${p.value.length}`});le(async()=>{var d;p.value.length&&S.leaveTypes.length&&(m.value.length!==p.value.length&&(m.value=p.value.map(()=>S.leaveTypes[0].id)),await U.fetchHolidays({company_id:(d=r==null?void 0:r.userInfo)==null?void 0:d.company_id,start_date:p.value[0],end_date:p.value[p.value.length-1]}),p.value.forEach(async(s,o)=>{const t=new Date(s).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),y=t.charAt(0).toUpperCase()+t.slice(1);I.value.includes(y)&&(m.value[o]="weekend"),U.holidayDates.includes(s)&&(m.value[o]="holiday")}))}),ie(()=>D.value,d=>{a.value.handover_user_id=d==null?void 0:d.id});const E=async()=>{var d;x.value=!0,L.value=null;try{const s=p.value.map((v,f)=>({date:v,leave_type_id:m.value[f]!=="weekend"&&m.value[f]!=="holiday"?m.value[f]:null})).filter(v=>v.leave_type_id!==null),o=p.value.map((v,f)=>({date:v,leave_type_id:m.value[f]||""})).filter(v=>v.leave_type_id!==null),t={user_id:(d=r==null?void 0:r.userInfo)==null?void 0:d.id,last_working_date:a.value.last_working_date,resumption_date:a.value.resumption_date,reason:a.value.reason,works_in_hand:a.value.works_in_hand,handover_user_id:h.value?null:a.value.handover_user_id,leave_days:s,json_data:o,is_direct_approve:h.value};await g.storeAdminLeaveApplication(t)&&k("formSuccessClosed")}catch(s){L.value=s.message||"Failed to submit leave application"}finally{x.value=!1}};return ae(async()=>{le(()=>{var s;const d=(s=r==null?void 0:r.userInfo)==null?void 0:s.company_id;d&&S.fetchLeaveTypes(d)}),await T.fetchTypeWiseEmployees({except:"auth"})}),(d,s)=>(n(),u("div",he,[s[16]||(s[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),x.value?(n(),W(ne,{key:0})):(n(),u("form",{key:1,onSubmit:ve(E,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",Ae,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),w(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=o=>a.value.last_working_date=o),class:"input-1 w-full",required:""},null,512),[[M,a.value.last_working_date]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),w(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=o=>a.value.resumption_date=o),class:"input-1 w-full",required:""},null,512),[[M,a.value.resumption_date]])])]),e("div",null,[e("label",De,[w(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=o=>h.value=o),class:"form-checkbox text-blue-600"},null,512),[[me,h.value]]),s[8]||(s[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),a.value.last_working_date&&a.value.resumption_date?(n(),u("div",Le,[e("p",Se,i(N.value),1)])):b("",!0),p.value.length?(n(),u("div",$e,[s[11]||(s[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),e("div",null,[(n(!0),u($,null,V(p.value,(o,t)=>(n(),u("div",{key:t,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[e("div",Te,i(o),1),e("div",Ue,[(n(!0),u($,null,V(c(S).leaveTypes,y=>(n(),u("label",{key:y.id,class:"flex items-center space-x-1"},[w(e("input",{type:"radio",name:"leaveType-"+t,value:y.id,"onUpdate:modelValue":v=>m.value[t]=v},null,8,Ce),[[H,m.value[t]]]),e("span",null,i(y.name),1)]))),128)),e("label",Ve,[w(e("input",{type:"radio",name:"leaveType-"+t,value:"weekend","onUpdate:modelValue":y=>m.value[t]=y},null,8,qe),[[H,m.value[t]]]),s[9]||(s[9]=e("span",null,"Weekend",-1))]),e("label",Re,[w(e("input",{type:"radio",name:"leaveType-"+t,value:"holiday","onUpdate:modelValue":y=>m.value[t]=y},null,8,je),[[H,m.value[t]]]),s[10]||(s[10]=e("span",null,"Holiday",-1))])])]))),128))])])):b("",!0),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),w(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=o=>a.value.reason=o),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[M,a.value.reason]])]),h.value?b("",!0):(n(),u("div",Fe,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),C(be,{modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=o=>D.value=o),options:c(T).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),h.value?b("",!0):(n(),u("div",Me,[s[14]||(s[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),w(e("textarea",{id:"works-in-hand","onUpdate:modelValue":s[5]||(s[5]=o=>a.value.works_in_hand=o),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[M,a.value.works_in_hand]])])),L.value?(n(),u("div",Be,i(L.value),1)):b("",!0),s[15]||(s[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Ne={class:"space-y-2 px-4"},Ee={class:"flex flex-wrap gap-2"},He=["value"],We={key:0,class:"text-center py-4"},Ye={key:1,class:"space-y-4"},ze={key:0,class:"bg-sky-100/30 p-4 rounded-lg shadow mb-6 space-y-6"},Oe={class:"grid md:grid-cols-2 gap-6"},Pe={class:"bg-white border rounded-lg p-4 shadow"},Je={class:"grid grid-cols-1 sm:grid-cols-2 gap-y-2 text-sm text-gray-600"},Ge={class:"bg-white border rounded-lg p-4 shadow"},Ke={class:"overflow-x-auto"},Qe={class:"min-w-full text-sm text-left text-gray-700 border"},Xe={class:"px-4 py-1 text-center font-medium"},Ze={class:"px-4 py-1 text-center"},et={class:"px-4 py-1 text-center"},tt={class:"px-4 py-1 text-center"},st={class:"overflow-x-auto"},lt={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},ot={class:"border border-gray-300 px-2 py-2"},at={class:"border border-gray-300 px-2 py-2 text-center"},nt={class:"border border-gray-300 px-2 py-2 text-center"},rt={class:"border border-gray-300 px-2 py-2"},dt={class:"border border-gray-300 px-2 py-2"},ut=["innerHTML"],it={class:"border border-gray-300 px-2 py-2 text-center"},vt={class:"border border-gray-300 px-2 py-2"},mt={class:"border border-gray-300 px-2"},yt={class:"flex justify-center gap-2"},pt=["onClick"],ct={key:0},gt={key:0},_t={class:"text-center py-2",colspan:"6"},ft={key:0,class:"fixed inset-0 z-[1000] bg-black bg-opacity-50 flex items-center justify-center"},bt={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},Ct={__name:"AdminLeaveApplication",setup(Y){const q=ye(),r=pe(),k=re();de();const{user:g,leave_balances:S,leaveApplications:T,loading:U}=ce(k),D=_(r.query.year||k.selectedYear),h=_(r.query.search||""),a=_({company_id:r.query.company_id||"",department_id:r.query.department_id||"all",type:r.query.type||"all",employee_id:r.query.employee_id||""}),m=_(!1),x=async()=>{const o={selectedYear:D.value,selectedStatus:k.selectedStatus,query:h.value};a.value.employee_id?(o.user_id=a.value.employee_id,U.value=!0,await k.fetchYearlyUserLeaveApplications(o),U.value=!1):T.value=[]};ae(async()=>{await x()});const L=B(()=>T.value||[]),I=()=>q.go(-1),p=async()=>{q.replace({query:{...r.query,company_id:a.value.company_id,department_id:a.value.department_id,type:a.value.type,employee_id:a.value.employee_id}}),await x()},N=async()=>{console.log("test close"),m.value=!1,await x()},E=new Date().getFullYear(),d=_([]);for(let o=2023;o<=E;o++)d.value.push(o);const s=async o=>{confirm("Are you sure to delete this application?")&&(await k.deleteLeaveApplication(o),await x())};return(o,t)=>{var v,f,R,j,z,O,P,J,G,K,Q,X,Z;const y=ge("RouterLink");return n(),u($,null,[e("div",Ne,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:I},t[5]||(t[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[6]||(t[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),t[7]||(t[7]=e("div",null,null,-1))]),e("div",Ee,[C(ke,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value=l),"initial-value":c(r).query,onFilterChange:p},null,8,["modelValue","initial-value"]),e("div",null,[w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>D.value=l),onChange:x,class:"input-1"},[(n(!0),u($,null,V(d.value,l=>(n(),u("option",{key:l,value:l},i(l),9,He))),128))],544),[[_e,D.value]])])]),c(k).loading?(n(),u("div",We,[C(ne)])):(n(),u("div",Ye,[(v=a.value)!=null&&v.employee_id?(n(),u("div",ze,[t[19]||(t[19]=e("h2",{class:"text-xl font-bold text-gray-800 text-center"},"Employee Overview",-1)),e("div",Oe,[e("div",Pe,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"User Info",-1)),e("div",Je,[e("p",null,[t[8]||(t[8]=e("strong",null,"Name:",-1)),A(" "+i((f=c(g))==null?void 0:f.name),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"Designation:",-1)),A(" "+i((j=(R=c(g))==null?void 0:R.designation)==null?void 0:j.title),1)]),e("p",null,[t[10]||(t[10]=e("strong",null,"Department:",-1)),A(" "+i((O=(z=c(g))==null?void 0:z.department)==null?void 0:O.name),1)]),e("p",null,[t[11]||(t[11]=e("strong",null,"Company:",-1)),A(" "+i((J=(P=c(g))==null?void 0:P.company)==null?void 0:J.name),1)]),e("p",null,[t[12]||(t[12]=e("strong",null,"Phone:",-1)),A(" "+i((G=c(g))==null?void 0:G.phone),1)]),e("p",null,[t[13]||(t[13]=e("strong",null,"Email:",-1)),A(" "+i((K=c(g))==null?void 0:K.email),1)]),e("p",null,[t[14]||(t[14]=e("strong",null,"Joining Date:",-1)),A(" "+i((Q=c(g))==null?void 0:Q.joining_date),1)]),e("p",null,[t[15]||(t[15]=e("strong",null,"Blood Group:",-1)),A(" "+i(((X=c(g))==null?void 0:X.blood)||"N/A"),1)])])]),e("div",Ge,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Leave Balance",-1)),e("div",Ke,[e("table",Qe,[t[17]||(t[17]=e("thead",{class:"bg-gray-100 text-xs uppercase"},[e("tr",null,[e("th",{class:"px-4 py-2 text-center"},"Type"),e("th",{class:"px-4 py-2 text-center"},"Total"),e("th",{class:"px-4 py-2 text-center"},"Used"),e("th",{class:"px-4 py-2 text-center"},"Remaining")])],-1)),e("tbody",null,[(n(!0),u($,null,V(c(S),l=>(n(),u("tr",{key:l.id,class:"border-t hover:bg-gray-50"},[e("td",Xe,i(l.leave_type),1),e("td",Ze,i(l.total_leave_days),1),e("td",et,i(l.used_days),1),e("td",tt,i(l.remaining_days),1)]))),128))])])])])])])):b("",!0),e("div",st,[e("table",lt,[t[24]||(t[24]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Type"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")])],-1)),e("tbody",null,[(n(!0),u($,null,V(L.value,(l,ee)=>{var te;return n(),u("tr",{key:ee,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ot,i(ee+1),1),e("td",at,i(l==null?void 0:l.last_working_date),1),e("td",nt,i(l==null?void 0:l.resumption_date),1),e("td",rt,i(l==null?void 0:l.leave_period),1),e("td",dt,[e("div",{innerHTML:(l==null?void 0:l.duration)||(l==null?void 0:l.total_leave_days)},null,8,ut)]),e("td",it,i([...new Set((te=l==null?void 0:l.leave_days)==null?void 0:te.map(F=>{var se;return(se=F==null?void 0:F.leave_type)==null?void 0:se.name}))].join(",")),1),e("td",vt,i((l==null?void 0:l.status)||"N/A"),1),e("td",mt,[e("div",yt,[C(y,{to:{name:"LeaveApplicationShow",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:oe(()=>t[20]||(t[20]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[20]},1032,["to"]),["Approved","Rejected"].includes(l==null?void 0:l.status)?b("",!0):(n(),W(y,{key:0,to:{name:"LeaveApplicationEdit",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:oe(()=>t[21]||(t[21]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[21]},1032,["to"])),e("button",{onClick:F=>s(l==null?void 0:l.id),class:"btn-icon text-red-500"},t[22]||(t[22]=[e("i",{class:"far fa-trash"},null,-1)]),8,pt)])])])}),128)),L.value.length?b("",!0):(n(),u("tr",ct,t[23]||(t[23]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(Z=a.value)!=null&&Z.employee_id?(n(),u("tr",gt,[e("th",_t,[e("button",{onClick:t[2]||(t[2]=l=>m.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):b("",!0)])])])]))]),(n(),W(fe,{to:"body"},[m.value?(n(),u("div",ft,[e("div",bt,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:t[3]||(t[3]=l=>m.value=!1)}," × "),C(Ie,{userInfo:c(g),onClose:t[4]||(t[4]=l=>m.value=!1),onFormSuccessClosed:N},null,8,["userInfo"])])])):b("",!0)]))],64)}}};export{Ct as default};
