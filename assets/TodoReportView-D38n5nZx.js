import{r as F,G as ce,x as w,q as M,c as l,o,a as t,N as le,w as ge,s as C,d as W,k as ie,v as pe,f as De,u as Ie,D as me,h as ue,y as ke,j as h,i as Te,l as Q,m as O,t as u,F as T,e as U,b as ye,M as Se}from"./index-Ocf9ygh3.js";import{L as $e}from"./LoaderView-BMi3QEyj.js";import{_ as Ce}from"./EmployeeFilter-Da3rjbvm.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as Re,b as V}from"./datetime-BEfC2TVK.js";import{u as Ee}from"./company-C9ZWhsNk.js";import{u as Ae}from"./department-BuF7wL4q.js";import{u as Le}from"./useTodoDateStore-CkGChtPk.js";import"./EmployeeDropdownInput-BYx3pqqk.js";import"./SelectDropdown-DVIQl_9u.js";import"./UserChip-CVnLEvW9.js";import"./url-CePbr-gY.js";const Ue={class:"px-4 py-4 md:py-3 bg-white rounded-md border"},Me={class:"flex flex-wrap items-center gap-3"},ze=["disabled"],Be={class:"print-hide"},Oe={class:"flex flex-col md:flex-row flex-wrap items-end md:ml-auto w-full md:w-auto gap-x-3 gap-y-4 print-hide"},Ve={class:"flex items-center justify-between w-full md:w-auto gap-3"},Fe={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Pe={class:"relative h-[32px] w-[150px] sm:w-[170px]"},je={__name:"TodoReportHeading",props:{loading:{type:Boolean,default:!1},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},employeeId:{type:[String,Number],default:""},lineType:{type:String,default:"all"},startDate:{type:String,default:""},endDate:{type:String,default:""}},emits:["reloadClick","change"],setup(R,{expose:b,emit:P}){const r=R,S=F(null),E=P,d=ce({companyId:String(r.companyId||""),departmentId:r.departmentId!==""&&r.departmentId!=null?String(r.departmentId):"",employeeId:String(r.employeeId||""),lineType:r.lineType||"all",startDate:r.startDate||"",endDate:r.endDate||""}),A=w(()=>({companyId:d.companyId,departmentId:d.departmentId,employeeId:d.employeeId,lineType:d.lineType,startDate:d.startDate,endDate:d.endDate}));function z(){E("change",{...A.value})}return M(()=>[r.companyId,r.departmentId,r.employeeId,r.lineType,r.startDate,r.endDate],()=>{d.companyId=String(r.companyId||""),d.departmentId=r.departmentId!==""&&r.departmentId!=null?String(r.departmentId):"",d.employeeId=String(r.employeeId||""),d.lineType=r.lineType||"all",d.startDate=r.startDate||"",d.endDate=r.endDate||""}),M(A,z,{deep:!0}),b({employees:w(()=>{var _;return((_=S.value)==null?void 0:_.employees)||[]})}),(_,e)=>(o(),l("div",Ue,[t("div",Me,[le(_.$slots,"before",{},void 0,!0),t("button",{class:C(["btn-icon print-hide",{"animate-spin !bg-opacity-0":R.loading}]),onClick:e[0]||(e[0]=ge(m=>E("reloadClick"),["prevent"])),disabled:R.loading,title:"Reload"},[t("i",{class:C(["fas fa-redo",[R.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,ze),t("span",Be,[le(_.$slots,"after",{},void 0,!0)]),t("div",Oe,[W(Ce,{ref_key:"employeeFilterRef",ref:S,company_id:d.companyId,"onUpdate:company_id":e[1]||(e[1]=m=>d.companyId=m),department_id:d.departmentId,"onUpdate:department_id":e[2]||(e[2]=m=>d.departmentId=m),employee_id:d.employeeId,"onUpdate:employee_id":e[3]||(e[3]=m=>d.employeeId=m),line_type:d.lineType,"onUpdate:line_type":e[4]||(e[4]=m=>d.lineType=m),"with-type":!0,class:"flex-1 gap-y-4 md:flex items-center justify-between w-full md:w-auto"},null,8,["company_id","department_id","employee_id","line_type"]),t("div",Ve,[t("div",Fe,[e[7]||(e[7]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Start Date",-1)),ie(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=m=>d.startDate=m),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[pe,d.startDate]])]),t("div",Pe,[e[8]||(e[8]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"End Date",-1)),ie(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=m=>d.endDate=m),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[pe,d.endDate]])])])])])]))}},He=Ne(je,[["__scopeId","data-v-1bffbf10"]]),Je={class:"container print:flex-grow mx-auto print:w-full px-4 py-6 print:px-0 print:py-0"},Ke=["disabled"],Qe={key:0,class:"bg-white border rounded-md mb-2 p-4 text-sm print:border-0 print:mb-2 print:px-0 print:w-full relative overflow-visible z-40"},We={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-7 gap-y-2 gap-x-6"},Ye={class:"font-medium text-gray-800"},Xe={class:"col-span-2"},Ze={class:"font-medium text-gray-800"},Ge={class:"inline-flex items-center gap-5 font-bold"},qe={class:"text-gray-700"},et={key:0,class:"mt-2 w-[280px] sm:w-[320px] lg:w-[280px] xl:w-[320px] bg-white border border-gray-200 rounded-md p-3 shadow-lg text-left absolute right-0"},tt={class:"flex items-center justify-between mb-2"},nt={class:"text-[11px] text-gray-500"},at={class:"space-y-3 max-h-56 overflow-auto pr-1 z-50"},st={class:"pt-2 border-t border-dashed border-gray-200"},rt={class:"flex flex-wrap gap-2"},dt={key:0,class:"text-xs text-gray-400"},ot=["title"],lt={class:"block max-w-[160px] truncate"},it={class:"flex flex-wrap gap-2"},pt={key:0,class:"text-xs text-gray-400"},mt=["title"],ut={class:"block max-w-[160px] truncate"},yt={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},ct={key:3,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},gt={key:4,class:"overflow-x-auto md:overflow-clip bg-white border border-t-0 rounded-md shadow-sm print:shadow-none print:rounded-none print:border-gray-400"},xt={class:"min-w-full text-left text-sm border-separate border-spacing-0"},ft={class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},bt={class:"border-y print:border-gray-400 sticky md:top-[123px] z-30 rounded-t-md"},vt={key:0,class:"px-4 py-3 border bg-white bg-opacity-70 backdrop-blur-sm text-center"},wt={class:"divide-y divide-gray-200"},ht=["rowspan"],_t={class:"sticky top-[170px] bg-white text-center"},Dt=["rowspan"],It={class:"sticky top-[170px] bg-white flex"},kt={key:0,class:"text-xs text-gray-500"},Tt=["colspan"],St=["rowspan"],$t={class:"sticky top-[170px] bg-white"},Ct={class:"px-4 py-3 text-gray-800 border-l border-t"},Nt={class:"font-medium"},Rt={class:"text-gray-400 mr-2"},Et={class:"text-xs text-gray-500"},At={class:"px-4 py-3 border-l border-t border-r text-center"},Kt={__name:"TodoReportView",setup(R){var Z,G,q,ee,te,ne;const b=De(),P=Ie(),r=Le(),S=Ee(),E=Ae(),{companies:d}=me(S),{departments:A}=me(E),z=F(null),_=Re(new Date),e=ce({companyId:((Z=b.query)==null?void 0:Z.company_id)||"",departmentId:((G=b.query)==null?void 0:G.department_id)||"",employeeId:((q=b.query)==null?void 0:q.employee_id)||"",lineType:((ee=b.query)==null?void 0:ee.line_type)||"all",startDate:((te=b.query)==null?void 0:te.start_date)||_,endDate:((ne=b.query)==null?void 0:ne.end_date)||_}),m=w(()=>{var a;return[...((a=z.value)==null?void 0:a.employees)||[]].sort((n,s)=>{var c,y;return(((c=n.user)==null?void 0:c.name)||"").localeCompare(((y=s.user)==null?void 0:y.name)||"")}).map(n=>{const s=r.todo_dates.filter(p=>{var i;return String((i=p.user)==null?void 0:i.id)===String(n.id)}),c={};s.forEach(p=>{const i=p.date||"unknown-date";c[i]||(c[i]={date:i,todos:[]}),c[i].todos.push(p)});let y=Object.values(c).map(p=>({...p,rowSpan:p.todos.length})).sort((p,i)=>new Date(p.date)-new Date(i.date));y.length||(y=[{date:null,rowSpan:1,todos:[{id:`empty-${n.id}`,isPlaceholder:!0,title:""}]}]);const v=y.reduce((p,i)=>p+i.rowSpan,0);return{user:n,dates:y,rowSpan:Math.max(1,v)}})}),xe=w(()=>{if(!e.startDate||!e.endDate)return"";const a=V(e.startDate,{weekDay:"long"}),n=V(e.endDate,{weekDay:"long"});return`${a} ~ ${n}`}),fe=w(()=>S.employees||[]),be={all:"All Types",executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},D=w(()=>{var y,v,p,i,I,k,g,f;const a=e.companyId&&((y=d.value)!=null&&y.length)?(v=d.value.find(x=>String(x.id)===String(e.companyId)))==null?void 0:v.name:null,n=e.departmentId&&((p=A.value)!=null&&p.length)?(i=A.value.find(x=>String(x.id)===String(e.departmentId)))==null?void 0:i.name:null;let s=null;e.employeeId&&(s=((k=(I=fe.value)==null?void 0:I.find(x=>String(x.id)===String(e.employeeId)))==null?void 0:k.name)||((f=(g=m.value.find(x=>{var $;return String((($=x.user)==null?void 0:$.id)||"")===String(e.employeeId)}))==null?void 0:g.user)==null?void 0:f.name)||null);const c=e.startDate===e.endDate&&e.startDate?V(e.startDate,{weekDay:"long"}):xe.value||"-";return{company:a||(e.companyId?`#${e.companyId}`:"All Companies"),department:n||(e.departmentId?`#${e.departmentId}`:"All Departments"),employee:s||(e.employeeId?`#${e.employeeId}`:"All Employees"),lineType:be[e.lineType]||e.lineType||"All Types",dateRange:c}}),N=F(!1),j=F(null),H=w(()=>{var a;return((a=m.value)==null?void 0:a.length)||0}),Y=w(()=>{var a,n;return Math.max(0,H.value-(((n=(a=L.value)==null?void 0:a.withoutTodos)==null?void 0:n.length)||0))}),X=a=>{N.value&&j.value&&(j.value.contains(a.target)||(N.value=!1))},L=w(()=>{var a;return(a=m.value)!=null&&a.length?m.value.reduce((n,s,c)=>{var p,i,I,k,g,f;const y=s.dates.reduce((x,$)=>x+$.todos.filter(B=>!B.isPlaceholder).length,0),v={id:((p=s.user)==null?void 0:p.id)??((i=s.user)==null?void 0:i.user_id)??((I=s.user)==null?void 0:I.uid)??((k=s.user)==null?void 0:k.email)??`${((g=s.user)==null?void 0:g.name)||"unknown"}-${c}`,name:((f=s.user)==null?void 0:f.name)||"Unknown user"};return y>0?n.withTodos.push(v):n.withoutTodos.push(v),n},{withTodos:[],withoutTodos:[]}):{withTodos:[],withoutTodos:[]}}),ve=a=>a==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":a==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":a==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200";function we(){P.replace({query:{...b.query,company_id:e.companyId||void 0,department_id:e.departmentId||void 0,employee_id:e.employeeId||void 0,line_type:e.lineType||void 0,start_date:e.startDate||void 0,end_date:e.endDate||void 0}})}async function J(){!e.companyId||!e.startDate||!e.endDate||await r.fetchTodoDates({"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate})}function he(a){e.companyId=a.companyId||"",e.departmentId=a.departmentId||"",e.employeeId=a.employeeId||"",e.lineType=a.lineType||"all",e.startDate=a.startDate||"",e.endDate=a.endDate||""}function _e(){window.print()}const K=w(()=>e.startDate===e.endDate);return M(()=>e.companyId,a=>{a&&(E.fetchDepartments(a),S.fetchEmployee(a))},{immediate:!0}),M(()=>({...e}),(a,n)=>{JSON.stringify(a)!==JSON.stringify(n)&&(we(),J())},{deep:!0}),M(()=>b.query,a=>{e.companyId=(a==null?void 0:a.company_id)||e.companyId,e.departmentId=(a==null?void 0:a.department_id)||e.departmentId,e.employeeId=(a==null?void 0:a.employee_id)||e.employeeId,e.lineType=(a==null?void 0:a.line_type)||e.lineType,e.startDate=(a==null?void 0:a.start_date)||e.startDate,e.endDate=(a==null?void 0:a.end_date)||e.endDate}),ue(()=>{S.fetchCompanies({ignore_permission:!0}),J()}),ue(()=>{document.addEventListener("click",X,!0)}),ke(()=>{document.removeEventListener("click",X,!0)}),(a,n)=>(o(),l("div",Je,[W(He,{ref_key:"headingRef",ref:z,"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate,loading:O(r).loading,class:"mb-4 print:px-0 print:py-0 print:mb-2 print:border-0 print:border-b print:border-gray-400 print:rounded-none print:w-full sticky top-[58px] z-50",onChange:he,onReloadClick:J},{before:Q(()=>n[1]||(n[1]=[t("div",null,[t("h1",{class:"text-xl font-semibold text-gray-800"},"Todo Report")],-1)])),after:Q(()=>[t("button",{type:"button",class:"btn-icon print-hide disabled:opacity-35 cursor-pointer disabled:cursor-not-allowed",onClick:ge(_e,["prevent"]),disabled:O(r).loading},n[2]||(n[2]=[t("i",{class:"fas fa-print"},null,-1)]),8,Ke)]),_:1},8,["company-id","department-id","employee-id","line-type","start-date","end-date","loading"]),e.companyId&&e.startDate&&e.endDate?(o(),l("div",Qe,[t("div",We,[t("div",null,[n[3]||(n[3]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Company",-1)),t("div",Ye,u(D.value.company),1)]),t("div",null,[n[4]||(n[4]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Department",-1)),t("div",{class:C(["font-medium",[D.value.department=="All Departments"?"text-gray-400":"text-gray-800"]])},u(D.value.department),3)]),t("div",null,[n[5]||(n[5]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Line Type",-1)),t("div",{class:C(["font-medium",[D.value.lineType=="All Types"?"text-gray-400":"text-gray-800"]])},u(D.value.lineType),3)]),t("div",null,[n[6]||(n[6]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Employee",-1)),t("div",{class:C(["font-medium",[D.value.employee=="All Employees"?"text-gray-400":"text-gray-800"]])},u(D.value.employee),3)]),t("div",Xe,[n[7]||(n[7]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Date",-1)),t("div",Ze,u(D.value.dateRange),1)]),t("div",{ref_key:"assignmentSummaryRef",ref:j,class:"print-hide relative"},[t("button",{type:"button",class:"px-3 bg-white text-gray-700 hover:bg-gray-50 w-full text-bg text-right",onClick:n[0]||(n[0]=s=>N.value=!N.value)},[n[8]||(n[8]=t("div",{class:"uppercase"},"Todo given",-1)),t("div",Ge,[t("div",qe,u(Y.value)+" / "+u(H.value),1),t("i",{class:C(["fas",[N.value?"fa-chevron-up":"fa-chevron-down"]])},null,2)])]),N.value?(o(),l("div",et,[t("div",tt,[n[9]||(n[9]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Todo Status",-1)),t("div",nt,u(Y.value)+" given / "+u(H.value)+" selected ",1)]),t("div",at,[t("div",st,[n[11]||(n[11]=t("div",{class:"text-[11px] text-gray-500 uppercase tracking-wide mb-1"}," Not given todos ",-1)),t("div",rt,[L.value.withoutTodos.length?h("",!0):(o(),l("span",dt," Everyone has todos ")),(o(!0),l(T,null,U(L.value.withoutTodos,s=>(o(),l("span",{key:`without-${s.id}`,class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-50 text-red-700 border border-red-100 text-xs max-w-full",title:s.name},[n[10]||(n[10]=t("i",{class:"fas fa-exclamation-circle"},null,-1)),t("span",lt,u(s.name),1)],8,ot))),128))])]),t("div",null,[n[13]||(n[13]=t("div",{class:"text-[11px] text-gray-500 uppercase tracking-wide mb-1"}," Given todos ",-1)),t("div",it,[L.value.withTodos.length?h("",!0):(o(),l("span",pt," No todos assigned ")),(o(!0),l(T,null,U(L.value.withTodos,s=>(o(),l("span",{key:`with-${s.id}`,class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100 text-xs max-w-full",title:s.name},[n[12]||(n[12]=t("i",{class:"fas fa-check-circle"},null,-1)),t("span",ut,u(s.name),1)],8,mt))),128))])])])])):h("",!0)],512)])])):h("",!0),!e.companyId||!e.startDate||!e.endDate?(o(),l("div",yt,n[14]||(n[14]=[t("p",{class:"text-red-500"},"Select company and date range to view the report.",-1)]))):O(r).loading?(o(),Te($e,{key:2},{default:Q(()=>n[15]||(n[15]=[ye("Loading report...")])),_:1,__:[15]})):m.value.length===0?(o(),l("div",ct,n[16]||(n[16]=[t("div",null,[t("i",{class:"fas fa-tasks fa-2x text-gray-300 mb-2"})],-1),t("div",null,"No todos.",-1)]))):(o(),l("div",gt,[t("table",xt,[t("thead",ft,[t("tr",bt,[n[17]||(n[17]=t("th",{class:"px-4 py-3 border w-[10px] bg-white bg-opacity-70 backdrop-blur-sm rounded-tl-md print:rounded-tl-none text-center"}," sl ",-1)),n[18]||(n[18]=t("th",{class:"px-4 py-3 border md:w-[100px] print:w-auto print:border-l print:border-l-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center"}," Employee Name ",-1)),K.value?h("",!0):(o(),l("th",vt," Date ")),n[19]||(n[19]=t("th",{class:"px-4 py-3 border bg-white text-center"},"Todo",-1)),n[20]||(n[20]=t("th",{class:"px-4 py-3 border print:border-r print:border-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center rounded-tr-md print:rounded-tr-none"}," Status ",-1))])]),t("tbody",wt,[(o(!0),l(T,null,U(m.value,(s,c)=>{var y,v,p;return o(),l(T,{key:((y=s.user)==null?void 0:y.id)||(((p=(v=s.dates[0])==null?void 0:v.todos[0])==null?void 0:p.id)??Math.random())},[(o(!0),l(T,null,U(s.dates,(i,I)=>{var k;return o(),l(T,{key:`${((k=s.user)==null?void 0:k.id)||"u"}-${i.date}`},[(o(!0),l(T,null,U(i.todos,(g,f)=>{var x,$,B,ae,se,re,de,oe;return o(),l("tr",{key:g.id||`${((x=s.user)==null?void 0:x.id)||"u"}-${i.date||"empty"}-${f}`,class:"border odd:bg-white even:bg-gray-50 hover:bg-gray-100"},[I===0&&f===0?(o(),l("td",{key:0,rowspan:s.rowSpan||1,class:"px-4 py-3 align-top font-bold text-xl text-gray-800 whitespace-nowrap border-l border-t bg-white"},[t("div",_t,u(c+1),1)],8,ht)):h("",!0),I===0&&f===0?(o(),l("td",{key:1,rowspan:s.rowSpan||1,class:"px-4 py-3 align-top font-medium text-gray-800 whitespace-nowrap border-l border-t bg-white"},[t("div",It,[W(Se,{size:"medium",user:s.user,class:"inline-block mr-2 align-middle"},null,8,["user"]),t("div",null,[t("div",null,u((($=s.user)==null?void 0:$.name)||"Unknown user"),1),(ae=(B=s.user)==null?void 0:B.department)!=null&&ae.name?(o(),l("div",kt,u((re=(se=s.user)==null?void 0:se.department)==null?void 0:re.name),1)):h("",!0)])])],8,Dt)):h("",!0),g.isPlaceholder?(o(),l("td",{key:2,class:"border-l border-t border-r bg-white px-4 py-3 text-center",colspan:K.value?2:3},n[21]||(n[21]=[t("div",{class:"text-red-400"},[t("i",{class:"fas fa-tasks text-red-200 mb-2 mr-1"}),t("span",null,"No todos found for this user. ")],-1)]),8,Tt)):(o(),l(T,{key:3},[f===0&&!K.value?(o(),l("td",{key:0,rowspan:i.rowSpan||1,class:"px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap border-l border-t bg-white"},[t("div",$t,u(O(V)(i.date)||i.date||"-"),1)],8,St)):h("",!0),t("td",Ct,[t("div",Nt,[t("span",Rt,u(f+1)+".",1),ye(" "+u(g.title),1)]),t("div",Et,u(((de=g.todoable)==null?void 0:de.title)||((oe=g.todoable_type)==null?void 0:oe.split("\\").pop())||""),1)]),t("td",At,[t("span",{class:C(["text-xs font-semibold px-2.5 py-1 rounded-full",ve(g.status)])},u(g.status||"N/A"),3)])],64))])}),128))],64)}),128))],64)}),128))])])]))]))}};export{Kt as default};
