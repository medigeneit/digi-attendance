import{r as h,q as O,c as u,j as b,o as i,F as A,e as D,a as t,t as S,h as B,i as U,w as k,d as n,l as _,b as R,m as w,k as V,v as q,H as P,u as I}from"./index-CXKyWMSV.js";import{_ as $}from"./CompanyDepartmentSelectInput-CvYiHN1W.js";import{R as C}from"./RequiredIcon-52msOjWQ.js";import{a as W}from"./requirement-B3oCxrSu.js";import{u as z}from"./company-DVBnAK_z.js";import{u as H}from"./tags-Buhdvzs6.js";import{u as G}from"./user-S87Iqfu3.js";import{L as J}from"./LoaderView-BGNf2NRt.js";import{S as T}from"./SelectDropdown-Bi1ethLt.js";import{_ as K}from"./TextEditor-C6_vOr1l.js";import{T as Q}from"./TextWithHr-B76IdEJR.js";import{_ as N}from"./UserChip-KQPhrcZF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function X(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(x){const m=Math.random()*16|0;return(x==="x"?m:m&3|8).toString(16)})}const Y={key:0,class:"mt-3 space-y-2"},Z=["src"],ee={key:1,class:"flex items-center gap-2"},te=["href"],se=["onClick"],oe={__name:"AttachmentPreview",props:{files:{type:Array,default:()=>[]}},setup(x){const m=x,d=h([]);return O(()=>m.files,p=>{d.value.forEach(a=>URL.revokeObjectURL(a.url)),d.value=p.map(a=>{if(a.type.startsWith("image/"))return{type:"image",url:URL.createObjectURL(a),name:a.name};if(a.type==="application/pdf")return{type:"pdf",url:URL.createObjectURL(a),name:a.name}})},{immediate:!0,deep:!0}),(p,a)=>x.files.length?(i(),u("div",Y,[(i(!0),u(A,null,D(d.value,(r,l)=>(i(),u("div",{key:l,class:"flex items-center gap-3 border rounded-md p-2 bg-gray-50"},[r.type==="image"?(i(),u("img",{key:0,src:r.url,alt:"Preview",class:"w-16 h-16 object-cover rounded-md border"},null,8,Z)):r.type==="pdf"?(i(),u("div",ee,[a[0]||(a[0]=t("span",{class:"text-red-500 text-lg"},"ðŸ“„",-1)),t("a",{href:r.url,target:"_blank",class:"text-blue-600 hover:underline text-sm truncate"},S(r.name),9,te)])):b("",!0),t("button",{type:"button",class:"ml-auto text-gray-500 hover:text-red-600 text-xs",onClick:v=>p.$emit("remove",l)}," âœ• Remove ",8,se)]))),128))])):b("",!0)}},ae={class:"w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},le={class:"sticky top-0 pt-4 bg-white z-10"},re={class:"block text-gray-600 text-sm mb-1 font-medium"},ne={class:"block text-gray-600 text-sm mb-1 font-medium"},ie={class:"mb-4 col-span-4"},de={class:"col-span-full"},ue={class:"mb-4 mt-5"},me={class:"w-full table-auto print:table-fixed mt-8"},pe={class:"border-2 border-gray-800 px-2 pb-2 pt-8 text-gray-800 print:text-black text-base whitespace-nowrap"},ce={class:"mb-4"},be={class:"block text-gray-600 text-sm mb-1 font-medium"},xe={class:""},ve={class:"mt-4"},fe={class:"border-2 border-gray-800 text-gray-800 print:text-black text-base px-3 whitespace-nowrap print:whitespace-normal print:p-0"},ge={class:"mb-4"},ye={class:"mb-4"},_e={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},we={key:0,class:"mb-4 text-red-500 font-medium"},he={key:1,class:"mb-4"},ke={class:"flex items-center justify-between gap-4"},Re=["disabled"],Ve={__name:"RequirementAddForm",emits:["create","cancelClick","error"],setup(x,{emit:m}){const d=m,p=H(),a=G(),r=z(),l=h(""),v=h(""),o=h({title:"",description:"",from_department_id:"",to_department_id:"",website_tags:[],priority:"",better_to_complete_on:"",supervisor_id:"",attachments:[]});B(async()=>{l.value="loading",p.fetchTags("website"),await r.fetchCompanies({with:"departments",ignore_permission:!0}),await r.fetchMyCompanies({with:"departments"}),await a.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"}),l.value="",F()});function L(c){o.value.attachments=[...o.value.attachments,...Array.from(c.target.files)]}function j(c){o.value.attachments.splice(c,1)}async function E(){var e,f,g,y;l.value="submitting";const c=new FormData;for(const s in o.value)s==="attachments"?o.value.attachments.forEach(M=>c.append("attachments[]",M)):c.append(s,o.value[s]);try{const s=await W(c);d("create",s),l.value="create"}catch(s){d("error",(f=(e=s.response)==null?void 0:e.data)==null?void 0:f.message),v.value=(y=(g=s.response)==null?void 0:g.data)==null?void 0:y.message,l.value="error"}}function F(){o.value.details=[...o.value.details,{uuid:X(),title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:""}]}return(c,e)=>{var f,g,y;return i(),u("div",ae,[t("div",le,[e[10]||(e[10]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Requirement",-1)),e[11]||(e[11]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=k(s=>d("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),t("form",{onSubmit:k(E,["prevent"]),class:"z-0 grid grid-cols-8 gap-4"},[l.value!=="loading"&&l.value!=="submitting"?(i(),u(A,{key:0},[n($,{modelValue:o.value.from_department_id,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.from_department_id=s),companies:((f=w(r))==null?void 0:f.myCompanies)||[],class:"mb-4 col-span-2",className:{select:"h-10"}},{label:_(()=>[t("label",re,[e[12]||(e[12]=R(" From ")),n(C)])]),_:1},8,["modelValue","companies"]),n($,{modelValue:o.value.to_department_id,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.to_department_id=s),companies:((g=w(r))==null?void 0:g.companies)||[],class:"mb-4 col-span-2",className:{select:"h-10"}},{label:_(()=>[t("label",ne,[e[13]||(e[13]=R(" To ")),n(C)])]),_:1},8,["modelValue","companies"]),t("div",ie,[e[14]||(e[14]=t("label",{class:"text-gray-800 text-sm"},"Websites",-1)),n(T,{options:w(p).tags,modelValue:o.value.website_tags,"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.website_tags=s),taggable:"",label:"name",value:"name"},null,8,["options","modelValue"])])],64)):b("",!0),t("div",de,[t("div",ue,[n(Q,{class:"mb-5"},{default:_(()=>e[15]||(e[15]=[t("h3",{class:"font-semibold text-xl text-gray-800 mx-2"},"Requirement details",-1)])),_:1,__:[15]}),t("table",me,[e[24]||(e[24]=t("thead",null,[t("tr",null,[t("th",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap w-[65%]"}," Requirement "),t("th",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Options ")])],-1)),t("tbody",null,[t("tr",null,[t("td",pe,[t("div",ce,[t("label",be,[e[16]||(e[16]=R(" Title ")),n(C)]),V(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.title=s),required:"",placeholder:"Ender Requirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[q,o.value.title]])]),t("div",xe,[e[17]||(e[17]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),n(K,{modelValue:o.value.description,"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.description=s),class:"w-full"},null,8,["modelValue"])]),t("div",ve,[e[18]||(e[18]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Attachments",-1)),t("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",onChange:L},null,32)]),n(oe,{files:((y=o.value)==null?void 0:y.attachments)||[],onRemove:j},null,8,["files"]),e[19]||(e[19]=t("div",{class:"flex items-center justify-between h-full"},null,-1))]),t("td",fe,[t("div",ge,[e[20]||(e[20]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),V(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=s=>o.value.better_to_complete_on=s),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[q,o.value.better_to_complete_on]])]),t("div",ye,[e[21]||(e[21]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor ",-1)),n(T,{modelValue:o.value.supervisor_id,"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.supervisor_id=s),options:w(a).users,placeholder:"--NO SUPERVISOR--",class:"h-10 w-full",clearable:""},{option:_(({option:s})=>[n(N,{user:s||{},class:"w-full overflow-hidden border relative"},null,8,["user"])]),"selected-option":_(({option:s})=>[s?(i(),U(N,{key:0,user:s||{}},null,8,["user"])):b("",!0)]),_:1},8,["modelValue","options"])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),V(t("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 h-10","onUpdate:modelValue":e[8]||(e[8]=s=>o.value.priority=s)},e[22]||(e[22]=[t("option",{value:""},"NORMAL",-1),t("option",null,"IMPORTANT",-1),t("option",null,"URGENT",-1)]),512),[[P,o.value.priority]])])])])])])]),t("div",_e,[v.value?(i(),u("div",we,S(v.value),1)):b("",!0),v.value?(i(),u("hr",he)):b("",!0),t("div",ke,[t("button",{type:"button",onClick:e[9]||(e[9]=k(s=>d("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),t("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},S(l.value=="submitting"?"Saving...":"Save"),9,Re)])])])],32),l.value==="loading"||l.value==="submitting"?(i(),U(J,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):b("",!0)])}}},Ce={class:"container mx-auto p-6"},De={__name:"RequirementAdd",setup(x){const m=I();function d(p){var r;const a=((r=p.data)==null?void 0:r.requirement)||null;a&&m.push({name:"RequirementShow",params:{id:a.id}})}return(p,a)=>(i(),u("div",Ce,[n(Ve,{onCreate:d,onCancelClick:a[0]||(a[0]=r=>w(m).back())})]))}};export{De as default};
