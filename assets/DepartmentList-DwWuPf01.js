import{s as T,r as h,D as O,m as I,z as k,c as i,g as z,o as c,a as e,t as d,w as R,h as $,B as j,F,q as U,k as V,p as w,v as A,a1 as G,e as H,j as q}from"./index-D1uv_qEI.js";import{_ as B}from"./MultiselectDropdown-J3l7-YLj.js";import{u as J}from"./company-CvDY86cR.js";import{_ as K,a as P}from"./HeaderWithButtons-BB6DkFp2.js";import{L as Q}from"./LoaderView-Crq6wuxx.js";import{u as W}from"./department-CkoZSvei.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={key:0,class:"modal-bg"},Y={class:"modal-card"},Z={class:"text-lg font-semibold mb-4"},ee={class:"mb-4"},te=["value"],se={class:"mb-4"},oe={class:"mb-4"},ae={class:"mb-4"},le={class:"mb-4"},ne={class:"mb-4"},re={class:"mb-4"},de={class:"flex justify-end"},ie={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},ce={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup(M,{emit:u}){const r=M,b=u,m=J(),{companies:p,employees:D}=T(m),y=h(""),_=h(""),x=h(!1),C=h(!1),s=O({id:null,company_id:"",incharge_id:"",coordinator_id:"",name:"",short_name:"",description:"",status:"Active"}),S=I(()=>y.value?y.value.id:null),E=I(()=>_.value?_.value.id:null);k(S,a=>{s.incharge_id=a}),k(E,a=>{s.coordinator_id=a});const l=()=>{x.value=!1,s.id=null,s.company_id="",s.incharge_id="",s.coordinator_id="",s.name="",s.short_name="",s.description="",s.status="Active"};k(()=>r.department,a=>{var t,o;a&&typeof a=="object"&&Object.keys(a).length>0?(x.value=!0,s.id=a.id||null,s.company_id=a.company_id||"",s.incharge_id=((t=a.in_charge)==null?void 0:t.id)||"",s.coordinator_id=((o=a.coordinator)==null?void 0:o.id)||"",s.name=a.name||"",s.short_name=a.short_name||"",s.description=a.description||"",s.status=a.status||"Active"):l()},{immediate:!0,deep:!0}),k(()=>r.show,async a=>{a&&!C.value&&await g()}),k(()=>s.company_id,async a=>{a&&(await m.fetchEmployee(a),y.value=m.employees.find(t=>{var o,v;return t.id===((v=(o=r.department)==null?void 0:o.in_charge)==null?void 0:v.id)}),_.value=m.employees.find(t=>{var o,v;return t.id===((v=(o=r.department)==null?void 0:o.coordinator)==null?void 0:v.id)}))});const n=()=>{b("save",{...s}),l(),f()},f=()=>{l(),b("close")},g=async()=>{try{await m.fetchCompanies(),C.value=!0}catch(a){console.error("Failed to fetch companies:",a)}};return(a,t)=>M.show?(c(),i("div",X,[e("div",Y,[e("h2",Z,d(x.value?"Edit Department":"Add Department"),1),e("form",{onSubmit:R(n,["prevent"])},[e("div",ee,[t[8]||(t[8]=e("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),$(e("select",{id:"company_id","onUpdate:modelValue":t[0]||(t[0]=o=>s.company_id=o),class:"w-full border rounded px-3 py-2",required:""},[t[7]||(t[7]=e("option",{value:"",disabled:""},"Select a company",-1)),(c(!0),i(F,null,U(V(p),o=>(c(),i("option",{key:o.id,value:o.id},d(o.name),9,te))),128))],512),[[j,s.company_id]])]),e("div",se,[t[9]||(t[9]=e("label",{for:"incharge_id",class:"block text-sm font-medium mb-2"},"In-Charge",-1)),w(B,{options:V(D),modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=o=>y.value=o),label:"label",multiple:!1},null,8,["options","modelValue"])]),e("div",oe,[t[10]||(t[10]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Coordinator",-1)),w(B,{options:V(D),modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=o=>_.value=o),label:"label",multiple:!1},null,8,["options","modelValue"])]),e("div",ae,[t[11]||(t[11]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),$(e("input",{id:"name","onUpdate:modelValue":t[3]||(t[3]=o=>s.name=o),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[A,s.name]])]),e("div",le,[t[12]||(t[12]=e("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),$(e("input",{id:"short_name","onUpdate:modelValue":t[4]||(t[4]=o=>s.short_name=o),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[A,s.short_name]])]),e("div",ne,[t[13]||(t[13]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),$(e("textarea",{id:"description","onUpdate:modelValue":t[5]||(t[5]=o=>s.description=o),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[A,s.description]])]),e("div",re,[t[15]||(t[15]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),$(e("select",{id:"status","onUpdate:modelValue":t[6]||(t[6]=o=>s.status=o),class:"w-full border rounded px-3 py-2",required:""},t[14]||(t[14]=[e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)]),512),[[j,s.status]])]),e("div",de,[e("button",{type:"button",onClick:f,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",ie,d(x.value?"Update":"Create"),1)])],32)])])):z("",!0)}},ue={class:"my-container space-y-4"},me={key:0,class:"text-center py-4"},pe={key:1,class:"space-y-4"},fe={class:"title-md"},ye={class:"overflow-x-auto"},ve={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},be={class:"text-gray-600 text-sm"},_e={class:"py-3 px-2 text-center"},he={class:"py-3 px-2 text-left"},xe={class:"py-3 px-2 text-left"},ge={class:"py-3 px-2 text-center"},we={class:"py-3 px-2 text-center"},Ce={class:"py-3 px-2 text-center"},ke={class:"flex item-center justify-center gap-4"},$e=["onClick"],De=["onClick"],Ue={__name:"DepartmentList",setup(M){const u=W(),r=G(),b=h(!1),m=h(!1),p=h(null),D=()=>{p.value=null,b.value=!0},y=()=>{b.value=!1},_=l=>{p.value=l,b.value=!0},x=l=>{p.value=l,m.value=!0},C=()=>{m.value=!1},s=async l=>{try{l.id?(await u.updateDepartment(l.id,l),r.success("Department updated successfully!"),await u.fetchDepartments()):(await u.createDepartment(l),r.success("Department added successfully!"))}catch(n){r.error("Failed to save department!"),console.error("Error handling save:",n)}finally{y()}},S=async()=>{var l;if(!((l=p.value)!=null&&l.id)){r.error("Invalid department selected for deletion!");return}try{await u.deleteDepartment(p.value.id),r.success("Department deleted successfully!")}catch(n){r.error("Failed to delete department!"),console.error("Error deleting department:",n)}finally{C()}},E=I(()=>{const l={};return u.departments.forEach(n=>{var g;const f=((g=n.company)==null?void 0:g.name)||"Unknown Company";l[f]||(l[f]=[]),l[f].push(n)}),l});return H(async()=>{try{await u.fetchDepartments()}catch(l){r.error("Failed to fetch departments!"),console.error("Error fetching departments:",l)}}),(l,n)=>{var f;return c(),i("div",ue,[w(K,{title:"Department List",onAdd:D}),V(u).loading?(c(),i("div",me,[w(Q)])):(c(),i("div",pe,[(c(!0),i(F,null,U(E.value,(g,a)=>(c(),i("div",{key:a},[e("h2",fe,d(a),1),e("div",ye,[e("table",ve,[n[4]||(n[4]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-center"},"#"),e("th",{class:"py-3 px-2 text-left"},"Department Name"),e("th",{class:"py-3 px-2 text-left"},"Coordinator & In-Charge"),e("th",{class:"py-3 px-2 text-center"},"Employee"),e("th",{class:"py-3 px-2 text-center"},"Status"),e("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),e("tbody",be,[(c(!0),i(F,null,U(g,(t,o)=>{var v,N;return c(),i("tr",{key:o,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",_e,d(o+=1),1),e("td",he,[e("div",null,d(t.name),1),e("strong",null,d(t.short_name),1)]),e("td",xe,[e("div",null,[n[0]||(n[0]=e("span",{class:"text-gray-400"},"Coordinator: ",-1)),q(" "+d(((v=t.coordinator)==null?void 0:v.name)||"-"),1)]),e("div",null,[n[1]||(n[1]=e("span",{class:"text-gray-400"},"In-Charge: ",-1)),q(" "+d(((N=t.in_charge)==null?void 0:N.name)||"-"),1)])]),e("td",ge,d(t==null?void 0:t.users_count),1),e("td",we,d(t.status),1),e("td",Ce,[e("div",ke,[e("button",{onClick:L=>_(t),class:"text-blue-600 hover:text-blue-800"},n[2]||(n[2]=[e("i",{class:"fas fa-edit"},null,-1)]),8,$e),e("button",{onClick:L=>x(t),class:"text-red-600 hover:text-red-800"},n[3]||(n[3]=[e("i",{class:"fas fa-trash"},null,-1)]),8,De)])])])}),128))])])])]))),128))])),w(ce,{show:b.value,department:p.value,onClose:y,onSave:s},null,8,["show","department"]),w(P,{show:m.value,title:"Delete Department",message:`Are you sure you want to delete ${(f=p.value)==null?void 0:f.name}?`,onClose:C,onConfirm:S},null,8,["show","message"])])}}};export{Ue as default};
