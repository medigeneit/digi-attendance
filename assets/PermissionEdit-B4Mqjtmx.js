import{D as p,f as L,u as V,r as x,q as B,h as j,c as n,o as l,a as s,m as r,d as E,j as F,k as c,H as M,F as g,e as h,t as k,P}from"./index-BteeEovh.js";import{_ as N}from"./MultiselectDropdown-BatEIbnW.js";import{u as R}from"./company-CEEzrARe.js";import{u as $}from"./department-CXiUJXQX.js";import{u as q}from"./user-BW_Ico--.js";import{u as A}from"./userPermissionStore-Bvg3B77I.js";const H={class:"max-w-3xl mx-auto px-4 py-8 space-y-6"},T={class:"flex items-center justify-between gap-3"},z={class:"rounded-2xl border border-slate-200 bg-white shadow-sm p-6 space-y-6"},G=["value"],I={key:0},J={class:"space-y-2"},K={class:"flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-2 text-sm"},O={class:"grid grid-cols-1 md:grid-cols-2 gap-2"},Q=["value"],W={class:"truncate"},X={class:"flex items-center justify-end gap-2 pt-2"},Y=["disabled"],Z={key:0},ee={key:1},ie={__name:"PermissionEdit",setup(se){const f=q(),i=A(),b=R(),u=$(),{users:v}=p(f),{companies:C}=p(b),{departments:y}=p(u),_=L(),d=V(),m=x(null),a=x({user_id:"",company_id:"",department_ids:[]}),S=async()=>{try{const o=await i.fetchPermission(_.params.id);a.value.user_id=o.user_id,a.value.company_id=o.company_id,a.value.department_ids=o.department_ids.includes("*")?["*"]:o.department_ids,m.value=v.value.find(e=>e.id===o.user_id)||null,await u.fetchDepartments(o.company_id)}catch{alert(i.error||"Failed to load permission"),d.push({name:"PermissionList"})}};B(m,o=>{a.value.user_id=(o==null?void 0:o.id)||""});const U=async()=>{a.value.department_ids=[],await u.fetchDepartments(a.value.company_id)},w=async()=>{try{await i.updatePermission(_.params.id,a.value),d.push({name:"PermissionList"})}catch{alert(i.error||"Update failed")}};return j(async()=>{await Promise.all([f.fetchUsers(),b.fetchCompanies()]),await S()}),(o,e)=>(l(),n("div",H,[s("header",T,[e[7]||(e[7]=s("div",null,[s("h2",{class:"text-xl font-semibold text-slate-900"},"Edit Permission"),s("p",{class:"text-xs text-slate-500"},"Update access scope for a user.")],-1)),s("button",{class:"btn-3",onClick:e[0]||(e[0]=t=>r(d).push({name:"PermissionList"}))},e[6]||(e[6]=[s("i",{class:"far fa-arrow-left"},null,-1),s("span",{class:"hidden md:flex"},"Back",-1)]))]),s("div",z,[E(N,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),options:r(v),multiple:!1,label:"label",topLabel:"Select User",placeholder:"Select employee"},null,8,["modelValue","options"]),s("div",null,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-slate-700 mb-1"},"Company",-1)),c(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.company_id=t),onChange:U,class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm bg-slate-50 text-slate-600",disabled:""},[e[8]||(e[8]=s("option",{value:""},"-- Select Company --",-1)),(l(!0),n(g,null,h(r(C),t=>(l(),n("option",{key:t.id,value:t.id},k(t.name),9,G))),128))],544),[[M,a.value.company_id]])]),r(y).length?(l(),n("div",I,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Departments",-1)),s("div",J,[s("label",K,[c(s("input",{type:"checkbox",value:"*","onUpdate:modelValue":e[3]||(e[3]=t=>a.value.department_ids=t),class:"h-4 w-4"},null,512),[[P,a.value.department_ids]]),e[10]||(e[10]=s("span",{class:"font-medium"},"All Departments",-1))]),s("div",O,[(l(!0),n(g,null,h(r(y),t=>(l(),n("label",{key:t.id,class:"flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-2 text-sm hover:bg-slate-50"},[c(s("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":e[4]||(e[4]=D=>a.value.department_ids=D),class:"h-4 w-4"},null,8,Q),[[P,a.value.department_ids]]),s("span",W,k(t.name),1)]))),128))])])])):F("",!0),s("div",X,[s("button",{type:"button",class:"btn-3",onClick:e[5]||(e[5]=t=>r(d).push({name:"PermissionList"}))}," Cancel "),s("button",{onClick:w,disabled:r(i).loading,class:"btn-2"},[r(i).loading?(l(),n("span",Z,"Updating...")):(l(),n("span",ee,"Update Permission"))],8,Y)])])]))}};export{ie as default};
