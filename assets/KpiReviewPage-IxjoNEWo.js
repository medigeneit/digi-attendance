import{x,r as w,c as r,o,a as s,k as g,t as i,O as j,n as oe,F as C,e as M,s as de,f as Ps,g as Ts,q as be,l as fe,G as js,v as He,j as tt,d as Rs,b as ne,I as Gs,m as Hs,z as zs,T as Bs,C as Xt}from"./index-B_wsJKL5.js";import{u as Ds}from"./kpi-DUMhT7ZV.js";const Ks={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Os={class:"flex items-center justify-between border-b bg-slate-50 px-3 py-2 gap-2"},Qs={class:"flex items-center gap-2 min-w-0"},Vs={class:"text-sm font-semibold text-slate-800 truncate"},Us={key:0,class:"text-[11px] text-slate-500 truncate"},qs={key:1,class:"flex items-center gap-2 shrink-0"},Ys={class:"inline-flex items-center rounded-xl border bg-white p-1 shadow-sm"},Ws=["disabled"],Js=["disabled"],Xs=["disabled"],Zs={class:"overflow-auto"},el={key:0,class:"min-w-[980px] w-full text-[11px]"},tl={class:"bg-slate-50 sticky top-0 z-10"},sl={class:"text-slate-700"},ll={class:"text-[11px] font-semibold"},al={class:"text-[10px] text-slate-500 flex flex-col items-center"},nl=["title"],ol={key:0,class:"mt-0.5 inline-flex items-center gap-1 rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-semibold text-blue-700 border border-blue-200"},rl={class:"bg-slate-100/80 border-t"},il=["colspan"],ul={class:"flex items-start justify-between gap-2"},dl=["title"],cl={class:"opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition shrink-0"},vl={class:"inline-flex items-center rounded-lg border bg-white p-0.5 shadow-sm"},ml=["disabled","onClick"],xl=["disabled","onClick"],pl=["disabled","onClick"],bl=["disabled","onClick"],fl=["disabled","onClick"],yl={key:0,class:"flex items-center justify-center"},gl=["max","value","onInput","onBlur","aria-label"],hl={key:1,class:"text-slate-700 tabular-nums"},_l={key:2,class:"text-slate-300"},kl={class:"bg-slate-50 border-t"},wl={class:"font-semibold text-slate-900 tabular-nums"},$l={class:"text-[10px] text-slate-500 tabular-nums"},Fl={class:"mt-1 h-1 rounded bg-slate-200 overflow-hidden"},Ll={key:1,class:"text-slate-300"},Sl={key:1,class:"w-full text-[11px]"},Nl={class:"sticky top-0 bg-white z-10"},Al={class:"bg-slate-100 text-slate-700"},Cl={class:"text-left px-2 py-2 w-[34%] font-medium"},Ml={class:"px-2 py-2 text-center text-slate-500"},El=["title"],Il={class:"px-2 py-2 text-center text-slate-700 tabular-nums"},Pl={class:"px-2 py-2 text-center"},Tl=["max","value","onInput","onBlur"],jl={key:1,class:"text-slate-700 tabular-nums"},Rl={class:"bg-slate-50 border-t"},Gl={class:"px-2 py-2 text-center font-semibold text-slate-800 tabular-nums"},Hl={class:"px-2 py-2 text-center font-semibold text-slate-900 tabular-nums"},$e=44,ze=320,et=84,Zt=Object.assign({name:"KpiGroupTable"},{__name:"KpiGroupTable",props:{group:{type:Object,required:!0},isPersonal:{type:Boolean,default:!1},lanes:{type:Array,default:()=>[]},editableLaneKey:{type:String,default:null},canEdit:{type:Boolean,default:!1},marks:{type:Object,default:()=>({})},headerLabel:{type:String,default:""},itemLabel:{type:String,default:"Item"},helperText:{type:String,default:""},showQuickFillGroup:{type:Boolean,default:!1},autoFillLabel:{type:String,default:""},autoFillVisible:{type:Boolean,default:!1},onAutoFill:{type:Function,default:null},serialMap:{type:Object,default:()=>({})},getLaneMark:{type:Function,default:()=>""},getHrMark:{type:Function,default:()=>""},onMarkChange:{type:Function,default:null},onCap:{type:Function,default:null},onQuickFillItem:{type:Function,default:null},onQuickFillGroup:{type:Function,default:null}},setup(p){const $=p,te=$e,S=$e+ze,re=x(()=>Array.isArray($.lanes)?$.lanes:[]),E=x(()=>{var f;return Array.isArray((f=$.group)==null?void 0:f.items)?$.group.items:[]}),Be=x(()=>$.showQuickFillGroup||$.isPersonal&&$.canEdit),ce=f=>{if(f===""||f==null)return null;const u=Number(f);return Number.isFinite(u)?u:null},k=f=>{const u=Number(f);return Number.isFinite(u)?u:0},I=(f,u,n)=>Math.min(Math.max(f,u),n),W=x(()=>E.value.reduce((f,u)=>f+k(u==null?void 0:u.max),0)),se=x(()=>E.value.reduce((f,u)=>{var h;const n=(h=$.marks)==null?void 0:h[u.id],y=n===""||n==null?0:Number(n),_=k(u==null?void 0:u.max);return f+I(k(y),0,_)},0)),le=(f,u)=>{var n;return((n=$.serialMap)==null?void 0:n[f.id])??u+1},H=w(!1),z=f=>(f==null?void 0:f.key)===$.editableLaneKey&&!!(f!=null&&f.can_current_user_review),ie=(f,u)=>{var n,y;return!f||!u?null:z(f)?ce((n=$.marks)==null?void 0:n[u.id]):f!=null&&f.can_view_marks?ce((y=$.getLaneMark)==null?void 0:y.call($,f.key,u.id)):null},T=x(()=>{const f={},u=k(W.value);return re.value.forEach(n=>{const y=z(n)||!!(n!=null&&n.can_view_marks);if(!(n!=null&&n.key))return;let _=0,h=!1;E.value.forEach(O=>{const Le=ie(n,O);if(Le==null)return;h=!0;const De=k(O==null?void 0:O.max);_+=I(k(Le),0,De)});const K=u>0?Math.round(_/u*100):0;f[n.key]={got:Number(_.toFixed(2)),max:Number(u.toFixed(2)),percent:K,hasData:h,canShow:y}}),f}),B=x(()=>{const f=re.value;if(H.value)return f;const u=f.filter(n=>{var y,_;return z(n)?!0:!!((_=(y=T.value)==null?void 0:y[n.key])!=null&&_.hasData)});return u.length?u:f}),ue=f=>{var y;const u=(y=T.value)==null?void 0:y[f];return!u||!u.max?"0%":`${I(u.got/u.max*100,0,100)}%`},D=f=>{var n;if(!$.canEdit)return!1;const u=(n=$.marks)==null?void 0:n[f.id];return u===""||u==null},ae=(f,u)=>{var y;const n=u===""?"":Number(u);u!==""&&Number.isNaN(n)||(y=$.onMarkChange)==null||y.call($,f,n)},Fe=(f,u)=>{var n;return(n=$.onCap)==null?void 0:n.call($,f,u)};return(f,u)=>(o(),r("section",Ks,[s("div",Os,[s("div",Qs,[s("div",Vs,i(p.headerLabel),1),p.isPersonal&&re.value.length>1?(o(),r("button",{key:0,type:"button",class:"shrink-0 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[10px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:u[0]||(u[0]=n=>H.value=!H.value)},i(H.value?"Show only filled lanes":"Show all lanes"),1)):g("",!0)]),p.helperText?(o(),r("div",Us,i(p.helperText),1)):g("",!0),Be.value&&p.itemLabel!=="Personal Attributes"?(o(),r("div",qs,[s("div",Ys,[s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg text-slate-700 hover:bg-slate-100 disabled:opacity-40",onClick:u[1]||(u[1]=n=>{var y;return(y=p.onQuickFillGroup)==null?void 0:y.call(p,p.group,"half")}),disabled:!p.canEdit}," All 1/2 ",8,Ws),s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg text-slate-700 hover:bg-slate-100 disabled:opacity-40",onClick:u[2]||(u[2]=n=>{var y;return(y=p.onQuickFillGroup)==null?void 0:y.call(p,p.group,"threeQuarter")}),disabled:!p.canEdit}," All 3/4 ",8,Js),s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg bg-slate-900 text-white hover:bg-slate-800 disabled:opacity-40",onClick:u[3]||(u[3]=n=>{var y;return(y=p.onQuickFillGroup)==null?void 0:y.call(p,p.group,"full")}),disabled:!p.canEdit}," All Full ",8,Xs)]),p.autoFillVisible?(o(),r("button",{key:0,type:"button",class:"rounded-full border border-slate-300 bg-white px-2.5 py-1 text-[10px] font-semibold text-slate-600 hover:border-slate-400",onClick:u[4]||(u[4]=n=>{var y;return(y=p.onAutoFill)==null?void 0:y.call(p)})},i(p.autoFillLabel),1)):g("",!0)])):g("",!0)]),s("div",Zs,[p.isPersonal?(o(),r("table",el,[s("thead",tl,[s("tr",sl,[s("th",{class:"sticky left-0 z-20 bg-slate-50 px-2 py-2 text-center font-medium",style:j({width:$e+"px"})}," # ",4),s("th",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-left font-medium",style:j({left:oe(te)+"px",width:ze+"px"})},i(p.itemLabel),5),s("th",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-center font-medium",style:j({left:S+"px",width:et+"px"})}," Max ",4),(o(!0),r(C,null,M(B.value,n=>(o(),r("th",{key:n.key,class:"px-2 py-2 text-center font-medium"},[s("div",ll,i(n.label||n.key),1),s("div",al,[s("span",{class:"truncate max-w-[140px]",title:n.assigned_user_name||""},i(n.assigned_user_name||"-"),9,nl),z(n)?(o(),r("span",ol," ✎ You can edit ")):g("",!0)])]))),128))])]),s("tbody",null,[s("tr",rl,[s("td",{colspan:3+B.value.length,class:"px-2 py-2 font-medium text-slate-800"},i(p.group.label||"Personal"),9,il)]),(o(!0),r(C,null,M(E.value,(n,y)=>(o(),r("tr",{key:n.id,class:de(["border-t hover:bg-slate-50/60 group",D(n)?"bg-rose-50/30 border-l-4 border-rose-400":""])},[s("td",{class:"sticky left-0 z-10 bg-white px-2 py-2 text-center text-slate-500",style:j({width:$e+"px"})},i(le(n,y)),5),s("td",{class:"sticky z-10 bg-white px-2 py-2 align-top",style:j({left:oe(te)+"px",width:ze+"px"})},[s("div",ul,[s("div",{class:"font-medium text-slate-800 truncate pr-2",title:n.label},i(n.label),9,dl),s("div",cl,[s("div",vl,[s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!p.canEdit,onClick:_=>{var h;return p.canEdit&&((h=p.onQuickFillItem)==null?void 0:h.call(p,n.id,n.max,"zero"))},title:"Set 0"}," 0 ",8,ml),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!p.canEdit,onClick:_=>{var h;return p.canEdit&&((h=p.onQuickFillItem)==null?void 0:h.call(p,n.id,n.max,"quarter"))},title:"Set 25%"}," ¼ ",8,xl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!p.canEdit,onClick:_=>{var h;return p.canEdit&&((h=p.onQuickFillItem)==null?void 0:h.call(p,n.id,n.max,"half"))},title:"Set 50%"}," ½ ",8,pl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!p.canEdit,onClick:_=>{var h;return p.canEdit&&((h=p.onQuickFillItem)==null?void 0:h.call(p,n.id,n.max,"threeQuarter"))},title:"Set 75%"}," ¾ ",8,bl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-40",disabled:!p.canEdit,onClick:_=>{var h;return p.canEdit&&((h=p.onQuickFillItem)==null?void 0:h.call(p,n.id,n.max,"full"))},title:"Set 100%"}," Full ",8,fl)])])])],4),s("td",{class:"sticky z-10 bg-white px-2 py-2 text-center text-slate-700 tabular-nums",style:j({left:S+"px",width:et+"px"})},i(k(n.max).toFixed(1).replace(/\.0$/,"")),5),(o(!0),r(C,null,M(B.value,_=>(o(),r("td",{key:_.key,class:"px-2 py-2 text-center"},[z(_)?(o(),r("div",yl,[s("input",{type:"number",step:"0.1",min:"0",max:n.max,value:p.marks[n.id]??"",onInput:h=>ae(n.id,h.target.value),onBlur:h=>Fe(n.id,n.max),inputmode:"decimal",class:de(["w-16 text-right rounded-md px-2 py-1 text-[11px] focus:outline-none focus:ring-2 focus:ring-indigo-200 border tabular-nums",D(n)?"border-rose-300 bg-rose-50/40":"border-slate-200"]),"aria-label":`Score for ${n.label}`},null,42,gl)])):_.can_view_marks?(o(),r("div",hl,i($.getLaneMark(_.key,n.id)||"—"),1)):(o(),r("div",_l,"—"))]))),128))],2))),128)),s("tr",kl,[s("td",{class:"sticky left-0 z-20 bg-slate-50 px-2 py-2",style:j({width:$e+"px"})},null,4),s("td",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-right font-medium text-slate-700",style:j({left:oe(te)+"px",width:ze+"px"})}," Group Total ",4),s("td",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-center font-semibold text-slate-800 tabular-nums",style:j({left:S+"px",width:et+"px"})},i(W.value.toFixed(2)),5),(o(!0),r(C,null,M(B.value,n=>{var y,_,h,K;return o(),r("td",{key:n.key,class:"px-2 py-2 text-center align-top"},[(_=(y=T.value)==null?void 0:y[n.key])!=null&&_.canShow&&(z(n)||(K=(h=T.value)==null?void 0:h[n.key])!=null&&K.hasData)?(o(),r(C,{key:0},[s("div",wl,i(T.value[n.key].got.toFixed(2)),1),s("div",$l," / "+i(T.value[n.key].max.toFixed(2))+" · "+i(T.value[n.key].percent)+"% ",1),s("div",Fl,[s("div",{class:"h-1 bg-slate-900/40",style:j({width:ue(n.key)})},null,4)])],64)):(o(),r("div",Ll,"—"))])}),128))])])])):(o(),r("table",Sl,[s("thead",Nl,[s("tr",Al,[u[5]||(u[5]=s("th",{class:"px-2 py-2 w-[36px] text-center font-medium"},"#",-1)),s("th",Cl,i(p.itemLabel),1),u[6]||(u[6]=s("th",{class:"px-2 py-2 text-center w-[70px] font-medium"},"Max",-1)),u[7]||(u[7]=s("th",{class:"px-2 py-2 text-center w-[90px] font-medium"},"HR Score",-1))])]),s("tbody",null,[(o(!0),r(C,null,M(E.value,(n,y)=>(o(),r("tr",{key:n.id,class:de(["border-t hover:bg-slate-50/60",D(n)?"bg-rose-50/30 border-l-4 border-rose-400":""])},[s("td",Ml,i(y+1),1),s("td",{class:"px-2 py-2 font-medium text-slate-800 truncate",title:n.label},i(n.label),9,El),s("td",Il,i(k(n.max).toFixed(1).replace(/\.0$/,"")),1),s("td",Pl,[p.canEdit?(o(),r("input",{key:0,type:"number",step:"0.1",min:"0",max:n.max,value:p.marks[n.id]??"",onInput:_=>ae(n.id,_.target.value),onBlur:_=>Fe(n.id,n.max),class:de(["w-16 text-right rounded-md px-2 py-1 text-[11px] focus:outline-none focus:ring-2 focus:ring-indigo-200 border tabular-nums",D(n)?"border-rose-300 bg-rose-50/40":"border-slate-200"])},null,42,Tl)):(o(),r("span",jl,i($.getHrMark(n.id)||"—"),1))])],2))),128)),s("tr",Rl,[u[8]||(u[8]=s("td",null,null,-1)),u[9]||(u[9]=s("td",{class:"px-2 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),s("td",Gl,i(W.value.toFixed(2)),1),s("td",Hl,i(se.value.toFixed(2)),1)])])]))])]))}}),zl={key:0,class:"space-y-4"},Bl={class:"flex items-start justify-between gap-3"},Dl={class:"text-sm font-semibold text-slate-900"},Kl={class:"text-xs text-slate-500"},Ol={key:0,class:"text-xs text-slate-400"},Ql={class:"flex flex-wrap items-center gap-2"},Vl=["onClick"],Ul={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},ql={key:1,class:"rounded-xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-700"},Yl={key:2,class:"space-y-3"},Wl={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Jl={key:1,class:"space-y-3"},Xl={class:"flex items-start justify-between gap-3"},Zl={class:"min-w-0"},ea=["title"],ta={class:"mt-0.5 text-[11px] text-slate-500"},sa={key:0},la={key:1},aa={class:"shrink-0"},na=["onUpdate:modelValue"],oa=["value"],ra={class:"mt-2"},ia=["onUpdate:modelValue"],ua={class:"flex items-center justify-end gap-2 pt-2"},da=["disabled"],ca=["disabled"],va={key:1,class:"max-w-7xl mx-auto px-4 py-6 space-y-6"},ma={key:0,class:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700"},xa={key:1,class:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-10 text-sm text-slate-600"},pa={class:"sticky top-14 z-[99999] border rounded-2xl bg-white/80 backdrop-blur px-4 py-3 shadow-sm"},ba={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},fa={class:"space-y-1"},ya={class:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1"},ga={class:"text-xs text-indigo-900"},ha={class:"text-sm text-slate-600"},_a={class:"font-medium text-slate-800"},ka={class:"flex flex-wrap gap-2 text-xs mt-0.5"},wa={key:0,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},$a={class:"ml-1 font-medium text-slate-800"},Fa={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},La={class:"ml-1 font-medium text-slate-800"},Sa={key:2,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},Na={class:"ml-1 font-medium text-slate-800"},Aa={class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},Ca={key:0,class:"ml-1 inline-flex items-center gap-1"},Ma={class:"font-semibold text-slate-800"},Ea={class:"font-semibold text-emerald-700"},Ia={key:1,class:"ml-1 inline-flex items-center gap-1"},Pa={key:2,class:"ml-1 font-semibold text-slate-800"},Ta={class:"flex items-end gap-4"},ja={class:"text-right"},Ra={class:"text-lg font-bold text-slate-900"},Ga={class:"text-slate-400"},Ha={class:"text-xs text-slate-500"},za={key:0},Ba={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Da={class:"text-xs text-slate-500"},Ka={key:0,class:"p-4 text-sm font-bold text-slate-500"},Oa=["innerHTML"],Qa={class:"mt-2"},Va={class:"grid gap-4 lg:grid-cols-5"},Ua={key:0,class:"space-y-4 lg:col-span-3"},qa={key:0,class:"sticky top-6 border rounded-2xl bg-white shadow-sm"},Ya={class:"flex flex-wrap items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},Wa={class:"flex flex-wrap items-center gap-2 text-[11px] text-slate-500"},Ja={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Xa={key:0,class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Za={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},en={class:"p-4 space-y-4 max-h-[360px] overflow-y-auto"},tn={class:"flex flex-wrap gap-2 border-b border-slate-100 pb-3"},sn=["onClick"],ln={class:"space-y-4"},an={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},nn={class:"rounded-xl border bg-slate-50 p-3"},on={class:"flex items-center justify-between"},rn={class:"text-[11px] px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200"},un={class:"mt-1 text-sm font-semibold text-slate-900"},dn={class:"text-xs text-slate-500"},cn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},vn={class:"rounded-xl border bg-slate-50 p-3"},mn={class:"flex items-center justify-between"},xn={class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-200"},pn={class:"mt-1 text-sm font-semibold text-slate-900"},bn={class:"text-xs text-slate-500"},fn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},yn={class:"rounded-xl border bg-slate-50 p-3 sm:col-span-2"},gn={class:"flex items-center justify-between"},hn={class:"text-[11px] px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 border border-emerald-200"},_n={class:"mt-1 text-sm font-semibold text-slate-900"},kn={class:"text-xs text-slate-500"},wn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},$n={class:"border-t pt-2 text-xs"},Fn={key:0,class:"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs space-y-2"},Ln={class:"grid grid-cols-2 gap-2"},Sn={class:"font-medium text-slate-800"},Nn={class:"font-medium text-slate-800"},An={class:"font-medium text-slate-800"},Cn={class:"font-medium text-slate-800"},Mn={class:"font-medium text-slate-800"},En={class:"font-medium text-slate-800"},In={key:1,class:"border rounded-2xl bg-white shadow-sm"},Pn={class:"flex items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},Tn={class:"text-[11px] text-slate-500"},jn={class:"p-4 space-y-3"},Rn={class:"max-h-96 overflow-auto border rounded-xl"},Gn={class:"min-w-full text-xs text-left"},Hn={class:"px-2 py-2"},zn={class:"font-semibold text-slate-700"},Bn={key:0,class:"mt-0.5 text-[11px] text-slate-400"},Dn={class:"px-2 py-2 text-right"},Kn=["onClick"],On={key:2,class:"rounded-2xl bg-white border shadow-sm px-4 py-4 space-y-4"},Qn={class:"grid gap-4 md:grid-cols-3"},Vn={class:"space-y-3"},Un={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},qn={key:0,class:"text-[11px] text-emerald-600"},Yn={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},Wn={class:"flex flex-wrap gap-1.5"},Jn=["onClick","disabled"],Xn={class:"space-y-1"},Zn={class:"space-y-3"},eo={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},to={key:0,class:"text-[11px] text-amber-600"},so={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},lo={class:"flex flex-wrap gap-1.5"},ao=["onClick","disabled"],no={class:"space-y-1"},oo={class:"space-y-3"},ro={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},io={key:0,class:"text-[11px] text-sky-600"},uo={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},co={class:"flex flex-wrap gap-1.5"},vo=["onClick","disabled"],mo={class:"space-y-1"},xo={class:"mt-2 flex flex-col gap-3 border-t pt-3 md:flex-row md:items-center md:justify-between"},po={class:"flex flex-wrap items-center gap-2"},bo=["disabled"],fo=["disabled"],yo={class:"relative w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true"},go={class:"flex items-start justify-between gap-3"},ho={class:"text-lg font-semibold text-slate-900"},_o={class:"text-xs text-slate-500"},ko={key:0,class:"text-xs text-slate-400 mt-1"},wo={class:"mt-5 space-y-4 text-sm text-slate-700"},$o={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},Fo={key:0},Lo={key:1,class:"text-slate-400"},So={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},No={key:0},Ao={key:1,class:"text-slate-400"},Co={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},Mo={key:0},Eo={key:1,class:"text-slate-400"},Io=15e3,Po={__name:"KpiReviewForm",props:{mode:{type:String,default:"full"},allowedLanes:{type:Array,default:()=>["supv_director","da"]},groupFilter:{type:String,default:null},initialLane:{type:String,default:""},employeeId:{type:[Number,String],default:null},employeeName:{type:String,default:""},year:{type:Number,default:null}},emits:["saved"],setup(p,{emit:$}){const te=Ps(),S=Ds(),re=Ts(),E=p,Be=$,ce=x(()=>E.mode==="compact"),k=w({}),I=w({}),W=w(""),se=w(""),le=w(""),H=w(null),z=w(null),ie=w(!1),T=w(!1),B=w(""),ue=x(()=>{const e=Number(E.employeeId);return Number.isFinite(e)&&e>0?e:null}),D=x(()=>{const e=Number(E.year);return Number.isFinite(e)&&e>0?e:new Date().getFullYear()}),ae=x(()=>E.groupFilter?String(E.groupFilter):"personal"),Fe=x(()=>ae.value?ae.value.replace(/_/g," "):"personal"),f=x(()=>{const e=Array.isArray(E.allowedLanes)?E.allowedLanes.filter(Boolean):[];return e.length?e:["supv_director","da"]}),u=w(E.initialLane||f.value[0]||""),n=w([]),y=w({}),_=w({}),h=w(!1),K=w(!1),O=w(""),Le=x(()=>{var e;return E.employeeName||((e=I.value)==null?void 0:e.name)||"Employee"}),De={supv_director:"Supv. Director",da:"DA"},st=e=>De[e]||e;function es(e){return Array.isArray(e)?e.map((t,l)=>{const a=(t==null?void 0:t.id)??(t==null?void 0:t.item_id)??(t==null?void 0:t.kpi_item_id)??(t==null?void 0:t.kpi_id)??l,c=(t==null?void 0:t.title)??(t==null?void 0:t.name)??(t==null?void 0:t.label)??`Item ${l+1}`,v=(t==null?void 0:t.weight)??(t==null?void 0:t.weightage)??(t==null?void 0:t.weight_value)??(t==null?void 0:t.score_weight)??null,d=(t==null?void 0:t.max_score)??(t==null?void 0:t.max)??(t==null?void 0:t.max_marks)??(t==null?void 0:t.score_max)??0,b=(t==null?void 0:t.score)??(t==null?void 0:t.mark)??(t==null?void 0:t.obtained)??(t==null?void 0:t.value)??null,L=(t==null?void 0:t.comment)??(t==null?void 0:t.note)??(t==null?void 0:t.remark)??"";return{id:a,title:c,weight:v,maxScore:d,score:b,comment:L}}):[]}function ts(e){const t=Number(e);if(!Number.isFinite(t)||t<=0)return[0];const l=Number.isInteger(t)?1:.5,a=[];for(let c=0;c<=t+1e-4;c+=l){const v=l===1?Math.round(c):Number(c.toFixed(1));a.push(v)}return a[a.length-1]!==t&&a.push(t),a}async function ss(){var e,t,l,a;if(ce.value&&!(!ue.value||!D.value||!u.value)){h.value=!0,O.value="";try{const{data:c}=await Xt.get(`/kpi/yearly/${D.value}/employees/${ue.value}/marking-form`,{params:{lane:u.value,group:ae.value}}),v=(c==null?void 0:c.data)??c??{},d=(v==null?void 0:v.items)||((e=v==null?void 0:v.form)==null?void 0:e.items)||((t=v==null?void 0:v.group)==null?void 0:t.items)||(v==null?void 0:v.data)||[],b=es(d),L={},N={};b.forEach(G=>{var he,_e;const ee=(he=v==null?void 0:v.marks)==null?void 0:he[G.id],Y=(_e=v==null?void 0:v.comments)==null?void 0:_e[G.id],pe=G.score??ee??0,Ge=G.comment??Y??"";L[G.id]=pe===""||pe==null?0:Number(pe),N[G.id]=Ge??""}),n.value=b,y.value=L,_.value=N}catch(c){O.value=((a=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:a.message)||"Failed to load KPI marking form.",n.value=[]}finally{h.value=!1}}}async function lt(e){var t,l;if(!(!ue.value||!D.value||!u.value)){K.value=!0,O.value="";try{const a=n.value.map(v=>({item_id:v.id,score:Number(y.value[v.id]??0),comment:_.value[v.id]??""})),c={lane:u.value,group:ae.value,submit:!!e,items:a,marks:{...y.value},comments:{..._.value}};await Xt.post(`/kpi/yearly/${D.value}/employees/${ue.value}/marking-form`,c),Be("saved")}catch(a){O.value=((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to save KPI marking form."}finally{K.value=!1}}}be(()=>E.initialLane,e=>{e&&(u.value=e)}),be(f,e=>{e.length&&(e.includes(u.value)||(u.value=e[0]))},{immediate:!0}),be([ce,u,ue,D,ae],([e,t,l,a,c])=>{!e||!t||!l||!a||!c||ss()},{immediate:!0});const at=w([]),nt=w({}),Ke=w(!1),Se=x(()=>{var e;return((e=S.cycle)==null?void 0:e.groups_json)||[]}),ls=x(()=>{var a;const e=S.cycle||{},t=Array.isArray(e==null?void 0:e.groups_json)?e.groups_json:[];return(e==null?void 0:e.slug)==="support_staff"&&t.length===1&&((a=t[0])==null?void 0:a.id)==="personal"?"staff":"executive"}),J=x(()=>ls.value==="staff"),ot=e=>{if(!e)return!1;const t=String(e.id||"").toLowerCase(),l=String(e.label||"").toLowerCase();return t==="personal"||t==="personal_evaluation"||t==="personal_eval"?!0:l.includes("personal")},X=x(()=>Se.value.find(ot)||null),Q=x(()=>J.value?[]:Se.value.filter(e=>!ot(e))),as=(e,t)=>(e==null?void 0:e.label)||`Group ${t+1}`,rt=e=>/^hr\d*$/i.test(e)||e==="hr",it=e=>rt((e==null?void 0:e.key)||"")||(e==null?void 0:e.is_hr_lane)===!0,Ne=x(()=>[...at.value||[]].sort((e,t)=>(e.rank??999)-(t.rank??999))),Oe=x(()=>Ne.value.filter(it)),ut=x(()=>Ne.value.filter(e=>!it(e))),Qe=x(()=>J.value?Ne.value:ut.value),R=x(()=>{var e;return((e=Qe.value.find(t=>t.can_current_user_review))==null?void 0:e.key)||null}),dt=x(()=>Qe.value.find(e=>e.key===R.value)||null),ns=x(()=>{var e;return((e=dt.value)==null?void 0:e.rank)??null}),os=x(()=>{var e;return Number(((e=re==null?void 0:re.user)==null?void 0:e.id)||0)}),Ve=x(()=>{const e=os.value;if(!e)return null;const t=Oe.value.find(l=>Number(l.assigned_user_id)===e);return t||Oe.value.find(l=>l.can_current_user_review)||null}),V=x(()=>{var e;return((e=Ve.value)==null?void 0:e.key)||null}),rs=x(()=>!!(Ve.value&&Ve.value.can_current_user_review)),U=x(()=>!!(Ke.value||rs.value)),Ae=x(()=>!!R.value),is=x(()=>Ae.value?!rt(R.value):!1);function us(e){const t=String(e||"").trim().replace(/_/g," ");return t?`${t.replace(/\b\w/g,a=>a.toUpperCase())} Submit`:"Submit Personal"}const ds=x(()=>{var t;const e=((t=dt.value)==null?void 0:t.label)||R.value;return us(e)}),cs=x(()=>{if(J.value||!U.value)return!1;const e=R.value,t=V.value;return!e||!t||e===t?!1:Q.value.length>0}),Ce=x(()=>J.value?R.value:U.value&&V.value?V.value:R.value),ct=x(()=>!!(Ce.value&&V.value&&Ce.value===V.value));function ve(e){var a;const t=(a=nt.value)==null?void 0:a[e];return t?(Array.isArray(t)?t:[t]).reduce((c,v)=>{if(!v)return c;if(!c)return v;const d=new Date(v.submitted_at||0).getTime(),b=new Date(c.submitted_at||0).getTime();return d>b?v:c},null):null}function vt(e,t){var a;const l=ve(e);return((a=l==null?void 0:l.marks)==null?void 0:a[t])??""}function mt(e){var l,a,c;if(V.value){const v=ve(V.value),d=(l=v==null?void 0:v.marks)==null?void 0:l[e];if(d!=null)return d}let t=null;for(const v of Oe.value){const d=ve(v.key);if(!d||((a=d==null?void 0:d.marks)==null?void 0:a[e])==null)continue;if(!t){t=d;continue}const b=new Date(d.submitted_at||0).getTime(),L=new Date(t.submitted_at||0).getTime();b>L&&(t=d)}return((c=t==null?void 0:t.marks)==null?void 0:c[e])??""}function xt(e,t){k.value[e]=t===""?"":Number(t)}function ye(e,t){const l=Number(k.value[e]??0);l<0&&(k.value[e]=0),l>Number(t)&&(k.value[e]=Number(t))}function pt(e,t,l){l==="zero"?k.value[e]=0:l==="quarter"?k.value[e]=Number(t)/4:l==="half"?k.value[e]=Number(t)/2:l==="threeQuarter"?k.value[e]=Number((Number(t)*.75).toFixed(1)):l==="full"&&(k.value[e]=Number(t)),ye(e,t)}function vs(e,t){e.items.forEach(l=>pt(l.id,l.max,t))}const Ue=x(()=>{let e=0,t=0;const l=X.value;l&&Array.isArray(l.items)&&l.items.forEach(c=>{e+=Number(c.max||0);const v=Number(k.value[c.id]||0);t+=Math.min(Math.max(v,0),Number(c.max||0))});const a=e>0?t/e*100:0;return{max:Number(e.toFixed(2)),got:Number(t.toFixed(2)),percent:Number(a.toFixed(2))}}),ms=x(()=>!!H.value&&typeof H.value=="object"),xs=x(()=>{var e;return((e=H.value)==null?void 0:e.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),ps=x(()=>{var e;return((e=H.value)==null?void 0:e.year)??null}),bs=x(()=>{var e;return((e=z.value)==null?void 0:e.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),fs=x(()=>{var e;return((e=z.value)==null?void 0:e.year)??null}),q=w("target"),bt=[{key:"target",label:"Annual Target"},{key:"performance",label:"Annual Performance"}],ft=x(()=>{var e;return((e=H.value)==null?void 0:e.months_total_form)??0}),ys=x(()=>{var e;return((e=z.value)==null?void 0:e.months_total_form)??ft.value}),F=x(()=>q.value==="target"?xs.value:bs.value),yt=x(()=>{var e,t;return Number(((t=(e=F.value)==null?void 0:e.per_form_yearly)==null?void 0:t.final)||0)}),gt=x(()=>{var e,t;return Number(((t=(e=F.value)==null?void 0:e.per_scored_month)==null?void 0:t.max)||0)}),gs=x(()=>gt.value?Math.round(yt.value/gt.value*100):0),ht=x(()=>U.value&&!J.value),qe=x(()=>q.value==="target"?ps.value:fs.value),_t=x(()=>q.value==="target"?ft.value:ys.value),kt=x(()=>{var e;return((e=bt.find(t=>t.key===q.value))==null?void 0:e.label)||"Annual Target"});be(q,()=>{ie.value=!1});const wt=e=>String(e||"").toLowerCase(),$t=(e,t)=>e?t==="target"?e.id==="monthly_target"?!0:wt(e.label).includes("monthly target"):t==="performance"?e.id==="execution"?!0:wt(e.label).includes("execution")||String(e.label||"").includes("কার্যসম্পাদন"):!1:!1,hs=e=>Q.value.find(t=>$t(t,e))||null,Ft=(e,{overwrite:t}={overwrite:!1})=>{if(!ht.value)return;const l=hs(e);if(!l||!Array.isArray(l.items)||l.items.length===0)return;const a=l.items,c=a.every(b=>Number(k.value[b.id]||0)===0);if(!t&&!c)return;const v=yt.value,d=a.reduce((b,L)=>b+Number(L.max||0),0);if(d){if(a.length===1){const b=a[0];k.value[b.id]=Math.min(v,Number(b.max||0)),ye(b.id,b.max);return}a.forEach(b=>{const L=Number(b.max||0)/d*v,N=Number(L.toFixed(1));k.value[b.id]=N,ye(b.id,b.max)})}},_s=x(()=>`Auto: ${q.value==="target"?"Annual Target":"Annual Performance"} (${gs.value}%)`);be(q,e=>{Ft(e,{overwrite:!1})},{immediate:!0});const Me=x(()=>{const e=J.value?Ne.value:ut.value,t=[],l=ct.value||U.value?1/0:ns.value??null,a=c=>{if(!c)return[];const v=[];if(Array.isArray(c))v.push(...c);else if(typeof c=="string"&&c.trim())v.push(c.trim());else return[];const d=new Set;return v.reduce((b,L)=>{const N=typeof L=="string"?L.trim():"";return!N||d.has(N)||(d.add(N),b.push(N)),b},[])};return e.forEach(c=>{const v=c.key;if(!v||l!=null&&(c.rank??999)>l)return;const d=ve(v);if(!d)return;const b=a(d.strengths),L=a(d.gaps),N=a(d.suggestions);!b.length&&!L.length&&!N.length||t.push({key:v,lane:v,label:c.label||(d==null?void 0:d.lane_label)||v,reviewer_id:d.reviewer_id,reviewer_name:d.reviewer_name,strengths:b,gaps:L,suggestions:N,submitted_at:d.submitted_at??null})}),t}),ks=e=>{const t=new Set;return Me.value.forEach(l=>{(Array.isArray(l[e])?l[e]:[]).forEach(c=>{const v=typeof c=="string"?c.trim():"";v&&t.add(v)})}),Array.from(t)},Lt=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(l=>{const a=typeof l=="string"?l.trim():"";a&&t.add(a)}),Array.from(t)},Ee=x(()=>Lt(S.strengths)),Ie=x(()=>Lt(S.gaps)),Pe=x(()=>ks("suggestions"));w([]),w([]),w([]);const Ye=w(!1),P=w(null);function ws(e){P.value=e,Ye.value=!0}function We(){Ye.value=!1,P.value=null}const St={strengths:W,gaps:se,suggestions:le};function $s(e,t){const l=(t||"").trim();return l?e!=null&&e.trim()?`${e.trim()}
${l}`:l:e}function Te(e,t){const l=St[e];if(!l)return!1;const a=(l.value||"").split(`
`).map(v=>v.trim()).filter(Boolean),c=(t||"").trim();return c?a.includes(c):!1}function Je(e,t){const l=St[e];if(!l)return;const a=typeof t=="string"?t.trim():"";a&&(Te(e,a)||(l.value=$s(l.value,a)))}const me=w(!1);let ge=null;const Fs=()=>{me.value=!me.value,ge&&(clearTimeout(ge),ge=null),me.value&&(ge=setTimeout(()=>{me.value=!1,ge=null},Io))},Ls=x(()=>{const e={};let t=1;const l=X.value;return l&&Array.isArray(l.items)&&l.items.forEach(a=>{e[a.id]=t++}),e});function je(e){return(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(l=>l.id).filter(l=>l!=null)}function Nt(e){const t={};return(Array.isArray(e)?e:[]).forEach(l=>{var a;t[l]=Number(((a=k.value)==null?void 0:a[l])??0)}),t}function At(e){return Nt(je(e))}function Ct(e){const t=[];(Array.isArray(e)?e:[]).forEach(a=>{t.push(...je(a))});const l=Array.from(new Set(t));return Nt(l)}function Xe(e){return Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():"").filter(Boolean).join(`
`):typeof e=="string"?e.trim():""}const Ss=x(()=>!R.value||!X.value?!1:Object.keys(At(X.value)).length>0),Ns=x(()=>!U.value||!V.value||!Array.isArray(Q.value)||Q.value.length===0?!1:Object.keys(Ct(Q.value)).length>0);function Mt(e,t){if(!e||!(t!=null&&t.length))return!1;const l=ve(e),a=l==null?void 0:l.marks;if(!a)return!1;let c=!1;return t.forEach(v=>{const d=a==null?void 0:a[v];d!==""&&d!=null&&(k.value[v]=Number(d),c=!0)}),c}const Re=e=>{if(typeof e!="string")return e;const t=e.trim();if(!t)return e;try{return JSON.parse(t)}catch{return e}};function As(e,t=0){const l=(e==null?void 0:e.key)??(e==null?void 0:e.lane_key)??(e==null?void 0:e.laneKey)??(e==null?void 0:e.lane)??"",a=(e==null?void 0:e.label)??(e==null?void 0:e.lane_label)??(e==null?void 0:e.title)??l,c=(e==null?void 0:e.rank)??(e==null?void 0:e.order)??(e==null?void 0:e.priority)??999,v=(e==null?void 0:e.assigned_user_id)??(e==null?void 0:e.assignee_id)??(e==null?void 0:e.reviewer_id)??null,d=(e==null?void 0:e.assigned_user_name)??(e==null?void 0:e.assignee_name)??(e==null?void 0:e.reviewer_name)??"",b=(e==null?void 0:e.can_current_user_review)??(e==null?void 0:e.can_review)??!1,L=(e==null?void 0:e.can_view_marks)??!0;return{...e,key:String(l),label:String(a),rank:Number(c??999),assigned_user_id:v==null?null:Number(v),assigned_user_name:String(d||""),can_current_user_review:!!b,can_view_marks:!!L,_idx:t}}function Cs(e){const t={},l=e&&typeof e=="object"?e:{};return Object.keys(l).forEach(a=>{const c=l[a],v=Array.isArray(c)?c:c?[c]:[];t[a]=v.map(d=>{const b=Re((d==null?void 0:d.marks)??(d==null?void 0:d.marks_json)??{});return{...d,marks:b&&typeof b=="object"?b:{},strengths:Re(d==null?void 0:d.strengths),gaps:Re(d==null?void 0:d.gaps),suggestions:Re(d==null?void 0:d.suggestions)}})}),t}const Ze=x(()=>Number(te.params.employeeId)),Et=e=>{var L;I.value=e.employee||{},H.value=(e==null?void 0:e.annual_target_avg_marks)||null,z.value=(e==null?void 0:e.annual_performance_avg_marks)||null,at.value=Array.isArray(e==null?void 0:e.lanes)?e.lanes.map(As):[],nt.value=Cs((e==null?void 0:e.reviews_by_lane)||{}),Ke.value=!!(((L=e==null?void 0:e.meta)==null?void 0:L.is_hr)??(e==null?void 0:e.hr)??!1),k.value={},(Array.isArray(Se.value)?Se.value:[]).forEach(N=>{(Array.isArray(N==null?void 0:N.items)?N.items:[]).forEach(ee=>{k.value[ee.id]=0})});const l=je(X.value),a=R.value,c=V.value;!Mt(a,l)&&c&&Mt(c,l),U.value&&Q.value.length&&Q.value.forEach(N=>{je(N).forEach(ee=>{let Y=c?vt(c,ee):"";(Y===""||Y==null)&&(Y=mt(ee)),Y!==""&&Y!=null&&(k.value[ee]=Number(Y))})});const d=Ce.value||a||c||null,b=d?ve(d):null;W.value=Xe(b==null?void 0:b.strengths),se.value=Xe(b==null?void 0:b.gaps),le.value=Xe(b==null?void 0:b.suggestions)},Ms=async e=>{var t,l;if(e){T.value=!0,B.value="";try{await S.fetchActiveCycle(e);const a=await S.fetchLanes(S.cycle.id,e);Et(a)}catch(a){B.value=((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to load KPI review data."}finally{T.value=!1}}},It=async()=>{var e,t,l;if(!(!Ze.value||!((e=S.cycle)!=null&&e.id))){T.value=!0,B.value="";try{const a=await S.fetchLanes(S.cycle.id,Ze.value);Et(a)}catch(a){B.value=((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||(a==null?void 0:a.message)||"Failed to refresh KPI review data."}finally{T.value=!1}}};be(Ze,async(e,t)=>{!e||t&&e===t||await Ms(e)},{immediate:!0});async function Es(){var a,c,v;const e=Number(te.params.employeeId),t=(a=S.cycle)==null?void 0:a.id,l=R.value;if(!t||!e)return alert("Invalid cycle/employee.");if(!l||!X.value)return alert("Unable to determine personal reviewer lane.");try{await S.submitReview({cycle_id:t,employee_id:e,reviewer_lane:l,marks:At(X.value),strengths:W.value,gaps:se.value,suggestions:le.value}),await It(),alert("Personal review submitted")}catch(d){const b=((v=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:v.message)||(d==null?void 0:d.message)||"Failed to submit personal review.";alert(b)}}async function Is(){var a,c,v;const e=Number(te.params.employeeId),t=(a=S.cycle)==null?void 0:a.id,l=V.value;if(!t||!e)return alert("Invalid cycle/employee.");if(!l)return alert("Unable to determine HR reviewer lane.");try{await S.submitReview({cycle_id:t,employee_id:e,reviewer_lane:l,marks:Ct(Q.value),strengths:W.value,gaps:se.value,suggestions:le.value}),await It(),alert("HR review submitted")}catch(d){const b=((v=(c=d==null?void 0:d.response)==null?void 0:c.data)==null?void 0:v.message)||(d==null?void 0:d.message)||"Failed to submit HR review.";alert(b)}}function Z(e){const t=Number(e??0);return isNaN(t)?"0.00":t.toFixed(2)}function xe(e,t){const l=Number(e??0),a=Number(t??0);return a>0?Math.round(l/a*100):0}return(e,t)=>{var l,a,c,v,d,b,L,N,G,ee,Y,pe,Ge,he,_e,Pt,Tt,jt,Rt,Gt,Ht,zt,Bt,Dt,Kt,Ot,Qt,Vt,Ut,qt,Yt,Wt;return ce.value?(o(),r("div",zl,[s("div",Bl,[s("div",null,[s("div",Dl,i(Le.value),1),s("div",Kl," Year "+i(D.value)+" / Group "+i(Fe.value),1)]),u.value?(o(),r("div",Ol," Lane: "+i(st(u.value)),1)):g("",!0)]),s("div",Ql,[(o(!0),r(C,null,M(f.value,m=>(o(),r("button",{key:m,type:"button",class:de(["rounded-full border px-3 py-1 text-xs font-semibold transition",m===u.value?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-600 border-slate-200 hover:border-slate-300"]),onClick:A=>u.value=m},i(st(m)),11,Vl))),128))]),h.value?(o(),r("div",Ul," Loading KPI items... ")):O.value?(o(),r("div",ql,i(O.value),1)):(o(),r("div",Yl,[n.value.length?(o(),r("div",Jl,[(o(!0),r(C,null,M(n.value,m=>(o(),r("div",{key:m.id,class:"rounded-xl border border-slate-200 bg-white p-3"},[s("div",Xl,[s("div",Zl,[s("div",{class:"text-sm font-semibold text-slate-900 truncate",title:m.title},i(m.title),9,ea),s("div",ta,[m.weight!=null?(o(),r("span",sa,"Weight: "+i(m.weight),1)):g("",!0),m.maxScore!=null?(o(),r("span",la," / Max: "+i(m.maxScore),1)):g("",!0)])]),s("div",aa,[fe(s("select",{"onUpdate:modelValue":A=>y.value[m.id]=A,class:"rounded-lg border border-slate-300 bg-white px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50"},[(o(!0),r(C,null,M(ts(m.maxScore),A=>(o(),r("option",{key:A,value:A},i(A),9,oa))),128))],8,na),[[js,y.value[m.id],void 0,{number:!0}]])])]),s("div",ra,[t[7]||(t[7]=s("label",{class:"block text-[11px] font-medium text-slate-500"},"Comment (optional)",-1)),fe(s("textarea",{"onUpdate:modelValue":A=>_.value[m.id]=A,rows:"2",class:"mt-1 w-full rounded-lg border border-slate-200 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/40",placeholder:"Add a note if needed"},null,8,ia),[[He,_.value[m.id]]])])]))),128))])):(o(),r("div",Wl," No KPI items found for this lane. "))])),s("div",ua,[s("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50 disabled:opacity-50",disabled:K.value||h.value||!n.value.length,onClick:t[0]||(t[0]=m=>lt(!1))},i(K.value?"Saving...":"Save Draft"),9,da),s("button",{type:"button",class:"rounded-lg bg-emerald-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-emerald-700 disabled:opacity-50",disabled:K.value||h.value||!n.value.length,onClick:t[1]||(t[1]=m=>lt(!0))},i(K.value?"Saving...":"Submit"),9,ca)])])):(o(),r("div",va,[B.value?(o(),r("div",ma,i(B.value),1)):g("",!0),T.value?(o(),r("div",xa," Loading KPI review... ")):(o(),r(C,{key:2},[s("header",pa,[s("div",ba,[s("div",fa,[s("div",ya,[t[8]||(t[8]=s("span",{class:"text-xs font-semibold text-indigo-700"},"KPI Cycle",-1)),s("span",ga,i((l=oe(S).cycle)==null?void 0:l.title),1)]),s("div",ha,[s("div",_a,i(((a=I.value)==null?void 0:a.name)||"Employee"),1),s("div",ka,[(v=(c=I.value)==null?void 0:c.designation)!=null&&v.title?(o(),r("span",wa,[t[9]||(t[9]=ne(" Designation: ")),s("span",$a,i(I.value.designation.title),1)])):g("",!0),(b=(d=I.value)==null?void 0:d.department)!=null&&b.name?(o(),r("span",Fa,[t[10]||(t[10]=ne(" Department: ")),s("span",La,i(I.value.department.name),1)])):g("",!0),(L=I.value)!=null&&L.joining_date?(o(),r("span",Sa,[t[11]||(t[11]=ne(" Joining Date: ")),s("span",Na,i((N=I.value)==null?void 0:N.joining_date),1)])):g("",!0),s("span",Aa,[t[15]||(t[15]=ne(" Reviewing as: ")),cs.value?(o(),r("span",Ca,[s("span",Ma,i(R.value),1),t[12]||(t[12]=s("span",{class:"text-slate-400"},"+",-1)),s("span",Ea,i(V.value),1),t[13]||(t[13]=s("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," dual mode ",-1))])):ct.value?(o(),r("span",Ia,t[14]||(t[14]=[s("span",{class:"font-semibold text-emerald-700"},"HR",-1),s("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," HR mode ",-1)]))):(o(),r("span",Pa,i(Ce.value||"No lane"),1))])])])]),s("div",Ta,[s("div",ja,[t[16]||(t[16]=s("div",{class:"text-[11px] uppercase tracking-wide text-slate-500"}," Personal group total ",-1)),s("div",Ra,[ne(i(Ue.value.got.toFixed(2))+" ",1),s("span",Ga,"/ "+i(Ue.value.max.toFixed(2)),1)]),s("div",Ha,i(Ue.value.percent.toFixed(2))+"% achieved ",1)]),Ke.value?(o(),r("button",{key:0,onClick:t[2]||(t[2]=m=>oe(S).submitFinalResult(oe(S).cycle.id,oe(te).params.employeeId)),class:"inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-medium text-white shadow hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-300 focus:outline-none"},t[17]||(t[17]=[s("span",null,"Finalize & Lock",-1)]))):g("",!0)])])]),(G=I.value)!=null&&G.active_criteria?(o(),r("div",za,[s("section",Ba,[s("button",{type:"button",class:"w-full flex items-center justify-between border-b bg-slate-50 px-4 py-2 text-left",onClick:Fs},[t[18]||(t[18]=s("div",{class:"text-sm font-semibold text-slate-800"},"কার্যসম্পাদন বিষয়",-1)),s("div",Da,i(me.value?"Hide":"Show"),1)]),fe(s("div",null,[((Y=(ee=I.value)==null?void 0:ee.active_criteria)==null?void 0:Y.length)===0?(o(),r("div",Ka," -- ")):g("",!0),(o(!0),r(C,null,M(I.value.active_criteria,m=>(o(),r("div",{class:"p-4 text-sm text-slate-700",key:m.id},[s("div",{class:"print:block richtext print:break-inside-avoid",innerHTML:m==null?void 0:m.description},null,8,Oa)]))),128))],512),[[Gs,me.value]])])])):g("",!0),oe(S).cycle&&X.value?(o(),tt(Zt,{key:1,group:X.value,"is-personal":!0,lanes:Qe.value,"editable-lane-key":R.value,"can-edit":Ae.value,marks:k.value,"header-label":"Personal Evaluation","item-label":((pe=X.value)==null?void 0:pe.label)||"Personal",mode:J.value,"helper-text":J.value?"All reviewer lanes score the Personal table.":Ae.value&&U.value?"Submit Personal and HR reviews separately using the buttons below.":"Fill only your lane; others appear as read-only.","serial-map":Ls.value,"get-lane-mark":vt,"on-mark-change":xt,"on-cap":ye,"on-quick-fill-item":pt},null,8,["group","lanes","editable-lane-key","can-edit","marks","item-label","mode","helper-text","serial-map"])):g("",!0),s("section",Qa,[s("div",Va,[Q.value.length?(o(),r("div",Ua,[(o(!0),r(C,null,M(Q.value,(m,A)=>(o(),tt(Zt,{key:A,group:m,"is-personal":!1,"can-edit":U.value,marks:k.value,"header-label":`Group ${A+1} - ${as(m,A)}`,"item-label":"Item","show-quick-fill-group":!0,"auto-fill-visible":ht.value&&$t(m,q.value),"auto-fill-label":_s.value,"on-auto-fill":()=>Ft(q.value,{overwrite:!0}),"get-hr-mark":mt,"on-mark-change":xt,"on-cap":ye,"on-quick-fill-group":vs},null,8,["group","can-edit","marks","header-label","auto-fill-visible","auto-fill-label","on-auto-fill"]))),128))])):g("",!0),s("aside",{class:de(["space-y-4 sticky top-10 z-50",[Q.value.length===0?"lg:col-span-full":"lg:col-span-2"]])},[!J.value&&ms.value&&U.value?(o(),r("section",qa,[s("header",Ya,[t[19]||(t[19]=s("span",null,"Annual Summary",-1)),s("div",Wa,[s("span",Ja,i(kt.value),1),qe.value?(o(),r("span",Xa," Year "+i(qe.value),1)):g("",!0),s("span",Za,i(_t.value)+" month(s) ",1)])]),s("div",en,[s("div",tn,[(o(),r(C,null,M(bt,m=>s("button",{key:m.key,type:"button",onClick:A=>q.value=m.key,class:de(["px-3 py-1 rounded-full text-xs font-semibold transition",q.value===m.key?"bg-slate-900 text-white shadow":"border border-slate-200 text-slate-700 bg-white hover:border-slate-400"])},i(m.label),11,sn)),64))]),s("div",ln,[s("div",an,[s("div",nn,[s("div",on,[t[20]||(t[20]=s("span",{class:"text-xs font-medium text-slate-600"},"Incharge",-1)),s("span",rn,i(xe((Ge=F.value.per_scored_month)==null?void 0:Ge.incharge,(he=F.value.per_scored_month)==null?void 0:he.max))+"% ",1)]),s("div",un,[ne(i(Z((_e=F.value.per_scored_month)==null?void 0:_e.incharge))+" ",1),s("span",dn,"/ "+i(Z((Pt=F.value.per_scored_month)==null?void 0:Pt.max)),1)]),s("div",cn,[s("div",{class:"h-2 bg-blue-500",style:j({width:xe((Tt=F.value.per_scored_month)==null?void 0:Tt.incharge,(jt=F.value.per_scored_month)==null?void 0:jt.max)+"%"})},null,4)])]),s("div",vn,[s("div",mn,[t[21]||(t[21]=s("span",{class:"text-xs font-medium text-slate-600"},"Coordinator",-1)),s("span",xn,i(xe((Rt=F.value.per_scored_month)==null?void 0:Rt.coordinator,(Gt=F.value.per_scored_month)==null?void 0:Gt.max))+"% ",1)]),s("div",pn,[ne(i(Z((Ht=F.value.per_scored_month)==null?void 0:Ht.coordinator))+" ",1),s("span",bn,"/ "+i(Z((zt=F.value.per_scored_month)==null?void 0:zt.max)),1)]),s("div",fn,[s("div",{class:"h-2 bg-violet-500",style:j({width:xe((Bt=F.value.per_scored_month)==null?void 0:Bt.coordinator,(Dt=F.value.per_scored_month)==null?void 0:Dt.max)+"%"})},null,4)])]),s("div",yn,[s("div",gn,[t[22]||(t[22]=s("span",{class:"text-xs font-medium text-slate-600"},"Final",-1)),s("span",hn,i(xe((Kt=F.value.per_form_yearly)==null?void 0:Kt.final,(Ot=F.value.per_scored_month)==null?void 0:Ot.max))+"% ",1)]),s("div",_n,[ne(i(Z((Qt=F.value.per_form_yearly)==null?void 0:Qt.final))+" ",1),s("span",kn,"/ "+i(Z((Vt=F.value.per_scored_month)==null?void 0:Vt.max)),1)]),s("div",wn,[s("div",{class:"h-2 bg-emerald-500",style:j({width:xe((Ut=F.value.per_form_yearly)==null?void 0:Ut.final,(qt=F.value.per_scored_month)==null?void 0:qt.max)+"%"})},null,4)])])]),s("div",$n,[s("button",{class:"text-xs px-3 py-1.5 rounded-md border hover:bg-slate-50",onClick:t[3]||(t[3]=m=>ie.value=!ie.value)},i(ie.value?"Hide details":"Show "+kt.value+" details"),1),ie.value?(o(),r("div",Fn,[s("div",Ln,[t[23]||(t[23]=s("div",{class:"text-slate-500"},"Year",-1)),s("div",Sn,i(qe.value||"-"),1),t[24]||(t[24]=s("div",{class:"text-slate-500"},"Months counted",-1)),s("div",Nn,i(_t.value),1),t[25]||(t[25]=s("div",{class:"text-slate-500"},"Max",-1)),s("div",An,i(Z((Yt=F.value.per_scored_month)==null?void 0:Yt.max)),1),t[26]||(t[26]=s("div",{class:"text-slate-500"},"Final avg",-1)),s("div",Cn,i(Z((Wt=F.value.per_form_yearly)==null?void 0:Wt.final)),1),t[27]||(t[27]=s("div",{class:"text-slate-500"},"Percent (simple)",-1)),s("div",Mn,i(Z(F.value.percent_simple))+"%",1),t[28]||(t[28]=s("div",{class:"text-slate-500"},"Percent (weighted)",-1)),s("div",En,i(Z(F.value.percent_weighted))+"%",1)])])):g("",!0)])])])])):g("",!0),Me.value.length?(o(),r("section",In,[s("header",Pn,[t[29]||(t[29]=s("span",null,"Review Comments",-1)),s("span",Tn,i(Me.value.length)+" lane(s) ",1)]),s("div",jn,[s("div",Rn,[s("table",Gn,[t[31]||(t[31]=s("thead",{class:"text-[11px] text-slate-600 uppercase tracking-wide bg-slate-50"},[s("tr",null,[s("th",{class:"px-2 py-2 w-[140px]"},"Lane"),s("th",{class:"px-2 py-2 text-right"},"Details")])],-1)),s("tbody",null,[(o(!0),r(C,null,M(Me.value,m=>(o(),r("tr",{key:m.key,class:"border-t hover:bg-slate-50/60 align-top"},[s("td",Hn,[s("div",zn,i(m.label),1),m.submitted_at?(o(),r("div",Bn,i(new Date(m.submitted_at).toLocaleDateString()),1)):g("",!0)]),s("td",Dn,[s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:A=>ws(m)},t[30]||(t[30]=[s("span",null,"View comments",-1),s("span",{class:"text-[10px] text-slate-400"},"Strengths · Gaps · Suggestions",-1)]),8,Kn)])]))),128))])])])])])):g("",!0)],2)])]),Ae.value||U.value?(o(),r("section",On,[t[38]||(t[38]=s("header",{class:"flex items-center justify-between mb-1"},[s("div",null,[s("h2",{class:"text-sm font-semibold text-slate-800"},"Overall Review Notes"),s("p",{class:"text-[11px] text-slate-500"},"Use saved hints or write your own detailed comments.")])],-1)),s("div",Qn,[s("div",Vn,[s("header",Un,[t[32]||(t[32]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-emerald-500 text-base leading-none"},"★"),s("span",null,"Strengths")],-1)),Ee.value.length?(o(),r("span",qn,i(Ee.value.length)+" saved hint(s) ",1)):g("",!0)]),Ee.value.length?(o(),r("div",Yn,[s("div",Wn,[(o(!0),r(C,null,M(Ee.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("strengths",m),disabled:Te("strengths",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,Jn))),128))])])):g("",!0),s("div",Xn,[t[33]||(t[33]=s("label",{class:"text-[11px] font-medium text-slate-500"}," Key Strength(s) ",-1)),fe(s("textarea",{"onUpdate:modelValue":t[4]||(t[4]=m=>W.value=m),placeholder:"e.g. Strong ownership, proactive problem solving…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[He,W.value]])])]),s("div",Zn,[s("header",eo,[t[34]||(t[34]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-amber-500 text-base leading-none"},"!"),s("span",null,"Gaps")],-1)),Ie.value.length?(o(),r("span",to,i(Ie.value.length)+" saved hint(s) ",1)):g("",!0)]),Ie.value.length?(o(),r("div",so,[s("div",lo,[(o(!0),r(C,null,M(Ie.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("gaps",m),disabled:Te("gaps",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-amber-300 hover:bg-amber-50 hover:text-amber-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,ao))),128))])])):g("",!0),s("div",no,[t[35]||(t[35]=s("label",{class:"text-[11px] font-medium text-slate-500"},"GAP(s)",-1)),fe(s("textarea",{"onUpdate:modelValue":t[5]||(t[5]=m=>se.value=m),placeholder:"e.g. Needs improvement in documentation, communication…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-amber-200"},null,512),[[He,se.value]])])]),s("div",oo,[s("header",ro,[t[36]||(t[36]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-sky-500 text-base leading-none"},"✱"),s("span",null,"Suggestions / Training")],-1)),Pe.value.length?(o(),r("span",io,i(Pe.value.length)+" common suggestion(s) ",1)):g("",!0)]),Pe.value.length?(o(),r("div",uo,[s("div",co,[(o(!0),r(C,null,M(Pe.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("suggestions",m),disabled:Te("suggestions",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-sky-300 hover:bg-sky-50 hover:text-sky-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,vo))),128))])])):g("",!0),s("div",mo,[t[37]||(t[37]=s("label",{class:"text-[11px] font-medium text-slate-500"}," Suggestions / Development plan ",-1)),fe(s("textarea",{"onUpdate:modelValue":t[6]||(t[6]=m=>le.value=m),placeholder:"Specific actions, training plans, timeline and expectations…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-sky-200"},null,512),[[He,le.value]])])])])])):g("",!0),s("div",xo,[t[39]||(t[39]=s("div",{class:"text-sm text-slate-600"},null,-1)),s("div",po,[is.value?(o(),r("button",{key:0,onClick:Es,disabled:!Ss.value,class:"inline-flex items-center justify-center rounded-xl bg-slate-900 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-slate-800 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-slate-300"},i(ds.value),9,bo)):g("",!0),U.value&&!J.value?(o(),r("button",{key:1,onClick:Is,disabled:!Ns.value,class:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-emerald-700 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-emerald-300"}," Submit HR Review ",8,fo)):g("",!0)])]),Rs(Bs,{name:"fade-scale"},{default:Hs(()=>{var m,A,Jt;return[Ye.value&&P.value?(o(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:zs(We,["escape","window"])},[s("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:We}),s("div",yo,[s("div",go,[s("div",null,[s("p",ho,i(P.value.label),1),s("p",_o," Lane: "+i(P.value.lane)+" - Reviewed by "+i(P.value.reviewer_name||"––"),1),P.value.submitted_at?(o(),r("p",ko,i(new Date(P.value.submitted_at).toLocaleString()),1)):g("",!0)]),s("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:We}," Close ")]),s("div",wo,[s("div",null,[t[40]||(t[40]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Strengths",-1)),s("div",$o,[(m=P.value.strengths)!=null&&m.length?(o(),r("div",Fo,[(o(!0),r(C,null,M(P.value.strengths,(ke,we)=>(o(),r("p",{key:"modal-strength-"+we},"- "+i(ke),1))),128))])):(o(),r("p",Lo,"No strengths entered."))])]),s("div",null,[t[41]||(t[41]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Gaps",-1)),s("div",So,[(A=P.value.gaps)!=null&&A.length?(o(),r("div",No,[(o(!0),r(C,null,M(P.value.gaps,(ke,we)=>(o(),r("p",{key:"modal-gap-"+we},"- "+i(ke),1))),128))])):(o(),r("p",Ao,"No gaps recorded."))])]),s("div",null,[t[42]||(t[42]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Suggestions",-1)),s("div",Co,[(Jt=P.value.suggestions)!=null&&Jt.length?(o(),r("div",Mo,[(o(!0),r(C,null,M(P.value.suggestions,(ke,we)=>(o(),r("p",{key:"modal-sug-"+we},"- "+i(ke),1))),128))])):(o(),r("p",Eo,"No suggestions provided."))])])])])],32)):g("",!0)]}),_:1})],64))]))}}},Ro={__name:"KpiReviewPage",setup(p){return($,te)=>(o(),tt(Po))}};export{Ro as default};
