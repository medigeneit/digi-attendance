import{z as B,r as b,m as _,e as R,x as k,c as r,o as d,a,g as m,q as y,i as x,t as h,w,_ as G}from"./index-DzEmXLmZ.js";import{u as H}from"./company-BOjL2COZ.js";import{u as J}from"./department-BHMXIvUA.js";import{S as V}from"./SelectDropdown-BCyAP76U.js";import{_ as K}from"./UserChip-B_lkHBeN.js";const Q={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},W={class:"relative"},X={key:0,class:"relative w-full pr-6"},Y={class:"flex items-center gap-2 text-sm text-gray-700"},Z={class:"line-clamp-1"},ee={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},te={class:"relative"},le={key:0,class:"relative w-full pr-6"},ae={class:"flex items-center gap-2 text-sm text-gray-700"},se={class:"line-clamp-1"},ie={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},oe={key:0,class:"absolute inset-0 bg-white/50 cursor-not-allowed rounded","aria-hidden":"true"},ne={key:0,class:"relative"},re={key:0,class:"relative w-full pr-6"},de={class:"flex items-center gap-2 text-sm text-gray-700"},ue={class:"line-clamp-1"},me={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},pe={class:"relative"},ce={key:0,class:"relative w-full pr-6"},ve={class:"flex items-center gap-2 text-sm text-gray-700"},fe={class:"line-clamp-1"},ye={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},Ve={__name:"EmployeeFilter",props:{modelValue:Object,withType:{type:Boolean,default:!0},initialValue:{type:Object,default:()=>({})}},emits:["update:modelValue","filter-change"],setup(C,{emit:O}){const s=C,E=O,g=H(),D=J(),{companies:U}=B(g),{departments:S}=B(D),u=b(""),o=b("all"),n=b(s.withType?"all":null),i=b(""),A=_(()=>(U.value||[]).map(l=>({id:String(l.id),label:l.name}))),F=_(()=>{const l=[{id:"all",label:"All Departments"}];if(!u.value)return l;const e=(S.value||[]).map(t=>({id:String(t.id),label:t.name}));return[...l,...e]}),I=_(()=>s.withType?[{id:"all",label:"All Types"},{id:"executive",label:"Executive"},{id:"support_staff",label:"Support Staff"},{id:"doctor",label:"Doctor"},{id:"academy_body",label:"Academy Body"}]:[]),N=_(()=>g.employees||[]),c=b([]);R(async()=>{var l,e,t,f;if(await g.fetchCompanies(),(l=s.initialValue)!=null&&l.company_id){if(u.value=String(s.initialValue.company_id),await $(u.value),(e=s.initialValue)!=null&&e.department_id&&s.initialValue.department_id!=="all"&&(o.value=String(s.initialValue.department_id)),s.withType&&((t=s.initialValue)!=null&&t.type)&&s.initialValue.type!=="all"&&(n.value=String(s.initialValue.type)),v(),(f=s.initialValue)!=null&&f.employee_id){const z=String(s.initialValue.employee_id);c.value.find(P=>String(P.id)===z)&&(i.value=z)}p()}else p()}),k(u,async l=>{o.value="all",n.value=s.withType?"all":null,i.value="",c.value=[],l?(await $(l),v()):(S.value=[],v()),p()}),k([o,n],()=>{v()}),k(i,()=>{p()});async function $(l){await Promise.all([D.fetchDepartments(l),g.fetchEmployee(l)])}function v(){let l=[...N.value];o.value&&o.value!=="all"&&(l=l.filter(e=>String(e.department_id)===String(o.value))),s.withType&&n.value&&n.value!=="all"&&(l=l.filter(e=>String(e.type)===String(n.value))),c.value=l.map(e=>({...e,id:String(e.id),label:e.name||e.label||`${e.first_name??""} ${e.last_name??""}`.trim()})),i.value&&(c.value.some(t=>t.id===String(i.value))||(i.value=""))}let T=null;function p(){T&&clearTimeout(T),T=setTimeout(()=>{E("update:modelValue",{company_id:u.value||"",department_id:o.value||"all",type:s.withType?n.value||"all":null,employee_id:i.value||""}),E("filter-change")},0)}function j(){u.value="",o.value="all",s.withType&&(n.value="all"),i.value="",c.value=[],S.value=[],p()}function M(){o.value="all",i.value="",v(),p()}function q(){s.withType&&(n.value="all",i.value="",v(),p())}function L(){i.value="",p()}return(l,e)=>(d(),r("div",Q,[a("div",W,[y(V,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value=t),options:A.value,placeholder:"Select Company",class:"border-2 border-gray-300 rounded h-[44px] w-full md:w-64 bg-white"},{"selected-option":x(({option:t})=>[t?(d(),r("div",X,[a("div",Y,[a("div",Z,h(t==null?void 0:t.label),1)]),u.value?(d(),r("div",ee,[a("button",{onClick:e[0]||(e[0]=w(f=>j(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"},"×")])):m("",!0)])):m("",!0)]),_:1},8,["modelValue","options"]),e[8]||(e[8]=a("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),a("div",te,[y(V,{modelValue:o.value,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value=t),options:F.value,placeholder:"Select Department",class:"border-2 border-gray-300 rounded h-[44px] w-full md:w-64 bg-white"},{"selected-option":x(({option:t})=>[t?(d(),r("div",le,[a("div",ae,[a("div",se,h(t==null?void 0:t.label),1)]),o.value&&o.value!=="all"?(d(),r("div",ie,[a("button",{onClick:e[2]||(e[2]=w(f=>M(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"},"×")])):m("",!0)])):m("",!0)]),_:1},8,["modelValue","options"]),e[9]||(e[9]=a("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Department ",-1)),u.value?m("",!0):(d(),r("div",oe))]),C.withType?(d(),r("div",ne,[y(V,{modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value=t),options:I.value,placeholder:"Select Type",class:"border-2 border-gray-300 rounded h-[44px] w-full md:w-64 bg-white"},{"selected-option":x(({option:t})=>[t?(d(),r("div",re,[a("div",de,[a("div",ue,h(t==null?void 0:t.label),1)]),n.value&&n.value!=="all"?(d(),r("div",me,[a("button",{onClick:e[4]||(e[4]=w(f=>q(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"},"×")])):m("",!0)])):m("",!0)]),_:1},8,["modelValue","options"]),e[10]||(e[10]=a("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Line Type ",-1))])):m("",!0),a("div",pe,[y(V,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value=t),options:c.value,placeholder:"--Select Employee--",class:"border-2 border-gray-300 rounded h-[44px] w-full md:w-64 bg-white"},{option:x(({option:t})=>[y(K,{user:t||{},class:"w-full overflow-hidden border relative"},null,8,["user"])]),"selected-option":x(({option:t})=>[t?(d(),r("div",ce,[a("div",ve,[y(G,{user:t},null,8,["user"]),a("div",fe,h(t==null?void 0:t.label),1)]),i.value?(d(),r("div",ye,[a("button",{onClick:e[6]||(e[6]=w(f=>L(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"},"×")])):m("",!0)])):m("",!0)]),_:1},8,["modelValue","options"]),e[11]||(e[11]=a("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))])]))}};export{Ve as _};
