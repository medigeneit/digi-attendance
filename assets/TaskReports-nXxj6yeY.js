import{b as N,e as B,q as P,k as V,c as n,o as a,a as t,t as l,l as C,p as A,n as E,h as u,f as p,F as D,x as S,w as F,y as L}from"./index-BRKnF_l4.js";import{_ as M}from"./UserChip-K87mPk4F.js";import{g as O}from"./datetime-BISRKKpq.js";import{u as $}from"./useTaskReportStore-xU0DCUBc.js";import{u as q}from"./useTaskStore-CJ5XB4Wi.js";const z={class:"mt-4"},I={class:"bg-white"},U={class:"flex mb-2 items-end"},j={class:"overflow-auto w-full"},G={key:0,class:"min-w-full bg-white shadow rounded-lg overflow-hidden"},H={class:"bg-gray-100"},J={key:0,class:"px-4 py-2 text-left md:w-[100px] lg:w-[220px] xl:w-[320px]"},K={key:0},Q=["onClick"],W={class:"px-4 py-2"},X={key:0,class:"px-4 py-2 font-medium border-r"},Y={key:0,style:{"font-family":"monospace"}},Z={class:"ml-1"},tt={class:"ml-1"},st={class:"font-medium py-2 px-4"},et={class:"border rounded-md bg-gray-50"},ot={class:"text-sm flex items-center px-3 py-3"},nt={class:"text-gray-600 text-sm ml-auto whitespace-nowrap"},at={class:"px-4 py-2 font-medium text-center"},rt={class:"px-4 py-2 font-medium text-center"},lt={key:1,class:"text-center border py-4 text-gray-500"},ft={__name:"TaskReports",setup(it){const c=$(),d=q(),y=N().params.id;B(async()=>{await d.fetchTask(y),await c.fetchTaskReports({task_id:y})});function h(i,s=[]){const r=[];for(const o of i){const m=[...s,o.title];o.children_tasks.length===0?r.push(...o.reports.map(e=>({...e,task_id:o.id,task_title:o.title,task_parents:s,user:o.users.find(_=>_.id===e.user_id)}))):r.push(...h(o.children_tasks,m))}return r}function k(i,s){try{const r=new Date(i.report_date).getTime(),o=new Date(s.report_date).getTime();return o===r?s.id-i.id:o-r}catch{return-1}}const x=P(()=>d.task.children_task_count===0?[...c.task_reports].sort(k):[...h(d.tasks)].sort(k));return(i,s)=>{var o,m;const r=V("RouterLink");return a(),n("div",z,[s[8]||(s[8]=t("hr",{class:"mb-2"},null,-1)),s[9]||(s[9]=t("hr",{class:"mb-2"},null,-1)),t("div",I,[t("pre",null,l(i.usersTaskProgress),1),t("div",U,[s[2]||(s[2]=t("h3",{class:"text-sm uppercase mt-4"},"Task Reports",-1)),C(r,{to:{name:"TaskReportAdd",params:{id:(o=u(c).task)==null?void 0:o.id}},onClick:s[0]||(s[0]=e=>e.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:A(()=>s[1]||(s[1]=[E("Add Report")])),_:1,__:[1]},8,["to"])]),t("div",j,[u(c).loading?(a(),n("div",lt,"Loading...")):(a(),n("table",G,[t("thead",H,[t("tr",null,[s[3]||(s[3]=t("th",{class:"px-4 py-2 text-left"},"#",-1)),u(d).task.children_task_count>0?(a(),n("th",J," Task ")):p("",!0),s[4]||(s[4]=t("th",{class:"px-4 py-2 text-left lg:w-[540px]"},"User Report",-1)),s[5]||(s[5]=t("th",{class:"px-4 py-2 text-center"},"Duration",-1)),s[6]||(s[6]=t("th",{class:"px-4 py-2 text-center"},"Progress",-1))])]),t("tbody",null,[((m=x.value)==null?void 0:m.length)===0?(a(),n("tr",K,s[7]||(s[7]=[t("td",{class:"px-4 py-4 font-medium text-gray-500 text-center",colspan:"10"}," NO REPORTS ",-1)]))):p("",!0),(a(!0),n(D,null,S(x.value,(e,_)=>{var g,w,v,b,R;return a(),n("tr",{key:e.id,class:"border-t hover:bg-gray-50 cursor-pointer",onClick:F(T=>i.goToShow(e.id),["prevent"]),role:"button"},[t("td",W,l(_+1),1),u(d).task.children_task_count>0?(a(),n("td",X,[t("div",null,[(a(!0),n(D,null,S(e.task_parents.reverse(),(T,f)=>(a(),n("div",{key:f,class:L(["text-gray-400 text-sm line-clamp-1",{"-ml-1":f==0}])},[f>0?(a(),n("span",Y,"↳")):p("",!0),t("span",Z,l(T),1)],2))),128)),t("div",null,[((g=e.task_parents)==null?void 0:g.length)>0?(a(),n("span",{key:0,style:{"font-family":"monospace"},class:L({"ml-2":((w=e.task_parents)==null?void 0:w.length)==1,"ml-4":((v=e.task_parents)==null?void 0:v.length)==2,"ml-6":((b=e.task_parents)==null?void 0:b.length)==3,"ml-8":((R=e.task_parents)==null?void 0:R.length)==4})},"↳",2)):p("",!0),t("span",tt,l(e.task_title),1)])])])):p("",!0),t("td",st,[t("div",et,[C(M,{user:e.user,class:"inline-block w-full !rounded-sm"},null,8,["user"]),t("div",ot,[t("div",null,l(e.title),1),t("div",nt," on "+l(u(O)(e.report_date)),1)])])]),t("td",at,l(e.duration_hour)+" h "+l(e.duration_minute)+" m ",1),t("td",rt,l(e.progress)+"%",1)],8,Q)}),128))])]))])])])}}};export{ft as default};
