import{z as u,b as V,u as E,r as x,x as B,e as F,c as n,o as l,a as s,g as L,q as M,k as r,h as p,y as N,F as g,n as h,t as k,E as S}from"./index-DM-YVLMB.js";import{_ as R}from"./MultiselectDropdown-ILKfAHVZ.js";import{u as q}from"./company-DjPjmu8Q.js";import{u as z}from"./department-fMpFRMyH.js";import{u as A}from"./user-BMJ1bKgM.js";import{u as T}from"./userPermissionStore-BUNrxxSl.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-CqgFx00g.js";const $={class:"max-w-xl mx-auto mt-10 p-6 bg-white shadow-md rounded-xl space-y-6"},j=["value"],G={key:0},H={class:"space-y-1 mt-2"},I={class:"flex items-center space-x-2"},J={class:"grid grid-cols-2 gap-2"},K=["value"],O=["disabled"],Q={key:0},W={key:1},ne={__name:"PermissionEdit",setup(X){const c=A(),i=T(),v=q(),m=z(),{users:y}=u(c),{companies:U}=u(v),{departments:_}=u(m),f=V(),b=E(),d=x(null),t=x({user_id:"",company_id:"",department_ids:[]}),P=async()=>{try{const o=await i.fetchPermission(f.params.id);t.value.user_id=o.user_id,t.value.company_id=o.company_id,t.value.department_ids=o.department_ids.includes("*")?["*"]:o.department_ids,d.value=y.value.find(e=>e.id===o.user_id)||null,await m.fetchDepartments(o.company_id)}catch{alert(i.error||"Failed to load permission"),b.push({name:"PermissionList"})}};B(d,o=>{t.value.user_id=(o==null?void 0:o.id)||""});const w=async()=>{t.value.department_ids=[],await m.fetchDepartments(t.value.company_id)},C=async()=>{try{await i.updatePermission(f.params.id,t.value),b.push({name:"PermissionList"})}catch{alert(i.error||"Update failed")}};return F(async()=>{await Promise.all([c.fetchUsers(),v.fetchCompanies()]),await P()}),(o,e)=>(l(),n("div",$,[e[9]||(e[9]=s("h2",{class:"text-2xl font-bold text-gray-700"},"Edit Permission",-1)),s("div",null,[e[4]||(e[4]=s("label",{class:"block font-medium mb-1"},"Select User",-1)),M(R,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),options:r(y),multiple:!1,label:"label",placeholder:"Select employee"},null,8,["modelValue","options"])]),s("div",null,[e[6]||(e[6]=s("label",{class:"block font-medium mb-1"},"Select Company",-1)),p(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.company_id=a),onChange:w,class:"w-full border rounded px-3 py-2",disabled:""},[e[5]||(e[5]=s("option",{value:""},"-- Select Company --",-1)),(l(!0),n(g,null,h(r(U),a=>(l(),n("option",{key:a.id,value:a.id},k(a.name),9,j))),128))],544),[[N,t.value.company_id]])]),r(_).length?(l(),n("div",G,[e[8]||(e[8]=s("label",{class:"block font-medium mb-1"},"Select Departments",-1)),s("div",H,[s("label",I,[p(s("input",{type:"checkbox",value:"*","onUpdate:modelValue":e[2]||(e[2]=a=>t.value.department_ids=a)},null,512),[[S,t.value.department_ids]]),e[7]||(e[7]=s("span",null,"All Departments",-1))]),s("div",J,[(l(!0),n(g,null,h(r(_),a=>(l(),n("label",{key:a.id,class:"flex items-center space-x-2"},[p(s("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":e[3]||(e[3]=D=>t.value.department_ids=D)},null,8,K),[[S,t.value.department_ids]]),s("span",null,k(a.name),1)]))),128))])])])):L("",!0),s("button",{onClick:C,disabled:r(i).loading,class:"w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},[r(i).loading?(l(),n("span",Q,"Updating...")):(l(),n("span",W,"Update Permission"))],8,O)]))}};export{ne as default};
