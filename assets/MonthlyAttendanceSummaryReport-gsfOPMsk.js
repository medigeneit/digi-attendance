import{m as C,c as y,o as c,t as s,u as P,b as M,d as E,r as f,z as F,x as T,e as V,A as R,a as e,f as w,q as b,k as u,h as $,v as B,F as W,n as N,g as I,i as j,j as U}from"./index-CDOc7smG.js";import{_ as z}from"./EmployeeFilter-CJhjKGNy.js";import{L as O}from"./LoaderView-BFEoiBtd.js";import{u as Q}from"./attendance-DkGZaAFG.js";import{u as G,_ as J}from"./UpdateOrCreate-B5sLMvsh.js";import"./company-DttRzgfs.js";import"./department-B0LjcvQZ.js";import"./SelectDropdown-rbIRixJt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-4DrqMYpq.js";import"./TimePickerAsFloatHour-BTSkGhcX.js";const K={__name:"DisplayFormattedWorkingHours",props:["workingHours"],setup(m){const i=m,d=C(()=>{if(!i.workingHours)return"-";const _=Math.floor(i.workingHours),o=Math.round((i.workingHours-_)*60);return o?`${_}h ${o}m`:`${_}h`});return(_,o)=>(c(),y("span",null,s(d.value),1))}},X={class:"px-4 space-y-4"},Y={class:"flex flex-wrap gap-4"},Z={class:"flex gap-4"},g={key:1,class:"space-y-4"},tt={key:0,class:"overflow-x-auto card-bg"},et={class:"min-w-full table-auto border-collapse border border-gray-300 bg-white"},st={class:"text-center text-sm"},at={class:"border px-2 py-0.5"},rt={class:"border px-2 py-0.5"},nt={class:"border px-2 py-0.5"},dt={class:"border px-2 py-0.5"},ot={class:"border px-2 py-0.5"},pt={class:"border px-2 py-0.5"},ct={class:"border px-2 py-0.5"},it={class:"border px-2 py-0.5"},yt={class:"border px-2 py-0.5"},_t={class:"border px-2 py-0.5"},ut={class:"border px-2 py-0.5"},lt={class:"border px-2 py-0.5"},ht={class:"border px-2 py-0.5"},bt={class:"border px-2 py-0.5"},mt={class:"border px-2 py-0.5"},xt={class:"border px-2 py-0.5"},vt={class:"border py-0.5"},ft={class:"border-b border-black font-semibold text-green-600"},wt={class:"text-gray-600"},kt={class:"border px-2 py-0.5"},Ht={class:"border px-2 py-0.5"},Dt={class:"border px-2 py-0.5"},Lt={class:"border px-2 py-0.5"},qt={class:"border px-2 py-0.5"},At={class:"border px-2 py-0.5"},St={class:"border px-2 py-0.5"},Ct={class:"border px-2 py-0.5"},Pt={class:"border px-2 py-0.5"},Mt={class:"border px-2 py-0.5"},Et={class:"flex gap-2 items-center"},Ft={class:"border px-2 py-0.5"},Tt={class:"border px-4 py-0.5"},Vt={key:1,class:"text-center text-red-500 text-xl italic mt-10"},Gt={__name:"MonthlyAttendanceSummaryReport",setup(m){const i=P(),d=M(),_=E(),o=Q();G();const p=f(d.query.date||o.selectedMonth),{monthly_company_summary:k}=F(o),r=f({company_id:d.query.company_id||"",department_id:d.query.department_id||"all",type:d.query.type||"all",employee_id:d.query.employee_id||""}),h=async()=>{const n=r.value.company_id,a=r.value.employee_id||"",l=r.value.type!=="all"?r.value.type:"";if(!n){alert("⚠️ Please select a company first.");return}try{await o.getMonthlyAttendanceSummaryReport(n,a,l,p.value)}catch(t){console.error("❌ Failed to load attendance:",t),alert("❌ Failed to load attendance data.")}},H=()=>{const n=d.query,a={...n,company_id:r.value.company_id,department_id:r.value.department_id,type:r.value.type,employee_id:r.value.employee_id,date:p.value};Object.keys(a).some(t=>n[t]!==String(a[t]))&&i.replace({query:a})};T(p,n=>{d.query.date!==n&&i.replace({query:{...d.query,date:n}})}),V(()=>{r.value.company_id&&h()});const D=async()=>{if(r.value.company_id){const n=r.value.type!=="all"?r.value.type:"";await o.downloadExcel(r.value.company_id,n,p.value)}},L=async()=>{if(r.value.company_id){const n=r.value.type!=="all"?r.value.type:"";await o.downloadPDF(r.value.company_id,n,p.value)}},q=()=>i.go(-1),A=async()=>{await h()};return(n,a)=>{const l=R("router-link");return c(),y("div",X,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:q},a[3]||(a[3]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),a[6]||(a[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Attendance Summary Report",-1)),e("div",{class:"flex gap-4"},[e("button",{type:"button",onClick:D,class:"btn-1"},a[4]||(a[4]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1)])),e("button",{type:"button",onClick:L,class:"btn-1"},a[5]||(a[5]=[e("i",{class:"fal fa-file-pdf text-2xl text-red-500"},null,-1)]))])]),e("div",Y,[b(z,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=t=>r.value=t),"initial-value":u(d).query,onFilterChange:H},null,8,["modelValue","initial-value"]),e("div",Z,[$(e("input",{type:"month","onUpdate:modelValue":a[1]||(a[1]=t=>p.value=t),class:"input-1"},null,512),[[B,p.value]]),e("button",{type:"button",onClick:a[2]||(a[2]=t=>h()),class:"btn-2"},"Search")])]),u(o).isLoading?(c(),w(O,{key:0})):(c(),y("div",g,[r.value.company_id?(c(),y("div",tt,[e("table",et,[a[8]||(a[8]=e("thead",{class:"sticky top-0 z-10 bg-white shadow-sm"},[e("tr",{class:"bg-gray-100 text-sm"},[e("th",{rowspan:"2",class:"border px-1 py-0.5"},"#"),e("th",{rowspan:"2",class:"border px-1 py-0.5"},"Employee Name"),e("th",{rowspan:"2",class:"border px-1 py-0.5"},"Designation"),e("th",{colspan:"5",class:"border px-1 py-0.5"},"Attendance Summary"),e("th",{colspan:"2",class:"border px-1 py-0.5"},"Actual Late"),e("th",{colspan:"2",class:"border px-1 py-0.5"},"Remaining Late"),e("th",{colspan:"2",class:"border px-1 py-0.5"},"Actual Early"),e("th",{colspan:"2",class:"border px-1 py-0.5"},"Remaining Early"),e("th",{rowspan:"2",class:"border px-1 py-0.5"},"Working Hour"),e("th",{colspan:"4",class:"border px-1 py-0.5"},"Leave Day"),e("th",{colspan:"2",class:"border px-1 py-0.5"},"Short Leave"),e("th",{rowspan:"2",class:"border px-1 py-0.5"},"OT Hour"),e("th",{colspan:"4",class:"border px-1 py-0.5"},"Deduction"),e("th",{rowspan:"2",class:"border px-8 py-0.5"},"Action")]),e("tr",{class:"bg-gray-100 text-xs"},[e("th",{class:"border px-2 py-0.5"},"TD"),e("th",{class:"border px-2 py-0.5"},"TP"),e("th",{class:"border px-2 py-0.5"},"TW"),e("th",{class:"border px-2 py-0.5"},"TL"),e("th",{class:"border px-2 py-0.5"},"TA"),e("th",{class:"border px-1 py-0.5"},"Day"),e("th",{class:"border px-2 py-0.5"},"Hour"),e("th",{class:"border px-1 py-0.5"},"Day"),e("th",{class:"border px-2 py-0.5"},"Hour"),e("th",{class:"border px-1 py-0.5"},"Day"),e("th",{class:"border px-2 py-0.5"},"Hour"),e("th",{class:"border px-1 py-0.5"},"Day"),e("th",{class:"border px-2 py-0.5"},"Hour"),e("th",{class:"border px-2 py-0.5"},"CL"),e("th",{class:"border px-2 py-0.5"},"ML"),e("th",{class:"border px-2 py-0.5"},"SL"),e("th",{class:"border px-2 py-0.5"},"WPL"),e("th",{class:"border px-2 py-0.5"},"Delay"),e("th",{class:"border px-2 py-0.5"},"Early"),e("th",{class:"border px-2 py-0.5"},"Absent Hour"),e("th",{class:"border px-2 py-0.5"},"WPL(Hour)"),e("th",{class:"border px-2 py-0.5"},"Pay Cut"),e("th",{class:"border px-2 py-0.5"},"Payable Hour")])],-1)),e("tbody",st,[(c(!0),y(W,null,N(u(k),(t,S)=>{var x,v;return c(),y("tr",{key:t==null?void 0:t.date,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",at,s(S+1),1),e("td",rt,s(t==null?void 0:t.user),1),e("td",nt,s(t==null?void 0:t.designation),1),e("td",dt,s(t==null?void 0:t.total_monthly_days),1),e("td",ot,s(t==null?void 0:t.total_present),1),e("td",pt,s(t==null?void 0:t.total_weekend),1),e("td",ct,s(t==null?void 0:t.total_leave),1),e("td",it,s(t==null?void 0:t.total_absent),1),e("td",yt,s(t==null?void 0:t.actual_late_day),1),e("td",_t,s(t==null?void 0:t.actual_late_hour),1),e("td",ut,s(t==null?void 0:t.total_remain_late_day),1),e("td",lt,s(t==null?void 0:t.total_remain_late_hour),1),e("td",ht,s(t==null?void 0:t.actual_early_day),1),e("td",bt,s(t==null?void 0:t.actual_early_hour),1),e("td",mt,s(t==null?void 0:t.total_remain_early_day),1),e("td",xt,s(t==null?void 0:t.total_remain_early_hour),1),e("td",vt,[e("div",ft,s((t==null?void 0:t.total_working_hours)||0),1),e("div",wt,s((t==null?void 0:t.total_shift_hour)||0),1)]),e("td",kt,s(t==null?void 0:t.total_cl_leave),1),e("td",Ht,s(t==null?void 0:t.total_ml_leave),1),e("td",Dt,s(t==null?void 0:t.total_sl_leave),1),e("td",Lt,s(t==null?void 0:t.total_wpl_leave),1),e("td",qt,s(t==null?void 0:t.total_first_short_leave),1),e("td",At,s(t==null?void 0:t.total_last_short_leave),1),e("td",St,s(t!=null&&t.total_overtime_hours?(t==null?void 0:t.total_overtime_hours)+" H":""),1),e("td",Ct,s((t==null?void 0:t.remain_total_absent)*9)+"H",1),e("td",Pt,s(t==null?void 0:t.total_wpl_hour)+"H",1),e("td",Mt,[e("div",Et,[b(K,{workingHours:(x=t==null?void 0:t.paycut)==null?void 0:x.paycut_hours},null,8,["workingHours"]),((v=u(_).user)==null?void 0:v.id)===8?(c(),w(J,{key:0,class:"mr-2",userId:t==null?void 0:t.user_id,month:p.value,onUpdated:A},null,8,["userId","month"])):I("",!0)])]),e("td",Ft,s(t==null?void 0:t.payable_hour)+"H",1),e("td",Tt,[b(l,{to:{name:"EmployeeAttendance",query:{...u(d).query,employee_id:t==null?void 0:t.user_id,date:p.value}},target:"_blank",class:"text-blue-500 hover:underline inline-flex items-center gap-1"},{default:j(()=>a[7]||(a[7]=[e("i",{class:"fas fa-calendar-check"},null,-1),U(" Go to ")])),_:2,__:[7]},1032,["to"])])])}),128))])])])):(c(),y("div",Vt,"Please select company"))]))])}}};export{Gt as default};
