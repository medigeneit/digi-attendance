import{c as i,o as n,F as q,x as z,m as V,M as H,y as w,a as e,q as T,z as I,n as C,t as g,r as R,A as F,k as J,f as m,w as S,l as y,p as B,_ as U}from"./index-BwlsWjXD.js";const G={class:"mt-3"},K={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(t,{emit:b}){const a=b;return(f,o)=>(n(),i("div",G,[(n(!0),i(q,null,z(t.childrenTasks,h=>(n(),V(pe,{key:h.id,task:h,class:"mb-3","hide-buttons":t.hideButtons,"tree-level":t.parentTreeLevel+1,onEditClick:o[0]||(o[0]=d=>a("editClick",d)),onAddClick:o[1]||(o[1]=d=>a("addClick",d))},null,8,["task","hide-buttons","tree-level"]))),128))]))}},Q=H({__name:"SubTaskProgress",props:{task:{}},setup(t,{expose:b}){const a=t,f=w(function(){if(a.task.children_tasks.length===0)return a.task.status==="COMPLETED"?1:0;const d=l=>{let c=0;for(let u=0;u<l.length;u++){const v=l[u];if(v.children_tasks.length===0)v.status==="COMPLETED"&&(c+=1);else{const _=v.children_tasks.length;d(v.children_tasks)===_&&(c+=1)}}return c};return d(a.task.children_tasks)}),o=w(()=>a.task.children_tasks.length===0?a.task.status==="COMPLETED"?100:0:f.value/a.task.children_tasks.length*100),h=w(()=>{const d=o.value;let l,c,u;return d===100?(l="bg-green-50",c="bg-green-200",u="text-green-600 "):d<100&&(l="bg-red-50",c="bg-red-200",u="text-red-600 "),{container:l,bar:c,text:u}});return b({completedPercentage:o.value,completedSubTaskCount:f.value}),(d,l)=>(n(),i("div",null,[e("div",{class:T(["rounded-full border py-0.5 relative overflow-hidden h-6",h.value.container]),style:{width:"180px"}},[e("div",{class:T(["z-10 absolute top-0 bottom-0",h.value.bar]),style:I(`width: ${o.value}%`)},null,6),e("span",{class:T(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",h.value.text])},[e("span",null,[e("span",null,g(f.value),1),l[0]||(l[0]=C(" / ")),e("span",null,g(d.task.children_tasks.length||1),1)])],2)],2)]))}}),W={class:"flex w-full"},X={key:0,class:"border-l border-gray-200 last:border-l-0"},Y={class:"items-start grid grid-cols-3 group"},Z={class:""},ee={class:"flex gap-4"},te={class:"text-sky-800"},se={class:"flex items-center gap-2"},ae={key:0,class:"text-sm text-gray-500 mt-2"},le={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},ne={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},re={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},ie={class:"flex items-center flex-wrap gap-3"},oe={class:"text-xs text-gray-700 mr-2"},de={key:0,class:"text-gray-500 text-xs"},ue={class:"flex justify-end items-center gap-2"},ce={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200"},ke={class:"mt-4"},ge={class:"flex items-center"},fe={key:0,class:"fas fa-caret-down text-gray-400 group-hover:text-sky-400"},he={key:1,class:"fas fa-caret-right text-gray-400 group-hover:text-sky-400"},xe=["href"],me={key:0,class:"flex gap-2 ml-auto items-center text-xs"},ve=["href"],be={class:"ml-0"},pe={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick"],setup(t,{emit:b}){const a=t,f=R(null),o=b;function h(r){o("addClick",r)}function d(r){o("editClick",r)}const l=R([]),c=localStorage.getItem("sub_task_opened_list");if(c)try{l.value=JSON.parse(c)}catch{l.value=[]}const u=w({get:()=>l.value.includes(a.task.id),set:r=>{const s=l.value.includes(a.task.id);r&&!s?l.value.push(a.task.id):!r&&s&&(l.value=l.value.filter(x=>x!==a.task.id))}});F(l,r=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(r))},{deep:!0});const v=w(()=>{var r,s,x,p;return{"hover:underline hover:text-sky-400 cursor-pointer":((s=(r=a.task)==null?void 0:r.children_tasks)==null?void 0:s.length)>0,"cursor-default pointer-none":((p=(x=a.task)==null?void 0:x.children_tasks)==null?void 0:p.length)===0}});function _(){a.task.children_tasks.length>0&&(u.value=!u.value)}return(r,s)=>{var p,L,E,A,N,P,$,D,O,M;const x=J("RouterLink");return n(),i("div",W,[t.treeLevel>0?(n(),i("div",X,s[3]||(s[3]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):m("",!0),e("div",{class:T(["flex-grow border rounded py-3 px-3",{"bg-green-50  ":((p=f.value)==null?void 0:p.completedPercentage)===100,"bg-gray-50 hover:bg-teal-50":((L=f.value)==null?void 0:L.completedPercentage)<100,"shadow-sm":t.treeLevel>0}])},[e("div",Y,[e("div",Z,[e("div",null,[e("div",ee,[t.showDraggableHandle?(n(),i("button",{key:0,onMousedown:s[0]||(s[0]=S((...k)=>r.handleDragging&&r.handleDragging(...k),["stop"])),class:"handle"},s[4]||(s[4]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):m("",!0),e("span",te," #"+g(t.task.id),1)]),e("div",se,[y(x,{to:{name:"TaskShow",params:{id:t.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:B(()=>[e("div",null,g(t.task.title),1)]),_:1},8,["to"])])]),(E=t.task)!=null&&E.requirement?(n(),i("p",ae," Requirement: "+g((N=(A=t.task)==null?void 0:A.requirement)==null?void 0:N.title),1)):m("",!0),e("div",le,[(P=t.task)!=null&&P.is_important?(n(),i("span",ne,"IMPORTANT")):m("",!0),($=t.task)!=null&&$.is_urgent?(n(),i("span",re,"URGENT")):m("",!0)])]),e("div",ie,[(n(!0),i(q,null,z(t.task.users,(k,j)=>(n(),i("div",{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",key:j},[y(U,{user:k,class:"w-6 h-6 !text-xs"},null,8,["user"]),e("span",oe,g(k.id)+" - "+g(k==null?void 0:k.name),1)]))),128)),t.task.users.length===0?(n(),i("div",de," Not Assigned To Anyone ")):m("",!0),y(x,{to:{name:"TaskUserAssign",params:{id:(D=t.task)==null?void 0:D.id}},title:"Assign user",class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},{default:B(()=>s[5]||(s[5]=[e("i",{class:"fas fa-user-plus"},null,-1)])),_:1},8,["to"])]),e("div",ue,[e("span",ce,g(t.task.status),1),y(Q,{task:t.task,ref_key:"progress",ref:f,class:"text-sm"},null,8,["task"])])]),e("div",ke,[e("div",ge,[e("div",{class:"flex gap-3 group items-center",onClick:_},[u.value?(n(),i("i",fe)):(n(),i("i",he)),e("span",{class:T([v.value,"text-xs text-gray-500"])},[C(" Sub Tasks ("+g((O=t.task.children_tasks)==null?void 0:O.length)+") ",1),e("a",{href:`/tasks/add?parent_id=${a.task.id}`,class:"hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border border-transparent ml-2",onClick:s[1]||(s[1]=S(k=>o("addClick",a.task.id),["stop","prevent"]))},s[6]||(s[6]=[e("i",{class:"fas fa-plus"},null,-1),C(" Add Sub Task ")]),8,xe)],2)]),t.hideButtons?m("",!0):(n(),i("div",me,[e("a",{href:`/tasks/edit/${t.task.id}`,onClick:s[2]||(s[2]=S(k=>o("editClick",t.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},s[7]||(s[7]=[e("i",{class:"fas fa-edit"},null,-1),C(" Edit ")]),8,ve),y(x,{to:{name:"TaskReports",params:{id:(M=t.task)==null?void 0:M.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:B(()=>s[8]||(s[8]=[e("i",{class:"far fa-file-alt"},null,-1),C(" Reports ")])),_:1},8,["to"])]))]),e("div",be,[u.value?(n(),V(K,{key:0,childrenTasks:t.task.children_tasks,"hide-buttons":t.hideButtons,"parent-tree-level":t.treeLevel,onEditClick:d,onAddClick:h},null,8,["childrenTasks","hide-buttons","parent-tree-level"])):m("",!0)])])],2)])}}};export{pe as _,Q as a};
