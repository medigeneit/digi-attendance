import{u as I,b as K,r as y,e as Q,x as S,m as W,c as n,o as r,a as t,q as C,h as p,v as f,k as q,g,p as T,t as F,F as z,n as J,E as B,w as m,y as G,j as X}from"./index-D2XudXqW.js";import{_ as Y}from"./EmployeeFilter-B01Hl13z.js";import{L as Z}from"./LoaderView-DR-ecsZZ.js";import{S as ee}from"./SelectedEmployeeCard-BO152fwi.js";import{u as te}from"./manual-attendance-QbOQurkk.js";import{u as le}from"./user-BpN-B6VT.js";import"./company-OF8UZBhv.js";import"./department-B5Sb__96.js";import"./SelectDropdown-D1VKLKcP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-CuT18WaH.js";const oe={class:"space-y-2 px-4"},se={class:"flex flex-wrap gap-2"},ae={key:0,class:"text-center py-4"},ne={key:1,class:"space-y-4"},re={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={class:"overflow-x-auto"},de={key:0,class:"text-red-500 text-sm text-left"},ue={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},pe={class:"bg-gray-200"},ce={class:"border border-gray-300 px-2 text-left py-2"},ye={class:"flex items-center justify-center gap-2"},me=["onClick"],ve={class:"border border-gray-300 px-2 cursor-pointer text-center"},_e=["onUpdate:modelValue"],be={class:"border border-gray-300 px-2"},fe=["onUpdate:modelValue"],ge={class:"border border-gray-300 px-2"},ke=["onUpdate:modelValue"],he={class:"border border-gray-300 px-2"},xe=["onUpdate:modelValue"],we={class:"border border-gray-300 px-2"},Ae=["onUpdate:modelValue"],Se={class:"border border-gray-300 px-2"},Ce=["onUpdate:modelValue","disabled"],Ue={key:0},Ve={key:1},Me={class:"space-y-6"},qe={key:0,class:"text-red-500 text-sm text-left"},Te={class:"flex items-center justify-center gap-2 cursor-pointer"},Fe={class:"flex justify-center"},Be=["disabled"],De={key:0},$e={key:1},ze={__name:"AdminManualAttendanceApplication",setup(Pe){const U=I(),b=K(),i=te(),D=le(),u=y(b.query.date||i.selectedMonth||new Date().toISOString().slice(0,7)),v=y([]),c=y(!1),d=y(null),x=y(!0),o=y({company_id:b.query.company_id||"",department_id:b.query.department_id||"",type:b.query.type||"all",employee_id:b.query.employee_id||""}),V=async()=>{const s={company_id:o.value.company_id,department_id:o.value.department_id,selectedMonth:u.value,selectedStatus:i.selectedStatus};if(o.value.employee_id){s.user_id=o.value.employee_id,c.value=!0;try{await i.fetchAdminManualAttendances(s)}finally{c.value=!1}}else typeof i.setAttendances=="function"?i.setAttendances([]):i.attendances=[]};function $(){const s={};return u.value&&(s.date=String(u.value)),o.value.company_id&&(s.company_id=String(o.value.company_id)),o.value.department_id&&(s.department_id=String(o.value.department_id)),o.value.employee_id&&(s.employee_id=String(o.value.employee_id)),o.value.type&&o.value.type!=="all"&&(s.type=String(o.value.type)),s}let w=null;function P(){w&&clearTimeout(w),w=setTimeout(()=>{U.replace({query:$()}).catch(()=>{})},120)}let A=null;const M=y("");async function j(){P();const s=JSON.stringify({m:u.value||"",c:o.value.company_id||"",d:o.value.department_id||"",t:o.value.type||"all",e:o.value.employee_id||""});s!==M.value&&(await V(),M.value=s)}function k(){A&&clearTimeout(A),A=setTimeout(j,200)}Q(async()=>{await D.fetchUsers(),k()});function E(){k()}function N(){U.go(-1)}S(u,()=>{k()}),S(()=>({...o.value,month:u.value}),()=>k(),{deep:!0});const O=W(()=>i.attendances||[]);S(()=>i.attendances,s=>{v.value=[],(s||[]).forEach(e=>{v.value.push({date:e==null?void 0:e.date,type:"Forget Punch",check_in:e==null?void 0:e.entry_time,check_out:e==null?void 0:e.exit_time,description:"",is_check:!1})})},{immediate:!0,deep:!0});function R(){const s=v.value.every(e=>e.is_check);v.value.forEach(e=>{e.is_check=!s})}async function L(){var s;if(c.value=!0,d.value=null,!o.value.employee_id){d.value="Please select an employee.",c.value=!1;return}try{const e=v.value.filter(l=>l.is_check&&(l.check_in||l.check_out));if(!e.length){d.value="Please select at least one row.";return}const h=e.map(l=>({user_id:o.value.employee_id,type:l.type,check_in:l.check_in?`${l.date} ${l.check_in}:00`:null,check_out:l.check_out?`${l.date} ${l.check_out}:00`:null,description:l.description||""})),_=await i.createBulkManualAttendance({records:h,direct_approve:x.value});(s=_==null?void 0:_.data)!=null&&s.length&&await V()}catch(e){d.value=(e==null?void 0:e.message)||"Failed to submit manual attendance requests."}finally{c.value=!1}}return(s,e)=>{var h,_;return r(),n("div",oe,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:N},e[13]||(e[13]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[14]||(e[14]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Admin Bulk Manual Attendance Applications",-1)),e[15]||(e[15]=t("div",null,null,-1))]),t("div",se,[C(Y,{company_id:o.value.company_id,"onUpdate:company_id":e[0]||(e[0]=l=>o.value.company_id=l),department_id:o.value.department_id,"onUpdate:department_id":e[1]||(e[1]=l=>o.value.department_id=l),employee_id:o.value.employee_id,"onUpdate:employee_id":e[2]||(e[2]=l=>o.value.employee_id=l),category:o.value.type,"onUpdate:category":e[3]||(e[3]=l=>o.value.type=l),"with-type":!0,"initial-value":s.$route.query,onFilterChange:E},null,8,["company_id","department_id","employee_id","category","initial-value"]),t("div",null,[p(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[4]||(e[4]=l=>u.value=l),class:"input-1"},null,512),[[f,u.value]])])]),q(i).loading?(r(),n("div",ae,[C(Z)])):(r(),n("div",ne,[(h=o.value)!=null&&h.employee_id?(r(),n("div",re,[C(ee,{user:q(i).user},null,8,["user"])])):g("",!0),t("div",ie,[t("div",{class:T(d.value?"py-2":"")},[d.value?(r(),n("div",de,F(d.value),1)):g("",!0)],2),t("table",ue,[t("thead",null,[t("tr",pe,[t("th",ce,[t("div",ye,[t("input",{id:"allCheck",type:"checkbox",onChange:R,class:"h-5 w-5 accent-blue-600 cursor-pointer"},null,32),e[16]||(e[16]=t("label",{for:"allCheck",class:"text-sm cursor-pointer"},"All Check",-1))])]),e[17]||(e[17]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Date",-1)),e[18]||(e[18]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Type",-1)),e[19]||(e[19]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Check-In",-1)),e[20]||(e[20]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Check-Out",-1)),e[21]||(e[21]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Description",-1))])]),t("tbody",null,[(r(!0),n(z,null,J(v.value,(l,H)=>(r(),n("tr",{key:H,class:T(["border-b border-gray-200 hover:bg-blue-200 cursor-pointer",l.is_check?"bg-yellow-100":""]),onClick:a=>l.is_check=!l.is_check},[t("td",ve,[p(t("input",{type:"checkbox","onUpdate:modelValue":a=>l.is_check=a,class:"h-5 w-5",onClick:e[5]||(e[5]=m(()=>{},["stop"]))},null,8,_e),[[B,l.is_check]])]),t("td",be,[p(t("input",{type:"date","onUpdate:modelValue":a=>l.date=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[6]||(e[6]=m(()=>{},["stop"])),disabled:""},null,8,fe),[[f,l.date]])]),t("td",ge,[p(t("select",{"onUpdate:modelValue":a=>l.type=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[7]||(e[7]=m(()=>{},["stop"]))},e[22]||(e[22]=[t("option",{value:""},"Select Type",-1),t("option",{value:"Home Office"},"Home Office",-1),t("option",{value:"Remote Work"},"Remote Work",-1),t("option",{value:"Forget Punch"},"Forget Punch",-1)]),8,ke),[[G,l.type]])]),t("td",he,[p(t("input",{type:"time","onUpdate:modelValue":a=>l.check_in=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[8]||(e[8]=m(()=>{},["stop"]))},null,8,xe),[[f,l.check_in]])]),t("td",we,[p(t("input",{type:"time","onUpdate:modelValue":a=>l.check_out=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[9]||(e[9]=m(()=>{},["stop"]))},null,8,Ae),[[f,l.check_out]])]),t("td",Se,[p(t("textarea",{"onUpdate:modelValue":a=>l.description=a,onKeyup:e[10]||(e[10]=m(()=>{},["stop"])),onClick:e[11]||(e[11]=m(()=>{},["stop"])),disabled:!l.check_in&&!l.check_out,class:"w-full border border-gray-600 py-1 px-2 rounded-sm disabled:bg-gray-300 disabled:cursor-not-allowed",cols:"1"},null,40,Ce),[[f,l.description]])])],10,me))),128)),O.value.length===0?(r(),n("tr",Ue,e[23]||(e[23]=[t("td",{colspan:"6",class:"p-2 text-center text-red-500"},"Please select any employee",-1)]))):g("",!0)])])]),(_=o.value)!=null&&_.employee_id?(r(),n("div",Ve,[t("div",Me,[d.value?(r(),n("div",qe,F(d.value),1)):g("",!0),t("div",Te,[p(t("input",{id:"directApprove",type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=l=>x.value=l),class:"accent-blue-600 h-6 w-6 cursor-pointer"},null,512),[[B,x.value]]),e[24]||(e[24]=t("label",{for:"directApprove",class:"text-lg cursor-pointer"},"Direct Approve",-1))]),t("div",Fe,[t("button",{type:"button",class:"btn-2",disabled:c.value,onClick:L},[c.value?(r(),n("span",De,e[25]||(e[25]=[t("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),X("Submitting...")]))):(r(),n("span",$e,"Submit All"))],8,Be)])])])):g("",!0)]))])}}};export{ze as default};
