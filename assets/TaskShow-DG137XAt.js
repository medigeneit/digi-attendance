import{c as d,o as r,a as e,E as j,t as T,F as h,x as F,l as g,r as I,D as G,m as E,f as _,p as x,w as V,b as z,u as K,y as U,e as H,A as J,k as D,h as n,n as v,q as C}from"./index-Rxn7ADR7.js";import{O as M}from"./OverlyModal-BpOuz2Mj.js";import{_ as Q}from"./TaskAddForm-Bc1KjtSX.js";import{_ as W}from"./TaskEditForm-CM2BfoN_.js";import{_ as X}from"./TaskTreeView-CysOFTu_.js";import{u as Y}from"./useTaskStore-CvSkHeqt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-6S87vlgk.js";import"./SectionLoading-XWd_VF6c.js";const Z={class:"mb-3"},tt={key:0,class:"text-center py-4 text-gray-500"},st={key:1,class:"text-center py-4 text-red-500"},et={key:2,class:"space-y-4"},at={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String}},emits:["commentButtonClick","editClick","addClick"],setup(k,{emit:s}){const l=s;return(y,u)=>(r(),d("div",null,[e("div",Z,[j(y.$slots,"task:header")]),k.loading?(r(),d("div",tt,"Loading tasks...")):k.error?(r(),d("div",st,T(k.error),1)):(r(),d("div",et,[(r(!0),d(h,null,F(k.tasks||[],o=>(r(),d("div",{key:o.id,class:"rounded-lg border bg-white overflow-hidden"},[g(X,{task:o,class:"!border-0",onCommentButtonClick:i=>l("commentButtonClick",o.id),onEditClick:u[0]||(u[0]=i=>l("editClick",i)),onAddClick:u[1]||(u[1]=i=>l("addClick",i))},null,8,["task","onCommentButtonClick"])]))),128))]))]))}},nt={class:"flex justify-between mt-5"},ot={class:"flex flex-wrap items-center gap-2 mt-3"},rt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0}},emits:["created","error"],setup(k,{emit:s}){const l=k,y=s,u=I(),o=G({show:!1,parentId:l.parentId,requirementId:null}),i=t=>{o.show=!0,o.parentId=t,console.log({addForm:o})};function f(){o.show=!1,o.parentId=l.parentId,y("created")}function m(){u.value=!1,y("updated")}function c(){o.show=!1,o.parentId=l.parentId}return(t,a)=>(r(),d("div",null,[u.value?(r(),E(M,{key:0},{default:x(()=>[g(W,{taskId:u.value,onClose:a[0]||(a[0]=b=>u.value=null),onUpdated:m},null,8,["taskId"])]),_:1})):_("",!0),o.show?(r(),E(M,{key:1},{default:x(()=>[g(Q,{parentTaskId:o.parentId,requirementId:o.requirementId,onTaskCreated:f,onError:t.handleTaskError,onClose:c},null,8,["parentTaskId","requirementId","onError"])]),_:1})):_("",!0),g(at,{tasks:k.subTasks,onAddClick:a[2]||(a[2]=b=>i(b)),onEditClick:a[3]||(a[3]=b=>u.value=b)},{"task:header":x(()=>[e("div",nt,[a[4]||(a[4]=e("div",{class:"flex justify-between items-center"},[e("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),e("div",ot,[e("button",{class:"btn-1 ml-auto",onClick:a[1]||(a[1]=V(()=>i(k.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks"])]))}},it=()=>{const k=I(),s=I(0);function l(i,f){k.value=i,s.value=f}function y(){const i=[],f=(m,c=0,t="")=>{m.forEach(a=>{i.push({...a,depth:c,idPath:t+a.id}),a.children_tasks&&a.children_tasks.length&&f(a.children_tasks,c+1,t+a.id+"-")})};return f(o()),i}function u(i,f=0){return Array.isArray(i)===!1||i.length===0?[]:i.filter(m=>m.parent_id===f).map(m=>({...m,children_tasks:u(i,m.id)}))}function o(){return u(k.value,s.value)}return{getTaskListTree:o,getFlattenedTasks:y,setTaskList:l}},lt={class:"container mx-auto p-6"},dt={class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6"},ut={class:"grid grid-cols-4"},pt={class:"py-2 font-medium col-span-full text-xl"},kt={class:"py-2 font-medium mb-4 col-span-full md:col-span-2"},mt={class:"flex gap-2 flex-wrap"},ct={class:"py-2 col-span-full md:col-span-1"},ft={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},gt={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},yt={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},xt={class:"py-4 text-right col-span-full md:col-span-1"},bt={class:"py-2 flex justify-center items-center gap-2 col-span-full"},vt={class:"ml-auto flex gap-4"},Tt={key:0},_t={key:1},wt={key:1,class:"text-center py-4 text-gray-500"},Ct={key:2,class:"text-center py-4 text-red-500"},Nt={__name:"TaskShow",setup(k){const s=Y(),l=z(),y=K(),u=it(),o=U(()=>u.getTaskListTree());H(async()=>{});const i=c=>{y.push({name:"TaskEdit",params:{id:c}})},f=U(()=>{var c,t;return s.task.parent_id==0?{name:"TaskList",params:{id:(c=s.task)==null?void 0:c.id}}:{name:"TaskShow",params:{id:(t=s.task)==null?void 0:t.parent_id}}});async function m(c){const t=await s.fetchTask(c);u.setTaskList(t.sub_tasks,s.task.id)}return J(()=>l.params.id,m,{initial:!0,immediate:!0}),(c,t)=>{var $,L,S,A,R,B,N,P,q,O;const a=D("RouterLink"),b=D("router-view");return r(),d("div",lt,[e("div",dt,[n(s).task?(r(),d(h,{key:0},[e("section",ut,[e("div",pt,T(n(s).task.title),1),e("div",kt,[t[9]||(t[9]=e("div",{class:"text-xs mb-0.5 text-gray-600 uppercase"},"Assigns",-1)),e("div",mt,[(r(!0),d(h,null,F(n(s).task.users,p=>(r(),d("span",{onClick:t[0]||(t[0]=w=>w.stopPropagation()),key:p.id,class:"btn-1 !inline-flex flex-shrink-0"},[t[8]||(t[8]=e("i",{class:"fad fa-user"},null,-1)),v(" "+T(p==null?void 0:p.name),1)]))),128))])]),e("div",ct,[e("div",ft,[($=n(s).task)!=null&&$.is_important?(r(),d("span",gt,"IMPORTANT")):_("",!0),(L=n(s).task)!=null&&L.is_urgent?(r(),d("span",yt,"URGENT")):_("",!0)])]),e("div",xt,[e("span",{class:C([{"bg-gray-200":((S=n(s).task)==null?void 0:S.status)==="PENDING","bg-blue-200":((A=n(s).task)==null?void 0:A.status)==="IN_PROGRESS","bg-green-200":((R=n(s).task)==null?void 0:R.status)==="COMPLETED","bg-red-200":((B=n(s).task)==null?void 0:B.status)==="BLOCKED"},"px-3 py-0.5 rounded-full"])},T((N=n(s).task)==null?void 0:N.status),3)]),t[14]||(t[14]=e("hr",{class:"my-3 col-span-full"},null,-1)),e("div",bt,[e("button",{onClick:t[1]||(t[1]=V(p=>{var w;return i((w=n(s).task)==null?void 0:w.id)},["stop"])),class:"btn-2"},"Edit"),g(a,{to:{name:"TaskUserAssign",params:{id:(P=n(s).task)==null?void 0:P.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[2]||(t[2]=p=>p.stopPropagation())},{default:x(()=>t[10]||(t[10]=[e("i",{class:"fas fa-user-plus"},null,-1),v(" Assign Users ")])),_:1},8,["to"]),g(a,{to:f.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[3]||(t[3]=p=>p.stopPropagation())},{default:x(()=>t[11]||(t[11]=[e("i",{class:"fas fa-arrow-left"},null,-1),v(" Back ")])),_:1},8,["to"]),e("div",vt,[o.value.length>0?(r(),E(a,{key:0,to:{name:"TaskShow",params:{id:(q=n(s).task)==null?void 0:q.id}},onClick:t[4]||(t[4]=p=>p.stopPropagation()),class:C(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":n(l).name=="TaskShow"}])},{default:x(()=>t[12]||(t[12]=[e("i",{class:"fal fa-list-ul"},null,-1),v(" Sub Tasks ")])),_:1},8,["to","class"])):_("",!0),g(a,{to:{name:"TaskReports",params:{id:(O=n(s).task)==null?void 0:O.id}},onClick:t[5]||(t[5]=p=>p.stopPropagation()),class:C(["py-1 btn-3",{"bg-blue-500 text-white":n(l).name=="TaskReports"}])},{default:x(()=>t[13]||(t[13]=[e("i",{class:"fal fa-file-alt"},null,-1),v(" Reports ")])),_:1},8,["to","class"])])])]),n(l).name=="TaskShow"?(r(),d("section",Tt,[g(rt,{subTasks:o.value,"parent-id":n(l).params.id,onCreated:t[6]||(t[6]=p=>m(n(l).params.id)),onUpdated:t[7]||(t[7]=p=>m(n(l).params.id))},null,8,["subTasks","parent-id"])])):(r(),d("section",_t,[g(b)]))],64)):n(s).loading?(r(),d("div",wt," Loading task details... ")):(r(),d("div",Ct,T(n(s).error),1))])])}}};export{Nt as default};
