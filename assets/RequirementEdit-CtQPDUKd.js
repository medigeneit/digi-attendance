import{r as g,e as B,A as E,x as M,c as f,o as u,a,f as D,g as k,w as C,F as T,n as _,k as b,t as V,i as I,j as F,q as U,b as j,u as L}from"./index-BH851uCa.js";import{_ as q}from"./CompanyDepartmentSelectInput-DbuInkfO.js";import{R as N}from"./RequiredIcon-CS6zbmMj.js";import{f as R,u as O}from"./requirement-tVXfPYia.js";import{u as W}from"./company-CZRt-PMq.js";import{u as G}from"./tags-C7_yYnoZ.js";import{L as H}from"./LoaderView-ByyjOWlC.js";import{S as J}from"./SelectDropdown-CgXaD685.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"sticky top-0 pt-4 bg-white z-10"},P={class:"mb-4"},Q={key:0,class:"mb-4"},X={class:"block text-gray-600 text-sm mb1 font-medium"},Y={class:"block text-gray-600 text-sm mb-1 font-medium"},Z={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},h={class:"flex items-center justify-between gap-4"},ee=["disabled"],te={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(S,{emit:x}){const c=S,v=x,l=G(),i=W(),s=g(""),w=g(),y=g(""),$=g(),n=g({from_department_id:"",to_department_id:"",website_tags:[]});B(async()=>{var t;s.value="loading",l.fetchTags("website"),await i.fetchCompanies({with:"departments",ignore_permission:!0}),await i.fetchMyCompanies({with:"departments"}),w.value=(t=(await R(c.requirementId)).data)==null?void 0:t.requirement,s.value=""}),E(w,function(t){var e;t&&(n.value.from_department_id=t.from_department_id,n.value.to_department_id=t.to_department_id,Array.isArray(t==null?void 0:t.website_tags)&&((e=t.website_tags)==null?void 0:e.length)>0&&(n.value.website_tags=t.website_tags.map(r=>r.name)))});async function z(){var e,r,p,m;s.value="submitting";const t={...n.value};console.log({payload:t});try{const o=await O(c.requirementId,t);v("update",o),s.value="created",y.value=(e=o==null?void 0:o.data)==null?void 0:e.message}catch(o){v("error",(r=o==null?void 0:o.response)==null?void 0:r.data),y.value=(m=(p=o==null?void 0:o.response)==null?void 0:p.data)==null?void 0:m.message,s.value="error"}}const A=M(()=>{var t,e;for(let r in i.myCompanies)if((((e=(t=i==null?void 0:i.myCompanies)==null?void 0:t[r])==null?void 0:e.departments)||[]).some(m=>m.id==n.value.from_department_id))return!0;return!1});return(t,e)=>{var r,p,m,o;return u(),f("div",{ref_key:"containerRef",ref:$,class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[a("div",K,[e[5]||(e[5]=a("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[6]||(e[6]=a("hr",{class:"mb-4"},null,-1)),a("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=C(d=>v("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),a("form",{onSubmit:C(z,["prevent"]),class:"z-0"},[s.value!=="loading"&&s.value!=="submitting"?(u(),f(T,{key:0},[a("div",P,[e[7]||(e[7]=a("label",{class:"text-gray-800"},"Websites",-1)),_(J,{options:b(l).tags,modelValue:n.value.website_tags,"onUpdate:modelValue":e[1]||(e[1]=d=>n.value.website_tags=d),taggable:"",label:"name",value:"name",class:"py-2"},null,8,["options","modelValue"])]),A.value?(u(),D(q,{key:1,modelValue:n.value.from_department_id,"onUpdate:modelValue":e[2]||(e[2]=d=>n.value.from_department_id=d),companies:((m=b(i))==null?void 0:m.myCompanies)||[],class:"mb-4"},{label:I(()=>[a("label",X,[e[9]||(e[9]=F(" From Department ")),_(N)])]),_:1},8,["modelValue","companies"])):(u(),f("div",Q,[e[8]||(e[8]=a("label",{class:"block text-gray-600 text-sm mb1 font-medium"}," From Department ",-1)),a("div",null,V((p=(r=w.value)==null?void 0:r.from_department)==null?void 0:p.name),1)])),_(q,{modelValue:n.value.to_department_id,"onUpdate:modelValue":e[3]||(e[3]=d=>n.value.to_department_id=d),companies:((o=b(i))==null?void 0:o.companies)||[],class:"mb-4"},{label:I(()=>[a("label",Y,[e[10]||(e[10]=F(" To Department ")),_(N)])]),_:1},8,["modelValue","companies"])],64)):k("",!0),a("div",Z,[y.value?(u(),f("div",{key:0,class:U(["mb-4 font-medium text-center",{"text-red-500":s.value=="error","text-green-500":s.value=="created"}])},V(y.value),3)):k("",!0),a("div",h,[a("button",{type:"button",onClick:e[4]||(e[4]=C(d=>v("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),a("button",{disabled:s.value=="loading"||s.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},V(s.value=="submitting"?"Saving...":"Save"),9,ee)])])],32),s.value==="loading"||s.value==="submitting"?(u(),D(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):k("",!0)],512)}}},ae={class:"container mx-auto p-6"},pe={__name:"RequirementEdit",setup(S){const x=j(),c=L();return(v,l)=>(u(),f("div",ae,[_(te,{requirementId:b(x).params.id,onUpdate:l[0]||(l[0]=()=>b(c).back()),onCancelClick:l[1]||(l[1]=()=>b(c).back())},null,8,["requirementId"])]))}};export{pe as default};
