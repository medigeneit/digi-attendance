import{u as T,r as p,h as j,x as y,c as o,o as a,a as e,n as w,b as v,l as h,v as B,H as k,F as A,e as S,t as i,k as _,s as K,w as m}from"./index-CnILmDJV.js";import{u as P}from"./kpiCycleAdmin-_aHBudR0.js";const z={class:"max-w-6xl mx-auto px-4 py-6 space-y-5"},R={class:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between"},U={class:"flex items-center gap-2"},E={class:"rounded-2xl border border-slate-200 bg-white shadow-sm"},F={class:"p-3 sm:p-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Y={class:"flex flex-col sm:flex-row gap-2 sm:items-center w-full"},q={class:"relative w-full sm:w-80"},H=["value"],O={class:"text-xs text-slate-500"},G={class:"font-semibold text-slate-700"},J={class:"border-t border-slate-200"},Q={class:"min-w-full text-sm"},W={class:"divide-y divide-slate-100"},X={class:"px-4 py-3"},Z={class:"flex items-start gap-3"},ee={class:"mt-0.5 h-9 w-9 rounded-xl bg-indigo-50 text-indigo-600 flex items-center justify-center font-bold"},te={class:"min-w-0"},se={class:"font-semibold text-slate-900 truncate"},le={class:"text-xs text-slate-500"},oe={key:0},ae={class:"px-4 py-3 text-center text-slate-700"},ie={class:"px-4 py-3 text-center"},ne={class:"px-4 py-3 text-right"},re={class:"flex items-center justify-end gap-2"},de=["onClick"],ue=["onClick"],ce={class:"relative"},xe=["onClick"],pe=["onClick"],ve=["onClick"],me=["onClick"],fe={key:0},be={colspan:"4",class:"px-4 py-12 text-center"},ge={class:"mx-auto max-w-sm"},_e={__name:"CycleSetupPage",setup(ye){const n=P(),f=T(),b=p(""),d=p("all"),u=p("all"),c=p(null);j(()=>n.fetchAll());const C=y(()=>(n.list||[]).map(l=>{const t=typeof l.is_active=="boolean"?l.is_active:l.status==="active",s=t?"Active":l.status??"Inactive";return{...l,isActive:t,statusText:s}})),N=y(()=>{const l=new Set(C.value.map(t=>t.year).filter(Boolean));return Array.from(l).sort((t,s)=>Number(s)-Number(t))}),g=y(()=>{let l=C.value;const t=b.value.trim().toLowerCase();return t&&(l=l.filter(s=>String(s.title||"").toLowerCase().includes(t)||String(s.year||"").toLowerCase().includes(t))),d.value!=="all"&&(l=l.filter(s=>d.value==="active"?s.isActive:d.value==="inactive"?!s.isActive:(s.status??"").toLowerCase()===d.value)),u.value!=="all"&&(l=l.filter(s=>String(s.year)===String(u.value))),l.slice().sort((s,r)=>Number(r.id)-Number(s.id))});function I(l){return l.isActive?"bg-emerald-50 text-emerald-700 ring-emerald-200":(l.status||"").toLowerCase()==="draft"?"bg-amber-50 text-amber-700 ring-amber-200":"bg-slate-50 text-slate-700 ring-slate-200"}async function M(l){await n.activate(l.id)}async function $(l){n.deactivate&&await n.deactivate(l.id)}async function D(l){const t=Number(l.year)+1;await n.clone(l.id,t)}async function L(l){confirm("Delete this cycle? (Only if no reviews)")&&await n.remove(l.id)}function V(l){c.value=c.value===l?null:l}function x(){c.value=null}return(l,t)=>(a(),o("div",z,[e("div",R,[t[7]||(t[7]=e("div",null,[e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-indigo-500"},"KPI"),e("h1",{class:"mt-1 text-2xl font-semibold text-slate-900"},"KPI Cycles"),e("p",{class:"mt-1 text-sm text-slate-500"},"Create, activate, and manage review cycles.")],-1)),e("div",U,[e("button",{class:"inline-flex items-center gap-2 rounded-xl bg-slate-900 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-slate-800",onClick:t[0]||(t[0]=s=>w(f).push({name:"kpi-cycle-new"}))},t[6]||(t[6]=[e("span",{class:"text-lg leading-none"},"+",-1),v(" New Cycle ")]))])]),e("div",E,[e("div",F,[e("div",Y,[e("div",q,[t[8]||(t[8]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"},"⌕",-1)),h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value=s),type:"text",placeholder:"Search by title or year...",class:"w-full rounded-xl border border-slate-200 bg-white pl-9 pr-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/30"},null,512),[[B,b.value]])]),h(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>d.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500/30"},t[9]||(t[9]=[e("option",{value:"all"},"All status",-1),e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1),e("option",{value:"draft"},"Draft",-1)]),512),[[k,d.value]]),h(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>u.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500/30"},[t[10]||(t[10]=e("option",{value:"all"},"All years",-1)),(a(!0),o(A,null,S(N.value,s=>(a(),o("option",{key:s,value:s},i(s),9,H))),128))],512),[[k,u.value]])]),e("div",O,[t[11]||(t[11]=v(" Showing ")),e("span",G,i(g.value.length),1),t[12]||(t[12]=v(" cycles "))])]),e("div",J,[e("table",Q,[t[16]||(t[16]=e("thead",{class:"bg-slate-50 text-xs uppercase tracking-wide text-slate-500"},[e("tr",null,[e("th",{class:"text-left px-4 py-3 w-24"},"Cycle"),e("th",{class:"text-center px-4 py-3 w-24"},"Year"),e("th",{class:"text-center px-4 py-3 w-28"},"Status"),e("th",{class:"text-right px-4 py-3 w-44"},"Action")])],-1)),e("tbody",W,[(a(!0),o(A,null,S(g.value,s=>(a(),o("tr",{key:s.id,class:"hover:bg-slate-50/60",onClick:x},[e("td",X,[e("div",Z,[e("div",ee,i(String(s.year||"").slice(-2)||"•"),1),e("div",te,[e("div",se,i(s.title),1),e("div",le,[v(" ID: "+i(s.id)+" ",1),s.created_at?(a(),o("span",oe," • Created: "+i(String(s.created_at).slice(0,10)),1)):_("",!0)])])])]),e("td",ae,i(s.year),1),e("td",ie,[e("span",{class:K(["inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold ring-1 ring-inset",I(s)])},i(s.isActive?"Active":s.statusText||"Inactive"),3)]),e("td",ne,[e("div",re,[s.isActive?(a(),o("button",{key:0,class:"rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold hover:bg-slate-50",onClick:m(r=>$(s),["stop"])}," Deactivate ",8,de)):(a(),o("button",{key:1,class:"rounded-xl bg-emerald-600 px-3 py-2 text-xs font-semibold text-white shadow-sm hover:bg-emerald-500",onClick:m(r=>M(s),["stop"])}," Activate ",8,ue)),e("div",ce,[e("button",{class:"rounded-xl border border-slate-200 px-3 py-2 text-xs font-semibold hover:bg-slate-50",onClick:m(r=>V(s.id),["stop"])}," More ▾ ",8,xe),c.value===s.id?(a(),o("div",{key:0,class:"absolute right-0 mt-2 w-44 rounded-2xl border border-slate-200 bg-white shadow-lg overflow-hidden z-10",onClick:t[4]||(t[4]=m(()=>{},["stop"]))},[e("button",{class:"w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:r=>{w(f).push({name:"kpi-cycle-edit",params:{id:s.id}}),x()}}," Edit ",8,pe),e("button",{class:"w-full text-left px-3 py-2 text-sm hover:bg-slate-50",onClick:r=>{D(s),x()}}," Clone to next year ",8,ve),t[13]||(t[13]=e("div",{class:"h-px bg-slate-100"},null,-1)),e("button",{class:"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50",onClick:r=>{L(s),x()}}," Delete ",8,me)])):_("",!0)])])])]))),128)),g.value.length?_("",!0):(a(),o("tr",fe,[e("td",be,[e("div",ge,[t[14]||(t[14]=e("div",{class:"text-slate-900 font-semibold"},"No cycles found",-1)),t[15]||(t[15]=e("p",{class:"mt-1 text-sm text-slate-500"}," Try clearing filters or create a new KPI cycle to get started. ",-1)),e("button",{class:"mt-4 rounded-xl bg-slate-900 px-4 py-2.5 text-sm font-semibold text-white hover:bg-slate-800",onClick:t[5]||(t[5]=s=>w(f).push({name:"kpi-cycle-new"}))}," Create first cycle ")])])]))])])])])]))}};export{_e as default};
