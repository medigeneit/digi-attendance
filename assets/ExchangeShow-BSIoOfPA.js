import{u as Ie,i as Ge,r as x,p as Je,b as Ke,c as r,a as t,k as n,j as Oe,t as l,h as _,e as u,y as Qe,l as Xe,d as Ye,v as Ze,F as et,f as tt,o,g as st}from"./index-B_S1VLCL.js";import{L as lt}from"./LoaderView-CiLW5dR2.js";import{_ as at}from"./ShareComponent-Q5GxPkOM.js";import{u as nt}from"./exchange-B0Pq2_67.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ot={class:"my-container max-w-3xl space-y-6"},rt={class:"flex items-center justify-between gap-2 print:hidden"},ut={key:1,class:"card-bg p-4 md:p-8"},dt={class:"grid md:grid-cols-2"},it={class:"grid md:grid-cols-2 gap-4 pt-10"},pt={class:"font-medium"},vt={class:"text-sm"},ct={key:0,class:"print:hidden"},mt={class:"text-xs"},gt={class:"flex gap-2"},bt={class:"font-bold"},ft={key:0,class:"text-green-600 print:text-black"},xt={key:1,class:"pl-2 text-yellow-700"},_t={class:"title-md"},yt={key:0},ht={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},kt={class:"pt-10"},wt={key:0,class:"print:hidden"},At={class:""},jt={class:"text-xs text-blue-600"},Ct={class:"flex gap-4"},Rt={class:"font-bold"},Et={key:0,class:"text-green-600"},Nt={class:"pt-10"},Ft={key:0,class:"print:hidden"},Bt={class:""},St={class:"text-xs text-blue-600"},$t={class:"flex gap-4"},Dt={class:"font-bold"},Vt={key:0,class:"text-green-600"},qt={class:"flex flex-col pt-10"},Mt={key:0,class:"print:hidden"},Tt={class:""},Ut={class:"text-xs text-blue-600"},Wt={class:"flex gap-4"},Lt={class:"font-bold"},Ht={key:0,class:"text-green-600"},Pt={key:0,class:"mb-2"},zt=["href"],It={key:1,class:"text-sm text-gray-600 mt-1"},Gt={key:0,class:"modal-bg"},Jt={class:"modal-card"},Kt={class:"flex justify-end gap-2 mt-4"},ts={__name:"ExchangeShow",setup(Ot){const Ue=st(),v=tt(),d=nt(),m=Ie(),We=Ge(),k=x(!0),g=x(!1),b=x(""),y=x(null),s=Je(()=>d.exchange);Ke(async()=>{const{id:a}=v.params;try{await d.fetchExchange(a)}catch(e){console.error("Failed to fetch exchange details:",e)}finally{k.value=!1}});const Le=async()=>{try{await d.rejectExchange(v.params.id,b.value),g.value=!1,b.value="",await d.fetchExchange(v.params.id)}catch(a){console.error("Failed to reject exchange request:",a),alert("Failed to reject exchange request.")}},h=()=>{g.value=!0},f=async a=>{try{const{id:e}=v.params;a==="handover"&&await d.handoverAccept(e),a==="inCharge"&&await d.inChargeAccept(e),a==="recommend"&&await d.recommendByAccept(e),a==="approve"&&await d.approvedByAccept(e),alert(`${a} accepted successfully!`),await d.fetchExchange(e)}catch(e){console.error(`Failed to accept ${a}:`,e),alert(`Failed to accept ${a}.`)}},He=async a=>{const e=a.target.files[0];if(e){const c=new FormData;c.append("file",e);const p=await d.fetchFileUpload(c);y.value=p==null?void 0:p.url,We.success("Attachment upload successfully")}},Pe=async()=>{try{const a={attachment:y.value};await d.uploadAttachmentExchange(v.params.id,a),alert("Short leave rejected successfully!")}catch(a){console.error("Failed to reject short leave:",a),alert("Failed to reject short leave.")}},ze=()=>Ue.go(-1);return(a,e)=>{var c,p,w,A,j,C,R,E,N,F,B,S,$,D,V,q,M,T,U,W,L,H,P,z,I,G,J,K,O,Q,X,Y,Z,ee,te,se,le,ae,ne,oe,re,ue,de,ie,pe,ve,ce,me,ge,be,fe,xe,_e,ye,he,ke,we,Ae,je,Ce,Re,Ee,Ne,Fe,Be,Se,$e,De,Ve,qe,Me,Te;return o(),r(et,null,[t("div",ot,[t("div",rt,[t("button",{class:"btn-3",onClick:ze},e[7]||(e[7]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[9]||(e[9]=t("h1",{class:"title-lg text-center"},"Exchange Details",-1)),t("div",null,[t("button",{class:"btn-2",onClick:e[0]||(e[0]=(...i)=>a.print&&a.print(...i))},e[8]||(e[8]=[t("i",{class:"far fa-print"},null,-1),n(" Print ")]))])]),k.value?(o(),Oe(lt,{key:0})):(o(),r("div",ut,[e[38]||(e[38]=t("h2",{class:"title-md"},"Exchange Request",-1)),t("div",dt,[t("div",null,[e[10]||(e[10]=t("b",null,"Type:",-1)),n(" "+l((c=s.value)==null?void 0:c.exchange_type),1)]),t("div",null,[e[11]||(e[11]=t("b",null,"Current Date:",-1)),n(" "+l((p=s.value)==null?void 0:p.current_date),1)]),t("div",null,[e[12]||(e[12]=t("b",null,"Exchange Date:",-1)),n(" "+l((w=s.value)==null?void 0:w.exchange_date),1)]),t("div",null,[e[13]||(e[13]=t("b",null,"Status:",-1)),n(" "+l(((A=s.value)==null?void 0:A.status)||"N/A"),1)]),t("div",null,[e[14]||(e[14]=t("b",null,"Works in Hand:",-1)),n(" "+l(((j=s.value)==null?void 0:j.works_in_hand)||"N/A"),1)])]),t("div",it,[t("div",null,[e[15]||(e[15]=t("hr",{class:"w-44 border-black"},null,-1)),e[16]||(e[16]=t("div",null,[t("b",null,"Applicant")],-1)),t("p",pt,l((R=(C=s.value)==null?void 0:C.user)==null?void 0:R.name),1),t("div",vt,[t("p",null,l((F=(N=(E=s.value)==null?void 0:E.user)==null?void 0:N.department)==null?void 0:F.name),1),t("p",null,l(($=(S=(B=s.value)==null?void 0:B.user)==null?void 0:S.designation)==null?void 0:$.title),1)])]),t("div",null,[t("p",null,l(((V=(D=s.value)==null?void 0:D.handover_user)==null?void 0:V.name)||"Not assigned"),1),!((q=s.value)!=null&&q.status)&&s.value.handover_user_id===_(m).user.id?(o(),r("div",ct,[t("p",mt,[n(l((T=(M=s.value)==null?void 0:M.user)==null?void 0:T.name)+" has assigned you for his handover.",1),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=n(" Do you agree? "))]),t("div",gt,[t("button",{class:"font-bold text-lg text-green-600 px-2",onClick:e[1]||(e[1]=i=>f("handover"))}," ✔ "),e[19]||(e[19]=t("button",{class:"px-2"},"❌",-1))])])):u("",!0),e[22]||(e[22]=t("hr",{class:"w-44 border-black"},null,-1)),t("h4",bt,[e[21]||(e[21]=n(" Handover ")),(U=s.value)!=null&&U.handover_user_id&&((W=s.value)!=null&&W.status)?(o(),r("span",ft," (✔) ")):u("",!0),(L=s.value)!=null&&L.handover_user_id&&!((H=s.value)!=null&&H.status)?(o(),r("span",xt,e[20]||(e[20]=[t("i",{class:"fad fa-spinner"},null,-1)]))):u("",!0)])])]),e[39]||(e[39]=t("hr",null,null,-1)),t("div",null,[t("h3",_t,[e[23]||(e[23]=n(" Approvals ")),t("span",{class:Qe({"text-yellow-500":((P=s.value)==null?void 0:P.status)==="Pending","text-green-500":((z=s.value)==null?void 0:z.status)==="Approved","text-red-500":((I=s.value)==null?void 0:I.status)==="Rejected"})}," ("+l(((G=s.value)==null?void 0:G.status)||"N/A")+") ",3)]),((J=s.value)==null?void 0:J.status)==="Rejected"?(o(),r("div",yt,[t("div",null,[e[24]||(e[24]=t("b",null,"Rejected By:",-1)),n(" "+l(((O=(K=s.value)==null?void 0:K.rejected_by_user)==null?void 0:O.name)||"N/A"),1)]),t("div",null,[e[25]||(e[25]=t("b",null,"Rejection Reason:",-1)),n(" "+l(((Q=s.value)==null?void 0:Q.rejection_reason)||"N/A"),1)])])):u("",!0)]),t("div",ht,[t("div",kt,[s.value.status!=="Rejected"&&s.value.status!=="Approved"&&!((X=s.value)!=null&&X.in_charge_user_id)&&((ee=(Z=(Y=s.value)==null?void 0:Y.user)==null?void 0:Z.other_approval)==null?void 0:ee.in_charge_user_id)===_(m).user.id?(o(),r("div",wt,[t("p",At,l(((ae=(le=(se=(te=s.value)==null?void 0:te.user)==null?void 0:se.other_approval)==null?void 0:le.in_charge_user)==null?void 0:ae.name)||"N/A"),1),t("p",jt,[n(l((oe=(ne=s.value)==null?void 0:ne.user)==null?void 0:oe.name)+" has submitted an application. ",1),e[26]||(e[26]=t("br",null,null,-1)),e[27]||(e[27]=n(" Will you forward it? "))]),t("div",Ct,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[2]||(e[2]=i=>f("inCharge"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):u("",!0),t("p",null,l(((ue=(re=s.value)==null?void 0:re.in_charge_user)==null?void 0:ue.name)||""),1),e[29]||(e[29]=t("hr",{class:"w-44 border-black"},null,-1)),t("p",Rt,[e[28]||(e[28]=n(" In-Charge ")),(de=s.value)!=null&&de.in_charge_user_id?(o(),r("span",Et,"(✔)")):u("",!0)])]),t("div",Nt,[s.value.status!=="Rejected"&&s.value.status!=="Approved"&&!((ie=s.value)!=null&&ie.recommend_by_user_id)&&((ce=(ve=(pe=s.value)==null?void 0:pe.user)==null?void 0:ve.other_approval)==null?void 0:ce.recommend_by_user_id)===_(m).user.id?(o(),r("div",Ft,[t("p",Bt,l(((fe=(be=(ge=(me=s.value)==null?void 0:me.user)==null?void 0:ge.other_approval)==null?void 0:be.recommend_by_user)==null?void 0:fe.name)||"N/A"),1),t("p",St,[n(l((_e=(xe=s.value)==null?void 0:xe.user)==null?void 0:_e.name)+" has submitted an application.",1),e[30]||(e[30]=t("br",null,null,-1)),e[31]||(e[31]=n(" Will you recommend it? "))]),t("div",$t,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[3]||(e[3]=i=>f("recommend"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):u("",!0),t("p",null,l(((he=(ye=s.value)==null?void 0:ye.recommend_by_user)==null?void 0:he.name)||""),1),e[33]||(e[33]=t("hr",{class:"w-44 border-black"},null,-1)),t("p",Dt,[e[32]||(e[32]=n(" Recommend By ")),(ke=s.value)!=null&&ke.recommend_by_user_id?(o(),r("span",Vt,"(✔)")):u("",!0)])])]),t("div",qt,[s.value.status!=="Rejected"&&s.value.status!=="Approved"&&!((we=s.value)!=null&&we.approved_by_user_id)&&((Ce=(je=(Ae=s.value)==null?void 0:Ae.user)==null?void 0:je.other_approval)==null?void 0:Ce.approved_by_user_id)===_(m).user.id?(o(),r("div",Mt,[t("p",Tt,l(((Fe=(Ne=(Ee=(Re=s.value)==null?void 0:Re.user)==null?void 0:Ee.other_approval)==null?void 0:Ne.approved_by_user)==null?void 0:Fe.name)||"N/A"),1),t("p",Ut,[n(l((Se=(Be=s.value)==null?void 0:Be.user)==null?void 0:Se.name)+" has submitted an application.",1),e[34]||(e[34]=t("br",null,null,-1)),e[35]||(e[35]=n(" Will you accept it? "))]),t("div",Wt,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[4]||(e[4]=i=>f("approve"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):u("",!0),t("p",null,l(((De=($e=s.value)==null?void 0:$e.approved_by_user)==null?void 0:De.name)||""),1),e[37]||(e[37]=t("hr",{class:"w-44 border-black"},null,-1)),t("p",Lt,[e[36]||(e[36]=n(" Approved By ")),(Ve=s.value)!=null&&Ve.approved_by_user_id?(o(),r("span",Ht,"(✔)")):u("",!0)])])])),t("div",null,[t("div",null,[e[40]||(e[40]=t("label",null,"Attachment",-1)),(qe=s.value)!=null&&qe.attachment&&typeof((Me=s.value)==null?void 0:Me.attachment)=="string"?(o(),r("div",Pt,[t("a",{href:(Te=s.value)==null?void 0:Te.attachment,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,zt)])):u("",!0),t("input",{type:"file",onChange:He,class:"w-full p-2 border rounded"},null,32),a.fileName?(o(),r("p",It,"Selected File: "+l(a.fileName),1)):u("",!0)]),y.value?(o(),r("button",{key:0,type:"button",class:"btn-2",onClick:Pe}," Upload Attachment ")):u("",!0)]),Xe(at)]),g.value?(o(),r("div",Gt,[t("div",Jt,[e[41]||(e[41]=t("h3",{class:"title-lg"},"Reject Exchange Request",-1)),Ye(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=i=>b.value=i),rows:"4",placeholder:"Enter rejection reason...",class:"w-full border rounded-lg p-2 text-gray-700"},null,512),[[Ze,b.value]]),t("div",Kt,[t("button",{class:"btn-3",onClick:e[6]||(e[6]=i=>g.value=!1)},"Cancel"),t("button",{class:"btn-2 bg-red-500 text-white",onClick:Le},"Confirm")])])])):u("",!0)],64)}}};export{ts as default};
