import{u as K,b as M,s as b,r as f,A as L,e as Q,c as u,o as p,a as t,j as s,n as T,h as W,v as $,k as h,g as G,F as H,y as J,t as o,q as w}from"./index-BPxZlJG7.js";import{_ as I}from"./EmployeeFilter-CUfFbeA-.js";import{L as X}from"./LoaderView-BwtfiCYw.js";import{u as Y}from"./attendance-xkbsfV4Q.js";import{u as Z}from"./company-CE9SJoWr.js";import{u as ee}from"./department-B_o_uD3A.js";import{S as te}from"./sweetalert2.esm.all-DGhwgajj.js";import"./EmployeeDropdownInput-WLfzEYT1.js";import"./SelectDropdown-bBc0D5Lc.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-Dgw3j-FJ.js";const ae={class:"space-y-4 px-4"},le={class:"rounded-xl border border-zinc-200 bg-white shadow-sm"},ne={class:"flex flex-wrap gap-3 p-4"},ie={key:0,class:"py-10 text-center"},se={key:1,class:"overflow-hidden rounded-xl border border-zinc-200 bg-white shadow-sm"},oe={class:"overflow-x-auto"},de={class:"min-w-full text-sm"},ue={class:"px-3 py-2 align-top"},pe={class:"px-3 py-2 align-top"},ce={class:"inline-flex items-center gap-1 rounded-full bg-zinc-100 px-2 py-0.5 text-xs text-zinc-700"},me={class:"px-3 py-2 align-top"},ye={class:"inline-flex items-center gap-1 rounded-full bg-blue-50 text-blue-700 px-2 py-0.5 text-xs"},re={class:"px-3 py-2 align-top"},fe={class:"max-w-[220px] truncate font-medium text-zinc-800"},_e={class:"px-3 py-2 align-top"},ve={class:"max-w-[220px] truncate text-zinc-700"},xe={class:"px-3 py-2 align-top"},ge={class:"max-w-[220px] truncate text-zinc-700"},be={class:"px-3 py-2 align-top"},he={class:"inline-flex items-center gap-1 rounded-md bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-700"},we={class:"px-3 py-2 align-top"},Se={class:"px-3 py-2 align-top"},ke={key:1,class:"text-xs italic text-zinc-400"},ze={class:"px-3 py-2 align-top"},De={class:"inline-flex items-center gap-1 rounded-full bg-indigo-50 text-indigo-700 px-2 py-0.5 text-xs"},Ee={key:0},Ke={__name:"DailyLateAttendanceReport",setup(Ce){const _=K(),y=M(),v=Y(),c=Z(),S=ee(),{dailyLateLogs:k,isLoading:A,selectedDate:z}=b(v),{companies:qe}=b(c),{departments:Le}=b(S),e=f({company_id:y.query.company_id||"",department_id:y.query.department_id||"",line_type:y.query.line_type||"all",employee_id:y.query.employee_id||"",date:y.query.date||""});["company_id","department_id","employee_id","date"].forEach(n=>{e.value[n]=e.value[n]?String(e.value[n]):""}),e.value.line_type=e.value.line_type||"all";const d=f(null),r=f([]);z.value=e.value.date||"";function D(){d.value&&d.value.id?e.value.employee_id=String(d.value.id):d.value||(e.value.employee_id=e.value.employee_id||"")}async function R(){await v.getDailyLateReport(e.value.company_id||"",e.value.department_id||"",e.value.line_type||"all",e.value.employee_id||"",e.value.date||"","daily")}async function U(n){if(!n){r.value=[],d.value=null,e.value.department_id="";return}if(await Promise.all([S.fetchDepartments(n),c.fetchEmployee(n)]),r.value=c.employees||[],e.value.department_id&&((c.employees||[]).some(i=>String(i.department_id)===String(e.value.department_id))||(e.value.department_id="")),e.value.employee_id){const l=(c.employees||[]).find(i=>String(i.id)===String(e.value.employee_id));d.value=l||null,D()}}function B(){if(!e.value.company_id){r.value=[],d.value=null,e.value.employee_id="";return}const n=c.employees||[],l=e.value.department_id,i=e.value.line_type;let a=n;l&&(a=a.filter(m=>String(m.department_id)===String(l))),i&&i!=="all"&&(a=a.filter(m=>String(m.type)===String(i))),r.value=a,e.value.employee_id&&(a.some(P=>String(P.id)===String(e.value.employee_id))||(d.value=null,e.value.employee_id=""))}let x=null;function F(){x&&clearTimeout(x),x=setTimeout(()=>{const n={};e.value.company_id&&(n.company_id=String(e.value.company_id)),e.value.department_id&&(n.department_id=String(e.value.department_id)),e.value.employee_id&&(n.employee_id=String(e.value.employee_id)),e.value.line_type&&e.value.line_type!=="all"&&(n.line_type=String(e.value.line_type)),e.value.date&&(n.date=String(e.value.date)),_.replace({query:n}).catch(()=>{})},120)}let g=null;const E=f(e.value.company_id||""),C=f("");async function N(){(e.value.company_id||"")!==(E.value||"")&&(await U(e.value.company_id||""),E.value=e.value.company_id||""),e.value.company_id?B():(r.value=[],d.value=null);const n=JSON.stringify({c:e.value.company_id||"",d:e.value.department_id||"",t:e.value.line_type||"all",e:e.value.employee_id||"",dt:e.value.date||""});n!==C.value&&(await R(),C.value=n),F()}function q(){g&&clearTimeout(g),g=setTimeout(N,200)}L(()=>({...e.value}),()=>{D(),q()},{deep:!0}),L(()=>e.value.date,n=>{z.value=n||""}),Q(async()=>{await c.fetchCompanies(),q()});async function V(){try{console.log("sdf"),await v.lateReportDownloadExcel(e.value.company_id||"",e.value.department_id||"",e.value.line_type||"all",e.value.employee_id||"",e.value.date||"","daily")}catch{te.fire({icon:"warning",title:"Heads up",text:"Exporting all companies may be restricted by backend.",confirmButtonText:"OK"})}}const j=()=>{const n={company_id:e.value.company_id,department_id:e.value.department_id,line_type:e.value.line_type,employee_id:e.value.employee_id};Object.entries(n).some(([i,a])=>y.query[i]!==String(a))&&_.replace({query:n})};function O(){_.go(-1)}return(n,l)=>{var i;return p(),u("div",ae,[t("div",{class:"flex flex-wrap items-center justify-between gap-3"},[t("button",{class:"btn-3 inline-flex items-center gap-2",onClick:O,"aria-label":"Go back"},l[5]||(l[5]=[t("i",{class:"fas fa-arrow-left"},null,-1),t("span",{class:"hidden md:inline"},"Back",-1)])),l[7]||(l[7]=t("h1",{class:"title-md md:title-lg text-center flex-1"}," Daily Late Reports ",-1)),t("div",{class:"flex items-center gap-2"},[t("button",{type:"button",onClick:V,class:"btn-3 inline-flex items-center gap-2"},l[6]||(l[6]=[t("i",{class:"fas fa-file-excel text-green-600"},null,-1),t("span",{class:"hidden sm:inline"},"Export",-1)]))])]),t("div",le,[l[9]||(l[9]=t("div",{class:"flex items-center justify-between border-b border-zinc-100 px-4 py-3"},[t("p",{class:"text-sm text-zinc-600"},[t("i",{class:"fas fa-filter mr-2"}),s(" Filters ")]),t("div",{class:"h-1 w-32 bg-gradient-to-r from-indigo-500 via-sky-500 to-cyan-400 rounded-full"})],-1)),t("div",ne,[T(I,{company_id:e.value.company_id,"onUpdate:company_id":l[0]||(l[0]=a=>e.value.company_id=a),department_id:e.value.department_id,"onUpdate:department_id":l[1]||(l[1]=a=>e.value.department_id=a),employee_id:e.value.employee_id,"onUpdate:employee_id":l[2]||(l[2]=a=>e.value.employee_id=a),line_type:e.value.line_type,"onUpdate:line_type":l[3]||(l[3]=a=>e.value.line_type=a),"initial-value":n.$route.query,class:"w-full",onFilterChange:j},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",null,[l[8]||(l[8]=t("label",{class:"mb-1 block text-xs font-medium text-zinc-500"},"Date",-1)),W(t("input",{id:"filter-date","onUpdate:modelValue":l[4]||(l[4]=a=>e.value.date=a),type:"date",class:"input-1"},null,512),[[$,e.value.date]])])])]),h(A)?(p(),u("div",ie,[T(X)])):(p(),u("div",se,[t("div",oe,[t("table",de,[l[19]||(l[19]=t("thead",{class:"bg-zinc-50 sticky top-0 z-10"},[t("tr",{class:"text-left text-zinc-700"},[t("th",{class:"px-3 py-2.5"},"#"),t("th",{class:"px-3 py-2.5"},"Date"),t("th",{class:"px-3 py-2.5"},"Weekday"),t("th",{class:"px-3 py-2.5"},"Employee"),t("th",{class:"px-3 py-2.5"},"Company"),t("th",{class:"px-3 py-2.5"},"Department"),t("th",{class:"px-3 py-2.5"},"Entry Time"),t("th",{class:"px-3 py-2.5"},"Late Duration"),t("th",{class:"px-3 py-2.5"},"Application"),t("th",{class:"px-3 py-2.5"},"Shift")])],-1)),t("tbody",null,[(p(!0),u(H,null,J(h(k),(a,m)=>(p(),u("tr",{key:a.id||m,class:"border-t border-zinc-100 odd:bg-white even:bg-zinc-50 hover:bg-sky-50 transition-colors"},[t("td",ue,o(m+1),1),t("td",pe,[t("span",ce,[l[10]||(l[10]=t("i",{class:"far fa-calendar-alt"},null,-1)),s(" "+o((a==null?void 0:a.date)||"-"),1)])]),t("td",me,[t("span",ye,[l[11]||(l[11]=t("i",{class:"far fa-calendar-check"},null,-1)),s(" "+o((a==null?void 0:a.weekday)||"-"),1)])]),t("td",re,[t("div",fe,[l[12]||(l[12]=t("i",{class:"far fa-user mr-1 text-zinc-500"},null,-1)),s(o((a==null?void 0:a.user_name)||"Unknown"),1)])]),t("td",_e,[t("div",ve,[l[13]||(l[13]=t("i",{class:"far fa-building mr-1 text-zinc-500"},null,-1)),s(o((a==null?void 0:a.company_name)||"Unknown"),1)])]),t("td",xe,[t("div",ge,[l[14]||(l[14]=t("i",{class:"far fa-sitemap mr-1 text-zinc-500"},null,-1)),s(o((a==null?void 0:a.department_name)||"Unknown"),1)])]),t("td",be,[t("span",he,[l[15]||(l[15]=t("i",{class:"far fa-clock"},null,-1)),s(o((a==null?void 0:a.entry_time)||"-"),1)])]),t("td",we,[t("span",{class:w(["inline-flex items-center gap-1 rounded-md px-2 py-0.5 text-xs font-semibold",((a==null?void 0:a.late_duration)||"").trim()?"bg-rose-50 text-rose-700":"bg-zinc-100 text-zinc-500"])},[l[16]||(l[16]=t("i",{class:"fas fa-stopwatch"},null,-1)),s(o((a==null?void 0:a.late_duration)||"â€”"),1)],2)]),t("td",Se,[a!=null&&a.short_leave?(p(),u("span",{key:0,class:w(["inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium",{"bg-green-50 text-green-700":a.short_leave.status==="Approved","bg-yellow-50 text-yellow-700":a.short_leave.status==="Pending","bg-rose-50 text-rose-700":a.short_leave.status!=="Approved"&&a.short_leave.status!=="Pending"}])},[t("i",{class:w([a.short_leave.status==="Approved"?"fas fa-check-circle":a.short_leave.status==="Pending"?"fas fa-hourglass-half":"fas fa-times-circle"])},null,2),s(" "+o(a.short_leave.status||"Waiting"),1)],2)):(p(),u("span",ke,"No Application"))]),t("td",ze,[t("span",De,[l[17]||(l[17]=t("i",{class:"far fa-moon"},null,-1)),s(o((a==null?void 0:a.shift_name)||"-"),1)])])]))),128)),(i=h(k))!=null&&i.length?G("",!0):(p(),u("tr",Ee,l[18]||(l[18]=[t("td",{colspan:"10",class:"px-3 py-8 text-center text-zinc-500"},[t("i",{class:"far fa-folder-open mr-2"}),s("No late entries found for the selected filters. ")],-1)])))])])])]))])}}};export{Ke as default};
