import{d as fe,z,r as h,m as E,a4 as ce,n as H,e as ye,c as u,o as n,a as e,f as O,w as me,g as L,h as w,v as q,K as be,t as y,F as M,q as R,k as g,a5 as Y,x as F,u as ge,b as xe,A as he,D as we,j as V,i as ve,a6 as ke}from"./index-B_8aCD-G.js";import{L as pe}from"./LoaderView-f2SvpUAp.js";import{_ as Le}from"./MultiselectDropdown-Cka1uaAm.js";import{u as $e}from"./holiday-CbVISNKQ.js";import{u as _e}from"./leave-application-CVZGEhlx.js";import{u as Se}from"./leave-type-Qc5dlhtf.js";import{u as P}from"./user-JWDUtDya.js";import{_ as Ae}from"./EmployeeFilter-BtKUHgD1.js";import{u as Ue}from"./company-CpBnBnE5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./department-D6hjV4T2.js";const De={class:"space-y-4 p-2 md:p-4"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve={class:"inline-flex items-center space-x-2"},qe={key:0},Te={class:"text-blue-600 font-medium"},Be={key:1,class:"bg-gray-100 p-2 rounded-md"},Me={class:"font-semibold"},je={class:"flex flex-wrap gap-2"},Fe=["name","value","onUpdate:modelValue"],Re={class:"flex items-center space-x-1"},Ie=["name","onUpdate:modelValue"],Ne={class:"flex items-center space-x-1"},Ee=["name","onUpdate:modelValue"],He={key:2},We={key:3},Ye={key:4,class:"text-red-500 text-sm"},ze={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(T,{emit:j}){const a=T,k=j,D=_e();Se();const f=P();fe();const A=$e(),{userLeaveBalance:$}=z(f),C=h(""),S=h(!0),r=h({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),o=h([]),v=h(!1),c=h(null),B=E(()=>{var m,t,i;return((t=(m=a==null?void 0:a.userInfo)==null?void 0:m.assign_weekend)==null?void 0:t.weekends)||((i=a==null?void 0:a.userInfo)==null?void 0:i.weekends)}),d=E(()=>{const m=r.value.last_working_date,t=r.value.resumption_date;if(!m||!t)return[];const i=new Date(m),p=new Date(t);if(p<=i)return[];const b=[];let _=new Date(i);for(_.setDate(_.getDate()+1);_<p;){const U=_.getFullYear(),x=(_.getMonth()+1).toString().padStart(2,"0"),s=_.getDate().toString().padStart(2,"0");b.push(`${U}-${x}-${s}`),_.setDate(_.getDate()+1)}return b}),I=E(()=>{if(!r.value.last_working_date||!r.value.resumption_date)return"";const m=new Date(r.value.last_working_date);return new Date(r.value.resumption_date)<=m?"Resumption date must be after Last Working Date.":d.value.length===0?"No leave days between the selected dates.":`Total leave days: ${d.value.length}`});ce(async()=>{var m;d.value.length&&$.value.length&&(o.value.length!==d.value.length&&(o.value=d.value.map(()=>$.value[0].id)),await A.fetchHolidays({company_id:(m=a==null?void 0:a.userInfo)==null?void 0:m.company_id,start_date:d.value[0],end_date:d.value[d.value.length-1]}),d.value.forEach(async(t,i)=>{const p=new Date(t).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),b=p.charAt(0).toUpperCase()+p.slice(1);B.value.includes(b)&&(o.value[i]="weekend"),A.holidayDates.includes(t)&&(o.value[i]="holiday")}))}),H(()=>C.value,m=>{r.value.handover_user_id=m==null?void 0:m.id});const W=async()=>{var m;v.value=!0,c.value=null;try{const t=d.value.map((_,U)=>({date:_,leave_type_id:o.value[U]!=="weekend"&&o.value[U]!=="holiday"?o.value[U]:null})).filter(_=>_.leave_type_id!==null),i=d.value.map((_,U)=>({date:_,leave_type_id:o.value[U]||""})).filter(_=>_.leave_type_id!==null),p={user_id:(m=a==null?void 0:a.userInfo)==null?void 0:m.id,last_working_date:r.value.last_working_date,resumption_date:r.value.resumption_date,reason:r.value.reason,works_in_hand:r.value.works_in_hand,handover_user_id:S.value?null:r.value.handover_user_id,leave_days:t,json_data:i,is_direct_approve:S.value};await D.storeAdminLeaveApplication(p)&&k("formSuccessClosed")}catch(t){c.value=t.message||"Failed to submit leave application"}finally{v.value=!1}};return ye(async()=>{ce(()=>{var t;const m=(t=a==null?void 0:a.userInfo)==null?void 0:t.id;m&&f.fetchUserLeaveBalances(m)}),await f.fetchTypeWiseEmployees({except:"auth"})}),(m,t)=>(n(),u("div",De,[t[16]||(t[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),v.value?(n(),O(pe,{key:0})):(n(),u("form",{key:1,onSubmit:me(W,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",Ce,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),w(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=i=>r.value.last_working_date=i),class:"input-1 w-full",required:""},null,512),[[q,r.value.last_working_date]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),w(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=i=>r.value.resumption_date=i),class:"input-1 w-full",required:""},null,512),[[q,r.value.resumption_date]])])]),e("div",null,[e("label",Ve,[w(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=i=>S.value=i),class:"form-checkbox text-blue-600"},null,512),[[be,S.value]]),t[8]||(t[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),r.value.last_working_date&&r.value.resumption_date?(n(),u("div",qe,[e("p",Te,y(I.value),1)])):L("",!0),d.value.length?(n(),u("div",Be,[t[11]||(t[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),e("div",null,[(n(!0),u(M,null,R(d.value,(i,p)=>(n(),u("div",{key:p,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[e("div",Me,y(i),1),e("div",je,[(n(!0),u(M,null,R(g($),b=>(n(),u("label",{key:b.id,class:"flex items-center space-x-1"},[w(e("input",{type:"radio",name:"leaveType-"+p,value:b.id,"onUpdate:modelValue":_=>o.value[p]=_},null,8,Fe),[[Y,o.value[p]]]),e("span",null,y(b.leave_type),1)]))),128)),e("label",Re,[w(e("input",{type:"radio",name:"leaveType-"+p,value:"weekend","onUpdate:modelValue":b=>o.value[p]=b},null,8,Ie),[[Y,o.value[p]]]),t[9]||(t[9]=e("span",null,"Weekend",-1))]),e("label",Ne,[w(e("input",{type:"radio",name:"leaveType-"+p,value:"holiday","onUpdate:modelValue":b=>o.value[p]=b},null,8,Ee),[[Y,o.value[p]]]),t[10]||(t[10]=e("span",null,"Holiday",-1))])])]))),128))])])):L("",!0),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),w(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=i=>r.value.reason=i),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[q,r.value.reason]])]),S.value?L("",!0):(n(),u("div",He,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),F(Le,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=i=>C.value=i),options:g(f).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),S.value?L("",!0):(n(),u("div",We,[t[14]||(t[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),w(e("textarea",{id:"works-in-hand","onUpdate:modelValue":t[5]||(t[5]=i=>r.value.works_in_hand=i),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[q,r.value.works_in_hand]])])),c.value?(n(),u("div",Ye,y(c.value),1)):L("",!0),t[15]||(t[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Oe={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},Pe={class:"bg-white rounded-lg shadow-lg w-full max-w-3xl"},Je={class:"px-6 py-4 border-b"},Ge={class:"text-lg font-bold"},Ke={class:"table-auto w-full border"},Qe={class:"p-2"},Xe=["onUpdate:modelValue"],Ze=["onUpdate:modelValue"],et={class:"p-2"},tt=["onUpdate:modelValue"],st={class:"p-2"},lt=["onUpdate:modelValue"],at={__name:"UserLeaveBalanceModal",props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0}},emits:["close"],setup(T,{emit:j}){const a=T,k=j,D=Ue(),f=P(),A=h([]),$=h(!1);H(()=>a.show,async o=>{var v;o&&((v=a.user)!=null&&v.id)&&!$.value&&(await C(),$.value=!0)}),H(()=>{var o;return(o=a.user)==null?void 0:o.id},()=>{$.value=!1,A.value=[]});const C=async()=>{try{const o=await f.fetchUserLeaveTypes(a.user.id);if(o!=null&&o.length)A.value=o;else{const v=await D.fetchCompanyLeaveTypes(a.user.company_id);A.value=v.data.map(c=>({id:c.id,name:c.name,annual_quota:c.annual_quota||0,max_consecutive_days:c.max_consecutive_days||null,type:c.type||"Paid"}))}}catch(o){console.error("Failed to load leave balances or fallback types:",o)}},S=async()=>{try{await f.saveLeaveBalances(a.user.id,A.value),k("close")}catch(o){console.error("Failed to save leave balances:",o)}},r=()=>{k("close")};return(o,v)=>T.show&&T.user?(n(),u("div",Oe,[e("div",Pe,[e("div",Je,[e("h3",Ge,"Set Leave Balances for "+y(T.user.name),1)]),e("form",{onSubmit:me(S,["prevent"]),class:"p-6 space-y-4"},[e("table",Ke,[v[0]||(v[0]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"p-2"},"Leave Type"),e("th",{class:"p-2"},"Annual Quota"),e("th",{class:"p-2"},"Max Consecutive Days")])],-1)),e("tbody",null,[(n(!0),u(M,null,R(A.value,(c,B)=>(n(),u("tr",{key:B},[e("td",Qe,[w(e("input",{type:"hidden","onUpdate:modelValue":d=>c.id=d,class:"input-1 w-full"},null,8,Xe),[[q,c.id]]),w(e("input",{"onUpdate:modelValue":d=>c.name=d,class:"input-1 w-full",disabled:""},null,8,Ze),[[q,c.name]])]),e("td",et,[w(e("input",{"onUpdate:modelValue":d=>c.annual_quota=d,type:"number",min:"0",class:"input-1 w-full"},null,8,tt),[[q,c.annual_quota,void 0,{number:!0}]])]),e("td",st,[w(e("input",{"onUpdate:modelValue":d=>c.max_consecutive_days=d,type:"number",min:"0",class:"input-1 w-full"},null,8,lt),[[q,c.max_consecutive_days,void 0,{number:!0}]])])]))),128))])]),e("div",{class:"flex justify-end gap-2 pt-4 border-t"},[e("button",{type:"button",onClick:r,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancel "),v[1]||(v[1]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," Save ",-1))])],32)])])):L("",!0)}},ot={class:"space-y-2 px-4"},nt={class:"flex flex-wrap gap-2"},rt=["value"],dt={key:0,class:"text-center py-4"},ut={key:1,class:"space-y-4"},it={key:0,class:"bg-sky-100/30 p-4 rounded-lg shadow mb-6 space-y-6"},ct={class:"grid md:grid-cols-2 gap-6"},vt={class:"bg-white border rounded-lg p-4 shadow"},yt={class:"grid grid-cols-1 sm:grid-cols-2 gap-y-2 text-sm text-gray-600"},mt={class:"bg-white border rounded-lg p-4 shadow"},pt={class:"overflow-x-auto"},_t={class:"min-w-full text-sm text-left text-gray-700 border"},ft={class:"px-4 py-1 text-center font-medium"},bt={class:"px-4 py-1 text-center"},gt={class:"px-4 py-1 text-center"},xt={class:"px-4 py-1 text-center"},ht={class:"overflow-x-auto"},wt={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},kt={class:"border border-gray-300 px-2 py-2"},Lt={class:"border border-gray-300 px-2 py-2 text-center"},$t={class:"border border-gray-300 px-2 py-2 text-center"},St={class:"border border-gray-300 px-2 py-2"},At={class:"border border-gray-300 px-2 py-2"},Ut=["innerHTML"],Dt={class:"border border-gray-300 px-2 py-2 text-center"},Ct={class:"border border-gray-300 px-2 py-2"},Vt={class:"border border-gray-300 px-2"},qt={class:"flex justify-center gap-2"},Tt=["onClick"],Bt={key:0},Mt={key:0},jt={class:"text-center py-2",colspan:"6"},Ft={key:0,class:"fixed inset-0 z-[1000] bg-black bg-opacity-50 flex items-center justify-center"},Rt={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},Kt={__name:"AdminLeaveApplication",setup(T){const j=ge(),a=xe(),k=_e(),D=P(),{user:f,leave_balances:A,leaveApplications:$,loading:C}=z(k),{userLeaveBalance:S}=z(D),r=h(a.query.year||k.selectedYear),o=h(a.query.search||""),v=h({company_id:a.query.company_id||"",department_id:a.query.department_id||"all",type:a.query.type||"all",employee_id:a.query.employee_id||""}),c=h(!1),B=h(!1),d=async()=>{const x={selectedYear:r.value,selectedStatus:k.selectedStatus,query:o.value};v.value.employee_id?(x.user_id=v.value.employee_id,C.value=!0,await k.fetchYearlyUserLeaveApplications(x),C.value=!1):$.value=[]};ye(async()=>{await d(),a.query.employee_id&&await D.fetchUserLeaveBalances(a.query.employee_id)}),H(()=>a.query.employee_id,async x=>{x&&await D.fetchUserLeaveBalances(x)});const I=E(()=>$.value||[]),W=()=>j.go(-1),m=async()=>{j.replace({query:{...a.query,company_id:v.value.company_id,department_id:v.value.department_id,type:v.value.type,employee_id:v.value.employee_id}}),await d()},t=()=>{B.value=!0},i=async()=>{console.log("test close"),c.value=!1,await d()},p=new Date().getFullYear(),b=h([]);for(let x=2023;x<=p;x++)b.value.push(x);const _=async x=>{confirm("Are you sure to delete this application?")&&(await k.deleteLeaveApplication(x),await d())},U=()=>{B.value=!1,D.fetchUserLeaveBalances(a.query.employee_id)};return(x,s)=>{var G,K,Q,X,Z,ee,te,se,le,ae,oe,ne,re;const J=he("RouterLink");return n(),u(M,null,[e("div",ot,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:W},s[5]||(s[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),s[6]||(s[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),s[7]||(s[7]=e("div",null,null,-1))]),e("div",nt,[F(Ae,{modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=l=>v.value=l),"initial-value":g(a).query,onFilterChange:m},null,8,["modelValue","initial-value"]),e("div",null,[w(e("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>r.value=l),onChange:d,class:"input-1"},[(n(!0),u(M,null,R(b.value,l=>(n(),u("option",{key:l,value:l},y(l),9,rt))),128))],544),[[we,r.value]])])]),g(k).loading?(n(),u("div",dt,[F(pe)])):(n(),u("div",ut,[(G=v.value)!=null&&G.employee_id?(n(),u("div",it,[s[19]||(s[19]=e("h2",{class:"text-xl font-bold text-gray-800 text-center"},"Employee Overview",-1)),e("div",ct,[e("div",vt,[s[16]||(s[16]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"User Info",-1)),e("div",yt,[e("p",null,[s[8]||(s[8]=e("strong",null,"Name:",-1)),V(" "+y((K=g(f))==null?void 0:K.name),1)]),e("p",null,[s[9]||(s[9]=e("strong",null,"Designation:",-1)),V(" "+y((X=(Q=g(f))==null?void 0:Q.designation)==null?void 0:X.title),1)]),e("p",null,[s[10]||(s[10]=e("strong",null,"Department:",-1)),V(" "+y((ee=(Z=g(f))==null?void 0:Z.department)==null?void 0:ee.name),1)]),e("p",null,[s[11]||(s[11]=e("strong",null,"Company:",-1)),V(" "+y((se=(te=g(f))==null?void 0:te.company)==null?void 0:se.name),1)]),e("p",null,[s[12]||(s[12]=e("strong",null,"Phone:",-1)),V(" "+y((le=g(f))==null?void 0:le.phone),1)]),e("p",null,[s[13]||(s[13]=e("strong",null,"Email:",-1)),V(" "+y((ae=g(f))==null?void 0:ae.email),1)]),e("p",null,[s[14]||(s[14]=e("strong",null,"Joining Date:",-1)),V(" "+y((oe=g(f))==null?void 0:oe.joining_date),1)]),e("p",null,[s[15]||(s[15]=e("strong",null,"Blood Group:",-1)),V(" "+y(((ne=g(f))==null?void 0:ne.blood)||"N/A"),1)])])]),e("div",mt,[e("div",{class:"flex justify-between items-center"},[s[17]||(s[17]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Leave Balance",-1)),e("button",{onClick:t,type:"button",class:"btn-2"},"Set Leave Balance")]),e("div",pt,[e("table",_t,[s[18]||(s[18]=e("thead",{class:"bg-gray-100 text-xs uppercase"},[e("tr",null,[e("th",{class:"px-4 py-2 text-center"},"Type"),e("th",{class:"px-4 py-2 text-center"},"Total"),e("th",{class:"px-4 py-2 text-center"},"Used"),e("th",{class:"px-4 py-2 text-center"},"Remaining")])],-1)),e("tbody",null,[(n(!0),u(M,null,R(g(S),l=>(n(),u("tr",{key:l.id,class:"border-t hover:bg-gray-50"},[e("td",ft,y(l.leave_type),1),e("td",bt,y(l.annual_quota),1),e("td",gt,y(l.used_days),1),e("td",xt,y(l.remaining_days),1)]))),128))])])])])])])):L("",!0),e("div",ht,[e("table",wt,[s[24]||(s[24]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Type"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")])],-1)),e("tbody",null,[(n(!0),u(M,null,R(I.value,(l,de)=>{var ue;return n(),u("tr",{key:de,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",kt,y(de+1),1),e("td",Lt,y(l==null?void 0:l.last_working_date),1),e("td",$t,y(l==null?void 0:l.resumption_date),1),e("td",St,y(l==null?void 0:l.leave_period),1),e("td",At,[e("div",{innerHTML:(l==null?void 0:l.duration)||(l==null?void 0:l.total_leave_days)},null,8,Ut)]),e("td",Dt,y([...new Set((ue=l==null?void 0:l.leave_days)==null?void 0:ue.map(N=>{var ie;return(ie=N==null?void 0:N.leave_type)==null?void 0:ie.name}))].join(",")),1),e("td",Ct,y((l==null?void 0:l.status)||"N/A"),1),e("td",Vt,[e("div",qt,[F(J,{to:{name:"LeaveApplicationShow",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:ve(()=>s[20]||(s[20]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[20]},1032,["to"]),["Approved","Rejected"].includes(l==null?void 0:l.status)?L("",!0):(n(),O(J,{key:0,to:{name:"LeaveApplicationEdit",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:ve(()=>s[21]||(s[21]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[21]},1032,["to"])),e("button",{onClick:N=>_(l==null?void 0:l.id),class:"btn-icon text-red-500"},s[22]||(s[22]=[e("i",{class:"far fa-trash"},null,-1)]),8,Tt)])])])}),128)),I.value.length?L("",!0):(n(),u("tr",Bt,s[23]||(s[23]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(re=v.value)!=null&&re.employee_id?(n(),u("tr",Mt,[e("th",jt,[e("button",{onClick:s[2]||(s[2]=l=>c.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):L("",!0)])])])]))]),F(at,{show:B.value,user:g(f),onClose:U},null,8,["show","user"]),(n(),O(ke,{to:"body"},[c.value?(n(),u("div",Ft,[e("div",Rt,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:s[3]||(s[3]=l=>c.value=!1)}," × "),F(ze,{userInfo:g(f),onClose:s[4]||(s[4]=l=>c.value=!1),onFormSuccessClosed:i},null,8,["userInfo"])])])):L("",!0)]))],64)}}};export{Kt as default};
