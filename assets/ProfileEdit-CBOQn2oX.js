import{r as n,q as L,c as y,j as F,o as c,a as l,t as N,G,g as E,D as q,S as z,u as H,h as J,p as K,i as A,d as D,w as Q,m as I,k as v,v as b,H as W,F as O,e as X,l as Y,b as Z}from"./index-97A5Hncs.js";import{L as ee}from"./LoaderView-D1EjMxlI.js";import{_ as le}from"./ChangePasswordModal-C5HyXs6E.js";const oe={key:0,class:"modal-bg z-50"},te={class:"modal-card relative"},se={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-200 bg-opacity-75 z-10"},ae=["src"],ne={class:"flex justify-center mt-4"},re=["disabled"],de={__name:"PhotoModal",props:{imageSrc:{type:String,default:""},isOpen:{type:Boolean,default:!1}},emits:["close","fileSelected","uploadPhoto"],setup(V,{emit:o}){const x=o,u=n(null),s=n(!1),r=n(!1),P=n(!1),g=V,i=n(g.isOpen),p=n(g.imageSrc),k=()=>{i.value=!1,x("close"),_()},m=f=>{const d=f.target.files[0];if(d){const U=new FileReader;U.onload=C=>{p.value=C.target.result,s.value=!0},U.readAsDataURL(d),x("fileSelected",d)}},h=()=>{u.value.click()},S=()=>{s.value?(r.value=!0,x("uploadPhoto",u.value.files[0]),setTimeout(()=>{r.value=!1,P.value=!0},2e3)):h()},_=()=>{s.value=!1,r.value=!1,P.value=!1};return L(()=>g.isOpen,f=>{i.value=f,f&&(p.value=g.imageSrc,_())}),(f,d)=>i.value?(c(),y("div",oe,[l("div",te,[r.value?(c(),y("div",se,d[0]||(d[0]=[l("div",{class:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"},null,-1)]))):F("",!0),p.value?(c(),y("img",{key:1,src:p.value,alt:"Modal Image",class:"aspect-[3/4] object-cover rounded-md"},null,8,ae)):F("",!0),l("div",ne,[l("button",{class:"btn-2",onClick:S,disabled:r.value},N(s.value?"Upload Photo":"Change Photo"),9,re)]),l("input",{type:"file",ref_key:"fileInput",ref:u,class:"hidden",onChange:m},null,544),l("button",{onClick:k,class:"absolute top-2 right-2 text-red-500 text-xl"},d[1]||(d[1]=[l("i",{class:"far fa-times-circle"},null,-1)]))])])):F("",!0)}},ue={class:"my-container space-y-2"},ie={class:"card-bg md:p-8 p-4 mx-4"},pe={class:"grid gap-4"},fe={class:"border p-4 rounded-md bg-gray-100"},ve={class:"flex justify-center w-full"},ce=["src"],me={class:"grid md:grid-cols-2 gap-4"},be={class:"space-y-2"},ge=["value"],ye={class:"flex justify-center gap-4"},Pe={__name:"ProfileEdit",setup(V){const o=G({name:"",bn_name:"",phone:"",email:"",nid:"",date_of_birth:"",address:"",blood:""}),x=["A+","A-","B+","B-","AB+","AB-","O+","O-"],u=E(),{user:s}=q(u),r=z(),P=H(),g=n(!1),i=n(!1),p=n(!1),k=n(null),m=n(null),h=n(!1),S=n(!1);J(()=>{s.value&&C()}),L(s,a=>{a&&C()});const _=()=>{k.value=s.value.photo,p.value=!0},f=()=>{p.value=!1,m.value=null},d=()=>{i.value=!1},U=a=>{m.value=a},C=()=>{var a,e,M,w,t,B,j,$;o.name=((a=s.value)==null?void 0:a.name)||"",o.bn_name=((e=s.value)==null?void 0:e.bn_name)||"",o.phone=((M=s.value)==null?void 0:M.phone)||"",o.email=((w=s.value)==null?void 0:w.email)||"",o.address=((t=s.value)==null?void 0:t.address)||"",o.nid=((B=s.value)==null?void 0:B.nid)||"",o.blood=((j=s.value)==null?void 0:j.blood)||"",o.date_of_birth=(($=s.value)==null?void 0:$.date_of_birth)||""},R=async()=>{try{await u.updateProfile(o),r.success("Profile updated successfully!"),P.push({name:"MyProfile"})}catch(a){console.error("Failed to update profile:",a),r.error(u.error||"Failed to save profile!");return}},T=async()=>{if(console.log(m.value),!m.value)return;const a=new FormData;a.append("photo",m.value),a.append("user_id",s.value.id),console.log({formData:a});try{h.value=!0,await u.uploadProfilePhoto(a),S.value=!0,setTimeout(()=>{f(),h.value=!1,S.value=!1},1500),r.success("Image updated successfully!")}catch(e){console.error("Failed to upload photo:",e),r.error(u.error||"Failed to save profile!")}finally{h.value=!1}};return(a,e)=>{var w;const M=K("RouterLink");return c(),y(O,null,[l("div",ue,[l("div",ie,[e[23]||(e[23]=l("h2",{class:"title-lg text-center"},"Edit Profile",-1)),g.value?(c(),A(ee,{key:0,class:"bg-gray-100 border shadow-none"})):(c(),y("form",{key:1,onSubmit:Q(R,["prevent"]),class:"space-y-4"},[l("div",pe,[l("div",fe,[l("div",ve,[l("div",{onClick:_,class:"relative bg-gray-200 w-40 h-40 rounded-full overflow-hidden mx-auto flex items-center justify-center"},[l("img",{class:"object-cover w-full h-full",src:((w=I(s))==null?void 0:w.photo)||"/default-avatar.png",alt:"Profile Photo"},null,8,ce),e[9]||(e[9]=l("div",{class:"absolute inset-0 flex items-end justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity"},[l("button",{type:"button",class:"btn-2 px-3 py-1 text-sm rounded-md mb-2"}," Change ")],-1))])]),e[19]||(e[19]=l("p",{class:"title-md"},"Personal Info",-1)),e[20]||(e[20]=l("hr",{class:"my-2"},null,-1)),l("div",me,[l("div",null,[e[10]||(e[10]=l("label",null,"Name",-1)),v(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.name=t),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[b,o.name]])]),l("div",null,[e[11]||(e[11]=l("label",null,"Bangla Name",-1)),v(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.bn_name=t),type:"text",class:"w-full p-2 border rounded"},null,512),[[b,o.bn_name]])]),l("div",null,[e[12]||(e[12]=l("label",null,"Phone",-1)),v(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.phone=t),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[b,o.phone]])]),l("div",null,[e[13]||(e[13]=l("label",null,"Email",-1)),v(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.email=t),type:"email",class:"w-full p-2 border rounded"},null,512),[[b,o.email]])]),l("div",be,[e[15]||(e[15]=l("label",{for:"bloodGroup",class:"text-gray-700 flex items-center gap-2"}," Blood Group ",-1)),v(l("select",{id:"bloodGroup","onUpdate:modelValue":e[4]||(e[4]=t=>o.blood=t),class:"py-2 px-4 border rounded w-full"},[e[14]||(e[14]=l("option",{disabled:"",value:""},"Select blood group",-1)),(c(),y(O,null,X(x,t=>l("option",{key:t,value:t},N(t),9,ge)),64))],512),[[W,o.blood]])]),l("div",null,[e[16]||(e[16]=l("label",null,"NID",-1)),v(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.nid=t),type:"text",class:"w-full p-2 border rounded"},null,512),[[b,o.nid]])]),l("div",null,[e[17]||(e[17]=l("label",null,"Date of Birth",-1)),v(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.date_of_birth=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[b,o.date_of_birth]])]),l("div",null,[e[18]||(e[18]=l("label",null,"Address",-1)),v(l("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>o.address=t),rows:"2",class:"w-full p-2 border rounded"},null,512),[[b,o.address]])])])])]),l("div",ye,[D(M,{to:{name:"MyProfile"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:Y(()=>e[21]||(e[21]=[Z(" Cancel ")])),_:1,__:[21]}),e[22]||(e[22]=l("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1)),l("button",{type:"button",onClick:e[8]||(e[8]=t=>i.value=!i.value),class:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"}," Change Password ")])],32))])]),i.value?(c(),A(le,{key:0,onClose:d,user:I(s)},null,8,["user"])):F("",!0),D(de,{imageSrc:k.value,isOpen:p.value,onClose:f,onFileSelected:U,onUploadPhoto:T},null,8,["imageSrc","isOpen"])],64)}}};export{Pe as default};
