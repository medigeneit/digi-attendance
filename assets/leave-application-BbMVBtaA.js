import{P as K,r as v,Q as u,a9 as V}from"./index-BRRNElZb.js";const X=K("leaveApplication",()=>{const d=v([]),s=v([]),f=v(null),o=v(!1),i=v(null),A=v(new Date().toISOString().substring(0,7)),I=v(new Date().getFullYear()),h=v(null),w=v([]),x=v(""),F=v(null),E=v(null),$=v([]),L=v(null);async function g(e={}){var l,n;o.value=!0,i.value=null;try{const t=await u.get("/leave-applications",{params:e});t.data?s.value=t.data:s.value=[]}catch(t){i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to fetch leave applications"}finally{o.value=!1}}const S=async(e,l)=>{var n,t;if(!e||!l){i.value="Invalid user ID or month";return}o.value=!0;try{const a=await u.get(`/user/${e}/application/monthly/${l}/log`);console.log({response:a}),d.value=a.data.applications}catch(a){i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Something went wrong",console.error(i.value)}finally{o.value=!1}},_=async(e,l)=>{var n,t;i.value=null,o.value=!0;try{if(typeof e=="object"||!l){const y=typeof e=="object"?e:{},m=y.month||l;if(!m)throw new Error("Month is required");const{companyId:z=null,departmentId:G=null,includeEmpty:J=!1}=y,{data:p}=await u.get("/reports/monthly-applications",{params:{month:m,company_id:z||void 0,department_id:G||void 0,include_empty:J?1:0}});return $.value=Array.isArray(p==null?void 0:p.results)?p.results:[],L.value=(p==null?void 0:p.month)||m,p}const a=e,r=l;if(!a||!r)throw new Error("Invalid user ID or month");const{data:c}=await u.get(`/user/application/monthly/${encodeURIComponent(r)}/report`,{params:{user_id:a}});return d.value=(c==null?void 0:c.applications)||[],E.value=(c==null?void 0:c.user)||null,F.value=(c==null?void 0:c.month)||r,c}catch(a){return console.error(a),i.value=((t=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Something went wrong",null}finally{o.value=!1}};async function b(e={}){var l,n,t,a,r;o.value=!0,i.value=null;try{const c=await u.get("/yearly-user-leave-applications",{params:e});c.data?(s.value=(l=c==null?void 0:c.data)==null?void 0:l.leave_applications,h.value=(n=c==null?void 0:c.data)==null?void 0:n.user,w.value=(t=c==null?void 0:c.data)==null?void 0:t.leave_balances):(s.value=[],h.value=[])}catch(c){i.value=((r=(a=c.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to fetch leave applications"}finally{o.value=!1}}async function j(e={}){var l,n;o.value=!0,i.value=null;try{const t=await u.get("/my-leave-applications",{params:e});s.value=t.data.data}catch(t){i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to fetch leave applications"}finally{o.value=!1}}async function C(e){var l,n,t,a;o.value=!0,i.value=null;try{const r=await u.post("/leave-applications/store",e);return s.value.push((l=r==null?void 0:r.data)==null?void 0:l.data),(n=r==null?void 0:r.data)==null?void 0:n.data}catch(r){throw i.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to store leave application",new Error(i.value)}finally{o.value=!1}}async function D(e){var l,n,t;o.value=!0,i.value=null;try{console.log(111);const a=await u.post("/admin-leave-applications/store",e);return console.log(a),(l=a==null?void 0:a.data)==null?void 0:l.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to store leave application",new Error(i.value)}finally{o.value=!1}}async function M(e){var l,n;o.value=!0,i.value=null;try{await u.delete(`/my-leave-application/destroy/${e}`),await g()}catch(t){throw i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to store leave application",new Error(i.value)}finally{o.value=!1}}const R=async e=>{var l,n;try{return o.value=!0,(await u.post("cental-attachment-upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(t){i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Something went wrong"}finally{o.value=!1}};async function U(e,l){var n,t;o.value=!0,i.value=null;try{const a=await u.post(`/leave-applications/${e}/update`,l),r=s.value.findIndex(c=>c.id===e);return r!==-1&&(s.value[r]=a.data.data),a.data.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to update leave application",new Error(i.value)}finally{o.value=!1}}const B=async(e,l)=>{var n,t;o.value=!0,i.value=null;try{const a=await u.put(`/leave-attachment/${e}`,l),r=s.value.findIndex(c=>c.id===e);return r!==-1&&(s.value[r]=a.data.data),a.data.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||`Failed to update application leave (ID: ${e})`,console.error(`Error updating application leave with id ${e}:`,a),new Error(i.value)}finally{o.value=!1}};async function Y(e){var l,n;o.value=!0,i.value=null;try{const t=await u.get(`/leave-applications/${e}`);f.value=t==null?void 0:t.data,await V().fetchApprovalPermissions("leave_applications",f.value.id)}catch(t){i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to fetch leave application"}finally{o.value=!1}}async function P(e){var l,n;o.value=!0,i.value=null;try{const t=await u.post(`/leave-applications/${e.id}/handover-accept`,e),a=s.value.findIndex(r=>r.id===(e==null?void 0:e.id));return a!==-1&&(s.value[a]=t.data.data),t.data.data}catch(t){throw i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to accept handover",new Error(i.value)}finally{o.value=!1}}async function q(e){var l,n,t;o.value=!0,i.value=null;try{const a=await u.post(`/leave-applications/${e.id}/incharge-accept`,e),r=s.value.findIndex(c=>c.id===(e==null?void 0:e.id));return r!==-1&&(s.value[r]=a.data.data),(l=a==null?void 0:a.data)==null?void 0:l.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept in-charge approval",new Error(i.value)}finally{o.value=!1}}async function H(e){var l,n,t;o.value=!0,i.value=null;try{const a=await u.post(`/leave-applications/${e.id}/coordinator-accept`,e),r=s.value.findIndex(c=>c.id===(e==null?void 0:e.id));return r!==-1&&(s.value[r]=a.data.data),(l=a==null?void 0:a.data)==null?void 0:l.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept coordinator approval",new Error(i.value)}finally{o.value=!1}}async function N(e){var l,n,t;o.value=!0,i.value=null;try{const a=await u.post(`/leave-applications/${e.id}/operational-admin-accept`,e),r=s.value.findIndex(c=>c.id===(e==null?void 0:e.id));return r!==-1&&(s.value[r]=a.data.data),(l=a==null?void 0:a.data)==null?void 0:l.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept operational admin approval",new Error(i.value)}finally{o.value=!1}}async function Q(e){var l,n,t;o.value=!0,i.value=null;try{const a=await u.post(`/leave-applications/${e.id}/recommend-by-accept`,e),r=s.value.findIndex(c=>c.id===(e==null?void 0:e.id));return r!==-1&&(s.value[r]=a.data.data),(l=a==null?void 0:a.data)==null?void 0:l.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept recommend by approval",new Error(i.value)}finally{o.value=!1}}async function T(e){var l,n,t;o.value=!0,i.value=null;try{const a=await u.post(`/leave-applications/${e==null?void 0:e.id}/approved-by-accept`,e),r=s.value.findIndex(c=>c.id===(e==null?void 0:e.id));return r!==-1&&(s.value[r]=a.data.data),(l=a==null?void 0:a.data)==null?void 0:l.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept approval by admin",new Error(i.value)}finally{o.value=!1}}async function k(e,l){var n,t;o.value=!0,i.value=null;try{const a=await u.post(`/leave-applications/${e}/reject`,l),r=s.value.findIndex(c=>c.id===e);return r!==-1&&(s.value[r]=a.data.data),a.data.data}catch(a){throw i.value=((t=(n=a.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to reject leave application",new Error(i.value)}finally{o.value=!1}}return{leaveApplications:s,leaveApplication:f,applicationLog:d,loading:o,error:i,selectedMonth:A,selectedYear:I,user:h,selectedStatus:x,fetchLeaveApplications:g,storeLeaveApplication:C,updateLeaveApplication:U,fetchLeaveApplicationById:Y,acceptHandover:P,acceptInCharge:q,acceptCoordinator:H,acceptOperationalAdmin:N,acceptRecommendBy:Q,acceptApprovedBy:T,rejectLeaveApplication:k,fetchMyLeaveApplications:j,deleteLeaveApplication:M,fetchFileUpload:R,uploadLeaveApplicationAttachment:B,fetchYearlyUserLeaveApplications:b,getMonthlyApplicationLog:S,storeAdminLeaveApplication:D,leave_balances:w,getMonthlyApplicationSummary:_}});export{X as u};
