import{H as E,r as d,y as i,I as f}from"./index-o7WSkoLO.js";const _=E("task",()=>{const o=d([]),v=d(null),n=d(!1),u=d(null),p=async(a,l)=>{var s,t;n.value=!0,u.value=null;try{await f.post(`/tasks/${a}/assign-users`,{user_ids:l}),await h(a)}catch(r){throw u.value=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Assign users failed",r}finally{n.value=!1}},y=async(a,l={loadingBeforeFetch:!0})=>{var s,t,r;l.loadingBeforeFetch&&(n.value=!0),u.value=null;try{const e=await f.get("/tasks",{params:a});o.value=((s=e.data)==null?void 0:s.tasks)||[]}catch(e){u.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",e)}finally{n.value=!1}};function k(a,l=0){return Array.isArray(a)===!1||a.length===0?[]:a.filter(s=>s.parent_id===l).map(s=>({...s,children_tasks:k(a,s.id)}))}function g(){return k(o.value,0)}function T(){const a=[],l=(s,t=0,r="")=>{s.forEach(e=>{a.push({...e,depth:t,idPath:r+e.id}),e.children_tasks&&e.children_tasks.length&&l(e.children_tasks,t+1,r+e.id+"-")})};return l(g()),a}const h=async(a,l={},s={loadingBeforeFetch:!0})=>{var t,r,e;s.loadingBeforeFetch&&(n.value=!0),u.value=null;try{const c=await f.get(`/tasks/${a}`,{params:l});return v.value=((t=c.data)==null?void 0:t.task)||{},c.data}catch(c){u.value=((e=(r=c.response)==null?void 0:r.data)==null?void 0:e.message)||`টাস্ক (ID: ${a}) লোড করতে ব্যর্থ হয়েছে।`,console.error(`Error fetching task with id ${a}:`,c)}finally{n.value=!1}},w=async a=>{var l,s,t,r;n.value=!0,u.value=null;try{const e=await f.post("/tasks",a);return(l=e.data)!=null&&l.data&&o.value.push((s=e.data)==null?void 0:s.data),e.data.data}catch(e){u.value=((r=(t=e.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",e)}finally{n.value=!1}},$=async(a,l)=>{var s,t;n.value=!0,u.value=null;try{const r=await f.put(`/tasks/${a}`,l),e=o.value.findIndex(c=>c.id===a);return e!==-1&&(o.value[e]=r.data.data),r.data.data}catch(r){u.value=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||`টাস্ক (ID: ${a}) আপডেট করতে ব্যর্থ হয়েছে।`,console.error(`Error updating task with id ${a}:`,r)}finally{n.value=!1}},m=async a=>{var l,s;n.value=!0,u.value=null;try{await f.delete(`/tasks/${a}`),o.value=o.value.filter(t=>t.id!==a)}catch(t){u.value=((s=(l=t.response)==null?void 0:l.data)==null?void 0:s.message)||`টাস্ক (ID: ${a}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${a}:`,t)}finally{n.value=!1}};return{tasks:i(()=>o.value),task:i(()=>v.value),loading:i(()=>n.value),error:i(()=>u.value),taskListTree:i(g),flattenedTasks:i(T),fetchTasks:y,fetchTask:h,createTask:w,updateTask:$,deleteTask:m,assignUsers:p}});export{_ as u};
