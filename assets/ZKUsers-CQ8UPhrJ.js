import{M as P,r as v,C as g,D as E,m as K,z as Z,c as k,g as j,o as y,a as e,t as f,w as q,h as w,v as C,a2 as F,x as L,B as $,e as R,p as _,f as O,k as x,F as D,q as S,K as T}from"./index-DvNPcaBE.js";import{u as G}from"./device-DH-atiT9.js";import{L as H}from"./LoaderView-DuQT9e8H.js";import{_ as J,a as Q}from"./HeaderWithButtons-C3h4zNBQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const M=P("zkUser",()=>{const U=v([]),i=v(!1),u=v(null);async function c(){var r,l;i.value=!0,u.value=null;try{const s=await g.get("/zk-users");U.value=s.data}catch(s){u.value=((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.message)||s.message}finally{i.value=!1}}async function d(r){var l;try{const s=await g.post("/zk-users",r);return await c(),s.data}catch(s){throw((l=s.response)==null?void 0:l.data)||s}}async function o(r,l){var s;try{const a=await g.put(`/zk-users/${r}`,l);return await c(),a.data}catch(a){throw((s=a.response)==null?void 0:s.data)||a}}async function b(r){var l;try{const s=await g.delete(`/zk-users/${r}`);return await c(),s.data}catch(s){throw((l=s.response)==null?void 0:l.data)||s}}async function p(r,l){var s;try{return(await g.post("/zk-users/bulk-push",{device_id:r,user_ids:l})).data}catch(a){throw((s=a.response)==null?void 0:s.data)||a}}return{users:U,loading:i,error:u,fetchUsers:c,createUser:d,updateUser:o,deleteUser:b,bulkPush:p}}),W={key:0,class:"modal-bg"},X={class:"modal-card"},Y={class:"text-xl font-bold mb-4 text-center"},ee={class:"relative"},se=["type"],te={class:"flex justify-end gap-4 mt-4"},oe={__name:"ZKUserModal",props:{editUser:Object,show:Boolean},emits:["close","saved"],setup(U,{emit:i}){const u=i,c=U,d=M(),o=E({zk_userid:"",name:"",password:"",role:0,cardno:""}),b=K(()=>!!c.editUser),p=v(!1);Z(()=>c.editUser,l=>{l?(o.zk_userid=l.zk_userid||"",o.name=l.name||"",o.password=l.password||"",o.role=l.role||0,o.cardno=l.cardno||""):(o.zk_userid="",o.name="",o.password="",o.role=0,o.cardno="")},{immediate:!0});const r=async()=>{const l={...o};b.value?await d.updateUser(c.editUser.id,l):await d.createUser(l),u("saved"),u("close")};return(l,s)=>U.show?(y(),k("div",W,[e("div",X,[e("h2",Y,f(b.value?"Edit User":"Add User"),1),e("form",{onSubmit:q(r,["prevent"]),class:"space-y-4"},[e("div",null,[s[7]||(s[7]=e("label",{class:"block"},"User ID",-1)),w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>o.zk_userid=a),type:"text",class:"input-1",required:""},null,512),[[C,o.zk_userid]])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block"},"Name",-1)),w(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.name=a),type:"text",class:"input-1",required:""},null,512),[[C,o.name]])]),e("div",null,[s[9]||(s[9]=e("label",{class:"block"},"Password",-1)),e("div",ee,[w(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>o.password=a),type:p.value?"text":"password",class:"input-1"},null,8,se),[[F,o.password]]),e("span",{class:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:s[3]||(s[3]=a=>p.value=!p.value)},[e("i",{class:L(p.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block"},"Role",-1)),w(e("select",{"onUpdate:modelValue":s[4]||(s[4]=a=>o.role=a),class:"input-1"},s[10]||(s[10]=[e("option",{value:0},"User",-1),e("option",{value:14},"Admin",-1)]),512),[[$,o.role]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block"},"Card No",-1)),w(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>o.cardno=a),type:"text",class:"input-1"},null,512),[[C,o.cardno]])]),e("div",te,[e("button",{type:"button",onClick:s[6]||(s[6]=a=>u("close")),class:"px-4 py-2 bg-gray-500 text-white rounded"}," Cancel "),s[13]||(s[13]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded"},"Save",-1))])],32)])])):j("",!0)}},le={class:"my-container space-y-4"},ae={key:1,class:"overflow-x-auto card-bg"},ne={class:"min-w-full text-sm text-left text-gray-700"},re={class:"bg-gray-200 uppercase text-xs text-gray-600 tracking-wider"},ie={class:"p-3"},de={class:"p-3"},ue=["value"],ce={class:"p-3"},pe={class:"p-3"},ve={class:"p-3 font-medium"},me={class:"p-3 font-medium"},fe={class:"p-3"},be={class:"p-3 space-x-6"},ye=["onClick"],ke=["onClick"],we={class:"card-bg p-4 md:p-6 space-y-4"},Ue=["disabled"],ge=["value"],xe={class:"flex justify-center"},he=["disabled"],$e={__name:"ZKUsers",setup(U){const i=M(),u=G(),c=v(""),d=v([]),o=v(!1),b=v(null),p=v(!1),r=v(null);R(()=>{i.fetchUsers(),u.fetchDevices()});function l(){b.value=null,o.value=!0}function s(m){b.value={...m},o.value=!0}function a(){o.value=!1}function V(){i.fetchUsers(),a()}function N(m){r.value=m,p.value=!0}async function A(){await i.deleteUser(r.value),r.value=null,p.value=!1,i.fetchUsers()}async function B(){const m=prompt("Enter Device ID to push selected users:");m&&(await i.bulkPush(Number(m),d.value),d.value=[])}function I(m){m.target.checked?d.value=i.users.map(t=>t.id):d.value=[]}return(m,t)=>(y(),k(D,null,[e("div",le,[_(J,{title:"ZK User Management",onAdd:l}),x(i).loading?(y(),O(H,{key:0})):(y(),k("div",ae,[e("table",ne,[e("thead",re,[e("tr",null,[e("th",ie,[e("input",{type:"checkbox",onChange:t[0]||(t[0]=n=>I(n))},null,32)]),t[4]||(t[4]=e("th",{class:"p-3"},"ID",-1)),t[5]||(t[5]=e("th",{class:"p-3"},"Device User ID",-1)),t[6]||(t[6]=e("th",{class:"p-3"},"Name (Software)",-1)),t[7]||(t[7]=e("th",{class:"p-3"},"Name (Device)",-1)),t[8]||(t[8]=e("th",{class:"p-3"},"Fingers",-1)),t[9]||(t[9]=e("th",{class:"p-3"},"Role",-1)),t[10]||(t[10]=e("th",{class:"p-3"},"Actions",-1))])]),e("tbody",null,[(y(!0),k(D,null,S(x(i).users,n=>{var z;return y(),k("tr",{key:n.id,class:"border-b hover:bg-gray-50 transition-colors duration-150"},[e("td",de,[w(e("input",{type:"checkbox",value:n.id,"onUpdate:modelValue":t[1]||(t[1]=h=>d.value=h)},null,8,ue),[[T,d.value]])]),e("td",ce,f(n.zk_uid),1),e("td",pe,f(n.zk_userid),1),e("td",ve,f((z=n==null?void 0:n.user)==null?void 0:z.name),1),e("td",me,f(n.name),1),e("td",fe,f(n.fingerprints_count),1),e("td",be,[e("button",{onClick:h=>s(n),class:"text-blue-600 hover:text-blue-800 font-semibold"},t[11]||(t[11]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ye),e("button",{onClick:h=>N(n.id),class:"text-red-600 hover:text-red-800 font-semibold"},t[12]||(t[12]=[e("i",{class:"fas fa-trash"},null,-1)]),8,ke)])])}),128))])])])),e("div",we,[e("div",null,[t[14]||(t[14]=e("h2",{class:"text-lg font-semibold"},"Bulk Actions",-1)),e("p",null,"Selected Users: "+f(d.value.length),1),t[15]||(t[15]=e("label",{class:"block text-gray-700 font-medium mb-1"},"Select Device",-1)),w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>c.value=n),class:"input-1",disabled:x(u).loading},[t[13]||(t[13]=e("option",{disabled:"",value:""},"-- Choose a device --",-1)),(y(!0),k(D,null,S(x(u).devices,n=>(y(),k("option",{key:n.id,value:n.id},f(n.name)+" ("+f(n.ip_address)+") ",9,ge))),128))],8,Ue),[[$,c.value]])]),e("div",xe,[e("button",{onClick:B,class:"btn-2",disabled:d.value.length===0}," Push Selected ",8,he)])])]),_(oe,{show:o.value,editUser:b.value,onClose:a,onSaved:V},null,8,["show","editUser"]),_(Q,{show:p.value,title:"Confirm Deletion",message:"Are you sure you want to delete this user?",onClose:t[3]||(t[3]=n=>p.value=!1),onConfirm:A},null,8,["show"])],64))}};export{$e as default};
