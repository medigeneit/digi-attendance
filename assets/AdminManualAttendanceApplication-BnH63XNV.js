import{u as J,f as Y,r as u,x as $,h as G,q as M,c as n,o as i,a as t,d as x,l as X,m as D,j as h,s as B,t as N,F as Z,e as ee,k as c,P,w as y,v as w,H as te,b as le}from"./index-BvQkN2MQ.js";import{_ as oe}from"./EmployeeFilter-DUZEEsle.js";import{_ as se}from"./FlexibleDatePicker-DmmArVI2.js";import{L as ae}from"./LoaderView-ClTZfY9Q.js";import{S as ne}from"./SelectedEmployeeCard-D3k7_D30.js";import{u as ie}from"./manual-attendance-DwI9u50V.js";import{u as re}from"./user-CdhbaEqD.js";import"./company-DI96fVYT.js";import"./department-COD6jg5B.js";import"./EmployeeDropdownInput-D66NUYcd.js";import"./SelectDropdown-C8mvIR8a.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-4anII6Cq.js";const de={class:"space-y-2 px-4"},ue={class:"flex flex-wrap gap-2 py-2"},pe={key:0,class:"text-center py-4"},ce={key:1,class:"space-y-4"},ye={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},me={class:"overflow-x-auto"},_e={key:0,class:"text-red-500 text-sm text-left"},ve={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},be={class:"bg-gray-200"},fe={class:"border border-gray-300 px-2 text-left py-2"},he={class:"flex items-center justify-center gap-2"},ge=["onClick"],ke={class:"border border-gray-300 px-2 cursor-pointer text-center"},xe=["onUpdate:modelValue"],we={class:"border border-gray-300 px-2"},Ae=["onUpdate:modelValue"],Se={class:"border border-gray-300 px-2"},Ce=["onUpdate:modelValue"],Ue={class:"border border-gray-300 px-2"},Ve=["onUpdate:modelValue"],Me={class:"border border-gray-300 px-2"},qe=["onUpdate:modelValue"],Fe={class:"border border-gray-300 px-2"},Te=["onUpdate:modelValue","disabled"],$e={key:0},De={key:1},Be={class:"space-y-6"},Ne={key:0,class:"text-red-500 text-sm text-left"},Pe={class:"flex items-center justify-center gap-2 cursor-pointer"},je={class:"flex justify-center"},Oe=["disabled"],Ee={key:0},Re={key:1},lt={__name:"AdminManualAttendanceApplication",setup(He){const q=J(),b=Y(),r=ie(),j=re(),A=b.query.date||r.selectedMonth||new Date().toISOString().slice(0,7),f=u(A),m=u([]),p=u(!1),d=u(null),S=u(!0),o=u({company_id:b.query.company_id||"",department_id:b.query.department_id||"",line_type:b.query.line_type||"all",employee_id:b.query.employee_id||""}),O=s=>s.toString().padStart(2,"0"),_=u({year:Number(A.split("-")[0]||new Date().getFullYear()),month:Number(A.split("-")[1]||new Date().getMonth()+1),day:1}),C=$(()=>{var s,e;return!((s=_.value)!=null&&s.year)||!((e=_.value)!=null&&e.month)?"":`${_.value.year}-${O(_.value.month)}`}),F=async()=>{const s={company_id:o.value.company_id,department_id:o.value.department_id,line_type:o.value.line_type,selectedMonth:f.value,selectedStatus:r.selectedStatus};if(o.value.employee_id){s.user_id=o.value.employee_id,p.value=!0;try{await r.fetchAdminManualAttendances(s)}finally{p.value=!1}}else typeof r.setAttendances=="function"?r.setAttendances([]):r.attendances=[]};function E(){const s={};return f.value&&(s.date=String(f.value)),o.value.company_id&&(s.company_id=String(o.value.company_id)),o.value.department_id&&(s.department_id=String(o.value.department_id)),o.value.line_type&&o.value.line_type!=="all"&&(s.line_type=String(o.value.line_type)),o.value.employee_id&&(s.employee_id=String(o.value.employee_id)),s}let U=null;function R(){U&&clearTimeout(U),U=setTimeout(()=>{q.replace({query:E()}).catch(()=>{})},120)}let V=null;const T=u("");async function H(){R();const s=JSON.stringify({m:f.value||"",c:o.value.company_id||"",d:o.value.department_id||"",t:o.value.line_type||"all",e:o.value.employee_id||""});s!==T.value&&(await F(),T.value=s)}function g(){V&&clearTimeout(V),V=setTimeout(H,200)}G(async()=>{await j.fetchUsers(),g()});function L(){g()}function I(){q.go(-1)}M(C,()=>{f.value=C.value,g()}),M(()=>({...o.value,month:C.value}),()=>g(),{deep:!0});const K=$(()=>r.attendances||[]);M(()=>r.attendances,s=>{m.value=[],(s||[]).forEach(e=>{m.value.push({date:e==null?void 0:e.date,type:"Forget Punch",check_in:e==null?void 0:e.entry_time,check_out:e==null?void 0:e.exit_time,description:"",is_check:!1})})},{immediate:!0,deep:!0});function Q(){const s=m.value.every(e=>e.is_check);m.value.forEach(e=>{e.is_check=!s})}async function W(){var s;if(p.value=!0,d.value=null,!o.value.employee_id){d.value="Please select an employee.",p.value=!1;return}try{const e=m.value.filter(l=>l.is_check&&(l.check_in||l.check_out));if(!e.length){d.value="Please select at least one row.";return}const k=e.map(l=>({user_id:o.value.employee_id,type:l.type,check_in:l.check_in?`${l.date} ${l.check_in}:00`:null,check_out:l.check_out?`${l.date} ${l.check_out}:00`:null,description:l.description||""})),v=await r.createBulkManualAttendance({records:k,direct_approve:S.value});(s=v==null?void 0:v.data)!=null&&s.length&&await F()}catch(e){d.value=(e==null?void 0:e.message)||"Failed to submit manual attendance requests."}finally{p.value=!1}}return(s,e)=>{var k,v;return i(),n("div",de,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:I},e[13]||(e[13]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[14]||(e[14]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Admin Bulk Manual Attendance Applications",-1)),e[15]||(e[15]=t("div",null,null,-1))]),t("div",ue,[x(oe,{company_id:o.value.company_id,"onUpdate:company_id":e[1]||(e[1]=l=>o.value.company_id=l),department_id:o.value.department_id,"onUpdate:department_id":e[2]||(e[2]=l=>o.value.department_id=l),employee_id:o.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=l=>o.value.employee_id=l),line_type:o.value.line_type,"onUpdate:line_type":e[4]||(e[4]=l=>o.value.line_type=l),"with-type":!0,"initial-value":s.$route.query,onFilterChange:L},{default:X(()=>[t("div",null,[x(se,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value=l),"show-year":!1,"show-month":!0,"show-date":!1},null,8,["modelValue"])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])]),D(r).loading?(i(),n("div",pe,[x(ae)])):(i(),n("div",ce,[(k=o.value)!=null&&k.employee_id?(i(),n("div",ye,[x(ne,{user:D(r).user},null,8,["user"])])):h("",!0),t("div",me,[t("div",{class:B(d.value?"py-2":"")},[d.value?(i(),n("div",_e,N(d.value),1)):h("",!0)],2),t("table",ve,[t("thead",null,[t("tr",be,[t("th",fe,[t("div",he,[t("input",{id:"allCheck",type:"checkbox",onChange:Q,class:"h-5 w-5 accent-blue-600 cursor-pointer"},null,32),e[16]||(e[16]=t("label",{for:"allCheck",class:"text-sm cursor-pointer"},"All Check",-1))])]),e[17]||(e[17]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Date",-1)),e[18]||(e[18]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Type",-1)),e[19]||(e[19]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Check-In",-1)),e[20]||(e[20]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Check-Out",-1)),e[21]||(e[21]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Description",-1))])]),t("tbody",null,[(i(!0),n(Z,null,ee(m.value,(l,z)=>(i(),n("tr",{key:z,class:B(["border-b border-gray-200 hover:bg-blue-200 cursor-pointer",l.is_check?"bg-yellow-100":""]),onClick:a=>l.is_check=!l.is_check},[t("td",ke,[c(t("input",{type:"checkbox","onUpdate:modelValue":a=>l.is_check=a,class:"h-5 w-5",onClick:e[5]||(e[5]=y(()=>{},["stop"]))},null,8,xe),[[P,l.is_check]])]),t("td",we,[c(t("input",{type:"date","onUpdate:modelValue":a=>l.date=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[6]||(e[6]=y(()=>{},["stop"]))},null,8,Ae),[[w,l.date]])]),t("td",Se,[c(t("select",{"onUpdate:modelValue":a=>l.type=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[7]||(e[7]=y(()=>{},["stop"]))},e[22]||(e[22]=[t("option",{value:""},"Select Type",-1),t("option",{value:"Home Office"},"Home Office",-1),t("option",{value:"Remote Work"},"Remote Work",-1),t("option",{value:"Forget Punch"},"Forget Punch",-1)]),8,Ce),[[te,l.type]])]),t("td",Ue,[c(t("input",{type:"time","onUpdate:modelValue":a=>l.check_in=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[8]||(e[8]=y(()=>{},["stop"]))},null,8,Ve),[[w,l.check_in]])]),t("td",Me,[c(t("input",{type:"time","onUpdate:modelValue":a=>l.check_out=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[9]||(e[9]=y(()=>{},["stop"]))},null,8,qe),[[w,l.check_out]])]),t("td",Fe,[c(t("textarea",{"onUpdate:modelValue":a=>l.description=a,onKeyup:e[10]||(e[10]=y(()=>{},["stop"])),onClick:e[11]||(e[11]=y(()=>{},["stop"])),disabled:!l.check_in&&!l.check_out,class:"w-full border border-gray-600 py-1 px-2 rounded-sm disabled:bg-gray-300 disabled:cursor-not-allowed",cols:"1"},null,40,Te),[[w,l.description]])])],10,ge))),128)),K.value.length===0?(i(),n("tr",$e,e[23]||(e[23]=[t("td",{colspan:"6",class:"p-2 text-center text-red-500"},"Please select any employee",-1)]))):h("",!0)])])]),(v=o.value)!=null&&v.employee_id?(i(),n("div",De,[t("div",Be,[d.value?(i(),n("div",Ne,N(d.value),1)):h("",!0),t("div",Pe,[c(t("input",{id:"directApprove",type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=l=>S.value=l),class:"accent-blue-600 h-6 w-6 cursor-pointer"},null,512),[[P,S.value]]),e[24]||(e[24]=t("label",{for:"directApprove",class:"text-lg cursor-pointer"},"Direct Approve",-1))]),t("div",je,[t("button",{type:"button",class:"btn-2",disabled:p.value,onClick:W},[p.value?(i(),n("span",Ee,e[25]||(e[25]=[t("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),le("Submitting...")]))):(i(),n("span",Re,"Submit All"))],8,Oe)])])])):h("",!0)]))])}}};export{lt as default};
