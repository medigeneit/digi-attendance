import{o as m}from"./url-CePbr-gY.js";import{Q as l,S as C,r as p,m as T}from"./index-fLGF1t2u.js";async function G(s,{params:o={}}={}){return l.get(`/todos/${s}/settings`,{params:o})}async function H(s,o){return l.post(`/todos/${s}/settings`,o)}async function I(s,o,{params:i={}}={}){const u=m(i);return l.delete(`/todos/${s}/settings/${o}${u?`?${u}`:""}`)}async function F({params:s={}}={}){return l.get("/todo-dates",{params:s})}async function L(s){return l.post("/todo-dates",s)}async function N(s,o){return l.get(`/todo-dates/${s}`,o)}async function P(s,o){return l.patch(`/my-todo-dates/${s}/status`,o)}async function k(s,{params:o={}}={}){const i=m(o);return l.delete(`/todo-dates/${s}${i?"?"+i:""}`)}const J=C("todo-date",()=>{const s=p(null),o=p(!1),i=p(!1),u=p(null),d=p([]),w=()=>s.value=[],_=async t=>{var a,n,r;o.value=!0,u.value=null;try{const e=await F({params:t});d.value=((a=e.data)==null?void 0:a.todo_dates)||[],v()}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"TodoDates load failed",e}finally{o.value=!1}};function v(){d.value=[...d.value.sort((t,a)=>(t==null?void 0:t.user_id)!==(a==null?void 0:a.user_id)?(t==null?void 0:t.user_id)-(a==null?void 0:a.user_id):t.priority!==a.priority?t.priority-a.priority:a.id-t.id)]}const $=async t=>{var a,n,r;o.value=!0,u.value=null;try{const e=await l.get("/my-todo-dates",{params:t});d.value=((a=e.data)==null?void 0:a.todo_dates)||[],v()}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"TodoDates load failed",e}finally{o.value=!1}},S=t=>{var a;return(a=d.value)==null?void 0:a.filter(n=>n.date==t)},q=async t=>{var a,n;o.value=!0,u.value=null;try{const r=await N(t);s.value=r.data.todo_date}catch(r){throw u.value=((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Todo load failed",r}finally{o.value=!1}},M=async t=>{var a,n,r;o.value=!0,u.value=null;try{const e=await L(t);return d.value=[...d.value,(a=e.data)==null?void 0:a.todo_date],v(),e.data}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo create failed",e}finally{o.value=!1}},Q=t=>{d.value=[...d.value,t],v()},D=async(t,a)=>{var n,r;o.value=!0,u.value=null;try{const e=await D(t,a);return d.value=d.value.map(c=>{var h,f,y,g;return c.id==((f=(h=e.data)==null?void 0:h.todo)==null?void 0:f.id)?c.user?{...(y=e.data)==null?void 0:y.todo,user:{...c.user}}:{...(g=e.data)==null?void 0:g.todo}:{...c}}),e.data}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo update failed",e}finally{o.value=!1}},b=async(t,a)=>{var n,r;o.value=!0,u.value=null;try{await P(t,{status:a}),d.value=d.value.map(e=>e.id===t?{...e,status:a}:{...e})}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to update todo status",e}finally{o.value=!1}},j=async(t,{date:a}={})=>{var n,r;o.value=!0,i.value=!0,u.value=null;try{const e=await l.put("/my-todo-dates/rearrange",{ids:t,date:a});d.value=d.value.map(c=>{var y;const f=(((y=e.data)==null?void 0:y.changes)||[]).find(g=>g.id==c.id);return f?{...c,priority:f.priority}:c}),v()}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo rearranging failed",e}finally{i.value=!0,o.value=!1}};async function x(t){var a,n;o.value=!0,u.value=null;try{await k(t),d.value=d.value.filter(r=>r.id!==t)}catch(r){throw u.value=((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Todo delete failed",r}finally{o.value=!1}}return{loading:T(()=>o.value),error:T(()=>u.value),todo_dates:T(()=>d.value),todo_date:T(()=>s.value),fetchTodoDates:_,fetchTodoDate:q,createTodoDate:M,updateTodoDate:D,rearrangeMyTodoDates:j,deleteTodoDate:x,fetchMyTodoDates:$,updateStatus:b,getTodoDatesByDate:S,setNewTodoDate:Q,emptyTodoDates:w}});export{H as a,I as d,G as f,J as u};
