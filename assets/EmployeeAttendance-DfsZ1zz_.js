import{u as te,f as se,r as b,x as K,q as A,h as ne,A as oe,p as re,c as m,o as d,a as t,d as k,j as z,i as Q,k as ae,l as G,b as c,t as u,m as l,J as le}from"./index-B5bk4ZAj.js";import{_ as ie}from"./AttendanceTable-CFxs7wWC.js";import{_ as de}from"./EmployeeFilter-Cezb1Vnl.js";import{_ as ue}from"./FlexibleDatePicker-BzARoznA.js";import{L as pe}from"./LoaderView-BTQ5SK5f.js";import{S as me}from"./SelectedEmployeeCard-CLWhyME-.js";import{u as ce}from"./attendance-BOx8mSIo.js";import{u as ye}from"./user-e9nRjoMg.js";import"./datetime-BEfC2TVK.js";import"./company-CMArcOv_.js";import"./department-DU_Arbru.js";import"./EmployeeDropdownInput-Fl-m6CTj.js";import"./SelectDropdown-DXPP342P.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-XhBebWh0.js";const fe={class:"px-4 space-y-4"},xe={class:"relative"},_e={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl"},ge={class:"grid md:grid-cols-2 gap-4 text-sm mt-2"},ve={key:1,class:"card-bg p-4 gap-1"},be={class:"flex justify-between items-center"},he={class:"px-1 pt-1 pb-0.5 overflow-hidden"},we={class:"-mx-1 flex items-center gap-2 overflow-x-auto px-1"},ke={key:0,class:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-0.5 text-[11px] font-medium text-emerald-700 whitespace-nowrap"},ze={class:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2.5 py-0.5 text-[11px] font-medium text-amber-700 whitespace-nowrap"},Se={class:"inline-flex items-center gap-1 rounded-full border border-red-200 bg-red-50 px-2.5 py-0.5 text-[11px] font-medium text-red-700 whitespace-nowrap"},$e={class:"inline-flex items-center gap-1 rounded-full border border-sky-200 bg-sky-50 px-2.5 py-0.5 text-[11px] font-medium text-sky-700 whitespace-nowrap"},Me={class:"grid md:grid-cols-3 gap-2 mt-1"},Ae={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Ue={class:"text-sm text-zinc-900"},qe={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Ce={class:"text-sm text-zinc-900"},Ne={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},je={key:0,class:"text-sm text-zinc-900"},Be={key:1,class:"inline-block h-4 w-28 rounded bg-zinc-200 animate-pulse"},Fe={key:0},Te={key:2,class:"space-y-4"},et={__name:"EmployeeAttendance",setup(Le){const U=te(),q=se(),r=ce(),C=ye(),y=new Date,_=s=>{if(!s)return"";if(typeof s=="string"){if(/^\d{4}-\d{2}$/.test(s))return s;const e=s.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(s),o=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0");return`${o}-${a}`}catch{return""}},g=q.query,v=b(_(g.date)||_(r.selectedMonth)||_(y)),f=b({...((s,e)=>{const o=_(s)||_(e);if(!o)return{year:y.getFullYear(),month:y.getMonth()+1};const[a,p]=o.split("-");return{year:Number(a)||y.getFullYear(),month:Number(p)||y.getMonth()+1}})(v.value,y),day:1}),X=K(()=>{var e,o;if(!((e=f.value)!=null&&e.year)||!((o=f.value)!=null&&o.month))return"";const s=String(f.value.month).padStart(2,"0");return`${f.value.year}-${s}`}),n=b({company_id:g.company_id||"",department_id:g.department_id||"all",line_type:g.line_type||"all",employee_id:g.employee_id||""}),x=b(null);let S=null;const h=(s={})=>{S&&clearTimeout(S),S=setTimeout(()=>{const e={...q.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:v.value||"",...s};Object.keys(e).forEach(o=>{(e[o]===""||e[o]===void 0||e[o]===null)&&delete e[o]}),U.replace({query:e}).catch(()=>{})},150)},N=async s=>{if(!s){x.value=null;return}try{await C.fetchUser(s),x.value=C.user||null}catch(e){console.error("fetchUser error:",e),x.value=null}},w=b(""),$=async()=>{const s=n.value.employee_id,e=v.value;if(!s||!e)return;const o=`${s}|${e}`;if(o!==w.value){w.value=o;try{await r.getMonthlyAttendanceByShift(s,e)}catch(a){console.error("fetchAttendance error:",a),w.value=""}}};A(X,s=>{s&&(v.value=s,h({date:s}),n.value.employee_id&&$())}),A(()=>({...n.value}),()=>{h()}),A(()=>n.value.employee_id,async(s,e)=>{s&&s!==e&&(await N(s),await $()),s||(x.value=null,w.value="")}),ne(async()=>{n.value.employee_id&&await N(n.value.employee_id),n.value.employee_id&&v.value&&await $(),await oe(),h()});const Z=()=>U.go(-1),I=()=>{h()},M=K(()=>!!n.value.employee_id),ee=s=>{const e=Number(s??0);if(!Number.isFinite(e)||e<=0)return"0h";const o=Math.round(e*60),a=Math.floor(o/60),p=o%60;return p?`${a}h ${p}m`:`${a}h`};return(s,e)=>{var a,p,j,B,F,T,L,D,H,V,E,P,W,R,Y,J,O;const o=re("router-link");return d(),m("div",fe,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:Z},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Job Card",-1)),e[7]||(e[7]=t("div",null,null,-1))]),k(de,{company_id:n.value.company_id,"onUpdate:company_id":e[1]||(e[1]=i=>n.value.company_id=i),department_id:n.value.department_id,"onUpdate:department_id":e[2]||(e[2]=i=>n.value.department_id=i),employee_id:n.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=i=>n.value.employee_id=i),line_type:n.value.line_type,"onUpdate:line_type":e[4]||(e[4]=i=>n.value.line_type=i),"with-type":!0,"initial-value":s.$route.query,onFilterChange:I,class:"w-full"},{default:G(()=>[t("div",xe,[e[8]||(e[8]=t("label",{for:"",class:"top-label -top-1"}," Month",-1)),k(ue,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=i=>f.value=i),"show-year":!1,"show-month":!0,"show-date":!1},null,8,["modelValue"])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",_e,[t("div",ge,[M.value?(d(),Q(me,{key:0,user:x.value},null,8,["user"])):z("",!0),M.value?(d(),m("div",ve,[t("div",be,[e[10]||(e[10]=t("h2",{class:"text-sm md:text-base font-semibold text-zinc-900"},"Attendance Summary",-1)),k(o,{to:{name:"MonthWiseApplicationLog",query:{...s.$route.query}},class:"inline-flex items-center gap-1 rounded-md border border-zinc-200 bg-white px-2.5 py-1 text-[12px] font-medium text-zinc-700 hover:bg-zinc-50 active:scale-[.99]",target:"_blank",rel:"noopener noreferrer"},{default:G(()=>e[9]||(e[9]=[t("i",{class:"far fa-clock text-[12px]"},null,-1),t("span",{class:"hidden sm:inline"},"Application History",-1),t("span",{class:"sm:hidden"},"History",-1)])),_:1,__:[9]},8,["to"])]),e[22]||(e[22]=t("div",{class:"h-px w-full bg-gradient-to-r from-indigo-500/70 via-sky-400/70 to-cyan-400/70"},null,-1)),t("div",he,[t("div",we,[s.presentRate!==null?(d(),m("span",ke,[e[11]||(e[11]=t("i",{class:"far fa-check-circle text-[11px]"},null,-1)),e[12]||(e[12]=c(" Present ")),t("strong",null,u(((p=(a=l(r))==null?void 0:a.summary)==null?void 0:p.total_present_days)||0)+"d",1)])):z("",!0),t("span",ze,[e[13]||(e[13]=t("i",{class:"far fa-clock text-[11px]"},null,-1)),e[14]||(e[14]=c(" Late ")),t("strong",null,u((B=(j=l(r))==null?void 0:j.summary)==null?void 0:B.actual_late_day)+"d",1)]),t("span",Se,[e[15]||(e[15]=t("i",{class:"far fa-user-times text-[11px]"},null,-1)),e[16]||(e[16]=c(" Absent ")),t("strong",null,u(((T=(F=l(r))==null?void 0:F.summary)==null?void 0:T.total_absent_days)||0)+"d",1)]),t("span",$e,[e[17]||(e[17]=t("i",{class:"far fa-bolt text-[11px]"},null,-1)),e[18]||(e[18]=c(" Total Weekends ")),t("strong",null,u((D=(L=l(r))==null?void 0:L.summary)==null?void 0:D.total_weekend_days)+"d",1)])])]),t("div",Me,[t("div",Ae,[e[19]||(e[19]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-briefcase text-[12px]"}),c(" Total Working Days ")],-1)),t("strong",Ue,u(((V=(H=l(r))==null?void 0:H.summary)==null?void 0:V.total_working_days)||0),1)]),t("div",qe,[e[20]||(e[20]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-hourglass-half text-[12px]"}),c(" Working Hours ")],-1)),t("strong",Ce,u((((P=(E=l(r))==null?void 0:E.summary)==null?void 0:P.total_working_hours)??"").toString().trim()||"â€”"),1)]),t("div",Ne,[e[21]||(e[21]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-bolt text-[12px]"}),c(" Overtime Hours ")],-1)),(W=l(r))!=null&&W.loading?(d(),m("span",Be)):(d(),m("strong",je,u(ee((Y=(R=l(r))==null?void 0:R.summary)==null?void 0:Y.approved_overtimes))+" of "+u((O=(J=l(r))==null?void 0:J.summary)==null?void 0:O.total_overtime_hours),1))])])])):z("",!0)])]),x.value?z("",!0):(d(),m("div",Fe,e[23]||(e[23]=[t("p",{class:"text-gray-400 text-center text-2xl italic"},"Select an employee, please.",-1)]))),l(r).isLoading?(d(),Q(pe,{key:1})):ae((d(),m("div",Te,[k(ie,{logs:l(r).monthlyLogs},null,8,["logs"])],512)),[[le,M.value]])])}}};export{et as default};
