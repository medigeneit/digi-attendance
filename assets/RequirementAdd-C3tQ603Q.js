import{r as C,e as E,A as I,c as x,o as u,a as e,t as q,w as _,h as R,j as $,p as d,v as S,i as k,f as U,g as w,k as h,B as L,F as D,y as O,u as z}from"./index-14LG4blP.js";import{_ as A}from"./CompanyDepartmentSelectInput-ifNgdVGD.js";import{R as N}from"./RequiredIcon-3ViSB0Xm.js";import{a as P}from"./requirement-CHJ_7e_e.js";import{u as W}from"./company-DYxGSeCF.js";import{u as G}from"./tags-WWovr67D.js";import{L as H}from"./LoaderView-CLK5bI2f.js";import{S as j}from"./SelectDropdown-DgkyDutT.js";import{T as J}from"./TextWithHr-CyhYLv6T.js";import{u as K}from"./user-DoSD_RMq.js";import{_ as M}from"./UserChip-Barf3oqI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Q(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(v){const m=Math.random()*16|0;return(v==="x"?m:m&3|8).toString(16)})}const X={class:"border-2 border-gray-800 text-left px-4 py-4 text-gray-800 print:text-black align-top"},Y={class:"font-semibold whitespace-nowrap text-2xl"},Z={class:"border-2 border-gray-800 px-2 pb-2 pt-8 text-gray-800 print:text-black text-base whitespace-nowrap"},ee={class:"mb-4"},te={class:"block text-gray-600 text-sm mb-1 font-medium"},se={class:""},oe={class:"border-2 border-gray-800 text-gray-800 print:text-black text-base px-3 whitespace-nowrap print:whitespace-normal print:p-0"},re={class:"mb-4"},le={class:"mb-4"},ie={__name:"RequirementFormDetailItem",props:{fromDepartmentId:{type:[Number,String],required:!0},serial:{type:Number,required:!0},uuid:{type:String,required:!0}},emits:["update","removeClick"],setup(v,{emit:m}){const n=v,b=m,a=K(),s=C({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:""});E(async()=>{await a.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"})});const f=()=>{confirm("Are you sure?")&&b("removeClick",n.uuid)};return I(()=>({...s.value}),r=>{b("update",{...r,uuid:n.uuid})}),(r,o)=>(u(),x("tr",null,[e("td",X,[e("div",Y,q(n.serial),1),e("button",{type:"button",onClick:_(f,["prevent"]),class:"btn-2-red mt-8"}," Remove ")]),e("td",Z,[e("div",ee,[e("label",te,[o[5]||(o[5]=$(" Title ")),d(N)]),R(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>s.value.title=l),required:"",placeholder:"Ender Requirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,s.value.title]])]),e("div",se,[o[6]||(o[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),R(e("textarea",{rows:"5","onUpdate:modelValue":o[1]||(o[1]=l=>s.value.description=l),placeholder:"Enter Requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,s.value.description]])]),o[7]||(o[7]=e("div",{class:"flex items-center justify-between h-full"},null,-1))]),e("td",oe,[e("div",re,[o[8]||(o[8]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),R(e("input",{type:"date","onUpdate:modelValue":o[2]||(o[2]=l=>s.value.better_to_complete_on=l),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,s.value.better_to_complete_on]])]),e("div",le,[o[9]||(o[9]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor ",-1)),d(j,{modelValue:s.value.supervisor_id,"onUpdate:modelValue":o[3]||(o[3]=l=>s.value.supervisor_id=l),options:h(a).users,placeholder:"--NO SUPERVISOR--",class:"h-10 w-full",clearable:""},{option:k(({option:l})=>[d(M,{user:l||{},class:"w-full overflow-hidden border relative"},null,8,["user"])]),"selected-option":k(({option:l})=>[l?(u(),U(M,{key:0,user:l||{}},null,8,["user"])):w("",!0)]),_:1},8,["modelValue","options"])]),e("div",null,[o[11]||(o[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),R(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 h-10","onUpdate:modelValue":o[4]||(o[4]=l=>s.value.priority=l)},o[10]||(o[10]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[L,s.value.priority]])])])]))}},ae={class:"w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},ne={class:"sticky top-0 pt-4 bg-white z-10"},ue={class:"block text-gray-600 text-sm mb-1 font-medium"},de={class:"block text-gray-600 text-sm mb-1 font-medium"},me={class:"mb-4 col-span-4"},pe={class:"col-span-full"},be={class:"mb-4 mt-5"},ce={class:"w-full table-auto print:table-fixed mt-8"},xe={class:"mb-4 rounded-md flex items-center justify-center"},fe={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ve={key:0,class:"mb-4 text-red-500 font-medium"},ye={key:1,class:"mb-4"},ge={class:"flex items-center justify-between gap-4"},_e=["disabled"],we={__name:"RequirementAddForm",emits:["create","cancelClick","error"],setup(v,{emit:m}){const n=m,b=G(),a=W(),s=C(""),f=C(""),r=C({from_department_id:"",to_department_id:"",website_tags:[],details:[]});E(async()=>{s.value="loading",b.fetchTags("website"),await a.fetchCompanies({with:"departments",ignore_permission:!0}),await a.fetchMyCompanies({with:"departments"}),s.value="",T()});async function o(){var t,p,y,g;s.value="submitting";const c={...r.value};try{const i=await P(c);n("create",i),s.value="create"}catch(i){n("error",(p=(t=i.response)==null?void 0:t.data)==null?void 0:p.message),f.value=(g=(y=i.response)==null?void 0:y.data)==null?void 0:g.message,s.value="error"}}function l(c,t){r.value.details=r.value.details.map(p=>p.uuid===c?(console.log({uuid:c}),{...p,...t}):{...p})}function B(c){r.value.details=r.value.details.filter(t=>t.uuid!==c)}function T(){r.value.details=[...r.value.details,{uuid:Q(),title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:"4"}]}return(c,t)=>{var p,y,g;return u(),x("div",ae,[e("div",ne,[t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Requirement",-1)),t[8]||(t[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=_(i=>n("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:_(o,["prevent"]),class:"z-0 grid grid-cols-8 gap-4"},[s.value!=="loading"&&s.value!=="submitting"?(u(),x(D,{key:0},[d(A,{modelValue:r.value.from_department_id,"onUpdate:modelValue":t[1]||(t[1]=i=>r.value.from_department_id=i),companies:((p=h(a))==null?void 0:p.myCompanies)||[],class:"mb-4 col-span-2",className:{select:"h-10"}},{label:k(()=>[e("label",ue,[t[9]||(t[9]=$(" From ")),d(N)])]),_:1},8,["modelValue","companies"]),d(A,{modelValue:r.value.to_department_id,"onUpdate:modelValue":t[2]||(t[2]=i=>r.value.to_department_id=i),companies:((y=h(a))==null?void 0:y.companies)||[],class:"mb-4 col-span-2",className:{select:"h-10"}},{label:k(()=>[e("label",de,[t[10]||(t[10]=$(" To ")),d(N)])]),_:1},8,["modelValue","companies"]),e("div",me,[t[11]||(t[11]=e("label",{class:"text-gray-800 text-sm"},"Websites",-1)),d(j,{options:h(b).tags,modelValue:r.value.website_tags,"onUpdate:modelValue":t[3]||(t[3]=i=>r.value.website_tags=i),taggable:"",label:"name",value:"name",class:"min-h-10 py-1"},null,8,["options","modelValue"])])],64)):w("",!0),e("div",pe,[e("div",be,[d(J,{class:"mb-5"},{default:k(()=>t[12]||(t[12]=[e("h3",{class:"font-semibold text-xl text-gray-800 mx-2"},"Requirement details",-1)])),_:1,__:[12]}),e("table",ce,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",{class:"border-2 border-gray-800 text-left px-4 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[5%]"}," SL "),e("th",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap w-[65%]"}," Requirement "),e("th",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Options ")])],-1)),e("tbody",null,[(u(!0),x(D,null,O(((g=r.value)==null?void 0:g.details)||[],(i,F)=>(u(),U(ie,{key:i.uuid,serial:F+1,uuid:i.uuid,"from-department-id":r.value.from_department_id,onUpdate:V=>l(i.uuid,V),onRemoveClick:t[4]||(t[4]=V=>B(V))},null,8,["serial","uuid","from-department-id","onUpdate"]))),128))])])]),e("div",xe,[e("button",{class:"btn-icon flex justify-center items-center",onClick:t[5]||(t[5]=_(()=>T(),["prevent"]))},t[14]||(t[14]=[e("i",{class:"fad fa-plus-circle text-2xl"},null,-1)]))]),e("div",fe,[f.value?(u(),x("div",ve,q(f.value),1)):w("",!0),f.value?(u(),x("hr",ye)):w("",!0),e("div",ge,[e("button",{type:"button",onClick:t[6]||(t[6]=_(i=>n("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:s.value=="loading"||s.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},q(s.value=="submitting"?"Saving...":"Save"),9,_e)])])])],32),s.value==="loading"||s.value==="submitting"?(u(),U(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):w("",!0)])}}},ke={class:"container mx-auto p-6"},Me={__name:"RequirementAdd",setup(v){const m=z();function n(b){var s;const a=((s=b.data)==null?void 0:s.requirement)||null;a&&m.push({name:"RequirementShow",params:{id:a.id}})}return(b,a)=>(u(),x("div",ke,[d(we,{onCreate:n,onCancelClick:a[0]||(a[0]=s=>h(m).back())})]))}};export{Me as default};
