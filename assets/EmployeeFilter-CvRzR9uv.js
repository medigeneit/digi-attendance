import{D as $,r as _,x as h,h as L,q as m,c as u,o as p,a as i,k as w,d as S,m as c,t as y,w as P,N as R}from"./index-cDReJAxe.js";import{u as G}from"./company-Cv20eCG5.js";import{u as H}from"./department-DF6r79XD.js";import{_ as J}from"./EmployeeDropdownInput-DNnPS9nt.js";import{S as T}from"./SelectDropdown-fs5gBbHR.js";const K={class:"grid grid-cols-1 md:grid-cols-5 gap-2"},Q={class:"relative"},W=["title"],X={key:0},Y={key:1,class:"text-gray-500 whitespace-nowrap"},Z=["title"],ee={class:"relative"},te=["title"],le={key:0},ae={key:1,class:"text-gray-500 whitespace-nowrap"},ie=["title"],se={key:0,class:"absolute inset-0 bg-white/50 cursor-not-allowed rounded","aria-hidden":"true"},ne={key:0,class:"relative"},de={key:0,class:"relative w-full pr-6"},re={class:"flex items-center gap-2 text-sm text-gray-700"},oe={class:"line-clamp-1"},ue={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},pe=["title"],me={class:"relative"},ce={class:"relative"},ge={__name:"EmployeeFilter",props:{company_id:{type:[String,Number],default:""},department_id:{type:[String,Number],default:""},employee_id:{type:[String,Number],default:""},line_type:{type:String,default:"all"},withType:{type:Boolean,default:!0},initialValue:{type:Object,default:()=>({})}},emits:["update:company_id","update:department_id","update:employee_id","update:line_type","filter-change"],setup(k,{expose:z,emit:O}){const a=k,r=O,f=G(),D=H(),{companies:U}=$(f),{departments:C}=$(D),o=_(String(a.company_id||a.initialValue.company_id||"")),n=_(a.department_id!==""?String(a.department_id):a.initialValue.department_id&&a.initialValue.department_id!=="all"?String(a.initialValue.department_id):""),s=_(a.withType?String(a.line_type||a.initialValue.line_type||"all"):null),d=_(String(a.employee_id||a.initialValue.employee_id||"")),A=h(()=>(U.value||[]).map(t=>({id:String(t.id),label:t.name}))),F=h(()=>(C.value||[]).map(t=>({id:String(t.id),label:t.name}))),M=h(()=>a.withType?[{id:"all",label:"All Types"},{id:"executive",label:"Executive"},{id:"support_staff",label:"Support Staff"},{id:"doctor",label:"Doctor"},{id:"academy_body",label:"Academy Body"}]:[]),E=h(()=>f.employees||[]),b=_([]);L(async()=>{await f.fetchCompanies({ignore_permission:!1}),o.value&&await N(o.value),g(),j()}),m(()=>a.company_id,t=>{const l=String(t||"");l!==o.value&&(o.value=l)}),m(()=>a.department_id,t=>{const l=t===""||t==null?"":String(t);l!==n.value&&(n.value=l)}),m(()=>a.employee_id,t=>{const l=String(t||"");l!==d.value&&(d.value=l)}),m(()=>a.line_type,t=>{if(!a.withType)return;const l=String(t||"all");l!==s.value&&(s.value=l)}),m(o,async t=>{n.value="",d.value="",b.value=[],r("update:company_id",t||""),r("update:department_id",""),r("update:employee_id",""),t?await N(t):C.value=[],g(),x()}),m([n,s],()=>{r("update:department_id",n.value||""),a.withType&&r("update:line_type",s.value||"all"),g(),x()}),m(d,()=>{r("update:employee_id",d.value||""),x()});async function N(t){await Promise.all([D.fetchDepartments(t),f.fetchEmployee(t,{with:"department,company"})])}function B(t){return{...t,id:String(t.id),label:t.name||t.label||`${t.first_name??""} ${t.last_name??""}`.trim(),bn_name:t.bn_name}}function g(){let t=[...E.value];n.value&&n.value!=="all"&&(t=t.filter(e=>String(e.department_id)===String(n.value))),a.withType&&s.value&&s.value!=="all"&&(t=t.filter(e=>String(e.type)===String(s.value)));let l=t.map(B);if(d.value&&!l.some(v=>v.id===String(d.value))){const v=E.value.find(I=>String(I.id)===String(d.value));v&&(l=[B(v),...l])}b.value=l}function j(){r("update:company_id",o.value||""),r("update:department_id",n.value||""),a.withType&&r("update:line_type",s.value||"all"),r("update:employee_id",d.value||""),x()}let V=null;function x(){V&&clearTimeout(V),V=setTimeout(()=>r("filter-change",{company_id:o.value,department_id:n.value,line_type:s.value,employee_id:d.value}),0)}function q(){a.withType&&(s.value="all",g())}return z({employees:b}),(t,l)=>(p(),u("div",K,[i("div",Q,[S(T,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),options:A.value,class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white",clearable:""},{"selected-option":c(({option:e})=>[i("div",{class:"line-clamp-1 text-sm text-gray-900 md:max-w-[120px]",title:e==null?void 0:e.label},[e!=null&&e.label?(p(),u("span",X,y(e==null?void 0:e.label),1)):(p(),u("span",Y,"--Select Company--"))],8,W)]),option:c(({option:e})=>[i("div",null,[i("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},y(e.label),9,Z)])]),_:1},8,["modelValue","options"]),l[5]||(l[5]=i("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),i("div",ee,[S(T,{modelValue:n.value,"onUpdate:modelValue":l[1]||(l[1]=e=>n.value=e),options:F.value,class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white",clearable:""},{"selected-option":c(({option:e})=>[i("div",{class:"line-clamp-1 text-sm text-gray-900 md:max-w-[120px]",title:e==null?void 0:e.label},[e!=null&&e.label?(p(),u("span",le,y(e==null?void 0:e.label),1)):(p(),u("span",ae,"--Select Department--"))],8,te)]),option:c(({option:e})=>[i("div",null,[i("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},y(e.label),9,ie)])]),_:1},8,["modelValue","options"]),l[6]||(l[6]=i("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Department ",-1)),o.value?w("",!0):(p(),u("div",se))]),k.withType?(p(),u("div",ne,[S(T,{modelValue:s.value,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value=e),options:M.value,placeholder:"Select Type",class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white"},{"selected-option":c(({option:e})=>[e?(p(),u("div",de,[i("div",re,[i("div",oe,y(e==null?void 0:e.label),1)]),s.value&&s.value!=="all"?(p(),u("div",ue,[i("button",{onClick:l[2]||(l[2]=P(v=>q(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"}," Ã— ")])):w("",!0)])):w("",!0)]),option:c(({option:e})=>[i("div",null,[i("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},y(e.label),9,pe)])]),_:1},8,["modelValue","options"]),l[7]||(l[7]=i("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Line Type ",-1))])):w("",!0),i("div",me,[S(J,{employees:b.value,modelValue:d.value,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value=e),class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white"},null,8,["employees","modelValue"]),l[8]||(l[8]=i("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))]),i("div",ce,[R(t.$slots,"default")])]))}};export{ge as _};
