import{b as M}from"./requirement-D9X6rrza.js";import{P as R,r as f,m as d,Q as i}from"./index-D7WFQ8O_.js";const U=R("task",()=>{const o=f([]),k=f([]),h=f([]),y=f(null),u=f(!1),n=f(null),_=f(1),$=f(!0),E=async(e,l,{updateStoreData:a=!0})=>{var s,t;a==!0&&(u.value=!0,n.value=null);try{await i.post(`/tasks/${e}/assign-users`,{user_ids:l}),await w(e)}catch(r){throw a==!0&&(n.value=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"Assign users failed"),r}finally{a==!0&&(u.value=!1)}};function q(){_.value=1,o.value=[]}const O=async(e={})=>{var l,a,s;u.value=!0,n.value=null;try{const t=await M({params:e});o.value=((l=t.data)==null?void 0:l.tasks)||[],console.log({response:t})}catch(t){throw n.value=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"রিকোয়ারমেন্ট লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching requirements:",t),t}finally{u.value=!1}};async function P(e,l={}){var a,s,t;n.value=null;try{const r={...e,per_page:5e3};u.value=!0;const c=await i.get("/tasks",{params:r,...l});return o.value=((a=c.data)==null?void 0:a.tasks)||[],u.value=!1,c.data}catch(r){throw n.value=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",r}}const A=async(e,l)=>{var a,s,t;n.value=null;try{const r=await i.get("/my-tasks",{params:e,...l});return o.value=((a=r.data)==null?void 0:a.tasks)||[],r.data}catch(r){throw n.value=((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",r),r}};function g(e,l=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>(a==null?void 0:a.parent_id)===l).map(a=>({...a,children_tasks:g(e,a.id)}))}function p(){return g(o.value,0)}function C(){const e=[],l=(a,s=0,t="")=>{a.forEach(r=>{e.push({...r,depth:s,idPath:t+r.id}),r.children_tasks&&r.children_tasks.length&&l(r.children_tasks,s+1,t+r.id+"-")})};return l(p()),e}const w=async(e,l={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var s,t,r,c,T;a.fetchOnly||(u.value=!0),n.value=null;try{const v=await i.get(`/tasks/${e}`,{params:l});return a.fetchOnly||(y.value=((s=v.data)==null?void 0:s.task)||{},h.value=((t=v.data)==null?void 0:t.todos)||{},k.value=((r=v.data)==null?void 0:r.todo_dates)||{},o.value=v.data.sub_tasks||[]),v.data}catch(v){const m=((T=(c=v.response)==null?void 0:c.data)==null?void 0:T.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(n.value=m),m}finally{a.fetchOnly||(u.value=!1)}},b=async(e,l={loadingBeforeCreate:!1})=>{var a,s,t,r;l.loadingBeforeCreate&&(u.value=!0),n.value=null;try{const c=await i.post("/tasks",e);return(a=c.data)!=null&&a.data&&o.value.push((s=c.data)==null?void 0:s.data),c.data.data}catch(c){throw n.value=((r=(t=c.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",c),c}finally{l.loadingBeforeCreate&&(u.value=!1)}},x=async(e,l,{loadingBeforeFetch:a=!0})=>{a&&(u.value=!0),n.value=null;try{const s=await i.put(`/tasks/${e}`,l),t=o.value.findIndex(r=>r.id===e);return t!==-1&&(o.value[t]=s.data.data),s.data.data}catch(s){throw s}finally{a&&(u.value=!1)}},B=async(e,l)=>(await i.put(`/tasks/${e}/update-priorities`,{task_ids:l})).data,L=async e=>{var l,a;u.value=!0,n.value=null;try{await i.delete(`/tasks/${e}`),o.value=o.value.filter(s=>s.id!==e)}catch(s){throw n.value=((a=(l=s.response)==null?void 0:l.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,s),s}finally{u.value=!1}},D=async(e,l)=>{var a,s;u.value=!0,n.value=null;try{await i.patch(`/tasks/${e}/update-requirement-detail/${l}`),o.value=o.value.filter(t=>t.id!==e)}catch(t){throw n.value=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||`টাস্ক (ID: ${e}) রেকয়্যারমেন্ট সেট করতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,t),t}finally{u.value=!1}};return{tasks:d(()=>o.value),task_todos:d(()=>h.value),task_todo_dates:d(()=>k.value),task:d(()=>y.value),loading:d(()=>u.value),error:d(()=>n.value),taskListTree:d(p),flattenedTasks:d(C),fetchAllTasks:O,fetchTasks:P,hasMoreTask:$,fetchMyTasks:A,resetTaskList:q,fetchTask:w,createTask:b,updateTask:x,deleteTask:L,assignUsers:E,updateTaskPriorities:B,setTaskRequirement:D}});export{U as u};
