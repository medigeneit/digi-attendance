import{E as J,r as u,G as O,s as $,p as K,q as Q,b as X,c as r,a as o,d as k,z as F,F as b,x as m,h as H,v as Z,y,o as i,t as h,k as L,C as P}from"./index-BlVvCVmu.js";import{u as ee}from"./company-DtwD11xK.js";import{u as te}from"./shift-C6cbZMPk.js";import{d as N}from"./dayjs.min-Cbbdfn5l.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe=J("shiftSchedule",()=>{const _=u([]);return{schedules:_,fetchSchedules:async c=>{const x=await O.get("/shift-schedules",c);return _.value=x.data,x.data},saveSchedules:async c=>{await O.post("/shift-schedules",{schedules:c==null?void 0:c.payload})}}}),ae={class:"p-4 max-w-[1600px] mx-auto"},le={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},ne=["value"],re=["value"],ie={class:"flex flex-wrap gap-3 mb-4"},de=["onClick"],ue={class:"text-sm"},ce={class:"overflow-auto"},ve={class:"table-auto w-full border text-sm"},pe={class:"sticky top-0 bg-white z-10"},he={class:"text-xs text-gray-400"},fe={class:"border p-2"},ge=["value"],be={class:"border p-2 whitespace-nowrap"},me={class:"border p-2"},ye=["onClick"],Se=["onClick"],xe=["title"],Ee={__name:"ShiftScheduleForm",setup(_){const C=oe(),S=ee(),c=te(),{companies:x,employees:M}=$(S),{shifts:V}=$(c),f=u(N().format("YYYY-MM")),D=u("");u(""),u("");const d=u("");u([]),u([]);const n=u({}),v=u([]),g=u({HOLIDAY:"bg-gray-500",WEEKEND:"bg-red-700"}),W=["bg-green-700","bg-pink-600","bg-blue-800","bg-cyan-600","bg-red-600","bg-purple-700","bg-yellow-500","bg-indigo-500","bg-amber-600"],E=K(()=>Object.values(V.value||{}).flat());function T(){const s=E.value;let e=0;s.forEach(t=>{g.value[t.id]=W[e%W.length],e++}),g.value.HOLIDAY="bg-gray-500",g.value.WEEKEND="bg-red-700"}const w=K(()=>Array.from({length:N(f.value).daysInMonth()},(s,e)=>e+1)),Y=s=>{const e=`${f.value}-${String(s).padStart(2,"0")}`;return N(e).format("ddd")},j=(s,e)=>{var a,l;const t=(l=(a=n.value)==null?void 0:a[s])==null?void 0:l[e];return t?["HOLIDAY","WEEKEND"].includes(t)?g.value[t]||"bg-gray-300":g.value[parseInt(t)]||"bg-gray-300":"bg-gray-300"},U=(s,e)=>{var l,p;const t=(p=(l=n.value)==null?void 0:l[s])==null?void 0:p[e],a=E.value.find(A=>A.id===t);return(a==null?void 0:a.name)||""},z=(s,e)=>{v.value.includes(parseInt(s))&&d.value&&(n.value[s]||(n.value[s]={}),n.value[s][e]=d.value)},I=s=>{v.value.includes(parseInt(s))&&d.value&&(n.value[s]||(n.value[s]={}),w.value.forEach(e=>{n.value[s][e]=d.value}))},B=()=>{v.value.forEach(s=>{I(s)})},q=()=>{v.value.forEach(s=>{var a;const e=M.value.find(l=>l.id===parseInt(s)),t=((a=e==null?void 0:e.weekends)==null?void 0:a.map(l=>l.slice(0,3)))||[];n.value[s]||(n.value[s]={}),w.value.forEach(l=>{const p=Y(l);t.includes(p)&&(n.value[s][l]="WEEKEND")})})},G=async()=>{const s=Object.entries(n.value).flatMap(([e,t])=>v.value.includes(parseInt(e))?Object.entries(t).map(([a,l])=>({employee_id:parseInt(e),date:`${f.value}-${String(a).padStart(2,"0")}`,shift_id:l})):[]);try{await C.saveSchedules({payload:s}),alert("Shift schedule saved successfully!")}catch(e){console.error("Failed to save schedule",e),alert("Something went wrong while saving.")}};Q(D,async s=>{s&&(await S.fetchEmployee(s),await c.fetchShifts({companyId:s}),T(),await R(s,f.value))}),X(async()=>{await S.fetchCompanies()});const R=async(s,e)=>{try{const t=await C.fetchSchedules({params:{company_id:s,month:e}}),a={};t.forEach(l=>{v.value.push(l.employee_id);const p=l.employee_id,A=parseInt(l.date.split("-")[2]);a[p]||(a[p]={}),a[p][A]=l.shift_id??(l.is_holiday?"HOLIDAY":"WEEKEND")}),n.value=a}catch(t){console.error("Failed to load schedule data:",t)}};return(s,e)=>(i(),r("div",ae,[o("div",le,[k(o("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>D.value=t),class:"p-2 border rounded"},[e[6]||(e[6]=o("option",{value:""},"Select Company",-1)),(i(!0),r(b,null,m(H(x),t=>(i(),r("option",{key:t.id,value:t.id},h(t.name),9,ne))),128))],512),[[F,D.value]]),k(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t),class:"p-2 border rounded"},[e[7]||(e[7]=o("option",{value:""},"- Shift -",-1)),(i(!0),r(b,null,m(E.value,t=>(i(),r("option",{key:t.id,value:t.id},h(t.name),9,re))),128))],512),[[F,d.value]]),k(o("input",{type:"month","onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),class:"p-2 border rounded"},null,512),[[Z,f.value]])]),o("div",ie,[(i(!0),r(b,null,m(E.value,t=>(i(),r("div",{key:t.id,class:y(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":d.value===t.id}]),onClick:a=>d.value=t.id},[o("div",{class:y(["w-5 h-5 rounded",g.value[t.id]||"bg-gray-300"])},null,2),o("span",ue,h(t.name),1)],10,de))),128)),o("div",{class:y(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":d.value==="HOLIDAY"}]),onClick:e[3]||(e[3]=t=>d.value="HOLIDAY")},e[8]||(e[8]=[o("div",{class:"w-5 h-5 rounded bg-gray-500"},null,-1),o("span",{class:"text-sm"},"Holiday",-1)]),2),o("div",{class:y(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":d.value==="WEEKEND"}]),onClick:e[4]||(e[4]=t=>d.value="WEEKEND")},e[9]||(e[9]=[o("div",{class:"w-5 h-5 rounded bg-red-700"},null,-1),o("span",{class:"text-sm"},"Weekend",-1)]),2)]),o("div",{class:"mb-4 flex gap-4"},[o("button",{onClick:B,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),o("button",{onClick:q,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),o("div",ce,[o("table",ve,[o("thead",pe,[o("tr",null,[e[10]||(e[10]=o("th",{class:"border p-2"},"Emp ID",-1)),e[11]||(e[11]=o("th",{class:"border p-2"},"Name",-1)),e[12]||(e[12]=o("th",{class:"border p-2"},"Action",-1)),(i(!0),r(b,null,m(w.value,t=>(i(),r("th",{key:t,class:"border text-center p-1 w-10"},[L(h(t)+" ",1),o("div",he,h(Y(t)),1)]))),128))])]),o("tbody",null,[(i(!0),r(b,null,m(H(M),t=>(i(),r("tr",{key:t.id},[o("td",fe,[k(o("input",{type:"checkbox",class:"mr-2",value:t.id,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value=a)},null,8,ge),[[P,v.value]]),L(" "+h(t.code),1)]),o("td",be,h(t.name),1),o("td",me,[o("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:a=>I(t.id)}," Apply to All Dates ",8,ye)]),(i(!0),r(b,null,m(w.value,a=>(i(),r("td",{key:a,class:"border text-center cursor-pointer",onClick:l=>z(t.id,a)},[o("div",{title:U(t.id,a),class:y([j(t.id,a),"w-full h-6"])},null,10,xe)],8,Se))),128))]))),128))])])]),o("div",{class:"mb-4 mt-4"},[o("button",{onClick:G,class:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow"}," ðŸ’¾ Save Schedule ")])]))}},Ae=se(Ee,[["__scopeId","data-v-2d27ea14"]]);export{Ae as default};
