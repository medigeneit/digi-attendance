import{r as f,e as N,A as q,m as z,c as _,o as u,a,f as S,g as k,w as V,F as A,p as b,h as B,v as j,k as v,t as C,i as I,j as F,x as L,b as O,u as R}from"./index-D46ic68_.js";import{_ as T}from"./CompanyDepartmentSelectInput-BP9TAOse.js";import{R as U}from"./RequiredIcon-BLLKMR5Z.js";import{f as W,u as G}from"./requirement-BUTlcBIc.js";import{u as H}from"./company-DS1527uV.js";import{u as J}from"./tags-CmLQYUu9.js";import{L as K}from"./LoaderView-DGBPwjQn.js";import{S as P}from"./SelectDropdown-D7p8aDS5.js";import{_ as Q}from"./TextEditor-CQPQqyGh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"sticky top-0 pt-4 bg-white z-10"},Y={class:"mb-4"},Z={class:"mb-4"},h={class:"mb-4"},ee={key:0,class:"mb-4"},te={class:"border rounded px-2 py-1 text-gray-600 bg-gray-50"},ae={class:"block text-gray-600 text-sm mb1 font-medium"},se={class:"block text-gray-600 text-sm mb-1 font-medium"},oe={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ie={class:"flex items-center justify-between gap-4"},le=["disabled"],re={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(D,{emit:w}){const g=D,c=w,m=J(),n=H(),o=f(""),y=f(),x=f(""),$=f(),s=f({from_department_id:"",to_department_id:"",website_tags:[]});N(async()=>{var t;o.value="loading",m.fetchTags("website"),await n.fetchCompanies({with:"departments",ignore_permission:!0}),await n.fetchMyCompanies({with:"departments"}),y.value=(t=(await W(g.requirementId)).data)==null?void 0:t.requirement,o.value=""}),q(y,function(t){var e;t&&(s.value.title=t.title,s.value.description=t.description,s.value.from_department_id=t.from_department_id,s.value.to_department_id=t.to_department_id,Array.isArray(t==null?void 0:t.website_tags)&&((e=t.website_tags)==null?void 0:e.length)>0&&(s.value.website_tags=t.website_tags.map(r=>r.name)))});async function E(){var e,r,p,d;o.value="submitting";const t={...s.value};console.log({payload:t});try{const i=await G(g.requirementId,t);c("update",i),o.value="created",x.value=(e=i==null?void 0:i.data)==null?void 0:e.message}catch(i){c("error",(r=i==null?void 0:i.response)==null?void 0:r.data),x.value=(d=(p=i==null?void 0:i.response)==null?void 0:p.data)==null?void 0:d.message,o.value="error"}}const M=z(()=>{var t,e;for(let r in n.myCompanies)if((((e=(t=n==null?void 0:n.myCompanies)==null?void 0:t[r])==null?void 0:e.departments)||[]).some(d=>d.id==s.value.from_department_id))return!0;return!1});return(t,e)=>{var r,p,d,i;return u(),_("div",{ref_key:"containerRef",ref:$,class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[a("div",X,[e[7]||(e[7]=a("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[8]||(e[8]=a("hr",{class:"mb-4"},null,-1)),a("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=V(l=>c("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),a("form",{onSubmit:V(E,["prevent"]),class:"z-0"},[o.value!=="loading"&&o.value!=="submitting"?(u(),_(A,{key:0},[a("div",Y,[e[9]||(e[9]=a("label",{class:"text-gray-800"},"Title",-1)),B(a("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.title=l),required:"",placeholder:"Ender Requirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[j,s.value.title]])]),a("div",Z,[e[10]||(e[10]=a("label",{class:"text-gray-800"},"Description",-1)),b(Q,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.description=l)},null,8,["modelValue"])]),a("div",h,[e[11]||(e[11]=a("label",{class:"text-gray-800"},"Websites",-1)),b(P,{options:v(m).tags,modelValue:s.value.website_tags,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.website_tags=l),taggable:"",label:"name",value:"name",class:"py-2"},null,8,["options","modelValue"])]),M.value?(u(),S(T,{key:1,modelValue:s.value.from_department_id,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.from_department_id=l),companies:((d=v(n))==null?void 0:d.myCompanies)||[],disabled:y.value.status,class:"mb-4"},{label:I(()=>[a("label",ae,[e[13]||(e[13]=F(" From Department ")),b(U)])]),_:1},8,["modelValue","companies","disabled"])):(u(),_("div",ee,[e[12]||(e[12]=a("label",{class:"block text-gray-600 text-sm mb1 font-medium"}," From Department ",-1)),a("div",te,C((p=(r=y.value)==null?void 0:r.from_department)==null?void 0:p.name),1)])),b(T,{modelValue:s.value.to_department_id,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.to_department_id=l),companies:((i=v(n))==null?void 0:i.companies)||[],disabled:y.value.status,class:"mb-4"},{label:I(()=>[a("label",se,[e[14]||(e[14]=F(" To Department ")),b(U)])]),_:1},8,["modelValue","companies","disabled"])],64)):k("",!0),a("div",oe,[x.value?(u(),_("div",{key:0,class:L(["mb-4 font-medium text-center",{"text-red-500":o.value=="error","text-green-500":o.value=="created"}])},C(x.value),3)):k("",!0),a("div",ie,[a("button",{type:"button",onClick:e[6]||(e[6]=V(l=>c("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),a("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},C(o.value=="submitting"?"Saving...":"Save"),9,le)])])],32),o.value==="loading"||o.value==="submitting"?(u(),S(K,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):k("",!0)],512)}}},ne={class:"container mx-auto p-6"},_e={__name:"RequirementEdit",setup(D){const w=O(),g=R();return(c,m)=>(u(),_("div",ne,[b(re,{requirementId:v(w).params.id,onUpdate:m[0]||(m[0]=()=>v(g).back()),onCancelClick:m[1]||(m[1]=()=>v(g).back())},null,8,["requirementId"])]))}};export{_e as default};
