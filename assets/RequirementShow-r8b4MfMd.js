import{r as q,e as M,c as u,o as l,a as e,f as D,g as c,w as h,F as N,h as F,j as E,y as C,v as V,i as R,A as be,t as k,d as _e,p as ve,C as fe,x as G,n as L,q as he,k as xe,b as $e,u as qe,z as O,I as Ce}from"./index-BYeQPT0g.js";import{L as z}from"./LoaderView-CkB2n-R6.js";import{O as j}from"./OverlyModal-CjvKL_NW.js";import{_ as H}from"./DescriptionView-Cj4HrbAz.js";import{R as ye}from"./RequiredIcon-CLWRCV3K.js";import{f as Y}from"./requirement-BMeelJ0_.js";import{a as Ie,f as K,d as Re,u as De,b as Se,_ as Te}from"./TaskAddForm-DRFoogIs.js";import{u as ge}from"./department-DlSJKsFZ.js";import{S as ke}from"./SelectDropdown-BWVHQCTn.js";import{_ as W}from"./UserChip-CMdQw1kG.js";import{u as we}from"./user-DlrCG3sR.js";import{_ as Ee}from"./TaskUserChip-Bf0VTWFN.js";import{u as Ne}from"./useTaskStore-Ba23_2pS.js";import{_ as ce}from"./TaskStatus-D1S14YAc.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-8ObuGlDp.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-C02i3wWK.js";import"./SectionLoading-CnZgms_l.js";import"./TextWithHr-G4FMb7c9.js";import"./TaskUrgencyInput-DzAUd6rD.js";const Fe={class:"sticky top-0 pt-4 bg-white z-10"},Ae={class:"mb-4"},Ue={class:"block text-gray-600 text-sm mb-1 font-medium"},Ve={class:"mb-4"},Pe={class:"mb-4"},Le={class:"mb-4"},Oe={class:"mb-4"},je={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Me={key:0,class:"mb-4 text-red-500 font-medium"},ze={key:1,class:"mb-4"},Be={class:"flex items-center justify-between gap-4"},Ge=["disabled"],He={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["create","closeClick","error"],setup(v,{emit:S}){const y=v,f=S,d=ge(),x=q(),n=q(""),m=q(),r=q({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),w=q([]);async function o(){var t,a;n.value="submitting";const s={...r.value};console.log({payload:s});try{const I=await Ie(y.requirementId,s);f("create",I),n.value="create"}catch(I){n.value="error",m.value=((a=(t=I.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to create requirement detail",f("error",m.value)}}return M(async()=>{var t;const s=((t=(await Y(y.requirementId)).data)==null?void 0:t.requirement)||{};w.value=await d.fetchDepartmentEmployee([s.from_department_id])}),(s,t)=>(l(),u("div",{class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative",ref_key:"formContainerRef",ref:x},[e("div",Fe,[t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement",-1)),t[8]||(t[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=h(a=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(o,["prevent"]),class:"z-0"},[n.value!=="loading"?(l(),u(N,{key:0},[e("div",Ae,[e("label",Ue,[t[9]||(t[9]=E("Title ")),C(ye)]),F(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>r.value.title=a),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,r.value.title]])]),e("div",Ve,[t[10]||(t[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Details",-1)),F(e("textarea",{rows:"10","onUpdate:modelValue":t[2]||(t[2]=a=>r.value.description=a),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,r.value.description]])]),e("div",Pe,[t[12]||(t[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),C(ke,{modelValue:r.value.supervisor_id,"onUpdate:modelValue":t[3]||(t[3]=a=>r.value.supervisor_id=a),options:w.value,placeholder:"--NO SUPERVISOR--",containment:x.value,clearable:"",class:"h-10"},{"list-header":R(()=>t[11]||(t[11]=[e("div",{class:"px-3 pt-2 pb-1 shadow-md text-xs uppercase bg-gray-50 text-gray-500"}," Employees ",-1)])),option:R(({option:a})=>[C(W,{user:a||{},class:"pr-5 -mx-1"},null,8,["user"])]),"selected-option":R(({option:a})=>[a?(l(),D(W,{key:0,user:a||{},class:"pr-4"},null,8,["user"])):c("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",Le,[t[14]||(t[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),F(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[4]||(t[4]=a=>r.value.priority=a)},t[13]||(t[13]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[be,r.value.priority]])]),e("div",Oe,[t[15]||(t[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),F(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=a=>r.value.better_to_complete_on=a),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,r.value.better_to_complete_on]])])],64)):c("",!0),e("div",je,[m.value?(l(),u("div",Me,k(m.value),1)):c("",!0),m.value?(l(),u("hr",ze)):c("",!0),e("div",Be,[e("button",{type:"button",onClick:t[6]||(t[6]=h(a=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:n.value=="loading"||n.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},k(n.value=="submitting"?"Saving...":"Add Requirement"),9,Ge)])])],32),n.value==="loading"||n.value==="submitting"?(l(),D(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512))}},We={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Ye={class:"mb-4"},Je={class:"font-semibold"},Ke={class:"mb-4"},Qe={class:"line-clamp-2"},Xe={key:1,class:"min-h-40"},Ze={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},et={key:0,class:"mb-4 text-red-500 font-medium"},tt={key:1,class:"mb-4"},st={class:"flex items-center justify-between gap-4"},rt=["disabled"],lt={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(v,{emit:S}){const y=v,f=S,d=we(),x=q(null),n=q(""),m=q(),r=q([]);async function w(){var o,s;n.value="submitting";try{const t=await Re(y.requirementId,y.detailId);f("delete",t),n.value="create"}catch(t){n.value="error",m.value=((s=(o=t.response)==null?void 0:o.data)==null?void 0:s.message)||"Failed to update requirement detail: "+t,f("error",m.value)}}return M(async()=>{var o,s,t;n.value="loading";try{r.value=await d.fetchDepartmentWiseEmployees(),x.value=(o=(await K(y.requirementId,y.detailId)).data)==null?void 0:o.detail}catch(a){m.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch requirement detail"}finally{n.value=""}}),(o,s)=>{var t,a;return l(),u("div",We,[s[4]||(s[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:h(w,["prevent"]),class:"z-0"},[n.value!=="loading"?(l(),u(N,{key:0},[e("div",Ye,[s[1]||(s[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Je,k((t=x.value)==null?void 0:t.title),1)]),e("div",Ke,[s[2]||(s[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",Qe,k((a=x.value)==null?void 0:a.description),1)]),s[3]||(s[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(l(),u("div",Xe)),e("div",Ze,[m.value?(l(),u("div",et,k(m.value),1)):c("",!0),m.value?(l(),u("hr",tt)):c("",!0),e("div",st,[e("button",{type:"button",onClick:s[0]||(s[0]=h(I=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:n.value=="loading"||n.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},k(n.value=="submitting"?"Deleting...":"Delete"),9,rt)])])],32),n.value==="loading"||n.value==="submitting"?(l(),D(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)])}}},it={class:"sticky top-0 pt-4 bg-white z-10"},nt={class:"mb-4"},ot={class:"block text-gray-600 text-sm mb-1 font-medium"},at={class:"mb-4"},dt={class:"mb-4"},ut={key:0,class:"relative w-full"},mt={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},pt={class:"mb-4"},ct={class:"mb-4"},bt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},vt={key:0,class:"mb-4 text-red-500 font-medium"},ft={key:1,class:"mb-4"},xt={class:"flex items-center justify-between gap-4"},yt=["disabled"],gt={__name:"RequirementDetailEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(v,{emit:S}){const y=v,f=S,d=q(),x=we(),n=ge(),m=q(null),r=q(""),w=q(),o=q({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),s=q([]),t=q([]);async function a(){var p,T;r.value="submitting";const I={...o.value};try{const g=await De(y.requirementId,y.detailId,I);f("update",g),r.value="create"}catch(g){r.value="error",w.value=((T=(p=g.response)==null?void 0:p.data)==null?void 0:T.message)||"Failed to update requirement detail",f("error",w.value)}}return M(async()=>{var I,p,T,g,b,A,P,_;r.value="loading";try{s.value=await x.fetchDepartmentWiseEmployees();const i=((I=(await Y(y.requirementId)).data)==null?void 0:I.requirement)||{};t.value=await n.fetchDepartmentEmployee([i.from_department_id]),m.value=(p=(await K(y.requirementId,y.detailId)).data)==null?void 0:p.detail,o.value={title:(T=m.value)==null?void 0:T.title,description:(g=m.value)==null?void 0:g.description,priority:(b=m.value)==null?void 0:b.priority,supervisor_id:(A=m.value)==null?void 0:A.supervisor_id};const J=new Date(m.value.better_to_complete_on);o.value.better_to_complete_on=J.toISOString().split("T")[0]}catch(i){w.value=((_=(P=i.response)==null?void 0:P.data)==null?void 0:_.message)||"Failed to fetch requirement detail"}finally{r.value=""}}),(I,p)=>{var T;return l(),u("div",{ref_key:"formContainerRef",ref:d,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",it,[p[8]||(p[8]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),p[9]||(p[9]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:p[0]||(p[0]=h(g=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(a,["prevent"]),class:"z-0"},[r.value!=="loading"?(l(),u(N,{key:0},[e("div",nt,[e("label",ot,[p[10]||(p[10]=E("Title ")),C(ye)]),F(e("input",{"onUpdate:modelValue":p[1]||(p[1]=g=>o.value.title=g),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,o.value.title]])]),e("div",at,[p[11]||(p[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),F(e("textarea",{rows:"10","onUpdate:modelValue":p[2]||(p[2]=g=>o.value.description=g),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,o.value.description]])]),e("div",dt,[p[12]||(p[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),C(ke,{modelValue:o.value.supervisor_id,"onUpdate:modelValue":p[4]||(p[4]=g=>o.value.supervisor_id=g),options:[...t.value,...t.value.find(g=>{var b,A;return g.id==((A=(b=m.value)==null?void 0:b.supervisor)==null?void 0:A.id)})?[]:[(T=m.value)==null?void 0:T.supervisor]],containment:d.value,placeholder:"--NO SUPERVISOR--",class:"h-10"},{option:R(({option:g})=>[C(W,{user:g||{}},null,8,["user"])]),"selected-option":R(({option:g})=>[g?(l(),u("div",ut,[C(W,{user:g||{}},null,8,["user"]),o.value.supervisor_id?(l(),u("div",mt,[e("button",{onClick:p[3]||(p[3]=h(b=>o.value.supervisor_id=null,["prevent"])),class:"text-gray-6 font-semibold 00 hover:text-red-700"}," × ")])):c("",!0)])):c("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",pt,[p[14]||(p[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),F(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":p[5]||(p[5]=g=>o.value.priority=g)},p[13]||(p[13]=[e("option",{value:null},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[be,o.value.priority]])]),e("div",ct,[p[15]||(p[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),F(e("input",{type:"date","onUpdate:modelValue":p[6]||(p[6]=g=>o.value.better_to_complete_on=g),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,o.value.better_to_complete_on]])])],64)):c("",!0),e("div",bt,[w.value?(l(),u("div",vt,k(w.value),1)):c("",!0),w.value?(l(),u("hr",ft)):c("",!0),e("div",xt,[e("button",{type:"button",onClick:p[7]||(p[7]=h(g=>f("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:r.value=="loading"||r.value=="submitting",type:"submit",class:"btn-2"},k(r.value=="submitting"?"Saving...":"Edit"),9,yt)])])],32),r.value==="loading"||r.value==="submitting"?(l(),D(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512)}}},kt=["rowspan"],wt={class:"text-2xl font-medium"},_t=["rowspan"],ht={class:"text-lg font-semibold mb-2 flex items-start gap-3"},$t={key:0},qt={key:0,class:"mb-5"},Ct=["innerHTML"],It={class:"flex items-end"},Rt={key:0,class:"mt-4 flex justify-between items-end print:pb-0"},Dt={class:""},St={class:"ml-auto flex gap-6 items-center"},Tt=["rowspan"],Et={class:"text-center print:text-xs"},Nt={class:"border-2 border-gray-700 p-3 text-center"},Ft=["title"],At={class:"border-2 border-gray-700 p-3"},Ut={class:"whitespace-nowrap text-center print:whitespace-break-spaces"},Vt={key:0,class:"print:text-xs"},Pt={key:1,class:"text-gray-500"},Lt={key:0,colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Ot={key:0},jt={colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Mt={__name:"RequirementDetailTableRow",props:{detail:{type:Object},requirement:{type:Object},serial:{type:Number},isPrinting:{type:Boolean}},emits:["editClick","deleteClick","taskCreateClick"],setup(v,{emit:S}){const y=v,f=S,d=_e(),x=ve(()=>{var m,r,w;return((r=(m=y.detail)==null?void 0:m.tasks)==null?void 0:r.length)>0?(w=y.detail)==null?void 0:w.tasks:[{id:0}]});function n(){var m,r,w,o,s;if(d.user.role!=="super_admin"&&((m=d.user)==null?void 0:m.id)!==((w=(r=y.requirement)==null?void 0:r.to_department)==null?void 0:w.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(s=(o=y.requirement)==null?void 0:o.to_department)==null?void 0:s.name}'s In charge can create or assign.`);f("taskCreateClick",y.detail)}return(m,r)=>{const w=fe("RouterLink");return l(),u(N,null,[(l(!0),u(N,null,G(x.value,(o,s)=>{var t,a,I,p,T,g;return l(),u("tr",{key:o.id,class:"group/item border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},[s===0?(l(),u(N,{key:0},[e("td",{class:"border-2 border-gray-700 p-3 align-top",rowspan:(((a=(t=v.detail)==null?void 0:t.tasks)==null?void 0:a.length)||1)+(v.isPrinting?0:1)},[e("span",wt,k(v.serial),1)],8,kt),e("td",{class:"border-2 border-gray-700 p-3",rowspan:(((p=(I=v.detail)==null?void 0:I.tasks)==null?void 0:p.length)||1)+(v.isPrinting?0:1)},[e("div",null,[e("div",ht,[C(H,{"line-clamp":"3",class:"grow"},{default:R(()=>[E(k(v.detail.title),1)]),btnText:R(({lineClampClass:b})=>[E(k(b?"More":"Less"),1)]),_:1}),v.detail.priority?(l(),u("div",$t,[e("span",{class:L(["font-semibold text-sm",{"text-yellow-600 ":v.detail.priority=="IMPORTANT","text-red-700 ":v.detail.priority=="URGENT"}])},k(v.detail.priority),3)])):c("",!0)]),r[3]||(r[3]=e("hr",{class:"mb-4 -mx-4"},null,-1)),v.detail.description?(l(),u("div",qt,[r[2]||(r[2]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),C(H,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"}},{default:R(()=>[e("p",{innerHTML:v.detail.description,class:"text-justify"},null,8,Ct)]),_:1})])):c("",!0)]),e("div",It,[v.detail.supervisor?(l(),u("div",Rt,[e("div",Dt,[r[4]||(r[4]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Supervisor:",-1)),C(Ee,{user:v.detail.supervisor},null,8,["user"])])])):c("",!0),e("div",St,[e("button",{class:"btn-2",onClick:r[0]||(r[0]=h(b=>f("editClick",v.detail),["prevent"]))},r[5]||(r[5]=[e("i",{class:"fas fa-edit"},null,-1),E("Edit ")])),e("button",{class:"btn-2-red",onClick:r[1]||(r[1]=h(b=>f("deleteClick",v.detail),["prevent"]))},r[6]||(r[6]=[e("i",{class:"fas fa-trash-alt"},null,-1),E("Delete ")]))])])],8,_t),e("td",{class:"border-2 border-gray-700 p-3 whitespace-nowrap print:whitespace-break-spaces print:px-0",rowspan:(((g=(T=v.detail)==null?void 0:T.tasks)==null?void 0:g.length)||1)+(v.isPrinting?0:1)},[e("div",Et,k(new Date(v.detail.better_to_complete_on).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)],8,Tt)],64)):c("",!0),o.id?(l(),u(N,{key:1},[e("td",Nt,[C(w,{to:{name:"TaskShow",params:{id:o.id}},class:"hover:underline text-gray-900 hover:text-blue-600 whitespace-nowrap block",target:"_blank"},{default:R(()=>[E(k(o.id)+" ",1),e("i",{title:o.status,class:L(["ml-1",{"fad fa-exclamation-circle text-red-600":o.status=="PENDING","fad fa-exclamation-square text-yellow-600":o.status=="IN_PROGRESS","fad fa-check-circle text-green-600":o.status=="COMPLETED"}])},null,10,Ft)]),_:2},1032,["to"])]),e("td",At,[e("div",Ut,[o.deadline?(l(),u("div",Vt,k(new Date(o.deadline).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)):(l(),u("div",Pt,"-"))])])],64)):(l(),u(N,{key:2},[v.isPrinting?(l(),u("td",Lt,[e("button",{onClick:h(n,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"},r[7]||(r[7]=[e("i",{class:"fas fa-plus-circle"},null,-1),E(" Create / Assign Task ")]))])):c("",!0)],64))])}),128)),v.isPrinting?c("",!0):(l(),u("tr",Ot,[e("td",jt,[e("button",{onClick:h(n,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"},r[8]||(r[8]=[e("i",{class:"fas fa-plus-circle"},null,-1),E(" Create / Assign Task ")]))])]))],64)}}},zt={class:"sticky top-0 pt-4 bg-white z-10"},Bt={class:"mb-4"},Gt={class:"mb-4"},Ht={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Wt={key:0,class:"mb-4 text-red-500 font-medium"},Yt={key:1,class:"mb-4"},Jt={class:"flex items-center justify-between gap-4"},Kt=["disabled"],Qt={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(v,{emit:S}){const y=v,f=S,d=q(),x=q(null),n=q(""),m=q(),r=q({feedback:""});async function w(){var o,s;n.value="submitting";try{const t=await Se(y.requirementId,y.detailId,r.value.feedback);f("update",t),n.value="create"}catch(t){n.value="error",m.value=((s=(o=t.response)==null?void 0:o.data)==null?void 0:s.message)||"Failed to update requirement detail",f("error",m.value)}}return M(async()=>{var o,s,t,a;n.value="loading";try{await Y(y.requirementId),x.value=(o=(await K(y.requirementId,y.detailId)).data)==null?void 0:o.detail,r.value={feedback:(s=x.value)==null?void 0:s.feedback}}catch(I){m.value=((a=(t=I.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to fetch requirement detail"}finally{n.value=""}}),(o,s)=>{var t;return l(),u("div",{ref_key:"formContainerRef",ref:d,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",zt,[s[3]||(s[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),s[4]||(s[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:s[0]||(s[0]=h(a=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(w,["prevent"]),class:"z-0"},[n.value!=="loading"?(l(),u(N,{key:0},[e("div",Bt,[s[5]||(s[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),C(H,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:R(()=>{var a;return[E(k((a=x.value)==null?void 0:a.title),1)]}),_:1})]),e("div",Gt,[s[6]||(s[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),F(e("textarea",{rows:"5","onUpdate:modelValue":s[1]||(s[1]=a=>r.value.feedback=a),placeholder:"Enter requirement feedback",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,r.value.feedback]])])],64)):c("",!0),e("div",Ht,[m.value?(l(),u("div",Wt,k(m.value),1)):c("",!0),m.value?(l(),u("hr",Yt)):c("",!0),e("div",Jt,[e("button",{type:"button",onClick:s[2]||(s[2]=h(a=>f("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:n.value=="loading"||n.value=="submitting",type:"submit",class:"btn-2"},k(n.value=="submitting"?"Saving...":(t=x.value)!=null&&t.feedback?"Update Feedback":"Add Feedback"),9,Kt)])])],32),n.value==="loading"||n.value==="submitting"?(l(),D(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512)}}},Xt={class:"text-left p-4"},Zt={class:"flex items-center gap-6 justify-center my-16"},es={key:0},ts={class:"bg-blue-50 px-6 py-4 rounded text-blue-500"},ss={class:"text-left text-base w-full font-semibold group flex items-center gap-2 mb-5 border-b border-blue-100 py-4"},rs={class:"flex items-center w-full"},ls={class:"grow"},is={class:"text-center text-red-500 text-sm font-semibold mb-4"},ns={class:"flex items-center justify-between"},os={key:1,class:"border rounded-md"},as={class:"flex flex-col justify-start items-start min-h-28 max-h-[70vh] overflow-y-auto"},ds=["onClick"],us={class:"flex items-center w-full"},ms={class:"grow"},ps={class:"line-clamp-1"},cs={__name:"TaskParentIdSelector",props:{fromDepartmentId:{type:Number},requirementDetail:{type:Object}},emits:["parentIdSelect","cancelClick","assignTask"],setup(v,{emit:S}){const y=v,f=S,d=Ne(),x=q(""),n=q(null);he(()=>x.value,(o,s)=>{s||d.fetchTasks({"from-department-id":y.fromDepartmentId})},{immediate:!0});function m(o){x.value=="sub-task"?f("parentIdSelect",o.id):n.value=o}async function r(){await d.setTaskRequirement(n.value.id,y.requirementDetail.id),f("assignTask")}const w=ve(()=>(d==null?void 0:d.tasks)||[]);return(o,s)=>{var t;return l(),u("div",Xt,[e("div",Zt,[e("button",{onClick:s[0]||(s[0]=h(a=>f("parentIdSelect",0,x.value),["prevent"])),class:"btn-3"}," Add as Main Task "),e("button",{class:L({"btn-3":x.value!=="sub-task","btn-2":x.value=="sub-task"}),onClick:s[1]||(s[1]=h(()=>{x.value="sub-task",n.value=null},["prevent"]))}," Add as Sub Task ",2),e("button",{class:L({"btn-3":x.value!=="direct-assign","btn-2":x.value=="direct-assign"}),onClick:s[2]||(s[2]=h(()=>x.value="direct-assign",["prevent"]))}," Assign Task ",2)]),x.value=="direct-assign"&&n.value?(l(),u("div",es,[e("div",ts,[e("div",ss,[e("i",{class:L(["fad text-xl group:hover-text-white",((t=n.value)==null?void 0:t.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",rs,[e("div",ls,k(n.value.title),1),C(ce,{status:n.value.status,class:"ml-auto"},null,8,["status"])])]),e("div",is,k(xe(d).error),1),e("div",ns,[e("button",{onClick:h(r,["prevent"]),class:"btn-2"},"Assign"),e("button",{onClick:s[3]||(s[3]=h(a=>f("cancelClick"),["prevent"])),class:"btn-3"},"Cancel")])])])):c("",!0),x.value&&!n.value?(l(),u("div",os,[s[4]||(s[4]=e("div",{class:"py-2 px-4 font-bold text-center border-b shadow"},"Click to select task",-1)),e("div",as,[(l(!0),u(N,null,G(w.value,a=>(l(),u("div",{key:a.id,class:"w-full mb-2"},[e("button",{type:"button",class:"text-left text-base w-full bg-blue-50 px-2 hover:bg-blue-500 hover:text-white py-2 text-blue-500 font-semibold group flex items-center gap-2",onClick:h(()=>m(a),["prevent"])},[e("i",{class:L(["fad text-xl group:hover-text-white",(a==null?void 0:a.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",us,[e("div",ms,[e("div",ps,k(a.title),1)]),C(ce,{status:a.status,class:"ml-auto"},null,8,["status"])])],8,ds)]))),128))])])):c("",!0)])}}},bs={class:"container mx-auto p-6 print:p-0 w-full print:max-w-full"},vs={class:"bg-white rounded shadow print:shadow-none p-4 print:p-0 relative"},fs={class:"flex items-start"},xs={class:"mb-4 text-lg print:black print:font-bold"},ys={class:"ml-auto print:hidden flex gap-2 items-center"},gs={class:"mb-4 flex items-center gap-1 print:mb-1"},ks={class:"font-bold print:text-gray-900"},ws={class:"mb-3 flex items-center gap-3 print:mb-1"},_s={class:"print:text-gray-900"},hs={key:0,class:"mb-3 flex items-center gap-3 print:mb-1"},$s={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},qs={class:"mb-3 flex items-center gap-3 print:mb-1"},Cs={class:"print:text-gray-900"},Is={key:0,class:"overflow-x-auto print:overflow-visible"},Rs={class:"w-full table-auto print:table-fixed"},Ds={colspan:"2",class:"w-[30%] border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap px-3 py-1 print:whitespace-normal"},Ss={class:""},Ts={class:"p-3 border-2 border-gray-800",colspan:"5"},Es={class:"font-semibold text-gray-500 print:text-gray-800 text-sm mb-1"},Ns=["innerHTML"],Fs=["onClick"],As={class:"mt-8 border rounded-md p-8 flex items-center justify-center bg-gray-50"},rr={__name:"RequirementShow",setup(v){const S=$e(),y=qe(),f=q(""),d=q(null),x=O({open:!1}),n=O({detail:null,open:!1}),m=O({detail:null,open:!1}),r=O({detail:null,open:!1}),w=q(!1),o=()=>w.value=!0,s=()=>w.value=!1;M(async()=>{await t(),window.addEventListener("beforeprint",o),window.addEventListener("afterprint",s)}),Ce(()=>{window.removeEventListener("beforeprint",o),window.removeEventListener("afterprint",s)});async function t(){var _;f.value="loading",d.value=(_=(await Y(S.params.id)).data)==null?void 0:_.requirement,f.value=""}function a(_){console.log({detail:_}),b.modalShown=!0,b.from_department_id=d.value.from_department_id,b.to_department_id=d.value.to_department_id,b.taskDefaultValues={title:_.title,description:_.description,from_department_id:d.value.from_department_id,to_department_id:d.value.to_department_id,is_important:(_==null?void 0:_.priority)=="IMPORTANT",is_urgent:(_==null?void 0:_.priority)=="URGENT",supervisor_ids:_!=null&&_.supervisor_id?[_==null?void 0:_.supervisor_id]:[]},b.requirementDetail=_}function I(){x.open=!0}function p(_){n.open=!0,n.detail=_}function T(_){r.open=!0,r.detail=_}function g(){setTimeout(()=>window.print()),w.value=!0}const b=O({parentId:null,modalShown:!1,requirementId:0,taskDefaultValues:{},requirementDetail:null});async function A(){b.parentId=0,b.parentId=null,b.modalShown=!1,b.requirementDetail=null,f.value="loading",await t()}async function P(){b.parentId=null,b.modalShown=!1,b.requirementDetail=null}return(_,i)=>{var Q,X,Z,ee,te,se,re,le,ie,ne,oe,ae,de,ue,me;const J=fe("RouterLink");return l(),u("div",bs,[x.open?(l(),D(j,{key:0,class:"*:max-w-4xl"},{default:R(()=>[C(He,{requirementId:d.value.id,onCloseClick:i[0]||(i[0]=$=>x.open=!1),onCreate:i[1]||(i[1]=async()=>{x.open=!1,await t()})},null,8,["requirementId"])]),_:1})):c("",!0),n.open?(l(),D(j,{key:1},{default:R(()=>{var $;return[C(gt,{requirementId:d.value.id,detailId:($=n.detail)==null?void 0:$.id,onCloseClick:i[2]||(i[2]=U=>n.open=!1),onUpdate:i[3]||(i[3]=async()=>{n.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),m.open?(l(),D(j,{key:2},{default:R(()=>{var $;return[C(Qt,{requirementId:d.value.id,detailId:($=m.detail)==null?void 0:$.id,onCloseClick:i[4]||(i[4]=U=>m.open=!1),onUpdate:i[5]||(i[5]=async()=>{m.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),r.open?(l(),D(j,{key:3},{default:R(()=>{var $;return[C(lt,{requirementId:d.value.id,detailId:($=r.detail)==null?void 0:$.id,onCloseClick:i[6]||(i[6]=U=>r.open=!1),onDelete:i[7]||(i[7]=async()=>{r.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),b.modalShown?(l(),D(j,{key:4,class:"*:relative"},{default:R(()=>{var $,U;return[e("button",{onClick:h(P,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},i[10]||(i[10]=[e("i",{class:"fas fa-times-circle"},null,-1)])),b.parentId===null?(l(),D(cs,{key:0,"from-department-id":($=d.value)==null?void 0:$.from_department_id,requirementDetail:b==null?void 0:b.requirementDetail,onParentIdSelect:i[8]||(i[8]=B=>b.parentId=B),onCancelClick:P,onAssignTask:A},null,8,["from-department-id","requirementDetail"])):(l(),D(Te,{key:1,parentTaskId:b.parentId,requirementDetailId:(U=b==null?void 0:b.requirementDetail)==null?void 0:U.id,requirementId:d.value.id,onClose:P,onTaskCreated:A,defaultValues:b.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["parentTaskId","requirementDetailId","requirementId","defaultValues"]))]}),_:1})):c("",!0),e("div",vs,[e("div",fs,[e("div",xs,[i[11]||(i[11]=e("div",{class:"text-gray-800 leading-none"},"To",-1)),e("div",null,k((X=(Q=d.value)==null?void 0:Q.to_department)==null?void 0:X.name),1)]),e("div",ys,[(((Z=d.value)==null?void 0:Z.details)||[]).length>0?(l(),u("button",{key:0,class:"btn-3 font-semibold !pl-2 !pr-4",onClick:h(g,["prevent"])},i[12]||(i[12]=[e("i",{class:"fad fa-print text-xl"},null,-1),E("Print ")]))):c("",!0),e("button",{class:"btn-3",onClick:i[9]||(i[9]=h(()=>xe(y).back(),["prevent"]))},"Back"),C(J,{class:"btn-2",to:`/requirements/edit/${(ee=d.value)==null?void 0:ee.id}`},{default:R(()=>i[13]||(i[13]=[E("Edit")])),_:1,__:[13]},8,["to"])])]),i[24]||(i[24]=e("div",{class:"text-center text-xl font-bold mb-2 underline"},"Requirement Form",-1)),e("div",gs,[i[14]||(i[14]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",ks,k((te=d.value)==null?void 0:te.id),1)]),e("div",ws,[i[15]||(i[15]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),e("div",_s,k((re=(se=d.value)==null?void 0:se.from_department)==null?void 0:re.name),1)]),((ie=(le=d.value)==null?void 0:le.website_tags)==null?void 0:ie.length)>0?(l(),u("div",hs,[i[16]||(i[16]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",$s,[(l(!0),u(N,null,G(((ne=d.value)==null?void 0:ne.website_tags)||[],$=>(l(),u("div",{key:$.id,class:"border px-2 rounded-md bg-gray-50 shadow-sm whitespace-nowrap"},k($.name),1))),128))])])):c("",!0),e("div",qs,[i[17]||(i[17]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",Cs,k(new Date((oe=d.value)==null?void 0:oe.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)]),i[25]||(i[25]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[i[23]||(i[23]=e("div",{class:"flex items-end mb-3"},[e("h2",{class:"text-xl font-semibold"},"Requirements"),e("div",{class:"ml-auto print:hidden flex gap-2 text-sm"})],-1)),(((ae=d.value)==null?void 0:ae.details)||[]).length>0?(l(),u("div",Is,[e("table",Rs,[e("thead",null,[e("tr",null,[i[18]||(i[18]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-left px-4 print:px-2 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[8%]"}," SL ",-1)),i[19]||(i[19]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap print:whitespace-normal w-[65%]"}," Requirement Details ",-1)),i[20]||(i[20]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Better To Complete ",-1)),e("th",Ds," For '"+k(((de=d.value.to_department)==null?void 0:de.short_name)||((ue=d.value.to_department)==null?void 0:ue.name))+"' Use ",1)]),i[21]||(i[21]=e("tr",null,[e("td",{class:"whitespace-nowrap border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold print:text-xs"}," Task No "),e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:text-xs print:p-0"}," Expected Date ")],-1))]),e("tbody",null,[(l(!0),u(N,null,G(((me=d.value)==null?void 0:me.details)||[],($,U)=>{var B,pe;return l(),u(N,{key:$.id},[C(Mt,{requirement:d.value,detail:$,serial:U+1,onEditClick:p,onDeleteClick:T,onTaskCreateClick:a,isPrinting:w.value},null,8,["requirement","detail","serial","isPrinting"]),e("tr",Ss,[e("td",Ts,[e("div",Es," '"+k(((B=d.value.to_department)==null?void 0:B.short_name)||((pe=d.value.to_department)==null?void 0:pe.name))+"' Feedback ",1),e("div",null,[$!=null&&$.feedback?(l(),D(H,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:R(()=>[e("p",{class:"text-sky-600 text-sm",innerHTML:$==null?void 0:$.feedback},null,8,Ns)]),_:2},1024)):c("",!0),e("div",null,[e("button",{class:"btn-3 print:hidden",onClick:h(()=>{m.open=!0,m.detail=$},["prevent"])},k($.feedback?"Update Feedback":"Add feedback"),9,Fs)])])])])],64)}),128))])])])):c("",!0),e("div",As,[e("button",{class:"btn-2 pl-2 text-base",onClick:h(I,["prevent"])},i[22]||(i[22]=[e("i",{class:"fad fa-plus-circle text-2xl mr-2"},null,-1),E("Add Requirement ")]))])]),f.value==="loading"?(l(),D(z,{key:1,class:"absolute inset-0 bg-opacity-90"})):c("",!0)])])}}};export{rr as default};
