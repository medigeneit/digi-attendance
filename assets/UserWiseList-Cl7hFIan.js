import{d as se,b as X,x as d,r as ae,e as oe,A as G,m as ne,c as m,o as n,a as l,f as N,g as M,F as j,n as D,i as B,t as F,k as w,h as $,B as re,S as R,v as ue,y as P,j as O,w as de,q as K}from"./index-a7sAWbwt.js";import{g as ie}from"./task-JHabeUP8.js";import{u as me}from"./company-DhpgsVrF.js";import{_ as J}from"./CompanyDepartmentSelectInput-B24sbthk.js";import{_ as pe}from"./EmployeeDropdownInput-p49Sikpd.js";import{_ as Q,m as ce}from"./task-tree-DRfcS2Q-.js";import{S as ve}from"./SelectDropdown-x8HeKfwJ.js";import{_ as ye}from"./UserChip-BwKnmrSF.js";import{_ as fe}from"./TaskTreeViewWithSubTable-D3lBhHRN.js";const xe={class:"mb-3 task-header"},be={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},ge={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},ke={class:"relative"},we=["title"],Ce={key:0},Ve={key:1,class:"text-gray-500 whitespace-nowrap"},Te={key:1,class:"relative w-full md:w-56 lg:flex-grow"},_e={class:"relative"},Ae={class:"w-32 relative h-10"},Me={class:"flex gap-4 items-center flex-shrink-0"},he={class:"flex gap-2"},Ue={class:"flex gap-2"},De={class:"flex gap-2"},Ee={class:"text-gray-600 w-full md:w-32 relative"},Le={class:"flex flex-col md:flex-row mb-2 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80"},Se={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},Be={key:0,class:"text-[9px] text-green-800"},$e=["onClick"],Ie={key:1,class:"flex justify-end gap-5"},Xe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(A,{emit:z}){const C=A,I=se(),p=X(),V=d(g("company-id")),h=d(g("from-department-id")),T=d(g("to-department-id")),a=d(g("user-ids")),o=d(g("month")),i=d(g("status")),v=d(g("is-important")),_=d(g("is-urgent")),U=d(g("is-target")),y=d(g("search")),Y=z,f=me(),E=ae([]);function g(r){return{get:()=>C.modelValue[r]||"",set:e=>{Y("update:modelValue",{...C.modelValue,[r]:e||void 0})}}}const Z=d(()=>ee(a.value));async function W(){var r,e,x;if(!C.isMyTask){const b=(r=C.modelValue)==null?void 0:r["company-id"],s=T.value,c={...b?{company_id:b}:{},...s?{department_ids:[s]}:{}};E.value=((x=(e=await ie({params:c}))==null?void 0:e.data)==null?void 0:x.employees)||[]}}oe(async()=>{await f.fetchCompanies({with:"departments",ignore_permission:!0}),await f.fetchMyCompanies({with:"departments"}),await W()});function ee(r){return Array.isArray(E.value)&&E.value.find(e=>e.id==r)||null}function te(){a.value=""}G(()=>T.value,W),G(()=>V.value,()=>{h.value="",T.value=""});function L(r,e,{value:x,id:b,label:s,onCancel:c}={}){if(!r)return[];const u=Array.isArray(e)?e.find(k=>(k==null?void 0:k[b])==r):null;return u?[{label:s,value:typeof x=="function"?x(u):u==null?void 0:u[x],id:u==null?void 0:u[b],onCancel:c}]:[]}const le=d(()=>{var b;const r=f.companies.reduce((s,c)=>[...s,...c.departments],[]),e=(s,{label:c,value:u,id:k,onCancel:q})=>s?[{label:c,value:u,id:k,onCancel:q}]:[],x=(s,{label:c,onCancel:u})=>{if(!s)return[];const k=new Date(s);return[{label:c,value:k.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:s,onCancel:u}]};return[...L(V.value,f.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{V.value=""}}),...L(h.value,r,{id:"id",label:"From",value:s=>s.short_name||s.name,onCancel:()=>{h.value=""}}),...L(T.value,r,{id:"id",label:"To",value:s=>s.short_name||s.name,onCancel:()=>{T.value=""}}),...L((b=Z.value)==null?void 0:b.id,E.value,{label:"Employee",value:"name",id:"id",onCancel:te}),...L(i.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{i.value=""}}),...e(v.value,{label:"",value:"Important ",id:!0,onCancel:()=>{v.value=""}}),...e(_.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{_.value=""}}),...e(U.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{U.value=""}}),...x(o.value,{label:"",onCancel:()=>{o.value=""}})]}),H=d(()=>V.value?f==null?void 0:f.companies.filter(r=>r.id==V.value):f==null?void 0:f.companies);return(r,e)=>{var b,s,c,u,k,q;const x=ne("RouterLink");return n(),m("div",null,[l("div",xe,[e[22]||(e[22]=l("div",{class:"flex justify-between items-start"},[l("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List")],-1)),l("div",be,[l("div",ge,[A.isMyTask?M("",!0):(n(),m(j,{key:0},[l("div",ke,[D(ve,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t),options:((b=w(f))==null?void 0:b.companies)||[],label:"name",id:"id",class:"border-2 border-gray-300 rounded h-[40px] w-full md:w-48 bg-white text-sm",clearable:""},{"selected-option":B(({option:t})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:t==null?void 0:t.name},[t!=null&&t.name?(n(),m("span",Ce,F(t==null?void 0:t.name),1)):(n(),m("span",Ve,"--Select Company--"))],8,we)]),_:1},8,["modelValue","options"]),e[11]||(e[11]=l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),D(J,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),companies:H.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300"},defaultOption:"--ALL DEPARTMENT--"},{label:B(()=>e[12]||(e[12]=[l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),w(p).name!=="MyTaskList"?(n(),N(J,{key:0,modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=t=>T.value=t),companies:H.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300  "},defaultOption:"--ALL DEPARTMENT--"},{label:B(()=>e[13]||(e[13]=[l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):M("",!0),w(I).isAdminMood&&((c=(s=w(I))==null?void 0:s.user)==null?void 0:c.role)!=="employee"?(n(),m("div",Te,[l("div",_e,[D(pe,{employees:E.value,modelValue:a.value,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value=t),class:"border-2 border-gray-300 rounded h-[40px] w-full bg-white !text-sm"},null,8,["employees","modelValue"]),e[14]||(e[14]=l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))]),e[15]||(e[15]=l("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):M("",!0)],64)),l("div",Ae,[e[17]||(e[17]=l("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),$(l("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>i.value=t),class:"h-full text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[16]||(e[16]=[l("option",{value:""},"--ALL TASKS--",-1),l("option",{value:"not-completed"},"Not Completed",-1),l("option",{value:"only-completed"},"Completed",-1)]),512),[[re,i.value]])]),l("div",Me,[l("label",he,[$(l("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=t=>v.value=t)},null,512),[[R,v.value]]),e[18]||(e[18]=l("span",null,"Important",-1))]),l("label",Ue,[$(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=t=>_.value=t)},null,512),[[R,_.value]]),e[19]||(e[19]=l("span",null,"Urgent",-1))]),l("label",De,[$(l("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=t=>U.value=t)},null,512),[[R,U.value]]),e[20]||(e[20]=l("span",null,"Is Target",-1))])]),l("div",Ee,[e[21]||(e[21]=l("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),$(l("input",{id:"month-filter","onUpdate:modelValue":e[8]||(e[8]=t=>o.value=t),type:"month",class:"h-10 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[ue,o.value]])])]),A.isMyTask?(n(),N(Q,{key:0,modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=t=>y.value=t),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):M("",!0)])]),l("div",Le,[A.isMyTask?M("",!0):(n(),N(Q,{key:0,modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=t=>y.value=t),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),l("div",Se,[(n(!0),m(j,null,P(le.value,t=>(n(),m("div",{key:t.label||t.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[l("div",null,[t.label?(n(),m("span",Be,F(t.label)+": ",1)):M("",!0),O(F(t.value),1)]),l("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:de(t.onCancel,["prevent"])},e[23]||(e[23]=[l("i",{class:"fas fa-times-circle"},null,-1)]),8,$e)]))),128))]),A.isMyTask?M("",!0):(n(),m("div",Ie,[D(x,{class:K(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((u=w(p).query)==null?void 0:u.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...w(p).query,view:"userwise"}}},{default:B(()=>e[24]||(e[24]=[O(" User Wise List ")])),_:1,__:[24]},8,["class","to"]),D(x,{class:K(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((k=w(p).query)==null?void 0:k.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((q=w(p))==null?void 0:q.query)||{}).filter(t=>{var S;return((S=w(p))==null?void 0:S.query[t])!=="userwise"}).reduce((t,S)=>({...t,[S]:w(p).query[S]}),{})}}},{default:B(()=>e[25]||(e[25]=[O(" TaskWise List ")])),_:1,__:[25]},8,["class","to"])]))])])}}},qe={class:"w-full"},Ne={class:"w-full table-fixed bg-white rounded-md"},je={class:"border rounded-md align-top bg-blue-50"},ze={key:0,class:"sticky top-16 py-2 px-2 z-40 bg-blue-100/70"},Fe={class:"space-y-4 mt-4"},Ye={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(A,{emit:z}){const C=A,I=X(),p=z,V=d(()=>C.tasks.reduce((a,o)=>(a.push(...o.users.filter(i=>!a.find(v=>v.id==i.id&&i.id))),a),[]).filter(a=>C.selectedUserId?a.id==C.selectedUserId:!0)),h=a=>{const i=C.tasks.filter(v=>v.users.some(_=>_.id===a));return ce(i,{...I.query,"user-ids":a})},T=d(()=>V.value.map(a=>{const o=h(a.id);return{...a,tasks:o}}));return(a,o)=>(n(),m("div",qe,[l("table",Ne,[l("tbody",null,[(n(!0),m(j,null,P(T.value,i=>{var v;return n(),m("tr",{key:i.id},[l("td",je,[l("div",null,[((v=i.tasks)==null?void 0:v.length)>0?(n(),m("div",ze,[D(ye,{user:i,class:""},null,8,["user"])])):M("",!0),l("div",Fe,[(n(!0),m(j,null,P(i.tasks,(_,U)=>(n(),N(fe,{key:_.id,task:_,class:"!border-0",index:U,isMyTask:A.isMyTask,onCommentButtonClick:o[0]||(o[0]=y=>p("commentButtonClick",a.item.id)),onEditClick:o[1]||(o[1]=y=>p("editClick",y)),onAddClick:o[2]||(o[2]=y=>p("addClick",y)),onEmployeeAssignClick:o[3]||(o[3]=y=>p("employeeAssignClick",y))},null,8,["task","index","isMyTask"]))),128))])])])])}),128))])])]))}};export{Xe as _,Ye as a};
