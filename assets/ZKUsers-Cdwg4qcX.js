import{M as E,r as v,D as g,s as K,m as P,x as Z,c as k,g as j,o as y,a as e,t as f,w as q,h as w,v as C,a2 as F,p as L,C as z,e as R,q as D,f as O,k as x,F as _,n as $,K as T}from"./index-Bc90buTO.js";import{u as G}from"./zk-device-DQnj0ioh.js";import{L as H}from"./LoaderView-B2Lw7IyU.js";import{_ as J,a as Q}from"./HeaderWithButtons-DsfHOf_F.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const M=E("zkUser",()=>{const U=v([]),r=v(!1),c=v(null);async function p(){var n,i;r.value=!0,c.value=null;try{const l=await g.get("/zk-users");U.value=l.data}catch(l){c.value=((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||l.message}finally{r.value=!1}}async function u(n){var i;try{const l=await g.post("/zk-users",n);return await p(),l.data}catch(l){throw((i=l.response)==null?void 0:i.data)||l}}async function o(n,i){var l;try{const s=await g.put(`/zk-users/${n}`,i);return await p(),s.data}catch(s){throw((l=s.response)==null?void 0:l.data)||s}}async function b(n){var i;try{const l=await g.delete(`/zk-users/${n}`);return await p(),l.data}catch(l){throw((i=l.response)==null?void 0:i.data)||l}}return{users:U,loading:r,error:c,fetchUsers:p,createUser:u,updateUser:o,deleteUser:b}}),W={key:0,class:"modal-bg"},X={class:"modal-card"},Y={class:"text-xl font-bold mb-4 text-center"},ee={class:"relative"},se=["type"],te={class:"flex justify-end gap-4 mt-4"},le={__name:"ZKUserModal",props:{editUser:Object,show:Boolean},emits:["close","saved"],setup(U,{emit:r}){const c=r,p=U,u=M(),o=K({zk_userid:"",name:"",password:"",role:0,cardno:""}),b=P(()=>!!p.editUser),n=v(!1);Z(()=>p.editUser,l=>{l?(o.zk_userid=l.zk_userid||"",o.name=l.name||"",o.password=l.password||"",o.role=l.role||0,o.cardno=l.cardno||""):(o.zk_userid="",o.name="",o.password="",o.role=0,o.cardno="")},{immediate:!0});const i=async()=>{const l={...o};b.value?await u.updateUser(p.editUser.id,l):await u.createUser(l),c("saved"),c("close")};return(l,s)=>U.show?(y(),k("div",W,[e("div",X,[e("h2",Y,f(b.value?"Edit User":"Add User"),1),e("form",{onSubmit:q(i,["prevent"]),class:"space-y-4"},[e("div",null,[s[7]||(s[7]=e("label",{class:"block"},"User ID",-1)),w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=d=>o.zk_userid=d),type:"text",class:"input-1",required:""},null,512),[[C,o.zk_userid]])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block"},"Name",-1)),w(e("input",{"onUpdate:modelValue":s[1]||(s[1]=d=>o.name=d),type:"text",class:"input-1",required:""},null,512),[[C,o.name]])]),e("div",null,[s[9]||(s[9]=e("label",{class:"block"},"Password",-1)),e("div",ee,[w(e("input",{"onUpdate:modelValue":s[2]||(s[2]=d=>o.password=d),type:n.value?"text":"password",class:"input-1"},null,8,se),[[F,o.password]]),e("span",{class:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:s[3]||(s[3]=d=>n.value=!n.value)},[e("i",{class:L(n.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block"},"Role",-1)),w(e("select",{"onUpdate:modelValue":s[4]||(s[4]=d=>o.role=d),class:"input-1"},s[10]||(s[10]=[e("option",{value:0},"User",-1),e("option",{value:14},"Admin",-1)]),512),[[z,o.role]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block"},"Card No",-1)),w(e("input",{"onUpdate:modelValue":s[5]||(s[5]=d=>o.cardno=d),type:"text",class:"input-1"},null,512),[[C,o.cardno]])]),e("div",te,[e("button",{type:"button",onClick:s[6]||(s[6]=d=>c("close")),class:"px-4 py-2 bg-gray-500 text-white rounded"}," Cancel "),s[13]||(s[13]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded"},"Save",-1))])],32)])])):j("",!0)}},oe={class:"my-container space-y-4"},ae={key:1,class:"overflow-x-auto card-bg"},ne={class:"min-w-full text-sm text-left text-gray-700"},ie={class:"bg-gray-200 uppercase text-xs text-gray-600 tracking-wider"},re={class:"p-3"},de={class:"p-3"},ue=["value"],ce={class:"p-3"},pe={class:"p-3"},ve={class:"p-3 font-medium"},me={class:"p-3 font-medium"},fe={class:"p-3"},be={class:"p-3 space-x-6"},ye=["onClick"],ke=["onClick"],we={class:"card-bg p-4 md:p-6 space-y-4"},Ue=["disabled"],ge=["value"],xe={class:"flex justify-center"},he=["disabled"],ze={__name:"ZKUsers",setup(U){const r=M(),c=G(),p=v(""),u=v([]),o=v(!1),b=v(null),n=v(!1),i=v(null);R(()=>{r.fetchUsers(),c.fetchDevices()});function l(){b.value=null,o.value=!0}function s(m){b.value={...m},o.value=!0}function d(){o.value=!1}function V(){r.fetchUsers(),d()}function N(m){i.value=m,n.value=!0}async function A(){await r.deleteUser(i.value),i.value=null,n.value=!1,r.fetchUsers()}async function I(){const m=prompt("Enter Device ID to push selected users:");m&&(await r.bulkPush(Number(m),u.value),u.value=[])}function B(m){m.target.checked?u.value=r.users.map(t=>t.id):u.value=[]}return(m,t)=>(y(),k(_,null,[e("div",oe,[D(J,{title:"ZK User Management",onAdd:l}),x(r).loading?(y(),O(H,{key:0})):(y(),k("div",ae,[e("table",ne,[e("thead",ie,[e("tr",null,[e("th",re,[e("input",{type:"checkbox",onChange:t[0]||(t[0]=a=>B(a))},null,32)]),t[4]||(t[4]=e("th",{class:"p-3"},"ID",-1)),t[5]||(t[5]=e("th",{class:"p-3"},"Device User ID",-1)),t[6]||(t[6]=e("th",{class:"p-3"},"Name (Software)",-1)),t[7]||(t[7]=e("th",{class:"p-3"},"Name (Device)",-1)),t[8]||(t[8]=e("th",{class:"p-3"},"Fingers",-1)),t[9]||(t[9]=e("th",{class:"p-3"},"Role",-1)),t[10]||(t[10]=e("th",{class:"p-3"},"Actions",-1))])]),e("tbody",null,[(y(!0),k(_,null,$(x(r).users,a=>{var S;return y(),k("tr",{key:a.id,class:"border-b hover:bg-gray-50 transition-colors duration-150"},[e("td",de,[w(e("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":t[1]||(t[1]=h=>u.value=h)},null,8,ue),[[T,u.value]])]),e("td",ce,f(a.zk_uid),1),e("td",pe,f(a.zk_userid),1),e("td",ve,f((S=a==null?void 0:a.user)==null?void 0:S.name),1),e("td",me,f(a.name),1),e("td",fe,f(a.fingerprints_count),1),e("td",be,[e("button",{onClick:h=>s(a),class:"text-blue-600 hover:text-blue-800 font-semibold"},t[11]||(t[11]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ye),e("button",{onClick:h=>N(a.id),class:"text-red-600 hover:text-red-800 font-semibold"},t[12]||(t[12]=[e("i",{class:"fas fa-trash"},null,-1)]),8,ke)])])}),128))])])])),e("div",we,[e("div",null,[t[14]||(t[14]=e("h2",{class:"text-lg font-semibold"},"Bulk Actions",-1)),e("p",null,"Selected Users: "+f(u.value.length),1),t[15]||(t[15]=e("label",{class:"block text-gray-700 font-medium mb-1"},"Select Device",-1)),w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>p.value=a),class:"input-1",disabled:x(c).loading},[t[13]||(t[13]=e("option",{disabled:"",value:""},"-- Choose a device --",-1)),(y(!0),k(_,null,$(x(c).devices,a=>(y(),k("option",{key:a.id,value:a.id},f(a.name)+" ("+f(a.ip_address)+") ",9,ge))),128))],8,Ue),[[z,p.value]])]),e("div",xe,[e("button",{onClick:I,class:"btn-2",disabled:u.value.length===0}," Push Selected ",8,he)])])]),D(le,{show:o.value,editUser:b.value,onClose:d,onSaved:V},null,8,["show","editUser"]),D(Q,{show:n.value,title:"Confirm Deletion",message:"Are you sure you want to delete this user?",onClose:t[3]||(t[3]=a=>n.value=!1),onConfirm:A},null,8,["show"])],64))}};export{ze as default};
