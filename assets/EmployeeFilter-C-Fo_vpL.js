import{s as B,r as y,m as g,e as L,A as m,c as u,o as p,a as d,g as b,p as x,i as w,t as V,w as P}from"./index-BaOyklmU.js";import{u as R}from"./company-D4SKdFnR.js";import{u as q}from"./department-DjIUisR4.js";import{_ as G}from"./EmployeeDropdownInput-0YMgAnrR.js";import{S as T}from"./SelectDropdown-C35nhqyK.js";const H={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},J={class:"relative"},K=["title"],Q={key:0},W={key:1,class:"text-gray-500 whitespace-nowrap"},X={class:"relative"},Y=["title"],Z={key:0},ee={key:1,class:"text-gray-800 whitespace-nowrap"},te={key:0,class:"absolute inset-0 bg-white/50 cursor-not-allowed rounded","aria-hidden":"true"},le={key:0,class:"relative"},ae={key:0,class:"relative w-full pr-6"},ie={class:"flex items-center gap-2 text-sm text-gray-700"},se={class:"line-clamp-1"},de={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},ne={class:"relative"},ce={__name:"EmployeeFilter",props:{company_id:{type:[String,Number],default:""},department_id:{type:[String,Number],default:""},employee_id:{type:[String,Number],default:""},line_type:{type:String,default:"all"},withType:{type:Boolean,default:!0},initialValue:{type:Object,default:()=>({})}},emits:["update:company_id","update:department_id","update:employee_id","update:line_type","filter-change"],setup(k,{emit:z}){const a=k,n=z,v=R(),C=q(),{companies:O}=B(v),{departments:D}=B(C),o=y(String(a.company_id||a.initialValue.company_id||"")),r=y(a.department_id!==""?String(a.department_id):a.initialValue.department_id&&a.initialValue.department_id!=="all"?String(a.initialValue.department_id):""),i=y(a.withType?String(a.line_type||a.initialValue.line_type||"all"):null),s=y(String(a.employee_id||a.initialValue.employee_id||"")),U=g(()=>(O.value||[]).map(t=>({id:String(t.id),label:t.name}))),$=g(()=>(D.value||[]).map(t=>({id:String(t.id),label:t.name}))),F=g(()=>a.withType?[{id:"all",label:"All Types"},{id:"executive",label:"Executive"},{id:"support_staff",label:"Support Staff"},{id:"doctor",label:"Doctor"},{id:"academy_body",label:"Academy Body"}]:[]),E=g(()=>v.employees||[]),S=y([]);L(async()=>{await v.fetchCompanies({ignore_permission:!0}),o.value&&await N(o.value),_(),M()}),m(()=>a.company_id,t=>{const l=String(t||"");l!==o.value&&(o.value=l)}),m(()=>a.department_id,t=>{const l=t===""||t==null?"":String(t);l!==r.value&&(r.value=l)}),m(()=>a.employee_id,t=>{const l=String(t||"");l!==s.value&&(s.value=l)}),m(()=>a.line_type,t=>{if(!a.withType)return;const l=String(t||"all");l!==i.value&&(i.value=l)}),m(o,async t=>{r.value="",s.value="",S.value=[],n("update:company_id",t||""),n("update:department_id",""),n("update:employee_id",""),t?await N(t):D.value=[],_(),f()}),m([r,i],()=>{n("update:department_id",r.value||""),a.withType&&n("update:line_type",i.value||"all"),_(),f()}),m(s,()=>{n("update:employee_id",s.value||""),f()});async function N(t){await Promise.all([C.fetchDepartments(t),v.fetchEmployee(t)])}function A(t){return{...t,id:String(t.id),label:t.name||t.label||`${t.first_name??""} ${t.last_name??""}`.trim()}}function _(){let t=[...E.value];r.value&&(t=t.filter(e=>String(e.department_id)===String(r.value))),a.withType&&i.value&&i.value!=="all"&&(t=t.filter(e=>String(e.type)===String(i.value)));let l=t.map(A);if(s.value&&!l.some(c=>c.id===String(s.value))){const c=E.value.find(I=>String(I.id)===String(s.value));c&&(l=[A(c),...l])}S.value=l}function M(){n("update:company_id",o.value||""),n("update:department_id",r.value||""),a.withType&&n("update:line_type",i.value||"all"),n("update:employee_id",s.value||""),f()}let h=null;function f(){h&&clearTimeout(h),h=setTimeout(()=>n("filter-change",{company_id:o.value,department_id:r.value,line_type:i.value,employee_id:s.value}),0)}function j(){a.withType&&(i.value="all",_())}return(t,l)=>(p(),u("div",H,[d("div",J,[x(T,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=e=>o.value=e),options:U.value,class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white",clearable:""},{"selected-option":w(({option:e})=>[d("div",{class:"line-clamp-1 text-sm text-gray-900",title:e==null?void 0:e.label},[e!=null&&e.label?(p(),u("span",Q,V(e==null?void 0:e.label),1)):(p(),u("span",W,"--Select Company--"))],8,K)]),_:1},8,["modelValue","options"]),l[5]||(l[5]=d("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),d("div",X,[x(T,{modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=e=>r.value=e),options:$.value,class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white",clearable:""},{"selected-option":w(({option:e})=>[d("div",{class:"line-clamp-1 text-sm text-gray-900",title:e==null?void 0:e.label},[e!=null&&e.label?(p(),u("span",Z,V(e==null?void 0:e.label),1)):(p(),u("span",ee,"--All Departments--"))],8,Y)]),_:1},8,["modelValue","options"]),l[6]||(l[6]=d("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Department ",-1)),o.value?b("",!0):(p(),u("div",te))]),k.withType?(p(),u("div",le,[x(T,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value=e),options:F.value,placeholder:"Select Type",class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white"},{"selected-option":w(({option:e})=>[e?(p(),u("div",ae,[d("div",ie,[d("div",se,V(e==null?void 0:e.label),1)]),i.value&&i.value!=="all"?(p(),u("div",de,[d("button",{onClick:l[2]||(l[2]=P(c=>j(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"}," Ã— ")])):b("",!0)])):b("",!0)]),_:1},8,["modelValue","options"]),l[7]||(l[7]=d("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Line Type ",-1))])):b("",!0),d("div",ne,[x(G,{employees:S.value,modelValue:s.value,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value=e),class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white"},null,8,["employees","modelValue"]),l[8]||(l[8]=d("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))])]))}};export{ce as _};
