import{f as K,u as J,G as W,q as R,h as X,c as v,o as m,a as n,d as G,k as Z,H as te,m as O,A as ne,B as ae,r as N,x as L,C as H,ad as se,j as F,F as E,e as Y,s as B,t as f,O as Q,b as j,v as le,i as oe}from"./index-DIq5m9p6.js";import{_ as re}from"./EmployeeFilter-BK44xt64.js";import"./company-DZp6dPED.js";import"./department-DDcgrP2T.js";import"./EmployeeDropdownInput-DSNsq7RH.js";import"./SelectDropdown-Dl9Hjy9i.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-DotAyPGR.js";const ie={class:"flex flex-wrap items-end gap-3"},de={__name:"BoardFilters",props:{modelValue:{type:Object,required:!0},companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(_,{emit:d}){const I=_,T=d,M=K(),P=J(),b={type:null,user_type:"Probationary"},w=(o={})=>({type:o.type??b.type,company_id:o.companyId??null,department_id:o.departmentId??null,employee_id:o.employeeId??null,line_type:o.lineType??null,user_type:o.user_type??b.user_type}),g=(o={})=>({type:o.type??b.type,companyId:o.company_id??null,departmentId:o.department_id??null,employeeId:o.employee_id??null,lineType:o.line_type??null,user_type:o.user_type??b.user_type}),l=W(w(I.modelValue));let c=!1;function C(){c||T("update:modelValue",{...g(l)})}const h=["type","company_id","department_id","employee_id","line_type","user_type"],p=o=>o===""||o===null||o===void 0||o==="all";function $(){const o={};return!p(l.type)&&String(l.type)!==String(b.type)&&(o.type=String(l.type)),p(l.company_id)||(o.company_id=String(l.company_id)),p(l.department_id)||(o.department_id=String(l.department_id)),p(l.employee_id)||(o.employee_id=String(l.employee_id)),p(l.line_type)||(o.line_type=String(l.line_type)),!p(l.user_type)&&String(l.user_type)!==b.user_type&&(o.user_type=String(l.user_type)),o}function x(o={}){const e={...M.query};for(const u of h)delete e[u];const s={...e,...$(),...o};for(const u of Object.keys(s)){const S=s[u];(S===""||S===null||S===void 0)&&delete s[u]}return s}let t=null;function i({replace:o=!0,partial:e={},debounce:s=150}={}){t&&clearTimeout(t),t=setTimeout(()=>{const u=x(e);(o?P.replace({query:u}):P.push({query:u})).catch(()=>{})},s)}function r(){const o={...g(l)};T("submit",o),i({replace:!0,debounce:0})}return R(()=>I.modelValue,o=>{const e=w(o||{});let s=!1;for(const u of Object.keys(e))if(l[u]!==e[u]){s=!0;break}s&&(c=!0,Object.assign(l,e),ne(()=>{c=!1}))},{deep:!0}),R(()=>[l.type,l.company_id,l.department_id,l.employee_id,l.line_type,l.user_type],()=>{C(),i({replace:!0,debounce:150})}),X(()=>{M.query.user_type&&(l.user_type=String(M.query.user_type))}),R(()=>M.query.user_type,o=>{o!=null&&(l.user_type=String(o))}),(o,e)=>(m(),v("div",ie,[n("div",null,[e[7]||(e[7]=n("label",{class:"block text-xs text-gray-500 mb-1"},"User Type",-1)),Z(n("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.user_type=s),class:"border rounded px-2 py-1"},e[6]||(e[6]=[n("option",{value:"Probationary"},"Probationary",-1),n("option",{value:"Permanent"},"Permanent",-1),n("option",{value:"Contract"},"Contract",-1)]),512),[[te,l.user_type]])]),G(re,{company_id:l.company_id,"onUpdate:company_id":e[1]||(e[1]=s=>l.company_id=s),department_id:l.department_id,"onUpdate:department_id":e[2]||(e[2]=s=>l.department_id=s),employee_id:l.employee_id,"onUpdate:employee_id":e[3]||(e[3]=s=>l.employee_id=s),line_type:l.line_type,"onUpdate:line_type":e[4]||(e[4]=s=>l.line_type=s),"with-type":!0,"initial-value":O(M).query,companies:_.companies,departments:_.departments,onFilterChange:e[5]||(e[5]=s=>{Object.assign(l,s)})},null,8,["company_id","department_id","employee_id","line_type","initial-value","companies","departments"]),n("button",{class:"btn-2 py-1",onClick:r}," Apply ")]))}},ee=ae("checklistBoard",()=>{const _=N(!1),d=N(null),I=N("joining"),T=N("Probationary"),M=N(null),P=N(null),b=N(""),w=N([]),g=N([]),l=N(Object.create(null)),c=N(null),C=a=>typeof a=="string"?a.toLowerCase():"",h=a=>Array.isArray(a)?a:[],p=a=>{var y;return((y=a==null?void 0:a.data)==null?void 0:y.data)??(a==null?void 0:a.data)},$=a=>{var y,k;return((y=a==null?void 0:a.company)==null?void 0:y.name)||(a==null?void 0:a.company_name)||((k=a==null?void 0:a.organization)==null?void 0:k.name)||"—"},x=a=>{var y,k;return((y=a==null?void 0:a.department)==null?void 0:y.name)||((k=a==null?void 0:a.dept)==null?void 0:k.name)||(a==null?void 0:a.department_name)||"—"},t=a=>{var y;return((y=a==null?void 0:a.position)==null?void 0:y.title)||(a==null?void 0:a.designation)||"—"},i=(a={})=>{const y={user_type:T.value||void 0,type:I.value||void 0,company_id:M.value||void 0,department_id:P.value||void 0,search:(b.value||"").trim()||void 0,template_id:o.value||void 0};return Object.keys(y).forEach(k=>(y[k]==null||y[k]==="")&&delete y[k]),{...y,...a}},r=L(()=>{const a=C(I.value);return w.value.find(y=>C(y==null?void 0:y.type)===a)||null}),o=L(()=>{var a;return((a=r.value)==null?void 0:a.id)??null});async function e(a={}){try{const y=await H.get("/checklist-templates",{params:a});w.value=h(p(y))}catch(y){throw w.value=[],d.value=y,y}}async function s(a,y){const{data:k}=await H.patch(`/user/${a}/employment-type`,{employment_type:y}),D=g.value.findIndex(z=>z.id===a);return D!==-1&&(this.users[D]={...this.users[D],employment_type:I}),this.rows[a]&&(this.rows[a]={...this.rows[a]}),k}async function u(a={}){if(c.value)try{await c.value}catch{}_.value=!0,d.value=null;const y=i(a),k=(async()=>{try{const D=await H.get("/users-checklists",{params:y});g.value=h(p(D))}catch(D){throw g.value=[],d.value=D,D}finally{_.value=!1,c.value=null}})();return c.value=k,k}async function S({withUsers:a=!0,templateParams:y={},userParams:k={}}={}){_.value=!0,d.value=null;try{w.value.length||await e(y),a&&await u(k)}catch(D){throw d.value=D,D}finally{_.value=!1}}function V(a){g.value=h(a)}function A(a={}){"type"in a&&(I.value=a.type),"companyId"in a&&(M.value=a.companyId),"departmentId"in a&&(P.value=a.departmentId),"search"in a&&(b.value=a.search)}function U(){I.value="joining",M.value=null,P.value=null,b.value=""}function q(){l.value=Object.create(null)}return{loading:_,error:d,type:I,companyId:M,departmentId:P,search:b,templates:w,users:g,rows:l,templateByType:r,templateId:o,companyNameOf:$,departmentNameOf:x,positionTitleOf:t,loadBoard:S,loadTemplates:e,loadUsers:u,setUsers:V,setFilters:A,resetFilters:U,clearRowCache:q,updateEmploymentType:s}}),ce={class:"space-y-1"},pe={class:"inline-flex rounded-lg border p-0.5 text-[11px] bg-white"},ue=["onClick"],ye={key:0,class:"group relative"},me={class:"relative h-2 w-full overflow-hidden rounded-full bg-gray-100 ring-1 ring-inset ring-gray-200"},fe=["aria-valuenow"],ve={class:"mt-1 flex items-center justify-between text-[11px] text-gray-600"},_e={class:"flex items-center gap-2"},be={class:"font-medium"},ge={class:"hidden sm:inline"},he={key:1,class:"space-y-1.5"},xe={key:0},we={key:1,class:"text-red-600"},ke={key:2,class:"text-gray-500"},Ce={key:2,class:"space-y-1.5"},$e={key:0},Me={key:1,class:"text-red-600"},Ie={key:2,class:"text-gray-500"},Pe={__name:"ChecklistProgressCell",props:{user:{type:Object,required:!0},actualPercent:{type:Number,required:!0},targetPercent:{type:Number,required:!0}},setup(_){const d=_,I=(e,s,u)=>Math.min(Math.max(Number(e||0),s),u),T=e=>e<0?0:e>100?100:Math.round(e),M=e=>e?new Date(e):null,P=(e,s)=>{const u=new Date(e.getTime()),S=u.getMonth()+(s||0);return u.setMonth(S),u.getMonth()!==(S%12+12)%12&&u.setDate(0),u},b=(e,s)=>Math.round((e-s)/864e5),w=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",g=e=>String(e||"").toLowerCase(),l=L(()=>{var e;return g((e=d.user)==null?void 0:e.employment_type)});function c(e){const s=g(e==null?void 0:e.employment_type)==="probationary",u=M(e==null?void 0:e.joining_date)||M(e==null?void 0:e.created_at),S=Number(e==null?void 0:e.probation_months)||0,V=Number(e==null?void 0:e.probation_extension_months)||0;if(!s||!u||Number.isNaN(S)||S<=0)return{enabled:!1,start:null,end:null,pct:0,leftDays:null,status:"inactive",reason:s?"No probation months/start date":"Not probationary"};const A=Math.max(1,S+(V||0)),U=P(u,A),q=new Date,a=Math.max(1,b(U,u)),y=Math.max(0,Math.min(a,b(q,u))),k=b(U,q),D=T(y/a*100),z=k<0?"overdue":k<=14?"near_end":"active";return{enabled:!0,start:u,end:U,pct:D,leftDays:k,status:z}}function C(e){const s=g(e==null?void 0:e.employment_type)==="contract",u=M(e==null?void 0:e.joining_date)||M(e==null?void 0:e.created_at),S=Number((e==null?void 0:e.contract_month)??(e==null?void 0:e.contract_months)??(e==null?void 0:e.contract_duration_months)??0),V=Number((e==null?void 0:e.contract_extension_months)??0);if(!s||!u||Number.isNaN(S)||S<=0)return{enabled:!1,start:null,end:null,pct:0,leftDays:null,status:"inactive",reason:s?"No contract months/start date":"Not contract"};const A=Math.max(1,S+(V||0)),U=P(u,A),q=new Date,a=Math.max(1,b(U,u)),y=Math.max(0,Math.min(a,b(q,u))),k=b(U,q),D=T(y/a*100),z=k<0?"overdue":k<=30?"near_end":"active";return{enabled:!0,start:u,end:U,pct:D,leftDays:k,status:z}}const h=e=>e?"bg-gradient-to-r from-emerald-500 to-emerald-600":"bg-gradient-to-r from-amber-500 to-amber-600",p=(e,s="amber")=>e==="overdue"?{track:"bg-red-100",fill:"bg-red-500",tone:"text-red-600"}:e==="near_end"?{track:s==="blue"?"bg-indigo-100":"bg-orange-100",fill:s==="blue"?"bg-indigo-500":"bg-orange-500",tone:"text-gray-700"}:e==="inactive"?{track:"bg-gray-100",fill:"bg-gray-300",tone:"text-gray-500"}:{track:s==="blue"?"bg-blue-100":"bg-amber-100",fill:s==="blue"?"bg-blue-500":"bg-amber-500",tone:"text-gray-600"},$=N("permanent"),x=L(()=>c(d.user)),t=L(()=>C(d.user)),i=L(()=>[{key:"permanent",label:"Permanent"},{key:"probationary",label:"Probationary"},{key:"contract",label:"Contract"}]);se(()=>{i.value.map(s=>s.key).includes($.value)||($.value="permanent")}),R([l],()=>{const e=l.value;e&&["permanent","probationary","contract"].includes(e)&&$.value!==e&&($.value=e)},{immediate:!0});function r(e){["permanent","probationary","contract"].includes(e)&&($.value=e)}const o=L(()=>{const e=I(d.actualPercent,0,100),s=I(d.targetPercent,1,100);return $.value!=="permanent"?"":e>=s?"Met":`Short by ${Math.max(0,s-e)}%`});return(e,s)=>(m(),v("div",ce,[n("div",pe,[(m(!0),v(E,null,Y(i.value,u=>(m(),v("button",{key:u.key,class:B(["px-2 py-0.5 rounded-md",$.value===u.key?"bg-gray-900 text-white":"text-gray-700"]),onClick:S=>r(u.key)},f(u.label),11,ue))),128))]),$.value==="permanent"?(m(),v("div",ye,[n("div",me,[n("div",{class:"pointer-events-none absolute top-0 h-2 w-0.5 bg-gray-600/60",style:Q({left:`calc(${_.targetPercent}% - 1px)`})},null,4),n("div",{class:B(["h-2 transition-all duration-500 ease-out",h(_.actualPercent>=_.targetPercent)]),style:Q({width:_.actualPercent+"%"}),role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":_.actualPercent},null,14,fe)]),n("div",ve,[n("div",_e,[n("span",be,"Actual: "+f(_.actualPercent)+"%",1),n("span",ge,"Target: "+f(_.targetPercent)+"%",1)]),n("span",{class:B(["rounded-full px-1.5 py-0.5 ring-1 text-[10px]",_.actualPercent>=_.targetPercent?"bg-emerald-50 text-emerald-700 ring-emerald-200":"bg-amber-50 text-amber-700 ring-amber-200"])},f(o.value),3)])])):$.value==="probationary"?(m(),v("div",he,[n("div",{class:B(["relative w-full h-1.5 overflow-hidden rounded-full",p(x.value.status).track])},[n("div",{class:B(["h-1.5 transition-all duration-500 ease-out",p(x.value.status).fill]),style:Q({width:(x.value.enabled?x.value.pct:0)+"%"})},null,6)],2),n("div",{class:B(["flex items-center justify-between text-[11px]",p(x.value.status).tone])},[n("span",null,[s[0]||(s[0]=j(" Probation: ")),x.value.enabled?(m(),v(E,{key:0},[j(f(x.value.pct)+"%",1)],64)):(m(),v(E,{key:1},[j("Not set")],64))]),x.value.enabled&&x.value.leftDays>=0?(m(),v("span",xe,f(w(x.value.start))+" → "+f(w(x.value.end))+" · "+f(x.value.leftDays)+"d left ",1)):x.value.enabled?(m(),v("span",we,f(w(x.value.start))+" → "+f(w(x.value.end))+" · Overdue "+f(Math.abs(x.value.leftDays))+"d ",1)):(m(),v("span",ke,"No tenure data"))],2)])):$.value==="contract"?(m(),v("div",Ce,[n("div",{class:B(["relative w-full h-1.5 overflow-hidden rounded-full",p(t.value.status,"blue").track])},[n("div",{class:B(["h-1.5 transition-all duration-500 ease-out",p(t.value.status,"blue").fill]),style:Q({width:(t.value.enabled?t.value.pct:0)+"%"})},null,6)],2),n("div",{class:B(["flex items-center justify-between text-[11px]",p(t.value.status,"blue").tone])},[n("span",null,[s[1]||(s[1]=j(" Contract: ")),t.value.enabled?(m(),v(E,{key:0},[j(f(t.value.pct)+"%",1)],64)):(m(),v(E,{key:1},[j("Not set")],64))]),t.value.enabled&&t.value.leftDays>=0?(m(),v("span",$e,f(w(t.value.start))+" → "+f(w(t.value.end))+" · "+f(t.value.leftDays)+"d left ",1)):t.value.enabled?(m(),v("span",Me,f(w(t.value.start))+" → "+f(w(t.value.end))+" · Expired "+f(Math.abs(t.value.leftDays))+"d ",1)):(m(),v("span",Ie,"No data"))],2)])):F("",!0)]))}},Ne={class:"flex items-center gap-2"},Te={class:"relative"},Se=["disabled","value"],De=["value"],je={key:0,class:"absolute right-2 top-1/2 h-3 w-3 -translate-y-1/2 animate-spin text-gray-400",viewBox:"0 0 24 24"},Be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Oe={class:"relative z-10 w-[92vw] max-w-sm rounded-xl bg-white p-4 shadow-xl"},Le={class:"mt-2 text-[13px] text-gray-600"},Ue={class:"font-medium"},qe={class:"font-medium"},Ee={class:"font-medium"},Fe={__name:"EmploymentTypeCell",props:{user:{type:Object,required:!0},saving:{type:Boolean,default:!1},value:{type:String,required:!0},onConfirmChange:{type:Function,required:!0}},setup(_){const d=_,I=[{value:"probationary",label:"Probationary"},{value:"permanent",label:"Permanent"},{value:"contract",label:"Contract"}],T=h=>{var p;return((p=I.find($=>$.value===h))==null?void 0:p.label)||"—"},M=h=>h==="probationary"?"bg-amber-50 text-amber-700 ring-amber-200":h==="permanent"?"bg-green-50 text-green-700 ring-green-200":h==="contract"?"bg-blue-50 text-blue-700 ring-blue-200":"bg-gray-50 text-gray-700 ring-gray-200",P=N(!1),b=N(""),w=L(()=>T(d.value)),g=L(()=>T(b.value));function l(h){const p=h.target.value;p!==d.value&&(b.value=p,P.value=!0)}async function c(){const h=b.value;P.value=!1,h&&(await d.onConfirmChange(h),b.value="")}function C(){P.value=!1,b.value=""}return(h,p)=>{var $,x,t;return m(),v("div",Ne,[n("span",{class:B(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] ring-1",M(_.value)])},f(T(_.value)),3),n("div",Te,[n("select",{disabled:_.saving,value:_.value,class:"rounded-md border bg-white px-2 py-1 text-[11px] outline-none disabled:opacity-50",onChange:l,"aria-label":"Change employment type"},[(m(),v(E,null,Y(I,i=>n("option",{key:i.value,value:i.value},f(i.label),9,De)),64))],40,Se),_.saving?(m(),v("svg",je,p[0]||(p[0]=[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3",fill:"none"},null,-1),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3A5 5 0 007 12H4z"},null,-1)]))):F("",!0)]),P.value?(m(),v("div",Be,[p[6]||(p[6]=n("div",{class:"absolute inset-0 bg-black/40"},null,-1)),n("div",Oe,[p[5]||(p[5]=n("h3",{class:"text-sm font-semibold"},"Confirm status change",-1)),n("p",Le,[p[1]||(p[1]=j(" Change ")),n("span",Ue,f(w.value),1),p[2]||(p[2]=j(" ➜ ")),n("span",qe,f(g.value),1),p[3]||(p[3]=j(" for ")),n("span",Ee,f((($=_.user)==null?void 0:$.name)||((x=_.user)==null?void 0:x.full_name)||((t=_.user)==null?void 0:t.email)),1),p[4]||(p[4]=j("? "))]),n("div",{class:"mt-4 flex items-center justify-end gap-2"},[n("button",{class:"px-3 py-1.5 rounded-md text-[12px] border",onClick:C},"Cancel"),n("button",{class:"px-3 py-1.5 rounded-md text-[12px] bg-gray-900 text-white hover:bg-black",onClick:c}," Confirm ")])])])):F("",!0)])}}},Ve={class:"space-y-4"},Ae={class:"flex flex-wrap items-center gap-2"},ze={class:"relative"},Re={class:"ml-auto"},Qe={class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs text-blue-700"},Ge={class:"ml-1 font-medium"},He={class:"overflow-x-auto rounded-xl border shadow-sm"},Je={class:"min-w-full text-[13px]"},Ye={class:"p-2"},Ke={class:"p-2"},We={class:"flex items-center gap-2"},Xe={class:"relative h-8 w-8 shrink-0"},Ze=["src"],et={key:1,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 text-[11px] font-semibold text-gray-700"},tt={class:"min-w-0"},nt={class:"font-medium truncate"},at={class:"text-[11px] text-gray-500 space-x-2 truncate"},st={key:0},lt={class:"hidden sm:inline"},ot={class:"p-2 hidden md:table-cell"},rt=["title"],it={class:"p-2"},dt={class:"p-2"},ct={class:"p-2"},pt=["disabled","title","onClick"],ut={key:0,class:"text-gray-600 text-sm"},yt={key:1,class:"rounded-xl border border-dashed p-10 text-center text-sm text-gray-500"},mt={__name:"ChecklistBoardTable",setup(_){const d=ee(),I=J(),T=N(""),M=N(!1),P=N("progress_desc"),b=W({}),w=t=>{var i;return((i=d.rows)==null?void 0:i[String(t==null?void 0:t.id)])||{}},g=(t,i,r)=>Math.min(Math.max(Number(t||0),i),r),l=t=>{const r=w(t).percent??(t==null?void 0:t.percent)??0;return g(r,0,100)},c=t=>{var i;return g(((i=t==null?void 0:t.checklist)==null?void 0:i.required_completion_percent)??100,1,100)},C=t=>{const i=o=>String(o||"").toLowerCase(),r=i(T.value);return r?[t==null?void 0:t.name,t==null?void 0:t.employee_id,t==null?void 0:t.department,t==null?void 0:t.designation].filter(Boolean).some(o=>i(o).includes(r)):!0},h=L(()=>{let t=(d.users||[]).filter(C);return M.value&&(t=t.filter(i=>l(i)<c(i))),P.value==="name_asc"?t=[...t].sort((i,r)=>(i.name||"").localeCompare(r.name||"")):P.value==="progress_asc"?t=[...t].sort((i,r)=>l(i)-l(r)):t=[...t].sort((i,r)=>l(r)-l(i)),t});function p(t){const i=d.templateId;i&&I.push({name:"checklist.create",params:{userId:t.id,templateId:i}})}const $=t=>String(t||"").toLowerCase();async function x(t,i){if(!(t!=null&&t.id))return;const r=$(t.employment_type),e=(s=>s==="probationary"?"Probationary":s==="permanent"?"Permanent":s==="contract"?"Contract":"—")(i);b[t.id]=!0,t.employment_type=i;try{await d.updateEmploymentType(t.id,e)}catch(s){t.employment_type=r,console.error(s),alert("Failed to update employment type. Please try again.")}finally{b[t.id]=!1}}return(t,i)=>(m(),v("div",Ve,[n("div",Ae,[n("div",ze,[Z(n("input",{"onUpdate:modelValue":i[0]||(i[0]=r=>T.value=r),type:"search",placeholder:"Search name / ID / dept / designation…",class:"w-64 md:w-80 max-w-full rounded-lg border bg-white/90 px-8 py-2 text-sm outline-none focus:border-gray-400"},null,512),[[le,T.value]]),i[2]||(i[2]=n("svg",{class:"pointer-events-none absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M12.9 14.32a8 8 0 111.414-1.414l3.387 3.387a1 1 0 01-1.414 1.414L12.9 14.32zM14 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1)),T.value?(m(),v("button",{key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",onClick:i[1]||(i[1]=r=>T.value=""),"aria-label":"Clear search"},"✕")):F("",!0)]),n("div",Re,[n("span",Qe,[i[3]||(i[3]=j(" Template: ")),n("span",Ge,f(O(d).templateId||"Not selected"),1)])])]),n("div",He,[n("table",Je,[i[4]||(i[4]=n("thead",{class:"sticky top-0 bg-gray-50/90 backdrop-blur"},[n("tr",{class:"text-left border-b"},[n("th",{class:"p-2 w-10"},"#"),n("th",{class:"p-2 min-w-[220px]"},"User"),n("th",{class:"p-2 hidden md:table-cell min-w-[160px]"},"Role"),n("th",{class:"p-2 min-w-[260px]"},"Progress"),n("th",{class:"p-2 w-48"},"Status"),n("th",{class:"p-2 w-36"},"Actions")])],-1)),n("tbody",null,[(m(!0),v(E,null,Y(h.value,(r,o)=>(m(),v("tr",{key:r.id,class:"border-b hover:bg-gray-50/70"},[n("td",Ye,f(o+1),1),n("td",Ke,[n("div",We,[n("div",Xe,[r.avatar?(m(),v("img",{key:0,src:r.avatar,alt:"",class:"h-8 w-8 rounded-full object-cover"},null,8,Ze)):(m(),v("div",et,f((r.name||r.full_name||r.email||"??").slice(0,2).toUpperCase()),1))]),n("div",tt,[n("div",nt,f(r.name||r.full_name||r.email),1),n("div",at,[r.joining_date?(m(),v("span",st,"Joining Date: "+f(r.joining_date),1)):F("",!0),n("span",lt,"Dept: "+f(r.department||"—"),1)])])])]),n("td",ot,[n("div",{class:"truncate",title:r.designation},f(r.designation||"—"),9,rt)]),n("td",it,[G(Pe,{user:r,"actual-percent":l(r),"target-percent":c(r)},null,8,["user","actual-percent","target-percent"])]),n("td",dt,[G(Fe,{user:r,value:String(r.employment_type).toLowerCase(),saving:!!b[r.id],"on-confirm-change":e=>x(r,e)},null,8,["user","value","saving","on-confirm-change"])]),n("td",ct,[n("button",{class:"px-3 py-1.5 rounded-md text-[12px] font-medium bg-gray-900 text-white hover:bg-black disabled:opacity-40",disabled:!O(d).templateId,title:O(d).templateId?"":"Select a template first",onClick:e=>p(r)},f(r!=null&&r.checklist?"Open":"Create"),9,pt)])]))),128))])])]),O(d).loading?(m(),v("div",ut,"Loading…")):!O(d).loading&&h.value.length===0?(m(),v("div",yt," No users found for the current filters. ")):F("",!0)]))}},ft={class:"p-6 space-y-6"},vt={class:"flex items-center justify-between"},_t={class:"text-2xl font-semibold"},bt={class:"text-gray-500"},gt={key:0,class:"text-gray-600"},ht={key:1,class:"text-red-600"},Nt={__name:"JoiningExitBoard",setup(_){const d=ee(),I=K(),T=J(),M=N([]),P=N([]),b=(c={})=>({type:c.type??d.type,companyId:c.company_id?Number(c.company_id):null,departmentId:c.department_id?Number(c.department_id):null,employeeId:c.employee_id?Number(c.employee_id):null,lineType:c.line_type??null,user_type:c.user_type??null,search:c.search??d.search}),w=(c={})=>{const C={type:c.type||void 0,company_id:c.companyId||void 0,department_id:c.departmentId||void 0,employee_id:c.employeeId||void 0,line_type:c.lineType||void 0,user_type:c.user_type||void 0,search:c.search||void 0};return Object.keys(C).forEach(h=>(C[h]==null||C[h]==="")&&delete C[h]),C},g=N({type:d.type,companyId:d.companyId,departmentId:d.departmentId,employeeId:null,lineType:null,user_type:null,search:d.search});R(g,c=>{d.type=c.type,d.user_type=c.user_type,d.companyId=c.companyId??null,d.departmentId=c.departmentId??null,d.search=c.search??"",T.replace({query:{...I.query,...w(c)}})},{deep:!0,immediate:!0});async function l(){await d.loadUsers({type:g.value.type,company_id:g.value.companyId,department_id:g.value.departmentId,employee_id:g.value.employeeId,line_type:g.value.lineType,user_type:g.value.user_type,search:g.value.search})}return X(async()=>{Object.assign(g.value,b(I.query)),await d.loadBoard({withUsers:!0,userParams:w(g.value)})}),(c,C)=>{var h,p;return m(),v("div",ft,[n("div",vt,[n("h1",_t,[n("b",null,f(((h=O(d).templateByType)==null?void 0:h.name)||"—"),1),C[1]||(C[1]=j(" Board"))]),n("div",bt,[C[2]||(C[2]=j(" Template: ")),n("b",null,f(((p=O(d).templateByType)==null?void 0:p.name)||"—"),1)])]),G(de,{modelValue:g.value,"onUpdate:modelValue":C[0]||(C[0]=$=>g.value=$),companies:M.value,departments:P.value,onSubmit:l},null,8,["modelValue","companies","departments"]),O(d).loading?(m(),v("div",gt,"Loading…")):O(d).error?(m(),v("div",ht,"Failed to load.")):(m(),oe(mt,{key:2}))])}}};export{Nt as default};
