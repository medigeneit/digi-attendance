import{_ as ae}from"./CommentModal-Cljv9D6m.js";import{u as ne,O as Y,_ as re}from"./task-priority-CbAt-KSp.js";import{L as ie}from"./LoaderView-45X10oWR.js";import{_ as ue}from"./TaskAddForm-BlUk6b_H.js";import{_ as de}from"./TaskEditForm-5R0GlLW-.js";import{q as k,s as me,A as te,e as se,c as u,o,a as t,f as A,w as F,g as U,C as Z,F as h,x as R,t as j,h as r,l as v,p as S,D as H,v as pe,y as O,b as ce,u as ye,r as V,E as fe,k as ve,m as M,n as ee}from"./index-Bq3f3wcr.js";import{_ as ke}from"./MultiselectDropdown-BZUH1_a3.js";import{u as be}from"./company-JJle0TU9.js";import{_ as le}from"./UserChip-DZuKO4mk.js";import{_ as oe}from"./TaskTreeView-C1cI4H75.js";import{u as ge}from"./useTaskStore-RZ0jMdb5.js";import"./useCommentStore-CdLZus9K.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-BUWpKWBP.js";import"./useRequirementStore-Ck1_RRW7.js";import"./SectionLoading-BF2YT7oF.js";import"./vue-multiselect.esm-BkH2lNjX.js";import"./datetime-BISRKKpq.js";const xe={class:"mb-3 task-header"},we={class:"flex justify-between items-center"},Ce={class:"ml-auto flex gap-6 items-center"},_e={key:0,class:"flex gap-2 items-center"},Te={class:"flex flex-wrap items-center gap-2 mt-3"},qe={class:"flex flex-wrap gap-4 w-full"},Ie={class:"text-gray-600 w-full md:w-64 relative"},Ve=["value"],$e={class:"relative w-full md:w-72"},Ue={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Se={class:"text-gray-600 w-40 relative"},Ae={class:"flex gap-4 items-center flex-shrink-0"},he={class:"flex gap-2"},Le={class:"flex gap-2"},Ee={class:"flex gap-2"},De={class:"text-gray-600 w-full md:w-40 md:ml-auto relative"},Pe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(L,{emit:y}){const s=L,b=k(g("company-id")),w=k(g("user-ids")),_=k(g("month")),I=k(g("status")),a=k(g("is-important")),i=k(g("is-urgent")),d=k(g("is-target")),c=y,f=be(),{companies:T,employees:E}=me(f);function g(m){return{get:()=>s.modelValue[m]||"",set:e=>{console.log("---SETTING modelValue: ",{key:m,value:e}),c("update:modelValue",{...s.modelValue,[m]:e||void 0})}}}const q=k(()=>B(w.value));async function $(m){m&&await f.fetchEmployee(m)}te(()=>b.value,$),se(async()=>{var m,e;await f.fetchCompanies(),(m=s.modelValue)!=null&&m["company-id"]&&await $((e=s.modelValue)==null?void 0:e["company-id"])});function B(m){return Array.isArray(E.value)&&E.value.find(e=>e.id==m)||null}function N(m){w.value=(m==null?void 0:m.id)||""}function D(){w.value=""}return(m,e)=>(o(),u("div",xe,[t("div",we,[e[10]||(e[10]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",Ce,[L.listHasRearranged?(o(),u("div",_e,[e[9]||(e[9]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=F(l=>c("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=F(l=>c("clickPriorityDiscard"),["prevent"]))},"Discard")])):A("",!0),t("button",{onClick:e[2]||(e[2]=l=>c("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",Te,[t("div",qe,[t("div",Ie,[e[12]||(e[12]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Company",-1)),U(t("select",{id:"company-filter","onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),class:"input-1"},[e[11]||(e[11]=t("option",{value:""},"All Company",-1)),(o(!0),u(h,null,R(r(T),l=>(o(),u("option",{key:l.id,value:l.id},j(l.name),9,Ve))),128))],512),[[Z,b.value]])]),t("div",$e,[v(ke,{modelValue:q.value,onSelect:N,onRemove:D,options:r(E),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employees",class:"text-gray-600 w-full"},{option:S(({option:l})=>[v(le,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),q.value?(o(),u("div",Ue,[t("button",{onClick:F(D,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):A("",!0),e[13]||(e[13]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))]),t("div",Se,[e[15]||(e[15]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),U(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>I.value=l),class:"input-1"},e[14]||(e[14]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[Z,I.value]])]),t("div",Ae,[t("label",he,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>a.value=l)},null,512),[[H,a.value]]),e[16]||(e[16]=t("span",null,"Important",-1))]),t("label",Le,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>i.value=l)},null,512),[[H,i.value]]),e[17]||(e[17]=t("span",null,"Urgent",-1))]),t("label",Ee,[U(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>d.value=l)},null,512),[[H,d.value]]),e[18]||(e[18]=t("span",null,"Is Target",-1))])]),t("div",De,[e[19]||(e[19]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),U(t("input",{id:"month-filter","onUpdate:modelValue":e[8]||(e[8]=l=>_.value=l),type:"month",class:"input-1",placeholder:"All month"},null,512),[[pe,_.value]])])])])]))}},Be={class:"w-full bg-white rounded"},Me=["rowspan"],Re={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(L,{emit:y}){const s=L,b=y,w=k(()=>s.tasks.reduce((a,i)=>(a.push(...i.users.filter(d=>!a.find(c=>c.id==d.id&&d.id))),a),[]).filter(a=>s.selectedUserId?a.id==s.selectedUserId:!0)),_=a=>s.tasks.filter(c=>c.users.some(f=>f.id===a)),I=k(()=>w.value.map(a=>{const i=_(a.id);return{...a,tasks:i}}));return(a,i)=>(o(),u("div",null,[t("table",Be,[t("tbody",null,[(o(!0),u(h,null,R(I.value,d=>(o(),u(h,{key:d.id},[(o(!0),u(h,null,R(d.tasks,(c,f)=>(o(),u("tr",{key:c.id},[f==0?(o(),u("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(d.tasks.length,1)},[v(le,{user:d,class:"sticky top-[80px]"},null,8,["user"])],8,Me)):A("",!0),t("td",{class:O(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":f==0,"border-b":d.tasks.length-1===f}])},[v(oe,{task:c,class:"!border-0 my-0",index:f,onCommentButtonClick:i[0]||(i[0]=T=>b("commentButtonClick",a.item.id)),onEditClick:i[1]||(i[1]=T=>b("editClick",T)),onAddClick:i[2]||(i[2]=T=>b("addClick",T))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Ne={class:"container mx-auto p-6 relative"},Fe={class:"mb-4"},He={class:"w-full flex justify-end gap-5 mb-1"},je={key:3},Oe={key:0,class:"text-center py-4 text-red-500"},ze={key:1},We={class:"flex items-stretched"},Ge={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Je=1,ct={__name:"TaskList",setup(L){const y=ge(),s=ce(),b=ye(),w=V(!1),_=V(null),I=V(!1),a=V(null),i=V(!1),d=fe({parentId:0,requirementId:0}),c=V(null),f=V([]),{handleItemsPriorityUpdate:T,saveTaskPriority:E,listHasRearranged:g}=ne(()=>y.taskListTree,0);se(async()=>{s.query.status||b.push({query:{...s.query,status:"not-completed"}}),await q()});async function q(){I.value=!!s.query["user-ids"];const x=await y.fetchTasks({...s.query},{newList:!0,loadingBeforeFetch:!0});f.value=x.query_log||[]}const $=x=>{i.value=!0,d.parentId=x},B=x=>{_.value=x,w.value=!0},N=()=>{w.value=!1,_.value=null};async function D(){a.value=null,i.value=!1,d.parentId=0,await q()}async function m(){i.value=!1,d.parentId=0,await q()}async function e(){E()&&await q()}te(()=>({...s.query}),async()=>{await q()});const l=k({get(){return{...s.query}},set(x){localStorage.removeItem("sub_task_opened_list"),b.push({query:{...x}})}});return(x,n)=>{var W,G,J,K,Q,X;const z=ve("RouterLink");return o(),u("div",Ne,[a.value?(o(),M(Y,{key:0},{default:S(()=>[v(de,{taskId:a.value,onClose:n[0]||(n[0]=p=>a.value=null),onUpdated:D},null,8,["taskId"])]),_:1})):A("",!0),i.value?(o(),M(Y,{key:1},{default:S(()=>[v(ue,{parentTaskId:d.parentId,requirementId:d.requirementId,onClose:m,onTaskCreated:D},null,8,["parentTaskId","requirementId"])]),_:1})):A("",!0),v(Pe,{modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=p=>l.value=p),onClickAddTask:$,onClickPrioritySave:e,onClickPriorityDiscard:n[2]||(n[2]=()=>r(g)?c.value.resetItems:null),"list-has-rearranged":r(g),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((G=(W=r(s))==null?void 0:W.query)==null?void 0:G["query-log"])=="true"?(o(!0),u(h,{key:2},R(f.value,(p,C)=>(o(),u("div",{key:C,class:"text-xs text-gray-500"},[t("div",Fe,j(p.raw_query),1)]))),128)):A("",!0),t("div",He,[v(z,{class:O(["text-sm btn-3 py-0.5",((J=r(s).query)==null?void 0:J.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...r(s).query,view:"userwise"}}},{default:S(()=>n[9]||(n[9]=[ee(" User Wise List ")])),_:1,__:[9]},8,["class","to"]),v(z,{class:O(["text-sm btn-3 py-0.5",((K=r(s).query)==null?void 0:K.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((Q=r(s))==null?void 0:Q.query)||{}).filter(p=>{var C;return((C=r(s))==null?void 0:C.query[p])!=="userwise"}).reduce((p,C)=>({...p,[C]:r(s).query[C]}),{})}}},{default:S(()=>n[10]||(n[10]=[ee(" TaskWise List ")])),_:1,__:[10]},8,["class","to"])]),r(y).loading?(o(),u("div",je,[v(ie)])):(o(),u(h,{key:4},[r(y).error?(o(),u("div",Oe,j(r(y).error),1)):r(y).tasks.length>0?(o(),u("div",ze,[((X=r(s).query)==null?void 0:X.view)=="userwise"?(o(),M(Re,{key:0,tasks:r(y).tasks,selectedUserId:r(s).query["user-ids"],onCommentButtonClick:n[3]||(n[3]=p=>B(p,x.task.id)),onEditClick:n[4]||(n[4]=p=>a.value=p),onAddClick:n[5]||(n[5]=p=>$(p))},null,8,["tasks","selectedUserId"])):(o(),M(re,{key:1,items:r(y).tasks,handle:"handle",onItemsUpdate:r(T),class:"space-y-4",ref_key:"draggableTaskList",ref:c},{item:S(({item:p,index:C})=>[t("div",We,[v(oe,{task:p,index:C,showDraggableHandle:!I.value,onCommentButtonClick:n[6]||(n[6]=P=>B(P,x.task.id)),onEditClick:n[7]||(n[7]=P=>a.value=P),onAddClick:n[8]||(n[8]=P=>$(P)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(o(),u("div",Ge," No tasks found. "))],64)),v(ae,{show:w.value,"commentable-id":_.value,"commentable-type":"task","user-id":Je,"on-close":N,onSubmitted:r(y).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{ct as default};
