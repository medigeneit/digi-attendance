import{r as i,q as K,c as d,k as A,o as n,a as e,t as f,_ as W,g as Z,D as ee,R as le,u as se,E as te,x as T,h as ae,p as oe,j,d as O,m as E,b as q,n as P,F as G,e as z,w as ne,l as g,v as U,G as ie}from"./index-f4zPxwY7.js";import{L as de}from"./LoaderView-B7lS9Ul6.js";import{C as re}from"./ChangePasswordModal-aRDOvB7L.js";const ue={key:0,class:"modal-bg z-50"},pe={class:"modal-card relative"},ce={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-200 bg-opacity-75 z-10"},ve=["src"],me={class:"flex justify-center mt-4"},fe=["disabled"],be={__name:"PhotoModal",props:{imageSrc:{type:String,default:""},isOpen:{type:Boolean,default:!1}},emits:["close","fileSelected","uploadPhoto"],setup(X,{emit:_}){const t=_,b=i(null),C=i(!1),s=i(!1),V=i(!1),p=X,S=i(p.isOpen),h=i(p.imageSrc),B=()=>{S.value=!1,t("close"),k()},I=x=>{const c=x.target.files[0];if(c){const M=new FileReader;M.onload=N=>{h.value=N.target.result,C.value=!0},M.readAsDataURL(c),t("fileSelected",c)}},w=()=>{b.value.click()},y=()=>{C.value?(s.value=!0,t("uploadPhoto",b.value.files[0]),setTimeout(()=>{s.value=!1,V.value=!0},2e3)):w()},k=()=>{C.value=!1,s.value=!1,V.value=!1};return K(()=>p.isOpen,x=>{S.value=x,x&&(h.value=p.imageSrc,k())}),(x,c)=>S.value?(n(),d("div",ue,[e("div",pe,[s.value?(n(),d("div",ce,c[0]||(c[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"},null,-1)]))):A("",!0),h.value?(n(),d("img",{key:1,src:h.value,alt:"Modal Image",class:"aspect-[3/4] object-cover rounded-md"},null,8,ve)):A("",!0),e("div",me,[e("button",{class:"btn-2",onClick:y,disabled:s.value},f(C.value?"Upload Photo":"Change Photo"),9,fe)]),e("input",{type:"file",ref_key:"fileInput",ref:b,class:"hidden",onChange:I},null,544),e("button",{onClick:B,class:"absolute top-2 right-2 text-red-500 text-xl"},c[1]||(c[1]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):A("",!0)}},he={class:"my-container"},ge={class:"header-card"},_e={class:"actions"},ye={class:"mt-6 grid gap-6 lg:grid-cols-[360px_1fr]"},ke={class:"card"},xe={class:"p-5 md:p-6"},Pe={class:"flex items-center gap-4"},Ue=["src"],Ce={key:1,class:"h-full w-full grid place-items-center avatar-fallback"},we={class:"min-w-0"},Se={class:"name truncate"},Be={class:"muted truncate"},Me={class:"mt-2 flex flex-wrap gap-2"},De={class:"chip"},Fe={class:"chip chip-soft"},Ve={class:"mt-6 space-y-3"},Ie={class:"meta-label"},Ne={class:"meta-value truncate"},Ae={class:"card"},Oe={class:"p-5 md:p-6"},Xe={class:"section"},$e={class:"grid gap-4 md:grid-cols-2"},Le={class:"section"},Re={class:"grid gap-4 md:grid-cols-2"},Te=["value"],je={class:"md:col-span-2"},Ee={class:"flex flex-col sm:flex-row items-center justify-between gap-3 pt-4 border-t border-slate-200"},qe={class:"flex flex-wrap gap-2"},Ge=["disabled"],ze={key:0},Ke={key:1},Ye={__name:"ProfileEdit",setup(X){const _=Z(),{user:t}=ee(_),b=le(),C=se(),s=te({name:"",bn_name:"",phone:"",email:"",nid:"",date_of_birth:"",address:"",blood:""}),V=["A+","A-","B+","B-","AB+","AB-","O+","O-"],p=i(!1),S=i(!1),h=i(!1),B=i(!1),I=i(null),w=i(null),y=i(!1),k=i(!1),x=T(()=>{var r,u;const o=(((r=t.value)==null?void 0:r.name)||"").trim();if(!o)return"U";const l=o.split(" ").filter(Boolean),v=((u=l[0])==null?void 0:u[0])||"U",m=l.length>1?l[l.length-1][0]:"";return(v+m).toUpperCase()}),c=T(()=>{var o,l,v,m,r,u;return[{label:"Employee ID",value:((o=t.value)==null?void 0:o.employee_id)||((l=t.value)==null?void 0:l.id)||"-"},{label:"Company",value:((m=(v=t.value)==null?void 0:v.company)==null?void 0:m.name)||"-"},{label:"Department",value:((u=(r=t.value)==null?void 0:r.department)==null?void 0:u.name)||"-"}]}),M=()=>{var o,l,v,m,r,u,D,F;s.name=((o=t.value)==null?void 0:o.name)||"",s.bn_name=((l=t.value)==null?void 0:l.bn_name)||"",s.phone=((v=t.value)==null?void 0:v.phone)||"",s.email=((m=t.value)==null?void 0:m.email)||"",s.address=((r=t.value)==null?void 0:r.address)||"",s.nid=((u=t.value)==null?void 0:u.nid)||"",s.blood=((D=t.value)==null?void 0:D.blood)||"",s.date_of_birth=((F=t.value)==null?void 0:F.date_of_birth)||""};ae(()=>{t.value&&M()}),K(t,o=>{o&&M()},{immediate:!0});const N=()=>{var o;I.value=((o=t.value)==null?void 0:o.photo)||null,B.value=!0},$=()=>{B.value=!1,w.value=null,k.value=!1},Y=o=>{w.value=o},H=()=>{h.value=!1},J=async()=>{if(!p.value)try{p.value=!0,await _.updateProfile(s),b.success("Profile updated successfully!"),C.push({name:"MyProfile"})}catch(o){console.error("Failed to update profile:",o),b.error(_.error||"Failed to save profile!")}finally{p.value=!1}},Q=async()=>{if(!w.value||y.value)return;const o=new FormData;o.append("photo",w.value),o.append("user_id",t.value.id);try{y.value=!0,await _.uploadProfilePhoto(o),k.value=!0,b.success("Image updated successfully!"),setTimeout(()=>{$(),y.value=!1,k.value=!1},900)}catch(l){console.error("Failed to upload photo:",l),b.error(_.error||"Failed to save profile!")}finally{y.value=!1}};return(o,l)=>{var m,r,u,D,F,L,R;const v=oe("RouterLink");return n(),d("div",he,[e("div",ge,[l[10]||(l[10]=e("div",null,[e("p",{class:"kicker"},"Account Settings"),e("h2",{class:"heading"},"Update Profile"),e("p",{class:"subheading"}," Keep your information up to date. Changes reflect across systems instantly. ")],-1)),e("div",_e,[O(v,{to:{name:"MyProfile"},class:"btn-1"},{default:E(()=>l[9]||(l[9]=[q(" Back ")])),_:1,__:[9]}),e("button",{type:"button",class:"btn-2",onClick:l[0]||(l[0]=a=>h.value=!0)}," Change Password ")])]),e("div",ye,[e("div",ke,[e("div",xe,[e("div",Pe,[e("button",{type:"button",class:"avatar-btn group",onClick:N,"aria-label":"Change profile photo"},[(m=P(t))!=null&&m.photo?(n(),d("img",{key:0,class:"h-full w-full object-cover",src:P(t).photo,alt:"Profile Photo"},null,8,Ue)):(n(),d("div",Ce,f(x.value),1)),l[11]||(l[11]=e("div",{class:"avatar-overlay"},[e("span",{class:"chip chip-solid"},"Change")],-1))]),e("div",we,[e("p",Se,f(((r=P(t))==null?void 0:r.name)||"Your Name"),1),e("p",Be,f(((D=(u=P(t))==null?void 0:u.designation)==null?void 0:D.title)||"Designation"),1),e("div",Me,[e("span",De,f(((L=(F=P(t))==null?void 0:F.role)==null?void 0:L.name)||"User"),1),e("span",Fe,f(((R=P(t))==null?void 0:R.phone)||"No phone"),1)])])]),e("div",Ve,[(n(!0),d(G,null,z(c.value,a=>(n(),d("div",{key:a.label,class:"meta-row"},[e("p",Ie,f(a.label),1),e("p",Ne,f(a.value),1)]))),128))]),l[12]||(l[12]=e("div",{class:"mt-6 tip-box"},[e("p",{class:"tip-title"},"Tips"),e("p",{class:"tip-text"}," Use a clear photo and keep phone/email updated for notifications. ")],-1))])]),e("div",Ae,[e("div",Oe,[S.value?(n(),j(de,{key:0,class:"rounded-2xl border border-slate-200 bg-white shadow-none"})):(n(),d("form",{key:1,onSubmit:ne(J,["prevent"]),class:"space-y-6"},[e("div",Xe,[l[17]||(l[17]=e("div",{class:"section-head"},[e("div",null,[e("p",{class:"section-title"},"Basic Information"),e("p",{class:"section-sub"},"Name, phone and contact details.")])],-1)),e("div",$e,[e("div",null,[l[13]||(l[13]=e("label",{class:"field-label"},"Name",-1)),g(e("input",{"onUpdate:modelValue":l[1]||(l[1]=a=>s.name=a),type:"text",required:"",class:"input-light",placeholder:"Full name"},null,512),[[U,s.name]])]),e("div",null,[l[14]||(l[14]=e("label",{class:"field-label"},"Bangla Name",-1)),g(e("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>s.bn_name=a),type:"text",class:"input-light",placeholder:"বাংলা নাম"},null,512),[[U,s.bn_name]])]),e("div",null,[l[15]||(l[15]=e("label",{class:"field-label"},"Phone",-1)),g(e("input",{"onUpdate:modelValue":l[3]||(l[3]=a=>s.phone=a),type:"text",required:"",class:"input-light",placeholder:"01XXXXXXXXX"},null,512),[[U,s.phone]])]),e("div",null,[l[16]||(l[16]=e("label",{class:"field-label"},"Email",-1)),g(e("input",{"onUpdate:modelValue":l[4]||(l[4]=a=>s.email=a),type:"email",class:"input-light",placeholder:"name@email.com"},null,512),[[U,s.email]])])])]),e("div",Le,[l[23]||(l[23]=e("div",{class:"section-head"},[e("div",null,[e("p",{class:"section-title"},"Personal Details"),e("p",{class:"section-sub"},"Blood group, NID, DOB and address.")])],-1)),e("div",Re,[e("div",null,[l[19]||(l[19]=e("label",{class:"field-label"},"Blood Group",-1)),g(e("select",{"onUpdate:modelValue":l[5]||(l[5]=a=>s.blood=a),class:"input-light"},[l[18]||(l[18]=e("option",{disabled:"",value:""},"Select blood group",-1)),(n(),d(G,null,z(V,a=>e("option",{key:a,value:a},f(a),9,Te)),64))],512),[[ie,s.blood]])]),e("div",null,[l[20]||(l[20]=e("label",{class:"field-label"},"NID",-1)),g(e("input",{"onUpdate:modelValue":l[6]||(l[6]=a=>s.nid=a),type:"text",class:"input-light",placeholder:"NID number"},null,512),[[U,s.nid]])]),e("div",null,[l[21]||(l[21]=e("label",{class:"field-label"},"Date of Birth",-1)),g(e("input",{"onUpdate:modelValue":l[7]||(l[7]=a=>s.date_of_birth=a),type:"date",class:"input-light"},null,512),[[U,s.date_of_birth]])]),e("div",je,[l[22]||(l[22]=e("label",{class:"field-label"},"Address",-1)),g(e("textarea",{"onUpdate:modelValue":l[8]||(l[8]=a=>s.address=a),rows:"3",class:"input-light",placeholder:"Full address"},null,512),[[U,s.address]])])])]),e("div",Ee,[e("div",qe,[O(v,{to:{name:"MyProfile"},class:"btn-2-red"},{default:E(()=>l[24]||(l[24]=[q(" Cancel ")])),_:1,__:[24]}),e("button",{type:"submit",class:"btn-2",disabled:p.value},[p.value?(n(),d("span",Ke,"Saving...")):(n(),d("span",ze,"Save Changes"))],8,Ge)]),e("button",{type:"button",class:"btn-1",onClick:N}," Update Photo ")])],32))])])]),h.value?(n(),j(re,{key:0,onClose:H,user:P(t)},null,8,["user"])):A("",!0),O(be,{imageSrc:I.value,isOpen:B.value,onClose:$,onFileSelected:Y,onUploadPhoto:Q,isUploading:y.value,isUploadComplete:k.value},null,8,["imageSrc","isOpen","isUploading","isUploadComplete"])])}}},We=W(Ye,[["__scopeId","data-v-c3c4cf18"]]);export{We as default};
