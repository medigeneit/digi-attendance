import{_ as ye}from"./CommentModal-BOy1xT0O.js";import{_ as ce,a as ve}from"./TaskUserAssignForm-DQBdlkMo.js";import{L as fe}from"./LoaderView-hmpYXRjA.js";import{O as Q}from"./OverlyModal-CnsgLAQl.js";import{_ as ke}from"./TaskAddForm-BuOhGJo_.js";import{_ as ge}from"./TaskEditForm-BjY5O4aA.js";import{d as ie,b as te,p as g,r as O,e as ue,q as ee,C as xe,c as p,o,a as t,f as $,g as M,F as j,y as q,h as F,A as se,x as H,t as R,k as d,i as S,w as le,H as X,v as be,j as Z,n as ae,u as we,z as oe,I as Ce}from"./index-R7vZ2RpN.js";import{_ as Te}from"./MultiselectDropdown-Dezo3VDH.js";import{g as Ie,u as Ae}from"./task-priority-BRmihBVY.js";import{u as Me}from"./company-B5HtBMP2.js";import{_ as ne}from"./CompanyDepartmentSelectInput-Diimh5kD.js";import{_ as re,m as de}from"./task-tree-CTX_QHoL.js";import{_ as me}from"./UserChip-C4BKm0kY.js";import{_ as pe}from"./TaskTreeViewWithSubTable-DmSaf2R_.js";import{u as Ve}from"./useTaskStore-BlrO0d-U.js";import"./useCommentStore-CtBPwzIf.js";import"./datetime-C4Yr_jSk.js";import"./TextWithHr-xMyc9zZj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-DnlHtuzu.js";import"./TaskUserChip-BAe2FkgT.js";import"./RequiredIcon-BwXE68AS.js";import"./useRequirementStore-BAVG08TC.js";import"./requirement-Vfjoyeqi.js";import"./SectionLoading-BOKyxEfI.js";import"./tags-NyY600LJ.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DyAwGMGL.js";import"./url-CePbr-gY.js";import"./TaskSupervisorAndEmployee-D425nwKz.js";const _e={class:"mb-3 task-header"},Le={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},qe={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Ue={class:"relative w-full md:w-48 flex-grow"},he=["value"],$e={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Ee={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Se={class:"w-32 relative h-8"},De={class:"flex gap-4 items-center flex-shrink-0"},Be={class:"flex gap-2"},Oe={class:"flex gap-2"},Pe={class:"flex gap-2"},Ne={class:"text-gray-600 w-full md:w-32 relative"},Fe={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},je={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},ze={key:0,class:"text-[9px] text-green-800"},Re=["onClick"],He={key:1,class:"flex justify-end gap-5"},We={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(E,{emit:C}){const y=E,m=ie(),T=te(),v=g(w("company-id")),U=g(w("from-department-id")),V=g(w("to-department-id")),c=g(w("user-ids")),n=g(w("month")),f=g(w("status")),x=g(w("is-important")),b=g(w("is-urgent")),A=g(w("is-target")),P=g(w("search")),K=C,_=Me(),D=O([]);function w(u){return{get:()=>y.modelValue[u]||"",set:e=>{K("update:modelValue",{...y.modelValue,[u]:e||void 0})}}}const h=g(()=>W(c.value));async function N(){var u,e,a;if(!y.isMyTask){const l=(u=y.modelValue)==null?void 0:u["company-id"],i=V.value,I={...l?{company_id:l}:{},...i?{department_ids:[i]}:{}};D.value=((a=(e=await Ie({params:I}))==null?void 0:e.data)==null?void 0:a.employees)||[]}}ue(async()=>{await _.fetchCompanies({with:"departments",ignore_permission:!0}),await _.fetchMyCompanies({with:"departments"}),await N()});function W(u){return Array.isArray(D.value)&&D.value.find(e=>e.id==u)||null}function Y(u){c.value=(u==null?void 0:u.id)||""}function z(){c.value=""}ee(()=>V.value,N),ee(()=>v.value,()=>{V.value="",U.value=""});function B(u,e,{value:a,id:l,label:i,onCancel:I}={}){if(!u)return[];const k=Array.isArray(e)?e.find(r=>(r==null?void 0:r[l])==u):null;return k?[{label:i,value:typeof a=="function"?a(k):k==null?void 0:k[a],id:k==null?void 0:k[l],onCancel:I}]:[]}const J=g(()=>{var l;const u=_.companies.reduce((i,I)=>[...i,...I.departments],[]),e=(i,{label:I,value:k,id:r,onCancel:s})=>i?[{label:I,value:k,id:r,onCancel:s}]:[],a=(i,{label:I,onCancel:k})=>{if(!i)return[];const r=new Date(i);return[{label:I,value:r.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:i,onCancel:k}]};return[...B(v.value,_.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{v.value=""}}),...B(U.value,u,{id:"id",label:"From",value:i=>i.short_name||i.name,onCancel:()=>{U.value=""}}),...B(V.value,u,{id:"id",label:"To",value:i=>i.short_name||i.name,onCancel:()=>{V.value=""}}),...B((l=h.value)==null?void 0:l.id,D.value,{label:"Employee",value:"name",id:"id",onCancel:z}),...B(f.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{f.value=""}}),...e(x.value,{label:"",value:"Important ",id:!0,onCancel:()=>{x.value=""}}),...e(b.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{b.value=""}}),...e(A.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{A.value=""}}),...a(n.value,{label:"",onCancel:()=>{n.value=""}})]}),G=g(()=>v.value?_==null?void 0:_.companies.filter(u=>u.id==v.value):_==null?void 0:_.companies);return(u,e)=>{var l,i,I,k,r;const a=xe("RouterLink");return o(),p("div",null,[t("div",_e,[e[21]||(e[21]=t("div",{class:"flex justify-between items-start mb-4"},[t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List")],-1)),t("div",Le,[t("div",qe,[E.isMyTask?M("",!0):(o(),p(j,{key:0},[t("div",Ue,[e[11]||(e[11]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),F(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[10]||(e[10]=t("option",{value:""},"--ALL COMPANY--",-1)),(o(!0),p(j,null,H(d(_).companies,s=>(o(),p("option",{key:s.id,value:s.id},R(s.name),9,he))),128))],512),[[se,v.value]])]),q(ne,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=s=>U.value=s),companies:G.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:S(()=>e[12]||(e[12]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),d(T).name!=="MyTaskList"?(o(),$(ne,{key:0,modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s),companies:G.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:S(()=>e[13]||(e[13]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):M("",!0),d(m).isAdminMood&&((i=(l=d(m))==null?void 0:l.user)==null?void 0:i.role)!=="employee"?(o(),p("div",$e,[q(Te,{modelValue:h.value,onSelect:Y,onRemove:z,options:D.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:S(({option:s})=>[q(me,{user:s,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),h.value?(o(),p("div",Ee,[t("button",{onClick:le(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):M("",!0),e[14]||(e[14]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):M("",!0)],64)),t("div",Se,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),F(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>f.value=s),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[15]||(e[15]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[se,f.value]])]),t("div",De,[t("label",Be,[F(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=s=>x.value=s)},null,512),[[X,x.value]]),e[17]||(e[17]=t("span",null,"Important",-1))]),t("label",Oe,[F(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s)},null,512),[[X,b.value]]),e[18]||(e[18]=t("span",null,"Urgent",-1))]),t("label",Pe,[F(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>A.value=s)},null,512),[[X,A.value]]),e[19]||(e[19]=t("span",null,"Is Target",-1))])]),t("div",Ne,[e[20]||(e[20]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),F(t("input",{id:"month-filter","onUpdate:modelValue":e[7]||(e[7]=s=>n.value=s),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[be,n.value]])])]),E.isMyTask?(o(),$(re,{key:0,modelValue:P.value,"onUpdate:modelValue":e[8]||(e[8]=s=>P.value=s),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):M("",!0)])]),t("div",Fe,[E.isMyTask?M("",!0):(o(),$(re,{key:0,modelValue:P.value,"onUpdate:modelValue":e[9]||(e[9]=s=>P.value=s),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),t("div",je,[(o(!0),p(j,null,H(J.value,s=>(o(),p("div",{key:s.label||s.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[t("div",null,[s.label?(o(),p("span",ze,R(s.label)+": ",1)):M("",!0),Z(R(s.value),1)]),t("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:le(s.onCancel,["prevent"])},e[22]||(e[22]=[t("i",{class:"fas fa-times-circle"},null,-1)]),8,Re)]))),128))]),E.isMyTask?M("",!0):(o(),p("div",He,[q(a,{class:ae(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((I=d(T).query)==null?void 0:I.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...d(T).query,view:"userwise"}}},{default:S(()=>e[23]||(e[23]=[Z(" User Wise List ")])),_:1,__:[23]},8,["class","to"]),q(a,{class:ae(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((k=d(T).query)==null?void 0:k.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((r=d(T))==null?void 0:r.query)||{}).filter(s=>{var L;return((L=d(T))==null?void 0:L.query[s])!=="userwise"}).reduce((s,L)=>({...s,[L]:d(T).query[L]}),{})}}},{default:S(()=>e[24]||(e[24]=[Z(" TaskWise List ")])),_:1,__:[24]},8,["class","to"])]))])])}}},Ye={class:"w-full bg-white rounded"},Ge={class:"border p-4 align-top border-green-300 bg-blue-50"},Ke={class:"sticky top-[7rem] bg-white/80 py-2 z-40"},Je={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(E,{emit:C}){const y=E,m=te(),T=C,v=g(()=>y.tasks.reduce((c,n)=>(c.push(...n.users.filter(f=>!c.find(x=>x.id==f.id&&f.id))),c),[]).filter(c=>y.selectedUserId?c.id==y.selectedUserId:!0)),U=c=>{const f=y.tasks.filter(x=>x.users.some(b=>b.id===c));return de(f,{...m.query,"user-ids":c})},V=g(()=>v.value.map(c=>{const n=U(c.id);return{...c,tasks:n}}));return(c,n)=>(o(),p("div",null,[t("table",Ye,[t("tbody",null,[(o(!0),p(j,null,H(V.value,f=>(o(),p("tr",{key:f.id},[t("td",Ge,[t("div",null,[t("div",Ke,[q(me,{user:f,class:""},null,8,["user"])]),(o(!0),p(j,null,H(f.tasks,(x,b)=>(o(),$(pe,{key:x.id,task:x,class:"!border-0 my-4",index:b,isMyTask:E.isMyTask,onCommentButtonClick:n[0]||(n[0]=A=>T("commentButtonClick",c.item.id)),onEditClick:n[1]||(n[1]=A=>T("editClick",A)),onAddClick:n[2]||(n[2]=A=>T("addClick",A)),onEmployeeAssignClick:n[3]||(n[3]=A=>T("employeeAssignClick",A))},null,8,["task","index","isMyTask"]))),128))])])]))),128))])])]))}},Qe={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},Xe={class:"mb-4"},Ze={class:"relative min-h-[30vh]"},et={key:0,class:"text-center py-4 text-red-500"},tt={key:1},st={class:"flex items-stretched"},lt={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},at=1,Et={__name:"TaskList",setup(E){const C=Ve(),y=ie(),m=te(),T=we(),v=O(""),U=O(!1),V=O(null),c=g(()=>{var a;return((a=y==null?void 0:y.user)==null?void 0:a.role)==="employee"||!(y!=null&&y.isAdminMood)?!0:!!m.query["user-ids"]}),n=O(null),f=O(!1),x=oe({parentId:0,requirementId:0}),b=oe({taskId:0,isOpen:!1}),A=O(null),P=O([]),{handleItemsPriorityUpdate:K,saveTaskPriority:_,listHasRearranged:D}=Ae(()=>C.taskListTree,0);ue(async()=>{console.log("Task List Mounted"),v.value="loading",m.query.status||T.push({query:{...m.query,status:"not-completed"}}),await h()});let w;async function h(){let a;w=new AbortController,console.log({taskAbortController:w}),m.name==="MyTaskList"?a=await C.fetchMyTasks({...m.query,page:1},{signal:w.signal}):a=await C.fetchTasks({...m.query,page:1},{signal:w.signal}),v.value="",P.value=a.query_log||[]}const N=a=>{f.value=!0,x.parentId=a},W=a=>{b.taskId=a,b.isOpen=!0},Y=a=>{V.value=a,U.value=!0},z=()=>{U.value=!1,V.value=null};async function B(){n.value=null,f.value=!1,x.parentId=0,v.value="loading",await h()}async function J(){f.value=!1,x.parentId=0,await h()}async function G(){v.value="loading",await _()&&await h()}ee(()=>({...m.query}),async()=>{try{C.resetTaskList(),v.value="loading",await h()}catch{console.warn("...")}});const u=g({get(){return{...m.query}},set(a){localStorage.removeItem("sub_task_opened_list"),T.push({query:{...a}})}}),e=g(()=>{var l;const a={...m.query};return m.name=="MyTaskList"&&(a["user-ids"]=(l=y==null?void 0:y.user)==null?void 0:l.id),Array.isArray(C.tasks)?de(C.tasks,a):[]});return Ce(()=>{C.tasks.value=null,w&&w.abort()}),(a,l)=>{var i,I,k;return o(),p("div",Qe,[n.value?(o(),$(Q,{key:0},{default:S(()=>[q(ge,{taskId:n.value,onClose:l[0]||(l[0]=r=>n.value=null),onUpdated:B},null,8,["taskId"])]),_:1})):M("",!0),f.value?(o(),$(Q,{key:1},{default:S(()=>[q(ke,{parentTaskId:x.parentId,requirementId:x.requirementId,onClose:J,onTaskCreated:B},null,8,["parentTaskId","requirementId"])]),_:1})):M("",!0),b.isOpen?(o(),$(Q,{key:2,class:"*:max-w-4xl"},{default:S(()=>[q(ce,{taskId:b.taskId,onCancelClick:l[1]||(l[1]=()=>{b.isOpen=!1,b.taskId=0}),onSuccess:l[2]||(l[2]=()=>{b.isOpen=!1,b.taskId=0,v.value="loading",h()})},null,8,["taskId"])]),_:1})):M("",!0),q(We,{modelValue:u.value,"onUpdate:modelValue":l[3]||(l[3]=r=>u.value=r),onClickAddTask:N,onClickPrioritySave:G,onClickPriorityDiscard:l[4]||(l[4]=()=>d(D)?A.value.resetItems:null),"list-has-rearranged":d(D),isMyTask:d(m).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((I=(i=d(m))==null?void 0:i.query)==null?void 0:I["query-log"])=="true"?(o(!0),p(j,{key:3},H(P.value,(r,s)=>(o(),p("div",{key:s,class:"text-xs text-gray-500"},[t("div",Xe,R(r.raw_query),1)]))),128)):M("",!0),t("div",Ze,[d(C).error?(o(),p("div",et,R(d(C).error),1)):d(C).tasks.length>0?(o(),p("div",tt,[((k=d(m).query)==null?void 0:k.view)=="userwise"?(o(),$(Je,{key:0,tasks:e.value,selectedUserId:d(m).query["user-ids"],isMyTask:d(m).name==="MyTaskList",onCommentButtonClick:l[5]||(l[5]=r=>Y(r,a.task.id)),onEditClick:l[6]||(l[6]=r=>n.value=r),onAddClick:l[7]||(l[7]=r=>N(r)),onEmployeeAssignClick:l[8]||(l[8]=r=>W(r))},null,8,["tasks","selectedUserId","isMyTask"])):(o(),$(ve,{key:1,items:e.value,handle:"handle",onItemsUpdate:d(K),class:"space-y-6",ref_key:"draggableTaskList",ref:A},{item:S(({item:r,index:s})=>[t("div",st,[q(pe,{isMyTask:d(m).name==="MyTaskList",task:r,index:s,showDraggableHandle:!c.value,onCommentButtonClick:l[9]||(l[9]=L=>Y(L,a.task.id)),onEditClick:l[10]||(l[10]=L=>n.value=L),onAddClick:l[11]||(l[11]=L=>N(L)),onEmployeeAssignClick:l[12]||(l[12]=L=>W(L)),class:"!border-0 shadow hover:shadow-md"},null,8,["isMyTask","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):v.value!=="loading"?(o(),p("div",lt," No tasks found. ")):M("",!0),v.value==="loading"?(o(),$(fe,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):M("",!0)]),q(ye,{show:U.value,"commentable-id":V.value,"commentable-type":"task","user-id":at,"on-close":z,onSubmitted:d(C).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Et as default};
