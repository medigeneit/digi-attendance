import{d as Vt,r as Lt,m as Tt,A as It,K as Mt,f as jt,o as n,p as b,i as Ut,c as i,g as _,a as t,w as $t,t as o,j as r,F as x,y as h,x as Bt,k as zt,a6 as Pt,Y as Gt}from"./index-C1bkql9t.js";import{_ as f}from"./ApprovalItem-CKezAu9Y.js";import{L as Ht}from"./LoaderView-Zi2oAX2g.js";import{_ as Jt}from"./ShareComponent-BR44ynkc.js";import{u as Kt}from"./leave-application-0SOpkE3j.js";import{_ as Ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AcceptAndRejectHandler-CH4ZnEMg.js";const Yt={key:1,class:"print:text-black py-2"},qt={class:"space-y-2"},Qt={class:"grid md:grid-cols-2 print:grid-cols-2 gap-8"},Xt={class:"text-sm"},Zt={class:"pt-6"},te={key:0},ee={key:1,class:"font-semibold"},se={class:"flex justify-end gap-4"},oe={class:"table-auto border border-black bg-white text-xs"},le={class:"border border-black px-2"},ae={class:"border border-black px-2"},ne={class:"border border-black px-2"},re={class:"font-bold"},ie={class:"border border-black px-2"},de={class:"table-auto border border-black bg-white text-xs"},pe={class:"border border-black"},ue={colspan:"2",class:"border border-black px-2 w-32"},ce={class:"border border-black px-2"},be={class:"border border-black px-2"},ye={class:"font-bold"},ve={class:"border border-black px-2"},me={class:"grid print:grid-cols-2 md:grid-cols-2 text-sm"},fe={class:"list-none"},ge={class:"list-none"},_e={class:"list-none"},xe={class:"list-none"},ke={class:"list-none"},he={class:"list-none"},we={class:"list-none"},Ae={class:"text-sm"},De={class:"whitespace-pre-line"},Le={class:"pt-8 grid grid-cols-2"},Te={class:"text-sm"},je={class:"font-bold"},Be={class:"text-blue-700 print:text-black"},Ce={class:"overflow-x-auto"},Se={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},Ne={class:"border border-gray-500 px-4 py-0.5 text-left"},Fe={class:"border border-gray-500 px-4 py-0.5 text-center"},Re={class:"border border-gray-500 px-4 py-0.5 text-center"},We={class:"space-y-14"},Ee={class:"font-bold text-center text-lg"},Ve={key:0},Ie={class:"grid md:grid-cols-3 print:grid-cols-3 gap-4 text-sm items-end"},Me={class:"flex justify-evenly text-sm items-end"},Ue={class:"pt-6"},$e={key:0,class:"mb-2"},ze=["href"],Pe={key:1,class:"text-sm italic text-gray-400"},Ge={key:2,class:"mt-2"},He={__name:"LeaveApplicationModal",props:{open:{type:Boolean,default:!1},id:{type:[String,Number,null],default:null}},emits:["update:open","refetch"],setup(L,{emit:Ct}){const u=L,T=Ct,St=Vt(),y=Kt(),w=Lt(!1),j=Lt(null),s=Tt(()=>y.leaveApplication);function k(){T("update:open",!1)}function A(l){l.key==="Escape"&&k()}function Nt(l){l.stopPropagation()}function D(l=!0){document.body.style.overflow=l?"hidden":""}async function Ft(){if(!(!u.open||!u.id))try{w.value=!0,await y.fetchLeaveApplicationById(u.id)}catch(l){console.error("Failed to load leave application:",l)}finally{w.value=!1}}It(()=>u.open,l=>{l?(D(!0),window.addEventListener("keydown",A),Ft()):(D(!1),window.removeEventListener("keydown",A))},{immediate:!0}),Mt(()=>{D(!1),window.removeEventListener("keydown",A)});const v=async()=>{u.id&&(await y.fetchLeaveApplicationById(u.id),T("refetch"))},B=Tt(()=>{const l=s.value;if(!(l!=null&&l.last_working_date)||!(l!=null&&l.resumption_date))return 0;const e=new Date(l.last_working_date),d=new Date(l.resumption_date).getTime()-e.getTime();return Math.ceil(d/(1e3*60*60*24))-1}),Rt=async()=>{if(u.id)try{await y.uploadLeaveApplicationAttachment(u.id,{attachment:j.value}),await y.fetchLeaveApplicationById(u.id)}catch(l){console.error("Failed to upload attachment:",l),alert("Failed to upload attachment.")}},Wt=async l=>{var m,g;const e=(g=(m=l==null?void 0:l.target)==null?void 0:m.files)==null?void 0:g[0];if(!e)return;const c=new FormData;c.append("file",e),c.append("folder","leave-application");const d=await y.fetchFileUpload(c);j.value=(d==null?void 0:d.url)||null,Rt()},Et=l=>{if(!l)return"N/A";const e=new Date(l),c=e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),d=e.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${c} , ${d}`};return(l,e)=>(n(),jt(Gt,{to:"body"},[b(Pt,{name:"fade"},{default:Ut(()=>{var c,d,m,g,C,S,N,F,R,W,E,V,I,M,U,$,z,P,G,H,J,K,O,Y,q,Q,X,Z,tt,et,st,ot,lt,at,nt,rt,it,dt,pt,ut,ct,bt,yt,vt,mt,ft,gt,_t,xt,kt,ht,wt,At,Dt;return[L.open?(n(),i("div",{key:0,class:"fixed inset-0 z-[999] flex items-center justify-center bg-black/50",onClick:k},[t("div",{class:"relative max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-2xl bg-white px-6 shadow-2xl print:static print:overflow-visible",role:"dialog","aria-modal":"true",onClick:$t(Nt,["stop"])},[t("div",{class:"sticky top-0 z-10 flex items-center justify-between gap-2 border-b bg-white px-4 py-3 print:hidden"},[e[1]||(e[1]=t("h2",{class:"title-md md:title-lg"},"Leave Application",-1)),t("div",{class:"flex items-center gap-2"},[t("button",{class:"btn-3",onClick:k,"aria-label":"Close"},e[0]||(e[0]=[t("i",{class:"far fa-times"},null,-1)]))])]),w.value?(n(),jt(Ht,{key:0})):(n(),i("div",Yt,[t("div",qt,[t("div",Qt,[t("div",null,[e[4]||(e[4]=t("p",null,"To",-1)),e[5]||(e[5]=t("p",{class:"font-bold"},"Managing Director",-1)),t("p",null,o((m=(d=(c=s.value)==null?void 0:c.user)==null?void 0:d.company)==null?void 0:m.name),1),t("p",Xt,o((S=(C=(g=s.value)==null?void 0:g.user)==null?void 0:C.company)==null?void 0:S.address),1),t("div",null,[t("p",Zt,[e[2]||(e[2]=t("b",null,"Subject:",-1)),e[3]||(e[3]=r(" Leave Application for ")),(n(!0),i(x,null,h((N=s.value)==null?void 0:N.leave_types,(a,p)=>(n(),i(x,{key:p},[p&&a.days?(n(),i("span",te,",Â ")):_("",!0),a.days?(n(),i("span",ee,o(a.type),1)):_("",!0)],64))),128))])])]),t("div",se,[t("div",null,[e[9]||(e[9]=t("h1",{class:"font-bold"},"Summary",-1)),t("table",oe,[e[8]||(e[8]=t("thead",null,[t("tr",{class:"bg-gray-200 border border-black"},[t("th",{class:"border border-black px-2"},"Type"),t("th",{class:"border border-black px-2"},"Days")])],-1)),t("tbody",null,[(n(!0),i(x,null,h((F=s.value)==null?void 0:F.leave_types,(a,p)=>(n(),i("tr",{key:p,class:"border border-black"},[t("td",le,o(a.type),1),t("td",ae,o(a.days),1)]))),128)),t("tr",null,[e[6]||(e[6]=t("td",{class:"border-black px-2"},"WL/GHD",-1)),t("td",ne,o(B.value-((W=(R=s.value)==null?void 0:R.leave_days)==null?void 0:W.length)),1)]),t("tr",re,[e[7]||(e[7]=t("td",{class:"border border-black px-2"},"Total",-1)),t("td",ie,o(B.value),1)])])])]),t("div",null,[e[13]||(e[13]=t("h1",{class:"font-bold"},"Last Leave",-1)),t("table",de,[t("thead",null,[e[10]||(e[10]=t("tr",{class:"bg-gray-200 border border-black"},[t("th",{colspan:"2",class:"border border-black px-2"},"Date")],-1)),t("tr",pe,[t("td",ue,o(((V=(E=s.value)==null?void 0:E.last_leave)==null?void 0:V.date)||"N/A"),1)]),e[11]||(e[11]=t("tr",{class:"bg-gray-200 border border-black"},[t("th",{class:"border border-black px-2"},"Type"),t("th",{class:"border border-black px-2"},"Days")],-1))]),t("tbody",null,[(n(!0),i(x,null,h((M=(I=s.value)==null?void 0:I.last_leave)==null?void 0:M.types,(a,p)=>(n(),i("tr",{key:p,class:"border border-black"},[t("td",ce,o(a==null?void 0:a.type),1),t("td",be,o(a==null?void 0:a.days),1)]))),128)),t("tr",ye,[e[12]||(e[12]=t("td",{class:"border border-black px-2"},"Total",-1)),t("td",ve,o(($=(U=s.value)==null?void 0:U.last_leave)!=null&&$.types?s.value.last_leave.types.reduce((a,p)=>a+p.days,0):0),1)])])])])])]),t("div",null,[e[21]||(e[21]=t("h3",{class:"font-bold"},"Leave Details:",-1)),t("div",me,[t("li",fe,[e[14]||(e[14]=t("strong",null,"Reason: ",-1)),r(o(((z=s.value)==null?void 0:z.reason)||"No reason provided"),1)]),t("li",ge,[e[15]||(e[15]=t("strong",null,"Leave Days:",-1)),r(" "+o((P=s.value)==null?void 0:P.leave_period),1)]),t("li",_e,[e[16]||(e[16]=t("strong",null,"Total Days:",-1)),r(" "+o((G=s.value)==null?void 0:G.total_leave_days),1)]),t("li",xe,[e[17]||(e[17]=t("strong",null,"Weekends:",-1)),r(" "+o((O=(K=(J=(H=s.value)==null?void 0:H.user)==null?void 0:J.assign_weekend)==null?void 0:K.weekends)==null?void 0:O.join(", ")),1)]),t("li",ke,[e[18]||(e[18]=t("strong",null,"Last Working Date:",-1)),r(" "+o((Y=s.value)==null?void 0:Y.last_working_date),1)]),t("li",he,[e[19]||(e[19]=t("strong",null,"Resumption Date:",-1)),r(" "+o((q=s.value)==null?void 0:q.resumption_date),1)]),t("li",we,[e[20]||(e[20]=t("strong",null,"Create Date:",-1)),r(" "+o(Et((Q=s.value)==null?void 0:Q.created_at)),1)])])]),t("div",Ae,[t("p",De,[e[22]||(e[22]=t("strong",null,"Works in Hand: ",-1)),r(o(((X=s.value)==null?void 0:X.works_in_hand)||"No details provided"),1)])]),t("div",Le,[t("div",Te,[e[28]||(e[28]=t("hr",{class:"w-44 border-black hidden print:block my-1"},null,-1)),t("p",je,[e[23]||(e[23]=t("strong",null,"Applicant: ",-1)),t("span",Be,o((tt=(Z=s.value)==null?void 0:Z.user)==null?void 0:tt.name),1)]),t("p",null,[e[24]||(e[24]=t("strong",null,"Designation:",-1)),r(" "+o((ot=(st=(et=s.value)==null?void 0:et.user)==null?void 0:st.designation)==null?void 0:ot.title),1)]),t("p",null,[e[25]||(e[25]=t("strong",null,"Department:",-1)),r(" "+o((nt=(at=(lt=s.value)==null?void 0:lt.user)==null?void 0:at.department)==null?void 0:nt.name),1)]),t("p",null,[e[26]||(e[26]=t("strong",null,"Phone:",-1)),r(" "+o((it=(rt=s.value)==null?void 0:rt.user)==null?void 0:it.phone),1)]),t("p",null,[e[27]||(e[27]=t("strong",null,"Joining Date:",-1)),r(" "+o((pt=(dt=s.value)==null?void 0:dt.user)==null?void 0:pt.joining_date),1)])]),b(f,{application:s.value,type:"leave_applications",item:"handover",onAction:v},null,8,["application"])]),t("div",null,[e[30]||(e[30]=t("h1",{class:"font-bold"},"Leave Balance",-1)),t("div",Ce,[t("table",Se,[e[29]||(e[29]=t("thead",null,[t("tr",{class:"bg-gray-200"},[t("th",{class:"border border-gray-500 px-4 py-0.5 text-left"},"Leave Type"),t("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Total Days"),t("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Used Days"),t("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Remaining Days")])],-1)),t("tbody",null,[(n(!0),i(x,null,h((ut=s.value)==null?void 0:ut.leave_balance,(a,p)=>(n(),i("tr",{key:p,class:"hover:bg-blue-200"},[t("td",Ne,o(a.leave_type),1),t("td",Fe,o(a==null?void 0:a.total_leave_days),1),t("td",Re,o(a.used_days),1),t("td",{class:Bt(["border border-gray-500 px-4 py-0.5 text-center",{"text-green-600 font-bold":a.remaining_days>0,"text-red-600 font-bold":a.remaining_days===0}])},o(a.remaining_days),3)]))),128))])])])]),t("div",We,[t("p",Ee,[e[31]||(e[31]=r(" Leave Approval: ")),t("b",{class:Bt({"text-yellow-600":((ct=s.value)==null?void 0:ct.status)==="Pending","text-green-600":((bt=s.value)==null?void 0:bt.status)==="Approved","text-red-600":((yt=s.value)==null?void 0:yt.status)==="Rejected"})},o(((vt=s.value)==null?void 0:vt.status)||"N/A"),3)]),((mt=s.value)==null?void 0:mt.status)==="Rejected"?(n(),i("div",Ve,[t("p",null,[e[32]||(e[32]=t("b",null,"Rejected by: ",-1)),r(" "+o((gt=(ft=s.value)==null?void 0:ft.rejected_by_user)==null?void 0:gt.name),1)]),t("p",null,[e[33]||(e[33]=t("b",null,"Rejection Reason: ",-1)),r(" "+o((_t=s.value)==null?void 0:_t.rejection_reason),1)])])):_("",!0),t("div",Ie,[b(f,{application:s.value,type:"leave_applications",item:"in_charge",onAction:v},null,8,["application"]),b(f,{application:s.value,type:"leave_applications",item:"coordinator",onAction:v},null,8,["application"]),b(f,{application:s.value,type:"leave_applications",item:"operational_admin",onAction:v},null,8,["application"])]),t("div",Me,[b(f,{application:s.value,type:"leave_applications",item:"recommend_by",onAction:v},null,8,["application"]),b(f,{application:s.value,type:"leave_applications",item:"approved_by",onAction:v},null,8,["application"])])])]),t("div",Ue,[e[34]||(e[34]=t("label",{class:"font-medium"},"Attachment",-1)),(xt=s.value)!=null&&xt.attachment&&typeof((kt=s.value)==null?void 0:kt.attachment)=="string"?(n(),i("div",$e,[t("a",{href:(ht=s.value)==null?void 0:ht.attachment,target:"_blank",class:"text-blue-500 underline"},"View Current File",8,ze)])):(n(),i("div",Pe,"No attachment")),((wt=s.value)==null?void 0:wt.user_id)===((Dt=(At=zt(St))==null?void 0:At.user)==null?void 0:Dt.id)?(n(),i("div",Ge,[t("input",{type:"file",onChange:Wt,class:"w-full p-2 border rounded"},null,32)])):_("",!0)]),b(Jt)])),t("div",{class:"mb-2 flex justify-end gap-2 print:hidden"},[t("button",{class:"btn-3",onClick:k},e[35]||(e[35]=[t("i",{class:"far fa-times"},null,-1),r(" Close ")]))])])])):_("",!0)]}),_:1})]))}},Ze=Ot(He,[["__scopeId","data-v-a1340e08"]]);export{Ze as default};
