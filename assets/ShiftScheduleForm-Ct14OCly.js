import{E as J,r as d,G as F,s as V,p as T,q as Q,b as X,c as r,a as o,d as _,z as j,F as g,x as b,h as U,v as Z,y as w,o as i,t as h,k as Y,D as P}from"./index-Bh8RbBmY.js";import{u as ee}from"./company-vR8T3nhb.js";import{u as te}from"./shift-CIIf-_H4.js";import{d as M}from"./dayjs.min-Cbbdfn5l.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe=J("shiftSchedule",()=>{const k=d([]);return{schedules:k,fetchSchedules:async c=>{const S=await F.get("/shift-schedules",c);return k.value=S.data,S.data},saveSchedules:async c=>{await F.post("/shift-schedules",{schedules:c==null?void 0:c.payload})}}}),ae={class:"p-4 max-w-[1600px] mx-auto"},le={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},ne=["value"],re=["value"],ie={class:"flex flex-wrap gap-3 mb-4"},de=["onClick"],ue={class:"text-sm"},ce={class:"overflow-auto"},ve={class:"table-auto w-full border text-sm"},pe={class:"sticky top-0 bg-white z-10"},he={class:"text-xs text-gray-400"},fe={class:"border p-2"},ge=["value"],be={class:"border p-2 whitespace-nowrap"},me={class:"border p-2"},ye=["onClick"],Se=["onClick"],xe=["title"],Ee={__name:"ShiftScheduleForm",setup(k){const C=oe(),y=ee(),c=te(),{companies:S,employees:W}=V(y),{shifts:z}=V(c),f=d(M().format("YYYY-MM")),D=d("");d(""),d("");const u=d("");d([]),d([]);const n=d({}),v=d([]),m=d({WEEKEND:"bg-red-700"}),A=["bg-green-700","bg-pink-600","bg-blue-800","bg-cyan-600","bg-red-300","bg-purple-700","bg-yellow-500","bg-indigo-500","bg-amber-600"],x=T(()=>Object.values(z.value||{}).flat());function B(){const s=x.value;let t=0;s.forEach(e=>{m.value[e.id]=A[t%A.length],t++}),m.value.WEEKEND="bg-red-700"}const E=T(()=>Array.from({length:M(f.value).daysInMonth()},(s,t)=>t+1)),K=s=>{const t=`${f.value}-${String(s).padStart(2,"0")}`;return M(t).format("ddd")},I=(s,t)=>{var a,l;const e=(l=(a=n.value)==null?void 0:a[s])==null?void 0:l[t];return e?["WEEKEND"].includes(e)?m.value[e]||"bg-gray-300":m.value[parseInt(e)]||"bg-gray-300":"bg-gray-300"},O=(s,t)=>{var l,p;const e=(p=(l=n.value)==null?void 0:l[s])==null?void 0:p[t],a=x.value.find(N=>N.id===e);return(a==null?void 0:a.name)||""},q=(s,t)=>{v.value.includes(parseInt(s))&&u.value&&(n.value[s]||(n.value[s]={}),n.value[s][t]=u.value)},$=s=>{v.value.includes(parseInt(s))&&u.value&&(n.value[s]||(n.value[s]={}),E.value.forEach(t=>{n.value[s][t]=u.value}))},G=()=>{v.value.forEach(s=>{$(s)})},L=()=>{v.value.forEach(s=>{var a;const t=W.value.find(l=>l.id===parseInt(s)),e=((a=t==null?void 0:t.weekends)==null?void 0:a.map(l=>l.slice(0,3)))||[];n.value[s]||(n.value[s]={}),E.value.forEach(l=>{const p=K(l);e.includes(p)&&(n.value[s][l]="WEEKEND")})})},R=async()=>{const s=Object.entries(n.value).flatMap(([t,e])=>v.value.includes(parseInt(t))?Object.entries(e).map(([a,l])=>({employee_id:parseInt(t),date:`${f.value}-${String(a).padStart(2,"0")}`,shift_id:l})):[]);try{await C.saveSchedules({payload:s}),alert("Shift schedule saved successfully!")}catch(t){console.error("Failed to save schedule",t),alert("Something went wrong while saving.")}};Q(D,async s=>{s&&(await y.fetchEmployee(s),await c.fetchShifts({companyId:s}),B(),await H(s,f.value))}),X(async()=>{await y.fetchCompanies()});const H=async(s,t)=>{try{const e=await C.fetchSchedules({params:{company_id:s,month:t}}),a={};e.forEach(l=>{v.value.push(l.employee_id);const p=l.employee_id,N=parseInt(l.date.split("-")[2]);a[p]||(a[p]={}),a[p][N]=l.shift_id||"WEEKEND"}),n.value=a}catch(e){console.error("Failed to load schedule data:",e)}};return(s,t)=>(i(),r("div",ae,[o("div",le,[_(o("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>D.value=e),class:"p-2 border rounded"},[t[5]||(t[5]=o("option",{value:""},"Select Company",-1)),(i(!0),r(g,null,b(U(S),e=>(i(),r("option",{key:e.id,value:e.id},h(e.name),9,ne))),128))],512),[[j,D.value]]),_(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),class:"p-2 border rounded"},[t[6]||(t[6]=o("option",{value:""},"- Shift -",-1)),(i(!0),r(g,null,b(x.value,e=>(i(),r("option",{key:e.id,value:e.id},h(e.name),9,re))),128))],512),[[j,u.value]]),_(o("input",{type:"month","onUpdate:modelValue":t[2]||(t[2]=e=>f.value=e),class:"p-2 border rounded"},null,512),[[Z,f.value]])]),o("div",ie,[(i(!0),r(g,null,b(x.value,e=>(i(),r("div",{key:e.id,class:w(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":u.value===e.id}]),onClick:a=>u.value=e.id},[o("div",{class:w(["w-5 h-5 rounded",m.value[e.id]||"bg-gray-300"])},null,2),o("span",ue,h(e.name),1)],10,de))),128)),o("div",{class:w(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":u.value==="WEEKEND"}]),onClick:t[3]||(t[3]=e=>u.value="WEEKEND")},t[7]||(t[7]=[o("div",{class:"w-5 h-5 rounded bg-red-700"},null,-1),o("span",{class:"text-sm"},"Weekend",-1)]),2)]),o("div",{class:"mb-4 flex gap-4"},[o("button",{onClick:G,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),o("button",{onClick:L,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),o("div",ce,[o("table",ve,[o("thead",pe,[o("tr",null,[t[8]||(t[8]=o("th",{class:"border p-2"},"Emp ID",-1)),t[9]||(t[9]=o("th",{class:"border p-2"},"Name",-1)),t[10]||(t[10]=o("th",{class:"border p-2"},"Action",-1)),(i(!0),r(g,null,b(E.value,e=>(i(),r("th",{key:e,class:"border text-center p-1 w-10"},[Y(h(e)+" ",1),o("div",he,h(K(e)),1)]))),128))])]),o("tbody",null,[(i(!0),r(g,null,b(U(W),e=>(i(),r("tr",{key:e.id},[o("td",fe,[_(o("input",{type:"checkbox",class:"mr-2",value:e.id,"onUpdate:modelValue":t[4]||(t[4]=a=>v.value=a)},null,8,ge),[[P,v.value]]),Y(" "+h(e.code),1)]),o("td",be,h(e.name),1),o("td",me,[o("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:a=>$(e.id)}," Apply to All Dates ",8,ye)]),(i(!0),r(g,null,b(E.value,a=>(i(),r("td",{key:a,class:"border text-center cursor-pointer",onClick:l=>q(e.id,a)},[o("div",{title:O(e.id,a),class:w([I(e.id,a),"w-full h-6"])},null,10,xe)],8,Se))),128))]))),128))])])]),o("div",{class:"mb-4 mt-4"},[o("button",{onClick:R,class:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow"}," ðŸ’¾ Save Schedule ")])]))}},Ne=se(Ee,[["__scopeId","data-v-4a6956d0"]]);export{Ne as default};
