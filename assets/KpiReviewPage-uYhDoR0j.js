import{x as m,c as n,o as a,a as s,k as g,t as o,F as C,e as M,f as ws,g as $s,r as _,q as ee,d as Fs,s as Qe,l as xe,H as Ss,v as Ce,j as Ve,n as pe,b as V,P as ze,i as Ns,m as Ls,z as Cs,T as As,C as Ht}from"./index-CeLzYoOE.js";import{u as Ms}from"./kpi-CPE0cvmi.js";const Is={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Es={class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2.5"},Rs={class:"text-sm font-semibold text-slate-800"},Gs={key:0,class:"text-xs text-slate-500"},Ps={key:1,class:"flex items-center gap-2"},js={class:"inline-flex items-center rounded-xl border bg-white p-1 shadow-sm"},Hs=["disabled"],Ts=["disabled"],Ds=["disabled"],Bs={class:"overflow-auto"},Ks={key:0,class:"min-w-[980px] w-full text-sm"},Qs={class:"bg-slate-50 sticky top-0 z-10"},zs={class:"text-slate-700"},Vs={class:"text-left px-3 py-2 w-[20%] font-medium"},Os={class:"font-medium"},qs={class:"text-[11px] text-slate-500 flex flex-col items-center"},Us={key:0,class:"mt-0.5 inline-flex items-center gap-1 rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-semibold text-blue-700 border border-blue-200"},Ys={class:"bg-slate-100/80 border-t"},Ws=["colspan"],Js={class:"px-3 py-2 text-center text-slate-500"},Xs={class:"px-3 py-2 align-top"},Zs={class:"font-medium text-slate-800"},el={class:"mt-1"},tl={class:"inline-flex items-center rounded-lg border bg-white p-0.5 shadow-sm opacity-0 group-hover:opacity-100 transition"},sl=["disabled","onClick"],ll=["disabled","onClick"],al=["disabled","onClick"],nl=["disabled","onClick"],ol=["disabled","onClick"],rl={class:"px-3 py-2 text-center text-slate-700"},il={key:0,class:"flex items-center justify-center"},ul=["max","value","onInput","onBlur"],dl={key:1,class:"text-slate-700 text-sm"},cl={key:2,class:"text-slate-300 text-sm"},vl={class:"bg-slate-50 border-t"},ml={class:"px-3 py-2 text-center font-semibold text-slate-800"},xl=["colspan"],pl={class:"font-semibold text-slate-900"},fl={class:"text-slate-500"},bl={key:1,class:"w-full text-sm"},gl={class:"sticky top-0 bg-white z-10"},yl={class:"bg-slate-100 text-slate-700"},hl={class:"text-left px-3 py-2 w-[30%] font-medium"},_l={class:"px-3 py-2 text-center text-slate-500"},kl={class:"px-3 py-2"},wl={class:"font-medium text-slate-800"},$l={class:"px-3 py-2 text-center text-slate-700"},Fl={class:"px-3 py-2 text-center"},Sl=["max","value","onInput","onBlur"],Nl={key:1,class:"text-slate-700 text-sm"},Ll={class:"bg-slate-50 border-t"},Cl={class:"px-3 py-2 text-center font-semibold text-slate-800"},Al={class:"px-3 py-2 text-center text-sm"},Tt={__name:"KpiGroupTable",props:{group:{type:Object,required:!0},isPersonal:{type:Boolean,default:!1},lanes:{type:Array,default:()=>[]},editableLaneKey:{type:String,default:null},canEdit:{type:Boolean,default:!1},marks:{type:Object,default:()=>({})},headerLabel:{type:String,default:""},itemLabel:{type:String,default:"Item"},helperText:{type:String,default:""},showQuickFillGroup:{type:Boolean,default:!1},autoFillLabel:{type:String,default:""},autoFillVisible:{type:Boolean,default:!1},onAutoFill:{type:Function,default:null},serialMap:{type:Object,default:()=>({})},getLaneMark:{type:Function,default:()=>""},getHrMark:{type:Function,default:()=>""},onMarkChange:{type:Function,default:null},onCap:{type:Function,default:null},onQuickFillItem:{type:Function,default:null},onQuickFillGroup:{type:Function,default:null}},setup(d){const E=d,B=m(()=>{var b;return((b=E.group)==null?void 0:b.items)??[]}),w=m(()=>B.value.reduce((b,p)=>b+Number((p==null?void 0:p.max)||0),0)),q=m(()=>B.value.reduce((b,p)=>{var $;const v=($=E.marks)==null?void 0:$[p.id],h=v===""||v==null?0:Number(v);return b+Math.min(Math.max(h||0,0),Number((p==null?void 0:p.max)||0))},0)),R=(b,p)=>{var v;return((v=E.serialMap)==null?void 0:v[b.id])??p+1},fe=b=>(b==null?void 0:b.key)===E.editableLaneKey&&(b==null?void 0:b.can_current_user_review),U=(b,p)=>{var h;const v=p===""?"":Number(p);p!==""&&Number.isNaN(v)||(h=E.onMarkChange)==null||h.call(E,b,v)},k=(b,p)=>{var v;return(v=E.onCap)==null?void 0:v.call(E,b,p)};return(b,p)=>(a(),n("section",Is,[s("div",Es,[s("div",Rs,o(d.headerLabel),1),d.helperText?(a(),n("div",Gs,o(d.helperText),1)):d.showQuickFillGroup?(a(),n("div",Ps,[p[4]||(p[4]=s("span",{class:"text-xs font-medium text-slate-500"},"Quick fill",-1)),s("div",js,[s("button",{type:"button",class:"px-3 py-1.5 text-xs font-semibold rounded-lg text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40",onClick:p[0]||(p[0]=v=>{var h;return(h=d.onQuickFillGroup)==null?void 0:h.call(d,d.group,"half")}),disabled:!d.canEdit,title:"Fill all items with 50%"}," All 1/2 ",8,Hs),s("button",{type:"button",class:"px-3 py-1.5 text-xs font-semibold rounded-lg text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40",onClick:p[1]||(p[1]=v=>{var h;return(h=d.onQuickFillGroup)==null?void 0:h.call(d,d.group,"threeQuarter")}),disabled:!d.canEdit,title:"Fill all items with 75%"}," All 3/4 ",8,Ts),s("button",{type:"button",class:"px-3 py-1.5 text-xs font-semibold rounded-lg bg-slate-900 text-white hover:bg-slate-800 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-300 disabled:opacity-40",onClick:p[2]||(p[2]=v=>{var h;return(h=d.onQuickFillGroup)==null?void 0:h.call(d,d.group,"full")}),disabled:!d.canEdit,title:"Fill all items with 100%"}," All Full ",8,Ds)]),d.autoFillVisible?(a(),n("button",{key:0,type:"button",class:"rounded-full border border-slate-300 bg-white px-2.5 py-1 text-[10px] font-semibold text-slate-600 hover:border-slate-400 hover:text-slate-800",onClick:p[3]||(p[3]=v=>{var h;return(h=d.onAutoFill)==null?void 0:h.call(d)})},o(d.autoFillLabel),1)):g("",!0)])):g("",!0)]),s("div",Bs,[d.isPersonal?(a(),n("table",Ks,[s("thead",Qs,[s("tr",zs,[p[5]||(p[5]=s("th",{class:"px-3 py-2 w-[40px] text-center font-medium"},"#",-1)),s("th",Vs,o(d.itemLabel),1),p[6]||(p[6]=s("th",{class:"px-3 py-2 text-center font-medium"},"Max",-1)),(a(!0),n(C,null,M(d.lanes,v=>(a(),n("th",{key:v.key,class:"px-3 py-2 text-center font-medium"},[s("div",Os,o(v.label||v.key),1),s("div",qs,[s("span",null,o(v.assigned_user_name||"-"),1),fe(v)?(a(),n("span",Us," ✎ You can edit ")):g("",!0)])]))),128))])]),s("tbody",null,[s("tr",Ys,[s("td",{colspan:3+d.lanes.length,class:"px-3 py-2 font-medium text-slate-800"},o(d.group.label||"Personal"),9,Ws)]),(a(!0),n(C,null,M(B.value,(v,h)=>(a(),n("tr",{key:v.id,class:"border-t hover:bg-slate-50/60 group"},[s("td",Js,o(R(v,h)),1),s("td",Xs,[s("div",Zs,o(v.label),1),s("div",el,[s("div",tl,[s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!d.canEdit,onClick:$=>{var F;return d.canEdit&&((F=d.onQuickFillItem)==null?void 0:F.call(d,v.id,v.max,"zero"))},title:"Set 0"}," 0 ",8,sl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!d.canEdit,onClick:$=>{var F;return d.canEdit&&((F=d.onQuickFillItem)==null?void 0:F.call(d,v.id,v.max,"quarter"))},title:"Set 25%"}," ¼ ",8,ll),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!d.canEdit,onClick:$=>{var F;return d.canEdit&&((F=d.onQuickFillItem)==null?void 0:F.call(d,v.id,v.max,"half"))},title:"Set 50%"}," ½ ",8,al),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-indigo-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!d.canEdit,onClick:$=>{var F;return d.canEdit&&((F=d.onQuickFillItem)==null?void 0:F.call(d,v.id,v.max,"threeQuarter"))},title:"Set 75%"}," ¾ ",8,nl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md bg-emerald-600 text-white hover:bg-emerald-700 active:scale-[0.98] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-200 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!d.canEdit,onClick:$=>{var F;return d.canEdit&&((F=d.onQuickFillItem)==null?void 0:F.call(d,v.id,v.max,"full"))},title:"Set 100%"}," Full ",8,ol)])])]),s("td",rl,o(v.max),1),(a(!0),n(C,null,M(d.lanes,$=>(a(),n("td",{key:$.key,class:"px-3 py-2 text-center"},[fe($)?(a(),n("div",il,[s("input",{type:"number",step:"0.1",min:"0",max:v.max,value:d.marks[v.id]??"",onInput:F=>U(v.id,F.target.value),onBlur:F=>k(v.id,v.max),inputmode:"decimal",class:"w-24 text-right rounded-lg border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200"},null,40,ul)])):$.can_view_marks?(a(),n("div",dl,o(d.getLaneMark($.key,v.id)),1)):(a(),n("div",cl,"—"))]))),128))]))),128)),s("tr",vl,[p[7]||(p[7]=s("td",null,null,-1)),p[8]||(p[8]=s("td",{class:"px-3 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),s("td",ml,o(w.value.toFixed(2)),1),s("td",{colspan:d.lanes.length,class:"px-3 py-2 text-center text-sm"},[s("span",pl,o(q.value.toFixed(2)),1),s("span",fl,"/ "+o(w.value.toFixed(2)),1)],8,xl)])])])):(a(),n("table",bl,[s("thead",gl,[s("tr",yl,[p[9]||(p[9]=s("th",{class:"px-3 py-2 w-[40px] text-center font-medium"},"#",-1)),s("th",hl,o(d.itemLabel),1),p[10]||(p[10]=s("th",{class:"px-3 py-2 text-center w-[40px] font-medium"},"Max",-1)),p[11]||(p[11]=s("th",{class:"px-3 py-2 text-center w-[80px] font-medium"},"HR Score",-1))])]),s("tbody",null,[(a(!0),n(C,null,M(B.value,(v,h)=>(a(),n("tr",{key:v.id,class:"border-t hover:bg-slate-50/60 group"},[s("td",_l,o(h+1),1),s("td",kl,[s("div",wl,o(v.label),1)]),s("td",$l,o(v.max),1),s("td",Fl,[d.canEdit?(a(),n("input",{key:0,type:"number",step:"0.1",min:"0",max:v.max,value:d.marks[v.id]??"",onInput:$=>U(v.id,$.target.value),onBlur:$=>k(v.id,v.max),inputmode:"decimal",class:"w-24 text-right rounded-lg border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200"},null,40,Sl)):(a(),n("p",Nl,o(d.getHrMark(v.id)||"—"),1))])]))),128)),s("tr",Ll,[p[12]||(p[12]=s("td",null,null,-1)),p[13]||(p[13]=s("td",{class:"px-3 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),s("td",Cl,o(w.value.toFixed(2)),1),s("td",Al,o(q.value.toFixed(2)),1)])])]))])]))}},Ml={key:0,class:"space-y-4"},Il={class:"flex items-start justify-between gap-3"},El={class:"text-sm font-semibold text-slate-900"},Rl={class:"text-xs text-slate-500"},Gl={key:0,class:"text-xs text-slate-400"},Pl={class:"flex flex-wrap items-center gap-2"},jl=["onClick"],Hl={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Tl={key:1,class:"rounded-xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-700"},Dl={key:2,class:"space-y-3"},Bl={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Kl={key:1,class:"space-y-3"},Ql={class:"flex items-start justify-between gap-3"},zl={class:"min-w-0"},Vl=["title"],Ol={class:"mt-0.5 text-[11px] text-slate-500"},ql={key:0},Ul={key:1},Yl={class:"shrink-0"},Wl=["onUpdate:modelValue"],Jl=["value"],Xl={class:"mt-2"},Zl=["onUpdate:modelValue"],ea={class:"flex items-center justify-end gap-2 pt-2"},ta=["disabled"],sa=["disabled"],la={key:1,class:"max-w-7xl mx-auto px-4 py-6 space-y-6"},aa={class:"border rounded-2xl bg-white/80 backdrop-blur px-4 py-3 shadow-sm"},na={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},oa={class:"space-y-1"},ra={class:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1"},ia={class:"text-xs text-indigo-900"},ua={class:"text-sm text-slate-600"},da={class:"font-medium text-slate-800"},ca={class:"flex flex-wrap gap-2 text-xs mt-0.5"},va={key:0,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},ma={class:"ml-1 font-medium text-slate-800"},xa={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},pa={class:"ml-1 font-medium text-slate-800"},fa={class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},ba={key:0,class:"ml-1 inline-flex items-center gap-1"},ga={class:"font-semibold text-slate-800"},ya={class:"font-semibold text-emerald-700"},ha={key:1,class:"ml-1 inline-flex items-center gap-1"},_a={key:2,class:"ml-1 font-semibold text-slate-800"},ka={class:"flex items-end gap-4"},wa={class:"text-right"},$a={class:"text-lg font-bold text-slate-900"},Fa={class:"text-slate-400"},Sa={class:"text-xs text-slate-500"},Na={key:0},La={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Ca={key:0,class:"p-4 text-sm font-bold text-slate-500"},Aa=["innerHTML"],Ma={key:2,class:"mt-2 flex flex-wrap items-center justify-between gap-3 rounded-2xl border bg-white px-4 py-3 shadow-sm"},Ia={class:"text-sm text-slate-600"},Ea={class:"text-slate-900"},Ra={class:"text-slate-400"},Ga=["disabled"],Pa={class:"mt-2"},ja={class:"grid gap-4 lg:grid-cols-5"},Ha={key:0,class:"space-y-4 lg:col-span-3"},Ta={key:0,class:"sticky top-6 border rounded-2xl bg-white shadow-sm"},Da={class:"flex flex-wrap items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},Ba={class:"flex flex-wrap items-center gap-2 text-[11px] text-slate-500"},Ka={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Qa={key:0,class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},za={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Va={class:"p-4 space-y-4 max-h-[360px] overflow-y-auto"},Oa={class:"flex flex-wrap gap-2 border-b border-slate-100 pb-3"},qa=["onClick"],Ua={class:"space-y-4"},Ya={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},Wa={class:"rounded-xl border bg-slate-50 p-3"},Ja={class:"flex items-center justify-between"},Xa={class:"text-[11px] px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200"},Za={class:"mt-1 text-sm font-semibold text-slate-900"},en={class:"text-xs text-slate-500"},tn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},sn={class:"rounded-xl border bg-slate-50 p-3"},ln={class:"flex items-center justify-between"},an={class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-200"},nn={class:"mt-1 text-sm font-semibold text-slate-900"},on={class:"text-xs text-slate-500"},rn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},un={class:"rounded-xl border bg-slate-50 p-3 sm:col-span-2"},dn={class:"flex items-center justify-between"},cn={class:"text-[11px] px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 border border-emerald-200"},vn={class:"mt-1 text-sm font-semibold text-slate-900"},mn={class:"text-xs text-slate-500"},xn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},pn={class:"border-t pt-2 text-xs"},fn={key:0,class:"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs space-y-2"},bn={class:"grid grid-cols-2 gap-2"},gn={class:"font-medium text-slate-800"},yn={class:"font-medium text-slate-800"},hn={class:"font-medium text-slate-800"},_n={class:"font-medium text-slate-800"},kn={class:"font-medium text-slate-800"},wn={class:"font-medium text-slate-800"},$n={class:"font-medium text-slate-800"},Fn={class:"font-medium text-slate-800"},Sn={class:"font-medium text-slate-800"},Nn={key:1,class:"border rounded-2xl bg-white shadow-sm"},Ln={class:"flex items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},Cn={class:"text-[11px] text-slate-500"},An={class:"p-4 space-y-3"},Mn={class:"max-h-96 overflow-auto border rounded-xl"},In={class:"min-w-full text-xs text-left"},En={class:"px-2 py-2"},Rn={class:"font-semibold text-slate-700"},Gn={key:0,class:"mt-0.5 text-[11px] text-slate-400"},Pn={class:"px-2 py-2 text-right"},jn=["onClick"],Hn={key:3,class:"rounded-2xl bg-white border shadow-sm px-4 py-4 space-y-4"},Tn={class:"grid gap-4 md:grid-cols-3"},Dn={class:"space-y-3"},Bn={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},Kn={key:0,class:"text-[11px] text-emerald-600"},Qn={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},zn={class:"flex flex-wrap gap-1.5"},Vn=["onClick","disabled"],On={key:1,class:"text-[11px] text-slate-400"},qn={class:"space-y-1"},Un={class:"space-y-3"},Yn={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},Wn={key:0,class:"text-[11px] text-amber-600"},Jn={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},Xn={class:"flex flex-wrap gap-1.5"},Zn=["onClick","disabled"],eo={key:1,class:"text-[11px] text-slate-400"},to={class:"space-y-1"},so={class:"space-y-3"},lo={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},ao={key:0,class:"text-[11px] text-sky-600"},no={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},oo={class:"flex flex-wrap gap-1.5"},ro=["onClick","disabled"],io={class:"space-y-1"},uo={class:"mt-2 flex flex-col gap-3 border-t pt-3 md:flex-row md:items-center md:justify-between"},co={class:"flex flex-wrap items-center gap-2"},vo=["disabled"],mo={class:"relative w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true"},xo={class:"flex items-start justify-between gap-3"},po={class:"text-lg font-semibold text-slate-900"},fo={class:"text-xs text-slate-500"},bo={key:0,class:"text-xs text-slate-400 mt-1"},go={class:"mt-5 space-y-4 text-sm text-slate-700"},yo={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},ho={key:0},_o={key:1,class:"text-slate-400"},ko={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},wo={key:0},$o={key:1,class:"text-slate-400"},Fo={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},So={key:0},No={key:1,class:"text-slate-400"},Lo={__name:"KpiReviewForm",props:{mode:{type:String,default:"full"},allowedLanes:{type:Array,default:()=>["supv_director","da"]},groupFilter:{type:String,default:null},initialLane:{type:String,default:""},employeeId:{type:[Number,String],default:null},employeeName:{type:String,default:""},year:{type:Number,default:null}},emits:["saved"],setup(d,{emit:E}){const B=ws(),w=Ms(),q=$s(),R=d,fe=E,U=m(()=>R.mode==="compact"),k=_({}),b=_({}),p=_(""),v=_(""),h=_(""),$=_(null),F=_(null),te=_(!1),se=m(()=>{const t=Number(R.employeeId);return Number.isFinite(t)&&t>0?t:null}),Y=m(()=>{const t=Number(R.year);return Number.isFinite(t)&&t>0?t:new Date().getFullYear()}),le=m(()=>R.groupFilter?String(R.groupFilter):"personal"),Ae=m(()=>{const t=Array.isArray(R.allowedLanes)?R.allowedLanes.filter(Boolean):[];return t.length?t:["supv_director","da"]}),G=_(R.initialLane||Ae.value[0]||""),O=_([]),ae=_({}),ne=_({}),oe=_(!1),W=_(!1),J=_(""),Dt=m(()=>{var t;return R.employeeName||((t=b.value)==null?void 0:t.name)||"Employee"}),Bt={supv_director:"Supv. Director",da:"DA"},Oe=t=>Bt[t]||t,Kt=m(()=>le.value?le.value.replace(/_/g," "):"personal");function Qt(t){return Array.isArray(t)?t.map((e,l)=>{const r=(e==null?void 0:e.id)??(e==null?void 0:e.item_id)??(e==null?void 0:e.kpi_item_id)??(e==null?void 0:e.kpi_id)??l,u=(e==null?void 0:e.title)??(e==null?void 0:e.name)??(e==null?void 0:e.label)??`Item ${l+1}`,i=(e==null?void 0:e.weight)??(e==null?void 0:e.weightage)??(e==null?void 0:e.weight_value)??(e==null?void 0:e.score_weight)??null,x=(e==null?void 0:e.max_score)??(e==null?void 0:e.max)??(e==null?void 0:e.max_marks)??(e==null?void 0:e.score_max)??0,f=(e==null?void 0:e.score)??(e==null?void 0:e.mark)??(e==null?void 0:e.obtained)??(e==null?void 0:e.value)??null,S=(e==null?void 0:e.comment)??(e==null?void 0:e.note)??(e==null?void 0:e.remark)??"";return{id:r,title:u,weight:i,maxScore:x,score:f,comment:S}}):[]}function zt(t){const e=Number(t);if(!Number.isFinite(e)||e<=0)return[0];const l=Number.isInteger(e)?1:.5,r=[];for(let u=0;u<=e+1e-4;u+=l){const i=l===1?Math.round(u):Number(u.toFixed(1));r.push(i)}return r[r.length-1]!==e&&r.push(e),r}async function Vt(){var t,e,l,r;if(U.value&&!(!se.value||!Y.value||!G.value)){oe.value=!0,J.value="";try{const{data:u}=await Ht.get(`/kpi/yearly/${Y.value}/employees/${se.value}/marking-form`,{params:{lane:G.value,group:le.value}}),i=(u==null?void 0:u.data)??u??{},x=(i==null?void 0:i.items)||((t=i==null?void 0:i.form)==null?void 0:t.items)||((e=i==null?void 0:i.group)==null?void 0:e.items)||(i==null?void 0:i.data)||[],f=Qt(x),S={},N={};f.forEach(A=>{var de,ce;const Se=(de=i==null?void 0:i.marks)==null?void 0:de[A.id],Ne=(ce=i==null?void 0:i.comments)==null?void 0:ce[A.id],Z=A.score??Se??0,Le=A.comment??Ne??"";S[A.id]=Z===""||Z==null?0:Number(Z),N[A.id]=Le??""}),O.value=f,ae.value=S,ne.value=N}catch(u){J.value=((r=(l=u==null?void 0:u.response)==null?void 0:l.data)==null?void 0:r.message)||"Failed to load KPI marking form.",O.value=[]}finally{oe.value=!1}}}async function qe(t){var e,l;if(!(!se.value||!Y.value||!G.value)){W.value=!0,J.value="";try{const r=O.value.map(i=>({item_id:i.id,score:Number(ae.value[i.id]??0),comment:ne.value[i.id]??""})),u={lane:G.value,group:le.value,submit:!!t,items:r,marks:{...ae.value},comments:{...ne.value}};await Ht.post(`/kpi/yearly/${Y.value}/employees/${se.value}/marking-form`,u),fe("saved")}catch(r){J.value=((l=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to save KPI marking form."}finally{W.value=!1}}}ee(()=>R.initialLane,t=>{t&&(G.value=t)}),ee(Ae,t=>{t.length&&(t.includes(G.value)||(G.value=t[0]))},{immediate:!0}),ee([U,G,se,Y,le],([t,e,l,r,u])=>{!t||!e||!l||!r||!u||Vt()},{immediate:!0});const Ue=_([]),Ye=_({}),Me=_(!1),be=m(()=>{var t;return((t=w.cycle)==null?void 0:t.groups_json)||[]}),Ot=m(()=>{var r;const t=w.cycle||{},e=Array.isArray(t==null?void 0:t.groups_json)?t.groups_json:[];return(t==null?void 0:t.slug)==="support_staff"&&e.length===1&&((r=e[0])==null?void 0:r.id)==="personal"?"staff":"executive"}),z=m(()=>Ot.value==="staff"),We=t=>{if(!t)return!1;const e=String(t.id||"").toLowerCase(),l=String(t.label||"").toLowerCase();return e==="personal"||e==="personal_evaluation"||e==="personal_eval"?!0:l.includes("personal")},K=m(()=>be.value.find(We)||null),P=m(()=>z.value?[]:be.value.filter(t=>!We(t))),qt=(t,e)=>(t==null?void 0:t.label)||`Group ${e+1}`,Ut=t=>/^hr\d*$/i.test(t)||t==="hr",Je=t=>Ut((t==null?void 0:t.key)||"")||(t==null?void 0:t.is_hr_lane)===!0,ge=m(()=>[...Ue.value||[]].sort((t,e)=>(t.rank??999)-(e.rank??999))),Ie=m(()=>ge.value.filter(Je)),Xe=m(()=>ge.value.filter(t=>!Je(t))),Ee=m(()=>z.value?ge.value:Xe.value),Q=m(()=>{var t;return((t=Ee.value.find(e=>e.can_current_user_review))==null?void 0:t.key)||null}),Yt=m(()=>Ee.value.find(t=>t.key===Q.value)||null),Wt=m(()=>{var t;return((t=Yt.value)==null?void 0:t.rank)??null}),Jt=m(()=>{var t;return Number(((t=q==null?void 0:q.user)==null?void 0:t.id)||0)}),Re=m(()=>{const t=Jt.value;if(!t)return null;const e=Ie.value.find(l=>Number(l.assigned_user_id)===t);return e||Ie.value.find(l=>l.can_current_user_review)||null}),T=m(()=>{var t;return((t=Re.value)==null?void 0:t.key)||null}),Xt=m(()=>!!(Re.value&&Re.value.can_current_user_review)),D=m(()=>!!(Me.value||Xt.value)),ye=m(()=>!!Q.value),Zt=m(()=>{if(z.value||!D.value)return!1;const t=Q.value,e=T.value;return!t||!e||t===e?!1:P.value.length>0}),Ge=m(()=>z.value?Q.value:D.value&&T.value?T.value:Q.value),Ze=m(()=>!!(Ge.value&&T.value&&Ge.value===T.value));function re(t){var r;const e=(r=Ye.value)==null?void 0:r[t];return e?(Array.isArray(e)?e:[e]).reduce((u,i)=>{if(!i)return u;if(!u)return i;const x=new Date(i.submitted_at||0).getTime(),f=new Date(u.submitted_at||0).getTime();return x>f?i:u},null):null}function et(t,e){var r;const l=re(t);return((r=l==null?void 0:l.marks)==null?void 0:r[e])??""}function tt(t){var l,r,u;if(T.value){const i=re(T.value),x=(l=i==null?void 0:i.marks)==null?void 0:l[t];if(x!=null)return x}let e=null;for(const i of Ie.value){const x=re(i.key);if(!x||((r=x==null?void 0:x.marks)==null?void 0:r[t])==null)continue;if(!e){e=x;continue}const f=new Date(x.submitted_at||0).getTime(),S=new Date(e.submitted_at||0).getTime();f>S&&(e=x)}return((u=e==null?void 0:e.marks)==null?void 0:u[t])??""}function st(t,e){k.value[t]=e===""?"":Number(e)}function ie(t,e){const l=Number(k.value[t]??0);l<0&&(k.value[t]=0),l>Number(e)&&(k.value[t]=Number(e))}function lt(t,e,l){l==="zero"?k.value[t]=0:l==="quarter"?k.value[t]=Number(e)/4:l==="half"?k.value[t]=Number(e)/2:l==="threeQuarter"?k.value[t]=Number((Number(e)*.75).toFixed(1)):l==="full"&&(k.value[t]=Number(e)),ie(t,e)}function es(t,e){t.items.forEach(l=>lt(l.id,l.max,e))}const ue=m(()=>{let t=0,e=0;const l=K.value;l&&Array.isArray(l.items)&&l.items.forEach(u=>{t+=Number(u.max||0);const i=Number(k.value[u.id]||0);e+=Math.min(Math.max(i,0),Number(u.max||0))});const r=t>0?e/t*100:0;return{max:Number(t.toFixed(2)),got:Number(e.toFixed(2)),percent:Number(r.toFixed(2))}}),ts=m(()=>!!$.value&&typeof $.value=="object"),ss=m(()=>{var t;return((t=$.value)==null?void 0:t.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),ls=m(()=>{var t;return((t=$.value)==null?void 0:t.year)??null}),as=m(()=>{var t;return((t=F.value)==null?void 0:t.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),ns=m(()=>{var t;return((t=F.value)==null?void 0:t.year)??null}),j=_("target"),Pe=[{key:"target",label:"Annual Target"},{key:"performance",label:"Annual Performance"}],at=m(()=>{var t;return((t=$.value)==null?void 0:t.months_total_form)??0}),os=m(()=>{var t;return((t=F.value)==null?void 0:t.months_total_form)??at.value}),y=m(()=>j.value==="target"?ss.value:as.value),nt=m(()=>{var t,e;return Number(((e=(t=y.value)==null?void 0:t.per_form_yearly)==null?void 0:e.final)||0)}),ot=m(()=>{var t,e;return Number(((e=(t=y.value)==null?void 0:t.per_scored_month)==null?void 0:e.max)||0)}),rs=m(()=>ot.value?Math.round(nt.value/ot.value*100):0),rt=m(()=>D.value&&!z.value),je=m(()=>j.value==="target"?ls.value:ns.value),it=m(()=>j.value==="target"?at.value:os.value),He=m(()=>{var t;return((t=Pe.find(e=>e.key===j.value))==null?void 0:t.label)||"Annual Target"}),is={target:"target",performance:"regular_activities_of_the_department"},us=m(()=>{const t=is[j.value];return t&&P.value.find(e=>e.id===t)||null}),ds=m(()=>{var t;return((t=us.value)==null?void 0:t.label)||He.value}),cs=t=>{Pe.some(e=>e.key===t)&&(j.value=t)};ee(j,()=>{te.value=!1});const ut=t=>String(t||"").toLowerCase(),dt=(t,e)=>t?e==="target"?t.id==="monthly_target"?!0:ut(t.label).includes("monthly target"):e==="performance"?t.id==="execution"?!0:ut(t.label).includes("execution")||String(t.label||"").includes("কার্যসম্পাদন"):!1:!1,vs=t=>P.value.find(e=>dt(e,t))||null,ct=(t,{overwrite:e}={overwrite:!1})=>{if(!rt.value)return;const l=vs(t);if(!l||!Array.isArray(l.items)||l.items.length===0)return;const r=l.items,u=r.every(f=>Number(k.value[f.id]||0)===0);if(!e&&!u)return;const i=nt.value,x=r.reduce((f,S)=>f+Number(S.max||0),0);if(x){if(r.length===1){const f=r[0];k.value[f.id]=Math.min(i,Number(f.max||0)),ie(f.id,f.max);return}r.forEach(f=>{const S=Number(f.max||0)/x*i,N=Number(S.toFixed(1));k.value[f.id]=N,ie(f.id,f.max)})}},ms=m(()=>`Auto: ${j.value==="target"?"Annual Target":"Annual Performance"} (${rs.value}%)`);ee(j,t=>{ct(t,{overwrite:!1})},{immediate:!0});const he=m(()=>{const t=z.value?ge.value:Xe.value,e=[],l=Ze.value||D.value?1/0:Wt.value??null,r=u=>{if(!u)return[];const i=[];if(Array.isArray(u))i.push(...u);else if(typeof u=="string"&&u.trim())i.push(u.trim());else return[];const x=new Set;return i.reduce((f,S)=>{const N=typeof S=="string"?S.trim():"";return!N||x.has(N)||(x.add(N),f.push(N)),f},[])};return t.forEach(u=>{const i=u.key;if(!i||l!=null&&(u.rank??999)>l)return;const x=re(i);if(!x)return;const f=r(x.strengths),S=r(x.gaps),N=r(x.suggestions);!f.length&&!S.length&&!N.length||e.push({key:i,lane:i,label:u.label||(x==null?void 0:x.lane_label)||i,reviewer_id:x.reviewer_id,reviewer_name:x.reviewer_name,strengths:f,gaps:S,suggestions:N,submitted_at:x.submitted_at??null})}),e}),xs=t=>{const e=new Set;return he.value.forEach(l=>{(Array.isArray(l[t])?l[t]:[]).forEach(u=>{const i=typeof u=="string"?u.trim():"";i&&e.add(i)})}),Array.from(e)},vt=t=>{if(!Array.isArray(t))return[];const e=new Set;return t.forEach(l=>{const r=typeof l=="string"?l.trim():"";r&&e.add(r)}),Array.from(e)},_e=m(()=>vt(w.strengths)),ke=m(()=>vt(w.gaps)),we=m(()=>xs("suggestions"));_([]),_([]),_([]);const Te=_(!1),I=_(null);function ps(t){I.value=t,Te.value=!0}function De(){Te.value=!1,I.value=null}const mt={strengths:p,gaps:v,suggestions:h};function fs(t,e){const l=(e||"").trim();return l?t!=null&&t.trim()?`${t.trim()}
${l}`:l:t}const bs=m(()=>{const t={};let e=1;const l=K.value;return l&&Array.isArray(l.items)&&l.items.forEach(r=>{t[r.id]=e++}),t});function $e(t){return(Array.isArray(t==null?void 0:t.items)?t.items:[]).map(l=>l.id).filter(l=>l!=null)}function xt(t){const e={};return(Array.isArray(t)?t:[]).forEach(l=>{var r;e[l]=Number(((r=k.value)==null?void 0:r[l])??0)}),e}function pt(t){return xt($e(t))}function ft(t){const e=[];(Array.isArray(t)?t:[]).forEach(r=>{e.push(...$e(r))});const l=Array.from(new Set(e));return xt(l)}const gs=m(()=>!Q.value||!K.value?!1:Object.keys(pt(K.value)).length>0),ys=m(()=>!D.value||!T.value||!Array.isArray(P.value)||P.value.length===0?!1:Object.keys(ft(P.value)).length>0);function bt(t,e){if(!t||!(e!=null&&e.length))return!1;const l=re(t),r=l==null?void 0:l.marks;if(!r)return!1;let u=!1;return e.forEach(i=>{const x=r==null?void 0:r[i];x!==""&&x!=null&&(k.value[i]=Number(x),u=!0)}),u}const Be=m(()=>Number(B.params.employeeId)),gt=t=>{var x;b.value=t.employee,$.value=(t==null?void 0:t.annual_target_avg_marks)||null,F.value=(t==null?void 0:t.annual_performance_avg_marks)||null,Ue.value=t.lanes||[],Ye.value=t.reviews_by_lane||{},Me.value=!!(((x=t==null?void 0:t.meta)==null?void 0:x.is_hr)??(t==null?void 0:t.hr)??!1),k.value={},(Array.isArray(be.value)?be.value:[]).forEach(f=>{(Array.isArray(f==null?void 0:f.items)?f.items:[]).forEach(N=>{k.value[N.id]=0})});const l=$e(K.value),r=Q.value,u=T.value;!bt(r,l)&&u&&bt(u,l),D.value&&P.value.length&&P.value.forEach(f=>{$e(f).forEach(N=>{let A=u?et(u,N):"";(A===""||A==null)&&(A=tt(N)),A!==""&&A!=null&&(k.value[N]=Number(A))})})},hs=async t=>{if(!t)return;await w.fetchActiveCycle(t);const e=await w.fetchLanes(w.cycle.id,t);gt(e)},yt=async()=>{var e;if(!Be.value||!((e=w.cycle)!=null&&e.id))return;const t=await w.fetchLanes(w.cycle.id,Be.value);gt(t)};ee(Be,async(t,e)=>{!t||e&&t===e||await hs(t)},{immediate:!0});async function _s(){var r,u,i;const t=Number(B.params.employeeId),e=(r=w.cycle)==null?void 0:r.id,l=Q.value;if(!e||!t){alert("Invalid cycle/employee.");return}if(!l||!K.value){alert("Unable to determine personal reviewer lane.");return}try{await w.submitReview({cycle_id:e,employee_id:t,reviewer_lane:l,marks:pt(K.value),strengths:"",gaps:"",suggestions:""}),await yt(),alert("Personal review submitted")}catch(x){const f=((i=(u=x==null?void 0:x.response)==null?void 0:u.data)==null?void 0:i.message)||(x==null?void 0:x.message)||"Failed to submit personal review.";alert(f)}}async function ks(){var r,u,i;const t=Number(B.params.employeeId),e=(r=w.cycle)==null?void 0:r.id,l=T.value;if(!e||!t){alert("Invalid cycle/employee.");return}if(!l){alert("Unable to determine HR reviewer lane.");return}try{await w.submitReview({cycle_id:e,employee_id:t,reviewer_lane:l,marks:ft(P.value),strengths:p.value,gaps:v.value,suggestions:h.value}),await yt(),alert("HR review submitted")}catch(x){const f=((i=(u=x==null?void 0:x.response)==null?void 0:u.data)==null?void 0:i.message)||(x==null?void 0:x.message)||"Failed to submit HR review.";alert(f)}}function H(t){const e=Number(t??0);return isNaN(e)?"0.00":e.toFixed(2)}function X(t,e){const l=Number(t??0),r=Number(e??0);return r>0?Math.round(l/r*100):0}function Fe(t,e){const l=mt[t];if(!l)return!1;const r=(l.value||"").split(`
`).map(i=>i.trim()).filter(Boolean),u=(e||"").trim();return u?r.includes(u):!1}function Ke(t,e){const l=mt[t];if(!l)return;const r=typeof e=="string"?e.trim():"";r&&(Fe(t,r)||(l.value=fs(l.value,r)))}return(t,e)=>{var l,r,u,i,x,f,S,N,A,Se,Ne,Z,Le,de,ce,ht,_t,kt,wt,$t,Ft,St,Nt,Lt,Ct,At,Mt,It,Et,Rt,Gt,Pt;return a(),n(C,null,[U.value?(a(),n("div",Ml,[s("div",Il,[s("div",null,[s("div",El,o(Dt.value),1),s("div",Rl," Year "+o(Y.value)+" / Group "+o(Kt.value),1)]),G.value?(a(),n("div",Gl," Lane: "+o(Oe(G.value)),1)):g("",!0)]),s("div",Pl,[(a(!0),n(C,null,M(Ae.value,c=>(a(),n("button",{key:c,type:"button",class:Qe(["rounded-full border px-3 py-1 text-xs font-semibold transition",c===G.value?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-600 border-slate-200 hover:border-slate-300"]),onClick:L=>G.value=c},o(Oe(c)),11,jl))),128))]),oe.value?(a(),n("div",Hl," Loading KPI items... ")):J.value?(a(),n("div",Tl,o(J.value),1)):(a(),n("div",Dl,[O.value.length?(a(),n("div",Kl,[(a(!0),n(C,null,M(O.value,c=>(a(),n("div",{key:c.id,class:"rounded-xl border border-slate-200 bg-white p-3"},[s("div",Ql,[s("div",zl,[s("div",{class:"text-sm font-semibold text-slate-900 truncate",title:c.title},o(c.title),9,Vl),s("div",Ol,[c.weight!=null?(a(),n("span",ql,"Weight: "+o(c.weight),1)):g("",!0),c.maxScore!=null?(a(),n("span",Ul," / Max: "+o(c.maxScore),1)):g("",!0)])]),s("div",Yl,[xe(s("select",{"onUpdate:modelValue":L=>ae.value[c.id]=L,class:"rounded-lg border border-slate-300 bg-white px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50"},[(a(!0),n(C,null,M(zt(c.maxScore),L=>(a(),n("option",{key:L,value:L},o(L),9,Jl))),128))],8,Wl),[[Ss,ae.value[c.id],void 0,{number:!0}]])])]),s("div",Xl,[e[7]||(e[7]=s("label",{class:"block text-[11px] font-medium text-slate-500"},"Comment (optional)",-1)),xe(s("textarea",{"onUpdate:modelValue":L=>ne.value[c.id]=L,rows:"2",class:"mt-1 w-full rounded-lg border border-slate-200 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/40",placeholder:"Add a note if needed"},null,8,Zl),[[Ce,ne.value[c.id]]])])]))),128))])):(a(),n("div",Bl," No KPI items found for this lane. "))])),s("div",ea,[s("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50 disabled:opacity-50",disabled:W.value||oe.value||!O.value.length,onClick:e[0]||(e[0]=c=>qe(!1))},o(W.value?"Saving...":"Save Draft"),9,ta),s("button",{type:"button",class:"rounded-lg bg-emerald-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-emerald-700 disabled:opacity-50",disabled:W.value||oe.value||!O.value.length,onClick:e[1]||(e[1]=c=>qe(!0))},o(W.value?"Saving...":"Submit"),9,sa)])])):(a(),n("div",la,[s("header",aa,[s("div",na,[s("div",oa,[s("div",ra,[e[8]||(e[8]=s("span",{class:"text-xs font-semibold text-indigo-700"},"KPI Cycle",-1)),s("span",ia,o((l=pe(w).cycle)==null?void 0:l.title),1)]),s("div",ua,[s("div",da,o(((r=b.value)==null?void 0:r.name)||"Employee"),1),s("div",ca,[(i=(u=b.value)==null?void 0:u.designation)!=null&&i.title?(a(),n("span",va,[e[9]||(e[9]=V(" Designation: ")),s("span",ma,o(b.value.designation.title),1)])):g("",!0),(f=(x=b.value)==null?void 0:x.department)!=null&&f.name?(a(),n("span",xa,[e[10]||(e[10]=V(" Department: ")),s("span",pa,o(b.value.department.name),1)])):g("",!0),s("span",fa,[e[14]||(e[14]=V(" Reviewing as: ")),Zt.value?(a(),n("span",ba,[s("span",ga,o(Q.value),1),e[11]||(e[11]=s("span",{class:"text-slate-400"},"+",-1)),s("span",ya,o(T.value),1),e[12]||(e[12]=s("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," dual mode ",-1))])):Ze.value?(a(),n("span",ha,e[13]||(e[13]=[s("span",{class:"font-semibold text-emerald-700"},"HR",-1),s("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," HR mode ",-1)]))):(a(),n("span",_a,o(Ge.value||"No lane"),1))])])])]),s("div",ka,[s("div",wa,[e[15]||(e[15]=s("div",{class:"text-[11px] uppercase tracking-wide text-slate-500"}," Personal group total ",-1)),s("div",$a,[V(o(ue.value.got.toFixed(2))+" ",1),s("span",Fa,"/ "+o(ue.value.max.toFixed(2)),1)]),s("div",Sa,o(ue.value.percent.toFixed(2))+"% achieved ",1)]),Me.value?(a(),n("button",{key:0,onClick:e[2]||(e[2]=c=>pe(w).submitFinalResult(pe(w).cycle.id,pe(B).params.employeeId)),class:"inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-medium text-white shadow hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-300 focus:outline-none"},e[16]||(e[16]=[s("span",null,"Finalize & Lock",-1)]))):g("",!0)])])]),(S=b.value)!=null&&S.active_criteria?(a(),n("div",Na,[s("section",La,[e[17]||(e[17]=s("div",{class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2"},[s("div",{class:"text-sm font-semibold text-slate-800"},"কার্যসম্পাদন বিষয়")],-1)),((A=(N=b.value)==null?void 0:N.active_criteria)==null?void 0:A.length)===0?(a(),n("div",Ca," -- ")):g("",!0),(a(!0),n(C,null,M(b.value.active_criteria,c=>(a(),n("div",{class:"p-4 text-sm text-slate-700",key:c.id},[s("div",{class:"print:block richtext print:break-inside-avoid",innerHTML:c==null?void 0:c.description},null,8,Aa)]))),128))])])):g("",!0),pe(w).cycle&&K.value?(a(),Ve(Tt,{key:1,group:K.value,"is-personal":!0,lanes:Ee.value,"editable-lane-key":Q.value,"can-edit":ye.value,marks:k.value,"header-label":"Personal Evaluation","item-label":((Se=K.value)==null?void 0:Se.label)||"Personal","helper-text":z.value?"All reviewer lanes score the Personal table.":ye.value&&D.value?"Submit Personal and HR reviews separately using the buttons below.":"Fill only your lane; others appear as read-only.","serial-map":bs.value,"get-lane-mark":et,"on-mark-change":st,"on-cap":ie,"on-quick-fill-item":lt},null,8,["group","lanes","editable-lane-key","can-edit","marks","item-label","helper-text","serial-map"])):g("",!0),ye.value?(a(),n("div",Ma,[s("div",Ia,[e[18]||(e[18]=V(" Personal total: ")),s("b",Ea,o(ue.value.got.toFixed(2)),1),s("span",Ra,"/ "+o(ue.value.max.toFixed(2)),1)]),s("button",{onClick:_s,disabled:!gs.value,class:"inline-flex items-center justify-center rounded-xl bg-slate-900 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-slate-800 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-slate-300"}," Submit Personal ",8,Ga)])):g("",!0),s("section",Pa,[s("div",ja,[P.value.length?(a(),n("div",Ha,[(a(!0),n(C,null,M(P.value,(c,L)=>(a(),Ve(Tt,{key:L,group:c,"is-personal":!1,"can-edit":D.value,marks:k.value,"header-label":`Group ${L+1} - ${qt(c,L)}`,"item-label":"Item","show-quick-fill-group":!0,"auto-fill-visible":rt.value&&dt(c,j.value),"auto-fill-label":ms.value,"on-auto-fill":()=>ct(j.value,{overwrite:!0}),"get-hr-mark":tt,"on-mark-change":st,"on-cap":ie,"on-quick-fill-group":es},null,8,["group","can-edit","marks","header-label","auto-fill-visible","auto-fill-label","on-auto-fill"]))),128))])):g("",!0),s("aside",{class:Qe(["space-y-4 sticky top-10 z-50",[P.value.length===0?"lg:col-span-full":"lg:col-span-2"]])},[!z.value&&ts.value&&D.value?(a(),n("section",Ta,[s("header",Da,[e[19]||(e[19]=s("span",null,"Annual Summary",-1)),s("div",Ba,[s("span",Ka,o(He.value),1),je.value?(a(),n("span",Qa," Year "+o(je.value),1)):g("",!0),s("span",za,o(it.value)+" month(s) ",1)])]),s("div",Va,[s("div",Oa,[(a(),n(C,null,M(Pe,c=>s("button",{key:c.key,type:"button",onClick:L=>cs(c.key),class:Qe(["px-3 py-1 rounded-full text-xs font-semibold transition",j.value===c.key?"bg-slate-900 text-white shadow":"border border-slate-200 text-slate-700 bg-white hover:border-slate-400"])},o(c.label),11,qa)),64))]),s("div",Ua,[s("div",Ya,[s("div",Wa,[s("div",Ja,[e[20]||(e[20]=s("span",{class:"text-xs font-medium text-slate-600"},"Incharge",-1)),s("span",Xa,o(X((Ne=y.value.per_scored_month)==null?void 0:Ne.incharge,(Z=y.value.per_scored_month)==null?void 0:Z.max))+"% ",1)]),s("div",Za,[V(o(H((Le=y.value.per_scored_month)==null?void 0:Le.incharge))+" ",1),s("span",en,"/ "+o(H((de=y.value.per_scored_month)==null?void 0:de.max)),1)]),s("div",tn,[s("div",{class:"h-2 bg-blue-500",style:ze({width:X((ce=y.value.per_scored_month)==null?void 0:ce.incharge,(ht=y.value.per_scored_month)==null?void 0:ht.max)+"%"})},null,4)])]),s("div",sn,[s("div",ln,[e[21]||(e[21]=s("span",{class:"text-xs font-medium text-slate-600"},"Coordinator",-1)),s("span",an,o(X((_t=y.value.per_scored_month)==null?void 0:_t.coordinator,(kt=y.value.per_scored_month)==null?void 0:kt.max))+"% ",1)]),s("div",nn,[V(o(H((wt=y.value.per_scored_month)==null?void 0:wt.coordinator))+" ",1),s("span",on,"/ "+o(H(($t=y.value.per_scored_month)==null?void 0:$t.max)),1)]),s("div",rn,[s("div",{class:"h-2 bg-violet-500",style:ze({width:X((Ft=y.value.per_scored_month)==null?void 0:Ft.coordinator,(St=y.value.per_scored_month)==null?void 0:St.max)+"%"})},null,4)])]),s("div",un,[s("div",dn,[e[22]||(e[22]=s("span",{class:"text-xs font-medium text-slate-600"},"Final",-1)),s("span",cn,o(X((Nt=y.value.per_form_yearly)==null?void 0:Nt.final,(Lt=y.value.per_scored_month)==null?void 0:Lt.max))+"% ",1)]),s("div",vn,[V(o(H((Ct=y.value.per_form_yearly)==null?void 0:Ct.final))+" ",1),s("span",mn,"/ "+o(H((At=y.value.per_scored_month)==null?void 0:At.max)),1)]),s("div",xn,[s("div",{class:"h-2 bg-emerald-500",style:ze({width:X((Mt=y.value.per_form_yearly)==null?void 0:Mt.final,(It=y.value.per_scored_month)==null?void 0:It.max)+"%"})},null,4)])])]),s("div",pn,[s("button",{class:"text-xs px-3 py-1.5 rounded-md border hover:bg-slate-50",onClick:e[3]||(e[3]=c=>te.value=!te.value)},o(te.value?"Hide details":"Show "+He.value+" details"),1),te.value?(a(),n("div",fn,[s("div",bn,[e[23]||(e[23]=s("div",{class:"text-slate-500"},"Year",-1)),s("div",gn,o(je.value||"-"),1),e[24]||(e[24]=s("div",{class:"text-slate-500"},"Months counted",-1)),s("div",yn,o(it.value),1),e[25]||(e[25]=s("div",{class:"text-slate-500"},"Group",-1)),s("div",hn,o(ds.value),1),e[26]||(e[26]=s("div",{class:"text-slate-500"},"Max (denominator)",-1)),s("div",_n,o(H((Et=y.value.per_scored_month)==null?void 0:Et.max)),1),e[27]||(e[27]=s("div",{class:"text-slate-500"},"Incharge avg",-1)),s("div",kn,o(H((Rt=y.value.per_form_yearly)==null?void 0:Rt.incharge)),1),e[28]||(e[28]=s("div",{class:"text-slate-500"},"Coordinator avg",-1)),s("div",wn,o(H((Gt=y.value.per_form_yearly)==null?void 0:Gt.coordinator)),1),e[29]||(e[29]=s("div",{class:"text-slate-500"},"Final avg",-1)),s("div",$n,o(H((Pt=y.value.per_form_yearly)==null?void 0:Pt.final)),1),e[30]||(e[30]=s("div",{class:"text-slate-500"},"Percent (simple)",-1)),s("div",Fn,o(H(y.value.percent_simple))+"%",1),e[31]||(e[31]=s("div",{class:"text-slate-500"},"Percent (weighted)",-1)),s("div",Sn,o(H(y.value.percent_weighted))+"%",1)])])):g("",!0)])])])])):g("",!0),he.value.length?(a(),n("section",Nn,[s("header",Ln,[e[32]||(e[32]=s("span",null,"Review Comments",-1)),s("span",Cn,o(he.value.length)+" lane(s) ",1)]),s("div",An,[s("div",Mn,[s("table",In,[e[34]||(e[34]=s("thead",{class:"text-[11px] text-slate-600 uppercase tracking-wide bg-slate-50"},[s("tr",null,[s("th",{class:"px-2 py-2 w-[140px]"},"Lane"),s("th",{class:"px-2 py-2 text-right"},"Details")])],-1)),s("tbody",null,[(a(!0),n(C,null,M(he.value,c=>(a(),n("tr",{key:c.key,class:"border-t hover:bg-slate-50/60 align-top"},[s("td",En,[s("div",Rn,o(c.label),1),c.submitted_at?(a(),n("div",Gn,o(new Date(c.submitted_at).toLocaleDateString()),1)):g("",!0)]),s("td",Pn,[s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:L=>ps(c)},e[33]||(e[33]=[s("span",null,"View comments",-1),s("span",{class:"text-[10px] text-slate-400"},"Strengths · Gaps · Suggestions",-1)]),8,jn)])]))),128))])])])])])):g("",!0)],2)])]),ye.value||D.value?(a(),n("section",Hn,[e[41]||(e[41]=Ns('<header class="flex items-center justify-between mb-1"><div><h2 class="text-sm font-semibold text-slate-800">Overall Review Notes</h2><p class="text-[11px] text-slate-500">Use saved hints or write your own detailed comments.</p></div><div class="hidden md:flex items-center gap-2 text-[11px] text-slate-500"><span class="inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 border border-emerald-100"><span class="text-xs">●</span> Strengths </span><span class="inline-flex items-center gap-1 rounded-full bg-amber-50 px-2 py-0.5 border border-amber-100"><span class="text-xs">●</span> Gaps </span><span class="inline-flex items-center gap-1 rounded-full bg-sky-50 px-2 py-0.5 border border-sky-100"><span class="text-xs">●</span> Suggestions </span></div></header>',1)),s("div",Tn,[s("div",Dn,[s("header",Bn,[e[35]||(e[35]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-emerald-500 text-base leading-none"},"★"),s("span",null,"Strengths")],-1)),_e.value.length?(a(),n("span",Kn,o(_e.value.length)+" saved hint(s) ",1)):g("",!0)]),_e.value.length?(a(),n("div",Qn,[s("div",zn,[(a(!0),n(C,null,M(_e.value,c=>(a(),n("button",{key:c,type:"button",onClick:L=>Ke("strengths",c),disabled:Fe("strengths",c),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-800 disabled:opacity-40 disabled:cursor-not-allowed"},o(c),9,Vn))),128))])])):(a(),n("p",On,"No historical strengths yet. Write your own notes below.")),s("div",qn,[e[36]||(e[36]=s("label",{class:"text-[11px] font-medium text-slate-500"}," Key Strength(s) ",-1)),xe(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=c=>p.value=c),placeholder:"e.g. Strong ownership, proactive problem solving…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[Ce,p.value]])])]),s("div",Un,[s("header",Yn,[e[37]||(e[37]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-amber-500 text-base leading-none"},"!"),s("span",null,"Gaps")],-1)),ke.value.length?(a(),n("span",Wn,o(ke.value.length)+" saved hint(s) ",1)):g("",!0)]),ke.value.length?(a(),n("div",Jn,[s("div",Xn,[(a(!0),n(C,null,M(ke.value,c=>(a(),n("button",{key:c,type:"button",onClick:L=>Ke("gaps",c),disabled:Fe("gaps",c),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-amber-300 hover:bg-amber-50 hover:text-amber-800 disabled:opacity-40 disabled:cursor-not-allowed"},o(c),9,Zn))),128))])])):(a(),n("p",eo,"No historical gaps yet.")),s("div",to,[e[38]||(e[38]=s("label",{class:"text-[11px] font-medium text-slate-500"},"GAP(s)",-1)),xe(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=c=>v.value=c),placeholder:"e.g. Needs improvement in documentation, communication…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-amber-200"},null,512),[[Ce,v.value]])])]),s("div",so,[s("header",lo,[e[39]||(e[39]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-sky-500 text-base leading-none"},"✱"),s("span",null,"Suggestions / Training")],-1)),we.value.length?(a(),n("span",ao,o(we.value.length)+" common suggestion(s) ",1)):g("",!0)]),we.value.length?(a(),n("div",no,[s("div",oo,[(a(!0),n(C,null,M(we.value,c=>(a(),n("button",{key:c,type:"button",onClick:L=>Ke("suggestions",c),disabled:Fe("suggestions",c),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-sky-300 hover:bg-sky-50 hover:text-sky-800 disabled:opacity-40 disabled:cursor-not-allowed"},o(c),9,ro))),128))])])):g("",!0),s("div",io,[e[40]||(e[40]=s("label",{class:"text-[11px] font-medium text-slate-500"}," Suggestions / Development plan ",-1)),xe(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=c=>h.value=c),placeholder:"Specific actions, training plans, timeline and expectations…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-sky-200"},null,512),[[Ce,h.value]])])])])])):g("",!0),s("div",uo,[e[42]||(e[42]=s("div",{class:"text-sm text-slate-600"},"HR review (other groups)",-1)),s("div",co,[D.value?(a(),n("button",{key:0,onClick:ks,disabled:!ys.value,class:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-emerald-700 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-emerald-300"}," Submit HR Review ",8,vo)):g("",!0)])])])),Fs(As,{name:"fade-scale"},{default:Ls(()=>{var c,L,jt;return[Te.value&&I.value?(a(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:Cs(De,["escape","window"])},[s("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:De}),s("div",mo,[s("div",xo,[s("div",null,[s("p",po,o(I.value.label),1),s("p",fo," Lane: "+o(I.value.lane)+" - Reviewed by "+o(I.value.reviewer_name||"––"),1),I.value.submitted_at?(a(),n("p",bo,o(new Date(I.value.submitted_at).toLocaleString()),1)):g("",!0)]),s("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:De}," Close ")]),s("div",go,[s("div",null,[e[43]||(e[43]=s("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[s("span",null,"Strengths")],-1)),s("div",yo,[(c=I.value.strengths)!=null&&c.length?(a(),n("div",ho,[(a(!0),n(C,null,M(I.value.strengths,(ve,me)=>(a(),n("p",{key:"modal-strength-"+me}," - "+o(ve),1))),128))])):(a(),n("p",_o,"No strengths entered."))])]),s("div",null,[e[44]||(e[44]=s("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[s("span",null,"Gaps")],-1)),s("div",ko,[(L=I.value.gaps)!=null&&L.length?(a(),n("div",wo,[(a(!0),n(C,null,M(I.value.gaps,(ve,me)=>(a(),n("p",{key:"modal-gap-"+me}," - "+o(ve),1))),128))])):(a(),n("p",$o,"No gaps recorded."))])]),s("div",null,[e[45]||(e[45]=s("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[s("span",null,"Suggestions")],-1)),s("div",Fo,[(jt=I.value.suggestions)!=null&&jt.length?(a(),n("div",So,[(a(!0),n(C,null,M(I.value.suggestions,(ve,me)=>(a(),n("p",{key:"modal-sug-"+me}," - "+o(ve),1))),128))])):(a(),n("p",No,"No suggestions provided."))])])])])],32)):g("",!0)]}),_:1})],64)}}},Mo={__name:"KpiReviewPage",setup(d){return(E,B)=>(a(),Ve(Lo))}};export{Mo as default};
