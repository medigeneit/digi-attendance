import{_ as $e}from"./CommentModal-DnfK1SG3.js";import{_ as _e,a as Ae}from"./TaskUserAssignForm-C5U8cpZA.js";import{L as Ie}from"./LoaderView-CqVgd0Or.js";import{O as ae}from"./OverlyModal-DpIF2Rsu.js";import{_ as Se}from"./TaskAddForm-BWLCyXN5.js";import{_ as Le}from"./TaskEditForm-BcnnFN6F.js";import{r as P,m as k,c as o,o as s,a as e,h as Y,v as me,g as n,w as H,d as ce,b as se,e as pe,x as le,z as ye,f as D,F as z,q as $,C as re,n as Z,t as L,k as y,i as j,E as oe,j as E,p as ee,G as Ve,u as Me,s as ie}from"./index-Bv4d1Dc3.js";import{_ as De}from"./MultiselectDropdown-DrTwp2Bf.js";import{g as qe,m as xe,u as Ee}from"./task-priority-BmRxEBcz.js";import{u as Ue}from"./company-CmPWV7DS.js";import{_ as de}from"./CompanyDepartmentSelectInput-BqVTsq9S.js";import{_ as fe}from"./UserChip-CvQiC193.js";import{_ as ge,a as Be,b as ve,c as ke,T as be,d as we,e as Pe}from"./TaskUrgentBadge-cTpNVkfc.js";import{b as he,a as Q}from"./datetime-DLUp6MRA.js";import{o as Oe}from"./url-CePbr-gY.js";import{_ as je}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ne}from"./useTaskStore-C0udZJKQ.js";import"./useCommentStore-miLazjzY.js";import"./TextWithHr-D5FLDBdj.js";import"./TaskUrgencyInput-Emkxi90k.js";import"./TaskUserChip-6SnDBmYF.js";import"./RequiredIcon-DbQPNDWB.js";import"./useRequirementStore-l6Kf5LHR.js";import"./requirement-wGnmSAvt.js";import"./SectionLoading-DuCUcQb-.js";import"./tags-7t-mHvof.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DECOkjG4.js";const Re={class:"text-gray-600 relative"},Fe={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},ue={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(l,{emit:w}){const m=l,x=P(),b=w,g=c=>{b("update:modelValue",c||void 0)};let _=0;const C=k({get(){return m.modelValue},set(c){clearTimeout(_),_=setTimeout(g,500,c)}});return(c,d)=>(s(),o("div",Re,[d[3]||(d[3]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),Y(e("input",{ref_key:"searchInput",ref:x,id:"search","onUpdate:modelValue":d[0]||(d[0]=p=>C.value=p),type:"text",class:"!pr-7 w-full rounded-md px-2 py-1 border-2 border-gray-400 placeholder:text-sm focus:outline-gray-400",placeholder:"Search by main task title"},null,512),[[me,C.value]]),e("div",Fe,[C.value?(s(),o("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:d[1]||(d[1]=H(()=>{g(""),x.value.focus()},["prevent"]))})):n("",!0),d[2]||(d[2]=e("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},He={class:"mb-3 task-header"},ze={class:"flex justify-between items-start mb-4"},We={key:0,class:"ml-auto flex gap-6 items-center"},Ge={key:0,class:"flex gap-2 items-center"},Je={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ke={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Ye={class:"relative w-full md:w-48 flex-grow"},Qe=["value"],Xe={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Ze={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},et={class:"w-32 relative h-8"},tt={class:"flex gap-4 items-center flex-shrink-0"},st={class:"flex gap-2"},lt={class:"flex gap-2"},at={class:"flex gap-2"},ot={class:"text-gray-600 w-full md:w-32 relative"},nt={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},rt={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},it={key:0,class:"text-[9px] text-green-800"},dt=["onClick"],ut={key:1,class:"flex justify-end gap-5"},mt={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(l,{emit:w}){const m=l,x=ce(),b=se(),g=k(S("company-id")),_=k(S("from-department-id")),C=k(S("to-department-id")),c=k(S("user-ids")),d=k(S("month")),p=k(S("status")),h=k(S("is-important")),a=k(S("is-urgent")),A=k(S("is-target")),O=k(S("search")),I=w,r=Ue(),B=P([]);function S(T){return{get:()=>m.modelValue[T]||"",set:t=>{I("update:modelValue",{...m.modelValue,[T]:t||void 0})}}}const N=k(()=>K(c.value));async function W(){var T,t,f;if(!m.isMyTask){const i=(T=m.modelValue)==null?void 0:T["company-id"],V=C.value,q={...i?{company_id:i}:{},...V?{department_ids:[V]}:{}};B.value=((f=(t=await qe({params:q}))==null?void 0:t.data)==null?void 0:f.employees)||[]}}pe(async()=>{await W(),await r.fetchCompanies({with:"departments",ignore_permission:!0}),await r.fetchMyCompanies({with:"departments"})});function K(T){return Array.isArray(B.value)&&B.value.find(t=>t.id==T)||null}function X(T){c.value=(T==null?void 0:T.id)||""}function G(){c.value=""}le(()=>C.value,W),le(()=>g.value,()=>{C.value!==""?C.value="":W()});function R(T,t,{value:f,id:i,label:V,onCancel:q}={}){if(!T)return[];const M=Array.isArray(t)?t.find(v=>(v==null?void 0:v[i])==T):null;return M?[{label:V,value:M==null?void 0:M[f],id:M==null?void 0:M[i],onCancel:q}]:[]}const U=k(()=>{var i;const T=r.companies.reduce((V,q)=>[...V,...q.departments],[]),t=(V,{label:q,value:M,id:v,onCancel:J})=>V?[{label:q,value:M,id:v,onCancel:J}]:[],f=(V,{label:q,onCancel:M})=>{if(!V)return[];const v=new Date(V);return[{label:q,value:v.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:V,onCancel:M}]};return[...R(g.value,r.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{g.value=""}}),...R(_.value,T,{label:"From",value:"short_name",id:"id",onCancel:()=>{_.value=""}}),...R(C.value,T,{label:"To",value:"short_name",id:"id",onCancel:()=>{C.value=""}}),...R((i=N.value)==null?void 0:i.id,B.value,{label:"Employee",value:"name",id:"id",onCancel:G}),...R(p.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{p.value=""}}),...t(h.value,{label:"",value:"Important ",id:!0,onCancel:()=>{h.value=""}}),...t(a.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{a.value=""}}),...t(A.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{A.value=""}}),...f(d.value,{label:"",onCancel:()=>{d.value=""}})]});return(T,t)=>{var i,V,q,M,v,J,F,ne;const f=ye("RouterLink");return s(),o(z,null,[e("div",He,[e("div",ze,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),l.isMyTask?n("",!0):(s(),o("div",We,[l.listHasRearranged?(s(),o("div",Ge,[t[13]||(t[13]=e("span",{class:"text-red-500"},"Priority Changed",-1)),e("button",{class:"btn-3",onClick:t[0]||(t[0]=H(u=>I("clickPrioritySave"),["prevent"]))},"Save"),e("button",{class:"btn-3",onClick:t[1]||(t[1]=H(u=>I("clickPriorityDiscard"),["prevent"]))},"Discard")])):n("",!0),e("button",{onClick:t[2]||(t[2]=u=>I("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),e("div",Je,[e("div",Ke,[l.isMyTask?n("",!0):(s(),o(z,{key:0},[e("div",Ye,[t[16]||(t[16]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),Y(e("select",{"onUpdate:modelValue":t[3]||(t[3]=u=>g.value=u),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[t[15]||(t[15]=e("option",{value:""},"--ALL COMPANY--",-1)),(s(!0),o(z,null,Z((i=y(r))==null?void 0:i.myCompanies,u=>(s(),o("option",{key:u.id,value:u.id},L(u.name),9,Qe))),128))],512),[[re,g.value]])]),$(de,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=u=>_.value=u),companies:((V=y(r))==null?void 0:V.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:j(()=>t[17]||(t[17]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),y(b).name!=="MyTaskList"?(s(),D(de,{key:0,modelValue:C.value,"onUpdate:modelValue":t[5]||(t[5]=u=>C.value=u),companies:((q=y(r))==null?void 0:q.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:j(()=>t[18]||(t[18]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):n("",!0),y(x).isAdminMood&&((v=(M=y(x))==null?void 0:M.user)==null?void 0:v.role)!=="employee"?(s(),o("div",Xe,[$(De,{modelValue:N.value,onSelect:X,onRemove:G,options:B.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:j(({option:u})=>[$(fe,{user:u,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),N.value?(s(),o("div",Ze,[e("button",{onClick:H(G,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):n("",!0),t[19]||(t[19]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):n("",!0)],64)),e("div",et,[t[21]||(t[21]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),Y(e("select",{"onUpdate:modelValue":t[6]||(t[6]=u=>p.value=u),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},t[20]||(t[20]=[e("option",{value:""},"--ALL TASKS--",-1),e("option",{value:"not-completed"},"Not Completed",-1),e("option",{value:"only-completed"},"Completed",-1)]),512),[[re,p.value]])]),e("div",tt,[e("label",st,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=u=>h.value=u)},null,512),[[oe,h.value]]),t[22]||(t[22]=e("span",null,"Important",-1))]),e("label",lt,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=u=>a.value=u)},null,512),[[oe,a.value]]),t[23]||(t[23]=e("span",null,"Urgent",-1))]),e("label",at,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=u=>A.value=u)},null,512),[[oe,A.value]]),t[24]||(t[24]=e("span",null,"Is Target",-1))])]),e("div",ot,[t[25]||(t[25]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),Y(e("input",{id:"month-filter","onUpdate:modelValue":t[10]||(t[10]=u=>d.value=u),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[me,d.value]])])]),l.isMyTask?(s(),D(ue,{key:0,modelValue:O.value,"onUpdate:modelValue":t[11]||(t[11]=u=>O.value=u),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):n("",!0)])]),e("div",nt,[l.isMyTask?n("",!0):(s(),D(ue,{key:0,modelValue:O.value,"onUpdate:modelValue":t[12]||(t[12]=u=>O.value=u),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),e("div",rt,[(s(!0),o(z,null,Z(U.value,u=>(s(),o("div",{key:u.label||u.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[e("div",null,[u.label?(s(),o("span",it,L(u.label)+": ",1)):n("",!0),E(L(u.value),1)]),e("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:H(u.onCancel,["prevent"])},t[26]||(t[26]=[e("i",{class:"fas fa-times-circle"},null,-1)]),8,dt)]))),128))]),l.isMyTask?n("",!0):(s(),o("div",ut,[$(f,{class:ee(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((J=y(b).query)==null?void 0:J.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...y(b).query,view:"userwise"}}},{default:j(()=>t[27]||(t[27]=[E(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),$(f,{class:ee(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((F=y(b).query)==null?void 0:F.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ne=y(b))==null?void 0:ne.query)||{}).filter(u=>{var te;return((te=y(b))==null?void 0:te.query[u])!=="userwise"}).reduce((u,te)=>({...u,[te]:y(b).query[te]}),{})}}},{default:j(()=>t[28]||(t[28]=[E(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},ct={},pt={class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"};function yt(l,w){return s(),o("div",pt,w[0]||(w[0]=[e("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),E("CLOSED ")]))}const Te=je(ct,[["render",yt]]),xt={class:"-mx-3"},ft={key:0,class:"w-full"},gt={class:"border text-center py-2 border-gray-200"},vt={key:0,class:"text-base font-semibold text-purple-600"},kt={class:"border px-3 py-1 border-gray-200"},bt={class:"flex items-center gap-3"},wt={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},ht={class:"text-gray-400 text-xs mr-4"},Tt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ct={class:"border px-3 py-1 border-gray-200"},$t={class:"flex justify-center"},_t={class:"border px-3 py-1 border-gray-200 text-center"},At={key:0,class:"text-gray-500 text-sm"},It={class:"font-semibold text-blue-800"},St={class:"border px-3 py-1 border-gray-200 text-center"},Lt={key:0,class:"ml-4 text-gray-500 text-sm"},Vt={class:"text-blue-500 font-semibold"},Mt={class:"border px-3 py-1 border-gray-200 text-center"},Dt={key:0,class:"text-gray-500 text-sm"},qt={class:"font-semibold text-blue-800"},Et={class:"border px-3 py-1 border-gray-200"},Ut={class:"flex justify-end gap-2"},Bt={class:"flex gap-1 items-center mt-2 text-sm"},Pt={key:1,class:"text-red-800 italic"},Ot=["href"],jt={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},parentTask:{type:Object},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5}},emits:["editClick","addClick","employeeAssignClick"],setup(l,{emit:w}){const m=l,x=P(!1),b=se(),g=k(()=>x.value?m.childrenTasks:m.childrenTasks.slice(0,m.maxItem)),_=k(()=>x.value?[]:m.childrenTasks.slice(m.maxItem));function C(){x.value=!x.value}const c=w;return(d,p)=>{var h;return s(),o("div",xt,[((h=l.childrenTasks)==null?void 0:h.length)>0?(s(),o("table",ft,[p[2]||(p[2]=e("thead",null,[e("tr",null,[e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50 w-[30px]"},"SL"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Sub Task"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Assign Person"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Assign Date"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Deadline"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Started"),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50"},"Status")])],-1)),e("tbody",null,[(s(!0),o(z,null,Z(g.value,(a,A)=>(s(),o("tr",{key:a.id,class:ee(["",{" bg-green-400/20":a.status=="COMPLETED"," bg-white hover:bg-slate-50":a.status!=="COMPLETED"}])},[e("td",gt,[A!==void 0?(s(),o("div",vt,L(A+1)+". ",1)):n("",!0)]),e("td",kt,[e("div",bt,[$(ge,{titleClass:"text-sm",task:a,"sub-tasks-open":!1,"is-my-task":d.isMyTask},null,8,["task","is-my-task"])]),e("div",wt,[e("div",ht,[p[1]||(p[1]=e("i",{class:"fas fa-clock"},null,-1)),E(" "+L(y(he)(a.created_at)),1)]),e("div",Tt,[a!=null&&a.is_important?(s(),D(be,{key:0})):n("",!0),a!=null&&a.is_urgent?(s(),D(we,{key:1})):n("",!0)])])]),e("td",Ct,[e("div",$t,[$(Be,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:a.users||[],isTargetTask:a.is_target,maxItem:1,"route-to":O=>`/tasks?status=not-completed&view=userwise&user-ids=${O.id}`},null,8,["users","isTargetTask","route-to"])])]),e("td",_t,[a.assigned_at||a.created_at?(s(),o("span",At,[e("span",It,L(y(Q)(a.assigned_at||a.created_at)),1)])):n("",!0)]),e("td",St,[a.deadline?(s(),o("span",Lt,[e("span",Vt,L(y(Q)(a.deadline)),1)])):n("",!0)]),e("td",Mt,[a.started_at?(s(),o("span",Dt,[e("span",qt,L(y(Q)(a.started_at)),1)])):n("",!0)]),e("td",Et,[e("div",Ut,[a.closed_at?(s(),D(Te,{key:0})):n("",!0),$(ve,{status:a==null?void 0:a.status,progressPercent:(a==null?void 0:a.progress_percent)||0},null,8,["status","progressPercent"]),$(ke,{ref_for:!0,ref:"progress",task:a,class:"text-sm"},null,8,["task"])])])],2))),128))])])):n("",!0),e("div",Bt,[l.childrenTasks.length>0?(s(),o(z,{key:0},[_.value.length>0||x.value?(s(),o("button",{key:0,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border ml-2",onClick:H(C,["prevent","stop"])},L(x.value?"Hide":"Show")+" All ",1)):n("",!0),_.value.length>0?(s(),o("span",Pt,L(_.value.length)+" More sub task"+L(_.value.length>1?"s":""),1)):n("",!0)],64)):n("",!0),l.parentTask.level<2?(s(),o("a",{key:1,href:`/tasks/add?parent_id=${l.parentTask.id}&back-to=${encodeURIComponent(y(b).path+"?"+y(Oe)(y(b).query)).toLowerCase()}`,class:"ml-5 hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-indigo-300",onClick:p[0]||(p[0]=H(a=>c("addClick",l.parentTask.id),["stop","prevent"]))},p[3]||(p[3]=[e("i",{class:"fas fa-plus"},null,-1),E(" Add Sub Task ")]),8,Ot)):n("",!0)])])}}},Nt={class:"flex w-full text-gray-800 bg-white"},Rt={key:0,class:"border-l border-gray-200 last:border-l-0"},Ft={class:"items-start group"},Ht={class:"flex items-start gap-6 w-full pb-4"},zt={class:"flex-grow w-6/12"},Wt={class:"flex gap-2"},Gt={key:0,class:"text-xl font-semibold text-blue-500"},Jt={class:"flex items-center mb-2"},Kt={key:0,class:"flex gap-4 items-center mr-3"},Yt={key:1,class:"text-gray-500 text-sm"},Qt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Xt={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},Zt={class:"text-xs text-gray-400 whitespace-nowrap"},es={class:"justify-end items-center gap-2 ml-auto flex flex-wrap w-[350px]"},ts={class:"ml-0 col-span-full"},ss={class:"flex gap-3 items-center"},ls={class:"text-right text-sm flex gap-4 mt-2 opacity-80"},as={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},os={key:1,class:"text-gray-500 text-sm"},ns={class:"font-semibold text-blue-800"},rs={key:2,class:"ml-4 text-gray-500 text-sm"},is={class:"text-blue-500 font-semibold"},ds={key:3,class:"text-gray-500 text-sm"},us={class:"font-semibold text-blue-800"},ms={key:4,class:"text-gray-500 text-sm"},cs={class:"font-semibold text-blue-800"},ps={class:"flex items-center sm:ml-auto order-0 sm:order-1"},ys={key:0,class:"flex gap-2 ml-4 items-center text-xs"},xs=["href"],fs=["href"],Ce={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(l,{emit:w}){const m=l,x=se(),b=P(null),g=w;function _(I){g("editClick",I)}function C(I){g("employeeAssignClick",I)}const c=P([]),d=localStorage.getItem("sub_task_opened_list");if(d)try{c.value=JSON.parse(d)}catch{c.value=[]}const p=k(()=>Q(m.task.assigned_at||m.task.created_at)),h=k(()=>Q(m.task.deadline)),a=k(()=>Q(m.task.started_at)),A=k(()=>Q(m.task.completed_at)),O=k({get:()=>c.value.includes(m.task.id),set:I=>{const r=c.value.includes(m.task.id);I&&!r?c.value.push(m.task.id):!I&&r&&(c.value=c.value.filter(B=>B!==m.task.id))}});return le(c,I=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(I))},{deep:!0}),(I,r)=>{var S,N,W,K,X,G,R;const B=ye("RouterLink");return s(),o("div",Nt,[l.treeLevel>0?(s(),o("div",Rt,r[4]||(r[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):n("",!0),e("div",{class:ee(["flex-grow border-2 rounded pb-3 px-3",{"border-blue-500":l.index%2===0,"border-pink-300":l.index%2===1}])},[e("div",Ft,[e("div",{class:ee(["-mx-3 px-3 pt-3 shadow-slate-100 flex flex-wrap z-30",{"bg-blue-100/30  ":l.task.closed_at,"bg-green-100  ":((S=b.value)==null?void 0:S.completedPercentage)===100,"bg-white hover:bg-gray-50":((N=b.value)==null?void 0:N.completedPercentage)<100&&!l.task.closed_at,"shadow-sm":l.treeLevel>0}])},[e("div",Ht,[e("div",zt,[e("div",Wt,[l.index!==void 0?(s(),o("div",Gt,L(l.index+1)+". ",1)):n("",!0),$(ge,{task:l.task,"sub-tasks-open":O.value,"is-my-task":l.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",Jt,[l.showDraggableHandle||l.task.serial?(s(),o("div",Kt,[l.showDraggableHandle?(s(),o("button",{key:0,onMousedown:r[0]||(r[0]=H((...U)=>I.handleDragging&&I.handleDragging(...U),["stop"])),class:"handle"},r[5]||(r[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):n("",!0),l.task.serial?(s(),o("span",Yt," #"+L(l.task.serial),1)):n("",!0)])):n("",!0),e("div",Qt,[l.treeLevel===0?(s(),o("div",Xt," Main ")):n("",!0),(W=l.task)!=null&&W.is_important?(s(),D(be,{key:1,class:"flex-none"})):n("",!0),(K=l.task)!=null&&K.is_urgent?(s(),D(we,{key:2,class:"flex-none"})):n("",!0)])]),e("div",Zt,[r[6]||(r[6]=e("i",{class:"fas fa-clock"},null,-1)),E(" "+L(y(he)(l.task.created_at)),1)])]),l.hideAssignedUsers?n("",!0):(s(),D(Pe,{key:0,task:l.task,"tree-level":l.treeLevel,class:"flex-nowrap w-1/2","employee-route-to":U=>({query:{...y(x).query,view:"userwise","company-id":U.company_id,"user-ids":U.id}})},null,8,["task","tree-level","employee-route-to"])),e("div",es,[l.task.closed_at?(s(),D(Te,{key:0})):n("",!0),$(ve,{status:(X=l.task)==null?void 0:X.status,progressPercent:((G=l.task)==null?void 0:G.progress_percent)||0,class:"w-[150px] text-center !border-2"},null,8,["status","progressPercent"]),$(ke,{ref_key:"progress",ref:b,task:l.task,class:"text-sm w-[150px] text-center"},null,8,["task"])])])],2),e("div",ts,[$(jt,{childrenTasks:l.task.children_tasks,parentTask:l.task,"hide-buttons":l.hideButtons,"hide-assigned-users":l.hideAssignedUsers,"parent-tree-level":l.treeLevel,onEditClick:_,onAddClick:r[1]||(r[1]=U=>g("addClick",U)),onEmployeeAssignClick:C},{"tree-item-end":j(({task:U,level:T})=>[Ve(I.$slots,"item-end",{level:T,task:U})]),_:3},8,["childrenTasks","parentTask","hide-buttons","hide-assigned-users","parent-tree-level"])])]),e("div",null,[e("div",ss,[e("div",ls,[l.task.is_target?(s(),o("div",as,r[7]||(r[7]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),E(" TARGET TASK ")]))):n("",!0),p.value?(s(),o("span",os,[r[8]||(r[8]=E(" Assign: ")),e("span",ns,L(p.value),1)])):n("",!0),h.value?(s(),o("span",rs,[r[9]||(r[9]=E(" Deadline: ")),e("span",is,L(h.value),1)])):n("",!0),a.value?(s(),o("span",ds,[r[10]||(r[10]=E(" Started: ")),e("span",us,L(a.value),1)])):n("",!0),A.value?(s(),o("span",ms,[r[11]||(r[11]=E(" Completed: ")),e("span",cs,L(A.value),1)])):n("",!0)]),e("div",ps,[l.hideButtons?n("",!0):(s(),o("div",ys,[l.task.is_closed?n("",!0):(s(),o("a",{key:0,href:`/tasks/edit/${l.task.id}`,onClick:r[2]||(r[2]=H(U=>g("editClick",l.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},r[12]||(r[12]=[e("i",{class:"fas fa-edit"},null,-1),E(" Edit ")]),8,xs)),l.task.is_closed?n("",!0):(s(),o("a",{key:1,href:`/tasks/${l.task.id}/assign-users`,onClick:r[3]||(r[3]=H(U=>g("employeeAssignClick",l.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},r[13]||(r[13]=[e("i",{class:"fas fa-users-cog"},null,-1),E(" Manage Employee & Supervisor ")]),8,fs)),$(B,{to:{name:"TaskReports",params:{id:(R=l.task)==null?void 0:R.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:j(()=>r[14]||(r[14]=[e("i",{class:"far fa-file-alt"},null,-1),E(" Reports ")])),_:1,__:[14]},8,["to"])]))])])])],2)])}}},gs={class:"w-full bg-white rounded"},vs=["rowspan"],ks={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(l,{emit:w}){const m=l,x=se(),b=w,g=k(()=>m.tasks.reduce((c,d)=>(c.push(...d.users.filter(p=>!c.find(h=>h.id==p.id&&p.id))),c),[]).filter(c=>m.selectedUserId?c.id==m.selectedUserId:!0)),_=c=>{const p=m.tasks.filter(h=>h.users.some(a=>a.id===c));return xe(p,{...x.query,"user-ids":c})},C=k(()=>g.value.map(c=>{const d=_(c.id);return{...c,tasks:d}}));return(c,d)=>(s(),o("div",null,[e("table",gs,[e("tbody",null,[(s(!0),o(z,null,Z(C.value,p=>(s(),o(z,{key:p.id},[(s(!0),o(z,null,Z(p.tasks,(h,a)=>(s(),o("tr",{key:h.id},[a==0?(s(),o("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(p.tasks.length,1)},[$(fe,{user:p,class:"sticky top-[8rem]"},null,8,["user"])],8,vs)):n("",!0),e("td",{class:ee(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":a==0,"border-b":p.tasks.length-1===a}])},[$(Ce,{task:h,class:"!border-0 my-0",index:a,onCommentButtonClick:d[0]||(d[0]=A=>b("commentButtonClick",c.item.id)),onEditClick:d[1]||(d[1]=A=>b("editClick",A)),onAddClick:d[2]||(d[2]=A=>b("addClick",A)),onEmployeeAssignClick:d[3]||(d[3]=A=>b("employeeAssignClick",A))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},bs={class:"max-w-full mx-4 p-6 mt-2 relative bg-white rounded-md shadow-md"},ws={class:"mb-4"},hs={class:"relative min-h-[30vh]"},Ts={key:0,class:"text-center py-4 text-red-500"},Cs={key:1},$s={class:"flex items-stretched"},_s={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},As=1,tl={__name:"TaskList",setup(l){const w=Ne(),m=ce(),x=se(),b=Me(),g=P(""),_=P(!1),C=P(null),c=k(()=>{var f;return((f=m==null?void 0:m.user)==null?void 0:f.role)==="employee"||!(m!=null&&m.isAdminMood)?!0:!!x.query["user-ids"]}),d=P(null),p=P(!1),h=ie({parentId:0,requirementId:0}),a=ie({taskId:0,isOpen:!1}),A=P(null),O=P([]),{handleItemsPriorityUpdate:I,saveTaskPriority:r,listHasRearranged:B}=Ee(()=>w.taskListTree,0);pe(async()=>{g.value="loading",x.query.status?await S():b.push({query:{...x.query,status:"not-completed"}})});async function S(){let f;x.name==="MyTaskList"?f=await w.fetchMyTasks({...x.query,page:1}):f=await w.fetchTasks({...x.query,page:1},{infiniteScrolling:!1}),g.value="",O.value=f.query_log||[]}const N=f=>{p.value=!0,h.parentId=f},W=f=>{a.taskId=f,a.isOpen=!0},K=f=>{C.value=f,_.value=!0},X=()=>{_.value=!1,C.value=null};async function G(){d.value=null,p.value=!1,h.parentId=0,g.value="loading",await S()}async function R(){p.value=!1,h.parentId=0,await S()}async function U(){g.value="loading",await r()&&await S()}le(()=>({...x.query}),async()=>{w.resetTaskList(),g.value="loading",await S()});const T=k({get(){return{...x.query}},set(f){localStorage.removeItem("sub_task_opened_list"),b.push({query:{...f}})}}),t=k(()=>{var i;const f={...x.query};return x.name=="MyTaskList"&&(f["user-ids"]=(i=m==null?void 0:m.user)==null?void 0:i.id),Array.isArray(w.tasks)?xe(w.tasks,f):[]});return(f,i)=>{var V,q,M;return s(),o("div",bs,[d.value?(s(),D(ae,{key:0},{default:j(()=>[$(Le,{taskId:d.value,onClose:i[0]||(i[0]=v=>d.value=null),onUpdated:G},null,8,["taskId"])]),_:1})):n("",!0),p.value?(s(),D(ae,{key:1},{default:j(()=>[$(Se,{parentTaskId:h.parentId,requirementId:h.requirementId,onClose:R,onTaskCreated:G},null,8,["parentTaskId","requirementId"])]),_:1})):n("",!0),a.isOpen?(s(),D(ae,{key:2,class:"*:max-w-4xl"},{default:j(()=>[$(_e,{taskId:a.taskId,onCancelClick:i[1]||(i[1]=()=>{a.isOpen=!1,a.taskId=0}),onSuccess:i[2]||(i[2]=()=>{a.isOpen=!1,a.taskId=0,g.value="loading",S()})},null,8,["taskId"])]),_:1})):n("",!0),$(mt,{modelValue:T.value,"onUpdate:modelValue":i[3]||(i[3]=v=>T.value=v),onClickAddTask:N,onClickPrioritySave:U,onClickPriorityDiscard:i[4]||(i[4]=()=>y(B)?A.value.resetItems:null),"list-has-rearranged":y(B),isMyTask:y(x).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((q=(V=y(x))==null?void 0:V.query)==null?void 0:q["query-log"])=="true"?(s(!0),o(z,{key:3},Z(O.value,(v,J)=>(s(),o("div",{key:J,class:"text-xs text-gray-500"},[e("div",ws,L(v.raw_query),1)]))),128)):n("",!0),e("div",hs,[y(w).error?(s(),o("div",Ts,L(y(w).error),1)):y(w).tasks.length>0?(s(),o("div",Cs,[((M=y(x).query)==null?void 0:M.view)=="userwise"?(s(),D(ks,{key:0,tasks:t.value,selectedUserId:y(x).query["user-ids"],onCommentButtonClick:i[5]||(i[5]=v=>K(v,f.task.id)),onEditClick:i[6]||(i[6]=v=>d.value=v),onAddClick:i[7]||(i[7]=v=>N(v)),onEmployeeAssignClick:i[8]||(i[8]=v=>W(v))},null,8,["tasks","selectedUserId"])):(s(),D(Ae,{key:1,items:t.value,handle:"handle",onItemsUpdate:y(I),class:"space-y-6",ref_key:"draggableTaskList",ref:A},{item:j(({item:v,index:J})=>[e("div",$s,[$(Ce,{"is-my-task":y(x).name==="MyTaskList",task:v,index:J,showDraggableHandle:!c.value,onCommentButtonClick:i[9]||(i[9]=F=>K(F,f.task.id)),onEditClick:i[10]||(i[10]=F=>d.value=F),onAddClick:i[11]||(i[11]=F=>N(F)),onEmployeeAssignClick:i[12]||(i[12]=F=>W(F)),class:"!border-0 shadow hover:shadow-md"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):g.value!=="loading"?(s(),o("div",_s," No tasks found. ")):n("",!0),g.value==="loading"?(s(),D(Ie,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):n("",!0)]),$($e,{show:_.value,"commentable-id":C.value,"commentable-type":"task","user-id":As,"on-close":X,onSubmitted:y(w).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{tl as default};
