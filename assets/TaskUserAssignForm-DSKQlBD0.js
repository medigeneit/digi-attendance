import{x as E,f as F,o,i as V,n as k,a as s,q as Z,Q as ee,c as i,g as x,w as R,d as se,r as _,e as L,t as S,k as $,F as P,y as te,h as W,v as H}from"./index-C6kSuS6n.js";import{g as Q}from"./datetime-Gf8VFxwP.js";import{u as le}from"./user-CzAarg7n.js";import{u as ae}from"./useTaskStore-CriUQ4IQ.js";import{L as oe}from"./LoaderView-CW2AWKb5.js";import{T as re}from"./TextWithHr-B7ZFjIUI.js";import{_ as ne,a as ie}from"./TaskUrgencyInput-ipT8tIIx.js";import{_ as ue}from"./DraggableList.vue_vue_type_script_setup_true_lang-4lpXLueF.js";import{S as de}from"./SelectDropdown-DJ6ZHnTw.js";import{_ as Y}from"./UserChip-D599-Zsm.js";import{_ as me}from"./TaskUserChip-DJCSdo1O.js";const pe={class:"w-full"},ce=["onClick"],ve={key:2,class:"btn-icon size-6 bg-blue-200 text-blue-800 border-blue-300"},fe={key:3,class:"btn-icon size-8 ml-auto bg-blue-200 text-blue-800 border-blue-300"},G={__name:"TaskAssignEmployeeInput",props:{modelValue:{type:Array,default:()=>[]},employees:{type:Array,required:!0},listType:{type:String,default:"employee"},placeholder:{type:String,default:""},isRemovable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(T,{emit:A}){const w=T,g=A,U=E({get(){return w.modelValue},set(m){g("update:modelValue",m)}});function d(m){U.value=[...m],console.log({newList:m})}function b(){return w.listType==="supervisor"}function v(m){return w.listType==="employee"&&m===0}return(m,n)=>(o(),F(de,{modelValue:U.value,"onUpdate:modelValue":n[0]||(n[0]=f=>U.value=f),options:T.employees,placeholder:T.placeholder,class:"border-gray-300 bg-sky-50/10 !rounded-2xl shadow-sm",multiple:"","hide-selected-value":""},{"selected-options":V(({items:f,removeItem:t,getOption:l})=>[s("div",pe,[k(ue,{items:f||[],handle:"handle",class:"flex flex-col gap-x-4 gap-y-2 w-full",onItemsUpdate:d},{item:V(({item:h,index:c})=>[k(Y,{user:l(h),isRemovable:c>0,isSortable:c>0,"avatar-size":v(c)?"medium":"small","avatar-class":["transition"],class:Z(["w-full flex bg-sky-100/40 !shadow-sm border-sky-200 "]),onRemoveClick:()=>t(h),onClick:C=>v(c)?C.stopPropagation():null},ee({after:V(()=>[!v(c)||b()?(o(),i("button",{key:0,class:"btn-icon size-6 ml-auto font-bold text-base text-red-600/60 hover:text-red-600 border border-red-200 flex items-center justify-center",onClick:R(C=>t(h),["prevent","stop"])},n[2]||(n[2]=[s("i",{class:"fas fa-times"},null,-1)]),8,ce)):x("",!0),f.length>1&&!v(c)&&!b()?(o(),i("button",{key:1,type:"button",class:"btn-icon size-6 handle text-gray-500 hover:text-gray-800",onClick:R(()=>null,["stop"])},n[3]||(n[3]=[s("i",{class:"fas fa-arrows"},null,-1)]))):x("",!0),b()?(o(),i("div",ve,n[4]||(n[4]=[s("i",{class:"fas fa-user-cowboy text-base"},null,-1)]))):v(c)?(o(),i("div",fe,n[5]||(n[5]=[s("i",{class:"fas fa-user-crown text-xl"},null,-1)]))):x("",!0)]),_:2},[v(c)?{name:"title-bottom",fn:V(()=>[n[1]||(n[1]=s("span",{class:"text-xs italic text-gray-400"},"Responsible for Task",-1))]),key:"0"}:void 0]),1032,["user","isRemovable","isSortable","avatar-size","onRemoveClick","onClick"])]),_:2},1032,["items"])])]),option:V(({option:f})=>[k(Y,{user:f,class:"w-full border-gray-300"},null,8,["user"])]),_:1},8,["modelValue","options","placeholder"]))}},ye={class:"bg-white z-20 sticky top-0 -mx-4 px-4"},ge={class:"col-span-full mb-2 font-semibold text-gray-800 text-sm line-clamp-3 mb-4"},be={class:"min-h-[150px]"},_e={key:1,class:"grid grid-cols-4 gap-8 mb-4 items-stretch"},xe={class:"col-span-2 flex flex-col"},ke={key:0,class:"mb-4"},we={class:"text-base"},he={key:2,class:"flex gap-x-3 gap-y-4 flex-wrap border p-2 rounded items-center flex-grow justify-center"},Se={key:1,class:"text-center w-full text-sm text-gray-400 py-2"},Ve={class:"col-span-2 w-full flex flex-col"},Te={key:0,class:"mb-4"},Ue={class:"text-base"},Ce={class:"flex items-end col-span-full md:col-span-2 gap-4"},$e={class:"w-1/2"},Fe={class:"w-1/2"},Ae={class:"block text-gray-600 text-sm mb-1 font-medium"},Ee={class:"bg-white border-t px-4 -mx-4 py-4 sticky bottom-0"},Re={key:0,class:"mb-4 text-red-500 font-medium"},ze={key:1,class:"mb-4 text-blue-500 font-medium"},Me={class:"flex justify-between items-center gap-4"},Be=["disabled"],Ye={__name:"TaskUserAssignForm",props:{taskId:{type:[Number,String],required:!0}},emits:["success","cancelClick"],setup(T,{emit:A}){var z;const w=ae(),g=se(),U=_([]),d=_(""),b=_(null),v=_([]),m=_([]),n=T,f=le(),t=_(null),l=_(((z=g.user)==null?void 0:z.role)=="employee"?{}:{is_important:!1,is_urgent:!1,is_target:!1,assigned_at:"",deadline:""}),h=A;L(async()=>{var e,u,p;d.value="loading";const a=await w.fetchTask(n.taskId,{with_parent:"true",with_department_users:"true"},{loadingBeforeFetch:!1,fetchOnly:!0});t.value=a.task,v.value=(e=t.value)!=null&&e.parent?(u=t.value.parent)==null?void 0:u.users:(a==null?void 0:a.to_department_users)||[],K(t.value),U.value=t.value.users,m.value=((p=t.value)==null?void 0:p.supervisors)||[],d.value=""});const c=E(()=>{var a,e;return[...v.value,...(e=(a=t.value)==null?void 0:a.users)!=null&&e.length?[...t.value.users]:[]]}),C=E(()=>{var e,u,p,y;return[...(e=t.value)!=null&&e.parent?(u=t.value.parent)==null?void 0:u.supervisors:f.users,...(y=(p=t.value)==null?void 0:p.supervisors)!=null&&y.length?[...t.value.supervisors]:[]]}),J=async()=>{var a,e;d.value="submitting",b.value=null;try{await w.updateTask(n.taskId,l.value,{loadingBeforeFetch:!1}),h("success")}catch(u){b.value=((e=(a=u.response)==null?void 0:a.data)==null?void 0:e.message)||"Assign users failed"}finally{d.value=""}};function K(a){var e,u,p;l.value=((e=g.user)==null?void 0:e.role)=="employee"?{}:{is_important:a.is_important,is_urgent:a.is_urgent,is_target:a.is_target,assigned_at:Q(a.assigned_at),deadline:Q(a.deadline),user_ids:(u=t.value.users)==null?void 0:u.map(y=>y.id),supervisor_ids:(p=t.value.supervisors)==null?void 0:p.map(y=>y.id)}}const X=_();return L(async()=>{await f.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"})}),(a,e)=>{var u,p,y,M,B,I,N,D,O,j,q;return o(),i("div",{class:"px-4 rounded border max-h-[98vh] overflow-auto",ref_key:"taskFormContainerRef",ref:X},[s("div",ye,[e[8]||(e[8]=s("h2",{class:"text-xl font-semibold text-gray-800 mb-1 mt-4"},"Manage Employee(s) for Task",-1)),e[9]||(e[9]=s("hr",{class:"mb-4 !mt-0"},null,-1)),s("h3",ge,S((u=t.value)==null?void 0:u.title),1)]),s("form",{onSubmit:R(J,["prevent"]),class:"relative min-h-40"},[s("div",be,[d.value==="loading"?(o(),F(oe,{key:0,class:"absolute inset-0 border-0 shadow-none"})):(o(),i("div",_e,[s("div",xe,[(p=t.value)!=null&&p.from_department?(o(),i("div",ke,[e[10]||(e[10]=s("div",{class:"text-sm text-gray-500"},"Task From Department",-1)),s("div",we,S((M=(y=t.value)==null?void 0:y.from_department)==null?void 0:M.name),1)])):x("",!0),e[11]||(e[11]=s("label",{class:"block uppercase text-xs text-gray-600"}," Supervisors ",-1)),((I=(B=$(g))==null?void 0:B.user)==null?void 0:I.role)!=="employee"&&$(g).isAdminMood?(o(),F(G,{key:1,employees:C.value,"list-type":"supervisor",isRemovable:!0,modelValue:l.value.supervisor_ids,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value.supervisor_ids=r),class:"flex-grow",placeholder:"--No Supervisor assigned--"},null,8,["employees","modelValue"])):(o(),i("div",he,[(m.value||[]).length>0?(o(!0),i(P,{key:0},te(m.value,r=>(o(),F(me,{key:r.id,user:r},null,8,["user"]))),128)):(o(),i("div",Se," No Supervisor assigned "))]))]),s("div",Ve,[(N=t.value)!=null&&N.to_department?(o(),i("div",Te,[e[12]||(e[12]=s("div",{class:"text-sm text-gray-500"},"Task To Department",-1)),s("div",Ue,S((O=(D=t.value)==null?void 0:D.to_department)==null?void 0:O.name),1)])):x("",!0),e[13]||(e[13]=s("label",{class:"block uppercase text-xs text-gray-600"}," Employees ",-1)),k(G,{employees:c.value,modelValue:l.value.user_ids,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value.user_ids=r),class:"flex-grow",placeholder:"--No employee(s) assigned--"},null,8,["employees","modelValue"])]),((q=(j=$(g))==null?void 0:j.user)==null?void 0:q.role)!=="employee"&&$(g).isAdminMood?(o(),i(P,{key:0},[k(re,{class:"col-span-full"},{default:V(()=>e[14]||(e[14]=[s("div",{class:"px-2"},[s("b",{class:"fas fa-cog text-gray-400"}),s("span",{class:"text-gray-700 ml-2"},"Task Settings for Employee")],-1)])),_:1,__:[14]}),k(ne,{class:"col-span-full",isImportant:l.value.is_important,"onUpdate:isImportant":e[2]||(e[2]=r=>l.value.is_important=r),isUrgent:l.value.is_urgent,"onUpdate:isUrgent":e[3]||(e[3]=r=>l.value.is_urgent=r)},null,8,["isImportant","isUrgent"]),k(ie,{modelValue:l.value.is_target,"onUpdate:modelValue":e[4]||(e[4]=r=>l.value.is_target=r),class:"col-span-full md:col-span-2 mt-4"},null,8,["modelValue"]),s("div",Ce,[s("div",$e,[e[15]||(e[15]=s("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Assign Date",-1)),W(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>l.value.assigned_at=r),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[H,l.value.assigned_at]])]),s("div",Fe,[s("label",Ae,S(l.value.is_target?"Target":"")+" Deadline",1),W(s("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>l.value.deadline=r),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[H,l.value.deadline]])])])],64)):x("",!0)]))]),s("div",Ee,[b.value?(o(),i("div",Re,S(b.value),1)):x("",!0),d.value=="submitting"?(o(),i("div",ze," Saving changes... ")):x("",!0),s("div",Me,[s("button",{type:"button",onClick:e[7]||(e[7]=r=>h("cancelClick")),class:"btn-3"},"Cancel"),s("button",{disabled:d.value=="submitting"||d.value=="loading",type:"submit",class:"btn-2"},S(d.value=="submitting"?"Saving...":"Save"),9,Be)])])],32)],512)}}};export{Ye as _};
