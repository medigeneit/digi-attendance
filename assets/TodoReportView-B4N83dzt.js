import{r as oe,G as se,x as I,q as A,c as l,o as s,a as t,N as te,w as le,s as S,d as P,k as ae,v as ne,f as be,u as fe,D as re,h as xe,j as h,i as we,l as F,m as M,t as u,b as de,F as k,e as z,M as ve}from"./index-5sfQtKXK.js";import{L as De}from"./LoaderView-WT8NzL3b.js";import{_ as _e}from"./EmployeeFilter-L8T5ugpy.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as he,b as U}from"./datetime-BEfC2TVK.js";import{u as ke}from"./company-coK1D-nH.js";import{u as Se}from"./department-DoYrNQKB.js";import{u as Te}from"./useTodoDateStore-1-28Dglw.js";import"./EmployeeDropdownInput-TRJhEtqQ.js";import"./SelectDropdown-suQzm2-T.js";import"./UserChip-B9DX_38p.js";import"./url-CePbr-gY.js";const $e={class:"px-4 py-4 md:py-3 bg-white rounded-md border"},Ce={class:"flex flex-wrap items-center gap-3"},Ne=["disabled"],Re={class:"print-hide"},Ee={class:"flex flex-col md:flex-row flex-wrap items-end md:ml-auto w-full md:w-auto gap-x-3 gap-y-4 print-hide"},Ae={class:"flex items-center justify-between w-full md:w-auto gap-3"},Le={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Me={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Ue={__name:"TodoReportHeading",props:{loading:{type:Boolean,default:!1},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},employeeId:{type:[String,Number],default:""},lineType:{type:String,default:"all"},startDate:{type:String,default:""},endDate:{type:String,default:""}},emits:["reloadClick","change"],setup(T,{expose:g,emit:V}){const r=T,D=oe(null),$=V,d=se({companyId:String(r.companyId||""),departmentId:r.departmentId!==""&&r.departmentId!=null?String(r.departmentId):"",employeeId:String(r.employeeId||""),lineType:r.lineType||"all",startDate:r.startDate||"",endDate:r.endDate||""}),C=I(()=>({companyId:d.companyId,departmentId:d.departmentId,employeeId:d.employeeId,lineType:d.lineType,startDate:d.startDate,endDate:d.endDate}));function L(){$("change",{...C.value})}return A(()=>[r.companyId,r.departmentId,r.employeeId,r.lineType,r.startDate,r.endDate],()=>{d.companyId=String(r.companyId||""),d.departmentId=r.departmentId!==""&&r.departmentId!=null?String(r.departmentId):"",d.employeeId=String(r.employeeId||""),d.lineType=r.lineType||"all",d.startDate=r.startDate||"",d.endDate=r.endDate||""}),A(C,L,{deep:!0}),g({employees:I(()=>{var x;return((x=D.value)==null?void 0:x.employees)||[]})}),(x,e)=>(s(),l("div",$e,[t("div",Ce,[te(x.$slots,"before",{},void 0,!0),t("button",{class:S(["btn-icon print-hide",{"animate-spin !bg-opacity-0":T.loading}]),onClick:e[0]||(e[0]=le(m=>$("reloadClick"),["prevent"])),disabled:T.loading,title:"Reload"},[t("i",{class:S(["fas fa-redo",[T.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,Ne),t("span",Re,[te(x.$slots,"after",{},void 0,!0)]),t("div",Ee,[P(_e,{ref_key:"employeeFilterRef",ref:D,company_id:d.companyId,"onUpdate:company_id":e[1]||(e[1]=m=>d.companyId=m),department_id:d.departmentId,"onUpdate:department_id":e[2]||(e[2]=m=>d.departmentId=m),employee_id:d.employeeId,"onUpdate:employee_id":e[3]||(e[3]=m=>d.employeeId=m),line_type:d.lineType,"onUpdate:line_type":e[4]||(e[4]=m=>d.lineType=m),"with-type":!0,class:"flex-1 gap-y-4 md:flex items-center justify-between w-full md:w-auto"},null,8,["company_id","department_id","employee_id","line_type"]),t("div",Ae,[t("div",Le,[e[7]||(e[7]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Start Date",-1)),ae(t("input",{type:"date","onUpdate:modelValue":e[5]||(e[5]=m=>d.startDate=m),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ne,d.startDate]])]),t("div",Me,[e[8]||(e[8]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"End Date",-1)),ae(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=m=>d.endDate=m),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ne,d.endDate]])])])])])]))}},Ve=Ie(Ue,[["__scopeId","data-v-1bffbf10"]]),Be={class:"container print:flex-grow mx-auto print:w-full px-4 py-6 print:px-0 print:py-0"},Oe=["disabled"],Fe={key:0,class:"bg-white border rounded-md mb-2 p-4 text-sm print:border-0 print:mb-2 print:px-0 print:w-full"},ze={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-y-2 gap-x-6"},Pe={class:"font-medium text-gray-800"},je={class:"col-span-2"},He={class:"font-medium text-gray-800"},Je={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Ke={key:3,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Qe={key:4,class:"overflow-x-auto md:overflow-clip bg-white border border-t-0 rounded-md shadow-sm print:shadow-none print:rounded-none print:border-gray-400"},We={class:"min-w-full text-left text-sm border-separate border-spacing-0"},Ye={class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},Xe={class:"border-y print:border-gray-400 sticky md:top-[58px] z-30 rounded-t-md"},Ze={key:0,class:"px-4 py-3 border bg-white bg-opacity-70 backdrop-blur-sm text-center"},Ge={class:"divide-y divide-gray-200"},qe=["rowspan"],et={class:"sticky top-[116px] bg-white text-center"},tt=["rowspan"],at={class:"sticky top-[116px] bg-white flex"},nt={key:0,class:"text-xs text-gray-500"},rt=["colspan"],dt=["rowspan"],ot={class:"sticky top-[116px] bg-white"},st={class:"px-4 py-3 text-gray-800 border-l border-t"},lt={class:"font-medium"},it={class:"text-gray-400 mr-2"},pt={class:"text-xs text-gray-500"},mt={class:"px-4 py-3 border-l border-t border-r text-center"},ht={__name:"TodoReportView",setup(T){var j,H,J,K,Q,W;const g=be(),V=fe(),r=Te(),D=ke(),$=Se(),{companies:d}=re(D),{departments:C}=re($),L=oe(null),x=he(new Date),e=se({companyId:((j=g.query)==null?void 0:j.company_id)||"",departmentId:((H=g.query)==null?void 0:H.department_id)||"",employeeId:((J=g.query)==null?void 0:J.employee_id)||"",lineType:((K=g.query)==null?void 0:K.line_type)||"all",startDate:((Q=g.query)==null?void 0:Q.start_date)||x,endDate:((W=g.query)==null?void 0:W.end_date)||x}),m=I(()=>{var a;return[...((a=L.value)==null?void 0:a.employees)||[]].sort((n,i)=>{var c,y;return(((c=n.user)==null?void 0:c.name)||"").localeCompare(((y=i.user)==null?void 0:y.name)||"")}).map(n=>{const i=r.todo_dates.filter(p=>{var o;return String((o=p.user)==null?void 0:o.id)===String(n.id)}),c={};i.forEach(p=>{const o=p.date||"unknown-date";c[o]||(c[o]={date:o,todos:[]}),c[o].todos.push(p)});let y=Object.values(c).map(p=>({...p,rowSpan:p.todos.length})).sort((p,o)=>new Date(p.date)-new Date(o.date));y.length||(y=[{date:null,rowSpan:1,todos:[{id:`empty-${n.id}`,isPlaceholder:!0,title:""}]}]);const _=y.reduce((p,o)=>p+o.rowSpan,0);return{user:n,dates:y,rowSpan:Math.max(1,_)}})}),ie=I(()=>{if(!e.startDate||!e.endDate)return"";const a=U(e.startDate,{weekDay:"long"}),n=U(e.endDate,{weekDay:"long"});return`${a} ~ ${n}`}),pe=I(()=>D.employees||[]),me={all:"All Types",executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},w=I(()=>{var y,_,p,o,N,R,b,v;const a=e.companyId&&((y=d.value)!=null&&y.length)?(_=d.value.find(f=>String(f.id)===String(e.companyId)))==null?void 0:_.name:null,n=e.departmentId&&((p=C.value)!=null&&p.length)?(o=C.value.find(f=>String(f.id)===String(e.departmentId)))==null?void 0:o.name:null;let i=null;e.employeeId&&(i=((R=(N=pe.value)==null?void 0:N.find(f=>String(f.id)===String(e.employeeId)))==null?void 0:R.name)||((v=(b=m.value.find(f=>{var E;return String(((E=f.user)==null?void 0:E.id)||"")===String(e.employeeId)}))==null?void 0:b.user)==null?void 0:v.name)||null);const c=e.startDate===e.endDate&&e.startDate?U(e.startDate,{weekDay:"long"}):ie.value||"-";return{company:a||(e.companyId?`#${e.companyId}`:"All Companies"),department:n||(e.departmentId?`#${e.departmentId}`:"All Departments"),employee:i||(e.employeeId?`#${e.employeeId}`:"All Employees"),lineType:me[e.lineType]||e.lineType||"All Types",dateRange:c}}),ye=a=>a==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":a==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":a==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200";function ue(){V.replace({query:{...g.query,company_id:e.companyId||void 0,department_id:e.departmentId||void 0,employee_id:e.employeeId||void 0,line_type:e.lineType||void 0,start_date:e.startDate||void 0,end_date:e.endDate||void 0}})}async function B(){!e.companyId||!e.startDate||!e.endDate||await r.fetchTodoDates({"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate})}function ce(a){e.companyId=a.companyId||"",e.departmentId=a.departmentId||"",e.employeeId=a.employeeId||"",e.lineType=a.lineType||"all",e.startDate=a.startDate||"",e.endDate=a.endDate||""}function ge(){window.print()}const O=I(()=>e.startDate===e.endDate);return A(()=>e.companyId,a=>{a&&($.fetchDepartments(a),D.fetchEmployee(a))},{immediate:!0}),A(()=>({...e}),(a,n)=>{JSON.stringify(a)!==JSON.stringify(n)&&(ue(),B())},{deep:!0}),A(()=>g.query,a=>{e.companyId=(a==null?void 0:a.company_id)||e.companyId,e.departmentId=(a==null?void 0:a.department_id)||e.departmentId,e.employeeId=(a==null?void 0:a.employee_id)||e.employeeId,e.lineType=(a==null?void 0:a.line_type)||e.lineType,e.startDate=(a==null?void 0:a.start_date)||e.startDate,e.endDate=(a==null?void 0:a.end_date)||e.endDate}),xe(()=>{D.fetchCompanies({ignore_permission:!0}),B()}),(a,n)=>(s(),l("div",Be,[P(Ve,{ref_key:"headingRef",ref:L,"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate,loading:M(r).loading,class:"mb-4 print:px-0 print:py-0 print:mb-2 print:border-0 print:border-b print:border-gray-400 print:rounded-none print:w-full",onChange:ce,onReloadClick:B},{before:F(()=>n[0]||(n[0]=[t("div",null,[t("h1",{class:"text-xl font-semibold text-gray-800"},"Todo Report")],-1)])),after:F(()=>[t("button",{type:"button",class:"btn-icon print-hide disabled:opacity-35 cursor-pointer disabled:cursor-not-allowed",onClick:le(ge,["prevent"]),disabled:M(r).loading},n[1]||(n[1]=[t("i",{class:"fas fa-print"},null,-1)]),8,Oe)]),_:1},8,["company-id","department-id","employee-id","line-type","start-date","end-date","loading"]),e.companyId&&e.startDate&&e.endDate?(s(),l("div",Fe,[t("div",ze,[t("div",null,[n[2]||(n[2]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Company",-1)),t("div",Pe,u(w.value.company),1)]),t("div",null,[n[3]||(n[3]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Department",-1)),t("div",{class:S(["font-medium",[w.value.department=="All Departments"?"text-gray-400":"text-gray-800"]])},u(w.value.department),3)]),t("div",null,[n[4]||(n[4]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Line Type",-1)),t("div",{class:S(["font-medium",[w.value.lineType=="All Types"?"text-gray-400":"text-gray-800"]])},u(w.value.lineType),3)]),t("div",null,[n[5]||(n[5]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Employee",-1)),t("div",{class:S(["font-medium",[w.value.employee=="All Employees"?"text-gray-400":"text-gray-800"]])},u(w.value.employee),3)]),t("div",je,[n[6]||(n[6]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Date",-1)),t("div",He,u(w.value.dateRange),1)])])])):h("",!0),!e.companyId||!e.startDate||!e.endDate?(s(),l("div",Je,n[7]||(n[7]=[t("p",{class:"text-red-500"},"Select company and date range to view the report.",-1)]))):M(r).loading?(s(),we(De,{key:2},{default:F(()=>n[8]||(n[8]=[de("Loading report...")])),_:1,__:[8]})):m.value.length===0?(s(),l("div",Ke,n[9]||(n[9]=[t("div",null,[t("i",{class:"fas fa-tasks fa-2x text-gray-300 mb-2"})],-1),t("div",null,"No todos.",-1)]))):(s(),l("div",Qe,[t("table",We,[t("thead",Ye,[t("tr",Xe,[n[10]||(n[10]=t("th",{class:"px-4 py-3 border w-[10px] bg-white bg-opacity-70 backdrop-blur-sm rounded-tl-md print:rounded-tl-none text-center"}," sl ",-1)),n[11]||(n[11]=t("th",{class:"px-4 py-3 border md:w-[100px] print:w-auto print:border-l print:border-l-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center"}," Employee Name ",-1)),O.value?h("",!0):(s(),l("th",Ze," Date ")),n[12]||(n[12]=t("th",{class:"px-4 py-3 border bg-white text-center"},"Todo",-1)),n[13]||(n[13]=t("th",{class:"px-4 py-3 border print:border-r print:border-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center rounded-tr-md print:rounded-tr-none"}," Status ",-1))])]),t("tbody",Ge,[(s(!0),l(k,null,z(m.value,(i,c)=>{var y,_,p;return s(),l(k,{key:((y=i.user)==null?void 0:y.id)||(((p=(_=i.dates[0])==null?void 0:_.todos[0])==null?void 0:p.id)??Math.random())},[(s(!0),l(k,null,z(i.dates,(o,N)=>{var R;return s(),l(k,{key:`${((R=i.user)==null?void 0:R.id)||"u"}-${o.date}`},[(s(!0),l(k,null,z(o.todos,(b,v)=>{var f,E,Y,X,Z,G,q,ee;return s(),l("tr",{key:b.id||`${((f=i.user)==null?void 0:f.id)||"u"}-${o.date||"empty"}-${v}`,class:"border odd:bg-white even:bg-gray-50 hover:bg-gray-100"},[N===0&&v===0?(s(),l("td",{key:0,rowspan:i.rowSpan||1,class:"px-4 py-3 align-top font-bold text-xl text-gray-800 whitespace-nowrap border-l border-t bg-white"},[t("div",et,u(c+1),1)],8,qe)):h("",!0),N===0&&v===0?(s(),l("td",{key:1,rowspan:i.rowSpan||1,class:"px-4 py-3 align-top font-medium text-gray-800 whitespace-nowrap border-l border-t bg-white"},[t("div",at,[P(ve,{size:"medium",user:i.user,class:"inline-block mr-2 align-middle"},null,8,["user"]),t("div",null,[t("div",null,u(((E=i.user)==null?void 0:E.name)||"Unknown user"),1),(X=(Y=i.user)==null?void 0:Y.department)!=null&&X.name?(s(),l("div",nt,u((G=(Z=i.user)==null?void 0:Z.department)==null?void 0:G.name),1)):h("",!0)])])],8,tt)):h("",!0),b.isPlaceholder?(s(),l("td",{key:2,class:"border-l border-t border-r bg-white px-4 py-3 text-center",colspan:O.value?2:3},n[14]||(n[14]=[t("div",{class:"text-red-400"},[t("i",{class:"fas fa-tasks text-red-200 mb-2 mr-1"}),t("span",null,"No todos found for this user. ")],-1)]),8,rt)):(s(),l(k,{key:3},[v===0&&!O.value?(s(),l("td",{key:0,rowspan:o.rowSpan||1,class:"px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap border-l border-t bg-white"},[t("div",ot,u(M(U)(o.date)||o.date||"-"),1)],8,dt)):h("",!0),t("td",st,[t("div",lt,[t("span",it,u(v+1)+".",1),de(" "+u(b.title),1)]),t("div",pt,u(((q=b.todoable)==null?void 0:q.title)||((ee=b.todoable_type)==null?void 0:ee.split("\\").pop())||""),1)]),t("td",mt,[t("span",{class:S(["text-xs font-semibold px-2.5 py-1 rounded-full",ye(b.status)])},u(b.status||"N/A"),3)])],64))])}),128))],64)}),128))],64)}),128))])])]))]))}};export{ht as default};
