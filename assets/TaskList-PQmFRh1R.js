import{_ as ne}from"./CommentModal-ClDfr5BY.js";import{u as re,O as J,_ as ie}from"./task-priority-1rba5vfF.js";import{L as ue}from"./LoaderView-DUd6okPN.js";import{_ as Q,a as de}from"./TaskAddForm-BGOxg12o.js";import{_ as me}from"./TaskEditForm-DSFPEjpf.js";import{b as te,q as f,s as pe,e as se,A as le,k as ce,c as m,o as a,a as t,f as w,w as z,m as S,h as l,p as h,l as C,g as E,C as ye,D as W,v as X,n as Z,y as G,F as D,x as K,u as fe,r as U,E as ke,t as ee}from"./index-l4XLehSa.js";import{_ as ve}from"./MultiselectDropdown-D4e9i3Ts.js";import{u as be}from"./company-B9N2F3U6.js";import{_ as ae}from"./UserChip-CNtu4BR2.js";import{_ as oe}from"./TaskTreeView-ej6p1CoW.js";import{u as ge}from"./useTaskStore-O-jO3i0p.js";import"./useCommentStore-DiFszZY6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-BdcHKc7v.js";import"./useRequirementStore-BtNTC4M5.js";import"./SectionLoading-Bh_eeVO2.js";import"./vue-multiselect.esm-BoJvfMpc.js";import"./datetime-BISRKKpq.js";const xe={class:"mb-3 task-header"},we={class:"flex justify-between items-start mb-4"},Te={class:"ml-auto flex gap-6 items-center"},Ce={key:0,class:"flex gap-2 items-center"},_e={class:"flex flex-wrap items-center gap-2 mt-3"},Ve={class:"flex flex-wrap gap-4 w-full"},Ie={key:2,class:"relative w-full md:w-72"},Le={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},qe={class:"text-gray-600 w-40 relative"},he={class:"flex gap-4 items-center flex-shrink-0"},Se={class:"flex gap-2"},Ae={class:"flex gap-2"},Ue={class:"flex gap-2"},$e={class:"text-gray-600 w-full md:w-40 relative"},Ee={class:"flex mb-4 items-end mt-5"},De={class:"text-gray-600 w-full md:w-64 lg:w-96 md:ml-auto relative"},Me={class:"w-full flex justify-end gap-5 mb-1"},Pe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(M,{emit:c}){const r=M,u=te(),I=f(b("from-department-id")),g=f(b("to-department-id")),L=f(b("user-ids")),n=f(b("month")),i=f(b("status")),d=f(b("is-important")),k=f(b("is-urgent")),v=f(b("is-target")),_=f(R()),A=c,T=be(),{employees:V}=pe(T);function b(s){return{get:()=>r.modelValue[s]||"",set:e=>{A("update:modelValue",{...r.modelValue,[s]:e||void 0})}}}function R(){let s=0;const e=x=>{A("update:modelValue",{...r.modelValue,search:x||void 0})};return{get:()=>r.modelValue.search||"",set:x=>{clearTimeout(s),s=setTimeout(e,500,x)}}}const N=f(()=>j(L.value));async function F(s){s&&await T.fetchEmployee(s)}async function H(){if(g.value){const s=T.companies.find(e=>e.departments.some(x=>x.id==g.value));await T.fetchEmployee(s.id)}}se(async()=>{var s,e;await T.fetchCompanies({with:"departments",ignore_permission:!0}),(s=r.modelValue)!=null&&s["company-id"]&&await F((e=r.modelValue)==null?void 0:e["company-id"])});function j(s){return Array.isArray(V.value)&&V.value.find(e=>e.id==s)||null}function O(s){L.value=(s==null?void 0:s.id)||""}function y(){L.value=""}return le(()=>g.value,H),(s,e)=>{var P,p,$,q,Y;const x=ce("RouterLink");return a(),m(D,null,[t("div",xe,[t("div",we,[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none"},"Task List",-1)),t("div",Te,[M.listHasRearranged?(a(),m("div",Ce,[e[11]||(e[11]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=z(o=>A("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=z(o=>A("clickPriorityDiscard"),["prevent"]))},"Discard")])):w("",!0),t("button",{onClick:e[2]||(e[2]=o=>A("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",_e,[t("div",Ve,[l(u).name!=="MyTaskList"?(a(),S(Q,{key:0,modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=o=>I.value=o),companies:((P=l(T))==null?void 0:P.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:h(()=>e[13]||(e[13]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"])):w("",!0),l(u).name!=="MyTaskList"?(a(),S(Q,{key:1,modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=o=>g.value=o),companies:((p=l(T))==null?void 0:p.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:h(()=>e[14]||(e[14]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):w("",!0),l(u).name!=="MyTaskList"?(a(),m("div",Ie,[C(ve,{modelValue:N.value,onSelect:O,onRemove:y,options:l(V),multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full"},{option:h(({option:o})=>[C(ae,{user:o,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),N.value?(a(),m("div",Le,[t("button",{onClick:z(y,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):w("",!0),e[15]||(e[15]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):w("",!0),t("div",qe,[e[17]||(e[17]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),E(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>i.value=o),class:"input-1"},e[16]||(e[16]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[ye,i.value]])]),t("div",he,[t("label",Se,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=o=>d.value=o)},null,512),[[W,d.value]]),e[18]||(e[18]=t("span",null,"Important",-1))]),t("label",Ae,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=o=>k.value=o)},null,512),[[W,k.value]]),e[19]||(e[19]=t("span",null,"Urgent",-1))]),t("label",Ue,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=o=>v.value=o)},null,512),[[W,v.value]]),e[20]||(e[20]=t("span",null,"Is Target",-1))])]),t("div",$e,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),E(t("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=o=>n.value=o),type:"month",class:"input-1",placeholder:"All month"},null,512),[[X,n.value]])])])])]),t("div",Ee,[t("div",De,[e[22]||(e[22]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),E(t("input",{id:"search","onUpdate:modelValue":e[10]||(e[10]=o=>_.value=o),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[X,_.value]]),e[23]||(e[23]=t("i",{class:"fas fa-search absolute right-2 top-[50%] translate-y-[-50%]"},null,-1))]),t("div",Me,[l(u).name!=="MyTaskList"?(a(),S(x,{key:0,class:G(["text-sm btn-3 py-0.5",(($=l(u).query)==null?void 0:$.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...l(u).query,view:"userwise"}}},{default:h(()=>e[24]||(e[24]=[Z(" User Wise List ")])),_:1,__:[24]},8,["class","to"])):w("",!0),l(u).name!=="MyTaskList"?(a(),S(x,{key:1,class:G(["text-sm btn-3 py-0.5",((q=l(u).query)==null?void 0:q.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((Y=l(u))==null?void 0:Y.query)||{}).filter(o=>{var B;return((B=l(u))==null?void 0:B.query[o])!=="userwise"}).reduce((o,B)=>({...o,[B]:l(u).query[B]}),{})}}},{default:h(()=>e[25]||(e[25]=[Z(" TaskWise List ")])),_:1,__:[25]},8,["class","to"])):w("",!0)])])],64)}}},Be={class:"w-full bg-white rounded"},Re=["rowspan"],Ne={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(M,{emit:c}){const r=M,u=c,I=f(()=>r.tasks.reduce((n,i)=>(n.push(...i.users.filter(d=>!n.find(k=>k.id==d.id&&d.id))),n),[]).filter(n=>r.selectedUserId?n.id==r.selectedUserId:!0)),g=n=>r.tasks.filter(k=>k.users.some(v=>v.id===n)),L=f(()=>I.value.map(n=>{const i=g(n.id);return{...n,tasks:i}}));return(n,i)=>(a(),m("div",null,[t("table",Be,[t("tbody",null,[(a(!0),m(D,null,K(L.value,d=>(a(),m(D,{key:d.id},[(a(!0),m(D,null,K(d.tasks,(k,v)=>(a(),m("tr",{key:k.id},[v==0?(a(),m("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(d.tasks.length,1)},[C(ae,{user:d,class:"sticky top-[80px]"},null,8,["user"])],8,Re)):w("",!0),t("td",{class:G(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":v==0,"border-b":d.tasks.length-1===v}])},[C(oe,{task:k,class:"!border-0 my-0",index:v,onCommentButtonClick:i[0]||(i[0]=_=>u("commentButtonClick",n.item.id)),onEditClick:i[1]||(i[1]=_=>u("editClick",_)),onAddClick:i[2]||(i[2]=_=>u("addClick",_))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Fe={class:"container mx-auto p-6 mt-2 relative bg-white rounded-md shadow-md"},Oe={class:"mb-4"},He={key:3},je={key:0,class:"text-center py-4 text-red-500"},ze={key:1},We={class:"flex items-stretched"},Ge={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Ke=1,ct={__name:"TaskList",setup(M){const c=ge(),r=te(),u=fe(),I=U(!1),g=U(null),L=U(!1),n=U(null),i=U(!1),d=ke({parentId:0,requirementId:0}),k=U(null),v=U([]),{handleItemsPriorityUpdate:_,saveTaskPriority:A,listHasRearranged:T}=re(()=>c.taskListTree,0);se(async()=>{r.query.status||u.push({query:{...r.query,status:"not-completed"}}),await V()});async function V(){L.value=!!r.query["user-ids"];const y=await c.fetchTasks({...r.query},{newList:!0,loadingBeforeFetch:!0});v.value=y.query_log||[]}const b=y=>{i.value=!0,d.parentId=y},R=y=>{g.value=y,I.value=!0},N=()=>{I.value=!1,g.value=null};async function F(){n.value=null,i.value=!1,d.parentId=0,await V()}async function H(){i.value=!1,d.parentId=0,await V()}async function j(){A()&&await V()}le(()=>({...r.query}),async()=>{await V()});const O=f({get(){return{...r.query}},set(y){localStorage.removeItem("sub_task_opened_list"),u.push({query:{...y}})}});return(y,s)=>{var e,x,P;return a(),m("div",Fe,[n.value?(a(),S(J,{key:0},{default:h(()=>[C(me,{taskId:n.value,onClose:s[0]||(s[0]=p=>n.value=null),onUpdated:F},null,8,["taskId"])]),_:1})):w("",!0),i.value?(a(),S(J,{key:1},{default:h(()=>[C(de,{parentTaskId:d.parentId,requirementId:d.requirementId,onClose:H,onTaskCreated:F},null,8,["parentTaskId","requirementId"])]),_:1})):w("",!0),C(Pe,{modelValue:O.value,"onUpdate:modelValue":s[1]||(s[1]=p=>O.value=p),onClickAddTask:b,onClickPrioritySave:j,onClickPriorityDiscard:s[2]||(s[2]=()=>l(T)?k.value.resetItems:null),"list-has-rearranged":l(T),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((x=(e=l(r))==null?void 0:e.query)==null?void 0:x["query-log"])=="true"?(a(!0),m(D,{key:2},K(v.value,(p,$)=>(a(),m("div",{key:$,class:"text-xs text-gray-500"},[t("div",Oe,ee(p.raw_query),1)]))),128)):w("",!0),l(c).loading?(a(),m("div",He,[C(ue)])):(a(),m(D,{key:4},[l(c).error?(a(),m("div",je,ee(l(c).error),1)):l(c).tasks.length>0?(a(),m("div",ze,[((P=l(r).query)==null?void 0:P.view)=="userwise"?(a(),S(Ne,{key:0,tasks:l(c).tasks,selectedUserId:l(r).query["user-ids"],onCommentButtonClick:s[3]||(s[3]=p=>R(p,y.task.id)),onEditClick:s[4]||(s[4]=p=>n.value=p),onAddClick:s[5]||(s[5]=p=>b(p))},null,8,["tasks","selectedUserId"])):(a(),S(ie,{key:1,items:l(c).tasks,handle:"handle",onItemsUpdate:l(_),class:"space-y-4",ref_key:"draggableTaskList",ref:k},{item:h(({item:p,index:$})=>[t("div",We,[C(oe,{task:p,index:$,showDraggableHandle:!L.value,onCommentButtonClick:s[6]||(s[6]=q=>R(q,y.task.id)),onEditClick:s[7]||(s[7]=q=>n.value=q),onAddClick:s[8]||(s[8]=q=>b(q)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(a(),m("div",Ge," No tasks found. "))],64)),C(ne,{show:I.value,"commentable-id":g.value,"commentable-type":"task","user-id":Ke,"on-close":N,onSubmitted:l(c).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{ct as default};
