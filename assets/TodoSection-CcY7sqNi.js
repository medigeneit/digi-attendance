import{L as ee}from"./LoaderView-BOPiIUWG.js";import{r as R,x as z,e as Y,A as J,c as v,o as i,L as P,a as e,F as q,y as H,t as E,g,w as M,q as B,n as A,f as L,I as ve,i as N,k as C,d as ae,m as he,j as F,J as ne,K as xe,M as we,V as De,h as le,v as de,W as Q,X as Z}from"./index-W-8vDVy9.js";import{f as Ce,h as pe,b as ie,g as K,i as Te,j as $e}from"./datetime-DcVwRp76.js";import{a as te,u as X,f as Se,d as Ie,b as Me}from"./useTodoStore-CUZAia1B.js";import{_ as Ee}from"./DraggableList.vue_vue_type_script_setup_true_lang-DhIzC79e.js";import{_ as fe}from"./UserChip-Cd-hMJpK.js";import{O as oe}from"./OverlyModal-2IUwp5IT.js";import{u as Re}from"./useTaskStore-U0vvO3SO.js";const Oe={class:"grid grid-cols-7 *:text-center *:p-2 *:border-r *:border-b *:text-blue-800 *:text-sm"},Ne={class:"flex flex-col"},Le={key:0,class:"p-2 border-r border-t"},je={__name:"CalenderView",props:{month:{type:String,required:!0,validator:o=>/^\d{4}-(0[1-9]|1[0-2])$/.test(o)}},emits:["change"],setup(o,{emit:$}){const d=o,a=$,u=R(),s=R(),l=R(),p=R(),n=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function y(x,c,k,T){const w=[];for(let _=k-1;_>=0;_--){const j=T-_,U=new Date(x,c-1,j);w.push({date:U,day:U.getDate(),month:U.getMonth()+1,year:U.getFullYear(),isCurrentMonth:!1})}return w}function b(x,c,k){const T=[];for(let w=1;w<=k;w++){const j={date:new Date(x,c,w),day:w,month:c+1,year:x,isCurrentMonth:!0};T.push(j)}return T}function m(x,c,k){const T=[...x],w=Math.ceil(T.length/7)*7,_=1;for(let j=0;T.length<w;j++){const U=new Date(c,k+1,_+j);T.push({date:U,day:U.getDate(),month:U.getMonth()+1,year:U.getFullYear(),isCurrentMonth:!1})}return T}function t(x,c){const k=new Date(x,c,1),w=new Date(x,c+1,0).getDate(),j=(k.getDay()+1)%7,I=new Date(x,c,0).getDate();let r=[];r=[...y(x,c,j,I)];const D=b(x,c,w);return l.value=D[0],p.value=D[D.length-1],r=[...r,...D],r=[...m(r,x,c)],u.value=r[0],s.value=r[r.length-1],r}const h=z(()=>{const[x,c]=d.month.split("-"),k=parseInt(x),T=parseInt(c)-1;return console.log({yearStr:x,monthStr:c}),t(k,T)}),S=z(()=>{const x=h.value,c=[];for(let k=0;k<x.length;k+=7)c.push(x.slice(k,k+7));return c});function O(){a("change",{gridStartDate:u.value,gridEndDate:s.value,startOfMonth:l.value,endOfMonth:p.value})}return Y(()=>O()),J(()=>d.month,O),(x,c)=>(i(),v("div",null,[P(x.$slots,"calender-top"),e("div",Oe,[(i(),v(q,null,H(n,k=>e("div",{key:k},E(k),1)),64))]),e("div",Ne,[(i(!0),v(q,null,H(S.value,(k,T)=>(i(),v("div",{class:"week grid grid-cols-7 min-h-28 items-stretch",key:T},[(i(!0),v(q,null,H(k,(w,_)=>P(x.$slots,"date",{key:_,day:w.day,month:w.month,year:w.year,weekday:(w.date.getDay()+1)%7,isCurrentMonth:w.isCurrentMonth,yearMonthDate:`${w.year}-${String(w.month).padStart(2,"0")}-${String(w.day).padStart(2,"0")}`},()=>{var j;return[w!=null&&w.date?(i(),v("div",Le,E((j=w==null?void 0:w.date)==null?void 0:j.getDate()),1)):g("",!0)]})),128))]))),128))]),P(x.$slots,"calender-bottom")]))}},Ue={class:"px-4 py-2 flex items-center lg:justify-start flex-wrap bg-gray-50 group md:gap-x-2 gap-y-4"},Pe=["disabled"],Ae=["value"],_e=["value"],Fe={key:2,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},ze=["value"],qe={key:3,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},Be=["value"],We={__name:"TodoHeading",props:{selected:{type:Object,default:()=>({type:"month-view",month:"",day:"",year:"",week:""})},loading:{type:Boolean,default:!1}},emits:["reloadClick",,"change"],setup(o,{emit:$}){const d=o,a=[{value:"month-view",label:"Monthly"},{value:"day-view",label:"Daily"}],u=$,s=R();function l(c){s.value=c,u("change",{...d.selected,type:c})}J(()=>{var c;return(c=d.selected)==null?void 0:c.type},c=>l(c),{immediate:!0});const p=z(()=>s.value=="month-view"&&d.selected.year&&d.selected.month?[d.selected.year,d.selected.month-1,1]:s.value=="day-view"&&d.selected.year&&d.selected.month&&d.selected.day?[d.selected.year,d.selected.month-1,d.selected.day]:[new Date().getFullYear(),new Date().getMonth(),new Date().getDate()]);function n(){s.value=="month-view"&&S(new Date)}function y(){if(s.value=="month-view"){const c=new Date(...p.value);c.setMonth(c.getMonth()+1),S(c)}}function b(){if(s.value=="month-view"){const c=new Date(...p.value);c.setMonth(c.getMonth()-1),S(c)}}function m(){s.value=="day-view"&&S(new Date)}function t(){if(s.value=="day-view"){const c=new Date(...p.value);c.setDate(c.getDate()+1),S(c)}}function h(){if(s.value=="day-view"){const c=new Date(...p.value);c.setDate(c.getDate()-1),S(c)}}function S(c){u("change",{type:s.value,month:c.getMonth()+1,day:c.getDate(),year:c.getFullYear(),week:c.getDay()})}const O=z(()=>s.value=="month-view"?`${d.selected.year}-${d.selected.month.toString().padStart(2,"0")}`:s.value=="day-view"?`${d.selected.year}-${d.selected.month.toString().padStart(2,"0")}-${d.selected.day.toString().padStart(2,"0")}`:d.selected),x=c=>{var k,T;if(s.value=="month-view"){const[w,_]=(k=c.target.value)==null?void 0:k.split("-").map(Number),j=new Date(w,_-1,1);S(j)}if(s.value=="day-view"){const w=new Date((T=c.target)==null?void 0:T.value);S(w)}};return(c,k)=>(i(),v("div",null,[e("div",Ue,[P(c.$slots,"before",{selected:o.selected}),e("button",{class:B(["px-2 py-2 disabled:text-gray-300 border size-[32px] flex items-center justify-center rounded-full",{"animate-spin !bg-opacity-0":o.loading}]),onClick:k[0]||(k[0]=M(T=>u("reloadClick"),["prevent"])),disabled:o.loading},[e("i",{class:B(["fas fa-redo",[o.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,Pe),P(c.$slots,"typeSelection",{selected:o.selected,types:a,changeType:l},()=>[e("select",{class:"px-2 h-7 border rounded",value:s.value,onChange:k[1]||(k[1]=T=>l(T.target.value))},[(i(),v(q,null,H(a,T=>e("option",{value:T.value,key:T.id},E(T.label),9,_e)),64))],40,Ae)]),s.value=="month-view"?(i(),v("button",{key:0,class:"h-7",onClick:M(n,["prevent"])})):g("",!0),s.value=="day-view"?(i(),v("button",{key:1,class:"h-7",onClick:M(m,["prevent"])})):g("",!0),P(c.$slots,"inner",{selected:o.selected}),s.value=="month-view"?(i(),v("div",Fe,[e("button",{class:"btn-3 px-3 rounded h-7",onClick:M(b,["prevent"])},k[2]||(k[2]=[e("span",{class:"fas fa-arrow-left"},null,-1)])),s.value=="month-view"?(i(),v("input",{key:0,type:"month",value:O.value,onInput:x,class:"border-2 px-2 rounded border-blue-900"},null,40,ze)):g("",!0),e("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:M(y,["prevent"])},k[3]||(k[3]=[e("span",{class:"fas fa-arrow-right"},null,-1)]))])):g("",!0),s.value=="day-view"?(i(),v("div",qe,[e("button",{class:"btn-3 px-3 rounded h-7",onClick:M(h,["prevent"])},k[4]||(k[4]=[e("span",{class:"fas fa-arrow-left"},null,-1)])),s.value=="day-view"?(i(),v("input",{key:0,type:"date",value:O.value,onInput:x,class:"border-2 px-2 rounded border-blue-900 w-28"},null,40,Be)):g("",!0),e("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:M(t,["prevent"])},k[5]||(k[5]=[e("span",{class:"fas fa-arrow-right"},null,-1)]))])):g("",!0),P(c.$slots,"after",{selected:o.selected})]),P(c.$slots,"bottom",{selected:o.selected})]))}},Ve={key:0,class:"fa fa-exclamation-square",title:"Pending"},Ge={key:1,class:"fa fa-pause",title:"Working"},He={key:2,class:"fa fa-check-square",title:"Completed"},re={__name:"TodoStatusIcon",props:{todoDate:{type:Object,required:!0}},setup(o){const $=o,d=z(()=>{switch($.todoDate.status){case"PENDING":return"text-red-400";case"WORKING":return"text-yellow-600";case"COMPLETED":return"text-green-400"}return""});return(a,u)=>(i(),v("span",{class:B(d.value)},[o.todoDate.status=="PENDING"?(i(),v("i",Ve)):g("",!0),o.todoDate.status=="WORKING"?(i(),v("i",Ge)):g("",!0),o.todoDate.status=="COMPLETED"?(i(),v("i",He)):g("",!0)],2))}},Ke=["title","onClick"],Ye={class:"line-clamp-1"},Je={key:0,class:"text-purple-600 text-center"},ge={__name:"TodosInDate",props:{date:{type:String,required:!0},maxItems:{type:[Number,String],default:3}},emits:["clickTodo"],setup(o,{emit:$}){const d=o,a=$,{getTodoDatesByDate:u}=te(),s=z(()=>{let l=[],p=!1,n=[];if(typeof u=="function"){const y=u(d.date);if(n=Array.isArray(y)?y:[],d.maxItems==="all")return{all:n,items:n,moreItemsCount:0};l=n.slice(0,d.maxItems),p=n.length-l.length}return{all:n,items:l,moreItemsCount:p}});return(l,p)=>(i(),v("div",null,[s.value.items.length===0?P(l.$slots,"noTodos",{key:0},()=>[p[0]||(p[0]=e("div",{class:"text-gray-400 text-center"},"No todos",-1))]):(i(),v(q,{key:1},[P(l.$slots,"todoItems",{todos:s.value.items,allTodos:s.value.items,moreItemsCount:s.value.moreItemsCount},()=>[(i(!0),v(q,null,H(s.value.items,n=>P(l.$slots,"todoItem",{key:n.id,todoDate:n,moreItemsCount:s.value.moreItemsCount},()=>{var y,b,m,t;return[e("div",{title:`${n==null?void 0:n.title} ${n!=null&&n.user?`
by:`:""} ${(y=n==null?void 0:n.user)==null?void 0:y.name} ${(b=n==null?void 0:n.user)!=null&&b.department?`
DEPT:`:""} ${(t=(m=n.user)==null?void 0:m.department)==null?void 0:t.name}`,class:B(["px-1 mb-2 text-xs rounded cursor-pointer flex items-center gap-2",{"bg-sky-50 text-sky-900 hover:bg-sky-700 hover:text-white border border-sky-300":n.status!=="COMPLETED","bg-green-500 text-white":n.status==="COMPLETED"}]),onClick:M(h=>a("clickTodo",n),["prevent","stop"])},[A(re,{todoDate:n,class:B(["text-sm",[n.status=="COMPLETED"?"!text-white":""]])},null,8,["todoDate","class"]),e("div",Ye,E(n.title),1),n.user?(i(),L(ve,{key:0,user:n.user,size:"xsmall",class:"ml-auto"},null,8,["user"])):g("",!0)],10,Ke)]})),128))]),s.value.moreItemsCount>0?(i(),v("div",Je," + "+E(s.value.moreItemsCount)+" more todo"+E(s.value.moreItemsCount>1?"s":""),1)):g("",!0)],64))]))}},Xe={class:"relative"},Qe=["onClick","onKeypress"],Ze={class:"flex items-center justify-center"},et=["onClick"],tt={__name:"TodosInCalenderView",props:{month:{type:String,required:!0,validator:o=>/^\d{4}-(0[1-9]|1[0-2])$/.test(o)}},emits:["dateClick","clickTodo","clickDateCell"],setup(o,{emit:$}){const d=$;function a(s,l){s.isTrusted&&s.ctrlKey&&s.which==10&&d("dateClick",l)}function u(s){const[l,p,n]=String(s).split("-").map(Number),y=new Date(l,p-1,n);return pe(y)}return(s,l)=>(i(),v("div",Xe,[o.month?(i(),L(je,{key:0,month:o.month,class:"border-t border-blue-200/50 relative"},{date:N(({day:p,month:n,yearMonthDate:y,isCurrentMonth:b})=>[e("div",{tabindex:"0",class:B(["border p-4 cursor-pointer group/date relative focus:outline-slate-400",{"bg-sky-50   border-sky-300 focus:bg-sky-50 focus:outline-sky-400":u(y),"hover:bg-slate-50  hover:border-slate-300 focus:bg-slate-50 ":!u(y)}]),onClick:M(m=>d("dateClick",y),["prevent","stop"]),onKeypress:M(m=>a(m,y),["prevent"])},[e("button",{tabindex:"1",class:B([{"text-gray-300 hover:bg-sky-200  hover:text-white":!b,"text-sky-400 hover:bg-sky-200":b},"text-center mb-2 font-semibold w-full rounded"])},E(p)+" "+E(b?"":C(Ce)(n-1)),3),e("div",null,[A(ge,{date:y,onClickTodo:l[0]||(l[0]=m=>d("clickTodo",m))},{noTodos:N(()=>l[1]||(l[1]=[e("span",null,null,-1)])),_:2},1032,["date"])]),e("div",Ze,[e("button",{onClick:M(m=>d("clickDateCell",y),["prevent","stop"]),class:"btn-3 !py-1 invisible group-hover/date:visible text-sm text-red-800/40"},l[2]||(l[2]=[e("i",{class:"fas fa-plus"},null,-1),e("span",{class:"hidden lg:inline whitespace-nowrap"}," Add todo ",-1)]),8,et)])],42,Qe)]),_:1},8,["month"])):g("",!0)]))}},ot={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},be={__name:"DepartmentChip",props:{department:Object},setup(o){return($,d)=>{var a;return i(),v("div",ot,E((a=o.department)==null?void 0:a.name),1)}}},nt={class:""},st={key:0,class:"mt-1 flex items-center gap-2"},at={key:0,class:"line-clamp-2 text-gray-500 whitespace-nowrap mr-2"},lt={class:"md:ml-auto w-full md:w-auto flex items-center justify-center gap-2"},dt={key:0,class:"flex items-center gap-1 text-red-600"},it={__name:"TodoItemCard",props:{todoDate:{type:Object,required:!0},hideDepartment:{type:Boolean,default:!1},hideUser:{type:Boolean,default:!1},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","clickDelete","clickChangeStatus","clickDelete"],setup(o,{emit:$}){const d=ae(),a=$;return(u,s)=>{var p,n,y,b,m,t,h;const l=he("RouterLink");return i(),v("div",{class:B(["px-4 py-4 md:py-2 cursor-pointer flex flex-wrap items-center gap-y-2 gap-x-4 text-sm",{"bg-green-100":o.todoDate.status=="COMPLETED","hover:bg-gray-50":o.todoDate.status!="COMPLETED"}]),onClick:s[4]||(s[4]=M(S=>a("clickTodo",o.todoDate),["prevent"]))},[A(re,{todoDate:o.todoDate},null,8,["todoDate"]),e("div",nt,[e("div",{class:B(["line-clamp-1",{"text-green-800":o.todoDate.status=="COMPLETED","text-blue-800":o.todoDate.status!="COMPLETED"}])},E(o.todoDate.id)+" - "+E(o.todoDate.title),3),o.todoDate.user?(i(),v("div",st,[o.hideUser?g("",!0):(i(),L(fe,{key:0,user:o.todoDate.user,"avatar-size":"xsmall"},null,8,["user"])),o.hideDepartment?g("",!0):(i(),L(be,{key:1,department:(n=(p=o.todoDate)==null?void 0:p.user)==null?void 0:n.department},null,8,["department"]))])):g("",!0)]),(y=o.todoDate.todo)!=null&&y.todo_type&&((b=o.todoDate.todo)!=null&&b.todo_type_id)?(i(),v("div",at,[F(E((m=o.todoDate.todo)==null?void 0:m.todo_type)+" ",1),A(l,{class:"text-blue-600 font-semibold underline hover:text-sky-400",onClick:M(S=>null,["stop"]),to:{name:o.userRole=="employee"?"MyTaskShow":"TaskShow",params:{id:(t=o.todoDate.todo)==null?void 0:t.todo_type_id}}},{default:N(()=>{var S;return[s[5]||(s[5]=e("i",{class:"fas fa-link"},null,-1)),F(" "+E((S=o.todoDate.todo)==null?void 0:S.todo_type_id),1)]}),_:1,__:[5]},8,["to"])])):g("",!0),e("div",lt,[o.todoDate.status=="WORKING"?(i(),v("div",dt,s[6]||(s[6]=[e("span",{class:"fas fa-circle animate-pulse text-xs"},null,-1),e("span",{class:"text-xs"},"Working",-1)]))):g("",!0),o.todoDate.user_id===((h=C(d).user)==null?void 0:h.id)?(i(),v(q,{key:1},[o.todoDate.status==="WORKING"?(i(),v("button",{key:0,title:"Mark as Completed",class:"btn-icon bg-transparent text-green-400 border-green-400 border hover:bg-green-400 hover:text-white",onClick:s[0]||(s[0]=M(()=>a("clickChangeStatus",o.todoDate,"COMPLETED"),["prevent","stop"]))},s[7]||(s[7]=[e("i",{class:"fas fa-check"},null,-1)]))):g("",!0),o.todoDate.status==="PENDING"?(i(),v("button",{key:1,title:"Start Working",class:"btn-icon bg-transparent text-red-400 border-red-400 border hover:bg-red-400 hover:text-white",onClick:s[1]||(s[1]=M(()=>a("clickChangeStatus",o.todoDate,"WORKING"),["prevent","stop"]))},s[8]||(s[8]=[e("i",{class:"fas fa-play ml-[4px]"},null,-1)]))):g("",!0),e("button",{class:"btn-icon bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:s[2]||(s[2]=M(S=>{var O;return a("clickEdit",(O=o.todoDate)==null?void 0:O.todo)},["prevent","stop"]))},s[9]||(s[9]=[e("i",{class:"fas fa-pen"},null,-1)])),e("button",{class:"btn-icon bg-red-400 text-white hover:bg-red-600 hover:text-white",onClick:s[3]||(s[3]=M(()=>a("clickDelete",o.todoDate),["prevent","stop"]))},s[10]||(s[10]=[e("i",{class:"fas fa-trash-alt"},null,-1)]))],64)):g("",!0),e("button",{onClick:M(()=>null,["stop","prevent"]),class:"btn-icon bg-gray-400 text-white hover:bg-gray-600 hover:text-white handle"},s[11]||(s[11]=[e("i",{class:"fas fa-arrows-alt-v"},null,-1)]))])],2)}}},rt={class:"border rounded-md"},ut={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},ct={class:"font-semibold flex items-center gap-2"},mt={class:"text-white text-base"},yt={class:"ml-auto flex items-center gap-2"},vt={key:0,class:"flex items-center gap-3 mr-6"},pt=["disabled"],ft=["disabled"],gt=["date"],bt={key:1,class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"},kt={__name:"UserTodos",props:{todosDates:{type:Array,required:!0},user:{type:Object,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","addCarryClick","update"],setup(o,{emit:$}){const d=o,a=R(null),u=$,s=X(),l=te();async function p(b){confirm(`Are your sure want to delete todo
'${b==null?void 0:b.title}'`)&&(await l.deleteTodoDate(b.id),u("update"))}async function n(b,m){confirm(`Are your sure?
want to change status to ${m} 
todo: '${b==null?void 0:b.title}'`)&&(await l.updateStatus(b.id,m),u("update"))}async function y(){var m;const b=(m=a==null?void 0:a.value.items)==null?void 0:m.map(t=>t.id);await s.rearrangeMyTodos(b,{date:d.date}),u("update")}return(b,m)=>{var t,h;return i(),v("div",rt,[e("div",ut,[e("div",ct,[A(ve,{user:o.user},null,8,["user"]),e("div",mt,E(o.user.label),1)]),e("div",yt,[(t=a.value)!=null&&t.isItemsChanged?(i(),v("div",vt,[e("button",{onClick:m[0]||(m[0]=M(()=>y(),["prevent"])),class:"btn-2 disabled:opacity-40 disabled:pointer-events-none",disabled:C(s).updatingPriority}," Save Rearranged ",8,pt),e("button",{onClick:m[1]||(m[1]=M(()=>a.value.resetItems(),["prevent"])),class:"btn-3 disabled:opacity-40 disabled:pointer-events-none",disabled:C(s).updatingPriority}," Discard ",8,ft)])):g("",!0),A(be,{department:(h=o.user)==null?void 0:h.department,class:"px-2"},null,8,["department"])])]),e("div",{date:b.date,"max-items":"all",class:"w-full"},[o.todosDates.length>0?(i(),L(Ee,{key:0,items:o.todosDates,ref_key:"draggableTodos",ref:a,handle:"handle"},{item:N(({item:S})=>[A(it,{todoDate:S,onClickTodo:O=>u("clickTodo",O),onClickEdit:O=>u("clickEdit",O),onClickDelete:O=>p(O),onClickChangeStatus:(O,x)=>n(O,x),"hide-department":"","hide-user":"",class:"border-b border-sky-200",userRole:o.userRole},null,8,["todoDate","onClickTodo","onClickEdit","onClickDelete","onClickChangeStatus","userRole"])]),_:1},8,["items"])):g("",!0),o.todosDates.length===0?(i(),v("div",bt," No Todos ")):g("",!0)],8,gt)])}}},ht={class:"relative bg-white p-4"},xt={key:0,class:"text-red-500 text-sm border border-red-300 max-w-6xl mx-auto py-2 gap-2 shadow-sm rounded flex items-center px-3"},wt={class:"max-w-6xl mx-auto border rounded my-5"},Dt={class:"text-gray-700 border-b py-2 px-4 flex items-center"},Ct={class:"text-lg font-semibold flex items-center gap-2"},Tt={key:0,class:"rounded-md border text-xs px-2 py-[1px] text-red-500 border-red-500 bg-red-50"},$t={key:0,class:"ml-auto flex items-center gap-2"},St={__name:"TodosInDailyView",props:{date:{type:String,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickAdd","clickEdit","addCarryClick","clickDelete","clickChangeStatus","backClick","update"],setup(o,{emit:$}){const d=o,a=$,u=ae(),s=X(),l=z(()=>new Date(d.date)),p=n=>{if(d.userRole=="employee")return[{...u.user,todos:n}];const y={};return n.forEach(b=>{const m=b.user.id;y[m]||(y[m]={...b.user,todos:[]}),y[m].todos.push(b)}),Object.values(y)};return(n,y)=>(i(),v("div",ht,[C(s).error?(i(),v("div",xt,[y[5]||(y[5]=e("i",{class:"fad fa-exclamation-circle"},null,-1)),e("div",null,E(C(s).error),1)])):g("",!0),e("div",wt,[e("div",Dt,[e("button",{class:"fa fa-arrow-left btn-icon mr-2",onClick:y[0]||(y[0]=M(b=>a("backClick"),["prevent"]))}),e("div",Ct,[F(E(C(ie)(l.value,{weekDay:"long"}))+" ",1),C(pe)(o.date)?(i(),v("span",Tt," Today ")):g("",!0)]),o.userRole=="employee"?(i(),v("div",$t,[e("button",{class:"btn btn-icon",onClick:y[1]||(y[1]=M(b=>a("clickAdd",d.date),["prevent"]))},y[6]||(y[6]=[e("i",{class:"fas fa-plus"},null,-1)]))])):g("",!0)]),A(ge,{date:o.date,"max-items":"all",class:"w-full space-y-4 p-2"},{todoItems:N(({allTodos:b})=>[(i(!0),v(q,null,H(p(b),m=>(i(),L(kt,{key:m.id,todosDates:(m==null?void 0:m.todos)||[],user:m,onClickTodo:y[2]||(y[2]=t=>a("clickTodo",t)),onClickEdit:y[3]||(y[3]=t=>a("clickEdit",t)),onUpdate:y[4]||(y[4]=t=>a("update")),"user-role":o.userRole},null,8,["todosDates","user","user-role"]))),128))]),noTodos:N(()=>y[7]||(y[7]=[e("div",{class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"}," No Todos ",-1)])),_:1},8,["date"])])]))}},It={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md"},Mt={key:0,class:"mb-4 text-red-500 font-medium"},Et={key:0,class:"mb-4 text-blue-500 font-medium"},Rt={class:"flex justify-between items-center gap-4"},Ot=["disabled"],ue={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(o,{emit:$}){const d=$;return(a,u)=>(i(),v("form",{onSubmit:u[1]||(u[1]=M(s=>d("submit"),["prevent"]))},[P(a.$slots,"default"),e("div",It,[P(a.$slots,"error",{},()=>[o.error?(i(),v("div",Mt,E(o.error),1)):g("",!0)]),o.isSubmitting?(i(),v("div",Et,"Saving changes...")):g("",!0),P(a.$slots,"footer",{},()=>[e("div",Rt,[e("button",{type:"button",onClick:u[0]||(u[0]=s=>d("clickCancel")),class:"btn-3"},"Cancel"),e("button",{disabled:o.isSubmitting||o.isLoading,type:"submit",class:"btn-2"},E(o.isSubmitting?"Saving...":"Save"),9,Ot)])])])],32))}},Nt={class:"px-2 border-b py-3 over text-sm relative"},Lt={class:"flex items-center py-1"},se={__name:"TodoInputTaskItem",props:{task:Object,level:Number,selected:Number},emits:["select"],setup(o,{emit:$}){const d=$;return(a,u)=>{var s,l,p;return i(),v("div",Nt,[e("div",Lt,[e("div",{class:B(["line-clamp-2 mr-4 ",{"text-red-50 bg-green-800 px-2":o.task.id==o.selected},{"hover:text-blue-500":o.task.id!=o.selected}])},E(o.task.id)+" - "+E(o.task.title),3),e("button",{class:"border btn-2 ml-auto",onClick:u[0]||(u[0]=M(()=>d("select",o.task),["prevent"]))}," Select ")]),(l=(s=o.task)==null?void 0:s.children_tasks)!=null&&l.length?P(a.$slots,"children",{key:0,childrenTasks:(p=o.task)==null?void 0:p.children_tasks,level:o.level+1}):g("",!0)])}}},jt={class:"border"},Ut={class:"border ml-4 mt-4"},Pt={class:"border ml-4 mt-4"},ke={__name:"TodoTypeInput",props:{todoType:{type:String,default:"task"},todoTypeId:{type:[String,Number],default:null},show:{type:Boolean,default:!1}},emits:["update:todoType","update:todoTypeId","update:show"],setup(o,{emit:$}){const d=o,a=$,u=z({get:()=>d.todoTypeId,set:t=>a("update:todoTypeId",t)}),s=z({get:()=>d.show,set:t=>a("update:show",t)}),l=R(null),p=R({});function n(){if(!(l!=null&&l.value))return;const t=l.value.getBoundingClientRect(),h=window.innerHeight,S=300,x=h-t.bottom<S;p.value={position:"fixed",top:x?t.top-S+"px":t.bottom+"px",left:t.left+"px",width:t.width+"px",zIndex:5e3}}function y(t){u.value=t.id,s.value=!1}function b(t){u.value="",s.value=!1}Y(async()=>{await ne(),window.addEventListener("resize",n),document.addEventListener("scroll",n)});const m=Re();return J(()=>s.value,async t=>{t&&await m.fetchMyTasks()}),xe(()=>{window.removeEventListener("resize",n),document.removeEventListener("scroll",n)}),(t,h)=>(i(),v("div",{class:"relative",ref_key:"anchor",ref:l},[e("div",{class:B(["w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 cursor-pointer flex items-center shadow-sm",u.value?"":"text-gray-400"]),onClick:h[0]||(h[0]=M(()=>{s.value=!0,n()},["stop"]))},[F(E(u.value||"Click to select todo")+" ",1),u.value?(i(),v("button",{key:0,class:"btn-icon fas fa-times !size-8 text-sm ml-auto",onClick:M(b,["prevent","stop"])})):g("",!0)],2),(i(),L(De,{to:"body"},[s.value?(i(),v("div",{key:0,style:we(p.value),class:"fixed h-[300px] bg-white rounded-b-md overflow-y-auto shadow-lg border z-[5000] p-4"},[e("div",jt,[(i(!0),v(q,null,H(C(m).tasks,S=>(i(),L(se,{key:S.id,task:S,onSelect:y,selected:u.value,class:"group/main"},{children:N(({childrenTasks:O})=>[e("div",Ut,[(i(!0),v(q,null,H(O,x=>(i(),L(se,{key:x.id,task:x,onSelect:y,selected:u.value},{children:N(({childrenTasks:c})=>[e("div",Pt,[(i(!0),v(q,null,H(c,k=>(i(),L(se,{key:k.id,task:k,onSelect:y,selected:u.value},null,8,["task","selected"]))),128))])]),_:2},1032,["task","selected"]))),128))])]),_:2},1032,["task","selected"]))),128))])],4)):g("",!0)]))],512))}},At={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},_t={class:"mb-2"},Ft={class:"mb-4"},zt={class:"mb-4"},qt={__name:"TodoAddForm",props:{date:{type:String,default:K(new Date)},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(o,{emit:$}){const d=o,a=R(),u=R(!1),s=R(),l=X(),p=$,n=R({title:"",date:d.date||"",todo_type:"",todo_type_id:""});async function y(){var m;try{a.value="submitting",(m=n.value)!=null&&m.todo_type_id||(n.value={title:n.value.title,date:n.value.date}),await l.createTodo(n.value,{returnWith:d.userRole!=="employee"?"user,department,company":""}),p("update")}finally{a.value=""}}const b=z(()=>new Date(d.date));return Y(async()=>{var m;await ne(),(m=s.value)==null||m.focus()}),(m,t)=>(i(),v("div",{onClick:t[5]||(t[5]=h=>u.value=!1)},[C(l).loading?(i(),L(ee,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:N(()=>t[6]||(t[6]=[F(" Loading... ")])),_:1,__:[6]})):g("",!0),A(ue,{onSubmit:y,onClickCancel:t[4]||(t[4]=h=>p("cancelClick")),isSubmitting:a.value=="submitting",error:C(l).error,class:"rounded-md relative"},{default:N(()=>[t[10]||(t[10]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),e("div",At,[e("div",_t,[t[7]||(t[7]=e("span",{class:"font-semibold"}," Date ",-1)),e("span",null,E(C(ie)(b.value,{weekDay:"long"})),1)]),e("div",Ft,[t[8]||(t[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),le(e("input",{ref_key:"titleRef",ref:s,"onUpdate:modelValue":t[0]||(t[0]=h=>n.value.title=h),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[de,n.value.title]])]),e("div",zt,[t[9]||(t[9]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),A(ke,{show:u.value,"onUpdate:show":t[1]||(t[1]=h=>u.value=h),todoType:n.value.todo_type,"onUpdate:todoType":t[2]||(t[2]=h=>n.value.todo_type=h),todoTypeId:n.value.todo_type_id,"onUpdate:todoTypeId":t[3]||(t[3]=h=>n.value.todo_type_id=h)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","error"])]))}},Bt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Wt={class:"mb-4 text-md"},Vt={class:"font-semibold"},Gt={class:"mb-2"},Ht={__name:"TodoDateAddForm",props:{date:{type:[String,Number],default:K(new Date)},todoId:{type:[String,Number],required:!0},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(o,{emit:$}){const d=o,a=R(),u=R(!1),s=R(),l=X(),p=te(),n=$,y=R({date:d.date||"",todo_id:d.todoId});async function b(){try{a.value="submitting",await p.createTodoDate(y.value),n("update")}finally{a.value=""}}return Y(async()=>{var m;await ne(),await l.fetchTodo(d.todoId),(m=s.value)==null||m.focus()}),(m,t)=>(i(),v("div",{onClick:t[2]||(t[2]=h=>u.value=!1)},[C(l).loading?(i(),L(ee,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:N(()=>t[3]||(t[3]=[F(" Loading... ")])),_:1,__:[3]})):g("",!0),A(ue,{onSubmit:b,onClickCancel:t[1]||(t[1]=h=>n("cancelClick")),isSubmitting:a.value=="submitting",error:C(p).error,class:"rounded-md relative"},{default:N(()=>{var h;return[t[6]||(t[6]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Carry Todo To Date")],-1)),e("div",Bt,[e("div",Wt,[t[4]||(t[4]=F(" TODO: ")),e("span",Vt,E((h=C(l).todo)==null?void 0:h.title),1)]),e("div",Gt,[t[5]||(t[5]=e("span",{class:"font-semibold"}," Date ",-1)),le(e("input",{"onUpdate:modelValue":t[0]||(t[0]=S=>y.value.date=S),type:"date",multiple:"",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[de,y.value.date]])])])]}),_:1,__:[6]},8,["isSubmitting","error"])]))}},Kt={key:0,class:"mb-4 text-red-500 font-medium"},Yt={key:1,class:"mb-4 text-red-500 font-medium"},Jt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Xt={class:"mb-4"},Qt={class:"mb-4"},Zt={__name:"TodoEditForm",props:{date:{type:String,default:K(new Date)},todo:{type:Object,default:()=>({})}},emits:["update","cancelClick"],setup(o,{emit:$}){var U;const d=o,a=R(),u=R(!1),s=R(),l=X(),p=$,n=R({title:"",todo_type:"task",todo_type_id:""}),y=R({id:null,repeat_type:"daily",start_date:((U=d.todo)==null?void 0:U.date)||d.date||K(new Date),end_date:null,weekly_day:null,monthly_mode:null,monthly_value:null,monthly_week:null,yearly_month:null,yearly_day:null}),b=R(!1),m=R({});async function t(){var I,r,f;await l.fetchTodo((I=d.todo)==null?void 0:I.id),n.value.title=(r=l.todo)==null?void 0:r.title,n.value.todo_type_id=(f=l.todo)==null?void 0:f.todoable_id}const h=R(null);async function S(){var I,r;try{const{data:f}=await Se(d.todo.id),D=f==null?void 0:f.setting;D?(b.value=!0,h.value=D.id,y.value={repeat_type:D.repeat_type??"daily",start_date:D.start_date??y.value.start_date,end_date:D.end_date??null,weekly_day:D.weekly_day??null,monthly_mode:D.monthly_mode??null,monthly_value:D.monthly_value??null,monthly_week:D.monthly_week??null,yearly_month:D.yearly_month??null,yearly_day:D.yearly_day??null}):y.value.id=null}catch(f){w.value=(r=(I=f==null?void 0:f.response)==null?void 0:I.data)==null?void 0:r.message,console.error("Load setting failed:",(f==null?void 0:f.message)||f)}}async function O(){await l.updateTodo(d.todo.id,{title:n.value.title,todo_type:n.value.todo_type,todo_type_id:n.value.todo_type_id})}async function x(){var I,r;if(!b.value)h.value&&await Ie(d.todo.id,h.value);else{const f=(I=m.value)!=null&&I.buildPayload?m.value.buildPayload():{...y.value};f.start_date||(f.start_date=((r=d.todo)==null?void 0:r.date)||d.date||K(new Date)),await Me(d.todo.id,f)}}const c=I=>{var r,f;return((f=(r=I==null?void 0:I.response)==null?void 0:r.data)==null?void 0:f.message)||(I==null?void 0:I.message)||"Something went wrong"};async function k(){const[I,r]=await Promise.allSettled([O(),x()]),f=I.status==="fulfilled",D=r.status==="fulfilled";D||(w.value=c(r.reason)),f&&D&&p("update")}const T=R(!1),w=R(!1);async function _(){var I;await t(),T.value=!0,await S(),T.value=!1,await ne(),(I=s.value)==null||I.focus()}const j=z(()=>l.loading||T.value);return Y(()=>{_()}),(I,r)=>(i(),v("div",{class:"relative",onClick:r[5]||(r[5]=f=>u.value=!1)},[j.value?(i(),L(ee,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:N(()=>r[6]||(r[6]=[F(" Loading... ")])),_:1,__:[6]})):g("",!0),A(ue,{onSubmit:k,onClickCancel:r[4]||(r[4]=f=>p("cancelClick")),isSubmitting:a.value=="submitting",isLoading:j.value,id:"todoEditForm"},{error:N(()=>[e("div",null,[C(l).error?(i(),v("div",Kt,E(C(l).error),1)):g("",!0),w.value?(i(),v("div",Yt,E(w.value),1)):g("",!0)])]),default:N(()=>[r[10]||(r[10]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),e("div",Jt,[r[9]||(r[9]=e("div",{class:"text-xs text-red-800 mb-6"},[e("strong",null,"Tips:"),F(" If you change the todo, it will change to all the concurrent dates ")],-1)),e("div",Xt,[r[7]||(r[7]=e("label",{class:"block text-gray-500 font-medium text-sm"},"Title",-1)),le(e("input",{ref_key:"titleRef",ref:s,"onUpdate:modelValue":r[0]||(r[0]=f=>n.value.title=f),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 shadow-sm"},null,512),[[de,n.value.title]])]),e("div",Qt,[r[8]||(r[8]=e("label",{class:"block text-gray-500 font-medium text-sm"},"Task ID (optional)",-1)),A(ke,{show:u.value,"onUpdate:show":r[1]||(r[1]=f=>u.value=f),todoType:n.value.todo_type,"onUpdate:todoType":r[2]||(r[2]=f=>n.value.todo_type=f),todoTypeId:n.value.todo_type_id,"onUpdate:todoTypeId":r[3]||(r[3]=f=>n.value.todo_type_id=f)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","isLoading"])]))}},eo={class:"relative"},to={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},oo={class:"mb-4"},no={class:"mb-4 flex justify-between items-end"},so={key:0,class:"mt-1 flex items-center gap-2 mb-4"},ao={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},lo={class:"flex items-center justify-between gap-4"},io={key:0,class:"flex items-center gap-2"},ro={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},uo={key:0,class:"ml-auto flex items-center gap-2"},co={__name:"TodoShow",props:{todoDate:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update","clickAddTodoDate"],setup(o,{emit:$}){const d=o,a=te(),u=ae(),s=$;async function l(){var m;console.log({todo_date:"dd"}),await a.fetchTodoDate((m=d.todoDate)==null?void 0:m.id)}const p=z(()=>{var m,t;return(m=a.todo_date)!=null&&m.date?new Date((t=a.todo_date)==null?void 0:t.date):null}),n=z(()=>{var m,t,h;return((t=(m=a.todo_date)==null?void 0:m.user)==null?void 0:t.id)===((h=u.user)==null?void 0:h.id)});async function y(m){var t;confirm(`Are your sure want to delete todo
'${(t=a.todo_date)==null?void 0:t.title}'`)&&(await a.deleteTodoDate(m.id),s("update"))}async function b(m,t){var h;confirm(`Are your sure want to compete todo
'${(h=a.todo_date)==null?void 0:h.title}'`)&&(await a.updateStatus(m.id,t),s("update"))}return Y(async()=>{await l()}),(m,t)=>{var h,S,O,x,c,k,T,w,_;return i(),v("div",eo,[C(a).loading?(i(),L(ee,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:N(()=>t[6]||(t[6]=[F(" Loading... ")])),_:1,__:[6]})):g("",!0),e("div",null,[t[13]||(t[13]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),e("div",to,[e("div",oo,[t[7]||(t[7]=e("div",{class:"font-semibold text-xs text-gray-500"},"Date",-1)),e("span",null,E(C(ie)(p.value,{weekDay:"long"})),1)]),e("div",no,[e("div",null,[t[8]||(t[8]=e("div",{class:"text-xs text-gray-500"},"Todo",-1)),F(" "+E((h=C(a).todo_date)==null?void 0:h.title),1)]),e("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white bg-none",onClick:t[0]||(t[0]=M(j=>{var U;return s("clickEdit",(U=C(a).todo_date)==null?void 0:U.todo)},["prevent","stop"]))},t[9]||(t[9]=[e("i",{class:"fas fa-pen"},null,-1),F(" Edit Todo ")]))]),(S=o.todoDate)!=null&&S.user?(i(),v("div",so,[A(fe,{user:o.todoDate.user,"avatar-size":"xsmall"},null,8,["user"]),e("div",ao,E((x=(O=o.todoDate.user)==null?void 0:O.department)==null?void 0:x.name),1)])):g("",!0),e("div",null,[t[12]||(t[12]=e("div",{class:"text-xs text-gray-500"},"Status",-1)),e("div",lo,[e("div",null,[(c=C(a))!=null&&c.todo_date?(i(),L(re,{key:0,todoDate:(k=C(a))==null?void 0:k.todo_date},null,8,["todoDate"])):g("",!0),F(" "+E((T=C(a).todo_date)==null?void 0:T.status),1)]),n.value&&!C(a).loading?(i(),v("div",io,[((w=C(a).todo_date)==null?void 0:w.status)==="PENDING"?(i(),v("button",{key:0,class:"btn-2 from-yellow-700 to-yellow-500 text-white hover:bg-green-600 hover:text-white",onClick:t[1]||(t[1]=M(()=>b(C(a).todo_date,"WORKING"),["prevent","stop"]))},t[10]||(t[10]=[e("i",{class:"fas fa-exclamation-circle"},null,-1),F(" Change to Working ")]))):g("",!0),((_=C(a).todo_date)==null?void 0:_.status)==="WORKING"?(i(),v("button",{key:1,class:"btn-2 from-green-700 to-green-300 text-white hover:bg-green-600 hover:text-white",onClick:t[2]||(t[2]=M(()=>b(C(a).todo_date,"COMPLETED"),["prevent","stop"]))},t[11]||(t[11]=[e("i",{class:"fas fa-check"},null,-1),F(" Make Complete ")]))):g("",!0)])):g("",!0)])])])]),e("div",ro,[e("button",{type:"button",onClick:t[3]||(t[3]=j=>s("cancelClick")),class:"btn-3"},"Cancel"),n.value&&!C(a).loading?(i(),v("div",uo,[e("button",{class:"btn-2 bg-green-600 text-white hover:bg-green-700 hover:text-white bg-none",onClick:t[4]||(t[4]=M(j=>{var U,I;return s("clickAddTodoDate",(U=C(a).todo_date)==null?void 0:U.todo_id,(I=C(a).todo_date)==null?void 0:I.date)},["prevent","stop"]))},t[14]||(t[14]=[e("i",{class:"fas fa-plus"},null,-1),F(" Add To another date ")])),e("button",{class:"btn-2-red",onClick:t[5]||(t[5]=M(()=>y(C(a).todo_date),["prevent","stop"]))},t[15]||(t[15]=[e("i",{class:"fas fa-trash-alt"},null,-1),F(" Delete ")]))])):g("",!0)])])}}},mo={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","todoUpdate","todoDateUpdate","clickEdit","clickDelete","clickChangeStatus","clickAddTodoDate"],setup(o,{emit:$}){const d=$;function a(){d("todoUpdate")}function u(){d("todoDateUpdate")}return(s,l)=>(i(),v(q,null,[o.todoModal.action=="add"?(i(),L(oe,{key:0},{default:N(()=>{var p;return[A(qt,{onCancelClick:l[0]||(l[0]=n=>d("cancelClick")),onUpdate:a,date:(p=o.todoModal)==null?void 0:p.date,userRole:o.userRole},null,8,["date","userRole"])]}),_:1})):g("",!0),o.todoModal.action=="addDate"?(i(),L(oe,{key:1},{default:N(()=>{var p,n;return[A(Ht,{onCancelClick:l[1]||(l[1]=y=>d("cancelClick")),onUpdate:u,date:(p=o.todoModal)==null?void 0:p.date,todoId:(n=o.todoModal)==null?void 0:n.todo_id,userRole:o.userRole},null,8,["date","todoId","userRole"])]}),_:1})):g("",!0),o.todoModal.action=="edit"?(i(),L(oe,{key:2},{default:N(()=>{var p;return[A(Zt,{onCancelClick:l[2]||(l[2]=n=>d("cancelClick")),onUpdate:a,todo:(p=o.todoModal)==null?void 0:p.todo,userRole:o.userRole},null,8,["todo","userRole"])]}),_:1})):g("",!0),o.todoModal.action=="show"?(i(),L(oe,{key:3},{default:N(()=>{var p;return[A(co,{onCancelClick:l[3]||(l[3]=n=>d("cancelClick")),onUpdate:u,onClickEdit:l[4]||(l[4]=n=>d("clickEdit",n)),onClickAddTodoDate:l[5]||(l[5]=(...n)=>d("clickAddTodoDate",...n)),onClickDelete:l[6]||(l[6]=n=>d("clickDelete",n)),onClickChangeStatus:l[7]||(l[7]=(n,y)=>d("clickChangeStatus",n,y)),todoDate:(p=o.todoModal)==null?void 0:p.todo,userRole:o.userRole},null,8,["todoDate","userRole"])]}),_:1})):g("",!0)],64))}},yo={class:"border bg-white relative"},vo={key:0,class:"text-red-600 py-4 text-semibold text-center text-xl"},Do={__name:"TodoSection",props:{year:{type:Number,default:()=>new Date().getFullYear()},month:{type:Number,default:()=>new Date().getMonth()+1},day:{type:Number,default:()=>new Date().getDate()},week:{type:Number,default:()=>new Date().getDay()},type:{type:String,default:"month-view"},companyId:{type:String,default:""},departmentId:{type:String,default:""},employeeId:{type:String,default:""},lineType:{type:String,default:""},status:{type:String,default:""},userRole:{type:String,default:"employee"}},emits:["changeInput"],setup(o,{emit:$}){const d=new Date,a=o,u=R({type:"month-view",month:d.getMonth()+1,day:d.getDate(),year:d.getFullYear(),week:d.getDay()}),s=$;J(()=>({...u.value}),r=>{s("changeInput",r)}),J(()=>({year:a.year,month:a.month,day:a.day,week:a.week,type:a.type}),r=>{u.value={...r}},{immediate:!0});const l=R({action:null}),p=X(),n=te();async function y(){await I()}function b(){l.value={...l.value,action:""},I()}function m(){l.value={...l.value,action:""}}async function t(r,f){await p.updateTodoStatus(r,f)}async function h(r){await p.deleteTodo(r)}function S(){u.value={...u.value,type:"month-view"}}function O(r){u.value={...u.value,...r}}function x(r){const[f,D,W]=r.split("-").map(Number);u.value={...u.value,type:"day-view",year:f,month:D,day:W}}function c(r){console.log({todo:r}),l.value={...l.value,action:"show",todo:r}}function k(r){l.value={...l.value,action:"edit",todo:r}}function T(r,f){console.log({yearMonthDay:r,mainTodoId:f}),l.value={...l.value,action:"add",date:r,todo_id:f}}function w(r,f){console.log({yearMonthDay:f,todoId:r}),l.value={...l.value,action:"addDate",date:f,todo_id:r}}function _(){l.value={action:null,todo:null}}const j=z(()=>{var W,V,G,ce,me,ye;const r=(V=(W=u.value)==null?void 0:W.year)==null?void 0:V.toString(),f=(ce=(G=u.value)==null?void 0:G.month)==null?void 0:ce.toString().padStart(2,"0"),D=(ye=(me=u.value)==null?void 0:me.day)==null?void 0:ye.toString().padStart(2,"0");return`${r}-${f}-${D}`}),U=z(()=>{var D,W,V,G;const r=(W=(D=u.value)==null?void 0:D.year)==null?void 0:W.toString(),f=(G=(V=u.value)==null?void 0:V.month)==null?void 0:G.toString().padStart(2,"0");return`${r}-${f}`});async function I(){const[r,f]=[Number(a.year),Number(a.month)],D=K(new Date(r,f-1,1)),W=K(Te(r,f-1));console.log("FETCHING...",{startDate1:D,endDate1:W});const[V,G]=$e(r,f-1);console.log("FETCHING...",{startDate:V,endDate:G}),a.userRole=="employee"?await n.fetchMyTodoDates({"start-date":V,"end-date":G}):await n.fetchTodoDates({"company-id":a.companyId,"department-id":a.departmentId,"employee-id":a.employeeId,"line-type":a.lineType,"start-date":V,"end-date":G,status:a.status})}return Y(()=>{I()}),J(()=>({"company-id":a.companyId,"department-id":a.departmentId,"employee-id":a.employeeId,"line-type":a.lineType,status:a.status,month:a.month}),()=>I()),(r,f)=>(i(),v("div",null,[e("div",yo,[C(n).loading?(i(),L(ee,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:N(()=>f[0]||(f[0]=[F(" Loading... ")])),_:1,__:[0]})):g("",!0),A(We,{selected:u.value,class:"border-b shadow z-20",onChange:O,onReloadClick:y},{before:N(D=>[P(r.$slots,"beforeHeader",Q(Z(D)))]),inner:N(D=>[P(r.$slots,"innerHeader",Q(Z(D)))]),after:N(D=>[P(r.$slots,"afterHeader",Q(Z(D)))]),bottom:N(D=>[e("div",null,[P(r.$slots,"bottomHeader",Q(Z(D))),C(n).error?(i(),v("div",vo,E(C(n).error),1)):g("",!0)])]),typeSelection:N(D=>[P(r.$slots,"typeSelection",Q(Z(D)))]),_:3},8,["selected"]),u.value.type=="month-view"?(i(),L(tt,{key:1,month:U.value,class:"bg-white",onDateClick:x,onClickTodo:c,onClickDateCell:T},null,8,["month"])):g("",!0),u.value.type=="day-view"?(i(),L(St,{key:2,date:j.value,userRole:o.userRole,onClickTodo:c,onClickEdit:k,onClickAdd:T,onClickDelete:h,onClickChangeStatus:t,onBackClick:S,onUpdate:b,onAddCarryClick:T},null,8,["date","userRole"])):g("",!0)]),A(mo,{todoModal:l.value,userRole:o.userRole,onCancelClick:_,onTodoUpdate:b,onTodoDateUpdate:m,onClickEdit:k,onClickAddTodoDate:w},null,8,["todoModal","userRole"])]))}};export{je as _,Do as a};
