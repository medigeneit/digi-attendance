import{c as l,o as a,F as D,y as Q,f as v,i as $,L as W,b as Z,r as K,m as x,A as _,n as ee,g as i,a as s,p as h,t as c,j as r,w as p,k as y,x as C}from"./index-DQNN2hA4.js";import{_ as te,b as se,T as ae,a as le}from"./TaskUrgentBadge-2mOMM7im.js";import{a as ie}from"./TaskAssignedUsers-CDwVmCvd.js";import{b as w,d as ne}from"./datetime-BEfC2TVK.js";import{o as de}from"./url-CePbr-gY.js";import{_ as oe}from"./TaskSupervisorAndEmployee-pMOrhvs4.js";const re={class:"mt-3"},ue={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick","employeeAssignClick"],setup(e,{emit:T}){const d=T;return(f,u)=>(a(),l("div",re,[(a(!0),l(D,null,Q(e.childrenTasks,(k,A)=>(a(),v(Ge,{key:k.id,index:A,task:k,class:"mb-3","hide-buttons":e.hideButtons,"hide-assigned-users":f.hideAssignedUsers,"tree-level":e.parentTreeLevel+1,onEditClick:u[0]||(u[0]=m=>d("editClick",m)),onAddClick:u[1]||(u[1]=m=>d("addClick",m)),onEmployeeAssignClick:u[2]||(u[2]=m=>d("employeeAssignClick",m))},{"item-end":$(({task:m,level:B})=>[W(f.$slots,"treeItemEnd",{task:m,level:B})]),_:2},1032,["index","task","hide-buttons","hide-assigned-users","tree-level"]))),128))]))}},ce={class:"flex w-full text-gray-800"},ke={key:0,class:"border-l border-gray-200 last:border-l-0"},me={class:"items-start grid grid-cols-4 gap-4 group"},ge={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},fe={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},xe={key:0,class:"text-xl font-semibold text-blue-500"},be={key:1,class:"text-sm text-gray-500 mt-2"},ye={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},ve={key:0,class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"},he={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},pe={key:0,class:"flex gap-4 items-center mr-3"},Ce={key:1,class:"text-gray-500 text-sm"},we={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Te={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},Ae={class:"text-gray-400 text-xs col-span-full"},Be={class:"flex flex-wrap gap-2 mb-2 col-span-full"},Le={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4 mt-4 opacity-80"},De={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},$e={key:1,class:"text-gray-500 text-sm"},Se={class:"font-semibold text-blue-800"},Ee={key:2,class:"ml-4 text-gray-500 text-sm"},qe={class:"text-blue-500 font-semibold"},Ne={key:3,class:"text-gray-500 text-sm"},Re={class:"font-semibold text-blue-800"},Me={key:4,class:"text-gray-500 text-sm"},je={class:"font-semibold text-blue-800"},Ue={class:"mt-4 col-span-full"},Ie={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},Oe={class:"text-xs text-gray-400 flex gap-3 order-1 sm:order-0"},Ve=["href"],Pe={class:"flex items-center sm:ml-auto order-0 sm:order-1"},He={key:0,class:"flex gap-2 ml-4 items-center text-xs"},Fe=["href"],Je=["href"],ze={class:"ml-0"},Ge={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(e,{emit:T}){const d=e,f=Z(),u=K(null),k=T;function A(n){k("addClick",n)}function m(n){k("editClick",n)}function B(n){k("employeeAssignClick",n)}const g=K([]),S=localStorage.getItem("sub_task_opened_list");if(S)try{g.value=JSON.parse(S)}catch{g.value=[]}const E=x(()=>w(d.task.assigned_at||d.task.created_at)),q=x(()=>w(d.task.deadline)),N=x(()=>w(d.task.started_at)),R=x(()=>w(d.task.completed_at)),b=x({get:()=>g.value.includes(d.task.id),set:n=>{const t=g.value.includes(d.task.id);n&&!t?g.value.push(d.task.id):!n&&t&&(g.value=g.value.filter(L=>L!==d.task.id))}});_(g,n=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(n))},{deep:!0});const M=x(()=>{var n,t;return((t=(n=d.task)==null?void 0:n.children_tasks)==null?void 0:t.length)>0});function X(){d.task.children_tasks.length>0&&(b.value=!b.value)}return(n,t)=>{var j,U,I,O,V,P,H,F,J,z,G;const L=ee("RouterLink");return a(),l("div",ce,[e.treeLevel>0?(a(),l("div",ke,t[4]||(t[4]=[s("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):i("",!0),s("div",{class:C(["flex-grow border-2 rounded py-3 px-3",{"bg-blue-100/30  ":e.task.closed_at,"bg-green-100  ":((j=u.value)==null?void 0:j.completedPercentage)===100,"bg-white hover:bg-gray-50":((U=u.value)==null?void 0:U.completedPercentage)<100&&!e.task.closed_at,"shadow-sm":e.treeLevel>0,"border-blue-500":e.index%2===0,"border-pink-300":e.index%2===1}])},[s("div",me,[s("div",ge,[s("div",fe,[e.index!==void 0?(a(),l("div",xe,c(e.index+1)+". ",1)):i("",!0),h(te,{task:e.task,"sub-tasks-open":b.value,"is-my-task":e.isMyTask},null,8,["task","sub-tasks-open","is-my-task"]),(I=e.task)!=null&&I.requirement?(a(),l("p",be," Requirement: "+c((V=(O=e.task)==null?void 0:O.requirement)==null?void 0:V.title),1)):i("",!0)]),s("div",ye,[e.task.closed_at?(a(),l("div",ve,t[5]||(t[5]=[s("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),r("CLOSED ")]))):i("",!0),h(ie,{status:(P=e.task)==null?void 0:P.status,progressPercent:((H=e.task)==null?void 0:H.progress_percent)||0},null,8,["status","progressPercent"]),h(se,{ref_key:"progress",ref:u,task:e.task,class:"text-sm"},null,8,["task"])]),s("div",he,[e.showDraggableHandle||e.task.serial?(a(),l("div",pe,[e.showDraggableHandle?(a(),l("button",{key:0,onMousedown:t[0]||(t[0]=p((...o)=>n.handleDragging&&n.handleDragging(...o),["stop"])),class:"handle"},t[6]||(t[6]=[s("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):i("",!0),e.task.serial?(a(),l("span",Ce," #"+c(e.task.serial),1)):i("",!0)])):i("",!0),s("div",we,[e.treeLevel===0?(a(),l("div",Te," Main ")):i("",!0),(F=e.task)!=null&&F.is_important?(a(),v(ae,{key:1})):i("",!0),(J=e.task)!=null&&J.is_urgent?(a(),v(le,{key:2})):i("",!0)])])]),s("div",Ae,[t[7]||(t[7]=s("i",{class:"fas fa-clock"},null,-1)),r(" "+c(y(ne)(e.task.created_at)),1)]),s("div",Be,[(a(!0),l(D,null,Q(e.task.website_tags||[],o=>(a(),l("div",{class:"border bg-gray-50 text-xs px-2 rounded-lg shadow-sm text-gray-700 bg-gradient-to-b to-slate-50 from-blue-100",key:o.id},c(o.name),1))),128))]),e.hideAssignedUsers?i("",!0):(a(),v(oe,{key:0,task:e.task,"tree-level":e.treeLevel,"employee-route-to":o=>({query:{...y(f).query,view:"userwise","company-id":o.company_id,"user-ids":o.id}}),class:"col-span-full"},null,8,["task","tree-level","employee-route-to"]))]),s("div",Le,[e.task.is_target?(a(),l("div",De,t[8]||(t[8]=[s("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),r(" TARGET TASK ")]))):i("",!0),E.value?(a(),l("span",$e,[t[9]||(t[9]=r(" Assign: ")),s("span",Se,c(E.value),1)])):i("",!0),q.value?(a(),l("span",Ee,[t[10]||(t[10]=r(" Deadline: ")),s("span",qe,c(q.value),1)])):i("",!0),N.value?(a(),l("span",Ne,[t[11]||(t[11]=r(" Started: ")),s("span",Re,c(N.value),1)])):i("",!0),R.value?(a(),l("span",Me,[t[12]||(t[12]=r(" Completed: ")),s("span",je,c(R.value),1)])):i("",!0)]),s("div",Ue,[s("div",Ie,[s("div",Oe,[s("button",{class:C([{"text-blue-600 font-semibold  inline-block  ":M.value},"flex items-center gap-1 group"]),onClick:X},[s("i",{class:C([b.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),s("span",{class:C(M.value?"group-hover:underline":"")}," Sub Tasks ("+c((z=e.task.children_tasks)==null?void 0:z.length)+") ",3)],2),!e.task.closed_at&&!e.hideButtons?(a(),l(D,{key:0},[e.treeLevel<2?(a(),l("a",{key:0,href:`/tasks/add?parent_id=${d.task.id}&back-to=${encodeURIComponent(y(f).path+"?"+y(de)(y(f).query)).toLowerCase()}`,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:t[1]||(t[1]=p(o=>k("addClick",d.task.id),["stop","prevent"]))},t[13]||(t[13]=[s("i",{class:"fas fa-plus"},null,-1),r(" Add Sub Task ")]),8,Ve)):i("",!0)],64)):i("",!0)]),s("div",Pe,[e.hideButtons?i("",!0):(a(),l("div",He,[e.task.is_closed?i("",!0):(a(),l("a",{key:0,href:`/tasks/edit/${e.task.id}`,onClick:t[2]||(t[2]=p(o=>k("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},t[14]||(t[14]=[s("i",{class:"fas fa-edit"},null,-1),r(" Edit ")]),8,Fe)),e.task.is_closed?i("",!0):(a(),l("a",{key:1,href:`/tasks/${e.task.id}/assign-users`,onClick:t[3]||(t[3]=p(o=>k("employeeAssignClick",e.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},t[15]||(t[15]=[s("i",{class:"fas fa-users-cog"},null,-1),r(" Manage ")]),8,Je)),h(L,{to:{name:"TaskReports",params:{id:(G=e.task)==null?void 0:G.id},query:{"is-my-task":e.isMyTask},hash:"#task-reports"},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:$(()=>t[16]||(t[16]=[s("i",{class:"far fa-file-alt"},null,-1),r(" Reports ")])),_:1,__:[16]},8,["to"])]))])]),s("div",ze,[b.value?(a(),v(ue,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"hide-assigned-users":e.hideAssignedUsers,"parent-tree-level":e.treeLevel,onEditClick:m,onAddClick:A,onEmployeeAssignClick:B},{"tree-item-end":$(({task:o,level:Y})=>[W(n.$slots,"item-end",{level:Y,task:o})]),_:3},8,["childrenTasks","hide-buttons","hide-assigned-users","parent-tree-level"])):i("",!0)])])],2)])}}};export{Ge as _};
