import{B as c,C as n}from"./index-DiHNyYlN.js";const m=c("kpi-report",{state:()=>({meta:null,rows:[],reports:null,isLoading:!1,error:null}),actions:{async fetchBiMonthly(o){var t,r;this.isLoading=!0,this.error=null;try{const{data:e}=await n.get("/kpi/reports/bi-monthly",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:Array.isArray(e==null?void 0:e.data)?e.data:[],{meta:this.meta,rows:this.rows}}catch(e){throw this.error=((r=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to load report",e}finally{this.isLoading=!1}},async exportBiMonthly(o){try{const t=await n.get("/kpi/reports/bi-monthly-export",{params:o,responseType:"blob"}),r=t.headers["content-disposition"]||"";let e="kpi_bi_monthly.xlsx";const s=/filename="?([^"]+)"?/i.exec(r);s&&s[1]&&(e=decodeURIComponent(s[1]));const l=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=URL.createObjectURL(l),i=document.createElement("a");i.href=a,i.download=e,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(a)}catch(t){throw console.error(t),t}},async setReportCompletion(o){var t,r;try{const{form_id:e,department_id:s,completed:l}=o||{};if(!e)throw new Error("form_id is required");if(s==null)throw new Error("department_id is required");const{data:a}=await n.patch(`/kpi/forms/${e}/report-completion`,{department_id:s,completed:!!l});return a}catch(e){const s=((r=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:r.message)||(e==null?void 0:e.message)||"Failed to update report completion";throw console.error("setReportCompletion error:",e),new Error(s)}},async setTargetCompletion({form_id:o,department_id:t,completed:r}){const{data:e}=await n.post(`/kpi/bi-monthly/forms/${o}/target-completion`,{department_id:t,completed:r});return e},async fetchYearly(o){var t,r;this.isLoading=!0,this.error=null;try{const{data:e}=await n.get("/kpi/reports/yearly",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:[],this.reports=e??null,{meta:this.meta,rows:this.rows}}catch(e){throw this.error=((r=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to load yearly report",e}finally{this.isLoading=!1}},async exportYearly(o){try{const t=await n.get("/yearly-kpi-summary-reports",{params:o,responseType:"blob"}),r=t.headers["content-disposition"]||"";let e="yearly_kpi_report.xlsx";const s=/filename="?([^"]+)"?/i.exec(r);s&&s[1]&&(e=decodeURIComponent(s[1]));const l=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),a=URL.createObjectURL(l),i=document.createElement("a");i.href=a,i.download=e,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(a)}catch(t){throw console.error(t),t}},async fetchYearlyExecutive(o){var t,r;this.isLoading=!0,this.error=null;try{const{data:e}=await n.get("/yearly-kpi-summary-reports",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:[],this.reports=e??null,{meta:this.meta,rows:this.rows,reports:this.reports}}catch(e){throw this.error=((r=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to load yearly report",e}finally{this.isLoading=!1}}}});export{m as u};
