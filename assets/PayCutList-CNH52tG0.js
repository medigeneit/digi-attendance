import{_ as R}from"./EmployeeFilter-Bw1ReJOs.js";import{_ as E}from"./FlexibleDatePicker-C9-hXcRq.js";import{L as I}from"./LoaderView-BoIktWu4.js";import{u as O,U as Q}from"./UpdateOrCreate-BGerie7z.js";import{g as z,u as G,f as H,r as m,x as g,q as w,h as J,c as u,o as d,a as e,i as N,d as D,l as K,t as l,j,F as Y,e as W,s as X,m as k}from"./index-DTWB89sk.js";import"./company-BhgP5mGd.js";import"./department-DM-5Zo7h.js";import"./EmployeeDropdownInput-BjUF11Kb.js";import"./SelectDropdown-D5qW88T_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-7Jb8R5_-.js";import"./TimePickerAsFloatHour-D_BhAeN6.js";const Z={class:"px-4 space-y-5"},ee={class:"rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},te={class:"flex flex-wrap gap-2 p-3 rounded-2xl border border-white/20 bg-white/60 backdrop-blur-md shadow-sm supports-[backdrop-filter]:bg-white/50 sticky top-14"},se={class:"relative"},ae={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},oe={class:"rounded-2xl border border-slate-100 bg-slate-50 px-4 py-3"},le={class:"text-2xl font-semibold text-slate-900"},re={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},ne={class:"text-xl font-semibold text-amber-700"},ie={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},de={class:"text-xl font-semibold text-emerald-700"},pe={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},ue={class:"text-xl font-semibold text-rose-700"},ce={key:1,class:"rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden"},ye={class:"overflow-x-auto"},me={class:"min-w-full text-sm"},_e={class:"px-4 py-3"},xe={class:"px-4 py-3"},fe={class:"px-4 py-3"},ve={class:"px-4 py-3"},he={class:"px-4 py-3"},be={class:"px-4 py-3"},ge={class:"px-4 py-3"},we={class:"px-4 py-3 text-right"},ke={class:"flex items-center justify-end gap-2"},Se=["onClick"],Ce={key:0,class:"px-4 py-10 text-center text-slate-500"},Pe={key:0},Ne={key:1},Ie={__name:"PayCutList",setup(De){const U=z(),q=G(),c=H(),p=O(),y=m(c.query.month||new Date().toISOString().slice(0,7)),L=s=>s.toString().padStart(2,"0"),r=m({year:Number(y.value.split("-")[0]||new Date().getFullYear()),month:Number(y.value.split("-")[1]||new Date().getMonth()+1),day:1}),i=g(()=>!r.value.year||!r.value.month?"":`${r.value.year}-${L(r.value.month)}`),a=m({company_id:c.query.company_id||"",department_id:c.query.department_id||"",line_type:c.query.line_type||"all",employee_id:c.query.employee_id||""}),f=m(!1);g(()=>p.paycuts.length);const _=g(()=>{const s={total:0,pending:0,approved:0,rejected:0},t=p.paycuts||[];return s.total=t.length,t.forEach(o=>{const n=(o.status||"").toLowerCase();n==="pending"?s.pending++:n==="approved"?s.approved++:n==="rejected"&&s.rejected++}),s}),A=s=>{const t=(s||"").toLowerCase();return t==="approved"?"text-emerald-700 bg-emerald-50 border border-emerald-100":t==="rejected"?"text-rose-700 bg-rose-50 border border-rose-100":t==="pending"?"text-amber-700 bg-amber-50 border border-amber-100":"text-slate-700 bg-slate-100 border border-slate-200"};async function v(){if(!i.value||!a.value.company_id){p.paycuts=[];return}const s={month:i.value,company_id:String(a.value.company_id)};a.value.employee_id&&(s.user_id=String(a.value.employee_id)),f.value=!0;try{await p.fetchPaycuts(s)}finally{f.value=!1}}function F(){const s={};return i.value&&(s.month=String(i.value)),a.value.company_id&&(s.company_id=String(a.value.company_id)),a.value.department_id&&(s.department_id=String(a.value.department_id)),a.value.employee_id&&(s.employee_id=String(a.value.employee_id)),a.value.line_type&&a.value.line_type!=="all"&&(s.line_type=String(a.value.line_type)),s}let h=null;function M(){h&&clearTimeout(h),h=setTimeout(()=>{const s=F();q.replace({query:s}).catch(()=>{})},120)}let b=null;const S=m("");async function T(){M();const s=JSON.stringify({m:i.value||"",c:a.value.company_id||"",d:a.value.department_id||"",t:a.value.line_type||"all",e:a.value.employee_id||""});s!==S.value&&(await v(),S.value=s)}function x(){b&&clearTimeout(b),b=setTimeout(T,200)}w(()=>({...a.value,month:i.value}),()=>x(),{deep:!0}),w(i,()=>{i.value&&(y.value=i.value,x())}),w(()=>c.query,s=>{const t=s.month||"";t!==y.value&&(y.value=t,r.value.year=Number(t.split("-")[0]||r.value.year),r.value.month=Number(t.split("-")[1]||r.value.month));const o={company_id:s.company_id||"",department_id:s.department_id||"",line_type:s.line_type||"all",employee_id:s.employee_id||""},n=a.value;(o.company_id!==n.company_id||o.department_id!==n.department_id||o.line_type!==n.line_type||o.employee_id!==n.employee_id)&&(a.value=o)}),J(async()=>{x()});function V(){x()}async function $(s){confirm("Are you sure you want to delete this paycut?")&&(await p.deletePaycut(s),await v())}const B=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return(s,t)=>(d(),u("div",Z,[e("div",ee,[t[6]||(t[6]=e("div",null,[e("p",{class:"text-xs uppercase tracking-widest text-slate-500"},"Monthly Paycut"),e("h1",{class:"text-2xl font-semibold text-slate-900"},"Paycut log"),e("p",{class:"text-sm text-slate-500"},"Use filters to narrow down the report.")],-1)),e("div",te,[D(R,{company_id:a.value.company_id,"onUpdate:company_id":t[1]||(t[1]=o=>a.value.company_id=o),department_id:a.value.department_id,"onUpdate:department_id":t[2]||(t[2]=o=>a.value.department_id=o),employee_id:a.value.employee_id,"onUpdate:employee_id":t[3]||(t[3]=o=>a.value.employee_id=o),line_type:a.value.line_type,"onUpdate:line_type":t[4]||(t[4]=o=>a.value.line_type=o),"with-type":!0,"initial-value":s.$route.query,onFilterChange:V,class:"min-w-[220px]"},{default:K(()=>[e("div",se,[t[5]||(t[5]=e("label",{class:"top-label -top-1"},"Month",-1)),D(E,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),"show-year":!1,"show-month":!0,"show-date":!1},null,8,["modelValue"])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])])]),e("div",ae,[e("div",oe,[t[7]||(t[7]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Total",-1)),e("p",le,l(_.value.total),1)]),e("div",re,[t[8]||(t[8]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Pending",-1)),e("p",ne,l(_.value.pending),1)]),e("div",ie,[t[9]||(t[9]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Approved",-1)),e("p",de,l(_.value.approved),1)]),e("div",pe,[t[10]||(t[10]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Rejected",-1)),e("p",ue,l(_.value.rejected),1)])]),f.value?(d(),N(I,{key:0})):(d(),u("div",ce,[e("div",ye,[e("table",me,[t[12]||(t[12]=e("thead",{class:"bg-slate-50 text-xs uppercase tracking-wider text-slate-500"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left"},"#"),e("th",{class:"px-4 py-3 text-left"},"Employee"),e("th",{class:"px-4 py-3 text-left"},"Created Date"),e("th",{class:"px-4 py-3 text-left"},"Paycut Hours"),e("th",{class:"px-4 py-3 text-left"},"Reason"),e("th",{class:"px-4 py-3 text-left"},"Note"),e("th",{class:"px-4 py-3 text-left"},"Status"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(d(!0),u(Y,null,W(k(p).paycuts,(o,n)=>{var C,P;return d(),u("tr",{key:o.id,class:"border-t hover:bg-slate-50 transition-colors"},[e("td",_e,l(n+1),1),e("td",xe,l(((C=o.user)==null?void 0:C.name)||"N/A"),1),e("td",fe,l(B(o.created_at)),1),e("td",ve,l(o.paycut_hours),1),e("td",he,l(o.reason||"—"),1),e("td",be,l(o.note||"—"),1),e("td",ge,[e("span",{class:X(["inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold tracking-wide border",A(o.status)])},l(o.status||"Pending"),3)]),e("td",we,[e("div",ke,[((P=k(U).user)==null?void 0:P.id)===8?(d(),N(Q,{key:0,userId:o.user_id,month:y.value,onUpdated:v},null,8,["userId","month"])):j("",!0),e("button",{type:"button",class:"text-red-500",onClick:je=>$(o.id)},t[11]||(t[11]=[e("i",{class:"fa fa-trash"},null,-1)]),8,Se)])])])}),128))])])]),k(p).paycuts.length?j("",!0):(d(),u("div",Ce,[a.value.company_id?(d(),u("p",Ne,"No paycuts found for the selected filters.")):(d(),u("p",Pe,"Please select a company to load paycut data."))]))]))]))}};export{Ie as default};
