import{c as o,o as r,F as L,x as E,m as w,p as T,I as V,G as W,q as x,a as t,y as b,z as X,n as _,t as h,T as Z,f as k,l as p,B as z,k as H,b as ee,r as F,A as te,w as N,h as se}from"./index-CUUNTXsO.js";import{_ as G}from"./UserChip-DnGEdzkj.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"mt-3"},ae={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(e,{emit:l}){const a=l;return(c,i)=>(r(),o("div",re,[(r(!0),o(L,null,E(e.childrenTasks,(u,g)=>(r(),w(Qe,{key:u.id,index:g,task:u,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:i[0]||(i[0]=d=>a("editClick",d)),onAddClick:i[1]||(i[1]=d=>a("addClick",d))},{"item-end":T(({task:d,level:n})=>[V(c.$slots,"treeItemEnd",{task:d,level:n})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},le=W({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:l}){const a=e,c=x(function(){if(a.task.children_tasks.length===0)return a.task.status==="COMPLETED"?1:0;const g=d=>{let n=0;for(let m=0;m<d.length;m++){const y=d[m];if(y.children_tasks.length===0)y.status==="COMPLETED"&&(n+=1);else{const $=y.children_tasks.length;g(y.children_tasks)===$&&(n+=1)}}return n};return g(a.task.children_tasks)}),i=x(()=>a.task.children_tasks.length===0?a.task.status==="COMPLETED"?100:0:c.value/a.task.children_tasks.length*100),u=x(()=>{const g=i.value;let d,n,m;return g===100?(d="bg-green-50",n="bg-green-200",m="text-green-600 "):g<100&&(d="bg-red-50",n="bg-red-200",m="text-red-600 "),{container:d,bar:n,text:m}});return l({completedPercentage:i.value,completedSubTaskCount:c.value}),(g,d)=>(r(),o("div",null,[t("div",{class:b(["rounded-full border py-0.5 relative overflow-hidden h-6",u.value.container]),style:{width:"180px"}},[t("div",{class:b(["z-10 absolute top-0 bottom-0",u.value.bar]),style:X(`width: ${i.value}%`)},null,6),t("span",{class:b(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",u.value.text])},[t("span",null,[t("span",null,h(c.value),1),d[0]||(d[0]=_(" / ")),t("span",null,h(g.task.children_tasks.length||1),1)])],2)],2)]))}}),ne={__name:"TaskStatus",props:{status:{type:String,required:!0}},setup(e){const l=e,a=x(()=>{switch(l.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),c=x(()=>{switch(l.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(i,u)=>(r(),o("div",{class:b(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",a.value])},[t("i",{class:b(c.value)},null,2),_(" "+h(e.status),1)],2))}},J=e=>{if(!e)return"";try{const l=new Date(e);if(isNaN(l))return"";const a=String(l.getDate()).padStart(2,"0"),i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][l.getMonth()],u=l.getFullYear();return`${a}-${i}-${u}`}catch{return""}},oe={class:"relative"},ie={key:0,class:"text-gray-500 text-xs"},de={key:2,class:"text-sm text-gray-500 group/users"},ue={class:"cursor-pointer hover:underline text-blue-600"},ce={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg"},fe={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:()=>null},isTargetTask:{Boolean,default:!1}},setup(e){const l=e,a=x(()=>l.users.slice(0,2)),c=x(()=>l.users.slice(2));function i(g){if(typeof l.routeTo=="function")return l.routeTo(g)}const u=x(()=>typeof l.routeTo=="function"?Z:"div");return(g,d)=>(r(),o("div",oe,[l.users.length===0?(r(),o("div",ie,"Not Assigned To Anyone")):(r(!0),o(L,{key:1},E(a.value,(n,m)=>(r(),w(z(u.value),{key:m,to:i(n)},{default:T(()=>[p(G,{class:b(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask}]),user:n},null,8,["class","user"])]),_:2},1032,["to"]))),128)),c.value.length>0?(r(),o("div",de,[t("div",ue," + "+h(c.value.length)+" more users ",1),t("div",ce,[(r(!0),o(L,null,E(c.value,(n,m)=>(r(),w(z(u.value),{key:m,to:i(n),class:"w-full block mb-2"},{default:T(()=>[p(G,{class:b(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:n},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):k("",!0)]))}},ge={},me={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function ke(e,l){return r(),o("span",me,"IMPORTANT")}const he=K(ge,[["render",ke]]),xe={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(l,a)=>{const c=H("RouterLink");return r(),w(c,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:T(()=>[t("div",null,h(e.task.title),1)]),_:1},8,["to"])}}},be={},ve={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function pe(e,l){return r(),o("span",ve,"URGENT")}const ye=K(be,[["render",pe]]),_e={class:"flex w-full"},we={key:0,class:"border-l border-gray-200 last:border-l-0"},Te={class:"items-start grid grid-cols-4 gap-4 group"},Ce={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},$e={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},Se={key:0,class:"text-xl font-semibold text-sky-500"},Ne={key:1,class:"text-sm text-gray-500 mt-2"},Le={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Ee={class:"flex items-center gap-6 flex-none lg:w-full order-0 lg:order-1"},De={class:"flex gap-4 items-center"},Ae={class:"text-gray-500 text-sm"},Be={class:"text-red-500 text-sm"},Re={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Oe={class:"col-span-full flex items-center my-2 lg:my-0 justify-center flex-wrap gap-3"},Pe={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4"},Me={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},qe={key:1,class:"text-gray-500"},Ie={class:"font-semibold text-green-800"},je={key:2,class:"ml-4 text-gray-500"},Ue={class:"text-red-500 font-semibold"},ze={class:"mt-4 col-span-full"},Fe={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},Ge={class:"text-xs text-gray-500 flex gap-3 order-1 sm:order-0"},Je=["href"],Ve={class:"flex items-center sm:ml-auto order-0 sm:order-1"},He={key:0,class:"flex gap-2 ml-4 items-center text-xs"},Ke=["href"],Ye={class:"ml-0"},Qe={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick"],setup(e,{emit:l}){const a=e,c=ee(),i=F(null),u=l;function g(f){u("addClick",f)}function d(f){u("editClick",f)}const n=F([]),m=localStorage.getItem("sub_task_opened_list");if(m)try{n.value=JSON.parse(m)}catch{n.value=[]}const y=x(()=>J(a.task.started_at)),$=x(()=>J(a.task.deadline)),C=x({get:()=>n.value.includes(a.task.id),set:f=>{const s=n.value.includes(a.task.id);f&&!s?n.value.push(a.task.id):!f&&s&&(n.value=n.value.filter(S=>S!==a.task.id))}});te(n,f=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(f))},{deep:!0});const D=x(()=>{var f,s;return((s=(f=a.task)==null?void 0:f.children_tasks)==null?void 0:s.length)>0});function Y(){a.task.children_tasks.length>0&&(C.value=!C.value)}return(f,s)=>{var A,B,R,O,P,M,q,I,j,U;const S=H("RouterLink");return r(),o("div",_e,[e.treeLevel>0?(r(),o("div",we,s[3]||(s[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):k("",!0),t("div",{class:b(["flex-grow border rounded py-3 px-3",{"bg-green-100  ":((A=i.value)==null?void 0:A.completedPercentage)===100,"bg-white hover:bg-gray-50":((B=i.value)==null?void 0:B.completedPercentage)<100,"shadow-sm":e.treeLevel>0}])},[t("div",Te,[t("div",Ce,[t("div",$e,[e.index!==void 0?(r(),o("div",Se,h(e.index+1)+". ",1)):k("",!0),p(xe,{task:e.task},null,8,["task"]),(R=e.task)!=null&&R.requirement?(r(),o("p",Ne," Requirement: "+h((P=(O=e.task)==null?void 0:O.requirement)==null?void 0:P.title),1)):k("",!0)]),t("div",Le,[p(ne,{status:e.task.status},null,8,["status"]),p(le,{task:e.task,ref_key:"progress",ref:i,class:"text-sm"},null,8,["task"])]),t("div",Ee,[t("div",De,[e.showDraggableHandle?(r(),o("button",{key:0,onMousedown:s[0]||(s[0]=N((...v)=>f.handleDragging&&f.handleDragging(...v),["stop"])),class:"handle"},s[4]||(s[4]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):k("",!0),t("span",Ae," #"+h(e.task.id),1),t("div",Be,h(e.treeLevel),1)]),t("div",Re,[(M=e.task)!=null&&M.is_important?(r(),w(he,{key:0})):k("",!0),(q=e.task)!=null&&q.is_urgent?(r(),w(ye,{key:1})):k("",!0)])])]),t("div",Oe,[p(fe,{class:"flex items-center justify-center flex-wrap gap-3",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:v=>({query:{...se(c).query,view:"userwise","company-id":v.company_id,"user-ids":v.id}})},null,8,["users","isTargetTask","routeTo"]),p(S,{to:{name:"TaskUserAssign",params:{id:(I=e.task)==null?void 0:I.id}},title:"Add/Remove User",class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},{default:T(()=>s[5]||(s[5]=[t("i",{class:"fas fa-users-cog"},null,-1)])),_:1},8,["to"])])]),t("div",Pe,[e.task.is_target?(r(),o("div",Me," TARGET TASK ")):k("",!0),y.value?(r(),o("span",qe,[s[6]||(s[6]=_(" Started: ")),t("span",Ie,h(y.value),1)])):k("",!0),$.value?(r(),o("span",je,[s[7]||(s[7]=_(" Deadline: ")),t("span",Ue,h($.value),1)])):k("",!0)]),t("div",ze,[t("div",Fe,[t("div",Ge,[t("button",{class:b([{"text-yellow-600 font-semibold  inline-block  ":D.value},"flex items-center gap-1 group"]),onClick:Y},[t("i",{class:b([C.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:b(D.value?"group-hover:underline":"")}," Sub Tasks ("+h((j=e.task.children_tasks)==null?void 0:j.length)+") ",3)],2),e.treeLevel<2?(r(),o("a",{key:0,href:`/tasks/add?parent_id=${a.task.id}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:s[1]||(s[1]=N(v=>u("addClick",a.task.id),["stop","prevent"]))},s[8]||(s[8]=[t("i",{class:"fas fa-plus"},null,-1),_(" Add Sub Task ")]),8,Je)):k("",!0)]),t("div",Ve,[e.hideButtons?k("",!0):(r(),o("div",He,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:s[2]||(s[2]=N(v=>u("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},s[9]||(s[9]=[t("i",{class:"fas fa-edit"},null,-1),_(" Edit ")]),8,Ke),p(S,{to:{name:"TaskReports",params:{id:(U=e.task)==null?void 0:U.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:T(()=>s[10]||(s[10]=[t("i",{class:"far fa-file-alt"},null,-1),_(" Reports ")])),_:1},8,["to"])]))])]),t("div",Ye,[C.value?(r(),w(ae,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:d,onAddClick:g},{"tree-item-end":T(({task:v,level:Q})=>[V(f.$slots,"item-end",{level:Q,task:v})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):k("",!0)])])],2)])}}};export{Qe as _,le as a,J as g};
