import{G as W,r as C,e as J,H as et,A as K,c as u,o as r,f as v,a as t,t as g,I as A,n as $,h as i,w as S,l as x,p as _,E as Q,m as w,F as X,x as st,J as at,K as O,g as rt,v as nt,b as ot,u as lt,d as it,q as D,k as z,y as H}from"./index-l4XLehSa.js";import{L as G}from"./LoaderView-DUd6okPN.js";import{u as dt,_ as ut,O as L}from"./task-priority-1rba5vfF.js";import{a as pt}from"./TaskAddForm-BGOxg12o.js";import{_ as ct}from"./TaskEditForm-DSFPEjpf.js";import{_ as mt,a as kt,b as yt}from"./TaskTreeView-ej6p1CoW.js";import{g as P}from"./datetime-BISRKKpq.js";import{_ as Y}from"./UserChip-CNtu4BR2.js";import{u as ft}from"./useTaskStore-O-jO3i0p.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-BdcHKc7v.js";import"./company-B9N2F3U6.js";import"./useRequirementStore-BtNTC4M5.js";import"./SectionLoading-Bh_eeVO2.js";const gt={key:0},vt={key:0},xt={key:1},bt=W({__name:"CountdownTimer",props:{targetDateTime:{}},setup(l){const s=l,e=C(o());let n;function o(){const m=new Date(s.targetDateTime).getTime()-new Date().getTime(),y=Math.floor(m/1e3%60),f=Math.floor(m/1e3/60%60),p=Math.floor(m/(1e3*60*60)%24),c=Math.floor(m/(1e3*60*60*24));return{total:m,days:c,hours:p,minutes:f,seconds:y}}function d(){e.value=o()}return J(()=>{n=setInterval(()=>{d(),e.value.total<=0&&clearInterval(n)},1e3)}),et(()=>clearInterval(n)),K(()=>s.targetDateTime,()=>{d(),clearInterval(n)}),(m,y)=>e.value.total>0?(r(),u("div",gt,[e.value.days?(r(),u("span",vt,g(e.value.days)+"d ",1)):v("",!0),t("span",null,g(e.value.hours.toString().padStart(2,"0"))+"h :",1),t("span",null,g(e.value.minutes.toString().padStart(2,"0"))+"m :",1),t("span",null,g(e.value.seconds.toString().padStart(2,"0"))+"s",1)])):(r(),u("div",xt,[A(m.$slots,"expired",{},()=>[y[0]||(y[0]=$("Timeâ€™s up!"))])]))}}),_t={class:"mb-3"},ht={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Tt={key:1,class:"text-center py-4 text-gray-500"},$t={key:2,class:"text-center py-4 text-red-500"},wt={key:3,class:"space-y-4"},Ct={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(l,{emit:s}){const e=l,n=s,o=C(null),{handleItemsPriorityUpdate:d,saveTaskPriority:m,listHasRearranged:y}=dt(()=>e.tasks,e.parentId),f=async()=>{await m(),n("updatePriority")};return(p,c)=>(r(),u("div",null,[t("div",_t,[A(p.$slots,"task:header")]),i(y)?(r(),u("div",ht,[c[3]||(c[3]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:S(f,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:c[0]||(c[0]=S((...k)=>o.value.resetItems&&o.value.resetItems(...k),["prevent"]))},"Discard")])):v("",!0),l.loading?(r(),u("div",Tt,"Loading tasks...")):l.error?(r(),u("div",$t,g(l.error),1)):(r(),u("div",wt,[x(ut,{items:l.tasks,handle:"handle",onItemsUpdate:i(d),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:o},{item:_(({item:k,index:h})=>[x(mt,{index:h,task:k,showDraggableHandle:!0,"tree-level":l.treeLevel,class:"!border-0",onCommentButtonClick:I=>n("commentButtonClick",k.id),onEditClick:c[1]||(c[1]=I=>n("editClick",I)),onAddClick:c[2]||(c[2]=I=>n("addClick",I))},null,8,["index","task","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},It={class:"flex justify-between mt-5"},St={class:"flex flex-wrap items-center gap-2 mt-3"},Dt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(l,{emit:s}){const e=l,n=s,o=C(),d=Q({show:!1,parentId:e.parentId,requirementId:null}),m=c=>{d.show=!0,d.parentId=c,console.log({addForm:d})};function y(){d.show=!1,d.parentId=e.parentId,n("created")}function f(){o.value=!1,n("updated")}function p(){d.show=!1,d.parentId=e.parentId}return(c,k)=>(r(),u("div",null,[o.value?(r(),w(L,{key:0},{default:_(()=>[x(ct,{taskId:o.value,onClose:k[0]||(k[0]=h=>o.value=null),onUpdated:f},null,8,["taskId"])]),_:1})):v("",!0),d.show?(r(),w(L,{key:1},{default:_(()=>[x(pt,{parentTaskId:d.parentId,requirementId:d.requirementId,onTaskCreated:y,onError:c.handleTaskError,onClose:p},null,8,["parentTaskId","requirementId","onError"])]),_:1})):v("",!0),x(Ct,{tasks:l.subTasks,parentId:l.parentId,treeLevel:l.treeLevel,onAddClick:k[2]||(k[2]=h=>m(h)),onEditClick:k[3]||(k[3]=h=>o.value=h),onUpdatePriority:k[4]||(k[4]=h=>n("updatePriority"))},{"task:header":_(()=>[t("div",It,[k[5]||(k[5]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),t("div",St,[t("button",{class:"btn-1 ml-auto",onClick:k[1]||(k[1]=S(()=>m(l.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId","treeLevel"])]))}},Ut={class:"min-w-full bg-white rounded overflow-hidden"},Pt={class:"py-0.5 text-bg font-semibold"},Lt={class:"px-2 py-1 border-y"},At={class:"px-2 py-1 border-y"},Et={class:"px-2 py-1 border-y text-center"},Mt={class:"px-2 py-1 border-y text-center"},Bt={class:"px-2 py-1 border-y text-center"},Nt={class:"px-2 py-1 border-y text-center"},Rt=W({__name:"TaskProgressTable",props:{progressUsers:{}},setup(l){return(s,e)=>(r(),u("table",Ut,[t("caption",Pt,[A(s.$slots,"caption",{},()=>[e[0]||(e[0]=$("Progress"))])]),e[1]||(e[1]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," User Progress "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," Task Progress ")])],-1)),t("tbody",null,[(r(!0),u(X,null,st(s.progressUsers,(n,o)=>(r(),u("tr",{key:n.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Lt,g(o+1),1),t("td",At,[x(Y,{user:n},null,8,["user"])]),t("td",Et,g(i(P)(n.started_at)),1),t("td",Mt,g(i(P)(n.finished_at)),1),t("td",Bt,g(n.user_progress)+"%",1),t("td",Nt,g(n.task_progress)+"%",1)]))),128))])]))}}),jt=at("task-user",()=>({updateUserStartDate:async(e,n,o)=>await O.patch(`/task-user/task/${e}/user/${n}/update-start-date/${o}`),updateUserFinishDate:async(e,n,o)=>await O.patch(`/task-user/task/${e}/user/${n}/update-finish-date/${o}`)})),Ft={class:"border-b text-center"},qt={key:0},Vt={key:1},Ot={class:"mb-2 mt-6"},zt={class:"flex justify-center"},Ht={class:"py-6"},Gt={class:"mt-2"},Wt={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Jt={class:"flex justify-between items-center"},Kt={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(l,{emit:s}){const e=l,n=s,o=jt(),d=C(""),m=C("");async function y(){var f,p;console.log({date:d.value});try{e.type=="start-date"?await o.updateUserStartDate(e.task.id,e.user.id,d.value||"0"):e.type=="finish-date"&&await o.updateUserFinishDate(e.task.id,e.user.id,d.value||"0"),n("updateDate")}catch(c){m.value=((p=(f=c.response)==null?void 0:f.data)==null?void 0:p.message)||`Failed to update ${e.type}`}}return(f,p)=>(r(),u("form",{class:"p-4",onSubmit:S(y,["prevent"])},[t("div",Ft,[l.type=="start-date"?(r(),u("h2",qt,"Edit Start Date")):l.type=="finish-date"?(r(),u("h2",Vt,"Edit Finish Date")):v("",!0)]),t("div",Ot,[p[2]||(p[2]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,g(l.task.title),1)]),t("div",null,[p[3]||(p[3]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"User:",-1)),x(Y,{user:l.user},null,8,["user"])]),t("div",zt,[t("div",Ht,[p[4]||(p[4]=t("label",{class:"block text-xs font-semibold"},"Date",-1)),rt(t("input",{type:"date","onUpdate:modelValue":p[0]||(p[0]=c=>d.value=c),class:"border py-2 px-4 rounded-md",size:"8"},null,512),[[nt,d.value]])])]),t("div",Gt,[m.value?(r(),u("div",Wt,g(m.value),1)):v("",!0)]),t("div",Jt,[p[5]||(p[5]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1)),t("button",{class:"btn-3",onClick:p[1]||(p[1]=S(c=>n("closeClick"),["prevent"]))},"Close")])],32))}},Qt=l=>l==null?void 0:l.reduce((s,e)=>s+e.task_weight,0),Xt=(l,s)=>{const e=Qt(l);return l.map(n=>{const o=s.filter(d=>d.user_id===n.id).reduce((d,m)=>d+m.progress,0);return{...n,task_progress:Math.floor(o*(n.task_weight/e)),user_progress:o}})},Yt={class:"container mx-auto p-6"},Zt={key:2,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},te={class:"grid grid-cols-4"},ee={class:"mb-4 flex col-span-full"},se={class:"font-medium text-xl"},ae={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},re={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},ne={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},oe={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},le={class:"mt-4 col-span-full mb-6"},ie={class:"ml-auto text-right text-sm col-span-full"},de={key:1,class:"text-gray-500"},ue={class:"font-semibold text-green-800"},pe={key:2,class:"ml-4 text-gray-500"},ce={class:"text-red-500 font-semibold"},me={class:"py-2 flex justify-center items-center gap-2 col-span-full"},ke={class:"ml-auto flex gap-4"},ye={key:0},fe={key:1},ge={key:1,class:"text-center py-4 text-red-500"},Le={__name:"TaskShow",setup(l){const s=ft(),e=ot(),n=lt();it();const o=C(""),d=D(()=>s.tasks),m=C({});J(async()=>{o.value="loading",await f(e.params.id),o.value=""});const y=Q({user:null,type:""});async function f(T){await s.fetchTask(T)}const p=D(()=>Xt(s.task.users,s.task.task_reports||[])),c=D(()=>P(s.task.started_at)),k=D(()=>P(s.task.deadline));async function h(){await f(e.params.id),y.user=null,y.type=""}const I=T=>{n.push({name:"TaskEdit",params:{id:T}})},Z=D(()=>{var T,a;return s.task?((T=s.task)==null?void 0:T.parent_id)==0?{name:"TaskList"}:{name:"TaskShow",params:{id:(a=s.task)==null?void 0:a.parent_id}}:null});return K(()=>e.params.id,async T=>{o.value="changing",await f(T),o.value=""}),(T,a)=>{var E,M,B,N,R,j,F,q;const U=z("RouterLink"),tt=z("router-view");return r(),u("div",Yt,[y.user?(r(),w(L,{key:0},{default:_(()=>[x(Kt,{task:i(s).task,user:y.user,type:y.type,onCloseClick:a[0]||(a[0]=b=>y.user=null),onUpdateDate:h},null,8,["task","user","type"])]),_:1})):v("",!0),o.value==="loading"?(r(),w(G,{key:1})):(r(),u("div",Zt,[i(s).task?(r(),u(X,{key:0},[t("section",te,[t("div",ee,[t("div",null,[t("h2",se,g(i(s).task.title),1),t("div",ae,[(E=i(s).task)!=null&&E.is_important?(r(),u("span",re,"IMPORTANT")):v("",!0),(M=i(s).task)!=null&&M.is_urgent?(r(),u("span",ne,"URGENT")):v("",!0)])]),t("div",oe,[x(kt,{status:(B=i(s).task)==null?void 0:B.status,progressPercent:(N=i(s).task)==null?void 0:N.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),i(s).task?(r(),w(yt,{key:0,task:i(s).task,ref_key:"progress",ref:m,class:"!text-lg"},null,8,["task"])):v("",!0)])]),t("section",le,[x(Rt,{"progress-users":p.value},{caption:_(()=>a[9]||(a[9]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["progress-users"])]),t("div",ie,[i(s).task.deadline?(r(),w(bt,{key:0,targetDateTime:i(s).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):v("",!0),c.value?(r(),u("span",de,[a[10]||(a[10]=$(" Started: ")),t("span",ue,g(c.value),1)])):v("",!0),k.value?(r(),u("span",pe,[a[11]||(a[11]=$(" Deadline: ")),t("span",ce,g(k.value),1)])):v("",!0)]),a[16]||(a[16]=t("hr",{class:"my-3 col-span-full"},null,-1)),t("div",me,[t("button",{onClick:a[1]||(a[1]=S(b=>{var V;return I((V=i(s).task)==null?void 0:V.id)},["stop"])),class:"btn-2 py-0.5"},"Edit"),x(U,{to:{name:"TaskUserAssign",params:{id:(R=i(s).task)==null?void 0:R.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:a[2]||(a[2]=b=>b.stopPropagation())},{default:_(()=>a[12]||(a[12]=[t("i",{class:"fas fa-user-plus"},null,-1),$(" Assign Users ")])),_:1,__:[12]},8,["to"]),x(U,{to:Z.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:a[3]||(a[3]=b=>b.stopPropagation())},{default:_(()=>a[13]||(a[13]=[t("i",{class:"fas fa-arrow-left"},null,-1),$(" Back ")])),_:1,__:[13]},8,["to"]),t("div",ke,[d.value.length>0?(r(),w(U,{key:0,to:{name:"TaskShow",params:{id:(j=i(s).task)==null?void 0:j.id}},onClick:a[4]||(a[4]=b=>b.stopPropagation()),class:H(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":i(e).name=="TaskShow"}])},{default:_(()=>a[14]||(a[14]=[t("i",{class:"fal fa-list-ul"},null,-1),$(" Sub Tasks ")])),_:1,__:[14]},8,["to","class"])):v("",!0),x(U,{to:{name:"TaskReports",params:{id:(F=i(s).task)==null?void 0:F.id}},onClick:a[5]||(a[5]=b=>b.stopPropagation()),class:H(["py-1 btn-3",{"bg-blue-500 text-white":i(e).name=="TaskReports"}])},{default:_(()=>a[15]||(a[15]=[t("i",{class:"fal fa-file-alt"},null,-1),$(" Reports ")])),_:1,__:[15]},8,["to","class"])])])]),i(e).name=="TaskShow"&&((q=i(s).task)==null?void 0:q.level)<=2?(r(),u("section",ye,[x(Dt,{subTasks:d.value,"parent-id":i(e).params.id,"tree-level":i(s).task.level+1,onCreated:a[6]||(a[6]=b=>f(i(e).params.id)),onUpdated:a[7]||(a[7]=b=>f(i(e).params.id)),onUpdatePriority:a[8]||(a[8]=b=>f(i(e).params.id))},null,8,["subTasks","parent-id","tree-level"])])):(r(),u("section",fe,[x(tt)]))],64)):(r(),u("div",ge,g(i(s).error),1)),o.value==="changing"?(r(),w(G,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):v("",!0)]))])}}};export{Le as default};
