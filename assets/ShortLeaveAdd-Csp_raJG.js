import{u as I,r as m,q as U,p as A,b as P,c as i,a,l as C,m as $,w as j,d as u,v,A as O,e as p,F as W,x as z,h as G,t as B,f as J,n as K,o as n,k as Q,g as X}from"./index-CBF_IMfm.js";import{L as Y}from"./LoaderView-BpujvEg8.js";import{u as Z}from"./short-leave-Bf4529t5.js";import{u as ee}from"./user-B5tbGnsA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"max-w-3xl mx-auto p-4 space-y-4"},ae={class:"flex items-center justify-between gap-2"},le={key:0,class:"text-center"},se={key:0},oe={key:1},ie={key:2},ne={key:3},ue={key:4},re=["value"],de={key:5,class:"text-red-500 text-sm"},ke={__name:"ShortLeaveAdd",setup(me){const F=J(),g=X(),D=Z(),L=ee(),x=I(),_=m(null),{type:f,start_time:b,end_time:V}=F.query,y=m(""),c=m(""),w=new Date().toISOString().split("T")[0],t=m({date:w,time:"22:30",start_time:"",end_time:"",reason:"",works_in_hand:"",handover_user_id:"",total_minute:"",type:""}),k=m(!1),d=m(null);U(()=>t.value.date,async s=>{M()});const h=A(()=>{if(!t.value.start_time||!_.value.start_time)return 0;const s=N=>new Date(`1970-01-01T${N}`),e=s(t.value.start_time),o=t.value.end_time?s(t.value.end_time):null,l=s(_.value.start_time),T=s(_.value.end_time);let r=0;return t.value.type==="Delay"?r=(e-l)/(1e3*60):t.value.type==="Early"?r=(T-e)/(1e3*60):o&&(r=(o-e)/(1e3*60)),Math.round(r)});U(()=>t.value.type,s=>{if(!y.value&&!c.value)return;console.log({newType:s},c.value,y.value);const e=o=>o&&o.includes(" ")?o.split(" ")[1]:"";s==="Delay"&&y.value?t.value.start_time=e(y.value):s==="Early"&&c.value?t.value.start_time=e(c.value):t.value.start_time=""}),U(()=>[t.value.start_time,t.value.end_time,t.value.type],()=>{t.value.total_minute=h.value});const E=A(()=>h.value>30),H=async()=>{var s;k.value=!0,d.value=null;try{const e={user_id:(s=x==null?void 0:x.user)==null?void 0:s.id,...t.value},o=await D.createShortLeave(e);g.push({name:"ShortLeaveShow",params:{id:o.id}})}catch(e){d.value=e.message||"Failed to submit short leave application"}finally{k.value=!1}},M=async()=>{k.value=!0,d.value=null;try{const s={date:t.value.date},e=await D.fetchCreateShortLeaveData(s);_.value=e==null?void 0:e.shift,y.value=e==null?void 0:e.entry_time,c.value=e==null?void 0:e.exit_time}catch(s){d.value=s.message||"Failed to submit short leave application"}finally{k.value=!1}},q=s=>s?s.split(" ")[0]:w,S=s=>{if(!s)return null;const e=s.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!e)return null;let[o,l,T,r]=e;return l=parseInt(l,10),r.toUpperCase()==="PM"&&l<12&&(l+=12),r.toUpperCase()==="AM"&&l===12&&(l=0),`${l.toString().padStart(2,"0")}:${T}`};P(()=>{M(),L.fetchUsers(),t.value.date=q(f==="Delay"||f==="Early"?time:w),t.value.date=q(f==="Delay"?b:f==="Early"?V:w),t.value.type=f||"",t.value.time=b?S(b):"22:30",t.value.start_time=S(b)||"",t.value.end_time=S(V)||""});const R=()=>{g.go(-1)};return(s,e)=>{const o=K("RouterLink");return n(),i("div",te,[a("div",ae,[a("button",{class:"btn-3",onClick:R},e[8]||(e[8]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),e[10]||(e[10]=a("h1",{class:"title-lg flex-wrap text-center"},"Short Leave Application Form",-1)),a("div",null,[C(o,{to:"/my-applications",class:"btn-2"},{default:$(()=>e[9]||(e[9]=[Q("Home")])),_:1})])]),k.value?(n(),i("div",le,[C(Y)])):(n(),i("form",{key:1,onSubmit:j(H,["prevent"]),class:"space-y-4 card-bg md:p-8 p-4"},[a("div",null,[e[11]||(e[11]=a("label",{for:"date",class:"block text-sm font-medium"},"Date",-1)),u(a("input",{type:"date",id:"date","onUpdate:modelValue":e[0]||(e[0]=l=>t.value.date=l),class:"input-1 w-full",required:""},null,512),[[v,t.value.date]])]),a("div",null,[e[13]||(e[13]=a("label",{for:"type",class:"block text-sm font-medium"},"Type",-1)),u(a("select",{id:"type","onUpdate:modelValue":e[1]||(e[1]=l=>t.value.type=l),class:"input-1 w-full",required:""},e[12]||(e[12]=[a("option",{value:""},"Select Type",-1),a("option",{value:"Delay"},"Delay",-1),a("option",{value:"OfficeTime"},"Office Time",-1),a("option",{value:"Early"},"Early",-1)]),512),[[O,t.value.type]])]),t.value.type!=="OfficeTime"?(n(),i("div",se,[e[14]||(e[14]=a("label",{for:"start-time",class:"block text-sm font-medium"},"Time",-1)),u(a("input",{type:"time",id:"start-time","onUpdate:modelValue":e[2]||(e[2]=l=>t.value.start_time=l),class:"input-1 w-full",required:""},null,512),[[v,t.value.start_time]])])):p("",!0),t.value.type==="OfficeTime"?(n(),i("div",oe,[e[15]||(e[15]=a("label",{for:"start-time",class:"block text-sm font-medium"},"Start Time",-1)),u(a("input",{type:"time",id:"start-time","onUpdate:modelValue":e[3]||(e[3]=l=>t.value.start_time=l),class:"input-1 w-full",required:""},null,512),[[v,t.value.start_time]])])):p("",!0),t.value.type==="OfficeTime"?(n(),i("div",ie,[e[16]||(e[16]=a("label",{for:"end-time",class:"block text-sm font-medium"},"End Time",-1)),u(a("input",{type:"time",id:"end-time","onUpdate:modelValue":e[4]||(e[4]=l=>t.value.end_time=l),class:"input-1 w-full",required:""},null,512),[[v,t.value.end_time]])])):p("",!0),a("div",null,[e[17]||(e[17]=a("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),u(a("textarea",{id:"reason","onUpdate:modelValue":e[5]||(e[5]=l=>t.value.reason=l),class:"input-1 w-full",placeholder:"Enter your reason for leave",required:""},null,512),[[v,t.value.reason]])]),E.value?(n(),i("div",ne,[e[18]||(e[18]=a("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),u(a("textarea",{id:"works-in-hand","onUpdate:modelValue":e[6]||(e[6]=l=>t.value.works_in_hand=l),class:"input-1 w-full",placeholder:"Enter details of works in hand"},null,512),[[v,t.value.works_in_hand]])])):p("",!0),E.value?(n(),i("div",ue,[e[20]||(e[20]=a("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),u(a("select",{id:"handover-user","onUpdate:modelValue":e[7]||(e[7]=l=>t.value.handover_user_id=l),class:"input-1 w-full",required:""},[e[19]||(e[19]=a("option",{value:""},"Select Handover User",-1)),(n(!0),i(W,null,z(G(L).users,l=>(n(),i("option",{key:l.id,value:l.id},B(l.name),9,re))),128))],512),[[O,t.value.handover_user_id]])])):p("",!0),d.value?(n(),i("div",de,B(d.value),1)):p("",!0),e[21]||(e[21]=a("div",{class:"flex justify-center"},[a("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{ke as default};
