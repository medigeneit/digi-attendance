import{_ as F,D as I,r as N,x as D,q as P,h as T,c as r,o,a as e,b as g,t as n,l as G,G as M,n as l,F as p,e as y,d as j,k as S,s as z}from"./index-BUix9B9b.js";import{L as q}from"./LoaderView-DHmsjDX9.js";import{t as L}from"./todos-CHsG8mDp.js";import{u as E}from"./kpi-report-CJZ57bPX.js";const O={class:"space-y-4 px-4 print:px-0"},U={class:"hidden print:block mx-auto text-center mb-3"},W={class:"text-sm text-gray-600"},A={class:"font-medium"},H={class:"flex flex-wrap items-end gap-3 sticky top-0 z-10 bg-white/80 backdrop-blur print:hidden p-2 -mx-2 rounded-md border border-gray-100"},J={class:"flex items-center gap-2"},Q=["disabled"],X=["value"],Z={key:0,class:"py-10 text-center"},$={key:1,class:"rounded-md border border-red-200 bg-red-50 p-3 text-red-700",role:"alert","aria-live":"polite"},ee={key:2,class:"space-y-3 md:hidden"},te={class:"flex items-center justify-between"},se=["title"],re={class:"text-xs text-gray-500"},oe={class:"mt-2 grid grid-cols-2 gap-2"},ae=["title"],ne={class:"text-sm font-semibold mt-1"},le={key:0,class:"px-3 py-6 text-center text-gray-600"},de={class:"hidden md:block overflow-x-auto rounded-xl border bg-white shadow-sm"},ie={class:"table table-auto w-full text-sm"},ce={class:"text-gray-800 sticky top-0 z-[5]"},ue={class:"bg-gray-100/95 backdrop-blur"},pe={class:"text-xs"},ye={class:"text-gray-800"},me={class:"sticky left-0 z-[4] border-r bg-inherit px-2 text-center"},xe={class:"sticky z-[4] border-r bg-inherit px-2",style:{left:"2rem"}},be=["title"],_e={key:0},ge={__name:"YearlyDepartmentalKpiReport",setup(fe){const f=E(),{meta:V,rows:c,isLoading:v,error:h}=I(f),k=new Date().getFullYear(),u=N(k),w=N([]),C=D(()=>{var a;return((a=V.value)==null?void 0:a.columns)||[]}),_=D(()=>C.value.filter(a=>a.key!=="sl"&&a.key!=="department"));function R(a=2020,s=k+1){const t=[];for(let i=s;i>=a;i--)t.push(i);w.value=t}P(u,()=>{const a=Number(u.value);!Number.isInteger(a)||a<2e3||a>2100||Y()});function K(){window.print()}function B(){return new Date().toLocaleString()}async function Y(){try{await f.fetchYearly({year:Number(u.value)})}catch(a){console.error("fetchYearly failed:",a)}}return T(()=>{R(),Y()}),(a,s)=>(o(),r("div",O,[e("div",U,[s[3]||(s[3]=e("h1",{class:"text-xl font-semibold text-gray-900"},"Yearly KPI Report",-1)),e("div",W,[s[1]||(s[1]=g(" Year: ")),e("span",A,n(u.value),1),s[2]||(s[2]=g(" â€¢ Generated: ")),e("span",null,n(B()),1)])]),e("div",H,[e("div",J,[s[4]||(s[4]=e("label",{class:"text-xs font-medium text-gray-600"},"Year",-1)),G(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>u.value=t),class:"w-32 rounded border border-gray-300 bg-white px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50 disabled:opacity-60",disabled:l(v),"aria-label":"Select year"},[(o(!0),r(p,null,y(w.value,t=>(o(),r("option",{key:t,value:t},n(t),9,X))),128))],8,Q),[[M,u.value,void 0,{number:!0}]])]),e("div",{class:"ml-auto flex gap-2"},[e("button",{class:"btn-3 !py-1.5 !px-3",onClick:K},s[5]||(s[5]=[e("i",{class:"far fa-print mr-1"},null,-1),g(" Print ")]))])]),l(v)?(o(),r("div",Z,[j(q)])):l(h)?(o(),r("div",$,n(l(h)),1)):(o(),r("div",ee,[(o(!0),r(p,null,y(l(c),(t,i)=>(o(),r("div",{key:"card-"+t.key,class:"rounded-xl border border-gray-200 bg-white shadow-sm p-3 break-inside-avoid"},[e("div",te,[e("div",{class:"text-sm font-medium text-gray-900 truncate",title:t.name},n(i+1)+". "+n(t.name),9,se),e("div",re,"Total: "+n(t.employees_total),1)]),e("div",oe,[(o(!0),r(p,null,y(_.value,d=>{var m,x,b;return o(),r("div",{key:d.key,class:z(["rounded-lg border border-gray-200 p-2 text-center",l(L)((m=t.cells)==null?void 0:m[d.key])])},[e("div",{class:"text-[11px] font-medium text-gray-600 truncate",title:d.label},n(d.label),9,ae),e("div",ne,n(((b=(x=t.cells)==null?void 0:x[d.key])==null?void 0:b.display)||"0/0"),1)],2)}),128))])]))),128)),!l(c)||l(c).length===0?(o(),r("div",le," No data ")):S("",!0)])),e("div",de,[e("table",ie,[e("thead",ce,[e("tr",ue,[s[6]||(s[6]=e("th",{class:"sticky left-0 z-[6] border-y border-r bg-gray-100/95 px-2 py-2 text-center",style:{"min-width":"2.25rem",width:"2.25rem"}}," SL ",-1)),s[7]||(s[7]=e("th",{class:"sticky z-[6] border-y border-r bg-gray-100/95 px-2 py-2 text-left",style:{left:"2rem",minWidth:"12.5rem",width:"12.5rem"}}," Department ",-1)),(o(!0),r(p,null,y(_.value,t=>(o(),r("th",{key:t.key,class:"border-y border-r px-2 py-2 text-center font-medium"},[e("span",pe,n(t.label),1)]))),128))])]),e("tbody",ye,[(o(!0),r(p,null,y(l(c),(t,i)=>(o(),r("tr",{key:t.key,class:"border-t even:bg-gray-100 hover:bg-sky-500/40 transition-colors break-inside-avoid"},[e("td",me,n(i+1),1),e("td",xe,[e("div",{class:"truncate max-w-48 white-space-wrap",title:t.name},n(t.name),9,be)]),(o(!0),r(p,null,y(_.value,d=>{var m,x,b;return o(),r("td",{key:d.key,class:"border-r text-center px-2 py-1"},[e("span",{class:z(["inline-block rounded py-0.5 px-1.5 font-mono text-[12px]",l(L)((m=t.cells)==null?void 0:m[d.key])])},n(((b=(x=t.cells)==null?void 0:x[d.key])==null?void 0:b.display)||"0/0"),3)])}),128))]))),128)),!l(c)||l(c).length===0?(o(),r("tr",_e,s[8]||(s[8]=[e("td",{colspan:"100",class:"px-3 py-6 text-center text-gray-600"},"No data",-1)]))):S("",!0)])])])]))}},Ye=F(ge,[["__scopeId","data-v-09c526d4"]]);export{Ye as default};
