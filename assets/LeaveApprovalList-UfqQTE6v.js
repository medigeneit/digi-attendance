import{r as k,D as I,G as D,q as N,h as F,c as r,j as h,o as l,a as t,t as d,w as z,d as b,k as G,v as H,m as w,F as j,e as R,u as J,x as K,S as P}from"./index-Bffdaa73.js";import{_ as O}from"./MultiselectDropdown-TvW9ACnY.js";import{u as Q}from"./department-Dfj9hYR_.js";import{u as W}from"./user-CD2yCELJ.js";import{_ as X}from"./DeleteModal-DqF0GqEd.js";import{_ as Y}from"./HeaderWithButtons-BOrPKh6J.js";import{L as Z}from"./LoaderView-N3izsgv3.js";import{u as A}from"./leave-approval-Cv3gRRTr.js";const ee={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},te={class:"bg-white rounded-lg shadow-lg w-full max-w-lg"},se={class:"px-6 py-4 border-b"},oe={class:"text-lg font-bold capitalize"},ae={key:0},re=["for"],le={class:"flex justify-end space-x-4"},ne={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"},de={__name:"LeaveApprovalModal",props:{show:{type:Boolean,required:!0},leaveApproval:{type:Object,default:null},approvalType:{type:String,default:"leave"}},emits:["close","save"],setup(v,{emit:$}){const i=v,c=$,_=k(null),m=W(),x=Q(),{departments:p}=I(x),f=k(!1),n=D({id:null,name:"",department_id:"",in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),u=D({in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null}),C=()=>{Object.keys(u).forEach(e=>{u[e]=m.users.find(a=>a.id===n[e])||null})};Object.keys(u).forEach(e=>{N(()=>u[e],a=>{console.log(a),n[e]=a?a.id:null})});const g=()=>{Object.assign(n,{id:null,name:"",department_id:"",in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),f.value=!1},M=()=>{Object.assign(u,{in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),f.value=!1};N(()=>i.leaveApproval,e=>{e?(f.value=!0,Object.assign(n,e),C()):(g(),M())},{immediate:!0,deep:!0}),N(()=>_.value,e=>{n.department_id=(e==null?void 0:e.id)||null});const S=()=>{if(!n.name||!n.approved_by_user_id){alert("Name and Approved By are required!");return}c("save",{...n}),o()},o=()=>{g(),c("close")};return F(()=>{m.fetchUsers(),x.fetchDepartments()}),(e,a)=>v.show?(l(),r("div",ee,[t("div",te,[t("div",se,[t("h3",oe,d(f.value?"Edit":"Add")+" "+d(v.approvalType)+" Approval ",1)]),t("form",{onSubmit:z(S,["prevent"]),class:"p-6 space-y-4"},[t("div",null,[a[2]||(a[2]=t("label",{for:"name",class:"block text-sm font-medium"},"Approval Name",-1)),G(t("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=s=>n.name=s),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter approval name",required:""},null,512),[[H,n.name]])]),b(O,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=s=>_.value=s),multiple:!1,label:"name",options:w(p),placeholder:"Choose department"},null,8,["modelValue","options"]),(l(),r(j,null,R({in_charge_user_id:"In-Charge",coordinator_user_id:"Coordinator",operational_admin_user_id:"Operational Admin",recommend_by_user_id:"Recommend By",approved_by_user_id:"Approved By"},(s,y)=>(l(),r(j,{key:y},[v.approvalType==="leave"||!["coordinator_user_id","operational_admin_user_id"].includes(y)?(l(),r("div",ae,[t("label",{for:y,class:"block text-sm font-medium"},d(s),9,re),b(O,{modelValue:u[y],"onUpdate:modelValue":L=>u[y]=L,multiple:!1,label:"name","label-prefix":"employee_id",options:w(m).users},null,8,["modelValue","onUpdate:modelValue","options"])])):h("",!0)],64))),64)),t("div",le,[t("button",{type:"button",onClick:o,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400"}," Cancel "),t("button",ne,d(f.value?"Update":"Create"),1)])],32)])])):h("",!0)}},ie={class:"my-container space-y-2"},ue={class:"overflow-x-auto"},ce={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},_e={class:"bg-gray-200 text-gray-700 text-sm leading-normal"},pe={key:0,class:"py-3 px-2 text-left"},me={key:1,class:"py-3 px-2 text-left"},ye={class:"text-gray-600 text-sm"},fe={key:0},xe={colspan:"8"},he={class:"py-3 px-2 text-left"},be={class:"py-3 px-2 text-left"},ve={class:"py-3 px-2 text-left"},ge={class:"py-3 px-2 text-left"},ke={key:0,class:"py-3 px-2 text-left"},we={key:1,class:"py-3 px-2 text-left"},Le={class:"py-3 px-2 text-left"},$e={class:"py-3 px-2 text-left"},Ce={class:"py-3 px-2 text-center"},Me={class:"flex justify-center gap-4"},Se=["onClick"],Ne=["onClick"],je={key:2},Re={__name:"LeaveApprovalList",setup(v){const $=J(),i=K(()=>$.currentRoute.value.name==="LeaveApprovalList"?"leave":"other"),c=A(),_=P(),m=k(!1),x=k(!1),p=k(null),f=()=>{p.value=null,m.value=!0},n=o=>{p.value={...o},m.value=!0},u=()=>{m.value=!1},C=o=>{p.value=o,x.value=!0},g=()=>{x.value=!1},M=async()=>{var o;if(!((o=p.value)!=null&&o.id)){_.error("Invalid leave approval selected for deletion!");return}try{await c.deleteLeaveApproval(p.value.id),_.success("Leave approval deleted successfully!")}catch(e){_.error("Failed to delete leave approval!"),console.error("Error deleting leave approval:",e)}finally{g()}},S=async o=>{o.id||(o={...o,type:i.value});const e=o.id?"updateLeaveApproval":"createLeaveApproval",a=o.id?"Leave approval updated successfully!":"Leave approval added successfully!";try{await c[e](o.id||o,o),_.success(a)}catch(s){_.error("Failed to save leave approval!"),console.error("Error saving leave approval:",s)}finally{u()}};return F(()=>{c.fetchLeaveApprovals({type:i.value})}),(o,e)=>{var a;return l(),r("div",ie,[b(Y,{title:`${i.value} Approvals`,onAdd:f},null,8,["title"]),t("div",ue,[t("table",ce,[t("thead",null,[t("tr",_e,[e[0]||(e[0]=t("th",{class:"py-3 px-2 text-left"},"#",-1)),e[1]||(e[1]=t("th",{class:"py-3 px-2 text-left"},"Name",-1)),e[2]||(e[2]=t("th",{class:"py-3 px-2 text-left"},"Department",-1)),e[3]||(e[3]=t("th",{class:"py-3 px-2 text-left"},"In-Charge",-1)),i.value==="leave"?(l(),r("th",pe,"Coordinator")):h("",!0),i.value==="leave"?(l(),r("th",me,"Operational Admin")):h("",!0),e[4]||(e[4]=t("th",{class:"py-3 px-2 text-left"},"Recommend By",-1)),e[5]||(e[5]=t("th",{class:"py-3 px-2 text-left"},"Approved By",-1)),e[6]||(e[6]=t("th",{class:"py-3 px-2 text-center"},"Actions",-1))])]),t("tbody",ye,[w(c).loading?(l(),r("tr",fe,[t("td",xe,[b(Z,{class:"shadow-none"})])])):w(c).leaveApprovals.length?(l(!0),r(j,{key:1},R(w(c).leaveApprovals,(s,y)=>{var L,V,B,E,T,U;return l(),r("tr",{key:y,class:"border-b border-gray-200 hover:bg-blue-200"},[t("td",he,d(y+=1),1),t("td",be,d(s==null?void 0:s.name),1),t("td",ve,d((L=s==null?void 0:s.department)==null?void 0:L.name),1),t("td",ge,d(((V=s==null?void 0:s.in_charge_user)==null?void 0:V.name)||"N/A"),1),i.value==="leave"?(l(),r("td",ke,d(((B=s==null?void 0:s.coordinator_user)==null?void 0:B.name)||"N/A"),1)):h("",!0),i.value==="leave"?(l(),r("td",we,d(((E=s==null?void 0:s.operational_admin_user)==null?void 0:E.name)||"N/A"),1)):h("",!0),t("td",Le,d(((T=s==null?void 0:s.recommend_by_user)==null?void 0:T.name)||"N/A"),1),t("td",$e,d(((U=s==null?void 0:s.approved_by_user)==null?void 0:U.name)||"N/A"),1),t("td",Ce,[t("div",Me,[t("button",{onClick:q=>n(s),class:"text-blue-600 hover:text-blue-800"},e[7]||(e[7]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Se),t("button",{onClick:q=>C(s),class:"text-red-600 hover:text-red-800"},e[8]||(e[8]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Ne)])])])}),128)):(l(),r("tr",je,e[9]||(e[9]=[t("td",{colspan:"8",class:"text-center text-red-500 py-4"},"No leave approvals found",-1)])))])])]),b(de,{show:m.value,leaveApproval:p.value,approvalType:i.value,onClose:u,onSave:S},null,8,["show","leaveApproval","approvalType"]),b(X,{show:x.value,title:`Delete ${i.value} Approval`,message:`Are you sure you want to delete ${(a=p.value)==null?void 0:a.name}?`,onClose:g,onConfirm:M},null,8,["show","title","message"])])}}};export{Re as default};
