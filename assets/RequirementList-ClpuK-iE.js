import{L as Q}from"./LoaderView-BKmib88_.js";import{_ as F}from"./DepartmentChip-t-IUX34W.js";import{d as O,n as W,c as n,o as a,a as e,F as H,y as K,t as c,p as _,i as R,g as M,f as A,x as N,k as f,j as z,b as Y,m as V,r as X,e as J,A as E,h as Z,v as G,u as q}from"./index-BWHPSiOr.js";import{_ as S}from"./UserChip-D5c2B9JK.js";import{g as tt}from"./task-D01iKYE7.js";import{u as et}from"./company-BXfFB1oq.js";import{_ as I}from"./CompanyDepartmentSelectInput-ChN_oQ_3.js";import{_ as st}from"./EmployeeDropdownInput-DDy12CVZ.js";import{S as at}from"./SelectDropdown-BCU95NIg.js";import{u as ot}from"./useRequirementStore-QY4I93_l.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./url-CePbr-gY.js";import"./requirement-D1PWfLtO.js";const nt={class:"min-w-full bg-white border overflow-hidden table table-fixed"},lt={key:0},dt={class:"px-4 py-4 font-semibold text-xl text-gray-700 border border-gray-200 text-center"},it={class:"px-4 py-4 min-w-[300px] md:min-w-[400px] border border-gray-200"},rt={class:"space-y-4"},mt={class:"text-blue-800"},ut=["title"],pt={key:0},ct={class:"flex gap-6 items-center mt-6"},xt={key:0,class:"text-gray-600 text-xs flex items-center gap-2 whitespace-nowrap"},yt={class:"flex items-center gap-2 whitespace-nowrap"},_t={class:"px-4 py-4 whitespace-nowrap border border-gray-200"},ft=["title"],bt={class:"flex items-center gap-2 mt-4"},gt={key:1},vt={class:"flex items-center gap-2 mt-1"},ht={key:1},wt={key:0,class:"text-xs text-red-300"},kt={key:1,class:"italic text-xs text-gray-400"},Vt={class:"px-4 py-4 whitespace-nowrap border border-gray-200"},At=["title"],Rt={class:"flex items-center gap-2 mt-4"},$t={key:1},Dt={key:0,class:"text-xs text-red-300"},Tt={key:1,class:"italic text-xs text-gray-400"},Ct={class:"flex items-center gap-2 mt-2"},Lt={key:1},St={key:0,class:"text-xs text-red-300"},Mt={key:1,class:"italic text-xs text-gray-400"},Nt={class:"px-4 py-4 text-center whitespace-nowrap border border-gray-200"},zt={key:0,class:"text-gray-600 text-sm"},Et={class:"mb-1"},Pt={class:"flex justify-between items-center gap-1"},Ut={key:1},jt={class:"px-4 py-4 text-center border border-gray-200"},Bt={class:"flex gap-4 items-center justify-center"},Ft={__name:"RequirementTable",props:{requirements:{type:Array,default:()=>[]}},setup(T){const u=O();return(b,s)=>{var y;const x=W("RouterLink");return a(),n("table",nt,[s[13]||(s[13]=e("thead",{class:"bg-gray-100 text-gray-400 text-xs"},[e("tr",null,[e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap border w-[4%]"},"#"),e("th",{class:"px-4 py-0.5 text-left whitespace-nowrap border w-[60%]"},"Requirement"),e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"From Department"),e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"To Department"),e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"Submitted At"),e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"Actions")])],-1)),e("tbody",null,[((y=T.requirements)==null?void 0:y.length)===0?(a(),n("tr",lt,s[2]||(s[2]=[e("td",{colspan:"10",class:"p-4"},[e("div",{class:"text-gray-500 italic w-full h-64 flex items-center justify-center"}," No Requirement Found ")],-1)]))):(a(!0),n(H,{key:1},K(T.requirements,(t,i)=>{var l,r,g,m,C,v,$,L,p,o,h,w,k,d,P,U,j;return a(),n("tr",{key:t.id,class:"border-t hover:bg-blue-50 odd:bg-gray-50 group/item"},[e("td",dt,c(i+1),1),e("td",it,[e("div",rt,[_(x,{to:{name:"RequirementShow",params:{id:t==null?void 0:t.id}},class:"text-blue-600 text-sm hover:underline hover:text-blue-800"},{default:R(()=>{var D,B;return[e("div",mt,[e("div",{class:"line-clamp-1 font-semibold",title:t==null?void 0:t.title},c(t==null?void 0:t.title),9,ut)]),((D=t==null?void 0:t.details)==null?void 0:D.length)-1>0?(a(),n("span",pt,c(((B=t==null?void 0:t.details)==null?void 0:B.length)-1)+" More Requirement ",1)):M("",!0)]}),_:2},1032,["to"])]),e("div",ct,[t.created_at?(a(),n("div",xt,[s[3]||(s[3]=e("i",{class:"fas fa-clock text-sky-800/50"},null,-1)),e("div",null,c(new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)])):M("",!0),e("div",yt,[s[4]||(s[4]=e("span",{class:"text-xs text-gray-500"},"By:",-1)),t.created_by?(a(),A(S,{key:0,user:t.created_by,"avatar-size":"xsmall"},null,8,["user"])):M("",!0)])])]),e("td",_t,[e("span",{title:(l=t==null?void 0:t.from_department)==null?void 0:l.name,class:N([{"bg-green-500 text-white group-hover/item:text-white":((r=t==null?void 0:t.from_department)==null?void 0:r.id)==((m=(g=f(u))==null?void 0:g.user)==null?void 0:m.department_id)},"text-blue-500 font-semibold flex-shrink-0 border border-blue-500 bg-blue-50 rounded-full px-2 text-xs"])},c(((C=t==null?void 0:t.from_department)==null?void 0:C.short_name)||((v=t==null?void 0:t.from_department)==null?void 0:v.name)),11,ft),e("div",bt,[s[6]||(s[6]=e("div",{class:"text-xs text-gray-500"},"In Charge:",-1)),($=t==null?void 0:t.from_department)!=null&&$.in_charge?(a(),A(S,{key:0,user:(L=t==null?void 0:t.from_department)==null?void 0:L.in_charge,"avatar-size":"xsmall"},null,8,["user"])):(a(),n("div",gt,s[5]||(s[5]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)])))]),e("div",vt,[s[7]||(s[7]=e("div",{class:"text-xs text-gray-500"},"Coordinator:",-1)),t.from_coordinator?(a(),A(S,{key:0,user:t.from_coordinator,"avatar-size":"xsmall"},null,8,["user"])):(a(),n("div",ht,[(p=t==null?void 0:t.from_department)!=null&&p.coordinator_id?(a(),n("div",wt," Approval Pending ")):(a(),n("div",kt,"N/A"))]))])]),e("td",Vt,[e("span",{title:(o=t==null?void 0:t.to_department)==null?void 0:o.name,class:N([{"bg-sky-500 !text-white  ":((h=t==null?void 0:t.to_department)==null?void 0:h.id)==((k=(w=f(u))==null?void 0:w.user)==null?void 0:k.department_id)},"text-sky-500 font-semibold flex-shrink-0 border border-sky-500 bg-blue-50 rounded-full px-2 text-xs"])},c(((d=t==null?void 0:t.to_department)==null?void 0:d.short_name)||((P=t==null?void 0:t.to_department)==null?void 0:P.name)),11,At),e("div",Rt,[s[8]||(s[8]=e("div",{class:"text-xs text-gray-500"},"In Charge:",-1)),t.to_incharge?(a(),A(S,{key:0,user:t.to_incharge,"avatar-size":"xsmall"},null,8,["user"])):(a(),n("div",$t,[(U=t==null?void 0:t.to_department)!=null&&U.incharge_id?(a(),n("div",Dt," Approval Pending ")):(a(),n("div",Tt,"N/A"))]))]),e("div",Ct,[s[9]||(s[9]=e("div",{class:"text-xs text-gray-500"},"Coordinator:",-1)),t.to_coordinator?(a(),A(S,{key:0,user:t.to_coordinator,"avatar-size":"xsmall"},null,8,["user"])):(a(),n("div",Lt,[(j=t==null?void 0:t.to_department)!=null&&j.coordinator_id?(a(),n("div",St," Approval Pending ")):(a(),n("div",Mt,"N/A"))]))])]),e("td",Nt,[t.submission_date?(a(),n("div",zt,[e("div",Et,c(new Date(t.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))+" "+c(new Date(t.submission_date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1),e("div",Pt,[s[10]||(s[10]=e("span",{class:"text-gray-500 text-sm"},"Status: ",-1)),e("span",{class:N(["border rounded-lg px-2 text-sm py-0.5 text-xs",{"bg-red-300 text-red-700 border-red-400":t.status!="approved","bg-green-300 text-green-700 border-green-400":t.status=="approved"}])},c(String(t.status).toUpperCase()),3)])])):(a(),n("div",Ut,"-"))]),e("td",jt,[e("div",Bt,[_(x,{to:{name:"RequirementShow",params:{id:t==null?void 0:t.id}},class:"btn-2",onClick:s[0]||(s[0]=D=>D.stopPropagation())},{default:R(()=>s[11]||(s[11]=[e("i",{class:"fad fa-eye"},null,-1),z(" Show ")])),_:2,__:[11]},1032,["to"]),_(x,{to:{name:"RequirementEdit",params:{id:t==null?void 0:t.id}},class:"btn-4 border border-blue-500 hover:bg-blue-500 hover:text-white",onClick:s[1]||(s[1]=D=>D.stopPropagation())},{default:R(()=>s[12]||(s[12]=[e("i",{class:"fad fa-edit"},null,-1),z(" Edit ")])),_:2,__:[12]},1032,["to"])])])])}),128))])])}}},It={class:"mb-3 task-header"},Ot={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ht={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Kt={class:"relative"},Yt=["title"],Jt={key:0},Qt={key:1,class:"text-gray-500 whitespace-nowrap"},Wt={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Xt={class:"text-gray-600 w-full md:w-32 relative"},Zt={__name:"RequirementHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(T,{emit:u}){const b=T,s=O(),x=Y(),y=V(v("company-id")),t=V(v("from-department-id")),i=V(v("to-department-id")),l=V(v("created-by")),r=V(v("month")),g=u,m=et(),C=X([]);function v(p){return{get:()=>b.modelValue[p]||"",set:o=>{g("update:modelValue",{...b.modelValue,[p]:o||void 0})}}}async function $(){var p,o,h;if(!b.isMyTask){const w=(p=b.modelValue)==null?void 0:p["company-id"],k=i.value,d={...w?{company_id:w}:{},...k?{department_ids:[k]}:{}};C.value=((h=(o=await tt({params:d}))==null?void 0:o.data)==null?void 0:h.employees)||[]}}J(async()=>{await m.fetchCompanies({with:"departments",ignore_permission:!0}),await m.fetchMyCompanies({with:"departments"}),await $()}),E(()=>i.value,$),E(()=>y.value,()=>{t.value="",i.value="",l.value="",$()});const L=V(()=>y.value?m==null?void 0:m.companies.filter(p=>p.id==y.value):m==null?void 0:m.companies);return(p,o)=>{var h,w,k;return a(),n("div",null,[e("div",It,[e("div",Ot,[e("div",Ht,[e("div",Kt,[_(at,{modelValue:y.value,"onUpdate:modelValue":o[0]||(o[0]=d=>y.value=d),options:((h=f(m))==null?void 0:h.companies)||[],label:"name",id:"id",class:"border-2 border-gray-300 rounded h-[40px] w-full md:w-48 bg-white text-sm",clearable:""},{"selected-option":R(({option:d})=>[e("div",{class:"line-clamp-1 text-sm text-gray-900",title:d==null?void 0:d.name},[d!=null&&d.name?(a(),n("span",Jt,c(d==null?void 0:d.name),1)):(a(),n("span",Qt,"--ALL COMPANY--"))],8,Yt)]),_:1},8,["modelValue","options"]),o[5]||(o[5]=e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),_(I,{modelValue:t.value,"onUpdate:modelValue":o[1]||(o[1]=d=>t.value=d),companies:L.value||[],class:"relative w-full md:w-48 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300"},defaultOption:"--ALL DEPARTMENT--"},{label:R(()=>o[6]||(o[6]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),f(x).name!=="MyTaskList"?(a(),A(I,{key:0,modelValue:i.value,"onUpdate:modelValue":o[2]||(o[2]=d=>i.value=d),companies:L.value||[],class:"relative w-full md:w-48 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300  "},defaultOption:"--ALL DEPARTMENT--"},{label:R(()=>o[7]||(o[7]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):M("",!0),f(s).isAdminMood&&((k=(w=f(s))==null?void 0:w.user)==null?void 0:k.role)!=="employee"?(a(),n("div",Wt,[_(st,{employees:C.value,modelValue:l.value,"onUpdate:modelValue":o[3]||(o[3]=d=>l.value=d),class:"border-2 border-gray-300 rounded h-[40px] w-full bg-white !text-sm"},null,8,["employees","modelValue"]),o[8]||(o[8]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Created By ",-1))])):M("",!0),e("div",Xt,[o[9]||(o[9]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),Z(e("input",{id:"month-filter","onUpdate:modelValue":o[4]||(o[4]=d=>r.value=d),type:"month",class:"h-10 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[G,r.value]])])])])])])}}},Gt={class:"container mx-auto"},qt={class:"bg-white shadow-md rounded-lg p-4"},te={key:1,class:"text-center py-4 text-red-500"},ee={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},se={class:"font-semibold flex items-center gap-2"},ae={class:"rounded-b-md overflow-x-auto border-x xl:border-x-0"},fe={__name:"RequirementList",setup(T){const u=ot(),b=q(),s=Y(),x=V({get(){return{...s.query}},set(i){b.push({query:{...i}})}});J(()=>{console.log("Requirement List Mounted"),u.fetchRequirements(x.value)}),E(()=>({...x.value}),async function(i){u.fetchRequirements(i)});const y=()=>{b.push({name:"RequirementAdd"})},t=V(()=>(u.requirements||[]).reduce((i,l)=>{const r=`${l.from_department_id}-${l.to_department_id}`,g=i.find(m=>m.key==r);return g?g.requirements=[...g.requirements,l]:i.push({key:r,from_department:l.from_department,to_department:l.to_department,requirements:[l]}),i},[]));return(i,l)=>(a(),n("div",Gt,[e("div",{class:"flex justify-between items-center mb-6"},[l[1]||(l[1]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Requirements",-1)),e("button",{onClick:y,class:"btn-1"},"Add Requirement")]),e("div",qt,[_(Zt,{modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=r=>x.value=r),class:"mt-2 mb-6"},null,8,["modelValue"]),f(u).loading?(a(),A(Q,{key:0,class:"sm:min-h-64 lg:min-h-96 shadow-none flex items-center justify-center"},{default:R(()=>l[2]||(l[2]=[z(" Loading requirements... ")])),_:1,__:[2]})):f(u).error?(a(),n("div",te,c(f(u).error),1)):(a(!0),n(H,{key:2},K(t.value,r=>(a(),n("div",{key:r.key,class:"mt-8 rounded-md border-2 border-sky-300"},[e("div",ee,[e("div",se,[l[3]||(l[3]=e("span",{class:"text-white text-sm"},"From",-1)),_(F,{department:r.from_department},null,8,["department"]),l[4]||(l[4]=e("span",{class:"text-white text-sm"},"To",-1)),_(F,{department:r.to_department},null,8,["department"])])]),e("div",ae,[_(Ft,{requirements:r.requirements},null,8,["requirements"])])]))),128))])]))}};export{fe as default};
