import{e as W,h as D}from"./requirement-CjN7rzKN.js";import{B as F,r as v,x as d,C as i}from"./index-Cf6qM8w5.js";const z=F("task",()=>{const o=v([]),h=v([]),k=v([]),y=v(null),u=v(!1),n=v(null),m=v(1),_=v(!0),$=async(s,l,{updateStoreData:e=!0})=>{var t,a;e==!0&&(u.value=!0,n.value=null);try{await i.post(`/tasks/${s}/assign-users`,{user_ids:l}),await w(s)}catch(r){throw e==!0&&(n.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Assign users failed"),r}finally{e==!0&&(u.value=!1)}};function q(){m.value=1,o.value=[]}const E=async(s={})=>{var l,e,t;u.value=!0,n.value=null;try{const a=await W({params:s});o.value=((l=a.data)==null?void 0:l.tasks)||[],console.log({response:a})}catch(a){throw n.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"রিকোয়ারমেন্ট লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching requirements:",a),a}finally{u.value=!1}},A=async(s={})=>{var l,e,t;u.value=!0,n.value=null;try{const a=await D({params:s});o.value=((l=a.data)==null?void 0:l.tasks)||[],console.log({response:a})}catch(a){throw n.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"রিকোয়ারমেন্ট লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching requirements:",a),a}finally{u.value=!1}};async function C(s,l={}){var e,t,a;n.value=null;try{const r={...s,per_page:5e3};u.value=!0;const c=await i.get("/tasks",{params:r,...l});return o.value=((e=c.data)==null?void 0:e.tasks)||[],u.value=!1,c.data}catch(r){throw n.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",r}}const O=async(s,l)=>{var e,t,a;n.value=null;try{const r=await i.get("/my-tasks",{params:s,...l});return o.value=((e=r.data)==null?void 0:e.tasks)||[],r.data}catch(r){throw n.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",r),r}};function g(s,l=0){return Array.isArray(s)===!1||s.length===0?[]:s.filter(e=>(e==null?void 0:e.parent_id)===l).map(e=>({...e,children_tasks:g(s,e.id)}))}function p(){return g(o.value,0)}function x(){const s=[],l=(e,t=0,a="")=>{e.forEach(r=>{s.push({...r,depth:t,idPath:a+r.id}),r.children_tasks&&r.children_tasks.length&&l(r.children_tasks,t+1,a+r.id+"-")})};return l(p()),s}const w=async(s,l={},e={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,a,r,c,T;e.fetchOnly||(u.value=!0),n.value=null;try{const f=await i.get(`/tasks/${s}`,{params:l});return e.fetchOnly||(y.value=((t=f.data)==null?void 0:t.task)||{},k.value=((a=f.data)==null?void 0:a.todos)||{},h.value=((r=f.data)==null?void 0:r.todo_dates)||{},o.value=f.data.sub_tasks||[]),f.data}catch(f){const b=((T=(c=f.response)==null?void 0:c.data)==null?void 0:T.message)||`টাস্ক (ID: ${s}) লোড করতে ব্যর্থ হয়েছে।`;throw e.fetchOnly||(n.value=b),f}finally{e.fetchOnly||(u.value=!1)}},B=async(s,l={loadingBeforeCreate:!1})=>{var e,t,a,r;l.loadingBeforeCreate&&(u.value=!0),n.value=null;try{const c=await i.post("/tasks",s);return(e=c.data)!=null&&e.data&&o.value.push((t=c.data)==null?void 0:t.data),c.data.data}catch(c){throw n.value=((r=(a=c.response)==null?void 0:a.data)==null?void 0:r.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",c),c}finally{l.loadingBeforeCreate&&(u.value=!1)}},M=async(s,l,{loadingBeforeFetch:e=!0})=>{e&&(u.value=!0),n.value=null;try{const t=await i.put(`/tasks/${s}`,l),a=o.value.findIndex(r=>(r==null?void 0:r.id)===s);return a!==-1&&(o.value[a]=t.data.data),t.data.data}catch(t){throw t}finally{e&&(u.value=!1)}},P=async(s,l)=>(await i.put(`/tasks/${s}/update-priorities`,{task_ids:l})).data,L=async s=>{var l,e;u.value=!0,n.value=null;try{await i.delete(`/tasks/${s}`),o.value=o.value.filter(t=>t.id!==s)}catch(t){throw n.value=((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.message)||`টাস্ক (ID: ${s}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${s}:`,t),t}finally{u.value=!1}},R=async(s,l)=>{var e,t;u.value=!0,n.value=null;try{await i.patch(`/tasks/${s}/update-requirement/${l}`),o.value=o.value.filter(a=>a.id!==s)}catch(a){throw n.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||`টাস্ক (ID: ${s}) রেকয়্যারমেন্ট সেট করতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${s}:`,a),a}finally{u.value=!1}};return{tasks:d(()=>o.value),task_todos:d(()=>k.value),task_todo_dates:d(()=>h.value),task:d(()=>y.value),loading:d(()=>u.value),error:d(()=>n.value),taskListTree:d(p),flattenedTasks:d(x),fetchAllTasks:E,fetchAllMyTasks:A,fetchTasks:C,hasMoreTask:_,fetchMyTasks:O,resetTaskList:q,fetchTask:w,createTask:B,updateTask:M,deleteTask:L,assignUsers:$,updateTaskPriorities:P,setTaskRequirement:R}});export{z as u};
