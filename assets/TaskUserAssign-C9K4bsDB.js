import{d as N,b as E,u as F,r as v,q as k,e as L,c as d,o as n,a,t as f,h as x,w,f as M,l as S,p as _,F as R,x as q,m as z}from"./index-DUpYEQ6K.js";import{_ as D}from"./MultiselectDropdown-Cy162Yr7.js";import{_ as U}from"./UserChip-CJMFyHqa.js";import{u as I}from"./company-phqgVs9L.js";import{u as O}from"./useTaskStore-JVhe_UOU.js";import{u as j}from"./user-fvKhadLS.js";import"./vue-multiselect.esm-BkqKTA1f.js";const G={class:"container mx-auto p-6"},H={class:"max-w-xl mx-auto bg-white shadow-lg rounded-lg p-6"},J={class:"text-xl font-semibold text-gray-800 mb-4"},K={key:0,class:"text-center text-gray-500 py-4"},P={class:"mb-4"},Q={class:"mb-2 flex flex-wrap gap-2"},W=["onClick"],X={key:0,class:"mb-4 text-red-500 font-medium"},Y={class:"flex items-center gap-4"},Z=["disabled"],ue={__name:"TaskUserAssign",setup(ee){const l=O(),C=I(),b=j(),g=N(),A=E(),y=F(),o=v([]),V=k(()=>o.value.map(t=>t.id)),h=A.params.id,r=v(!1),c=v(null),m=v([]);L(async()=>{var t,e,i,s,u,p;r.value=!0,await l.fetchTask(h,{with_parent:"true"}),l.task.parent?m.value=((e=(t=l.task)==null?void 0:t.parent)==null?void 0:e.users)||[]:((i=g.user)==null?void 0:i.role)==="employee"?m.value=((p=(u=await C.fetchEmployees((s=g.user)==null?void 0:s.company_id))==null?void 0:u.data)==null?void 0:p.employees)||[]:(await b.fetchUsers(),m.value=b.users),o.value=l.task.users,r.value=!1});const B=k(()=>m.value.filter(t=>!o.value.find(e=>e.id===t.id))),T=async()=>{r.value=!0,c.value=null;try{await l.assignUsers(h,V.value),y.back()}catch(t){c.value=t.message||"Assign users failed"}finally{r.value=!1}};return(t,e)=>{var i;return n(),d("div",G,[a("div",H,[a("h2",J,' Assign Users to Task: "'+f((i=x(l).task)==null?void 0:i.title)+'" ',1),r.value?(n(),d("div",K,"Loading users...")):(n(),d("form",{key:1,onSubmit:w(T,["prevent"])},[a("div",P,[e[2]||(e[2]=a("label",{class:"block text-gray-700 font-medium"},"Select Users",-1)),S(D,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value=s),options:B.value,multiple:!0,"track-by":"id",label:"label",placeholder:"Select users"},{selection:_(({...s})=>[a("div",Q,[(n(!0),d(R,null,q((s==null?void 0:s.values)||[],u=>(n(),z(U,{key:u.id,user:u},{after:_(({user:p})=>[a("button",{class:"size-6 border rounded-full hover:bg-red-400 hover:text-white",onClick:w(se=>o.value=o.value.filter($=>$.id!==p.id),["prevent"])}," Ã— ",8,W)]),_:2},1032,["user"]))),128))])]),option:_(({option:s})=>[S(U,{user:s},null,8,["user"])]),_:1},8,["modelValue","options"])]),c.value?(n(),d("div",X,f(c.value),1)):M("",!0),a("div",Y,[a("button",{disabled:r.value,type:"submit",class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-5 py-2 rounded transition"},f(r.value?"Assigning...":"Assign Users"),9,Z),a("button",{type:"button",onClick:e[1]||(e[1]=s=>x(y).back()),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32))])])}}};export{ue as default};
