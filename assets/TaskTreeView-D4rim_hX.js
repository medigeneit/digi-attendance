import{c as l,o as s,F as S,x as A,m as T,p as w,I as ee,G as ae,q as b,f as k,y as p,a as t,z as ne,n as h,t as g,R as oe,l as v,L as ie,B as Q,k as te,b as de,r as W,A as ue,w as $,h as C}from"./index-xdpH0sCq.js";import{g as X}from"./datetime-q3Sn87-f.js";import{_ as Y}from"./UserChip-qy4idpWP.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"mt-3"},fe={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick","employeeAssignClick"],setup(e,{emit:n}){const a=n;return(o,i)=>(s(),l("div",ce,[(s(!0),l(S,null,A(e.childrenTasks,(c,x)=>(s(),T(ct,{key:c.id,index:x,task:c,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:i[0]||(i[0]=f=>a("editClick",f)),onAddClick:i[1]||(i[1]=f=>a("addClick",f)),onEmployeeAssignClick:i[2]||(i[2]=f=>a("employeeAssignClick",f))},{"item-end":w(({task:f,level:m})=>[ee(o.$slots,"treeItemEnd",{task:f,level:m})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ke=ae({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:n}){const a=e,o=b(function(){return a.task.completed_count}),i=b(()=>a.task.children_task_count===0?a.task.status==="COMPLETED"?100:0:o.value/a.task.children_task_count*100),c=b(()=>{const x=i.value;let f,m,d;return x===100?(f="bg-green-50",m="bg-green-200",d="text-green-600 "):x<100&&(f="bg-red-50",m="bg-red-200",d="text-red-600 "),{container:f,bar:m,text:d}});return n({completedPercentage:i.value,completedSubTaskCount:o.value}),(x,f)=>(s(),l("div",null,[x.task.children_task_count>0?(s(),l("div",{key:0,class:p(["rounded-full border py-0.5 relative overflow-hidden h-6",c.value.container]),style:{width:"180px"}},[t("div",{class:p(["z-10 absolute top-0 bottom-0",c.value.bar]),style:ne(`width: ${i.value}%`)},null,6),t("span",{class:p(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",c.value.text])},[t("span",null,[t("span",null,g(o.value),1),f[0]||(f[0]=h(" / ")),t("span",null,g(x.task.children_task_count),1)])],2)],2)):k("",!0)]))}}),ge={key:0},me={__name:"TaskStatus",props:{status:{type:String,required:!0},progressPercent:{type:Number,required:!0}},setup(e){const n=e,a=b(()=>{switch(n.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),o=b(()=>{switch(n.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(i,c)=>(s(),l("div",{class:p(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",a.value])},[t("i",{class:p(o.value)},null,2),t("span",null,g(e.status),1),e.progressPercent!==null||e.progressPercent!==void 0?(s(),l("span",ge,g(e.progressPercent)+"% ",1)):k("",!0)],2))}};function xe(e){return Object.entries(e).map(n=>`${n[0]}=${n[1]}`).join("&")}const ye={class:"relative"},be={key:0,class:"text-gray-500 text-xs"},pe={class:"border rounded-full size-6 flex justify-center items-center border-blue-300 bg-blue-100"},ve={key:0,class:"fas fa-user-cowboy text-blue-500"},he={key:1,class:"fas fa-user-crown text-blue-300"},Te={key:2,class:"text-sm text-gray-500 group/users"},we={class:"cursor-pointer hover:underline text-blue-600"},Ce={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg z-30"},Z={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:()=>null},isTargetTask:{Boolean,default:!1},listType:{String,default:"employee"}},setup(e){const n=e,a=b(()=>n.users.slice(0,2)),o=b(()=>n.users.slice(2));function i(x){if(typeof n.routeTo=="function")return n.routeTo(x)}const c=b(()=>typeof n.routeTo=="function"?oe:"div");return(x,f)=>(s(),l("div",ye,[n.users.length===0?(s(),l("div",be,g(e.listType=="supervisors"?"No Supervisor assigned":"Not Assigned To Anyone"),1)):(s(!0),l(S,{key:1},A(a.value,(m,d)=>(s(),T(Q(c.value),{key:d,to:i(m)},{default:w(()=>[v(Y,{class:p(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask," !bg-blue-100":!e.isTargetTask&&e.listType=="employee"&&d===0}]),user:m},ie({_:2},[d===0||e.listType=="supervisors"?{name:"after",fn:w(()=>[t("div",pe,[e.listType=="supervisors"?(s(),l("i",ve)):(s(),l("i",he))])]),key:"0"}:void 0]),1032,["class","user"])]),_:2},1032,["to"]))),128)),o.value.length>0?(s(),l("div",Te,[t("div",we," + "+g(o.value.length)+" more users ",1),t("div",Ce,[(s(!0),l(S,null,A(o.value,(m,d)=>(s(),T(Q(c.value),{key:d,to:i(m),class:"w-full block mb-2"},{default:w(()=>[v(Y,{class:p(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:m},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):k("",!0)]))}},_e={},$e={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function Se(e,n){return s(),l("span",$e,"IMPORTANT")}const Le=se(_e,[["render",Se]]),Ae={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(n,a)=>{const o=te("RouterLink");return s(),T(o,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:w(()=>[t("div",null,g(e.task.title),1)]),_:1},8,["to"])}}},Ee={},Ne={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function Be(e,n){return s(),l("span",Ne,"URGENT")}const Pe=se(Ee,[["render",Be]]),Re={class:"flex w-full"},qe={key:0,class:"border-l border-gray-200 last:border-l-0"},De={class:"items-start grid grid-cols-4 gap-4 group"},je={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},Ie={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},Oe={key:0,class:"text-xl font-semibold text-sky-500"},ze={key:1,class:"text-sm text-gray-500 mt-2"},Me={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Ue={class:"flex items-center gap-6 flex-none lg:w-full order-0 lg:order-1"},Ge={class:"flex gap-4 items-center"},Ve={class:"text-gray-500 text-sm"},Fe={class:"text-red-500 text-sm"},He={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Je={class:"col-span-full flex items-center my-2 lg:my-0 justify-center flex-wrap gap-x-3 gap-y-2"},Ke={class:"text-xs px-2 py-0.5 rounded-full border bg-sky-500 text-white"},Qe={class:"text-xs px-2 py-0.5 rounded-full border bg-blue-500 text-white"},We={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4 mt-4"},Xe={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Ye={key:1,class:"text-gray-500"},Ze={class:"font-semibold text-green-800"},et={key:2,class:"ml-4 text-gray-500"},tt={class:"text-red-500 font-semibold"},st={class:"mt-4 col-span-full"},rt={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},lt={class:"text-xs text-gray-500 flex gap-3 order-1 sm:order-0"},at=["href"],nt={class:"flex items-center sm:ml-auto order-0 sm:order-1"},ot={key:0,class:"flex gap-2 ml-4 items-center text-xs"},it=["href"],dt=["href"],ut={class:"ml-0"},ct={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(e,{emit:n}){const a=e,o=de(),i=W(null),c=n;function x(u){c("addClick",u)}function f(u){c("editClick",u)}function m(u){c("employeeAssignClick",u)}const d=W([]),E=localStorage.getItem("sub_task_opened_list");if(E)try{d.value=JSON.parse(E)}catch{d.value=[]}const N=b(()=>X(a.task.started_at)),B=b(()=>X(a.task.deadline)),_=b({get:()=>d.value.includes(a.task.id),set:u=>{const r=d.value.includes(a.task.id);u&&!r?d.value.push(a.task.id):!u&&r&&(d.value=d.value.filter(L=>L!==a.task.id))}});ue(d,u=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(u))},{deep:!0});const P=b(()=>{var u,r;return((r=(u=a.task)==null?void 0:u.children_tasks)==null?void 0:r.length)>0});function re(){a.task.children_tasks.length>0&&(_.value=!_.value)}return(u,r)=>{var R,q,D,j,I,O,z,M,U,G,V,F,H,J,K;const L=te("RouterLink");return s(),l("div",Re,[e.treeLevel>0?(s(),l("div",qe,r[4]||(r[4]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):k("",!0),t("div",{class:p(["flex-grow border-2 rounded py-3 px-3",{"bg-green-100  ":((R=i.value)==null?void 0:R.completedPercentage)===100,"bg-white hover:bg-gray-50":((q=i.value)==null?void 0:q.completedPercentage)<100,"shadow-sm":e.treeLevel>0,"border-sky-500":e.index%2===0,"border-pink-300":e.index%2===1}])},[t("div",De,[t("div",je,[t("div",Ie,[e.index!==void 0?(s(),l("div",Oe,g(e.index+1)+". ",1)):k("",!0),v(Ae,{task:e.task},null,8,["task"]),(D=e.task)!=null&&D.requirement?(s(),l("p",ze," Requirement: "+g((I=(j=e.task)==null?void 0:j.requirement)==null?void 0:I.title),1)):k("",!0)]),t("div",Me,[v(me,{status:(O=e.task)==null?void 0:O.status,progressPercent:((z=e.task)==null?void 0:z.progress_percent)||0},null,8,["status","progressPercent"]),v(ke,{task:e.task,ref_key:"progress",ref:i,class:"text-sm"},null,8,["task"])]),t("div",Ue,[t("div",Ge,[e.showDraggableHandle?(s(),l("button",{key:0,onMousedown:r[0]||(r[0]=$((...y)=>u.handleDragging&&u.handleDragging(...y),["stop"])),class:"handle"},r[5]||(r[5]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):k("",!0),t("span",Ve," #"+g(e.task.id),1),t("div",Fe,g(e.treeLevel),1)]),t("div",He,[(M=e.task)!=null&&M.is_important?(s(),T(Le,{key:0})):k("",!0),(U=e.task)!=null&&U.is_urgent?(s(),T(Pe,{key:1})):k("",!0)])])]),t("div",Je,[v(Z,{class:"flex items-center justify-center flex-wrap gap-x-3",users:e.task.supervisors||[],isTargetTask:e.task.is_target,listType:"supervisors",routeTo:y=>({query:{...C(o).query,view:"userwise","company-id":y.company_id,"user-ids":y.id}})},null,8,["users","isTargetTask","routeTo"]),e.treeLevel===0?(s(),l(S,{key:0},[t("div",Ke,g(((V=(G=e.task)==null?void 0:G.from_department)==null?void 0:V.name)||"--"),1),r[6]||(r[6]=t("span",{class:"text-2xl text-gray-400"},"⇒",-1)),t("div",Qe,g(((H=(F=e.task)==null?void 0:F.to_department)==null?void 0:H.name)||"--"),1)],64)):k("",!0),v(Z,{class:"flex items-center justify-center flex-wrap gap-x-3",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:y=>({query:{...C(o).query,view:"userwise","company-id":y.company_id,"user-ids":y.id}})},null,8,["users","isTargetTask","routeTo"])])]),t("div",We,[e.task.is_target?(s(),l("div",Xe," TARGET TASK ")):k("",!0),N.value?(s(),l("span",Ye,[r[7]||(r[7]=h(" Started: ")),t("span",Ze,g(N.value),1)])):k("",!0),B.value?(s(),l("span",et,[r[8]||(r[8]=h(" Deadline: ")),t("span",tt,g(B.value),1)])):k("",!0)]),t("div",st,[t("div",rt,[t("div",lt,[t("button",{class:p([{"text-yellow-600 font-semibold  inline-block  ":P.value},"flex items-center gap-1 group"]),onClick:re},[t("i",{class:p([_.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:p(P.value?"group-hover:underline":"")}," Sub Tasks ("+g((J=e.task.children_tasks)==null?void 0:J.length)+") ",3)],2),e.treeLevel<2?(s(),l("a",{key:0,href:`/tasks/add?parent_id=${a.task.id}&back-to=${encodeURIComponent(C(o).path+"?"+C(xe)(C(o).query)).toLowerCase()}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:r[1]||(r[1]=$(y=>c("addClick",a.task.id),["stop","prevent"]))},r[9]||(r[9]=[t("i",{class:"fas fa-plus"},null,-1),h(" Add Sub Task ")]),8,at)):k("",!0)]),t("div",nt,[e.hideButtons?k("",!0):(s(),l("div",ot,[t("a",{href:`/tasks/${e.task.id}/assign-users`,onClick:r[2]||(r[2]=$(y=>c("employeeAssignClick",e.task.id),["stop","prevent"])),class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},r[10]||(r[10]=[t("i",{class:"fas fa-users-cog"},null,-1),h(" Manage Employee & Supervisor ")]),8,it),t("a",{href:`/tasks/edit/${e.task.id}`,onClick:r[3]||(r[3]=$(y=>c("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},r[11]||(r[11]=[t("i",{class:"fas fa-edit"},null,-1),h(" Edit ")]),8,dt),v(L,{to:{name:"TaskReports",params:{id:(K=e.task)==null?void 0:K.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:w(()=>r[12]||(r[12]=[t("i",{class:"far fa-file-alt"},null,-1),h(" Reports ")])),_:1,__:[12]},8,["to"])]))])]),t("div",ut,[_.value?(s(),T(fe,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:f,onAddClick:x,onEmployeeAssignClick:m},{"tree-item-end":w(({task:y,level:le})=>[ee(u.$slots,"item-end",{level:le,task:y})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):k("",!0)])])],2)])}}};export{ct as _,me as a,ke as b};
