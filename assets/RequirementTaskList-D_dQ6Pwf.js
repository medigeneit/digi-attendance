import{L as ae}from"./LoaderView-a1BRn5bT.js";import{O as F}from"./OverlyModal-DOOCc6m-.js";import{_ as X}from"./DepartmentChip-BoTC4z1B.js";import{_ as ne}from"./TaskAddForm-drxd7jZG.js";import{_ as le}from"./TaskEditForm-CuGmgjGM.js";import{_ as de}from"./TaskHeader-BrAh08uO.js";import{_ as ue}from"./TaskUserAssignForm-DpSkS-F3.js";import{b as te,m as U,c as l,o as i,g as u,a as e,F as R,y as S,x as V,t as k,k as p,j,p as _,f as w,w as Y,u as me,r as D,d as ce,z as Z,e as pe,A as G,i as N,I as ye}from"./index-DKvvHbAy.js";import{u as fe}from"./task-priority-Rx99V5nG.js";import{u as _e}from"./useRequirementStore-Ddq38tXh.js";import{u as ge}from"./useTaskStore-D6tW7eRe.js";import{_ as xe,T as ke,a as ve,b as be}from"./TaskUrgentBadge-FKK6HwEk.js";import{_ as he,a as Te}from"./TaskAssignedUsers-el7LKBtn.js";import{T as we}from"./TaskIsClosedBadge-CM8Rkju_.js";import{d as qe,b as Ce}from"./datetime-Efw590t9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-Bs7eCBnk.js";import"./company-B6J0YW63.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-DWDhcOm2.js";import"./SelectDropdown-imgkIA7V.js";import"./SectionLoading-Cugfk7Wl.js";import"./TextWithHr-BlLcV8L3.js";import"./TaskUrgencyInput-CoTbEnoY.js";import"./tags-DYJP5j2L.js";import"./MultiselectDropdown-CWaGHj8X.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BIE3Wc0S.js";import"./task-D7bup4NP.js";import"./EmployeeDropdownInput-Bk38Y4rM.js";import"./UserChip-BciQLR_x.js";import"./SearchInput-BkjhnbKv.js";import"./user-DA5B48op.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-DtkzD3sO.js";import"./TaskUserChip-2tmqOvEW.js";import"./requirement-EV53ec5p.js";import"./TaskTitle-CDTGH-zJ.js";const $e={class:"w-full p-1"},Le={key:0,class:"w-full rounded-b"},Ie={class:"group/dept"},Ae={class:"flex gap-1 items-start text-base"},Me={class:"font-bold text-lime-600"},Re={class:"line-clamp-2"},Be={class:"ml-auto"},De=["onClick"],Se={class:"border text-center py-2 px-1 border-gray-200"},ze={key:0,class:"font-semibold text-purple-400 text-sm"},Ee={class:"border px-3 py-1 border-gray-200 relative"},Oe={class:"flex items-center justify-between gap-2"},Pe={class:"flex items-center gap-3 mb-0.5"},Ue={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Ve={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},Fe={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},je={class:"text-xs flex items-center gap-1 text-sky-400 ml-4"},Ne={class:"text-xs flex items-center gap-1 text-sky-400 ml-3"},He=["href","onClick"],Ke={class:"border px-3 py-1 border-gray-200"},Je={class:"flex gap-2 justify-between items-center relative w-full"},Qe={class:"shrink-0"},We=["href","onClick"],Xe={class:"border px-3 py-1 border-gray-200 text-center"},Ye={key:0,class:"ml-4 text-gray-500 text-sm"},Ze={class:"text-blue-500 font-semibold whitespace-nowrap"},Ge={class:"border px-3 border-gray-200 sticky right-0 border-l bg-gray-50"},et={class:"flex justify-end flex-wrap gap-2 py-2"},ee={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick","clickAddClick"],setup(I,{emit:g}){const z=I,d=te(),B=U(()=>z.tasks.reduce((x,r)=>{var C;const q=((C=r.requirement_detail)==null?void 0:C.id)||"-",o=[...x],m=o.find(t=>(t==null?void 0:t.key)==q);return m?m.tasks=[...m.tasks,r]:o.push({key:q,position:r!=null&&r.requirement_detail?0:1,...(r==null?void 0:r.requirement_detail)||{title:"(Other tasks)",id:0},tasks:[r]}),o},[]).sort((x,r)=>x.position-r.position)),f=g;return(x,r)=>{var q;return i(),l("div",$e,[((q=I.tasks)==null?void 0:q.length)>0?(i(),l("table",Le,[r[6]||(r[6]=e("thead",null,[e("tr",null,[e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(i(!0),l(R,null,S(B.value,(o,m)=>{var C;return i(),l(R,{key:o.id},[e("tr",Ie,[e("th",{colspan:"10",class:V(["font-semibold",[(m>0,"")]])},[e("div",{class:V(["text-left -mx-[2px] -mb-[1px] py-2 px-2 flex items-center border border-b-0 rounded-t bg-emerald-50",[o.id===0?"text-gray-500":"text-sky-800",m>0?"mt-4":""]])},[e("div",Ae,[e("div",Me,k(m+1)+".",1),e("p",Re,k(o==null?void 0:o.title),1)]),e("div",Be,[((C=p(d))==null?void 0:C.name)=="RequirementTaskList"?(i(),l("button",{key:0,onClick:t=>{var $,b,L;return f("clickAddTask",{requirement_id:($=o.requirement)==null?void 0:$.id,requirement_detail_id:o.id,from_department_id:(b=o.requirement)==null?void 0:b.from_department_id,to_department_id:(L=o.requirement)==null?void 0:L.to_department_id},{requirement_id:!0,from_department_id:!0,to_department_id:!0})},class:"btn-2 whitespace-nowrap h-6 px-3 opacity-20 group-hover/dept:opacity-100"},r[0]||(r[0]=[e("i",{class:"fas fa-plus-circle"},null,-1),j(" Add Task ")]),8,De)):u("",!0)])],2)],2)]),(i(!0),l(R,null,S(o.tasks,(t,$)=>{var b,L;return i(),l("tr",{key:t.id,class:V(["group/sub-task-row",{" bg-green-400/20":t.status=="COMPLETED"," bg-white hover:bg-slate-50":t.status!=="COMPLETED"}])},[e("td",Se,[$!==void 0?(i(),l("div",ze,k(m+1)+"."+k($+1),1)):u("",!0)]),e("td",Ee,[e("div",Oe,[e("div",null,[e("div",Pe,[_(xe,{titleClass:"text-sm",task:t,"sub-tasks-open":!1,isMyTask:p(d).name=="RequirementList",to:I.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",Ue,[e("div",Ve,[r[1]||(r[1]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,k(p(qe)(t.created_at)),1)]),e("div",Fe,[t!=null&&t.is_important?(i(),w(ke,{key:0})):u("",!0),t!=null&&t.is_urgent?(i(),w(ve,{key:1})):u("",!0)]),e("div",je,[r[2]||(r[2]=e("i",{class:"fas fa-tasks"},null,-1)),j(" "+k(t==null?void 0:t.todos_count),1)]),e("div",Ne,[r[3]||(r[3]=e("i",{class:"fas fa-book"},null,-1)),j(" "+k((b=t==null?void 0:t.requirement_detail)==null?void 0:b.id),1)])])]),!t.is_closed&&!I.hideButtons?(i(),l("a",{key:0,href:`/tasks/edit/${t.id}`,onClick:Y(A=>f("editClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},r[4]||(r[4]=[e("i",{class:"fas fa-edit"},null,-1)]),8,He)):u("",!0)])]),e("td",Ke,[e("div",Je,[_(he,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:t.users||[],isTargetTask:t.is_target,maxItem:1,"route-to":A=>`/requirement-tasks?status=not-completed&view=userwise&user-ids=${A.id}`},null,8,["users","isTargetTask","route-to"]),e("div",Qe,[!t.is_closed&&!I.hideButtons?(i(),l("a",{key:0,href:`/tasks/${t.id}/assign-users`,onClick:Y(A=>f("employeeAssignClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},r[5]||(r[5]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,We)):u("",!0)])])]),e("td",Xe,[t.deadline?(i(),l("span",Ye,[e("span",Ze,k(p(Ce)(t.deadline)),1)])):u("",!0)]),e("td",Ge,[e("div",et,[t.closed_at?(i(),w(we,{key:0})):u("",!0),_(Te,{status:t==null?void 0:t.status,progressPercent:(t==null?void 0:t.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((L=t==null?void 0:t.children_tasks)==null?void 0:L.length)>0?(i(),w(be,{key:1,ref_for:!0,ref:"progress",task:t,class:"text-sm w-full"},null,8,["task"])):u("",!0)])])],2)}),128))],64)}),128))])])):u("",!0)])}}},tt={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},st={class:"mb-4"},rt={key:4,class:"text-center py-4 text-red-500"},it={class:"relative min-h-[20vh]"},ot={key:0,class:"space-y-6"},at={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},nt={class:"font-semibold flex items-center gap-2"},lt={class:"text-white text-base"},dt={class:"rounded-b-md overflow-y-auto"},ut={key:1,class:"space-y-6"},mt={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},ct={class:"font-semibold flex items-center gap-2"},pt={class:"ml-auto"},yt=["onClick"],ft={class:"rounded-b-md overflow-y-auto"},_t={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},Gt={__name:"RequirementTaskList",setup(I){const g=ge(),z=_e(),d=te(),B=me(),f=D(""),x=D(null),r=D(!1),q=ce(),o=Z({parentId:0,requirementId:0,params:{}}),m=Z({taskId:0,isOpen:!1}),C=U(()=>{const a=d.query["user-ids"]||null,s=(g.tasks||[]).flatMap(y=>{var v;return a?(v=y.users)==null?void 0:v.filter(O=>a.includes(O.id)):y.users});return[...new Map(s.map(y=>[y.id,y])).values()].sort((y,v)=>y.id-v.id)}),t=U(()=>(g.tasks||[]).reduce((a,s)=>{const h=`${s.from_department_id}-${s.to_department_id}`,y=a.find(v=>v.key==h);return y?y.tasks=[...y.tasks,s]:a.push({key:h,from_department:s.from_department,to_department:s.to_department,tasks:[s]}),a},[])),$=D(null),b=D([]),{saveTaskPriority:L,listHasRearranged:A}=fe(()=>g.taskListTree,0);pe(()=>{console.log("Task List Mounted"),f.value="loading",M()});async function M(){console.log({name:d.name}),d.name=="RequirementTaskList"&&await g.fetchAllTasks({...d.query,page:1}),d.name=="MyRequirementTaskList"&&await g.fetchAllMyTasks({...d.query,page:1}),f.value="",b.value=[]}const E=(a,s)=>{r.value=!0,o.params=a,o.readonlyValues=s},H=a=>{m.taskId=a,m.isOpen=!0};async function K(){x.value=null,r.value=!1,f.value="loading",o.params={},await M()}async function se(){r.value=!1,o.params={},await M()}async function re(){f.value="loading",await L()&&await M()}function ie(a){return g.tasks.filter(s=>(s.users||[]).some(h=>h.id===a))}G(()=>({...d.query}),async()=>{try{g.resetTaskList(),f.value="loading",await M()}catch(a){console.warn(a)}}),G(()=>q.isAdminMood,a=>{a?B.push({name:"RequirementTaskList",query:d.query}):B.push({name:"MyRequirementTaskList",query:d.query})});const J=U({get(){return{...d.query}},set(a){localStorage.removeItem("sub_task_opened_list"),B.push({query:{...a}})}});function oe(a){return{name:"RequirementTaskShow",params:{id:(a==null?void 0:a.id)||0}}}return(a,s)=>{var h,y,v,O,Q;return i(),l("div",tt,[x.value?(i(),w(F,{key:0},{default:N(()=>[_(le,{taskId:x.value,onClose:s[0]||(s[0]=n=>x.value=null),onUpdated:K},null,8,["taskId"])]),_:1})):u("",!0),r.value?(i(),w(F,{key:1},{default:N(()=>{var n,c;return[_(ne,{parentTaskId:o.parentId,requirementId:(n=o.params)==null?void 0:n.requirement_id,requirementDetailId:(c=o.params)==null?void 0:c.requirement_detail_id,"default-values":o.params,"readonly-fields":o.readonlyValues,onClose:se,onTaskCreated:K},null,8,["parentTaskId","requirementId","requirementDetailId","default-values","readonly-fields"])]}),_:1})):u("",!0),m.isOpen?(i(),w(F,{key:2,class:"*:max-w-4xl"},{default:N(()=>[_(ue,{taskId:m.taskId,onCancelClick:s[1]||(s[1]=()=>{m.isOpen=!1,m.taskId=0}),onSuccess:s[2]||(s[2]=()=>{m.isOpen=!1,m.taskId=0,f.value="loading",M()})},null,8,["taskId"])]),_:1})):u("",!0),_(de,{modelValue:J.value,"onUpdate:modelValue":s[3]||(s[3]=n=>J.value=n),onClickAddTask:E,onClickPrioritySave:re,onClickPriorityDiscard:s[4]||(s[4]=()=>p(A)?$.value.resetItems:null),"list-has-rearranged":p(A),isMyTask:p(d).name==="MyRequirementTaskList",class:"mb-4"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((y=(h=p(d))==null?void 0:h.query)==null?void 0:y["query-log"])=="true"?(i(!0),l(R,{key:3},S(b.value,(n,c)=>(i(),l("div",{key:c,class:"text-xs text-gray-500"},[e("div",st,k(n.raw_query),1)]))),128)):u("",!0),p(z).error?(i(),l("div",rt,k(p(z).error),1)):u("",!0),e("div",it,[((v=p(d).query)==null?void 0:v.view)==="userwise"?(i(),l("div",ot,[(i(!0),l(R,null,S(C.value,n=>(i(),l("div",{key:n.id,class:"rounded-md border-2 border-sky-300"},[e("div",at,[e("div",nt,[_(ye,{user:n},null,8,["user"]),e("div",lt,k(n.label),1)])]),e("div",dt,[_(ee,{tasks:ie(n.id),onEditClick:s[5]||(s[5]=c=>x.value=c),onAddClick:s[6]||(s[6]=c=>E(c)),onEmployeeAssignClick:s[7]||(s[7]=c=>H(c)),taskLinkTo:c=>({name:"RequirementTaskShow",params:{id:(c==null?void 0:c.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128))])):(i(),l("div",ut,[(i(!0),l(R,null,S(t.value,n=>{var c,W;return i(),l("div",{key:n.key,class:"rounded-md border-2 border-sky-300"},[e("div",mt,[e("div",ct,[s[11]||(s[11]=e("span",{class:"text-white text-sm"},"From",-1)),_(X,{department:n.from_department},null,8,["department"]),s[12]||(s[12]=e("span",{class:"text-white text-sm"},"To",-1)),_(X,{department:n.to_department},null,8,["department"])]),e("div",pt,[((c=p(d))==null?void 0:c.name)=="RequirementTaskList"?(i(),l("button",{key:0,onClick:()=>{var T,P;return E({from_department_id:(T=n==null?void 0:n.from_department)==null?void 0:T.id,to_department_id:(P=n==null?void 0:n.to_department)==null?void 0:P.id},{from_department_id:!0,to_department_id:!0})},class:"btn-3 h-6 whitespace-nowrap bg-white border-white px-2"}," Add Task ",8,yt)):u("",!0)])]),e("div",ft,[_(ee,{tasks:n.tasks,groupBy:"requirement_details",onEditClick:s[8]||(s[8]=T=>x.value=T),onClickAddTask:s[9]||(s[9]=(T,P)=>E(T,P)),onEmployeeAssignClick:s[10]||(s[10]=T=>H(T)),hideButtons:((W=p(d))==null?void 0:W.name)!=="RequirementTaskList",taskLinkTo:oe},null,8,["tasks","hideButtons"])])])}),128))])),f.value!=="loading"&&((O=p(g).tasks)==null?void 0:O.length)===0?(i(),l("div",_t," No tasks ")):u("",!0),f.value==="loading"?(i(),w(ae,{key:3,class:V(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((Q=p(g).tasks)==null?void 0:Q.length)===0?"justify-center":""]])},null,8,["class"])):u("",!0)])])}}};export{Gt as default};
