import{d as vt,z as K,m as w,c as i,o as n,a as s,g as f,j as L,F as U,y as F,x as z,t as h,w as q,b as St,u as $t,r as ct,e as Et,A as pt,n as mt,f as S,p as k,i as R,k as l,I as Mt}from"./index-D7WFQ8O_.js";import{L as ft}from"./LoaderView-CANp5_lp.js";import{O as W}from"./OverlyModal-DOHkpFLY.js";import{_ as kt}from"./DepartmentChip-DJAWfSAu.js";import{_ as At}from"./DescriptionView-B2OlLY3v.js";import{_ as _t}from"./TaskAssignedUsers-RPhjAFR-.js";import{_ as Rt,a as Lt,b as Ut}from"./TaskStatusManager-Do_S2nk9.js";import{_ as jt}from"./TaskStatus-_pt3wFk4.js";import{_ as Nt,a as Ot}from"./TodoCreateEditShow-D0HN6pMA.js";import{b as V,d as Pt}from"./datetime-DcVwRp76.js";import{s as yt}from"./dom-BKn8Ftnz.js";import{u as Bt}from"./useTaskStore-B9KCI2Rg.js";import{a as Vt}from"./useTodoStore-OA0f8GGk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BfL1c_L2.js";import"./task-DRp1Vp2-.js";import"./url-CePbr-gY.js";import"./requirement-D9X6rrza.js";const zt={class:"border-gray-300"},Gt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Ft={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},qt={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},Ht={key:0,class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-2 justify-between"},Wt={key:0},Kt=["disabled"],Jt=["disabled"],Qt={class:"text-base font-semibold text-gray-700"},Xt={__name:"TaskTimeline",props:{task:{type:Object}},emits:["updateStatus","error"],setup(J,{emit:a}){const p=J,G=vt(),u=K({user:null,type:""});function j(y){u.user=G.user,u.type=y}const g={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},$=w(()=>(g==null?void 0:g[_.value])||0),C=w(()=>{var y;return{"bg-yellow-50":_.value==="IN_PROGRESS","bg-green-50":_.value==="COMPLETED","bg-red-50":_.value==="PENDING","bg-blue-50":(y=p.task)==null?void 0:y.closed_at}}),_=w(()=>{var y;return(y=p.task)==null?void 0:y.status}),H=w(()=>{var y,x,E,r,T,M,D,m;return[{date:V((y=p.task)==null?void 0:y.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((x=p.task)!=null&&x.assigned_at)},{date:V((E=p.task)==null?void 0:E.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((r=p.task)!=null&&r.started_at)||$.value>=g.IN_PROGRESS},{date:V((T=p.task)==null?void 0:T.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((M=p.task)!=null&&M.completed_at)||$.value>=g.COMPLETED},{date:V((D=p.task)==null?void 0:D.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((m=p.task)!=null&&m.deadline)}].sort((A,N)=>A.date===null||N.date===null||new Date(A.date)==new Date(N.date)?A.serial-N.serial:new Date(A.date)-new Date(N.date))});return(y,x)=>{var E;return n(),i("div",{class:z(["border py-8 px-4 rounded",C.value])},[s("div",zt,[(E=p.task)!=null&&E.is_target?(n(),i("div",Gt,x[2]||(x[2]=[s("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),L(" TARGET TASK ")]))):f("",!0),s("ol",Ft,[(n(!0),i(U,null,F(H.value,(r,T)=>{var M,D;return n(),i("li",{class:"ml-5",key:T},[s("div",qt,[r.active?(n(),i("i",{key:0,class:z([r.icon,"text-xs"])},null,2)):f("",!0)]),s("div",{class:z({"opacity-30":!r.active})},[r.active?(n(),i("div",Ht,[r.date?(n(),i("span",Wt,h(r.date),1)):f("",!0),((M=p.task)==null?void 0:M.children_task_count)===0&&r.status==="started"&&r.active?(n(),i("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:x[0]||(x[0]=q(()=>j("start-date"),["prevent"])),disabled:!!p.task.closed_at},h(r.date?"Edit":"Set Date"),9,Kt)):f("",!0),((D=p.task)==null?void 0:D.children_task_count)===0&&r.active&&r.status==="completed"?(n(),i("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:x[1]||(x[1]=q(()=>j("finish-date"),["prevent"])),disabled:!!p.task.closed_at},h(r.date?"Edit":"Set Date"),9,Jt)):f("",!0)])):f("",!0),s("h3",Qt,h(r.title),1)],2)])}),128))])])],2)}}},Yt={class:"container mx-auto p-6"},Zt={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},It={key:0,class:"text-sm mb-2 border-b","aria-label":"Breadcrumb"},te={class:"flex items-center gap-2"},ee={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},se=["title"],ae={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},oe={class:"grid grid-cols-12 gap-x-8 gap-y-3"},ne={class:"col-span-full lg:col-span-9 row-span-10"},le={class:"font-medium text-xl flex items-start gap-2"},ie={class:"mt-2 col-span-full flex items-center"},re={class:"text-gray-400 text-xs"},de={class:"flex items-center gap-0.5"},ue={class:"text-sky-400 text-sm font-semibold"},ce=["innerHTML"],pe={class:"flex justify-between items-end mt-6 mb-2"},me={key:0,class:"border flex items-center justify-center h-96 rounded bg-gray-50 text-sm italic"},fe={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},ke={class:"font-semibold flex items-center gap-2"},_e={class:"text-white text-base"},ye={class:"col-span-full lg:col-span-3 space-y-4 sticky top-16"},ve={class:"border col-span-3 p-3 rounded shadow"},ge={class:"flex items-center gap-2 mb-4"},xe={class:"flex items-center gap-2 mb-4"},he={class:"flex items-center gap-4 flex-wrap justify-between col-span-3"},be=["disabled"],we={class:"flex items-start justify-center !text-lg mb-4"},Ce={key:2},Te={key:1,class:"text-center py-4 text-red-500"},qe={__name:"RequirementTaskShow",setup(J){const a=Bt(),p=vt(),G=Vt(),u=St(),j=$t(),g=ct(""),$=K({open:!1,task:null});Et(async()=>{g.value="loading",await _(u.params.id),g.value="",u.hash=="#sub-tasks"&&setTimeout(()=>yt(u.hash,66),0)});const C=K({user:null,type:""});async function _(e){await a.fetchTask(e,{with_todos:"true"})}async function H(){await _(u.params.id),C.user=null,C.type=""}const y=e=>{j.push({name:"TaskEdit",params:{id:e}})},x=w(()=>{var e,t;return a.task?((e=a.task)==null?void 0:e.parent_id)==0?{name:r.value?"MyTaskList":"TaskList"}:{params:{id:(t=a.task)==null?void 0:t.parent_id},query:{"is-my-task":r.value}}:null});function E(){$.open=!1,console.log({STATE:"Deleted",backLink:x.value}),j.push(x.value)}const r=w(()=>u.name=="MyTaskShow"||!!u.query["is-my-task"]),T=(e,t=!1)=>({id:e==null?void 0:e.id,title:e==null?void 0:e.title,status:e==null?void 0:e.status,is_current_page:t}),M=w(()=>{var e,t;return(t=(e=a==null?void 0:a.task)==null?void 0:e.users)==null?void 0:t.find(d=>{var v;return((v=p.user)==null?void 0:v.id)==d.id})}),D=w(()=>{var t,d,v,b,O,P;const e=[];return(t=a==null?void 0:a.task)!=null&&t.parent&&(e.push(T((d=a.task)==null?void 0:d.parent)),(b=(v=a==null?void 0:a.task)==null?void 0:v.parent)!=null&&b.parent&&e.push(T((P=(O=a.task)==null?void 0:O.parent)==null?void 0:P.parent))),[...e.reverse(),T(a.task,!0)]});pt(()=>u.params.id,async e=>{g.value="changing",await _(e),g.value=""}),pt(()=>u.hash,async function(){setTimeout(()=>yt(u.hash,66),0)});const m=ct({action:null}),A=w(()=>{const t=((a==null?void 0:a.task_todo_dates)||[]).reduce((d,v)=>{const b=v.date;return d[b]||(d[b]=[]),d[b].push(v),d},{});return Object.keys(t).sort((d,v)=>new Date(v)-new Date(d)).map(d=>({date:d,todo_dates:t[d]}))});function N(){m.value={...m.value,action:""},_(u.params.id)}function gt(){m.value={...m.value,action:""},_(u.params.id)}function Q(e){console.log({todo:e}),m.value={...m.value,action:"edit",todo:e}}function xt(e,t){console.log({yearMonthDay:t,todoId:e}),m.value={...m.value,action:"addDate",date:t,todo_id:e,formReadonlyValues:{date:!0}}}function ht(){m.value={action:null,todo:null}}function bt(e){console.log({todo:e}),m.value={...m.value,action:"show",todo:e}}function wt(){var e;m.value={...m.value,action:"add",todoTypeId:(e=u.params)==null?void 0:e.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}async function Ct(e,t){var d;confirm(`Are your sure?
want to change status to ${t} 
todo: '${e==null?void 0:e.title}'`)&&(await G.updateStatus(e.id,t),_((d=u.params)==null?void 0:d.id))}async function Tt(e){var t;confirm(`Are your sure want to delete todo
'${e==null?void 0:e.title}'`)&&(await G.deleteTodoDate(e.id),_((t=u.params)==null?void 0:t.id))}return(e,t)=>{var b,O,P,X,Y,Z,I,tt,et,st,at,ot,nt,lt,it,rt,dt,ut;const d=mt("RouterLink"),v=mt("router-view");return n(),i("div",Yt,[C.user?(n(),S(W,{key:0},{default:R(()=>[k(Rt,{task:l(a).task,user:C.user,type:C.type,onCloseClick:t[0]||(t[0]=o=>C.user=null),onUpdateDate:H},null,8,["task","user","type"])]),_:1})):f("",!0),$.open?(n(),S(W,{key:1},{default:R(()=>[k(Lt,{onCloseClick:t[1]||(t[1]=o=>$.open=!1),task:$.task,onDelete:E},null,8,["task"])]),_:1})):f("",!0),g.value==="loading"?(n(),S(ft,{key:2,class:"h-[80vh] items-center justify-center"})):(n(),i("div",Zt,[l(a).task?(n(),i(U,{key:0},[D.value.length>1?(n(),i("nav",It,[s("ol",te,[(n(!0),i(U,null,F(D.value,(o,c)=>(n(),i(U,{key:o.id},[c>0?(n(),i("li",ee,"/")):f("",!0),s("li",{title:o==null?void 0:o.title,class:"text-gray-600 line-clamp-1"},[o.is_current_page?(n(),i("span",ae,h(o==null?void 0:o.title),1)):(n(),S(d,{key:0,to:`${r.value?"/my-tasks":"/tasks"}/${o.id}`,class:z(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":c>0,"whitespace-nowrap":c===0}])},{default:R(()=>[L(h(o==null?void 0:o.title),1)]),_:2},1032,["to","class"]))],8,se)],64))),128))])])):f("",!0),s("div",oe,[s("div",ne,[s("div",null,[s("h2",le,[s("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:t[2]||(t[2]=o=>l(j).back())},t[7]||(t[7]=[s("i",{class:"fas fa-arrow-left"},null,-1)])),L(" "+h(l(a).task.title),1)]),s("div",ie,[s("div",re,[t[8]||(t[8]=s("i",{class:"fas fa-clock"},null,-1)),L(" "+h(l(Pt)(l(a).task.created_at)),1)]),(b=l(a).task)!=null&&b.created_by_user?(n(),i(U,{key:0},[t[9]||(t[9]=s("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),s("div",de,[k(Mt,{user:(O=l(a).task)==null?void 0:O.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),s("div",ue,h((X=(P=l(a).task)==null?void 0:P.created_by_user)==null?void 0:X.label),1)])],64)):f("",!0)])]),k(At,null,{default:R(()=>{var o;return[s("p",{innerHTML:(o=l(a).task)==null?void 0:o.description,class:"text-justify"},null,8,ce)]}),_:1}),s("div",null,[s("div",pe,[t[11]||(t[11]=s("h3",{class:"font-semibold text-xl"},"Todos",-1)),M.value?(n(),i("button",{key:0,class:"btn btn-3 h-8",onClick:t[3]||(t[3]=q(()=>wt(),["prevent"]))},t[10]||(t[10]=[s("i",{class:"fas fa-plus"},null,-1),L(" Add Todo ")]))):f("",!0)]),s("div",null,[A.value.length===0?(n(),i("div",me," No Todos ")):f("",!0),(n(!0),i(U,null,F(A.value,o=>(n(),i("div",{key:o.date,class:"border rounded-md overflow-hidden mb-4"},[s("div",fe,[s("div",ke,[s("div",_e,h(l(V)(o.date)),1)])]),s("div",null,[(n(!0),i(U,null,F((o==null?void 0:o.todo_dates)||[],c=>(n(),S(Nt,{key:c.id,todoDate:c,onClickTodo:B=>bt(B),onClickEdit:()=>Q(c==null?void 0:c.todo),onClickChangeStatus:(B,Dt)=>Ct(B,Dt),onClickDelete:B=>Tt(B),"hide-sorting-btn":"",class:"border-b border-sky-200"},null,8,["todoDate","onClickTodo","onClickEdit","onClickChangeStatus","onClickDelete"]))),128))])]))),128))])])]),s("div",ye,[s("div",ve,[s("div",null,[s("div",ge,[t[12]||(t[12]=s("div",{class:"text-gray-500 text-sm"},"From",-1)),k(kt,{department:(Z=(Y=l(a))==null?void 0:Y.task)==null?void 0:Z.from_department,"short-name":!0},null,8,["department"])]),t[13]||(t[13]=s("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisors",-1)),k(_t,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((tt=(I=l(a))==null?void 0:I.task)==null?void 0:tt.supervisors)||[],listType:"supervisors",maxItem:3},null,8,["users"])]),t[16]||(t[16]=s("hr",{class:"my-4"},null,-1)),s("div",null,[s("div",xe,[t[14]||(t[14]=s("div",{class:"text-gray-500 text-sm"},"To",-1)),k(kt,{department:(st=(et=l(a))==null?void 0:et.task)==null?void 0:st.to_department,"short-name":!0},null,8,["department"])]),t[15]||(t[15]=s("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Assigned Users",-1)),k(_t,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((ot=(at=l(a))==null?void 0:at.task)==null?void 0:ot.users)||[],isTargetTask:(lt=(nt=l(a))==null?void 0:nt.task)==null?void 0:lt.is_target,maxItem:5},null,8,["users","isTargetTask"])])]),s("div",he,[k(d,{to:{name:"TaskUserAssign",params:{id:(it=l(a).task)==null?void 0:it.id}},class:z(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",l(a).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:t[4]||(t[4]=o=>o.stopPropagation())},{default:R(()=>t[17]||(t[17]=[s("i",{class:"fas fa-users-cog"},null,-1),L(" Assign Users ")])),_:1,__:[17]},8,["to","class"]),s("button",{onClick:t[5]||(t[5]=q(o=>{var c;return y((c=l(a).task)==null?void 0:c.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!l(a).task.closed_at},t[18]||(t[18]=[s("i",{class:"fas fa-edit"},null,-1),L(" Edit ")]),8,be)]),k(Xt,{task:(rt=l(a))==null?void 0:rt.task},null,8,["task"]),(dt=l(a))!=null&&dt.task?(n(),S(Ut,{key:0,task:((ut=l(a))==null?void 0:ut.task)||{},class:"col-span-full",onUpdateStatus:t[6]||(t[6]=()=>{var o,c;return _((c=(o=l(a))==null?void 0:o.task)==null?void 0:c.id)}),"hide-timeline":""},{top:R(()=>{var o,c;return[s("div",we,[k(jt,{status:(o=l(a).task)==null?void 0:o.status,progressPercent:(c=l(a).task)==null?void 0:c.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"])])]}),_:1},8,["task"])):f("",!0)])]),l(u).name==="TaskReportAdd"?(n(),S(W,{key:1,class:"*:bg-transparent"},{default:R(()=>[k(v)]),_:1})):(n(),i("section",Ce,[k(v)]))],64)):(n(),i("div",Te,h(l(a).error),1)),g.value==="changing"?(n(),S(ft,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):f("",!0)])),k(Ot,{userRole:"employee",todoModal:m.value,onCancelClick:ht,onTodoUpdate:N,onTodoDateUpdate:gt,onClickEdit:Q,onClickAddTodoDate:xt},null,8,["todoModal"])])}}};export{qe as default};
