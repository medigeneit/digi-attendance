import{q as A,c as f,o as i,a,F as $,y as D,f as S,l as C,p as B,n as Z,t as M,s as ee,b as te,u as se,r as g,D as ae,e as ne,A as q,m as U,g as oe,C as le,h as p,w as H}from"./index-BkgQMidg.js";import{_ as re}from"./CommentModal-CD0tmN9h.js";import{g as ie,u as de,O,_ as ue}from"./task-priority-CEH3mTWI.js";import{_ as me}from"./MultiselectDropdown-M3NhH6uc.js";import{_ as ce}from"./TaskAddForm-C3GxWDtS.js";import{_ as pe}from"./TaskEditForm-CZ5ySTwE.js";import{_ as j}from"./TaskTreeView-CiVleqBq.js";import{_ as fe}from"./UserChip-CtATFYfy.js";import{u as ke}from"./company-CSJeTmBe.js";import{u as ye}from"./useTaskStore-CGIiwADV.js";import"./useCommentStore-C-OJnk1g.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-DkU0oRiv.js";import"./useRequirementStore-XbRhXGAn.js";import"./SectionLoading-DlPcXp3x.js";const ve={class:"w-full bg-white rounded"},ge=["rowspan"],_e={class:""},Ce={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(V,{emit:k}){const v=V,w=k,b=A(()=>v.tasks.reduce((o,n)=>(o.push(...n.users.filter(u=>!o.find(m=>m.id==u.id&&u.id))),o),[]).filter(o=>v.selectedUserId?o.id==v.selectedUserId:!0)),d=o=>{const n=v.tasks,u=new Map(n.map(l=>[l.id,l])),m=new Set,y=[],r=n.filter(l=>l.users.some(c=>c.id===o));for(const l of r){m.has(l.id)||(m.add(l.id),y.push(l));let c=l.parent_id;for(;c&&u.has(c)&&!m.has(c);){const _=u.get(c);m.add(_.id),y.push(_),c=_.parent_id}}return y},E=A(()=>b.value.map(o=>{const n=ie(d(o.id),0);return{...o,tasks:n}}));return(o,n)=>(i(),f("div",null,[a("table",ve,[a("tbody",null,[(i(!0),f($,null,D(E.value,u=>(i(),f($,{key:u.id},[(i(!0),f($,null,D(u.tasks,(m,y)=>(i(),f("tr",{key:m.id},[y==0?(i(),f("td",{key:0,class:"border p-4 align-top",rowspan:Math.max(u.tasks.length,1)},[C(fe,{user:u,class:"sticky top-[80px]"},null,8,["user"])],8,ge)):S("",!0),a("td",_e,[C(j,{task:m,class:"!border-0",index:y,onCommentButtonClick:n[0]||(n[0]=r=>w("commentButtonClick",o.item.id)),onEditClick:n[1]||(n[1]=r=>w("editClick",r)),onAddClick:n[2]||(n[2]=r=>w("addClick",r))},{"item-override":B(({task:r,level:l})=>[Z(M({task:r,level:l}),1)]),_:2},1032,["task","index"])])]))),128))],64))),128))])])]))}},we={class:"container mx-auto p-6 relative"},be={class:"mb-3"},Ie={class:"flex flex-wrap items-center gap-2 mt-3"},Te={class:"flex gap-4"},he={class:"flex-shrink-0 w-full md:w-64 text-gray-600"},xe=["value"],qe={class:"ml-auto flex gap-6 items-center"},Se={key:0,class:"flex gap-2 items-center"},Ue={key:2,class:"text-center py-4 text-red-500"},$e={class:"space-y-4"},Be={class:"flex items-stretched"},Ae=1,ze={__name:"TaskList",setup(V){const k=ye(),v=ke(),{companies:w,employees:b}=ee(v),d=te(),E=se(),o=g(!1),n=g(null),u=A(P("company-id")),m=A(P("user-id")),y=g(!1),r=g(null),l=g(!1),c=ae({parentId:0,requirementId:0}),_=g(null),{handleItemsPriorityUpdate:G,saveTaskPriority:Q,listHasRearranged:W}=de(()=>k.taskListTree,0);ne(async()=>{await v.fetchCompanies(),await I()});async function I(){y.value=!!d.query["user-id"],await k.fetchTasks({user_ids:d.query["user-id"]||void 0,company_id:d.query["company-id"]||void 0},{loadingBeforeFetch:!0})}const L=t=>{l.value=!0,c.parentId=t};function P(t){return{set:e=>{E.push({query:{...d.query,[t]:e||void 0}})},get:()=>d.query[t]||""}}const F=t=>{n.value=t,o.value=!0},z=()=>{o.value=!1,n.value=null};async function N(){r.value=null,l.value=!1,c.parentId=0,await I()}async function J(){l.value=!1,c.parentId=0,await I()}const T=g();function h(){return b.value.find(t=>t.id==m.value)||null}async function K(){Q()&&await I()}q(()=>({"user-id":d.query["user-id"],"company-id":d.query["company-id"]}),async()=>{await I()}),q(T,t=>{m.value=t==null?void 0:t.id}),q(m,()=>{h()&&(T.value=h())}),q(()=>u.value,async t=>{t&&(await v.fetchEmployee(t),h()||(m.value=""),console.log({selectedEmployee:h(),employees:b.value}),T.value=h())},{initial:!0,immediate:!0});const X=g({month:"2025-04","company-id":d.query["company-id"]||"","user-id":d.query["user-id"],status:d.query.status||""});return q(X,function(t){console.log({f:t})}),(t,e)=>{var R;return i(),f("div",we,[r.value?(i(),U(O,{key:0},{default:B(()=>[C(pe,{taskId:r.value,class:"rounded-full",onClose:e[0]||(e[0]=s=>r.value=null),onUpdated:N},null,8,["taskId"])]),_:1})):S("",!0),l.value?(i(),U(O,{key:1},{default:B(()=>[C(ce,{parentTaskId:c.parentId,requirementId:c.requirementId,class:"rounded-full",onClose:J,onTaskCreated:N},null,8,["parentTaskId","requirementId"])]),_:1})):S("",!0),a("div",be,[e[12]||(e[12]=a("div",{class:"flex justify-between items-center"},[a("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),a("div",Ie,[a("div",Te,[a("div",he,[oe(a("select",{id:"company-filter","onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s),class:"input-1 h-full"},[e[10]||(e[10]=a("option",{value:""},"Select Company",-1)),(i(!0),f($,null,D(p(w),s=>(i(),f("option",{key:s.id,value:s.id},M(s.name),9,xe))),128))],512),[[le,u.value]])]),C(me,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=s=>T.value=s),options:p(b),multiple:!1,label:"name","label-prefix":"id",placeholder:"Please select employee...",class:"w-full md:w-64 text-gray-600"},null,8,["modelValue","options"])]),a("div",qe,[p(W)?(i(),f("div",Se,[e[11]||(e[11]=a("span",{class:"text-red-500"},"Priority Changed",-1)),a("button",{class:"btn-3",onClick:H(K,["prevent"])},"Save"),a("button",{class:"btn-3",onClick:e[3]||(e[3]=H((...s)=>_.value.resetItems&&_.value.resetItems(...s),["prevent"]))},"Discard")])):S("",!0),a("button",{onClick:L,class:"btn-1"},"Add Task")])])]),p(k).error?(i(),f("div",Ue,M(p(k).error),1)):S("",!0),a("div",$e,[((R=p(d).query)==null?void 0:R.view)=="userwise"?(i(),U(Ce,{key:0,tasks:p(k).tasks,selectedUserId:p(d).query["user-id"],onCommentButtonClick:e[4]||(e[4]=s=>F(s,t.task.id)),onEditClick:e[5]||(e[5]=s=>r.value=s),onAddClick:e[6]||(e[6]=s=>L(s))},null,8,["tasks","selectedUserId"])):(i(),U(ue,{key:1,items:p(k).taskListTree,handle:"handle",onItemsUpdate:p(G),class:"space-y-4",ref_key:"draggableTaskList",ref:_},{item:B(({item:s,index:Y})=>[a("div",Be,[C(j,{task:s,index:Y,class:"!border-0",onCommentButtonClick:e[7]||(e[7]=x=>F(x,t.task.id)),onEditClick:e[8]||(e[8]=x=>r.value=x),onAddClick:e[9]||(e[9]=x=>L(x)),showDraggableHandle:!y.value},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))]),C(re,{show:o.value,"commentable-id":n.value,"commentable-type":"task","user-id":Ae,"on-close":z,onSubmitted:p(k).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{ze as default};
