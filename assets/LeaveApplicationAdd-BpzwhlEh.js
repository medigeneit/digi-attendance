import{u as $,d as j,r as f,q as D,a3 as T,A as q,e as z,k as I,c as m,o as p,a,m as J,l as V,p as P,n as Y,w as G,f as h,g as c,v as k,t as w,F as A,x as R,h as B,a4 as x}from"./index-DI6vi9p1.js";import{L as K}from"./LoaderView-BDReDYi9.js";import{_ as O}from"./MultiselectDropdown-D5rBUlox.js";import{u as Q}from"./holiday-DMNiU6-a.js";import{u as X}from"./leave-application-Cptehtel.js";import{u as Z}from"./leave-type-ByN5LhNS.js";import{u as ee}from"./user-Bnth4S2v.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"my-container max-w-3xl space-y-4"},te={class:"flex items-center justify-between gap-2"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},se={key:0,class:""},oe={class:"text-blue-600 font-medium"},ne={key:1,class:"bg-gray-100 p-2 rounded-md"},re={class:"font-semibold"},de={class:"flex flex-wrap gap-2"},ue=["name","value","onUpdate:modelValue"],ie={class:"flex items-center space-x-1"},pe=["name","onUpdate:modelValue"],ve={class:"flex items-center space-x-1"},me=["name","onUpdate:modelValue"],ce={key:2,class:"text-red-500 text-sm"},xe={__name:"LeaveApplicationAdd",setup(fe){const L=$(),C=X(),y=Z(),U=ee(),r=j(),S=Q(),g=f(""),s=f({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),d=f([]),b=f(!1),_=f(null),E=D(()=>{var l,e,u;return((e=(l=r==null?void 0:r.user)==null?void 0:l.assign_weekend)==null?void 0:e.weekends)||((u=r==null?void 0:r.user)==null?void 0:u.weekends)}),i=D(()=>{const l=s.value.last_working_date,e=s.value.resumption_date;if(!l||!e)return[];const u=new Date(l),o=new Date(e);if(o<=u)return[];const n=[];let t=new Date(u);for(t.setDate(t.getDate()+1);t<o;){const v=t.getFullYear(),W=(t.getMonth()+1).toString().padStart(2,"0"),F=t.getDate().toString().padStart(2,"0");n.push(`${v}-${W}-${F}`),t.setDate(t.getDate()+1)}return n}),H=D(()=>{const l=s.value.last_working_date,e=s.value.resumption_date;if(!l||!e)return"";const u=new Date(l);return new Date(e)<=u?"Resumption date must be after Last Working Date.":i.value.length===0?"No leave days between the selected dates.":`Total leave days: ${i.value.length}`});T(async()=>{var l;i.value.length&&y.leaveTypes.length&&(d.value.length!==i.value.length&&(d.value=i.value.map(()=>y.leaveTypes[0].id)),await S.fetchHolidays({company_id:(l=r==null?void 0:r.user)==null?void 0:l.company_id,start_date:i.value[0],end_date:i.value[i.value.length-1]}),i.value.forEach(async(e,u)=>{const o=new Date(e).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),n=o.charAt(0).toUpperCase()+o.slice(1);E.value.includes(n)&&(d.value[u]="weekend"),S.holidayDates.includes(e)&&(d.value[u]="holiday")}))}),q(()=>g.value,l=>{s.value.handover_user_id=l==null?void 0:l.id});const M=async()=>{var l;b.value=!0,_.value=null;try{const e=i.value.map((t,v)=>({date:t,leave_type_id:d.value[v]!=="weekend"&&d.value[v]!=="holiday"?d.value[v]:null})).filter(t=>t.leave_type_id!==null),u=i.value.map((t,v)=>({date:t,leave_type_id:d.value[v]||""})).filter(t=>t.leave_type_id!==null),o={user_id:(l=r==null?void 0:r.user)==null?void 0:l.id,last_working_date:s.value.last_working_date,resumption_date:s.value.resumption_date,reason:s.value.reason,works_in_hand:s.value.works_in_hand,handover_user_id:s.value.handover_user_id,leave_days:e,json_data:u},n=await C.storeLeaveApplication(o);n&&L.push({name:"LeaveApplicationShow",params:{id:n==null?void 0:n.id}})}catch(e){_.value=e.message||"Failed to submit leave application"}finally{b.value=!1}};z(()=>{T(()=>{var e;const l=(e=r==null?void 0:r.user)==null?void 0:e.company_id;l&&y.fetchLeaveTypes(l)}),U.fetchTypeWiseEmployees({except:"auth"})});const N=()=>{L.go(-1)};return(l,e)=>{const u=I("RouterLink");return p(),m("div",ae,[a("div",te,[a("button",{class:"btn-3",onClick:N},e[5]||(e[5]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=a("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),a("div",null,[V(u,{to:"/applications",class:"btn-2"},{default:P(()=>e[6]||(e[6]=[Y("Home")])),_:1,__:[6]})])]),b.value?(p(),J(K,{key:0})):(p(),m("form",{key:1,onSubmit:G(M,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[a("div",le,[a("div",null,[e[8]||(e[8]=a("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),c(a("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=o=>s.value.last_working_date=o),class:"input-1 w-full",required:""},null,512),[[k,s.value.last_working_date]])]),a("div",null,[e[9]||(e[9]=a("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),c(a("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=o=>s.value.resumption_date=o),class:"input-1 w-full",required:""},null,512),[[k,s.value.resumption_date]])])]),s.value.last_working_date&&s.value.resumption_date?(p(),m("div",se,[a("p",oe,w(H.value),1)])):h("",!0),i.value.length?(p(),m("div",ne,[e[12]||(e[12]=a("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),a("div",null,[(p(!0),m(A,null,R(i.value,(o,n)=>(p(),m("div",{key:n,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[a("div",re,w(o),1),a("div",de,[(p(!0),m(A,null,R(B(y).leaveTypes,t=>(p(),m("label",{key:t.id,class:"flex items-center space-x-1"},[c(a("input",{type:"radio",name:"leaveType-"+n,value:t.id,"onUpdate:modelValue":v=>d.value[n]=v},null,8,ue),[[x,d.value[n]]]),a("span",null,w(t.name),1)]))),128)),a("label",ie,[c(a("input",{type:"radio",name:"leaveType-"+n,value:"weekend","onUpdate:modelValue":t=>d.value[n]=t},null,8,pe),[[x,d.value[n]]]),e[10]||(e[10]=a("span",null,"Weekend",-1))]),a("label",ve,[c(a("input",{type:"radio",name:"leaveType-"+n,value:"holiday","onUpdate:modelValue":t=>d.value[n]=t},null,8,me),[[x,d.value[n]]]),e[11]||(e[11]=a("span",null," Holiday",-1))])])]))),128))])])):h("",!0),a("div",null,[e[13]||(e[13]=a("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),c(a("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=o=>s.value.reason=o),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[k,s.value.reason]])]),a("div",null,[e[14]||(e[14]=a("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),V(O,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=o=>g.value=o),options:B(U).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])]),a("div",null,[e[15]||(e[15]=a("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),c(a("textarea",{id:"works-in-hand","onUpdate:modelValue":e[4]||(e[4]=o=>s.value.works_in_hand=o),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[k,s.value.works_in_hand]])]),_.value?(p(),m("div",ce,w(_.value),1)):h("",!0),e[16]||(e[16]=a("div",{class:"flex justify-end"},[a("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{xe as default};
