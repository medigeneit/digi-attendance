import{N as ue,u as pe,b as me,r as p,s as Q,x as i,z as ce,A as w,e as ve,m as be,c as h,o as g,a as t,g as A,f as fe,w as ge,t as d,q as c,h as R,v as T,n as C,j as B,K as ye,i as xe}from"./index-Bn9fwYto.js";import{L as he}from"./LoaderView-D4kBK7uD.js";import{_ as H}from"./MultiselectDropdown-DrGayDMr.js";import{_ as _e}from"./TextEditor-DUj5Q1yq.js";import{u as we}from"./company-8B53_O-G.js";import{u as Ce}from"./department-DIwzJSYA.js";import{u as ke}from"./notice-C4VjYEtz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DDhF2qZ5.js";const Ve={class:"my-container space-y-4"},Ne={class:"card-bg md:p-8 p-4 mx-4"},je={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},De={class:"rounded-xl border bg-white p-4 flex items-center justify-between"},Se={class:"flex items-center gap-3"},ze={class:"font-semibold"},Ue={class:"rounded-xl border bg-white p-4 flex items-center justify-between"},Ee={class:"flex items-center gap-3"},Ae={class:"font-semibold"},Be={class:"rounded-xl border bg-white p-4"},Me={class:"flex items-center justify-between"},Pe={class:"flex items-center gap-3"},$e={class:"font-semibold"},Fe={class:"border p-4 rounded-xl bg-white space-y-6 shadow-sm"},Le={class:"grid md:grid-cols-3 gap-4"},Re={class:"w-full"},Te={class:"inline-flex rounded-lg border overflow-hidden"},He={class:"w-full"},Ge={class:"w-full"},qe={key:0,class:"text-xs text-red-600 mt-1"},Je={class:"space-y-3"},Oe={class:"flex items-center justify-between"},Ie={class:"inline-flex rounded-lg border overflow-hidden"},Ke={class:"grid md:grid-cols-2 gap-6"},Xe={class:"space-y-3"},Qe={class:"flex items-center justify-between"},We={class:"inline-flex rounded-lg border overflow-hidden"},Ye={class:"space-y-3"},Ze={class:"flex items-center justify-between"},et={class:"inline-flex items-center gap-3"},tt={class:"text-xs text-gray-500"},lt={class:"inline-flex rounded-lg border overflow-hidden"},st={class:"border p-4 rounded-xl bg-white space-y-6 shadow-sm"},ot={class:"space-y-2"},at={key:0,class:"mb-2"},nt=["href"],it={class:"w-full rounded-lg border border-dashed p-4 hover:bg-gray-50 transition"},dt={class:"flex items-center justify-between gap-3"},rt={class:"inline-flex items-center"},ut=["disabled"],pt={key:0,class:"mt-3"},mt={class:"h-2 bg-gray-200 rounded overflow-hidden"},ct={class:"flex items-center justify-between mt-1 text-xs text-gray-600"},vt={class:"sticky bottom-0 bg-white/90 backdrop-blur flex justify-center gap-4 p-3 rounded-xl border"},bt=["disabled"],ft={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4"},gt={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 space-y-4"},yt={class:"text-sm text-gray-600 break-words"},xt={class:"flex justify-end gap-3"},zt={__name:"NoticeEdit",setup(ht){const r=ue(),G=pe(),M=me(),P=p(!1),k=p(!1),$=ke(),q=we(),y=Ce(),{companies:W}=Q(q),{employees:F}=Q(y),V=i(()=>y.departments||[]),N=i(()=>Array.isArray(F.value)?F.value:[]),j=i(()=>W.value||[]),l=ce({title:"",type:1,description:"",published_at:"",expired_at:"",all_companies:!1,all_departments:!1,all_employees:!1,file_url:null}),v=p([]),b=p([]),u=p([]),m=p(null),D=p(0),x=p(!1),S=p(!1);let _=null;const Y=i(()=>{var s;return((s=m.value)==null?void 0:s.name)||""}),Z=i(()=>m.value?(m.value.size/(1024*1024)).toFixed(2):"0.00"),J=i(()=>v.value.map(s=>s.id)),O=i(()=>b.value.map(s=>s.id)),ee=i(()=>u.value.map(s=>s.id)),I=s=>{if(!s)return"";const e=String(s).split(" ")[0];return e.includes("-")?e:""},L=i(()=>{if(l.type===2||!l.published_at||!l.expired_at)return!0;try{const s=new Date(l.published_at);return new Date(l.expired_at)>=s}catch{return!0}}),te=i(()=>!!l.title&&!x.value&&L.value),z=i({get:()=>l.all_companies?"all":"custom",set:s=>{l.all_companies=s==="all",v.value=l.all_companies?[...j.value]:[]}}),U=i({get:()=>l.all_departments?"all":"custom",set:s=>{l.all_departments=s==="all",b.value=l.all_departments?[...V.value]:[]}}),E=i({get:()=>l.all_employees?"all":"custom",set:s=>{l.all_employees=s==="all",u.value=l.all_employees?[...N.value]:[]}});w(()=>l.all_companies,async s=>{s&&await y.fetchDepartments()}),w(J,async s=>{l.all_companies||await y.fetchDepartments(s)}),w(()=>l.all_departments,async s=>{s&&await y.fetchDepartmentEmployee("all")}),w(O,async s=>{l.all_departments||await y.fetchDepartmentEmployee(s)}),w([u,F],([s,e])=>{const a=Array.isArray(e)?e.length:0;l.all_employees=a>0&&s.length===a});const le=async()=>{var e,a,o,f,X;const s=M.params.id;try{const n=await $.fetchNotice(s);l.title=n.title??"",l.type=Number(n.type??1),l.published_at=I(n.published_at),l.expired_at=I(n.expired_at),l.description=n.description??"",l.file_url=n.file_url||n.file||null,v.value=n.companies_notice||[],b.value=n.departments||[],u.value=n.employees||[],l.all_companies=(((e=n.companies_notice)==null?void 0:e.length)??0)===0,l.all_departments=(((a=n.departments)==null?void 0:a.length)??0)===0,l.all_employees=(((o=n.employees)==null?void 0:o.length)??0)===0,l.all_companies&&(v.value=[...j.value]),l.all_departments&&(b.value=[...V.value]),l.all_employees&&(u.value=[...N.value])}catch(n){const re=((X=(f=n==null?void 0:n.response)==null?void 0:f.data)==null?void 0:X.message)||"Failed to load notice data";r.error(re),G.push({name:"NoticeList"})}},se=s=>{var o,f;const e=(f=(o=s==null?void 0:s.target)==null?void 0:o.files)==null?void 0:f[0];if(!e)return;if(!["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)){r.error("Unsupported file type. Allowed: jpg, jpeg, png, pdf, doc, docx.");return}if(e.size>2*1024*1024){r.error("File size must be ≤ 2MB.");return}m.value=e,S.value=!0},oe=async()=>{var s,e;try{const a=M.params.id;if(!(m.value instanceof Blob))return;D.value=0,x.value=!0,_=new AbortController;const o=await $.updateNoticeFile(a,m.value,{onProgress:f=>D.value=f,signal:_.signal});l.file_url=(o==null?void 0:o.file_url)||(o==null?void 0:o.file)||l.file_url,r.success("File uploaded successfully.")}catch(a){if((a==null?void 0:a.name)==="CanceledError"||(a==null?void 0:a.message)==="canceled")r.info("Upload canceled.");else{const o=((e=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Upload failed.";r.error(o)}}finally{x.value=!1,S.value=!1,m.value=null,_=null}},ae=()=>{_&&_.abort()},ne=async()=>{var s,e;if(!L.value){r.error("Expire date must be the same or after Publish date.");return}try{k.value=!0;const a=M.params.id,o={title:l.title,type:l.type,description:l.description,published_at:l.type===2?null:l.published_at||null,expired_at:l.type===2?null:l.expired_at||null,all_companies:!!l.all_companies,all_departments:!!l.all_departments,all_employees:!!l.all_employees,company_ids:J.value,department_ids:O.value,employee_ids:ee.value};await $.updateNotice(a,o),r.success("Notice updated successfully"),G.push({name:"NoticeShow",params:{id:a}})}catch(a){const o=((e=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Failed to update notice";r.error(o)}finally{k.value=!1}};ve(async()=>{P.value=!0,await q.fetchCompanies(),await le(),P.value=!1});const ie=i(()=>j.value.length),de=i(()=>V.value.length),K=i(()=>N.value.length);return(s,e)=>{const a=be("RouterLink");return g(),h("div",Ve,[t("div",Ne,[e[37]||(e[37]=t("h2",{class:"title-lg text-center"},"Edit Notice",-1)),P.value?(g(),fe(he,{key:0,class:"bg-gray-100 border shadow-none"})):(g(),h("form",{key:1,onSubmit:ge(ne,["prevent"]),class:"space-y-5"},[t("div",je,[t("div",De,[t("div",Se,[e[17]||(e[17]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-blue-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-blue-600"},[t("path",{fill:"currentColor",d:"M3 10v10h18V10H3zm9-7l9 7H3l9-7z"})])],-1)),t("div",null,[e[16]||(e[16]=t("div",{class:"text-sm text-gray-500"},"Companies",-1)),t("div",ze,d(l.all_companies?"All":v.value.length)+" / "+d(ie.value),1)])])]),t("div",Ue,[t("div",Ee,[e[19]||(e[19]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-purple-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-purple-600"},[t("path",{fill:"currentColor",d:"M3 5h18v2H3V5zm3 4h12v10H6V9z"})])],-1)),t("div",null,[e[18]||(e[18]=t("div",{class:"text-sm text-gray-500"},"Departments",-1)),t("div",Ae,d(l.all_departments?"All":b.value.length)+" / "+d(de.value),1)])])]),t("div",Be,[t("div",Me,[t("div",Pe,[e[21]||(e[21]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-emerald-600"},[t("path",{fill:"currentColor",d:"M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"})])],-1)),t("div",null,[e[20]||(e[20]=t("div",{class:"text-sm text-gray-500"},"Employees",-1)),t("div",$e,d(l.all_employees?"All":u.value.length)+" / "+d(K.value),1)])])])])]),t("div",Fe,[e[28]||(e[28]=t("h2",{class:"text-lg font-semibold"},"Notice Information",-1)),t("div",Le,[t("div",Re,[e[22]||(e[22]=t("label",{for:"type",class:"font-medium block mb-1"},"Type*",-1)),t("div",Te,[t("button",{type:"button",class:c(["px-4 py-2 text-sm",l.type===1?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[0]||(e[0]=o=>l.type=1)}," General ",2),t("button",{type:"button",class:c(["px-4 py-2 text-sm border-l",l.type===2?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[1]||(e[1]=o=>l.type=2)}," Policy ",2)])]),t("div",He,[e[23]||(e[23]=t("label",{class:"font-medium block mb-1"},"Publish Date",-1)),R(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.published_at=o),type:"date",class:"w-full p-2 border rounded"},null,512),[[T,l.published_at]])]),t("div",Ge,[e[24]||(e[24]=t("label",{class:"font-medium block mb-1"},"Expire Date",-1)),R(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>l.expired_at=o),type:"date",class:"w-full p-2 border rounded"},null,512),[[T,l.expired_at]]),L.value?A("",!0):(g(),h("p",qe," Expire date must be the same or after Publish date. "))])]),t("div",Je,[t("div",Oe,[e[25]||(e[25]=t("label",{class:"font-medium"},"Companies",-1)),t("div",Ie,[t("button",{type:"button",class:c(["px-3 py-1.5 text-xs",z.value==="all"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[4]||(e[4]=o=>z.value="all")},"All",2),t("button",{type:"button",class:c(["px-3 py-1.5 text-xs border-l",z.value==="custom"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[5]||(e[5]=o=>z.value="custom")},"Custom",2)])]),t("div",null,[C(H,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=o=>v.value=o),options:j.value,multiple:!0,searchable:!0,placeholder:"Select companies","track-by":"id",label:"name"},null,8,["modelValue","options"])])]),t("div",Ke,[t("div",Xe,[t("div",Qe,[e[26]||(e[26]=t("label",{class:"font-medium"},"Departments",-1)),t("div",We,[t("button",{type:"button",class:c(["px-3 py-1.5 text-xs",U.value==="all"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[7]||(e[7]=o=>U.value="all")},"All",2),t("button",{type:"button",class:c(["px-3 py-1.5 text-xs border-l",U.value==="custom"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[8]||(e[8]=o=>U.value="custom")},"Custom",2)])]),C(H,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=o=>b.value=o),options:V.value,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name"},null,8,["modelValue","options"])]),t("div",Ye,[t("div",Ze,[e[27]||(e[27]=t("label",{class:"font-medium"},"Employees",-1)),t("div",et,[t("span",tt," Selected "+d(u.value.length)+" / "+d(K.value),1),t("div",lt,[t("button",{type:"button",class:c(["px-3 py-1.5 text-xs",E.value==="all"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[10]||(e[10]=o=>E.value="all")},"All",2),t("button",{type:"button",class:c(["px-3 py-1.5 text-xs border-l",E.value==="custom"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[11]||(e[11]=o=>E.value="custom")},"Custom",2)])])]),C(H,{modelValue:u.value,"onUpdate:modelValue":e[12]||(e[12]=o=>u.value=o),options:N.value,multiple:!0,searchable:!0,placeholder:"Select employee","track-by":"id",label:"name"},null,8,["modelValue","options"])])])]),t("div",st,[e[35]||(e[35]=t("h2",{class:"text-lg font-semibold"},"Notice Content",-1)),t("div",null,[e[29]||(e[29]=t("label",{class:"font-medium block mb-1"},"Title*",-1)),R(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>l.title=o),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[T,l.title]])]),t("div",ot,[e[33]||(e[33]=t("label",{class:"font-medium block mb-1"},"Attachment",-1)),l.file_url?(g(),h("div",at,[t("a",{href:l.file_url,target:"_blank",class:"inline-flex items-center gap-2 text-blue-600 underline"},e[30]||(e[30]=[t("svg",{viewBox:"0 0 24 24",class:"h-4 w-4"},[t("path",{fill:"currentColor",d:"M14 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),t("path",{fill:"currentColor",d:"M14 3v6h6"})],-1),B(" View Current File ")]),8,nt)])):A("",!0),t("div",it,[t("div",dt,[e[32]||(e[32]=t("div",{class:"text-sm text-gray-600"},[t("div",{class:"font-medium"},"Upload new file"),t("div",null,"JPG, JPEG, PNG, PDF, DOC, DOCX (≤ 2MB)")],-1)),t("label",rt,[t("input",{type:"file",accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",onChange:se,class:"hidden",disabled:x.value},null,40,ut),e[31]||(e[31]=t("span",{class:"px-4 py-2 rounded border bg-white hover:bg-gray-50 cursor-pointer"}," Browse… ",-1))])]),x.value?(g(),h("div",pt,[t("div",mt,[t("div",{class:"h-2 bg-blue-600 transition-all",style:ye({width:D.value+"%"})},null,4)]),t("div",ct,[t("span",null,d(D.value)+"%",1),t("button",{type:"button",class:"px-3 py-1 rounded border hover:bg-gray-50",onClick:ae}," Cancel ")])])):A("",!0)])]),t("div",null,[e[34]||(e[34]=t("label",{class:"font-medium block mb-1"},"Description",-1)),C(_e,{modelValue:l.description,"onUpdate:modelValue":e[14]||(e[14]=o=>l.description=o),class:"w-full px-4 py-2"},null,8,["modelValue"])])]),t("div",vt,[C(a,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:xe(()=>e[36]||(e[36]=[B(" Cancel ")])),_:1,__:[36]}),t("button",{disabled:k.value||x.value||!te.value,type:"submit",class:"bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 disabled:opacity-60"},d(k.value?"Saving…":"Save"),9,bt)])],32))]),S.value?(g(),h("div",ft,[t("div",gt,[e[41]||(e[41]=t("h3",{class:"text-lg font-semibold"},"Upload this file?",-1)),t("p",yt,[e[38]||(e[38]=t("span",{class:"font-medium"},"Name:",-1)),B(" "+d(Y.value),1),e[39]||(e[39]=t("br",null,null,-1)),e[40]||(e[40]=t("span",{class:"font-medium"},"Size:",-1)),B(" "+d(Z.value)+" MB ",1)]),t("div",xt,[t("button",{class:"px-4 py-2 rounded border hover:bg-gray-50",onClick:e[15]||(e[15]=o=>{S.value=!1,m.value=null})}," Cancel "),t("button",{class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",onClick:oe}," Upload ")])])])):A("",!0)])}}};export{zt as default};
