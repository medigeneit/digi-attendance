import{d as oe,s as z,r as g,x as I,ac as Z,A as W,e as te,c as d,o as r,a as e,f as O,w as se,g as L,h as x,v as D,S as ne,t as _,F as M,y as j,q as re,k as T,ad as Y,n as B,u as de,b as ue,m as ie,B as ce,i as ee,X as ve}from"./index-DBkH8yyG.js";import{L as ae}from"./LoaderView-JXku94jZ.js";import{_ as ye}from"./MultiselectDropdown-Dbo6e8on.js";import{u as pe}from"./holiday-C1AW85B4.js";import{u as le}from"./leave-application-za7gAJQ0.js";import{u as me}from"./leave-type-DpzNTThL.js";import{u as P}from"./user-DelkH_5d.js";import{_ as _e}from"./EmployeeFilter-BCi79Otx.js";import{S as fe}from"./SelectedEmployeeCard-DqGvCR-q.js";import{u as be}from"./company-Dt9wELO_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-Bz9h_nBX.js";import"./department-kKVKcoBm.js";import"./EmployeeDropdownInput-BceDnX-W.js";import"./SelectDropdown-B-DUI2oB.js";import"./UserChip-BWY-xgPI.js";const ge={class:"space-y-4 p-2 md:p-4"},xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},he={class:"inline-flex items-center space-x-2"},we={key:0},ke={class:"text-blue-600 font-medium"},Le={key:1,class:"bg-gray-100 p-2 rounded-md"},Se={class:"font-semibold"},$e={class:"flex flex-wrap gap-2"},Ue=["name","value","onUpdate:modelValue","disabled"],Ae={class:"flex items-center space-x-1"},De=["name","onUpdate:modelValue"],Ce={class:"flex items-center space-x-1"},qe=["name","onUpdate:modelValue"],Ve={key:2},Be={key:3},Te={key:4,class:"text-red-500 text-sm"},Me={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(C,{emit:F}){const n=C,w=F,A=le();me();const k=P(),S=oe(),U=pe(),{userLeaveBalance:q}=z(k),V=g(""),h=g(!0),o=g({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),a=g([]),i=g(!1),$=g(null),f=I(()=>{var c,s,u;return((s=(c=n==null?void 0:n.userInfo)==null?void 0:c.assign_weekend)==null?void 0:s.weekends)||((u=n==null?void 0:n.userInfo)==null?void 0:u.weekends)}),b=I(()=>{const c=o.value.last_working_date,s=o.value.resumption_date;if(!c||!s)return[];const u=new Date(c),v=new Date(s);if(v<=u)return[];const m=[];let y=new Date(u);for(y.setDate(y.getDate()+1);y<v;){const p=y.getFullYear(),l=(y.getMonth()+1).toString().padStart(2,"0"),R=y.getDate().toString().padStart(2,"0");m.push(`${p}-${l}-${R}`),y.setDate(y.getDate()+1)}return m}),H=I(()=>{if(!o.value.last_working_date||!o.value.resumption_date)return"";const c=new Date(o.value.last_working_date);return new Date(o.value.resumption_date)<=c?"Resumption date must be after Last Working Date.":b.value.length===0?"No leave days between the selected dates.":`Total leave days: ${b.value.length}`});Z(async()=>{var c;b.value.length&&q.value.length&&(await U.fetchHolidays({company_id:(c=S==null?void 0:S.user)==null?void 0:c.company_id,start_date:b.value[0],end_date:b.value[b.value.length-1]}),b.value.forEach(async(s,u)=>{const v=new Date(s).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),m=v.charAt(0).toUpperCase()+v.slice(1);f.value.includes(m)&&(a.value[u]="weekend"),U.holidayDates.includes(s)&&(a.value[u]="holiday")}))}),W(()=>V.value,c=>{o.value.handover_user_id=c==null?void 0:c.id});const N=async()=>{var c;i.value=!0,$.value=null;try{const s=b.value.map((y,p)=>({date:y,leave_type_id:a.value[p]!=="weekend"&&a.value[p]!=="holiday"?a.value[p]:null})).filter(y=>y.leave_type_id!==null),u=b.value.map((y,p)=>({date:y,leave_type_id:a.value[p]||""})).filter(y=>y.leave_type_id!==null),v={user_id:(c=n==null?void 0:n.userInfo)==null?void 0:c.id,last_working_date:o.value.last_working_date,resumption_date:o.value.resumption_date,reason:o.value.reason,works_in_hand:o.value.works_in_hand,handover_user_id:h.value?null:o.value.handover_user_id,leave_days:s,json_data:u,is_direct_approve:h.value};await A.storeAdminLeaveApplication(v)&&w("formSuccessClosed")}catch(s){$.value=s.message||"Failed to submit leave application"}finally{i.value=!1}};return te(async()=>{Z(()=>{var s;const c=(s=n==null?void 0:n.userInfo)==null?void 0:s.id;c&&k.fetchUserLeaveBalances(c)}),await k.fetchTypeWiseEmployees({except:"auth"})}),(c,s)=>(r(),d("div",ge,[s[16]||(s[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),i.value?(r(),O(ae,{key:0})):(r(),d("form",{key:1,onSubmit:se(N,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",xe,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=u=>o.value.last_working_date=u),class:"input-1 w-full",required:""},null,512),[[D,o.value.last_working_date]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=u=>o.value.resumption_date=u),class:"input-1 w-full",required:""},null,512),[[D,o.value.resumption_date]])])]),e("div",null,[e("label",he,[x(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=u=>h.value=u),class:"form-checkbox text-blue-600"},null,512),[[ne,h.value]]),s[8]||(s[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),o.value.last_working_date&&o.value.resumption_date?(r(),d("div",we,[e("p",ke,_(H.value),1)])):L("",!0),b.value.length?(r(),d("div",Le,[s[11]||(s[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),(r(!0),d(M,null,j(b.value,(u,v)=>(r(),d("div",{key:v,class:re(["flex gap-4 mb-2 bg-white p-2 rounded-md",{"!bg-red-500":a.value[v]==="Weekend"}])},[e("div",Se,_(u),1),e("div",$e,[(r(!0),d(M,null,j(T(q),m=>(r(),d("label",{key:m.id,class:"flex items-center space-x-1"},[x(e("input",{type:"radio",name:"leaveType-"+v,value:m.id,"onUpdate:modelValue":y=>a.value[v]=y,disabled:a.value.filter(y=>y===m.id).length>=m.remaining_days},null,8,Ue),[[Y,a.value[v]]]),e("span",null,_(m.leave_type),1)]))),128)),e("label",Ae,[x(e("input",{type:"radio",name:"leaveType-"+v,value:"weekend","onUpdate:modelValue":m=>a.value[v]=m},null,8,De),[[Y,a.value[v]]]),s[9]||(s[9]=e("span",null,"Weekend",-1))]),e("label",Ce,[x(e("input",{type:"radio",name:"leaveType-"+v,value:"holiday","onUpdate:modelValue":m=>a.value[v]=m},null,8,qe),[[Y,a.value[v]]]),s[10]||(s[10]=e("span",null,"Holiday",-1))])])],2))),128))])):L("",!0),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),x(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=u=>o.value.reason=u),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[D,o.value.reason]])]),h.value?L("",!0):(r(),d("div",Ve,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),B(ye,{modelValue:V.value,"onUpdate:modelValue":s[4]||(s[4]=u=>V.value=u),options:T(k).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),h.value?L("",!0):(r(),d("div",Be,[s[14]||(s[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),x(e("textarea",{id:"works-in-hand","onUpdate:modelValue":s[5]||(s[5]=u=>o.value.works_in_hand=u),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[D,o.value.works_in_hand]])])),$.value?(r(),d("div",Te,_($.value),1)):L("",!0),s[15]||(s[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Fe={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},je={class:"bg-white rounded-lg shadow-lg w-full max-w-3xl"},Re={class:"px-6 py-4 border-b"},Ee={class:"text-lg font-bold"},Ie={class:"table-auto w-full border"},We={class:"p-2"},He=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],Ye={class:"p-2"},ze=["onUpdate:modelValue"],Oe={class:"p-2"},Pe=["onUpdate:modelValue"],Je={__name:"UserLeaveBalanceModal",props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0}},emits:["close"],setup(C,{emit:F}){const n=C,w=F,A=be(),k=P(),S=g([]),U=g(!1);W(()=>n.show,async o=>{var a;o&&((a=n.user)!=null&&a.id)&&!U.value&&(await q(),U.value=!0)}),W(()=>{var o;return(o=n.user)==null?void 0:o.id},()=>{U.value=!1,S.value=[]});const q=async()=>{try{const o=await k.fetchUserLeaveTypes(n.user.id);if(o!=null&&o.length)S.value=o;else{const a=await A.fetchCompanyLeaveTypes(n.user.company_id);S.value=a.data.map(i=>({id:i.id,name:i.name,annual_quota:i.annual_quota||0,max_consecutive_days:i.max_consecutive_days||null,type:i.type||"Paid"}))}}catch(o){console.error("Failed to load leave balances or fallback types:",o)}},V=async()=>{try{await k.saveLeaveBalances(n.user.id,S.value),w("close")}catch(o){console.error("Failed to save leave balances:",o)}},h=()=>{w("close")};return(o,a)=>C.show&&C.user?(r(),d("div",Fe,[e("div",je,[e("div",Re,[e("h3",Ee,"Set Leave Balances for "+_(C.user.name),1)]),e("form",{onSubmit:se(V,["prevent"]),class:"p-6 space-y-4"},[e("table",Ie,[a[0]||(a[0]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"p-2"},"Leave Type"),e("th",{class:"p-2"},"Annual Quota"),e("th",{class:"p-2"},"Max Consecutive Days")])],-1)),e("tbody",null,[(r(!0),d(M,null,j(S.value,(i,$)=>(r(),d("tr",{key:$},[e("td",We,[x(e("input",{type:"hidden","onUpdate:modelValue":f=>i.id=f,class:"input-1 w-full"},null,8,He),[[D,i.id]]),x(e("input",{"onUpdate:modelValue":f=>i.name=f,class:"input-1 w-full",disabled:""},null,8,Ne),[[D,i.name]])]),e("td",Ye,[x(e("input",{"onUpdate:modelValue":f=>i.annual_quota=f,type:"number",min:"0",class:"input-1 w-full"},null,8,ze),[[D,i.annual_quota,void 0,{number:!0}]])]),e("td",Oe,[x(e("input",{"onUpdate:modelValue":f=>i.max_consecutive_days=f,type:"number",min:"0",class:"input-1 w-full"},null,8,Pe),[[D,i.max_consecutive_days,void 0,{number:!0}]])])]))),128))])]),e("div",{class:"flex justify-end gap-2 pt-4 border-t"},[e("button",{type:"button",onClick:h,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancel "),a[1]||(a[1]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," Save ",-1))])],32)])])):L("",!0)}},Qe={class:"space-y-2 px-4"},Xe={class:"flex flex-wrap gap-2"},Ge=["value"],Ke={key:0,class:"text-center py-4"},Ze={key:1,class:"space-y-4"},et={key:0,class:"bg-sky-100/30 p-4 rounded-lg shadow mb-6 space-y-6"},tt={class:"grid md:grid-cols-2 gap-6"},st={class:"bg-white border rounded-lg p-4 shadow"},at={class:"overflow-x-auto"},lt={class:"min-w-full text-sm text-left text-gray-700 border"},ot={class:"px-4 py-1 text-center font-medium"},nt={class:"px-4 py-1 text-center"},rt={class:"px-4 py-1 text-center"},dt={class:"px-4 py-1 text-center"},ut={class:"overflow-x-auto"},it={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},ct={class:"border border-gray-300 px-2 py-2"},vt={class:"border border-gray-300 px-2 py-2 text-center"},yt={class:"border border-gray-300 px-2 py-2 text-center"},pt={class:"border border-gray-300 px-2 py-2"},mt={class:"border border-gray-300 px-2 py-2"},_t=["innerHTML"],ft={class:"border border-gray-300 px-2 py-2 text-center"},bt={class:"border border-gray-300 px-2 py-2"},gt={class:"border border-gray-300 px-2"},xt={class:"flex justify-center gap-2"},ht=["onClick"],wt={key:0},kt={key:0},Lt={class:"text-center py-2",colspan:"6"},St={key:0,class:"fixed inset-0 z-[1000] bg-black bg-opacity-50 flex items-center justify-center"},$t={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},Nt={__name:"AdminLeaveApplication",setup(C){const F=de(),n=ue(),w=le(),A=P(),{user:k,leave_balances:S,leaveApplications:U,loading:q}=z(w),{userLeaveBalance:V}=z(A),h=g(n.query.year||w.selectedYear),o=g(n.query.search||""),a=g({company_id:n.query.company_id||"",department_id:n.query.department_id||"all",line_type:n.query.line_type||"all",employee_id:n.query.employee_id||""}),i=g(!1),$=g(!1),f=async()=>{const p={selectedYear:h.value,selectedStatus:w.selectedStatus,query:o.value};a.value.employee_id?(p.user_id=a.value.employee_id,q.value=!0,await w.fetchYearlyUserLeaveApplications(p),q.value=!1):U.value=[]};te(async()=>{await f(),n.query.employee_id&&await A.fetchUserLeaveBalances(n.query.employee_id)}),W(()=>n.query.employee_id,async p=>{p&&await A.fetchUserLeaveBalances(p)});const b=I(()=>U.value||[]),H=()=>F.go(-1),N=async()=>{F.replace({query:{...n.query,company_id:a.value.company_id,department_id:a.value.department_id,line_type:a.value.line_type,employee_id:a.value.employee_id}}),await f()},c=()=>{$.value=!0},s=async()=>{i.value=!1,await f()},u=new Date().getFullYear(),v=g([]);for(let p=2023;p<=u;p++)v.value.push(p);const m=async p=>{confirm("Are you sure to delete this application?")&&(await w.deleteLeaveApplication(p),await f())},y=()=>{$.value=!1,A.fetchUserLeaveBalances(n.query.employee_id)};return(p,l)=>{var J,Q;const R=ie("RouterLink");return r(),d(M,null,[e("div",Qe,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:H},l[8]||(l[8]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),l[9]||(l[9]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),l[10]||(l[10]=e("div",null,null,-1))]),e("div",Xe,[B(_e,{company_id:a.value.company_id,"onUpdate:company_id":l[0]||(l[0]=t=>a.value.company_id=t),department_id:a.value.department_id,"onUpdate:department_id":l[1]||(l[1]=t=>a.value.department_id=t),employee_id:a.value.employee_id,"onUpdate:employee_id":l[2]||(l[2]=t=>a.value.employee_id=t),line_type:a.value.line_type,"onUpdate:line_type":l[3]||(l[3]=t=>a.value.line_type=t),"with-type":!0,"initial-value":p.$route.query,onFilterChange:N},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),e("div",null,[x(e("select",{"onUpdate:modelValue":l[4]||(l[4]=t=>h.value=t),onChange:f,class:"input-1"},[(r(!0),d(M,null,j(v.value,t=>(r(),d("option",{key:t,value:t},_(t),9,Ge))),128))],544),[[ce,h.value]])])]),T(w).loading?(r(),d("div",Ke,[B(ae)])):(r(),d("div",Ze,[(J=a.value)!=null&&J.employee_id?(r(),d("div",et,[l[13]||(l[13]=e("h2",{class:"text-xl font-bold text-gray-800 text-center"},"Employee Overview",-1)),e("div",tt,[B(fe,{user:T(k)},null,8,["user"]),e("div",st,[e("div",{class:"flex justify-between items-center"},[l[11]||(l[11]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Leave Balance",-1)),e("button",{onClick:c,type:"button",class:"btn-2"},"Set Leave Balance")]),e("div",at,[e("table",lt,[l[12]||(l[12]=e("thead",{class:"bg-gray-100 text-xs uppercase"},[e("tr",null,[e("th",{class:"px-4 py-2 text-center"},"Type"),e("th",{class:"px-4 py-2 text-center"},"Total"),e("th",{class:"px-4 py-2 text-center"},"Used"),e("th",{class:"px-4 py-2 text-center"},"Remaining")])],-1)),e("tbody",null,[(r(!0),d(M,null,j(T(V),t=>(r(),d("tr",{key:t.id,class:"border-t hover:bg-gray-50"},[e("td",ot,_(t.leave_type),1),e("td",nt,_(t.annual_quota),1),e("td",rt,_(t.used_days),1),e("td",dt,_(t.remaining_days),1)]))),128))])])])])])])):L("",!0),e("div",ut,[e("table",it,[l[18]||(l[18]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Type"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")])],-1)),e("tbody",null,[(r(!0),d(M,null,j(b.value,(t,X)=>{var G;return r(),d("tr",{key:X,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ct,_(X+1),1),e("td",vt,_(t==null?void 0:t.last_working_date),1),e("td",yt,_(t==null?void 0:t.resumption_date),1),e("td",pt,_(t==null?void 0:t.leave_period),1),e("td",mt,[e("div",{innerHTML:(t==null?void 0:t.duration)||(t==null?void 0:t.total_leave_days)},null,8,_t)]),e("td",ft,_([...new Set((G=t==null?void 0:t.leave_days)==null?void 0:G.map(E=>{var K;return(K=E==null?void 0:E.leave_type)==null?void 0:K.name}))].join(",")),1),e("td",bt,_((t==null?void 0:t.status)||"N/A"),1),e("td",gt,[e("div",xt,[B(R,{to:{name:"LeaveApplicationShow",params:{id:t==null?void 0:t.id}},class:"btn-icon",target:"_blank"},{default:ee(()=>l[14]||(l[14]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[14]},1032,["to"]),["Approved","Rejected"].includes(t==null?void 0:t.status)?L("",!0):(r(),O(R,{key:0,to:{name:"LeaveApplicationEdit",params:{id:t==null?void 0:t.id}},class:"btn-icon",target:"_blank"},{default:ee(()=>l[15]||(l[15]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[15]},1032,["to"])),e("button",{onClick:E=>m(t==null?void 0:t.id),class:"btn-icon text-red-500"},l[16]||(l[16]=[e("i",{class:"far fa-trash"},null,-1)]),8,ht)])])])}),128)),b.value.length?L("",!0):(r(),d("tr",wt,l[17]||(l[17]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(Q=a.value)!=null&&Q.employee_id?(r(),d("tr",kt,[e("th",Lt,[e("button",{onClick:l[5]||(l[5]=t=>i.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):L("",!0)])])])]))]),B(Je,{show:$.value,user:T(k),onClose:y},null,8,["show","user"]),(r(),O(ve,{to:"body"},[i.value?(r(),d("div",St,[e("div",$t,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:l[6]||(l[6]=t=>i.value=!1)}," × "),B(Me,{userInfo:T(k),onClose:l[7]||(l[7]=t=>i.value=!1),onFormSuccessClosed:s},null,8,["userInfo"])])])):L("",!0)]))],64)}}};export{Nt as default};
