import{E as Z,r as P,e as Q,G as tt,A as W,c as l,o,f as b,a as s,t as x,H as X,n as w,h as a,w as $,l as g,p as T,D as st,m as S,b as et,u as at,q as C,k as H,F as z,x as D,y as nt}from"./index-D2ntkdUR.js";import{u as ot,_ as rt,O as K,a as it}from"./task-priority-Dw3zKWuW.js";import{_ as lt}from"./TaskAddForm-DkduteEc.js";import{_ as dt}from"./TaskEditForm-BDE7T6e6.js";import{_ as ut,g as J,a as pt}from"./TaskTreeView-C0vSie66.js";import{_ as mt}from"./UserChip-Ckcu_54G.js";import{u as kt}from"./useTaskStore-CEpxYBsP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-tvmAMMZ1.js";import"./SectionLoading-Bk1xpN7Z.js";const ct={key:0},ft={key:0},gt={key:1},yt=Z({__name:"CountdownTimer",props:{targetDateTime:{}},setup(c){const e=c,n=P(p());let u;function p(){const m=new Date(e.targetDateTime).getTime()-new Date().getTime(),y=Math.floor(m/1e3%60),h=Math.floor(m/1e3/60%60),v=Math.floor(m/(1e3*60*60)%24),d=Math.floor(m/(1e3*60*60*24));return{total:m,days:d,hours:v,minutes:h,seconds:y}}function r(){n.value=p()}return Q(()=>{u=setInterval(()=>{r(),n.value.total<=0&&clearInterval(u)},1e3)}),tt(()=>clearInterval(u)),W(()=>e.targetDateTime,()=>{r(),clearInterval(u)}),(m,y)=>n.value.total>0?(o(),l("div",ct,[n.value.days?(o(),l("span",ft,x(n.value.days)+"d ",1)):b("",!0),s("span",null,x(n.value.hours.toString().padStart(2,"0"))+"h :",1),s("span",null,x(n.value.minutes.toString().padStart(2,"0"))+"m :",1),s("span",null,x(n.value.seconds.toString().padStart(2,"0"))+"s",1)])):(o(),l("div",gt,[X(m.$slots,"expired",{},()=>[y[0]||(y[0]=w("Timeâ€™s up!"))])]))}}),vt={class:"mb-3"},xt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},_t={key:1,class:"text-center py-4 text-gray-500"},bt={key:2,class:"text-center py-4 text-red-500"},Tt={key:3,class:"space-y-4"},ht={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(c,{emit:e}){const n=c,u=e,p=P(null),{handleItemsPriorityUpdate:r,saveTaskPriority:m,listHasRearranged:y}=ot(()=>n.tasks,n.parentId),h=async()=>{await m(),u("updatePriority")};return(v,d)=>(o(),l("div",null,[s("div",vt,[X(v.$slots,"task:header")]),a(y)?(o(),l("div",xt,[d[3]||(d[3]=s("span",{class:"text-red-500"},"Priority Changed",-1)),s("button",{class:"btn-3",onClick:$(h,["prevent"])},"Save"),s("button",{class:"btn-3",onClick:d[0]||(d[0]=$((...i)=>p.value.resetItems&&p.value.resetItems(...i),["prevent"]))},"Discard")])):b("",!0),c.loading?(o(),l("div",_t,"Loading tasks...")):c.error?(o(),l("div",bt,x(c.error),1)):(o(),l("div",Tt,[g(rt,{items:c.tasks,handle:"handle",onItemsUpdate:a(r),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:p},{item:T(({item:i,index:_})=>[g(ut,{index:_,task:i,class:"!border-0",onCommentButtonClick:f=>u("commentButtonClick",i.id),onEditClick:d[1]||(d[1]=f=>u("editClick",f)),onAddClick:d[2]||(d[2]=f=>u("addClick",f)),showDraggableHandle:!0},null,8,["index","task","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},wt={class:"flex justify-between mt-5"},Ct={class:"flex flex-wrap items-center gap-2 mt-3"},It={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(c,{emit:e}){const n=c,u=e,p=P(),r=st({show:!1,parentId:n.parentId,requirementId:null}),m=d=>{r.show=!0,r.parentId=d,console.log({addForm:r})};function y(){r.show=!1,r.parentId=n.parentId,u("created")}function h(){p.value=!1,u("updated")}function v(){r.show=!1,r.parentId=n.parentId}return(d,i)=>(o(),l("div",null,[p.value?(o(),S(K,{key:0},{default:T(()=>[g(dt,{taskId:p.value,onClose:i[0]||(i[0]=_=>p.value=null),onUpdated:h},null,8,["taskId"])]),_:1})):b("",!0),r.show?(o(),S(K,{key:1},{default:T(()=>[g(lt,{parentTaskId:r.parentId,requirementId:r.requirementId,onTaskCreated:y,onError:d.handleTaskError,onClose:v},null,8,["parentTaskId","requirementId","onError"])]),_:1})):b("",!0),g(ht,{tasks:c.subTasks,parentId:c.parentId,onAddClick:i[2]||(i[2]=_=>m(_)),onEditClick:i[3]||(i[3]=_=>p.value=_),onUpdatePriority:i[4]||(i[4]=_=>u("updatePriority"))},{"task:header":T(()=>[s("div",wt,[i[5]||(i[5]=s("div",{class:"flex justify-between items-center"},[s("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),s("div",Ct,[s("button",{class:"btn-1 ml-auto",onClick:i[1]||(i[1]=$(()=>m(c.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId"])]))}},$t={class:"container mx-auto p-6"},St={class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6"},Pt={class:"grid grid-cols-4"},Dt={class:"mb-4 flex col-span-full"},Lt={class:"font-medium text-xl"},Et={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},At={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},Rt={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},Ut={class:"text-right col-span-full md:col-span-1 ml-auto flex justify-center gap-4 !text-lg"},Nt={class:"py-2 font-medium mb-4 col-span-full md:col-span-2"},Bt={class:"flex items-center flex-wrap gap-3"},Mt={key:0,class:"text-gray-500 text-xs"},qt={class:"ml-auto text-right text-sm col-span-full"},Ot={class:"text-gray-500"},jt={class:"font-semibold text-green-800"},Ft={class:"ml-4 text-gray-500"},Gt={class:"text-red-500 font-semibold"},Vt={class:"py-2 flex justify-center items-center gap-2 col-span-full"},Ht={class:"ml-auto flex gap-4"},zt={key:0},Kt={key:1},Jt={key:1,class:"text-center py-4 text-gray-500"},Qt={key:2,class:"text-center py-4 text-red-500"},rs={__name:"TaskShow",setup(c){const e=kt(),n=et(),u=at(),p=it(),r=C(()=>p.getTaskListTree()),m=P({});Q(async()=>{});const y=f=>{u.push({name:"TaskEdit",params:{id:f}})},h=C(()=>{var f,t;return e.task.parent_id==0?{name:"TaskList",params:{id:(f=e.task)==null?void 0:f.id}}:{name:"TaskShow",params:{id:(t=e.task)==null?void 0:t.parent_id}}});async function v(f){const t=await e.fetchTask(f);p.setTaskList(t.sub_tasks,e.task.id)}const d=C(()=>({...e.task,children_tasks:r.value})),i=C(()=>J(e.task.started_at)),_=C(()=>J(e.task.deadline));return W(()=>n.params.id,v,{initial:!0,immediate:!0}),(f,t)=>{var L,E,A,R,U,N,B,M,q,O,j,F,G;const I=H("RouterLink"),Y=H("router-view");return o(),l("div",$t,[s("div",St,[a(e).task?(o(),l(z,{key:0},[s("section",Pt,[s("div",Dt,[s("div",null,[s("h2",Lt,x(a(e).task.title),1),s("div",Et,[(L=a(e).task)!=null&&L.is_important?(o(),l("span",At,"IMPORTANT")):b("",!0),(E=a(e).task)!=null&&E.is_urgent?(o(),l("span",Rt,"URGENT")):b("",!0)])]),s("div",Ut,[s("span",{class:D([{"bg-gray-200":((A=a(e).task)==null?void 0:A.status)==="PENDING","bg-blue-200":((R=a(e).task)==null?void 0:R.status)==="IN_PROGRESS","bg-green-200":((U=a(e).task)==null?void 0:U.status)==="COMPLETED","bg-red-200":((N=a(e).task)==null?void 0:N.status)==="BLOCKED"},"px-3 py-0.5 rounded-full text-sm h-6"])},x((B=a(e).task)==null?void 0:B.status),3),g(pt,{task:d.value,ref_key:"progress",ref:m,class:"!text-lg"},null,8,["task"])])]),s("div",Nt,[s("div",null,[t[8]||(t[8]=s("div",{class:"text-xs mb-0.5 text-gray-600 uppercase"},"Assigns",-1)),s("div",Bt,[(o(!0),l(z,null,nt(((M=a(e).task)==null?void 0:M.users)||[],k=>(o(),S(mt,{user:k,key:k.id},null,8,["user"]))),128)),((O=(q=a(e).task)==null?void 0:q.users)==null?void 0:O.length)===0?(o(),l("div",Mt," Not Assigned To Anyone ")):b("",!0)])])]),s("div",qt,[g(yt,{targetDateTime:a(e).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"]),s("span",Ot,[t[9]||(t[9]=w(" Started: ")),s("span",jt,x(i.value),1)]),s("span",Ft,[t[10]||(t[10]=w(" Deadline: ")),s("span",Gt,x(_.value),1)])]),t[15]||(t[15]=s("hr",{class:"my-3 col-span-full"},null,-1)),s("div",Vt,[s("button",{onClick:t[0]||(t[0]=$(k=>{var V;return y((V=a(e).task)==null?void 0:V.id)},["stop"])),class:"btn-2"},"Edit"),g(I,{to:{name:"TaskUserAssign",params:{id:(j=a(e).task)==null?void 0:j.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[1]||(t[1]=k=>k.stopPropagation())},{default:T(()=>t[11]||(t[11]=[s("i",{class:"fas fa-user-plus"},null,-1),w(" Assign Users ")])),_:1},8,["to"]),g(I,{to:h.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[2]||(t[2]=k=>k.stopPropagation())},{default:T(()=>t[12]||(t[12]=[s("i",{class:"fas fa-arrow-left"},null,-1),w(" Back ")])),_:1},8,["to"]),s("div",Ht,[r.value.length>0?(o(),S(I,{key:0,to:{name:"TaskShow",params:{id:(F=a(e).task)==null?void 0:F.id}},onClick:t[3]||(t[3]=k=>k.stopPropagation()),class:D(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":a(n).name=="TaskShow"}])},{default:T(()=>t[13]||(t[13]=[s("i",{class:"fal fa-list-ul"},null,-1),w(" Sub Tasks ")])),_:1},8,["to","class"])):b("",!0),g(I,{to:{name:"TaskReports",params:{id:(G=a(e).task)==null?void 0:G.id}},onClick:t[4]||(t[4]=k=>k.stopPropagation()),class:D(["py-1 btn-3",{"bg-blue-500 text-white":a(n).name=="TaskReports"}])},{default:T(()=>t[14]||(t[14]=[s("i",{class:"fal fa-file-alt"},null,-1),w(" Reports ")])),_:1},8,["to","class"])])])]),a(n).name=="TaskShow"?(o(),l("section",zt,[g(It,{subTasks:r.value,"parent-id":a(n).params.id,onCreated:t[5]||(t[5]=k=>v(a(n).params.id)),onUpdated:t[6]||(t[6]=k=>v(a(n).params.id)),onUpdatePriority:t[7]||(t[7]=k=>v(a(n).params.id))},null,8,["subTasks","parent-id"])])):(o(),l("section",Kt,[g(Y)]))],64)):a(e).loading?(o(),l("div",Jt," Loading task details... ")):(o(),l("div",Qt,x(a(e).error),1))])])}}};export{rs as default};
