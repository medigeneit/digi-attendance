import{_ as F,D as I,r as D,x as z,q as P,h as T,c as o,o as a,a as e,b as _,t as n,l as M,H as j,n as d,F as y,e as p,d as q,k as S,s as L}from"./index-BVAUvyQc.js";import{L as E}from"./LoaderView-CmiNrmpL.js";import{u as G}from"./kpi-report-BPDLxYT3.js";const H={class:"space-y-4 px-4 print:px-0"},O={class:"hidden print:block mx-auto text-center mb-3"},U={class:"text-sm text-gray-600"},W={class:"font-medium"},A={class:"flex flex-wrap items-end gap-3 sticky top-0 z-10 bg-white/80 backdrop-blur print:hidden p-2 -mx-2 rounded-md border border-gray-100"},J={class:"flex items-center gap-2"},Q=["disabled"],X=["value"],Z={key:0,class:"py-10 text-center"},$={key:1,class:"rounded-md border border-red-200 bg-red-50 p-3 text-red-700",role:"alert","aria-live":"polite"},ee={key:2,class:"space-y-3 md:hidden"},te={class:"flex items-center justify-between"},se=["title"],re={class:"text-xs text-gray-500"},oe={class:"mt-2 grid grid-cols-2 gap-2"},ae=["title"],ne={class:"text-sm font-semibold mt-1"},de={key:0,class:"px-3 py-6 text-center text-gray-600"},ie={class:"hidden md:block overflow-x-auto rounded-xl border bg-white shadow-sm"},le={class:"table table-auto w-full text-sm"},ce={class:"text-gray-800 sticky top-0 z-[5]"},ue={class:"bg-gray-100/95 backdrop-blur"},ye={class:"text-xs"},pe={class:"text-gray-800"},me={class:"sticky left-0 z-[4] border-r bg-inherit px-2 text-center"},be={class:"sticky z-[4] border-r bg-inherit px-2",style:{left:"2rem"}},xe=["title"],ge={key:0},_e={__name:"YearlyDepartmentalKpiReport",setup(fe){const f=G(),{meta:V,rows:c,isLoading:v,error:h}=I(f),k=new Date().getFullYear(),u=D(k),w=D([]),C=z(()=>{var r;return((r=V.value)==null?void 0:r.columns)||[]}),g=z(()=>C.value.filter(r=>r.key!=="sl"&&r.key!=="department"));function R(r=2020,s=k+1){const t=[];for(let l=s;l>=r;l--)t.push(l);w.value=t}P(u,()=>{const r=Number(u.value);!Number.isInteger(r)||r<2e3||r>2100||Y()});function N(r){const s=Number((r==null?void 0:r.completed)??0),t=Number((r==null?void 0:r.total)??0);return t===0?"bg-gray-50 text-gray-600":s>=t?"bg-emerald-50 text-emerald-700":s>0?"bg-amber-50 text-amber-700":"bg-rose-50 text-rose-700"}function K(){window.print()}function B(){return new Date().toLocaleString()}async function Y(){try{await f.fetchYearly({year:Number(u.value)})}catch(r){console.error("fetchYearly failed:",r)}}return T(()=>{R(),Y()}),(r,s)=>(a(),o("div",H,[e("div",O,[s[3]||(s[3]=e("h1",{class:"text-xl font-semibold text-gray-900"},"Yearly KPI Report",-1)),e("div",U,[s[1]||(s[1]=_(" Year: ")),e("span",W,n(u.value),1),s[2]||(s[2]=_(" â€¢ Generated: ")),e("span",null,n(B()),1)])]),e("div",A,[e("div",J,[s[4]||(s[4]=e("label",{class:"text-xs font-medium text-gray-600"},"Year",-1)),M(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>u.value=t),class:"w-32 rounded border border-gray-300 bg-white px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50 disabled:opacity-60",disabled:d(v),"aria-label":"Select year"},[(a(!0),o(y,null,p(w.value,t=>(a(),o("option",{key:t,value:t},n(t),9,X))),128))],8,Q),[[j,u.value,void 0,{number:!0}]])]),e("div",{class:"ml-auto flex gap-2"},[e("button",{class:"btn-3 !py-1.5 !px-3",onClick:K},s[5]||(s[5]=[e("i",{class:"far fa-print mr-1"},null,-1),_(" Print ")]))])]),d(v)?(a(),o("div",Z,[q(E)])):d(h)?(a(),o("div",$,n(d(h)),1)):(a(),o("div",ee,[(a(!0),o(y,null,p(d(c),(t,l)=>(a(),o("div",{key:"card-"+t.key,class:"rounded-xl border border-gray-200 bg-white shadow-sm p-3 break-inside-avoid"},[e("div",te,[e("div",{class:"text-sm font-medium text-gray-900 truncate",title:t.name},n(l+1)+". "+n(t.name),9,se),e("div",re,"Total: "+n(t.employees_total),1)]),e("div",oe,[(a(!0),o(y,null,p(g.value,i=>{var m,b,x;return a(),o("div",{key:i.key,class:L(["rounded-lg border border-gray-200 p-2 text-center",N((m=t.cells)==null?void 0:m[i.key])])},[e("div",{class:"text-[11px] font-medium text-gray-600 truncate",title:i.label},n(i.label),9,ae),e("div",ne,n(((x=(b=t.cells)==null?void 0:b[i.key])==null?void 0:x.display)||"0/0"),1)],2)}),128))])]))),128)),!d(c)||d(c).length===0?(a(),o("div",de,"No data")):S("",!0)])),e("div",ie,[e("table",le,[e("thead",ce,[e("tr",ue,[s[6]||(s[6]=e("th",{class:"sticky left-0 z-[6] border-y border-r bg-gray-100/95 px-2 py-2 text-center",style:{"min-width":"2.25rem",width:"2.25rem"}},"SL",-1)),s[7]||(s[7]=e("th",{class:"sticky z-[6] border-y border-r bg-gray-100/95 px-2 py-2 text-left",style:{left:"2rem",minWidth:"12.5rem",width:"12.5rem"}}," Department ",-1)),(a(!0),o(y,null,p(g.value,t=>(a(),o("th",{key:t.key,class:"border-y border-r px-2 py-2 text-center font-medium"},[e("span",ye,n(t.label),1)]))),128))])]),e("tbody",pe,[(a(!0),o(y,null,p(d(c),(t,l)=>(a(),o("tr",{key:t.key,class:"border-t even:bg-gray-100 hover:bg-sky-500/40 transition-colors break-inside-avoid"},[e("td",me,n(l+1),1),e("td",be,[e("div",{class:"truncate max-w-48 white-space-wrap",title:t.name},n(t.name),9,xe)]),(a(!0),o(y,null,p(g.value,i=>{var m,b,x;return a(),o("td",{key:i.key,class:"border-r text-center px-2 py-1"},[e("span",{class:L(["inline-block rounded py-0.5 px-1.5 font-mono text-[12px]",N((m=t.cells)==null?void 0:m[i.key])])},n(((x=(b=t.cells)==null?void 0:b[i.key])==null?void 0:x.display)||"0/0"),3)])}),128))]))),128)),!d(c)||d(c).length===0?(a(),o("tr",ge,s[8]||(s[8]=[e("td",{colspan:"100",class:"px-3 py-6 text-center text-gray-600"},"No data",-1)]))):S("",!0)])])])]))}},we=F(_e,[["__scopeId","data-v-16b9d48b"]]);export{we as default};
