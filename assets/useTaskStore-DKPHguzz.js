import{G as A,r as f,p as v,H as i}from"./index-Bk7gtYxA.js";const L=A("task",()=>{const o=f([]),d=f(null),c=f(!1),n=f(null),p=f(1),w=f(!0),T=async(e,l,{updateStoreData:a=!0})=>{var s,r;a==!0&&(c.value=!0,n.value=null);try{await i.post(`/tasks/${e}/assign-users`,{user_ids:l}),await y(e)}catch(t){throw a==!0&&(n.value=((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Assign users failed"),t}finally{a==!0&&(c.value=!1)}};function m(){p.value=1,o.value=[]}async function $(e,l={}){var a,s,r;n.value=null;try{const t={...e,per_page:5e3};c.value=!0;const u=await i.get("/tasks",{params:t,...l});return o.value=((a=u.data)==null?void 0:a.tasks)||[],c.value=!1,u.data}catch(t){throw n.value=((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",t}}const _=async(e,l)=>{var a,s,r;n.value=null;try{const t=await i.get("/my-tasks",{params:e,...l});return o.value=((a=t.data)==null?void 0:a.tasks)||[],t.data}catch(t){throw n.value=((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",t),t}};function k(e,l=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>(a==null?void 0:a.parent_id)===l).map(a=>({...a,children_tasks:k(e,a.id)}))}function h(){return k(o.value,0)}function E(){const e=[],l=(a,s=0,r="")=>{a.forEach(t=>{e.push({...t,depth:s,idPath:r+t.id}),t.children_tasks&&t.children_tasks.length&&l(t.children_tasks,s+1,r+t.id+"-")})};return l(h()),e}const y=async(e,l={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var s,r,t;a.fetchOnly||(c.value=!0),n.value=null;try{const u=await i.get(`/tasks/${e}`,{params:l});return a.fetchOnly||(d.value=((s=u.data)==null?void 0:s.task)||{},o.value=u.data.sub_tasks||[]),u.data}catch(u){const g=((t=(r=u.response)==null?void 0:r.data)==null?void 0:t.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(n.value=g),g}finally{a.fetchOnly||(c.value=!1)}},O=async(e,l={loadingBeforeCreate:!1})=>{var a,s,r,t;l.loadingBeforeCreate&&(c.value=!0),n.value=null;try{const u=await i.post("/tasks",e);return(a=u.data)!=null&&a.data&&o.value.push((s=u.data)==null?void 0:s.data),u.data.data}catch(u){throw n.value=((t=(r=u.response)==null?void 0:r.data)==null?void 0:t.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",u),u}finally{l.loadingBeforeCreate&&(c.value=!1)}},C=async(e,l,{loadingBeforeFetch:a=!0})=>{a&&(c.value=!0),n.value=null;try{const s=await i.put(`/tasks/${e}`,l),r=o.value.findIndex(t=>t.id===e);return r!==-1&&(o.value[r]=s.data.data),s.data.data}catch(s){throw s}finally{a&&(c.value=!1)}},P=async(e,l)=>(await i.put(`/tasks/${e}/update-priorities`,{task_ids:l})).data,q=async e=>{var l,a;c.value=!0,n.value=null;try{await i.delete(`/tasks/${e}`),o.value=o.value.filter(s=>s.id!==e)}catch(s){throw n.value=((a=(l=s.response)==null?void 0:l.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,s),s}finally{c.value=!1}},x=async(e,l)=>{var a,s;c.value=!0,n.value=null;try{await i.patch(`/tasks/${e}/update-requirement-detail/${l}`),o.value=o.value.filter(r=>r.id!==e)}catch(r){throw n.value=((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.message)||`টাস্ক (ID: ${e}) রেকয়্যারমেন্ট সেট করতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,r),r}finally{c.value=!1}};return{tasks:v(()=>o.value),task:v(()=>d.value),loading:v(()=>c.value),error:v(()=>n.value),taskListTree:v(h),flattenedTasks:v(E),fetchTasks:$,hasMoreTask:w,fetchMyTasks:_,resetTaskList:m,fetchTask:y,createTask:O,updateTask:C,deleteTask:q,assignUsers:T,updateTaskPriorities:P,setTaskRequirement:x}});export{L as u};
