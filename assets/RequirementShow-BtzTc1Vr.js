import{x as z,c as o,o as n,_ as Be,r as h,Q as Fe,h as pe,q as Je,k as p,a as e,j as N,F as P,e as H,t as m,n as E,s as L,d as _,M as ee,m as M,w as D,E as ie,p as Ve,b as I,l as re,v as He,P as me,R as De,y as ze,A as be,g as Ge,f as Xe,u as Ze}from"./index-javiA15k.js";import{_ as We}from"./TextEditor-DgiY41By.js";import{s as Ue,_ as et}from"./TaskAddForm-CDrKHLuQ.js";import{u as Ye}from"./useCommentStore-CC8e36hQ.js";import{O as Z}from"./OverlyModal-ocwxkhvL.js";import{L as ge}from"./LoaderView-BOty2_fP.js";import{_ as tt}from"./ShareComponent-BPqkHxWL.js";import{_ as Le}from"./DepartmentChip-B0Hy3Is9.js";import{_ as de}from"./DescriptionView-Ij2CevQi.js";import{i as Ke,f as fe,a as st,_ as nt,b as rt}from"./TaskTableRow-D2F3ylWS.js";import{b as ot,r as at,c as lt,f as xe,d as it,s as dt}from"./requirement-Cz8hheCG.js";import{_ as ut}from"./AttachmentPreview-ohiBpKjY.js";import{_ as le}from"./UserChip-BdWTjjzm.js";import{b as oe,c as Qe}from"./datetime-y2WWmmYq.js";import{u as mt}from"./useTaskStore-dqBlKVhb.js";import{_ as ct}from"./TaskSelectionInput-D_n2VUY2.js";import{_ as pt}from"./TaskEditForm-CHCn_1Hw.js";import{_ as vt}from"./TaskUserAssignForm-BdV3Z8oK.js";import{T as ve}from"./TextWithHr-D__APYMy.js";import{c as bt}from"./dom-Bic1TNqD.js";import{_ as ft}from"./ApproveAndReject-DuigPmXu.js";import"./RequiredIcon-DJnKrrVV.js";import"./company-DCfl-E13.js";import"./CompanyDepartmentSelectInput-CGRkrTHu.js";import"./SelectDropdown-Bb30ZDkW.js";import"./SectionLoading-ByhNOPqF.js";import"./TaskUrgencyInput-D2oKheGw.js";import"./TaskUrgentBadge-CrQ4K8GR.js";import"./TaskTitle-CUZ1pFuh.js";import"./TaskStatus-BG4uQFDO.js";import"./TaskIsClosedBadge-BH2bNhd7.js";import"./user-CuQ922DA.js";import"./tags-sqQVLdOk.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-BxqQTcMi.js";function xt(d){const v=new DOMParser().parseFromString(d,"text/html"),c=/#(\d+)/g;function u(t){t.childNodes.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){const b=i.textContent.replace(c,(x,q)=>`<a href="/requirement-tasks/${q}" class="text-pink-600 hover:underline font-bold">${x}</a>`);if(b!==i.textContent){const x=document.createElement("span");x.innerHTML=b,i.replaceWith(...x.childNodes)}}else u(i)})}return u(v.body),v.body.innerHTML}function gt(d){const v=new DOMParser().parseFromString(d,"text/html"),c=/(https?:\/\/[^\s]+)/g;function u(t){t.childNodes.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){const b=i.textContent.replace(c,x=>`<a href="${x}" target="_blank" class="text-blue-600 hover:underline">
            ${x}
            <i class="fas fa-external-link text-xs text-blue-600"></i>
          </a>`);if(b!==i.textContent){const x=document.createElement("span");x.innerHTML=b,i.replaceWith(...x.childNodes)}}else u(i)})}return u(v.body),v.body.innerHTML}const yt=["innerHTML"],ce={__name:"HTMLTextBody",props:{message:{type:String,required:!0}},setup(d){const w=d,v=z(()=>gt(xt(w.message)));return(c,u)=>(n(),o("div",{class:"prose prose-sm max-w-none leading-loose text-sm",innerHTML:v.value},null,8,yt))}},_t={class:"space-y-4"},kt={key:0,class:"space-y-2"},ht={class:"text-xs opacity-80"},wt=["onClick"],$t={class:"space-y-4"},qt={key:0,class:"text-sm text-gray-500"},Ct={key:1,class:"text-sm text-gray-500"},Tt={key:0,class:"shrink-0 mt-2"},At={class:"bg-inherit bubble-inner px-4 py-3 rounded-md"},jt={class:"text-sm font-bold text-gray-800"},St={class:"text-xs text-gray-400"},Rt={key:0,class:"mt-3 pt-2 border-t border-dashed border-gray-200"},Ot={class:"flex flex-wrap gap-2 items-center"},It=["title"],Mt={key:0,class:"fas fa-check-circle text-[10px]"},Nt={key:0,class:"mt-2 border rounded border-dashed p-2 text-center flex flex-col items-center gap-2 bg-yellow-50"},Et=["onClick","disabled"],Dt=["onClick"],Ut={key:2,class:"mt-2 space-y-1"},Lt={key:1,class:"shrink-0 mt-2"},Pt={class:"bg-white rounded-xl shadow-sm border p-4 space-y-3"},Bt={class:"flex items-center gap-2"},Ft={class:"text-sm font-semibold text-gray-700"},Vt={class:"flex items-center justify-end gap-2"},Ht=["disabled"],zt={key:0,class:"text-xs text-red-600"},Gt={class:"bg-white rounded-2xl w-full p-5 space-y-4"},Wt={class:"rounded-xl bg-slate-50 border border-slate-100 p-3 text-sm text-gray-700 max-h-40 overflow-auto"},Yt=["innerHTML"],Kt={__name:"CommentBox",props:{commentableType:{type:String,required:!0},commentableId:{type:[Number,String],required:!0},currentUser:{type:Object,required:!0},mentionableUsers:{type:Array,default:()=>[]},mentionableTasks:{type:Array,default:()=>[]}},setup(d){const w=d,v=h(!1),c=h(null),u=f=>{c.value=f,v.value=!0},t=()=>{v.value=!1,c.value=null},i=async()=>{if(!c.value)return;const f=c.value.id;t(),await G(f)},b=h([]),x=h({}),q=f=>{f&&b.value.push({id:crypto.randomUUID(),message:f,time:new Date().toISOString()})},s=(f,r)=>{!f||!r||(x.value[f]||(x.value[f]=[]),x.value[f].push(r))},a=f=>{x.value[f]=[]},l=Ye(),g=Fe(),k=z(()=>l.comments),$=z(()=>l.loading),S=z(()=>l.error),A=h(""),R=h(!1),C=async()=>{await l.fetchComments({commentable_type:w.commentableType,commentable_id:w.commentableId})},U=async()=>{if(!(!A.value||!Ue(String(A.value)).trim())){R.value=!0;try{await l.createComment({commentable_type:w.commentableType,commentable_id:Number(w.commentableId),user_id:w.currentUser.id,message:A.value}),A.value=""}catch(f){q(f.message)}finally{R.value=!1}}},G=async f=>{var r,B;a(f);try{await l.deleteComment(f)}catch(y){s(f,(B=(r=y.response)==null?void 0:r.data)==null?void 0:B.message)}};pe(C),Je(()=>[w.commentableType,w.commentableId],()=>C());const te=f=>f?new Date(f).toLocaleString():"",W=f=>(f==null?void 0:f.user_id)===w.currentUser.id,Y=f=>(f==null?void 0:f.user_id)===w.currentUser.id,T=f=>{var r;return(r=f.mentions)==null?void 0:r.find(B=>B.user_id==w.currentUser.id)},se=f=>{const r=T(f);return r&&r.acknowledged_at},Q=h(null),J=async f=>{var r,B;Q.value=f;try{await l.acknowledgeComment(f),g.success("Acknowledge successful")}catch(y){console.error("Acknowledge error:",y);const O=((B=(r=y.response)==null?void 0:r.data)==null?void 0:B.message)||"Failed to acknowledge";s(f,O),g.error(O)}finally{Q.value=null}};return(f,r)=>{var B;return n(),o("div",_t,[b.value.length?(n(),o("div",kt,[(n(!0),o(P,null,H(b.value,y=>(n(),o("div",{key:y.id,class:"rounded-xl border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-700 flex items-start justify-between gap-3"},[e("div",null,[r[1]||(r[1]=e("p",{class:"font-semibold"},"Error",-1)),e("p",ht,m(y.message),1)]),e("button",{class:"text-xs text-red-500 hover:underline",onClick:O=>b.value=b.value.filter(F=>F.id!==y.id)}," Dismiss ",8,wt)]))),128))])):p("",!0),e("div",$t,[$.value&&E(l).action=="fetching"?(n(),o("div",qt," Loading comments... ")):k.value.length?p("",!0):(n(),o("div",Ct,"No comments yet.")),(n(!0),o(P,null,H(k.value,y=>{var O,F,ne;return n(),o("div",{key:y.id,class:L(["flex gap-3",Y(y)?"justify-end":"justify-start"])},[Y(y)?p("",!0):(n(),o("div",Tt,[_(ee,{user:y.user},null,8,["user"])])),e("div",{class:L(["group relative min-w-[25%] max-w-[90%] rounded-md shadow border bubble-arrow",Y(y)?"bubble-right bg-indigo-50 border-indigo-100":"bubble-left bg-white border-gray-100"])},[e("div",At,[e("div",{class:L(["flex items-center gap-2 mb-2 pb-1 border-b border-dashed",Y(y)?"justify-end":"justify-start"])},[e("p",jt,m(Y(y)?"You":((O=y.user)==null?void 0:O.name)||"Unknown"),1),r[2]||(r[2]=e("span",{class:"text-xs text-gray-400"},"•",-1)),e("p",St,m(te(y.created_at)),1)],2),_(ce,{message:y.message},null,8,["message"]),(F=y.mentions)!=null&&F.length?(n(),o("div",Rt,[e("div",Ot,[r[3]||(r[3]=e("span",{class:"text-[10px] text-gray-400 uppercase font-semibold"},"Mentions:",-1)),(n(!0),o(P,null,H(y.mentions,V=>{var X;return n(),o("div",{key:V.id,class:"flex items-center gap-1 group/mention"},[e("div",{class:L(["flex items-center gap-1.5 px-1 py-0.5 rounded-full text-xs box-border border transition cursor-default",V.acknowledged_at?"bg-green-50 border-green-200 text-green-700":"bg-gray-50 border-gray-200 text-gray-500"]),title:V.acknowledged_at?`Acknowledged at ${te(V.acknowledged_at)}`:"Not acknowledged yet"},[_(ee,{user:V.user,size:"2xsmall"},null,8,["user"]),e("span",null,m((X=V.user)==null?void 0:X.name),1),V.acknowledged_at?(n(),o("i",Mt)):p("",!0)],10,It)])}),128))]),T(y)&&!se(y)?(n(),o("div",Nt,[r[4]||(r[4]=e("span",{class:"text-sm text-gray-700 font-medium"}," You Have been mentioned ",-1)),e("button",{onClick:V=>J(y.id),disabled:Q.value===y.id,class:"flex items-center gap-2 px-3 py-1.5 bg-sky-600 hover:bg-sky-700 disabled:opacity-70 text-white text-xs font-semibold rounded-lg transition shadow-sm"},[e("i",{class:L(["fas",Q.value===y.id?"fa-spinner fa-spin":"fa-check"])},null,2),e("span",null,m(Q.value===y.id?"Acknowledging...":"Acknowledge"),1)],8,Et)])):p("",!0)])):p("",!0),W(y)?(n(),o("div",{key:1,class:L(["mt-2 flex",Y(y)?"justify-end":"justify-start"])},[e("button",{class:"text-[11px] text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100",onClick:V=>u(y)}," Delete ",8,Dt)],2)):p("",!0),(ne=x.value[y.id])!=null&&ne.length?(n(),o("div",Ut,[(n(!0),o(P,null,H(x.value[y.id],(V,X)=>(n(),o("p",{key:X,class:L(["text-xs text-red-600",Y(y)?"text-right":"text-left"])},m(V),3))),128))])):p("",!0)])],2),Y(y)?(n(),o("div",Lt,[_(ee,{user:y.user||d.currentUser},null,8,["user"])])):p("",!0)],2)}),128))]),e("div",Pt,[e("div",Bt,[_(ee,{user:d.currentUser},null,8,["user"]),e("div",Ft,m(((B=d.currentUser)==null?void 0:B.name)||"You"),1)]),_(We,{modelValue:A.value,"onUpdate:modelValue":r[0]||(r[0]=y=>A.value=y),"mentionable-users":d.mentionableUsers,"mentionable-tasks":d.mentionableTasks,"current-user":d.currentUser},null,8,["modelValue","mentionable-users","mentionable-tasks","current-user"]),e("div",Vt,[e("button",{class:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm disabled:opacity-60",disabled:R.value||!E(Ue)(String(A.value)).trim(),onClick:U},m(R.value?"Posting...":"Post Comment"),9,Ht)]),S.value?(n(),o("p",zt,m(S.value),1)):p("",!0)]),v.value?(n(),N(Z,{key:1},{default:M(()=>{var y;return[e("div",Gt,[r[5]||(r[5]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete comment?",-1)),r[6]||(r[6]=e("p",{class:"text-sm text-gray-600 leading-relaxed"}," আপনি কি নিশ্চিত যে এই কমেন্টটি মুছে ফেলতে চান? মুছে ফেলা কমেন্ট পুনরুদ্ধার করা যাবে না। ",-1)),e("div",Wt,[e("div",{innerHTML:(y=c.value)==null?void 0:y.message},null,8,Yt)]),e("div",{class:"flex items-center justify-end gap-2 pt-2"},[e("button",{class:"px-4 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-50",onClick:t}," Cancel "),e("button",{class:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700",onClick:i}," Yes, Delete ")])])]}),_:1})):p("",!0)])}}},Qt=Be(Kt,[["__scopeId","data-v-59390069"]]),Jt={class:"flex items-center border-b w-full pb-2"},Xt={class:""},Zt={class:"mt-4 border h-40 flex items-center flex-col justify-center rounded border-dashed bg-red-50 text-center"},es={key:1,class:"text-red-500 text-center mt-2"},ts={class:"flex items-center justify-between mt-4"},ss={__name:"RequirementAttachmentForm",props:{requirementId:[String,Number],default:()=>null},emits:["uploaded","error","clickBack"],setup(d,{emit:w}){const v=d,c=h({attachments:[]}),u=h(""),t=h(""),i=w;function b(s){c.value.attachments=[...c.value.attachments,...Array.from(s.target.files)]}function x(s){c.value.attachments.splice(s,1)}async function q(){var a,l,g,k;u.value="submitting";const s=new FormData;for(const $ in c.value)$==="attachments"?c.value.attachments.forEach(S=>s.append("attachments[]",S)):s.append($,c.value[$]);try{const $=await ot(v.requirementId,s);c.value.attachments=[],i("uploaded",$),u.value="uploaded"}catch($){i("error",(l=(a=$.response)==null?void 0:a.data)==null?void 0:l.message),t.value=(k=(g=$.response)==null?void 0:g.data)==null?void 0:k.message,u.value="error"}}return(s,a)=>{var l;return n(),o("form",{class:"p-4 flex flex-col relative",onSubmit:D(q,["prevent"])},[u.value=="submitting"?(n(),N(ge,{key:0,class:"absolute inset-0 bg-opacity-80 flex items-center justify-center"})):p("",!0),e("div",Jt,[a[3]||(a[3]=e("h3",null,"Requirement Attachment",-1)),e("button",{class:"btn-icon ml-auto",onClick:a[0]||(a[0]=D(()=>{i("clickBack")},["prevent"]))},a[2]||(a[2]=[e("span",{class:"fas fa-times"},null,-1)]))]),e("div",Xt,[e("label",Zt,[a[4]||(a[4]=e("div",{class:"block text-gray-600 font-medium text-sm md:text-xl mb-4"}," Click to Select files or Drop Here ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",class:"border rounded-r-md text-gray-600 bg-gray-50",onChange:b},null,32)])]),_(ut,{files:((l=c.value)==null?void 0:l.attachments)||[],onRemove:x,class:"border p-1 rounded overflow-y-auto flex-grow"},null,8,["files"]),a[6]||(a[6]=e("hr",{class:"mt-4"},null,-1)),t.value?(n(),o("div",es,m(t.value),1)):p("",!0),e("div",ts,[e("button",{class:"btn-3",onClick:a[1]||(a[1]=D(g=>i("clickBack"),["prevent"]))},"Cancel"),a[5]||(a[5]=e("button",{class:"btn-2"},"Save",-1))])],32)}}},ns={class:"card-bg p-4 pt-2"},rs={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 w-full"},os=["onClick"],as=["src"],ls=["href"],is={key:2,class:"text-xs text-gray-500 text-center"},ds={__name:"RequirementAttachments",props:{requirement:{type:Array,default:()=>[]}},setup(d){const w=d,v=z(()=>{var t;return((t=w.requirement)==null?void 0:t.attachments)||[]}),c=ie({show:!1}),u=ie({show:!1,selectedFile:""});return(t,i)=>(n(),o("div",ns,[e("div",null,[i[6]||(i[6]=e("h4",{class:"text-gray-900 font-semibold mb-3 border-b font-e"},"Attachments",-1)),e("div",rs,[v.value&&v.value.length?(n(!0),o(P,{key:0},H(v.value,(b,x)=>(n(),o("div",{key:x,class:"border p-1 rounded aspect-square flex items-center justify-center bg-gray-50 relative",tabindex:"0",onClick:D(()=>{u.show=!0,u.selectedFile=b},["prevent"])},[E(Ke)(b)?(n(),o("img",{key:0,src:E(fe)(b),alt:"attachment",class:"object-cover w-full h-full rounded"},null,8,as)):E(st)(b)?(n(),o("a",{key:1,href:E(fe)(b),target:"_blank",class:"text-xs text-blue-600 text-center break-words hover:underline"},i[4]||(i[4]=[e("i",{class:"fas fa-file-pdf fa-2x mb-1 text-amber-700"},null,-1),e("div",{class:"whitespace-nowrap text-xs mt-1"},"Open PDF",-1)]),8,ls)):(n(),o("span",is,"Unknown"))],8,os))),128)):p("",!0),e("button",{title:"Add Attachments",onClick:i[0]||(i[0]=D(b=>c.show=!c.show,["prevent"])),class:"border rounded aspect-square flex items-center justify-center bg-sky-50 hover:bg-sky-100 relative group/btn"},i[5]||(i[5]=[e("i",{class:"fas fa-plus-circle text-2xl text-blue-300 group-hover/btn:text-blue-500"},null,-1)]))])]),c.show?(n(),N(Z,{key:0},{default:M(()=>[_(ss,{onClickBack:i[1]||(i[1]=b=>c.show=!1),onUploaded:i[2]||(i[2]=b=>c.show=!1),requirementId:d.requirement.id,class:"max-h-[70vh]"},null,8,["requirementId"])]),_:1})):p("",!0),u.show?(n(),N(Z,{key:1,class:"*:max-w-4xl *:min-h-[60vh]"},{default:M(()=>[_(nt,{attachments:v.value,selected:u.selectedFile,onClickClose:i[3]||(i[3]=b=>u.show=!1)},null,8,["attachments","selected"])]),_:1})):p("",!0)]))}},us={class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},ms={class:"text-sm flex flex-col xl:flex-row items-center mt-2 xl:mt-0 gap-x-2 text-red-400 font-semibold whitespace-nowrap"},cs={class:"mt-[2px]"},ps={key:0,class:"text-gray-800 flex items-center gap-2"},vs={key:1,class:"text-gray-800 w-full my-2 text-center"},bs={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},fs=["innerHTML"],xs={key:1,class:"flex gap-4 items-center justify-center mt-2"},gs={key:2,class:"mb-2"},ys={class:"flex justify-end text-sky-500"},_s={key:3,class:"text-center w-full"},ks={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick","closeClick","showHistoryClick"],setup(d,{emit:w}){const v=w;return(c,u)=>{var t,i;return n(),o("div",us,[d.requirement.closed_at?(n(),o(P,{key:0},[u[6]||(u[6]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",ms,[u[3]||(u[3]=e("span",{class:"flex items-center gap-2 text-gray-600"},[e("span",{class:"fad fa-lock"}),e("span",{class:"mt-[2px]"},"CLOSED AT")],-1)),e("span",cs,m(new Date(d.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),d.requirement.closed_by_user?(n(),o("div",ps,[u[4]||(u[4]=e("span",{class:"text-sm"},"Closed by",-1)),_(le,{user:d.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):p("",!0),d.requirement.closing_note?(n(),o("div",vs,[u[5]||(u[5]=e("div",{class:"text-xs text-left"},"Note",-1)),e("div",bs,[e("p",{innerHTML:d.requirement.closing_note},null,8,fs)])])):p("",!0)],64)):p("",!0),d.requirement.closed_at?(n(),o("div",xs,[e("button",{class:"btn-2 h-8",onClick:u[0]||(u[0]=D(b=>v("reOpenClick"),["prevent"]))},"Re Open")])):p("",!0),d.requirement.closed_at?p("",!0):(n(),o("div",gs,[e("div",ys,[e("button",{class:"btn-1 border border-sky-800",onClick:u[1]||(u[1]=D(b=>v("closeClick"),["prevent"]))}," Close Requirement ")])])),((i=(t=d.requirement)==null?void 0:t.closing_history)==null?void 0:i.length)>1?(n(),o("div",_s,[e("button",{onClick:u[2]||(u[2]=b=>v("showHistoryClick")),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):p("",!0)])}}},hs={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},ws={class:"my-6"},$s={class:"text-center font-semibold text-blue-800 mb-4"},qs={class:"text-center my-1"},Cs={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},Ts={class:"mt-4"},As=["placeholder","required"],js={class:"flex"},Ss={class:"text-red-600 text-center mt-2 text-sm"},Rs={class:"flex justify-between mt-3"},Os=["disabled"],Is={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(d,{emit:w}){const v=d,c=w,u=z({get:()=>v.loading,set:()=>c("update:loading")}),t=h(""),i=h(""),b=h(255),x=z(()=>b.value-t.value.length);async function q(){var s,a,l;u.value=!0;try{(s=v.requirement)!=null&&s.closed_at?await at(v.requirement.id,t.value):await lt(v.requirement.id,t.value),c("updateStatus")}catch(g){i.value=(l=(a=g.response)==null?void 0:a.data)==null?void 0:l.message,c("error")}finally{u.value=!1}}return(s,a)=>{var g,k,$,S,A;const l=Ve("LoaderView");return n(),o("form",{class:"p-4 rounded relative border",onSubmit:D(q,["prevent"])},[u.value?(n(),N(l,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:M(()=>a[3]||(a[3]=[I(" Submitting! ")])),_:1,__:[3]})):p("",!0),e("h3",hs,m((g=d.requirement)!=null&&g.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",ws,[e("div",$s,m((k=d.requirement)==null?void 0:k.title),1),a[6]||(a[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",qs,[a[4]||(a[4]=I(" Want to ")),e("span",Cs,m(($=d.requirement)!=null&&$.closed_at?"Re-Open":"Close"),1),a[5]||(a[5]=I(" the requirement? "))]),e("div",Ts,[re(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=R=>t.value=R),rows:"4",placeholder:`Write about why are you ${(S=d.requirement)!=null&&S.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:s.currentAction==="reject",onInput:a[1]||(a[1]=R=>t.value.length>b.value?t.value=t.value.slice(0,b.value):null)},null,40,As),[[He,t.value]]),e("div",js,[e("div",{class:L(["ml-auto inline-block text-sm text-gray-500",t.value.length>=b.value?"text-red-500":""])}," left "+m(x.value)+"/"+m(b.value)+" words ",3)])])]),a[7]||(a[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",Ss,m(i.value),1),e("div",Rs,[e("button",{class:"btn-3",onClick:a[2]||(a[2]=D(R=>c("clickCancel"),["prevent"]))},"Cancel"),e("button",{class:"btn-2 disabled:opacity-45",disabled:t.value.trim().length==0},m((A=d.requirement)!=null&&A.closed_at?"Re-Open Requirement":"Close Requirement"),9,Os)])])],32)}}},Ms={class:"sticky top-0 pt-4 bg-white z-10"},Ns={class:"mb-4"},Es={class:"mb-4"},Ds={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Us={key:0,class:"mb-4 text-red-500 font-medium"},Ls={key:1,class:"mb-4"},Ps={class:"flex items-center justify-between gap-4"},Bs=["disabled"],Fs={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(d,{emit:w}){const v=d,c=w,u=h(),t=h(null),i=h(""),b=h(),x=h({feedback:""});async function q(){var s,a;i.value="submitting";try{const l=await it(v.requirementId,x.value.feedback);c("update",l),i.value="create"}catch(l){i.value="error",b.value=((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to update requirement requirement",c("error",b.value)}}return pe(async()=>{var s,a,l,g;i.value="loading";try{await xe(v.requirementId),t.value=(s=(await xe(v.requirementId)).data)==null?void 0:s.requirement,x.value={feedback:(a=t.value)==null?void 0:a.feedback}}catch(k){b.value=((g=(l=k.response)==null?void 0:l.data)==null?void 0:g.message)||"Failed to fetch requirement requirement"}finally{i.value=""}}),(s,a)=>{var l;return n(),o("div",{ref_key:"formContainerRef",ref:u,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Ms,[a[3]||(a[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),a[4]||(a[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:a[0]||(a[0]=D(g=>c("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:D(q,["prevent"]),class:"z-0"},[i.value!=="loading"?(n(),o(P,{key:0},[e("div",Ns,[a[5]||(a[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),_(de,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:M(()=>{var g;return[I(m((g=t.value)==null?void 0:g.title),1)]}),_:1})]),e("div",Es,[a[6]||(a[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),_(We,{modelValue:x.value.feedback,"onUpdate:modelValue":a[1]||(a[1]=g=>x.value.feedback=g)},null,8,["modelValue"])])],64)):p("",!0),e("div",Ds,[b.value?(n(),o("div",Us,m(b.value),1)):p("",!0),b.value?(n(),o("hr",Ls)):p("",!0),e("div",Ps,[e("button",{type:"button",onClick:a[2]||(a[2]=D(g=>c("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:i.value=="loading"||i.value=="submitting",type:"submit",class:"btn-2"},m(i.value=="submitting"?"Saving...":(l=t.value)!=null&&l.feedback?"Update Feedback":"Add Feedback"),9,Bs)])])],32),i.value==="loading"||i.value==="submitting"?(n(),N(ge,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):p("",!0)],512)}}},Vs={class:"bg-white p-6 rounded-lg w-full w-full"},Hs={class:"flex items-center justify-between mb-4 border-b pb-2"},zs={class:"space-y-4"},Gs={class:"space-y-2"},Ws={class:"flex items-center gap-2"},Ys={key:0,class:"ml-6 space-y-2 p-2 bg-gray-50 rounded-md"},Ks={class:"flex items-center gap-2"},Qs={class:"flex items-center gap-2"},Js={class:"flex items-center gap-2"},Xs={class:"flex items-center gap-2"},Zs={class:"flex items-center gap-2"},en={class:"mt-8 flex justify-end gap-3 border-t pt-4"},tn={__name:"RequirementPrintOptions",props:{initialOptions:{type:Object,default:()=>({withTasks:!0,taskOption:"list",withMessages:!0,withApprovals:!0,withAttachments:!0})}},emits:["close","print"],setup(d,{emit:w}){const v=d,c=w,u=ie({...v.initialOptions});return(t,i)=>(n(),o("div",Vs,[e("div",Hs,[i[10]||(i[10]=e("h3",{class:"text-xl font-bold"},"Print Options",-1)),e("button",{onClick:i[0]||(i[0]=b=>c("close")),class:"text-gray-500 hover:text-gray-700"},i[9]||(i[9]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",zs,[e("div",Gs,[e("div",Ws,[re(e("input",{type:"checkbox","onUpdate:modelValue":i[1]||(i[1]=b=>u.withTasks=b),id:"withTasks",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[me,u.withTasks]]),i[11]||(i[11]=e("label",{for:"withTasks",class:"font-semibold text-gray-700"},"Print with Tasks",-1))]),u.withTasks?(n(),o("div",Ys,[e("div",Ks,[re(e("input",{type:"radio","onUpdate:modelValue":i[2]||(i[2]=b=>u.taskOption=b),value:"list",id:"taskOptionList",class:"w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[De,u.taskOption]]),i[12]||(i[12]=e("label",{for:"taskOptionList",class:"text-sm text-gray-600"},"Task list with count",-1))]),e("div",Qs,[re(e("input",{type:"radio","onUpdate:modelValue":i[3]||(i[3]=b=>u.taskOption=b),value:"countOnly",id:"taskOptionCount",class:"w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[De,u.taskOption]]),i[13]||(i[13]=e("label",{for:"taskOptionCount",class:"text-sm text-gray-600"},"Only task count (completed/total)",-1))])])):p("",!0)]),e("div",Js,[re(e("input",{type:"checkbox","onUpdate:modelValue":i[4]||(i[4]=b=>u.withMessages=b),id:"withMessages",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[me,u.withMessages]]),i[14]||(i[14]=e("label",{for:"withMessages",class:"font-semibold text-gray-700"},"Print with message list",-1))]),e("div",Xs,[re(e("input",{type:"checkbox","onUpdate:modelValue":i[5]||(i[5]=b=>u.withApprovals=b),id:"withApprovals",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[me,u.withApprovals]]),i[15]||(i[15]=e("label",{for:"withApprovals",class:"font-semibold text-gray-700"},"Print with Approval list",-1))]),e("div",Zs,[re(e("input",{type:"checkbox","onUpdate:modelValue":i[6]||(i[6]=b=>u.withAttachments=b),id:"withAttachments",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[me,u.withAttachments]]),i[16]||(i[16]=e("label",{for:"withAttachments",class:"font-semibold text-gray-700"},"Print Attachments (Images on separate page)",-1))])]),e("div",en,[e("button",{onClick:i[7]||(i[7]=b=>c("close")),class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition"}," Cancel "),e("button",{onClick:i[8]||(i[8]=b=>c("print",u)),class:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition font-semibold"},i[17]||(i[17]=[e("i",{class:"fas fa-print mr-2"},null,-1),I(" Print ")]))])]))}},sn={class:"requirement-print-preview bg-white text-black p-8 font-serif leading-relaxed"},nn={class:"border-b-2 border-gray-800 pb-4 mb-6"},rn={class:"flex justify-between items-start"},on={class:"text-sm text-gray-600 mt-1"},an={class:"font-semibold"},ln={class:"text-right"},dn={class:"text-lg font-bold text-indigo-700"},un={class:"grid grid-cols-2 gap-x-12 gap-y-4 mb-6 text-sm"},mn={class:"space-y-2"},cn={class:"flex justify-between border-b border-gray-100 pb-1"},pn={class:"font-medium text-right"},vn={class:"flex justify-between border-b border-gray-100 pb-1"},bn={class:"font-medium text-right"},fn={class:"flex justify-between border-b border-gray-100 pb-1"},xn={class:"font-medium text-right"},gn={class:"space-y-2"},yn={class:"flex justify-between border-b border-gray-100 pb-1"},_n={class:"flex justify-between border-b border-gray-100 pb-1"},kn={class:"font-medium text-right"},hn={class:"flex justify-between border-b border-gray-100 pb-1"},wn={class:"font-medium text-right"},$n={class:"mb-6 p-3 bg-gray-50 rounded border flex items-center gap-4"},qn={key:0,class:"flex items-center gap-2"},Cn={class:"font-semibold"},Tn={key:0,class:"text-xs text-gray-500"},An={key:1,class:"text-gray-400"},jn={class:"mb-6"},Sn={class:"text-xl mb-2"},Rn={class:"font-bold"},On={key:0,class:"print-description prose prose-sm max-w-none text-gray-800 p-0"},In={key:0,class:"mb-6 break-inside-avoid"},Mn={class:"flex justify-between items-center mb-4 border-b pb-2"},Nn={class:"font-semibold text-sm bg-gray-800 text-white px-3 py-1 rounded-full"},En={key:0,class:"overflow-hidden border rounded"},Dn={class:"w-full border-collapse text-sm"},Un={class:"border p-2 text-center font-bold text-gray-400"},Ln={class:"border p-2"},Pn={class:"font-semibold"},Bn=["innerHTML"],Fn={class:"border p-2"},Vn={key:0,class:"text-gray-400 text-xs italic"},Hn={class:"border p-2 text-center"},zn={key:0},Gn={key:1,class:"p-4 border rounded bg-gray-50 text-center italic text-gray-600"},Wn={key:1,class:"mb-10"},Yn={class:"space-y-4 break-before-page"},Kn={class:"flex items-center gap-2 mb-1"},Qn={class:"font-bold text-sm"},Jn={class:"text-xs text-gray-400"},Xn={key:0,class:"text-sm text-gray-700"},Zn={class:"mb-10 p-4 bg-blue-50/50 rounded-lg flex items-center justify-between border-l-4 border-blue-400"},er={class:"flex items-center gap-4"},tr={class:"flex items-center gap-2"},sr={class:"font-bold text-gray-800"},nr={class:"text-right"},rr={class:"text-sm font-semibold"},or={key:2,class:"mb-6"},ar={class:"break-inside-avoid"},lr={class:"mb-8"},ir={class:"text-xs font-bold text-gray-700 text-center uppercase tracking-widest border-b border-dashed pb-1 mb-4"},dr={class:"grid grid-cols-2 gap-8"},ur={key:0,class:"w-full"},mr={class:"text-[10px] text-gray-500 uppercase font-bold mb-3"},cr={key:0,class:"space-y-2"},pr={class:"flex flex-col items-center gap-2"},vr={class:"relative inline-block"},br={class:"font-bold text-indigo-700"},fr={key:0,class:"text-xs text-red-600 font-semibold italic"},xr={key:1,class:"text-xs text-gray-600 italic"},gr={key:2,class:"mt-1 text-[10px] text-red-600 font-bold px-2 py-0.5 rounded inline-block"},yr={key:3,class:"mt-1 text-[10px] text-green-600 font-bold px-2 py-0.5 rounded inline-block"},_r={key:4,class:"mt-1 text-[10px] text-yellow-600 font-bold px-2 py-0.5 rounded inline-block"},kr={key:1,class:"h-12 flex items-center justify-center text-gray-300 italic text-xs"},hr={key:0,class:"break-inside-avoid"},wr={class:"text-xs font-bold text-center text-gray-700 uppercase tracking-widest border-b border-dashed pb-1 mb-4"},$r={class:"grid grid-cols-2 gap-8"},qr={key:0,class:"w-full"},Cr={class:"text-[10px] text-gray-500 uppercase font-bold mb-3"},Tr={key:0,class:"space-y-2"},Ar={class:"flex flex-col items-center gap-2"},jr={class:"relative inline-block"},Sr={class:"font-bold text-indigo-700"},Rr={key:0,class:"text-xs text-red-600 font-semibold italic"},Or={key:1,class:"text-xs text-gray-600 italic"},Ir={key:2,class:"mt-1 text-[10px] text-red-600 font-bold px-2 py-0.5 rounded inline-block"},Mr={key:3,class:"mt-1 text-[10px] text-green-600 font-bold px-2 py-0.5 rounded inline-block"},Nr={key:4,class:"mt-1 text-[10px] text-yellow-600 font-bold px-2 py-0.5 rounded inline-block"},Er={key:1,class:"h-12 flex items-center justify-center text-gray-300 italic text-xs"},Dr={key:3,class:"break-before-page mt-12"},Ur={class:"grid grid-cols-1 gap-8"},Lr={class:"text-xs text-gray-500 mb-2 font-mono"},Pr=["src"],Br={__name:"RequirementPrintPreview",props:{requirement:{type:Object,required:!0},options:{type:Object,required:!0},comments:{type:Array,default:()=>[]}},setup(d){const w=d,v=z(()=>{var u;return(((u=w.requirement)==null?void 0:u.attachments)||[]).filter(t=>Ke(t))}),c=u=>{var l,g,k,$,S,A;const t=w.requirement,i={from_in_charge:!!(t!=null&&t.status&&(t!=null&&t.submission_date)),from_coordinator:!!(t!=null&&t.from_coordinator),to_in_charge:!!(t!=null&&t.to_incharge),to_coordinator:!!(t!=null&&t.to_coordinator)},b={from_in_charge:(l=t==null?void 0:t.from_department)==null?void 0:l.in_charge,from_coordinator:(g=t==null?void 0:t.from_department)==null?void 0:g.coordinator,to_in_charge:(k=t==null?void 0:t.to_department)==null?void 0:k.in_charge,to_coordinator:($=t==null?void 0:t.to_department)==null?void 0:$.coordinator};let x=null,q=null,s="",a="";return u==="from_in_charge"&&(x=t==null?void 0:t.from_department,q=(S=t==null?void 0:t.from_department)==null?void 0:S.in_charge,s="In Charge",a=t==null?void 0:t.from_incharge_note),u==="from_coordinator"&&(x=t==null?void 0:t.from_department,q=t==null?void 0:t.from_coordinator,s="Coordinator",a=t==null?void 0:t.from_coordinator_note),u==="to_in_charge"&&(x=t==null?void 0:t.to_department,q=t==null?void 0:t.to_incharge,s="In Charge",a=t==null?void 0:t.to_incharge_note),u==="to_coordinator"&&(x=t==null?void 0:t.to_department,q=t==null?void 0:t.to_coordinator,s="Coordinator",a=t==null?void 0:t.to_coordinator_note),{department:x,approved:i[u],approval_user:q,is_rejected:(t==null?void 0:t.rejected_by_user_id)&&(t==null?void 0:t.rejected_by_user_id)===((A=b[u])==null?void 0:A.id),userType:s,approval_note:a}};return(u,t)=>{var i,b,x,q,s,a;return n(),o("div",sn,[e("div",nn,[e("div",rn,[e("div",null,[t[1]||(t[1]=e("h1",{class:"text-xl font-bold uppercase tracking-wider"},"Requirement Report",-1)),e("p",on,[t[0]||(t[0]=I(" Generated on ")),e("span",an,m(E(oe)(new Date)),1)])]),e("div",ln,[e("div",dn,"#"+m(d.requirement.id),1),e("div",{class:L(["text-sm font-semibold uppercase px-2 py-0.5 rounded border inline-block mt-1",d.requirement.status==="approved"?"bg-green-100 border-green-400 text-green-800":d.requirement.status==="rejected"?"bg-red-100 border-red-400 text-red-800":"bg-yellow-100 border-yellow-400 text-yellow-800"])},[e("i",{class:L(["mr-1",d.requirement.status==="approved"?"fas fa-check-circle":d.requirement.status==="rejected"?"fas fa-times-circle":"fas fa-clock"])},null,2),I(" "+m(d.requirement.status||"PENDING"),1)],2)])])]),e("div",un,[e("div",mn,[e("div",cn,[t[2]||(t[2]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Website:",-1)),e("span",pn,m((d.requirement.website_tags||[]).map(l=>l.name).join(", ")||"N/A"),1)]),e("div",vn,[t[3]||(t[3]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Submission Date:",-1)),e("span",bn,m(d.requirement.submission_date?E(oe)(d.requirement.submission_date):"N/A"),1)]),e("div",fn,[t[4]||(t[4]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Better To Complete:",-1)),e("span",xn,m(d.requirement.better_to_complete_on?E(Qe)(d.requirement.better_to_complete_on):"N/A"),1)])]),e("div",gn,[e("div",yn,[t[5]||(t[5]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Priority:",-1)),e("span",{class:L(["font-bold uppercase",d.requirement.priority==="URGENT"?"text-red-600":d.requirement.priority==="IMPORTANT"?"text-orange-600":""])},m(d.requirement.priority||"NORMAL"),3)]),e("div",_n,[t[6]||(t[6]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"From Dept:",-1)),e("span",kn,m((i=d.requirement.from_department)==null?void 0:i.name),1)]),e("div",hn,[t[7]||(t[7]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"To Dept:",-1)),e("span",wn,m((b=d.requirement.to_department)==null?void 0:b.name),1)])])]),e("div",$n,[t[8]||(t[8]=e("span",{class:"text-gray-500 font-bold uppercase text-xs"},"Supervisor:",-1)),d.requirement.supervisor?(n(),o("div",qn,[_(ee,{user:d.requirement.supervisor,size:"xsmall"},null,8,["user"]),e("span",Cn,m(d.requirement.supervisor.name),1),d.requirement.supervisor.designation?(n(),o("span",Tn,"("+m(d.requirement.supervisor.designation)+")",1)):p("",!0)])):(n(),o("span",An,"Not Assigned"))]),e("div",jn,[e("h2",Sn,[e("span",Rn,m(d.requirement.title),1)]),d.requirement.description?(n(),o("div",On,[_(ce,{message:d.requirement.description},null,8,["message"])])):p("",!0)]),d.options.withTasks?(n(),o("div",In,[e("div",Mn,[t[9]||(t[9]=e("h3",{class:"text-lg font-bold uppercase"},"Tasks",-1)),e("span",Nn,m(d.requirement.completed_tasks_count)+" / "+m(d.requirement.tasks_count)+" Completed ",1)]),d.options.taskOption==="list"?(n(),o("div",En,[e("table",Dn,[t[12]||(t[12]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"border p-2 text-left w-12 text-gray-600"},"SL"),e("th",{class:"border p-2 text-left text-gray-600"},"Task Title"),e("th",{class:"border p-2 text-left text-gray-600 w-48"},"Assigned To"),e("th",{class:"border p-2 text-center text-gray-600 w-32"},"Status")])],-1)),e("tbody",null,[(n(!0),o(P,null,H(d.requirement.tasks,(l,g)=>{var k;return n(),o("tr",{key:l.id,class:"border-b hover:bg-gray-50"},[e("td",Un,m(g+1),1),e("td",Ln,[e("div",Pn,m(l.title),1),l.description?(n(),o("div",{key:0,class:"text-xs text-gray-500 mt-1",innerHTML:l.description},null,8,Bn)):p("",!0)]),e("td",Fn,[(n(!0),o(P,null,H(l.users,$=>(n(),o("div",{key:$.id,class:"text-xs mb-1 last:mb-0 flex items-center gap-1"},[t[10]||(t[10]=e("span",{class:"w-1.5 h-1.5 bg-indigo-400 rounded-full"},null,-1)),I(" "+m($.name),1)]))),128)),(k=l.users)!=null&&k.length?p("",!0):(n(),o("span",Vn,"Unassigned"))]),e("td",Hn,[e("span",{class:L(["px-2 py-0.5 rounded-full text-[10px] uppercase font-bold",l.status==="COMPLETED"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"])},m(l.status),3)])])}),128)),(x=d.requirement.tasks)!=null&&x.length?p("",!0):(n(),o("tr",zn,t[11]||(t[11]=[e("td",{colspan:"4",class:"p-8 text-center text-gray-400 italic"}," No tasks found for this requirement. ",-1)])))])])])):(n(),o("div",Gn," Task list hidden based on print options. (Summary: "+m(d.requirement.completed_tasks_count)+" / "+m(d.requirement.tasks_count)+" tasks completed) ",1))])):p("",!0),d.options.withMessages&&d.comments.length?(n(),o("div",Wn,[t[13]||(t[13]=e("h3",{class:"text-lg font-bold uppercase mb-4 border-b pb-2"},"Message History",-1)),e("div",Yn,[(n(!0),o(P,null,H(d.comments,l=>{var g;return n(),o("div",{key:l.id,class:"border-l-4 border-gray-200 pl-4 py-1"},[e("div",Kn,[_(ee,{user:l.user,size:"xsmall"},null,8,["user"]),e("span",Qn,m((g=l.user)==null?void 0:g.name),1),e("span",Jn,m(E(oe)(l.created_at)),1)]),l.message?(n(),o("div",Xn,[_(ce,{message:l.message},null,8,["message"])])):p("",!0)])}),128))])])):p("",!0),e("div",Zn,[e("div",er,[t[14]||(t[14]=e("span",{class:"text-xs font-bold text-blue-700 uppercase tracking-widest"},"Submitted By:",-1)),e("div",tr,[_(ee,{user:d.requirement.created_by,size:"xsmall"},null,8,["user"]),e("span",sr,m((q=d.requirement.created_by)==null?void 0:q.name),1)])]),e("div",nr,[t[15]||(t[15]=e("p",{class:"text-[10px] text-gray-500 font-bold uppercase"},"Submission Date",-1)),e("p",rr,m(E(oe)(d.requirement.created_at)),1)])]),d.options.withApprovals?(n(),o("div",or,[e("div",ar,[t[20]||(t[20]=e("h3",{class:"text-lg font-bold uppercase mb-6 border-b pb-2"},"Approvals",-1)),e("div",lr,[e("h4",ir,m((s=d.requirement.from_department)==null?void 0:s.name)+" Approvals ",1),e("div",dr,[(n(),o(P,null,H(["from_in_charge","from_coordinator"],l=>e("div",{key:l,class:"approval-box p-4 flex flex-col items-center text-center"},[c(l)?(n(),o("div",ur,[e("p",mr,m(c(l).userType),1),c(l).approval_user?(n(),o("div",cr,[e("div",pr,[_(ee,{user:c(l).approval_user,size:"small"},null,8,["user"]),e("div",vr,[e("span",br,m(c(l).approval_user.name),1),t[16]||(t[16]=e("hr",{class:"border-t-2 border-indigo-100 mt-0.5"},null,-1))])]),c(l).is_rejected&&d.requirement.rejection_reason?(n(),o("p",fr,m(d.requirement.rejection_reason),1)):c(l).approval_note?(n(),o("p",xr,m(c(l).approval_note),1)):p("",!0),c(l).is_rejected?(n(),o("div",gr,t[17]||(t[17]=[e("i",{class:"fas fa-times-circle mr-1"},null,-1),I(" REJECTED ")]))):c(l).approved?(n(),o("div",yr,[t[18]||(t[18]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),I(" "+m(l==="from_in_charge"?"SUBMITTED":"APPROVED"),1)])):(n(),o("div",_r,t[19]||(t[19]=[e("i",{class:"fas fa-clock mr-1"},null,-1),I(" PENDING ")])))])):(n(),o("div",kr," N/A "))])):p("",!0)])),64))])])]),d.requirement.from_department_id!==d.requirement.to_department_id?(n(),o("div",hr,[e("h4",wr,m((a=d.requirement.to_department)==null?void 0:a.name)+" Approvals ",1),e("div",$r,[(n(),o(P,null,H(["to_in_charge","to_coordinator"],l=>e("div",{key:l,class:"approval-box p-4 flex flex-col items-center text-center"},[c(l)?(n(),o("div",qr,[e("p",Cr,m(c(l).userType),1),c(l).approval_user?(n(),o("div",Tr,[e("div",Ar,[_(ee,{user:c(l).approval_user,size:"small"},null,8,["user"]),e("div",jr,[e("span",Sr,m(c(l).approval_user.name),1),t[21]||(t[21]=e("hr",{class:"border-t-2 border-indigo-100 mt-0.5"},null,-1))])]),c(l).is_rejected&&d.requirement.rejection_reason?(n(),o("p",Rr,m(d.requirement.rejection_reason),1)):c(l).approval_note?(n(),o("p",Or,m(c(l).approval_note),1)):p("",!0),c(l).is_rejected?(n(),o("div",Ir,t[22]||(t[22]=[e("i",{class:"fas fa-times-circle mr-1"},null,-1),I(" REJECTED ")]))):c(l).approved?(n(),o("div",Mr,t[23]||(t[23]=[e("i",{class:"fas fa-check-circle mr-1"},null,-1),I(" APPROVED ")]))):(n(),o("div",Nr,t[24]||(t[24]=[e("i",{class:"fas fa-clock mr-1"},null,-1),I(" PENDING ")])))])):(n(),o("div",Er," N/A "))])):p("",!0)])),64))])])):p("",!0)])):p("",!0),d.options.withAttachments&&v.value.length?(n(),o("div",Dr,[t[25]||(t[25]=e("h3",{class:"text-lg font-bold uppercase mb-6 border-b pb-2"},"Image Attachments",-1)),e("div",Ur,[(n(!0),o(P,null,H(v.value,(l,g)=>(n(),o("div",{key:g,class:"break-inside-avoid border p-4 rounded bg-gray-50 shadow-sm"},[e("p",Lr,"Attachment #"+m(g+1),1),e("img",{src:E(fe)(l),class:"max-w-full h-auto rounded border shadow-inner mx-auto",alt:"Requirement Attachment"},null,8,Pr)]))),128))])])):p("",!0)])}}},Fr=Be(Br,[["__scopeId","data-v-f1f8b264"]]),Vr={class:"flex justify-center items-center"},Hr={class:"modal-card"},zr={key:0},Gr=["required"],Wr={class:"flex"},Yr={class:"flex justify-between gap-2 mt-4"},Kr=["disabled"],Qr=["disabled"],Jr={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0},requirementNote:{type:Boolean,default:!0}},emits:["loading","success","error"],setup(d,{emit:w}){const v=d,c=w,u=h(255),t=z(()=>u.value-s.value.length),i=Fe(),b=h(null),x=h(null),q=h(null),s=h(""),a=h(!1),l=z(()=>q.value!==null);function g(R){q.value=R,s.value="",A()}function k(){q.value=null,s.value=""}async function $(){var R,C;if(q.value==="reject"&&!s.value)return i.error("Rejection Reason is required!");if(typeof v.onSubmit=="function")return v.onSubmit({note:s.value,action:q.value});c("loading",!0),a.value=!0;try{await dt(v.requirementId,{note:s.value}),c("success"),k()}catch(U){return c("error",U),i.error(((C=(R=U==null?void 0:U.response)==null?void 0:R.data)==null?void 0:C.message)||"Submission failed!")}finally{c("loading",!1),a.value=!1}}function S(R){var C,U;l.value&&(R.key==="ArrowLeft"?(C=x.value)==null||C.focus():R.key==="ArrowRight"&&((U=b.value)==null||U.focus()))}function A(){be(()=>{var R;(R=b.value)==null||R.focus()})}return pe(()=>{window.addEventListener("keydown",S)}),ze(()=>{window.removeEventListener("keydown",S)}),(R,C)=>(n(),o("div",null,[e("div",Vr,[e("button",{onClick:C[0]||(C[0]=U=>g("accept"))},C[3]||(C[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),l.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:D(k,["self"])},[e("div",Hr,[C[4]||(C[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),d.requirementNote?(n(),o("div",zr,[re(e("textarea",{"onUpdate:modelValue":C[1]||(C[1]=U=>s.value=U),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:q.value==="reject",onInput:C[2]||(C[2]=U=>s.value.length>u.value?s.value=s.value.slice(0,u.value):null)},null,40,Gr),[[He,s.value]]),e("div",Wr,[e("div",{class:L(["ml-auto inline-block text-sm text-gray-500",s.value.length>=u.value?"text-red-500":""])}," left "+m(t.value)+"/"+m(u.value)+" words ",3)])])):p("",!0),e("div",Yr,[e("button",{ref_key:"cancelBtnRef",ref:x,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:k,disabled:a.value}," Cancel ",8,Kr),e("button",{ref_key:"confirmBtnRef",ref:b,class:L(["focus:ring-2 ring-offset-2 disabled:opacity-30",q.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:$,disabled:a.value}," Confirm Submission ",10,Qr)])])])):p("",!0)]))}},Xr={class:"flex items-center gap-6 justify-center my-16"},Zr={key:0,class:"border rounded-md"},eo={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(d,{emit:w}){const v=d,c=w,u=mt(),t=h(""),i=h(null),b=h(""),x=h(!1);async function q(){await u.setTaskRequirement(b.value,v.requirement.id),c("assignTask")}return(s,a)=>(n(),o("div",{class:L(["text-left p-4",[t.value&&!i.value?"min-h-[400px]":""]])},[e("div",Xr,[e("button",{onClick:a[0]||(a[0]=D(l=>c("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),a[5]||(a[5]=e("span",null,"or",-1)),e("button",{class:L({"btn-3":t.value!=="direct-assign","btn-2":t.value=="direct-assign"}),onClick:a[1]||(a[1]=D(()=>t.value="direct-assign",["prevent"]))}," Assign Task ",2)]),t.value&&!i.value?(n(),o("div",Zr,[e("form",{onSubmit:D(q,["prevent"]),class:"p-4 flex items-end"},[_(ct,{class:"flex-grow mr-4 h-12",taskId:b.value,"onUpdate:taskId":a[2]||(a[2]=l=>b.value=l),show:x.value,"onUpdate:show":a[3]||(a[3]=l=>x.value=l),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":d.fromDepartmentId},filterTasks:l=>!l.requirement_id,onAddNewTaskClick:a[4]||(a[4]=l=>c("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),a[6]||(a[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):p("",!0)],2))}},to={class:"flex flex-col items-center gax-x-1 justify-end"},so={key:0},no={key:1},ro={class:"text-sm text-gray-600 whitespace-normal w-64"},oo={class:"text-gray-900 font-semibold text-sm md:text-base"},ao={class:"ml-2"},lo={key:0,class:"text-red-700 text-sm"},io={key:1,class:"text-green-600 ml-2"},uo={key:2,class:"ml-2 text-yellow-700"},Pe={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(d,{emit:w}){const v=d,c=w,u=Ge(),t=z(()=>{var s,a,l,g,k;return{from_in_charge:!!((s=v.requirement)!=null&&s.status&&((a=v.requirement)!=null&&a.submission_date)),from_coordinator:!!((l=v.requirement)!=null&&l.from_coordinator),to_in_charge:!!((g=v.requirement)!=null&&g.to_incharge),to_coordinator:!!((k=v.requirement)!=null&&k.to_coordinator)}}),i=z(()=>{var s,a,l,g,k,$,S,A;return{from_in_charge:(a=(s=v.requirement)==null?void 0:s.from_department)==null?void 0:a.in_charge,from_coordinator:(g=(l=v.requirement)==null?void 0:l.from_department)==null?void 0:g.coordinator,to_in_charge:($=(k=v.requirement)==null?void 0:k.to_department)==null?void 0:$.in_charge,to_coordinator:(A=(S=v.requirement)==null?void 0:S.to_department)==null?void 0:A.coordinator}}),b=z(()=>{var g;const s=Object.keys(t.value),a=s.indexOf(v.approvalType);let l=!0;for(let k=a-1;k>=0;k--){const $=s[k];l=l&&(i.value[$]?(g=t.value)==null?void 0:g[$]:!0)}return l}),x=z(()=>{var $,S,A,R,C,U,G,te,W,Y,T,se,Q,J,f,r;let s=null,a=null,l="",g="";v.approvalType==="from_in_charge"&&(s=($=v.requirement)==null?void 0:$.from_department,a=(A=(S=v.requirement)==null?void 0:S.from_department)==null?void 0:A.in_charge,l="In Charge",g=(R=v.requirement)==null?void 0:R.from_incharge_note),v.approvalType==="from_coordinator"&&(s=(C=v.requirement)==null?void 0:C.from_department,a=(U=v.requirement)==null?void 0:U.from_coordinator,l="Coordinator",g=(G=v.requirement)==null?void 0:G.from_coordinator_note),v.approvalType==="to_in_charge"&&(s=(te=v.requirement)==null?void 0:te.to_department,a=(W=v.requirement)==null?void 0:W.to_in_charge,l="In Charge",g=(Y=v.requirement)==null?void 0:Y.to_incharge_note),v.approvalType==="to_coordinator"&&(s=(T=v.requirement)==null?void 0:T.to_department,a=(se=v.requirement)==null?void 0:se.to_coordinator,l="Coordinator",g=(Q=v.requirement)==null?void 0:Q.to_coordinator_note);const k=(J=i.value)==null?void 0:J[v.approvalType];return{department:s,department_user:k,approved:(f=t.value)==null?void 0:f[v.approvalType],approval_user:a,is_rejected:((r=v.requirement)==null?void 0:r.rejected_by_user_id)==(k==null?void 0:k.id),userType:l,approval_note:g}});function q(){c("updateApproval")}return(s,a)=>{var l,g,k,$,S,A;return n(),o("div",to,[x.value.department_user?(n(),o("div",so,[_(le,{user:x.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),o("div",no,a[0]||(a[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",ro,[x.value.is_rejected?(n(),N(de,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:M(()=>[I(m(d.requirement.rejection_reason),1)]),_:1})):(n(),N(de,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:M(()=>[I(m(x.value.approval_note),1)]),_:1}))]),e("div",null,[!x.value.is_rejected&&!x.value.approved&&b.value&&((l=E(u).user)==null?void 0:l.id)==((k=(g=x.value)==null?void 0:g.department_user)==null?void 0:k.id)?(n(),N(ft,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:($=v.requirement)==null?void 0:$.id,onSuccess:q,variant:1},null,8,["applicationId"])):p("",!0)]),a[2]||(a[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",oo,[e("span",null,m(((S=x.value.department)==null?void 0:S.short_name)||((A=x.value.department)==null?void 0:A.name)),1),e("span",ao,m(x.value.userType),1),x.value.department_user?(n(),o(P,{key:0},[x.value.is_rejected?(n(),o("span",lo," (Rejected)")):x.value.approved?(n(),o("span",io,"(✔)")):(n(),o("span",uo,a[1]||(a[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):p("",!0)])])}}},mo={class:"container mx-auto print:p-0 w-full print:max-w-full"},co={class:"border-b px-3 py-1 bg-gray-50 flex items-center justify-between rounded-t-md"},po={key:0,class:"p-3 max-h-[50vh] overflow-auto"},vo={class:"border table-auto w-full"},bo={class:"border-y px-4 py-2 text-right"},fo={class:"border-y pr-4 py-2 whitespace-nowrap"},xo={class:"border-y px-4 py-2"},go={class:"line-clamp-2 text-sm text-amber-950"},yo={class:"border-y px-4 py-2 text-center"},_o={class:"print:hidden relative min-h-[50vh] mx-4"},ko={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},ho={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},wo={class:"text-center text-xl font-bold mb-2 flex items-center justify-between"},$o={class:"flex items-center"},qo={class:"text-2xl ml-4"},Co={class:"mb-8"},To={class:"text-lg font-semibold mb-2"},Ao={class:"flex gap-4 items-center text-gray-500"},jo={class:"text-sm"},So={key:0,class:"flex items-center gap-1"},Ro={key:0,class:"mb-5"},Oo={class:"mb-8"},Io={class:"font-semibold text-lg px-2"},Mo={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},No={class:"w-full border-collapse"},Eo={key:0},Do={class:"mb-8"},Uo={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Lo={class:"flex flex-col items-end"},Po={key:2,class:"mt-6 mb-8 break-before-avoid-page"},Bo={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},Fo={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},Vo={class:"bg-white shadow rounded-lg space-y-4 p-4 mb-4"},Ho={class:"border col-span-3 p-3 rounded-md"},zo={class:"flex items-center gap-2 mb-4"},Go={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},Wo={class:"flex items-center gap-2 mb-4"},Yo={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},Ko={class:"font-bold print:text-gray-900"},Qo={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},Jo={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},Xo={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},Zo={class:"print:text-gray-900 text-sm text-right"},ea={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},ta={class:"print:text-gray-900 text-sm text-right"},sa={class:"flex justify-between items-center mb-4"},na={class:"mb-4"},ra={class:"flex justify-between items-center"},oa={key:1,class:"text-red-600"},aa={key:0,class:"mb-2"},la={class:"flex justify-between items-center"},ia={key:1,class:"mb-4 text-red-700 text-sm flex justify-between"},da={key:2,class:"print:hidden flex flex-wrap gap-2 items-center justify-between w-full text-sm"},ua={class:"flex gap-2"},za={__name:"RequirementShow",setup(d){const w=Xe(),v=Ze(),c=h(""),u=Ge(),t=Ye(),i=z(()=>{if(!s.value)return[];const f=new Map;return s.value.tasks&&s.value.tasks.forEach(r=>f.set(r.id,r)),Array.from(f.values())}),b=z(()=>{var B,y;if(!s.value)return[];const f=new Map,r=(O,F)=>{O&&(!O.department&&F&&(O.department={id:F.id,name:F.name,short_name:F.short_name}),f.set(O.id,O))};return(B=s.value.from_department)!=null&&B.users&&s.value.from_department.users.forEach(O=>{r(O,s.value.from_department)}),(y=s.value.to_department)!=null&&y.users&&s.value.to_department.users.forEach(O=>{r(O,s.value.to_department)}),s.value.tasks&&s.value.tasks.forEach(O=>{O.users&&O.users.forEach(F=>r(F,F.department))}),Array.from(f.values())}),x=h(),q=h(!1),s=h(null),a=ie({detail:null,open:!1}),l=h(!1),g=h(!1),k=h({withTasks:!0,taskOption:"list",withMessages:!0,withApprovals:!0,withAttachments:!0}),$=()=>l.value=!0,S=()=>l.value=!1,A=()=>{g.value=!0},R=async f=>{k.value=f,g.value=!1,f.withMessages&&await t.fetchComments({commentable_type:"requirement",commentable_id:s.value.id}),l.value=!0,await be(),window.print()},C=h(),U=h(""),G=h({isOpen:!1,taskId:null});pe(async()=>{await W(),window.addEventListener("beforeprint",$),window.addEventListener("afterprint",S),window.addEventListener("resize",te),await be(),bt(x.value,()=>{})});function te(){}ze(()=>{window.removeEventListener("beforeprint",$),window.removeEventListener("afterprint",S),window.removeEventListener("resize",te)});async function W(){c.value="loading";const f=(await xe(w.params.id)).data;s.value=f==null?void 0:f.requirement,U.value=f==null?void 0:f.user_department_position,c.value=""}function Y(){var f,r,B,y,O,F,ne,V,X;if(u.user.role!=="super_admin"&&((f=u.user)==null?void 0:f.id)!==((B=(r=s.value)==null?void 0:r.to_department)==null?void 0:B.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(O=(y=s.value)==null?void 0:y.to_department)==null?void 0:O.name}'s In charge can create or assign.`);console.log({requirement:s}),T.modalShown=!0,T.from_department_id=s.value.from_department_id,T.to_department_id=s.value.to_department_id,T.taskDefaultValues={title:"",description:"",from_department_id:s.value.from_department_id,to_department_id:s.value.to_department_id,is_important:((F=s.value)==null?void 0:F.priority)=="IMPORTANT",is_urgent:((ne=s.value)==null?void 0:ne.priority)=="URGENT",supervisor_ids:(V=s.value)!=null&&V.supervisor_id?[(X=s.value)==null?void 0:X.supervisor_id]:[]},T.requirement=s.value}const T=ie({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function se(){C.value=null,T.modalShown=!1,await W()}async function Q(){T.modalShown=!1,T.requirement=null,T.creating=!1}const J=h({open:!1});return(f,r)=>{var y,O,F,ne,V,X,ye,_e,ke,he,we,$e,qe,Ce,Te,Ae,je,Se,Re,Oe,Ie,Me,Ne;const B=Ve("RouterLink");return n(),o("div",mo,[a.open?(n(),N(Z,{key:0},{default:M(()=>[_(Fs,{requirementId:s.value.id,onCloseClick:r[0]||(r[0]=j=>a.open=!1),onUpdate:r[1]||(r[1]=async()=>{a.open=!1,await W()})},null,8,["requirementId"])]),_:1})):p("",!0),T.modalShown?(n(),N(Z,{key:1,class:"*:relative"},{default:M(()=>{var j;return[e("button",{onClick:D(Q,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},r[19]||(r[19]=[e("i",{class:"fas fa-times-circle"},null,-1)])),T!=null&&T.creating?p("",!0):(n(),N(eo,{key:0,"from-department-id":(j=s.value)==null?void 0:j.from_department_id,requirement:T==null?void 0:T.requirement,onCancelClick:Q,onAddNewTaskClick:r[2]||(r[2]=()=>{T.modalShown=!0,T.creating=!0}),onAssignTask:se},null,8,["from-department-id","requirement"])),T!=null&&T.creating?(n(),N(et,{key:1,requirementId:s.value.id,onClose:Q,onTaskCreated:se,defaultValues:T.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementId","defaultValues"])):p("",!0)]}),_:1})):p("",!0),C.value?(n(),N(Z,{key:2},{default:M(()=>[_(pt,{taskId:C.value,onClose:r[3]||(r[3]=j=>C.value=null),onUpdated:se},null,8,["taskId"])]),_:1})):p("",!0),G.value.isOpen?(n(),N(Z,{key:3,class:"*:max-w-4xl"},{default:M(()=>[_(vt,{taskId:G.value.taskId,onCancelClick:r[4]||(r[4]=()=>{G.value.isOpen=!1,G.value.taskId=0}),onSuccess:r[5]||(r[5]=()=>{G.value.isOpen=!1,G.value.taskId=0,c.value="loading",W()})},null,8,["taskId"])]),_:1})):p("",!0),J.value.open?(n(),N(Z,{key:4},{default:M(()=>[_(Is,{requirement:s.value,onClickCancel:r[6]||(r[6]=j=>J.value.open=!1),onUpdateStatus:r[7]||(r[7]=()=>{W(),J.value.open=!1})},null,8,["requirement"])]),_:1})):p("",!0),g.value?(n(),N(Z,{key:5},{default:M(()=>[_(tn,{initialOptions:k.value,onClose:r[8]||(r[8]=j=>g.value=!1),onPrint:R},null,8,["initialOptions"])]),_:1})):p("",!0),q.value?(n(),N(Z,{key:6},{default:M(()=>{var j,ue,ae,Ee;return[e("div",co,[r[21]||(r[21]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon size-8",onClick:r[9]||(r[9]=D(K=>q.value=!1,["prevent"]))},r[20]||(r[20]=[e("i",{class:"fas fa-times"},null,-1)]))]),(j=s.value)!=null&&j.closing_history&&((ae=(ue=s.value)==null?void 0:ue.closing_history)!=null&&ae.length)?(n(),o("div",po,[e("table",vo,[r[22]||(r[22]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-right"},"Close/Open"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status")])],-1)),e("tbody",null,[(n(!0),o(P,null,H(((Ee=s.value)==null?void 0:Ee.closing_history)||[],K=>(n(),o("tr",{key:K.at,class:"text-sm"},[e("td",bo,m(K==null?void 0:K.type),1),e("td",fo,m(K.at?E(oe)(K.at):""),1),e("td",xo,[e("div",go,m(K==null?void 0:K.closing_note),1)]),e("td",yo,m(K==null?void 0:K.status),1)]))),128))])])])):p("",!0)]}),_:1})):p("",!0),e("div",_o,[s.value?(n(),o("div",ko,[e("div",ho,[e("div",wo,[e("div",$o,[e("button",{class:"btn-3 h-8 px-4",onClick:r[10]||(r[10]=D(()=>E(v).back(),["prevent"]))},"Back"),e("div",qo,m(((y=s.value)==null?void 0:y.title)||"Requirement Form"),1)]),e("button",{class:"btn-indigo-light text-xs font-bold btn-3 h-8 px-4",onClick:D(A,["prevent"])},r[23]||(r[23]=[e("i",{class:"fas fa-print mr-1"},null,-1),I(" PRINT ")]))]),r[35]||(r[35]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",Co,[e("div",null,[e("div",To,[_(de,{"line-clamp":"3",class:"mb-2"},{default:M(()=>[I(m(s.value.title),1)]),btnText:M(({lineClampClass:j})=>[I(m(j?"More":"Less"),1)]),_:1}),e("div",Ao,[e("div",jo,[r[24]||(r[24]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),I(" "+m(E(oe)(s.value.created_at)),1)]),s.value.created_by?(n(),o("div",So,[r[25]||(r[25]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),_(le,{"show-details-on-avatar-hover":E(u).isAdminMood,"avatar-size":"xsmall",user:s.value.created_by,class:"border-sky-300"},null,8,["show-details-on-avatar-hover","user"])])):p("",!0)])]),s.value.description?(n(),o("div",Ro,[r[26]||(r[26]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),_(de,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:M(()=>[_(ce,{message:s.value.description},null,8,["message"])]),_:1})])):p("",!0)])]),e("div",Oo,[_(ve,{class:"mb-4"},{default:M(()=>[e("h2",Io,[r[27]||(r[27]=e("span",null,"Task List ",-1)),s.value.status=="approved"?(n(),o("span",{key:0,class:L(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":s.value.tasks_count>0&&s.value.completed_tasks_count==s.value.tasks_count,"text-red-700 font-semibold":s.value.tasks_count==0||s.value.completed_tasks_count!=s.value.tasks_count}]])}," ("+m(s.value.completed_tasks_count)+"/"+m(s.value.tasks_count)+" task(s) done) ",3)):p("",!0)])]),_:1}),e("div",Mo,[e("table",No,[r[29]||(r[29]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[c.value!="loading"&&((F=(O=s.value)==null?void 0:O.tasks)==null?void 0:F.length)===0?(n(),o("tr",Eo,r[28]||(r[28]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),o(P,{key:1},H(((ne=s.value)==null?void 0:ne.tasks)||[],(j,ue)=>(n(),N(rt,{key:j.id,task:j,indexing:ue+1,class:"*:py-3 *:border-b-0",onEditClick:r[11]||(r[11]=ae=>C.value=ae),onEmployeeAssignClick:r[12]||(r[12]=ae=>{G.value.isOpen=!0,G.value.taskId=ae})},null,8,["task","indexing"]))),128))])])])]),e("div",Do,[_(ve,{class:"mb-4"},{default:M(()=>r[30]||(r[30]=[e("h2",{class:"font-semibold text-lg px-2"},"Comments",-1)])),_:1,__:[30]}),_(Qt,{"commentable-type":"requirement","commentable-id":s.value.id,"current-user":E(u).user,"mentionable-users":b.value,"mentionable-tasks":i.value},null,8,["commentable-id","current-user","mentionable-users","mentionable-tasks"])]),p("",!0),c.value!="loading"&&!((V=s.value)!=null&&V.submission_date)?(n(),o("div",Uo,[e("div",Lo,[_(Jr,{"requirement-id":(X=s.value)==null?void 0:X.id,onSuccess:W,"requirement-note":U.value=="in_charge"},{heading:M(()=>r[31]||(r[31]=[I(" Requirement Submission ")])),acceptButtonLabel:M(()=>r[32]||(r[32]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),I("Submit Requirement ")],-1)])),submitButtonLabel:M(()=>r[33]||(r[33]=[I(" Submit Requirement ")])),_:1},8,["requirement-id","requirement-note"])])])):p("",!0),(ye=s.value)!=null&&ye.submission_date?(n(),o("div",Po,[_(ve,null,{default:M(()=>r[34]||(r[34]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[34]}),e("div",Bo,[(n(),o(P,null,H(["from_in_charge","from_coordinator"],j=>_(Pe,{class:"pt-12",key:j,requirement:s.value,"approval-type":j,onUpdateApproval:r[14]||(r[14]=()=>W())},null,8,["requirement","approval-type"])),64))]),((_e=s.value)==null?void 0:_e.from_department_id)!==((ke=s.value)==null?void 0:ke.to_department_id)?(n(),o("div",Fo,[(n(),o(P,null,H(["to_in_charge","to_coordinator"],j=>_(Pe,{class:"pt-12",key:j,requirement:s.value,"approval-type":j,onUpdateApproval:r[15]||(r[15]=()=>W())},null,8,["requirement","approval-type"])),64))])):p("",!0)])):p("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:x},[e("div",Vo,[e("div",Ho,[e("div",null,[e("div",zo,[r[36]||(r[36]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),_(Le,{department:(he=s.value)==null?void 0:he.from_department,"short-name":!0},null,8,["department"])]),r[37]||(r[37]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",Go,[(we=s.value)!=null&&we.supervisor?(n(),N(le,{key:0,"show-details-on-avatar-hover":E(u).isAdminMood,user:($e=s.value)==null?void 0:$e.supervisor},null,8,["show-details-on-avatar-hover","user"])):p("",!0)])]),r[39]||(r[39]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Wo,[r[38]||(r[38]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),_(Le,{department:(qe=s.value)==null?void 0:qe.to_department,"short-name":!0},null,8,["department"])])])]),e("div",Yo,[r[40]||(r[40]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",Ko,m((Ce=s.value)==null?void 0:Ce.id),1)]),((Ae=(Te=s.value)==null?void 0:Te.website_tags)==null?void 0:Ae.length)>0?(n(),o("div",Qo,[r[41]||(r[41]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",Jo,[(n(!0),o(P,null,H(((je=s.value)==null?void 0:je.website_tags)||[],j=>(n(),o("div",{key:j.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},m(j.name),1))),128))])])):p("",!0),(Se=s.value)!=null&&Se.submission_date?(n(),o("div",Xo,[r[42]||(r[42]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",Zo,m(E(oe)((Re=s.value)==null?void 0:Re.submission_date)),1)])):p("",!0),(Oe=s.value)!=null&&Oe.better_to_complete_on?(n(),o("div",ea,[r[43]||(r[43]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",ta,m(E(Qe)((Ie=s.value)==null?void 0:Ie.better_to_complete_on,{weekDay:"long"})),1)])):p("",!0),e("div",null,[e("div",sa,[r[44]||(r[44]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:L(["font-semibold text-sm",{"text-yellow-600 ":s.value.priority=="IMPORTANT","text-red-700 ":s.value.priority=="URGENT"}])},m(s.value.priority||"NORMAL"),3)])]),e("div",na,[e("div",ra,[r[45]||(r[45]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),s.value.status?(n(),o("span",{key:0,class:L(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":s.value.status!="approved","bg-green-300 text-green-700 border-green-400":s.value.status=="approved"}])},m(String(s.value.status).toUpperCase()),3)):(n(),o("span",oa,"..."))])]),s.value.rejected_by?(n(),o("div",aa,[e("div",la,[r[46]||(r[46]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),_(le,{user:s.value.rejected_by},null,8,["user"])])])):p("",!0),s.value.rejection_reason?(n(),o("div",ia,[r[47]||(r[47]=e("p",{class:"text-gray-600 mb-1"},"Reason:",-1)),e("p",null,m(s.value.rejection_reason),1)])):p("",!0),r[50]||(r[50]=e("hr",{class:"mb-3"},null,-1)),(Me=s.value)!=null&&Me.closed_at?p("",!0):(n(),o("div",da,[e("div",ua,[s.value.status=="approved"?(n(),o("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:D(Y,["prevent"])},r[48]||(r[48]=[e("i",{class:"fas fa-plus text-sm"},null,-1),I(" Add/Assign Task ")]))):p("",!0)]),_(B,{class:"btn-2 h-8",to:`/requirements/edit/${(Ne=s.value)==null?void 0:Ne.id}`},{default:M(()=>r[49]||(r[49]=[I(" Edit ")])),_:1,__:[49]},8,["to"])]))])]),_(ks,{requirement:s.value,onReOpenClick:r[16]||(r[16]=j=>J.value.open=!0),class:"mb-4 card-bg bg-white",onCloseClick:r[17]||(r[17]=j=>J.value.open=!0),onShowHistoryClick:r[18]||(r[18]=j=>q.value=!q.value)},null,8,["requirement"]),_(ds,{requirement:s.value,class:"mb-4"},null,8,["requirement"]),_(tt,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3",ref:"shareComponent"},null,512)],512)])):p("",!0),c.value==="loading"?(n(),N(ge,{key:1,class:"absolute inset-0 bg-opacity-90"})):p("",!0)]),s.value&&l.value?(n(),N(Fr,{key:7,class:"hidden print:block",requirement:s.value,options:k.value,comments:E(t).comments},null,8,["requirement","options","comments"])):p("",!0)])}}};export{za as default};
