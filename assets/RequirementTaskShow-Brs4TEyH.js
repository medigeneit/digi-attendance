import{m as R,r as Y,n as Z,c as i,o as a,f as D,g as c,a as t,i as E,j as C,t as h,w as j,d as xt,z as Q,F as U,y as X,x as K,b as Et,u as At,e as Mt,A as kt,p as v,k as l,I as Rt}from"./index-DKvvHbAy.js";import{L as ft}from"./LoaderView-a1BRn5bT.js";import{O as J}from"./OverlyModal-DOOCc6m-.js";import{_ as yt}from"./DepartmentChip-BoTC4z1B.js";import{_ as _t}from"./DescriptionView-BK-gSBbP.js";import{_ as vt,a as jt}from"./TaskAssignedUsers-el7LKBtn.js";import{u as Lt}from"./task-D7bup4NP.js";import{_ as Ot,a as Nt,b as Ut}from"./TaskStatusManager-DNV3d8XB.js";import{_ as Pt}from"./TodoItemCard-DjgftUtV.js";import{b as W,d as Bt}from"./datetime-Efw590t9.js";import{s as gt}from"./dom-BKn8Ftnz.js";import{u as Vt}from"./useTaskStore-D6tW7eRe.js";import{u as zt}from"./useTodoDateStore-B1KIHEfz.js";import{_ as Gt}from"./TodoCreateEditShow-BiTucM8u.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BciQLR_x.js";import"./url-CePbr-gY.js";import"./requirement-EV53ec5p.js";import"./useTodoStore-v7pzwtom.js";import"./TaskSelectionInput-D61pFdCg.js";import"./TaskTitle-CDTGH-zJ.js";const qt={class:"my-6"},Ft={class:"text-center font-semibold text-blue-800 mb-4"},Ht={class:"text-red-600 text-center mt-2 text-sm"},Wt={class:"flex justify-between mt-3"},Kt={__name:"TaskClosingForm",props:{loading:{type:Boolean,default:!1},task:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(z,{emit:s}){const d=z,$=s,u=R({get:()=>d.loading,set:()=>$("update:loading")}),w=Y("");async function g(){var x,r;u.value=!0;try{await Lt(d.task.id,{status:"CLOSED"}),$("updateStatus")}catch(T){w.value=(r=(x=T.response)==null?void 0:x.data)==null?void 0:r.message,$("error")}finally{u.value=!1}}return(x,r)=>{var P;const T=Z("LoaderView");return a(),i("form",{class:"p-4 rounded relative border",onSubmit:j(g,["prevent"])},[u.value?(a(),D(T,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:E(()=>r[1]||(r[1]=[C(" Submitting! ")])),_:1,__:[1]})):c("",!0),r[5]||(r[5]=t("h3",{class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},"Task Closing",-1)),t("div",qt,[t("div",Ft,h((P=z.task)==null?void 0:P.title),1),r[2]||(r[2]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),r[3]||(r[3]=t("div",{class:"text-center my-1"},[C(" Want to "),t("span",{class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},[t("i",{class:"text-sm fas fa-lock text-blue-600"}),C("Close")]),C(" the task? ")],-1))]),r[6]||(r[6]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",Ht,h(w.value),1),t("div",Wt,[t("button",{class:"btn-3",onClick:r[0]||(r[0]=j(p=>$("clickCancel"),["prevent"]))},"Cancel"),r[4]||(r[4]=t("button",{class:"btn-2"},[t("i",{class:"text-xl text-white fas fa-lock"}),C(" Close")],-1))])])],32)}}},Jt={class:"border-gray-300"},Qt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Xt={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Yt={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},Zt={key:0,class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-2 justify-between"},It={key:0},te=["disabled"],ee=["disabled"],se={class:"text-base font-semibold text-gray-700"},ae={__name:"TaskTimeline",props:{task:{type:Object}},emits:["updateStatus","error"],setup(z,{emit:s}){const d=z,$=xt(),u=Q({user:null,type:""});function w(p){u.user=$.user,u.type=p}const g={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},x=R(()=>(g==null?void 0:g[T.value])||0),r=R(()=>{var p;return{"bg-yellow-50":T.value==="IN_PROGRESS","bg-green-50":T.value==="COMPLETED","bg-red-50":T.value==="PENDING","bg-blue-50":(p=d.task)==null?void 0:p.closed_at}}),T=R(()=>{var p;return(p=d.task)==null?void 0:p.status}),P=R(()=>{var p,k,L,f,B,O,A,_;return[{date:W((p=d.task)==null?void 0:p.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((k=d.task)!=null&&k.assigned_at)},{date:W((L=d.task)==null?void 0:L.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((f=d.task)!=null&&f.started_at)||x.value>=g.IN_PROGRESS},{date:W((B=d.task)==null?void 0:B.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((O=d.task)!=null&&O.completed_at)||x.value>=g.COMPLETED},{date:W((A=d.task)==null?void 0:A.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((_=d.task)!=null&&_.deadline)}].sort((N,V)=>N.date===null||V.date===null||new Date(N.date)==new Date(V.date)?N.serial-V.serial:new Date(N.date)-new Date(V.date))});return(p,k)=>{var L;return a(),i("div",{class:K(["border py-8 px-4 rounded",r.value])},[t("div",Jt,[(L=d.task)!=null&&L.is_target?(a(),i("div",Qt,k[2]||(k[2]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),C(" TARGET TASK ")]))):c("",!0),t("ol",Xt,[(a(!0),i(U,null,X(P.value,(f,B)=>{var O,A;return a(),i("li",{class:"ml-5",key:B},[t("div",Yt,[f.active?(a(),i("i",{key:0,class:K([f.icon,"text-xs"])},null,2)):c("",!0)]),t("div",{class:K({"opacity-30":!f.active})},[f.active?(a(),i("div",Zt,[f.date?(a(),i("span",It,h(f.date),1)):c("",!0),((O=d.task)==null?void 0:O.children_task_count)===0&&f.status==="started"&&f.active?(a(),i("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:k[0]||(k[0]=j(()=>w("start-date"),["prevent"])),disabled:!!d.task.closed_at},h(f.date?"Edit":"Set Date"),9,te)):c("",!0),((A=d.task)==null?void 0:A.children_task_count)===0&&f.active&&f.status==="completed"?(a(),i("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:k[1]||(k[1]=j(()=>w("finish-date"),["prevent"])),disabled:!!d.task.closed_at},h(f.date?"Edit":"Set Date"),9,ee)):c("",!0)])):c("",!0),t("h3",se,h(f.title),1)],2)])}),128))])])],2)}}},oe={class:"container mx-auto px-4"},ne={key:3,class:"w-full xl:max-w-8xl min-h-64 mx-auto relative"},le={key:0,class:"text-sm mb-4 border-b","aria-label":"Breadcrumb"},ie={class:"flex items-center gap-2"},re={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},de=["title"],ue=["to"],ce={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},pe={class:"grid grid-cols-12 gap-x-4 gap-y-3"},me={class:"col-span-full md:col-span-7 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},ke={class:"font-medium text-md flex items-start gap-2"},fe={class:"mt-2 col-span-full flex items-center"},ye={class:"text-gray-400 text-xs"},_e={class:"flex items-center gap-0.5"},ve={class:"text-sky-400 text-sm font-semibold"},ge=["innerHTML"],xe={class:"flex justify-between items-end mt-6 mb-2"},be={key:0,class:"border flex items-center justify-center h-96 rounded bg-gray-50 text-sm italic"},he={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},Ce={class:"font-semibold flex items-center gap-2"},we={class:"text-white text-base"},Te={class:"col-span-full md:col-span-5 xl:col-span-4 2xl:col-span-3 space-y-4 sticky top-[74px] bg-white shadow rounded-lg p-4 pb-0"},$e={class:"border col-span-3 p-3 rounded-md"},Se={class:"flex items-center gap-2 mb-4"},De={class:"flex items-center gap-2 mb-4"},Ee={key:0,class:"flex items-center gap-4 flex-wrap justify-between col-span-3 sticky bottom-0 bg-white"},Ae=["disabled"],Me={key:0,class:"flex items-start justify-center !text-lg mb-4"},Re={key:2,class:"py-4 flex items-center justify-between"},je={key:3,class:"h-1"},Le={key:2},Oe={key:1,class:"text-center py-4 text-red-500"},as={__name:"RequirementTaskShow",setup(z){const s=Vt(),d=xt(),$=zt(),u=Et(),w=At(),g=Y(""),x=Q({open:!1,task:null}),r=Q({open:!1,task:null});function T(){x.open=!0,x.task=s.task}function P(){r.open=!0,r.task=s.task}Mt(async()=>{g.value="loading";try{await k(u.params.id)}catch(o){o.response.status===404&&w.push({name:"RequirementTaskList"})}g.value="",u.hash=="#sub-tasks"&&setTimeout(()=>gt(u.hash,66),0)});const p=Q({user:null,type:""});async function k(o){await s.fetchTask(o,{with_todos:"true"})}async function L(){await k(u.params.id),p.user=null,p.type=""}const f=o=>{w.push({name:"TaskEdit",params:{id:o}})};function B(){x.open=!1,w.back()}const O=R(()=>{var o,e;return(e=(o=s==null?void 0:s.task)==null?void 0:o.users)==null?void 0:e.find(m=>{var b;return((b=d.user)==null?void 0:b.id)==m.id})}),A=R(()=>{var e,m,b,S,G,q,F,H;const o=[];return(m=(e=s.task)==null?void 0:e.requirement_detail)!=null&&m.id&&o.push({id:(S=(b=s.task)==null?void 0:b.requirement_detail)==null?void 0:S.id,title:(q=(G=s.task)==null?void 0:G.requirement_detail)==null?void 0:q.title,is_current_page:!1}),o.push({id:(F=s.task)==null?void 0:F.id,title:(H=s.task)==null?void 0:H.title,is_current_page:!0}),o});kt(()=>u.params.id,async o=>{g.value="changing",await k(o),g.value=""}),kt(()=>u.hash,async function(){setTimeout(()=>gt(u.hash,66),0)});const _=Y({action:null}),N=R(()=>{const e=((s==null?void 0:s.task_todo_dates)||[]).reduce((m,b)=>{const S=b.date;return m[S]||(m[S]=[]),m[S].push(b),m},{});return Object.keys(e).sort((m,b)=>new Date(b)-new Date(m)).map(m=>({date:m,todo_dates:e[m]}))});function V(){_.value={..._.value,action:""},k(u.params.id)}function bt(){_.value={..._.value,action:""},k(u.params.id)}function I(o){console.log({todo:o}),_.value={..._.value,action:"edit",todo:o}}function ht(o,e){console.log({yearMonthDay:e,todoId:o}),_.value={..._.value,action:"addDate",date:e,todo_id:o,formReadonlyValues:{date:!0}}}function Ct(){_.value={action:null,todo:null}}function wt(o){console.log({todo:o}),_.value={..._.value,action:"show",todo:o}}function Tt(){var o;_.value={..._.value,action:"add",todoTypeId:(o=u.params)==null?void 0:o.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}async function $t(o,e){var m;confirm(`Are your sure?
want to change status to ${e} 
todo: '${o==null?void 0:o.title}'`)&&(await $.updateStatus(o.id,e),k((m=u.params)==null?void 0:m.id))}async function St(o){var e;confirm(`Are your sure want to delete todo
'${o==null?void 0:o.title}'`)&&(await $.deleteTodoDate(o.id),k((e=u.params)==null?void 0:e.id))}return(o,e)=>{var S,G,q,F,H,tt,et,st,at,ot,nt,lt,it,rt,dt,ut,ct,pt,mt;const m=Z("RouterLink"),b=Z("router-view");return a(),i("div",oe,[p.user?(a(),D(J,{key:0},{default:E(()=>[v(Ot,{task:l(s).task,user:p.user,type:p.type,onCloseClick:e[0]||(e[0]=n=>p.user=null),onUpdateDate:L},null,8,["task","user","type"])]),_:1})):c("",!0),x.open?(a(),D(J,{key:1},{default:E(()=>[v(Nt,{onCloseClick:e[1]||(e[1]=n=>x.open=!1),task:x.task,onDelete:B},null,8,["task"])]),_:1})):c("",!0),g.value==="loading"?(a(),D(ft,{key:2,class:"h-[80vh] items-center justify-center"})):(a(),i("div",ne,[l(s).task?(a(),i(U,{key:0},[A.value.length>1?(a(),i("nav",le,[t("ol",ie,[(a(!0),i(U,null,X(A.value,(n,y)=>(a(),i(U,{key:n.id},[y>0?(a(),i("li",re,"/")):c("",!0),t("li",{title:n==null?void 0:n.title,class:"text-gray-600 line-clamp-1"},[n.is_current_page?(a(),i("span",ce,h(n==null?void 0:n.title),1)):(a(),i("div",{key:0,to:`${o.isMyTask?"/my-tasks":"/tasks"}/${n.id}`,class:K(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":y>0,"whitespace-nowrap":y===0}])},h(n==null?void 0:n.title),11,ue))],8,de)],64))),128))])])):c("",!0),t("div",pe,[t("div",me,[t("div",null,[t("h2",ke,[t("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:e[2]||(e[2]=n=>l(w).back())},e[8]||(e[8]=[t("i",{class:"fas fa-arrow-left"},null,-1)])),v(_t,null,{default:E(()=>[C(h(l(s).task.title),1)]),_:1})]),t("div",fe,[t("div",ye,[e[9]||(e[9]=t("i",{class:"fas fa-clock"},null,-1)),C(" "+h(l(Bt)(l(s).task.created_at)),1)]),(S=l(s).task)!=null&&S.created_by_user?(a(),i(U,{key:0},[e[10]||(e[10]=t("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),t("div",_e,[v(Rt,{user:(G=l(s).task)==null?void 0:G.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),t("div",ve,h((F=(q=l(s).task)==null?void 0:q.created_by_user)==null?void 0:F.label),1)])],64)):c("",!0)])]),v(_t,null,{default:E(()=>{var n;return[t("p",{innerHTML:(n=l(s).task)==null?void 0:n.description,class:"text-justify"},null,8,ge)]}),_:1}),t("div",null,[t("div",xe,[e[12]||(e[12]=t("h3",{class:"font-semibold text-xl"},"Todos",-1)),O.value?(a(),i("button",{key:0,class:"btn btn-3 h-8",onClick:e[3]||(e[3]=j(()=>Tt(),["prevent"]))},e[11]||(e[11]=[t("i",{class:"fas fa-plus"},null,-1),C(" Add Todo ")]))):c("",!0)]),t("div",null,[N.value.length===0?(a(),i("div",be," No Todos ")):c("",!0),(a(!0),i(U,null,X(N.value,n=>(a(),i("div",{key:n.date,class:"border rounded-md overflow-hidden mb-4"},[t("div",he,[t("div",Ce,[t("div",we,h(l(W)(n.date)),1)])]),t("div",null,[(a(!0),i(U,null,X((n==null?void 0:n.todo_dates)||[],y=>(a(),D(Pt,{key:y.id,todoDate:y,onClickTodo:M=>wt(M),onClickEdit:()=>I(y==null?void 0:y.todo),onClickChangeStatus:(M,Dt)=>$t(M,Dt),onClickDelete:M=>St(M),"hide-sorting-btn":"",class:"border-b border-sky-200"},null,8,["todoDate","onClickTodo","onClickEdit","onClickChangeStatus","onClickDelete"]))),128))])]))),128))])])]),t("div",Te,[t("div",$e,[t("div",null,[t("div",Se,[e[13]||(e[13]=t("div",{class:"text-gray-500 text-sm"},"From",-1)),v(yt,{department:(tt=(H=l(s))==null?void 0:H.task)==null?void 0:tt.from_department,"short-name":!0},null,8,["department"])]),e[14]||(e[14]=t("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisors",-1)),v(vt,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((st=(et=l(s))==null?void 0:et.task)==null?void 0:st.supervisors)||[],listType:"supervisors",maxItem:3},null,8,["users"])]),e[17]||(e[17]=t("hr",{class:"my-4"},null,-1)),t("div",null,[t("div",De,[e[15]||(e[15]=t("div",{class:"text-gray-500 text-sm"},"To",-1)),v(yt,{department:(ot=(at=l(s))==null?void 0:at.task)==null?void 0:ot.to_department,"short-name":!0},null,8,["department"])]),e[16]||(e[16]=t("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Assigned Users",-1)),v(vt,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((lt=(nt=l(s))==null?void 0:nt.task)==null?void 0:lt.users)||[],isTargetTask:(rt=(it=l(s))==null?void 0:it.task)==null?void 0:rt.is_target,maxItem:5},null,8,["users","isTargetTask"])])]),l(d).isAdminMood?(a(),i("div",Ee,[v(m,{to:{name:"TaskUserAssign",params:{id:(dt=l(s).task)==null?void 0:dt.id}},class:K(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",l(s).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:e[4]||(e[4]=n=>n.stopPropagation())},{default:E(()=>e[18]||(e[18]=[t("i",{class:"fas fa-users-cog"},null,-1),C(" Employees ")])),_:1,__:[18]},8,["to","class"]),t("button",{onClick:e[5]||(e[5]=j(n=>{var y;return f((y=l(s).task)==null?void 0:y.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!l(s).task.closed_at},e[19]||(e[19]=[t("i",{class:"fas fa-edit"},null,-1),C(" Edit ")]),8,Ae)])):c("",!0),v(ae,{task:(ut=l(s))==null?void 0:ut.task},null,8,["task"]),(ct=l(s))!=null&&ct.task?(a(),D(Ut,{key:1,task:((pt=l(s))==null?void 0:pt.task)||{},class:"col-span-full",onUpdateStatus:e[6]||(e[6]=()=>{var n,y;return k((y=(n=l(s))==null?void 0:n.task)==null?void 0:y.id)}),"hide-timeline":""},{top:E(()=>{var n,y,M;return[(n=l(s).task)!=null&&n.closed_at?c("",!0):(a(),i("div",Me,[v(jt,{status:(y=l(s).task)==null?void 0:y.status,progressPercent:(M=l(s).task)==null?void 0:M.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"])]))]}),_:1},8,["task"])):c("",!0),l(d).isAdminMood?(a(),i("div",Re,[t("button",{class:"btn-2-red h-8",onClick:j(T,["prevent"])},"Delete"),(mt=l(s).task)!=null&&mt.closed_at?c("",!0):(a(),i("button",{key:0,class:"btn-3 h-8",onClick:j(P,["prevent"])}," Close Task "))])):(a(),i("div",je))])]),l(u).name==="TaskReportAdd"?(a(),D(J,{key:1,class:"*:bg-transparent"},{default:E(()=>[v(b)]),_:1})):(a(),i("section",Le,[v(b)]))],64)):(a(),i("div",Oe,h(l(s).error),1)),g.value==="changing"?(a(),D(ft,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):c("",!0)])),v(Gt,{userRole:"employee",todoModal:_.value,onCancelClick:Ct,onTodoUpdate:V,onTodoDateUpdate:bt,onClickEdit:I,onClickAddTodoDate:ht},null,8,["todoModal"]),r.open?(a(),D(J,{key:4},{default:E(()=>[v(Kt,{task:l(s).task,onClickCancel:e[7]||(e[7]=n=>r.open=!1)},null,8,["task"])]),_:1})):c("",!0)])}}};export{as as default};
