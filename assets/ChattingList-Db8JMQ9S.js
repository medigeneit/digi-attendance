import{M as A,g as R,c as r,k,n as p,o as n,a as t,x as $,F as M,e as T,s as S,b as N,t as I,r as C,q as L,h as z,d as U,l as B,v as P,N as O,u as G,w as K,j,i as te,A as H,y as se,_ as ne,O as oe,p as ae,m as Y,f as re}from"./index-BB1GXcvH.js";import{u as le}from"./company-CCWddKVn.js";import{u as ie}from"./department-qVHqS-9y.js";import{u as de}from"./user-5sz7IJjV.js";const W={__name:"AddNewButton",setup(i){const e=A(),l=R(),s=()=>{e.openAddModal=!0};return(o,c)=>{var v;return["admin","super_admin","developer"].includes((v=p(l).user)==null?void 0:v.role)?(n(),r("div",{key:0,onClick:s,title:"Add New Conversation",class:"size-10 shrink-0 grow-0 flex justify-center items-center"},c[0]||(c[0]=[t("i",{class:"fas fa-comment-alt-plus text-3xl cursor-pointer text-[#24A1DE]"},null,-1)]))):k("",!0)}}},ce={class:"flex justify-center items-center gap-3"},ue=["onClick"],ve={__name:"ConversationTypeSelector",props:{modelValue:{type:String,default:""},onSelect:{tyep:Function,default:()=>{}}},emits:["update:modelValue"],setup(i,{emit:e}){const l=i,s=e,o=$(()=>[{label:"Group",value:"group",iconClass:"fas fa-users"}]);function c(v){s("update:modelValue",v.value),l.onSelect()}return(v,u)=>(n(),r("div",ce,[(n(!0),r(M,null,T(o.value,a=>(n(),r("button",{key:a.value,class:S(["cursor-pointer px-6 py-1 border rounded-lg transition font-bold",i.modelValue===a.value?"bg-sky-600 text-white border-sky-600":"hover:bg-gray-50"]),onClick:f=>c(a)},[t("i",{class:S(a.iconClass)},null,2),N(" "+I(a.label),1)],10,ue))),128))]))}},me={class:"flex flex-col md:flex-row justify-center md:items-center gap-2"},pe=["value"],fe={__name:"GroupTitleInput",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(i,{emit:e}){return(l,s)=>(n(),r("div",me,[s[1]||(s[1]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"}," Group Title ",-1)),t("input",{id:"title",value:i.modelValue,onInput:s[0]||(s[0]=o=>l.$emit("update:modelValue",o.target.value)),type:"text",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},null,40,pe)]))}},ye={class:"grid sm:grid-cols-2 gap-4"},ge={class:"flex flex-row justify-center items-center gap-2"},xe=["value"],he=["value"],be={class:"flex flex-row justify-center items-center gap-2"},_e=["value","disabled"],we=["value"],Ce={__name:"CompanyDepartmentFilter",props:{companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""}},emits:["update:companyId","update:departmentId"],setup(i,{emit:e}){return(l,s)=>(n(),r("div",ye,[t("div",ge,[s[3]||(s[3]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Company",-1)),t("select",{value:i.companyId,onChange:s[0]||(s[0]=o=>l.$emit("update:companyId",o.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},[s[2]||(s[2]=t("option",{value:""},"-- Company --",-1)),(n(!0),r(M,null,T(i.companies,o=>(n(),r("option",{key:o.id,value:o.id},I(o.name),9,he))),128))],40,xe)]),t("div",be,[s[5]||(s[5]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Department",-1)),t("select",{value:i.departmentId,disabled:!i.companyId,onChange:s[1]||(s[1]=o=>l.$emit("update:departmentId",o.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60"},[s[4]||(s[4]=t("option",{value:""},"-- Department --",-1)),(n(!0),r(M,null,T(i.departments,o=>(n(),r("option",{key:o.id,value:o.id},I(o.name),9,we))),128))],40,_e)])]))}},ke={class:"grid gap-2"},$e={key:0,class:"flex flex-wrap gap-2"},Ie={class:"font-medium"},Ue=["onClick"],Me={class:"flex items-center gap-2"},Se=["disabled"],Ae={class:"max-h-72 overflow-y-auto rounded-lg rounded-t-none border"},je={key:0,class:"p-4 text-gray-500 text-center"},Te={key:0,class:"p-4 text-center text-gray-600"},Le={key:1,class:"divide-y"},De=["for"],Ee={class:"w-full grow flex items-center gap-3"},Ne=["title"],Ve={class:"leading-tight"},Re={class:"font-medium text-sm md:text-base"},ze={class:"text-xs text-gray-500"},He={class:"w-14 md:w-auto md:shrink-0 inline-flex justify-center items-center text-right"},Oe={key:0,class:"text-gray-500 text-xs text-center"},Be=["id","type","name","checked","onChange"],J={__name:"UserPicker",props:{mode:{type:String,required:!0},users:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},selectedUserIds:{type:Array,default:()=>[]},alreadyAddedUserIds:{type:Array,default:()=>[]}},emits:["update:companyId","update:departmentId","update:selectedUserIds"],setup(i,{emit:e}){const l=i,s=e,o=le(),c=ie(),v=de(),u=R(),a=$({get:()=>l.companyId,set:x=>s("update:companyId",x)}),f=$({get:()=>l.departmentId,set:x=>s("update:departmentId",x)}),h=$({get:()=>l.selectedUserIds,set:x=>s("update:selectedUserIds",x)}),w=$(()=>o.companies||[]),b=$(()=>c.departments||[]),m=$(()=>v.users||[]),d=$(()=>{var x;return(x=l.users)!=null&&x.length?l.users:m.value}),g=C(""),D=$(()=>{if(!g.value.trim())return d.value;const x=g.value.trim().toLowerCase();return d.value.filter(_=>{const y=(_.name||"").toLowerCase(),E=String(_.employee_id||"").toLowerCase(),V=String(_.phone||"").toLowerCase(),F=String(_.email||"").toLowerCase();return y.includes(x)||E.includes(x)||V.includes(x)||F.includes(x)})}),q=$(()=>!a.value);function Z(x){let _=[...h.value];const y=_.indexOf(x.id);l.mode==="direct"?_=y>=0?[]:[x.id]:y>=0?_.splice(y,1):_.push(x.id),h.value=_}function ee(x){var y;const _=(y=d.value)==null?void 0:y.find(E=>parseInt(E.id)==parseInt(x));return _?_.name||_.employee_id||_.id:""}return L(()=>a.value,async(x,_)=>{x!==_&&(f.value="",h.value=[],x&&await c.fetchDepartments(x),await v.fetchUsers({company_id:x||null,department_id:null}))}),L(()=>f.value,async(x,_)=>{x!==_&&(h.value=[],a.value&&await v.fetchUsers({company_id:a.value,department_id:x||null}))}),z(async()=>{!w.value.length&&o.fetchCompanies&&await o.fetchCompanies(),a.value&&(await c.fetchDepartments(a.value),await v.fetchUsers({company_id:a.value,department_id:f.value||null}))}),(x,_)=>(n(),r(M,null,[U(Ce,{"company-id":a.value,"onUpdate:companyId":_[0]||(_[0]=y=>a.value=y),"department-id":f.value,"onUpdate:departmentId":_[1]||(_[1]=y=>f.value=y),companies:w.value,departments:b.value},null,8,["company-id","department-id","companies","departments"]),t("div",ke,[i.mode==="group"&&i.selectedUserIds.length?(n(),r("div",$e,[(n(!0),r(M,null,T(i.selectedUserIds,y=>(n(),r("span",{key:y,class:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm"},[t("span",Ie,I(ee(y)),1),t("button",{type:"button",class:"text-red-600",onClick:E=>h.value=i.selectedUserIds.filter(V=>V!==y)}," ✕ ",8,Ue)]))),128))])):k("",!0),t("div",null,[t("div",Me,[B(t("input",{"onUpdate:modelValue":_[2]||(_[2]=y=>g.value=y),type:"search",disabled:q.value,class:"flex-1 px-3 py-2 border rounded-lg rounded-b-none focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60",placeholder:"Search by Name / Employee ID / Phone"},null,8,Se),[[P,g.value]])]),t("div",Ae,[q.value?(n(),r("div",je,"Company নির্বাচন করুন।")):(n(),r(M,{key:1},[D.value.length?(n(),r("div",Le,[(n(!0),r(M,null,T(D.value,y=>{var E,V;return n(),r(M,{key:y.id},[((V=(E=p(u))==null?void 0:E.user)==null?void 0:V.id)!==y.id?(n(),r("label",{key:0,for:`userId${y.id}`,class:"flex items-center justify-between gap-3 p-3 hover:bg-gray-50"},[t("div",Ee,[t("div",{class:"border rounded-full",title:y.name},[U(O,{user:y,size:"medium"},null,8,["user"])],8,Ne),t("div",Ve,[t("div",Re,I(y.name||"User #"+(y.employee_id??y.id)),1),t("div",ze,I(y.employee_id||y.phone||y.email||""),1)])]),t("div",He,[i.alreadyAddedUserIds.includes(y.id)?(n(),r("span",Oe," Already Added ")):(n(),r("input",{key:1,id:`userId${y.id}`,type:i.mode==="direct"?"radio":"checkbox",name:i.mode==="direct"?"direct-user":"group-users",checked:i.selectedUserIds.includes(y.id),onChange:F=>Z(y),class:"size-5"},null,40,Be))])],8,De)):k("",!0)],64)}),128))])):(n(),r("div",Te," কোন ইউজার পাওয়া যায়নি। "))],64))])])])],64))}},Pe={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},qe={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[100vh] md:max-h-[90%] overflow-y-auto"},Fe={class:"flex flex-col gap-y-2 md:flex-row justify-between items-center"},Ge={key:0,class:"mt-4"},Ke={key:1,class:"text-red-600 text-sm"},Ye={class:"flex justify-between"},We=["disabled"],Je={__name:"AddNewConversationModal",setup(i){const e={GROUP:"group"},l=A(),s=G(),o=C("group"),c=C(""),v=C(""),u=C(""),a=C([]),f=C(""),h=()=>{l.openAddModal=!1,w()};function w(){o.value="group",c.value="",v.value="",u.value="",a.value=[],f.value=""}async function b(){var d;if(f.value="",!o.value){f.value="দয়া করে Conversation টাইপ নির্বাচন করুন।";return}if(((d=a.value)==null?void 0:d.length)==0){f.value="User নির্বাচন করুন।";return}const m=await l.createConversation({type:o.value,title:o.value=="group"?u.value:"",user_ids:a.value});l.openAddModal=!1,s.push({name:"Conversation Message",params:{conversationId:m}}),l.showMobileConversationList=!1,l.fetchUserConversations()}return(m,d)=>p(l).openAddModal?(n(),r("div",Pe,[t("div",qe,[t("div",Fe,[d[5]||(d[5]=t("h2",{class:"text-xl text-center font-semibold"},"Add New Conversation",-1)),U(ve,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=g=>o.value=g),onSelect:()=>a.value=[]},null,8,["modelValue","onSelect"])]),d[9]||(d[9]=t("hr",{class:"mt-4"},null,-1)),o.value?(n(),r("form",{key:1,class:"space-y-3 mt-3",onSubmit:K(b,["prevent"])},[o.value===e.GROUP?(n(),j(fe,{key:0,modelValue:u.value,"onUpdate:modelValue":d[1]||(d[1]=g=>u.value=g)},null,8,["modelValue"])):k("",!0),U(J,{mode:o.value,"company-id":c.value,"onUpdate:companyId":d[2]||(d[2]=g=>c.value=g),"department-id":v.value,"onUpdate:departmentId":d[3]||(d[3]=g=>v.value=g),selectedUserIds:a.value,"onUpdate:selectedUserIds":d[4]||(d[4]=g=>a.value=g)},null,8,["mode","company-id","department-id","selectedUserIds"]),f.value?(n(),r("p",Ke,I(f.value),1)):k("",!0),d[8]||(d[8]=t("hr",null,null,-1)),t("div",Ye,[t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:h}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:!u.value.trim()||a.value.length<2}," Create ",8,We)])],32)):(n(),r("div",Ge,[t("div",{class:"rounded-md border border-dashed p-4 text-center text-gray-600"},[d[6]||(d[6]=t("div",{class:"py-4 text-xl leading-loose"},[N(" Conversation টাইপ (Direct / Group) সিলেক্ট করুন, "),t("br"),N(" তারপর নিচে ফিল্টার দেখাবে। ")],-1)),d[7]||(d[7]=t("p",{class:"pb-1"},"অথবা,",-1)),t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:h}," Cancel ")])]))])])):k("",!0)}},Qe={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},Xe={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90%] overflow-y-auto"},Ze={key:0,class:"text-red-600 text-sm"},et={class:"flex justify-between"},tt=["disabled"],st={__name:"AddNewMemberModal",setup(i){const e=A(),l=R();G();const s=C(""),o=C(""),c=C([]),v=C(""),u=()=>{e.openAddMemberModal=!1,a()};function a(){s.value="",o.value="",c.value=[],v.value=""}async function f(){var h;if(v.value="",((h=c.value)==null?void 0:h.length)==0){v.value="User নির্বাচন করুন।";return}e.activeConversationId&&await e.addConversationMembers(e.activeConversationId,{user_ids:c.value}),e.openAddMemberModal=!1}return z(async()=>{e.activeConversationId&&await e.fetchConversationById(e.activeConversationId)}),(h,w)=>{var b,m;return p(e).openAddMemberModal&&p(e).activeConversationId&&p(e).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((b=p(l).user)==null?void 0:b.role)?(n(),r("div",Qe,[t("div",Xe,[w[4]||(w[4]=te('<div class="flex justify-between items-center"><h2 class="text-xl text-center">Add New Members</h2><button class="bg-sky-600 text-white border-sky-600 cursor-pointer px-6 py-1 border rounded-lg transition font-bold"><i class="fas fa-users"></i> Group </button></div><hr class="mt-4">',2)),t("form",{class:"space-y-3 mt-3",onSubmit:K(f,["prevent"])},[U(J,{mode:"group","company-id":s.value,"onUpdate:companyId":w[0]||(w[0]=d=>s.value=d),"department-id":o.value,"onUpdate:departmentId":w[1]||(w[1]=d=>o.value=d),selectedUserIds:c.value,"onUpdate:selectedUserIds":w[2]||(w[2]=d=>c.value=d),alreadyAddedUserIds:((m=p(e).conversation)==null?void 0:m.user_ids)||[]},null,8,["company-id","department-id","selectedUserIds","alreadyAddedUserIds"]),v.value?(n(),r("p",Ze,I(v.value),1)):k("",!0),w[3]||(w[3]=t("hr",null,null,-1)),t("div",et,[t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:u}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:c.value.length<1}," Create ",8,tt)])],32)])])):k("",!0)}}},nt={class:"py-px text-xs md:text-sm bg-gray-300 text-black italic font-thin rounded-lg px-4 z-10"},ot={__name:"ChatMessageUnreadMarker",setup(i){const e=A(),l=C(!1),s=new Set,o=C(null);let c=null;async function v(){console.log("read calling..."),l.value=!0;try{e.activeConversationId&&await e.readAllForActiveConversation(e.activeConversationId)}catch{}finally{l.value=!1}}const u=$(()=>{var b;return((b=e.activeConversation)==null?void 0:b.id)??null}),a=$(()=>{var b,m;return(((m=(b=e.activeConversation)==null?void 0:b.unread)==null?void 0:m.count)??0)>0}),f=$(()=>{var b,m;return(((m=(b=e.activeConversation)==null?void 0:b.unread)==null?void 0:m.last_read_message_id)??0)===0});function h(){if(!o.value||c)return;const b=document.querySelector("#chatScroll")||null;c=new IntersectionObserver(m=>{const d=m[0];if(d.isIntersecting&&d.intersectionRatio>.6){const g=u.value;g&&!s.has(g)&&(s.add(g),v()),w()}},{root:b,threshold:[0,.6,1]}),c.observe(o.value)}function w(){c&&(c.disconnect(),c=null)}return L([a,u],async([b,m])=>{w(),!(!b||!m||s.has(m))&&(await H(),h())},{immediate:!0}),se(w),(b,m)=>{var d,g;return a.value?(n(),r("div",{key:0,ref_key:"bannerRef",ref:o,class:S(["relative flex justify-center items-center",f.value?"order-1":"order-3"])},[t("p",nt,I((g=(d=p(e).activeConversation)==null?void 0:d.unread)==null?void 0:g.count)+" unread message ",1),m[0]||(m[0]=t("span",{class:"absolute h-2 bg-gray-300 left-0 right-0 top-1/2 -translate-y-1/2 w-full rounded-lg"},null,-1))],2)):k("",!0)}}},at={class:"px-2 md:px-4 grid gap-4"},rt={key:0,class:"flex flex-wrap gap-x-0.5 md:gap-x-1 items-center justify-center"},lt={class:"text-xs md:text-sm"},it=["innerHTML"],dt={key:1},ct={class:"border rounded-lg max-w-lg w-full min-w-40 md:min-w-80"},ut={class:"grow w-full flex items-center gap-1"},vt={class:"font-semibold sm:inline-block text-sm line-clamp-1"},mt={class:"shrink md:shrink-0 text-[10px] md:text-xs mt-1 text-right"},pt=["innerHTML"],ft={__name:"ChatMessageCard",props:{message:{type:Object,required:!0},index:Number},setup(i){R();const e=A(),l=i,s=$(()=>l.message.is_own_message),o=$(()=>l.message.type==="system"),c=$(()=>{var a;const v=(a=e.activeConversation)==null?void 0:a.unread;if(!(v!=null&&v.count))return!1;const u=v.last_read_message_id??0;return u===0?l.index===0:l.message.id===u});return(v,u)=>{var a,f;return n(),r("div",at,[t("div",{class:S(["flex order-2",{"justify-end pl-6 md:pl-12":!o.value&&s.value,"justify-start pr-6 md:pr-12":!o.value&&!s.value,"justify-center":o.value}])},[o.value?(n(),r("div",rt,[u[0]||(u[0]=t("i",{class:"far fa-cog text-gray-700 text-xs md:text-base"},null,-1)),t("strong",lt,I(s.value?"You":(a=i.message.sender)==null?void 0:a.name),1),t("div",{innerHTML:i.message.body,class:"block text-xs md:text-sm italic whitespace-pre-wrap break-words leading-relaxed"},null,8,it)])):(n(),r("div",dt,[t("div",ct,[t("div",{class:S(["flex justify-between items-center p-1 rounded-t-lg gap-1 md:gap-4",{"bg-[#24A1DE] text-white":s.value,"bg-gray-200 text-black":!s.value}])},[t("div",ut,[U(O,{user:i.message.sender,size:"small"},null,8,["user"]),t("div",vt,I((f=i.message.sender)==null?void 0:f.name),1)]),t("div",mt,I(i.message.send_at),1)],2),t("div",{class:"block py-1 px-2 rounded-b-lg bg-white text-xs md:text-sm whitespace-pre-wrap break-words leading-relaxed",innerHTML:i.message.body},null,8,pt)]),t("div",{class:S(["flex",{"justify-end":s.value,"justify-start":!s.value}])},[t("div",{class:S(["flex flex-wrap gap-1 max-w-[280px] pt-1",{"justify-end":s.value,"justify-start":!s.value}])},[(n(!0),r(M,null,T(i.message.last_readers,h=>(n(),j(O,{key:h.id,title:h.name,user:h,size:"xsmall"},null,8,["title","user"]))),128))],2)],2)]))],2),c.value?(n(),j(ot,{key:0})):k("",!0)])}}},yt={},gt={class:"flex justify-center items-center py-4"};function xt(i,e){return n(),r("div",gt,e[0]||(e[0]=[t("i",{class:"fas fa-spinner fa-spin text-2xl text-[#24A1DE]"},null,-1)]))}const Q=ne(yt,[["render",xt]]),ht={key:1,class:"text-red-500 text-center my-4"},bt={key:2,class:"text-center text-gray-500 my-4"},_t={key:0,class:"text-xs text-gray-400 text-center py-2"},wt={__name:"ChatMessageContainer",setup(i){const e=A(),l=R(),s=C(!1),o=C(null),c=C(!0),v=C(!1);let u=null;function a(){const m=e.activeConversationId;m&&(u&&u.stopListening(".message.created"),u=window.Echo.private(`chat.${m}`).subscribed(()=>console.log(`[SUBSCRIBED] chat.${m}`)).error(d=>console.error("[CHANNEL ERROR]",d)).listen(".message.created",d=>{console.log("[EVENT]",d),e.messages.push(d.message)}))}z(async()=>{await b(),l.user||await l.fetchUser(),L(()=>e.activeConversationId,a,{immediate:!0})});const f=(m,d=80)=>m.scrollHeight-m.scrollTop-m.clientHeight<d,h=async(m="auto")=>{await H();const d=o.value;d&&(d.scrollTo({top:d.scrollHeight,behavior:m}),c.value=!0)},w=async()=>{const m=o.value;if(m&&(c.value=f(m),m.scrollTop<=0&&e.hasMore&&!v.value)){v.value=!0;const d=m.scrollHeight,g=m.scrollTop;try{await e.fetchOlderMessages(e.activeConversationId),await H();const D=m.scrollHeight;m.scrollTop=D-(d-g)}catch{}finally{v.value=!1}}},b=async()=>{s.value=!0;try{e.activeConversationId&&(await e.fetchConversationMessages(e.activeConversationId),await h("auto"))}catch{}finally{s.value=!1}};return L(()=>e.activeConversationId,async(m,d)=>{m&&m!==d&&await b()}),L(()=>e.messages.length,async(m,d)=>{const g=o.value;g&&m>d&&f(g,120)&&await h("smooth")}),$(()=>!c.value&&!!e.activeConversationId),(m,d)=>(n(),r("div",{ref_key:"scrollEl",ref:o,onScroll:w,class:S(["w-full overflow-y-auto h-[calc(100dvh-150px)] scrollbar-hide relative flex flex-col",{"items-center justify-center":!p(e).activeConversationId||p(e).error||s.value}])},[s.value?(n(),j(Q,{key:0})):k("",!0),p(e).error?(n(),r("div",ht,I(p(e).error),1)):p(e).activeConversationId?(n(),r(M,{key:3},[v.value?(n(),r("div",_t,"Loading older…")):k("",!0),(n(!0),r(M,null,T(p(e).messages,(g,D)=>(n(),j(ft,{key:g.id,message:g,class:"w-full my-4",index:D},null,8,["message","index"]))),128))],64)):(n(),r("div",bt," Please select a conversation to view messages. ")),oe(m.$slots,"default")],34))}},Ct={key:0},kt={__name:"AddNewMemberButton",setup(i){const e=A(),l=R();return(s,o)=>{var c;return p(e).activeConversationId&&p(e).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((c=p(l).user)==null?void 0:c.role)?(n(),r("div",Ct,[t("div",{class:"size-8 rounded-full text-sm border flex justify-center items-center cursor-pointer",title:"Add New Members",onClick:o[0]||(o[0]=v=>p(e).openAddMemberModal=!0)},o[1]||(o[1]=[t("i",{class:"fas fa-user-plus"},null,-1)]))])):k("",!0)}}},$t={class:"min-w-max size-8 md:size-12 flex justify-center items-center text-[#24A1DE] bg-white rounded-full overflow-hidden border"},It=["src"],Ut={key:0,class:"fas fa-users md:text-3xl"},Mt={key:1,class:"fas fa-user md:text-3xl"},X={__name:"ConversationAvatar",props:{conversation:{type:Object,required:!0}},setup(i){const e=C(!0);return(l,s)=>{var o,c;return n(),r("div",null,[t("div",$t,[(o=i.conversation)!=null&&o.avatar&&e.value?(n(),r("img",{key:0,onError:s[0]||(s[0]=v=>e.value=!1),src:(c=i.conversation)==null?void 0:c.avatar,alt:"Photo",class:"object-cover w-full h-full aspect-square"},null,40,It)):(n(),r(M,{key:1},[i.conversation.type==="group"?(n(),r("i",Ut)):(n(),r("i",Mt))],64))])])}}},St={class:"bg-[#24A1DE] border-b border-[#24A1DE] text-white h-[48px] md:h-[56px] flex items-center"},At={key:0,class:"w-full flex items-center justify-start gap-2 px-1 py-[3px]"},jt={class:"md:text-lg font-semibold line-clamp-1"},Tt={key:0,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Lt={key:1,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Dt={__name:"ConversationHeader",setup(i){const e=A();return(l,s)=>{var o,c,v;return n(),r("div",St,[(c=(o=p(e))==null?void 0:o.activeConversation)!=null&&c.id?(n(),r("div",At,[U(X,{conversation:p(e).activeConversation},null,8,["conversation"]),t("div",null,[t("h3",jt,I((v=p(e).activeConversation)==null?void 0:v.title),1),p(e).activeConversation.type==="group"?(n(),r("div",Tt,s[0]||(s[0]=[t("i",{class:"fas fa-users"},null,-1),t("i",{class:"line-clamp-1"},"Group chatting",-1)]))):(n(),r("div",Lt,s[1]||(s[1]=[t("i",{class:"fas fa-handshake"},null,-1),t("i",{class:"line-clamp-1"},"One to One chatting",-1)])))]),U(kt,{class:"ml-auto md:mr-3"})])):k("",!0)])}}},Et={class:"flex items-center gap-2 relative"},Nt=["title"],Vt=["innerHTML"],Rt={key:0,class:"absolute right-0 top-1/2 -translate-y-1/2"},zt={class:"flex justify-center items-center size-5 text-[9px] text-white rounded-full bg-red-600"},Ht={__name:"ConversationListItem",props:{conversation:{type:Object,required:!0}},setup(i){const e=A(),l=i,s=$(()=>parseInt(l.conversation.id)===parseInt(e.activeConversationId));return(o,c)=>{var u;const v=ae("RouterLink");return(u=i.conversation)!=null&&u.id?(n(),j(v,{key:0,to:`/chatting/${i.conversation.id}`,class:S(["block p-1.5 md:p-3 border-b cursor-pointer hover:bg-[#24A1DE] hover:text-white group hover:opacity-90",{"bg-[#24A1DE] text-white":s.value}]),onClick:c[0]||(c[0]=a=>p(e).showMobileConversationList=!1)},{default:Y(()=>{var a,f,h,w,b,m;return[t("div",Et,[U(X,{conversation:i.conversation},null,8,["conversation"]),t("div",{class:S([{hidden:!p(e).showMobileConversationList},"md:block"])},[t("h3",{title:i.conversation.title,class:"md:text-lg font-semibold line-clamp-1"},I(i.conversation.title),9,Nt),t("div",{class:S(["text-xs md:text-sm group-hover:text-gray-50 line-clamp-1",{"text-gray-50":s.value,"text-gray-600":!s.value,"font-bold":(f=(a=i.conversation)==null?void 0:a.unread)==null?void 0:f.count}]),innerHTML:i.conversation.subtitle},null,10,Vt)],2),(w=(h=i.conversation)==null?void 0:h.unread)!=null&&w.count?(n(),r("div",Rt,[t("span",zt,I((m=(b=i.conversation)==null?void 0:b.unread)==null?void 0:m.count),1)])):k("",!0)])]}),_:1},8,["to","class"])):k("",!0)}}},Ot={class:"flex flex-col items-center justify-center p-4 text-center text-gray-600"},Bt={__name:"ConversationNotFoundMessage",setup(i){return(e,l)=>(n(),r("div",Ot,[l[0]||(l[0]=t("i",{class:"fas fa-info-circle text-xl"},null,-1)),l[1]||(l[1]=t("p",{class:"mt-2 mb-4"},[N(" No conversations found. "),t("br"),N(" Start a new conversation! ")],-1)),U(W)]))}},Pt={class:"overflow-y-auto h-[calc(100dvh-150px)] scrollbar-hide text-blue-900 bg-white border-0"},qt={key:2,class:"p-4 text-center text-gray-500"},Ft={key:0},Gt={key:0,class:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 px-4 pt-2"},Kt={key:1,class:"p-2"},Yt=["onClick"],Wt=["src"],Jt={class:"font-medium text-gray-900"},Qt={class:"text-xs text-gray-500"},Xt={__name:"ConversationList",setup(i){const e=A(),l=C(!1);let s=null;L(()=>e.searchText,v=>{if(s&&clearTimeout(s),!v){e.searchedUsers=[];return}s=setTimeout(()=>{e.searchUsers(v)},300)});const o=async v=>{const u=e.conversations.find(a=>{var f;return a.type==="direct"&&((f=a.participants)==null?void 0:f.some(h=>h.user_id===v.id))});if(u)e.activeConversationId=u.id;else try{const a=await e.createConversation({type:"direct",user_ids:[v.id]});a&&(e.activeConversationId=a,await e.fetchUserConversations())}catch(a){console.error("Failed to create conversation",a)}e.clearSearch()},c=$(()=>{if(!e.searchedUsers||e.searchedUsers.length===0)return[];const v=e.conversations.filter(u=>u.type==="direct").flatMap(u=>{var a;return((a=u.participants)==null?void 0:a.map(f=>f.user_id))||[]});return e.searchedUsers.filter(u=>!v.includes(u.id))});return z(async()=>{l.value=!0,await e.fetchUserConversations(),l.value=!1}),(v,u)=>(n(),r("div",null,[t("div",Pt,[l.value?(n(),j(Q,{key:0})):p(e).conversations.length===0&&!p(e).searchText?(n(),j(Bt,{key:1})):p(e).searchText&&p(e).filteredConversations.length===0&&c.value.length===0?(n(),r("div",qt," No results found ")):(n(),r(M,{key:3},[p(e).filteredConversations.length>0?(n(),r("div",Ft,[p(e).searchText?(n(),r("h3",Gt,"Conversations")):k("",!0),(n(!0),r(M,null,T(p(e).filteredConversations,a=>(n(),j(Ht,{key:a.id,conversation:a},null,8,["conversation"]))),128))])):k("",!0),p(e).searchText&&c.value.length>0?(n(),r("div",Kt,[u[0]||(u[0]=t("h3",{class:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 px-2"},"People",-1)),(n(!0),r(M,null,T(c.value,a=>{var f;return n(),r("div",{key:a.id,onClick:h=>o(a),class:"flex items-center p-2 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors"},[t("img",{src:a.photo||"https://ui-avatars.com/api/?name="+a.name,class:"w-10 h-10 rounded-full object-cover mr-3",alt:""},null,8,Wt),t("div",null,[t("div",Jt,I(a.name),1),t("div",Qt,I(((f=a.designation)==null?void 0:f.title)||"Employee"),1)])],8,Yt)}),128))])):k("",!0)],64))])]))}},Zt={for:"search",class:"grow shrink relative block"},es={__name:"SearchConversation",setup(i){const e=A();return(l,s)=>(n(),r("label",Zt,[s[1]||(s[1]=t("i",{class:"fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-[#24A1DE]"},null,-1)),B(t("input",{id:"search",placeholder:"Search Conversations...",type:"search",class:"input-1 pl-10 pr-2 rounded-b-none border-none outline-[#24a0deb0] py-[11px] md:py-[15px] rounded-none rounded-tl-lg","onUpdate:modelValue":s[0]||(s[0]=o=>p(e).searchText=o)},null,512),[[P,p(e).searchText]])]))}},ts={class:"flex items-start gap-2"},ss={class:"w-full border-2 border-blue-100 rounded-xl bg-gray-100 px-1.5 pt-1.5 pb-0"},ns={__name:"SendMessageBox",setup(i){const e=A(),l=C(""),s=C(null);function o(){const u=s.value;u&&(u.style.height="auto",u.style.height=u.scrollHeight+"px")}async function c(){var f;const u=l.value.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim();if(!e.activeConversationId||!u)return;const a=await e.createConversationMessage(e.activeConversationId,{type:"text",body:u,format:"plain"});l.value="",await H(),o(),(f=e==null?void 0:e.bumpConversationToTop)==null||f.call(e,e.activeConversationId,a)}function v(u){u.isComposing||u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),c())}return z(()=>H(o)),(u,a)=>(n(),r("div",ts,[a[2]||(a[2]=t("label",{class:"hidden bg-gray-100 text-gray-600 rounded-full px-3 py-2 hover:bg-gray-500 hover:text-white cursor-pointer"},[t("input",{type:"file",class:"hidden",accept:"image/jpg,image/jpeg,image/png,image/gif,application/pdf"}),t("i",{class:"far fa-paperclip text-xl"})],-1)),t("div",ss,[B(t("textarea",{ref_key:"taRef",ref:s,"onUpdate:modelValue":a[0]||(a[0]=f=>l.value=f),onInput:o,onKeydown:v,name:"body",rows:"1",placeholder:"Write a message…",class:"w-full resize-none overflow-hidden bg-transparent outline-none leading-6 max-h-32 mb-0"},null,544),[[P,l.value]])]),t("button",{type:"button",onClick:c,class:"bg-blue-100 text-blue-600 rounded-full px-3 py-2 hover:bg-blue-600 hover:text-white"},a[1]||(a[1]=[t("i",{class:"far fa-paper-plane text-xl"},null,-1)]))]))}},os={class:"my-container"},as={class:"flex overflow-hidden border-[#24A1DE] border rounded-lg"},rs={class:"h-[48px] md:h-[56px] flex justify-center items-center border-b border-[#24A1DE] bg-white rounded-tl-lg"},ls={key:0,class:"my-8 text-center px-4 grid justify-center items-center gap-2"},vs={__name:"ChattingList",setup(i){const e=A(),l=re();return L(()=>l.params.conversationId,s=>{e.activeConversationId=s},{immediate:!0}),z(()=>{e.showMobileConversationList=!l.params.conversationId}),(s,o)=>(n(),r(M,null,[t("div",os,[t("div",as,[t("div",{class:S(["min-w-11 md:block grow-0 shrink-0 md:w-[280px] lg:w-[360px] xl:w-[400px] rounded-l-lg",{"w-full":p(e).showMobileConversationList}])},[t("div",rs,[t("div",{onClick:o[0]||(o[0]=c=>p(e).showMobileConversationList=!0),class:S(["md:hidden flex justify-center items-center text-2xl text-[#24A1DE]",{hidden:p(e).showMobileConversationList}])},o[1]||(o[1]=[t("i",{class:"fas fa-bars"},null,-1)]),2),t("div",{class:S([p(e).showMobileConversationList?"flex":"hidden","w-full md:flex items-center justify-between"])},[U(es),U(W)],2)]),U(Xt)],2),t("div",{class:S(["md:block relative grow shrink border-l rounded-r-lg overflow-hidden bg-gray-100 border-[#24A1DE]",{hidden:p(e).showMobileConversationList}])},[p(e).activeConversationId?(n(),r(M,{key:1},[U(Dt),U(wt,null,{default:Y(()=>[U(ns,{class:"bg-white border-t border-[#24A1DE] sticky bottom-0 mt-auto z-10 w-full p-2"})]),_:1})],64)):(n(),r("div",ls,o[2]||(o[2]=[t("i",{class:"fad text-blue-600 fa-info-circle text-4xl md:text-7xl"},null,-1),t("p",{class:"text-gray-500 md:text-4xl"},[N(" Select a conversation "),t("br"),N(" to start chatting ")],-1)])))],2)])]),U(Je),p(e).openAddMemberModal?(n(),j(st,{key:0})):k("",!0)],64))}};export{vs as default};
