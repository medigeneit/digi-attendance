import{r as c,d as W,e as $,z,n as Y,c as l,o as r,a as t,f as G,g as u,h as k,v as C,p as V,k as b,t as v,F as y,j as M,B as E,q as w,w as I}from"./index-BkfYvf6a.js";import{a as L}from"./datetime-q3Sn87-f.js";import{u as H}from"./company-Dn98aD6b.js";import{u as J}from"./tags-G-9As9ks.js";import{u as K}from"./useTaskStore-BORWN_xB.js";import{S as P}from"./SectionLoading-DGpQHMJO.js";import{_ as Q}from"./MultiselectDropdown-BOozf-mx.js";const X={class:"px-4 max-h-[90vh] overflow-auto"},Z={class:"sticky top-0 pt-4 -mx-4 px-4 border-b bg-white rounded-t-md"},D={key:0,class:"text-center py-4 text-gray-500"},ee={class:"mb-4"},te={class:"mb-4"},se={key:0,class:"mb-4"},oe={class:"mb-4"},re={class:"block text-gray-600 text-sm mb-1 font-medium"},le=["label"],ae=["value"],ie={class:"mb-4"},ne={class:"block text-gray-600 text-sm mb-1 font-medium"},de=["label"],ue=["value"],me={class:"mb-4"},pe={class:"sticky bottom-0 bg-white py-4 border-t"},ce={key:0,class:"mb-4 text-red-500 font-medium"},be={key:1,class:"mb-4"},ve={class:"flex items-center gap-4 justify-between"},fe=["disabled"],ge={key:0,class:"text-red-500 text-sm"},Se={__name:"TaskEditForm",props:{taskId:{type:[String,Number],required:!0}},emits:["updated","cancel"],setup(R,{emit:j}){const q=R,F=j,f=K(),x=c([]),U=J(),A=W(),h=H(),i=c(),n=c(!1),T=c([]),S=c(""),a=c({});$(async()=>{var s,e;n.value=!0,U.fetchTags("website"),i.value=(s=await f.fetchTask(q.taskId,{},{fetchOnly:!0,loadingBeforeFetch:!1}))==null?void 0:s.task,await h.fetchCompanies({with:"departments",ignore_permission:!0}),B(i.value),x.value=((e=i.value)==null?void 0:e.website_tags)||[],T.value=i.value.users,n.value=!1}),z(()=>i.value,s=>{B(s),T.value=s.users});function B(s){var e;a.value={title:s.title,description:s.description,requirement_id:s.requirement_id,from_department_id:s.from_department_id,to_department_id:s.to_department_id,...((e=A.user)==null?void 0:e.role)!=="employee"?{is_important:s.is_important,is_urgent:s.is_urgent,is_target:s.is_target,started_at:L(s.started_at),deadline:L(s.deadline)}:{}}}const O=async()=>{var s,e,g,_;n.value=!0;try{const m={...a.value,user_ids:((s=T.value)==null?void 0:s.map(p=>Number(p.id)))||[],website_tags:((e=x.value)==null?void 0:e.map(p=>Number(p.id)))||[]};await f.updateTask(q.taskId,m,{loadingBeforeFetch:!1}),F("updated")}catch(m){S.value=((_=(g=m.response)==null?void 0:g.data)==null?void 0:_.message)||"An error occurred while updating the task."}finally{n.value=!1}};return(s,e)=>{var _,m,p,N;const g=Y("RequiredIcon");return r(),l("div",X,[t("div",Z,[e[6]||(e[6]=t("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Edit Task",-1)),n.value?(r(),l("div",D,"Loading form...")):u("",!0)]),t("form",{onSubmit:I(O,["prevent"]),class:"my-4"},[t("div",ee,[e[7]||(e[7]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task Title",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.title=o),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,a.value.title]])]),t("div",te,[e[8]||(e[8]=t("label",{class:"text-gray-800"},"Websites",-1)),V(Q,{options:b(U).tags,multiple:!0,modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=o=>x.value=o),label:"name","track-by":"id"},null,8,["options","modelValue"])]),(_=i.value)!=null&&_.requirement?(r(),l("div",se,[e[9]||(e[9]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Requirement",-1)),t("div",null,[t("p",null,v((p=(m=i.value)==null?void 0:m.requirement)==null?void 0:p.title),1)])])):u("",!0),((N=i.value)==null?void 0:N.parent_id)===0?(r(),l(y,{key:1},[t("div",oe,[t("label",re,[e[10]||(e[10]=M(" From Department ")),V(g)]),k(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.from_department_id=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[11]||(e[11]=t("option",{value:""},"--select department--",-1)),(r(!0),l(y,null,w(b(h).companies,o=>(r(),l("optgroup",{key:o.id,label:o.name},[(r(!0),l(y,null,w(o.departments,d=>(r(),l("option",{value:d.id,key:d.id},v(d.name),9,ae))),128))],8,le))),128))],512),[[E,a.value.from_department_id]])]),t("div",ie,[t("label",ne,[e[12]||(e[12]=M(" To Department ")),V(g)]),k(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.to_department_id=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[13]||(e[13]=t("option",{value:""},"--select department--",-1)),(r(!0),l(y,null,w(b(h).companies,o=>(r(),l("optgroup",{key:o.id,label:o.name},[(r(!0),l(y,null,w(o.departments,d=>(r(),l("option",{value:d.id,key:d.id},v(d.name),9,ue))),128))],8,de))),128))],512),[[E,a.value.to_department_id]])])],64)):u("",!0),t("div",me,[e[14]||(e[14]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Description",-1)),k(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.description=o),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,a.value.description]])]),t("div",pe,[b(f).error?(r(),l("div",ce,v(b(f).error),1)):u("",!0),b(f).error?(r(),l("hr",be)):u("",!0),t("div",ve,[t("button",{type:"button",onClick:e[5]||(e[5]=I(o=>F("close"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),t("button",{disabled:n.value,type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-semibold px-5 py-2 rounded transition"},v(n.value?"Updating...":"Update Task"),9,fe),S.value?(r(),l("div",ge,v(S.value),1)):u("",!0)])])],32),n.value?(r(),G(P,{key:0})):u("",!0)])}}};export{Se as _};
