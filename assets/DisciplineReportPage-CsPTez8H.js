import{_ as Q,c as r,o,a as t,N as ut,k as w,b as Y,t as y,F as A,e as U,r as C,s as st,E as ct,x as T,q as H,l as R,v as G,ae as pt,d as L,g as kt,p as Ct,m as K,f as At,u as It,D as St,j as ft,G as vt,n as J}from"./index-CVXK1MwV.js";import{L as Mt}from"./LoaderView-DXUYLVRI.js";import{_ as Ut}from"./PaginationBar-CPz4a_r-.js";import{_ as Nt}from"./SearchInput-BjN2zn9Y.js";import{_ as Lt}from"./EmployeeFilter-q0EOa_hJ.js";import{u as lt,_ as Ft}from"./LetterEditor-DsHa-AiS.js";import"./company-CHgYY0UX.js";import"./department-CB8wa74M.js";import"./EmployeeDropdownInput-DyFJU9bw.js";import"./SelectDropdown-DhBAlHt0.js";import"./UserChip-BsQDMkvJ.js";import"./user-k0e5Ubju.js";import"./TextEditor-Dqa0K0UY.js";const jt={class:"month-cell"},Vt={class:"month-cell__header"},Dt={class:"month-cell__body"},Tt={__name:"MonthCell",props:{showAdd:{type:Boolean,default:!0},addLabel:{type:String,default:"Add"}},emits:["add"],setup(b){return(h,n)=>(o(),r("div",jt,[t("div",Vt,[ut(h.$slots,"header",{},void 0,!0),b.showAdd?(o(),r("button",{key:0,type:"button",class:"month-cell__add",onClick:n[0]||(n[0]=c=>h.$emit("add"))},[n[1]||(n[1]=t("i",{class:"far fa-plus"},null,-1)),Y(" "+y(b.addLabel),1)])):w("",!0)]),t("div",Dt,[ut(h.$slots,"default",{},void 0,!0)])]))}},dt=Q(Tt,[["__scopeId","data-v-27298107"]]),Et={class:"space-y-1"},Rt={class:"truncate"},Ot={class:"truncate"},qt={class:"list-actions"},Pt=["onClick"],Bt=["onClick"],Yt={key:0,class:"empty"},zt={__name:"IndisciplineList",props:{autoItems:{type:Array,default:()=>[]},manualItems:{type:Array,default:()=>[]}},emits:["edit","delete"],setup(b){const h=n=>(n==null?void 0:n.title)||(n==null?void 0:n.reason)||(n==null?void 0:n.note)||(n==null?void 0:n.label)||(n==null?void 0:n.text)||(n==null?void 0:n.description)||"Untitled";return(n,c)=>(o(),r("div",Et,[(o(!0),r(A,null,U(b.autoItems,f=>(o(),r("div",{key:`auto-${(f==null?void 0:f.id)||(f==null?void 0:f.key)||h(f)}`,class:"list-item list-item--locked"},[c[0]||(c[0]=t("i",{class:"far fa-lock text-[11px]"},null,-1)),t("span",Rt,y(h(f)),1)]))),128)),(o(!0),r(A,null,U(b.manualItems,f=>(o(),r("div",{key:`manual-${(f==null?void 0:f.id)||h(f)}`,class:"list-item"},[t("span",Ot,y(h(f)),1),t("div",qt,[t("button",{type:"button",class:"list-action list-action--edit",onClick:v=>n.$emit("edit",f)},c[1]||(c[1]=[t("i",{class:"far fa-pen"},null,-1)]),8,Pt),t("button",{type:"button",class:"list-action list-action--delete",onClick:v=>n.$emit("delete",f)},c[2]||(c[2]=[t("i",{class:"far fa-trash"},null,-1)]),8,Bt)])]))),128)),b.autoItems.length===0&&b.manualItems.length===0?(o(),r("p",Yt," No items ")):w("",!0)]))}},Gt=Q(zt,[["__scopeId","data-v-84ff40e5"]]),Ht={class:"space-y-1"},Qt={class:"flex items-center gap-2"},Wt={class:"truncate"},Jt={key:0,class:"badge"},Kt={class:"truncate"},Xt={class:"list-actions"},Zt=["onClick"],te=["onClick"],ee={key:0,class:"empty"},se={__name:"ActionList",props:{autoItems:{type:Array,default:()=>[]},manualItems:{type:Array,default:()=>[]}},emits:["edit","delete"],setup(b){const h=c=>(c==null?void 0:c.title)||(c==null?void 0:c.reason)||(c==null?void 0:c.note)||(c==null?void 0:c.label)||(c==null?void 0:c.text)||(c==null?void 0:c.description)||"Untitled",n=c=>(c==null?void 0:c.hours)||(c==null?void 0:c.pay_hours)||(c==null?void 0:c.paycut_hours)||(c==null?void 0:c.pay_hours_text);return(c,f)=>(o(),r("div",Ht,[(o(!0),r(A,null,U(b.autoItems,v=>(o(),r("div",{key:`auto-${(v==null?void 0:v.id)||h(v)}`,class:"list-item list-item--locked"},[t("div",Qt,[f[0]||(f[0]=t("i",{class:"far fa-lock text-[11px]"},null,-1)),t("span",Wt,y((v==null?void 0:v.label)||"Paycut applied"),1)]),n(v)?(o(),r("span",Jt,y(n(v))+"h",1)):w("",!0)]))),128)),(o(!0),r(A,null,U(b.manualItems,v=>(o(),r("div",{key:`manual-${(v==null?void 0:v.id)||h(v)}`,class:"list-item"},[t("span",Kt,y(h(v)),1),t("div",Xt,[t("button",{type:"button",class:"list-action list-action--edit",onClick:p=>c.$emit("edit",v)},f[1]||(f[1]=[t("i",{class:"far fa-pen"},null,-1)]),8,Zt),t("button",{type:"button",class:"list-action list-action--delete",onClick:p=>c.$emit("delete",v)},f[2]||(f[2]=[t("i",{class:"far fa-trash"},null,-1)]),8,te)])]))),128)),b.autoItems.length===0&&b.manualItems.length===0?(o(),r("p",ee," No items ")):w("",!0)]))}},le=Q(se,[["__scopeId","data-v-88bb90ee"]]),ne={class:"flex items-center justify-between gap-2 rounded-md border border-slate-100 bg-white/80 px-2 py-1 text-[11px] text-slate-700"},ae={class:"font-semibold text-slate-600"},oe={__name:"AttachmentCell",props:{count:{type:Number,default:0}},emits:["view"],setup(b){return(h,n)=>(o(),r("div",ne,[t("span",ae,y(b.count),1),t("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:n[0]||(n[0]=c=>h.$emit("view"))},n[1]||(n[1]=[t("i",{class:"far fa-eye"},null,-1),Y(" View ")]))]))}},de={class:"flex items-center justify-center gap-1"},re=["onClick"],ie={__name:"FinalOutcomeCell",props:{userId:{type:[Number,String],required:!0},year:{type:Number,required:!0},value:{type:[Number,String],default:0},disabled:{type:Boolean,default:!1}},setup(b){const h=b,n=lt(),c=C(!1),f=async v=>{if(!(h.disabled||c.value)){c.value=!0;try{await n.updateFinalScore({user_id:h.userId,year:h.year,score:v})}catch(p){console.error("Failed to update final outcome:",p)}finally{c.value=!1}}};return(v,p)=>(o(),r("div",de,[(o(),r(A,null,U(5,x=>t("button",{key:x,type:"button",class:st(["score-dot",{"score-dot--active":Number(b.value)===x,"score-dot--disabled":b.disabled}]),onClick:N=>f(x)},y(x),11,re)),64))]))}},ue=Q(ie,[["__scopeId","data-v-b8d56759"]]),ce={key:0,class:"fixed inset-0 z-[1200] flex items-center justify-center bg-slate-900/40"},pe={class:"w-full max-w-4xl rounded-2xl border border-slate-100 bg-white shadow-xl"},fe={class:"flex items-center justify-between border-b border-slate-100 px-5 py-3"},ve={class:"text-lg font-semibold text-slate-800"},xe={class:"text-xs text-slate-500"},be={class:"flex items-center gap-2 border-b border-slate-100 px-5 py-3"},_e={class:"max-h-[70vh] overflow-auto px-5 py-4"},ye={key:0,class:"grid gap-4 md:grid-cols-[1.1fr_1fr]"},he={class:"space-y-3"},ge={class:"space-y-2"},me={class:"flex items-center gap-2"},$e=["disabled"],we={class:"space-y-2"},ke={class:"space-y-2"},Ce={class:"flex items-start justify-between gap-2"},Ae={class:"text-xs font-semibold text-slate-700"},Ie={key:0,class:"text-[11px] text-slate-500"},Se={class:"flex items-center gap-1"},Me=["onClick"],Ue=["onClick"],Ne={key:0,class:"text-xs text-slate-400"},Le={key:1,class:"grid gap-4 md:grid-cols-[1.1fr_1fr]"},Fe={class:"space-y-3"},je={class:"space-y-2"},Ve={class:"flex items-center gap-2"},De=["disabled"],Te={class:"space-y-2"},Ee={class:"space-y-2"},Re={class:"flex items-start justify-between gap-2"},Oe={class:"text-xs font-semibold text-slate-700"},qe={key:0,class:"text-[11px] text-slate-500"},Pe={class:"flex items-center gap-1"},Be=["onClick"],Ye=["onClick"],ze={key:0,class:"text-xs text-slate-400"},Ge={key:2,class:"space-y-4"},He={class:"flex flex-wrap items-center gap-4"},Qe={class:"flex items-center gap-2 text-xs font-semibold text-slate-600"},We={class:"flex items-center gap-2 text-xs font-semibold text-slate-600"},Je={key:0,class:"grid gap-3 md:grid-cols-[1fr_auto]"},Ke={class:"space-y-2"},Xe=["disabled"],Ze={key:1,class:"space-y-3"},ts={class:"flex justify-end"},es=["disabled"],ss={class:"space-y-2"},ls={class:"space-y-2"},ns={class:"text-xs font-semibold text-slate-700"},as={class:"text-[11px] text-slate-500"},os={key:0,class:"text-xs text-slate-400"},ds={__name:"MonthModal",props:{open:{type:Boolean,default:!1},user:{type:Object,default:null},year:{type:Number,default:new Date().getFullYear()},monthStart:{type:String,default:""},record:{type:Object,default:null},initialTab:{type:String,default:"indiscipline"},editItem:{type:Object,default:null},editType:{type:String,default:""}},emits:["close"],setup(b,{emit:h}){const n=b,c=h,f=lt(),v=C(n.initialTab||"indiscipline"),p=C(!1),x=ct({id:null,title:"",note:""}),N=C("file"),I=C(""),E=C(null),$=ct({title:"",body_html:""}),i=T(()=>{var u,l;return((u=n.user)==null?void 0:u.id)||((l=n.user)==null?void 0:l.user_id)}),m=T(()=>{var u,l;return((u=n.record)==null?void 0:u.id)||((l=n.record)==null?void 0:l.month_record_id)}),F=T(()=>{var u,l,k;return((u=n.record)==null?void 0:u.manual_indisciplines)||((l=n.record)==null?void 0:l.indisciplines)||((k=n.record)==null?void 0:k.manualIndisciplines)||[]}),j=T(()=>{var u,l,k;return((u=n.record)==null?void 0:u.manual_actions)||((l=n.record)==null?void 0:l.actions)||((k=n.record)==null?void 0:k.manualActions)||[]}),V=T(()=>{var k,B,a,q,tt,et;const u=((k=n.record)==null?void 0:k.attachments)||((B=n.record)==null?void 0:B.attachment_files)||((a=n.record)==null?void 0:a.files)||[],l=((q=n.record)==null?void 0:q.letters)||((tt=n.record)==null?void 0:tt.text_letters)||((et=n.record)==null?void 0:et.letter_attachments)||[];return[...u.map(z=>({...z,_type:"file"})),...l.map(z=>({...z,_type:"letter"}))]}),S=u=>(u==null?void 0:u.title)||(u==null?void 0:u.reason)||(u==null?void 0:u.note)||(u==null?void 0:u.label)||(u==null?void 0:u.text)||(u==null?void 0:u.description)||"Untitled",D=()=>{x.id=null,x.title="",x.note=""},_=(u,l)=>{v.value=u,x.id=(l==null?void 0:l.id)||null,x.title=(l==null?void 0:l.title)||(l==null?void 0:l.reason)||(l==null?void 0:l.label)||"",x.note=(l==null?void 0:l.note)||(l==null?void 0:l.description)||""};H(()=>n.open,async u=>{u&&(v.value=n.initialTab||"indiscipline",D(),N.value="file",I.value="",E.value=null,$.title="",$.body_html="",i.value&&n.monthStart&&await f.ensureMonthRecord(i.value,n.year,n.monthStart),n.editItem&&_(n.editType||v.value,n.editItem))}),H(()=>n.initialTab,u=>{n.open&&u&&(v.value=u)}),H(()=>n.editItem,u=>{n.open&&u&&_(n.editType||v.value,u)}),H(v,()=>{x.id||D()});const P=async()=>{if(!x.title&&!x.note||!i.value||!n.monthStart)return;p.value=!0;const u={user_id:i.value,year:n.year,month_start:n.monthStart,title:x.title,note:x.note};m.value&&(u.month_record_id=m.value);try{v.value==="indiscipline"?x.id?await f.updateManualIndiscipline(x.id,{title:x.title,note:x.note},{user_id:i.value,month_start:n.monthStart}):await f.createManualIndiscipline(u):x.id?await f.updateManualAction(x.id,{title:x.title,note:x.note},{user_id:i.value,month_start:n.monthStart}):await f.createManualAction(u),D()}catch(l){console.error("Failed to save manual item:",l)}finally{p.value=!1}},X=async(u,l)=>{l!=null&&l.id&&confirm("Delete this item?")&&(u==="indiscipline"?await f.deleteManualIndiscipline(l.id,{month_start:n.monthStart}):await f.deleteManualAction(l.id,{month_start:n.monthStart}))},nt=u=>{var k;const l=(k=u.target.files)==null?void 0:k[0];E.value=l||null},O=async()=>{if(!(!E.value||!i.value||!n.monthStart)){p.value=!0;try{await f.uploadAttachment({file:E.value,title:I.value,user_id:i.value,month_start:n.monthStart,year:n.year}),E.value=null,I.value=""}catch(u){console.error("Failed to upload attachment:",u)}finally{p.value=!1}}},Z=async()=>{if(!(!$.title||!$.body_html)&&!(!i.value||!n.monthStart)){p.value=!0;try{await f.createLetter({title:$.title,body_html:$.body_html,user_id:i.value,month_start:n.monthStart,year:n.year}),$.title="",$.body_html=""}catch(u){console.error("Failed to save letter:",u)}finally{p.value=!1}}};return(u,l)=>{var k,B;return b.open?(o(),r("div",ce,[t("div",pe,[t("div",fe,[t("div",null,[l[13]||(l[13]=t("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Month Record",-1)),t("h3",ve,y(((k=b.user)==null?void 0:k.name)||((B=b.user)==null?void 0:B.user)||"Employee"),1),t("p",xe,y(b.monthStart),1)]),t("button",{type:"button",class:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50",onClick:l[0]||(l[0]=a=>c("close"))},l[14]||(l[14]=[t("i",{class:"far fa-times"},null,-1)]))]),t("div",be,[t("button",{type:"button",class:st(["tab-btn",{"tab-btn--active":v.value==="indiscipline"}]),onClick:l[1]||(l[1]=a=>v.value="indiscipline")}," Indiscipline ",2),t("button",{type:"button",class:st(["tab-btn",{"tab-btn--active":v.value==="action"}]),onClick:l[2]||(l[2]=a=>v.value="action")}," Action ",2),t("button",{type:"button",class:st(["tab-btn",{"tab-btn--active":v.value==="attachment"}]),onClick:l[3]||(l[3]=a=>v.value="attachment")}," Attachment / Letter ",2)]),t("div",_e,[v.value==="indiscipline"?(o(),r("div",ye,[t("div",he,[l[15]||(l[15]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Manual Indiscipline",-1)),t("div",ge,[R(t("input",{"onUpdate:modelValue":l[4]||(l[4]=a=>x.title=a),type:"text",placeholder:"Title",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[G,x.title]]),R(t("textarea",{"onUpdate:modelValue":l[5]||(l[5]=a=>x.note=a),rows:"3",placeholder:"Notes",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[G,x.note]]),t("div",me,[t("button",{type:"button",class:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white",disabled:p.value,onClick:P},y(x.id?"Update":"Save"),9,$e),x.id?(o(),r("button",{key:0,type:"button",class:"rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-600",onClick:D}," Cancel ")):w("",!0)])])]),t("div",we,[l[18]||(l[18]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Existing Manual Items",-1)),t("div",ke,[(o(!0),r(A,null,U(F.value,a=>(o(),r("div",{key:(a==null?void 0:a.id)||S(a),class:"rounded-lg border border-slate-100 bg-slate-50/70 p-2"},[t("div",Ce,[t("div",null,[t("p",Ae,y(S(a)),1),a!=null&&a.note||a!=null&&a.description?(o(),r("p",Ie,y((a==null?void 0:a.note)||(a==null?void 0:a.description)),1)):w("",!0)]),t("div",Se,[t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-full text-slate-500 hover:bg-white",onClick:q=>_("indiscipline",a)},l[16]||(l[16]=[t("i",{class:"far fa-pen text-[11px]"},null,-1)]),8,Me),t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-full text-rose-500 hover:bg-white",onClick:q=>X("indiscipline",a)},l[17]||(l[17]=[t("i",{class:"far fa-trash text-[11px]"},null,-1)]),8,Ue)])])]))),128)),F.value.length===0?(o(),r("p",Ne," No manual indiscipline items yet. ")):w("",!0)])])])):v.value==="action"?(o(),r("div",Le,[t("div",Fe,[l[19]||(l[19]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Manual Action",-1)),t("div",je,[R(t("input",{"onUpdate:modelValue":l[6]||(l[6]=a=>x.title=a),type:"text",placeholder:"Title",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[G,x.title]]),R(t("textarea",{"onUpdate:modelValue":l[7]||(l[7]=a=>x.note=a),rows:"3",placeholder:"Notes",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[G,x.note]]),t("div",Ve,[t("button",{type:"button",class:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white",disabled:p.value,onClick:P},y(x.id?"Update":"Save"),9,De),x.id?(o(),r("button",{key:0,type:"button",class:"rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-600",onClick:D}," Cancel ")):w("",!0)])])]),t("div",Te,[l[22]||(l[22]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Existing Manual Actions",-1)),t("div",Ee,[(o(!0),r(A,null,U(j.value,a=>(o(),r("div",{key:(a==null?void 0:a.id)||S(a),class:"rounded-lg border border-slate-100 bg-slate-50/70 p-2"},[t("div",Re,[t("div",null,[t("p",Oe,y(S(a)),1),a!=null&&a.note||a!=null&&a.description?(o(),r("p",qe,y((a==null?void 0:a.note)||(a==null?void 0:a.description)),1)):w("",!0)]),t("div",Pe,[t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-full text-slate-500 hover:bg-white",onClick:q=>_("action",a)},l[20]||(l[20]=[t("i",{class:"far fa-pen text-[11px]"},null,-1)]),8,Be),t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-full text-rose-500 hover:bg-white",onClick:q=>X("action",a)},l[21]||(l[21]=[t("i",{class:"far fa-trash text-[11px]"},null,-1)]),8,Ye)])])]))),128)),j.value.length===0?(o(),r("p",ze," No manual actions yet. ")):w("",!0)])])])):(o(),r("div",Ge,[t("div",He,[t("label",Qe,[R(t("input",{type:"radio",class:"text-slate-700",value:"file","onUpdate:modelValue":l[8]||(l[8]=a=>N.value=a)},null,512),[[pt,N.value]]),l[23]||(l[23]=Y(" File Upload "))]),t("label",We,[R(t("input",{type:"radio",class:"text-slate-700",value:"letter","onUpdate:modelValue":l[9]||(l[9]=a=>N.value=a)},null,512),[[pt,N.value]]),l[24]||(l[24]=Y(" Write Letter "))])]),N.value==="file"?(o(),r("div",Je,[t("div",Ke,[R(t("input",{"onUpdate:modelValue":l[10]||(l[10]=a=>I.value=a),type:"text",placeholder:"Attachment title (optional)",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[G,I.value]]),t("input",{type:"file",class:"w-full rounded-lg border border-dashed border-slate-300 px-3 py-2 text-sm",onChange:nt},null,32)]),t("button",{type:"button",class:"h-10 rounded-full bg-slate-900 px-4 text-xs font-semibold text-white",disabled:p.value||!E.value,onClick:O}," Upload ",8,Xe)])):(o(),r("div",Ze,[R(t("input",{"onUpdate:modelValue":l[11]||(l[11]=a=>$.title=a),type:"text",placeholder:"Letter title",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[G,$.title]]),L(Ft,{modelValue:$.body_html,"onUpdate:modelValue":l[12]||(l[12]=a=>$.body_html=a)},null,8,["modelValue"]),t("div",ts,[t("button",{type:"button",class:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white",disabled:p.value||!$.title||!$.body_html,onClick:Z}," Save Letter ",8,es)])])),t("div",ss,[l[25]||(l[25]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Existing Attachments",-1)),t("div",ls,[(o(!0),r(A,null,U(V.value,a=>(o(),r("div",{key:(a==null?void 0:a.id)||S(a),class:"rounded-lg border border-slate-100 bg-slate-50/70 p-2"},[t("p",ns,y(S(a)),1),t("p",as,y(a._type==="letter"?"Letter":"File"),1)]))),128)),V.value.length===0?(o(),r("p",os," No attachments added yet. ")):w("",!0)])])]))])])])):w("",!0)}}},rs=Q(ds,[["__scopeId","data-v-a2fe727b"]]),is={key:0,class:"fixed inset-0 z-[1200] flex items-center justify-center bg-slate-900/40"},us={class:"w-full max-w-3xl rounded-2xl border border-slate-100 bg-white shadow-xl"},cs={class:"flex items-center justify-between border-b border-slate-100 px-5 py-3"},ps={class:"text-lg font-semibold text-slate-800"},fs={class:"text-xs text-slate-500"},vs={class:"max-h-[60vh] space-y-3 overflow-auto px-5 py-4"},xs={class:"flex items-start justify-between gap-3"},bs={class:"text-sm font-semibold text-slate-800"},_s={class:"text-[11px] uppercase tracking-wide text-slate-400"},ys={class:"flex items-center gap-2"},hs=["href"],gs=["onClick"],ms={key:0,class:"mt-2 text-xs text-slate-600"},$s={key:0,class:"text-sm text-slate-500"},ws={class:"flex items-center justify-end border-t border-slate-100 px-5 py-3"},ks={__name:"AttachmentModal",props:{open:{type:Boolean,default:!1},attachments:{type:Array,default:()=>[]},user:{type:Object,default:null},monthStart:{type:String,default:""},year:{type:Number,default:new Date().getFullYear()}},emits:["close"],setup(b,{emit:h}){const n=b,c=h,f=kt(),v=lt(),p=T(()=>{var F,j;const i=String(((F=f.user)==null?void 0:F.role)||"").toLowerCase(),m=(((j=f.user)==null?void 0:j.roles)||[]).map(V=>String(V).toLowerCase());return["admin","super_admin","developer","hr"].includes(i)||m.includes("hr")}),x=i=>(i==null?void 0:i.title)||(i==null?void 0:i.name)||(i==null?void 0:i.file_name)||(i==null?void 0:i.original_name)||(i==null?void 0:i.filename)||"Attachment",N=i=>(i==null?void 0:i.url)||(i==null?void 0:i.file_url)||(i==null?void 0:i.download_url)||(i==null?void 0:i.path)||"",I=i=>{const m=String((i==null?void 0:i.type)||(i==null?void 0:i.attachment_type)||"").toLowerCase();return m==="letter"||m==="text"},E=i=>String(i||"").replace(/<[^>]*>/g,"").trim(),$=async i=>{p.value&&confirm("Delete this attachment?")&&await v.deleteAttachment(i.id,{month_start:n.monthStart})};return(i,m)=>{var j,V,S,D;const F=Ct("router-link");return b.open?(o(),r("div",is,[t("div",us,[t("div",cs,[t("div",null,[m[1]||(m[1]=t("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Attachments",-1)),t("h3",ps,y(((j=b.user)==null?void 0:j.name)||((V=b.user)==null?void 0:V.user)||"Employee"),1),t("p",fs,y(b.monthStart),1)]),t("button",{type:"button",class:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50",onClick:m[0]||(m[0]=_=>c("close"))},m[2]||(m[2]=[t("i",{class:"far fa-times"},null,-1)]))]),t("div",vs,[(o(!0),r(A,null,U(b.attachments,_=>(o(),r("div",{key:(_==null?void 0:_.id)||x(_),class:"rounded-xl border border-slate-100 bg-slate-50/60 p-3"},[t("div",xs,[t("div",null,[t("p",bs,y(x(_)),1),t("p",_s,y(I(_)?"Letter":"File"),1)]),t("div",ys,[!I(_)&&N(_)?(o(),r("a",{key:0,href:N(_),target:"_blank",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-600 hover:text-slate-800"},m[3]||(m[3]=[t("i",{class:"far fa-arrow-up-right-from-square"},null,-1),Y(" Open ")]),8,hs)):w("",!0),p.value?(o(),r("button",{key:1,type:"button",class:"inline-flex items-center gap-1 rounded-full border border-rose-200 bg-rose-50 px-2 py-0.5 text-[10px] font-semibold text-rose-600 hover:text-rose-700",onClick:P=>$(_)},m[4]||(m[4]=[t("i",{class:"far fa-trash"},null,-1),Y(" Delete ")]),8,gs)):w("",!0)])]),I(_)?(o(),r("p",ms,y(E((_==null?void 0:_.body_html)||(_==null?void 0:_.body)||(_==null?void 0:_.content)).slice(0,180)),1)):w("",!0)]))),128)),b.attachments.length===0?(o(),r("p",$s," No attachments yet. ")):w("",!0)]),t("div",ws,[L(F,{to:{name:"DisciplineAttachments",query:{user_id:((S=b.user)==null?void 0:S.id)||((D=b.user)==null?void 0:D.user_id),month_start:b.monthStart,year:b.year}},class:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-600 hover:text-slate-800"},{default:K(()=>m[5]||(m[5]=[Y(" Open Full Page "),t("i",{class:"far fa-arrow-up-right-from-square text-[10px]"},null,-1)])),_:1,__:[5]},8,["to"])])])])):w("",!0)}}},Cs={class:"px-4 space-y-5"},As={class:"glass-panel flex flex-col gap-3 px-5 py-4 md:flex-row md:items-center md:justify-between"},Is={class:"text-xs font-semibold text-slate-500"},Ss={class:"glass-panel space-y-3 px-5 py-4"},Ms={class:"flex items-center gap-2"},Us=["value"],Ns={class:"flex flex-wrap items-center gap-3"},Ls={class:"min-w-[220px]"},Fs={class:"flex items-center gap-2"},js={key:1,class:"table-shell"},Vs={key:0,class:"empty-state"},Ds={key:1,class:"table-scroll"},Ts={class:"min-w-full table-fixed border-collapse"},Es={class:"sticky top-0 z-30 bg-slate-50"},Rs={class:"td sticky-col"},Os={class:"space-y-1"},qs={class:"text-sm font-semibold text-slate-800"},Ps={class:"text-[11px] text-slate-500"},Bs={class:"td min-w-[220px]"},Ys={class:"td min-w-[220px]"},zs={class:"td min-w-[200px]"},Gs={class:"td min-w-[140px] text-center"},Hs={__name:"DisciplineReportPage",setup(b){const h=lt(),n=At(),c=It(),f=n.query,v=new Date().getFullYear(),p=C({company_id:f.company_id||"",department_id:f.department_id==="all"?"":f.department_id||"",line_type:f.line_type||"all",employee_id:f.employee_id||"",year:Number(f.year)||v,search:f.search||"",page:Number(f.page)||1,per_page:Number(f.per_page)||25}),{users:x,months:N,pagination:I,loading:E}=St(h),$=C(!1),i=C(!1),m=C(null),F=C(""),j=C("indiscipline"),V=C(null),S=C(""),D=C(null),_=C(""),P=e=>(e==null?void 0:e.id)||(e==null?void 0:e.user_id),X=e=>(e==null?void 0:e.name)||(e==null?void 0:e.user)||(e==null?void 0:e.employee_name)||(e==null?void 0:e.full_name)||"Employee",nt=e=>{var s;return(e==null?void 0:e.designation)||((s=e==null?void 0:e.department)==null?void 0:s.name)||(e==null?void 0:e.dept)||(e==null?void 0:e.department_name)||""},O=(e,s)=>{var d;return((d=e==null?void 0:e._monthMap)==null?void 0:d[s])||null},Z=e=>e?Array.isArray(e.paycuts)?e.paycuts:e.paycut?[e.paycut]:[]:[],u=e=>Z(e).map(s=>({id:(s==null?void 0:s.id)||(s==null?void 0:s.paycut_id)||`paycut-${(s==null?void 0:s.reason)||""}`,reason:(s==null?void 0:s.reason)||"Paycut applied"})),l=e=>Z(e).map(s=>({id:(s==null?void 0:s.id)||(s==null?void 0:s.paycut_id)||`paycut-${(s==null?void 0:s.pay_hours)||""}`,label:"Paycut applied",hours:(s==null?void 0:s.pay_hours)||(s==null?void 0:s.paycut_hours)||(s==null?void 0:s.hours)})),k=e=>(e==null?void 0:e.manual_indisciplines)||(e==null?void 0:e.indisciplines)||[],B=e=>(e==null?void 0:e.manual_actions)||(e==null?void 0:e.actions)||[],a=e=>{if(!e)return[];const s=e.attachments||e.attachment_files||e.files||[],d=e.letters||e.text_letters||e.letter_attachments||[];return[...s.map(g=>({...g,_type:"file"})),...d.map(g=>({...g,_type:"letter"}))]},q=e=>(e==null?void 0:e.attachments_count)||(e==null?void 0:e.attachment_count)||a(e).length,tt=e=>Number((e==null?void 0:e.final_outcome)||(e==null?void 0:e.final_score)||(e==null?void 0:e.yearly_final_outcome)||0),et=e=>String(e).padStart(2,"0"),z=e=>{if(!e)return"";const s=new Date(e);return Number.isNaN(s.getTime())?e:new Intl.DateTimeFormat("en",{month:"short"}).format(s)},xt=e=>Array.from({length:12},(s,d)=>{const g=d+1,M=`${e}-${et(g)}-01`;return{month_start:M,label:z(M)}}),at=T(()=>{var e;return(e=N.value)!=null&&e.length?N.value:xt(p.value.year)}),W=T(()=>x.value||[]),bt=T(()=>{const e=[];for(let s=v+1;s>=v-4;s-=1)e.push(s);return e}),_t=T(()=>O(D.value,_.value)),yt=T(()=>a(_t.value)),ot=(e,s,d="indiscipline")=>{m.value=e,F.value=s,j.value=d,V.value=null,S.value="",$.value=!0},rt=(e,s,d,g)=>{m.value=s,F.value=d,j.value=e,V.value=g,S.value=e,$.value=!0},ht=()=>{$.value=!1,V.value=null,S.value=""},gt=(e,s)=>{D.value=e,_.value=s,i.value=!0},mt=()=>{i.value=!1},it=async(e,s,d)=>{s!=null&&s.id&&confirm("Delete this item?")&&(e==="indiscipline"?await h.deleteManualIndiscipline(s.id,{month_start:d}):await h.deleteManualAction(s.id,{month_start:d}))},$t=e=>{const s={};return Object.entries(e).forEach(([d,g])=>{g==null||g===""||(s[d]=g)}),s},wt=()=>{p.value.page!==1&&(p.value.page=1)};return H(p,async e=>{await h.fetchReport(e),c.replace({query:$t(e)})},{deep:!0,immediate:!0}),H(()=>[p.value.year,p.value.company_id,p.value.department_id,p.value.line_type,p.value.employee_id,p.value.search,p.value.per_page],()=>{p.value.page=1}),(e,s)=>(o(),r("div",Cs,[t("div",As,[s[8]||(s[8]=t("div",null,[t("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400"}," Discipline Report "),t("h1",{class:"text-2xl font-semibold text-slate-900"},"Discipline Report Grid"),t("p",{class:"text-sm text-slate-500"}," Track monthly discipline, actions, and attachments with Excel-style clarity. ")],-1)),t("div",Is,y(W.value.length)+" users | "+y(p.value.year),1)]),t("div",Ss,[L(Lt,{company_id:p.value.company_id,"onUpdate:company_id":s[1]||(s[1]=d=>p.value.company_id=d),department_id:p.value.department_id,"onUpdate:department_id":s[2]||(s[2]=d=>p.value.department_id=d),employee_id:p.value.employee_id,"onUpdate:employee_id":s[3]||(s[3]=d=>p.value.employee_id=d),line_type:p.value.line_type,"onUpdate:line_type":s[4]||(s[4]=d=>p.value.line_type=d),"with-type":!0,"initial-value":e.$route.query,onFilterChange:wt,class:"w-full"},{default:K(()=>[t("div",Ms,[s[9]||(s[9]=t("label",{class:"text-xs font-semibold text-slate-600"},"Year",-1)),R(t("select",{"onUpdate:modelValue":s[0]||(s[0]=d=>p.value.year=d),class:"rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},[(o(!0),r(A,null,U(bt.value,d=>(o(),r("option",{key:d,value:d},y(d),9,Us))),128))],512),[[vt,p.value.year,void 0,{number:!0}]])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",Ns,[t("div",Ls,[L(Nt,{modelValue:p.value.search,"onUpdate:modelValue":s[5]||(s[5]=d=>p.value.search=d),placeholder:"Search by name..."},null,8,["modelValue"])]),t("div",Fs,[s[11]||(s[11]=t("label",{class:"text-xs font-semibold text-slate-600"},"Rows",-1)),R(t("select",{"onUpdate:modelValue":s[6]||(s[6]=d=>p.value.per_page=d),class:"rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},s[10]||(s[10]=[t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1)]),512),[[vt,p.value.per_page,void 0,{number:!0}]])])])]),J(E)?(o(),ft(Mt,{key:0})):(o(),r("div",js,[W.value.length===0?(o(),r("div",Vs,s[12]||(s[12]=[t("p",{class:"text-base font-semibold text-slate-700"},"No discipline records found",-1),t("p",{class:"text-sm text-slate-500"},"Try a different year or adjust filters.",-1)]))):(o(),r("div",Ds,[t("table",Ts,[t("thead",Es,[t("tr",null,[s[13]||(s[13]=t("th",{rowspan:"2",class:"th sticky-col"},[t("div",{class:"text-left"},[t("p",{class:"text-xs font-semibold text-slate-700"},"Employee"),t("p",{class:"text-[10px] text-slate-400"},"Sticky column")])],-1)),(o(!0),r(A,null,U(at.value,d=>(o(),r("th",{key:`group-${d.month_start}`,colspan:"3",class:"th text-center"},y(d.label||z(d.month_start)),1))),128)),s[14]||(s[14]=t("th",{rowspan:"2",class:"th text-center"},"Final Outcome",-1))]),t("tr",null,[(o(!0),r(A,null,U(at.value,d=>(o(),r(A,{key:`sub-${d.month_start}`},[s[15]||(s[15]=t("th",{class:"th"},"Indiscipline",-1)),s[16]||(s[16]=t("th",{class:"th"},"Action",-1)),s[17]||(s[17]=t("th",{class:"th"},"Attachment",-1))],64))),128))])]),t("tbody",null,[(o(!0),r(A,null,U(W.value,d=>(o(),r("tr",{key:P(d),class:"border-b border-slate-100 hover:bg-slate-50/70"},[t("td",Rs,[t("div",Os,[t("p",qs,y(X(d)),1),t("p",Ps,y(nt(d)),1)])]),(o(!0),r(A,null,U(at.value,g=>(o(),r(A,{key:`${P(d)}-${g.month_start}`},[t("td",Bs,[L(dt,{onAdd:M=>ot(d,g.month_start,"indiscipline")},{default:K(()=>[L(Gt,{"auto-items":u(O(d,g.month_start)),"manual-items":k(O(d,g.month_start)),onEdit:M=>rt("indiscipline",d,g.month_start,M),onDelete:M=>it("indiscipline",M,g.month_start)},null,8,["auto-items","manual-items","onEdit","onDelete"])]),_:2},1032,["onAdd"])]),t("td",Ys,[L(dt,{onAdd:M=>ot(d,g.month_start,"action")},{default:K(()=>[L(le,{"auto-items":l(O(d,g.month_start)),"manual-items":B(O(d,g.month_start)),onEdit:M=>rt("action",d,g.month_start,M),onDelete:M=>it("action",M,g.month_start)},null,8,["auto-items","manual-items","onEdit","onDelete"])]),_:2},1032,["onAdd"])]),t("td",zs,[L(dt,{onAdd:M=>ot(d,g.month_start,"attachment")},{default:K(()=>[L(oe,{count:q(O(d,g.month_start)),onView:M=>gt(d,g.month_start)},null,8,["count","onView"])]),_:2},1032,["onAdd"])])],64))),128)),t("td",Gs,[L(ue,{"user-id":P(d),year:p.value.year,value:tt(d)},null,8,["user-id","year","value"])])]))),128))])])]))])),W.value.length?(o(),ft(Ut,{key:2,page:J(I).page||p.value.page,"per-page":J(I).per_page||p.value.per_page,total:J(I).total||W.value.length,"last-page":J(I).last_page||1,onPageChange:s[7]||(s[7]=d=>p.value.page=d)},null,8,["page","per-page","total","last-page"])):w("",!0),L(rs,{open:$.value,user:m.value,year:p.value.year,"month-start":F.value,record:O(m.value,F.value),"initial-tab":j.value,"edit-item":V.value,"edit-type":S.value,onClose:ht},null,8,["open","user","year","month-start","record","initial-tab","edit-item","edit-type"]),L(ks,{open:i.value,attachments:yt.value,user:D.value,"month-start":_.value,year:p.value.year,onClose:mt},null,8,["open","attachments","user","month-start","year"])]))}},dl=Q(Hs,[["__scopeId","data-v-169f9658"]]);export{dl as default};
