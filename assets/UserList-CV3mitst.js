import{r as y,p as ne,q as k,B as M,c as f,g as E,o as c,a as e,j as ie,t as m,k as x,h as $,A as de,F as I,x as T,v as ae,u as he,b as ve,e as be,C as ge,y as g,i as C,n as D,f as se,$ as oe}from"./index-BQaj8qaN.js";import{_ as xe}from"./EmployeeFilter-DVq64cxH.js";import{L as ke}from"./LoaderView-BqqBcpqA.js";import{u as re}from"./shift-Onvk1U9D.js";import{d as le}from"./dayjs.min-Cbbdfn5l.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as Se}from"./WeekendAssignModal-Dtx-5z9U.js";import{u as qe}from"./company-KFCczr7Z.js";import{u as Ce}from"./department-eIAgu9oZ.js";import{u as Ue}from"./user-CRwyY2cc.js";import"./EmployeeDropdownInput-DtcLs5yl.js";import"./SelectDropdown-vuQLlnJ9.js";import"./UserChip-B9vOkNdd.js";const Ae={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},De={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},Me={class:"text-lg font-semibold mb-4"},Ee={class:"mb-4"},$e=["value"],je={class:"mb-4"},Le={class:"mb-4"},Oe={class:"flex justify-end gap-3 mt-4"},Ie={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(U,{emit:w}){const j=w,d=U,o=y({shift_id:"",employee_id:d.employee.id,start_date:"",end_date:""}),h=ne(()=>{const p=Object.keys(d.shifts)[0];return d.shifts[p]||[]});k(()=>d.employee,p=>{o.value.employee_id=(p==null?void 0:p.id)||0},{immediate:!0,deep:!0}),k(()=>d.isOpen,p=>{var i;p&&(d.hasShift?(o.value.shift_id=d.hasShift.shift_id||"",o.value.start_date=d.hasShift.start_date?le(d.hasShift.start_date).format("YYYY-MM-DD"):"",o.value.end_date=d.hasShift.end_date?le(d.hasShift.end_date).format("YYYY-MM-DD"):"",o.value.employee_id=((i=d.employee)==null?void 0:i.id)||""):(o.value.shift_id="",o.value.start_date="",o.value.end_date=""))},{immediate:!0});const u=()=>{j("close",!1)},_=re(),{message:v}=M(_),b=async()=>{if(!o.value.shift_id||!o.value.start_date||!o.value.employee_id){alert("All fields are required!");return}try{const p={...o.value},i=await _.shiftAssign(p);console.log("Shift assigned successfully:",i),alert(d.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),u()}catch(p){console.error("Failed to assign shift:",p),alert("Failed to assign shift.")}};return(p,i)=>U.isOpen?(c(),f("div",Ae,[e("div",De,[e("h2",Me,m(d.hasShift?"Update Shift for":"Assign Shift to")+" "+m(U.employee.name),1),ie(" "+m(x(v))+" ",1),e("div",Ee,[i[4]||(i[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),$(e("select",{"onUpdate:modelValue":i[0]||(i[0]=r=>o.value.shift_id=r),class:"w-full p-2 border rounded"},[i[3]||(i[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(c(!0),f(I,null,T(h.value,r=>(c(),f("option",{key:r==null?void 0:r.id,value:r==null?void 0:r.id},m(r==null?void 0:r.name),9,$e))),128))],512),[[de,o.value.shift_id]])]),e("div",je,[i[5]||(i[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),$(e("input",{type:"date","onUpdate:modelValue":i[1]||(i[1]=r=>o.value.start_date=r),class:"w-full border rounded p-2"},null,512),[[ae,o.value.start_date]])]),e("div",Le,[i[6]||(i[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),$(e("input",{type:"date","onUpdate:modelValue":i[2]||(i[2]=r=>o.value.end_date=r),class:"w-full border rounded p-2"},null,512),[[ae,o.value.end_date]])]),e("div",Oe,[e("button",{onClick:u,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:b,class:"px-4 py-2 bg-green-600 text-white rounded"},m(d.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:u,class:"absolute top-2 right-2 text-red-500 text-xl"},i[7]||(i[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):E("",!0)}},Te=we(Ie,[["__scopeId","data-v-c3e70801"]]),Be={class:"space-y-2 px-4"},Ne={class:"flex items-center justify-between gap-2"},Ye={class:"flex gap-4"},Fe={class:"flex gap-4 items-center py-2"},We={key:0,class:"text-center py-4"},Re={key:1,class:"space-y-4"},He={key:0,class:"text-center py-2 text-lg italic text-gray-500"},ze={class:"title-md"},Pe={class:"overflow-x-auto"},Je={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},Ke={class:"border border-gray-300 px-2"},Ge=["innerHTML"],Qe=["innerHTML"],Xe={class:"border border-gray-300 px-2"},Ze={class:"border border-gray-300 px-2"},Ve={class:"border border-gray-300 px-2"},et={class:"border border-gray-300 px-2"},tt={class:"border border-gray-300 px-3 py-3"},at={class:"flex items-center justify-between gap-2"},st={key:0,class:"text-sm font-medium text-green-700"},ot={key:1,class:"text-sm italic text-red-500"},lt=["onClick","title"],nt={class:"border border-gray-300 px-3 py-3"},it={class:"flex items-center justify-between gap-2"},dt={key:0,class:"text-sm font-medium text-green-700"},rt={key:1,class:"text-sm italic text-red-500"},ct=["onClick","title"],pt={class:"border border-gray-300 px-2"},ft={class:"border border-gray-300 px-2"},mt={class:"border border-gray-300 px-2"},yt={key:0,class:"text-green-500"},ut={key:1,class:"text-red-500"},_t={class:"border border-gray-300 px-2"},ht={class:"flex gap-2"},jt={__name:"UserList",setup(U){const w=re(),{shifts:j}=M(w),d=he(),o=ve(),h=Ue(),u=y(o.query.company||"all"),_=y(o.query.department||"all"),v=y(o.query.line_type||"all"),b=y(o.query.status||"active"),p=y(""),i=y(""),r=y(!1),S=y(!1),L=Ce(),O=qe(),{companies:vt}=M(O),{departments:bt}=M(L),B=y([]);be(async()=>{await O.fetchCompanies();const t=o.query.company,a=o.query.department;t&&(await F(t),await N(t)),a&&await W(a)});const ce=()=>{d.go(-1)},pe=()=>{h.fetchUsers({company_id:o.query.company,department_id:o.query.department,line_type:o.query.line_type,status:o.query.status,user_id:o.query.employee_id})};k(u,async(t,a)=>{!t||t===a||(N(t),F(t),o.query.company!==t&&d.push({query:{...o.query,company:t}}))}),k(_,async(t,a)=>{!t||t===a||(W(t),o.query.department!==t&&d.push({query:{...o.query,department:t}}))}),k(v,t=>{d.push({query:{...o.query,line_type:t}})}),k(b,t=>{d.push({query:{...o.query,status:t}})});const N=async t=>{await L.fetchDepartments(t)},Y=ne(()=>{let t=[...(h==null?void 0:h.users)||[]];if(u.value!=="all"&&(t=t.filter(n=>{var l;return((l=n==null?void 0:n.company)==null?void 0:l.id)==u.value})),_.value!=="all"&&(t=t.filter(n=>{var l;return((l=n==null?void 0:n.department)==null?void 0:l.id)==_.value})),v.value!=="all"&&(t=t.filter(n=>(n==null?void 0:n.type)==v.value)),b.value){const n=b.value==="active"?1:0;t=t.filter(l=>(l==null?void 0:l.is_active)==n)}p.value&&(t=t.filter(n=>(n==null?void 0:n.id)==p.value));const a={};return t.forEach(n=>{var q;const l=((q=n==null?void 0:n.company)==null?void 0:q.name)||"Unknown Company";a[l]||(a[l]=[]),a[l].push(n)}),a}),A=y("");function fe(t){A.value=t.id,i.value=t,(t==null?void 0:t.company_id)!==void 0&&(w.fetchShifts(t==null?void 0:t.company_id),r.value=!r.value)}function me(t){A.value=t.id,i.value=t,(t==null?void 0:t.company_id)!==void 0&&(w.fetchShifts(t==null?void 0:t.company_id),S.value=!S.value)}function ye(){r.value=!1}async function ue(){await h.fetchUsersExcelExport({data:{company_id:u.value,department_id:_.value,line_type:v.value,status:b.value}})}const F=async t=>{try{const a=await O.fetchEmployees(t);B.value=a.data}catch(a){console.error("Failed to fetch employees by company:",a)}},W=async t=>{try{const a=await L.fetchDepartmentEmployee({departmentIds:[t]});B.value=a}catch(a){console.error("Failed to fetch employees by department:",a)}},R=t=>{if(t){const a=t.split(" "),n=a.slice(0,2).join(" "),l=a.length>2?`<br>${a.slice(2).join(" ")}`:"";return n+l}return""};return(t,a)=>{const n=ge("RouterLink");return c(),f("div",Be,[e("div",Ne,[e("button",{class:"btn-3",onClick:ce},a[7]||(a[7]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),a[10]||(a[10]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),e("div",Ye,[g(n,{to:{name:"UserAdd",query:{company:x(o).query.company}},class:"btn-2"},{default:C(()=>a[8]||(a[8]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[8]},8,["to"]),e("button",{type:"button",onClick:ue,class:"btn-3"},a[9]||(a[9]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),ie("Excel ")]))])]),e("div",Fe,[g(xe,{company_id:u.value,"onUpdate:company_id":a[0]||(a[0]=l=>u.value=l),department_id:_.value,"onUpdate:department_id":a[1]||(a[1]=l=>_.value=l),employee_id:p.value,"onUpdate:employee_id":a[2]||(a[2]=l=>p.value=l),line_type:v.value,"onUpdate:line_type":a[3]||(a[3]=l=>v.value=l),"with-type":!0,"initial-value":t.$route.query,class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),$(e("select",{"onUpdate:modelValue":a[4]||(a[4]=l=>b.value=l),class:"input-1 w-auto"},a[11]||(a[11]=[e("option",{value:"active"},"Active",-1),e("option",{value:"in_active"},"In Active",-1)]),512),[[de,b.value]]),e("div",{class:"btn-2",onClick:a[5]||(a[5]=l=>pe())},"Search")]),x(h).isLoading?(c(),f("div",We,[g(ke)])):(c(),f("div",Re,[Object.keys(Y.value).length===0?(c(),f("div",He," User not found ")):E("",!0),(c(!0),f(I,null,T(Y.value,(l,q)=>(c(),f("div",{key:q},[e("h2",ze,m(q)+" ("+m(l.length)+")",1),e("div",Pe,[e("table",Je,[a[14]||(a[14]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Finger ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Employee ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Joining Date"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Weekend"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(c(!0),f(I,null,T(l,(s,_e)=>{var H,z,P,J,K,G,Q,X,Z,V,ee;return c(),f("tr",{key:s.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",Ke,m(_e+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:R(s==null?void 0:s.name)},null,8,Ge),e("td",{class:"border border-gray-300 px-2",innerHTML:R((H=s==null?void 0:s.designation)==null?void 0:H.title)},null,8,Qe),e("td",Xe,m(s==null?void 0:s.device_user_id),1),e("td",Ze,m(s==null?void 0:s.employee_id),1),e("td",Ve,m(s.joining_date),1),e("td",et,m(s.role),1),e("td",tt,[e("div",at,[e("div",null,[(P=(z=s.current_shift)==null?void 0:z.shift)!=null&&P.name?(c(),f("span",st,m(s.current_shift.shift.name),1)):(c(),f("span",ot,"Not Assigned"))]),e("button",{onClick:te=>fe(s),title:s!=null&&s.current_shift?"Change Shift":"Assign Shift",class:D(["p-2 rounded-full transition hover:scale-110 focus:outline-none",s!=null&&s.current_shift?"bg-yellow-100 text-yellow-700":"bg-emerald-600 text-white"])},[e("i",{class:D(s!=null&&s.current_shift?"fas fa-pen":"fas fa-plus")},null,2)],10,lt)]),g(oe,{name:"fade"},{default:C(()=>[A.value===s.id&&r.value?(c(),se(Te,{key:0,isOpen:r.value,shifts:x(j),hasShift:s==null?void 0:s.current_shift,employee:{id:i.value.id,name:i.value.name},onClose:ye},null,8,["isOpen","shifts","hasShift","employee"])):E("",!0)]),_:2},1024)]),e("td",nt,[e("div",it,[e("div",null,[(K=(J=s==null?void 0:s.assign_weekend)==null?void 0:J.weekends)!=null&&K.length?(c(),f("span",dt,m(s.assign_weekend.weekends.join(", ")),1)):(c(),f("span",rt,"Not Assigned"))]),e("button",{onClick:te=>me(s),title:(Q=(G=s==null?void 0:s.assign_weekend)==null?void 0:G.weekends)!=null&&Q.length?"Edit Weekend":"Assign Weekend",class:D(["p-2 rounded-full transition hover:scale-110 focus:outline-none",(Z=(X=s==null?void 0:s.assign_weekend)==null?void 0:X.weekends)!=null&&Z.length?"bg-yellow-100 text-yellow-700":"bg-emerald-600 text-white"])},[e("i",{class:D((ee=(V=s==null?void 0:s.assign_weekend)==null?void 0:V.weekends)!=null&&ee.length?"fas fa-pen":"fas fa-plus")},null,2)],10,ct)]),g(oe,{name:"fade"},{default:C(()=>[A.value===s.id&&S.value?(c(),se(Se,{key:0,isOpen:S.value,assign_weekend:s.assign_weekend,userId:s.id,onClose:a[6]||(a[6]=te=>S.value=!1)},null,8,["isOpen","assign_weekend","userId"])):E("",!0)]),_:2},1024)]),e("td",pt,m(s.phone),1),e("td",ft,m(s.email||"নেই"),1),e("td",mt,[s.is_active?(c(),f("span",yt,"Active")):(c(),f("span",ut,"Inactive"))]),e("td",_t,[e("div",ht,[g(n,{to:{name:"UserShow",params:{id:s.id},query:{company:x(o).query.company}},class:"btn-icon"},{default:C(()=>a[12]||(a[12]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[12]},1032,["to"]),g(n,{to:{name:"UserEdit",params:{id:s.id},query:{company:x(o).query.company}},class:"btn-icon"},{default:C(()=>a[13]||(a[13]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[13]},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{jt as default};
