import{u as N,r as n,q as w,p as O,b as $,c as i,a,l as g,m as I,w as P,d,v,A as j,e as p,h as W,t as z,f as G,n as J,o as r,k as K,g as Q}from"./index-B_S1VLCL.js";import{L as X}from"./LoaderView-CiLW5dR2.js";import{_ as Y}from"./MultiselectDropdown-C8CKHC_C.js";import{u as Z}from"./short-leave-DUPghIiQ.js";import{u as ee}from"./user-Bym1dekl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-CxBaIQ9q.js";const te={class:"max-w-3xl mx-auto p-4 space-y-4"},ae={class:"flex items-center justify-between gap-2"},le={key:0,class:"text-center"},se={key:0},oe={key:1},ie={key:2},re={key:3},ue={key:4},ne={key:5,class:"text-red-500 text-sm"},_e={__name:"ShortLeaveAdd",setup(de){const B=G(),L=Q(),h=Z(),E=ee(),S=N(),c=n(null),T=n(""),{type:f,start_time:b,end_time:V}=B.query,_=n(""),k=n(""),x=new Date().toISOString().split("T")[0],t=n({date:x,time:"22:30",start_time:"",end_time:"",reason:"",works_in_hand:"",handover_user_id:"",total_minute:"",type:""}),y=n(!1),m=n(null);w(()=>t.value.date,async l=>{A()}),w(()=>T.value,l=>{t.value.handover_user_id=l==null?void 0:l.id});const M=O(()=>{if(!t.value.start_time||!c.value.start_time)return 0;const l=H=>new Date(`1970-01-01T${H}`),e=l(t.value.start_time),o=t.value.end_time?l(t.value.end_time):null,s=l(c.value.start_time),U=l(c.value.end_time);let u=0;return t.value.type==="Delay"?u=(e-s)/(1e3*60):t.value.type==="Early"?u=(U-e)/(1e3*60):o&&(u=(o-e)/(1e3*60)),Math.round(u)});w(()=>t.value.type,l=>{if(!_.value&&!k.value)return;const e=o=>o&&o.includes(" ")?o.split(" ")[1].substring(0,5):"";l==="Delay"&&_.value?t.value.start_time=e(_.value):l==="Early"&&k.value?t.value.start_time=e(k.value):t.value.start_time=""}),w(()=>[t.value.start_time,t.value.end_time,t.value.type],()=>{t.value.total_minute=M.value});const q=O(()=>M.value>30),R=async()=>{var l;y.value=!0,m.value=null;try{const e={user_id:(l=S==null?void 0:S.user)==null?void 0:l.id,...t.value},o=await h.createShortLeave(e);L.push({name:"ShortLeaveShow",params:{id:o.id}})}catch(e){m.value=e.message||"Failed to submit short leave application"}finally{y.value=!1}},A=async()=>{y.value=!0,m.value=null;try{const l={date:t.value.date},e=await h.fetchCreateShortLeaveData(l);c.value=e==null?void 0:e.shift,_.value=e==null?void 0:e.entry_time,k.value=e==null?void 0:e.exit_time}catch(l){m.value=l.message||"Failed to submit short leave application"}finally{y.value=!1}},C=l=>l?l.split(" ")[0]:x,D=l=>{if(!l)return null;const e=l.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!e)return null;let[o,s,U,u]=e;return s=parseInt(s,10),u.toUpperCase()==="PM"&&s<12&&(s+=12),u.toUpperCase()==="AM"&&s===12&&(s=0),`${s.toString().padStart(2,"0")}:${U}`};$(()=>{A(),E.fetchDepartmentWiseEmployees(),t.value.date=C(f==="Delay"||f==="Early"?time:x),t.value.date=C(f==="Delay"?b:f==="Early"?V:x),t.value.type=f||"",t.value.time=b?D(b):"22:30",t.value.start_time=D(b)||"",t.value.end_time=D(V)||""});const F=()=>{L.go(-1)};return(l,e)=>{const o=J("RouterLink");return r(),i("div",te,[a("div",ae,[a("button",{class:"btn-3",onClick:F},e[8]||(e[8]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),e[10]||(e[10]=a("h1",{class:"title-lg flex-wrap text-center"},"Short Leave Application Form",-1)),a("div",null,[g(o,{to:"/my-applications",class:"btn-2"},{default:I(()=>e[9]||(e[9]=[K("Home")])),_:1})])]),y.value?(r(),i("div",le,[g(X)])):(r(),i("form",{key:1,onSubmit:P(R,["prevent"]),class:"space-y-4 card-bg md:p-8 p-4"},[a("div",null,[e[11]||(e[11]=a("label",{for:"date",class:"block text-sm font-medium"},"Date",-1)),d(a("input",{type:"date",id:"date","onUpdate:modelValue":e[0]||(e[0]=s=>t.value.date=s),class:"input-1 w-full",required:""},null,512),[[v,t.value.date]])]),a("div",null,[e[13]||(e[13]=a("label",{for:"type",class:"block text-sm font-medium"},"Type",-1)),d(a("select",{id:"type","onUpdate:modelValue":e[1]||(e[1]=s=>t.value.type=s),class:"input-1 w-full",required:""},e[12]||(e[12]=[a("option",{value:""},"Select Type",-1),a("option",{value:"Delay"},"Delay",-1),a("option",{value:"OfficeTime"},"Office Time",-1),a("option",{value:"Early"},"Early",-1)]),512),[[j,t.value.type]])]),t.value.type!=="OfficeTime"?(r(),i("div",se,[e[14]||(e[14]=a("label",{for:"start-time",class:"block text-sm font-medium"},"Time",-1)),d(a("input",{type:"time",id:"start-time","onUpdate:modelValue":e[2]||(e[2]=s=>t.value.start_time=s),class:"input-1 w-full",required:""},null,512),[[v,t.value.start_time]])])):p("",!0),t.value.type==="OfficeTime"?(r(),i("div",oe,[e[15]||(e[15]=a("label",{for:"start-time",class:"block text-sm font-medium"},"Start Time",-1)),d(a("input",{type:"time",id:"start-time","onUpdate:modelValue":e[3]||(e[3]=s=>t.value.start_time=s),class:"input-1 w-full",required:""},null,512),[[v,t.value.start_time]])])):p("",!0),t.value.type==="OfficeTime"?(r(),i("div",ie,[e[16]||(e[16]=a("label",{for:"end-time",class:"block text-sm font-medium"},"End Time",-1)),d(a("input",{type:"time",id:"end-time","onUpdate:modelValue":e[4]||(e[4]=s=>t.value.end_time=s),class:"input-1 w-full",required:""},null,512),[[v,t.value.end_time]])])):p("",!0),a("div",null,[e[17]||(e[17]=a("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),d(a("textarea",{id:"reason","onUpdate:modelValue":e[5]||(e[5]=s=>t.value.reason=s),class:"input-1 w-full",placeholder:"Enter your reason for leave",required:""},null,512),[[v,t.value.reason]])]),q.value?(r(),i("div",re,[e[18]||(e[18]=a("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),d(a("textarea",{id:"works-in-hand","onUpdate:modelValue":e[6]||(e[6]=s=>t.value.works_in_hand=s),class:"input-1 w-full",placeholder:"Enter details of works in hand"},null,512),[[v,t.value.works_in_hand]])])):p("",!0),q.value?(r(),i("div",ue,[e[19]||(e[19]=a("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),g(Y,{modelValue:T.value,"onUpdate:modelValue":e[7]||(e[7]=s=>T.value=s),options:W(E).users,multiple:!1,label:"Select User",labelFor:"user"},null,8,["modelValue","options"])])):p("",!0),m.value?(r(),i("div",ne,z(m.value),1)):p("",!0),e[20]||(e[20]=a("div",{class:"flex justify-center"},[a("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{_e as default};
