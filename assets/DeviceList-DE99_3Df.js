import{r as f,c as u,o as r,a as e,g as w,p as U,t as y,s as z,x as K,w as Z,h as g,v as $,C as W,a1 as G,m as P,e as H,q as C,f as J,k as D,F as S,n as Q}from"./index-D-kBrU1A.js";import{u as F,a as R,b as X}from"./zk-finger-ZhHV15mH.js";import{_ as Y,a as ee}from"./HeaderWithButtons-C4agYO9P.js";import{L as se}from"./LoaderView-BW0liX-1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"flex justify-center items-center gap-2"},le={__name:"CheckDeviceConnection",props:{device:Object},setup(k){const c=F(),_=k,x=f(!1),o=f(""),a=f(!1),p=async()=>{a.value=!0;const v=await c.checkDeviceConnection(_.device.id);x.value=v,o.value=v?"success":"Failed",a.value=!1,setTimeout(()=>{o.value=!1},1e3*60)};return(v,i)=>(r(),u("div",te,[e("button",{onClick:p,class:"text-blue-600 hover:text-blue-800"},[e("i",{class:U(["fas fa-sync-alt",{"animate-spin":a.value}])},null,2)]),o.value?(r(),u("span",{key:0,class:U(x.value?"text-green-600":"text-red-600")},y(o.value),3)):w("",!0)]))}},ae={key:0,class:"modal-bg"},ne={class:"modal-card"},oe={class:"text-lg font-semibold mb-4"},ie={class:"mb-4"},re={class:"mb-4"},ue={class:"mb-4"},de={class:"mb-4"},ce={class:"mb-4"},pe={class:"mb-4"},me={class:"flex justify-end"},ve={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},fe={__name:"DeviceModal",props:{show:{type:Boolean,required:!0},device:{type:Object,default:null}},emits:["close","save"],setup(k,{emit:c}){const _=k,x=c,o=f(!1),a=z({id:null,name:"",ip_address:"",port:"",serial_number:"",firmware:"",status:"active"}),p=()=>{o.value=!1,a.id=null,a.name="",a.ip_address="",a.port="",a.serial_number="",a.firmware="",a.status="active"};K(()=>_.device,d=>{d&&typeof d=="object"&&Object.keys(d).length>0?(o.value=!0,a.id=d.id||null,a.name=d.name||"",a.ip_address=d.ip_address||"",a.port=d.port||"",a.serial_number=d.serial_number||"",a.firmware=d.firmware||"",a.status=d.status||"active"):p()},{immediate:!0,deep:!0});const v=()=>{x("save",{...a}),i()},i=()=>{x("close")};return(d,l)=>k.show?(r(),u("div",ae,[e("div",ne,[e("h2",oe,y(o.value?"Edit Device":"Add Device"),1),e("form",{onSubmit:Z(v,["prevent"])},[e("div",ie,[l[6]||(l[6]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),g(e("input",{id:"name","onUpdate:modelValue":l[0]||(l[0]=m=>a.name=m),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter device name",required:""},null,512),[[$,a.name]])]),e("div",re,[l[7]||(l[7]=e("label",{for:"ip_address",class:"block text-sm font-medium mb-2"},"IP Address",-1)),g(e("input",{id:"ip_address","onUpdate:modelValue":l[1]||(l[1]=m=>a.ip_address=m),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter IP address",required:""},null,512),[[$,a.ip_address]])]),e("div",ue,[l[8]||(l[8]=e("label",{for:"port",class:"block text-sm font-medium mb-2"},"Port",-1)),g(e("input",{id:"port","onUpdate:modelValue":l[2]||(l[2]=m=>a.port=m),type:"number",class:"w-full border rounded px-3 py-2",placeholder:"Enter port",required:""},null,512),[[$,a.port]])]),e("div",de,[l[9]||(l[9]=e("label",{for:"serial_number",class:"block text-sm font-medium mb-2"},"Serial Number",-1)),g(e("input",{id:"serial_number","onUpdate:modelValue":l[3]||(l[3]=m=>a.serial_number=m),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter serial number (optional)"},null,512),[[$,a.serial_number]])]),e("div",ce,[l[10]||(l[10]=e("label",{for:"firmware",class:"block text-sm font-medium mb-2"},"Firmware",-1)),g(e("input",{id:"firmware","onUpdate:modelValue":l[4]||(l[4]=m=>a.firmware=m),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter firmware version (optional)"},null,512),[[$,a.firmware]])]),e("div",pe,[l[12]||(l[12]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),g(e("select",{id:"status","onUpdate:modelValue":l[5]||(l[5]=m=>a.status=m),class:"w-full border rounded px-3 py-2",required:""},l[11]||(l[11]=[e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1),e("option",{value:"error"},"Error",-1)]),512),[[W,a.status]])]),e("div",me,[e("button",{type:"button",onClick:i,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",ve,y(o.value?"Update":"Create"),1)])],32)])])):w("",!0)}},be={class:"my-container space-y-2"},ye={key:1},_e={key:0,class:"grid gap-4 md:grid-cols-3"},xe={key:0,class:"absolute inset-0 bg-white/60 grid place-items-center rounded-xl z-10"},he={class:"flex items-start justify-between"},ge={class:"text-base font-semibold"},we={class:"text-xs text-gray-500"},ke={class:"mt-2"},$e={class:"mt-3 flex flex-wrap items-center gap-3"},Ce=["disabled","onClick"],De={key:0,class:"fas fa-list-ol"},Ue={key:1,class:"fas fa-circle-notch fa-spin"},Me=["disabled","onClick"],Pe=["disabled","onClick"],Se=["disabled","onClick"],Fe={key:0,class:"fas fa-fingerprint"},Ie={key:1,class:"fas fa-circle-notch fa-spin"},Ee=["onClick"],Ae=["disabled","onClick"],Ve={class:"mt-2 text-[11px] text-gray-500"},Ne={key:0},Oe={key:1,class:"ml-2 inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-0.5 text-gray-700",title:"Last checked at"},je={key:0,class:"text-red-600"},qe={key:1,class:"text-center text-red-500 py-8"},Ze={__name:"DeviceList",setup(k){const c=F(),_=R(),x=X(),o=G(),a=f(!1),p=f(null),v=f(!1),i=f(null),d=f({}),l=f({running:!1,deviceId:null,label:""}),m=()=>{p.value=null,a.value=!0},I=t=>{p.value=t,a.value=!0},E=()=>a.value=!1,A=async t=>{try{t.id?(await c.updateDevice(t.id,t),o.success("Device updated successfully!")):(await c.createDevice(t),o.success("Device added successfully!")),await c.fetchDevices()}catch(n){o.error("Failed to save device!"),console.error("Error handling save:",n)}},V=t=>{p.value=t,i.value="delete",v.value=!0},N=t=>{p.value=t,i.value="pull",v.value=!0},O=t=>{p.value=t,i.value="push",v.value=!0},j=t=>{p.value=t,i.value="pull-fp",v.value=!0},M=()=>v.value=!1,q=P(()=>i.value==="pull"?"Pull Users from Device":i.value==="push"?"Push All Users to Device":i.value==="pull-fp"?"Pull Fingerprints from Device":"Delete Device"),B=P(()=>{var n;const t=((n=p.value)==null?void 0:n.name)||"this device";return i.value==="pull"?`Pull all users from "${t}"? Only new users will be saved centrally.`:i.value==="push"?`Push all central users to "${t}"? Only users missing on the device will be created.`:i.value==="pull-fp"?`Pull all fingerprints from "${t}"? Only new prints will be saved centrally.`:`Are you sure you want to delete "${t}"?`}),b=(t,n=null)=>l.value.running&&l.value.deviceId===t.id&&(n?l.value.label===n:!0);H(async()=>{await c.fetchDevices()});const L=async()=>{var n;if(!((n=p.value)!=null&&n.id)){o.error("No device selected!");return}const t=p.value;try{if(i.value==="delete")l.value={running:!0,deviceId:t.id,label:"delete-device"},await c.deleteDevice(t.id),o.warning("Device deleted successfully!"),await c.fetchDevices();else if(i.value==="pull"){l.value={running:!0,deviceId:t.id,label:"pull-users"};const s=await _.pullUsersFromDevice(t.id);o.success(`Pulled users from ${t.name}: seen ${s.seen}, inserted ${s.inserted}, mapped ${s.mapped}`)}else if(i.value==="push"){l.value={running:!0,deviceId:t.id,label:"push-users"};const s=await _.pushAllUsersToDevice(t.id);o.success(`Pushed to ${t.name}: new ${s.pushed}, already ${s.already}`)}else if(i.value==="pull-fp"){l.value={running:!0,deviceId:t.id,label:"pull-fp"};const s=await x.pullFingerprintsFromDevice(t.id);o.success(`Pulled fingerprints from ${t.name}: seen ${s.seen}, inserted ${s.inserted}, skipped ${s.skipped}, unmatched ${s.unmatched}`)}}catch(s){const h=(s==null?void 0:s.message)||(s==null?void 0:s.error)||"Operation failed";o.error(h),console.error("Confirm action error:",s)}finally{l.value={running:!1,deviceId:null,label:""},M()}};async function T(t){try{l.value={running:!0,deviceId:t.id,label:"user-count"};const n=await _.getDeviceUserCount(t.id);n.online||o.warning(`Device ${t.name} is offline`),d.value[t.id]={count:Number(n.user_count??0),online:!!n.online,at:new Date().toISOString()}}catch(n){o.error((n==null?void 0:n.message)||"User count failed")}finally{l.value={running:!1,deviceId:null,label:""}}}return(t,n)=>(r(),u(S,null,[e("div",be,[C(Y,{title:"Device List",onAdd:m}),D(c).loading?(r(),J(se,{key:0})):(r(),u("div",ye,[D(c).devices&&D(c).devices.length?(r(),u("div",_e,[(r(!0),u(S,null,Q(D(c).devices,s=>(r(),u("div",{key:s.id,class:"relative rounded-xl border p-4 shadow bg-white hover:shadow-md transition"},[b(s)?(r(),u("div",xe,n[0]||(n[0]=[e("i",{class:"fas fa-circle-notch fa-spin text-2xl"},null,-1)]))):w("",!0),e("div",he,[e("div",null,[e("div",ge,y(s.name),1),e("div",we,y(s.ip_address)+" : "+y(s.port),1)]),e("span",{class:U(["text-xs px-2 py-0.5 rounded",s.status==="active"?"bg-green-100 text-green-700":s.status==="inactive"?"bg-gray-100 text-gray-600":"bg-red-100 text-red-700"])},y(s.status),3)]),e("div",ke,[C(le,{device:s},null,8,["device"])]),e("div",$e,[e("button",{class:"text-slate-700 hover:text-slate-900",disabled:b(s),onClick:h=>T(s),title:"User Count"},[b(s,"user-count")?(r(),u("i",Ue)):(r(),u("i",De))],8,Ce),e("button",{class:"text-amber-600 hover:text-amber-800",disabled:b(s),onClick:h=>N(s),title:"Pull Users from Device"},n[1]||(n[1]=[e("i",{class:"fas fa-download"},null,-1)]),8,Me),e("button",{class:"text-emerald-600 hover:text-emerald-800",disabled:b(s),onClick:h=>O(s),title:"Push Users to Device"},n[2]||(n[2]=[e("i",{class:"fas fa-upload"},null,-1)]),8,Pe),e("button",{class:"text-purple-600 hover:text-purple-800",disabled:b(s),onClick:h=>j(s),title:"Pull Fingerprints from Device"},[b(s,"pull-fp")?(r(),u("i",Ie)):(r(),u("i",Fe))],8,Se),e("button",{class:"text-blue-600 hover:text-blue-800 ml-auto",onClick:h=>I(s),title:"Edit"},n[3]||(n[3]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ee),e("button",{class:"text-red-600 hover:text-red-800",disabled:b(s),onClick:h=>V(s),title:"Delete"},n[4]||(n[4]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ae)]),e("div",Ve,[b(s)?(r(),u("span",Ne,"Working: "+y(l.value.label),1)):w("",!0),d.value[s.id]?(r(),u("span",Oe,[n[5]||(n[5]=e("i",{class:"fas fa-user"},null,-1)),e("span",null,"Users: "+y(d.value[s.id].count),1),d.value[s.id].online?w("",!0):(r(),u("span",je,"(offline)"))])):w("",!0)])]))),128))])):(r(),u("div",qe,"No devices found"))]))]),C(fe,{show:a.value,device:p.value,onClose:E,onSave:A},null,8,["show","device"]),C(ee,{show:v.value,title:q.value,message:B.value,onClose:M,onConfirm:L},null,8,["show","title","message"])],64))}};export{Ze as default};
