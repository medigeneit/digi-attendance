import{d as yt,b as vt,m as S,r as L,c as n,o as s,a as t,g as b,p as Z,F as O,k as d,w,t as x,x as $,i as I,y as H,f as P,L as bt,e as K,G as Tt,n as Y,h as xt,j as E,v as gt,q,M as $t,E as pt,s as N,u as Ct,A as kt}from"./index-BR5t5sGL.js";import{L as z}from"./LoaderView-CzUihn0q.js";import{O as j}from"./OverlyModal-BV_Kla2a.js";import{_ as St}from"./TaskAddForm-BLFFH07n.js";import{_ as wt}from"./TaskEditForm-CS1kzmGD.js";import{_ as Dt,a as It,b as Et,c as Pt}from"./TaskTreeView-CRUYmBU3.js";import{a as Lt,_ as Ut}from"./TaskUserAssignForm-BKQzgwfU.js";import{u as Mt,r as At,d as Nt,a as Ot}from"./task-priority-ChXsLw_U.js";import{g as F,a as Rt,b as jt}from"./datetime-DLSuPxzD.js";import{_ as mt}from"./UserChip-BCaGXdU2.js";import{u as Ft}from"./useTaskStore-CmLj28p_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-DcO9bMwJ.js";import"./company-Ckpx29pt.js";import"./useRequirementStore-BNzIM_i8.js";import"./requirement-CwmDdsyU.js";import"./CompanyDepartmentSelectInput-DsfCZlYX.js";import"./SectionLoading-CYv6L3do.js";import"./TextWithHr-2iAUXFmP.js";import"./TaskUrgencyInput-CfjAhTwS.js";import"./tags-BpTgKTql.js";import"./MultiselectDropdown-5COsgnhL.js";import"./url-CePbr-gY.js";import"./TaskUserChip-CH6ltXH8.js";const Gt={class:"mb-3"},Bt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Vt={key:1,class:"text-center py-4 text-gray-500"},qt={key:2,class:"text-center py-4 text-red-500"},Ht={key:3,class:"space-y-4"},Wt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(c,{emit:a}){const e=c,l=yt(),o=vt(),i=S(()=>{var y;return!!(((y=l==null?void 0:l.user)==null?void 0:y.role)!=="employee"&&(l!=null&&l.isAdminMood))}),m=a,g=L(null),{handleItemsPriorityUpdate:u,saveTaskPriority:v,listHasRearranged:k}=Mt(()=>e.tasks,e.parentId),h=async()=>{await v(),m("updatePriority")};return(y,r)=>(s(),n("div",null,[t("div",Gt,[Z(y.$slots,"task:header")]),i.value?(s(),n(O,{key:0},[d(k)?(s(),n("div",Bt,[r[4]||(r[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:w(h,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:r[0]||(r[0]=w((..._)=>g.value.resetItems&&g.value.resetItems(..._),["prevent"]))},"Discard")])):b("",!0)],64)):b("",!0),c.loading?(s(),n("div",Vt,"Loading tasks...")):c.error?(s(),n("div",qt,x(c.error),1)):(s(),n("div",Ht,[$(Lt,{items:c.tasks,handle:"handle",onItemsUpdate:d(u),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:g},{item:I(({item:_,index:A})=>[$(Dt,{isMyTask:d(o).name=="MyTaskShow",index:A,task:_,showDraggableHandle:i.value,"tree-level":c.treeLevel,class:"!border-0",onCommentButtonClick:M=>m("commentButtonClick",_.id),onEditClick:r[1]||(r[1]=M=>m("editClick",M)),onAddClick:r[2]||(r[2]=M=>m("addClick",M)),onEmployeeAssignClick:r[3]||(r[3]=M=>m("employeeAssignClick",M))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Zt={class:"flex justify-between mt-5"},zt={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},Kt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(c,{emit:a}){const e=c,l=H({taskId:0,isOpen:!1}),o=a,i=L(),m=H({show:!1,parentId:e.parentId,requirementId:null}),g=y=>{m.show=!0,m.parentId=y,console.log({addForm:m})};function u(){m.show=!1,m.parentId=e.parentId,o("created")}function v(){o("assignUser")}function k(){i.value=!1,o("updated")}function h(){m.show=!1,m.parentId=e.parentId}return(y,r)=>(s(),n("div",null,[i.value?(s(),P(j,{key:0},{default:I(()=>[$(wt,{taskId:i.value,onClose:r[0]||(r[0]=_=>i.value=null),onUpdated:k},null,8,["taskId"])]),_:1})):b("",!0),m.show?(s(),P(j,{key:1},{default:I(()=>[$(St,{parentTaskId:m.parentId,requirementId:m.requirementId,onTaskCreated:u,onError:y.handleTaskError,onClose:h},null,8,["parentTaskId","requirementId","onError"])]),_:1})):b("",!0),l.isOpen?(s(),P(j,{key:2},{default:I(()=>[$(Ut,{taskId:l.taskId,onCancelClick:r[1]||(r[1]=()=>{l.isOpen=!1,l.taskId=0}),onSuccess:r[2]||(r[2]=()=>{l.isOpen=!1,l.taskId=0,v()})},null,8,["taskId"])]),_:1})):b("",!0),$(Wt,{tasks:c.subTasks,parentId:c.parentId,treeLevel:c.treeLevel,onAddClick:r[4]||(r[4]=_=>g(_)),onEditClick:r[5]||(r[5]=_=>i.value=_),onUpdatePriority:r[6]||(r[6]=_=>o("updatePriority")),onEmployeeAssignClick:r[7]||(r[7]=_=>{l.taskId=_,l.isOpen=!0})},{"task:header":I(()=>[t("div",Zt,[r[8]||(r[8]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks")],-1)),c.subTaskIsCreatable?(s(),n("div",zt,[t("button",{class:"btn-1 ml-auto",onClick:r[3]||(r[3]=w(()=>g(c.parentId),["prevent"]))}," Add Sub Task ")])):b("",!0)])]),_:1},8,["tasks","parentId","treeLevel"])]))}},Yt={key:0},Jt={key:0},Qt={key:1},Xt={key:2},te={key:3},ee={key:1},se=bt({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(c){const a=c;let e=0;const l=L(m());let o;function i(){return a.millisecond&&typeof a.millisecond=="number"}function m(){i()?e&&(e-=1e3):e=new Date(a.targetDateTime).getTime()-new Date().getTime();const y=Math.floor(e/1e3%60),r=Math.floor(e/1e3/60%60),_=Math.floor(e/(1e3*60*60)%24),A=Math.floor(e/(1e3*60*60*24));return{total:e,days:A,hours:_,minutes:r,seconds:y}}function g(){l.value=m()}K(()=>{i()&&(e=a.millisecond),console.log("MOUNTED"),g(),o=setInterval(()=>{g(),l.value.total<=0&&clearInterval(o)},1e3)}),Tt(()=>clearInterval(o)),Y(()=>a.targetDateTime,()=>{g(),clearInterval(o)});const u=S(()=>l.value.days.toString().padStart(2,"0")),v=S(()=>l.value.hours.toString().padStart(2,"0")),k=S(()=>l.value.minutes.toString().padStart(2,"0")),h=S(()=>l.value.seconds.toString().padStart(2,"0"));return(y,r)=>l.value.total>0?(s(),n("span",Yt,[!y.hideIfZeroValue||u.value!="00"?(s(),n("span",Jt,x(u.value)+"d : ",1)):b("",!0),!y.hideIfZeroValue||v.value!="00"?(s(),n("span",Qt,x(v.value)+"h : ",1)):b("",!0),!y.hideIfZeroValue||k.value!="00"?(s(),n("span",Xt,x(k.value)+"m : ",1)):b("",!0),!y.hideIfZeroValue||h.value!="00"?(s(),n("span",te,x(h.value)+"s",1)):b("",!0)])):(s(),n("span",ee,[Z(y.$slots,"expired")]))}}),ae={class:"mb-2 mt-6"},ne={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},le={class:"flex justify-center"},oe={class:"py-6 w-full text-center"},re={class:"block mb-2"},ie={class:"font-semibold text-red-600 mx-2 text-xl"},de={class:"mt-2"},ue={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},ce={class:"flex justify-between items-center"},pe={key:0,class:"btn-2-red"},ke={key:1,class:"btn-2-red"},ft=5e3,me={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(c,{emit:a}){const e=c,l=L(""),o=L(""),i=a,m=L("");let g=0;async function u(){var h,y;if(!l.value)return m.value="Type the task title on input box";clearTimeout(g);try{m.value="",o.value==="deleted"?(o.value="restoring",await At(e.task.id),o.value="restored"):(o.value="deleting",await Nt(e.task.id,{params:{security_check:l.value}}),o.value="deleted"),o.value=="deleted"?g=setTimeout(()=>{k()},ft):i("closeClick")}catch(r){o.value="error",m.value=((y=(h=r.response)==null?void 0:h.data)==null?void 0:y.message)||`Failed to update ${e.type}`}}function v(){o.value==="deleted"&&k(),i("closeClick")}function k(){o.value="",i("delete")}return(h,y)=>{var r,_;return s(),n("form",{class:"p-4 relative",onSubmit:w(u,["prevent"])},[y[7]||(y[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",ae,[y[1]||(y[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,x((r=c.task)==null?void 0:r.title),1)]),o.value=="deleted"?(s(),n("div",ne,y[2]||(y[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(s(),n(O,{key:1},[t("div",le,[t("div",oe,[t("label",re,[y[3]||(y[3]=E(" Type ")),t("span",ie,x((_=c.task)==null?void 0:_.title),1),y[4]||(y[4]=E(" and submit to delete "))]),xt(t("input",{type:"text","onUpdate:modelValue":y[0]||(y[0]=A=>l.value=A),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[gt,l.value]])])]),y[5]||(y[5]=t("hr",null,null,-1)),t("div",de,[m.value?(s(),n("div",ue,x(m.value),1)):b("",!0)])],64)),t("div",ce,[t("button",{class:"btn-3",type:"button",onClick:w(v,["prevent"])},"Close"),o.value=="deleted"?(s(),n("button",pe,[y[6]||(y[6]=E(" Undo Delete in ")),o.value=="deleted"?(s(),P(se,{key:0,"hide-if-zero-value":!0,millisecond:ft})):b("",!0)])):(s(),n("button",ke,"Delete"))]),o.value=="deleting"||o.value=="restoring"?(s(),P(z,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:I(()=>[E(x(String(o.value).charAt(0).toUpperCase()+String(o.value).slice(1)),1)]),_:1})):b("",!0)],32)}}},fe=c=>c==null?void 0:c.reduce((a,e)=>a+e.task_weight,0),_t=(c,a)=>{const e=fe(c);return c.map(l=>{const o=a.filter(i=>i.user_id===l.id).reduce((i,m)=>i+m.progress,0);return{...l,task_progress:Math.floor(o*(l.task_weight/e)),user_progress:o}})},ye=(c,a)=>{let e=0;const l=[],o=g=>g.status==="COMPLETED",i=g=>g.users.some(u=>u.id===a),m=(g,u)=>{g.forEach(v=>{const k=i(v);l[u]=l[u]||{user_id:a,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const h=k&&v.children_tasks.length===0;l[u].total_assigned+=k?1:0,l[u].total_assigned_on_leaf_task+=h?1:0,e+=h?1:0,k&&o(v)&&(l[u].completed_count++,v.children_tasks.length),v.children_tasks.length>0&&m(v.children_tasks,u+1)})};return m(c,0),{sub_task_infos:l,assigned_on_any_leaf_task:e>0}},ve=(c,a)=>c.map(e=>({...e,...ye(a,e.id)})),be={key:0,class:"min-w-full bg-white rounded overflow-hidden"},xe={class:"py-0.5 text-bg font-semibold"},ge={class:"bg-gray-50"},_e={class:"px-2 py-1 border-y"},he={class:"px-2 py-1 border-y"},Te={key:0,class:"text-sm text-gray-400"},$e={key:1},Ce={key:1,class:"min-w-full bg-white rounded overflow-hidden"},Se={class:"py-0.5 text-bg font-semibold"},we={class:"px-2 py-1 border-y text-center"},De={class:"px-2 py-1 border-y border-r"},Ie={class:"px-2 py-1 border-y text-center"},Ee={class:"px-2 py-1 border-y text-center"},Pe=bt({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(c){const a=c,e=S(()=>_t(a.task.users,a.task.task_reports||[])),l=S(()=>ve(a.task.users,a.subTasks));return(o,i)=>{var m,g;return a.task.children_task_count>0?(s(),n("table",be,[t("caption",xe,[Z(o.$slots,"caption",{},()=>[i[0]||(i[0]=E("Progress"))])]),t("thead",ge,[t("tr",null,[i[1]||(i[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),i[2]||(i[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(s(!0),n(O,null,q(((g=(m=l.value[0]||{})==null?void 0:m.sub_task_infos)==null?void 0:g.length)||1,u=>(s(),n("th",{key:u,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},x(u===1?"Completed Sub Task":"")+" "+x(u===2?"Completed Sub Sub Task":"")+" "+x(u===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(s(!0),n(O,null,q(l.value,(u,v)=>(s(),n("tr",{key:u.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",_e,x(v+1),1),t("td",he,[$(mt,{user:u},null,8,["user"])]),(s(!0),n(O,null,q(u.sub_task_infos,(k,h)=>(s(),n("td",{class:"px-2 py-1 border-y text-center",key:h},[k.total_assigned===0||!u.assigned_on_any_leaf_task?(s(),n("div",Te," Not Assigned To Any Task ")):(s(),n("div",$e,x(k.completed_count)+" / "+x(k.total_assigned),1))]))),128))]))),128))])])):(s(),n("table",Ce,[t("caption",Se,[Z(o.$slots,"caption",{},()=>[i[3]||(i[3]=E("Progress"))])]),i[4]||(i[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(s(!0),n(O,null,q(e.value,(u,v)=>(s(),n("tr",{key:u.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",we,x(v+1),1),t("td",De,[$(mt,{user:u},null,8,["user"])]),t("td",Ie,x(d(F)(u.task_started_at)),1),t("td",Ee,x(d(F)(u.task_finished_at)),1)]))),128))])]))}}}),Le=$t("task-user",()=>({updateUserStartDate:async(e,l,o)=>await pt.patch(`/task-user/task/${e}/user/${l}/update-start-date/${o}`),updateUserFinishDate:async(e,l,o)=>await pt.patch(`/task-user/task/${e}/user/${l}/update-finish-date/${o}`)})),Ue={class:"border-b text-center"},Me={key:0},Ae={key:1},Ne={class:"text-center font-semibold text-blue-800 my-4"},Oe={class:"flex justify-center w-full"},Re={class:"py-6 w-4/12"},je={class:"block text-xs font-semibold"},Fe={class:"mt-3"},Ge={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Be={class:"flex justify-between items-center"},ht={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(c,{emit:a}){const e=c,l=a,o=Le(),i=L(""),m=L("");async function g(){var v,k;console.log({date:i.value});try{e.type=="start-date"?await o.updateUserStartDate(e.task.id,e.user.id,i.value||"0"):e.type=="finish-date"&&await o.updateUserFinishDate(e.task.id,e.user.id,i.value||"0"),l("updateDate")}catch(h){m.value=((k=(v=h.response)==null?void 0:v.data)==null?void 0:k.message)||`Failed to update ${e.type}`}}function u(v){if(v){const k=e.type==="start-date"?v.started_at:v.completed_at;i.value=Rt(k)}}return Y(()=>e.task,v=>{u(v)},{immediate:!0}),K(()=>{u(e.task)}),(v,k)=>(s(),n("form",{class:"p-4",onSubmit:w(g,["prevent"])},[t("div",Ue,[c.type=="start-date"?(s(),n("h2",Me,"Edit Start Date")):c.type=="finish-date"?(s(),n("h2",Ae,"Edit Completed Date")):b("",!0)]),t("div",Ne,x(c.task.title),1),t("div",Oe,[t("div",Re,[t("label",je,x(c.type=="start-date"?"Start date":"Completed date"),1),xt(t("input",{type:"date","onUpdate:modelValue":k[0]||(k[0]=h=>i.value=h),class:"border py-2 px-4 rounded-md w-full"},null,512),[[gt,i.value]])])]),k[3]||(k[3]=t("hr",{class:"mt-4"},null,-1)),t("div",Fe,[m.value?(s(),n("div",Ge,x(m.value),1)):b("",!0)]),t("div",Be,[t("button",{class:"btn-3",onClick:k[1]||(k[1]=w(h=>l("closeClick"),["prevent"]))},"Close"),k[2]||(k[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},Ve={key:1},qe={key:2,class:"flex"},He={class:"border-r-2 border-dashed pr-6 border-gray-300"},We={class:"text-right text-sm col-span-full"},Ze={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},ze={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Ke={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},Ye={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},Je={key:0},Qe=["disabled"],Xe=["disabled"],ts={class:"text-lg font-semibold text-gray-700"},es={class:"text-sm text-gray-500"},ss={class:"flex flex-grow justify-center items-center"},as={key:0,class:"flex flex-col justify-center items-center"},ns={key:1},ls={key:1},os={key:2,class:"flex justify-center items-center flex-col"},rs={key:3,class:"flex flex-col justify-center items-center"},is={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},ds={class:"my-6"},us={class:"text-center font-semibold text-blue-800 mb-4"},cs={class:"text-center my-1"},ps={class:"border px-2 rounded-md bg-gray-50"},ks={class:"text-red-600 text-center mt-2 text-sm"},ms={class:"flex justify-between mt-3"},fs={class:"btn-2"},ys={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(c,{emit:a}){const e=c,l=a,o=yt(),i=L(""),m=L(),g=L(),u=H({user:null,type:""});function v(C){u.user=o.user,u.type=C}const k={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},h=S(()=>(k==null?void 0:k[r.value])||0),y=S(()=>({"bg-yellow-50":r.value==="IN_PROGRESS","bg-green-50":r.value==="COMPLETED","bg-red-50":r.value==="PENDING","bg-blue-50":e.task.closed_at})),r=S(()=>{var C;return(C=e.task)==null?void 0:C.status}),_=S(()=>r.value=="PENDING"?"Start":r.value=="IN_PROGRESS"?"Finish":r.value=="COMPLETED"?"Close":""),A=S(()=>_.value=="Start"?"Start Task":_.value=="Finish"?"Finish Task":_.value=="Close"?"Close Task":"");async function M(){var C,p;m.value="submitting";try{await Ot(e.task.id,{status:i.value}),i.value="",l("updateStatus")}catch(R){g.value=(p=(C=R.response)==null?void 0:C.data)==null?void 0:p.message,l("error")}finally{m.value=""}}const U=S(()=>_.value=="Start"?"fas fa-play-circle text-blue-500":_.value=="Finish"?"fas fa-stop-circle text-blue-500":""),f=S(()=>[{date:F(e.task.assigned_at||e.task.created_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!e.task.assigned_at||!!e.task.created_at},{date:F(e.task.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!e.task.started_at||h.value>=k.IN_PROGRESS},{date:F(e.task.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!e.task.completed_at||h.value>=k.COMPLETED},{date:F(e.task.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!e.task.deadline}].sort((C,p)=>C.date===null||p.date===null?C.serial-p.serial:new Date(C.date)-new Date(p.date)));return(C,p)=>{var R;return c.task.children_task_count>0&&r.value!=="PENDING"||c.task.children_task_count===0?(s(),n("div",{key:0,class:N(["border py-8 px-4 rounded",y.value])},[u.user?(s(),P(j,{key:0},{default:I(()=>[$(ht,{task:e.task,user:u.user,type:u.type,onCloseClick:p[0]||(p[0]=T=>u.user=null),onUpdateDate:p[1]||(p[1]=()=>{u.user=null,u.type=null,l("updateStatus")})},null,8,["task","user","type"])]),_:1})):b("",!0),r.value==="BLOCKED"?(s(),n("div",Ve,p[8]||(p[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(s(),n("div",qe,[t("div",He,[t("div",We,[(R=e.task)!=null&&R.is_target?(s(),n("div",Ze," TARGET TASK ")):b("",!0)]),t("ol",ze,[(s(!0),n(O,null,q(f.value,(T,W)=>{var G,B;return s(),n("li",{class:"ml-5",key:W},[t("div",Ke,[T.active?(s(),n("i",{key:0,class:N([T.icon,"text-xs"])},null,2)):b("",!0)]),t("div",{class:N({"opacity-30":!T.active})},[t("div",Ye,[T.date?(s(),n("span",Je,x(T.date),1)):b("",!0),((G=e.task)==null?void 0:G.children_task_count)===0&&T.status==="started"&&T.active?(s(),n("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:p[2]||(p[2]=w(()=>v("start-date"),["prevent"])),disabled:!!e.task.closed_at},x(T.date?"Edit":"Set Date"),9,Qe)):b("",!0),((B=e.task)==null?void 0:B.children_task_count)===0&&T.active&&T.status==="completed"?(s(),n("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:p[3]||(p[3]=w(()=>v("finish-date"),["prevent"])),disabled:!!e.task.closed_at},x(T.date?"Edit":"Set Date"),9,Xe)):b("",!0)]),t("h3",ts,x(T.title),1),t("p",es,x(T.description),1)],2)])}),128))])]),t("div",ss,[c.task.closed_at?(s(),n("div",as,p[9]||(p[9]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):r.value==="PENDING"?(s(),n("div",ns,[c.task.children_task_count===0?(s(),n("button",{key:0,class:"btn-3",onClick:p[4]||(p[4]=w(T=>i.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(s(),n("div",ls,"Task Pending"))])):r.value==="IN_PROGRESS"?(s(),n("div",os,[p[10]||(p[10]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),p[11]||(p[11]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),c.task.children_task_count===0?(s(),n("button",{key:0,class:"btn-3",onClick:p[5]||(p[5]=w(T=>i.value="COMPLETED",["prevent"]))}," Finish Task ")):b("",!0)])):r.value==="COMPLETED"?(s(),n("div",rs,[p[12]||(p[12]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),p[13]||(p[13]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:p[6]||(p[6]=w(T=>i.value="CLOSED",["prevent"]))},"Close Task")])):b("",!0)])])),i.value?(s(),P(j,{key:3},{default:I(()=>[t("form",{class:"p-4 rounded relative",onSubmit:w(M,["prevent"])},[m.value==="submitting"?(s(),P(z,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:I(()=>p[14]||(p[14]=[E("Submitting!")])),_:1,__:[14]})):b("",!0),t("h3",is,x(A.value),1),t("div",ds,[t("div",us,x(c.task.title),1),p[17]||(p[17]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",cs,[p[15]||(p[15]=E(" Want to ")),t("span",ps,[t("i",{class:N(["text-sm",U.value])},null,2),E(" "+x(_.value),1)]),p[16]||(p[16]=E(" the task? "))])]),p[18]||(p[18]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",ks,x(g.value),1),t("div",ms,[t("button",{class:"btn-3",onClick:p[7]||(p[7]=w(T=>i.value="",["prevent"]))},"Cancel"),t("button",fs,[t("i",{class:N(["text-xl text-white",U.value])},null,2),E(" "+x(_.value)+" Task ",1)])])])],32)]),_:1})):b("",!0)],2)):b("",!0)}}},vs={class:"container mx-auto p-6"},bs={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},xs={class:"grid grid-cols-4"},gs={class:"mb-4 flex col-span-full"},_s={class:"font-medium text-xl"},hs={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},Ts={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},$s={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},Cs={key:2,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},Ss={class:"text-gray-400 text-xs mt-2 col-span-full"},ws={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},Ds={class:"col-span-full mb-4"},Is=["innerHTML"],Es={key:0,class:"mt-4 col-span-full mb-6"},Ps={class:"ml-auto text-right text-sm col-span-full mt-4"},Ls={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Us={class:"mt-6 py-2 flex justify-center items-center gap-2 col-span-full"},Ms=["disabled"],As={class:"ml-auto flex gap-4"},Ns={key:0},Os={key:1},Rs={key:1,class:"text-center py-4 text-red-500"},da={__name:"TaskShow",setup(c){const a=Ft(),e=vt(),l=Ct(),o=L(""),i=S(()=>a.tasks),m=L({}),g=H({open:!1,task:null}),u=L(!0);K(async()=>{o.value="loading",await k(e.params.id),o.value=""});const v=H({user:null,type:""});async function k(U){await a.fetchTask(U)}const h=S(()=>_t(a.task.users,a.task.task_reports||[]));async function y(){await k(e.params.id),v.user=null,v.type=""}const r=U=>{l.push({name:"TaskEdit",params:{id:U}})},_=S(()=>{var U,f;return a.task?((U=a.task)==null?void 0:U.parent_id)==0?{name:e.name==="MyTaskShow"?"MyTaskList":"TaskList"}:{params:{id:(f=a.task)==null?void 0:f.parent_id}}:null});function A(){g.open=!0,g.task=a.task}function M(){g.open=!1,console.log({STATE:"Deleted",backLink:_.value}),l.push(_.value)}return Y(()=>e.params.id,async U=>{o.value="changing",await k(U),o.value=""}),(U,f)=>{var R,T,W,G,B,J,Q,X,tt,et,st,at,nt,lt,ot,rt,it,dt,ut;const C=kt("RouterLink"),p=kt("router-view");return s(),n("div",vs,[v.user?(s(),P(j,{key:0},{default:I(()=>[$(ht,{task:d(a).task,user:v.user,type:v.type,onCloseClick:f[0]||(f[0]=D=>v.user=null),onUpdateDate:y},null,8,["task","user","type"])]),_:1})):b("",!0),g.open?(s(),P(j,{key:1},{default:I(()=>[$(me,{onCloseClick:f[1]||(f[1]=D=>g.open=!1),task:g.task,onDelete:M},null,8,["task"])]),_:1})):b("",!0),o.value==="loading"?(s(),P(z,{key:2})):(s(),n("div",bs,[d(a).task?(s(),n(O,{key:0},[t("section",xs,[t("div",gs,[t("div",null,[t("h2",_s,x(d(a).task.title),1),t("div",hs,[d(a).task.parent_id==0?(s(),n("div",Ts," MAIN TASK ")):b("",!0),(R=d(a).task)!=null&&R.is_important?(s(),n("span",$s,"IMPORTANT")):b("",!0),(T=d(a).task)!=null&&T.is_urgent?(s(),n("span",Cs,"URGENT")):b("",!0)]),t("div",Ss,[f[13]||(f[13]=t("i",{class:"fas fa-clock"},null,-1)),E(" "+x(d(jt)(d(a).task.created_at)),1)])]),t("div",ws,[$(It,{status:(W=d(a).task)==null?void 0:W.status,progressPercent:(G=d(a).task)==null?void 0:G.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),d(a).task?(s(),P(Et,{key:0,task:d(a).task,ref_key:"progress",ref:m,class:"!text-lg"},null,8,["task"])):b("",!0)])]),t("div",Ds,[t("p",{innerHTML:(B=d(a).task)==null?void 0:B.description,class:N(["text-gray-700",{"line-clamp-3":u.value}])},null,10,Is),((Q=(J=d(a).task)==null?void 0:J.description)==null?void 0:Q.length)>=600?(s(),n("button",{key:0,class:"text-blue-500 mt-2",onClick:f[2]||(f[2]=w(D=>u.value=!u.value,["prevent"]))}," Show "+x(u.value?"More":"Less"),1)):b("",!0)]),$(Pt,{task:(X=d(a))==null?void 0:X.task,"tree-level":(et=(tt=d(a))==null?void 0:tt.task)==null?void 0:et.level},null,8,["task","tree-level"]),d(a).task.children_task_count>0?(s(),n("section",Es,[$(Pe,{"task-users":((st=d(a).task)==null?void 0:st.users)||[],task:d(a).task,"sub-tasks":d(a).tasks,"progress-users":h.value},{caption:I(()=>f[14]||(f[14]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):b("",!0),t("div",Ps,[(at=d(a).task)!=null&&at.is_target?(s(),n("div",Ls," TARGET TASK ")):b("",!0)]),$(ys,{task:((nt=d(a))==null?void 0:nt.task)||{},class:"col-span-full mt-4",onUpdateStatus:f[3]||(f[3]=D=>{var V,ct;return k((ct=(V=d(a))==null?void 0:V.task)==null?void 0:ct.id)})},null,8,["task"]),t("div",Us,[t("button",{onClick:f[4]||(f[4]=w(D=>{var V;return r((V=d(a).task)==null?void 0:V.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!d(a).task.closed_at}," Edit ",8,Ms),$(C,{to:{name:"TaskUserAssign",params:{id:(lt=d(a).task)==null?void 0:lt.id}},class:N(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",d(a).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:f[5]||(f[5]=D=>D.stopPropagation())},{default:I(()=>f[15]||(f[15]=[t("i",{class:"fas fa-user-plus"},null,-1),E(" Assign Users ")])),_:1,__:[15]},8,["to","class"]),$(C,{to:_.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none",onClick:f[6]||(f[6]=D=>D.stopPropagation())},{default:I(()=>f[16]||(f[16]=[t("i",{class:"fas fa-arrow-left"},null,-1),E(" Back ")])),_:1,__:[16]},8,["to"]),t("div",As,[((ot=d(a).task)==null?void 0:ot.children_task_count)===0&&((rt=d(a).task)==null?void 0:rt.status)==="PENDING"?(s(),n("button",{key:0,class:"btn-2-red h-8",onClick:w(A,["prevent"])}," Delete ")):b("",!0),i.value.length>0?(s(),P(C,{key:1,to:{name:"TaskShow",params:{id:(it=d(a).task)==null?void 0:it.id}},onClick:f[7]||(f[7]=D=>D.stopPropagation()),class:N(["py-0.5 btn-3 ml-auto text-sm h-8",{"bg-blue-500 text-white":d(e).name=="TaskShow"||d(e).name==="MyTaskShow"}])},{default:I(()=>f[17]||(f[17]=[t("i",{class:"fal fa-list-ul"},null,-1),E(" Sub Tasks ")])),_:1,__:[17]},8,["to","class"])):b("",!0),$(C,{to:{name:"TaskReports",params:{id:(dt=d(a).task)==null?void 0:dt.id}},onClick:f[8]||(f[8]=D=>D.stopPropagation()),class:N(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":d(e).name=="TaskReports"}])},{default:I(()=>f[18]||(f[18]=[t("i",{class:"fal fa-file-alt"},null,-1),E(" Reports ")])),_:1,__:[18]},8,["to","class"])])])]),(d(e).name=="TaskShow"||d(e).name==="MyTaskShow")&&((ut=d(a).task)==null?void 0:ut.level)<=2?(s(),n("section",Ns,[$(Kt,{subTasks:i.value,"parent-id":d(e).params.id,"tree-level":d(a).task.level+1,onCreated:f[9]||(f[9]=D=>k(d(e).params.id)),onUpdated:f[10]||(f[10]=D=>k(d(e).params.id)),onUpdatePriority:f[11]||(f[11]=D=>k(d(e).params.id)),onAssignUser:f[12]||(f[12]=D=>k(d(e).params.id)),"sub-task-is-creatable":!d(a).task.closed_at},null,8,["subTasks","parent-id","tree-level","sub-task-is-creatable"])])):(s(),n("section",Os,[$(p)]))],64)):(s(),n("div",Rs,x(d(a).error),1)),o.value==="changing"?(s(),P(z,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):b("",!0)]))])}}};export{da as default};
