import{L as W}from"./LoaderView-BSfuDlKp.js";import{_ as I}from"./DepartmentChip-BYP7kliX.js";import{d as H,n as X,c as o,o as l,a as t,F as G,y as K,t as d,p as u,i as c,g as A,f as D,x as P,k as w,j as C,b as J,m as h,r as Y,e as Q,A as z,w as Z,h as q,v as ee,u as te}from"./index-IGFbykZ2.js";import{_ as S}from"./UserChip-B5_F6w0k.js";import{g as se}from"./task-nr573zuE.js";import{u as ae}from"./company-pNEjKsHS.js";import{_ as F}from"./CompanyDepartmentSelectInput-DvGRnqol.js";import{_ as le}from"./EmployeeDropdownInput-D2guPsoC.js";import{S as j}from"./SelectDropdown-KjHR8Ig_.js";import{u as oe}from"./useRequirementStore-BDCZjgFD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./url-CePbr-gY.js";import"./requirement-DDLzz7E5.js";const ne={class:"min-w-full bg-white border overflow-hidden table table-fixed"},re={key:0},de={class:"px-4 py-4 font-semibold text-xl text-gray-700 border border-gray-200 text-center"},ie={class:"px-4 py-4 min-w-[300px] md:min-w-[400px] border border-gray-200"},me={class:"space-y-4"},ue={class:"text-blue-800"},ce=["title"],pe={key:0},xe={class:"flex gap-6 items-center mt-6"},ye={key:0,class:"text-gray-600 text-xs flex items-center gap-2 whitespace-nowrap"},_e={class:"flex items-center gap-2 whitespace-nowrap"},be={class:"px-4 py-4 whitespace-nowrap border border-gray-200"},fe=["title"],ge={class:"flex items-center gap-2 mt-4"},ve={key:1},he={class:"flex items-center gap-2 mt-1"},we={key:1},ke={key:0,class:"text-xs text-red-300"},$e={key:1,class:"italic text-xs text-gray-400"},Ve={class:"px-4 py-4 whitespace-nowrap border border-gray-200"},Re=["title"],Ae={class:"flex items-center gap-2 mt-4"},Te={key:1},Se={key:0,class:"text-xs text-red-300"},De={key:1,class:"italic text-xs text-gray-400"},Ce={class:"flex items-center gap-2 mt-2"},Le={key:1},Ne={key:0,class:"text-xs text-red-300"},Ue={key:1,class:"italic text-xs text-gray-400"},Ee={class:"px-4 py-4 text-center whitespace-nowrap border border-gray-200"},Me={key:0,class:"text-gray-600 text-sm"},Pe={class:"mb-2 w-full flex flex-col justify-between items-start"},je={class:"mb-2 w-full flex flex-col justify-between items-start"},ze={class:"flex justify-between items-center gap-1"},Oe={key:1},Be={class:"px-4 py-4 text-center border border-gray-200"},Ie={class:"flex gap-4 items-center justify-center"},Fe={key:0,class:"absolute inset-0 flex flex-col items-center justify-center bg-white bg-opacity-50"},He={class:"flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},Ge={class:"text-sm flex items-center gap-2 text-red-400 font-semibold"},Ke={class:"mt-[2px]"},Je={class:"text-gray-800 flex items-center gap-2"},Qe={class:"flex gap-4 items-center justify-center"},We={__name:"RequirementTable",props:{requirements:{type:Array,default:()=>[]}},setup(N){const p=H();return(k,a)=>{var f;const x=X("RouterLink");return l(),o("table",ne,[a[22]||(a[22]=t("thead",{class:"bg-gray-100 text-gray-400 text-xs"},[t("tr",null,[t("th",{class:"px-4 py-0.5 text-center whitespace-nowrap border w-[4%]"},"#"),t("th",{class:"px-4 py-0.5 text-left whitespace-nowrap border w-[60%]"},"Requirement"),t("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"From Department"),t("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"To Department"),t("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"}),t("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"Actions")])],-1)),t("tbody",null,[((f=N.requirements)==null?void 0:f.length)===0?(l(),o("tr",re,a[4]||(a[4]=[t("td",{colspan:"10",class:"p-4"},[t("div",{class:"text-gray-500 italic w-full h-64 flex items-center justify-center"}," No Requirement Found ")],-1)]))):(l(!0),o(G,{key:1},K(N.requirements,(e,i)=>{var r,y,m,T,U,_,E,g,L,M,b,n,$,V,R,s,O;return l(),o("tr",{key:e.id,class:"border-t hover:bg-blue-50 odd:bg-gray-50 group/item relative"},[t("td",de,d(i+1),1),t("td",ie,[t("div",me,[u(x,{to:{name:"RequirementShow",params:{id:e==null?void 0:e.id}},class:"text-blue-600 text-sm hover:underline hover:text-blue-800 z-20"},{default:c(()=>{var v,B;return[t("div",ue,[t("div",{class:"line-clamp-1 font-semibold",title:e==null?void 0:e.title},d(e==null?void 0:e.title),9,ce)]),((v=e==null?void 0:e.details)==null?void 0:v.length)-1>0?(l(),o("span",pe,d(((B=e==null?void 0:e.details)==null?void 0:B.length)-1)+" More Requirement ",1)):A("",!0)]}),_:2},1032,["to"])]),t("div",xe,[e.created_at?(l(),o("div",ye,[a[5]||(a[5]=t("i",{class:"fas fa-clock text-sky-800/50"},null,-1)),t("div",null,d(new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)])):A("",!0),t("div",_e,[a[6]||(a[6]=t("span",{class:"text-xs text-gray-500"},"By:",-1)),e.created_by?(l(),D(S,{key:0,user:e.created_by,"avatar-size":"xsmall"},null,8,["user"])):A("",!0)]),e.priority?(l(),o("span",{key:1,class:P(["font-semibold text-sm border rounded-full px-2",{"bg-yellow-50 text-yellow-700 border-yellow-700 ":e.priority=="IMPORTANT","bg-red-700 text-red-50 ":e.priority=="URGENT"}])},d(e.priority),3)):A("",!0)])]),t("td",be,[t("span",{title:(r=e==null?void 0:e.from_department)==null?void 0:r.name,class:P([{"bg-green-500 text-white group-hover/item:text-white":((y=e==null?void 0:e.from_department)==null?void 0:y.id)==((T=(m=w(p))==null?void 0:m.user)==null?void 0:T.department_id)},"text-blue-500 font-semibold flex-shrink-0 border border-blue-500 bg-blue-50 rounded-full px-2 text-xs"])},d(((U=e==null?void 0:e.from_department)==null?void 0:U.short_name)||((_=e==null?void 0:e.from_department)==null?void 0:_.name)),11,fe),t("div",ge,[a[8]||(a[8]=t("div",{class:"text-xs text-gray-500"},"In Charge:",-1)),(E=e==null?void 0:e.from_department)!=null&&E.in_charge?(l(),D(S,{key:0,user:(g=e==null?void 0:e.from_department)==null?void 0:g.in_charge,"avatar-size":"xsmall"},null,8,["user"])):(l(),o("div",ve,a[7]||(a[7]=[t("span",{class:"italic text-xs text-gray-400"},"N/A",-1)])))]),t("div",he,[a[9]||(a[9]=t("div",{class:"text-xs text-gray-500"},"Coordinator:",-1)),e.from_coordinator?(l(),D(S,{key:0,user:e.from_coordinator,"avatar-size":"xsmall"},null,8,["user"])):(l(),o("div",we,[(L=e==null?void 0:e.from_department)!=null&&L.coordinator_id?(l(),o("div",ke," Approval Pending ")):(l(),o("div",$e,"N/A"))]))])]),t("td",Ve,[t("span",{title:(M=e==null?void 0:e.to_department)==null?void 0:M.name,class:P([{"bg-sky-500 !text-white  ":((b=e==null?void 0:e.to_department)==null?void 0:b.id)==(($=(n=w(p))==null?void 0:n.user)==null?void 0:$.department_id)},"text-sky-500 font-semibold flex-shrink-0 border border-sky-500 bg-blue-50 rounded-full px-2 text-xs"])},d(((V=e==null?void 0:e.to_department)==null?void 0:V.short_name)||((R=e==null?void 0:e.to_department)==null?void 0:R.name)),11,Re),t("div",Ae,[a[10]||(a[10]=t("div",{class:"text-xs text-gray-500"},"In Charge:",-1)),e.to_incharge?(l(),D(S,{key:0,user:e.to_incharge,"avatar-size":"xsmall"},null,8,["user"])):(l(),o("div",Te,[(s=e==null?void 0:e.to_department)!=null&&s.incharge_id?(l(),o("div",Se," Approval Pending ")):(l(),o("div",De,"N/A"))]))]),t("div",Ce,[a[11]||(a[11]=t("div",{class:"text-xs text-gray-500"},"Coordinator:",-1)),e.to_coordinator?(l(),D(S,{key:0,user:e.to_coordinator,"avatar-size":"xsmall"},null,8,["user"])):(l(),o("div",Le,[(O=e==null?void 0:e.to_department)!=null&&O.coordinator_id?(l(),o("div",Ne," Approval Pending ")):(l(),o("div",Ue,"N/A"))]))])]),t("td",Ee,[e.submission_date?(l(),o("div",Me,[t("div",Pe,[a[12]||(a[12]=t("span",{class:"text-xs font-bold"},"Submitted:",-1)),t("div",null,d(new Date(e.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))+" "+d(new Date(e.submission_date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),t("div",je,[a[13]||(a[13]=t("span",{class:"text-xs font-bold"},"Better To Complete:",-1)),t("div",null,d(new Date(e.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))+" "+d(new Date(e.submission_date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),t("div",ze,[a[14]||(a[14]=t("span",{class:"text-xs font-bold"},"Status:",-1)),t("span",{class:P(["border rounded-lg px-2 py-0.5 text-xs",{"bg-red-300 text-red-700 border-red-400":e.status!="approved","bg-green-300 text-green-700 border-green-400":e.status=="approved"}])},d(String(e.status).toUpperCase()),3)])])):(l(),o("div",Oe,"-"))]),t("td",Be,[t("div",Ie,[u(x,{to:{name:"RequirementShow",params:{id:e==null?void 0:e.id}},class:"btn-2",onClick:a[0]||(a[0]=v=>v.stopPropagation())},{default:c(()=>a[15]||(a[15]=[t("i",{class:"fad fa-eye"},null,-1),C(" Show ")])),_:2,__:[15]},1032,["to"]),u(x,{to:{name:"RequirementEdit",params:{id:e==null?void 0:e.id}},class:"btn-4 border border-blue-500 hover:bg-blue-500 hover:text-white",onClick:a[1]||(a[1]=v=>v.stopPropagation())},{default:c(()=>a[16]||(a[16]=[t("i",{class:"fad fa-edit"},null,-1),C(" Edit ")])),_:2,__:[16]},1032,["to"])]),e.closed_at?(l(),o("div",Fe,[t("div",He,[t("div",Ge,[a[17]||(a[17]=t("span",{class:"fad fa-lock"},null,-1)),a[18]||(a[18]=t("span",{class:"mt-[2px]"},"CLOSED AT",-1)),t("span",Ke,d(new Date(e.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),t("div",Je,[a[19]||(a[19]=t("span",{class:"text-sm"},"Closed by",-1)),u(S,{user:e.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])]),t("div",Qe,[u(x,{to:{name:"RequirementShow",params:{id:e==null?void 0:e.id}},class:"btn-2 h-6",onClick:a[2]||(a[2]=v=>v.stopPropagation())},{default:c(()=>a[20]||(a[20]=[t("i",{class:"fad fa-eye"},null,-1),C(" Show ")])),_:2,__:[20]},1032,["to"]),u(x,{to:{name:"RequirementEdit",params:{id:e==null?void 0:e.id}},class:"btn-4 h-6 border border-blue-500 hover:bg-blue-500 hover:text-white",onClick:a[3]||(a[3]=v=>v.stopPropagation())},{default:c(()=>a[21]||(a[21]=[t("i",{class:"fad fa-edit"},null,-1),C(" Edit ")])),_:2,__:[21]},1032,["to"])])])])):A("",!0)])])}),128))])])}}},Xe={class:"flex flex-wrap items-center w-full gap-2"},Ye={class:"flex flex-wrap items-center justify-center gap-x-4 gap-y-3 ml-auto"},Ze={class:"relative"},qe=["title"],et={key:1},tt=["user","title"],st={key:1},at=["user","title"],lt={key:1},ot={key:1,class:"relative lg:flex-grow"},nt={key:0,class:"flex items-center gap-1 overflow-hidden"},rt={key:1},dt={class:"relative"},it=["user"],mt={key:1},ut={class:"relative"},ct=["user"],pt={key:1},xt={class:"text-gray-600 max-w-40 relative rounded h-8 border border-gray-300 bg-white"},yt={class:"!text-sm h-full"},_t={key:0,class:"text-sm bg-white absolute top-0 bottom-0 left-2 right-8 flex items-center"},bt={__name:"RequirementHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask","clickAdd"],setup(N,{emit:p}){const k=N,a=H(),x=J(),f=h(g("company-id")),e=h(g("from-department-id")),i=h(g("to-department-id")),r=h(g("created-by")),y=h(g("month")),m=h(g("priority")),T=h(g("status")),U=p,_=ae(),E=Y([]);function g(b){return{get:()=>k.modelValue[b]||"",set:n=>{U("update:modelValue",{...k.modelValue,[b]:n||void 0})}}}async function L(){var b,n,$;if(!k.isMyTask){const V=(b=k.modelValue)==null?void 0:b["company-id"],R=i.value,s={...V?{company_id:V}:{},...R?{department_ids:[R]}:{}};E.value=(($=(n=await se({params:s}))==null?void 0:n.data)==null?void 0:$.employees)||[]}}Q(async()=>{await _.fetchCompanies({with:"departments",ignore_permission:!0}),await _.fetchMyCompanies({with:"departments"}),await L()}),z(()=>i.value,L),z(()=>f.value,()=>{e.value="",i.value="",r.value="",L()});const M=h(()=>f.value?_==null?void 0:_.companies.filter(b=>b.id==f.value):_==null?void 0:_.companies);return(b,n)=>{var $,V,R;return l(),o("div",null,[t("div",Xe,[n[14]||(n[14]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Requirements",-1)),t("button",{onClick:n[0]||(n[0]=Z(s=>U("clickAdd"),["prevent"])),class:"btn-icon size-8 border border-gray-400"},n[8]||(n[8]=[t("i",{class:"fas fa-plus text-sm"},null,-1)])),t("div",Ye,[t("div",Ze,[u(j,{modelValue:f.value,"onUpdate:modelValue":n[1]||(n[1]=s=>f.value=s),options:(($=w(_))==null?void 0:$.companies)||[],label:"name",id:"id",class:"border border-gray-300 rounded h-8 bg-white !text-sm",clearable:""},{"selected-option":c(({option:s})=>[s?(l(),o("span",{key:0,title:s==null?void 0:s.name,class:"max-w-28 line-clamp-1"},d(s==null?void 0:s.name),9,qe)):(l(),o("span",et,"Company"))]),_:1},8,["modelValue","options"])]),u(F,{modelValue:e.value,"onUpdate:modelValue":n[2]||(n[2]=s=>e.value=s),companies:M.value||[],class:"relative",className:{select:"border border-gray-300 rounded h-8 bg-white !text-sm"},defaultOption:"--ALL DEPARTMENT--"},{label:c(()=>n[9]||(n[9]=[t("span",null,null,-1)])),selectedOption:c(({option:s})=>[s?(l(),o("span",{key:0,user:s,"avatar-size":"xsmall",class:"max-w-28 line-clamp-1",title:s==null?void 0:s.name},[n[10]||(n[10]=t("span",{class:"text-gray-400"},"From:",-1)),C(" "+d((s==null?void 0:s.short_name)||(s==null?void 0:s.name)),1)],8,tt)):(l(),o("span",st,"From Department"))]),_:1},8,["modelValue","companies"]),w(x).name!=="MyTaskList"?(l(),D(F,{key:0,modelValue:i.value,"onUpdate:modelValue":n[3]||(n[3]=s=>i.value=s),companies:M.value||[],class:"relative",className:{select:"border border-gray-300 rounded h-8 bg-white !text-sm"},defaultOption:"--ALL DEPARTMENT--"},{label:c(()=>n[11]||(n[11]=[t("span",null,null,-1)])),selectedOption:c(({option:s})=>[s?(l(),o("span",{key:0,user:s,"avatar-size":"xsmall",class:"max-w-28 line-clamp-1",title:s==null?void 0:s.name},[n[12]||(n[12]=t("span",{class:"text-gray-400"},"To:",-1)),C(" "+d((s==null?void 0:s.short_name)||(s==null?void 0:s.name)),1)],8,at)):(l(),o("span",lt,"To Department"))]),_:1},8,["modelValue","companies"])):A("",!0),w(a).isAdminMood&&((R=(V=w(a))==null?void 0:V.user)==null?void 0:R.role)!=="employee"?(l(),o("div",ot,[u(le,{employees:E.value,modelValue:r.value,"onUpdate:modelValue":n[4]||(n[4]=s=>r.value=s),class:"border border-gray-300 rounded h-8 bg-white max-w-64 !text-sm"},{selectedOption:c(({option:s})=>[s?(l(),o("span",nt,[n[13]||(n[13]=t("span",{class:"text-gray-400"},"User: ",-1)),u(S,{user:s,"avatar-size":"xsmall",class:"inline"},null,8,["user"])])):(l(),o("span",rt,"Employee"))]),_:1},8,["employees","modelValue"])])):A("",!0),t("div",dt,[u(j,{modelValue:m.value,"onUpdate:modelValue":n[5]||(n[5]=s=>m.value=s),searchable:!1,clearable:!0,options:[{label:"--Any Priority--",id:""},{label:"Normal",id:"normal"},{label:"IMPORTANT",id:"IMPORTANT"},{label:"URGENT",id:"URGENT"}],class:"border border-gray-300 rounded h-8 bg-white !text-sm"},{"selected-option":c(({option:s})=>[s?(l(),o("span",{key:0,user:s,"avatar-size":"xsmall",class:"max-w-28 line-clamp-1"},d(s==null?void 0:s.label),9,it)):(l(),o("span",mt,"Priority"))]),_:1},8,["modelValue"])]),t("div",ut,[u(j,{modelValue:T.value,"onUpdate:modelValue":n[6]||(n[6]=s=>T.value=s),searchable:!1,clearable:!0,options:[{label:"--ALL Status--",id:""},{label:"Pending",id:"pending"},{label:"Approved",id:"approved"},{label:"Rejected",id:"rejected"}],class:"border border-gray-300 rounded h-8 bg-white !text-sm"},{"selected-option":c(({option:s})=>[s?(l(),o("span",{key:0,user:s,"avatar-size":"xsmall",class:"max-w-28 line-clamp-1"},d(s==null?void 0:s.label),9,ct)):(l(),o("span",pt,"Status"))]),_:1},8,["modelValue"])]),t("div",xt,[t("div",yt,[y.value?A("",!0):(l(),o("label",_t," Month ")),q(t("input",{id:"month-filter","onUpdate:modelValue":n[7]||(n[7]=s=>y.value=s),type:"month",class:"rounded h-full !text-sm px-4 w-full",placeholder:"All month"},null,512),[[ee,y.value]])])])])])])}}},ft={class:"container mx-auto"},gt={class:"bg-white shadow-md rounded-lg p-4"},vt={key:1,class:"text-center py-4 text-red-500"},ht={key:2,class:"text-center py-4 text-gray-500 min-h-[50vh] flex items-center justify-center border rounded-md"},wt={key:3,class:"space-y-6"},kt={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},$t={class:"font-semibold flex items-center gap-2"},Vt={class:"rounded-b-md overflow-x-auto border-x xl:border-x-0"},zt={__name:"RequirementList",setup(N){const p=oe(),k=te(),a=J(),x=h({get(){return{...a.query}},set(i){k.push({query:{...i}})}});Q(()=>{console.log("Requirement List Mounted"),p.fetchRequirements(x.value)}),z(()=>({...x.value}),async function(i){p.fetchRequirements(i)});const f=()=>{k.push({name:"RequirementAdd"})},e=h(()=>(p.requirements||[]).reduce((i,r)=>{const y=`${r.from_department_id}-${r.to_department_id}`,m=i.find(T=>T.key==y);return m?m.requirements=[...m.requirements,r]:i.push({key:y,from_department:r.from_department,to_department:r.to_department,requirements:[r]}),i},[]));return(i,r)=>{var y;return l(),o("div",ft,[t("div",gt,[u(bt,{modelValue:x.value,"onUpdate:modelValue":r[0]||(r[0]=m=>x.value=m),onClickAdd:f,class:"mb-4"},null,8,["modelValue"]),w(p).loading?(l(),D(W,{key:0,class:"sm:min-h-64 lg:min-h-96 shadow-none flex items-center justify-center"},{default:c(()=>r[1]||(r[1]=[C(" Loading requirements... ")])),_:1,__:[1]})):w(p).error?(l(),o("div",vt,d(w(p).error),1)):((y=w(p).requirements)==null?void 0:y.length)===0?(l(),o("div",ht," No Requirements ")):(l(),o("div",wt,[(l(!0),o(G,null,K(e.value,m=>(l(),o("div",{key:m.key,class:"rounded-md border-2 border-sky-300"},[t("div",kt,[t("div",$t,[r[2]||(r[2]=t("span",{class:"text-white text-sm"},"From",-1)),u(I,{department:m.from_department},null,8,["department"]),r[3]||(r[3]=t("span",{class:"text-white text-sm"},"To",-1)),u(I,{department:m.to_department},null,8,["department"])])]),t("div",Vt,[u(We,{requirements:m.requirements},null,8,["requirements"])])]))),128))]))])])}}};export{zt as default};
