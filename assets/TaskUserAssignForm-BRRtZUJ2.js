import{d as F,r as f,q as U,e as N,c as i,o as l,a as o,t as g,h as V,w as A,f as O,l as y,p as h,F as q,x as E,m as L,b as M,u as R}from"./index-FFQob3Ky.js";import{_ as z}from"./MultiselectDropdown-B2_9sdpF.js";import{_ as I}from"./UserChip-DQYGpQgu.js";import{u as D}from"./company-B-ukXYqW.js";import{u as j}from"./useTaskStore-DGrBxAU9.js";import{u as G}from"./user-Blza303b.js";import"./vue-multiselect.esm-CaksV9Rh.js";const H={class:"container mx-auto p-6"},J={class:"max-w-xl mx-auto bg-white shadow-lg rounded-lg p-6"},K={class:"text-xl font-semibold text-gray-800 mb-4"},P={key:0,class:"text-center text-gray-500 py-4"},Q={class:"mb-4"},W={class:"mb-2 flex flex-wrap gap-2"},X=["onClick"],Y={key:0,class:"mb-4 text-red-500 font-medium"},Z={class:"flex items-center gap-4"},ee=["disabled"],se={__name:"TaskUserAssignForm",props:{taskId:{type:[Number,String],required:!0}},emits:["success","cancelClick"],setup(x,{emit:k}){const t=j(),b=D(),d=G(),m=F(),r=f([]),w=U(()=>r.value.map(a=>a.id)),n=f(!1),p=f(null),v=f([]),S=x,C=k;N(async()=>{var a,e,u,s,c,_;n.value=!0,await t.fetchTask(S.taskId,{with_parent:"true"}),t.task.parent?v.value=((e=(a=t.task)==null?void 0:a.parent)==null?void 0:e.users)||[]:((u=m.user)==null?void 0:u.role)==="employee"?v.value=((_=(c=await b.fetchEmployees((s=m.user)==null?void 0:s.company_id))==null?void 0:c.data)==null?void 0:_.employees)||[]:(await d.fetchUsers(),v.value=d.users),r.value=t.task.users,n.value=!1});const $=U(()=>v.value.filter(a=>!r.value.find(e=>e.id===a.id))),T=async()=>{n.value=!0,p.value=null;try{await t.assignUsers(S.taskId,w.value),C("success")}catch(a){p.value=a.message||"Assign users failed"}finally{n.value=!1}};return(a,e)=>{var u;return l(),i("div",H,[o("div",J,[o("h2",K,' Assign Users to Task: "'+g((u=V(t).task)==null?void 0:u.title)+'" ',1),n.value?(l(),i("div",P,"Loading users...")):(l(),i("form",{key:1,onSubmit:A(T,["prevent"])},[o("div",Q,[e[2]||(e[2]=o("label",{class:"block text-gray-700 font-medium"},"Select Users",-1)),y(z,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),options:$.value,multiple:!0,"track-by":"id",label:"label",placeholder:"Select users"},{selection:h(({...s})=>[o("div",W,[(l(!0),i(q,null,E((s==null?void 0:s.values)||[],c=>(l(),L(I,{key:c.id,user:c},{after:h(({user:_})=>[o("button",{class:"size-6 border rounded-full hover:bg-red-400 hover:text-white",onClick:A(ae=>r.value=r.value.filter(B=>B.id!==_.id),["prevent"])}," Ã— ",8,X)]),_:2},1032,["user"]))),128))])]),option:h(({option:s})=>[y(I,{user:s},null,8,["user"])]),_:1},8,["modelValue","options"])]),p.value?(l(),i("div",Y,g(p.value),1)):O("",!0),o("div",Z,[o("button",{disabled:n.value,type:"submit",class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-5 py-2 rounded transition"},g(n.value?"Assigning...":"Assign Users"),9,ee),o("button",{type:"button",onClick:e[1]||(e[1]=s=>C("cancelClick")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32))])])}}},te={class:"container mx-auto p-6"},de={__name:"TaskUserAssignForm",setup(x){const k=M(),t=R(),b=k.params.id,d=()=>{t.back()},m=()=>{t.back()};return(r,w)=>(l(),i("div",te,[y(se,{taskId:V(b),onSuccess:d,onCancelClick:m},null,8,["taskId"])]))}};export{de as default};
