import{H as E,r as v,y as i,I as f}from"./index-6-7E_vKF.js";const O=E("task",()=>{const o=v([]),k=v(null),u=v(!1),c=v(null),p=async(e,r)=>{var a,s;u.value=!0,c.value=null;try{await f.post(`/tasks/${e}/assign-users`,{user_ids:r}),await y(e)}catch(l){throw c.value=((s=(a=l.response)==null?void 0:a.data)==null?void 0:s.message)||"Assign users failed",l}finally{u.value=!1}},T=async(e,{loadingBeforeFetch:r=!0})=>{var a,s,l;r&&(u.value=!0),c.value=null;try{const t=await f.get("/tasks",{params:e});o.value=((a=t.data)==null?void 0:a.tasks)||[]}catch(t){c.value=((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",t)}finally{u.value=!1}};function g(e,r=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>a.parent_id===r).map(a=>({...a,children_tasks:g(e,a.id)}))}function h(){return g(o.value,0)}function m(){const e=[],r=(a,s=0,l="")=>{a.forEach(t=>{e.push({...t,depth:s,idPath:l+t.id}),t.children_tasks&&t.children_tasks.length&&r(t.children_tasks,s+1,l+t.id+"-")})};return r(h()),e}const y=async(e,r={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var s,l,t;a.fetchOnly||(u.value=!0),c.value=null;try{const n=await f.get(`/tasks/${e}`,{params:r});return a.fetchOnly||(k.value=((s=n.data)==null?void 0:s.task)||{}),n.data}catch(n){const d=((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(c.value=d),d}finally{a.fetchOnly||(u.value=!1)}},w=async(e,r={loadingBeforeCreate:!1})=>{var a,s,l,t;r.loadingBeforeCreate&&(u.value=!0),c.value=null;try{const n=await f.post("/tasks",e);return(a=n.data)!=null&&a.data&&o.value.push((s=n.data)==null?void 0:s.data),n.data.data}catch(n){c.value=((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",n)}finally{r.loadingBeforeCreate&&(u.value=!1)}},$=async(e,r,a={loadingBeforeFetch:!0})=>{var s,l;a.loadingBeforeFetch&&(u.value=!0),c.value=null;try{const t=await f.put(`/tasks/${e}`,r),n=o.value.findIndex(d=>d.id===e);return n!==-1&&(o.value[n]=t.data.data),t.data.data}catch(t){c.value=((l=(s=t.response)==null?void 0:s.data)==null?void 0:l.message)||`টাস্ক (ID: ${e}) আপডেট করতে ব্যর্থ হয়েছে।`,console.error(`Error updating task with id ${e}:`,t)}finally{a.loadingBeforeFetch&&(u.value=!1)}},B=async e=>{var r,a;u.value=!0,c.value=null;try{await f.delete(`/tasks/${e}`),o.value=o.value.filter(s=>s.id!==e)}catch(s){c.value=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,s)}finally{u.value=!1}};return{tasks:i(()=>o.value),task:i(()=>k.value),loading:i(()=>u.value),error:i(()=>c.value),taskListTree:i(h),flattenedTasks:i(m),fetchTasks:T,fetchTask:y,createTask:w,updateTask:$,deleteTask:B,assignUsers:p}});export{O as u};
