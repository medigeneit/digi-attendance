import{d as X,b as tt,p as I,r as A,c as n,o as a,a as t,g as f,s as Y,F as N,k as r,w as U,t as x,y as C,i as P,z as Z,f as E,h as et,A as St,m as $t,e as st,K as Dt,q as J,j as D,v as Tt,x as K,G as It,H as xt,n as q,u as Et,C as bt,_ as Pt}from"./index-BYeQPT0g.js";import{L as Q}from"./LoaderView-CkB2n-R6.js";import{O as z}from"./OverlyModal-CjvKL_NW.js";import{_ as Lt}from"./DescriptionView-Cj4HrbAz.js";import{m as Ut,_ as At}from"./task-tree-BpXozWvU.js";import{_ as Mt}from"./TaskAddForm-DRFoogIs.js";import{_ as Nt}from"./TaskEditForm-DgoRqpyH.js";import{_ as jt}from"./TaskTreeView-Xq0oDuU-.js";import{a as Ot,_ as Rt}from"./TaskUserAssignForm-C7OgE5Z2.js";import{u as Bt}from"./task-priority-DSRVzVih.js";import{c as Ft,d as Vt,T as Gt,b as qt}from"./TaskSupervisorAndEmployee-Bs9Ug6eD.js";import{r as Ht,d as zt,u as Kt}from"./task-B7unkLT4.js";import{b as W,g as Wt,d as Zt}from"./datetime-C4Yr_jSk.js";import{_ as gt}from"./UserChip-CMdQw1kG.js";import{_ as Yt}from"./TaskStatus-D1S14YAc.js";import{s as _t}from"./dom-BKn8Ftnz.js";import{u as Jt}from"./useTaskStore-Ba23_2pS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-CLWRCV3K.js";import"./company-8ObuGlDp.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-C02i3wWK.js";import"./SelectDropdown-BWVHQCTn.js";import"./SectionLoading-CnZgms_l.js";import"./TextWithHr-G4FMb7c9.js";import"./TaskUrgencyInput-DzAUd6rD.js";import"./tags-BjMkZiCQ.js";import"./MultiselectDropdown-Bo598pX2.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BVQEJBuy.js";import"./user-DlrCG3sR.js";import"./TaskUserChip-Bf0VTWFN.js";const Qt={class:"mb-3"},Xt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},te={key:1,class:"text-center py-4 text-gray-500"},ee={key:2,class:"text-center py-4 text-red-500"},se={key:3,class:"space-y-4"},ae={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(p,{emit:l}){const s=p,d=X(),i=tt(),u=I(()=>{var v;return!!(((v=d==null?void 0:d.user)==null?void 0:v.role)!=="employee"&&(d!=null&&d.isAdminMood))}),b=l,y=A(null),{handleItemsPriorityUpdate:o,saveTaskPriority:k,listHasRearranged:c}=Bt(()=>s.tasks,s.parentId),T=async()=>{await k(),b("updatePriority")};return(v,g)=>(a(),n("div",null,[t("div",Qt,[Y(v.$slots,"task:header")]),u.value?(a(),n(N,{key:0},[r(c)?(a(),n("div",Xt,[g[4]||(g[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:U(T,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:g[0]||(g[0]=U((...S)=>y.value.resetItems&&y.value.resetItems(...S),["prevent"]))},"Discard")])):f("",!0)],64)):f("",!0),p.loading?(a(),n("div",te,"Loading tasks...")):p.error?(a(),n("div",ee,x(p.error),1)):(a(),n("div",se,[C(Ot,{items:p.tasks,handle:"handle",onItemsUpdate:r(o),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:y},{item:P(({item:S,index:j})=>[C(jt,{isMyTask:r(i).name=="MyTaskShow",index:j,task:S,showDraggableHandle:u.value,"tree-level":p.treeLevel,class:"!border-0",onCommentButtonClick:L=>b("commentButtonClick",S.id),onEditClick:g[1]||(g[1]=L=>b("editClick",L)),onAddClick:g[2]||(g[2]=L=>b("addClick",L)),onEmployeeAssignClick:g[3]||(g[3]=L=>b("employeeAssignClick",L))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},le={class:"flex justify-between mt-5"},ne={class:"flex justify-between items-center gap-4"},oe={class:"w-32 relative h-8 mx-4"},re={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},ie={key:3,class:"border p-4 rounded text-center text-gray-500 italic"},de={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(p,{emit:l}){const s=p,d=tt(),i=X(),u=A(""),b=A("not-completed"),y=Z({taskId:0,isOpen:!1}),o=l,k=A(),c=Z({show:!1,parentId:s.parentId,requirementId:null}),T=M=>{c.show=!0,c.parentId=M};function v(){c.show=!1,c.parentId=s.parentId,o("created")}function g(){o("assignUser")}function S(){k.value=!1,o("updated")}function j(){c.show=!1,c.parentId=s.parentId}const L=I(()=>{var M;return Array.isArray(s.subTasks)?Ut(s.subTasks,{status:b.value,...d.name=="MyTaskShow"?{"user-ids":(M=i==null?void 0:i.user)==null?void 0:M.id}:{}}).filter(_=>{var m,e,w;return u.value?(w=(m=_==null?void 0:_.title)==null?void 0:m.toUpperCase())==null?void 0:w.includes((e=u.value)==null?void 0:e.toUpperCase()):!0}):[]});return(M,_)=>{var m;return a(),n("div",null,[k.value?(a(),E(z,{key:0},{default:P(()=>[C(Nt,{taskId:k.value,onClose:_[0]||(_[0]=e=>k.value=null),onUpdated:S},null,8,["taskId"])]),_:1})):f("",!0),c.show?(a(),E(z,{key:1},{default:P(()=>[C(Mt,{parentTaskId:c.parentId,requirementId:c.requirementId,onTaskCreated:v,onError:M.handleTaskError,onClose:j},null,8,["parentTaskId","requirementId","onError"])]),_:1})):f("",!0),y.isOpen?(a(),E(z,{key:2},{default:P(()=>[C(Rt,{taskId:y.taskId,onCancelClick:_[1]||(_[1]=()=>{y.isOpen=!1,y.taskId=0}),onSuccess:_[2]||(_[2]=()=>{y.isOpen=!1,y.taskId=0,g()})},null,8,["taskId"])]),_:1})):f("",!0),C(ae,{tasks:L.value,parentId:p.parentId,treeLevel:p.treeLevel,onAddClick:_[6]||(_[6]=e=>T(e)),onEditClick:_[7]||(_[7]=e=>k.value=e),onUpdatePriority:_[8]||(_[8]=e=>o("updatePriority")),onEmployeeAssignClick:_[9]||(_[9]=e=>{y.taskId=e,y.isOpen=!0})},{"task:header":P(()=>{var e;return[t("div",le,[t("div",ne,[_[12]||(_[12]=t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks",-1)),((e=s==null?void 0:s.subTasks)==null?void 0:e.length)>0?(a(),n(N,{key:0},[C(At,{modelValue:u.value,"onUpdate:modelValue":_[3]||(_[3]=w=>u.value=w),class:"w-full md:w-48 md:ml-auto h-8","debounce-time":0},null,8,["modelValue"]),t("div",oe,[_[11]||(_[11]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),et(t("select",{"onUpdate:modelValue":_[4]||(_[4]=w=>b.value=w),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},_[10]||(_[10]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[St,b.value]])])],64)):f("",!0)]),p.subTaskIsCreatable?(a(),n("div",re,[t("button",{class:"btn-1 ml-auto",onClick:_[5]||(_[5]=U(()=>T(p.parentId),["prevent"]))}," Add Sub Task ")])):f("",!0)])]}),_:1},8,["tasks","parentId","treeLevel"]),((m=L.value)==null?void 0:m.length)===0&&p.treeLevel<=2?(a(),n("div",ie," No Sub Tasks ")):f("",!0)])}}},ue={key:0},ce={key:0},pe={key:1},ke={key:2},me={key:3},fe={key:1},ye=$t({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(p){const l=p;let s=0;const d=A(b());let i;function u(){return l.millisecond&&typeof l.millisecond=="number"}function b(){u()?s&&(s-=1e3):s=new Date(l.targetDateTime).getTime()-new Date().getTime();const v=Math.floor(s/1e3%60),g=Math.floor(s/1e3/60%60),S=Math.floor(s/(1e3*60*60)%24),j=Math.floor(s/(1e3*60*60*24));return{total:s,days:j,hours:S,minutes:g,seconds:v}}function y(){d.value=b()}st(()=>{u()&&(s=l.millisecond),console.log("MOUNTED"),y(),i=setInterval(()=>{y(),d.value.total<=0&&clearInterval(i)},1e3)}),Dt(()=>clearInterval(i)),J(()=>l.targetDateTime,()=>{y(),clearInterval(i)});const o=I(()=>d.value.days.toString().padStart(2,"0")),k=I(()=>d.value.hours.toString().padStart(2,"0")),c=I(()=>d.value.minutes.toString().padStart(2,"0")),T=I(()=>d.value.seconds.toString().padStart(2,"0"));return(v,g)=>d.value.total>0?(a(),n("span",ue,[!v.hideIfZeroValue||o.value!="00"?(a(),n("span",ce,x(o.value)+"d : ",1)):f("",!0),!v.hideIfZeroValue||k.value!="00"?(a(),n("span",pe,x(k.value)+"h : ",1)):f("",!0),!v.hideIfZeroValue||c.value!="00"?(a(),n("span",ke,x(c.value)+"m : ",1)):f("",!0),!v.hideIfZeroValue||T.value!="00"?(a(),n("span",me,x(T.value)+"s",1)):f("",!0)])):(a(),n("span",fe,[Y(v.$slots,"expired")]))}}),ve={class:"mb-2 mt-6"},xe={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},be={class:"flex justify-center"},ge={class:"py-6 w-full text-center"},_e={class:"block mb-2"},he={class:"font-semibold text-red-600 mx-2 text-xl"},$e={class:"mt-2"},Te={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},we={class:"flex justify-between items-center"},Ce={key:1,class:"btn-3"},Se={key:2,class:"btn-2 bg-green-600 bg-none"},De={key:3,class:"btn-2-red"},ht=5e3,Ie={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(p,{emit:l}){const s=p,d=A(""),i=A(""),u=l,b=A("");let y=0;async function o(){var T,v;if(!d.value)return b.value="Type the task title on input box";clearTimeout(y);try{b.value="",i.value==="deleted"?(i.value="restoring",await Ht(s.task.id),i.value="restored"):(i.value="deleting",await zt(s.task.id,{params:{security_check:encodeURIComponent(d.value)}}),i.value="deleted"),i.value=="deleted"?y=setTimeout(()=>{c()},ht):u("closeClick")}catch(g){i.value="error",b.value=((v=(T=g.response)==null?void 0:T.data)==null?void 0:v.message)||`Failed to update ${s.type}`}}function k(){i.value==="deleted"&&c(),u("closeClick")}function c(){i.value="",u("delete")}return(T,v)=>{var g,S;return a(),n("form",{class:"p-4 relative",onSubmit:U(o,["prevent"])},[v[7]||(v[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",ve,[v[1]||(v[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,x((g=p.task)==null?void 0:g.title),1)]),i.value=="deleted"?(a(),n("div",xe,v[2]||(v[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(a(),n(N,{key:1},[t("div",be,[t("div",ge,[t("label",_e,[v[3]||(v[3]=D(" Type ")),t("span",he,x((S=p.task)==null?void 0:S.title),1),v[4]||(v[4]=D(" and submit to delete "))]),et(t("input",{type:"text","onUpdate:modelValue":v[0]||(v[0]=j=>d.value=j),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[Tt,d.value]])])]),v[5]||(v[5]=t("hr",null,null,-1)),t("div",$e,[b.value?(a(),n("div",Te,x(b.value),1)):f("",!0)])],64)),t("div",we,[i.value=="deleted"?(a(),n("button",{key:0,class:"btn-2-red",type:"button",onClick:U(k,["prevent"])}," Delete ")):(a(),n("button",Ce,"Close")),i.value=="deleted"?(a(),n("button",Se,[v[6]||(v[6]=D(" Undo Delete in ")),i.value=="deleted"?(a(),E(ye,{key:0,"hide-if-zero-value":!0,millisecond:ht})):f("",!0)])):(a(),n("button",De,"Delete"))]),i.value=="deleting"||i.value=="restoring"?(a(),E(Q,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:P(()=>[D(x(String(i.value).charAt(0).toUpperCase()+String(i.value).slice(1)),1)]),_:1})):f("",!0)],32)}}},Ee=p=>p==null?void 0:p.reduce((l,s)=>l+s.task_weight,0),wt=(p,l)=>{const s=Ee(p);return p.map(d=>{const i=l.filter(u=>u.user_id===d.id).reduce((u,b)=>u+b.progress,0);return{...d,task_progress:Math.floor(i*(d.task_weight/s)),user_progress:i}})},Pe=(p,l)=>{let s=0;const d=[],i=y=>y.status==="COMPLETED",u=y=>y.users.some(o=>o.id===l),b=(y,o)=>{y.forEach(k=>{const c=u(k);d[o]=d[o]||{user_id:l,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const T=c&&k.children_tasks.length===0;d[o].total_assigned+=c?1:0,d[o].total_assigned_on_leaf_task+=T?1:0,s+=T?1:0,c&&i(k)&&(d[o].completed_count++,k.children_tasks.length),k.children_tasks.length>0&&b(k.children_tasks,o+1)})};return b(p,0),{sub_task_infos:d,assigned_on_any_leaf_task:s>0}},Le=(p,l)=>p.map(s=>({...s,...Pe(l,s.id)})),Ue={key:0,class:"min-w-full bg-white rounded overflow-hidden"},Ae={class:"py-0.5 text-bg font-semibold"},Me={class:"bg-gray-50"},Ne={class:"px-2 py-1 border-y"},je={class:"px-2 py-1 border-y"},Oe={key:0,class:"text-sm text-gray-400"},Re={key:1},Be={key:1,class:"min-w-full bg-white rounded overflow-hidden"},Fe={class:"py-0.5 text-bg font-semibold"},Ve={class:"px-2 py-1 border-y text-center"},Ge={class:"px-2 py-1 border-y border-r"},qe={class:"px-2 py-1 border-y text-center"},He={class:"px-2 py-1 border-y text-center"},ze=$t({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(p){const l=p,s=I(()=>wt(l.task.users,l.task.task_reports||[])),d=I(()=>Le(l.task.users,l.subTasks));return(i,u)=>{var b,y;return l.task.children_task_count>0?(a(),n("table",Ue,[t("caption",Ae,[Y(i.$slots,"caption",{},()=>[u[0]||(u[0]=D("Progress"))])]),t("thead",Me,[t("tr",null,[u[1]||(u[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),u[2]||(u[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(a(!0),n(N,null,K(((y=(b=d.value[0]||{})==null?void 0:b.sub_task_infos)==null?void 0:y.length)||1,o=>(a(),n("th",{key:o,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},x(o===1?"Completed Sub Task":"")+" "+x(o===2?"Completed Sub Sub Task":"")+" "+x(o===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(a(!0),n(N,null,K(d.value,(o,k)=>(a(),n("tr",{key:o.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ne,x(k+1),1),t("td",je,[C(gt,{user:o},null,8,["user"])]),(a(!0),n(N,null,K(o.sub_task_infos,(c,T)=>(a(),n("td",{class:"px-2 py-1 border-y text-center",key:T},[c.total_assigned===0||!o.assigned_on_any_leaf_task?(a(),n("div",Oe," Not Assigned To Any Task ")):(a(),n("div",Re,x(c.completed_count)+" / "+x(c.total_assigned),1))]))),128))]))),128))])])):(a(),n("table",Be,[t("caption",Fe,[Y(i.$slots,"caption",{},()=>[u[3]||(u[3]=D("Progress"))])]),u[4]||(u[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(a(!0),n(N,null,K(s.value,(o,k)=>(a(),n("tr",{key:o.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ve,x(k+1),1),t("td",Ge,[C(gt,{user:o},null,8,["user"])]),t("td",qe,x(r(W)(o.task_started_at)),1),t("td",He,x(r(W)(o.task_finished_at)),1)]))),128))])]))}}}),Ke=It("task-user",()=>({updateUserStartDate:async(s,d,i)=>await xt.patch(`/task-user/task/${s}/user/${d}/update-start-date/${i}`),updateUserFinishDate:async(s,d,i)=>await xt.patch(`/task-user/task/${s}/user/${d}/update-finish-date/${i}`)})),We={class:"border-b text-center"},Ze={key:0},Ye={key:1},Je={class:"text-center font-semibold text-blue-800 my-4"},Qe={class:"flex justify-center w-full"},Xe={class:"py-6 w-4/12"},ts={class:"block text-xs font-semibold"},es={class:"mt-3"},ss={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},as={class:"flex justify-between items-center"},Ct={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(p,{emit:l}){const s=p,d=l,i=Ke(),u=A(""),b=A("");async function y(){var k,c;console.log({date:u.value});try{s.type=="start-date"?await i.updateUserStartDate(s.task.id,s.user.id,u.value||"0"):s.type=="finish-date"&&await i.updateUserFinishDate(s.task.id,s.user.id,u.value||"0"),d("updateDate")}catch(T){b.value=((c=(k=T.response)==null?void 0:k.data)==null?void 0:c.message)||`Failed to update ${s.type}`}}function o(k){if(k){const c=s.type==="start-date"?k.started_at:k.completed_at;u.value=Wt(c)}}return J(()=>s.task,k=>{o(k)},{immediate:!0}),st(()=>{o(s.task)}),(k,c)=>(a(),n("form",{class:"p-4",onSubmit:U(y,["prevent"])},[t("div",We,[p.type=="start-date"?(a(),n("h2",Ze,"Edit Start Date")):p.type=="finish-date"?(a(),n("h2",Ye,"Edit Completed Date")):f("",!0)]),t("div",Je,x(p.task.title),1),t("div",Qe,[t("div",Xe,[t("label",ts,x(p.type=="start-date"?"Start date":"Completed date"),1),et(t("input",{type:"date","onUpdate:modelValue":c[0]||(c[0]=T=>u.value=T),class:"border py-2 px-4 rounded-md w-full"},null,512),[[Tt,u.value]])])]),c[3]||(c[3]=t("hr",{class:"mt-4"},null,-1)),t("div",es,[b.value?(a(),n("div",ss,x(b.value),1)):f("",!0)]),t("div",as,[t("button",{class:"btn-3",onClick:c[1]||(c[1]=U(T=>d("closeClick"),["prevent"]))},"Close"),c[2]||(c[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},ls={key:0},ns={key:1,class:"flex"},os={class:"border-r-2 border-dashed pr-6 border-gray-300"},rs={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},is={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},ds={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},us={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},cs={key:0},ps=["disabled"],ks=["disabled"],ms={class:"text-lg font-semibold text-gray-700"},fs={class:"text-sm text-gray-500"},ys={class:"flex flex-grow justify-center items-center"},vs={key:0,class:"flex flex-col justify-center items-center"},xs={key:1},bs={key:1},gs={key:2,class:"flex justify-center items-center flex-col"},_s={key:3,class:"flex flex-col justify-center items-center"},hs={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},$s={class:"my-6"},Ts={class:"text-center font-semibold text-blue-800 mb-4"},ws={class:"text-center my-1"},Cs={class:"border px-2 rounded-md bg-gray-50"},Ss={class:"text-red-600 text-center mt-2 text-sm"},Ds={class:"flex justify-between mt-3"},Is={class:"btn-2"},Es={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(p,{emit:l}){const s=p,d=l,i=X(),u=A(""),b=A(),y=A(),o=Z({user:null,type:""});function k(m){o.user=i.user,o.type=m}const c={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},T=I(()=>(c==null?void 0:c[g.value])||0),v=I(()=>{var m;return{"bg-yellow-50":g.value==="IN_PROGRESS","bg-green-50":g.value==="COMPLETED","bg-red-50":g.value==="PENDING","bg-blue-50":(m=s.task)==null?void 0:m.closed_at}}),g=I(()=>{var m;return(m=s.task)==null?void 0:m.status}),S=I(()=>g.value=="PENDING"?"Start":g.value=="IN_PROGRESS"?"Finish":g.value=="COMPLETED"?"Close":""),j=I(()=>S.value=="Start"?"Start Task":S.value=="Finish"?"Finish Task":S.value=="Close"?"Close Task":"");async function L(){var m,e;b.value="submitting";try{await Kt(s.task.id,{status:u.value}),u.value="",d("updateStatus")}catch(w){y.value=(e=(m=w.response)==null?void 0:m.data)==null?void 0:e.message,d("error")}finally{b.value=""}}const M=I(()=>S.value=="Start"?"fas fa-play-circle text-blue-500":S.value=="Finish"?"fas fa-stop-circle text-blue-500":""),_=I(()=>{var m,e,w,O,R,B,$,H;return[{date:W((m=s.task)==null?void 0:m.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((e=s.task)!=null&&e.assigned_at)},{date:W((w=s.task)==null?void 0:w.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((O=s.task)!=null&&O.started_at)||T.value>=c.IN_PROGRESS},{date:W((R=s.task)==null?void 0:R.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((B=s.task)!=null&&B.completed_at)||T.value>=c.COMPLETED},{date:W(($=s.task)==null?void 0:$.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((H=s.task)!=null&&H.deadline)}].sort((F,V)=>F.date===null||V.date===null||new Date(F.date)==new Date(V.date)?F.serial-V.serial:new Date(F.date)-new Date(V.date))});return(m,e)=>{var w,O,R,B;return a(),n("div",{class:q(["border py-8 px-4 rounded",v.value])},[g.value==="BLOCKED"?(a(),n("div",ls,e[8]||(e[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(a(),n("div",ns,[t("div",os,[(w=s.task)!=null&&w.is_target?(a(),n("div",rs,e[9]||(e[9]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),D(" TARGET TASK ")]))):f("",!0),t("ol",is,[(a(!0),n(N,null,K(_.value,($,H)=>{var F,V;return a(),n("li",{class:"ml-5",key:H},[t("div",ds,[$.active?(a(),n("i",{key:0,class:q([$.icon,"text-xs"])},null,2)):f("",!0)]),t("div",{class:q({"opacity-30":!$.active})},[t("div",us,[$.date?(a(),n("span",cs,x($.date),1)):f("",!0),((F=s.task)==null?void 0:F.children_task_count)===0&&$.status==="started"&&$.active?(a(),n("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:e[0]||(e[0]=U(()=>k("start-date"),["prevent"])),disabled:!!s.task.closed_at},x($.date?"Edit":"Set Date"),9,ps)):f("",!0),((V=s.task)==null?void 0:V.children_task_count)===0&&$.active&&$.status==="completed"?(a(),n("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:e[1]||(e[1]=U(()=>k("finish-date"),["prevent"])),disabled:!!s.task.closed_at},x($.date?"Edit":"Set Date"),9,ks)):f("",!0)]),t("h3",ms,x($.title),1),t("p",fs,x($.description),1)],2)])}),128))])]),t("div",ys,[(O=p.task)!=null&&O.closed_at?(a(),n("div",vs,e[10]||(e[10]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):g.value==="PENDING"?(a(),n("div",xs,[((R=p.task)==null?void 0:R.children_task_count)===0?(a(),n("button",{key:0,class:"btn-3 mt-2",onClick:e[2]||(e[2]=U($=>u.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(a(),n("div",bs,e[11]||(e[11]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),t("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):g.value==="IN_PROGRESS"?(a(),n("div",gs,[e[12]||(e[12]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),e[13]||(e[13]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((B=p.task)==null?void 0:B.children_task_count)===0?(a(),n("button",{key:0,class:"btn-3",onClick:e[3]||(e[3]=U($=>u.value="COMPLETED",["prevent"]))}," Finish Task ")):f("",!0)])):g.value==="COMPLETED"?(a(),n("div",_s,[e[14]||(e[14]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),e[15]||(e[15]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:e[4]||(e[4]=U($=>u.value="CLOSED",["prevent"]))},"Close Task")])):f("",!0)])])),u.value?(a(),E(z,{key:2},{default:P(()=>{var $;return[t("form",{class:"p-4 rounded relative",onSubmit:U(L,["prevent"])},[b.value==="submitting"?(a(),E(Q,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:P(()=>e[16]||(e[16]=[D("Submitting!")])),_:1,__:[16]})):f("",!0),t("h3",hs,x(j.value),1),t("div",$s,[t("div",Ts,x(($=p.task)==null?void 0:$.title),1),e[19]||(e[19]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",ws,[e[17]||(e[17]=D(" Want to ")),t("span",Cs,[t("i",{class:q(["text-sm",M.value])},null,2),D(" "+x(S.value),1)]),e[18]||(e[18]=D(" the task? "))])]),e[20]||(e[20]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",Ss,x(y.value),1),t("div",Ds,[t("button",{class:"btn-3",onClick:e[5]||(e[5]=U(H=>u.value="",["prevent"]))},"Cancel"),t("button",Is,[t("i",{class:q(["text-xl text-white",M.value])},null,2),D(" "+x(S.value)+" Task ",1)])])])],32)]}),_:1})):f("",!0),o!=null&&o.user?(a(),E(z,{key:3},{default:P(()=>[C(Ct,{task:s.task,user:o.user,type:o.type,onCloseClick:e[6]||(e[6]=$=>o.user=null),onUpdateDate:e[7]||(e[7]=()=>{o.user=null,o.type=null,d("updateStatus")})},null,8,["task","user","type"])]),_:1})):f("",!0)],2)}}},Ps={class:"container mx-auto p-6"},Ls={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},Us={key:0,class:"text-sm mb-2 border-b","aria-label":"Breadcrumb"},As={class:"flex items-center gap-2"},Ms={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},Ns=["title"],js={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},Os={class:"grid grid-cols-4"},Rs={class:"mb-4 flex col-span-full"},Bs={class:"font-medium text-xl"},Fs={class:"flex items-center gap-3 text-xs text-gray-500 mt-2 opacity-80 text-left"},Vs={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-2 py-[2px] rounded-full border border-green-200 opacity-80"},Gs={class:"font-semibold"},qs={class:"mt-2 col-span-full flex items-center"},Hs={class:"text-gray-400 text-xs"},zs={class:"flex items-center gap-0.5"},Ks={class:"text-sky-400 text-sm font-semibold"},Ws={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},Zs={class:"col-span-full mb-4"},Ys=["innerHTML"],Js={key:0,class:"mt-4 col-span-full mb-6"},Qs={class:"mt-2 py-2 flex flex-col lg:flex-row gap-y-4 justify-center items-center gap-2 col-span-full"},Xs={class:"flex items-center gap-4 flex-wrap justify-center"},ta=["disabled"],ea={class:"lg:ml-auto flex gap-4 items-center"},sa={key:1},aa={key:3},la={key:1,class:"text-center py-4 text-red-500"},Na={__name:"TaskShow",setup(p){const l=Jt(),s=tt(),d=Et(),i=A(""),u=I(()=>l.tasks),b=A({}),y=Z({open:!1,task:null});st(async()=>{i.value="loading",await k(s.params.id),i.value="",s.hash=="#sub-tasks"&&setTimeout(()=>_t(s.hash,66),0)});const o=Z({user:null,type:""});async function k(m){await l.fetchTask(m)}const c=I(()=>wt(l.task.users,l.task.task_reports||[]));async function T(){await k(s.params.id),o.user=null,o.type=""}const v=m=>{d.push({name:"TaskEdit",params:{id:m}})},g=I(()=>{var m,e;return l.task?((m=l.task)==null?void 0:m.parent_id)==0?{name:L.value?"MyTaskList":"TaskList"}:{params:{id:(e=l.task)==null?void 0:e.parent_id},query:{"is-my-task":L.value}}:null});function S(){y.open=!0,y.task=l.task}function j(){y.open=!1,console.log({STATE:"Deleted",backLink:g.value}),d.push(g.value)}const L=I(()=>s.name=="MyTaskShow"||!!s.query["is-my-task"]),M=(m,e=!1)=>({id:m==null?void 0:m.id,title:m==null?void 0:m.title,status:m==null?void 0:m.status,is_current_page:e}),_=I(()=>{var e,w,O,R,B,$;const m=[];return(e=l==null?void 0:l.task)!=null&&e.parent&&(m.push(M((w=l.task)==null?void 0:w.parent)),(R=(O=l==null?void 0:l.task)==null?void 0:O.parent)!=null&&R.parent&&m.push(M(($=(B=l.task)==null?void 0:B.parent)==null?void 0:$.parent))),[...m.reverse(),M(l.task,!0)]});return J(()=>s.params.id,async m=>{i.value="changing",await k(m),i.value=""}),J(()=>s.hash,async function(){setTimeout(()=>_t(s.hash,66),0)}),(m,e)=>{var R,B,$,H,F,V,at,lt,nt,ot,rt,it,dt,ut,ct,pt,kt,mt,ft,yt,vt;const w=bt("RouterLink"),O=bt("router-view");return a(),n("div",Ps,[o.user?(a(),E(z,{key:0},{default:P(()=>[C(Ct,{task:r(l).task,user:o.user,type:o.type,onCloseClick:e[0]||(e[0]=h=>o.user=null),onUpdateDate:T},null,8,["task","user","type"])]),_:1})):f("",!0),y.open?(a(),E(z,{key:1},{default:P(()=>[C(Ie,{onCloseClick:e[1]||(e[1]=h=>y.open=!1),task:y.task,onDelete:j},null,8,["task"])]),_:1})):f("",!0),i.value==="loading"?(a(),E(Q,{key:2})):(a(),n("div",Ls,[r(l).task?(a(),n(N,{key:0},[_.value.length>1?(a(),n("nav",Us,[t("ol",As,[(a(!0),n(N,null,K(_.value,(h,G)=>(a(),n(N,{key:h.id},[G>0?(a(),n("li",Ms,"/")):f("",!0),t("li",{title:h==null?void 0:h.title,class:"text-gray-600"},[h.is_current_page?(a(),n("span",js,x(h==null?void 0:h.title),1)):(a(),E(w,{key:0,to:`${L.value?"/my-tasks":"/tasks"}/${h.id}`,class:q(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":G>0,"whitespace-nowrap":G===0}])},{default:P(()=>[D(x(h==null?void 0:h.title),1)]),_:2},1032,["to","class"]))],8,Ns)],64))),128))])])):f("",!0),t("section",Os,[t("div",Rs,[t("div",null,[t("h2",Bs,x(r(l).task.title),1),t("div",Fs,[r(l).task.parent_id==0?(a(),n("div",Vs," MAIN TASK ")):f("",!0),t("div",Gs,"#"+x((R=r(l).task)==null?void 0:R.serial),1),(B=r(l).task)!=null&&B.is_important?(a(),E(Gt,{key:1})):f("",!0),($=r(l).task)!=null&&$.is_urgent?(a(),E(qt,{key:2})):f("",!0)]),t("div",qs,[t("div",Hs,[e[13]||(e[13]=t("i",{class:"fas fa-clock"},null,-1)),D(" "+x(r(Zt)(r(l).task.created_at)),1)]),(H=r(l).task)!=null&&H.created_by_user?(a(),n(N,{key:0},[e[14]||(e[14]=t("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),t("div",zs,[C(Pt,{user:(F=r(l).task)==null?void 0:F.created_by_user,class:"!size-4 ml-1"},null,8,["user"]),t("div",Ks,x((at=(V=r(l).task)==null?void 0:V.created_by_user)==null?void 0:at.label),1)])],64)):f("",!0)])]),t("div",Ws,[C(Yt,{status:(lt=r(l).task)==null?void 0:lt.status,progressPercent:(nt=r(l).task)==null?void 0:nt.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),r(l).task?(a(),E(Ft,{key:0,task:r(l).task,ref_key:"progress",ref:b,class:"!text-lg"},null,8,["task"])):f("",!0)])]),t("div",Zs,[C(Lt,null,{default:P(()=>{var h;return[t("p",{innerHTML:(h=r(l).task)==null?void 0:h.description,class:"text-justify"},null,8,Ys)]}),_:1})]),C(Vt,{task:(ot=r(l))==null?void 0:ot.task,"tree-level":(it=(rt=r(l))==null?void 0:rt.task)==null?void 0:it.level,class:"justify-center border col-span-full border-dashed rounded-lg"},null,8,["task","tree-level"]),r(l).task.children_task_count>0?(a(),n("section",Js,[C(ze,{"task-users":((dt=r(l).task)==null?void 0:dt.users)||[],task:r(l).task,"sub-tasks":r(l).tasks,"progress-users":c.value},{caption:P(()=>e[15]||(e[15]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):f("",!0),(ut=r(l))!=null&&ut.task?(a(),E(Es,{key:1,task:((ct=r(l))==null?void 0:ct.task)||{},class:"col-span-full mt-4",onUpdateStatus:e[2]||(e[2]=()=>{var h,G;return k((G=(h=r(l))==null?void 0:h.task)==null?void 0:G.id)})},null,8,["task"])):f("",!0),t("div",Qs,[t("div",Xs,[t("button",{onClick:e[3]||(e[3]=U(h=>{var G;return v((G=r(l).task)==null?void 0:G.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!r(l).task.closed_at},e[16]||(e[16]=[t("i",{class:"fas fa-edit"},null,-1),D(" Edit ")]),8,ta),C(w,{to:{name:"TaskUserAssign",params:{id:(pt=r(l).task)==null?void 0:pt.id}},class:q(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",r(l).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:e[4]||(e[4]=h=>h.stopPropagation())},{default:P(()=>e[17]||(e[17]=[t("i",{class:"fas fa-users-cog"},null,-1),D(" Assign Users ")])),_:1,__:[17]},8,["to","class"]),t("button",{class:"border-2 border-indigo-500 hover:bg-indigo-500 hover:text-white text-indigo-500 font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none whitespace-nowrap",onClick:e[5]||(e[5]=h=>r(d).back())},e[18]||(e[18]=[t("i",{class:"fas fa-arrow-left"},null,-1),D(" Back ")])),C(w,{to:g.value,class:"border-2 border-indigo-500 hover:bg-indigo-500 hover:text-white ml-2 text-indigo-500 font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none whitespace-nowrap",onClick:e[6]||(e[6]=h=>h.stopPropagation())},{default:P(()=>e[19]||(e[19]=[t("i",{class:"fas fa-arrow-left"},null,-1),D(" Parent Task ")])),_:1,__:[19]},8,["to"])]),t("div",ea,[((kt=r(l).task)==null?void 0:kt.children_task_count)===0&&((mt=r(l).task)==null?void 0:mt.status)==="PENDING"?(a(),n("button",{key:0,class:"btn-2-red h-8",onClick:U(S,["prevent"])}," Delete ")):f("",!0),u.value.length>0?(a(),E(w,{key:1,to:{name:L.value||r(s).query["is-my-task"]?"MyTaskShow":"TaskShow",params:{id:(ft=r(l).task)==null?void 0:ft.id},hash:"#sub-tasks"},onClick:e[7]||(e[7]=h=>h.stopPropagation()),class:q(["py-0.5 btn-3 ml-auto text-sm h-8 whitespace-nowrap",{"bg-blue-500 text-white":r(s).name=="TaskShow"||r(s).name==="MyTaskShow"}])},{default:P(()=>e[20]||(e[20]=[t("i",{class:"fal fa-list-ul"},null,-1),D(" Sub Tasks ")])),_:1,__:[20]},8,["to","class"])):f("",!0),C(w,{to:{name:"TaskReports",params:{id:(yt=r(l).task)==null?void 0:yt.id},query:{"is-my-task":L.value},hash:"#task-reports"},onClick:e[8]||(e[8]=h=>h.stopPropagation()),class:q(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":r(s).name=="TaskReports"}])},{default:P(()=>e[21]||(e[21]=[t("i",{class:"fal fa-file-alt"},null,-1),D(" Reports ")])),_:1,__:[21]},8,["to","class"])])])]),e[22]||(e[22]=t("div",{id:"sub-tasks"},null,-1)),(r(s).name=="TaskShow"||r(s).name==="MyTaskShow")&&((vt=r(l).task)==null?void 0:vt.level)<=2?(a(),n("section",sa,[C(de,{subTasks:u.value,"parent-id":r(s).params.id,"sub-task-is-creatable":!r(l).task.closed_at,"tree-level":r(l).task.level+1,onCreated:e[9]||(e[9]=h=>k(r(s).params.id)),onUpdated:e[10]||(e[10]=h=>k(r(s).params.id)),onUpdatePriority:e[11]||(e[11]=h=>k(r(s).params.id)),onAssignUser:e[12]||(e[12]=h=>k(r(s).params.id))},null,8,["subTasks","parent-id","sub-task-is-creatable","tree-level"])])):f("",!0),r(s).name==="TaskReportAdd"?(a(),E(z,{key:2,class:"*:bg-transparent"},{default:P(()=>[C(O)]),_:1})):(a(),n("section",aa,[C(O)]))],64)):(a(),n("div",la,x(r(l).error),1)),i.value==="changing"?(a(),E(Q,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):f("",!0)]))])}}};export{Na as default};
