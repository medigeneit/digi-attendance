import{C as T,f as K,u as W,Q as X,D as R,x as _,r as E,h as Z,q as ee,c as n,o as d,a as l,k as te,H as ae,F as c,e as b,t as i,d as v,l as y}from"./index-DSsNBt6A.js";import{u as le}from"./company-CoqM2OcS.js";import{u as se}from"./department-9t0Qw50q.js";import{L as ne}from"./LoaderView-DSv51NMQ.js";import{S as V}from"./SelectDropdown-CLPSgcXi.js";import{_ as de}from"./EmployeeDropdownInput-D4YYHeKY.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BpGcz9Tx.js";const oe=x=>T.get("/attendance/yearly-delay-early-summary",{params:x}),ie=x=>T.get("/attendance/yearly-delay-early-summary/export",{params:x,responseType:"blob"}),ce={class:"space-y-3 px-3 pb-4"},ue={class:"rounded-xl border border-slate-200 bg-white p-3 shadow-sm"},ye={class:"grid gap-2 items-end xl:grid-cols-[90px_1.1fr_1.1fr_1fr_1.1fr_110px_130px]"},me={class:"min-w-0 relative"},pe=["value"],_e={class:"min-w-0 relative"},be=["title"],ve={key:0},xe={key:1,class:"text-gray-500 whitespace-nowrap"},fe=["title"],he={class:"min-w-0 relative"},ge=["title"],we={key:0},ke={key:1,class:"text-gray-500 whitespace-nowrap"},Se=["title"],De={class:"min-w-0 relative"},Ee=["title"],Ve={key:0},Ae={key:1,class:"text-gray-500 whitespace-nowrap"},Ce=["title"],Le={class:"min-w-0 relative"},Ue=["disabled"],Fe=["disabled"],Oe={class:"rounded-xl border border-slate-200 bg-white shadow-sm"},Re={key:0,class:"py-8"},Te={key:1,class:"empty-state"},Ye={key:2,class:"overflow-x-auto table-scroll"},qe={class:"min-w-full table-auto border-collapse"},Me={class:"sticky top-0 bg-white shadow-sm"},Ne={class:"bg-slate-50 text-[11px] text-left"},$e={class:"bg-slate-50 text-[11px] text-left"},Be={class:"text-[11px]"},Je={class:"td"},je={class:"td font-semibold text-slate-700 whitespace-nowrap"},Pe={class:"td text-center"},Qe={class:"td text-center"},He={class:"td text-center"},Ie={class:"td text-center font-semibold"},ze={__name:"YearlyDelayEarlyAttendanceSummary",setup(x){const m=K(),Y=W(),w=X(),f=le(),k=se(),{companies:S,employees:q}=R(f),{departments:A}=R(k),C=new Date().getFullYear(),M=_(()=>Array.from({length:6},(s,t)=>{const e=C-t;return{id:String(e),label:String(e)}})),a=E({year:m.query.year||String(C),company_id:m.query.company_id||"",department_id:m.query.department_id||"",line_type:m.query.line_type||"all",employee_id:m.query.employee_id||""}),h=E([]),u=E(!1),g=[{key:"01",label:"Jan"},{key:"02",label:"Feb"},{key:"03",label:"Mar"},{key:"04",label:"Apr"},{key:"05",label:"May"},{key:"06",label:"Jun"},{key:"07",label:"Jul"},{key:"08",label:"Aug"},{key:"09",label:"Sep"},{key:"10",label:"Oct"},{key:"11",label:"Nov"},{key:"12",label:"Dec"}],N=[{id:"all",label:"All Types"},{id:"executive",label:"Executive"},{id:"support_staff",label:"Support Staff"},{id:"doctor",label:"Doctor"},{id:"academy_body",label:"Academy Body"}],$=_(()=>(S.value||[]).map(s=>({id:String(s.id),label:s.name}))),B=_(()=>(A.value||[]).map(s=>({id:String(s.id),label:s.name}))),L=_(()=>q.value||[]),U=s=>({...s,id:String(s.id),label:s.name||s.label||`${s.first_name??""} ${s.last_name??""}`.trim()}),J=_(()=>{let s=[...L.value];a.value.department_id&&a.value.department_id!=="all"&&(s=s.filter(e=>String(e.department_id)===String(a.value.department_id))),a.value.line_type&&a.value.line_type!=="all"&&(s=s.filter(e=>String(e.type)===String(a.value.line_type)));let t=s.map(U);if(a.value.employee_id&&!t.some(r=>r.id===String(a.value.employee_id))){const r=L.value.find(o=>String(o.id)===String(a.value.employee_id));r&&(t=[U(r),...t])}return t}),D=(s,t)=>{var e;return((e=s==null?void 0:s.months)==null?void 0:e[t])||{score:null,late:0,early:0,total:0}},j=s=>{var e,r,o;const t=(e=g[0])==null?void 0:e.key;return t?((o=(r=s==null?void 0:s.months)==null?void 0:r[t])==null?void 0:o.score)??null:null},P=s=>{const t=Number(s);return Number.isFinite(t)?t.toFixed(2):"-"},Q=()=>{Y.replace({query:{year:a.value.year||void 0,company_id:a.value.company_id||void 0,department_id:a.value.department_id||void 0,line_type:a.value.line_type||void 0,employee_id:a.value.employee_id||void 0}})},F=async()=>{var s,t,e;if(!a.value.company_id){h.value=[];return}u.value=!0;try{const r={company_id:a.value.company_id,department_id:a.value.department_id||void 0,line_type:a.value.line_type||void 0,employee_id:a.value.employee_id||void 0,year:a.value.year},o=await oe(r);h.value=((s=o==null?void 0:o.data)==null?void 0:s.data)??(o==null?void 0:o.data)??[],Q()}catch(r){w.error(((e=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to load report")}finally{u.value=!1}},H=async()=>{await F()},I=async()=>{var s,t;if(!a.value.company_id){w.info("Select a company first.");return}try{const e={company_id:a.value.company_id,department_id:a.value.department_id||void 0,line_type:a.value.line_type||void 0,employee_id:a.value.employee_id||void 0,year:a.value.year},r=await ie(e),o=new Blob([r.data]),O=window.URL.createObjectURL(o),p=document.createElement("a");p.href=O;const z=a.value.department_id||"all",G=`yearly_delay_early_attendance_${a.value.company_id}_${a.value.year}_${z}.xlsx`;p.setAttribute("download",G),document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(O)}catch(e){w.error(((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to export excel")}};return Z(async()=>{await f.fetchCompanies(),!a.value.company_id&&(S.value||[]).length===1&&(a.value.company_id=String(S.value[0].id)),a.value.company_id&&await Promise.all([k.fetchDepartments(a.value.company_id),f.fetchEmployee(a.value.company_id,{with:"department,company"})]),a.value.company_id&&await F()}),ee(()=>a.value.company_id,async s=>{if(a.value.department_id="",a.value.employee_id="",!s){A.value=[];return}await Promise.all([k.fetchDepartments(s),f.fetchEmployee(s,{with:"department,company"})])}),(s,t)=>(d(),n("section",ce,[t[17]||(t[17]=l("header",{class:"rounded-xl border border-slate-200 bg-white px-4 py-3 shadow-sm"},[l("h1",{class:"text-base font-semibold text-slate-900"},"Yearly Delay Early Attendance Summary"),l("p",{class:"text-xs text-slate-500"}," Month-wise late, early, and total with yearly score average. ")],-1)),l("div",ue,[l("div",ye,[l("div",me,[t[5]||(t[5]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Year",-1)),te(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.year=e),class:"input-1 h-8 py-0 w-full text-xs"},[(d(!0),n(c,null,b(M.value,e=>(d(),n("option",{key:e.id,value:e.id},i(e.label),9,pe))),128))],512),[[ae,a.value.year]])]),l("div",_e,[t[6]||(t[6]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Company",-1)),v(V,{modelValue:a.value.company_id,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.company_id=e),options:$.value,class:"border border-gray-300 rounded h-8 w-full bg-white text-xs",clearable:""},{"selected-option":y(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:e==null?void 0:e.label},[e!=null&&e.label?(d(),n("span",ve,i(e==null?void 0:e.label),1)):(d(),n("span",xe,"--Select Company--"))],8,be)]),option:y(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},i(e.label),9,fe)]),_:1},8,["modelValue","options"])]),l("div",he,[t[7]||(t[7]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Department",-1)),v(V,{modelValue:a.value.department_id,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.department_id=e),options:B.value,class:"border border-gray-300 rounded h-8 w-full bg-white text-xs",clearable:""},{"selected-option":y(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:e==null?void 0:e.label},[e!=null&&e.label?(d(),n("span",we,i(e==null?void 0:e.label),1)):(d(),n("span",ke,"--Select Department--"))],8,ge)]),option:y(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},i(e.label),9,Se)]),_:1},8,["modelValue","options"])]),l("div",De,[t[8]||(t[8]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Line Type",-1)),v(V,{modelValue:a.value.line_type,"onUpdate:modelValue":t[3]||(t[3]=e=>a.value.line_type=e),options:N,class:"border border-gray-300 rounded h-8 w-full bg-white text-xs"},{"selected-option":y(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:e==null?void 0:e.label},[e!=null&&e.label?(d(),n("span",Ve,i(e==null?void 0:e.label),1)):(d(),n("span",Ae,"All Types"))],8,Ee)]),option:y(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},i(e.label),9,Ce)]),_:1},8,["modelValue"])]),l("div",Le,[t[9]||(t[9]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Employee",-1)),v(de,{modelValue:a.value.employee_id,"onUpdate:modelValue":t[4]||(t[4]=e=>a.value.employee_id=e),employees:J.value,class:"border border-gray-300 rounded h-8 w-full bg-white text-xs"},null,8,["modelValue","employees"])]),l("div",null,[l("button",{class:"btn-2 w-full rounded h-8 text-xs",disabled:u.value,onClick:H},i(u.value?"Loading...":"Apply"),9,Ue)]),l("div",null,[l("button",{class:"btn-1 rounded h-8 text-xs",disabled:u.value,onClick:I}," Download Excel ",8,Fe)])])]),l("div",Oe,[u.value?(d(),n("div",Re,[v(ne)])):h.value.length===0?(d(),n("div",Te,t[10]||(t[10]=[l("p",{class:"text-base font-semibold text-slate-700"},"No data found",-1),l("p",{class:"text-xs text-slate-500"},"Try changing filters or year.",-1)]))):(d(),n("div",Ye,[l("table",qe,[l("thead",Me,[l("tr",Ne,[t[11]||(t[11]=l("th",{class:"th w-12",rowspan:"2"},"#",-1)),t[12]||(t[12]=l("th",{class:"th min-w-[180px]",rowspan:"2"},"User",-1)),(d(),n(c,null,b(g,e=>l("th",{key:e.key,class:"th text-center",colspan:"3"},i(e.label),1)),64)),t[13]||(t[13]=l("th",{class:"th text-center",rowspan:"2"},"Score Avg",-1))]),l("tr",$e,[(d(),n(c,null,b(g,e=>(d(),n(c,{key:e.key},[t[14]||(t[14]=l("th",{class:"th text-center"},"Late",-1)),t[15]||(t[15]=l("th",{class:"th text-center"},"Early",-1)),t[16]||(t[16]=l("th",{class:"th text-center"},"Total",-1))],64))),64))])]),l("tbody",Be,[(d(!0),n(c,null,b(h.value,(e,r)=>(d(),n("tr",{key:e.user_id||r,class:"border-b hover:bg-slate-100"},[l("td",Je,i(r+1),1),l("td",je,[l("div",null,i(e.user_name||"-"),1)]),(d(),n(c,null,b(g,o=>(d(),n(c,{key:o.key},[l("td",Pe,i(D(e,o.key).late),1),l("td",Qe,i(D(e,o.key).early),1),l("td",He,i(D(e,o.key).total),1)],64))),64)),l("td",Ie,i(P(j(e))),1)]))),128))])])]))])]))}},st=re(ze,[["__scopeId","data-v-1726d5f9"]]);export{st as default};
