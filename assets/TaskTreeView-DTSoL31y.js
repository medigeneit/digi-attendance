import{c as l,o as s,F as _,q as L,f as w,i as T,p as W,L as te,m as b,g as o,s as h,a as t,B as se,j as p,t as k,R as le,x as v,N as re,O as ae,C as G,A as X,b as ne,r as H,n as oe,w as S,k as $}from"./index-B_8aCD-G.js";import{g as J,a as ie}from"./datetime-DWeuW3kx.js";import{o as de}from"./url-CePbr-gY.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as K}from"./UserChip-DHN_m03l.js";const ue={class:"mt-3"},ce={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick","employeeAssignClick"],setup(e,{emit:i}){const a=i;return(d,n)=>(s(),l("div",ue,[(s(!0),l(_,null,L(e.childrenTasks,(u,g)=>(s(),w(xt,{key:u.id,index:g,task:u,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:n[0]||(n[0]=m=>a("editClick",m)),onAddClick:n[1]||(n[1]=m=>a("addClick",m)),onEmployeeAssignClick:n[2]||(n[2]=m=>a("employeeAssignClick",m))},{"item-end":T(({task:m,level:x})=>[W(d.$slots,"treeItemEnd",{task:m,level:x})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},fe=te({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:i}){const a=e,d=b(function(){return a.task.completed_count}),n=b(()=>a.task.children_task_count===0?a.task.status==="COMPLETED"?100:0:d.value/a.task.children_task_count*100),u=b(()=>{const g=n.value;let m,x,c;return g===100?(m="bg-green-50",x="bg-green-200",c="text-green-600 "):g<100&&(m="bg-red-50",x="bg-red-200",c="text-red-600 "),{container:m,bar:x,text:c}});return i({completedPercentage:n,completedSubTaskCount:d}),(g,m)=>(s(),l("div",null,[g.task.children_task_count>0?(s(),l("div",{key:0,class:h(["rounded-full border py-0.5 relative overflow-hidden h-6",u.value.container]),style:{width:"180px"}},[t("div",{class:h(["z-10 absolute top-0 bottom-0",u.value.bar]),style:se(`width: ${n.value}%`)},null,6),t("span",{class:h(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",u.value.text])},[t("span",null,[t("span",null,k(d.value),1),m[0]||(m[0]=p(" / ")),t("span",null,k(g.task.children_task_count),1)])],2)],2)):o("",!0)]))}}),ke={key:0},me={__name:"TaskStatus",props:{status:{type:String,required:!0},progressPercent:{type:Number,required:!0}},setup(e){const i=e,a=b(()=>{switch(i.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),d=b(()=>{switch(i.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(n,u)=>(s(),l("div",{class:h(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",a.value])},[t("i",{class:h(d.value)},null,2),t("span",null,k(e.status),1),e.progressPercent!==null||e.progressPercent!==void 0?(s(),l("span",ke,k(e.progressPercent)+"% ",1)):o("",!0)],2))}},ge={},xe={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function ye(e,i){return s(),l("span",xe,"IMPORTANT")}const be=Y(ge,[["render",ye]]),he={class:"relative"},ve={key:0,class:"text-gray-400 text-xs"},pe={class:"border rounded-full size-6 flex justify-center items-center border-blue-300 bg-blue-100"},Te={key:0,class:"fas fa-user-cowboy text-blue-500"},we={key:1,class:"fas fa-user-crown text-blue-300"},Ce={key:2,class:"text-sm text-gray-500 group/users"},$e={class:"cursor-pointer hover:underline text-blue-600"},_e={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg z-30"},Q={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:null},isTargetTask:{Boolean,default:!1},listType:{String,default:"employee"}},setup(e){const i=e,a=b(()=>i.users.slice(0,2)),d=b(()=>i.users.slice(2));function n(g){return typeof i.routeTo=="function"?i.routeTo(g):{}}const u=b(()=>typeof i.routeTo=="function"?le:"div");return(g,m)=>(s(),l("div",he,[i.users.length===0?(s(),l("div",ve,k(e.listType=="supervisors"?"No Supervisor assigned":"Not Assigned To Anyone"),1)):(s(!0),l(_,{key:1},L(a.value,(x,c)=>(s(),w(G(u.value),ae({key:c},{ref_for:!0},{...typeof i.routeTo=="function"?{to:n(x)}:{}}),{default:T(()=>[v(K,{class:h(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask," !bg-blue-100":!e.isTargetTask&&e.listType=="employee"&&c===0}]),user:x},re({_:2},[c===0||e.listType=="supervisors"?{name:"after",fn:T(()=>[t("div",pe,[e.listType=="supervisors"?(s(),l("i",Te)):(s(),l("i",we))])]),key:"0"}:void 0]),1032,["class","user"])]),_:2},1040))),128)),d.value.length>0?(s(),l("div",Ce,[t("div",$e," + "+k(d.value.length)+" more "+k(e.listType=="employee"?"users":e.listType=="supervisors"?"supervisor":""),1),t("div",_e,[(s(!0),l(_,null,L(d.value,(x,c)=>(s(),w(G(u.value),{key:c,to:n(x),class:"w-full block mb-2"},{default:T(()=>[v(K,{class:h(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:x},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):o("",!0)]))}},Se={class:"col-span-full flex flex-col md:flex-row items-stretched my-2 lg:my-0 justify-center flex-wrap gap-x-5 gap-y-4"},Le={class:"flex flex-col items-center justify-center gap-2 border border-dashed border-gray-100 rounded shadow shadow-gray-100 bg-gray-50/40 p-4"},Ae={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-sky-500 text-white"},Ee={class:"flex flex-col items-center justify-center gap-2 border border-dashed border-gray-100 rounded shadow shadow-gray-100 bg-gray-50/40 p-4"},Ne={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-blue-500 text-white"},Be={__name:"TaskSupervisorAndEmployee",props:{treeLevel:{type:Number,required:!0},task:{type:Object,required:!0},employeeRouteTo:{type:Function,default:null}},setup(e){return(i,a)=>{var d,n,u,g;return s(),l("div",Se,[t("div",Le,[e.treeLevel===0?(s(),l("div",Ae,k(((n=(d=e.task)==null?void 0:d.from_department)==null?void 0:n.name)||"--"),1)):o("",!0),v(Q,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:e.task.supervisors||[],listType:"supervisors"},null,8,["users"])]),a[0]||(a[0]=t("div",null,[t("span",{class:"flex md:hidden text-2xl text-gray-200 items-center justify-center h-full"},[t("i",{class:"fad fa-arrow-down"})]),t("span",{class:"hidden md:flex text-2xl text-gray-200 items-center justify-center h-full"},[t("i",{class:"fad fa-arrow-right"})])],-1)),t("div",Ee,[e.treeLevel===0?(s(),l("div",Ne,k(((g=(u=e.task)==null?void 0:u.to_department)==null?void 0:g.name)||"--"),1)):o("",!0),v(Q,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:e.employeeRouteTo},null,8,["users","isTargetTask","routeTo"])])])}}},Re={class:"flex items-center gap-2"},De={__name:"TaskTitleRouterLink",props:{task:Object,subTasksOpen:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},setup(e){return(i,a)=>{var n;const d=X("RouterLink");return s(),l("div",Re,[t("i",{class:h(["fad",((n=e.task)==null?void 0:n.children_task_count)>0?{"fa-folder text-blue-800/70":!e.subTasksOpen,"fa-folder-open text-blue-400":e.subTasksOpen}:"fa-file-alt text-gray-400"])},null,2),v(d,{to:{name:e.isMyTask?"MyTaskShow":"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-blue-700"},{default:T(()=>[t("div",null,k(e.task.title),1)]),_:1},8,["to"])])}}},je={},Pe={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function Oe(e,i){return s(),l("span",Pe,"URGENT")}const qe=Y(je,[["render",Oe]]),Me={class:"flex w-full text-gray-800"},Ie={key:0,class:"border-l border-gray-200 last:border-l-0"},ze={class:"items-start grid grid-cols-4 gap-4 group"},Ue={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},Ve={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},Fe={key:0,class:"text-xl font-semibold text-blue-500"},Ge={key:1,class:"text-sm text-gray-500 mt-2"},He={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Je={key:0,class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"},Ke={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Qe={key:0,class:"flex gap-4 items-center mr-3"},We={key:1,class:"text-gray-500 text-sm"},Xe={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ye={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},Ze={class:"text-gray-400 text-xs col-span-full"},et={class:"flex flex-wrap gap-2 mb-2 col-span-full"},tt={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4 mt-4 opacity-80"},st={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},lt={key:1,class:"text-gray-500 text-sm"},rt={class:"font-semibold text-blue-800"},at={key:2,class:"ml-4 text-gray-500 text-sm"},nt={class:"text-blue-500 font-semibold"},ot={class:"mt-4 col-span-full"},it={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},dt={class:"text-xs text-gray-400 flex gap-3 order-1 sm:order-0"},ut=["href"],ct={class:"flex items-center sm:ml-auto order-0 sm:order-1"},ft={key:0,class:"flex gap-2 ml-4 items-center text-xs"},kt=["href"],mt=["href"],gt={class:"ml-0"},xt={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(e,{emit:i}){const a=e,d=ne(),n=H(null),u=i;function g(f){u("addClick",f)}function m(f){u("editClick",f)}function x(f){u("employeeAssignClick",f)}const c=H([]),E=localStorage.getItem("sub_task_opened_list");if(E)try{c.value=JSON.parse(E)}catch{c.value=[]}const N=b(()=>J(a.task.started_at)),B=b(()=>J(a.task.deadline)),C=b({get:()=>c.value.includes(a.task.id),set:f=>{const r=c.value.includes(a.task.id);f&&!r?c.value.push(a.task.id):!f&&r&&(c.value=c.value.filter(A=>A!==a.task.id))}});oe(c,f=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(f))},{deep:!0});const R=b(()=>{var f,r;return((r=(f=a.task)==null?void 0:f.children_tasks)==null?void 0:r.length)>0});function Z(){a.task.children_tasks.length>0&&(C.value=!C.value)}return(f,r)=>{var D,j,P,O,q,M,I,z,U,V,F;const A=X("RouterLink");return s(),l("div",Me,[e.treeLevel>0?(s(),l("div",Ie,r[4]||(r[4]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):o("",!0),t("div",{class:h(["flex-grow border-2 rounded py-3 px-3",{"bg-blue-100/30  ":e.task.closed_at,"bg-green-100  ":((D=n.value)==null?void 0:D.completedPercentage)===100,"bg-white hover:bg-gray-50":((j=n.value)==null?void 0:j.completedPercentage)<100&&!e.task.closed_at,"shadow-sm":e.treeLevel>0,"border-blue-500":e.index%2===0,"border-pink-300":e.index%2===1}])},[t("div",ze,[t("div",Ue,[t("div",Ve,[e.index!==void 0?(s(),l("div",Fe,k(e.index+1)+". ",1)):o("",!0),v(De,{task:e.task,"sub-tasks-open":C.value,"is-my-task":e.isMyTask},null,8,["task","sub-tasks-open","is-my-task"]),(P=e.task)!=null&&P.requirement?(s(),l("p",Ge," Requirement: "+k((q=(O=e.task)==null?void 0:O.requirement)==null?void 0:q.title),1)):o("",!0)]),t("div",He,[e.task.closed_at?(s(),l("div",Je,r[5]||(r[5]=[t("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),p("CLOSED ")]))):o("",!0),v(me,{status:(M=e.task)==null?void 0:M.status,progressPercent:((I=e.task)==null?void 0:I.progress_percent)||0},null,8,["status","progressPercent"]),v(fe,{ref_key:"progress",ref:n,task:e.task,class:"text-sm"},null,8,["task"])]),t("div",Ke,[e.showDraggableHandle||e.task.serial?(s(),l("div",Qe,[e.showDraggableHandle?(s(),l("button",{key:0,onMousedown:r[0]||(r[0]=S((...y)=>f.handleDragging&&f.handleDragging(...y),["stop"])),class:"handle"},r[6]||(r[6]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):o("",!0),e.task.serial?(s(),l("span",We," #"+k(e.task.serial),1)):o("",!0)])):o("",!0),t("div",Xe,[e.treeLevel===0?(s(),l("div",Ye," Main ")):o("",!0),(z=e.task)!=null&&z.is_important?(s(),w(be,{key:1})):o("",!0),(U=e.task)!=null&&U.is_urgent?(s(),w(qe,{key:2})):o("",!0)])])]),t("div",Ze,[r[7]||(r[7]=t("i",{class:"fas fa-clock"},null,-1)),p(" "+k($(ie)(e.task.created_at)),1)]),t("div",et,[(s(!0),l(_,null,L(e.task.website_tags||[],y=>(s(),l("div",{class:"border bg-gray-50 text-xs px-2 rounded-lg shadow-sm text-gray-700 bg-gradient-to-b to-slate-50 from-blue-100",key:y.id},k(y.name),1))),128))]),v(Be,{task:e.task,"tree-level":e.treeLevel,"employee-route-to":y=>({query:{...$(d).query,view:"userwise","company-id":y.company_id,"user-ids":y.id}})},null,8,["task","tree-level","employee-route-to"])]),t("div",tt,[e.task.is_target?(s(),l("div",st," TARGET TASK ")):o("",!0),N.value?(s(),l("span",lt,[r[8]||(r[8]=p(" Starting: ")),t("span",rt,k(N.value),1)])):o("",!0),B.value?(s(),l("span",at,[r[9]||(r[9]=p(" Deadline: ")),t("span",nt,k(B.value),1)])):o("",!0)]),t("div",ot,[t("div",it,[t("div",dt,[t("button",{class:h([{"text-blue-600 font-semibold  inline-block  ":R.value},"flex items-center gap-1 group"]),onClick:Z},[t("i",{class:h([C.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:h(R.value?"group-hover:underline":"")}," Sub Tasks ("+k((V=e.task.children_tasks)==null?void 0:V.length)+") ",3)],2),e.task.closed_at?o("",!0):(s(),l(_,{key:0},[e.treeLevel<2?(s(),l("a",{key:0,href:`/tasks/add?parent_id=${a.task.id}&back-to=${encodeURIComponent($(d).path+"?"+$(de)($(d).query)).toLowerCase()}`,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:r[1]||(r[1]=S(y=>u("addClick",a.task.id),["stop","prevent"]))},r[10]||(r[10]=[t("i",{class:"fas fa-plus"},null,-1),p(" Add Sub Task ")]),8,ut)):o("",!0)],64))]),t("div",ct,[e.hideButtons?o("",!0):(s(),l("div",ft,[e.task.is_closed?o("",!0):(s(),l("a",{key:0,href:`/tasks/edit/${e.task.id}`,onClick:r[2]||(r[2]=S(y=>u("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},r[11]||(r[11]=[t("i",{class:"fas fa-edit"},null,-1),p(" Edit ")]),8,kt)),e.task.is_closed?o("",!0):(s(),l("a",{key:1,href:`/tasks/${e.task.id}/assign-users`,onClick:r[3]||(r[3]=S(y=>u("employeeAssignClick",e.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},r[12]||(r[12]=[t("i",{class:"fas fa-users-cog"},null,-1),p(" Manage Employee & Supervisor ")]),8,mt)),v(A,{to:{name:"TaskReports",params:{id:(F=e.task)==null?void 0:F.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:T(()=>r[13]||(r[13]=[t("i",{class:"far fa-file-alt"},null,-1),p(" Reports ")])),_:1,__:[13]},8,["to"])]))])]),t("div",gt,[C.value?(s(),w(ce,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:m,onAddClick:g,onEmployeeAssignClick:x},{"tree-item-end":T(({task:y,level:ee})=>[W(f.$slots,"item-end",{level:ee,task:y})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):o("",!0)])])],2)])}}};export{xt as _,me as a,fe as b,Be as c};
