import{u as ne,f as oe,r as b,x as G,q as A,h as re,A as ae,p as le,c as m,o as d,a as t,j as k,i as X,k as ie,d as S,l as Z,b as c,t as u,m as a,J as de}from"./index-Cv5O7YaQ.js";import{_ as ue}from"./AttendanceTable-DQmPi0EU.js";import{_ as pe}from"./EmployeeFilter-CSCrG6YK.js";import{_ as me}from"./FlexibleDatePicker-Bs4e7ZKx.js";import{L as ce}from"./LoaderView-lMGIT-Ru.js";import{S as ye}from"./SelectedEmployeeCard-Grrf1D1t.js";import{u as fe}from"./attendance-CVhN-_9_.js";import{u as xe}from"./user-_UxeZ3ol.js";import"./datetime-BEfC2TVK.js";import"./company-DQgFipii.js";import"./department-B8YEEoBY.js";import"./EmployeeDropdownInput-m6X86KLR.js";import"./SelectDropdown-Byds4-qS.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-DYR2gCHq.js";const _e={class:"px-4 space-y-4"},ge={class:"sticky top-14 z-40 bg-white p-4 rounded"},ve={class:"relative"},be={class:"text-gray-700 bg-gradient-to-tl"},he={class:"grid md:grid-cols-2 gap-4 text-sm mt-2"},we={key:1,class:"card-bg p-4 gap-1"},ke={class:"flex justify-between items-center"},Se={class:"px-1 pt-1 pb-0.5 overflow-hidden"},ze={class:"-mx-1 flex items-center gap-2 overflow-x-auto px-1"},$e={key:0,class:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-0.5 text-[11px] font-medium text-emerald-700 whitespace-nowrap"},Me={class:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2.5 py-0.5 text-[11px] font-medium text-amber-700 whitespace-nowrap"},Ae={class:"inline-flex items-center gap-1 rounded-full border border-red-200 bg-red-50 px-2.5 py-0.5 text-[11px] font-medium text-red-700 whitespace-nowrap"},Ue={class:"inline-flex items-center gap-1 rounded-full border border-sky-200 bg-sky-50 px-2.5 py-0.5 text-[11px] font-medium text-sky-700 whitespace-nowrap"},qe={class:"grid md:grid-cols-3 gap-2 mt-1"},Ce={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Ne={class:"text-sm text-zinc-900"},je={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Be={class:"text-sm text-zinc-900"},Fe={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Te={key:0,class:"text-sm text-zinc-900"},Le={key:1,class:"inline-block h-4 w-28 rounded bg-zinc-200 animate-pulse"},De={key:0},Ve={key:2,class:"space-y-4"},nt={__name:"EmployeeAttendance",setup(Ee){const U=ne(),q=oe(),r=fe(),C=xe(),y=new Date,_=s=>{if(!s)return"";if(typeof s=="string"){if(/^\d{4}-\d{2}$/.test(s))return s;const e=s.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(s),o=e.getFullYear(),l=String(e.getMonth()+1).padStart(2,"0");return`${o}-${l}`}catch{return""}},g=q.query,v=b(_(g.date)||_(r.selectedMonth)||_(y)),f=b({...((s,e)=>{const o=_(s)||_(e);if(!o)return{year:y.getFullYear(),month:y.getMonth()+1};const[l,p]=o.split("-");return{year:Number(l)||y.getFullYear(),month:Number(p)||y.getMonth()+1}})(v.value,y),day:1}),I=G(()=>{var e,o;if(!((e=f.value)!=null&&e.year)||!((o=f.value)!=null&&o.month))return"";const s=String(f.value.month).padStart(2,"0");return`${f.value.year}-${s}`}),n=b({company_id:g.company_id||"",department_id:g.department_id||"all",line_type:g.line_type||"all",employee_id:g.employee_id||""}),x=b(null);let z=null;const h=(s={})=>{z&&clearTimeout(z),z=setTimeout(()=>{const e={...q.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:v.value||"",...s};Object.keys(e).forEach(o=>{(e[o]===""||e[o]===void 0||e[o]===null)&&delete e[o]}),U.replace({query:e}).catch(()=>{})},150)},N=async s=>{if(!s){x.value=null;return}try{await C.fetchUser(s),x.value=C.user||null}catch(e){console.error("fetchUser error:",e),x.value=null}},w=b(""),$=async()=>{const s=n.value.employee_id,e=v.value;if(!s||!e)return;const o=`${s}|${e}`;if(o!==w.value){w.value=o;try{await r.getMonthlyAttendanceByShift(s,e)}catch(l){console.error("fetchAttendance error:",l),w.value=""}}};A(I,s=>{s&&(v.value=s,h({date:s}),n.value.employee_id&&$())}),A(()=>({...n.value}),()=>{h()}),A(()=>n.value.employee_id,async(s,e)=>{s&&s!==e&&(await N(s),await $()),s||(x.value=null,w.value="")}),re(async()=>{n.value.employee_id&&await N(n.value.employee_id),n.value.employee_id&&v.value&&await $(),await ae(),h()});const ee=()=>U.go(-1),te=()=>{h()},M=G(()=>!!n.value.employee_id),se=s=>{const e=Number(s??0);if(!Number.isFinite(e)||e<=0)return"0h";const o=Math.round(e*60),l=Math.floor(o/60),p=o%60;return p?`${l}h ${p}m`:`${l}h`};return(s,e)=>{var l,p,j,B,F,T,L,D,V,E,H,P,W,R,Y,J,O,K,Q;const o=le("router-link");return d(),m("div",_e,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:ee},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Job Card",-1)),e[7]||(e[7]=t("div",null,null,-1))]),t("div",ge,[S(pe,{company_id:n.value.company_id,"onUpdate:company_id":e[1]||(e[1]=i=>n.value.company_id=i),department_id:n.value.department_id,"onUpdate:department_id":e[2]||(e[2]=i=>n.value.department_id=i),employee_id:n.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=i=>n.value.employee_id=i),line_type:n.value.line_type,"onUpdate:line_type":e[4]||(e[4]=i=>n.value.line_type=i),"with-type":!0,"initial-value":s.$route.query,onFilterChange:te,class:"w-full"},{default:Z(()=>[t("div",ve,[e[8]||(e[8]=t("label",{for:"",class:"top-label -top-1"}," Month",-1)),S(me,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=i=>f.value=i),"show-year":!1,"show-month":!0,"show-date":!1},null,8,["modelValue"])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])]),t("div",be,[t("div",he,[M.value?(d(),X(ye,{key:0,user:x.value},null,8,["user"])):k("",!0),M.value?(d(),m("div",we,[t("div",ke,[e[10]||(e[10]=t("h2",{class:"text-sm md:text-base font-semibold text-zinc-900"},"Attendance Summary",-1)),S(o,{to:{name:"MonthWiseApplicationLog",query:{...s.$route.query}},class:"inline-flex items-center gap-1 rounded-md border border-zinc-200 bg-white px-2.5 py-1 text-[12px] font-medium text-zinc-700 hover:bg-zinc-50 active:scale-[.99]",target:"_blank",rel:"noopener noreferrer"},{default:Z(()=>e[9]||(e[9]=[t("i",{class:"far fa-clock text-[12px]"},null,-1),t("span",{class:"hidden sm:inline"},"Application History",-1),t("span",{class:"sm:hidden"},"History",-1)])),_:1,__:[9]},8,["to"])]),e[22]||(e[22]=t("div",{class:"h-px w-full bg-gradient-to-r from-indigo-500/70 via-sky-400/70 to-cyan-400/70"},null,-1)),t("div",Se,[t("div",ze,[s.presentRate!==null?(d(),m("span",$e,[e[11]||(e[11]=t("i",{class:"far fa-check-circle text-[11px]"},null,-1)),e[12]||(e[12]=c(" Present ")),t("strong",null,u(((p=(l=a(r))==null?void 0:l.summary)==null?void 0:p.total_present_days)||0)+"d",1)])):k("",!0),t("span",Me,[e[13]||(e[13]=t("i",{class:"far fa-clock text-[11px]"},null,-1)),e[14]||(e[14]=c(" Late ")),t("strong",null,u((B=(j=a(r))==null?void 0:j.summary)==null?void 0:B.actual_late_day)+"d",1)]),t("span",Ae,[e[15]||(e[15]=t("i",{class:"far fa-user-times text-[11px]"},null,-1)),e[16]||(e[16]=c(" Absent ")),t("strong",null,u(((T=(F=a(r))==null?void 0:F.summary)==null?void 0:T.total_absent_days)||0)+"d",1)]),t("span",Ue,[e[17]||(e[17]=t("i",{class:"far fa-bolt text-[11px]"},null,-1)),e[18]||(e[18]=c(" Total Weekends ")),t("strong",null,u((D=(L=a(r))==null?void 0:L.summary)==null?void 0:D.total_weekend_days)+"d",1)])])]),t("div",qe,[t("div",Ce,[e[19]||(e[19]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-briefcase text-[12px]"}),c(" Total Working Days ")],-1)),t("strong",Ne,u(((E=(V=a(r))==null?void 0:V.summary)==null?void 0:E.total_working_days)||0),1)]),t("div",je,[e[20]||(e[20]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-hourglass-half text-[12px]"}),c(" Working/Shift ")],-1)),t("strong",Be,u((((P=(H=a(r))==null?void 0:H.summary)==null?void 0:P.total_working_hours)??"").toString().trim()||"—")+" / "+u((((R=(W=a(r))==null?void 0:W.summary)==null?void 0:R.total_shift_hours)??"").toString().trim()||"—"),1)]),t("div",Fe,[e[21]||(e[21]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-bolt text-[12px]"}),c(" Overtime Hours ")],-1)),(Y=a(r))!=null&&Y.loading?(d(),m("span",Le)):(d(),m("strong",Te,u(se((O=(J=a(r))==null?void 0:J.summary)==null?void 0:O.approved_overtimes))+" of "+u((Q=(K=a(r))==null?void 0:K.summary)==null?void 0:Q.total_overtime_hours),1))])])])):k("",!0)])]),x.value?k("",!0):(d(),m("div",De,e[23]||(e[23]=[t("p",{class:"text-gray-400 text-center text-2xl italic"},"Select an employee, please.",-1)]))),a(r).isLoading?(d(),X(ce,{key:1})):ie((d(),m("div",Ve,[S(ue,{logs:a(r).monthlyLogs},null,8,["logs"])],512)),[[de,M.value]])])}}};export{nt as default};
