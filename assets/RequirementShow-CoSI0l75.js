import{r as y,e as F,c as a,o as r,a as e,f as N,g as c,w as $,F as U,h as j,j as T,p as S,v as L,i as R,B as ge,t as w,k as z,d as Ce,m as W,n as ke,y as K,x as V,N as Re,K as we,J as Se,b as Ie,u as Te,z as O}from"./index-BnkImPfz.js";import{L as B}from"./LoaderView-DyDNTiY4.js";import{O as M}from"./OverlyModal-DAQxLz-h.js";import{_ as G}from"./DescriptionView-DWJ_kbpP.js";import{R as _e}from"./RequiredIcon-DQrc6mJE.js";import{f as Q,s as De}from"./requirement-D7op8GBs.js";import{a as Ee,f as J,d as Ne,u as Ae,b as Ue,_ as je}from"./TaskAddForm-tl4KBb2S.js";import{u as Le}from"./department-DcNhxjJy.js";import{S as he}from"./SelectDropdown-Csf_yPDA.js";import{_ as H}from"./UserChip-C_FlooYP.js";import{u as qe}from"./user-BPRG_Zk2.js";import{_ as Pe}from"./TaskUserChip-hIb87wU0.js";import{u as Ve}from"./useTaskStore-DvL7jjdA.js";import{_ as Fe}from"./TaskSelectionInput-BZp1NLTD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-zi-yO5XC.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-6kuQxPVf.js";import"./SectionLoading-BmqjkZ0Q.js";import"./TextWithHr-J-2M_WuE.js";import"./TaskUrgencyInput-C4xSEPQI.js";const Oe={class:"sticky top-0 pt-4 bg-white z-10"},Me={class:"mb-4"},Be={class:"block text-gray-600 text-sm mb-1 font-medium"},ze={class:"mb-4"},Ge={class:"mb-4"},He={class:"mb-4"},We={class:"mb-4"},Ke={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Qe={key:0,class:"mb-4 text-red-500 font-medium"},Je={key:1,class:"mb-4"},Ye={class:"flex items-center justify-between gap-4"},Xe=["disabled"],Ze={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["create","closeClick","error"],setup(v,{emit:D}){const x=v,f=D,d=Le(),k=y(),o=y(""),u=y(),p=y({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),l=y([]);async function b(){var t,n;o.value="submitting";const s={...p.value};console.log({payload:s});try{const C=await Ee(x.requirementId,s);f("create",C),o.value="create"}catch(C){o.value="error",u.value=((n=(t=C.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to create requirement detail",f("error",u.value)}}return F(async()=>{var t;const s=((t=(await Q(x.requirementId)).data)==null?void 0:t.requirement)||{};l.value=await d.fetchDepartmentEmployee([s.from_department_id])}),(s,t)=>(r(),a("div",{class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative",ref_key:"formContainerRef",ref:k},[e("div",Oe,[t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement",-1)),t[8]||(t[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=$(n=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:$(b,["prevent"]),class:"z-0"},[o.value!=="loading"?(r(),a(U,{key:0},[e("div",Me,[e("label",Be,[t[9]||(t[9]=T("Title ")),S(_e)]),j(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>p.value.title=n),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,p.value.title]])]),e("div",ze,[t[10]||(t[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Details",-1)),j(e("textarea",{rows:"10","onUpdate:modelValue":t[2]||(t[2]=n=>p.value.description=n),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,p.value.description]])]),e("div",Ge,[t[12]||(t[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),S(he,{modelValue:p.value.supervisor_id,"onUpdate:modelValue":t[3]||(t[3]=n=>p.value.supervisor_id=n),options:l.value,placeholder:"--NO SUPERVISOR--",containment:k.value,clearable:"",class:"h-10"},{"list-header":R(()=>t[11]||(t[11]=[e("div",{class:"px-3 pt-2 pb-1 shadow-md text-xs uppercase bg-gray-50 text-gray-500"}," Employees ",-1)])),option:R(({option:n})=>[S(H,{user:n||{},class:"pr-5 -mx-1"},null,8,["user"])]),"selected-option":R(({option:n})=>[n?(r(),N(H,{key:0,user:n||{},class:"pr-4"},null,8,["user"])):c("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",He,[t[14]||(t[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),j(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[4]||(t[4]=n=>p.value.priority=n)},t[13]||(t[13]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ge,p.value.priority]])]),e("div",We,[t[15]||(t[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),j(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=n=>p.value.better_to_complete_on=n),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,p.value.better_to_complete_on]])])],64)):c("",!0),e("div",Ke,[u.value?(r(),a("div",Qe,w(u.value),1)):c("",!0),u.value?(r(),a("hr",Je)):c("",!0),e("div",Ye,[e("button",{type:"button",onClick:t[6]||(t[6]=$(n=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},w(o.value=="submitting"?"Saving...":"Add Requirement"),9,Xe)])])],32),o.value==="loading"||o.value==="submitting"?(r(),N(B,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512))}},et={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},tt={class:"mb-4"},st={class:"font-semibold"},nt={class:"mb-4"},rt={class:"line-clamp-2"},it={key:1,class:"min-h-40"},lt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ot={key:0,class:"mb-4 text-red-500 font-medium"},at={key:1,class:"mb-4"},dt={class:"flex items-center justify-between gap-4"},ut=["disabled"],mt={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(v,{emit:D}){const x=v,f=D,d=qe(),k=y(null),o=y(""),u=y(),p=y([]);async function l(){var b,s;o.value="submitting";try{const t=await Ne(x.requirementId,x.detailId);f("delete",t),o.value="create"}catch(t){o.value="error",u.value=((s=(b=t.response)==null?void 0:b.data)==null?void 0:s.message)||"Failed to update requirement detail: "+t,f("error",u.value)}}return F(async()=>{var b,s,t;o.value="loading";try{p.value=await d.fetchDepartmentWiseEmployees(),k.value=(b=(await J(x.requirementId,x.detailId)).data)==null?void 0:b.detail}catch(n){u.value=((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch requirement detail"}finally{o.value=""}}),(b,s)=>{var t,n;return r(),a("div",et,[s[4]||(s[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:$(l,["prevent"]),class:"z-0"},[o.value!=="loading"?(r(),a(U,{key:0},[e("div",tt,[s[1]||(s[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",st,w((t=k.value)==null?void 0:t.title),1)]),e("div",nt,[s[2]||(s[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",rt,w((n=k.value)==null?void 0:n.description),1)]),s[3]||(s[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(r(),a("div",it)),e("div",lt,[u.value?(r(),a("div",ot,w(u.value),1)):c("",!0),u.value?(r(),a("hr",at)):c("",!0),e("div",dt,[e("button",{type:"button",onClick:s[0]||(s[0]=$(C=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},w(o.value=="submitting"?"Deleting...":"Delete"),9,ut)])])],32),o.value==="loading"||o.value==="submitting"?(r(),N(B,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)])}}},pt={class:"sticky top-0 pt-4 bg-white z-10"},ct={class:"mb-4"},bt={class:"block text-gray-600 text-sm mb-1 font-medium"},vt={class:"mb-4"},ft={class:"mb-4"},yt={key:0,class:"relative w-full"},xt={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},gt={class:"mb-4"},kt={class:"mb-4"},wt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},_t={key:0,class:"mb-4 text-red-500 font-medium"},ht={key:1,class:"mb-4"},qt={class:"flex items-center justify-between gap-4"},$t=["disabled"],Ct={__name:"RequirementDetailEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(v,{emit:D}){const x=v,f=D,d=y(),k=qe(),o=y(null),u=y(""),p=y(),l=y({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),b=y([]);async function s(){var n,C;u.value="submitting";const t={...l.value};try{const g=await Ae(x.requirementId,x.detailId,t);f("update",g),u.value="create"}catch(g){u.value="error",p.value=((C=(n=g.response)==null?void 0:n.data)==null?void 0:C.message)||"Failed to update requirement detail",f("error",p.value)}}return F(async()=>{var t,n,C,g,E,A,m;u.value="loading";try{b.value=await k.fetchDepartmentWiseEmployees(),await k.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"}),o.value=(t=(await J(x.requirementId,x.detailId)).data)==null?void 0:t.detail,l.value={title:(n=o.value)==null?void 0:n.title,description:(C=o.value)==null?void 0:C.description,priority:(g=o.value)==null?void 0:g.priority,supervisor_id:(E=o.value)==null?void 0:E.supervisor_id};const _=new Date(o.value.better_to_complete_on);l.value.better_to_complete_on=_.toISOString().split("T")[0]}catch(_){p.value=((m=(A=_.response)==null?void 0:A.data)==null?void 0:m.message)||"Failed to fetch requirement detail"}finally{u.value=""}}),(t,n)=>{var C;return r(),a("div",{ref_key:"formContainerRef",ref:d,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",pt,[n[8]||(n[8]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),n[9]||(n[9]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:n[0]||(n[0]=$(g=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:$(s,["prevent"]),class:"z-0"},[u.value!=="loading"?(r(),a(U,{key:0},[e("div",ct,[e("label",bt,[n[10]||(n[10]=T("Title ")),S(_e)]),j(e("input",{"onUpdate:modelValue":n[1]||(n[1]=g=>l.value.title=g),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,l.value.title]])]),e("div",vt,[n[11]||(n[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),j(e("textarea",{rows:"10","onUpdate:modelValue":n[2]||(n[2]=g=>l.value.description=g),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,l.value.description]])]),e("div",ft,[n[12]||(n[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),S(he,{modelValue:l.value.supervisor_id,"onUpdate:modelValue":n[4]||(n[4]=g=>l.value.supervisor_id=g),options:[...z(k).users||[],...(z(k).users||[]).find(g=>{var E,A;return g.id==((A=(E=o.value)==null?void 0:E.supervisor)==null?void 0:A.id)})?[]:[(C=o.value)==null?void 0:C.supervisor]],containment:d.value,placeholder:"--NO SUPERVISOR--",class:"h-10"},{option:R(({option:g})=>[S(H,{user:g||{}},null,8,["user"])]),"selected-option":R(({option:g})=>[g?(r(),a("div",yt,[S(H,{user:g||{}},null,8,["user"]),l.value.supervisor_id?(r(),a("div",xt,[e("button",{onClick:n[3]||(n[3]=$(E=>l.value.supervisor_id=null,["prevent"])),class:"text-gray-6 font-semibold 00 hover:text-red-700"}," × ")])):c("",!0)])):c("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",gt,[n[14]||(n[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),j(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":n[5]||(n[5]=g=>l.value.priority=g)},n[13]||(n[13]=[e("option",{value:null},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ge,l.value.priority]])]),e("div",kt,[n[15]||(n[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),j(e("input",{type:"date","onUpdate:modelValue":n[6]||(n[6]=g=>l.value.better_to_complete_on=g),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,l.value.better_to_complete_on]])])],64)):c("",!0),e("div",wt,[p.value?(r(),a("div",_t,w(p.value),1)):c("",!0),p.value?(r(),a("hr",ht)):c("",!0),e("div",qt,[e("button",{type:"button",onClick:n[7]||(n[7]=$(g=>f("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:u.value=="loading"||u.value=="submitting",type:"submit",class:"btn-2"},w(u.value=="submitting"?"Saving...":"Edit"),9,$t)])])],32),u.value==="loading"||u.value==="submitting"?(r(),N(B,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512)}}},Rt=["rowspan"],St={class:"text-2xl font-medium"},It=["rowspan"],Tt={class:"text-lg font-semibold mb-2 flex items-start gap-3"},Dt={key:0},Et={key:0,class:"mb-5"},Nt=["innerHTML"],At={class:"flex items-end"},Ut={key:0,class:"mt-4 flex justify-between items-end print:pb-0"},jt={class:""},Lt={key:1,class:"ml-auto flex gap-6 items-center"},Pt=["rowspan"],Vt={class:"text-center print:text-xs"},Ft={class:"border-2 border-gray-700 p-3 text-center"},Ot=["title"],Mt={class:"border-2 border-gray-700 p-3"},Bt={class:"whitespace-nowrap text-center print:whitespace-break-spaces"},zt={key:0,class:"print:text-xs"},Gt={key:1,class:"text-gray-500"},Ht={key:0,colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Wt={key:1,class:"text-red-400"},Kt={key:2,class:"text-blue-400"},Qt={key:0},Jt={colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Yt={key:1,class:"text-red-400"},Xt={key:2,class:"text-blue-400"},Zt={__name:"RequirementDetailTableRow",props:{detail:{type:Object},requirement:{type:Object},serial:{type:Number},isPrinting:{type:Boolean}},emits:["editClick","deleteClick","taskCreateClick"],setup(v,{emit:D}){const x=v,f=D,d=Ce(),k=y(""),o=W(()=>{var p,l,b;return((l=(p=x.detail)==null?void 0:p.tasks)==null?void 0:l.length)>0?(b=x.detail)==null?void 0:b.tasks:[{id:0}]});function u(){var p,l,b,s,t;if(d.user.role!=="super_admin"&&((p=d.user)==null?void 0:p.id)!==((b=(l=x.requirement)==null?void 0:l.to_department)==null?void 0:b.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(t=(s=x.requirement)==null?void 0:s.to_department)==null?void 0:t.name}'s In charge can create or assign.`);f("taskCreateClick",x.detail)}return(p,l)=>{const b=ke("RouterLink");return r(),a(U,null,[(r(!0),a(U,null,K(o.value,(s,t)=>{var n,C,g,E,A,m,_,I,q;return r(),a("tr",{key:s.id,class:"group/item border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},[t===0?(r(),a(U,{key:0},[e("td",{class:"border-2 border-gray-700 p-3 align-top",rowspan:(((C=(n=v.detail)==null?void 0:n.tasks)==null?void 0:C.length)||1)+(v.isPrinting?0:1)},[e("span",St,w(v.serial),1)],8,Rt),e("td",{class:"border-2 border-gray-700 p-3",rowspan:(((E=(g=v.detail)==null?void 0:g.tasks)==null?void 0:E.length)||1)+(v.isPrinting?0:1)},[e("div",null,[e("div",Tt,[S(G,{"line-clamp":"3",class:"grow"},{default:R(()=>[T(w(v.detail.title),1)]),btnText:R(({lineClampClass:i})=>[T(w(i?"More":"Less"),1)]),_:1}),v.detail.priority?(r(),a("div",Dt,[e("span",{class:V(["font-semibold text-sm",{"text-yellow-600 ":v.detail.priority=="IMPORTANT","text-red-700 ":v.detail.priority=="URGENT"}])},w(v.detail.priority),3)])):c("",!0)]),l[3]||(l[3]=e("hr",{class:"mb-4 -mx-4"},null,-1)),v.detail.description?(r(),a("div",Et,[l[2]||(l[2]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),S(G,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"}},{default:R(()=>[e("p",{innerHTML:v.detail.description,class:"text-justify"},null,8,Nt)]),_:1})])):c("",!0)]),e("div",At,[v.detail.supervisor?(r(),a("div",Ut,[e("div",jt,[l[4]||(l[4]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Supervisor:",-1)),S(Pe,{user:v.detail.supervisor},null,8,["user"])])])):c("",!0),k.value!="loading"&&!((A=v.requirement)!=null&&A.status)||((_=(m=z(d))==null?void 0:m.user)==null?void 0:_.role)=="super_admin"?(r(),a("div",Lt,[e("button",{class:"btn-2",onClick:l[0]||(l[0]=$(i=>f("editClick",v.detail),["prevent"]))},l[5]||(l[5]=[e("i",{class:"fas fa-edit"},null,-1),T("Edit ")])),e("button",{class:"btn-2-red",onClick:l[1]||(l[1]=$(i=>f("deleteClick",v.detail),["prevent"]))},l[6]||(l[6]=[e("i",{class:"fas fa-trash-alt"},null,-1),T("Delete ")]))])):c("",!0)])],8,It),e("td",{class:"border-2 border-gray-700 p-3 whitespace-nowrap print:whitespace-break-spaces print:px-0",rowspan:(((q=(I=v.detail)==null?void 0:I.tasks)==null?void 0:q.length)||1)+(v.isPrinting?0:1)},[e("div",Vt,w(new Date(v.detail.better_to_complete_on).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)],8,Pt)],64)):c("",!0),s.id?(r(),a(U,{key:1},[e("td",Ft,[S(b,{title:s.title,to:{name:"RequirementTaskShow",params:{id:s.id}},class:"hover:underline text-gray-900 hover:text-blue-600 whitespace-nowrap block",target:"_blank"},{default:R(()=>[T(w(s.id)+" ",1),e("i",{title:s.status,class:V(["ml-1",{"fad fa-exclamation-circle text-red-600":s.status=="PENDING","fad fa-exclamation-square text-yellow-600":s.status=="IN_PROGRESS","fad fa-check-circle text-green-600":s.status=="COMPLETED"}])},null,10,Ot)]),_:2},1032,["title","to"])]),e("td",Mt,[e("div",Bt,[s.deadline?(r(),a("div",zt,w(new Date(s.deadline).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)):(r(),a("div",Gt,"-"))])])],64)):(r(),a(U,{key:2},[v.isPrinting?(r(),a("td",Ht,[v.requirement.status=="approved"?(r(),a("button",{key:0,onClick:$(u,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"},l[7]||(l[7]=[e("i",{class:"fas fa-plus-circle"},null,-1),T(" Create / Assign Task ")]))):v.requirement.status=="rejected"?(r(),a("div",Wt,"Task Rejected")):(r(),a("div",Kt,"Approval Pending"))])):c("",!0)],64))])}),128)),v.isPrinting?c("",!0):(r(),a("tr",Qt,[e("td",Jt,[v.requirement.status=="approved"?(r(),a("button",{key:0,onClick:$(u,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"},l[8]||(l[8]=[e("i",{class:"fas fa-plus-circle"},null,-1),T(" Create / Assign Task ")]))):v.requirement.status=="rejected"?(r(),a("div",Yt,"Task Rejected")):(r(),a("div",Xt,"Approval Pending"))])]))],64)}}},es={class:"sticky top-0 pt-4 bg-white z-10"},ts={class:"mb-4"},ss={class:"mb-4"},ns={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},rs={key:0,class:"mb-4 text-red-500 font-medium"},is={key:1,class:"mb-4"},ls={class:"flex items-center justify-between gap-4"},os=["disabled"],as={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(v,{emit:D}){const x=v,f=D,d=y(),k=y(null),o=y(""),u=y(),p=y({feedback:""});async function l(){var b,s;o.value="submitting";try{const t=await Ue(x.requirementId,x.detailId,p.value.feedback);f("update",t),o.value="create"}catch(t){o.value="error",u.value=((s=(b=t.response)==null?void 0:b.data)==null?void 0:s.message)||"Failed to update requirement detail",f("error",u.value)}}return F(async()=>{var b,s,t,n;o.value="loading";try{await Q(x.requirementId),k.value=(b=(await J(x.requirementId,x.detailId)).data)==null?void 0:b.detail,p.value={feedback:(s=k.value)==null?void 0:s.feedback}}catch(C){u.value=((n=(t=C.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to fetch requirement detail"}finally{o.value=""}}),(b,s)=>{var t;return r(),a("div",{ref_key:"formContainerRef",ref:d,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",es,[s[3]||(s[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),s[4]||(s[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:s[0]||(s[0]=$(n=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:$(l,["prevent"]),class:"z-0"},[o.value!=="loading"?(r(),a(U,{key:0},[e("div",ts,[s[5]||(s[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),S(G,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:R(()=>{var n;return[T(w((n=k.value)==null?void 0:n.title),1)]}),_:1})]),e("div",ss,[s[6]||(s[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),j(e("textarea",{rows:"5","onUpdate:modelValue":s[1]||(s[1]=n=>p.value.feedback=n),placeholder:"Enter requirement feedback",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[L,p.value.feedback]])])],64)):c("",!0),e("div",ns,[u.value?(r(),a("div",rs,w(u.value),1)):c("",!0),u.value?(r(),a("hr",is)):c("",!0),e("div",ls,[e("button",{type:"button",onClick:s[2]||(s[2]=$(n=>f("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"btn-2"},w(o.value=="submitting"?"Saving...":(t=k.value)!=null&&t.feedback?"Update Feedback":"Add Feedback"),9,os)])])],32),o.value==="loading"||o.value==="submitting"?(r(),N(B,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512)}}},ds={class:"flex justify-center items-center"},us={class:"modal-card"},ms=["required"],ps={class:"flex"},cs={class:"flex justify-between gap-2 mt-4"},bs=["disabled"],vs=["disabled"],fs={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(v,{emit:D}){const x=v,f=D,d=y(255),k=W(()=>d.value-b.value.length),o=Re(),u=y(null),p=y(null),l=y(null),b=y(""),s=y(!1),t=W(()=>l.value!==null);function n(m){l.value=m,b.value="",A()}function C(){l.value=null,b.value=""}async function g(){var m,_;if(l.value==="reject"&&!b.value)return o.error("Rejection Reason is required!");if(typeof x.onSubmit=="function")return x.onSubmit({note:b.value,action:l.value});f("loading",!0),s.value=!0;try{await De(x.requirementId,{note:b.value}),f("success"),C()}catch(I){return f("error",I),o.error(((_=(m=I==null?void 0:I.response)==null?void 0:m.data)==null?void 0:_.message)||"Submission failed!")}finally{f("loading",!1),s.value=!1}}function E(m){var _,I;t.value&&(m.key==="ArrowLeft"?(_=p.value)==null||_.focus():m.key==="ArrowRight"&&((I=u.value)==null||I.focus()))}function A(){Se(()=>{var m;(m=u.value)==null||m.focus()})}return F(()=>{window.addEventListener("keydown",E)}),we(()=>{window.removeEventListener("keydown",E)}),(m,_)=>(r(),a("div",null,[e("div",ds,[e("button",{onClick:_[0]||(_[0]=I=>n("accept"))},_[3]||(_[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),t.value?(r(),a("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:$(C,["self"])},[e("div",us,[_[4]||(_[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[j(e("textarea",{"onUpdate:modelValue":_[1]||(_[1]=I=>b.value=I),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:l.value==="reject",onInput:_[2]||(_[2]=I=>b.value.length>d.value?b.value=b.value.slice(0,d.value):null)},null,40,ms),[[L,b.value]]),e("div",ps,[e("div",{class:V(["ml-auto inline-block text-sm text-gray-500",b.value.length>=d.value?"text-red-500":""])}," left "+w(k.value)+"/"+w(d.value)+" words ",3)])]),e("div",cs,[e("button",{ref_key:"cancelBtnRef",ref:p,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:C,disabled:s.value}," Cancel ",8,bs),e("button",{ref_key:"confirmBtnRef",ref:u,class:V(["focus:ring-2 ring-offset-2 disabled:opacity-30",l.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:g,disabled:s.value}," Confirm Submission ",10,vs)])])])):c("",!0)]))}},ys={class:"flex items-center gap-6 justify-center my-16"},xs={key:0,class:"border rounded-md"},gs={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirementDetail:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(v,{emit:D}){const x=v,f=D,d=Ve(),k=y(""),o=y(null),u=y(""),p=y(!1);async function l(){await d.setTaskRequirement(u.value,x.requirementDetail.id),f("assignTask")}return(b,s)=>(r(),a("div",{class:V(["text-left p-4",[k.value&&!o.value?"min-h-[400px]":""]])},[e("div",ys,[e("button",{onClick:s[0]||(s[0]=$(t=>f("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),s[5]||(s[5]=e("span",null,"or",-1)),e("button",{class:V({"btn-3":k.value!=="direct-assign","btn-2":k.value=="direct-assign"}),onClick:s[1]||(s[1]=$(()=>k.value="direct-assign",["prevent"]))}," Assign Task ",2)]),k.value&&!o.value?(r(),a("div",xs,[e("form",{onSubmit:$(l,["prevent"]),class:"p-4 flex items-end"},[S(Fe,{class:"flex-grow mr-4 h-12",taskId:u.value,"onUpdate:taskId":s[2]||(s[2]=t=>u.value=t),show:p.value,"onUpdate:show":s[3]||(s[3]=t=>p.value=t),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":v.fromDepartmentId},filterTasks:t=>!t.requirement_detail_id,onAddNewTaskClick:s[4]||(s[4]=t=>f("addNewTaskClick"))},null,8,["taskId","show","taskQueryParams","filterTasks"]),s[6]||(s[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):c("",!0)],2))}},ks={class:"container mx-auto p-6 print:p-0 w-full print:max-w-full"},ws={class:"bg-white rounded shadow print:shadow-none p-4 print:p-0 relative"},_s={class:"flex items-start"},hs={class:"mb-4 text-lg print:black print:font-bold"},qs={class:"ml-auto print:hidden flex gap-2 items-center"},$s={class:"mb-4 flex items-center gap-1 print:mb-1"},Cs={class:"font-bold print:text-gray-900"},Rs={class:"mb-3 flex items-center gap-3 print:mb-1"},Ss={class:"print:text-gray-900"},Is={key:0,class:"mb-3 flex items-center gap-3 print:mb-1"},Ts={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},Ds={key:1,class:"mb-3 flex items-center gap-3 print:mb-1"},Es={class:"print:text-gray-900"},Ns={key:0,class:"overflow-x-auto print:overflow-visible"},As={class:"w-full table-auto print:table-fixed"},Us={colspan:"2",class:"w-[30%] border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap px-3 py-1 print:whitespace-normal"},js={class:""},Ls={class:"p-3 border-2 border-gray-800",colspan:"5"},Ps={class:"font-semibold text-gray-500 print:text-gray-800 text-sm mb-1"},Vs={key:0},Fs=["innerHTML"],Os=["onClick"],Ms={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Bs={class:"flex flex-col items-end"},zs={key:2,class:"mt-2 text-right print:hidden"},cn={__name:"RequirementShow",setup(v){const D=Ie(),x=Te(),f=y(""),d=y(null),k=O({open:!1}),o=O({detail:null,open:!1}),u=O({detail:null,open:!1}),p=O({detail:null,open:!1}),l=y(!1),b=()=>l.value=!0,s=()=>l.value=!1;F(async()=>{await t(),window.addEventListener("beforeprint",b),window.addEventListener("afterprint",s)}),we(()=>{window.removeEventListener("beforeprint",b),window.removeEventListener("afterprint",s)});async function t(){var q;f.value="loading",d.value=(q=(await Q(D.params.id)).data)==null?void 0:q.requirement,f.value=""}function n(q){console.log({detail:q}),m.modalShown=!0,m.from_department_id=d.value.from_department_id,m.to_department_id=d.value.to_department_id,m.taskDefaultValues={title:"",description:"",from_department_id:d.value.from_department_id,to_department_id:d.value.to_department_id,is_important:(q==null?void 0:q.priority)=="IMPORTANT",is_urgent:(q==null?void 0:q.priority)=="URGENT",supervisor_ids:q!=null&&q.supervisor_id?[q==null?void 0:q.supervisor_id]:[]},m.requirementDetail=q}function C(){k.open=!0}function g(q){o.open=!0,o.detail=q}function E(q){p.open=!0,p.detail=q}function A(){setTimeout(()=>window.print()),l.value=!0}const m=O({parentId:null,modalShown:!1,requirementId:0,taskDefaultValues:{},requirementDetail:null,creating:!1});async function _(){m.parentId=0,m.parentId=null,m.modalShown=!1,m.requirementDetail=null,f.value="loading",await t()}async function I(){m.parentId=null,m.modalShown=!1,m.requirementDetail=null,m.creating=!1}return(q,i)=>{var Y,X,Z,ee,te,se,ne,re,ie,le,oe,ae,de,ue,me,pe,ce,be,ve;const $e=ke("RouterLink");return r(),a("div",ks,[k.open?(r(),N(M,{key:0,class:"*:max-w-4xl"},{default:R(()=>[S(Ze,{requirementId:d.value.id,onCloseClick:i[0]||(i[0]=h=>k.open=!1),onCreate:i[1]||(i[1]=async()=>{k.open=!1,await t()})},null,8,["requirementId"])]),_:1})):c("",!0),o.open?(r(),N(M,{key:1},{default:R(()=>{var h;return[S(Ct,{requirementId:d.value.id,detailId:(h=o.detail)==null?void 0:h.id,onCloseClick:i[2]||(i[2]=P=>o.open=!1),onUpdate:i[3]||(i[3]=async()=>{o.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),u.open?(r(),N(M,{key:2},{default:R(()=>{var h;return[S(as,{requirementId:d.value.id,detailId:(h=u.detail)==null?void 0:h.id,onCloseClick:i[4]||(i[4]=P=>u.open=!1),onUpdate:i[5]||(i[5]=async()=>{u.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),p.open?(r(),N(M,{key:3},{default:R(()=>{var h;return[S(mt,{requirementId:d.value.id,detailId:(h=p.detail)==null?void 0:h.id,onCloseClick:i[6]||(i[6]=P=>p.open=!1),onDelete:i[7]||(i[7]=async()=>{p.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),m.modalShown?(r(),N(M,{key:4,class:"*:relative"},{default:R(()=>{var h,P;return[e("button",{onClick:$(I,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},i[10]||(i[10]=[e("i",{class:"fas fa-times-circle"},null,-1)])),m!=null&&m.creating?c("",!0):(r(),N(gs,{key:0,"from-department-id":(h=d.value)==null?void 0:h.from_department_id,requirementDetail:m==null?void 0:m.requirementDetail,onCancelClick:I,onAddNewTaskClick:i[8]||(i[8]=()=>{m.modalShown=!0,m.creating=!0}),onAssignTask:_},null,8,["from-department-id","requirementDetail"])),m!=null&&m.creating?(r(),N(je,{key:1,requirementDetailId:(P=m==null?void 0:m.requirementDetail)==null?void 0:P.id,requirementId:d.value.id,onClose:I,onTaskCreated:_,defaultValues:m.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):c("",!0)]}),_:1})):c("",!0),e("div",ws,[e("div",_s,[e("div",hs,[i[11]||(i[11]=e("div",{class:"text-gray-800 leading-none"},"To",-1)),e("div",null,w((X=(Y=d.value)==null?void 0:Y.to_department)==null?void 0:X.name),1)]),e("div",qs,[(((Z=d.value)==null?void 0:Z.details)||[]).length>0?(r(),a("button",{key:0,class:"btn-3 font-semibold !pl-2 !pr-4",onClick:$(A,["prevent"])},i[12]||(i[12]=[e("i",{class:"fad fa-print text-xl"},null,-1),T("Print ")]))):c("",!0),e("button",{class:"btn-3",onClick:i[9]||(i[9]=$(()=>z(x).back(),["prevent"]))},"Back"),S($e,{class:"btn-2",to:`/requirements/edit/${(ee=d.value)==null?void 0:ee.id}`},{default:R(()=>i[13]||(i[13]=[T("Edit")])),_:1,__:[13]},8,["to"])])]),i[28]||(i[28]=e("div",{class:"text-center text-xl font-bold mb-2 underline"},"Requirement Form",-1)),e("div",$s,[i[14]||(i[14]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",Cs,w((te=d.value)==null?void 0:te.id),1)]),e("div",Rs,[i[15]||(i[15]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),e("div",Ss,w((ne=(se=d.value)==null?void 0:se.from_department)==null?void 0:ne.name),1)]),((ie=(re=d.value)==null?void 0:re.website_tags)==null?void 0:ie.length)>0?(r(),a("div",Is,[i[16]||(i[16]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",Ts,[(r(!0),a(U,null,K(((le=d.value)==null?void 0:le.website_tags)||[],h=>(r(),a("div",{key:h.id,class:"border px-2 rounded-md bg-gray-50 shadow-sm whitespace-nowrap"},w(h.name),1))),128))])])):c("",!0),(oe=d.value)!=null&&oe.submission_date?(r(),a("div",Ds,[i[17]||(i[17]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",Es,w(new Date((ae=d.value)==null?void 0:ae.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)])):c("",!0),i[29]||(i[29]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[i[27]||(i[27]=e("div",{class:"flex items-end mb-3"},[e("h2",{class:"text-xl font-semibold"},"Requirements"),e("div",{class:"ml-auto print:hidden flex gap-2 text-sm"})],-1)),(((de=d.value)==null?void 0:de.details)||[]).length>0?(r(),a("div",Ns,[e("table",As,[e("thead",null,[e("tr",null,[i[18]||(i[18]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-left px-4 print:px-2 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[8%]"}," SL ",-1)),i[19]||(i[19]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap print:whitespace-normal w-[65%]"}," Requirement Details ",-1)),i[20]||(i[20]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Better To Complete ",-1)),e("th",Us," For '"+w(((ue=d.value.to_department)==null?void 0:ue.short_name)||((me=d.value.to_department)==null?void 0:me.name))+"' Use ",1)]),i[21]||(i[21]=e("tr",null,[e("td",{class:"whitespace-nowrap border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold print:text-xs"}," Task No "),e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:text-xs print:p-0"}," Expected Date ")],-1))]),e("tbody",null,[(r(!0),a(U,null,K(((pe=d.value)==null?void 0:pe.details)||[],(h,P)=>{var fe,ye,xe;return r(),a(U,{key:h.id},[S(Zt,{requirement:d.value,detail:h,serial:P+1,onEditClick:g,onDeleteClick:E,onTaskCreateClick:n,isPrinting:l.value},null,8,["requirement","detail","serial","isPrinting"]),e("tr",js,[e("td",Ls,[e("div",Ps," '"+w(((fe=d.value.to_department)==null?void 0:fe.short_name)||((ye=d.value.to_department)==null?void 0:ye.name))+"' Feedback ",1),f.value!="loading"&&((xe=d.value)!=null&&xe.status)?(r(),a("div",Vs,[h!=null&&h.feedback?(r(),N(G,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:R(()=>[e("p",{class:"text-sky-800 text-sm text-justify",innerHTML:h==null?void 0:h.feedback},null,8,Fs)]),_:2},1024)):c("",!0),e("div",null,[e("button",{class:"btn-3 print:hidden",onClick:$(()=>{u.open=!0,u.detail=h},["prevent"])},w(h.feedback?"Update Feedback":"Add feedback"),9,Os)])])):c("",!0)])])],64)}),128))])])])):c("",!0),f.value!="loading"&&!((ce=d.value)!=null&&ce.status)?(r(),a("div",Ms,[e("button",{class:"btn-2 pl-2 text-base",onClick:$(C,["prevent"])},i[22]||(i[22]=[e("i",{class:"fad fa-plus-circle text-2xl mr-2"},null,-1),T("Add Requirement ")])),e("div",Bs,[S(fs,{"requirement-id":(be=d.value)==null?void 0:be.id,onSuccess:t},{heading:R(()=>i[23]||(i[23]=[T(" Requirement Submission ")])),acceptButtonLabel:R(()=>i[24]||(i[24]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),T("Submit Requirement ")],-1)])),submitButtonLabel:R(()=>i[25]||(i[25]=[T(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):c("",!0),f.value!="loading"&&!((ve=d.value)!=null&&ve.status)?(r(),a("div",zs,i[26]||(i[26]=[e("p",{class:"text-yellow-800 text-sm"},[e("span",{class:"fas fa-exclamation-circle"}),T(" After submitting you cannot add requirement no more ")],-1)]))):c("",!0)]),f.value==="loading"?(r(),N(B,{key:2,class:"absolute inset-0 bg-opacity-90"})):c("",!0)])])}}};export{cn as default};
