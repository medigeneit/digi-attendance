import{d as ne,r as _,q as I,a3 as te,A as de,e as le,c as u,o as r,a as e,f as W,w as ue,g,h,v as j,D as ie,t as v,F as $,x as V,k as p,a4 as H,p as C,u as ve,b as ye,s as ce,n as me,C as pe,j as L,i as se,a5 as _e}from"./index-BR60YnFV.js";import{L as oe}from"./LoaderView-IjGxua2b.js";import{_ as fe}from"./MultiselectDropdown-Bb05-W-n.js";import{u as ge}from"./holiday-CwraZ5_s.js";import{u as ae}from"./leave-application-Dm1aAQf0.js";import{u as be}from"./leave-type-Cm1w07hE.js";import{u as re}from"./user-BypTyudl.js";import{_ as xe}from"./EmployeeFilter-_o8QIloG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-DwKzgJG2.js";import"./department-CkF1KV4b.js";const he={class:"space-y-4 p-2 md:p-4"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ke={class:"inline-flex items-center space-x-2"},De={key:0},Ae={class:"text-blue-600 font-medium"},Se={key:1,class:"bg-gray-100 p-2 rounded-md"},Le={class:"font-semibold"},$e={class:"flex flex-wrap gap-2"},Te=["name","value","onUpdate:modelValue"],Ue={class:"flex items-center space-x-1"},Ce=["name","onUpdate:modelValue"],Ve={class:"flex items-center space-x-1"},qe=["name","onUpdate:modelValue"],Re={key:2},Fe={key:3},Me={key:4,class:"text-red-500 text-sm"},je={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(Y,{emit:q}){const n=Y,w=q,b=ae(),S=be(),T=re();ne();const U=ge(),D=_(""),k=_(!0),a=_({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),y=_([]),x=_(!1),A=_(null),N=I(()=>{var d,s,o;return((s=(d=n==null?void 0:n.userInfo)==null?void 0:d.assign_weekend)==null?void 0:s.weekends)||((o=n==null?void 0:n.userInfo)==null?void 0:o.weekends)}),m=I(()=>{const d=a.value.last_working_date,s=a.value.resumption_date;if(!d||!s)return[];const o=new Date(d),t=new Date(s);if(t<=o)return[];const c=[];let i=new Date(o);for(i.setDate(i.getDate()+1);i<t;){const f=i.getFullYear(),R=(i.getMonth()+1).toString().padStart(2,"0"),F=i.getDate().toString().padStart(2,"0");c.push(`${f}-${R}-${F}`),i.setDate(i.getDate()+1)}return c}),E=I(()=>{if(!a.value.last_working_date||!a.value.resumption_date)return"";const d=new Date(a.value.last_working_date);return new Date(a.value.resumption_date)<=d?"Resumption date must be after Last Working Date.":m.value.length===0?"No leave days between the selected dates.":`Total leave days: ${m.value.length}`});te(async()=>{var d;m.value.length&&S.leaveTypes.length&&(y.value.length!==m.value.length&&(y.value=m.value.map(()=>S.leaveTypes[0].id)),await U.fetchHolidays({company_id:(d=n==null?void 0:n.userInfo)==null?void 0:d.company_id,start_date:m.value[0],end_date:m.value[m.value.length-1]}),m.value.forEach(async(s,o)=>{const t=new Date(s).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),c=t.charAt(0).toUpperCase()+t.slice(1);N.value.includes(c)&&(y.value[o]="weekend"),U.holidayDates.includes(s)&&(y.value[o]="holiday")}))}),de(()=>D.value,d=>{a.value.handover_user_id=d==null?void 0:d.id});const B=async()=>{var d;x.value=!0,A.value=null;try{const s=m.value.map((i,f)=>({date:i,leave_type_id:y.value[f]!=="weekend"&&y.value[f]!=="holiday"?y.value[f]:null})).filter(i=>i.leave_type_id!==null),o=m.value.map((i,f)=>({date:i,leave_type_id:y.value[f]||""})).filter(i=>i.leave_type_id!==null),t={user_id:(d=n==null?void 0:n.userInfo)==null?void 0:d.id,last_working_date:a.value.last_working_date,resumption_date:a.value.resumption_date,reason:a.value.reason,works_in_hand:a.value.works_in_hand,handover_user_id:k.value?null:a.value.handover_user_id,leave_days:s,json_data:o,is_direct_approve:k.value};await b.storeAdminLeaveApplication(t)&&w("formSuccessClosed")}catch(s){A.value=s.message||"Failed to submit leave application"}finally{x.value=!1}};return le(async()=>{te(()=>{var s;const d=(s=n==null?void 0:n.userInfo)==null?void 0:s.company_id;d&&S.fetchLeaveTypes(d)}),await T.fetchTypeWiseEmployees({except:"auth"})}),(d,s)=>(r(),u("div",he,[s[16]||(s[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),x.value?(r(),W(oe,{key:0})):(r(),u("form",{key:1,onSubmit:ue(B,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",we,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),h(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=o=>a.value.last_working_date=o),class:"input-1 w-full",required:""},null,512),[[j,a.value.last_working_date]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),h(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=o=>a.value.resumption_date=o),class:"input-1 w-full",required:""},null,512),[[j,a.value.resumption_date]])])]),e("div",null,[e("label",ke,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=o=>k.value=o),class:"form-checkbox text-blue-600"},null,512),[[ie,k.value]]),s[8]||(s[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),a.value.last_working_date&&a.value.resumption_date?(r(),u("div",De,[e("p",Ae,v(E.value),1)])):g("",!0),m.value.length?(r(),u("div",Se,[s[11]||(s[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),e("div",null,[(r(!0),u($,null,V(m.value,(o,t)=>(r(),u("div",{key:t,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[e("div",Le,v(o),1),e("div",$e,[(r(!0),u($,null,V(p(S).leaveTypes,c=>(r(),u("label",{key:c.id,class:"flex items-center space-x-1"},[h(e("input",{type:"radio",name:"leaveType-"+t,value:c.id,"onUpdate:modelValue":i=>y.value[t]=i},null,8,Te),[[H,y.value[t]]]),e("span",null,v(c.name),1)]))),128)),e("label",Ue,[h(e("input",{type:"radio",name:"leaveType-"+t,value:"weekend","onUpdate:modelValue":c=>y.value[t]=c},null,8,Ce),[[H,y.value[t]]]),s[9]||(s[9]=e("span",null,"Weekend",-1))]),e("label",Ve,[h(e("input",{type:"radio",name:"leaveType-"+t,value:"holiday","onUpdate:modelValue":c=>y.value[t]=c},null,8,qe),[[H,y.value[t]]]),s[10]||(s[10]=e("span",null,"Holiday",-1))])])]))),128))])])):g("",!0),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),h(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=o=>a.value.reason=o),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[j,a.value.reason]])]),k.value?g("",!0):(r(),u("div",Re,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),C(fe,{modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=o=>D.value=o),options:p(T).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),k.value?g("",!0):(r(),u("div",Fe,[s[14]||(s[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),h(e("textarea",{id:"works-in-hand","onUpdate:modelValue":s[5]||(s[5]=o=>a.value.works_in_hand=o),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[j,a.value.works_in_hand]])])),A.value?(r(),u("div",Me,v(A.value),1)):g("",!0),s[15]||(s[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Ie={class:"space-y-2 px-4"},Ne={class:"flex flex-wrap gap-2"},Ee=["value"],Be={key:0,class:"text-center py-4"},He={key:1,class:"space-y-4"},We={class:"overflow-x-auto"},Ye={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},ze={key:0,class:"bg-sky-200/20 text-center"},Pe={class:"border border-gray-300 py-2 text-center",colspan:"3"},Oe={class:""},Je={class:"grid md:grid-cols-2"},Ge={class:"py-1"},Ke={class:"py-1"},Qe={class:"py-1"},Xe={class:"py-1"},Ze={class:"py-1"},et={class:"py-1"},tt={class:"border border-gray-300 py-2 text-center",colspan:"4"},st={class:""},lt={class:"overflow-x-auto min-h-max"},ot={class:"min-w-full text-sm text-left text-gray-500"},at={class:"px-6 text-center font-medium text-gray-900"},rt={class:"px-6 text-center"},nt={class:"px-6 text-center"},dt={class:"px-6 text-center"},ut={class:"border border-gray-300 px-2 py-2"},it={class:"border border-gray-300 px-2 py-2 text-center"},vt={class:"border border-gray-300 px-2 py-2 text-center"},yt={class:"border border-gray-300 px-2 py-2"},ct={class:"border border-gray-300 px-2 py-2"},mt=["innerHTML"],pt={class:"border border-gray-300 px-2 py-2 text-center"},_t={class:"border border-gray-300 px-2 py-2"},ft={class:"border border-gray-300 px-2"},gt={class:"flex justify-center gap-2"},bt=["onClick"],xt={key:0},ht={key:0},wt={class:"text-center py-2",colspan:"6"},kt={key:0,class:"fixed inset-0 z-[1000] bg-black bg-opacity-50 flex items-center justify-center"},Dt={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},Mt={__name:"AdminLeaveApplication",setup(Y){const q=ve(),n=ye(),w=ae();re();const{user:b,leave_balances:S,leaveApplications:T,loading:U}=ce(w),D=_(n.query.year||w.selectedYear),k=_(n.query.search||""),a=_({company_id:n.query.company_id||"",department_id:n.query.department_id||"all",type:n.query.type||"all",employee_id:n.query.employee_id||""}),y=_(!1),x=async()=>{const o={selectedYear:D.value,selectedStatus:w.selectedStatus,query:k.value};a.value.employee_id?(o.user_id=a.value.employee_id,U.value=!0,await w.fetchYearlyUserLeaveApplications(o),U.value=!1):T.value=[]};le(async()=>{await x()});const A=I(()=>T.value||[]),N=()=>q.go(-1),m=async()=>{q.replace({query:{...n.query,company_id:a.value.company_id,department_id:a.value.department_id,type:a.value.type,employee_id:a.value.employee_id}}),await x()},E=async()=>{console.log("test close"),y.value=!1,await x()},B=new Date().getFullYear(),d=_([]);for(let o=2023;o<=B;o++)d.value.push(o);const s=async o=>{confirm("Are you sure to delete this application?")&&(await w.deleteLeaveApplication(o),await x())};return(o,t)=>{var i,f,R,F,z,P,O,J,G,K,Q;const c=me("RouterLink");return r(),u($,null,[e("div",Ie,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:N},t[5]||(t[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[6]||(t[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),t[7]||(t[7]=e("div",null,null,-1))]),e("div",Ne,[C(xe,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value=l),"initial-value":p(n).query,onFilterChange:m},null,8,["modelValue","initial-value"]),e("div",null,[h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>D.value=l),onChange:x,class:"input-1"},[(r(!0),u($,null,V(d.value,l=>(r(),u("option",{key:l,value:l},v(l),9,Ee))),128))],544),[[pe,D.value]])])]),p(w).loading?(r(),u("div",Be,[C(oe)])):(r(),u("div",He,[e("div",We,[e("table",Ye,[e("thead",null,[(i=a.value)!=null&&i.employee_id?(r(),u("tr",ze,[e("th",Pe,[e("div",Oe,[t[14]||(t[14]=e("h2",{class:"text-lg font-semibold text-center py-2"},"User Info",-1)),t[15]||(t[15]=e("hr",null,null,-1)),e("div",Je,[e("p",Ge,[t[8]||(t[8]=e("strong",null,"Name:",-1)),L(" "+v((f=p(b))==null?void 0:f.name),1)]),e("p",Ke,[t[9]||(t[9]=e("strong",null,"Designation:",-1)),L(" "+v((F=(R=p(b))==null?void 0:R.designation)==null?void 0:F.title),1)]),e("p",Qe,[t[10]||(t[10]=e("strong",null,"Department:",-1)),L(" "+v((P=(z=p(b))==null?void 0:z.department)==null?void 0:P.name),1)]),e("p",Xe,[t[11]||(t[11]=e("strong",null,"Company:",-1)),L(" "+v((J=(O=p(b))==null?void 0:O.company)==null?void 0:J.name),1)]),e("p",Ze,[t[12]||(t[12]=e("strong",null,"Phone:",-1)),L(" "+v((G=p(b))==null?void 0:G.phone),1)]),e("p",et,[t[13]||(t[13]=e("strong",null,"Email:",-1)),L(" "+v((K=p(b))==null?void 0:K.email),1)])])])]),e("th",tt,[e("div",st,[e("div",lt,[e("table",ot,[t[16]||(t[16]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 text-center py-1"},"Type"),e("th",{scope:"col",class:"px-6 text-center py-1"},"Total Days"),e("th",{scope:"col",class:"px-6 text-center py-1"},"Used Days"),e("th",{scope:"col",class:"px-6 text-center py-1"},"Remaining Days")])],-1)),e("tbody",null,[(r(!0),u($,null,V(p(S),l=>(r(),u("tr",{key:l.id,class:"border-b hover:bg-gray-100"},[e("td",at,v(l.leave_type),1),e("td",rt,v(l.total_leave_days),1),e("td",nt,v(l.used_days),1),e("td",dt,v(l.remaining_days),1)]))),128))])])])])])])):g("",!0),t[17]||(t[17]=e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Type"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")],-1))]),e("tbody",null,[(r(!0),u($,null,V(A.value,(l,X)=>{var Z;return r(),u("tr",{key:X,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ut,v(X+1),1),e("td",it,v(l==null?void 0:l.last_working_date),1),e("td",vt,v(l==null?void 0:l.resumption_date),1),e("td",yt,v(l==null?void 0:l.leave_period),1),e("td",ct,[e("div",{innerHTML:(l==null?void 0:l.duration)||(l==null?void 0:l.total_leave_days)},null,8,mt)]),e("td",pt,v([...new Set((Z=l==null?void 0:l.leave_days)==null?void 0:Z.map(M=>{var ee;return(ee=M==null?void 0:M.leave_type)==null?void 0:ee.name}))].join(",")),1),e("td",_t,v((l==null?void 0:l.status)||"N/A"),1),e("td",ft,[e("div",gt,[C(c,{to:{name:"LeaveApplicationShow",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:se(()=>t[18]||(t[18]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[18]},1032,["to"]),["Approved","Rejected"].includes(l==null?void 0:l.status)?g("",!0):(r(),W(c,{key:0,to:{name:"LeaveApplicationEdit",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:se(()=>t[19]||(t[19]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[19]},1032,["to"])),e("button",{onClick:M=>s(l==null?void 0:l.id),class:"btn-icon text-red-500"},t[20]||(t[20]=[e("i",{class:"far fa-trash"},null,-1)]),8,bt)])])])}),128)),A.value.length?g("",!0):(r(),u("tr",xt,t[21]||(t[21]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(Q=a.value)!=null&&Q.employee_id?(r(),u("tr",ht,[e("th",wt,[e("button",{onClick:t[2]||(t[2]=l=>y.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):g("",!0)])])])]))]),(r(),W(_e,{to:"body"},[y.value?(r(),u("div",kt,[e("div",Dt,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:t[3]||(t[3]=l=>y.value=!1)}," × "),C(je,{userInfo:p(b),onClose:t[4]||(t[4]=l=>y.value=!1),onFormSuccessClosed:E},null,8,["userInfo"])])])):g("",!0)]))],64)}}};export{Mt as default};
