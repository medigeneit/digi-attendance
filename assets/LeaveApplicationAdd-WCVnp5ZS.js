import{u as j,d as q,r as f,q as h,a2 as U,A as z,e as I,k as J,c as m,o as p,a as t,m as P,l as T,p as Y,n as G,w as K,f as D,g as c,v as k,t as w,F as V,x as A,h as E,a3 as x}from"./index-Lkck5I2M.js";import{L as O}from"./LoaderView-CkU8ir37.js";import{_ as Q}from"./MultiselectDropdown-CAs_PuFG.js";import{u as X}from"./holiday-hhhJkM1T.js";import{u as Z}from"./leave-application-DubYbhhS.js";import{u as ee}from"./leave-type-MHKzDrWf.js";import{u as te}from"./user-CYf3T0HJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-C1nYzVk5.js";const ae={class:"my-container max-w-3xl space-y-4"},se={class:"flex items-center justify-between gap-2"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={key:0,class:""},ne={class:"text-blue-600 font-medium"},re={key:1,class:"bg-gray-100 p-2 rounded-md"},de={class:"font-semibold"},ie={class:"flex flex-wrap gap-2"},ue=["name","value","onUpdate:modelValue"],pe={class:"flex items-center space-x-1"},ve=["name","onUpdate:modelValue"],me={class:"flex items-center space-x-1"},ce=["name","onUpdate:modelValue"],fe={key:2,class:"text-red-500 text-sm"},Se={__name:"LeaveApplicationAdd",setup(ye){const L=j(),H=Z(),y=ee(),S=te(),i=q(),R=X(),g=f(""),l=f({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),d=f([]),b=f(!1),_=f(null),B=h(()=>{var a,e,r;return((e=(a=i==null?void 0:i.user)==null?void 0:a.assign_weekend)==null?void 0:e.weekends)||((r=i==null?void 0:i.user)==null?void 0:r.weekends)}),u=h(()=>{const a=l.value.last_working_date,e=l.value.resumption_date;if(!a||!e)return[];const r=new Date(a),o=new Date(e);if(o<=r)return[];const n=[];let s=new Date(r);for(s.setDate(s.getDate()+1);s<o;){const v=s.getFullYear(),F=(s.getMonth()+1).toString().padStart(2,"0"),$=s.getDate().toString().padStart(2,"0");n.push(`${v}-${F}-${$}`),s.setDate(s.getDate()+1)}return n}),C=h(()=>{const a=l.value.last_working_date,e=l.value.resumption_date;if(!a||!e)return"";const r=new Date(a);return new Date(e)<=r?"Resumption date must be after Last Working Date.":u.value.length===0?"No leave days between the selected dates.":`Total leave days: ${u.value.length}`});U(()=>{u.value.length&&y.leaveTypes.length&&(d.value.length!==u.value.length&&(d.value=u.value.map(()=>y.leaveTypes[0].id)),u.value.forEach(async(a,e)=>{const r=new Date(a).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),o=r.charAt(0).toUpperCase()+r.slice(1);B.value.includes(o)&&(d.value[e]="weekend"),await W(a)&&(d.value[e]="holiday")}))}),z(()=>g.value,a=>{l.value.handover_user_id=a==null?void 0:a.id});const M=async()=>{var a;b.value=!0,_.value=null;try{const e=u.value.map((s,v)=>({date:s,leave_type_id:d.value[v]!=="weekend"&&d.value[v]!=="holiday"?d.value[v]:null})).filter(s=>s.leave_type_id!==null),r=u.value.map((s,v)=>({date:s,leave_type_id:d.value[v]||""})).filter(s=>s.leave_type_id!==null),o={user_id:(a=i==null?void 0:i.user)==null?void 0:a.id,last_working_date:l.value.last_working_date,resumption_date:l.value.resumption_date,reason:l.value.reason,works_in_hand:l.value.works_in_hand,handover_user_id:l.value.handover_user_id,leave_days:e,json_data:r},n=await H.storeLeaveApplication(o);n&&L.push({name:"LeaveApplicationShow",params:{id:n==null?void 0:n.id}})}catch(e){_.value=e.message||"Failed to submit leave application"}finally{b.value=!1}};I(()=>{U(()=>{var e;const a=(e=i==null?void 0:i.user)==null?void 0:e.company_id;a&&y.fetchLeaveTypes(a)}),S.fetchTypeWiseEmployees({except:"auth"})});const N=()=>{L.go(-1)},W=async a=>{var e;try{return(((e=(await R.fetchHolidays({start_date:a}))[0])==null?void 0:e.start_date)||[]).includes(a)}catch(r){return console.error("Error fetching holidays:",r),!1}};return(a,e)=>{const r=J("RouterLink");return p(),m("div",ae,[t("div",se,[t("button",{class:"btn-3",onClick:N},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),t("div",null,[T(r,{to:"/my-applications",class:"btn-2"},{default:Y(()=>e[6]||(e[6]=[G("Home")])),_:1,__:[6]})])]),b.value?(p(),P(O,{key:0})):(p(),m("form",{key:1,onSubmit:K(M,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[t("div",le,[t("div",null,[e[8]||(e[8]=t("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),c(t("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=o=>l.value.last_working_date=o),class:"input-1 w-full",required:""},null,512),[[k,l.value.last_working_date]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),c(t("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=o=>l.value.resumption_date=o),class:"input-1 w-full",required:""},null,512),[[k,l.value.resumption_date]])])]),l.value.last_working_date&&l.value.resumption_date?(p(),m("div",oe,[t("p",ne,w(C.value),1)])):D("",!0),u.value.length?(p(),m("div",re,[e[12]||(e[12]=t("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),t("div",null,[(p(!0),m(V,null,A(u.value,(o,n)=>(p(),m("div",{key:n,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[t("div",de,w(o),1),t("div",ie,[(p(!0),m(V,null,A(E(y).leaveTypes,s=>(p(),m("label",{key:s.id,class:"flex items-center space-x-1"},[c(t("input",{type:"radio",name:"leaveType-"+n,value:s.id,"onUpdate:modelValue":v=>d.value[n]=v},null,8,ue),[[x,d.value[n]]]),t("span",null,w(s.name),1)]))),128)),t("label",pe,[c(t("input",{type:"radio",name:"leaveType-"+n,value:"weekend","onUpdate:modelValue":s=>d.value[n]=s},null,8,ve),[[x,d.value[n]]]),e[10]||(e[10]=t("span",null,"Weekend",-1))]),t("label",me,[c(t("input",{type:"radio",name:"leaveType-"+n,value:"holiday","onUpdate:modelValue":s=>d.value[n]=s},null,8,ce),[[x,d.value[n]]]),e[11]||(e[11]=t("span",null," Holiday",-1))])])]))),128))])])):D("",!0),t("div",null,[e[13]||(e[13]=t("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),c(t("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=o=>l.value.reason=o),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[k,l.value.reason]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),T(Q,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=o=>g.value=o),options:E(S).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])]),t("div",null,[e[15]||(e[15]=t("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),c(t("textarea",{id:"works-in-hand","onUpdate:modelValue":e[4]||(e[4]=o=>l.value.works_in_hand=o),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[k,l.value.works_in_hand]])]),_.value?(p(),m("div",fe,w(_.value),1)):D("",!0),e[16]||(e[16]=t("div",{class:"flex justify-end"},[t("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{Se as default};
