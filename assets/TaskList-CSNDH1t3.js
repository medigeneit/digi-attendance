import{_ as ve}from"./CommentModal-BAG874GF.js";import{_ as ke,a as fe}from"./TaskUserAssignForm-CGvVUO7h.js";import{L as ge}from"./LoaderView-C6tN8QcO.js";import{O as ee}from"./OverlyModal-UdPkq4in.js";import{_ as xe}from"./TaskAddForm-DXVJhbUn.js";import{_ as be}from"./TaskEditForm-jdm6MZe1.js";import{d as de,b as ae,p as x,r as O,e as me,q as le,C as we,c as i,o,a as s,g as w,w as X,f as h,F as H,y as q,h as z,A as oe,x as K,t as G,k as r,i as D,H as te,v as Ce,j as se,n as ne,u as Te,z as re,I as Ae}from"./index-BNkDM6tN.js";import{_ as Ie}from"./MultiselectDropdown-3WFDad5B.js";import{g as Me,u as Ve}from"./task-priority-MQ8Fln-E.js";import{u as Le}from"./company-BnTStjh-.js";import{_ as ie}from"./CompanyDepartmentSelectInput-DJOgZvT8.js";import{_ as ue,m as pe}from"./task-tree-xcnS8yWy.js";import{_ as ye}from"./UserChip-C5t5x_OY.js";import{_ as ce}from"./TaskTreeViewWithSubTable--F2LFWW_.js";import{u as qe}from"./useTaskStore-D7BgrDbH.js";import"./useCommentStore-DzVVQAkN.js";import"./datetime-C4Yr_jSk.js";import"./TextWithHr-GQT5l7Er.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-CYqIGd-_.js";import"./TaskUserChip-HsM-SoTe.js";import"./RequiredIcon-D0xB7cOy.js";import"./useRequirementStore-B3GKMDPI.js";import"./requirement-B9lUyrI2.js";import"./SectionLoading-CJrUdEi1.js";import"./tags-DlqyMZ6z.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-Dred6w--.js";import"./url-CePbr-gY.js";import"./TaskSupervisorAndEmployee-DjS7kzSj.js";const Ue={class:"mb-3 task-header"},_e={class:"flex justify-between items-start mb-4"},$e={key:0,class:"ml-auto flex gap-6 items-center"},Se={key:0,class:"flex gap-2 items-center"},he={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ee={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},De={class:"relative w-full md:w-48 flex-grow"},Pe=["value"],Be={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Oe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Ne={class:"w-32 relative h-8"},Fe={class:"flex gap-4 items-center flex-shrink-0"},je={class:"flex gap-2"},Re={class:"flex gap-2"},ze={class:"flex gap-2"},He={class:"text-gray-600 w-full md:w-32 relative"},We={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},Ye={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},Ge={key:0,class:"text-[9px] text-green-800"},Ke=["onClick"],Je={key:1,class:"flex justify-end gap-5"},Qe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(U,{emit:C}){const m=U,u=de(),T=ae(),b=x(g("company-id")),_=x(g("from-department-id")),I=x(g("to-department-id")),p=x(g("user-ids")),n=x(g("month")),c=x(g("status")),k=x(g("is-important")),f=x(g("is-urgent")),M=x(g("is-target")),N=x(g("search")),j=C,E=Le(),P=O([]);function g(d){return{get:()=>m.modelValue[d]||"",set:e=>{j("update:modelValue",{...m.modelValue,[d]:e||void 0})}}}const $=x(()=>J(p.value));async function F(){var d,e,V;if(!m.isMyTask){const a=(d=m.modelValue)==null?void 0:d["company-id"],t=I.value,A={...a?{company_id:a}:{},...t?{department_ids:[t]}:{}};P.value=((V=(e=await Me({params:A}))==null?void 0:e.data)==null?void 0:V.employees)||[]}}me(async()=>{await E.fetchCompanies({with:"departments",ignore_permission:!0}),await E.fetchMyCompanies({with:"departments"}),await F()});function J(d){return Array.isArray(P.value)&&P.value.find(e=>e.id==d)||null}function Q(d){p.value=(d==null?void 0:d.id)||""}function W(){p.value=""}le(()=>I.value,F),le(()=>b.value,()=>{I.value!==""?I.value="":F()});function B(d,e,{value:V,id:a,label:t,onCancel:A}={}){if(!d)return[];const v=Array.isArray(e)?e.find(L=>(L==null?void 0:L[a])==d):null;return v?[{label:t,value:typeof V=="function"?V(v):v==null?void 0:v[V],id:v==null?void 0:v[a],onCancel:A}]:[]}const Z=x(()=>{var a;const d=E.companies.reduce((t,A)=>[...t,...A.departments],[]),e=(t,{label:A,value:v,id:L,onCancel:y})=>t?[{label:A,value:v,id:L,onCancel:y}]:[],V=(t,{label:A,onCancel:v})=>{if(!t)return[];const L=new Date(t);return[{label:A,value:L.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:t,onCancel:v}]};return[...B(b.value,E.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{b.value=""}}),...B(_.value,d,{id:"id",label:"From",value:t=>t.short_name||t.name,onCancel:()=>{_.value=""}}),...B(I.value,d,{id:"id",label:"To",value:t=>t.short_name||t.name,onCancel:()=>{I.value=""}}),...B((a=$.value)==null?void 0:a.id,P.value,{label:"Employee",value:"name",id:"id",onCancel:W}),...B(c.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{c.value=""}}),...e(k.value,{label:"",value:"Important ",id:!0,onCancel:()=>{k.value=""}}),...e(f.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{f.value=""}}),...e(M.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{M.value=""}}),...V(n.value,{label:"",onCancel:()=>{n.value=""}})]});return(d,e)=>{var a,t,A,v,L,y,R,S;const V=we("RouterLink");return o(),i("div",null,[s("div",Ue,[s("div",_e,[e[14]||(e[14]=s("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),U.isMyTask?w("",!0):(o(),i("div",$e,[U.listHasRearranged?(o(),i("div",Se,[e[13]||(e[13]=s("span",{class:"text-red-500"},"Priority Changed",-1)),s("button",{class:"btn-3",onClick:e[0]||(e[0]=X(l=>j("clickPrioritySave"),["prevent"]))},"Save"),s("button",{class:"btn-3",onClick:e[1]||(e[1]=X(l=>j("clickPriorityDiscard"),["prevent"]))},"Discard")])):w("",!0),s("button",{onClick:e[2]||(e[2]=l=>j("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),s("div",he,[s("div",Ee,[U.isMyTask?w("",!0):(o(),i(H,{key:0},[s("div",De,[e[16]||(e[16]=s("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),z(s("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[15]||(e[15]=s("option",{value:""},"--ALL COMPANY--",-1)),(o(!0),i(H,null,K((a=r(E))==null?void 0:a.myCompanies,l=>(o(),i("option",{key:l.id,value:l.id},G(l.name),9,Pe))),128))],512),[[oe,b.value]])]),q(ie,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value=l),companies:((t=r(E))==null?void 0:t.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:D(()=>e[17]||(e[17]=[s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),r(T).name!=="MyTaskList"?(o(),h(ie,{key:0,modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=l=>I.value=l),companies:((A=r(E))==null?void 0:A.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:D(()=>e[18]||(e[18]=[s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):w("",!0),r(u).isAdminMood&&((L=(v=r(u))==null?void 0:v.user)==null?void 0:L.role)!=="employee"?(o(),i("div",Be,[q(Ie,{modelValue:$.value,onSelect:Q,onRemove:W,options:P.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:D(({option:l})=>[q(ye,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),$.value?(o(),i("div",Oe,[s("button",{onClick:X(W,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):w("",!0),e[19]||(e[19]=s("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):w("",!0)],64)),s("div",Ne,[e[21]||(e[21]=s("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),z(s("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>c.value=l),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[20]||(e[20]=[s("option",{value:""},"--ALL TASKS--",-1),s("option",{value:"not-completed"},"Not Completed",-1),s("option",{value:"only-completed"},"Completed",-1)]),512),[[oe,c.value]])]),s("div",Fe,[s("label",je,[z(s("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l)},null,512),[[te,k.value]]),e[22]||(e[22]=s("span",null,"Important",-1))]),s("label",Re,[z(s("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l)},null,512),[[te,f.value]]),e[23]||(e[23]=s("span",null,"Urgent",-1))]),s("label",ze,[z(s("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=l=>M.value=l)},null,512),[[te,M.value]]),e[24]||(e[24]=s("span",null,"Is Target",-1))])]),s("div",He,[e[25]||(e[25]=s("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),z(s("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=l=>n.value=l),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[Ce,n.value]])])]),U.isMyTask?(o(),h(ue,{key:0,modelValue:N.value,"onUpdate:modelValue":e[11]||(e[11]=l=>N.value=l),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):w("",!0)])]),s("div",We,[U.isMyTask?w("",!0):(o(),h(ue,{key:0,modelValue:N.value,"onUpdate:modelValue":e[12]||(e[12]=l=>N.value=l),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),s("div",Ye,[(o(!0),i(H,null,K(Z.value,l=>(o(),i("div",{key:l.label||l.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[s("div",null,[l.label?(o(),i("span",Ge,G(l.label)+": ",1)):w("",!0),se(G(l.value),1)]),s("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:X(l.onCancel,["prevent"])},e[26]||(e[26]=[s("i",{class:"fas fa-times-circle"},null,-1)]),8,Ke)]))),128))]),U.isMyTask?w("",!0):(o(),i("div",Je,[q(V,{class:ne(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((y=r(T).query)==null?void 0:y.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...r(T).query,view:"userwise"}}},{default:D(()=>e[27]||(e[27]=[se(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),q(V,{class:ne(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((R=r(T).query)==null?void 0:R.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((S=r(T))==null?void 0:S.query)||{}).filter(l=>{var Y;return((Y=r(T))==null?void 0:Y.query[l])!=="userwise"}).reduce((l,Y)=>({...l,[Y]:r(T).query[Y]}),{})}}},{default:D(()=>e[28]||(e[28]=[se(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])])}}},Xe={class:"w-full bg-white rounded"},Ze={class:"border p-4 align-top border-green-300 bg-blue-50"},et={class:"sticky top-[7rem] bg-white/80 py-2 z-40"},tt={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(U,{emit:C}){const m=U,u=ae(),T=C,b=x(()=>m.tasks.reduce((p,n)=>(p.push(...n.users.filter(c=>!p.find(k=>k.id==c.id&&c.id))),p),[]).filter(p=>m.selectedUserId?p.id==m.selectedUserId:!0)),_=p=>{const c=m.tasks.filter(k=>k.users.some(f=>f.id===p));return pe(c,{...u.query,"user-ids":p})},I=x(()=>b.value.map(p=>{const n=_(p.id);return{...p,tasks:n}}));return(p,n)=>(o(),i("div",null,[s("table",Xe,[s("tbody",null,[(o(!0),i(H,null,K(I.value,c=>(o(),i("tr",{key:c.id},[s("td",Ze,[s("div",null,[s("div",et,[q(ye,{user:c,class:""},null,8,["user"])]),(o(!0),i(H,null,K(c.tasks,(k,f)=>(o(),h(ce,{key:k.id,task:k,class:"!border-0 my-4",index:f,isMyTask:U.isMyTask,onCommentButtonClick:n[0]||(n[0]=M=>T("commentButtonClick",p.item.id)),onEditClick:n[1]||(n[1]=M=>T("editClick",M)),onAddClick:n[2]||(n[2]=M=>T("addClick",M)),onEmployeeAssignClick:n[3]||(n[3]=M=>T("employeeAssignClick",M))},null,8,["task","index","isMyTask"]))),128))])])]))),128))])])]))}},st={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},lt={class:"mb-4"},at={class:"relative min-h-[30vh]"},ot={key:0,class:"text-center py-4 text-red-500"},nt={key:1},rt={class:"flex items-stretched"},it={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},ut=1,Ot={__name:"TaskList",setup(U){const C=qe(),m=de(),u=ae(),T=Te(),b=O(""),_=O(!1),I=O(null),p=x(()=>{var a;return((a=m==null?void 0:m.user)==null?void 0:a.role)==="employee"||!(m!=null&&m.isAdminMood)?!0:!!u.query["user-ids"]}),n=O(null),c=O(!1),k=re({parentId:0,requirementId:0}),f=re({taskId:0,isOpen:!1}),M=O(null),N=O([]),{handleItemsPriorityUpdate:j,saveTaskPriority:E,listHasRearranged:P}=Ve(()=>C.taskListTree,0);me(async()=>{console.log("Task List Mounted"),b.value="loading",u.query.status||T.push({query:{...u.query,status:"not-completed"}}),await $()});let g;async function $(){let a;g=new AbortController,console.log({taskAbortController:g}),u.name==="MyTaskList"?a=await C.fetchMyTasks({...u.query,page:1},{signal:g.signal}):a=await C.fetchTasks({...u.query,page:1},{signal:g.signal}),b.value="",N.value=a.query_log||[]}const F=a=>{c.value=!0,k.parentId=a},J=a=>{f.taskId=a,f.isOpen=!0},Q=a=>{I.value=a,_.value=!0},W=()=>{_.value=!1,I.value=null};async function B(){n.value=null,c.value=!1,k.parentId=0,b.value="loading",await $()}async function Z(){c.value=!1,k.parentId=0,await $()}async function d(){b.value="loading",await E()&&await $()}le(()=>({...u.query}),async()=>{try{C.resetTaskList(),b.value="loading",await $()}catch{console.warn("...")}});const e=x({get(){return{...u.query}},set(a){localStorage.removeItem("sub_task_opened_list"),T.push({query:{...a}})}}),V=x(()=>{var t;const a={...u.query};return u.name=="MyTaskList"&&(a["user-ids"]=(t=m==null?void 0:m.user)==null?void 0:t.id),Array.isArray(C.tasks)?pe(C.tasks,a):[]});return Ae(()=>{C.tasks.value=null,g&&g.abort()}),(a,t)=>{var A,v,L;return o(),i("div",st,[n.value?(o(),h(ee,{key:0},{default:D(()=>[q(be,{taskId:n.value,onClose:t[0]||(t[0]=y=>n.value=null),onUpdated:B},null,8,["taskId"])]),_:1})):w("",!0),c.value?(o(),h(ee,{key:1},{default:D(()=>[q(xe,{parentTaskId:k.parentId,requirementId:k.requirementId,onClose:Z,onTaskCreated:B},null,8,["parentTaskId","requirementId"])]),_:1})):w("",!0),f.isOpen?(o(),h(ee,{key:2,class:"*:max-w-4xl"},{default:D(()=>[q(ke,{taskId:f.taskId,onCancelClick:t[1]||(t[1]=()=>{f.isOpen=!1,f.taskId=0}),onSuccess:t[2]||(t[2]=()=>{f.isOpen=!1,f.taskId=0,b.value="loading",$()})},null,8,["taskId"])]),_:1})):w("",!0),q(Qe,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=y=>e.value=y),onClickAddTask:F,onClickPrioritySave:d,onClickPriorityDiscard:t[4]||(t[4]=()=>r(P)?M.value.resetItems:null),"list-has-rearranged":r(P),isMyTask:r(u).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((v=(A=r(u))==null?void 0:A.query)==null?void 0:v["query-log"])=="true"?(o(!0),i(H,{key:3},K(N.value,(y,R)=>(o(),i("div",{key:R,class:"text-xs text-gray-500"},[s("div",lt,G(y.raw_query),1)]))),128)):w("",!0),s("div",at,[r(C).error?(o(),i("div",ot,G(r(C).error),1)):r(C).tasks.length>0?(o(),i("div",nt,[((L=r(u).query)==null?void 0:L.view)=="userwise"?(o(),h(tt,{key:0,tasks:V.value,selectedUserId:r(u).query["user-ids"],isMyTask:r(u).name==="MyTaskList",onCommentButtonClick:t[5]||(t[5]=y=>Q(y,a.task.id)),onEditClick:t[6]||(t[6]=y=>n.value=y),onAddClick:t[7]||(t[7]=y=>F(y)),onEmployeeAssignClick:t[8]||(t[8]=y=>J(y))},null,8,["tasks","selectedUserId","isMyTask"])):(o(),h(fe,{key:1,items:V.value,handle:"handle",onItemsUpdate:r(j),class:"space-y-6",ref_key:"draggableTaskList",ref:M},{item:D(({item:y,index:R})=>[s("div",rt,[q(ce,{isMyTask:r(u).name==="MyTaskList",task:y,index:R,showDraggableHandle:!p.value,onCommentButtonClick:t[9]||(t[9]=S=>Q(S,a.task.id)),onEditClick:t[10]||(t[10]=S=>n.value=S),onAddClick:t[11]||(t[11]=S=>F(S)),onEmployeeAssignClick:t[12]||(t[12]=S=>J(S)),class:"!border-0 shadow hover:shadow-md"},null,8,["isMyTask","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):b.value!=="loading"?(o(),i("div",it," No tasks found. ")):w("",!0),b.value==="loading"?(o(),h(ge,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):w("",!0)]),q(ve,{show:_.value,"commentable-id":I.value,"commentable-type":"task","user-id":ut,"on-close":W,onSubmitted:r(C).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Ot as default};
