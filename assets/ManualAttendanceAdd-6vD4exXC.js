import{u as Y,g as Z,G as F,x as c,q as E,r as U,p as ee,c as i,o as l,a as s,d as H,m as te,b as y,w as se,k as d,l as h,v as C,t as f,H as oe,i as ne,s as b}from"./index-rh_aQaub.js";import{L as ie}from"./LoaderView-Dmom3oqu.js";import{u as le}from"./manual-attendance-Usxy9-Qr.js";const re={class:"max-w-4xl mx-auto px-4 py-4 space-y-4"},ue={class:"flex items-center justify-between gap-3"},ae={key:0,class:"text-center"},de={class:"grid md:grid-cols-2 gap-4"},ce={key:0,class:"text-xs text-red-600 mt-1"},pe={key:0,class:"text-xs text-red-600 mt-1"},fe={key:0,class:"space-y-2"},ye={class:"flex flex-wrap gap-2"},xe={key:0,class:"text-xs text-red-600"},_e={key:1,class:"space-y-2"},me={class:"flex flex-wrap gap-2"},be={key:0,class:"text-xs text-red-600"},ve={class:"grid md:grid-cols-2 gap-4"},ke={class:"space-y-2"},he={class:"flex items-center justify-between"},ge={class:"text-sm font-medium"},we={key:0,class:"text-red-500"},Ce={class:"flex gap-2"},$e=["disabled"],Se=["disabled"],Ee=["disabled"],Ne={key:0,class:"text-xs text-red-600"},qe={key:1,class:"text-xs text-slate-500"},Be={class:"space-y-2"},Me={class:"flex items-center justify-between"},Te={class:"text-sm font-medium"},Ae={key:0,class:"text-red-500"},Oe={class:"flex gap-2"},Pe=["disabled"],Ve=["disabled"],We=["disabled"],Re={key:0,class:"text-xs text-red-600"},je={key:1,class:"text-xs text-slate-500"},De={class:"flex items-center justify-between mb-1"},Fe={class:"text-xs text-slate-500"},Ue={key:0,class:"text-xs text-red-600 mt-1"},He={key:2,class:"rounded-lg bg-red-50 border border-red-200 text-red-700 px-3 py-2 text-sm"},Le={class:"flex items-center justify-between gap-3"},Ie=["disabled"],Qe={__name:"ManualAttendanceAdd",setup(ze){const $=Y(),L=le(),S=Z(),N=o=>{if(!o)return null;const e=o.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!e)return null;let[,a,n,D]=e;return a=parseInt(a,10),D.toUpperCase()==="PM"&&a<12&&(a+=12),D.toUpperCase()==="AM"&&a===12&&(a=0),`${a.toString().padStart(2,"0")}:${n}`},q=o=>String(o).padStart(2,"0"),B=o=>{const e=new Date;t[o]=`${q(e.getHours())}:${q(e.getMinutes())}`},M=o=>t[o]="",T=o=>{if(!o)return null;const[e,a]=o.split(":").map(Number);return Number.isNaN(e)||Number.isNaN(a)?null:e*60+a},{date:A,type:I,entry_time:O,exit_time:P}=$.currentRoute.value.query,z=A||new Date().toISOString().split("T")[0],t=F({date:z,type:I||"",check_in:O?N(O):"",check_out:P?N(P):"",description:"",punch_type:"",offsite_type:""}),x=c(()=>t.type==="Forget Punch"),_=c(()=>t.type==="Offsite Work"),G=c(()=>x.value),J=c(()=>_.value),v=c(()=>x.value?t.punch_type!=="exit":_.value?t.offsite_type!=="post":!0),k=c(()=>x.value?t.punch_type!=="entry":_.value?t.offsite_type!=="pre":!0),V=c(()=>x.value?t.punch_type==="entry"||t.punch_type==="both":_.value?t.offsite_type==="pre"||t.offsite_type==="both":!1),W=c(()=>x.value?t.punch_type==="exit"||t.punch_type==="both":_.value?t.offsite_type==="post"||t.offsite_type==="both":!1),K=c(()=>{if(!v.value||!k.value||!t.check_in||!t.check_out)return!1;const o=T(t.check_in),e=T(t.check_out);return o===null||e===null?!1:e<=o});E(()=>t.type,o=>{o!=="Forget Punch"&&(t.punch_type=""),o!=="isOffsiteWork"&&(t.offsite_type="")}),E(()=>t.punch_type,o=>{x.value&&(o==="entry"&&(t.check_out=""),o==="exit"&&(t.check_in=""))}),E(()=>t.offsite_type,o=>{_.value&&(o==="pre"&&(t.check_out=""),o==="post"&&(t.check_in=""))});const p=F({date:!1,type:!1,punch_type:!1,offsite_type:!1,check_in:!1,check_out:!1,description:!1}),r=o=>p[o]=!0,Q=()=>Object.keys(p).forEach(o=>p[o]=!0),u=c(()=>{var e;const o={};return t.date||(o.date="Date is required."),t.type||(o.type="Type is required."),x.value&&!t.punch_type&&(o.punch_type="Select Entry / Exit / Both."),_.value&&!t.offsite_type&&(o.offsite_type="Select Pre / Post / Both."),V.value&&!t.check_in&&(o.check_in="Entry Time is required."),W.value&&!t.check_out&&(o.check_out="Exit Time is required."),["Home Office","Remote Work"].includes(t.type)&&!t.check_in&&!t.check_out&&(o.check_in="Entry or Exit time is required."),K.value&&(o.check_out="Exit Time must be after Entry Time."),(e=t.description)!=null&&e.trim()||(o.description="Description is required."),(t.description||"").length>500&&(o.description="Max 500 characters."),o}),R=c(()=>Object.keys(u.value).length===0),g=U(!1),w=U(null),X=async()=>{var o;if(w.value=null,Q(),!!R.value){g.value=!0;try{const e={user_id:(o=S==null?void 0:S.user)==null?void 0:o.id,...t,check_in:t.check_in?`${t.date} ${t.check_in}:00`:null,check_out:t.check_out?`${t.date} ${t.check_out}:00`:null},a=await L.createManualAttendance(e);$.push({name:"ManualAttendanceShow",params:{id:a.id}})}catch(e){w.value=(e==null?void 0:e.message)||"Failed to submit manual attendance request."}finally{g.value=!1}}},j=()=>$.go(-1),m=o=>o?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-700 border-slate-200 hover:border-slate-300";return(o,e)=>{const a=ee("RouterLink");return l(),i("div",re,[s("div",ue,[s("button",{class:"btn-3",onClick:j},e[20]||(e[20]=[s("i",{class:"far fa-arrow-left"},null,-1),s("span",{class:"hidden md:inline"},"Back",-1)])),e[22]||(e[22]=s("div",{class:"text-center"},[s("h1",{class:"title-md md:title-lg leading-tight"},"Manual Attendance Request"),s("p",{class:"text-xs md:text-sm text-slate-500"},"Fill in the details & submit for approval")],-1)),H(a,{to:"/",class:"btn-2"},{default:te(()=>e[21]||(e[21]=[y("Home")])),_:1,__:[21]})]),g.value?(l(),i("div",ae,[H(ie)])):(l(),i("form",{key:1,onSubmit:se(X,["prevent"]),class:"card-bg p-4 md:p-8 space-y-6"},[s("div",de,[s("div",null,[e[23]||(e[23]=s("label",{class:"block text-sm font-medium mb-1"},[y("Date "),s("span",{class:"text-red-500"},"*")],-1)),h(s("input",{type:"date","onUpdate:modelValue":e[0]||(e[0]=n=>t.date=n),class:"input-1 w-full",required:"",onBlur:e[1]||(e[1]=n=>r("date"))},null,544),[[C,t.date]]),p.date&&u.value.date?(l(),i("p",ce,f(u.value.date),1)):d("",!0)]),s("div",null,[e[25]||(e[25]=s("label",{class:"block text-sm font-medium mb-1"},[y("Type "),s("span",{class:"text-red-500"},"*")],-1)),h(s("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>t.type=n),class:"input-1 w-full",required:"",onBlur:e[3]||(e[3]=n=>r("type"))},e[24]||(e[24]=[ne('<option value="">Select Type</option><option value="Home Office">Home Office</option><option value="Remote Work">Remote Work</option><option value="Forget Punch">Forget Punch</option><option value="Offsite Work">Offsite Work</option>',5)]),544),[[oe,t.type]]),p.type&&u.value.type?(l(),i("p",pe,f(u.value.type),1)):d("",!0)])]),G.value?(l(),i("div",fe,[e[26]||(e[26]=s("div",{class:"flex items-center justify-between"},[s("label",{class:"block text-sm font-medium"},[y("Work Schedule "),s("span",{class:"text-red-500"},"*")]),s("span",{class:"text-xs text-slate-500"},"Select one")],-1)),s("div",ye,[s("button",{type:"button",class:b(["px-3 py-2 rounded-lg border text-sm",m(t.punch_type==="entry")]),onClick:e[4]||(e[4]=n=>{t.punch_type="entry",r("punch_type")})}," Entry ",2),s("button",{type:"button",class:b(["px-3 py-2 rounded-lg border text-sm",m(t.punch_type==="exit")]),onClick:e[5]||(e[5]=n=>{t.punch_type="exit",r("punch_type")})}," Exit ",2),s("button",{type:"button",class:b(["px-3 py-2 rounded-lg border text-sm",m(t.punch_type==="both")]),onClick:e[6]||(e[6]=n=>{t.punch_type="both",r("punch_type")})}," Both ",2)]),p.punch_type&&u.value.punch_type?(l(),i("p",xe,f(u.value.punch_type),1)):d("",!0)])):d("",!0),J.value?(l(),i("div",_e,[e[27]||(e[27]=s("div",{class:"flex items-center justify-between"},[s("label",{class:"block text-sm font-medium"},[y("Work Schedule "),s("span",{class:"text-red-500"},"*")]),s("span",{class:"text-xs text-slate-500"},"Select one")],-1)),s("div",me,[s("button",{type:"button",class:b(["px-3 py-2 rounded-lg border text-sm",m(t.offsite_type==="pre")]),onClick:e[7]||(e[7]=n=>{t.offsite_type="pre",r("offsite_type")})}," Before Office (Pre) ",2),s("button",{type:"button",class:b(["px-3 py-2 rounded-lg border text-sm",m(t.offsite_type==="post")]),onClick:e[8]||(e[8]=n=>{t.offsite_type="post",r("offsite_type")})}," After Office (Post) ",2),s("button",{type:"button",class:b(["px-3 py-2 rounded-lg border text-sm",m(t.offsite_type==="both")]),onClick:e[9]||(e[9]=n=>{t.offsite_type="both",r("offsite_type")})}," Both ",2)]),p.offsite_type&&u.value.offsite_type?(l(),i("p",be,f(u.value.offsite_type),1)):d("",!0)])):d("",!0),s("div",ve,[s("div",ke,[s("div",he,[s("label",ge,[e[28]||(e[28]=y(" Entry Time ")),V.value?(l(),i("span",we,"*")):d("",!0)]),s("div",Ce,[s("button",{type:"button",class:"text-xs px-2 py-1 rounded-md border border-slate-200",disabled:!v.value,onClick:e[10]||(e[10]=n=>{B("check_in"),r("check_in")})}," Now ",8,$e),s("button",{type:"button",class:"text-xs px-2 py-1 rounded-md border border-slate-200",disabled:!v.value,onClick:e[11]||(e[11]=n=>{M("check_in"),r("check_in")})}," Clear ",8,Se)])]),h(s("input",{type:"time","onUpdate:modelValue":e[12]||(e[12]=n=>t.check_in=n),class:"input-1 w-full",disabled:!v.value,onBlur:e[13]||(e[13]=n=>r("check_in"))},null,40,Ee),[[C,t.check_in]]),p.check_in&&u.value.check_in?(l(),i("p",Ne,f(u.value.check_in),1)):v.value?d("",!0):(l(),i("p",qe,"Not required for this selection."))]),s("div",Be,[s("div",Me,[s("label",Te,[e[29]||(e[29]=y(" Exit Time ")),W.value?(l(),i("span",Ae,"*")):d("",!0)]),s("div",Oe,[s("button",{type:"button",class:"text-xs px-2 py-1 rounded-md border border-slate-200",disabled:!k.value,onClick:e[14]||(e[14]=n=>{B("check_out"),r("check_out")})}," Now ",8,Pe),s("button",{type:"button",class:"text-xs px-2 py-1 rounded-md border border-slate-200",disabled:!k.value,onClick:e[15]||(e[15]=n=>{M("check_out"),r("check_out")})}," Clear ",8,Ve)])]),h(s("input",{type:"time","onUpdate:modelValue":e[16]||(e[16]=n=>t.check_out=n),class:"input-1 w-full",disabled:!k.value,onBlur:e[17]||(e[17]=n=>r("check_out"))},null,40,We),[[C,t.check_out]]),p.check_out&&u.value.check_out?(l(),i("p",Re,f(u.value.check_out),1)):k.value?d("",!0):(l(),i("p",je,"Not required for this selection."))])]),s("div",null,[s("div",De,[e[30]||(e[30]=s("label",{class:"block text-sm font-medium"},[y("Description "),s("span",{class:"text-red-500"},"*")],-1)),s("span",Fe,f((t.description||"").length)+"/500",1)]),h(s("textarea",{"onUpdate:modelValue":e[18]||(e[18]=n=>t.description=n),class:"input-1 w-full min-h-[110px]",placeholder:"Example: Worked at client site (ABC), task: deployment & report. Please approve.",onBlur:e[19]||(e[19]=n=>r("description"))},null,544),[[C,t.description]]),p.description&&u.value.description?(l(),i("p",Ue,f(u.value.description),1)):d("",!0)]),w.value?(l(),i("div",He,f(w.value),1)):d("",!0),s("div",Le,[s("button",{type:"button",class:"btn-3",onClick:j},"Cancel"),s("button",{type:"submit",class:"btn-2",disabled:g.value||!R.value},"Submit",8,Ie)])],32))])}}};export{Qe as default};
