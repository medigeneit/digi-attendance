import{D as M,f as Q,u as X,S as Z,r as k,G as A,x as q,h as ee,q as te,p as oe,c as l,o as s,a as t,w as ne,k as i,j as m,b as y,v as p,t as u,H as f,F as b,e as _,m as w,n as le,d as B,aa as se,s as de,l as ae}from"./index-C0g-3I9C.js";import{S as ie}from"./WeekendAssignModal-DwXH9TzF.js";import{u as re}from"./company-CcuR0n6l.js";import{u as ue}from"./department-DX2znM50.js";import{u as pe}from"./designation-Bq6E1J7J.js";import{u as me}from"./leave-approval-DmCwGX30.js";import{u as ve}from"./shift-JcBfohyo.js";import{u as ye}from"./user-IftAA3DG.js";import{d as I}from"./dayjs.min-DPhbuu5_.js";const fe={class:"my-container"},be={class:"card-bg md:p-8 p-4 mx-4"},_e={class:"border p-4 rounded-md bg-gray-50"},we={class:"grid md:grid-cols-2 gap-4"},ge=["aria-invalid"],xe={key:0,class:"text-red-600 text-sm mt-1"},ke=["aria-invalid"],ce={key:0,class:"text-red-600 text-sm mt-1"},Se=["aria-invalid"],he={key:0,class:"text-red-600 text-sm mt-1"},Ue=["value"],Ve={class:"border p-4 rounded-md bg-gray-50"},Pe={class:"grid md:grid-cols-2 gap-4"},Ce=["aria-invalid"],De=["value"],Me={key:0,class:"text-red-600 text-sm mt-1"},qe=["disabled","aria-invalid"],Ee={value:"",disabled:""},Le=["value"],je={key:0,class:"text-red-600 text-sm mt-1"},Oe=["disabled"],Ne={value:"",disabled:""},Te=["value"],Ae=["value"],Be={key:1},Ie=["aria-invalid"],Re={key:0,class:"text-red-600 text-sm mt-1"},Ye={class:"md:col-span-2"},Ge={class:"flex items-center gap-3 flex-wrap"},ze={key:0,class:"flex flex-wrap gap-4 bg-white p-3 border rounded mt-2 text-sm"},Fe=["value"],We=["value"],He={key:2,class:"md:col-span-2"},$e=["required"],Je={class:"border p-4 rounded-md bg-gray-50"},Ke={class:"grid md:grid-cols-4 gap-4"},Qe=["aria-invalid"],Xe={key:0,class:"text-red-600 text-sm mt-1"},Ze={class:"relative"},et=["type"],tt=["aria-label"],ot={class:"sticky bottom-0 left-0 right-0 bg-white/80 backdrop-blur border-t p-3 mt-6 flex justify-center gap-3"},nt=["disabled"],lt={key:0},st={key:1,class:"inline-flex items-center gap-2"},bt={__name:"UserEdit",setup(dt){const V=re(),E=ue(),L=pe(),P=me(),j=ve(),C=ye(),{designations:R}=M(L),{shifts:Y}=M(j),{error:O}=M(C),h=Q(),N=X(),c=Z(),T=k(!0),g=k(!1),U=k(!1),S=k(!1),D=k(!1),G=Object.freeze(["A+","A-","B+","B-","AB+","AB-","O+","O-"]),z=Object.freeze(["Probationary","Permanent","Part_Time","Remote","Contract","Freelance","Intern"]),n=A({name:"",bn_name:"",phone:"",email:"",password:"",role:"employee",type:"",address:"",note:"",device_user_id:null,is_active:!0,company_id:"",department_id:"",designation_id:"",shift_id:"",nid:"",date_of_birth:"",joining_date:"",employment_type:"Probationary",contract_month:0,provisional_month:0,extended_provisional_month:0,employee_id:"",weekends:[],leave_approval_id:"",other_approval_id:"",blood:""}),v=k({weekends:[],start_month:"",end_month:""}),F=a=>{v.value=a},x=q(()=>V.companies.find(a=>a.id===n.company_id)),W=q(()=>{if(!x.value)return[];const a=R.value||{};return a[x.value.id]||a[x.value.name]||[]});q(()=>{if(!x.value)return[];const a=Y.value||{};return a[x.value.id]||a[x.value.name]||[]});const d=A({});function H(){for(const e of Object.keys(d))delete d[e];const a={name:"Name is required",phone:"Phone is required",company_id:"Company is required",department_id:"Department is required",role:"Role is required"};for(const[e,r]of Object.entries(a))String(n[e]??"").trim()||(d[e]=r);return n.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)&&(d.email="Provide a valid email address"),n.employment_type==="Contract"&&(!n.contract_month||n.contract_month<0)&&(d.contract_month="Contract month must be ≥ 0"),Object.keys(d).length===0}async function $(){const a=h.params.id,e=await C.fetchUser(a);if(!e)throw new Error("User not found");e.assign_weekend?v.value={weekends:e.assign_weekend.weekends||[],start_month:e.assign_weekend.start_month?I(e.assign_weekend.start_month).format("YYYY-MM"):"",end_month:e.assign_weekend.end_month?I(e.assign_weekend.end_month).format("YYYY-MM"):""}:v.value={weekends:[],start_month:"",end_month:""},n.name=e.name||"",n.bn_name=e.bn_name||"",n.phone=e.phone||"",n.email=e.email||"",n.address=e.address||"",n.nid=e.nid||"",n.date_of_birth=e.date_of_birth||"",n.blood=e.blood||"",n.joining_date=e.joining_date||"",n.employment_type=e.employment_type||"Probationary",n.employee_id=e.employee_id||"",n.provisional_month=e.provisional_month??0,n.extended_provisional_month=e.extended_provisional_month??0,n.contract_month=e.contract_month??0,n.weekends=e.weekends||[],n.is_active=!!e.is_active,n.company_id=e.company_id||"",n.department_id=e.department_id||"",n.designation_id=e.designation_id||"",n.shift_id=e.shift_id||"",n.role=e.role||"employee",n.type=e.type||"",n.device_user_id=e.device_user_id??"",n.leave_approval_id=e.leave_approval_id||"",n.other_approval_id=e.other_approval_id||""}ee(async()=>{var a,e;try{T.value=!0,await Promise.all([V.fetchCompanies(),P.fetchLeaveApprovals()]),await $()}catch(r){const o=((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Failed to load user data";c.error(o),N.push({name:"UserList"})}finally{T.value=!1}}),te(()=>n.company_id,async a=>{if(a)try{g.value=!0,await Promise.all([E.fetchDepartments(a),L.fetchDesignations(a),j.fetchShifts(a)])}finally{g.value=!1}});async function J(){var a,e;if(!H()){c.error("Please fix the highlighted fields");return}try{U.value=!0;const r={...n,selected_weekend:{weekends:v.value.weekends,start_month:v.value.start_month||null,end_month:v.value.end_month||null}};await C.updateUser(h.params.id,r),O.value?c.error(O.value):(c.success("User updated successfully"),N.push({name:"UserShow",params:{id:h.params.id}}))}catch(r){const o=((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Failed to update user";c.error(o)}finally{U.value=!1}}function K(){v.value={weekends:[],start_month:"",end_month:""}}return(a,e)=>{const r=oe("RouterLink");return s(),l("div",fe,[t("div",be,[e[68]||(e[68]=t("h2",{class:"title-lg text-center"},"Edit Employee",-1)),t("form",{class:"space-y-6",onSubmit:ne(J,["prevent"]),novalidate:""},[t("fieldset",_e,[e[37]||(e[37]=t("legend",{class:"title-md px-2"},"Personal Info",-1)),t("div",we,[t("div",null,[e[28]||(e[28]=t("label",{for:"name"},[y("Name"),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=o=>n.name=o),type:"text",class:"w-full p-2 border rounded","aria-invalid":!!d.name,autocomplete:"name",required:""},null,8,ge),[[p,n.name,void 0,{trim:!0}]]),d.name?(s(),l("p",xe,u(d.name),1)):m("",!0)]),t("div",null,[e[29]||(e[29]=t("label",{for:"bnName"},"Bangla Name",-1)),i(t("input",{id:"bnName","onUpdate:modelValue":e[1]||(e[1]=o=>n.bn_name=o),type:"text",class:"w-full p-2 border rounded",autocomplete:"name"},null,512),[[p,n.bn_name,void 0,{trim:!0}]])]),t("div",null,[e[30]||(e[30]=t("label",{for:"phone"},[y("Phone"),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{id:"phone","onUpdate:modelValue":e[2]||(e[2]=o=>n.phone=o),type:"tel",inputmode:"tel",class:"w-full p-2 border rounded","aria-invalid":!!d.phone,autocomplete:"tel",required:""},null,8,ke),[[p,n.phone,void 0,{trim:!0}]]),d.phone?(s(),l("p",ce,u(d.phone),1)):m("",!0)]),t("div",null,[e[31]||(e[31]=t("label",{for:"email"},"Email",-1)),i(t("input",{id:"email","onUpdate:modelValue":e[3]||(e[3]=o=>n.email=o),type:"email",class:"w-full p-2 border rounded","aria-invalid":!!d.email,autocomplete:"email",placeholder:"name@example.com"},null,8,Se),[[p,n.email,void 0,{trim:!0,lazy:!0}]]),d.email?(s(),l("p",he,u(d.email),1)):m("",!0)]),t("div",null,[e[32]||(e[32]=t("label",{for:"address"},"Address",-1)),i(t("input",{id:"address","onUpdate:modelValue":e[4]||(e[4]=o=>n.address=o),type:"text",class:"w-full p-2 border rounded",autocomplete:"street-address",placeholder:"House / Street / Area"},null,512),[[p,n.address,void 0,{trim:!0}]])]),t("div",null,[e[33]||(e[33]=t("label",{for:"nid"},"NID",-1)),i(t("input",{id:"nid","onUpdate:modelValue":e[5]||(e[5]=o=>n.nid=o),type:"text",class:"w-full p-2 border rounded"},null,512),[[p,n.nid,void 0,{trim:!0}]])]),t("div",null,[e[34]||(e[34]=t("label",{for:"dob"},"Date of Birth",-1)),i(t("input",{id:"dob","onUpdate:modelValue":e[6]||(e[6]=o=>n.date_of_birth=o),type:"date",class:"w-full p-2 border rounded"},null,512),[[p,n.date_of_birth]])]),t("div",null,[e[36]||(e[36]=t("label",{for:"bloodGroup",class:"text-gray-700 flex items-center gap-2"},"Blood Group",-1)),i(t("select",{id:"bloodGroup","onUpdate:modelValue":e[7]||(e[7]=o=>n.blood=o),class:"py-2 px-4 border rounded w-full"},[e[35]||(e[35]=t("option",{disabled:"",value:""},"Select blood group",-1)),(s(!0),l(b,null,_(w(G),o=>(s(),l("option",{key:o,value:o},u(o),9,Ue))),128))],512),[[f,n.blood]])])])]),t("fieldset",Ve,[e[59]||(e[59]=t("legend",{class:"title-md px-2"},"Professional Info",-1)),t("div",Pe,[t("div",null,[e[39]||(e[39]=t("label",{for:"company"},[y("Company"),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{id:"company","onUpdate:modelValue":e[8]||(e[8]=o=>n.company_id=o),class:"w-full border rounded px-3 py-2","aria-invalid":!!d.company_id,required:""},[e[38]||(e[38]=t("option",{value:"",disabled:""},"Select a company",-1)),(s(!0),l(b,null,_(w(V).companies,o=>(s(),l("option",{key:o==null?void 0:o.id,value:o==null?void 0:o.id},u(o==null?void 0:o.name),9,De))),128))],8,Ce),[[f,n.company_id]]),d.company_id?(s(),l("p",Me,u(d.company_id),1)):m("",!0)]),t("div",null,[e[40]||(e[40]=t("label",{for:"department"},[y("Department"),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{id:"department","onUpdate:modelValue":e[9]||(e[9]=o=>n.department_id=o),class:"w-full p-2 border rounded",disabled:g.value||!n.company_id,"aria-invalid":!!d.department_id,required:""},[t("option",Ee,u(g.value?"Loading departments…":"Select a department"),1),(s(!0),l(b,null,_(w(E).departments,o=>(s(),l("option",{key:o==null?void 0:o.id,value:o==null?void 0:o.id},u(o==null?void 0:o.name),9,Le))),128))],8,qe),[[f,n.department_id]]),d.department_id?(s(),l("p",je,u(d.department_id),1)):m("",!0)]),t("div",null,[e[41]||(e[41]=t("label",{for:"designation"},"Designation",-1)),i(t("select",{id:"designation","onUpdate:modelValue":e[10]||(e[10]=o=>n.designation_id=o),class:"w-full p-2 border rounded",disabled:g.value||!n.company_id},[t("option",Ne,u(g.value?"Loading designations…":"Select a designation"),1),(s(!0),l(b,null,_(W.value,o=>(s(),l("option",{key:o==null?void 0:o.id,value:o==null?void 0:o.id},u(o==null?void 0:o.title),9,Te))),128))],8,Oe),[[f,n.designation_id]])]),t("div",null,[e[42]||(e[42]=t("label",{for:"joining"},"Joining Date",-1)),i(t("input",{id:"joining","onUpdate:modelValue":e[11]||(e[11]=o=>n.joining_date=o),type:"date",class:"w-full p-2 border rounded"},null,512),[[p,n.joining_date]])]),t("div",null,[e[44]||(e[44]=t("label",{for:"lineType"},"Line Type",-1)),i(t("select",{id:"lineType","onUpdate:modelValue":e[12]||(e[12]=o=>n.type=o),class:"w-full p-2 border rounded",required:""},e[43]||(e[43]=[le('<option value="" disabled>Select Line Type</option><option value="executive">Executive</option><option value="support_staff">Support Staff</option><option value="doctor">Doctor</option><option value="academy_body">Academy Body</option>',5)]),512),[[f,n.type]])]),t("div",null,[e[45]||(e[45]=t("label",{for:"empType"},"Employment Type",-1)),i(t("select",{id:"empType","onUpdate:modelValue":e[13]||(e[13]=o=>n.employment_type=o),class:"w-full p-2 border rounded"},[(s(!0),l(b,null,_(w(z),o=>(s(),l("option",{key:o,value:o},u(o),9,Ae))),128))],512),[[f,n.employment_type]])]),n.employment_type==="Probationary"?(s(),l(b,{key:0},[t("div",null,[e[46]||(e[46]=t("label",{for:"probMonth"},"Probationary Period (month)",-1)),i(t("input",{id:"probMonth","onUpdate:modelValue":e[14]||(e[14]=o=>n.provisional_month=o),type:"number",min:"0",placeholder:"3",class:"w-full p-2 border rounded"},null,512),[[p,n.provisional_month,void 0,{number:!0}]])]),t("div",null,[e[47]||(e[47]=t("label",{for:"probExt"},"Extended Probationary (month)",-1)),i(t("input",{id:"probExt","onUpdate:modelValue":e[15]||(e[15]=o=>n.extended_provisional_month=o),type:"number",min:"0",placeholder:"3",class:"w-full p-2 border rounded"},null,512),[[p,n.extended_provisional_month,void 0,{number:!0}]])])],64)):m("",!0),n.employment_type==="Contract"?(s(),l("div",Be,[e[48]||(e[48]=t("label",{for:"contractMonth"},"Contract (month)",-1)),i(t("input",{id:"contractMonth","onUpdate:modelValue":e[16]||(e[16]=o=>n.contract_month=o),type:"number",min:"0",max:"120",placeholder:"6",class:"w-full p-2 border rounded","aria-invalid":!!d.contract_month,required:""},null,8,Ie),[[p,n.contract_month,void 0,{number:!0}]]),d.contract_month?(s(),l("p",Re,u(d.contract_month),1)):m("",!0)])):m("",!0),t("div",Ye,[t("div",Ge,[t("button",{type:"button",class:"btn-2",onClick:e[17]||(e[17]=o=>D.value=!0)},"Select Weekends"),t("button",{type:"button",class:"btn-ghost border px-3 py-2 rounded",onClick:K},"Clear")]),v.value?(s(),l("div",ze,[t("p",null,[e[49]||(e[49]=t("strong",null,"Weekends:",-1)),y(" "+u(v.value.weekends.join(", ")||"—"),1)]),t("p",null,[e[50]||(e[50]=t("strong",null,"Start Month:",-1)),y(" "+u(v.value.start_month||"—"),1)]),t("p",null,[e[51]||(e[51]=t("strong",null,"End Month:",-1)),y(" "+u(v.value.end_month||"—"),1)])])):m("",!0),B(ie,{isOpen:D.value,assign_weekend:v.value,onClose:e[18]||(e[18]=o=>D.value=!1),onUpdate:F},null,8,["isOpen","assign_weekend"])]),t("div",null,[e[53]||(e[53]=t("label",null,"Leave Approval Group",-1)),i(t("select",{"onUpdate:modelValue":e[19]||(e[19]=o=>n.leave_approval_id=o),class:"w-full p-2 border rounded"},[e[52]||(e[52]=t("option",{value:"",disabled:""},"Select Leave Approval Group",-1)),(s(!0),l(b,null,_(w(P).leaveApprovals,o=>(s(),l(b,{key:o.id},[o.type==="leave"?(s(),l("option",{key:0,value:o.id},u(o.name),9,Fe)):m("",!0)],64))),128))],512),[[f,n.leave_approval_id]])]),t("div",null,[e[55]||(e[55]=t("label",null,"Other Approval Group",-1)),i(t("select",{"onUpdate:modelValue":e[20]||(e[20]=o=>n.other_approval_id=o),class:"w-full p-2 border rounded"},[e[54]||(e[54]=t("option",{value:"",disabled:""},"Select Other Approval Group",-1)),(s(!0),l(b,null,_(w(P).leaveApprovals,o=>(s(),l(b,{key:o.id},[o.type==="other"?(s(),l("option",{key:0,value:o.id},u(o.name),9,We)):m("",!0)],64))),128))],512),[[f,n.other_approval_id]])]),t("div",null,[e[57]||(e[57]=t("label",{for:"active"},"Active Status",-1)),i(t("select",{id:"active","onUpdate:modelValue":e[21]||(e[21]=o=>n.is_active=o),class:"w-full p-2 border rounded"},e[56]||(e[56]=[t("option",{value:!0},"Active",-1),t("option",{value:!1},"Inactive",-1)]),512),[[f,n.is_active]])]),n.is_active?m("",!0):(s(),l("div",He,[e[58]||(e[58]=t("label",{for:"inactiveNote"},"Inactive Note",-1)),i(t("input",{id:"inactiveNote","onUpdate:modelValue":e[22]||(e[22]=o=>n.note=o),type:"text",class:"w-full p-2 border rounded",placeholder:"Reason / context…",required:!n.is_active},null,8,$e),[[p,n.note,void 0,{trim:!0}]])]))])]),t("fieldset",Je,[e[65]||(e[65]=t("legend",{class:"title-md px-2"},"Technical Info",-1)),t("div",Ke,[t("div",null,[e[61]||(e[61]=t("label",{for:"role"},[y("Role"),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{id:"role","onUpdate:modelValue":e[23]||(e[23]=o=>n.role=o),class:"w-full p-2 border rounded","aria-invalid":!!d.role,required:""},e[60]||(e[60]=[t("option",{value:"employee"},"Employee",-1),t("option",{value:"admin"},"Admin",-1),t("option",{value:"super_admin"},"Super Admin",-1),t("option",{value:"developer"},"Developer",-1)]),8,Qe),[[f,n.role]]),d.role?(s(),l("p",Xe,u(d.role),1)):m("",!0)]),t("div",null,[e[62]||(e[62]=t("label",{for:"deviceId"},"Device User ID",-1)),i(t("input",{id:"deviceId","onUpdate:modelValue":e[24]||(e[24]=o=>n.device_user_id=o),type:"number",inputmode:"numeric",placeholder:"3456",class:"w-full p-2 border rounded"},null,512),[[p,n.device_user_id,void 0,{number:!0}]])]),t("div",null,[e[63]||(e[63]=t("label",{for:"empId"},"Employee ID",-1)),i(t("input",{id:"empId","onUpdate:modelValue":e[25]||(e[25]=o=>n.employee_id=o),type:"text",class:"w-full p-2 border rounded",placeholder:"M123456",autocomplete:"off"},null,512),[[p,n.employee_id,void 0,{trim:!0}]])]),t("div",null,[e[64]||(e[64]=t("label",{for:"password"},"Password",-1)),t("div",Ze,[i(t("input",{id:"password","onUpdate:modelValue":e[26]||(e[26]=o=>n.password=o),type:S.value?"text":"password",class:"w-full p-2 border rounded pr-10",autocomplete:"new-password"},null,8,et),[[se,n.password]]),t("button",{type:"button",class:"absolute inset-y-0 right-2 px-1 text-gray-600",onClick:e[27]||(e[27]=o=>S.value=!S.value),"aria-label":S.value?"Hide password":"Show password"},[t("i",{class:de(S.value?"fas fa-eye-slash":"fas fa-eye")},null,2)],8,tt)])])])]),t("div",ot,[B(r,{to:{name:"UserList",query:{company:w(h).query.company}},class:"px-4 py-2 rounded border hover:bg-gray-50"},{default:ae(()=>e[66]||(e[66]=[y(" Cancel ")])),_:1,__:[66]},8,["to"]),t("button",{type:"submit",class:"bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 disabled:opacity-60",disabled:U.value},[U.value?(s(),l("span",st,e[67]||(e[67]=[t("svg",{class:"animate-spin h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),y(" Saving… ")]))):(s(),l("span",lt,"Save"))],8,nt)])],32)])])}}};export{bt as default};
