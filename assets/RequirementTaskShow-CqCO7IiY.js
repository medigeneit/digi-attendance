import{m as R,r as Z,n as xt,c as i,o as a,f as $,g as p,a as e,i as w,j as h,t as C,w as j,d as gt,z as Q,F as N,y as X,x as K,b as Et,u as At,e as Mt,A as mt,p as v,k as l,R as Y,G as Rt,I as jt}from"./index-N5qm6zD4.js";import{L as ft}from"./LoaderView-lEtf3S4b.js";import{O as J}from"./OverlyModal-DB-Ehdxf.js";import{_ as kt}from"./DepartmentChip-Bf4PVBBS.js";import{_ as yt}from"./DescriptionView-CV0UmMHX.js";import{_ as _t,a as Lt}from"./TaskAssignedUsers-BHy0Zplh.js";import{u as Ot}from"./task-C2qxALGm.js";import{_ as Ut,a as Nt,b as Pt}from"./TaskStatusManager-Dvjua9RT.js";import{_ as Bt}from"./TodoItemCard-Dfoe_IYM.js";import{b as W,d as Vt}from"./datetime-BEfC2TVK.js";import{s as vt}from"./dom-BKn8Ftnz.js";import{u as Gt}from"./useTaskStore-CYtczNEl.js";import{u as qt}from"./useTodoDateStore-DUV6u5Qx.js";import{_ as zt}from"./TodoCreateEditShow-DVrJ9ZBY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-CCV4uuBL.js";import"./url-CePbr-gY.js";import"./requirement-Xshz1jF2.js";import"./useTodoStore-BOwj1v1f.js";import"./TaskSelectionInput-B25pBhKc.js";import"./TaskTitle-g-SwgjOa.js";const Ft={class:"my-6"},Ht={class:"text-center font-semibold text-blue-800 mb-4"},Wt={class:"text-red-600 text-center mt-2 text-sm"},Kt={class:"flex justify-between mt-3"},Jt={__name:"TaskClosingForm",props:{loading:{type:Boolean,default:!1},task:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(G,{emit:s}){const d=G,D=s,u=R({get:()=>d.loading,set:()=>D("update:loading")}),T=Z("");async function x(){var g,r;u.value=!0;try{await Ot(d.task.id,{status:"CLOSED"}),D("updateStatus")}catch(S){T.value=(r=(g=S.response)==null?void 0:g.data)==null?void 0:r.message,D("error")}finally{u.value=!1}}return(g,r)=>{var P;const S=xt("LoaderView");return a(),i("form",{class:"p-4 rounded relative border",onSubmit:j(x,["prevent"])},[u.value?(a(),$(S,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:w(()=>r[1]||(r[1]=[h(" Submitting! ")])),_:1,__:[1]})):p("",!0),r[5]||(r[5]=e("h3",{class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},"Task Closing",-1)),e("div",Ft,[e("div",Ht,C((P=G.task)==null?void 0:P.title),1),r[2]||(r[2]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),r[3]||(r[3]=e("div",{class:"text-center my-1"},[h(" Want to "),e("span",{class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},[e("i",{class:"text-sm fas fa-lock text-blue-600"}),h("Close")]),h(" the task? ")],-1))]),r[6]||(r[6]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",Wt,C(T.value),1),e("div",Kt,[e("button",{class:"btn-3",onClick:r[0]||(r[0]=j(m=>D("clickCancel"),["prevent"]))},"Cancel"),r[4]||(r[4]=e("button",{class:"btn-2"},[e("i",{class:"text-xl text-white fas fa-lock"}),h(" Close")],-1))])])],32)}}},Qt={class:"border-gray-300"},Xt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Yt={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Zt={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},It={key:0,class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-2 justify-between"},te={key:0},ee=["disabled"],se=["disabled"],ae={class:"text-base font-semibold text-gray-700"},oe={__name:"TaskTimeline",props:{task:{type:Object}},emits:["updateStatus","error"],setup(G,{emit:s}){const d=G,D=gt(),u=Q({user:null,type:""});function T(m){u.user=D.user,u.type=m}const x={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},g=R(()=>(x==null?void 0:x[S.value])||0),r=R(()=>{var m;return{"bg-yellow-50":S.value==="IN_PROGRESS","bg-green-50":S.value==="COMPLETED","bg-red-50":S.value==="PENDING","bg-blue-50":(m=d.task)==null?void 0:m.closed_at}}),S=R(()=>{var m;return(m=d.task)==null?void 0:m.status}),P=R(()=>{var m,f,L,k,B,O,A,_;return[{date:W((m=d.task)==null?void 0:m.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((f=d.task)!=null&&f.assigned_at)},{date:W((L=d.task)==null?void 0:L.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((k=d.task)!=null&&k.started_at)||g.value>=x.IN_PROGRESS},{date:W((B=d.task)==null?void 0:B.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((O=d.task)!=null&&O.completed_at)||g.value>=x.COMPLETED},{date:W((A=d.task)==null?void 0:A.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((_=d.task)!=null&&_.deadline)}].sort((U,V)=>U.date===null||V.date===null||new Date(U.date)==new Date(V.date)?U.serial-V.serial:new Date(U.date)-new Date(V.date))});return(m,f)=>{var L;return a(),i("div",{class:K(["border py-8 px-4 rounded",r.value])},[e("div",Qt,[(L=d.task)!=null&&L.is_target?(a(),i("div",Xt,f[2]||(f[2]=[e("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),h(" TARGET TASK ")]))):p("",!0),e("ol",Yt,[(a(!0),i(N,null,X(P.value,(k,B)=>{var O,A;return a(),i("li",{class:"ml-5",key:B},[e("div",Zt,[k.active?(a(),i("i",{key:0,class:K([k.icon,"text-xs"])},null,2)):p("",!0)]),e("div",{class:K({"opacity-30":!k.active})},[k.active?(a(),i("div",It,[k.date?(a(),i("span",te,C(k.date),1)):p("",!0),((O=d.task)==null?void 0:O.children_task_count)===0&&k.status==="started"&&k.active?(a(),i("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:f[0]||(f[0]=j(()=>T("start-date"),["prevent"])),disabled:!!d.task.closed_at},C(k.date?"Edit":"Set Date"),9,ee)):p("",!0),((A=d.task)==null?void 0:A.children_task_count)===0&&k.active&&k.status==="completed"?(a(),i("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:f[1]||(f[1]=j(()=>T("finish-date"),["prevent"])),disabled:!!d.task.closed_at},C(k.date?"Edit":"Set Date"),9,se)):p("",!0)])):p("",!0),e("h3",ae,C(k.title),1)],2)])}),128))])])],2)}}},le={class:"container mx-auto px-4"},ne={key:3,class:"w-full xl:max-w-8xl min-h-64 mx-auto relative"},ie={key:0,class:"text-sm mb-4 border-b","aria-label":"Breadcrumb"},re={class:"flex items-center gap-2"},de={class:"text-gray-500 hover:text-blue-500 hover:underline text-base"},ue={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},ce=["title"],pe={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},me={class:"grid grid-cols-12 gap-x-4 gap-y-3"},fe={class:"col-span-full md:col-span-7 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},ke={class:"font-medium text-md flex items-start gap-2"},ye={class:"mt-2 col-span-full flex items-center"},_e={class:"text-gray-400 text-xs"},ve={class:"flex items-center gap-0.5"},xe={class:"text-sky-400 text-sm font-semibold"},ge=["innerHTML"],be={class:"flex justify-between items-end mt-6 mb-2"},he={key:0,class:"border flex items-center justify-center h-96 rounded bg-gray-50 text-sm italic"},Ce={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},we={class:"font-semibold flex items-center gap-2"},Te={class:"text-white text-base"},Se={class:"col-span-full md:col-span-5 xl:col-span-4 2xl:col-span-3 space-y-4 sticky top-[74px] bg-white shadow rounded-lg p-4 pb-0"},$e={class:"border col-span-3 p-3 rounded-md"},De={class:"flex items-center gap-2 mb-4"},Ee={class:"flex items-center gap-2 mb-4"},Ae={key:0,class:"flex items-center gap-4 flex-wrap justify-between col-span-3 sticky bottom-0 bg-white"},Me=["disabled"],Re={key:0,class:"flex items-start justify-center !text-lg mb-4"},je={key:2,class:"py-4 flex items-center justify-between"},Le={key:3,class:"h-1"},Oe={key:2},Ue={key:1,class:"text-center py-4 text-red-500"},os={__name:"RequirementTaskShow",setup(G){const s=Gt(),d=gt(),D=qt(),u=Et(),T=At(),x=Z(""),g=Q({open:!1,task:null}),r=Q({open:!1,task:null});function S(){g.open=!0,g.task=s.task}function P(){r.open=!0,r.task=s.task}Mt(async()=>{x.value="loading";try{await f(u.params.id)}catch(o){o.response.status===404&&T.push({name:"RequirementTaskList"})}x.value="",u.hash=="#sub-tasks"&&setTimeout(()=>vt(u.hash,66),0)});const m=Q({user:null,type:""});async function f(o){await s.fetchTask(o,{with_todos:"true"})}async function L(){await f(u.params.id),m.user=null,m.type=""}const k=o=>{T.push({name:"TaskEdit",params:{id:o}})};function B(){g.open=!1,T.back()}const O=R(()=>{var o,t;return(t=(o=s==null?void 0:s.task)==null?void 0:o.users)==null?void 0:t.find(c=>{var b;return((b=d.user)==null?void 0:b.id)==c.id})}),A=R(()=>{var t,c,b,E,q,z,F,H;const o=[];return(c=(t=s.task)==null?void 0:t.requirement)!=null&&c.id&&o.push({id:(E=(b=s.task)==null?void 0:b.requirement)==null?void 0:E.id,title:(z=(q=s.task)==null?void 0:q.requirement)==null?void 0:z.title,is_current_page:!1}),o.push({id:(F=s.task)==null?void 0:F.id,title:(H=s.task)==null?void 0:H.title,is_current_page:!0}),o});mt(()=>u.params.id,async o=>{x.value="changing",await f(o),x.value=""}),mt(()=>u.hash,async function(){setTimeout(()=>vt(u.hash,66),0)});const _=Z({action:null}),U=R(()=>{const t=((s==null?void 0:s.task_todo_dates)||[]).reduce((c,b)=>{const E=b.date;return c[E]||(c[E]=[]),c[E].push(b),c},{});return Object.keys(t).sort((c,b)=>new Date(b)-new Date(c)).map(c=>({date:c,todo_dates:t[c]}))});function V(){_.value={..._.value,action:""},f(u.params.id)}function bt(){_.value={..._.value,action:""},f(u.params.id)}function I(o){console.log({todo:o}),_.value={..._.value,action:"edit",todo:o}}function ht(o,t){console.log({yearMonthDay:t,todoId:o}),_.value={..._.value,action:"addDate",date:t,todo_id:o,formReadonlyValues:{date:!0}}}function Ct(){_.value={action:null,todo:null}}function wt(o){console.log({todo:o}),_.value={..._.value,action:"show",todo:o}}function Tt(){var o;_.value={..._.value,action:"add",todoTypeId:(o=u.params)==null?void 0:o.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}async function St(o,t){var c;confirm(`Are your sure?
want to change status to ${t} 
todo: '${o==null?void 0:o.title}'`)&&(await D.updateStatus(o.id,t),f((c=u.params)==null?void 0:c.id))}async function $t(o){var t;confirm(`Are your sure want to delete todo
'${o==null?void 0:o.title}'`)&&(await D.deleteTodoDate(o.id),f((t=u.params)==null?void 0:t.id))}return(o,t)=>{var b,E,q,z,F,H,tt,et,st,at,ot,lt,nt,it,rt,dt,ut,ct,pt;const c=xt("router-view");return a(),i("div",le,[m.user?(a(),$(J,{key:0},{default:w(()=>[v(Ut,{task:l(s).task,user:m.user,type:m.type,onCloseClick:t[0]||(t[0]=n=>m.user=null),onUpdateDate:L},null,8,["task","user","type"])]),_:1})):p("",!0),g.open?(a(),$(J,{key:1},{default:w(()=>[v(Nt,{onCloseClick:t[1]||(t[1]=n=>g.open=!1),task:g.task,onDelete:B},null,8,["task"])]),_:1})):p("",!0),x.value==="loading"?(a(),$(ft,{key:2,class:"h-[80vh] items-center justify-center"})):(a(),i("div",ne,[l(s).task?(a(),i(N,{key:0},[A.value.length>1?(a(),i("nav",ie,[e("ol",re,[e("li",de,[v(l(Y),{to:"/dashboard",class:"text-sm"},{default:w(()=>t[9]||(t[9]=[e("i",{class:"fas fa-home"},null,-1),h(" Home")])),_:1,__:[9]})]),t[10]||(t[10]=e("li",{"aria-hidden":"true",class:"text-gray-400 text-base"},"/",-1)),(a(!0),i(N,null,X(A.value,(n,y)=>(a(),i(N,{key:n.id},[y>0?(a(),i("li",ue,"/")):p("",!0),e("li",{title:n==null?void 0:n.title,class:"text-gray-600 line-clamp-1"},[n.is_current_page?(a(),i("span",pe,C(n==null?void 0:n.title),1)):(a(),$(Rt(l(d).isAdminMood?l(Y):o.div),{key:0,to:`${l(d).isAdminMood?"/requirements/show/"+n.id:"/tasks"}`,class:K(["transition",{"line-clamp-1 text-justify hover:text-blue-500 hover:underline":y>0,"whitespace-nowrap hover:text-blue-500 hover:underline":y===0}])},{default:w(()=>[h(C(n==null?void 0:n.title),1)]),_:2},1032,["to","class"]))],8,ce)],64))),128))])])):p("",!0),e("div",me,[e("div",fe,[e("div",null,[e("h2",ke,[e("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:t[2]||(t[2]=n=>l(T).back())},t[11]||(t[11]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),v(yt,null,{default:w(()=>[h(C(l(s).task.title),1)]),_:1})]),e("div",ye,[e("div",_e,[t[12]||(t[12]=e("i",{class:"fas fa-clock"},null,-1)),h(" "+C(l(Vt)(l(s).task.created_at)),1)]),(b=l(s).task)!=null&&b.created_by_user?(a(),i(N,{key:0},[t[13]||(t[13]=e("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),e("div",ve,[v(jt,{user:(E=l(s).task)==null?void 0:E.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),e("div",xe,C((z=(q=l(s).task)==null?void 0:q.created_by_user)==null?void 0:z.label),1)])],64)):p("",!0)])]),v(yt,null,{default:w(()=>{var n;return[e("p",{innerHTML:(n=l(s).task)==null?void 0:n.description,class:"text-justify"},null,8,ge)]}),_:1}),e("div",null,[e("div",be,[t[15]||(t[15]=e("h3",{class:"font-semibold text-xl"},"Todos",-1)),O.value?(a(),i("button",{key:0,class:"btn btn-3 h-8",onClick:t[3]||(t[3]=j(()=>Tt(),["prevent"]))},t[14]||(t[14]=[e("i",{class:"fas fa-plus"},null,-1),h(" Add Todo ")]))):p("",!0)]),e("div",null,[U.value.length===0?(a(),i("div",he," No Todos ")):p("",!0),(a(!0),i(N,null,X(U.value,n=>(a(),i("div",{key:n.date,class:"border rounded-md overflow-hidden mb-4"},[e("div",Ce,[e("div",we,[e("div",Te,C(l(W)(n.date)),1)])]),e("div",null,[(a(!0),i(N,null,X((n==null?void 0:n.todo_dates)||[],y=>(a(),$(Bt,{key:y.id,todoDate:y,onClickTodo:M=>wt(M),onClickEdit:()=>I(y==null?void 0:y.todo),onClickChangeStatus:(M,Dt)=>St(M,Dt),onClickDelete:M=>$t(M),"hide-sorting-btn":"",class:"border-b border-sky-200"},null,8,["todoDate","onClickTodo","onClickEdit","onClickChangeStatus","onClickDelete"]))),128))])]))),128))])])]),e("div",Se,[e("div",$e,[e("div",null,[e("div",De,[t[16]||(t[16]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),v(kt,{department:(H=(F=l(s))==null?void 0:F.task)==null?void 0:H.from_department,"short-name":!0},null,8,["department"])]),t[17]||(t[17]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisors",-1)),v(_t,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((et=(tt=l(s))==null?void 0:tt.task)==null?void 0:et.supervisors)||[],listType:"supervisors",maxItem:3},null,8,["users"])]),t[20]||(t[20]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Ee,[t[18]||(t[18]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),v(kt,{department:(at=(st=l(s))==null?void 0:st.task)==null?void 0:at.to_department,"short-name":!0},null,8,["department"])]),t[19]||(t[19]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Assigned Users",-1)),v(_t,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((lt=(ot=l(s))==null?void 0:ot.task)==null?void 0:lt.users)||[],isTargetTask:(it=(nt=l(s))==null?void 0:nt.task)==null?void 0:it.is_target,maxItem:5},null,8,["users","isTargetTask"])])]),l(d).isAdminMood?(a(),i("div",Ae,[v(l(Y),{to:{name:"TaskUserAssign",params:{id:(rt=l(s).task)==null?void 0:rt.id}},class:K(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",l(s).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:t[4]||(t[4]=n=>n.stopPropagation())},{default:w(()=>t[21]||(t[21]=[e("i",{class:"fas fa-users-cog"},null,-1),h(" Employees ")])),_:1,__:[21]},8,["to","class"]),e("button",{onClick:t[5]||(t[5]=j(n=>{var y;return k((y=l(s).task)==null?void 0:y.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!l(s).task.closed_at},t[22]||(t[22]=[e("i",{class:"fas fa-edit"},null,-1),h(" Edit ")]),8,Me)])):p("",!0),v(oe,{task:(dt=l(s))==null?void 0:dt.task},null,8,["task"]),(ut=l(s))!=null&&ut.task?(a(),$(Pt,{key:1,task:((ct=l(s))==null?void 0:ct.task)||{},class:"col-span-full",onUpdateStatus:t[6]||(t[6]=()=>{var n,y;return f((y=(n=l(s))==null?void 0:n.task)==null?void 0:y.id)}),"hide-timeline":""},{top:w(()=>{var n,y,M;return[(n=l(s).task)!=null&&n.closed_at?p("",!0):(a(),i("div",Re,[v(Lt,{status:(y=l(s).task)==null?void 0:y.status,progressPercent:(M=l(s).task)==null?void 0:M.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"])]))]}),_:1},8,["task"])):p("",!0),l(d).isAdminMood?(a(),i("div",je,[e("button",{class:"btn-2-red h-8",onClick:j(S,["prevent"])},"Delete"),(pt=l(s).task)!=null&&pt.closed_at?p("",!0):(a(),i("button",{key:0,class:"btn-3 h-8",onClick:j(P,["prevent"])}," Close Task "))])):(a(),i("div",Le))])]),l(u).name==="TaskReportAdd"?(a(),$(J,{key:1,class:"*:bg-transparent"},{default:w(()=>[v(c)]),_:1})):(a(),i("section",Oe,[v(c)]))],64)):(a(),i("div",Ue,C(l(s).error),1)),x.value==="changing"?(a(),$(ft,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):p("",!0)])),v(zt,{userRole:"employee",todoModal:_.value,onCancelClick:Ct,onTodoUpdate:V,onTodoDateUpdate:bt,onClickEdit:I,onClickAddTodoDate:ht},null,8,["todoModal"]),r.open?(a(),$(J,{key:4},{default:w(()=>[v(Jt,{task:l(s).task,onClickCancel:t[7]||(t[7]=n=>r.open=!1),onUpdateStatus:t[8]||(t[8]=()=>{var n;f((n=l(s).task)==null?void 0:n.id),r.open=!1})},null,8,["task"])]),_:1})):p("",!0)])}}};export{os as default};
