import{x as M,c as i,o as c,t as a,u as G,f as X,g as Y,D as Z,r as D,q as Q,h as g,p as tt,a as e,i as $,F as L,e as A,s as u,d as k,k as et,v as st,m as H,b as C,j as N,l as U}from"./index-B9mJ98Aa.js";import{_ as at}from"./EmployeeFilter-CFHrv4Rt.js";import{L as rt}from"./LoaderView-DGZ88Anb.js";import{U as R}from"./UpdateOrCreate-BWjf2wbD.js";import{u as nt}from"./attendance-GiSbzvI0.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-DxO9Z9A5.js";import"./department-Bu8cMC1u.js";import"./EmployeeDropdownInput-ClVgZeIZ.js";import"./SelectDropdown-DIJ70i6y.js";import"./UserChip-BZaMCocz.js";import"./TimePickerAsFloatHour-DEEyTDCe.js";const W={__name:"DisplayFormattedWorkingHours",props:["workingHours"],setup(F){const x=F,l=M(()=>{if(!x.workingHours)return"-";const b=Math.floor(x.workingHours),p=Math.round((x.workingHours-b)*60);return p?`${b}h ${p}m`:`${b}h`});return(b,p)=>(c(),i("span",null,a(l.value),1))}},ct={class:"px-4 space-y-6"},it={class:"report-hero glass-panel px-5 py-2"},lt={class:"report-hero__actions"},_t={class:"report-toolbar"},ot={class:"report-toolbar__group"},ut={class:"segmented-control"},pt=["onClick"],yt={class:"report-toolbar__group"},ht={class:"segmented-control segmented-control--ghost"},mt=["onClick"],vt={class:"report-toolbar__meta"},bt={class:"flex items-center gap-2"},ft=["disabled"],xt=["disabled"],wt={class:"glass-panel space-y-3 relative z-50"},kt={class:"flex flex-wrap items-end gap-4 p-2"},Ht={class:"flex flex-col gap-1"},Ct={class:"flex items-end gap-2"},Dt={key:1},Lt={key:0,class:"empty-state glass-panel"},At={key:1,class:"empty-state glass-panel"},Mt={key:2,class:"space-y-4"},St={key:0,class:"grid gap-3 md:grid-cols-2 xl:grid-cols-3"},qt={class:"report-card__header"},Tt={class:"report-card__title"},$t={class:"report-card__subtitle"},Ft={class:"report-card__body"},Pt={class:"report-card__row"},Et={class:"text-gray-500 text-xs"},It={class:"report-card__grid"},Nt={class:"report-card__metric"},Ut={class:"report-card__metric"},Rt={class:"report-card__metric"},Wt={class:"report-card__metric"},Vt={class:"report-card__metric"},zt={class:"report-card__metric"},Bt={class:"report-card__metric"},jt={class:"report-card__metric"},Ot={class:"report-card__footer"},Jt={class:"flex items-center gap-3 text-xs text-gray-500"},Kt={class:"table-scroll"},Gt={class:"min-w-full table-auto border-collapse"},Xt={class:"text-center text-xs"},Yt={class:"td"},Zt={class:"td text-left"},Qt={class:"td text-left"},gt={class:"td"},te={class:"td"},ee={class:"td"},se={class:"td"},ae={class:"td"},re={class:"td"},ne={class:"td"},de={class:"td"},ce={class:"td"},ie={class:"td"},le={class:"td"},_e={class:"td"},oe={class:"td"},ue={class:"td text-xs"},pe={class:"text-[11px] text-gray-500"},ye={class:"td"},he={class:"td"},me={class:"td"},ve={class:"td"},be={class:"td"},fe={class:"w-10 text-xs text-gray-600"},xe={class:"td"},we={class:"w-10 text-xs text-gray-600"},ke={class:"td"},He={class:"td"},Ce={class:"td"},De={class:"td"},Le={class:"flex items-center justify-center gap-2"},Ae={class:"td"},Me={class:"td"},Se={class:"bg-gray-100 text-center text-sm font-semibold"},qe={class:"td"},Te={class:"td"},$e={class:"td"},Fe={class:"td"},Pe={class:"td"},Ee={class:"td"},Ie={class:"td"},Ne={class:"td"},Ue={class:"td"},Re={__name:"MonthlyAttendanceSummaryReport",setup(F){const x=G(),l=X(),b=Y(),p=nt(),{monthly_company_summary:P}=Z(p),d=r=>{const s=Number(r);return Number.isFinite(s)?s:0},h=(r,s)=>r.reduce((o,t)=>{try{const y=s.split(".").reduce((v,f)=>v?v[f]:void 0,t);return o+d(y)}catch{return o}},0),_=D(l.query.date&&String(l.query.date)||p.selectedMonth||""),n=D({company_id:l.query.company_id||"",department_id:l.query.department_id||"all",line_type:l.query.line_type||"all",employee_id:l.query.employee_id||""}),w=M(()=>Array.isArray(P.value)?P.value:[]),m=M(()=>{const r=w.value;return{cl:h(r,"total_cl_leave"),ml:h(r,"total_ml_leave"),sl:h(r,"total_sl_leave"),wplDays:h(r,"total_wpl_leave"),otHour:h(r,"total_overtime_hours"),absentDays:h(r,"total_absent"),wplHour:h(r,"total_wpl_hour"),paycutHour:h(r,"paycut.paycut_hours"),payableHour:h(r,"payable_hour")}}),S=D("table"),q=D("cozy"),V=[{label:"Table",value:"table",icon:"fal fa-table"},{label:"Cards",value:"cards",icon:"fal fa-th-large"}],z=[{label:"Cozy",value:"cozy"},{label:"Compact",value:"compact"}],B=M(()=>{const r=_.value;if(!r)return"Month not selected";const[s,o]=r.split("-").map(y=>Number(y));return!s||!o?r:new Intl.DateTimeFormat("en",{month:"long",year:"numeric"}).format(new Date(s,o-1))}),T=async()=>{const r=n.value.company_id,s=n.value.employee_id||"",o=n.value.line_type!=="all"?n.value.line_type:"";if(!r){alert("⚠️ Please select a company first.");return}try{await p.getMonthlyAttendanceSummaryReport(r,o,s,_.value)}catch(t){console.error("❌ Failed to load attendance:",t),alert("❌ Failed to load attendance data.")}},E=r=>{const s=l.query;Object.keys(r).some(t=>String(s[t]??"")!==String(r[t]??""))&&x.replace({query:r})},j=()=>{E({...l.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:_.value||""})};Q(_,r=>{E({...l.query,date:r||""})}),g(()=>{n.value.company_id&&T()});const O=async()=>{if(!n.value.company_id)return;const r=n.value.line_type!=="all"?n.value.line_type:"";await p.downloadExcel(n.value.company_id,r,_.value)},J=async()=>{if(!n.value.company_id)return;const r=n.value.line_type!=="all"?n.value.line_type:"";await p.downloadPDF(n.value.company_id,r,_.value)},K=()=>x.go(-1),I=async()=>{await T()};return(r,s)=>{const o=tt("router-link");return c(),i("div",ct,[e("div",it,[e("div",{class:"space-y-4"},[e("div",{class:"flex justify-between items-center gap-3"},[e("button",{class:"btn-3 !h-12 !w-12 rounded-full shadow-sm",onClick:K},s[6]||(s[6]=[e("i",{class:"far fa-arrow-left text-lg"},null,-1)])),s[7]||(s[7]=e("div",{class:"space-y-1"},[e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400"},"Monthly overview"),e("h1",{class:"title-md"},"Monthly Attendance Summary"),e("p",{class:"text-sm text-gray-500"}," Keep teams aligned with a compact snapshot of utilization, leaves, and pay-impact in one view. ")],-1))])]),e("div",lt,[e("div",_t,[e("div",ot,[s[8]||(s[8]=e("span",{class:"toolbar-label"},"View",-1)),e("div",ut,[(c(),i(L,null,A(V,t=>e("button",{key:t.value,type:"button",class:u(["segmented-control__btn",{"is-active":S.value===t.value}]),onClick:y=>S.value=t.value},[e("i",{class:u(t.icon)},null,2),e("span",null,a(t.label),1)],10,pt)),64))])]),e("div",yt,[s[9]||(s[9]=e("span",{class:"toolbar-label"},"Density",-1)),e("div",ht,[(c(),i(L,null,A(z,t=>e("button",{key:t.value,type:"button",class:u(["segmented-control__btn",{"is-active":q.value===t.value}]),onClick:y=>q.value=t.value},a(t.label),11,mt)),64))])]),e("p",vt,a(w.value.length)+" employees | "+a(B.value),1)]),e("div",bt,[e("button",{type:"button",onClick:O,class:"btn-1 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold shadow-sm",disabled:!n.value.company_id},s[10]||(s[10]=[e("i",{class:"far fa-file-excel text-base text-green-500"},null,-1),e("span",{class:"hidden sm:inline"},"Excel",-1)]),8,ft),e("button",{type:"button",onClick:J,class:"btn-1 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold shadow-sm",disabled:!n.value.company_id},s[11]||(s[11]=[e("i",{class:"fal fa-file-pdf text-base text-red-500"},null,-1),e("span",{class:"hidden sm:inline"},"PDF",-1)]),8,xt)])])]),e("div",wt,[e("div",kt,[k(at,{company_id:n.value.company_id,"onUpdate:company_id":s[0]||(s[0]=t=>n.value.company_id=t),department_id:n.value.department_id,"onUpdate:department_id":s[1]||(s[1]=t=>n.value.department_id=t),employee_id:n.value.employee_id,"onUpdate:employee_id":s[2]||(s[2]=t=>n.value.employee_id=t),line_type:n.value.line_type,"onUpdate:line_type":s[3]||(s[3]=t=>n.value.line_type=t),"with-type":!0,"initial-value":r.$route.query,onFilterChange:j},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),e("div",Ht,[s[12]||(s[12]=e("label",{class:"text-xs font-semibold text-gray-600"},"Month",-1)),e("div",Ct,[et(e("input",{type:"month","onUpdate:modelValue":s[4]||(s[4]=t=>_.value=t),class:"input-1 py-0.5"},null,512),[[st,_.value]]),e("button",{type:"button",onClick:s[5]||(s[5]=t=>T()),class:"btn-2"},"Search")])])])]),H(p).isLoading?(c(),$(rt,{key:0})):(c(),i("div",Dt,[n.value.company_id?w.value.length===0?(c(),i("div",At,s[14]||(s[14]=[e("p",{class:"text-base font-semibold text-gray-700"},"No attendance found",-1),e("p",{class:"text-sm text-gray-500"},"Try a different set of filters or a different month.",-1)]))):(c(),i("div",Mt,[S.value==="cards"?(c(),i("div",St,[(c(!0),i(L,null,A(w.value,(t,y)=>{var v,f;return c(),i("article",{key:`${(t==null?void 0:t.user_id)||"card"}-${y}`,class:u(["report-card",{"report-card--alert":t==null?void 0:t.under_target}])},[e("header",qt,[e("div",null,[e("p",Tt,a(t==null?void 0:t.user),1),e("p",$t,a(t==null?void 0:t.designation),1)]),e("span",{class:u(["report-card__tag",t!=null&&t.under_target?"report-card__tag--alert":"report-card__tag--ok"])},a(t!=null&&t.under_target?"Under target":"On track"),3)]),e("div",Ft,[e("div",Pt,[s[15]||(s[15]=e("p",{class:"report-card__body-label"},"Working Hour",-1)),e("p",{class:u(["report-card__primary",t!=null&&t.under_target?"text-red-600":"text-emerald-600"])},[C(a(t==null?void 0:t.total_working_hours)+" ",1),e("span",Et,"/ "+a(t==null?void 0:t.total_shift_hour),1)],2)]),e("div",It,[e("div",null,[s[16]||(s[16]=e("p",{class:"report-card__body-label"},"Attendance",-1)),e("p",Nt," P "+a(d(t==null?void 0:t.total_present))+" | L "+a(d(t==null?void 0:t.total_leave))+" | A "+a(d(t==null?void 0:t.total_absent)),1)]),e("div",null,[s[17]||(s[17]=e("p",{class:"report-card__body-label"},"Weekend",-1)),e("p",Ut,a(d(t==null?void 0:t.total_weekend))+" days",1)]),e("div",null,[s[18]||(s[18]=e("p",{class:"report-card__body-label"},"Actual Late",-1)),e("p",Rt,a(d(t==null?void 0:t.actual_late_day))+"d / "+a(d(t==null?void 0:t.actual_late_hour))+"h",1)]),e("div",null,[s[19]||(s[19]=e("p",{class:"report-card__body-label"},"Actual Early",-1)),e("p",Wt,a(d(t==null?void 0:t.actual_early_day))+"d / "+a(d(t==null?void 0:t.actual_early_hour))+"h",1)]),e("div",null,[s[20]||(s[20]=e("p",{class:"report-card__body-label"},"Short Leave",-1)),e("p",Vt," First "+a(d(t==null?void 0:t.total_first_short_leave))+" | Last "+a(d(t==null?void 0:t.total_last_short_leave)),1)]),e("div",null,[s[21]||(s[21]=e("p",{class:"report-card__body-label"},"Leave Types",-1)),e("p",zt," CL "+a(d(t==null?void 0:t.total_cl_leave))+" | ML "+a(d(t==null?void 0:t.total_ml_leave))+" | SL "+a(d(t==null?void 0:t.total_sl_leave))+" | WPL "+a(d(t==null?void 0:t.total_wpl_leave)),1)]),e("div",null,[s[22]||(s[22]=e("p",{class:"report-card__body-label"},"Hours Impact",-1)),e("p",Bt," OT "+a(d(t==null?void 0:t.total_overtime_hours))+"h | Payable "+a(d(t==null?void 0:t.payable_hour))+"h ",1)]),e("div",null,[s[23]||(s[23]=e("p",{class:"report-card__body-label"},"Deduction",-1)),e("p",jt,a(d(t==null?void 0:t.total_absent)*9)+"h + "+a(d(t==null?void 0:t.total_wpl_hour))+"h",1)])])]),e("footer",Ot,[e("div",Jt,[k(W,{workingHours:(v=t==null?void 0:t.paycut)==null?void 0:v.paycut_hours},null,8,["workingHours"]),((f=H(b).user)==null?void 0:f.id)===8?(c(),$(R,{key:0,class:"rounded-full bg-slate-100 px-2 py-1 text-[11px] font-semibold text-slate-600",userId:t==null?void 0:t.user_id,month:_.value,onUpdated:I},null,8,["userId","month"])):N("",!0)]),k(o,{to:{name:"EmployeeAttendance",query:{...H(l).query,employee_id:t==null?void 0:t.user_id,date:_.value}},target:"_blank",class:"report-card__cta"},{default:U(()=>s[24]||(s[24]=[C(" Job Card "),e("i",{class:"far fa-arrow-up-right-from-square text-xs"},null,-1)])),_:2,__:[24]},1032,["to"])])],2)}),128))])):(c(),i("div",{key:1,class:u(["table-shell",[q.value==="compact"?"table-density-compact":"table-density-cozy"]])},[e("div",Kt,[e("table",Gt,[s[30]||(s[30]=e("thead",{class:"sticky top-0 bg-white shadow-sm"},[e("tr",{class:"bg-gray-50 text-sm"},[e("th",{rowspan:"2",class:"th"},"#"),e("th",{rowspan:"2",class:"th text-left"},"Employee Name"),e("th",{rowspan:"2",class:"th text-left"},"Designation"),e("th",{colspan:"5",class:"th"},"Attendance Summary"),e("th",{colspan:"2",class:"th"},"Actual Late"),e("th",{colspan:"2",class:"th"},"Remaining Late"),e("th",{colspan:"2",class:"th"},"Actual Early"),e("th",{colspan:"2",class:"th"},"Remaining Early"),e("th",{rowspan:"2",class:"th"},"Working Hour"),e("th",{colspan:"4",class:"th"},"Leave Day"),e("th",{colspan:"2",class:"th"},"Short Leave"),e("th",{rowspan:"2",class:"th"},"OT Hour"),e("th",{colspan:"4",class:"th"},"Deduction"),e("th",{rowspan:"2",class:"th"},"Action")]),e("tr",{class:"bg-gray-50 text-xs"},[e("th",{class:"th"},"TD"),e("th",{class:"th"},"TP"),e("th",{class:"th"},"TW"),e("th",{class:"th"},"TL"),e("th",{class:"th"},"TA"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"CL"),e("th",{class:"th"},"ML"),e("th",{class:"th"},"SL"),e("th",{class:"th"},"WPL"),e("th",{class:"th"},"Delay"),e("th",{class:"th"},"Early"),e("th",{class:"th"},"Absent Hour"),e("th",{class:"th"},"WPL(Hour)"),e("th",{class:"th"},"Pay Cut"),e("th",{class:"th"},"Payable Hour")])],-1)),e("tbody",Xt,[(c(!0),i(L,null,A(w.value,(t,y)=>{var v,f;return c(),i("tr",{key:`${(t==null?void 0:t.user_id)||"u"}-${y}`,class:u(["border-b hover:bg-blue-50",{"table-row--alert":t==null?void 0:t.under_target}])},[e("td",Yt,a(y+1),1),e("td",Zt,a(t==null?void 0:t.user),1),e("td",Qt,a(t==null?void 0:t.designation),1),e("td",gt,a(t==null?void 0:t.total_monthly_days),1),e("td",te,a(t==null?void 0:t.total_present),1),e("td",ee,a(t==null?void 0:t.total_weekend),1),e("td",se,a(t==null?void 0:t.total_leave),1),e("td",ae,a(t==null?void 0:t.total_absent),1),e("td",re,a(t==null?void 0:t.actual_late_day),1),e("td",ne,a(t==null?void 0:t.actual_late_hour),1),e("td",de,a(t==null?void 0:t.total_remain_late_day),1),e("td",ce,a(t==null?void 0:t.total_remain_late_hour),1),e("td",ie,a(t==null?void 0:t.actual_early_day),1),e("td",le,a(t==null?void 0:t.actual_early_hour),1),e("td",_e,a(t==null?void 0:t.total_remain_early_day),1),e("td",oe,a(t==null?void 0:t.total_remain_early_hour),1),e("td",ue,[e("p",{class:u(["font-semibold",t!=null&&t.under_target?"text-red-600":"text-emerald-600"])},a(t==null?void 0:t.total_working_hours)+"h ",3),e("p",pe,"of "+a(t==null?void 0:t.total_shift_hour)+"h",1)]),e("td",ye,a(t==null?void 0:t.total_cl_leave),1),e("td",he,a(t==null?void 0:t.total_ml_leave),1),e("td",me,a(t==null?void 0:t.total_sl_leave),1),e("td",ve,a(t==null?void 0:t.total_wpl_leave),1),e("td",be,[e("p",fe,[C(a((t==null?void 0:t.total_first_short_leave)||0)+" of ",1),e("span",{class:u({"text-red-600 font-bold":(t==null?void 0:t.actual_late_day)>=4})},a((t==null?void 0:t.actual_late_day)||0),3)])]),e("td",xe,[e("p",we,[C(a((t==null?void 0:t.total_last_short_leave)||0)+" of ",1),e("span",{class:u({"text-red-600 font-bold":(t==null?void 0:t.actual_early_day)>=4})},a((t==null?void 0:t.actual_early_day)||0),3)])]),e("td",ke,a(t!=null&&t.total_overtime_hours?`${t==null?void 0:t.total_overtime_hours} H`:""),1),e("td",He,a(d(t==null?void 0:t.total_absent)*9)+"H",1),e("td",Ce,a(t==null?void 0:t.total_wpl_hour)+"H",1),e("td",De,[e("div",Le,[k(W,{workingHours:(v=t==null?void 0:t.paycut)==null?void 0:v.paycut_hours},null,8,["workingHours"]),((f=H(b).user)==null?void 0:f.id)===8?(c(),$(R,{key:0,class:"mr-2",userId:t==null?void 0:t.user_id,month:_.value,onUpdated:I},null,8,["userId","month"])):N("",!0)])]),e("td",Ae,a(t==null?void 0:t.payable_hour)+"H",1),e("td",Me,[k(o,{to:{name:"EmployeeAttendance",query:{...H(l).query,employee_id:t==null?void 0:t.user_id,date:_.value}},target:"_blank",class:"inline-flex w-20 items-center gap-1 rounded-md bg-blue-50 px-1 py-1 font-medium text-blue-700 hover:bg-blue-100"},{default:U(()=>s[25]||(s[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M15 3h6v6"}),e("path",{d:"M10 14 21 3"}),e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"})],-1),C(" Job Card ")])),_:2,__:[25]},1032,["to"])])],2)}),128))]),e("tfoot",null,[e("tr",Se,[s[26]||(s[26]=e("td",{colspan:"17",class:"td"},"Total",-1)),e("td",qe,a(m.value.cl),1),e("td",Te,a(m.value.ml),1),e("td",$e,a(m.value.sl),1),e("td",Fe,a(m.value.wplDays),1),s[27]||(s[27]=e("td",{class:"td"},null,-1)),s[28]||(s[28]=e("td",{class:"td"},null,-1)),e("td",Pe,a(m.value.otHour),1),e("td",Ee,a(m.value.absentDays)+" day",1),e("td",Ie,a(m.value.wplHour),1),e("td",Ne,a(m.value.paycutHour),1),e("td",Ue,a(m.value.payableHour),1),s[29]||(s[29]=e("td",{class:"td"},null,-1))])])])])],2))])):(c(),i("div",Lt,s[13]||(s[13]=[e("p",{class:"text-base font-semibold text-red-500"},"Select a company to start the report.",-1),e("p",{class:"text-sm text-gray-500"},"Choose a company & filters above to preview this month.",-1)])))]))])}}},Qe=dt(Re,[["__scopeId","data-v-b0402d83"]]);export{Qe as default};
