import{J as I,r as c,m as _,D as y,a3 as k,a1 as C,x as S,c as P,o as $,a as n,g as V,q as M,t as x,h as D,v as F,F as U}from"./index-Drd-7d-W.js";import{_ as N}from"./TimePickerAsFloatHour-Cgzrkp_q.js";const j=I("paycut",()=>{const p=c([]),d=c(null),u=c(!1),s=c(null),w=c(new Date().toISOString().substring(0,7)),b=_(()=>new Date(w.value).toLocaleString("default",{month:"long",year:"numeric"})),h=async(a={})=>{var o,t,e;u.value=!0,s.value=null;try{const r=await y.get("/paycuts",{params:a});p.value=((o=r==null?void 0:r.data)==null?void 0:o.data)||(r==null?void 0:r.data)||[]}catch(r){s.value=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch paycuts",console.error("Error fetching paycuts:",r)}finally{u.value=!1}},v=async(a,o)=>{var t,e;u.value=!0,s.value=null;try{const r=await y.get(`/paycuts/${a}/${o}`);d.value=r.data}catch(r){s.value=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch paycuts",console.error("Error fetching paycuts:",r)}finally{u.value=!1}},l=async(a={})=>{var o,t;u.value=!0,s.value=null;try{const e=await y.post("/paycuts",a);return p.value.push(e.data),e.data}catch(e){throw s.value=((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||"Failed to create paycut",console.error("Error creating paycut:",e),new Error(s.value)}finally{u.value=!1}},i=async a=>{var o,t;u.value=!0,s.value=null;try{const e=await y.get(`/paycuts/${a}`);return d.value=e.data||{},await k().fetchApprovalPermissions("paycut_applications",d.value.id),d.value}catch(e){throw s.value=((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||`Failed to fetch paycut (ID: ${a})`,console.error(`Error fetching paycut with id ${a}:`,e),new Error(s.value)}finally{u.value=!1}};return{paycuts:p,paycut:d,loading:u,error:s,selectedMonth:w,selectedMonthDisplay:b,fetchPaycuts:h,fetchUserMonthlyPaycuts:v,fetchPaycutById:i,createPaycut:l,updatePaycut:async(a,o)=>{var t,e;u.value=!0,s.value=null;try{return(await y.put(`/paycuts/${a}`,o)).data}catch(r){throw s.value=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||`Failed to update paycut (ID: ${a})`,console.error(`Error updating paycut with id ${a}:`,r),new Error(s.value)}finally{u.value=!1}},deletePaycut:async a=>{var o,t;u.value=!0,s.value=null;try{await y.delete(`/paycuts/${a}`),p.value=p.value.filter(e=>e.id!==a)}catch(e){throw s.value=((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||`Failed to delete paycut (ID: ${a})`,console.error(`Error deleting paycut with id ${a}:`,e),new Error(s.value)}finally{u.value=!1}},approvePaycut:async a=>{var o,t;try{await y.post(`/paycuts/${a}/approve`),await i(a)}catch(e){throw s.value=((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||`Failed to approve paycut (ID: ${a})`,console.error(e),new Error(s.value)}},rejectPaycut:async a=>{var o,t;try{await y.post(`/paycuts/${a}/reject`),await i(a)}catch(e){throw s.value=((t=(o=e.response)==null?void 0:o.data)==null?void 0:t.message)||`Failed to reject paycut (ID: ${a})`,console.error(e),new Error(s.value)}}}}),B={key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50"},q={class:"modal-card max-w-sm"},A={class:"title-lg"},O={key:0},T={key:1},z={class:"flex justify-between gap-2 mt-4"},L={__name:"UpdateOrCreate",props:{userId:{type:[String,Number],required:!0},month:{type:String,required:!0},show:Boolean},emits:["updated"],setup(p,{emit:d}){const u=C(),s=p,w=d,b=_(()=>l.value>0&&l.value<=24),h=j(),v=c(!1),l=c(""),i=c(""),g=c(""),f=c(null),m=_(()=>{var t;return!!((t=f.value)!=null&&t.id)}),E=async()=>{try{await h.fetchUserMonthlyPaycuts(s.userId,s.month);const t=h.paycut;f.value=t||null,l.value=Number((t==null?void 0:t.paycut_hours)||0)||0,i.value=(t==null?void 0:t.reason)||"",console.log({record:t})}catch(t){console.error("Failed to fetch paycut:",t),f.value=null,l.value="",i.value=""}};S(v,async t=>{t&&await E()}),S(()=>[s.userId,s.month],async()=>{v.value&&await E()});const a=async()=>{if(!b.value)return u.error("Paycut hour must be between 1â€“24");if(window.confirm(m.value?"Are you sure you want to update this paycut? This can only be done once.":"Are you sure you want to create this paycut?"))try{m.value?await h.updatePaycut(f.value.id,{paycut_hours:l.value,note:g.value}):await h.createPaycut({paycut_hours:l.value,reason:i.value,user_id:s.userId,month:s.month}),w("updated"),o()}catch(e){alert("Failed to submit paycut: "+e.message)}},o=()=>{v.value=!1};return(t,e)=>($(),P(U,null,[n("i",{onClick:e[0]||(e[0]=r=>v.value=!0),class:"fa fa-edit cursor-pointer text-sky-600"}),v.value?($(),P("div",B,[n("div",q,[n("h3",A,x(m.value?"Update Paycut":"Create Paycut"),1),e[4]||(e[4]=n("hr",{class:"my-2"},null,-1)),M(N,{modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value=r),"minute-interval":5,required:!0,"hour-min":1,"hour-max":24},null,8,["modelValue"]),m.value?($(),P("div",O,[D(n("textarea",{class:"input-1","onUpdate:modelValue":e[2]||(e[2]=r=>g.value=r),placeholder:"Edit Note"},null,512),[[F,g.value]])])):($(),P("div",T,[D(n("textarea",{class:"input-1","onUpdate:modelValue":e[3]||(e[3]=r=>i.value=r),placeholder:"Pay cut reason"},null,512),[[F,i.value]])])),e[5]||(e[5]=n("hr",{class:"my-2"},null,-1)),n("div",z,[n("button",{class:"btn-3",onClick:o},"Cancel"),n("button",{class:"btn-2-green",onClick:a},x(m.value?"Update":"Create"),1)])])])):V("",!0)],64))}};export{L as _,j as u};
