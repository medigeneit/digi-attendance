import{_ as ee}from"./CommentModal-D8Ddgp1d.js";import{L as te}from"./LoaderView-B4ey7ILm.js";import{O as B}from"./OverlyModal-B6DJ-jKF.js";import{d as se}from"./datetime-DcVwRp76.js";import{_ as j}from"./DepartmentChip-BmHzzdy2.js";import{a as ae}from"./TaskTreeViewWithSubTable-DtvzHkFi.js";import{r as y,A as G,c as f,o,a as t,q as P,g as v,t as _,j as ie,k as r,n as g,i as L,L as le,d as oe,b as ne,u as re,z,e as de,x as H,O as ue,f as w,F as J,y as W}from"./index-CqAksBNS.js";import{_ as me}from"./TaskAddForm-BJy5gzPp.js";import{_ as ce}from"./TaskEditForm-DHB7op_K.js";import{_ as ke,a as fe}from"./UserWiseList-Ca_bdQ2_.js";import{_ as pe}from"./TaskUserAssignForm-dG1V4BQH.js";import{u as ye}from"./task-priority-BR5oEV-p.js";import{m as ve}from"./task-tree-BSa8lNqK.js";import{u as ge}from"./useRequirementStore-C395Nluq.js";import{u as xe}from"./useTaskStore-7Z5pTEJ6.js";import"./useCommentStore-Nk5X9-f1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskSupervisorAndEmployee-CF8M_EAL.js";import"./UserChip-BRd62vH2.js";import"./TaskStatus-CD0_98GY.js";import"./url-CePbr-gY.js";import"./RequiredIcon-Cgpn10hq.js";import"./company-CsM8a50S.js";import"./CompanyDepartmentSelectInput-BWcSg45C.js";import"./SelectDropdown-J3YuZeAq.js";import"./SectionLoading-D7tK76E9.js";import"./TextWithHr-Bn1Q_eho.js";import"./TaskUrgencyInput-A0hL916L.js";import"./tags-BS1nwVQ_.js";import"./MultiselectDropdown-BxLdtlDl.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-CC0J4iwA.js";import"./task-YuBvlLw0.js";import"./EmployeeDropdownInput-B1vjU1y6.js";import"./user-CuICE8D6.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-CX4w7YNd.js";import"./TaskUserChip-DctSmnnU.js";import"./requirement-DxR9HJee.js";const Te={class:"flex-grow rounded overflow-y-auto"},be={class:"items-start group"},Ce={class:"flex items-start justify-between w-full gap-4"},we={class:"flex gap-2 flex-grow items-center"},he={key:0,class:"text-xl font-semibold text-blue-500"},qe={class:"font-semibold text-blue-800 line-clamp-1"},Ie={class:"flex items-center justify-between gap-16 w-full"},_e={class:"flex-shrink-0 flex items-center gap-6"},Ae={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Le={class:"text-xs text-gray-400 whitespace-nowrap"},Me={class:"flex items-center gap-2"},$e={class:"ml-0 col-span-full"},Se={__name:"RequirementDetailItemWithTaskList",props:{detail:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number,default:0}},emits:["commentButtonClick","editClick","taskAddClick","employeeAssignClick"],setup(i,{emit:n}){const h=n;function q(d){h("editClick",d)}function s(d){h("employeeAssignClick",d)}const b=y([]),u=localStorage.getItem("sub_task_opened_list");if(u)try{b.value=JSON.parse(u)}catch{b.value=[]}return G(b,d=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(d))},{deep:!0}),(d,c)=>{var k,x,p,m;return o(),f("div",{class:P(["flex w-full text-gray-800 bg-white border mb-10 rounded-md shadow",{"border-blue-500":i.index%2===0,"border-purple-500":i.index%2===1}])},[t("div",Te,[t("div",be,[t("div",{class:P(["task-details py-3 shadow-slate-100 flex flex-wrap z-30 pl-3",{"shadow-sm":i.treeLevel>0}])},[t("div",Ce,[t("div",we,[i.index!==void 0?(o(),f("div",he,_(i.index+1)+". ",1)):v("",!0),t("div",qe,_(i.detail.title),1)])]),t("div",Ie,[t("div",_e,[t("div",Ae,[t("div",Le,[c[0]||(c[0]=t("i",{class:"fas fa-clock"},null,-1)),ie(" "+_(r(se)((x=(k=i.detail)==null?void 0:k.requirement)==null?void 0:x.submission_date)),1)])]),t("div",Me,[c[1]||(c[1]=t("span",{class:"text-sm text-gray-600"},"From",-1)),g(j,{department:(p=i.detail.requirement)==null?void 0:p.from_department},null,8,["department"]),c[2]||(c[2]=t("span",{class:"text-sm text-gray-600"},"To",-1)),g(j,{department:(m=i.detail.requirement)==null?void 0:m.to_department},null,8,["department"])])])])],2),t("div",$e,[g(ae,{childrenTasks:i.detail.tasks,parentTask:{},isMyTask:i.isMyTask,"hide-buttons":i.hideButtons,"hide-assigned-users":i.hideAssignedUsers,"parent-tree-level":i.treeLevel,onEditClick:q,onEmployeeAssignClick:s,class:"*:mb-0"},{"tree-item-end":L(({task:M,level:A})=>[le(d.$slots,"item-end",{level:A,task:M})]),_:3},8,["childrenTasks","isMyTask","hide-buttons","hide-assigned-users","parent-tree-level"])])])])],2)}}},Be={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},Oe={class:"mb-4"},Ee={class:"relative"},Fe={key:0,class:"text-center py-4 text-red-500"},Ne={key:1},Ue={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},De=1,wt={__name:"RequirementTaskList",setup(i){const n=xe(),h=ge(),q=oe(),s=ne(),b=re(),u=y(""),d=y(!1),c=y(null),k=y(null),x=y(!1),p=z({parentId:0,requirementId:0}),m=z({taskId:0,isOpen:!1}),M=y(null),A=y([]),{saveTaskPriority:K,listHasRearranged:O}=ye(()=>n.taskListTree,0);de(()=>{console.log("Task List Mounted"),u.value="loading",s.query.status||b.push({query:{...s.query,status:"not-completed"}}),C()});let I;async function C(){let a;I=new AbortController,h.fetchRequirementsWithTasks({...s.query,page:1}),s.name==="MyTaskList"?a=await n.fetchMyTasks({...s.query,page:1},{signal:I.signal}):a=await n.fetchTasks({...s.query,page:1},{signal:I.signal}),u.value="",A.value=a.query_log||[]}const $=a=>{x.value=!0,p.parentId=a},E=a=>{m.taskId=a,m.isOpen=!0},F=a=>{c.value=a,d.value=!0},Q=()=>{d.value=!1,c.value=null};async function N(){k.value=null,x.value=!1,p.parentId=0,u.value="loading",await C()}async function X(){x.value=!1,p.parentId=0,await C()}async function Y(){u.value="loading",await K()&&await C()}G(()=>({...s.query}),async()=>{try{n.resetTaskList(),u.value="loading",await C()}catch{console.warn("...")}});const U=H({get(){return{...s.query}},set(a){localStorage.removeItem("sub_task_opened_list"),b.push({query:{...a}})}}),Z=H(()=>{var e;const a={...s.query};return s.name=="MyTaskList"&&(a["user-ids"]=(e=q==null?void 0:q.user)==null?void 0:e.id),Array.isArray(n.tasks)?ve(n.tasks,a):[]});return ue(()=>{n.tasks.value=null,I&&I.abort()}),(a,e)=>{var D,V,R;return o(),f("div",Be,[k.value?(o(),w(B,{key:0},{default:L(()=>[g(ce,{taskId:k.value,onClose:e[0]||(e[0]=l=>k.value=null),onUpdated:N},null,8,["taskId"])]),_:1})):v("",!0),x.value?(o(),w(B,{key:1},{default:L(()=>[g(me,{parentTaskId:p.parentId,requirementId:p.requirementId,onClose:X,onTaskCreated:N},null,8,["parentTaskId","requirementId"])]),_:1})):v("",!0),m.isOpen?(o(),w(B,{key:2,class:"*:max-w-4xl"},{default:L(()=>[g(pe,{taskId:m.taskId,onCancelClick:e[1]||(e[1]=()=>{m.isOpen=!1,m.taskId=0}),onSuccess:e[2]||(e[2]=()=>{m.isOpen=!1,m.taskId=0,u.value="loading",C()})},null,8,["taskId"])]),_:1})):v("",!0),g(ke,{modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=l=>U.value=l),onClickAddTask:$,onClickPrioritySave:Y,onClickPriorityDiscard:e[4]||(e[4]=()=>r(O)?M.value.resetItems:null),"list-has-rearranged":r(O),isMyTask:r(s).name==="MyTaskList"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((V=(D=r(s))==null?void 0:D.query)==null?void 0:V["query-log"])=="true"?(o(!0),f(J,{key:3},W(A.value,(l,S)=>(o(),f("div",{key:S,class:"text-xs text-gray-500"},[t("div",Oe,_(l.raw_query),1)]))),128)):v("",!0),t("div",null,[(o(!0),f(J,null,W(r(h).requirementDetails,(l,S)=>(o(),w(Se,{key:l.id,index:S,detail:l,onCommentButtonClick:e[5]||(e[5]=T=>F(T,a.task.id)),onEditClick:e[6]||(e[6]=T=>k.value=T),onAddClick:e[7]||(e[7]=T=>$(T)),onEmployeeAssignClick:e[8]||(e[8]=T=>E(T))},null,8,["index","detail"]))),128))]),e[13]||(e[13]=t("hr",null,null,-1)),t("div",Ee,[r(n).error?(o(),f("div",Fe,_(r(n).error),1)):r(n).tasks.length>0?(o(),f("div",Ne,[((R=r(s).query)==null?void 0:R.view)=="userwise"?(o(),w(fe,{key:0,tasks:Z.value,selectedUserId:r(s).query["user-ids"],isMyTask:r(s).name==="MyTaskList",onCommentButtonClick:e[9]||(e[9]=l=>F(l,a.task.id)),onEditClick:e[10]||(e[10]=l=>k.value=l),onAddClick:e[11]||(e[11]=l=>$(l)),onEmployeeAssignClick:e[12]||(e[12]=l=>E(l))},null,8,["tasks","selectedUserId","isMyTask"])):v("",!0)])):u.value!=="loading"?(o(),f("div",Ue," No tasks found. ")):v("",!0),u.value==="loading"?(o(),w(te,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):v("",!0)]),g(ee,{show:d.value,"commentable-id":c.value,"commentable-type":"task","user-id":De,"on-close":Q,onSubmitted:r(n).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{wt as default};
