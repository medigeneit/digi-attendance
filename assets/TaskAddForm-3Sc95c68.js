import{c,o as u,s as B,r as x,q as L,A as q,e as M,m as R,f as k,a as t,w as N,h as y,n as d,t as _,g as r,l as w,v as T,E as I,C as z,y as A}from"./index-BUDGAavx.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as h}from"./useRequirementStore-OhXxN6LF.js";import{u as G}from"./useTaskStore-Bc7HIxNX.js";import{S as P}from"./SectionLoading-Ctwp0I02.js";const $={},F={class:"font-medium text-red-600 text-sm"};function K(f,S){return u(),c("span",F,"*")}const C=O($,[["render",K]]),j={class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 relative"},H={key:0,class:"text-center mt-2 mb-6"},J={class:"text-sky-600"},Q={key:1,class:"text-center mt-2 mb-6"},W={class:"text-sky-600"},X={class:"mb-4"},Y={class:"block text-gray-600 text-sm mb-1 font-medium"},Z={class:"mb-4"},ee={class:"flex gap-1 items-center"},te={class:"flex gap-1 items-center"},se={class:"grid grid-cols-2 gap-4 mb-4"},le={class:"block text-gray-600 text-sm mb-1 font-medium"},oe={class:"mt-8"},ae={class:"grid grid-cols-2 gap-4 mb-4 mt-4"},re={class:"mb-4"},ne={class:"block text-gray-600 text-sm mb-1 font-medium"},ie={class:"mb-4"},de={class:"block text-gray-600 text-sm mb-1 font-medium"},ue={class:"mb-4"},me={key:2,class:"mb-4 text-red-500 font-medium"},pe={class:"flex items-center gap-4"},be=["disabled"],ke={__name:"TaskAddForm",props:{parentTaskId:{type:Number,required:!0},requirementId:{type:Number}},emits:["taskCreated","close","error","ok"],setup(f,{emit:S}){const i=f,v=S,m=G(),E=h(),{requirement:p}=B(E),n=x(),D=x([]),V=L(()=>D.value.map(o=>o.id)),a=x(""),s=x({title:"",user_ids:[],priority:0,status:"PENDING",description:"",is_important:!1,is_urgent:!1});q(V,o=>{s.value.user_ids=o}),M(async()=>{a.value=""}),q(()=>({parentTaskId:i.parentTaskId,requirement:i.requirementId}),async()=>{var o;i.requirementId>0&&await E.fetchRequirement(i.requirementId),i.parentTaskId>0&&(n.value=(o=await m.fetchTask(i.parentTaskId,{},{loadingBeforeFetch:!1,fetchOnly:!0}))==null?void 0:o.task,console.log({t:n.value})),a.value="initialized"},{initial:!0,immediate:!0});async function U(){var e,b;a.value="loading";const o={...s.value,parent_id:((e=n==null?void 0:n.value)==null?void 0:e.id)||0,requirement_id:((b=p==null?void 0:p.value)==null?void 0:b.id)||null};try{await m.createTask(o,{loadingBeforeCreate:!1}),v("taskCreated"),a.value="taskCreated"}catch(g){console.log({err:g}),v("error",m.error),a.value="taskCreatingError"}}return(o,e)=>{var b,g;return u(),c("div",j,[a.value=="loading"?(u(),R(P,{key:0})):k("",!0),e[22]||(e[22]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Task",-1)),e[23]||(e[23]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/60 mb-4 text-xs",onClick:e[0]||(e[0]=N(l=>v("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. "),t("form",{onSubmit:N(U,["prevent"])},[f.requirementId&&((b=y(p))!=null&&b.title)?(u(),c("p",H,[e[10]||(e[10]=d(" Task under requirement ")),t("span",J,_(y(p).title),1)])):k("",!0),f.parentTaskId&&((g=n.value)!=null&&g.title)?(u(),c("p",Q,[e[11]||(e[11]=d(" Sub task under ")),t("span",W,_(n.value.title),1)])):k("",!0),t("div",X,[t("label",Y,[e[12]||(e[12]=d("Task Title ")),w(C)]),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.title=l),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,s.value.title]])]),t("div",Z,[t("label",ee,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=l=>s.value.is_important=l),class:"size-4"},null,512),[[I,s.value.is_important]]),e[13]||(e[13]=t("span",{class:"block text-gray-600 text-base pt-1 mb-1 font-medium"},"Important",-1))]),t("label",te,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=l=>s.value.is_urgent=l),class:"size-4"},null,512),[[I,s.value.is_urgent]]),e[14]||(e[14]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Urgent",-1))])]),t("div",se,[t("div",null,[t("label",le,[e[15]||(e[15]=d("Status ")),w(C)]),r(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.status=l),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[16]||(e[16]=[t("option",{value:""},"--select---",-1),t("option",null,"PENDING",-1),t("option",null,"IN_PROGRESS",-1),t("option",null,"COMPLETED",-1),t("option",null,"BLOCKED",-1),t("option",null,"CANCELLED",-1),t("option",null,"BACK_LOG",-1)]),512),[[z,s.value.status]])])]),t("div",oe,[t("label",{class:A(["flex gap-1 items-center mt-4 border rounded py-2 justify-center cursor-pointer",{"bg-yellow-200":s.value.is_target}])},[r(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>s.value.is_target=l),class:"size-6"},null,512),[[I,s.value.is_target]]),e[17]||(e[17]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Is Target Task",-1))],2)]),t("div",ae,[t("div",re,[t("label",ne,[e[18]||(e[18]=d(" Start Date ")),w(C)]),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.started_at=l),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,s.value.started_at]])]),t("div",ie,[t("label",de,[e[19]||(e[19]=d(" Deadline ")),w(C)]),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.deadline=l),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,s.value.deadline]])])]),t("div",ue,[e[20]||(e[20]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),r(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.description=l),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,s.value.description]])]),e[21]||(e[21]=t("hr",{class:"mb-4"},null,-1)),y(m).error?(u(),c("div",me,_(y(m).error),1)):k("",!0),t("div",pe,[t("button",{disabled:a.value=="loading",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},_(a.value=="loading"?"Saving...":"Save Task"),9,be),t("button",{type:"button",onClick:e[9]||(e[9]=l=>v("close")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32)])}}};export{ke as _};
