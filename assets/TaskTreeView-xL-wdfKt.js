import{c as o,o as r,F as L,x as E,m as w,p as T,I as V,G as W,q as x,a as t,y as p,z as X,n as _,t as h,T as Z,f as k,l as v,B as z,k as H,b as ee,r as F,A as te,w as N,h as se}from"./index-B3AlSP1P.js";import{_ as G}from"./UserChip-DkgiE04f.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"mt-3"},le={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(e,{emit:a}){const l=a;return(c,i)=>(r(),o("div",re,[(r(!0),o(L,null,E(e.childrenTasks,(u,m)=>(r(),w(Ye,{key:u.id,index:m,task:u,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:i[0]||(i[0]=d=>l("editClick",d)),onAddClick:i[1]||(i[1]=d=>l("addClick",d))},{"item-end":T(({task:d,level:n})=>[V(c.$slots,"treeItemEnd",{task:d,level:n})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ae=W({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:a}){const l=e,c=x(function(){if(l.task.children_tasks.length===0)return l.task.status==="COMPLETED"?1:0;const m=d=>{let n=0;for(let g=0;g<d.length;g++){const y=d[g];if(y.children_tasks.length===0)y.status==="COMPLETED"&&(n+=1);else{const $=y.children_tasks.length;m(y.children_tasks)===$&&(n+=1)}}return n};return m(l.task.children_tasks)}),i=x(()=>l.task.children_tasks.length===0?l.task.status==="COMPLETED"?100:0:c.value/l.task.children_tasks.length*100),u=x(()=>{const m=i.value;let d,n,g;return m===100?(d="bg-green-50",n="bg-green-200",g="text-green-600 "):m<100&&(d="bg-red-50",n="bg-red-200",g="text-red-600 "),{container:d,bar:n,text:g}});return a({completedPercentage:i.value,completedSubTaskCount:c.value}),(m,d)=>(r(),o("div",null,[t("div",{class:p(["rounded-full border py-0.5 relative overflow-hidden h-6",u.value.container]),style:{width:"180px"}},[t("div",{class:p(["z-10 absolute top-0 bottom-0",u.value.bar]),style:X(`width: ${i.value}%`)},null,6),t("span",{class:p(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",u.value.text])},[t("span",null,[t("span",null,h(c.value),1),d[0]||(d[0]=_(" / ")),t("span",null,h(m.task.children_tasks.length||1),1)])],2)],2)]))}}),ne={__name:"TaskStatus",props:{status:{type:String,required:!0}},setup(e){const a=e,l=x(()=>{switch(a.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),c=x(()=>{switch(a.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(i,u)=>(r(),o("div",{class:p(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",l.value])},[t("i",{class:p(c.value)},null,2),_(" "+h(e.status),1)],2))}},J=e=>{if(!e)return"";try{const a=new Date(e);if(isNaN(a))return"";const l=String(a.getDate()).padStart(2,"0"),i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a.getMonth()],u=a.getFullYear();return`${l}-${i}-${u}`}catch{return""}},oe={key:0,class:"text-gray-500 text-xs"},ie={key:2,class:"text-sm text-gray-500 relative group/users"},de={class:"cursor-pointer hover:underline text-blue-600"},ue={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg min-w-48"},ce={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:()=>null},isTargetTask:{Boolean,default:!1}},setup(e){const a=e,l=x(()=>a.users.slice(0,2)),c=x(()=>a.users.slice(2));function i(m){if(typeof a.routeTo=="function")return a.routeTo(m)}const u=x(()=>typeof a.routeTo=="function"?Z:"div");return(m,d)=>(r(),o("div",null,[a.users.length===0?(r(),o("div",oe,"Not Assigned To Anyone")):(r(!0),o(L,{key:1},E(l.value,(n,g)=>(r(),w(z(u.value),{key:g,to:i(n)},{default:T(()=>[v(G,{class:p(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask}]),user:n},null,8,["class","user"])]),_:2},1032,["to"]))),128)),c.value.length>0?(r(),o("div",ie,[t("div",de," + "+h(c.value.length)+" more users ",1),t("div",ue,[(r(!0),o(L,null,E(c.value,(n,g)=>(r(),w(z(u.value),{key:g,to:i(n),class:"w-full block mb-2"},{default:T(()=>[v(G,{class:p(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:n},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):k("",!0)]))}},fe={},me={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function ge(e,a){return r(),o("span",me,"IMPORTANT")}const ke=K(fe,[["render",ge]]),he={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(a,l)=>{const c=H("RouterLink");return r(),w(c,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:T(()=>[t("div",null,h(e.task.title),1)]),_:1},8,["to"])}}},xe={},pe={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function be(e,a){return r(),o("span",pe,"URGENT")}const ve=K(xe,[["render",be]]),ye={class:"flex w-full"},_e={key:0,class:"border-l border-gray-200 last:border-l-0"},we={class:"items-start grid grid-cols-4 gap-4 group"},Te={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},Ce={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},$e={key:0,class:"text-xl font-semibold text-sky-500"},Se={key:1,class:"text-sm text-gray-500 mt-2"},Ne={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Le={class:"flex items-center gap-6 flex-none lg:w-full order-0 lg:order-1"},Ee={class:"flex gap-4 items-center"},De={class:"text-gray-500 text-sm"},Ae={class:"text-red-500 text-sm"},Be={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Re={class:"col-span-full flex items-center my-2 lg:my-0 justify-center flex-wrap gap-3"},Oe={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4"},Pe={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Me={key:1,class:"text-gray-500"},qe={class:"font-semibold text-green-800"},Ie={key:2,class:"ml-4 text-gray-500"},je={class:"text-red-500 font-semibold"},Ue={class:"mt-4 col-span-full"},ze={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},Fe={class:"text-xs text-gray-500 flex gap-3 order-1 sm:order-0"},Ge=["href"],Je={class:"flex items-center sm:ml-auto order-0 sm:order-1"},Ve={key:0,class:"flex gap-2 ml-4 items-center text-xs"},He=["href"],Ke={class:"ml-0"},Ye={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick"],setup(e,{emit:a}){const l=e,c=ee(),i=F(null),u=a;function m(f){u("addClick",f)}function d(f){u("editClick",f)}const n=F([]),g=localStorage.getItem("sub_task_opened_list");if(g)try{n.value=JSON.parse(g)}catch{n.value=[]}const y=x(()=>J(l.task.started_at)),$=x(()=>J(l.task.deadline)),C=x({get:()=>n.value.includes(l.task.id),set:f=>{const s=n.value.includes(l.task.id);f&&!s?n.value.push(l.task.id):!f&&s&&(n.value=n.value.filter(S=>S!==l.task.id))}});te(n,f=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(f))},{deep:!0});const D=x(()=>{var f,s;return((s=(f=l.task)==null?void 0:f.children_tasks)==null?void 0:s.length)>0});function Y(){l.task.children_tasks.length>0&&(C.value=!C.value)}return(f,s)=>{var A,B,R,O,P,M,q,I,j,U;const S=H("RouterLink");return r(),o("div",ye,[e.treeLevel>0?(r(),o("div",_e,s[3]||(s[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):k("",!0),t("div",{class:p(["flex-grow border rounded py-3 px-3",{"bg-green-100  ":((A=i.value)==null?void 0:A.completedPercentage)===100,"bg-white hover:bg-gray-50":((B=i.value)==null?void 0:B.completedPercentage)<100,"shadow-sm":e.treeLevel>0}])},[t("div",we,[t("div",Te,[t("div",Ce,[e.index!==void 0?(r(),o("div",$e,h(e.index+1)+". ",1)):k("",!0),v(he,{task:e.task},null,8,["task"]),(R=e.task)!=null&&R.requirement?(r(),o("p",Se," Requirement: "+h((P=(O=e.task)==null?void 0:O.requirement)==null?void 0:P.title),1)):k("",!0)]),t("div",Ne,[v(ne,{status:e.task.status},null,8,["status"]),v(ae,{task:e.task,ref_key:"progress",ref:i,class:"text-sm"},null,8,["task"])]),t("div",Le,[t("div",Ee,[e.showDraggableHandle?(r(),o("button",{key:0,onMousedown:s[0]||(s[0]=N((...b)=>f.handleDragging&&f.handleDragging(...b),["stop"])),class:"handle"},s[4]||(s[4]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):k("",!0),t("span",De," #"+h(e.task.id),1),t("div",Ae,h(e.treeLevel),1)]),t("div",Be,[(M=e.task)!=null&&M.is_important?(r(),w(ke,{key:0})):k("",!0),(q=e.task)!=null&&q.is_urgent?(r(),w(ve,{key:1})):k("",!0)])])]),t("div",Re,[v(ce,{class:"flex items-center justify-center flex-wrap gap-3",users:e.task.users||[],routeTo:b=>({query:{...se(c).query,view:"userwise","company-id":b.company_id,"user-ids":b.id}})},null,8,["users","routeTo"]),v(S,{to:{name:"TaskUserAssign",params:{id:(I=e.task)==null?void 0:I.id}},title:"Add/Remove User",class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},{default:T(()=>s[5]||(s[5]=[t("i",{class:"fas fa-users-cog"},null,-1)])),_:1},8,["to"])])]),t("div",Oe,[e.task.is_target?(r(),o("div",Pe," TARGET TASK ")):k("",!0),y.value?(r(),o("span",Me,[s[6]||(s[6]=_(" Started: ")),t("span",qe,h(y.value),1)])):k("",!0),$.value?(r(),o("span",Ie,[s[7]||(s[7]=_(" Deadline: ")),t("span",je,h($.value),1)])):k("",!0)]),t("div",Ue,[t("div",ze,[t("div",Fe,[t("button",{class:p([{"text-yellow-600 font-semibold  inline-block  ":D.value},"flex items-center gap-1 group"]),onClick:Y},[t("i",{class:p([C.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:p(D.value?"group-hover:underline":"")}," Sub Tasks ("+h((j=e.task.children_tasks)==null?void 0:j.length)+") ",3)],2),e.treeLevel<2?(r(),o("a",{key:0,href:`/tasks/add?parent_id=${l.task.id}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:s[1]||(s[1]=N(b=>u("addClick",l.task.id),["stop","prevent"]))},s[8]||(s[8]=[t("i",{class:"fas fa-plus"},null,-1),_(" Add Sub Task ")]),8,Ge)):k("",!0)]),t("div",Je,[e.hideButtons?k("",!0):(r(),o("div",Ve,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:s[2]||(s[2]=N(b=>u("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},s[9]||(s[9]=[t("i",{class:"fas fa-edit"},null,-1),_(" Edit ")]),8,He),v(S,{to:{name:"TaskReports",params:{id:(U=e.task)==null?void 0:U.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:T(()=>s[10]||(s[10]=[t("i",{class:"far fa-file-alt"},null,-1),_(" Reports ")])),_:1},8,["to"])]))])]),t("div",Ke,[C.value?(r(),w(le,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:d,onAddClick:m},{"tree-item-end":T(({task:b,level:Q})=>[V(f.$slots,"item-end",{level:Q,task:b})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):k("",!0)])])],2)])}}};export{Ye as _,ae as a,J as g};
