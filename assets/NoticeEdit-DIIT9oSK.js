import{z as R,i as B,r as x,s as N,p as S,b as h,q as k,c as m,a as l,j,w as I,d as c,A as q,F as P,x as z,h as d,v as _,l as f,m as A,f as $,g as G,n as H,o as r,t as J,k as K}from"./index-Dz0vVWYx.js";import{L as O}from"./LoaderView-DeHtOgjp.js";import{_ as Q,s as F}from"./vue-multiselect.esm-DAf9ONbp.js";import{u as W}from"./company-CIQx75Wq.js";import{u as X}from"./department-BgxxQ8zZ.js";import{u as Y}from"./notice-Cu6ffLKq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"my-container space-y-2"},ee={class:"card-bg md:p-8 p-4 mx-4"},te={class:"grid gap-4"},le={class:"border p-4 rounded-md bg-gray-100"},se={class:"grid md:grid-cols-3 gap-4"},oe=["value"],ae={class:"col-span-3 flex justify-between gap-8"},ie={class:"w-full"},de={class:"w-full"},re={class:"col-span-full"},ne={class:"flex justify-center gap-4"},ge={__name:"NoticeEdit",setup(ue){const s=R({title:"",description:"",published_at:"",expired_at:"",company_id:"",department_id:"",file:""}),b=Y(),v=W(),n=X(),y=B(),g=$(),V=G(),u=x(!1);N(v);const{employees:L}=N(n),i=x([]),U=S(()=>i.value.map(o=>o.id)),p=x([]),E=S(()=>p.value.map(o=>o.id));h(async()=>{u.value=!0,await v.fetchCompanies(),await M(),u.value=!1}),k(()=>s.company_id,async o=>{o&&(await n.fetchDepartments(o),u.value=!1)});const C=async o=>{var a;const e=o.target.files[0];if(e){const t=new FormData;t.append("file",e),console.log({file:e});const w=await b.fetchFileUpload(t);s.file=(a=w==null?void 0:w.data)==null?void 0:a.url}},D=o=>{if(!o)return;const e=o.split(" ")[0];if(!e.includes("-")){formattedDate.value="Invalid Date Format";return}return e},M=async()=>{var o,e;try{const a=g.params.id,t=await b.fetchNotice(a);s.title=t.title,s.file=t.file,s.published_at=D(t.published_at),s.expired_at=D(t.expired_at),s.description=t.description,s.company_id=t.company_id,s.department_id=t.department_id,i.value=t.departments,p.value=t.employees}catch(a){const t=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to load notice data";y.error(t),V.push({name:"NoticeList"})}},T=async()=>{var o,e;try{const a={...s,department_ids:U.value,employee_ids:E.value};console.log({dataToSend:a}),await b.updateNotice(g.params.id,a),y.success("Notice updated successfully"),V.push({name:"NoticeShow",params:{id:g.params.id}})}catch(a){const t=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to update notice";y.error(t)}};return k(i,o=>{const e=o.map(a=>a.id);n.fetchDepartmentEmployee(e)}),(o,e)=>{const a=H("RouterLink");return r(),m("div",Z,[l("div",ee,[e[20]||(e[20]=l("h2",{class:"title-lg text-center"},"Edit Notice",-1)),u.value?(r(),j(O,{key:0,class:"bg-gray-100 border shadow-none"})):(r(),m("form",{key:1,onSubmit:I(T,["prevent"]),class:"space-y-4"},[l("div",te,[l("div",le,[e[16]||(e[16]=l("p",{class:"title-md"},"Notice Info",-1)),e[17]||(e[17]=l("hr",{class:"my-2"},null,-1)),l("div",se,[l("div",null,[e[8]||(e[8]=l("label",null,"Company",-1)),c(l("select",{id:"company_id","onUpdate:modelValue":e[0]||(e[0]=t=>s.company_id=t),class:"w-full border rounded px-3 py-2",required:""},[e[7]||(e[7]=l("option",{value:"",disabled:""},"Select a company",-1)),(r(!0),m(P,null,z(d(v).companies,t=>(r(),m("option",{key:t==null?void 0:t.id,value:t==null?void 0:t.id},J(t==null?void 0:t.name),9,oe))),128))],512),[[q,s.company_id]])]),l("div",null,[e[9]||(e[9]=l("label",null,"Publish Date",-1)),c(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.published_at=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[_,s.published_at]])]),l("div",null,[e[10]||(e[10]=l("label",null,"Expire Date",-1)),c(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.expired_at=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[_,s.expired_at]])]),l("div",ae,[l("div",ie,[e[11]||(e[11]=l("label",null,"Departments",-1)),f(d(F),{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value=t),options:d(n).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",class:"w-full p-2 border rounded"},null,8,["modelValue","options"])]),l("div",de,[e[12]||(e[12]=l("label",null,"Employees",-1)),f(d(F),{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t),options:d(L),multiple:!0,searchable:!0,placeholder:"Select Employee","track-by":"id",label:"name",class:"w-full p-2 border rounded"},null,8,["modelValue","options"])])]),l("div",null,[e[13]||(e[13]=l("label",null,"Title*",-1)),c(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.title=t),type:"text",class:"w-full p-2 border rounded"},null,512),[[_,s.title]])]),l("div",null,[e[14]||(e[14]=l("label",null,"File",-1)),l("input",{onChange:C,type:"file",class:"w-full p-2 border rounded"},null,32)]),l("div",re,[e[15]||(e[15]=l("label",null,"Description",-1)),f(Q,{modelValue:s.description,"onUpdate:modelValue":e[6]||(e[6]=t=>s.description=t),cols:"30",rows:"10",class:"w-full px-4 py-2"},null,8,["modelValue"])])])])]),l("div",ne,[f(a,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:A(()=>e[18]||(e[18]=[K(" Cancel ")])),_:1}),e[19]||(e[19]=l("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32))])])}}};export{ge as default};
