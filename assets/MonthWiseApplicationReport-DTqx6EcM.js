import{b as G,u as Q,r as x,A as E,x as N,e as X,c as n,o,a as l,f as tt,g as r,j as f,t as i,h,O as b,n as et,v as F,q as v,F as _,y as lt}from"./index-D1oMHpmu.js";import{u as st}from"./leave-application-DQwr3vVQ.js";import{_ as at}from"./EmployeeFilter-DDto4F5Q.js";import{L as ot}from"./LoaderView-Ctln-U5F.js";import{_ as nt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-B-OeDJIs.js";import"./department-KgdX4KuA.js";import"./EmployeeDropdownInput-CbZCmlAp.js";import"./SelectDropdown-kWIfxUNS.js";import"./UserChip-CYm-eoW0.js";const it={class:"px-3 space-y-4"},rt={class:"flex flex-wrap items-center gap-2"},dt={class:"min-w-[200px]"},pt={class:"text-[11px] text-slate-500 -mt-0.5"},ut={class:"hidden md:flex items-center gap-2 rounded-lg border bg-white p-1"},ct={class:"cols-chk"},vt={class:"cols-chk"},_t={class:"cols-chk"},mt={class:"cols-chk"},xt={class:"cols-chk"},ht={class:"flex flex-wrap items-end gap-3 rounded-lg border bg-white p-2"},yt={class:"flex items-center gap-2 ml-auto"},ft={class:"relative"},bt={class:"flex items-center gap-1 text-[11px] text-slate-600"},gt={class:"flex items-center gap-1 text-[11px] text-slate-600"},kt={key:1,class:"p-2 rounded bg-red-50 text-red-700 text-[12px] border border-red-200"},wt={class:"w-full text-[12px] print:text-[11px] leading-tight"},St={key:0,span:"3",style:{width:"96px"}},At={key:1,span:"4",style:{width:"96px"}},Mt={key:2,span:"2",style:{width:"102px"}},Lt={key:3,span:"2",style:{width:"96px"}},Tt={key:4,span:"1",style:{width:"96px"}},Ot={class:"sticky top-0 z-20 bg-white/95 backdrop-blur"},qt={class:"*:px-2.5 *:py-1.5 *:text-center *:border-b *:border-slate-200 text-slate-700"},Rt=["colspan"],Ct=["colspan"],Ut=["colspan"],Vt=["colspan"],Et=["colspan"],Nt={class:"*:px-2.5 *:py-1 *:text-center *:border-b *:border-slate-200"},$t={key:4,class:"th-col th-manual",title:"Manual Adjustments"},jt={class:"divide-y divide-slate-100"},zt={class:"px-2.5 text-left sticky left-0 z-20 bg-white"},Bt={class:"px-2.5 sticky left-[34px] z-20 bg-white"},It={class:"flex items-center gap-2"},Dt={class:"font-medium text-slate-800 truncate max-w-[180px]"},Ft={key:0,class:"text-[10px] text-slate-400"},Ht={key:0,class:"text-[10px] text-slate-500 -mt-0.5 truncate max-w-[200px]"},Jt={class:"text-center whitespace-nowrap"},Pt=["title"],Wt={class:"text-center whitespace-nowrap"},Zt=["title"],Kt={class:"text-center"},Yt={class:"text-center"},Gt={class:"text-center"},Qt={class:"text-center"},Xt={class:"text-center font-medium"},te={class:"text-center"},ee={class:"text-center"},le={class:"text-center"},se={class:"text-center"},ae={key:4,class:"text-center"},oe={class:"bg-gradient-to-r from-slate-100 to-slate-50 *:px-2.5 *:py-1.5 font-semibold border-t sticky bottom-0 z-10"},ne={class:"text-slate-700"},ie={class:"text-center"},re={class:"text-center"},de={class:"text-center"},pe={class:"text-center"},ue={class:"text-center"},ce={class:"text-center"},ve={class:"text-center"},_e={class:"text-center"},me={class:"text-center"},xe={class:"text-center"},he={class:"text-center"},ye={key:4,class:"text-center"},fe={key:3,class:"text-center text-slate-500 py-8"},H="monthly_application_cols_v2",be={__name:"MonthWiseApplicationReport",setup(ge){const g=G(),$=Q(),J=st(),S=x(!1),T=x(null),j=x([]),R=x(""),y=x(g.query.date||new Date().toISOString().slice(0,7)),p=x({company_id:g.query.company_id||"",department_id:g.query.department_id||"all",line_type:g.query.line_type||"all"}),C=x(""),O=x(!0),U=x(!1),a=x({ot:!0,leave:!0,ex:!1,sl:!0,manual:!0});try{const s=JSON.parse(localStorage.getItem(H)||"{}");Object.assign(a.value,s)}catch{}E(a,s=>localStorage.setItem(H,JSON.stringify(s)),{deep:!0});const c=s=>Number.isFinite(+s)?+s:0,z=s=>{const t=Number(s)||0,e=Math.floor(t),u=Math.round((t-e)*60);return`${e}h ${String(u).padStart(2,"0")}m`},q=s=>{const t=Number(s)||0,e=Math.floor(t),u=Math.round((t-e)*60);return`${e}:${String(u).padStart(2,"0")}`},P=s=>{if(!s)return{};if(Array.isArray(s)){const t={};for(const e of s)e&&e.type!=null&&(t[String(e.type)]=c(e.days));return t}return typeof s=="object"?s:{}},W=(s={})=>Object.values(s).some(t=>c(t)>0),Z=N(()=>(j.value||[]).map(s=>{var e,u,L,k,d,w,B,I,D;const t=P((e=s==null?void 0:s.leave)==null?void 0:e.by_type);return{...s,_leaveBy:t,_cl:c(t.CL),_ml:c(t.ML),_sl:c(t.SL),_leaveTotal:c((u=s==null?void 0:s.leave)==null?void 0:u.total_days),_otReq:c((L=s==null?void 0:s.overtime)==null?void 0:L.requested_hours),_otAppr:c((k=s==null?void 0:s.overtime)==null?void 0:k.approved_hours),_otApps:c((d=s==null?void 0:s.overtime)==null?void 0:d.count),_exOff:c((w=s==null?void 0:s.exchanges)==null?void 0:w.offday),_exShift:c((B=s==null?void 0:s.exchanges)==null?void 0:B.shift),_slTotal:c((I=s==null?void 0:s.short_leave)==null?void 0:I.total),_slMinutes:c((D=s==null?void 0:s.short_leave)==null?void 0:D.minutes),_manual:c(s==null?void 0:s.manual_attendance)}})),A=N(()=>{const s=(C.value||"").toLowerCase().trim();let t=Z.value;return s&&(t=t.filter(e=>String(e.user_name||"").toLowerCase().includes(s)||String(e.employee_id||"").toLowerCase().includes(s)||String(e.designation||"").toLowerCase().includes(s))),U.value&&(t=t.filter(e=>{const u={_cl:e._cl,_ml:e._ml,_sl:e._sl,_leaveTotal:e._leaveTotal,_otReq:e._otReq,_otAppr:e._otAppr,_otApps:e._otApps,_exOff:e._exOff,_exShift:e._exShift,_slTotal:e._slTotal,_slMinutes:e._slMinutes,_manual:e._manual};return!W(u)})),t}),m=N(()=>{const s={cl:0,ml:0,sl:0,leaveTotal:0,otReq:0,otAppr:0,otApps:0,exOff:0,exShift:0,slTotal:0,slMinutes:0,manual:0};for(const t of A.value)s.cl+=t._cl,s.ml+=t._ml,s.sl+=t._sl,s.leaveTotal+=t._leaveTotal,s.otReq+=t._otReq,s.otAppr+=t._otAppr,s.otApps+=t._otApps,s.exOff+=t._exOff,s.exShift+=t._exShift,s.slTotal+=t._slTotal,s.slMinutes+=t._slMinutes,s.manual+=t._manual;return s}),M=s=>s==="ot"?a.value.ot?3:0:s==="leave"?a.value.leave?4:0:s==="ex"?a.value.ex?2:0:s==="sl"?a.value.sl?2:0:s==="manual"&&a.value.manual?1:0,V=async()=>{var s,t;S.value=!0,T.value=null;try{const e=await J.getMonthlyApplicationSummary({month:y.value,companyId:p.value.company_id||null,departmentId:!p.value.department_id||p.value.department_id==="all"?null:p.value.department_id,includeEmpty:!0}),u=Array.isArray(e==null?void 0:e.results)?e.results:Array.isArray(e==null?void 0:e.data)?e.data:Array.isArray(e)?e:[];j.value=u,R.value=(e==null?void 0:e.month)||y.value}catch(e){console.error(e),T.value=((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Failed to load monthly application summary."}finally{S.value=!1}};X(V),E(y,s=>{$.replace({query:{...g.query,date:s}}),V()}),E(()=>[p.value.company_id,p.value.department_id,p.value.line_type],()=>{$.replace({query:{...g.query,company_id:p.value.company_id||"",department_id:p.value.department_id||"all",line_type:p.value.line_type||"all"}}),V()});const K=()=>{const s=["#","Employee",...a.value.ot?["OT Req(h)","OT Appr(h)","OT Apps"]:[],...a.value.leave?["CL","ML","SL","Leave Total"]:[],...a.value.ex?["Offday Exch","Shift Exch"]:[],...a.value.sl?["SL Total","SL Minutes"]:[],...a.value.manual?["Manual"]:[]],t=A.value.map((d,w)=>[w+1,`${d.user_name}${d.employee_id?` (#${d.employee_id})`:""}`,...a.value.ot?[d._otReq,d._otAppr,d._otApps]:[],...a.value.leave?[d._cl,d._ml,d._sl,d._leaveTotal]:[],...a.value.ex?[d._exOff,d._exShift]:[],...a.value.sl?[d._slTotal,d._slMinutes]:[],...a.value.manual?[d._manual]:[]]),e=[s,...t].map(d=>d.map(w=>`"${String(w).replace(/"/g,'""')}"`).join(",")).join(`
`),u=new Blob([e],{type:"text/csv;charset=utf-8;"}),L=URL.createObjectURL(u),k=document.createElement("a");k.href=L,k.download=`monthly-application-${R.value||y.value}.csv`,k.click(),URL.revokeObjectURL(L)},Y=()=>window.print();return(s,t)=>(o(),n("div",it,[l("div",rt,[l("div",dt,[t[13]||(t[13]=l("h1",{class:"text-base font-semibold text-slate-800 leading-tight"},"Monthly Application Summary",-1)),l("p",pt,[t[12]||(t[12]=f("Month: ")),l("b",null,i(R.value||y.value),1)])]),t[20]||(t[20]=l("div",{class:"flex-1"},null,-1)),l("div",ut,[t[19]||(t[19]=l("span",{class:"px-2 py-0.5 text-[11px] text-slate-500"},"Cols:",-1)),l("label",ct,[h(l("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>a.value.ot=e)},null,512),[[b,a.value.ot]]),t[14]||(t[14]=f(" OT"))]),l("label",vt,[h(l("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>a.value.leave=e)},null,512),[[b,a.value.leave]]),t[15]||(t[15]=f(" Leave"))]),l("label",_t,[h(l("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>a.value.ex=e)},null,512),[[b,a.value.ex]]),t[16]||(t[16]=f(" Exch"))]),l("label",mt,[h(l("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>a.value.sl=e)},null,512),[[b,a.value.sl]]),t[17]||(t[17]=f(" Short"))]),l("label",xt,[h(l("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>a.value.manual=e)},null,512),[[b,a.value.manual]]),t[18]||(t[18]=f(" Manual"))])]),l("button",{class:"btn-secondary",onClick:K},"Export CSV"),l("button",{class:"btn-secondary",onClick:Y},"Print")]),l("div",ht,[et(at,{company_id:p.value.company_id,"onUpdate:company_id":t[5]||(t[5]=e=>p.value.company_id=e),department_id:p.value.department_id,"onUpdate:department_id":t[6]||(t[6]=e=>p.value.department_id=e),line_type:p.value.line_type,"onUpdate:line_type":t[7]||(t[7]=e=>p.value.line_type=e),"with-type":!0,"initial-value":s.$route.query},null,8,["company_id","department_id","line_type","initial-value"]),l("div",null,[t[21]||(t[21]=l("label",{class:"block text-[11px] text-gray-500 mb-0.5"},"Month",-1)),h(l("input",{type:"month","onUpdate:modelValue":t[8]||(t[8]=e=>y.value=e),class:"input-1 py-1 h-8"},null,512),[[F,y.value]])]),l("div",yt,[l("div",ft,[h(l("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>C.value=e),type:"search",placeholder:"Search employee / ID / designation",class:"input-1 w-64 pl-8 h-8"},null,512),[[F,C.value]]),t[22]||(t[22]=l("span",{class:"absolute left-2 top-1.5 text-slate-400 select-none"},"ðŸ”Ž",-1))]),l("label",bt,[h(l("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>O.value=e)},null,512),[[b,O.value]]),t[23]||(t[23]=f(" Compact "))]),l("label",gt,[h(l("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>U.value=e)},null,512),[[b,U.value]]),t[24]||(t[24]=f(" Zero-only "))])])]),S.value?(o(),tt(ot,{key:0})):r("",!0),T.value?(o(),n("div",kt,i(T.value),1)):r("",!0),S.value?r("",!0):(o(),n("div",{key:2,class:v(["table-wrap group bg-white border rounded-xl shadow-sm overflow-auto print:overflow-visible",O.value?"max-h-[68vh]":"max-h-[74vh]"])},[l("table",wt,[l("colgroup",null,[t[25]||(t[25]=l("col",{style:{width:"34px"}},null,-1)),t[26]||(t[26]=l("col",{style:{width:"220px"}},null,-1)),a.value.ot?(o(),n("col",St)):r("",!0),a.value.leave?(o(),n("col",At)):r("",!0),a.value.ex?(o(),n("col",Mt)):r("",!0),a.value.sl?(o(),n("col",Lt)):r("",!0),a.value.manual?(o(),n("col",Tt)):r("",!0)]),l("thead",Ot,[l("tr",qt,[t[27]||(t[27]=l("th",{rowspan:"2",class:"text-left sticky left-0 z-30 bg-white/95"},"#",-1)),t[28]||(t[28]=l("th",{rowspan:"2",class:"text-left sticky left-[34px] z-30 bg-white/95"},"Employee",-1)),a.value.ot?(o(),n("th",{key:0,colspan:M("ot"),class:"th-group th-ot"},"Overtime",8,Rt)):r("",!0),a.value.leave?(o(),n("th",{key:1,colspan:M("leave"),class:"th-group th-leave"},"Leave Day",8,Ct)):r("",!0),a.value.ex?(o(),n("th",{key:2,colspan:M("ex"),class:"th-group th-ex"},"Shift Exchange",8,Ut)):r("",!0),a.value.sl?(o(),n("th",{key:3,colspan:M("sl"),class:"th-group th-sl"},"Short Leave",8,Vt)):r("",!0),a.value.manual?(o(),n("th",{key:4,colspan:M("manual"),class:"th-group th-manual"},"Manual",8,Et)):r("",!0)]),l("tr",Nt,[a.value.ot?(o(),n(_,{key:0},[t[29]||(t[29]=l("th",{class:"th-col th-ot",title:"Requested Hours"},"Req",-1)),t[30]||(t[30]=l("th",{class:"th-col th-ot",title:"Approved Hours"},"Appr",-1)),t[31]||(t[31]=l("th",{class:"th-col th-ot",title:"Applications Count"},"Apps",-1))],64)):r("",!0),a.value.leave?(o(),n(_,{key:1},[t[32]||(t[32]=l("th",{class:"th-col th-leave",title:"Casual Leave"},"CL",-1)),t[33]||(t[33]=l("th",{class:"th-col th-leave",title:"Medical Leave"},"ML",-1)),t[34]||(t[34]=l("th",{class:"th-col th-leave",title:"Sick Leave"},"SL",-1)),t[35]||(t[35]=l("th",{class:"th-col th-leave",title:"Total Leave Days"},"Total",-1))],64)):r("",!0),a.value.ex?(o(),n(_,{key:2},[t[36]||(t[36]=l("th",{class:"th-col th-ex",title:"Offday Exchange"},"Offday",-1)),t[37]||(t[37]=l("th",{class:"th-col th-ex",title:"Shift Exchange"},"Shift",-1))],64)):r("",!0),a.value.sl?(o(),n(_,{key:3},[t[38]||(t[38]=l("th",{class:"th-col th-sl",title:"Short Leave Applications"},"Total",-1)),t[39]||(t[39]=l("th",{class:"th-col th-sl",title:"Short Leave Minutes"},"Minutes",-1))],64)):r("",!0),a.value.manual?(o(),n("th",$t,"Count")):r("",!0)])]),l("tbody",jt,[(o(!0),n(_,null,lt(A.value,(e,u)=>(o(),n("tr",{key:e.user_id||u,class:v(["hover:bg-slate-50/80",O.value?"h-9":"h-11"])},[l("td",zt,i(u+1),1),l("td",Bt,[l("div",It,[l("span",Dt,i(e.user_name),1),e.employee_id?(o(),n("span",Ft,"#"+i(e.employee_id),1)):r("",!0)]),e.designation?(o(),n("div",Ht,i(e.designation),1)):r("",!0)]),a.value.ot?(o(),n(_,{key:0},[l("td",Jt,[l("span",{class:v(e._otReq>0?"badge":"muted"),title:z(e._otReq)},i(q(e._otReq)),11,Pt)]),l("td",Wt,[l("span",{class:v(e._otAppr>0?"badge":"muted"),title:z(e._otAppr)},i(q(e._otAppr)),11,Zt)]),l("td",Kt,[l("span",{class:v(e._otApps>0?"badge":"muted")},i(e._otApps),3)])],64)):r("",!0),a.value.leave?(o(),n(_,{key:1},[l("td",Yt,[l("span",{class:v(e._cl>0?"badge-soft-emerald":"muted")},i(e._cl),3)]),l("td",Gt,[l("span",{class:v(e._ml>0?"badge-soft-emerald":"muted")},i(e._ml),3)]),l("td",Qt,[l("span",{class:v(e._sl>0?"badge-soft-emerald":"muted")},i(e._sl),3)]),l("td",Xt,[l("span",{class:v(e._leaveTotal>0?"badge-strong":"muted")},i(e._leaveTotal),3)])],64)):r("",!0),a.value.ex?(o(),n(_,{key:2},[l("td",te,[l("span",{class:v(e._exOff>0?"badge-soft-indigo":"muted")},i(e._exOff),3)]),l("td",ee,[l("span",{class:v(e._exShift>0?"badge-soft-indigo":"muted")},i(e._exShift),3)])],64)):r("",!0),a.value.sl?(o(),n(_,{key:3},[l("td",le,[l("span",{class:v(e._slTotal>0?"badge-soft-amber":"muted")},i(e._slTotal),3)]),l("td",se,[l("span",{class:v(e._slMinutes>0?"badge-soft-amber":"muted")},i(e._slMinutes),3)])],64)):r("",!0),a.value.manual?(o(),n("td",ae,[l("span",{class:v(e._manual>0?"badge-soft-slate":"muted")},i(e._manual),3)])):r("",!0)],2))),128)),l("tr",oe,[t[40]||(t[40]=l("td",null,null,-1)),l("td",ne,"Totals ("+i(A.value.length)+" emp)",1),a.value.ot?(o(),n(_,{key:0},[l("td",ie,i(q(m.value.otReq)),1),l("td",re,i(q(m.value.otAppr)),1),l("td",de,i(m.value.otApps),1)],64)):r("",!0),a.value.leave?(o(),n(_,{key:1},[l("td",pe,i(m.value.cl),1),l("td",ue,i(m.value.ml),1),l("td",ce,i(m.value.sl),1),l("td",ve,i(m.value.leaveTotal),1)],64)):r("",!0),a.value.ex?(o(),n(_,{key:2},[l("td",_e,i(m.value.exOff),1),l("td",me,i(m.value.exShift),1)],64)):r("",!0),a.value.sl?(o(),n(_,{key:3},[l("td",xe,i(m.value.slTotal),1),l("td",he,i(m.value.slMinutes),1)],64)):r("",!0),a.value.manual?(o(),n("td",ye,i(m.value.manual),1)):r("",!0)])])]),t[41]||(t[41]=l("div",{class:"scroll-shadow-left"},null,-1)),t[42]||(t[42]=l("div",{class:"scroll-shadow-right"},null,-1))],2)),!S.value&&A.value.length===0?(o(),n("div",fe," No records for "+i(y.value)+". ",1)):r("",!0)]))}},Ce=nt(be,[["__scopeId","data-v-4e9374d9"]]);export{Ce as default};
