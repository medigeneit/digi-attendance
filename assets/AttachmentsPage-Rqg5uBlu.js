import{_ as K,f as Q,u as X,g as Z,D as ee,r as _,x as d,q as te,c as n,o as s,a,j as le,t as y,b as h,l as k,ae as q,v as B,d as ae,n as se,F as oe,e as ne,k as U}from"./index-D8L4kBdR.js";import{L as re}from"./LoaderView-bU7lXnfl.js";import{u as de,_ as ue}from"./LetterEditor-z4NWJXEk.js";import"./TextEditor-0mPQhnKg.js";const ce={class:"px-4 space-y-5"},ie={class:"glass-panel flex flex-col gap-3 px-5 py-4 md:flex-row md:items-center md:justify-between"},pe={class:"text-2xl font-semibold text-slate-900"},fe={class:"text-sm text-slate-500"},ve={class:"glass-panel space-y-4 px-5 py-4"},xe={class:"flex flex-wrap items-center gap-4"},_e={class:"flex items-center gap-2 text-xs font-semibold text-slate-600"},ye={class:"flex items-center gap-2 text-xs font-semibold text-slate-600"},he={key:0,class:"grid gap-3 md:grid-cols-[1fr_auto]"},be={class:"space-y-2"},ge=["disabled"],me={key:1,class:"space-y-3"},we={class:"flex justify-end"},ke=["disabled"],Le={key:1,class:"glass-panel px-5 py-4"},Ue={key:0,class:"empty-state"},Ve={key:1,class:"space-y-3"},Fe={class:"flex items-start justify-between gap-3"},Se={class:"text-sm font-semibold text-slate-800"},Ae={class:"text-[11px] uppercase tracking-wide text-slate-400"},Ce={class:"flex items-center gap-2"},Ne=["href"],De=["onClick"],Re={key:0,class:"mt-2 text-xs text-slate-600"},Me={__name:"AttachmentsPage",setup(qe){const b=Q(),j=X(),V=Z(),u=de(),{users:T,loading:I}=ee(u),f=_("file"),g=_(""),v=_(null),o=_({title:"",body_html:""}),c=_(!1),x=d(()=>Number(b.query.user_id)||b.query.user_id),r=d(()=>b.query.month_start||""),m=d(()=>Number(b.query.year)||new Date().getFullYear()),F=d(()=>{var t,p;const e=String(((t=V.user)==null?void 0:t.role)||"").toLowerCase(),l=(((p=V.user)==null?void 0:p.roles)||[]).map(w=>String(w).toLowerCase());return["admin","super_admin","developer","hr"].includes(e)||l.includes("hr")}),E=e=>(e==null?void 0:e.id)||(e==null?void 0:e.user_id),P=e=>(e==null?void 0:e.name)||(e==null?void 0:e.user)||(e==null?void 0:e.employee_name)||(e==null?void 0:e.full_name)||"Employee",$=(e,l)=>{var t;return((t=e==null?void 0:e._monthMap)==null?void 0:t[l])||null},S=d(()=>T.value.find(e=>Number(E(e))===Number(x.value))),i=d(()=>$(S.value,r.value)),A=d(()=>{var t,p,w,D,R,M;const e=((t=i.value)==null?void 0:t.attachments)||((p=i.value)==null?void 0:p.attachment_files)||((w=i.value)==null?void 0:w.files)||[],l=((D=i.value)==null?void 0:D.letters)||((R=i.value)==null?void 0:R.text_letters)||((M=i.value)==null?void 0:M.letter_attachments)||[];return[...e.map(L=>({...L,_type:"file"})),...l.map(L=>({...L,_type:"letter"}))]}),C=e=>(e==null?void 0:e.title)||(e==null?void 0:e.name)||(e==null?void 0:e.file_name)||(e==null?void 0:e.original_name)||(e==null?void 0:e.filename)||"Attachment",N=e=>(e==null?void 0:e.url)||(e==null?void 0:e.file_url)||(e==null?void 0:e.download_url)||(e==null?void 0:e.path)||"",H=e=>String(e||"").replace(/<[^>]*>/g,"").trim(),O=e=>{var l;v.value=((l=e.target.files)==null?void 0:l[0])||null},W=async()=>{r.value&&(u.setFilters({year:m.value}),await u.refreshMonth(r.value))},Y=async()=>{if(!(!v.value||!x.value||!r.value)){c.value=!0;try{await u.uploadAttachment({file:v.value,title:g.value,user_id:x.value,month_start:r.value,year:m.value}),g.value="",v.value=null}catch(e){console.error("Failed to upload attachment:",e)}finally{c.value=!1}}},z=async()=>{if(!(!o.value.title||!o.value.body_html)){c.value=!0;try{await u.createLetter({title:o.value.title,body_html:o.value.body_html,user_id:x.value,month_start:r.value,year:m.value}),o.value={title:"",body_html:""}}catch(e){console.error("Failed to save letter:",e)}finally{c.value=!1}}},G=async e=>{F.value&&confirm("Delete this attachment?")&&await u.deleteAttachment(e.id,{month_start:r.value})},J=()=>j.push({name:"DisciplineReport"});return te([x,r,m],W,{immediate:!0}),(e,l)=>(s(),n("div",ce,[a("div",ie,[a("div",null,[l[5]||(l[5]=a("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400"}," Attachments ",-1)),a("h1",pe,y(P(S.value)),1),a("p",fe,y(r.value||"Month not selected"),1)]),a("button",{type:"button",class:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-4 py-2 text-xs font-semibold text-slate-600 hover:text-slate-800",onClick:J},l[6]||(l[6]=[a("i",{class:"far fa-arrow-left"},null,-1),h(" Back to Report ")]))]),a("div",ve,[a("div",xe,[a("label",_e,[k(a("input",{type:"radio",value:"file","onUpdate:modelValue":l[0]||(l[0]=t=>f.value=t)},null,512),[[q,f.value]]),l[7]||(l[7]=h(" File Upload "))]),a("label",ye,[k(a("input",{type:"radio",value:"letter","onUpdate:modelValue":l[1]||(l[1]=t=>f.value=t)},null,512),[[q,f.value]]),l[8]||(l[8]=h(" Write Letter "))])]),f.value==="file"?(s(),n("div",he,[a("div",be,[k(a("input",{"onUpdate:modelValue":l[2]||(l[2]=t=>g.value=t),type:"text",placeholder:"Attachment title (optional)",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[B,g.value]]),a("input",{type:"file",class:"w-full rounded-lg border border-dashed border-slate-300 px-3 py-2 text-sm",onChange:O},null,32)]),a("button",{type:"button",class:"h-10 rounded-full bg-slate-900 px-4 text-xs font-semibold text-white",disabled:c.value||!v.value,onClick:Y}," Upload ",8,ge)])):(s(),n("div",me,[k(a("input",{"onUpdate:modelValue":l[3]||(l[3]=t=>o.value.title=t),type:"text",placeholder:"Letter title",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[B,o.value.title]]),ae(ue,{modelValue:o.value.body_html,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value.body_html=t)},null,8,["modelValue"]),a("div",we,[a("button",{type:"button",class:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white",disabled:c.value||!o.value.title||!o.value.body_html,onClick:z}," Save Letter ",8,ke)])]))]),se(I)?(s(),le(re,{key:0})):(s(),n("div",Le,[A.value.length===0?(s(),n("div",Ue,l[9]||(l[9]=[a("p",{class:"text-base font-semibold text-slate-700"},"No attachments found",-1),a("p",{class:"text-sm text-slate-500"},"Upload a file or write a letter to get started.",-1)]))):(s(),n("div",Ve,[(s(!0),n(oe,null,ne(A.value,t=>(s(),n("div",{key:(t==null?void 0:t.id)||C(t),class:"rounded-xl border border-slate-100 bg-slate-50/70 p-4"},[a("div",Fe,[a("div",null,[a("p",Se,y(C(t)),1),a("p",Ae,y(t._type==="letter"?"Letter":"File"),1)]),a("div",Ce,[t._type!=="letter"&&N(t)?(s(),n("a",{key:0,href:N(t),target:"_blank",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-600 hover:text-slate-800"},l[10]||(l[10]=[a("i",{class:"far fa-arrow-up-right-from-square"},null,-1),h(" Open ")]),8,Ne)):U("",!0),F.value?(s(),n("button",{key:1,type:"button",class:"inline-flex items-center gap-1 rounded-full border border-rose-200 bg-rose-50 px-2 py-0.5 text-[10px] font-semibold text-rose-600 hover:text-rose-700",onClick:p=>G(t)},l[11]||(l[11]=[a("i",{class:"far fa-trash"},null,-1),h(" Delete ")]),8,De)):U("",!0)])]),t._type==="letter"?(s(),n("p",Re,y(H((t==null?void 0:t.body_html)||(t==null?void 0:t.body)||(t==null?void 0:t.content)).slice(0,220)),1)):U("",!0)]))),128))]))]))]))}},Ee=K(Me,[["__scopeId","data-v-a5979dd6"]]);export{Ee as default};
