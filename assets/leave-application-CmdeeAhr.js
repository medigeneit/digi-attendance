import{B as W,r as v,C as u,ad as X}from"./index-9P-p50Eq.js";const O=W("leaveApplication",()=>{const m=v([]),s=v([]),d=v(null),c=v(!1),r=v(null),A=v(new Date().toISOString().substring(0,7)),x=v(new Date().getFullYear()),w=v(null),g=v([]),I=v(""),F=v(null),E=v(null),L=v([]),$=v(null);async function S(a={}){var i,n;c.value=!0,r.value=null;try{const t=await u.get("/leave-applications",{params:a});t.data?s.value=t.data:s.value=[]}catch(t){r.value=((n=(i=t.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to fetch leave applications"}finally{c.value=!1}}const _=async(a,i)=>{var n,t;if(!a||!i){r.value="Invalid user ID or month";return}c.value=!0;try{const e=await u.get(`/user/${a}/application/monthly/${i}/log`);console.log({response:e}),m.value=e.data.applications}catch(e){r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Something went wrong",console.error(r.value)}finally{c.value=!1}},b=async(a,i)=>{var n,t;r.value=null,c.value=!0;try{if(typeof a=="object"||!i){const h=typeof a=="object"?a:{},f=h.month||i;if(!f)throw new Error("Month is required");const{companyId:G=null,departmentId:J=null,employee_id:K,line_type:Q,includeEmpty:V=!1}=h,{data:p}=await u.get("/reports/monthly-applications",{params:{month:f,company_id:G||void 0,department_id:J||void 0,employee_id:K||null,line_type:Q||"all",include_empty:V?1:0}});return L.value=Array.isArray(p==null?void 0:p.results)?p.results:[],$.value=(p==null?void 0:p.month)||f,p}const e=a,l=i;if(!e||!l)throw new Error("Invalid user ID or month");const{data:o}=await u.get(`/user/application/monthly/${encodeURIComponent(l)}/report`,{params:{user_id:e}});return m.value=(o==null?void 0:o.applications)||[],E.value=(o==null?void 0:o.user)||null,F.value=(o==null?void 0:o.month)||l,o}catch(e){return console.error(e),r.value=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong",null}finally{c.value=!1}};async function j(a={}){var i,n,t,e,l;c.value=!0,r.value=null;try{const o=await u.get("/yearly-user-leave-applications",{params:a});o.data?(s.value=(i=o==null?void 0:o.data)==null?void 0:i.leave_applications,w.value=(n=o==null?void 0:o.data)==null?void 0:n.user,g.value=(t=o==null?void 0:o.data)==null?void 0:t.leave_balances):(s.value=[],w.value=[])}catch(o){r.value=((l=(e=o.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to fetch leave applications"}finally{c.value=!1}}async function y(a={}){var i,n;c.value=!0,r.value=null;try{const t=await u.get("/my-leave-applications",{params:a});s.value=t.data}catch(t){r.value=((n=(i=t.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to fetch leave applications"}finally{c.value=!1}}async function C(a){var i,n,t,e;c.value=!0,r.value=null;try{const l=await u.post("/leave-applications/store",a);return s.value.push((i=l==null?void 0:l.data)==null?void 0:i.data),(n=l==null?void 0:l.data)==null?void 0:n.data}catch(l){throw r.value=((e=(t=l.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to store leave application",new Error(r.value)}finally{c.value=!1}}async function D(a){var i,n,t;c.value=!0,r.value=null;try{console.log(111);const e=await u.post("/admin-leave-applications/store",a);return console.log(e),(i=e==null?void 0:e.data)==null?void 0:i.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to store leave application",new Error(r.value)}finally{c.value=!1}}async function M(a){var i,n;c.value=!0,r.value=null;try{await u.delete(`/my-leave-application/destroy/${a}`),await y()}catch(t){throw r.value=((n=(i=t.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to store leave application",new Error(r.value)}finally{c.value=!1}}const B=async a=>{var i,n;try{return c.value=!0,(await u.post("cental-attachment-upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(t){r.value=((n=(i=t.response)==null?void 0:i.data)==null?void 0:n.message)||"Something went wrong"}finally{c.value=!1}};async function R(a,i){var n,t;c.value=!0,r.value=null;try{const e=await u.post(`/leave-applications/${a}/update`,i),l=s.value.findIndex(o=>o.id===a);return l!==-1&&(s.value[l]=e.data.data),e.data.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to update leave application",new Error(r.value)}finally{c.value=!1}}const U=async(a,i)=>{var n,t;c.value=!0,r.value=null;try{const e=await u.put(`/leave-attachment/${a}`,i),l=s.value.findIndex(o=>o.id===a);return l!==-1&&(s.value[l]=e.data.data),e.data.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||`Failed to update application leave (ID: ${a})`,console.error(`Error updating application leave with id ${a}:`,e),new Error(r.value)}finally{c.value=!1}};async function Y(a){var i,n,t,e;c.value=!0,r.value=null,d.value=null;try{const l=await u.get(`/leave-applications/${a}`),o=((i=l==null?void 0:l.data)==null?void 0:i.data)??(l==null?void 0:l.data);if(!o||typeof o!="object"||!(o!=null&&o.id))return r.value=(o==null?void 0:o.message)||"Leave Application not found",d.value=null,null;d.value=o;const h=X();try{await h.fetchApprovalPermissions("leave_applications",d.value.id)}catch(f){console.error("Failed to fetch approval permissions:",f)}}catch(l){const o=(n=l==null?void 0:l.response)==null?void 0:n.status;r.value=((e=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:e.message)||(o===404?"Leave Application not found":o===403?"You don't have permission to view this Leave Application":o===401?"Session expired. Please login again.":"Failed to fetch leave application"),d.value=null}finally{c.value=!1}}async function P(a){var i,n;c.value=!0,r.value=null;try{const t=await u.post(`/leave-applications/${a.id}/handover-accept`,a),e=s.value.findIndex(l=>l.id===(a==null?void 0:a.id));return e!==-1&&(s.value[e]=t.data.data),t.data.data}catch(t){throw r.value=((n=(i=t.response)==null?void 0:i.data)==null?void 0:n.message)||"Failed to accept handover",new Error(r.value)}finally{c.value=!1}}async function q(a){var i,n,t;c.value=!0,r.value=null;try{const e=await u.post(`/leave-applications/${a.id}/incharge-accept`,a),l=s.value.findIndex(o=>o.id===(a==null?void 0:a.id));return l!==-1&&(s.value[l]=e.data.data),(i=e==null?void 0:e.data)==null?void 0:i.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept in-charge approval",new Error(r.value)}finally{c.value=!1}}async function H(a){var i,n,t;c.value=!0,r.value=null;try{const e=await u.post(`/leave-applications/${a.id}/coordinator-accept`,a),l=s.value.findIndex(o=>o.id===(a==null?void 0:a.id));return l!==-1&&(s.value[l]=e.data.data),(i=e==null?void 0:e.data)==null?void 0:i.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept coordinator approval",new Error(r.value)}finally{c.value=!1}}async function N(a){var i,n,t;c.value=!0,r.value=null;try{const e=await u.post(`/leave-applications/${a.id}/operational-admin-accept`,a),l=s.value.findIndex(o=>o.id===(a==null?void 0:a.id));return l!==-1&&(s.value[l]=e.data.data),(i=e==null?void 0:e.data)==null?void 0:i.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept operational admin approval",new Error(r.value)}finally{c.value=!1}}async function T(a){var i,n,t;c.value=!0,r.value=null;try{const e=await u.post(`/leave-applications/${a.id}/recommend-by-accept`,a),l=s.value.findIndex(o=>o.id===(a==null?void 0:a.id));return l!==-1&&(s.value[l]=e.data.data),(i=e==null?void 0:e.data)==null?void 0:i.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept recommend by approval",new Error(r.value)}finally{c.value=!1}}async function k(a){var i,n,t;c.value=!0,r.value=null;try{const e=await u.post(`/leave-applications/${a==null?void 0:a.id}/approved-by-accept`,a),l=s.value.findIndex(o=>o.id===(a==null?void 0:a.id));return l!==-1&&(s.value[l]=e.data.data),(i=e==null?void 0:e.data)==null?void 0:i.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept approval by admin",new Error(r.value)}finally{c.value=!1}}async function z(a,i){var n,t;c.value=!0,r.value=null;try{const e=await u.post(`/leave-applications/${a}/reject`,i),l=s.value.findIndex(o=>o.id===a);return l!==-1&&(s.value[l]=e.data.data),e.data.data}catch(e){throw r.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to reject leave application",new Error(r.value)}finally{c.value=!1}}return{leaveApplications:s,leaveApplication:d,applicationLog:m,loading:c,error:r,selectedMonth:A,selectedYear:x,user:w,selectedStatus:I,fetchLeaveApplications:S,storeLeaveApplication:C,updateLeaveApplication:R,fetchLeaveApplicationById:Y,acceptHandover:P,acceptInCharge:q,acceptCoordinator:H,acceptOperationalAdmin:N,acceptRecommendBy:T,acceptApprovedBy:k,rejectLeaveApplication:z,fetchMyLeaveApplications:y,deleteLeaveApplication:M,fetchFileUpload:B,uploadLeaveApplicationAttachment:U,fetchYearlyUserLeaveApplications:j,getMonthlyApplicationLog:_,storeAdminLeaveApplication:D,leave_balances:g,getMonthlyApplicationSummary:b}});export{O as u};
