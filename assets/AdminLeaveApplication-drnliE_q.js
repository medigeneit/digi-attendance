import{d as oe,z as Y,r as g,m as I,a4 as Z,x as H,e as te,c as u,o as n,a as e,f as z,w as se,g as k,h as x,v as V,E as ne,t as f,F as M,n as j,k as C,a5 as W,q as B,u as re,b as de,A as ue,y as ie,i as ee,a6 as ce}from"./index-D6IyOSuI.js";import{L as ae}from"./LoaderView-CbihmVPO.js";import{_ as ve}from"./MultiselectDropdown-DRun3tzX.js";import{u as ye}from"./holiday-BPdmkQqu.js";import{u as le}from"./leave-application-BNat4lME.js";import{u as me}from"./leave-type-arMAv1WG.js";import{u as O}from"./user-CqPNJv3N.js";import{_ as pe}from"./EmployeeFilter-Bpn5aPL1.js";import{S as _e}from"./SelectedEmployeeCard-CGsr6FiJ.js";import{u as fe}from"./company-B6Y6Xppm.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DhCdI7Zc.js";import"./department-D8otYRXI.js";import"./SelectDropdown-gBLt9qrB.js";import"./UserChip-Qp-JYzPq.js";const be={class:"space-y-4 p-2 md:p-4"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe={class:"inline-flex items-center space-x-2"},he={key:0},we={class:"text-blue-600 font-medium"},ke={key:1,class:"bg-gray-100 p-2 rounded-md"},Le={class:"font-semibold"},Se={class:"flex flex-wrap gap-2"},$e=["name","value","onUpdate:modelValue"],Ae={class:"flex items-center space-x-1"},Ue=["name","onUpdate:modelValue"],De={class:"flex items-center space-x-1"},Ce=["name","onUpdate:modelValue"],Ve={key:2},qe={key:3},Te={key:4,class:"text-red-500 text-sm"},Be={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(q,{emit:F}){const a=q,h=F,U=le();me();const w=O();oe();const $=ye(),{userLeaveBalance:L}=Y(w),D=g(""),S=g(!0),r=g({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),o=g([]),v=g(!1),c=g(null),T=I(()=>{var y,t,i;return((t=(y=a==null?void 0:a.userInfo)==null?void 0:y.assign_weekend)==null?void 0:t.weekends)||((i=a==null?void 0:a.userInfo)==null?void 0:i.weekends)}),d=I(()=>{const y=r.value.last_working_date,t=r.value.resumption_date;if(!y||!t)return[];const i=new Date(y),m=new Date(t);if(m<=i)return[];const _=[];let p=new Date(i);for(p.setDate(p.getDate()+1);p<m;){const A=p.getFullYear(),b=(p.getMonth()+1).toString().padStart(2,"0"),l=p.getDate().toString().padStart(2,"0");_.push(`${A}-${b}-${l}`),p.setDate(p.getDate()+1)}return _}),R=I(()=>{if(!r.value.last_working_date||!r.value.resumption_date)return"";const y=new Date(r.value.last_working_date);return new Date(r.value.resumption_date)<=y?"Resumption date must be after Last Working Date.":d.value.length===0?"No leave days between the selected dates.":`Total leave days: ${d.value.length}`});Z(async()=>{var y;d.value.length&&L.value.length&&(o.value.length!==d.value.length&&(o.value=d.value.map(()=>L.value[0].id)),await $.fetchHolidays({company_id:(y=a==null?void 0:a.userInfo)==null?void 0:y.company_id,start_date:d.value[0],end_date:d.value[d.value.length-1]}),d.value.forEach(async(t,i)=>{const m=new Date(t).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),_=m.charAt(0).toUpperCase()+m.slice(1);T.value.includes(_)&&(o.value[i]="weekend"),$.holidayDates.includes(t)&&(o.value[i]="holiday")}))}),H(()=>D.value,y=>{r.value.handover_user_id=y==null?void 0:y.id});const N=async()=>{var y;v.value=!0,c.value=null;try{const t=d.value.map((p,A)=>({date:p,leave_type_id:o.value[A]!=="weekend"&&o.value[A]!=="holiday"?o.value[A]:null})).filter(p=>p.leave_type_id!==null),i=d.value.map((p,A)=>({date:p,leave_type_id:o.value[A]||""})).filter(p=>p.leave_type_id!==null),m={user_id:(y=a==null?void 0:a.userInfo)==null?void 0:y.id,last_working_date:r.value.last_working_date,resumption_date:r.value.resumption_date,reason:r.value.reason,works_in_hand:r.value.works_in_hand,handover_user_id:S.value?null:r.value.handover_user_id,leave_days:t,json_data:i,is_direct_approve:S.value};await U.storeAdminLeaveApplication(m)&&h("formSuccessClosed")}catch(t){c.value=t.message||"Failed to submit leave application"}finally{v.value=!1}};return te(async()=>{Z(()=>{var t;const y=(t=a==null?void 0:a.userInfo)==null?void 0:t.id;y&&w.fetchUserLeaveBalances(y)}),await w.fetchTypeWiseEmployees({except:"auth"})}),(y,t)=>(n(),u("div",be,[t[16]||(t[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),v.value?(n(),z(ae,{key:0})):(n(),u("form",{key:1,onSubmit:se(N,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",ge,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=i=>r.value.last_working_date=i),class:"input-1 w-full",required:""},null,512),[[V,r.value.last_working_date]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=i=>r.value.resumption_date=i),class:"input-1 w-full",required:""},null,512),[[V,r.value.resumption_date]])])]),e("div",null,[e("label",xe,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=i=>S.value=i),class:"form-checkbox text-blue-600"},null,512),[[ne,S.value]]),t[8]||(t[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),r.value.last_working_date&&r.value.resumption_date?(n(),u("div",he,[e("p",we,f(R.value),1)])):k("",!0),d.value.length?(n(),u("div",ke,[t[11]||(t[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),e("div",null,[(n(!0),u(M,null,j(d.value,(i,m)=>(n(),u("div",{key:m,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[e("div",Le,f(i),1),e("div",Se,[(n(!0),u(M,null,j(C(L),_=>(n(),u("label",{key:_.id,class:"flex items-center space-x-1"},[x(e("input",{type:"radio",name:"leaveType-"+m,value:_.id,"onUpdate:modelValue":p=>o.value[m]=p},null,8,$e),[[W,o.value[m]]]),e("span",null,f(_.leave_type),1)]))),128)),e("label",Ae,[x(e("input",{type:"radio",name:"leaveType-"+m,value:"weekend","onUpdate:modelValue":_=>o.value[m]=_},null,8,Ue),[[W,o.value[m]]]),t[9]||(t[9]=e("span",null,"Weekend",-1))]),e("label",De,[x(e("input",{type:"radio",name:"leaveType-"+m,value:"holiday","onUpdate:modelValue":_=>o.value[m]=_},null,8,Ce),[[W,o.value[m]]]),t[10]||(t[10]=e("span",null,"Holiday",-1))])])]))),128))])])):k("",!0),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),x(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=i=>r.value.reason=i),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[V,r.value.reason]])]),S.value?k("",!0):(n(),u("div",Ve,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),B(ve,{modelValue:D.value,"onUpdate:modelValue":t[4]||(t[4]=i=>D.value=i),options:C(w).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),S.value?k("",!0):(n(),u("div",qe,[t[14]||(t[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),x(e("textarea",{id:"works-in-hand","onUpdate:modelValue":t[5]||(t[5]=i=>r.value.works_in_hand=i),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[V,r.value.works_in_hand]])])),c.value?(n(),u("div",Te,f(c.value),1)):k("",!0),t[15]||(t[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Me={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},Fe={class:"bg-white rounded-lg shadow-lg w-full max-w-3xl"},je={class:"px-6 py-4 border-b"},Re={class:"text-lg font-bold"},Ee={class:"table-auto w-full border"},Ie={class:"p-2"},He=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],We={class:"p-2"},Ye=["onUpdate:modelValue"],ze={class:"p-2"},Oe=["onUpdate:modelValue"],Pe={__name:"UserLeaveBalanceModal",props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0}},emits:["close"],setup(q,{emit:F}){const a=q,h=F,U=fe(),w=O(),$=g([]),L=g(!1);H(()=>a.show,async o=>{var v;o&&((v=a.user)!=null&&v.id)&&!L.value&&(await D(),L.value=!0)}),H(()=>{var o;return(o=a.user)==null?void 0:o.id},()=>{L.value=!1,$.value=[]});const D=async()=>{try{const o=await w.fetchUserLeaveTypes(a.user.id);if(o!=null&&o.length)$.value=o;else{const v=await U.fetchCompanyLeaveTypes(a.user.company_id);$.value=v.data.map(c=>({id:c.id,name:c.name,annual_quota:c.annual_quota||0,max_consecutive_days:c.max_consecutive_days||null,type:c.type||"Paid"}))}}catch(o){console.error("Failed to load leave balances or fallback types:",o)}},S=async()=>{try{await w.saveLeaveBalances(a.user.id,$.value),h("close")}catch(o){console.error("Failed to save leave balances:",o)}},r=()=>{h("close")};return(o,v)=>q.show&&q.user?(n(),u("div",Me,[e("div",Fe,[e("div",je,[e("h3",Re,"Set Leave Balances for "+f(q.user.name),1)]),e("form",{onSubmit:se(S,["prevent"]),class:"p-6 space-y-4"},[e("table",Ee,[v[0]||(v[0]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"p-2"},"Leave Type"),e("th",{class:"p-2"},"Annual Quota"),e("th",{class:"p-2"},"Max Consecutive Days")])],-1)),e("tbody",null,[(n(!0),u(M,null,j($.value,(c,T)=>(n(),u("tr",{key:T},[e("td",Ie,[x(e("input",{type:"hidden","onUpdate:modelValue":d=>c.id=d,class:"input-1 w-full"},null,8,He),[[V,c.id]]),x(e("input",{"onUpdate:modelValue":d=>c.name=d,class:"input-1 w-full",disabled:""},null,8,Ne),[[V,c.name]])]),e("td",We,[x(e("input",{"onUpdate:modelValue":d=>c.annual_quota=d,type:"number",min:"0",class:"input-1 w-full"},null,8,Ye),[[V,c.annual_quota,void 0,{number:!0}]])]),e("td",ze,[x(e("input",{"onUpdate:modelValue":d=>c.max_consecutive_days=d,type:"number",min:"0",class:"input-1 w-full"},null,8,Oe),[[V,c.max_consecutive_days,void 0,{number:!0}]])])]))),128))])]),e("div",{class:"flex justify-end gap-2 pt-4 border-t"},[e("button",{type:"button",onClick:r,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancel "),v[1]||(v[1]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," Save ",-1))])],32)])])):k("",!0)}},Je={class:"space-y-2 px-4"},Qe={class:"flex flex-wrap gap-2"},Ge=["value"],Ke={key:0,class:"text-center py-4"},Xe={key:1,class:"space-y-4"},Ze={key:0,class:"bg-sky-100/30 p-4 rounded-lg shadow mb-6 space-y-6"},et={class:"grid md:grid-cols-2 gap-6"},tt={class:"bg-white border rounded-lg p-4 shadow"},st={class:"overflow-x-auto"},at={class:"min-w-full text-sm text-left text-gray-700 border"},lt={class:"px-4 py-1 text-center font-medium"},ot={class:"px-4 py-1 text-center"},nt={class:"px-4 py-1 text-center"},rt={class:"px-4 py-1 text-center"},dt={class:"overflow-x-auto"},ut={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},it={class:"border border-gray-300 px-2 py-2"},ct={class:"border border-gray-300 px-2 py-2 text-center"},vt={class:"border border-gray-300 px-2 py-2 text-center"},yt={class:"border border-gray-300 px-2 py-2"},mt={class:"border border-gray-300 px-2 py-2"},pt=["innerHTML"],_t={class:"border border-gray-300 px-2 py-2 text-center"},ft={class:"border border-gray-300 px-2 py-2"},bt={class:"border border-gray-300 px-2"},gt={class:"flex justify-center gap-2"},xt=["onClick"],ht={key:0},wt={key:0},kt={class:"text-center py-2",colspan:"6"},Lt={key:0,class:"fixed inset-0 z-[1000] bg-black bg-opacity-50 flex items-center justify-center"},St={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},Ht={__name:"AdminLeaveApplication",setup(q){const F=re(),a=de(),h=le(),U=O(),{user:w,leave_balances:$,leaveApplications:L,loading:D}=Y(h),{userLeaveBalance:S}=Y(U),r=g(a.query.year||h.selectedYear),o=g(a.query.search||""),v=g({company_id:a.query.company_id||"",department_id:a.query.department_id||"all",type:a.query.type||"all",employee_id:a.query.employee_id||""}),c=g(!1),T=g(!1),d=async()=>{const b={selectedYear:r.value,selectedStatus:h.selectedStatus,query:o.value};v.value.employee_id?(b.user_id=v.value.employee_id,D.value=!0,await h.fetchYearlyUserLeaveApplications(b),D.value=!1):L.value=[]};te(async()=>{await d(),a.query.employee_id&&await U.fetchUserLeaveBalances(a.query.employee_id)}),H(()=>a.query.employee_id,async b=>{b&&await U.fetchUserLeaveBalances(b)});const R=I(()=>L.value||[]),N=()=>F.go(-1),y=async()=>{F.replace({query:{...a.query,company_id:v.value.company_id,department_id:v.value.department_id,type:v.value.type,employee_id:v.value.employee_id}}),await d()},t=()=>{T.value=!0},i=async()=>{console.log("test close"),c.value=!1,await d()},m=new Date().getFullYear(),_=g([]);for(let b=2023;b<=m;b++)_.value.push(b);const p=async b=>{confirm("Are you sure to delete this application?")&&(await h.deleteLeaveApplication(b),await d())},A=()=>{T.value=!1,U.fetchUserLeaveBalances(a.query.employee_id)};return(b,l)=>{var J,Q;const P=ue("RouterLink");return n(),u(M,null,[e("div",Je,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:N},l[5]||(l[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),l[6]||(l[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),l[7]||(l[7]=e("div",null,null,-1))]),e("div",Qe,[B(pe,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=s=>v.value=s),"initial-value":C(a).query,onFilterChange:y},null,8,["modelValue","initial-value"]),e("div",null,[x(e("select",{"onUpdate:modelValue":l[1]||(l[1]=s=>r.value=s),onChange:d,class:"input-1"},[(n(!0),u(M,null,j(_.value,s=>(n(),u("option",{key:s,value:s},f(s),9,Ge))),128))],544),[[ie,r.value]])])]),C(h).loading?(n(),u("div",Ke,[B(ae)])):(n(),u("div",Xe,[(J=v.value)!=null&&J.employee_id?(n(),u("div",Ze,[l[10]||(l[10]=e("h2",{class:"text-xl font-bold text-gray-800 text-center"},"Employee Overview",-1)),e("div",et,[B(_e,{user:C(w)},null,8,["user"]),e("div",tt,[e("div",{class:"flex justify-between items-center"},[l[8]||(l[8]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Leave Balance",-1)),e("button",{onClick:t,type:"button",class:"btn-2"},"Set Leave Balance")]),e("div",st,[e("table",at,[l[9]||(l[9]=e("thead",{class:"bg-gray-100 text-xs uppercase"},[e("tr",null,[e("th",{class:"px-4 py-2 text-center"},"Type"),e("th",{class:"px-4 py-2 text-center"},"Total"),e("th",{class:"px-4 py-2 text-center"},"Used"),e("th",{class:"px-4 py-2 text-center"},"Remaining")])],-1)),e("tbody",null,[(n(!0),u(M,null,j(C(S),s=>(n(),u("tr",{key:s.id,class:"border-t hover:bg-gray-50"},[e("td",lt,f(s.leave_type),1),e("td",ot,f(s.annual_quota),1),e("td",nt,f(s.used_days),1),e("td",rt,f(s.remaining_days),1)]))),128))])])])])])])):k("",!0),e("div",dt,[e("table",ut,[l[15]||(l[15]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Type"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")])],-1)),e("tbody",null,[(n(!0),u(M,null,j(R.value,(s,G)=>{var K;return n(),u("tr",{key:G,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",it,f(G+1),1),e("td",ct,f(s==null?void 0:s.last_working_date),1),e("td",vt,f(s==null?void 0:s.resumption_date),1),e("td",yt,f(s==null?void 0:s.leave_period),1),e("td",mt,[e("div",{innerHTML:(s==null?void 0:s.duration)||(s==null?void 0:s.total_leave_days)},null,8,pt)]),e("td",_t,f([...new Set((K=s==null?void 0:s.leave_days)==null?void 0:K.map(E=>{var X;return(X=E==null?void 0:E.leave_type)==null?void 0:X.name}))].join(",")),1),e("td",ft,f((s==null?void 0:s.status)||"N/A"),1),e("td",bt,[e("div",gt,[B(P,{to:{name:"LeaveApplicationShow",params:{id:s==null?void 0:s.id}},class:"btn-icon",target:"_blank"},{default:ee(()=>l[11]||(l[11]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[11]},1032,["to"]),["Approved","Rejected"].includes(s==null?void 0:s.status)?k("",!0):(n(),z(P,{key:0,to:{name:"LeaveApplicationEdit",params:{id:s==null?void 0:s.id}},class:"btn-icon",target:"_blank"},{default:ee(()=>l[12]||(l[12]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[12]},1032,["to"])),e("button",{onClick:E=>p(s==null?void 0:s.id),class:"btn-icon text-red-500"},l[13]||(l[13]=[e("i",{class:"far fa-trash"},null,-1)]),8,xt)])])])}),128)),R.value.length?k("",!0):(n(),u("tr",ht,l[14]||(l[14]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(Q=v.value)!=null&&Q.employee_id?(n(),u("tr",wt,[e("th",kt,[e("button",{onClick:l[2]||(l[2]=s=>c.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):k("",!0)])])])]))]),B(Pe,{show:T.value,user:C(w),onClose:A},null,8,["show","user"]),(n(),z(ce,{to:"body"},[c.value?(n(),u("div",Lt,[e("div",St,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:l[3]||(l[3]=s=>c.value=!1)}," × "),B(Be,{userInfo:C(w),onClose:l[4]||(l[4]=s=>c.value=!1),onFormSuccessClosed:i},null,8,["userInfo"])])])):k("",!0)]))],64)}}};export{Ht as default};
