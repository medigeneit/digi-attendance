import{x as U,r as tt,p as gt,c as i,o as a,j as $,k as c,a as e,m as T,b as h,t as C,w as L,g as bt,G as Y,F as V,e as Z,s as Q,d as y,f as At,u as Mt,h as Rt,q as ft,n,R as I,K as jt,N as Ut}from"./index-UQNVsj_8.js";import{L as kt}from"./LoaderView-BiJw4jAw.js";import{O as K}from"./OverlyModal-BDH8P-5g.js";import{_ as yt}from"./DepartmentChip-DaEa3c8-.js";import{_ as vt}from"./DescriptionView-CSOlKW2c.js";import{_ as _t,a as Lt}from"./TaskAssignedUsers-CwJKn_w2.js";import{u as Nt}from"./task-CsjtRPD0.js";import{_ as ht,a as Ot,b as Pt}from"./TaskStatusManager-Bbj_TBQE.js";import{_ as Bt}from"./TodoItemCard-Cr2qtVCs.js";import{b as J,d as Vt}from"./datetime-Du_mcDA9.js";import{s as xt}from"./dom-Bic1TNqD.js";import{u as qt}from"./useTaskStore-iTEbapxG.js";import{u as Gt}from"./useTodoDateStore-Z3fkDnFS.js";import{_ as zt}from"./TodoCreateEditShow-BOwb8cCA.js";import"./UserChip-CvCDxZtH.js";import"./user-CnbcIVyr.js";import"./url-CePbr-gY.js";import"./requirement-D73GKDpw.js";import"./useTodoStore-Dg1wf2fX.js";import"./TaskSelectionInput-CCoMFXYX.js";import"./TaskTitle-DgBHqYB2.js";const Ft={class:"my-6"},Ht={class:"text-center font-semibold text-blue-800 mb-4"},Wt={class:"text-red-600 text-center mt-2 text-sm"},Kt={class:"flex justify-between mt-3"},Jt={__name:"TaskClosingForm",props:{loading:{type:Boolean,default:!1},task:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(G,{emit:s}){const d=G,S=s,f=U({get:()=>d.loading,set:()=>S("update:loading")}),v=tt("");async function D(){var _,r;f.value=!0;try{await Nt(d.task.id,{status:"CLOSED"}),S("updateStatus")}catch(N){v.value=(r=(_=N.response)==null?void 0:_.data)==null?void 0:r.message,S("error")}finally{f.value=!1}}return(_,r)=>{var E;const N=gt("LoaderView");return a(),i("form",{class:"p-4 rounded relative border",onSubmit:L(D,["prevent"])},[f.value?(a(),$(N,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:T(()=>r[1]||(r[1]=[h(" Submitting! ")])),_:1,__:[1]})):c("",!0),r[5]||(r[5]=e("h3",{class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},"Task Closing",-1)),e("div",Ft,[e("div",Ht,C((E=G.task)==null?void 0:E.title),1),r[2]||(r[2]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),r[3]||(r[3]=e("div",{class:"text-center my-1"},[h(" Want to "),e("span",{class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},[e("i",{class:"text-sm fas fa-lock text-blue-600"}),h("Close")]),h(" the task? ")],-1))]),r[6]||(r[6]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",Wt,C(v.value),1),e("div",Kt,[e("button",{class:"btn-3",onClick:r[0]||(r[0]=L(A=>S("clickCancel"),["prevent"]))},"Cancel"),r[4]||(r[4]=e("button",{class:"btn-2"},[e("i",{class:"text-xl text-white fas fa-lock"}),h(" Close")],-1))])])],32)}}},Qt={class:"border-gray-300"},Xt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Yt={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Zt={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},It={key:0,class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-2 justify-between"},te={key:0},ee=["disabled"],se=["disabled"],ae={class:"text-base font-semibold text-gray-700"},oe={__name:"TaskTimeline",props:{task:{type:Object}},emits:["update","error"],setup(G,{emit:s}){const d=G,S=s,f=bt(),v=Y({user:null,type:""});function D(x){v.user=f.user,v.type=x}const _={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},r=U(()=>(_==null?void 0:_[E.value])||0),N=U(()=>{var x;return{"bg-yellow-50":E.value==="IN_PROGRESS","bg-green-50":E.value==="COMPLETED","bg-red-50":E.value==="PENDING","bg-blue-50":(x=d.task)==null?void 0:x.closed_at}}),E=U(()=>{var x;return(x=d.task)==null?void 0:x.status});async function A(){S("update"),v.user=null,v.type=""}const w=U(()=>{var x,g,O,k,P,p,R,X;return[{date:J((x=d.task)==null?void 0:x.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((g=d.task)!=null&&g.assigned_at)},{date:J((O=d.task)==null?void 0:O.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((k=d.task)!=null&&k.started_at)||r.value>=_.IN_PROGRESS},{date:J((P=d.task)==null?void 0:P.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((p=d.task)!=null&&p.completed_at)||r.value>=_.COMPLETED},{date:J((R=d.task)==null?void 0:R.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((X=d.task)!=null&&X.deadline)}].sort((q,B)=>q.date===null||B.date===null||new Date(q.date)==new Date(B.date)?q.serial-B.serial:new Date(q.date)-new Date(B.date))});return(x,g)=>{var O;return a(),i("div",{class:Q(["border py-8 px-4 rounded",N.value])},[e("div",Qt,[(O=d.task)!=null&&O.is_target?(a(),i("div",Xt,g[3]||(g[3]=[e("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),h(" TARGET TASK ")]))):c("",!0),e("ol",Yt,[(a(!0),i(V,null,Z(w.value,(k,P)=>{var p,R;return a(),i("li",{class:"ml-5",key:P},[e("div",Zt,[k.active?(a(),i("i",{key:0,class:Q([k.icon,"text-xs"])},null,2)):c("",!0)]),e("div",{class:Q({"opacity-30":!k.active})},[k.active?(a(),i("div",It,[k.date?(a(),i("span",te,C(k.date),1)):c("",!0),((p=d.task)==null?void 0:p.children_task_count)===0&&k.status==="started"&&k.active?(a(),i("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:g[0]||(g[0]=L(()=>D("start-date"),["prevent"])),disabled:!!d.task.closed_at},C(k.date?"Edit":"Set Date"),9,ee)):c("",!0),((R=d.task)==null?void 0:R.children_task_count)===0&&k.active&&k.status==="completed"?(a(),i("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:g[1]||(g[1]=L(()=>D("finish-date"),["prevent"])),disabled:!!d.task.closed_at},C(k.date?"Edit":"Set Date"),9,se)):c("",!0)])):c("",!0),e("h3",ae,C(k.title),1)],2)])}),128))])]),v.user?(a(),$(K,{key:0},{default:T(()=>[y(ht,{task:d.task,user:v.user,type:v.type,onCloseClick:g[2]||(g[2]=k=>v.user=null),onUpdateDate:A},null,8,["task","user","type"])]),_:1})):c("",!0)],2)}}},ne={class:"container mx-auto px-4"},le={key:3,class:"w-full xl:max-w-8xl min-h-64 mx-auto relative"},ie={key:0,class:"text-sm mb-4 border-b","aria-label":"Breadcrumb"},re={class:"flex items-center gap-2"},de={class:"text-gray-500 hover:text-blue-500 hover:underline text-base whitespace-nowrap"},ue={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},ce=["title"],pe={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},me={class:"grid grid-cols-12 gap-x-4 gap-y-3"},fe={class:"col-span-full md:col-span-7 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},ke={class:"font-medium text-md flex items-start gap-2"},ye={class:"mt-2 col-span-full flex items-center"},ve={class:"text-gray-400 text-xs"},_e={class:"flex items-center gap-0.5"},xe={class:"text-sky-400 text-sm font-semibold"},ge=["innerHTML"],be={class:"flex justify-between items-end mt-6 mb-2"},he={key:0,class:"border flex items-center justify-center h-96 rounded bg-gray-50 text-sm italic"},Ce={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},we={class:"font-semibold flex items-center gap-2"},Te={class:"text-white text-base"},De={class:"col-span-full md:col-span-5 xl:col-span-4 2xl:col-span-3 space-y-4 sticky top-[74px] bg-white shadow rounded-lg p-4 pb-0"},$e={class:"border col-span-3 p-3 rounded-md"},Se={class:"flex items-center gap-2 mb-4"},Ee={class:"flex items-center gap-2 mb-4"},Ae={key:0,class:"flex items-center gap-4 flex-wrap justify-between col-span-3 sticky bottom-0 bg-white"},Me=["disabled"],Re={key:0,class:"flex items-start justify-center !text-lg mb-4"},je={key:2,class:"py-4 flex items-center justify-between"},Ue={key:3,class:"h-1"},Le={key:2},Ne={key:1,class:"text-center py-4 text-red-500"},os={__name:"RequirementTaskShow",setup(G){const s=qt(),d=bt(),S=Gt(),f=At(),v=Mt(),D=tt(""),_=Y({open:!1,task:null}),r=Y({open:!1,task:null});function N(){_.open=!0,_.task=s.task}function E(){r.open=!0,r.task=s.task}Rt(async()=>{D.value="loading";try{await w(f.params.id)}catch(l){l.response.status===404&&v.push({name:"RequirementTaskList"})}D.value="",f.hash=="#sub-tasks"&&setTimeout(()=>xt(f.hash,66),0)});const A=Y({user:null,type:""});async function w(l){await s.fetchTask(l,{with_todos:"true"})}async function x(){await w(f.params.id),A.user=null,A.type=""}const g=l=>{v.push({name:"TaskEdit",params:{id:l}})};function O(){_.open=!1,v.back()}const k=U(()=>{var l,t;return(t=(l=s==null?void 0:s.task)==null?void 0:l.users)==null?void 0:t.find(m=>{var b;return((b=d.user)==null?void 0:b.id)==m.id})}),P=U(()=>{var t,m,b,M,z,F,H,W;const l=[];return(m=(t=s.task)==null?void 0:t.requirement)!=null&&m.id&&l.push({id:(M=(b=s.task)==null?void 0:b.requirement)==null?void 0:M.id,title:(F=(z=s.task)==null?void 0:z.requirement)==null?void 0:F.title,is_current_page:!1}),l.push({id:(H=s.task)==null?void 0:H.id,title:(W=s.task)==null?void 0:W.title,is_current_page:!0}),l});ft(()=>f.params.id,async l=>{D.value="changing",await w(l),D.value=""}),ft(()=>f.hash,async function(){setTimeout(()=>xt(f.hash,66),0)});const p=tt({action:null}),R=U(()=>{const t=((s==null?void 0:s.task_todo_dates)||[]).reduce((m,b)=>{const M=b.date;return m[M]||(m[M]=[]),m[M].push(b),m},{});return Object.keys(t).sort((m,b)=>new Date(b)-new Date(m)).map(m=>({date:m,todo_dates:t[m]}))});function X(){p.value={...p.value,action:""},w(f.params.id)}function q(){p.value={...p.value,action:""},w(f.params.id)}function B(l){console.log({todo:l}),p.value={...p.value,action:"edit",todo:l}}function Ct(l,t){console.log({yearMonthDay:t,todoId:l}),p.value={...p.value,action:"addDate",date:t,todo_id:l,formReadonlyValues:{date:!0}}}function wt(){p.value={action:null,todo:null}}function Tt(l){console.log({todo:l}),p.value={...p.value,action:"show",todo:l}}function Dt(){var l;p.value={...p.value,action:"add",todoTypeId:(l=f.params)==null?void 0:l.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}async function $t(l,t){var m;confirm(`Are your sure?
want to change status to ${t} 
todo: '${l==null?void 0:l.title}'`)&&(await S.updateStatus(l.id,t),w((m=f.params)==null?void 0:m.id))}async function St(l){var t;confirm(`Are your sure want to delete todo
'${l==null?void 0:l.title}'`)&&(await S.deleteTodoDate(l.id),w((t=f.params)==null?void 0:t.id))}return(l,t)=>{var b,M,z,F,H,W,et,st,at,ot,nt,lt,it,rt,dt,ut,ct,pt,mt;const m=gt("router-view");return a(),i("div",ne,[A.user?(a(),$(K,{key:0},{default:T(()=>[y(ht,{task:n(s).task,user:A.user,type:A.type,onCloseClick:t[0]||(t[0]=o=>A.user=null),onUpdateDate:x},null,8,["task","user","type"])]),_:1})):c("",!0),_.open?(a(),$(K,{key:1},{default:T(()=>[y(Ot,{onCloseClick:t[1]||(t[1]=o=>_.open=!1),task:_.task,onDelete:O},null,8,["task"])]),_:1})):c("",!0),D.value==="loading"?(a(),$(kt,{key:2,class:"h-[80vh] items-center justify-center"})):(a(),i("div",le,[n(s).task?(a(),i(V,{key:0},[P.value.length>1?(a(),i("nav",ie,[e("ol",re,[e("li",de,[y(n(I),{to:"/dashboard",class:"text-sm"},{default:T(()=>t[10]||(t[10]=[e("i",{class:"fas fa-home"},null,-1),h(" Home")])),_:1,__:[10]})]),t[11]||(t[11]=e("li",{"aria-hidden":"true",class:"text-gray-400 text-base"},"/",-1)),(a(!0),i(V,null,Z(P.value,(o,u)=>(a(),i(V,{key:o.id},[u>0?(a(),i("li",ue,"/")):c("",!0),e("li",{title:o==null?void 0:o.title,class:"text-gray-600 line-clamp-1"},[o.is_current_page?(a(),i("span",pe,C(o==null?void 0:o.title),1)):(a(),$(jt(n(d).isAdminMood?n(I):"div"),{key:0,to:`${n(d).isAdminMood?"/requirements/show/"+o.id:"/tasks"}`,class:Q(["transition",{"line-clamp-1 text-justify hover:text-blue-500 hover:underline":u>0,"whitespace-nowrap hover:text-blue-500 hover:underline":u===0}])},{default:T(()=>[h(C(o==null?void 0:o.title),1)]),_:2},1032,["to","class"]))],8,ce)],64))),128))])])):c("",!0),e("div",me,[e("div",fe,[e("div",null,[e("h2",ke,[e("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:t[2]||(t[2]=o=>n(v).back())},t[12]||(t[12]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),y(vt,null,{default:T(()=>[h(C(n(s).task.title),1)]),_:1})]),e("div",ye,[e("div",ve,[t[13]||(t[13]=e("i",{class:"fas fa-clock"},null,-1)),h(" "+C(n(Vt)(n(s).task.created_at)),1)]),(b=n(s).task)!=null&&b.created_by_user?(a(),i(V,{key:0},[t[14]||(t[14]=e("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),e("div",_e,[y(Ut,{user:(M=n(s).task)==null?void 0:M.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),e("div",xe,C((F=(z=n(s).task)==null?void 0:z.created_by_user)==null?void 0:F.label),1)])],64)):c("",!0)])]),y(vt,null,{default:T(()=>{var o;return[e("p",{innerHTML:(o=n(s).task)==null?void 0:o.description,class:"text-justify"},null,8,ge)]}),_:1}),e("div",null,[e("div",be,[t[16]||(t[16]=e("h3",{class:"font-semibold text-xl"},"Todos",-1)),k.value?(a(),i("button",{key:0,class:"btn btn-3 h-8",onClick:t[3]||(t[3]=L(()=>Dt(),["prevent"]))},t[15]||(t[15]=[e("i",{class:"fas fa-plus"},null,-1),h(" Add Todo ")]))):c("",!0)]),e("div",null,[R.value.length===0?(a(),i("div",he," No Todos ")):c("",!0),(a(!0),i(V,null,Z(R.value,o=>(a(),i("div",{key:o.date,class:"border rounded-md overflow-hidden mb-4"},[e("div",Ce,[e("div",we,[e("div",Te,C(n(J)(o.date)),1)])]),e("div",null,[(a(!0),i(V,null,Z((o==null?void 0:o.todo_dates)||[],u=>(a(),$(Bt,{key:u.id,todoDate:u,onClickTodo:j=>Tt(j),onClickEdit:()=>B(u==null?void 0:u.todo),onClickChangeStatus:(j,Et)=>$t(j,Et),onClickDelete:j=>St(j),"hide-sorting-btn":"",class:"border-b border-sky-200"},null,8,["todoDate","onClickTodo","onClickEdit","onClickChangeStatus","onClickDelete"]))),128))])]))),128))])])]),e("div",De,[e("div",$e,[e("div",null,[e("div",Se,[t[17]||(t[17]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),y(yt,{department:(W=(H=n(s))==null?void 0:H.task)==null?void 0:W.from_department,"short-name":!0},null,8,["department"])]),t[18]||(t[18]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisors",-1)),y(_t,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((st=(et=n(s))==null?void 0:et.task)==null?void 0:st.supervisors)||[],listType:"supervisors",maxItem:3},null,8,["users"])]),t[21]||(t[21]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Ee,[t[19]||(t[19]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),y(yt,{department:(ot=(at=n(s))==null?void 0:at.task)==null?void 0:ot.to_department,"short-name":!0},null,8,["department"])]),t[20]||(t[20]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Assigned Users",-1)),y(_t,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((lt=(nt=n(s))==null?void 0:nt.task)==null?void 0:lt.users)||[],isTargetTask:(rt=(it=n(s))==null?void 0:it.task)==null?void 0:rt.is_target,maxItem:5},null,8,["users","isTargetTask"])])]),n(d).isAdminMood?(a(),i("div",Ae,[y(n(I),{to:{name:"TaskUserAssign",params:{id:(dt=n(s).task)==null?void 0:dt.id}},class:Q(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",n(s).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:t[4]||(t[4]=o=>o.stopPropagation())},{default:T(()=>t[22]||(t[22]=[e("i",{class:"fas fa-users-cog"},null,-1),h(" Employees ")])),_:1,__:[22]},8,["to","class"]),e("button",{onClick:t[5]||(t[5]=L(o=>{var u;return g((u=n(s).task)==null?void 0:u.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!n(s).task.closed_at},t[23]||(t[23]=[e("i",{class:"fas fa-edit"},null,-1),h(" Edit ")]),8,Me)])):c("",!0),y(oe,{task:(ut=n(s))==null?void 0:ut.task,onUpdate:t[6]||(t[6]=()=>{var o,u;return w((u=(o=n(s))==null?void 0:o.task)==null?void 0:u.id)})},null,8,["task"]),(ct=n(s))!=null&&ct.task?(a(),$(Pt,{key:1,task:((pt=n(s))==null?void 0:pt.task)||{},class:"col-span-full",onUpdateStatus:t[7]||(t[7]=()=>{var o,u;return w((u=(o=n(s))==null?void 0:o.task)==null?void 0:u.id)}),"hide-timeline":""},{top:T(()=>{var o,u,j;return[(o=n(s).task)!=null&&o.closed_at?c("",!0):(a(),i("div",Re,[y(Lt,{status:(u=n(s).task)==null?void 0:u.status,progressPercent:(j=n(s).task)==null?void 0:j.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"])]))]}),_:1},8,["task"])):c("",!0),n(d).isAdminMood?(a(),i("div",je,[e("button",{class:"btn-2-red h-8",onClick:L(N,["prevent"])},"Delete"),(mt=n(s).task)!=null&&mt.closed_at?c("",!0):(a(),i("button",{key:0,class:"btn-3 h-8",onClick:L(E,["prevent"])}," Close Task "))])):(a(),i("div",Ue))])]),n(f).name==="TaskReportAdd"?(a(),$(K,{key:1,class:"*:bg-transparent"},{default:T(()=>[y(m)]),_:1})):(a(),i("section",Le,[y(m)]))],64)):(a(),i("div",Ne,C(n(s).error),1)),D.value==="changing"?(a(),$(kt,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):c("",!0)])),y(zt,{userRole:"employee",todoModal:p.value,onCancelClick:wt,onTodoUpdate:X,onTodoDateUpdate:q,onClickEdit:B,onClickAddTodoDate:Ct},null,8,["todoModal"]),r.open?(a(),$(K,{key:4},{default:T(()=>[y(Jt,{task:n(s).task,onClickCancel:t[8]||(t[8]=o=>r.open=!1),onUpdateStatus:t[9]||(t[9]=()=>{var o;w((o=n(s).task)==null?void 0:o.id),r.open=!1})},null,8,["task"])]),_:1})):c("",!0)])}}};export{os as default};
