import{J as O,r as d,q as f,K as o}from"./index-BfwuEPo9.js";const x=O("task",()=>{const c=d([]),v=d(null),u=d(!1),i=d(null),p=async(a,r,{updateStoreData:e=!0})=>{var t,n;e==!0&&(u.value=!0,i.value=null);try{await o.post(`/tasks/${a}/assign-users`,{user_ids:r}),await y(a)}catch(l){throw e==!0&&(i.value=((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"Assign users failed"),l}finally{e==!0&&(u.value=!1)}},w=async(a,{loadingBeforeFetch:r=!0,newList:e=!1}={})=>{var t,n,l;r&&(u.value=!0),i.value=null;try{let s;return e?s=await o.get("/tasks2",{params:a}):s=await o.get("/tasks",{params:a}),c.value=((t=s.data)==null?void 0:t.tasks)||[],s.data}catch(s){i.value=((l=(n=s.response)==null?void 0:n.data)==null?void 0:l.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",s)}finally{u.value=!1}};function k(a,r=0){return Array.isArray(a)===!1||a.length===0?[]:a.filter(e=>e.parent_id===r).map(e=>({...e,children_tasks:k(a,e.id)}))}function h(){return k(c.value,0)}function T(){const a=[],r=(e,t=0,n="")=>{e.forEach(l=>{a.push({...l,depth:t,idPath:n+l.id}),l.children_tasks&&l.children_tasks.length&&r(l.children_tasks,t+1,n+l.id+"-")})};return r(h()),a}const y=async(a,r={},e={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,n,l;e.fetchOnly||(u.value=!0),i.value=null;try{const s=await o.get(`/tasks/${a}`,{params:r});return e.fetchOnly||(v.value=((t=s.data)==null?void 0:t.task)||{},c.value=s.data.sub_tasks||[]),s.data}catch(s){const g=((l=(n=s.response)==null?void 0:n.data)==null?void 0:l.message)||`টাস্ক (ID: ${a}) লোড করতে ব্যর্থ হয়েছে।`;return e.fetchOnly||(i.value=g),g}finally{e.fetchOnly||(u.value=!1)}},$=async(a,r={loadingBeforeCreate:!1})=>{var e,t,n,l;r.loadingBeforeCreate&&(u.value=!0),i.value=null;try{const s=await o.post("/tasks",a);return(e=s.data)!=null&&e.data&&c.value.push((t=s.data)==null?void 0:t.data),s.data.data}catch(s){throw i.value=((l=(n=s.response)==null?void 0:n.data)==null?void 0:l.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",s),s}finally{r.loadingBeforeCreate&&(u.value=!1)}},m=async(a,r,{loadingBeforeFetch:e=!0})=>{e&&(u.value=!0),i.value=null;try{const t=await o.put(`/tasks/${a}`,r),n=c.value.findIndex(l=>l.id===a);return n!==-1&&(c.value[n]=t.data.data),t.data.data}catch(t){throw console.error(`Error updating task with id ${a}:`,t),t}finally{e&&(u.value=!1)}},_=async(a,r)=>(await o.put(`/tasks/${a}/update-priorities`,{task_ids:r})).data,E=async a=>{var r,e;u.value=!0,i.value=null;try{await o.delete(`/tasks/${a}`),c.value=c.value.filter(t=>t.id!==a)}catch(t){i.value=((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.message)||`টাস্ক (ID: ${a}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${a}:`,t)}finally{u.value=!1}};return{tasks:f(()=>c.value),task:f(()=>v.value),loading:f(()=>u.value),error:f(()=>i.value),taskListTree:f(h),flattenedTasks:f(T),fetchTasks:w,fetchTask:y,createTask:$,updateTask:m,deleteTask:E,assignUsers:p,updateTaskPriorities:_}});export{x as u};
