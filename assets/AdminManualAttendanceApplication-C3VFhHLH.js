import{u as J,f as Y,r as u,x as $,h as G,q as M,c as n,o as r,a as t,d as x,m as D,j as h,s as B,t as N,F as X,e as Z,k as c,P,w as y,v as w,H as ee,b as te}from"./index-4cVhF2CH.js";import{_ as le}from"./EmployeeFilter-DObv74j3.js";import{_ as oe}from"./FlexibleDatePicker-BOQ-fgzp.js";import{L as se}from"./LoaderView-D_-WElnV.js";import{S as ae}from"./SelectedEmployeeCard-C9MMqmtM.js";import{u as ne}from"./manual-attendance-BeRjK8ZP.js";import{u as re}from"./user-DejXXCx-.js";import"./company-De50kkBt.js";import"./department-DYjgWrB_.js";import"./EmployeeDropdownInput-BAmZixbQ.js";import"./SelectDropdown-wWdYH0ad.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BoWo7TBw.js";const ie={class:"space-y-2 px-4"},de={class:"flex flex-wrap gap-2"},ue={key:0,class:"text-center py-4"},pe={key:1,class:"space-y-4"},ce={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye={class:"overflow-x-auto"},me={key:0,class:"text-red-500 text-sm text-left"},_e={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},ve={class:"bg-gray-200"},be={class:"border border-gray-300 px-2 text-left py-2"},fe={class:"flex items-center justify-center gap-2"},he=["onClick"],ge={class:"border border-gray-300 px-2 cursor-pointer text-center"},ke=["onUpdate:modelValue"],xe={class:"border border-gray-300 px-2"},we=["onUpdate:modelValue"],Ae={class:"border border-gray-300 px-2"},Se=["onUpdate:modelValue"],Ce={class:"border border-gray-300 px-2"},Ue=["onUpdate:modelValue"],Ve={class:"border border-gray-300 px-2"},Me=["onUpdate:modelValue"],qe={class:"border border-gray-300 px-2"},Fe=["onUpdate:modelValue","disabled"],Te={key:0},$e={key:1},De={class:"space-y-6"},Be={key:0,class:"text-red-500 text-sm text-left"},Ne={class:"flex items-center justify-center gap-2 cursor-pointer"},Pe={class:"flex justify-center"},je=["disabled"],Oe={key:0},Ee={key:1},tt={__name:"AdminManualAttendanceApplication",setup(Re){const q=J(),b=Y(),i=ne(),j=re(),A=b.query.date||i.selectedMonth||new Date().toISOString().slice(0,7),f=u(A),m=u([]),p=u(!1),d=u(null),S=u(!0),o=u({company_id:b.query.company_id||"",department_id:b.query.department_id||"",line_type:b.query.line_type||"all",employee_id:b.query.employee_id||""}),O=s=>s.toString().padStart(2,"0"),_=u({year:Number(A.split("-")[0]||new Date().getFullYear()),month:Number(A.split("-")[1]||new Date().getMonth()+1),day:1}),C=$(()=>{var s,e;return!((s=_.value)!=null&&s.year)||!((e=_.value)!=null&&e.month)?"":`${_.value.year}-${O(_.value.month)}`}),F=async()=>{const s={company_id:o.value.company_id,department_id:o.value.department_id,line_type:o.value.line_type,selectedMonth:f.value,selectedStatus:i.selectedStatus};if(o.value.employee_id){s.user_id=o.value.employee_id,p.value=!0;try{await i.fetchAdminManualAttendances(s)}finally{p.value=!1}}else typeof i.setAttendances=="function"?i.setAttendances([]):i.attendances=[]};function E(){const s={};return f.value&&(s.date=String(f.value)),o.value.company_id&&(s.company_id=String(o.value.company_id)),o.value.department_id&&(s.department_id=String(o.value.department_id)),o.value.line_type&&o.value.line_type!=="all"&&(s.line_type=String(o.value.line_type)),o.value.employee_id&&(s.employee_id=String(o.value.employee_id)),s}let U=null;function R(){U&&clearTimeout(U),U=setTimeout(()=>{q.replace({query:E()}).catch(()=>{})},120)}let V=null;const T=u("");async function H(){R();const s=JSON.stringify({m:f.value||"",c:o.value.company_id||"",d:o.value.department_id||"",t:o.value.line_type||"all",e:o.value.employee_id||""});s!==T.value&&(await F(),T.value=s)}function g(){V&&clearTimeout(V),V=setTimeout(H,200)}G(async()=>{await j.fetchUsers(),g()});function L(){g()}function I(){q.go(-1)}M(C,()=>{f.value=C.value,g()}),M(()=>({...o.value,month:C.value}),()=>g(),{deep:!0});const K=$(()=>i.attendances||[]);M(()=>i.attendances,s=>{m.value=[],(s||[]).forEach(e=>{m.value.push({date:e==null?void 0:e.date,type:"Forget Punch",check_in:e==null?void 0:e.entry_time,check_out:e==null?void 0:e.exit_time,description:"",is_check:!1})})},{immediate:!0,deep:!0});function Q(){const s=m.value.every(e=>e.is_check);m.value.forEach(e=>{e.is_check=!s})}async function W(){var s;if(p.value=!0,d.value=null,!o.value.employee_id){d.value="Please select an employee.",p.value=!1;return}try{const e=m.value.filter(l=>l.is_check&&(l.check_in||l.check_out));if(!e.length){d.value="Please select at least one row.";return}const k=e.map(l=>({user_id:o.value.employee_id,type:l.type,check_in:l.check_in?`${l.date} ${l.check_in}:00`:null,check_out:l.check_out?`${l.date} ${l.check_out}:00`:null,description:l.description||""})),v=await i.createBulkManualAttendance({records:k,direct_approve:S.value});(s=v==null?void 0:v.data)!=null&&s.length&&await F()}catch(e){d.value=(e==null?void 0:e.message)||"Failed to submit manual attendance requests."}finally{p.value=!1}}return(s,e)=>{var k,v;return r(),n("div",ie,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:I},e[13]||(e[13]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[14]||(e[14]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Admin Bulk Manual Attendance Applications",-1)),e[15]||(e[15]=t("div",null,null,-1))]),t("div",de,[x(le,{company_id:o.value.company_id,"onUpdate:company_id":e[0]||(e[0]=l=>o.value.company_id=l),department_id:o.value.department_id,"onUpdate:department_id":e[1]||(e[1]=l=>o.value.department_id=l),employee_id:o.value.employee_id,"onUpdate:employee_id":e[2]||(e[2]=l=>o.value.employee_id=l),line_type:o.value.line_type,"onUpdate:line_type":e[3]||(e[3]=l=>o.value.line_type=l),"with-type":!0,"initial-value":s.$route.query,onFilterChange:L},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",null,[x(oe,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value=l),"show-year":!1,"show-month":!0,"show-date":!1},null,8,["modelValue"])])]),D(i).loading?(r(),n("div",ue,[x(se)])):(r(),n("div",pe,[(k=o.value)!=null&&k.employee_id?(r(),n("div",ce,[x(ae,{user:D(i).user},null,8,["user"])])):h("",!0),t("div",ye,[t("div",{class:B(d.value?"py-2":"")},[d.value?(r(),n("div",me,N(d.value),1)):h("",!0)],2),t("table",_e,[t("thead",null,[t("tr",ve,[t("th",be,[t("div",fe,[t("input",{id:"allCheck",type:"checkbox",onChange:Q,class:"h-5 w-5 accent-blue-600 cursor-pointer"},null,32),e[16]||(e[16]=t("label",{for:"allCheck",class:"text-sm cursor-pointer"},"All Check",-1))])]),e[17]||(e[17]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Date",-1)),e[18]||(e[18]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Type",-1)),e[19]||(e[19]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Check-In",-1)),e[20]||(e[20]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Check-Out",-1)),e[21]||(e[21]=t("th",{class:"border border-gray-300 px-2 text-left py-2"},"Description",-1))])]),t("tbody",null,[(r(!0),n(X,null,Z(m.value,(l,z)=>(r(),n("tr",{key:z,class:B(["border-b border-gray-200 hover:bg-blue-200 cursor-pointer",l.is_check?"bg-yellow-100":""]),onClick:a=>l.is_check=!l.is_check},[t("td",ge,[c(t("input",{type:"checkbox","onUpdate:modelValue":a=>l.is_check=a,class:"h-5 w-5",onClick:e[5]||(e[5]=y(()=>{},["stop"]))},null,8,ke),[[P,l.is_check]])]),t("td",xe,[c(t("input",{type:"date","onUpdate:modelValue":a=>l.date=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[6]||(e[6]=y(()=>{},["stop"]))},null,8,we),[[w,l.date]])]),t("td",Ae,[c(t("select",{"onUpdate:modelValue":a=>l.type=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[7]||(e[7]=y(()=>{},["stop"]))},e[22]||(e[22]=[t("option",{value:""},"Select Type",-1),t("option",{value:"Home Office"},"Home Office",-1),t("option",{value:"Remote Work"},"Remote Work",-1),t("option",{value:"Forget Punch"},"Forget Punch",-1)]),8,Se),[[ee,l.type]])]),t("td",Ce,[c(t("input",{type:"time","onUpdate:modelValue":a=>l.check_in=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[8]||(e[8]=y(()=>{},["stop"]))},null,8,Ue),[[w,l.check_in]])]),t("td",Ve,[c(t("input",{type:"time","onUpdate:modelValue":a=>l.check_out=a,class:"w-full border border-gray-600 py-1 px-2 rounded-sm",onClick:e[9]||(e[9]=y(()=>{},["stop"]))},null,8,Me),[[w,l.check_out]])]),t("td",qe,[c(t("textarea",{"onUpdate:modelValue":a=>l.description=a,onKeyup:e[10]||(e[10]=y(()=>{},["stop"])),onClick:e[11]||(e[11]=y(()=>{},["stop"])),disabled:!l.check_in&&!l.check_out,class:"w-full border border-gray-600 py-1 px-2 rounded-sm disabled:bg-gray-300 disabled:cursor-not-allowed",cols:"1"},null,40,Fe),[[w,l.description]])])],10,he))),128)),K.value.length===0?(r(),n("tr",Te,e[23]||(e[23]=[t("td",{colspan:"6",class:"p-2 text-center text-red-500"},"Please select any employee",-1)]))):h("",!0)])])]),(v=o.value)!=null&&v.employee_id?(r(),n("div",$e,[t("div",De,[d.value?(r(),n("div",Be,N(d.value),1)):h("",!0),t("div",Ne,[c(t("input",{id:"directApprove",type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=l=>S.value=l),class:"accent-blue-600 h-6 w-6 cursor-pointer"},null,512),[[P,S.value]]),e[24]||(e[24]=t("label",{for:"directApprove",class:"text-lg cursor-pointer"},"Direct Approve",-1))]),t("div",Pe,[t("button",{type:"button",class:"btn-2",disabled:p.value,onClick:W},[p.value?(r(),n("span",Oe,e[25]||(e[25]=[t("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),te("Submitting...")]))):(r(),n("span",Ee,"Submit All"))],8,je)])])])):h("",!0)]))])}}};export{tt as default};
