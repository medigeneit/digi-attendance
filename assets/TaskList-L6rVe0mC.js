import{_ as re}from"./CommentModal-fjl1imWF.js";import{_ as ie,a as ue}from"./TaskUserAssignForm-B2Fz6wJZ.js";import{L as de}from"./LoaderView-Ce29IeuC.js";import{O as W}from"./OverlyModal-DaJPAAAp.js";import{_ as Q,a as me}from"./TaskAddForm-BwPX6iZa.js";import{_ as pe}from"./TaskEditForm-C1gtq3Jr.js";import{b as se,q as v,s as ce,e as le,A as ae,k as ye,c,o,a as t,f as x,w as G,m as I,h as a,p as V,l as C,g as E,C as fe,D as K,v as X,n as Z,y as Y,F as U,x as J,u as ke,r as _,E as ee,t as te}from"./index-wfbTXXw4.js";import{_ as ve}from"./MultiselectDropdown-CMm1RBA7.js";import{u as be}from"./company-B1-MM4il.js";import{_ as oe}from"./UserChip-Cb0m4LL_.js";import{_ as ne}from"./TaskTreeView-Ct3IFdWb.js";import{u as ge}from"./task-priority-COodJNdO.js";import{u as xe}from"./useTaskStore-CQfG0lxL.js";import"./useCommentStore-DMh7e2Cn.js";import"./datetime-q3Sn87-f.js";import"./TaskUrgencyInput-knM_J2sj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon--7zcxl4G.js";import"./useRequirementStore-CQTK1Tte.js";import"./SectionLoading-BzKfPTcI.js";const we={class:"mb-3 task-header"},Ce={class:"flex justify-between items-start mb-4"},Te={class:"ml-auto flex gap-6 items-center"},Ie={key:0,class:"flex gap-2 items-center"},Ve={class:"flex flex-wrap items-center gap-2 mt-3"},Ae={class:"flex flex-wrap gap-4 w-full"},Le={key:2,class:"relative w-full md:w-72"},qe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},_e={class:"text-gray-600 w-40 relative"},Se={class:"flex gap-4 items-center flex-shrink-0"},$e={class:"flex gap-2"},Ee={class:"flex gap-2"},Ue={class:"flex gap-2"},De={class:"text-gray-600 w-full md:w-40 relative"},Me={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-5 gap-2"},he={class:"text-gray-600 w-full md:w-64 lg:w-96 md:ml-auto relative"},Pe={class:"w-full flex justify-end gap-5 mt-4"},Be={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(D,{emit:k}){const i=D,d=se(),A=v(f("from-department-id")),w=v(f("to-department-id")),L=v(f("user-ids")),r=v(f("month")),u=v(f("status")),m=v(f("is-important")),p=v(f("is-urgent")),b=v(f("is-target")),g=v(M()),q=k,T=be(),{employees:S}=ce(T);function f(n){return{get:()=>i.modelValue[n]||"",set:e=>{q("update:modelValue",{...i.modelValue,[n]:e||void 0})}}}function M(){let n=0;const e=s=>{q("update:modelValue",{...i.modelValue,search:s||void 0})};return{get:()=>i.modelValue.search||"",set:s=>{clearTimeout(n),n=setTimeout(e,500,s)}}}const h=v(()=>F(L.value));async function N(n){n&&await T.fetchEmployee(n)}async function j(){if(w.value){const n=T.companies.find(e=>e.departments.some(s=>s.id==w.value));await T.fetchEmployee(n.id)}}le(async()=>{var n,e;await T.fetchCompanies({with:"departments",ignore_permission:!0}),(n=i.modelValue)!=null&&n["company-id"]&&await N((e=i.modelValue)==null?void 0:e["company-id"])});function F(n){return Array.isArray(S.value)&&S.value.find(e=>e.id==n)||null}function z(n){L.value=(n==null?void 0:n.id)||""}function H(){L.value=""}return ae(()=>w.value,j),(n,e)=>{var P,B,O,y,$;const s=ye("RouterLink");return o(),c(U,null,[t("div",we,[t("div",Ce,[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none"},"Task List",-1)),t("div",Te,[D.listHasRearranged?(o(),c("div",Ie,[e[11]||(e[11]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=G(l=>q("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=G(l=>q("clickPriorityDiscard"),["prevent"]))},"Discard")])):x("",!0),t("button",{onClick:e[2]||(e[2]=l=>q("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",Ve,[t("div",Ae,[a(d).name!=="MyTaskList"?(o(),I(Q,{key:0,modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=l=>A.value=l),companies:((P=a(T))==null?void 0:P.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:V(()=>e[13]||(e[13]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),a(d).name!=="MyTaskList"?(o(),I(Q,{key:1,modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=l=>w.value=l),companies:((B=a(T))==null?void 0:B.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:V(()=>e[14]||(e[14]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),a(d).name!=="MyTaskList"?(o(),c("div",Le,[C(ve,{modelValue:h.value,onSelect:z,onRemove:H,options:a(S),multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full"},{option:V(({option:l})=>[C(oe,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),h.value?(o(),c("div",qe,[t("button",{onClick:G(H,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):x("",!0),e[15]||(e[15]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):x("",!0),t("div",_e,[e[17]||(e[17]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),E(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>u.value=l),class:"input-1"},e[16]||(e[16]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[fe,u.value]])]),t("div",Se,[t("label",$e,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>m.value=l)},null,512),[[K,m.value]]),e[18]||(e[18]=t("span",null,"Important",-1))]),t("label",Ee,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>p.value=l)},null,512),[[K,p.value]]),e[19]||(e[19]=t("span",null,"Urgent",-1))]),t("label",Ue,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>b.value=l)},null,512),[[K,b.value]]),e[20]||(e[20]=t("span",null,"Is Target",-1))])]),t("div",De,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),E(t("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=l=>r.value=l),type:"month",class:"input-1",placeholder:"All month"},null,512),[[X,r.value]])])])])]),t("div",Me,[t("div",he,[e[22]||(e[22]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),E(t("input",{id:"search","onUpdate:modelValue":e[10]||(e[10]=l=>g.value=l),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[X,g.value]]),e[23]||(e[23]=t("i",{class:"fas fa-search absolute right-2 top-[50%] translate-y-[-50%]"},null,-1))]),t("div",Pe,[a(d).name!=="MyTaskList"?(o(),I(s,{key:0,class:Y(["text-xs sm:text-sm btn-3 py-0.5",((O=a(d).query)==null?void 0:O.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...a(d).query,view:"userwise"}}},{default:V(()=>e[24]||(e[24]=[Z(" User Wise List ")])),_:1,__:[24]},8,["class","to"])):x("",!0),a(d).name!=="MyTaskList"?(o(),I(s,{key:1,class:Y(["text-xs sm:text-sm btn-3 py-0.5",((y=a(d).query)==null?void 0:y.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys((($=a(d))==null?void 0:$.query)||{}).filter(l=>{var R;return((R=a(d))==null?void 0:R.query[l])!=="userwise"}).reduce((l,R)=>({...l,[R]:a(d).query[R]}),{})}}},{default:V(()=>e[25]||(e[25]=[Z(" TaskWise List ")])),_:1,__:[25]},8,["class","to"])):x("",!0)])])],64)}}},Oe={class:"w-full bg-white rounded"},Re=["rowspan"],Ne={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(D,{emit:k}){const i=D,d=k,A=v(()=>i.tasks.reduce((r,u)=>(r.push(...u.users.filter(m=>!r.find(p=>p.id==m.id&&m.id))),r),[]).filter(r=>i.selectedUserId?r.id==i.selectedUserId:!0)),w=r=>i.tasks.filter(p=>p.users.some(b=>b.id===r)),L=v(()=>A.value.map(r=>{const u=w(r.id);return{...r,tasks:u}}));return(r,u)=>(o(),c("div",null,[t("table",Oe,[t("tbody",null,[(o(!0),c(U,null,J(L.value,m=>(o(),c(U,{key:m.id},[(o(!0),c(U,null,J(m.tasks,(p,b)=>(o(),c("tr",{key:p.id},[b==0?(o(),c("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(m.tasks.length,1)},[C(oe,{user:m,class:"sticky top-[80px]"},null,8,["user"])],8,Re)):x("",!0),t("td",{class:Y(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":b==0,"border-b":m.tasks.length-1===b}])},[C(ne,{task:p,class:"!border-0 my-0",index:b,onCommentButtonClick:u[0]||(u[0]=g=>d("commentButtonClick",r.item.id)),onEditClick:u[1]||(u[1]=g=>d("editClick",g)),onAddClick:u[2]||(u[2]=g=>d("addClick",g)),onEmployeeAssignClick:u[3]||(u[3]=g=>d("employeeAssignClick",g))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Fe={class:"container mx-auto p-6 mt-2 relative bg-white rounded-md shadow-md"},He={class:"mb-4"},je={key:4},ze={key:0,class:"text-center py-4 text-red-500"},We={key:1},Ge={class:"flex items-stretched"},Ke={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Ye=1,kt={__name:"TaskList",setup(D){const k=xe(),i=se(),d=ke(),A=_(!1),w=_(null),L=_(!1),r=_(null),u=_(!1),m=ee({parentId:0,requirementId:0}),p=ee({taskId:0,isOpen:!1}),b=_(null),g=_([]),{handleItemsPriorityUpdate:q,saveTaskPriority:T,listHasRearranged:S}=ge(()=>k.taskListTree,0);le(async()=>{i.query.status||d.push({query:{...i.query,status:"not-completed"}}),await f({loadingBeforeFetch:!0})});async function f({loadingBeforeFetch:e=!1}={}){L.value=!!i.query["user-ids"];const s=await k.fetchTasks({...i.query},{newList:!0,loadingBeforeFetch:e});g.value=s.query_log||[]}const M=e=>{u.value=!0,m.parentId=e},h=e=>{p.taskId=e,p.isOpen=!0},N=e=>{w.value=e,A.value=!0},j=()=>{A.value=!1,w.value=null};async function F(){r.value=null,u.value=!1,m.parentId=0,await f()}async function z(){u.value=!1,m.parentId=0,await f()}async function H(){T()&&await f()}ae(()=>({...i.query}),async()=>{await f()});const n=v({get(){return{...i.query}},set(e){localStorage.removeItem("sub_task_opened_list"),d.push({query:{...e}})}});return(e,s)=>{var P,B,O;return o(),c("div",Fe,[r.value?(o(),I(W,{key:0},{default:V(()=>[C(pe,{taskId:r.value,onClose:s[0]||(s[0]=y=>r.value=null),onUpdated:F},null,8,["taskId"])]),_:1})):x("",!0),u.value?(o(),I(W,{key:1},{default:V(()=>[C(me,{parentTaskId:m.parentId,requirementId:m.requirementId,onClose:z,onTaskCreated:F},null,8,["parentTaskId","requirementId"])]),_:1})):x("",!0),p.isOpen?(o(),I(W,{key:2,class:"*:max-w-4xl"},{default:V(()=>[C(ie,{taskId:p.taskId,onCancelClick:s[1]||(s[1]=()=>{p.isOpen=!1,p.taskId=0}),onSuccess:s[2]||(s[2]=()=>{p.isOpen=!1,p.taskId=0,f()})},null,8,["taskId"])]),_:1})):x("",!0),C(Be,{modelValue:n.value,"onUpdate:modelValue":s[3]||(s[3]=y=>n.value=y),onClickAddTask:M,onClickPrioritySave:H,onClickPriorityDiscard:s[4]||(s[4]=()=>a(S)?b.value.resetItems:null),"list-has-rearranged":a(S),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((B=(P=a(i))==null?void 0:P.query)==null?void 0:B["query-log"])=="true"?(o(!0),c(U,{key:3},J(g.value,(y,$)=>(o(),c("div",{key:$,class:"text-xs text-gray-500"},[t("div",He,te(y.raw_query),1)]))),128)):x("",!0),a(k).loading?(o(),c("div",je,[C(de)])):(o(),c(U,{key:5},[a(k).error?(o(),c("div",ze,te(a(k).error),1)):a(k).tasks.length>0?(o(),c("div",We,[((O=a(i).query)==null?void 0:O.view)=="userwise"?(o(),I(Ne,{key:0,tasks:a(k).tasks,selectedUserId:a(i).query["user-ids"],onCommentButtonClick:s[5]||(s[5]=y=>N(y,e.task.id)),onEditClick:s[6]||(s[6]=y=>r.value=y),onAddClick:s[7]||(s[7]=y=>M(y)),onEmployeeAssignClick:s[8]||(s[8]=y=>h(y))},null,8,["tasks","selectedUserId"])):(o(),I(ue,{key:1,items:a(k).tasks,handle:"handle",onItemsUpdate:a(q),class:"space-y-4",ref_key:"draggableTaskList",ref:b},{item:V(({item:y,index:$})=>[t("div",Ge,[C(ne,{task:y,index:$,showDraggableHandle:!L.value,onCommentButtonClick:s[9]||(s[9]=l=>N(l,e.task.id)),onEditClick:s[10]||(s[10]=l=>r.value=l),onAddClick:s[11]||(s[11]=l=>M(l)),onEmployeeAssignClick:s[12]||(s[12]=l=>h(l)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(o(),c("div",Ke," No tasks found. "))],64)),C(re,{show:A.value,"commentable-id":w.value,"commentable-type":"task","user-id":Ye,"on-close":j,onSubmitted:a(k).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{kt as default};
