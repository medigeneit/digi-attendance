import{u as j,f as F,D as $,r as p,h as E,q as c,x as H,p as O,c as m,o as _,a as t,t as u,d as b,k as g,H as D,v as I,m as x,j as R,F as Q,e as W,i as z,l as T}from"./index-Ab5Ru0L-.js";import{_ as G}from"./EmployeeFilter-DBPH-2qa.js";import{L as J}from"./LoaderView-DGF554uZ.js";import{u as K}from"./leave-application-B1R8oxBF.js";import{u as X}from"./user-B9jlUHS8.js";import"./company-D1vpQAIN.js";import"./department-DrRJoNhD.js";import"./EmployeeDropdownInput-BBLW79db.js";import"./SelectDropdown-DE1pWoXU.js";import"./UserChip-BzYA6rcd.js";const Y={class:"space-y-2 px-4"},Z={class:"flex items-center justify-between gap-2"},ee={class:"title-md md:title-lg flex-wrap text-center capitalize"},te={class:"flex flex-wrap gap-2 items-center"},re={key:0,class:"text-center py-4"},se={key:1,class:"space-y-4"},le={class:"overflow-x-auto"},oe={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},de={class:"border border-gray-300 px-2"},ae={class:"border border-gray-300 px-2"},ne={class:"border border-gray-300 px-2"},ue={class:"border border-gray-300 px-2"},ie={class:"border border-gray-300 px-2"},ye={class:"border border-gray-300 px-2"},_e=["innerHTML"],ve={class:"border border-gray-300 px-2"},me={class:"border border-gray-300 px-2"},pe={class:"border border-gray-300 px-2"},fe={class:"flex justify-center gap-2"},ce=["onClick"],be={key:0},h="applicationType",Ce={__name:"PrevAfterLeaveApplicationList",setup(ge){const w=j(),i=F(),d=K(),k=X(),{leaveApplications:C,loading:A}=$(d),q=p(null),a=p(i.query[h]==="after"?"after":"prev"),n=p(i.query.date||d.selectedMonth||new Date().toISOString().slice(0,7)),s=p({company_id:i.query.company_id||"",department_id:i.query.department_id||"",line_type:i.query.line_type||"all",employee_id:i.query.employee_id||""});function B(l){return/^\d{4}-\d{2}$/.test(l||"")?`${l}-15`:l||new Date().toISOString().slice(0,10)}const v=async()=>{const l=a.value==="after"?"next_week":"prev_week",r=B(n.value),o={company_id:s.value.company_id,department_id:s.value.department_id,selectedDate:n.value,selectedStatus:d.selectedStatus,query:l,anchor_date:r};s.value.employee_id&&(o.user_id=s.value.employee_id),s.value.line_type&&s.value.line_type!=="all"&&(o.line_type=s.value.line_type),A.value=!0;try{await d.fetchLeaveApplications(o)}finally{A.value=!1}};E(async()=>{s.value.employee_id&&(await k.fetchUser(s.value.employee_id),q.value=k.user||null),await v()});function M(){const l={[h]:a.value,date:n.value};return s.value.company_id&&(l.company_id=String(s.value.company_id)),s.value.department_id&&(l.department_id=String(s.value.department_id)),s.value.line_type&&s.value.line_type!=="all"&&(l.line_type=String(s.value.line_type)),s.value.employee_id&&(l.employee_id=String(s.value.employee_id)),l}let f=null;function L(){f&&clearTimeout(f),f=setTimeout(()=>{w.replace({query:M()}).catch(()=>{})},120)}c(()=>i.query,l=>{const r=l[h]==="after"?"after":"prev",o=l.date||"",e={company_id:l.company_id||"",department_id:l.department_id||"",line_type:l.line_type||"all",employee_id:l.employee_id||""};let y=!1;r!==a.value&&(a.value=r,y=!0),o&&o!==n.value&&(n.value=o,y=!0),(e.company_id!==s.value.company_id||e.department_id!==s.value.department_id||e.line_type!==s.value.line_type||e.employee_id!==s.value.employee_id)&&(s.value=e,y=!0),y&&v()}),c(()=>[a.value,n.value,s.value.company_id,s.value.department_id,s.value.employee_id,s.value.line_type],()=>{L(),v()}),c(()=>d.selectedStatus,()=>v());const S=H(()=>C.value||[]),N=async l=>{confirm("Are you sure to delete this application?")&&(await d.deleteLeaveApplication(l),await v())},V=()=>w.go(-1),P=()=>{L()};return(l,r)=>{const o=O("RouterLink");return _(),m("div",Y,[t("div",Z,[t("button",{class:"btn-3",onClick:V},r[7]||(r[7]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),t("h1",ee,u(a.value==="after"?"Upcoming Leave Applications":"Leave History of Previous Week"),1),r[8]||(r[8]=t("div",null,null,-1))]),t("div",te,[b(G,{company_id:s.value.company_id,"onUpdate:company_id":r[0]||(r[0]=e=>s.value.company_id=e),department_id:s.value.department_id,"onUpdate:department_id":r[1]||(r[1]=e=>s.value.department_id=e),employee_id:s.value.employee_id,"onUpdate:employee_id":r[2]||(r[2]=e=>s.value.employee_id=e),line_type:s.value.line_type,"onUpdate:line_type":r[3]||(r[3]=e=>s.value.line_type=e),"with-type":!0,"initial-value":l.$route.query,onFilterChange:P},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",null,[g(t("select",{"onUpdate:modelValue":r[4]||(r[4]=e=>a.value=e),class:"input-1"},r[9]||(r[9]=[t("option",{value:"prev"},"Leave history of previous week",-1),t("option",{value:"after"},"Upcoming Leave Applications",-1)]),512),[[D,a.value]])]),t("div",null,[g(t("input",{id:"monthOrDate",type:"date","onUpdate:modelValue":r[5]||(r[5]=e=>n.value=e),class:"input-1"},null,512),[[I,n.value]])]),t("div",null,[g(t("select",{"onUpdate:modelValue":r[6]||(r[6]=e=>x(d).selectedStatus=e),class:"input-1"},r[10]||(r[10]=[t("option",{value:""},"All",-1),t("option",{value:"Pending"},"Pending",-1),t("option",{value:"Approved"},"Approved",-1),t("option",{value:"Rejected"},"Rejected",-1)]),512),[[D,x(d).selectedStatus]])]),t("div",null,[t("button",{onClick:v,class:"btn-3"},r[11]||(r[11]=[t("i",{class:"far fa-sync"},null,-1),t("span",null,"Refresh",-1)]))])]),x(d).loading?(_(),m("div",re,[b(J)])):(_(),m("div",se,[t("div",le,[t("table",oe,[r[16]||(r[16]=t("thead",null,[t("tr",{class:"bg-gray-200"},[t("th",{class:"border border-gray-300 px-2 text-left"},"#"),t("th",{class:"border border-gray-300 px-2 text-left"},"Employee Name"),t("th",{class:"border border-gray-300 px-2 text-left"},"Last Working Day"),t("th",{class:"border border-gray-300 px-2 text-left"},"Resumption Date"),t("th",{class:"border border-gray-300 px-2 text-left"},"Leave Period"),t("th",{class:"border border-gray-300 px-2 text-left"},"Total Days"),t("th",{class:"border border-gray-300 px-2 text-left"},"Type"),t("th",{class:"border border-gray-300 px-2 text-left"},"Status"),t("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),t("tbody",null,[(_(!0),m(Q,null,W(S.value,(e,y)=>{var U;return _(),m("tr",{key:y,class:"border-b border-gray-200 hover:bg-blue-200"},[t("td",de,u(y+1),1),t("td",ae,u(((U=e==null?void 0:e.user)==null?void 0:U.name)||"Unknown"),1),t("td",ne,u(e==null?void 0:e.last_working_date),1),t("td",ue,u(e==null?void 0:e.resumption_date),1),t("td",ie,u(e==null?void 0:e.leave_period),1),t("td",ye,[t("div",{innerHTML:e.duration||(e==null?void 0:e.total_leave_days)},null,8,_e)]),t("td",ve,u(e==null?void 0:e.application_types),1),t("td",me,u((e==null?void 0:e.status)||"N/A"),1),t("td",pe,[t("div",fe,[b(o,{to:{name:"LeaveApplicationShow",params:{id:e==null?void 0:e.id}},class:"btn-icon"},{default:T(()=>r[12]||(r[12]=[t("i",{class:"far fa-eye"},null,-1)])),_:2,__:[12]},1032,["to"]),(e==null?void 0:e.status)!=="Approved"?(_(),z(o,{key:0,to:{name:"LeaveApplicationEdit",params:{id:e==null?void 0:e.id}},class:"btn-icon"},{default:T(()=>r[13]||(r[13]=[t("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[13]},1032,["to"])):R("",!0),t("button",{onClick:xe=>N(e==null?void 0:e.id),class:"btn-icon text-red-500"},r[14]||(r[14]=[t("i",{class:"far fa-trash"},null,-1)]),8,ce)])])])}),128)),S.value.length?R("",!0):(_(),m("tr",be,r[15]||(r[15]=[t("td",{colspan:"9",class:"p-1 text-center text-red-500"},"No application found",-1)])))])])])]))])}}};export{Ce as default};
