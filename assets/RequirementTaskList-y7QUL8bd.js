import{L as ee}from"./LoaderView-tNmOihNT.js";import{O as F}from"./OverlyModal-DGZOkjeQ.js";import{d as te}from"./datetime-DcVwRp76.js";import{_ as J}from"./DepartmentChip-B7oG-AVa.js";import{_ as se}from"./TaskTreeChildrenTable-pGWqVLNd.js";import{r as T,A as Q,c as p,o as s,a as t,q as V,g as y,t as q,j as ae,k as c,n as v,i as E,L as ie,b as re,u as le,z as W,x as G,e as ne,m as oe,f as w,F as B,y as O}from"./index-DmCKkijE.js";import{_ as de}from"./TaskAddForm-BFJegFx5.js";import{_ as ue}from"./TaskEditForm-DG7DgDHY.js";import{_ as me}from"./TaskHeader-QOf0LJdq.js";import{_ as ce}from"./TaskUserAssignForm-mk5lSzt_.js";import{u as pe}from"./task-priority-0djjiPuA.js";import{u as fe}from"./useRequirementStore-CgQe6nX7.js";import{u as ke}from"./useTaskStore-27uui8b3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./url-CePbr-gY.js";import"./TaskAssignedUsers-B8ozT_cW.js";import"./UserChip-DUkAJMuo.js";import"./TaskUrgentBadge-Dp_SWOgr.js";import"./TaskStatus-f8cd8Qwe.js";import"./RequiredIcon-CX0dwZwD.js";import"./company-C3y3EF8r.js";import"./CompanyDepartmentSelectInput-CJKcj3lY.js";import"./SelectDropdown-CALNdlZG.js";import"./SectionLoading-CiZTY1Bu.js";import"./TextWithHr-DuqOhveC.js";import"./TaskUrgencyInput-CVyTbdtE.js";import"./tags-Da0-YFMK.js";import"./MultiselectDropdown-dOmi45A4.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-C33tH98Q.js";import"./task-DLMUqqc3.js";import"./EmployeeDropdownInput-8vZG6sdx.js";import"./SearchInput-J8LWklFn.js";import"./user-BZV4LpVY.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-B4ocNJ4h.js";import"./TaskUserChip-CrBSFLHX.js";import"./requirement-DCz0s5Am.js";const ye={class:"flex-grow rounded overflow-y-auto"},ve={class:"items-start group"},ge={class:"flex items-start justify-between w-full gap-4"},xe={class:"flex gap-2 flex-grow items-center"},he={key:0,class:"text-xl font-semibold text-blue-500"},_e={class:"font-semibold text-blue-800 line-clamp-1"},be={class:"flex items-center justify-between gap-16 w-full"},we={class:"flex-shrink-0 flex items-center gap-6"},Te={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},qe={class:"text-xs text-gray-400 whitespace-nowrap"},Ce={class:"flex items-center gap-2"},Ie={class:"ml-0 col-span-full"},K={__name:"RequirementDetailItemWithTaskList",props:{detail:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number,default:0}},emits:["commentButtonClick","editClick","taskAddClick","employeeAssignClick"],setup(a,{emit:L}){const d=L;function f(i){d("editClick",i)}function N(i){d("employeeAssignClick",i)}const l=T([]),k=localStorage.getItem("sub_task_opened_list");if(k)try{l.value=JSON.parse(k)}catch{l.value=[]}return Q(l,i=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(i))},{deep:!0}),(i,n)=>{var u,$,S,C;return s(),p("div",{class:V(["flex w-full text-gray-800 bg-white border rounded-md shadow",{"border-blue-500":a.index%2===0,"border-purple-500":a.index%2===1}])},[t("div",ye,[t("div",ve,[t("div",{class:V(["task-details py-3 shadow-slate-100 flex flex-wrap z-30 pl-3",{"shadow-sm":a.treeLevel>0}])},[t("div",ge,[t("div",xe,[a.index!==void 0?(s(),p("div",he,q(a.index+1)+". ",1)):y("",!0),t("div",_e,q(a.detail.title),1)])]),t("div",be,[t("div",we,[t("div",Te,[t("div",qe,[n[0]||(n[0]=t("i",{class:"fas fa-clock"},null,-1)),ae(" "+q(c(te)(($=(u=a.detail)==null?void 0:u.requirement)==null?void 0:$.submission_date)),1)])]),t("div",Ce,[n[1]||(n[1]=t("span",{class:"text-sm text-gray-600"},"From",-1)),v(J,{department:(S=a.detail.requirement)==null?void 0:S.from_department},null,8,["department"]),n[2]||(n[2]=t("span",{class:"text-sm text-gray-600"},"To",-1)),v(J,{department:(C=a.detail.requirement)==null?void 0:C.to_department},null,8,["department"])])])])],2),t("div",Ie,[v(se,{childrenTasks:a.detail.tasks,parentTask:{},isMyTask:a.isMyTask,"hide-buttons":a.hideButtons,"hide-assigned-users":a.hideAssignedUsers,"parent-tree-level":a.treeLevel,onEditClick:f,onEmployeeAssignClick:N,class:"*:mb-0",taskLinkTo:g=>({name:"RequirementTaskShow",params:{id:(g==null?void 0:g.id)||0}})},{"tree-item-end":E(({task:g,level:D})=>[ie(i.$slots,"item-end",{level:D,task:g})]),_:3},8,["childrenTasks","isMyTask","hide-buttons","hide-assigned-users","parent-tree-level","taskLinkTo"])])])])],2)}}},Ae={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},Le={class:"mb-4"},$e={key:4,class:"text-center py-4 text-red-500"},Se={class:"relative min-h-[20vh]"},De={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 rounded-t-md py-2 px-4 flex items-center"},Me={class:"font-semibold flex items-center gap-2"},Ue={class:"text-white text-base"},Be={class:"border rounded-b-md"},Oe={class:"p-4 space-y-4"},Ee={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},ht={__name:"RequirementTaskList",setup(a){const L=ke(),d=fe(),f=re(),N=le(),l=T(""),k=T(null),i=T(!1),n=W({parentId:0,requirementId:0}),u=W({taskId:0,isOpen:!1}),$=G(()=>{const r=f.query["user-ids"]||null,e=d.requirementDetails.flatMap(m=>(m.tasks||[]).flatMap(x=>{var I;return r?(I=x.users)==null?void 0:I.filter(U=>r.includes(U.id)):x.users}));return[...new Map(e.map(m=>[m.id,m])).values()].sort((m,x)=>m.id-x.id)}),S=T(null),C=T([]),{saveTaskPriority:g,listHasRearranged:D}=pe(()=>L.taskListTree,0);ne(()=>{console.log("Task List Mounted"),l.value="loading",_()});async function _(){let r;await d.fetchRequirementsWithTasks({...f.query,page:1}),l.value="",C.value=r.query_log||[]}const R=r=>{i.value=!0,n.parentId=r},j=r=>{u.taskId=r,u.isOpen=!0};async function P(){k.value=null,i.value=!1,n.parentId=0,l.value="loading",await _()}async function X(){i.value=!1,n.parentId=0,await _()}async function Y(){l.value="loading",await g()&&await _()}function Z(r){return d.requirementDetails.filter(e=>(e.tasks||[]).some(M=>(M.users||[]).some(m=>m.id===r)))}Q(()=>({...f.query}),async()=>{try{L.resetTaskList(),l.value="loading",await _()}catch{console.warn("...")}});const z=G({get(){return{...f.query}},set(r){localStorage.removeItem("sub_task_opened_list"),N.push({query:{...r}})}});return(r,e)=>{var m,x,I,U,H;const M=oe("UserAvatar");return s(),p("div",Ae,[k.value?(s(),w(F,{key:0},{default:E(()=>[v(ue,{taskId:k.value,onClose:e[0]||(e[0]=o=>k.value=null),onUpdated:P},null,8,["taskId"])]),_:1})):y("",!0),i.value?(s(),w(F,{key:1},{default:E(()=>[v(de,{parentTaskId:n.parentId,requirementId:n.requirementId,onClose:X,onTaskCreated:P},null,8,["parentTaskId","requirementId"])]),_:1})):y("",!0),u.isOpen?(s(),w(F,{key:2,class:"*:max-w-4xl"},{default:E(()=>[v(ce,{taskId:u.taskId,onCancelClick:e[1]||(e[1]=()=>{u.isOpen=!1,u.taskId=0}),onSuccess:e[2]||(e[2]=()=>{u.isOpen=!1,u.taskId=0,l.value="loading",_()})},null,8,["taskId"])]),_:1})):y("",!0),v(me,{modelValue:z.value,"onUpdate:modelValue":e[3]||(e[3]=o=>z.value=o),onClickAddTask:R,onClickPrioritySave:Y,onClickPriorityDiscard:e[4]||(e[4]=()=>c(D)?S.value.resetItems:null),"list-has-rearranged":c(D),isMyTask:c(f).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((x=(m=c(f))==null?void 0:m.query)==null?void 0:x["query-log"])=="true"?(s(!0),p(B,{key:3},O(C.value,(o,b)=>(s(),p("div",{key:b,class:"text-xs text-gray-500"},[t("div",Le,q(o.raw_query),1)]))),128)):y("",!0),c(d).error?(s(),p("div",$e,q(c(d).error),1)):y("",!0),t("div",Se,[((I=c(f).query)==null?void 0:I.view)==="userwise"?(s(!0),p(B,{key:0},O($.value,o=>(s(),p("div",{key:o.id,class:"my-4 shadow rounded-md"},[t("div",De,[t("div",Me,[v(M,{user:o},null,8,["user"]),t("div",Ue,q(o.label),1)])]),t("div",Be,[t("div",Oe,[(s(!0),p(B,null,O(Z(o.id),(b,h)=>(s(),w(K,{key:b.id,index:h,detail:b,onEditClick:e[5]||(e[5]=A=>k.value=A),onAddClick:e[6]||(e[6]=A=>R(A)),onEmployeeAssignClick:e[7]||(e[7]=A=>j(A)),class:""},null,8,["index","detail"]))),128))])])]))),128)):(s(!0),p(B,{key:1},O(c(d).requirementDetails,(o,b)=>(s(),w(K,{key:o.id,index:b,detail:o,onEditClick:e[8]||(e[8]=h=>k.value=h),onAddClick:e[9]||(e[9]=h=>R(h)),onEmployeeAssignClick:e[10]||(e[10]=h=>j(h)),class:"mt-6"},null,8,["index","detail"]))),128)),l.value!=="loading"&&((U=c(d).requirementDetails)==null?void 0:U.length)===0?(s(),p("div",Ee," No tasks found. ")):y("",!0),l.value==="loading"?(s(),w(ee,{key:3,class:V(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((H=c(d).requirementDetails)==null?void 0:H.length)===0?"justify-center":""]])},null,8,["class"])):y("",!0)])])}}};export{ht as default};
