import{_ as ke}from"./CommentModal-CMkp62Ro.js";import{_ as ye}from"./DraggableList.vue_vue_type_script_setup_true_lang-Duhyizpf.js";import{L as ge}from"./LoaderView-Bu3vsHDy.js";import{O as Y}from"./OverlyModal-MehvcKxg.js";import{_ as pe}from"./TaskAddForm-je4XF6xb.js";import{_ as fe}from"./TaskEditForm-CPdpx2-n.js";import{_ as xe}from"./TaskHeader-BtkZL3aO.js";import{r as L,f as Q,x as M,c as r,o as a,k as i,a as e,F as V,e as G,s as K,t as x,d as T,b as S,n as k,j as v,w as D,q as ae,p as be,m as P,N as ve,C as he,g as we,u as Te,E as se,h as Ce,S as $e}from"./index-_fMFsOvU.js";import{_ as le,T as ie,a as re,b as ne}from"./TaskUrgentBadge-jKKyPN1a.js";import{_ as _e,a as oe}from"./TaskStatus-l6K5jE-q.js";import{b as de,c as O}from"./datetime-y2WWmmYq.js";import{o as Ae}from"./url-Buz9GlSr.js";import{T as ue}from"./TaskIsClosedBadge-Du0rdImt.js";import{_ as Ie}from"./TaskSupervisorAndEmployee-DdiYdsai.js";import{_ as Me}from"./TaskUserAssignForm-ChPq6UE8.js";import{_ as qe}from"./UserChip-ngjP0i00.js";import{m as ce}from"./task-tree-wODDhwOu.js";import{u as Le}from"./task-priority-BgmefJ8o.js";import{u as Be}from"./useTaskStore-nO1bY8RM.js";import"./useCommentStore-BDdoyWQe.js";import"./RequiredIcon-CQM4KW7m.js";import"./company-CVlXfDzS.js";import"./requirement-CNQJL5Tm.js";import"./CompanyDepartmentSelectInput-vp6YDVbW.js";import"./SelectDropdown-Cb8f6lFw.js";import"./SectionLoading-BJXaATJg.js";import"./TextEditor-B-Vwsx2v.js";import"./TextWithHr-qOjKQ8vG.js";import"./TaskUrgencyInput-BCXRYXeT.js";import"./tags-BhUIkvO_.js";import"./task-BWqfNyRu.js";import"./EmployeeDropdownInput-D11xBWpM.js";import"./SearchInput-CvdkEPw-.js";import"./TaskTitle-B_TbeTk3.js";import"./user-zrdLDqQl.js";const Se={class:"w-full"},De={key:0,class:"w-full"},Ee={class:"border-y text-center py-2 px-1 border-gray-200"},Ue={key:0,class:"text-base font-semibold text-purple-600"},Oe={class:"border px-3 py-1 border-gray-200 relative"},je={class:"flex items-center justify-between gap-2"},Pe={class:"flex items-center gap-3"},ze={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Ne={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},Re={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Fe={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},Ve=["href","onClick"],He={class:"border px-3 py-1 border-gray-200"},Je={class:"flex gap-2 justify-between items-center relative w-full"},We={class:"shrink-0"},Ge=["href","onClick"],Ke={class:"border px-3 py-1 border-gray-200 text-center"},Qe={key:0,class:"text-gray-500 text-sm"},Xe={class:"font-semibold text-blue-800 whitespace-nowrap"},Ye={class:"border px-3 py-1 border-gray-200 text-center"},Ze={key:0,class:"ml-4 text-gray-500 text-sm"},et={class:"text-blue-500 font-semibold whitespace-nowrap"},tt={class:"border px-3 py-1 border-gray-200 text-center"},st={key:0,class:"text-gray-500 text-sm whitespace-nowrap"},at={class:"font-semibold text-blue-800"},lt={class:"border-y px-3 border-gray-200 sticky right-0 border-l bg-sky-50"},it={class:"flex justify-end flex-wrap gap-2 py-2"},rt={class:"flex gap-1 items-center text-sm"},nt={key:1,class:"text-red-800 italic"},ot=["href"],dt={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},parentTask:{type:Object},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick"],setup(t,{emit:b}){const o=t,u=L(!1),A=Q(),g=M(()=>u.value?o.childrenTasks:o.childrenTasks.slice(0,o.maxItem)),I=M(()=>u.value?[]:o.childrenTasks.slice(o.maxItem));function B(){u.value=!u.value}const c=b;return(m,n)=>{var p;return a(),r("div",Se,[((p=t.childrenTasks)==null?void 0:p.length)>0?(a(),r("table",De,[n[5]||(n[5]=e("thead",null,[e("tr",null,[e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Date "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Started "),e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(a(!0),r(V,null,G(g.value,(s,q)=>{var h;return a(),r("tr",{key:s.id,class:K(["group/sub-task-row",{" bg-green-400/20":s.status=="COMPLETED"," bg-white hover:bg-slate-50":s.status!=="COMPLETED"}])},[e("td",Ee,[q!==void 0?(a(),r("div",Ue,x(q+1)+". ",1)):i("",!0)]),e("td",Oe,[e("div",je,[e("div",null,[e("div",Pe,[T(le,{titleClass:"text-sm",task:s,"sub-tasks-open":!1,isMyTask:t.isMyTask,to:t.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",ze,[e("div",Ne,[n[1]||(n[1]=e("i",{class:"fas fa-clock"},null,-1)),S(" "+x(k(de)(s.created_at)),1)]),e("div",Re,[s!=null&&s.is_important?(a(),v(ie,{key:0})):i("",!0),s!=null&&s.is_urgent?(a(),v(re,{key:1})):i("",!0)]),e("div",Fe,[n[2]||(n[2]=e("i",{class:"fas fa-tasks"},null,-1)),S(" "+x(s==null?void 0:s.todos_count),1)])])]),!s.is_closed&&!t.hideButtons?(a(),r("a",{key:0,href:`/tasks/edit/${s.id}`,onClick:D(E=>c("editClick",s.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},n[3]||(n[3]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ve)):i("",!0)])]),e("td",He,[e("div",Je,[T(_e,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:s.users||[],isTargetTask:s.is_target,maxItem:1,"route-to":E=>`/tasks?status=not-completed&view=userwise&user-ids=${E.id}`},null,8,["users","isTargetTask","route-to"]),e("div",We,[!s.is_closed&&!t.hideButtons?(a(),r("a",{key:0,href:`/tasks/${s.id}/assign-users`,onClick:D(E=>c("employeeAssignClick",s.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},n[4]||(n[4]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,Ge)):i("",!0)])])]),e("td",Ke,[s.assigned_at?(a(),r("span",Qe,[e("span",Xe,x(k(O)(s.assigned_at)),1)])):i("",!0)]),e("td",Ye,[s.deadline?(a(),r("span",Ze,[e("span",et,x(k(O)(s.deadline)),1)])):i("",!0)]),e("td",tt,[s.started_at?(a(),r("span",st,[e("span",at,x(k(O)(s.started_at)),1)])):i("",!0)]),e("td",lt,[e("div",it,[s.closed_at?(a(),v(ue,{key:0})):i("",!0),T(oe,{status:s==null?void 0:s.status,progressPercent:(s==null?void 0:s.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((h=s==null?void 0:s.children_tasks)==null?void 0:h.length)>0?(a(),v(ne,{key:1,ref_for:!0,ref:"progress",task:s,class:"text-sm w-full"},null,8,["task"])):i("",!0)])])],2)}),128))])])):i("",!0),e("div",rt,[t.childrenTasks.length>0?(a(),r(V,{key:0},[I.value.length>0||u.value?(a(),r("button",{key:0,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border ml-2 mt-2",onClick:D(B,["prevent","stop"])},x(u.value?"Show Less":"Show All"),1)):i("",!0),I.value.length>0?(a(),r("span",nt,x(I.value.length)+" More sub task"+x(I.value.length>1?"s":""),1)):i("",!0)],64)):i("",!0),t.parentTask.level<2&&!t.hideButtons?(a(),r("a",{key:1,href:`/tasks/add?parent_id=${t.parentTask.id}&back-to=${encodeURIComponent(k(A).path+"?"+k(Ae)(k(A).query)).toLowerCase()}`,class:K(["hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-indigo-300 mt-2",{"ml-2":t.childrenTasks.length===0,"ml-3":t.childrenTasks.length>0}]),onClick:n[0]||(n[0]=D(s=>c("addClick",t.parentTask.id),["stop","prevent"]))},n[6]||(n[6]=[e("i",{class:"fas fa-plus"},null,-1),S(" Add Sub Task ")]),10,ot)):i("",!0)])])}}},ut={class:"flex w-full text-gray-800 bg-white"},ct={key:0,class:"border-l border-gray-200 last:border-l-0"},mt={class:"items-start group"},kt={class:"flex items-start justify-between w-full gap-4 mb-2"},yt={class:"flex gap-2 flex-grow items-center"},gt={key:0,class:"text-xl font-semibold text-blue-500"},pt={class:"justify-end items-center gap-2 ml-auto flex flex-wrap flex-shrink-0 sticky right-4"},ft={key:0},xt={class:"flex items-center justify-between gap-16 w-full"},bt={class:"flex-shrink-0"},vt={class:"flex items-center"},ht={key:0,class:"flex gap-4 items-center mr-3"},wt={key:1,class:"text-gray-500 text-sm"},Tt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ct={class:"text-xs text-gray-400 whitespace-nowrap"},$t={class:"children-task-table ml-0 col-span-full"},_t={class:"flex gap-3 items-center px-3 flex-wrap gap-y-8"},At={class:"text-right text-sm flex items-center gap-4 mt-2 opacity-80"},It={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 whitespace-nowrap"},Mt={key:1,class:"text-sm"},qt={class:"text-blue-500 font-semibold whitespace-nowrap"},Lt={key:2,class:"text-sm"},Bt={class:"font-semibold text-blue-800 whitespace-nowrap"},St={key:3,class:"text-sm"},Dt={class:"font-semibold text-blue-500 whitespace-nowrap"},Et={key:4,class:"text-sm"},Ut={class:"font-semibold text-green-500 whitespace-nowrap"},Ot={class:"flex items-center justify-center w-full md:w-auto sm:ml-auto"},jt={key:0,class:"flex gap-2 ml-4 items-center text-xs"},Pt=["href"],zt=["href"],me={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(t,{emit:b}){const o=t,u=Q(),A=L(null),g=b;function I(f){g("editClick",f)}function B(f){g("employeeAssignClick",f)}const c=L([]),m=localStorage.getItem("sub_task_opened_list");if(m)try{c.value=JSON.parse(m)}catch{c.value=[]}const n=M(()=>O(o.task.assigned_at)),p=M(()=>O(o.task.deadline)),s=M(()=>O(o.task.started_at)),q=M(()=>O(o.task.completed_at)),h=M({get:()=>c.value.includes(o.task.id),set:f=>{const l=c.value.includes(o.task.id);f&&!l?c.value.push(o.task.id):!f&&l&&(c.value=c.value.filter(C=>C!==o.task.id))}});ae(c,f=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(f))},{deep:!0});async function E(){var f,l,C;if(confirm("Are you sure?"))try{await he.post(`/tasks/${(f=o.task)==null?void 0:f.id}/convert-to-requirement`)}catch($){alert((C=(l=$==null?void 0:$.response)==null?void 0:l.data)==null?void 0:C.message)}}return(f,l)=>{var $,j,z,N,H,R,J,W,F;const C=be("RouterLink");return a(),r("div",ut,[t.treeLevel>0?(a(),r("div",ct,l[4]||(l[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):i("",!0),e("div",{class:K(["flex-grow rounded pb-3 overflow-y-auto",{"border-2":t.index,"border-blue-500":t.index%2===0,"border-pink-300":t.index%2===1,"bg-blue-100/30  ":t.task.closed_at,"bg-green-100  ":(($=t.task)==null?void 0:$.progress_percent)===100,"bg-white hover:bg-gray-50":((j=t.task)==null?void 0:j.progress_percent)<100&&!t.task.closed_at}])},[e("div",mt,[e("div",{class:K(["task-details py-3 shadow-slate-100 flex flex-wrap z-30 pl-3",{"shadow-sm":t.treeLevel>0}])},[e("div",kt,[e("div",yt,[t.index!==void 0?(a(),r("div",gt,x(t.index+1)+". ",1)):i("",!0),T(le,{task:t.task,"sub-tasks-open":h.value,"is-my-task":t.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",pt,[t.task.closed_at?(a(),v(ue,{key:0})):i("",!0),T(oe,{status:(z=t.task)==null?void 0:z.status,progressPercent:((N=t.task)==null?void 0:N.progress_percent)||0,class:"w-[150px] text-center !border-2"},null,8,["status","progressPercent"]),((R=(H=t.task)==null?void 0:H.children_tasks)==null?void 0:R.length)>0?(a(),v(ne,{key:1,ref_key:"progress",ref:A,task:t.task,class:"text-sm w-[150px] text-center"},null,8,["task"])):i("",!0)])]),Object.keys(k(u).query).includes("make-task-convertible")?(a(),r("div",ft,[e("button",{class:"btn-2",onClick:D(E,["prevent"])}," Migrate To Requirement ")])):i("",!0),e("div",xt,[e("div",bt,[e("div",vt,[t.showDraggableHandle||t.task.serial?(a(),r("div",ht,[t.showDraggableHandle?(a(),r("button",{key:0,onMousedown:l[0]||(l[0]=D((..._)=>f.handleDragging&&f.handleDragging(..._),["stop"])),class:"handle"},l[5]||(l[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):i("",!0),t.task.serial?(a(),r("span",wt," #"+x(t.task.serial),1)):i("",!0)])):i("",!0),e("div",Tt,[e("div",Ct,[l[6]||(l[6]=e("i",{class:"fas fa-clock"},null,-1)),S(" "+x(k(de)(t.task.created_at)),1)]),(J=t.task)!=null&&J.is_important?(a(),v(ie,{key:0,class:"flex-none"})):i("",!0),(W=t.task)!=null&&W.is_urgent?(a(),v(re,{key:1,class:"flex-none"})):i("",!0)])])]),t.hideAssignedUsers?i("",!0):(a(),v(Ie,{key:0,task:t.task,"tree-level":t.treeLevel,class:"flex-nowrap grow shrink","employee-route-to":_=>({query:{...k(u).query,view:"userwise","company-id":_.company_id,"user-ids":_.id}})},null,8,["task","tree-level","employee-route-to"]))])],2),e("div",$t,[T(dt,{childrenTasks:t.task.children_tasks,parentTask:t.task,isMyTask:t.isMyTask,"hide-buttons":t.hideButtons,"hide-assigned-users":t.hideAssignedUsers,"parent-tree-level":t.treeLevel,onEditClick:I,onAddClick:l[1]||(l[1]=_=>g("addClick",_)),onEmployeeAssignClick:B},{"tree-item-end":P(({task:_,level:y})=>[ve(f.$slots,"item-end",{level:y,task:_})]),_:3},8,["childrenTasks","parentTask","isMyTask","hide-buttons","hide-assigned-users","parent-tree-level"])])]),e("div",_t,[e("div",At,[t.task.is_target?(a(),r("div",It,l[7]||(l[7]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),S(" TARGET TASK ")]))):i("",!0),p.value?(a(),r("span",Mt,[l[8]||(l[8]=e("span",{class:"italic text-gray-500"},"Deadline: ",-1)),e("span",qt,x(p.value),1)])):i("",!0),n.value?(a(),r("span",Lt,[l[9]||(l[9]=e("span",{class:"italic text-gray-500"},"Assign: ",-1)),e("span",Bt,x(n.value),1)])):i("",!0),s.value?(a(),r("span",St,[l[10]||(l[10]=e("span",{class:"italic text-gray-500"},"Started: ",-1)),e("span",Dt,x(s.value),1)])):i("",!0),q.value?(a(),r("span",Et,[l[12]||(l[12]=e("span",{class:"italic text-gray-500"},"Completed: ",-1)),e("span",Ut,[S(x(q.value)+" ",1),l[11]||(l[11]=e("i",{class:"fas fa-check-circle"},null,-1))])])):i("",!0)]),e("div",Ot,[t.hideButtons?i("",!0):(a(),r("div",jt,[t.task.is_closed?i("",!0):(a(),r("a",{key:0,href:`/tasks/edit/${t.task.id}`,onClick:l[2]||(l[2]=D(_=>g("editClick",t.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs whitespace-nowrap"},l[13]||(l[13]=[e("i",{class:"fas fa-edit"},null,-1),S(" Edit ")]),8,Pt)),t.task.is_closed?i("",!0):(a(),r("a",{key:1,href:`/tasks/${t.task.id}/assign-users`,onClick:l[3]||(l[3]=D(_=>g("employeeAssignClick",t.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2 whitespace-nowrap"},l[14]||(l[14]=[e("i",{class:"fas fa-users-cog"},null,-1),S(" Manage ")]),8,zt)),T(C,{to:{name:"TaskReports",params:{id:(F=t.task)==null?void 0:F.id},query:{"is-my-task":t.isMyTask},hash:"#task-reports"},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2 whitespace-nowrap"},{default:P(()=>l[15]||(l[15]=[e("i",{class:"far fa-file-alt"},null,-1),S(" Reports ")])),_:1,__:[15]},8,["to"])]))])])],2)])}}},Nt={class:"w-full"},Rt={class:"w-full table-fixed bg-white rounded-md"},Ft={class:"border rounded-md align-top bg-blue-50"},Vt={key:0,class:"sticky top-16 py-2 px-2 z-40 bg-blue-100/70"},Ht={class:"space-y-4 mt-4"},Jt={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(t,{emit:b}){const o=t,u=Q(),A=b,g=M(()=>o.tasks.reduce((c,m)=>(c.push(...m.users.filter(n=>!c.find(p=>p.id==n.id&&n.id))),c),[]).filter(c=>o.selectedUserId?c.id==o.selectedUserId:!0)),I=c=>{const n=o.tasks.filter(p=>p.users.some(s=>s.id===c));return ce(n,{...u.query,"user-ids":c})},B=M(()=>g.value.map(c=>{const m=I(c.id);return{...c,tasks:m}}));return(c,m)=>(a(),r("div",Nt,[e("table",Rt,[e("tbody",null,[(a(!0),r(V,null,G(B.value,n=>{var p;return a(),r("tr",{key:n.id},[e("td",Ft,[e("div",null,[((p=n.tasks)==null?void 0:p.length)>0?(a(),r("div",Vt,[T(qe,{user:n,class:""},null,8,["user"])])):i("",!0),e("div",Ht,[(a(!0),r(V,null,G(n.tasks,(s,q)=>(a(),v(me,{key:s.id,task:s,class:"!border-0",index:q,isMyTask:t.isMyTask,onCommentButtonClick:m[0]||(m[0]=h=>A("commentButtonClick",c.item.id)),onEditClick:m[1]||(m[1]=h=>A("editClick",h)),onAddClick:m[2]||(m[2]=h=>A("addClick",h)),onEmployeeAssignClick:m[3]||(m[3]=h=>A("employeeAssignClick",h))},null,8,["task","index","isMyTask"]))),128))])])])])}),128))])])]))}},Wt={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},Gt={class:"mb-4"},Kt={class:"relative min-h-[26vh]"},Qt={key:0,class:"text-center py-4 text-red-500"},Xt={key:1},Yt={class:"flex items-stretched"},Zt={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},es=1,Us={__name:"TaskList",setup(t){const b=Be(),o=we(),u=Q(),A=Te(),g=L(""),I=L(!1),B=L(null),c=M(()=>{var y;return((y=o==null?void 0:o.user)==null?void 0:y.role)==="employee"||!(o!=null&&o.isAdminMood)?!0:!!u.query["user-ids"]}),m=L(null),n=L(!1),p=se({parentId:0,requirementId:0}),s=se({taskId:0,isOpen:!1}),q=L(null),h=L([]),{handleItemsPriorityUpdate:E,saveTaskPriority:f,listHasRearranged:l}=Le(()=>b.taskListTree,0);Ce(async()=>{console.log("Task List Mounted"),g.value="loading",u.query.status||A.push({query:{...u.query,status:"not-completed"}}),await $()});let C;async function $(){let y;C=new AbortController,console.log({taskAbortController:C}),u.name==="MyTaskList"?y=await b.fetchMyTasks({...u.query,page:1},{signal:C.signal}):y=await b.fetchTasks({...u.query,page:1},{signal:C.signal}),g.value="",h.value=y.query_log||[]}const j=y=>{n.value=!0,p.parentId=y},z=y=>{s.taskId=y,s.isOpen=!0},N=y=>{B.value=y,I.value=!0},H=()=>{I.value=!1,B.value=null};async function R(){m.value=null,n.value=!1,p.parentId=0,g.value="loading",await $()}async function J(){n.value=!1,p.parentId=0,await $()}async function W(){g.value="loading",await f()&&await $()}ae(()=>({...u.query}),async()=>{try{b.resetTaskList(),g.value="loading",await $()}catch{console.warn("...")}});const F=M({get(){return{...u.query}},set(y){localStorage.removeItem("sub_task_opened_list"),A.push({query:{...y}})}}),_=M(()=>{var d;const y={...u.query};return u.name=="MyTaskList"&&(y["user-ids"]=(d=o==null?void 0:o.user)==null?void 0:d.id),Array.isArray(b.tasks)?ce(b.tasks,y):[]});return $e(()=>{b.tasks.value=null,C&&C.abort()}),(y,d)=>{var Z,ee,te;return a(),r("div",Wt,[m.value?(a(),v(Y,{key:0},{default:P(()=>[T(fe,{taskId:m.value,onClose:d[0]||(d[0]=w=>m.value=null),onUpdated:R},null,8,["taskId"])]),_:1})):i("",!0),n.value?(a(),v(Y,{key:1},{default:P(()=>[T(pe,{parentTaskId:p.parentId,requirementId:p.requirementId,onClose:J,onTaskCreated:R},null,8,["parentTaskId","requirementId"])]),_:1})):i("",!0),s.isOpen?(a(),v(Y,{key:2,class:"*:max-w-4xl"},{default:P(()=>[T(Me,{taskId:s.taskId,onCancelClick:d[1]||(d[1]=()=>{s.isOpen=!1,s.taskId=0}),onSuccess:d[2]||(d[2]=()=>{s.isOpen=!1,s.taskId=0,g.value="loading",$()})},null,8,["taskId"])]),_:1})):i("",!0),T(xe,{modelValue:F.value,"onUpdate:modelValue":d[3]||(d[3]=w=>F.value=w),onClickAddTask:j,onClickPrioritySave:W,onClickPriorityDiscard:d[4]||(d[4]=()=>k(l)?q.value.resetItems:null),"list-has-rearranged":k(l),isMyTask:k(u).name==="MyTaskList"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((ee=(Z=k(u))==null?void 0:Z.query)==null?void 0:ee["query-log"])=="true"?(a(!0),r(V,{key:3},G(h.value,(w,X)=>(a(),r("div",{key:X,class:"text-xs text-gray-500"},[e("div",Gt,x(w.raw_query),1)]))),128)):i("",!0),e("div",Kt,[k(b).error?(a(),r("div",Qt,x(k(b).error),1)):k(b).tasks.length>0?(a(),r("div",Xt,[((te=k(u).query)==null?void 0:te.view)=="userwise"?(a(),v(Jt,{key:0,tasks:_.value,selectedUserId:k(u).query["user-ids"],isMyTask:k(u).name==="MyTaskList",onCommentButtonClick:d[5]||(d[5]=w=>N(w,y.task.id)),onEditClick:d[6]||(d[6]=w=>m.value=w),onAddClick:d[7]||(d[7]=w=>j(w)),onEmployeeAssignClick:d[8]||(d[8]=w=>z(w))},null,8,["tasks","selectedUserId","isMyTask"])):(a(),v(ye,{key:1,items:_.value,handle:"handle",onItemsUpdate:k(E),class:"space-y-6",ref_key:"draggableTaskList",ref:q},{item:P(({item:w,index:X})=>[e("div",Yt,[T(me,{isMyTask:k(u).name==="MyTaskList",task:w,index:X,showDraggableHandle:!c.value,onCommentButtonClick:d[9]||(d[9]=U=>N(U,y.task.id)),onEditClick:d[10]||(d[10]=U=>m.value=U),onAddClick:d[11]||(d[11]=U=>j(U)),onEmployeeAssignClick:d[12]||(d[12]=U=>z(U)),class:"!border-0 shadow hover:shadow-md"},null,8,["isMyTask","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):g.value!=="loading"?(a(),r("div",Zt," No tasks found. ")):i("",!0),g.value==="loading"?(a(),v(ge,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):i("",!0)]),T(ke,{show:I.value,"commentable-id":B.value,"commentable-type":"task","user-id":es,"on-close":H,onSubmitted:k(b).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Us as default};
