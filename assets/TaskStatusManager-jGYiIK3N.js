import{q as J,r as C,e as B,O as X,A as Z,m as S,c as l,o as a,g as v,t as u,L as z,a as e,f as U,F as W,h as K,j as T,v as q,w as D,x as O,i as F,P as ee,Q as V,d as te,z as se,y as ae,p as le}from"./index-B0NTyrK3.js";import{r as ne,d as oe,u as re}from"./task-DN19OIzq.js";import{L as H}from"./LoaderView-BWudV5AW.js";import{g as ie,b as R}from"./datetime-DcVwRp76.js";import{O as G}from"./OverlyModal-D3A400Yi.js";const de={key:0},ue={key:0},ce={key:1},ve={key:2},fe={key:3},pe={key:1},me=J({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(f){const g=f;let s=0;const i=C(y());let n;function c(){return g.millisecond&&typeof g.millisecond=="number"}function y(){c()?s&&(s-=1e3):s=new Date(g.targetDateTime).getTime()-new Date().getTime();const o=Math.floor(s/1e3%60),p=Math.floor(s/1e3/60%60),h=Math.floor(s/(1e3*60*60)%24),N=Math.floor(s/(1e3*60*60*24));return{total:s,days:N,hours:h,minutes:p,seconds:o}}function _(){i.value=y()}B(()=>{c()&&(s=g.millisecond),console.log("MOUNTED"),_(),n=setInterval(()=>{_(),i.value.total<=0&&clearInterval(n)},1e3)}),X(()=>clearInterval(n)),Z(()=>g.targetDateTime,()=>{_(),clearInterval(n)});const m=S(()=>i.value.days.toString().padStart(2,"0")),k=S(()=>i.value.hours.toString().padStart(2,"0")),r=S(()=>i.value.minutes.toString().padStart(2,"0")),b=S(()=>i.value.seconds.toString().padStart(2,"0"));return(o,p)=>i.value.total>0?(a(),l("span",de,[!o.hideIfZeroValue||m.value!="00"?(a(),l("span",ue,u(m.value)+"d : ",1)):v("",!0),!o.hideIfZeroValue||k.value!="00"?(a(),l("span",ce,u(k.value)+"h : ",1)):v("",!0),!o.hideIfZeroValue||r.value!="00"?(a(),l("span",ve,u(r.value)+"m : ",1)):v("",!0),!o.hideIfZeroValue||b.value!="00"?(a(),l("span",fe,u(b.value)+"s",1)):v("",!0)])):(a(),l("span",pe,[z(o.$slots,"expired")]))}}),ke={class:"mb-2 mt-6"},ye={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},xe={class:"flex justify-center"},be={class:"py-6 w-full text-center"},ge={class:"block mb-2"},he={class:"font-semibold text-red-600 mx-2 text-xl"},_e={class:"mt-2"},Se={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},De={class:"flex justify-between items-center"},Te={key:0,class:"btn-2 bg-green-600 bg-none"},Ce={key:1,class:"btn-2-red"},A=5e3,kt={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(f,{emit:g}){const s=f,i=C(""),n=C(""),c=g,y=C("");let _=0;async function m(){var b,o;if(!i.value)return y.value="Type the task title on input box";clearTimeout(_);try{y.value="",n.value==="deleted"?(n.value="restoring",await ne(s.task.id),n.value="restored"):(n.value="deleting",await oe(s.task.id,{params:{security_check:encodeURIComponent(i.value)}}),n.value="deleted"),n.value=="deleted"?_=setTimeout(()=>{r()},A):c("closeClick")}catch(p){n.value="error",y.value=((o=(b=p.response)==null?void 0:b.data)==null?void 0:o.message)||`Failed to update ${s.type}`}}function k(){n.value==="deleted"&&r(),c("closeClick")}function r(){n.value="",c("delete")}return(b,o)=>{var p,h;return a(),l("form",{class:"p-4 relative",onSubmit:D(m,["prevent"])},[o[7]||(o[7]=e("div",{class:"border-b text-center"},[e("h2",null,"Delete Task")],-1)),e("div",ke,[o[1]||(o[1]=e("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),e("div",null,u((p=f.task)==null?void 0:p.title),1)]),n.value=="deleted"?(a(),l("div",ye,o[2]||(o[2]=[e("i",{class:"fad fa-check-circle fa-4x"},null,-1),e("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(a(),l(W,{key:1},[e("div",xe,[e("div",be,[e("label",ge,[o[3]||(o[3]=T(" Type ")),e("span",he,u((h=f.task)==null?void 0:h.title),1),o[4]||(o[4]=T(" and submit to delete "))]),K(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=N=>i.value=N),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[q,i.value]])])]),o[5]||(o[5]=e("hr",null,null,-1)),e("div",_e,[y.value?(a(),l("div",Se,u(y.value),1)):v("",!0)])],64)),e("div",De,[e("button",{class:O({"btn-2-red":n.value=="deleted","btn-3":n.value!="deleted"}),type:"button",onClick:D(k,["prevent"])},u(n.value==="deleted"?"Delete":"Close"),3),n.value=="deleted"?(a(),l("button",Te,[o[6]||(o[6]=T(" Undo Delete in ")),n.value=="deleted"?(a(),U(me,{key:0,"hide-if-zero-value":!0,millisecond:A})):v("",!0)])):(a(),l("button",Ce,"Delete"))]),n.value=="deleting"||n.value=="restoring"?(a(),U(H,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:F(()=>[T(u(String(n.value).charAt(0).toUpperCase()+String(n.value).slice(1)),1)]),_:1})):v("",!0)],32)}}},$e=ee("task-user",()=>({updateUserStartDate:async(s,i,n)=>await V.patch(`/task-user/task/${s}/user/${i}/update-start-date/${n}`),updateUserFinishDate:async(s,i,n)=>await V.patch(`/task-user/task/${s}/user/${i}/update-finish-date/${n}`)})),we={class:"border-b text-center"},Ee={key:0},Oe={key:1},Ne={class:"text-center font-semibold text-blue-800 my-4"},je={class:"flex justify-center w-full"},Le={class:"py-6 w-4/12"},Pe={class:"block text-xs font-semibold"},Me={class:"mt-3"},Ue={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Re={class:"flex justify-between items-center"},Fe={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(f,{emit:g}){const s=f,i=g,n=$e(),c=C(""),y=C("");async function _(){var k,r;console.log({date:c.value});try{s.type=="start-date"?await n.updateUserStartDate(s.task.id,s.user.id,c.value||"0"):s.type=="finish-date"&&await n.updateUserFinishDate(s.task.id,s.user.id,c.value||"0"),i("updateDate")}catch(b){y.value=((r=(k=b.response)==null?void 0:k.data)==null?void 0:r.message)||`Failed to update ${s.type}`}}function m(k){if(k){const r=s.type==="start-date"?k.started_at:k.completed_at;c.value=ie(r)}}return Z(()=>s.task,k=>{m(k)},{immediate:!0}),B(()=>{m(s.task)}),(k,r)=>(a(),l("form",{class:"p-4",onSubmit:D(_,["prevent"])},[e("div",we,[f.type=="start-date"?(a(),l("h2",Ee,"Edit Start Date")):f.type=="finish-date"?(a(),l("h2",Oe,"Edit Completed Date")):v("",!0)]),e("div",Ne,u(f.task.title),1),e("div",je,[e("div",Le,[e("label",Pe,u(f.type=="start-date"?"Start date":"Completed date"),1),K(e("input",{type:"date","onUpdate:modelValue":r[0]||(r[0]=b=>c.value=b),class:"border py-2 px-4 rounded-md w-full"},null,512),[[q,c.value]])])]),r[3]||(r[3]=e("hr",{class:"mt-4"},null,-1)),e("div",Me,[y.value?(a(),l("div",Ue,u(y.value),1)):v("",!0)]),e("div",Re,[e("button",{class:"btn-3",onClick:r[1]||(r[1]=D(b=>i("closeClick"),["prevent"]))},"Close"),r[2]||(r[2]=e("div",null,[e("button",{class:"btn-2"},"Submit")],-1))])],32))}},Ie={key:0},Ve={key:1,class:"flex"},Ge={key:0,class:"border-r-2 border-dashed pr-6 border-gray-300"},Ae={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Be={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Ze={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},ze={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},We={key:0},Ke=["disabled"],qe=["disabled"],He={class:"text-lg font-semibold text-gray-700"},Qe={class:"text-sm text-gray-500"},Ye={class:"flex flex-grow justify-center items-center"},Je={key:0,class:"flex flex-col justify-center items-center"},Xe={key:1},et={key:1},tt={key:2,class:"flex justify-center items-center flex-col"},st={key:3,class:"flex flex-col justify-center items-center"},at={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},lt={class:"my-6"},nt={class:"text-center font-semibold text-blue-800 mb-4"},ot={class:"text-center my-1"},rt={class:"border px-2 rounded-md bg-gray-50"},it={class:"text-red-600 text-center mt-2 text-sm"},dt={class:"flex justify-between mt-3"},ut={class:"btn-2"},yt={__name:"TaskStatusManager",props:{task:{type:Object},hideTimeline:{type:Boolean,default:!1}},emits:["updateStatus","error"],setup(f,{emit:g}){const s=f,i=g,n=te(),c=C(""),y=C(),_=C(),m=se({user:null,type:""});function k(x){m.user=n.user,m.type=x}const r={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},b=S(()=>(r==null?void 0:r[p.value])||0),o=S(()=>{var x;return{"bg-yellow-50":p.value==="IN_PROGRESS","bg-green-50":p.value==="COMPLETED","bg-red-50":p.value==="PENDING","bg-blue-50":(x=s.task)==null?void 0:x.closed_at}}),p=S(()=>{var x;return(x=s.task)==null?void 0:x.status}),h=S(()=>p.value=="PENDING"?"Start":p.value=="IN_PROGRESS"?"Finish":p.value=="COMPLETED"?"Close":""),N=S(()=>h.value=="Start"?"Start Task":h.value=="Finish"?"Finish Task":h.value=="Close"?"Close Task":"");async function Q(){var x,t;y.value="submitting";try{await re(s.task.id,{status:c.value}),c.value="",i("updateStatus")}catch($){_.value=(t=(x=$.response)==null?void 0:x.data)==null?void 0:t.message,i("error")}finally{y.value=""}}const I=S(()=>h.value=="Start"?"fas fa-play-circle text-blue-500":h.value=="Finish"?"fas fa-stop-circle text-blue-500":""),Y=S(()=>{var x,t,$,j,L,P,d,M;return[{date:R((x=s.task)==null?void 0:x.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((t=s.task)!=null&&t.assigned_at)},{date:R(($=s.task)==null?void 0:$.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((j=s.task)!=null&&j.started_at)||b.value>=r.IN_PROGRESS},{date:R((L=s.task)==null?void 0:L.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((P=s.task)!=null&&P.completed_at)||b.value>=r.COMPLETED},{date:R((d=s.task)==null?void 0:d.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((M=s.task)!=null&&M.deadline)}].sort((w,E)=>w.date===null||E.date===null||new Date(w.date)==new Date(E.date)?w.serial-E.serial:new Date(w.date)-new Date(E.date))});return(x,t)=>{var $,j,L,P;return a(),l("div",{class:O(["border py-8 px-4 rounded",o.value])},[z(x.$slots,"top"),p.value==="BLOCKED"?(a(),l("div",Ie,t[8]||(t[8]=[e("div",{class:"flex flex-col items-center"},[e("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),e("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(a(),l("div",Ve,[f.hideTimeline?v("",!0):(a(),l("div",Ge,[($=s.task)!=null&&$.is_target?(a(),l("div",Ae,t[9]||(t[9]=[e("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),T(" TARGET TASK ")]))):v("",!0),e("ol",Be,[(a(!0),l(W,null,ae(Y.value,(d,M)=>{var w,E;return a(),l("li",{class:"ml-5",key:M},[e("div",Ze,[d.active?(a(),l("i",{key:0,class:O([d.icon,"text-xs"])},null,2)):v("",!0)]),e("div",{class:O({"opacity-30":!d.active})},[e("div",ze,[d.date?(a(),l("span",We,u(d.date),1)):v("",!0),((w=s.task)==null?void 0:w.children_task_count)===0&&d.status==="started"&&d.active?(a(),l("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:t[0]||(t[0]=D(()=>k("start-date"),["prevent"])),disabled:!!s.task.closed_at},u(d.date?"Edit":"Set Date"),9,Ke)):v("",!0),((E=s.task)==null?void 0:E.children_task_count)===0&&d.active&&d.status==="completed"?(a(),l("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:t[1]||(t[1]=D(()=>k("finish-date"),["prevent"])),disabled:!!s.task.closed_at},u(d.date?"Edit":"Set Date"),9,qe)):v("",!0)]),e("h3",He,u(d.title),1),e("p",Qe,u(d.description),1)],2)])}),128))])])),e("div",Ye,[(j=f.task)!=null&&j.closed_at?(a(),l("div",Je,t[10]||(t[10]=[e("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),e("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):p.value==="PENDING"?(a(),l("div",Xe,[((L=f.task)==null?void 0:L.children_task_count)===0?(a(),l("button",{key:0,class:"btn-3 mt-2",onClick:t[2]||(t[2]=D(d=>c.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(a(),l("div",et,t[11]||(t[11]=[e("div",{class:"text-center"},[e("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),e("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):p.value==="IN_PROGRESS"?(a(),l("div",tt,[t[12]||(t[12]=e("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),t[13]||(t[13]=e("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((P=f.task)==null?void 0:P.children_task_count)===0?(a(),l("button",{key:0,class:"btn-3",onClick:t[3]||(t[3]=D(d=>c.value="COMPLETED",["prevent"]))}," Finish Task ")):v("",!0)])):p.value==="COMPLETED"?(a(),l("div",st,[t[14]||(t[14]=e("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),t[15]||(t[15]=e("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),e("button",{class:"btn-3 mt-8",onClick:t[4]||(t[4]=D(d=>c.value="CLOSED",["prevent"]))},"Close Task")])):v("",!0)])])),c.value?(a(),U(G,{key:2},{default:F(()=>{var d;return[e("form",{class:"p-4 rounded relative",onSubmit:D(Q,["prevent"])},[y.value==="submitting"?(a(),U(H,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:F(()=>t[16]||(t[16]=[T("Submitting!")])),_:1,__:[16]})):v("",!0),e("h3",at,u(N.value),1),e("div",lt,[e("div",nt,u((d=f.task)==null?void 0:d.title),1),t[19]||(t[19]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",ot,[t[17]||(t[17]=T(" Want to ")),e("span",rt,[e("i",{class:O(["text-sm",I.value])},null,2),T(" "+u(h.value),1)]),t[18]||(t[18]=T(" the task? "))])]),t[20]||(t[20]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",it,u(_.value),1),e("div",dt,[e("button",{class:"btn-3",onClick:t[5]||(t[5]=D(M=>c.value="",["prevent"]))},"Cancel"),e("button",ut,[e("i",{class:O(["text-xl text-white",I.value])},null,2),T(" "+u(h.value)+" Task ",1)])])])],32)]}),_:1})):v("",!0),m!=null&&m.user?(a(),U(G,{key:3},{default:F(()=>[le(Fe,{task:s.task,user:m.user,type:m.type,onCloseClick:t[6]||(t[6]=d=>m.user=null),onUpdateDate:t[7]||(t[7]=()=>{m.user=null,m.type=null,i("updateStatus")})},null,8,["task","user","type"])]),_:1})):v("",!0)],2)}}};export{Fe as _,kt as a,yt as b};
