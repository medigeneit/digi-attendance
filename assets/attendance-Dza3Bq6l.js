import{B as j,r as p,C as y}from"./index-DnagmssL.js";const N=j("attendance",()=>{const g=p([]),w=p([]),v=p([]),f=p([]),h=p([]),b=p(null),S=p(null),$=p(new Date().toISOString().substring(0,7)),E=p(new Date().toISOString().substring(0,10)),l=p(null),u=p(!1),D=p(null),x=async(e,t)=>{const a=C(t);return g.value.find(n=>n.date===a)},C=e=>{const t=new Date(e),a=String(t.getDate()).padStart(2,"0"),n=t.toLocaleString("en-US",{month:"short"}),o=t.getFullYear();return`${a} ${n} ${o}`},U=async(e,t)=>{var a,n;if(!e||!t){l.value="Invalid user ID or month";return}u.value=!0;try{const o=await y.get(`/user/${e}/attendance/monthly/${t}/log`);w.value=o.data.attendance_logs}catch(o){l.value=((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},A=async(e,t,a,n,o,r=!1)=>{var s,c;if(!a||!e||!t){l.value="Company, Start Date, and End Date are required";return}u.value=!0;try{return(await y.get("/attendance/date-range-summary",{params:{company_id:a,line_type:n||"all",start_date:e,end_date:t,employee_id:o||void 0,ignore_permission:r?"true":"false"}})).data}catch(d){return l.value=((c=(s=d.response)==null?void 0:s.data)==null?void 0:c.message)||"Something went wrong",console.error(l.value),null}finally{u.value=!1}},k=async(e,t,a,n="all",o=null)=>{var d;if(!a||!e||!t){l.value="Company, Start Date, and End Date are required";return}const r=(d=y.defaults.baseURL)==null?void 0:d.replace(/\/$/,"");let s=`flag=excel&company_id=${a}&start_date=${e}&end_date=${t}`;o&&(s+=`&employee_id=${o}`),n&&(s+=`&line_type=${n}`);const c=`${r}/attendance/date-range-summary?${s}`;console.log("ðŸ“ Opening Excel Download URL:",c),window.open(c,"_blank")},M=(e,t,a,n,o=null,r="")=>{if(!a||!e||!t){l.value="Company, Start Date, and End Date are required";return}const s=new URLSearchParams({flag:"pdf",company_id:a,line_type:n,start_date:e,end_date:t});o&&s.append("employee_id",o),r&&s.append("category",r);const c=`/attendance/date-range-summary?${s.toString()}`;window.open(c,"_blank")},O=async(e,t)=>{var a,n;if(!e||!t){l.value="Invalid user ID or month";return}u.value=!0;try{const o=await y.get(`/user/${e}/attendance/monthly/${t}`);g.value=o.data.monthly_logs,b.value=o.data.summary,l.value=null}catch(o){l.value=((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},B=async(e={})=>{var t,a;u.value=!0;try{const n=await y.get("/attendance/today",{params:e});v.value=n.data,l.value=null}catch(n){l.value=((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Something went wrong",console.error("[Attendance Error]",l.value)}finally{u.value=!1}},q=async(e,t=null,a=null,n=null,o,r)=>{var s,c;u.value=!0;try{const d={company_id:e,department_id:t,category:a,employee_id:n,type:r,...r==="daily"?{date:o}:{month:o}},i=await y.get("/monthly/attendance/late-reports",{params:d});r==="daily"?f.value=i.data:r==="monthly"&&(h.value=i.data),l.value=null}catch(d){l.value=((c=(s=d.response)==null?void 0:s.data)==null?void 0:c.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},P=async(e,t=null,a=null,n=null,o,r)=>{var s,c;u.value=!0;try{const d={company_id:e,department_id:t,line_type:a,employee_id:n,type:r,...r==="daily"?{date:o}:{month:o}},i=await y.get("/attendance/late-reports",{params:d});r==="daily"?f.value=i.data:r==="monthly"&&(h.value=i.data),l.value=null}catch(d){l.value=((c=(s=d.response)==null?void 0:s.data)==null?void 0:c.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},T=async(e,t,a,n,o)=>{var r,s,c,d;if(!e||!o){l.value="Company & month are required";return}u.value=!0;try{const i={company_id:e,department_id:t,month:o,line_type:a||"",employee_id:n||""},m=await y.get("/attendance/monthly-summary-reports",{params:i});S.value=((r=m.data)==null?void 0:r.data)??m.data,D.value=((s=m.data)==null?void 0:s.meta)||null,l.value=null}catch(i){l.value=((d=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:d.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},L=e=>{const t={};return Object.entries(e).forEach(([a,n])=>{n==null||n===""||(t[a]=n)}),t},R=(e,t)=>{if(!e||!t){const a="Company & month are required";throw l.value=a,new Error(a)}},_=(e,t="Something went wrong")=>{var n,o;const a=((o=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:o.message)||(e==null?void 0:e.message)||t;throw l.value=a,console.error(a,e),e};return{monthlyLogs:g,dailyLateLogs:f,monthlyLateLogs:h,summary:b,monthly_company_summary:S,selectedMonth:$,selectedDate:E,error:l,isLoading:u,dailyLogs:v,attendanceLogs:w,reportMeta:D,getUserDailyLogsByDate:x,getMonthlyAttendanceByShift:O,getTodayAttendanceReport:B,getAttendanceLateReport:q,getMonthlyAttendanceSummaryReport:T,downloadExcel:async(e,t,a)=>{var n,o;if(!e||!a){l.value="Invalid company ID or month";return}u.value=!0;try{const r={company_id:e,line_type:t,month:a},s=await y.get("/attendance/monthly-summary-reports?flag=excel",{params:r,responseType:"blob"}),c=window.URL.createObjectURL(new Blob([s.data])),d=document.createElement("a");d.href=c,d.setAttribute("download",`${a} attendance_summary.xlsx`),document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(r){l.value=((o=(n=r.response)==null?void 0:n.data)==null?void 0:o.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},downloadPDF:async(e,t,a,n=0)=>{var o,r;if(!e||!a){l.value="Invalid user ID or month";return}u.value=!0;try{const s={company_id:e,category:t,month:a},c=await y.get("/attendance/monthly-summary-reports?flag=pdf",{params:s,responseType:"blob"}),d=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=d,i.setAttribute("download",`${a} attendance_summary.pdf`),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(s){l.value=((r=(o=s.response)==null?void 0:o.data)==null?void 0:r.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},attendanceDownloadExcel:async(e,t,a,n,o)=>{var r,s;u.value=!0;try{const c={companyId:e,employee_id:t,line_type:a,month:n,status:o},d=await y.get("/attendance/today?flag=excel",{params:c,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([d.data])),m=document.createElement("a");m.href=i,m.setAttribute("download",`${n} attendance_summary.xlsx`),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(c){l.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},attendanceDownloadPdf:async(e,t,a,n,o)=>{var r,s;u.value=!0;try{const c={companyId:e,employee_id:t,category:a,month:n,status:o},d=await y.get("/attendance/today?flag=pdf",{params:c,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([d.data])),m=document.createElement("a");m.href=i,m.setAttribute("download",`${n} attendance_summary.pdf`),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(c){l.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},lateReportDownloadExcel:async(e,t,a,n)=>{var o,r;if(!e){l.value="Invalid company ID or date/month";return}u.value=!0;try{const s={company_id:e,...t?{employee_id:t}:{},type:n,...n==="daily"?{date:a}:{month:a}},c=await y.get("/monthly/attendance/late-reports?flag=excel",{params:s,responseType:"blob"}),d=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=d;const m=`${a}-late-attendance.xlsx`;i.setAttribute("download",m),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(s){l.value=((r=(o=s.response)==null?void 0:o.data)==null?void 0:r.message)||"Something went wrong",console.error(l.value)}finally{u.value=!1}},getMonthlyAttendanceLog:U,getDateRangeAttendanceSummary:A,downloadDateRangeExcel:k,downloadDateRangePdf:M,getDailyLateReport:P,recalculateMonthlySnapshot:async(e,t,a,n,o)=>{R(e,o),u.value=!0,l.value=null;try{const r=L({company_id:e,month:o,department_id:t||void 0,employee_id:n||void 0,line_type:a&&a!=="all"?a:void 0});return(await y.post("/attendance/monthly-snapshot/recalculate",r)).data}catch(r){_(r,"Failed to recalculate monthly snapshot")}finally{u.value=!1}},finalizeMonthlySnapshot:async(e,t,a,n,o="finalize")=>{R(e,n),u.value=!0,l.value=null;try{const r=L({company_id:e,month:n,action:o,employee_id:a||void 0,line_type:t&&t!=="all"?t:void 0});return(await y.post("/attendance/monthly-snapshot/finalize",r)).data}catch(r){_(r,"Failed to finalize monthly snapshot")}finally{u.value=!1}}}});export{N as u};
