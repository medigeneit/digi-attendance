import{_ as oe}from"./CommentModal-CpPF231y.js";import{g as ne,u as ie,O as X,_ as re}from"./task-priority-BO4nRP7G.js";import{L as de}from"./LoaderView-fvVG_kUa.js";import{_ as ue}from"./TaskAddForm-BhZJc_au.js";import{_ as me}from"./TaskEditForm-DmzSkK-f.js";import{q as C,s as ce,A as te,e as se,c,o as l,a as t,f as U,w as F,g as E,C as Y,F as S,y as R,t as N,h as r,l as x,p as V,D as Z,v as pe,n as H,b as ke,u as fe,r as $,E as ye,k as ve,m as M,x as ee}from"./index-Ba7q-zYQ.js";import{_ as ge}from"./MultiselectDropdown-Do4tYmaM.js";import{u as xe}from"./company-Dxk9eewm.js";import{_ as le}from"./UserChip-BgdG0e9I.js";import{_ as ae}from"./TaskTreeView-BSOn3QSd.js";import{u as we}from"./useTaskStore-zaf3lfXo.js";import"./useCommentStore-CXujdqr9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-gkyqJGh8.js";import"./SectionLoading-COy38i_p.js";import"./vue-multiselect.esm-B-TjtoRg.js";const be={class:"mb-3 task-header"},_e={class:"flex justify-between items-center"},Ce={class:"ml-auto flex gap-6 items-center"},Te={key:0,class:"flex gap-2 items-center"},he={class:"flex flex-wrap items-center gap-2 mt-3"},qe={class:"flex flex-wrap gap-4 w-full"},Ie={class:"text-gray-600 w-full md:w-44"},$e=["value"],Ve={class:"relative w-full md:w-52"},Ue={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Se={class:"text-gray-600 w-40"},Le={class:"flex gap-4 items-center flex-shrink-0"},Ae={class:"flex gap-2"},De={class:"flex gap-2"},Ee={class:"text-gray-600 w-full md:w-40 md:ml-auto"},Pe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(L,{emit:f}){const s=L,_=C(d("company-id")),T=C(d("user-ids")),q=C(d("month")),I=C(d("status")),a=C(d("is-important")),n=C(d("is-urgent")),i=f,p=xe(),{companies:w,employees:y}=ce(p);function d(m){return{get:()=>s.modelValue[m]||"",set:e=>{console.log("---SETTING modelValue: ",{key:m,value:e}),i("update:modelValue",{...s.modelValue,[m]:e||void 0})}}}const v=C(()=>A(T.value));async function g(m){m&&await p.fetchEmployee(m)}te(()=>_.value,g),se(async()=>{var m,e;await p.fetchCompanies(),(m=s.modelValue)!=null&&m["company-id"]&&await g((e=s.modelValue)==null?void 0:e["company-id"])});function A(m){return y.value.find(e=>e.id==m)||null}function P(m){T.value=(m==null?void 0:m.id)||""}function B(){T.value=""}return(m,e)=>(l(),c("div",be,[t("div",_e,[e[9]||(e[9]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",Ce,[L.listHasRearranged?(l(),c("div",Te,[e[8]||(e[8]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=F(u=>i("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=F(u=>i("clickPriorityDiscard"),["prevent"]))},"Discard")])):U("",!0),t("button",{onClick:e[2]||(e[2]=u=>i("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",he,[t("div",qe,[t("div",Ie,[E(t("select",{id:"company-filter","onUpdate:modelValue":e[3]||(e[3]=u=>_.value=u),class:"input-1"},[e[10]||(e[10]=t("option",{value:""},"All Company",-1)),(l(!0),c(S,null,R(r(w),u=>(l(),c("option",{key:u.id,value:u.id},N(u.name),9,$e))),128))],512),[[Y,_.value]])]),t("div",Ve,[x(ge,{modelValue:v.value,onSelect:P,onRemove:B,options:r(y),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employee",class:"text-gray-600 w-full"},{option:V(({option:u})=>[x(le,{user:u,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),v.value?(l(),c("div",Ue,[t("button",{onClick:F(B,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):U("",!0)]),t("div",Se,[E(t("select",{"onUpdate:modelValue":e[4]||(e[4]=u=>I.value=u),class:"input-1"},e[11]||(e[11]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[Y,I.value]])]),t("div",Le,[t("label",Ae,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=u=>a.value=u),value:"1"},null,512),[[Z,a.value]]),e[12]||(e[12]=t("span",null,"Important",-1))]),t("label",De,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=u=>n.value=u),value:"1"},null,512),[[Z,n.value]]),e[13]||(e[13]=t("span",null,"Urgent",-1))])]),t("div",Ee,[E(t("input",{id:"month-filter","onUpdate:modelValue":e[7]||(e[7]=u=>q.value=u),type:"month",class:"input-1"},null,512),[[pe,q.value]])])])])]))}},Be={class:"w-full bg-white rounded"},Me=["rowspan"],Re={class:""},Ne={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(L,{emit:f}){const s=L,_=f,T=C(()=>s.tasks.reduce((a,n)=>(a.push(...n.users.filter(i=>!a.find(p=>p.id==i.id&&i.id))),a),[]).filter(a=>s.selectedUserId?a.id==s.selectedUserId:!0)),q=a=>{const n=s.tasks,i=new Map(n.map(d=>[d.id,d])),p=new Set,w=[],y=n.filter(d=>d.users.some(v=>v.id===a));for(const d of y){p.has(d.id)||(p.add(d.id),w.push(d));let v=d.parent_id;for(;v&&i.has(v)&&!p.has(v);){const g=i.get(v);p.add(g.id),w.push(g),v=g.parent_id}}return w},I=C(()=>T.value.map(a=>{const n=ne(q(a.id),0);return{...a,tasks:n}}));return(a,n)=>(l(),c("div",null,[t("table",Be,[t("tbody",null,[(l(!0),c(S,null,R(I.value,i=>(l(),c(S,{key:i.id},[(l(!0),c(S,null,R(i.tasks,(p,w)=>(l(),c("tr",{key:p.id},[w==0?(l(),c("td",{key:0,class:"border p-4 align-top",rowspan:Math.max(i.tasks.length,1)},[x(le,{user:i,class:"sticky top-[80px]"},null,8,["user"])],8,Me)):U("",!0),t("td",Re,[x(ae,{task:p,class:"!border-0",index:w,onCommentButtonClick:n[0]||(n[0]=y=>_("commentButtonClick",a.item.id)),onEditClick:n[1]||(n[1]=y=>_("editClick",y)),onAddClick:n[2]||(n[2]=y=>_("addClick",y))},{"item-override":V(({task:y,level:d})=>[H(N({task:y,level:d}),1)]),_:2},1032,["task","index"])])]))),128))],64))),128))])])]))}},Fe={class:"container mx-auto p-6 relative"},He={class:"mb-4"},je={class:"w-full flex justify-end gap-5 mb-1"},Oe={key:3},We={key:0,class:"text-center py-4 text-red-500"},Ge={key:1},ze={class:"flex items-stretched"},Qe={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Je=1,ct={__name:"TaskList",setup(L){const f=we(),s=ke(),_=fe(),T=$(!1),q=$(null),I=$(!1),a=$(null),n=$(!1),i=ye({parentId:0,requirementId:0}),p=$(null),w=$([]),{handleItemsPriorityUpdate:y,saveTaskPriority:d,listHasRearranged:v}=ie(()=>f.taskListTree,0);se(async()=>{s.query.status||_.push({query:{...s.query,status:"not-completed"}}),await g()});async function g(){I.value=!!s.query["user-ids"];const b=await f.fetchTasks({...s.query},{loadingBeforeFetch:!0});console.log({dataQuery:b.query_log}),w.value=b.query_log||[]}const A=b=>{n.value=!0,i.parentId=b},P=b=>{q.value=b,T.value=!0},B=()=>{T.value=!1,q.value=null};async function m(){a.value=null,n.value=!1,i.parentId=0,await g()}async function e(){n.value=!1,i.parentId=0,await g()}async function u(){d()&&await g()}te(()=>({...s.query}),async()=>await g());const j=C({get(){return{...s.query}},set(b){_.push({query:{...b}})}});return(b,o)=>{var W,G,z,Q,J,K;const O=ve("RouterLink");return l(),c("div",Fe,[a.value?(l(),M(X,{key:0},{default:V(()=>[x(me,{taskId:a.value,class:"rounded-full",onClose:o[0]||(o[0]=k=>a.value=null),onUpdated:m},null,8,["taskId"])]),_:1})):U("",!0),n.value?(l(),M(X,{key:1},{default:V(()=>[x(ue,{parentTaskId:i.parentId,requirementId:i.requirementId,class:"rounded-full",onClose:e,onTaskCreated:m},null,8,["parentTaskId","requirementId"])]),_:1})):U("",!0),x(Pe,{modelValue:j.value,"onUpdate:modelValue":o[1]||(o[1]=k=>j.value=k),onClickAddTask:A,onClickPrioritySave:u,onClickPriorityDiscard:o[2]||(o[2]=()=>r(v)?p.value.resetItems:null),"list-has-rearranged":r(v),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((G=(W=r(s))==null?void 0:W.query)==null?void 0:G["query-log"])=="true"?(l(!0),c(S,{key:2},R(w.value,(k,h)=>(l(),c("div",{key:h,class:"text-xs text-gray-500"},[t("div",He,N(k.raw_query),1)]))),128)):U("",!0),t("div",je,[x(O,{class:ee(["text-sm btn-3 py-0.5",((z=r(s).query)==null?void 0:z.view)==="userwise"?"bg-blue-500 text-white":""]),to:{name:"TaskList",query:{...r(s).query,view:"userwise"}}},{default:V(()=>o[9]||(o[9]=[H(" User Wise List ")])),_:1},8,["class","to"]),x(O,{class:ee(["text-sm btn-3 py-0.5",((Q=r(s).query)==null?void 0:Q.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{name:"TaskList",query:{...Object.keys(((J=r(s))==null?void 0:J.query)||{}).filter(k=>{var h;return((h=r(s))==null?void 0:h.query[k])!=="userwise"}).reduce((k,h)=>({...k,[h]:r(s).query[h]}),{})}}},{default:V(()=>o[10]||(o[10]=[H(" TaskWise List ")])),_:1},8,["class","to"])]),r(f).loading?(l(),c("div",Oe,[x(de)])):(l(),c(S,{key:4},[r(f).error?(l(),c("div",We,N(r(f).error),1)):r(f).tasks.length>0?(l(),c("div",Ge,[((K=r(s).query)==null?void 0:K.view)=="userwise"?(l(),M(Ne,{key:0,tasks:r(f).tasks,selectedUserId:r(s).query["user-ids"],onCommentButtonClick:o[3]||(o[3]=k=>P(k,b.task.id)),onEditClick:o[4]||(o[4]=k=>a.value=k),onAddClick:o[5]||(o[5]=k=>A(k))},null,8,["tasks","selectedUserId"])):(l(),M(re,{key:1,items:r(f).taskListTree,handle:"handle",onItemsUpdate:r(y),class:"space-y-4",ref_key:"draggableTaskList",ref:p},{item:V(({item:k,index:h})=>[t("div",ze,[x(ae,{task:k,index:h,showDraggableHandle:!I.value,onCommentButtonClick:o[6]||(o[6]=D=>P(D,b.task.id)),onEditClick:o[7]||(o[7]=D=>a.value=D),onAddClick:o[8]||(o[8]=D=>A(D)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(l(),c("div",Qe," No tasks found. "))],64)),x(oe,{show:T.value,"commentable-id":q.value,"commentable-type":"task","user-id":Je,"on-close":B,onSubmitted:r(f).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{ct as default};
