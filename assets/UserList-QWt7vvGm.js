import{r as h,q as V,A as j,s as Y,c,f as B,o as p,a as e,n as R,t as f,h as v,g as M,C as F,F as $,x as q,v as O,u as W,b as G,e as K,k as J,l as _,p as A,y as Q}from"./index-D0gMtR9b.js";import{L as X}from"./LoaderView-3M-anU0G.js";import{u as H}from"./shift-CtdhI-Cw.js";import{d as T}from"./dayjs.min-Cbbdfn5l.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ee}from"./MultiselectDropdown-6X_hdIYm.js";import{_ as te}from"./UserChip-DliarONw.js";import{u as se}from"./user-DZT0y7MQ.js";import"./vue-multiselect.esm-BtYPs8a1.js";const oe={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},le={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},ae={class:"text-lg font-semibold mb-4"},ne={class:"mb-4"},de=["value"],ie={class:"mb-4"},re={class:"mb-4"},ce={class:"flex justify-end gap-3 mt-4"},pe={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(C,{emit:U}){const L=U,n=C,o=h({shift_id:"",employee_id:n.employee.id,start_date:"",end_date:""}),y=V(()=>{const d=Object.keys(n.shifts)[0];return n.shifts[d]||[]});j(()=>n.employee,d=>{o.value.employee_id=(d==null?void 0:d.id)||0},{immediate:!0,deep:!0}),j(()=>n.isOpen,d=>{var l;d&&(n.hasShift?(o.value.shift_id=n.hasShift.shift_id||"",o.value.start_date=n.hasShift.start_date?T(n.hasShift.start_date).format("YYYY-MM-DD"):"",o.value.end_date=n.hasShift.end_date?T(n.hasShift.end_date).format("YYYY-MM-DD"):"",o.value.employee_id=((l=n.employee)==null?void 0:l.id)||""):(o.value.shift_id="",o.value.start_date="",o.value.end_date=""))},{immediate:!0});const x=()=>{L("close",!1)},m=H(),{message:g}=Y(m),k=async()=>{if(!o.value.shift_id||!o.value.start_date||!o.value.employee_id){alert("All fields are required!");return}try{const d={...o.value},l=await m.shiftAssign(d);console.log("Shift assigned successfully:",l),alert(n.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),x()}catch(d){console.error("Failed to assign shift:",d),alert("Failed to assign shift.")}};return(d,l)=>C.isOpen?(p(),c("div",oe,[e("div",le,[e("h2",ae,f(n.hasShift?"Update Shift for":"Assign Shift to")+" "+f(C.employee.name),1),R(" "+f(v(g))+" ",1),e("div",ne,[l[4]||(l[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),M(e("select",{"onUpdate:modelValue":l[0]||(l[0]=i=>o.value.shift_id=i),class:"w-full p-2 border rounded"},[l[3]||(l[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(p(!0),c($,null,q(y.value,i=>(p(),c("option",{key:i==null?void 0:i.id,value:i==null?void 0:i.id},f(i==null?void 0:i.name),9,de))),128))],512),[[F,o.value.shift_id]])]),e("div",ie,[l[5]||(l[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),M(e("input",{type:"date","onUpdate:modelValue":l[1]||(l[1]=i=>o.value.start_date=i),class:"w-full border rounded p-2"},null,512),[[O,o.value.start_date]])]),e("div",re,[l[6]||(l[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),M(e("input",{type:"date","onUpdate:modelValue":l[2]||(l[2]=i=>o.value.end_date=i),class:"w-full border rounded p-2"},null,512),[[O,o.value.end_date]])]),e("div",ce,[e("button",{onClick:x,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:k,class:"px-4 py-2 bg-green-600 text-white rounded"},f(n.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:x,class:"absolute top-2 right-2 text-red-500 text-xl"},l[7]||(l[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):B("",!0)}},fe=Z(pe,[["__scopeId","data-v-c3e70801"]]),ue={class:"space-y-2 px-4"},me={class:"flex items-center justify-between gap-2"},ye={class:"flex items-center gap-4"},be={key:0,class:"text-center py-4"},_e={key:1,class:"space-y-4"},he={class:"title-md"},ve={class:"overflow-x-auto"},xe={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ge={class:"border border-gray-300 px-2"},Se=["innerHTML"],ke=["innerHTML"],we={class:"border border-gray-300 px-2"},Ce={class:"border border-gray-300 px-2"},Ue=["onClick"],Ae={key:0},Me={class:"border border-gray-300 px-2"},$e={class:"border border-gray-300 px-2"},qe={class:"border border-gray-300 px-2"},Le={key:0,class:"text-green-500"},je={key:1,class:"text-red-500"},Ee={class:"border border-gray-300 px-2"},De={class:"flex gap-2"},Ie={__name:"UserList",setup(C){const U=H(),{shifts:L}=Y(U),n=W(),o=G(),y=se(),x=h([]),m=h(o.query.company||"all"),g=h(""),k=h(""),d=h(!1);K(()=>{y.fetchUsers()});const l=()=>{n.go(-1)};j(m,a=>{n.push({query:{...o.query,company:a}})});const i=V(()=>{var r;const a={},s=new Set;y==null||y.users.forEach(u=>{var S;const t=((S=u==null?void 0:u.company)==null?void 0:S.name)||"Unknown Company";a[t]||(a[t]=[]),a[t].push(u),s.add(t)}),x.value=Array.from(s);let b=a;if(m.value!=="all"&&(b={[m.value]:a[m.value]||[]}),(r=g.value)!=null&&r.id){const u={};for(const[t,S]of Object.entries(b)){const w=S.filter(N=>N.id===g.value.id);w.length&&(u[t]=w)}return u}return b}),E=h("");function I(a){E.value=a.id,k.value=a,(a==null?void 0:a.company_id)!==void 0&&(U.fetchShifts(a==null?void 0:a.company_id),d.value=!d.value)}function z(){d.value=!1}async function P(){await y.fetchUsersExcelExport({data:{companyName:m.value}})}const D=a=>{if(a){const s=a.split(" "),b=s.slice(0,2).join(" "),r=s.length>2?`<br>${s.slice(2).join(" ")}`:"";return b+r}return""};return(a,s)=>{const b=J("RouterLink");return p(),c("div",ue,[e("div",me,[e("button",{class:"btn-3",onClick:l},s[2]||(s[2]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),s[4]||(s[4]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),_(b,{to:{name:"UserAdd",query:{company:v(o).query.company}},class:"btn-2"},{default:A(()=>s[3]||(s[3]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[3]},8,["to"])]),e("div",ye,[e("div",null,[M(e("select",{"onUpdate:modelValue":s[0]||(s[0]=r=>m.value=r),class:"input-1"},[s[5]||(s[5]=e("option",{value:"all",selected:""},"All Company",-1)),(p(!0),c($,null,q(x.value,(r,u)=>(p(),c("option",{key:u},f(r),1))),128))],512),[[F,m.value]])]),_(ee,{modelValue:g.value,"onUpdate:modelValue":s[1]||(s[1]=r=>g.value=r),options:v(y).users,multiple:!1,label:"name","label-prefix":"employee_id",class:"w-1/3",placeholder:"Select user"},{option:A(({option:r})=>[_(te,{user:r,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),e("button",{type:"button",onClick:P,class:"btn-3"},s[6]||(s[6]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),R("Excel ")]))]),v(y).isLoading?(p(),c("div",be,[_(X)])):(p(),c("div",_e,[(p(!0),c($,null,q(i.value,(r,u)=>(p(),c("div",{key:u},[e("h2",he,f(u)+" ("+f(r.length)+")",1),e("div",ve,[e("table",xe,[s[9]||(s[9]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(p(!0),c($,null,q(r,(t,S)=>{var w;return p(),c("tr",{key:t.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ge,f(S+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:D(t==null?void 0:t.name)},null,8,Se),e("td",{class:"border border-gray-300 px-2",innerHTML:D((w=t==null?void 0:t.designation)==null?void 0:w.title)},null,8,ke),e("td",we,f(t.role),1),e("td",Ce,[e("button",{type:"button",onClick:N=>I(t),class:Q(["btn-4 text-sm",t!=null&&t.current_shift?"bg-yellow-500 hover:bg-yellow-600":"btn-4"])},f(t!=null&&t.current_shift?"Change Shift":"Assign Shift"),11,Ue),E.value===t.id&&d.value?(p(),c("div",Ae,[_(fe,{isOpen:d.value,shifts:v(L),hasShift:t==null?void 0:t.current_shift,employee:{id:k.value.id,name:k.value.name},onClose:z},null,8,["isOpen","shifts","hasShift","employee"])])):B("",!0)]),e("td",Me,f(t.phone),1),e("td",$e,f(t.email||"নেই"),1),e("td",qe,[t.is_active?(p(),c("span",Le,"Active")):(p(),c("span",je,"Inactive"))]),e("td",Ee,[e("div",De,[_(b,{to:{name:"UserShow",params:{id:t.id},query:{company:v(o).query.company}},class:"btn-icon"},{default:A(()=>s[7]||(s[7]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[7]},1032,["to"]),_(b,{to:{name:"UserEdit",params:{id:t.id},query:{company:v(o).query.company}},class:"btn-icon"},{default:A(()=>s[8]||(s[8]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[8]},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{Ie as default};
