import{g as ie,D as pe,f as ue,u as me,G as ye,r as Y,x as c,q as P,h as ce,c as u,o as d,a as e,i as U,j as I,t as l,m as h,w as xe,k as H,v as Q,b as S,l as L,F as J,e as X,d as Z,M as ee,s as fe}from"./index-CL5zsjQB.js";import{_ as ge}from"./EmployeeFilter-BU9NR5JP.js";import{L as ve}from"./LoaderView-BXOTfrO7.js";import{U as be}from"./UserHoverBubble-BUD_l80V.js";import{g as te,m as _e,c as he,b as F,a as se}from"./datetime-Du_mcDA9.js";import{u as we}from"./useTodoDateStore-BSWXNksq.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-RmjKFnEr.js";import"./department-DprOVA99.js";import"./EmployeeDropdownInput-SufseIyw.js";import"./SelectDropdown-B77wfjc_.js";import"./UserChip-C1UTred-.js";import"./user-FqwOV9QK.js";import"./url-CePbr-gY.js";const Ie={class:"container mx-auto print:w-full print:px-0 print:py-0"},Te={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},De={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},Oe={key:0,class:"text-gray-400"},Se=["disabled"],Me={class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0"},Ne={key:0,class:"flex flex-wrap items-center gap-3"},Ee={class:"relative h-[32px] w-[170px]"},Re={class:"text-xs text-blue-600 flex items-center gap-2"},Ce={class:"relative h-[32px]"},Pe={key:0,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},Ue={key:2,class:"space-y-4"},Le={class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},Fe={class:"text-sm text-gray-700"},Ve={class:"font-semibold"},Ae={class:"text-sm text-gray-700"},Be={class:"font-semibold"},$e={class:"text-sm text-gray-700"},qe={class:"font-semibold text-green-600"},ze={class:"text-sm text-gray-700"},Ge={class:"font-semibold text-blue-600"},We={class:"text-sm text-gray-700"},je={class:"font-semibold text-amber-600"},Ke={key:0,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Ye={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},He={class:"flex items-center gap-3"},Qe={class:"font-semibold text-gray-800"},Je={class:"text-xs text-gray-500"},Xe={class:"text-[11px] text-gray-400"},Ze={key:0},et={key:1,class:"flex items-center gap-3"},tt={class:"font-semibold text-gray-800"},st={class:"text-xs text-gray-500"},ot={class:"text-[11px] text-gray-400"},nt={key:0},lt={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},at={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},rt={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},dt={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},it={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},pt={class:"overflow-x-auto"},ut={class:"min-w-full text-left text-sm border-separate border-spacing-0"},mt={key:0},yt={class:"px-4 py-3 text-center border"},ct={class:"px-4 py-3 border"},xt={class:"font-semibold text-gray-800"},ft={class:"text-xs text-gray-500"},gt={class:"px-4 py-3 border text-xs text-gray-700"},vt={class:"px-4 py-3 border text-center"},bt={__name:"PersonalActivityReportView",props:{selfOnly:{type:Boolean,default:!1}},setup(V){const p=V,T=we(),oe=ie(),{user:x}=pe(oe),M=ue(),ne=me(),n=ye({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),i=Y(""),A=Y(null),w=c(()=>{if(!i.value)return"";const[s,t]=i.value.split("-").map(Number);return!s||!t?"":te(new Date(s,t-1,1))}),k=c(()=>{if(!i.value)return"";const[s,t]=i.value.split("-").map(Number);return!s||!t?"":te(_e(new Date(s,t-1,1)))}),N=c(()=>i.value?he(`${i.value}-01`):""),v=c(()=>w.value&&k.value?`${F(w.value)} ~ ${F(k.value)}`:""),E=c(()=>{var s;return p.selfOnly?((s=x.value)==null?void 0:s.company_id)||"":n.companyId}),B=c(()=>!w.value||!k.value?!1:p.selfOnly?!!f.value&&!!E.value:!!E.value),$=c(()=>T.todo_dates||[]),f=c(()=>{var s;return(s=x.value)!=null&&s.id?String(x.value.id):""});function le(s){n.companyId=s.company_id||"",n.departmentId=s.department_id||"",n.employeeId=p.selfOnly?f.value:s.employee_id||"",n.lineType=s.line_type||"all"}function ae(s){return s==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":s==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":s==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"}function q(s){var t,o;return s.todo_id||s.todoId||((t=s.todo)==null?void 0:t.id)||((o=s.todo)==null?void 0:o.todo_id)||s.id||`${s.title}-${s.date}`}const z=c(()=>{var m;if(p.selfOnly&&x.value)return[x.value];const s=((m=A.value)==null?void 0:m.employees)||[];if(s.length)return s;const t=[],o=new Set;return $.value.forEach(b=>{const a=b.user;if(!a||!a.id)return;const y=String(a.id);o.has(y)||(o.add(y),t.push(a))}),t}),re=c(()=>n.employeeId?z.value.filter(s=>String(s.id)===String(n.employeeId)):z.value),D=c(()=>re.value.map(s=>{const t=$.value.filter(a=>{var y;return String(((y=a.user)==null?void 0:y.id)??a.user_id)===String(s.id)}),o={};for(const a of t){const y=q(a),_=o[y],r=new Date(a.date),g=_?new Date(_.date):null;(!_||g&&r>g)&&(o[y]=a)}const m=Object.values(o).sort((a,y)=>new Date(y.date).getTime()-new Date(a.date).getTime()),b={total:m.length,completed:m.filter(a=>a.status==="COMPLETED").length,working:m.filter(a=>a.status==="WORKING").length,pending:m.filter(a=>a.status==="PENDING").length};return{user:s,latestTodos:m,totals:b}}).sort((s,t)=>{var o,m;return(((o=s.user)==null?void 0:o.name)||"").localeCompare(((m=t.user)==null?void 0:m.name)||"")})),O=c(()=>D.value.reduce((s,t)=>({totalTodos:s.totalTodos+t.totals.total,completed:s.completed+t.totals.completed,working:s.working+t.totals.working,pending:s.pending+t.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));function G(){ne.replace({query:{...M.query,month:i.value||void 0,...p.selfOnly?{}:{company_id:n.companyId||void 0,department_id:n.departmentId||void 0,employee_id:n.employeeId||void 0,line_type:n.lineType||void 0}}})}async function R(){B.value&&await T.fetchTodoDates({"company-id":E.value||void 0,"department-id":p.selfOnly?void 0:n.departmentId,"employee-id":p.selfOnly?f.value:n.employeeId,"line-type":p.selfOnly?void 0:n.lineType,"start-date":w.value,"end-date":k.value})}function C(){p.selfOnly&&f.value&&(n.employeeId=f.value)}function W(){const s=M.query||{};i.value=typeof s.month=="string"&&s.month?s.month:i.value||se(new Date),n.companyId=p.selfOnly?"":s.company_id||"",n.departmentId=p.selfOnly?"":s.department_id||"",n.employeeId=p.selfOnly?f.value:s.employee_id||"",n.lineType=p.selfOnly?"all":s.line_type||"all",C()}P(()=>[n.companyId,n.departmentId,n.employeeId,n.lineType,w.value,k.value,i.value],()=>{C(),G(),R()}),P(()=>M.query,()=>{W()}),P(f,()=>{C(),G(),R()}),ce(()=>{i.value=i.value||se(new Date),W(),R()});function de(){window.print()}return(s,t)=>(d(),u("div",Ie,[e("div",Te,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),e("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),e("span",De,[t[6]||(t[6]=e("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),e("span",null,l(N.value),1),v.value?(d(),u("span",Oe,"("+l(v.value)+")",1)):I("",!0)]),e("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:xe(de,["prevent"]),disabled:h(T).loading,title:"Print"},t[7]||(t[7]=[e("i",{class:"fas fa-print"},null,-1)]),8,Se)]),e("div",Me,[p.selfOnly?(d(),u("div",Ne,[e("div",Ee,[t[9]||(t[9]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),H(e("input",{id:"month",type:"month","onUpdate:modelValue":t[0]||(t[0]=o=>i.value=o),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[Q,i.value]])]),e("div",Re,[t[10]||(t[10]=e("i",{class:"fas fa-user-lock"},null,-1)),S(" Showing only my todos (Employee ID: "+l(f.value||"loading...")+") ",1)])])):(d(),U(ge,{key:1,ref_key:"employeeFilterRef",ref:A,company_id:n.companyId,"onUpdate:company_id":t[2]||(t[2]=o=>n.companyId=o),department_id:n.departmentId,"onUpdate:department_id":t[3]||(t[3]=o=>n.departmentId=o),employee_id:n.employeeId,"onUpdate:employee_id":t[4]||(t[4]=o=>n.employeeId=o),line_type:n.lineType,"onUpdate:line_type":t[5]||(t[5]=o=>n.lineType=o),onFilterChange:le},{default:L(()=>[e("div",Ce,[t[11]||(t[11]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),H(e("input",{id:"month",type:"month","onUpdate:modelValue":t[1]||(t[1]=o=>i.value=o),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[Q,i.value]])])]),_:1},8,["company_id","department_id","employee_id","line_type"]))]),B.value?h(T).loading?(d(),U(ve,{key:1},{default:L(()=>t[13]||(t[13]=[S("Loading report...")])),_:1,__:[13]})):(d(),u("div",Ue,[e("div",Le,[e("div",Fe,[t[14]||(t[14]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",Ve,l(D.value.length),1)]),e("div",Ae,[t[15]||(t[15]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),e("div",Be,l(O.value.totalTodos),1)]),e("div",$e,[t[16]||(t[16]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),e("div",qe,l(O.value.completed),1)]),e("div",ze,[t[17]||(t[17]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),e("div",Ge,l(O.value.working),1)]),e("div",We,[t[18]||(t[18]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),e("div",je,l(O.value.pending),1)])]),D.value.length===0?(d(),u("div",Ke," No data available for the selected month. ")):I("",!0),(d(!0),u(J,null,X(D.value,(o,m)=>{var b,a,y,_;return d(),u("div",{key:((b=o.user)==null?void 0:b.id)||m,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[e("div",Ye,[V.selfOnly?(d(),u("div",et,[Z(ee,{user:h(x),size:"medium"},null,8,["user"]),e("div",null,[e("div",tt,l(((a=h(x))==null?void 0:a.name)||"Unknown user"),1),e("div",st,l(((_=(y=h(x))==null?void 0:y.department)==null?void 0:_.name)||"-"),1),e("div",ot,[S(" Month: "+l(N.value)+" ",1),v.value?(d(),u("span",nt,"("+l(v.value)+")",1)):I("",!0)])])])):(d(),U(be,{key:0,user:o.user},{trigger:L(({user:r})=>{var g;return[e("div",He,[Z(ee,{user:r,size:"medium"},null,8,["user"]),e("div",null,[e("div",Qe,l((r==null?void 0:r.name)||"Unknown user"),1),e("div",Je,l(((g=r==null?void 0:r.department)==null?void 0:g.name)||"-"),1),e("div",Xe,[S(" Month: "+l(N.value)+" ",1),v.value?(d(),u("span",Ze,"("+l(v.value)+")",1)):I("",!0)])])])]}),_:2},1032,["user"])),e("div",lt,[e("span",at," Total "+l(o.totals.total),1),e("span",rt," Done "+l(o.totals.completed),1),e("span",dt," Working "+l(o.totals.working),1),e("span",it," Pending "+l(o.totals.pending),1)])]),e("div",pt,[e("table",ut,[t[20]||(t[20]=e("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[e("tr",{class:"border-b"},[e("th",{class:"px-4 py-3 border text-center w-12"},"sl"),e("th",{class:"px-4 py-3 border text-left"},"Todo"),e("th",{class:"px-4 py-3 border text-left"},"Last Activity Date"),e("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),e("tbody",null,[o.latestTodos.length===0?(d(),u("tr",mt,t[19]||(t[19]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-400"}," No activity recorded for this month. ",-1)]))):I("",!0),(d(!0),u(J,null,X(o.latestTodos,(r,g)=>{var j,K;return d(),u("tr",{key:q(r),class:"border-b"},[e("td",yt,l(g+1),1),e("td",ct,[e("div",xt,l(r.title),1),e("div",ft,l(((K=(j=r.todo)==null?void 0:j.todoable)==null?void 0:K.title)||""),1)]),e("td",gt,l(h(F)(r.date)||r.date),1),e("td",vt,[e("span",{class:fe(["text-xs font-semibold px-2.5 py-1 rounded-full",ae(r.status)])},l(r.status||"N/A"),3)])])}),128))])])])])}),128))])):(d(),u("div",Pe,t[12]||(t[12]=[e("i",{class:"fad fa-tasks text-4xl"},null,-1),e("div",{class:"empty-state glass-panel"},[e("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),e("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)])))]))}},Pt=ke(bt,[["__scopeId","data-v-f2326ff6"]]);export{Pt as default};
