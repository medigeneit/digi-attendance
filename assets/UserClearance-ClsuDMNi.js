import{Q as Z,r as k,m as Y,N as B,ac as ee,h as M,B as F,c as d,o as l,F as K,y as z,a as s,t as v,A as V,j as U,x as R,z as J,K as X,p as W,g as D,w as Q,M as te,i as se,v as H,a6 as ae,J as re,d as ne,s as oe,e as le,a7 as ie,k as _,a1 as q,f as de,l as ue}from"./index-D39C7jUI.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe=Z("clearance",()=>{const N=k(null),m=k(""),E=k([]),g=k([]),i=k([]),o=k(new Map),h=k(new Set),f=k(!1),S=k(!1),b=k(""),$=Y(()=>{const c=(i.value??[]).slice().sort((n,t)=>(n.order_no??0)-(t.order_no??0)).map(n=>{var w,C;const t=o.value.get(n.id)||{},e=typeof n.show_receiver<"u"?!!n.show_receiver:n.handover_to!=="departmental_incharge",a=t.receiver_name??((w=n.handover_user)==null?void 0:w.name)??((C=n.handover_user)==null?void 0:C.label)??"";return{id:n.id,template_item_id:n.id,label:n.label||n.item_label||n.item_key,order_no:n.order_no??0,handover_to:n.handover_to??null,show_receiver:e,status:t.status??"PENDING",handover_status:t.handover_status??"NA",present_condition:t.present_condition??"",receiver_name:e?a:"",remarks:t.remarks??""}});return m.value?c.filter(n=>n.status===m.value):c});function x(c,n=!0){n?h.value.add(c):h.value.delete(c)}function p(){h.value.clear()}const y=async(c=null)=>{var n,t;f.value=!0,b.value=null;try{const e=await B.get("/departments",{params:{company_id:c}});E.value=e.data}catch(e){b.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"ডিপার্টমেন্ট লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching departments:",e)}finally{f.value=!1}};async function r(c){var n;b.value="";try{const t=await B.get("/without-permission-users",{params:{department_id:c,per_page:1e3}});g.value=((n=t.data)==null?void 0:n.data)||t.data||[]}catch(t){b.value="Failed to load users",console.error(t)}}async function u(){var c;i.value=[],b.value="";try{const n=await B.get("/department-clearance-items"),t=((c=n.data)==null?void 0:c.data)||n.data||[];i.value=t}catch(n){b.value="Failed to load assigned items",console.error(n)}}async function A(c,n,t){var e;o.value=new Map,b.value="";try{const a=await B.get("/clearances",{params:{user_id:c,department_id:n,template_id:t,per_page:1e3}}),w=((e=a.data)==null?void 0:e.data)||a.data||[];for(const C of w)o.value.set(C.template_item_id,C)}catch(a){b.value="Failed to load clearances",console.error(a)}}async function T(c,n){if(!(!c||!n)){f.value=!0,b.value="";try{await u(c,n),N.value&&await A(N.value,c,n)}catch(t){b.value="Failed to refresh data",console.error(t)}finally{f.value=!1}}}async function P(c,n){if(!N.value)return;const t=$.value.filter(e=>h.value.has(e.template_item_id)).map(e=>({template_item_id:e.template_item_id,status:e.status,handover_status:e.handover_status,present_condition:(typeof e.present_condition=="string"?e.present_condition.trim():"")||null,receiver_name:(typeof e.receiver_name=="string"?e.receiver_name.trim():"")||null,remarks:(typeof e.remarks=="string"?e.remarks.trim():"")||null}));if(t.length!==0){S.value=!0,b.value="";try{await B.post("/clearances/bulk-upsert",{user_id:N.value,department_id:c,items:t}),p(),await A(N.value,c,n)}catch(e){b.value="Failed to save",console.error(e)}finally{S.value=!1}}}return{userId:N,departments:E,statusFilter:m,users:g,assignedItems:i,clearanceByItemId:o,itemsForTable:$,dirty:h,loading:f,saving:S,error:b,loadUsersByDept:r,fetchDepartments:y,loadAssignedItems:u,loadClearances:A,refreshAll:T,saveBulk:P,markDirty:x}}),me=["value"],ve={__name:"HandoverSelect",props:{modelValue:{type:String,default:"NA"},modelModifiers:{}},emits:["update:modelValue"],setup(N){const m=ee(N,"modelValue"),E=[{v:"YES",t:"Yes"},{v:"NO",t:"No"},{v:"NA",t:"N/A"}];return(g,i)=>M((l(),d("select",{"onUpdate:modelValue":i[0]||(i[0]=o=>m.value=o),class:"input-1"},[(l(),d(K,null,z(E,o=>s("option",{key:o.v,value:o.v},v(o.t),9,me)),64))],512)),[[F,m.value]])}},ge=["aria-disabled"],be=["aria-checked","onClick"],ye="inline-flex items-center gap-1 rounded-md border px-2.5 py-1.5 text-xs font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/40 select-none",fe=Object.assign({name:"StatusSegment"},{__name:"StatusSegment",props:{modelValue:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(N,{emit:m}){const E=N,g=m,i=p=>(p??"").toString().trim().toUpperCase(),o=k(i(E.modelValue));V(()=>E.modelValue,p=>{const y=i(p);y!==o.value&&(o.value=y)});const h=[{value:"PENDING",label:"Pending"},{value:"WORKING",label:"Working"},{value:"COMPLETED",label:"Completed"}],f=p=>o.value===p;function S(p){if(E.disabled)return;const y=i(p);o.value=y,g("update:modelValue",y),g("change",y)}function b(p){if(E.disabled)return;const y=Math.max(0,h.findIndex(r=>r.value===o.value));["ArrowRight","ArrowDown"].includes(p.key)?(p.preventDefault(),S(h[(y+1)%h.length].value)):["ArrowLeft","ArrowUp"].includes(p.key)&&(p.preventDefault(),S(h[(y-1+h.length)%h.length].value))}function $(p){const r=f(p)?{PENDING:"bg-amber-600 text-white border-amber-600",WORKING:"bg-sky-600 text-white border-sky-600",COMPLETED:"bg-emerald-600 text-white border-emerald-600"}[p]||"bg-gray-800 text-white border-gray-800":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50",u=E.disabled?"opacity-60 cursor-not-allowed":"cursor-pointer";return`${ye} ${r} ${u}`}const x=Y(()=>`inline-flex items-center gap-1 bg-white rounded-lg p-1 border ${E.disabled?"opacity-75":""}`);return(p,y)=>(l(),d("div",{class:R(x.value),role:"radiogroup","aria-disabled":N.disabled?"true":"false",onKeydown:b},[(l(),d(K,null,z(h,r=>s("button",{key:r.value,type:"button",class:R($(r.value)),"aria-checked":f(r.value)?"true":"false",role:"radio",onClick:u=>S(r.value)},[s("span",{class:R(["h-1.5 w-1.5 rounded-full",{"bg-amber-200":r.value==="PENDING"&&!f(r.value),"bg-sky-200":r.value==="WORKING"&&!f(r.value),"bg-emerald-200":r.value==="COMPLETED"&&!f(r.value),"bg-white":f(r.value)}])},null,2),U(" "+v(r.label),1)],10,be)),64))],42,ge))}}),_e={class:"card overflow-hidden border rounded-xl bg-white shadow-sm"},he={class:"px-4 py-3 border-b bg-white/85 backdrop-blur flex items-center justify-between gap-3"},xe={class:"text-sm text-gray-700"},we={class:"ml-1 font-semibold tabular-nums"},ke=["disabled"],Ne={class:"w-full text-sm min-w-[1020px]"},Ee=["onClick"],Ce={class:"px-3 py-2 align-top text-gray-500 tabular-nums"},Se={class:"px-3 py-2 align-top"},$e={class:"font-medium text-gray-900"},De={class:"text-[11px] text-gray-500"},Ae={class:"px-3 py-2 align-top"},Ie={class:"font-medium"},Oe={class:"px-3 py-2 align-top"},Re={class:"whitespace-pre-wrap text-gray-900"},Me={class:"px-3 py-2 align-top"},Pe={key:0,class:"whitespace-pre-wrap text-gray-900"},Ue={key:1,class:"text-gray-400"},Ve={class:"px-3 py-2 align-top"},Te={class:"whitespace-pre-wrap text-gray-900"},Ge={class:"px-3 py-2 align-top"},Le={class:"font-medium"},Be=["onClick"],Ke={key:0},ze={class:"w-full max-w-2xl rounded-2xl bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 shadow-2xl ring-1 ring-black/5"},je={class:"px-5 py-4 space-y-4"},Fe={key:0,class:"text-xs text-rose-600 mt-1"},We=["maxlength"],He={key:0,class:"text-xs text-rose-600 mt-1"},Ye={key:0},Je=["maxlength"],Qe={key:0,class:"text-xs text-rose-600 mt-1"},qe=["maxlength"],Xe={key:0,class:"text-xs text-rose-600 mt-1"},Ze={key:0,class:"text-xs text-rose-600 mt-1"},et={__name:"ClearanceEditorTable",props:{rows:{type:Array,default:()=>[]},maxHeight:{type:String,default:"60vh"},disabled:{type:Boolean,default:!1}},emits:["update:row"],setup(N,{emit:m}){const E=N,g=m,i=k([]),o=t=>(t==null?void 0:t.template_item_id)??(t==null?void 0:t.id),h=(t=[])=>t.map(e=>({...e}));V(()=>E.rows,t=>{i.value=h(t??[])},{immediate:!0});const f={PENDING:{label:"Pending",dot:"bg-amber-500",pill:"bg-amber-50 text-amber-800 border-amber-200"},WORKING:{label:"Working",dot:"bg-sky-500",pill:"bg-sky-50 text-sky-800 border-sky-200"},COMPLETED:{label:"Completed",dot:"bg-emerald-500",pill:"bg-emerald-50 text-emerald-800 border-emerald-200"}},S={YES:{label:"Yes",pill:"bg-emerald-50 text-emerald-700 border-emerald-200"},NO:{label:"No",pill:"bg-rose-50 text-rose-700 border-rose-200"},NA:{label:"N/A",pill:"bg-slate-50 text-slate-700 border-slate-200"}},b=t=>t==="COMPLETED"?"border-l-4 border-emerald-400":t==="WORKING"?"border-l-4 border-sky-400":t==="PENDING"?"border-l-4 border-amber-400":"",$=t=>typeof(t==null?void 0:t.show_receiver)<"u"?!!t.show_receiver:(t==null?void 0:t.handover_to)!=="departmental_incharge",x={present_condition:200,receiver_name:120,remarks:255},p=k(!1),y=k(-1),r=J({handover_status:"NA",present_condition:"",receiver_name:"",remarks:"",status:"PENDING",show_receiver:!0}),u=J({});function A(t,e){y.value=e,r.handover_status=t.handover_status??"NA",r.present_condition=t.present_condition??"",r.receiver_name=t.receiver_name??"",r.remarks=t.remarks??"",r.status=t.status??"PENDING",r.show_receiver=$(t),Object.keys(u).forEach(a=>delete u[a]),p.value=!0,re(()=>{})}function T(){var t,e,a;return Object.keys(u).forEach(w=>delete u[w]),["YES","NO","NA"].includes(r.handover_status)||(u.handover_status="Select YES / NO / NA"),(((t=r.present_condition)==null?void 0:t.length)||0)>x.present_condition&&(u.present_condition=`Max ${x.present_condition} chars`),r.show_receiver&&(((e=r.receiver_name)==null?void 0:e.length)||0)>x.receiver_name&&(u.receiver_name=`Max ${x.receiver_name} chars`),(((a=r.remarks)==null?void 0:a.length)||0)>x.remarks&&(u.remarks=`Max ${x.remarks} chars`),["PENDING","WORKING","COMPLETED"].includes(r.status)||(u.status="Invalid status"),Object.keys(u).length===0}function P(){var C,G,I,L,O,j;if(!T())return;const t=y.value;if(t<0)return;const e=i.value[t],a=Number(o(e)),w={handover_status:r.handover_status,present_condition:((G=(C=r.present_condition)==null?void 0:C.trim)==null?void 0:G.call(C))??r.present_condition,receiver_name:r.show_receiver?((L=(I=r.receiver_name)==null?void 0:I.trim)==null?void 0:L.call(I))??r.receiver_name:"",remarks:((j=(O=r.remarks)==null?void 0:O.trim)==null?void 0:j.call(O))??r.remarks,status:r.status};i.value[t]={...e,...w},g("update:row",a,{id:a,template_item_id:a,...w}),p.value=!1}function c(){p.value=!1}function n(t){p.value&&(t.key==="Escape"&&(t.stopPropagation(),t.preventDefault(),c()),(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="enter"&&(t.preventDefault(),P()))}return typeof window<"u"&&window.addEventListener("keydown",n),X(()=>window.removeEventListener("keydown",n)),(t,e)=>(l(),d("div",_e,[s("div",he,[s("div",xe,[e[7]||(e[7]=s("span",{class:"font-medium"},"Assigned items:",-1)),s("span",we,v(i.value.length),1)]),s("button",{class:"rounded-md border px-3 py-1.5 text-sm hover:bg-gray-50 disabled:opacity-50",disabled:!i.value.length,onClick:e[0]||(e[0]=a=>A(i.value[0],0)),title:"Add/Update clearance"}," ➕ Add/Update clearance ",8,ke)]),s("div",{class:"overflow-auto",style:te({maxHeight:N.maxHeight})},[s("table",Ne,[e[9]||(e[9]=s("thead",{class:"bg-gray-50 sticky top-0 z-10 backdrop-blur border-b"},[s("tr",{class:"text-left text-gray-600"},[s("th",{class:"px-3 py-2 w-10"},"#"),s("th",{class:"px-3 py-2"},"Item"),s("th",{class:"px-3 py-2 w-40"},"Handover"),s("th",{class:"px-3 py-2 w-[18rem]"},"Present Condition"),s("th",{class:"px-3 py-2 w-[18rem]"},"Receiver"),s("th",{class:"px-3 py-2 w-[18rem]"},"Remarks"),s("th",{class:"px-3 py-2 w-40"},"Status"),s("th",{class:"px-3 py-2 w-16"})])],-1)),s("tbody",null,[(l(!0),d(K,null,z(i.value,(a,w)=>{var C,G,I,L,O;return l(),d("tr",{key:o(a),class:R(["border-t hover:bg-gray-50 transition-colors cursor-pointer",b(a.status)]),onClick:j=>A(a,w)},[s("td",Ce,v(w+1),1),s("td",Se,[s("div",$e,v(a.label),1),s("div",De,"#"+v(o(a)),1)]),s("td",Ae,[s("span",{class:R(["inline-flex items-center gap-1 rounded-full border px-2 py-0.5",((C=S[a.handover_status])==null?void 0:C.pill)||"bg-slate-50 text-slate-700 border-slate-200"])},[s("span",Ie,v(((G=S[a.handover_status])==null?void 0:G.label)||a.handover_status||"N/A"),1)],2)]),s("td",Oe,[s("div",Re,v(a.present_condition||"—"),1)]),s("td",Me,[$(a)?(l(),d("div",Pe,v(a.receiver_name||"—"),1)):(l(),d("div",Ue,"—"))]),s("td",Ve,[s("div",Te,v(a.remarks||"—"),1)]),s("td",Ge,[s("span",{class:R(["inline-flex items-center gap-1 rounded-full border px-2 py-0.5",((I=f[a.status])==null?void 0:I.pill)||"bg-slate-50 text-slate-700 border-slate-200"])},[s("span",{class:R(["h-1.5 w-1.5 rounded-full",((L=f[a.status])==null?void 0:L.dot)||"bg-slate-400"])},null,2),s("span",Le,v(((O=f[a.status])==null?void 0:O.label)||a.status||"—"),1)],2)]),s("td",{class:"px-3 py-2 align-top",onClick:e[1]||(e[1]=Q(()=>{},["stop"]))},[s("button",{class:"inline-flex items-center gap-1 rounded-md border px-2.5 py-1.5 text-xs hover:bg-gray-50",onClick:j=>A(a,w),title:"Edit"},"✎ Edit",8,Be)])],10,Ee)}),128)),i.value.length===0?(l(),d("tr",Ke,e[8]||(e[8]=[s("td",{colspan:"8",class:"px-3 py-12"},[s("div",{class:"flex flex-col items-center justify-center text-center border border-dashed rounded-xl p-8 bg-slate-50"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 mb-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M3 7h18M3 12h18M3 17h18M7 3v18"})]),s("div",{class:"text-sm text-gray-700 font-medium"},"No items to show"),s("p",{class:"text-xs text-gray-500 mt-1"},"Choose a department & template to load assigned clearance items.")])],-1)]))):D("",!0)])])],4),W(ae,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:se(()=>[p.value?(l(),d("div",{key:0,class:"fixed inset-0 z-[60] flex items-start md:items-center justify-center bg-black/40 p-4",onClick:Q(c,["self"]),role:"dialog","aria-modal":"true"},[s("div",ze,[s("div",{class:"sticky top-0 flex items-center justify-between border-b px-5 py-3 bg-white/90 dark:bg-gray-900/90 backdrop-blur"},[e[10]||(e[10]=s("h3",{class:"text-base font-semibold"},"Add / Update Clearance",-1)),s("button",{class:"h-8 w-8 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800",onClick:c,title:"Close"},"✕")]),s("div",je,[s("div",null,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium mb-1"},"Handover",-1)),W(ve,{"model-value":r.handover_status,"onUpdate:modelValue":e[2]||(e[2]=a=>r.handover_status=a)},null,8,["model-value"]),u.handover_status?(l(),d("p",Fe,v(u.handover_status),1)):D("",!0)]),s("div",null,[e[12]||(e[12]=s("label",{class:"block text-sm font-medium mb-1"},"Present Condition",-1)),M(s("textarea",{class:"w-full resize-none bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg px-3 py-2 leading-6 focus:outline-none focus:ring-2 focus:ring-sky-500/20 focus:border-sky-500","onUpdate:modelValue":e[3]||(e[3]=a=>r.present_condition=a),maxlength:x.present_condition,rows:"3",placeholder:"e.g., OK / minor scratches / N/A"},null,8,We),[[H,r.present_condition]]),u.present_condition?(l(),d("p",He,v(u.present_condition),1)):D("",!0)]),r.show_receiver?(l(),d("div",Ye,[e[13]||(e[13]=s("label",{class:"block text-sm font-medium mb-1"},"Receiver",-1)),M(s("textarea",{class:"w-full resize-none bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg px-3 py-2 leading-6 focus:outline-none focus:ring-2 focus:ring-sky-500/20 focus:border-sky-500","onUpdate:modelValue":e[4]||(e[4]=a=>r.receiver_name=a),maxlength:x.receiver_name,rows:"2",placeholder:"Receiver name(s), designation — one per line"},null,8,Je),[[H,r.receiver_name]]),u.receiver_name?(l(),d("p",Qe,v(u.receiver_name),1)):D("",!0)])):D("",!0),s("div",null,[e[14]||(e[14]=s("label",{class:"block text-sm font-medium mb-1"},"Remarks",-1)),M(s("textarea",{class:"w-full resize-none bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-lg px-3 py-2 leading-6 focus:outline-none focus:ring-2 focus:ring-sky-500/20 focus:border-sky-500","onUpdate:modelValue":e[5]||(e[5]=a=>r.remarks=a),maxlength:x.remarks,rows:"3",placeholder:"Remarks (optional)"},null,8,qe),[[H,r.remarks]]),u.remarks?(l(),d("p",Xe,v(u.remarks),1)):D("",!0)]),s("div",null,[e[15]||(e[15]=s("label",{class:"block text-sm font-medium mb-1"},"Status",-1)),W(fe,{"model-value":r.status,"onUpdate:modelValue":e[6]||(e[6]=a=>r.status=a)},null,8,["model-value"]),u.status?(l(),d("p",Ze,v(u.status),1)):D("",!0)])]),s("div",{class:"sticky bottom-0 flex items-center justify-end gap-2 border-t px-5 py-3 bg-white/90 dark:bg-gray-900/90 backdrop-blur"},[s("button",{class:"rounded-lg border px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800",onClick:c},"Cancel"),s("button",{class:"inline-flex items-center gap-2 rounded-lg bg-gray-900 px-3 py-2 text-sm text-white hover:bg-gray-800",onClick:P,title:"Save (Ctrl+Enter)"}," Save ")])])])):D("",!0)]),_:1})]))}},tt=ce(et,[["__scopeId","data-v-91a672b4"]]),st={class:"p-6 space-y-6"},at={class:"sticky top-0 z-10 bg-white/90 backdrop-blur border-b"},rt={class:"flex flex-wrap items-center justify-between gap-4 py-3"},nt={class:"flex items-center gap-2"},ot={key:0,class:"hidden md:flex items-center gap-2 text-xs text-gray-600","aria-label":"Summary"},lt={class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1"},it={class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1"},dt={class:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1"},ut=["disabled","aria-busy"],ct={key:0},pt={key:1},mt=["disabled","title","aria-busy"],vt={key:0},gt={key:1},bt={class:"card p-4 space-y-4"},yt={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ft=["value"],_t=["disabled"],ht=["value"],xt={key:0,class:"mt-2 text-sm text-rose-600"},wt={key:0,class:"card p-6 text-gray-600"},kt={key:1},Nt={key:0,class:"card p-6"},St={__name:"UserClearance",setup(N){const m=pe(),E=ne(),g=k(null),i=k(2),{userId:o,departments:h,statusFilter:f,users:S,itemsForTable:b,loading:$,saving:x,error:p,dirty:y}=oe(m),r=()=>y.value.size,u=()=>!!g.value&&!!i.value;V(()=>{var t;return(t=E.user)==null?void 0:t.department_id},async t=>{if(t){g.value=t,S.value=[],o.value=null;try{await m.loadUsersByDept(t),u()&&await m.refreshAll(t,i.value)}catch(e){console.error("bootstrap error",e)}}},{immediate:!0}),V(g,async t=>{if(S.value=[],o.value=null,t)try{await m.loadUsersByDept(t),i.value&&await m.refreshAll(t,i.value)}catch(e){console.error("dept change error",e)}}),V(i,async t=>{if(g.value&&t)try{await m.refreshAll(g.value,t)}catch(e){console.error("template change error",e)}}),V(o,async()=>{if(u()&&o.value)try{await m.loadClearances(o.value,g.value,i.value)}catch(t){console.error("user change error",t)}});function A(t,e){const a=b.value,w=a.findIndex(C=>C.template_item_id===t);w>=0&&(Object.assign(a[w],e),m.markDirty(t,!0))}async function T(){try{if(!o.value)return;await m.saveBulk(g.value,i.value)}catch(t){console.error(t)}}async function P(){if(u())try{await m.refreshAll(g.value,i.value),o.value&&await m.loadClearances(o.value,g.value,i.value)}catch(t){console.error("refresh error",t)}}const c=Y(()=>{if(!o.value)return{pending:0,working:0,completed:0};const t=b.value||[];return{pending:t.filter(e=>e.status==="PENDING").length,working:t.filter(e=>e.status==="WORKING").length,completed:t.filter(e=>e.status==="COMPLETED").length}});function n(t){y.value.size>0&&(t.preventDefault(),t.returnValue="")}return le(async()=>{typeof window<"u"&&window.addEventListener("beforeunload",n);try{await m.fetchDepartments()}catch(t){console.error("fetchDepartments error",t)}}),X(()=>{typeof window<"u"&&window.removeEventListener("beforeunload",n)}),ie((t,e,a)=>{if(y.value.size>0&&typeof window<"u"&&!window.confirm("You have unsaved changes. Leave anyway?"))return a(!1);a()}),(t,e)=>(l(),d("div",st,[s("div",at,[s("div",rt,[e[6]||(e[6]=s("div",{class:"p-2"},[s("h1",{class:"text-2xl font-semibold tracking-tight"},"User Clearance"),s("p",{class:"text-sm text-gray-600"}," Assign করা আইটেম অনুযায়ী ইউজারের ক্লিয়ারেন্স আপডেট করুন ")],-1)),s("div",nt,[_(o)?(l(),d("div",ot,[s("span",lt,[e[3]||(e[3]=U(" Pending: ")),s("b",null,v(c.value.pending),1)]),s("span",it,[e[4]||(e[4]=U(" Working: ")),s("b",null,v(c.value.working),1)]),s("span",dt,[e[5]||(e[5]=U(" Completed: ")),s("b",null,v(c.value.completed),1)])])):D("",!0),s("button",{class:"btn-2",onClick:P,disabled:_($)||!g.value||!i.value,title:"Reload template bindings and current user's items","aria-busy":_($)?"true":"false"},[_($)?(l(),d("span",ct,"Refreshing…")):(l(),d("span",pt,"Refresh"))],8,ut),s("button",{class:"btn-1",onClick:T,disabled:_(x)||_(y).size===0||!_(o),title:_(o)?"":"Select a user first","aria-busy":_(x)?"true":"false"},[_(x)?(l(),d("span",vt,"Saving…")):(l(),d("span",gt,"Save Changes ("+v(r())+")",1))],8,mt)])])]),s("div",bt,[s("div",yt,[s("div",null,[e[8]||(e[8]=s("label",{class:"text-sm font-medium"},"Department",-1)),M(s("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),class:"input-1"},[e[7]||(e[7]=s("option",{value:null},"Select Department",-1)),(l(!0),d(K,null,z(_(h),a=>(l(),d("option",{key:a.id,value:a.id},v(a.name),9,ft))),128))],512),[[F,g.value]])]),s("div",null,[e[10]||(e[10]=s("label",{class:"text-sm font-medium"},"User",-1)),M(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>q(o)?o.value=a:null),class:"input-1",disabled:!g.value},[e[9]||(e[9]=s("option",{value:null},"Select user",-1)),(l(!0),d(K,null,z(_(S),a=>(l(),d("option",{key:a.id,value:a.id},v(a.name),9,ht))),128))],8,_t),[[F,_(o)]])]),s("div",null,[e[12]||(e[12]=s("label",{class:"text-sm font-medium"},"Status Filter",-1)),M(s("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>q(f)?f.value=a:null),class:"input-1"},e[11]||(e[11]=[s("option",{value:""},"All",-1),s("option",{value:"PENDING"},"Pending",-1),s("option",{value:"WORKING"},"Working",-1),s("option",{value:"COMPLETED"},"Completed",-1)]),512),[[F,_(f)]])])]),_(p)?(l(),d("div",xt,v(_(p)),1)):D("",!0)]),_(o)?(l(),d("div",kt,[_($)?(l(),d("div",Nt,e[14]||(e[14]=[ue('<div class="animate-pulse space-y-3"><div class="h-4 bg-gray-200 rounded w-1/3"></div><div class="h-4 bg-gray-200 rounded w-2/3"></div><div class="h-4 bg-gray-200 rounded"></div><div class="h-4 bg-gray-200 rounded"></div></div>',1)]))):(l(),de(tt,{rows:_(b),key:_(o),"onUpdate:row":A},null,8,["rows"]))])):(l(),d("div",wt,e[13]||(e[13]=[U(" Select a "),s("b",null,"User",-1),U(" to load clearance items. ")])))]))}};export{St as default};
