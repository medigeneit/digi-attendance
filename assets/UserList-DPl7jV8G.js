import{r as b,q as B,A as U,s as D,c as r,f as R,o as c,a as e,n as F,t as f,h as v,g as k,C as L,F as w,x as C,v as T,u as X,b as Z,e as ee,k as te,l as g,p as M,i as oe,y as le}from"./index-DGK8Wbtz.js";import{L as se}from"./LoaderView-2GBcwiWH.js";import{u as H}from"./shift-D7x7hA4E.js";import{d as Y}from"./dayjs.min-Cbbdfn5l.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ne}from"./MultiselectDropdown-BN6BcYkG.js";import{_ as de}from"./UserChip-D-Zo07Z7.js";import{u as ie}from"./company-BK1fGjFi.js";import{u as re}from"./department-DHKtgDO2.js";import{u as ce}from"./user-6Ec0A6T6.js";import"./vue-multiselect.esm-BXmxVYxE.js";const pe={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},ue={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},fe={class:"text-lg font-semibold mb-4"},me={class:"mb-4"},ye=["value"],be={class:"mb-4"},ve={class:"mb-4"},_e={class:"flex justify-end gap-3 mt-4"},he={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(A,{emit:q}){const $=q,d=A,s=b({shift_id:"",employee_id:d.employee.id,start_date:"",end_date:""}),y=B(()=>{const p=Object.keys(d.shifts)[0];return d.shifts[p]||[]});U(()=>d.employee,p=>{s.value.employee_id=(p==null?void 0:p.id)||0},{immediate:!0,deep:!0}),U(()=>d.isOpen,p=>{var a;p&&(d.hasShift?(s.value.shift_id=d.hasShift.shift_id||"",s.value.start_date=d.hasShift.start_date?Y(d.hasShift.start_date).format("YYYY-MM-DD"):"",s.value.end_date=d.hasShift.end_date?Y(d.hasShift.end_date).format("YYYY-MM-DD"):"",s.value.employee_id=((a=d.employee)==null?void 0:a.id)||""):(s.value.shift_id="",s.value.start_date="",s.value.end_date=""))},{immediate:!0});const m=()=>{$("close",!1)},_=H(),{message:x}=D(_),S=async()=>{if(!s.value.shift_id||!s.value.start_date||!s.value.employee_id){alert("All fields are required!");return}try{const p={...s.value},a=await _.shiftAssign(p);console.log("Shift assigned successfully:",a),alert(d.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),m()}catch(p){console.error("Failed to assign shift:",p),alert("Failed to assign shift.")}};return(p,a)=>A.isOpen?(c(),r("div",pe,[e("div",ue,[e("h2",fe,f(d.hasShift?"Update Shift for":"Assign Shift to")+" "+f(A.employee.name),1),F(" "+f(v(x))+" ",1),e("div",me,[a[4]||(a[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),k(e("select",{"onUpdate:modelValue":a[0]||(a[0]=i=>s.value.shift_id=i),class:"w-full p-2 border rounded"},[a[3]||(a[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(c(!0),r(w,null,C(y.value,i=>(c(),r("option",{key:i==null?void 0:i.id,value:i==null?void 0:i.id},f(i==null?void 0:i.name),9,ye))),128))],512),[[L,s.value.shift_id]])]),e("div",be,[a[5]||(a[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),k(e("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=i=>s.value.start_date=i),class:"w-full border rounded p-2"},null,512),[[T,s.value.start_date]])]),e("div",ve,[a[6]||(a[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),k(e("input",{type:"date","onUpdate:modelValue":a[2]||(a[2]=i=>s.value.end_date=i),class:"w-full border rounded p-2"},null,512),[[T,s.value.end_date]])]),e("div",_e,[e("button",{onClick:m,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:S,class:"px-4 py-2 bg-green-600 text-white rounded"},f(d.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:m,class:"absolute top-2 right-2 text-red-500 text-xl"},a[7]||(a[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):R("",!0)}},xe=ae(he,[["__scopeId","data-v-c3e70801"]]),ge={class:"space-y-2 px-4"},Se={class:"flex items-center justify-between gap-2"},ke={class:"flex items-center gap-4"},we=["value"],Ce=["value"],Ue={key:0,class:"text-center py-4"},Ae={key:1,class:"space-y-4"},qe={class:"title-md"},Me={class:"overflow-x-auto"},De={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},Le={class:"border border-gray-300 px-2"},$e=["innerHTML"],Ee=["innerHTML"],je={class:"border border-gray-300 px-2"},Ve={class:"border border-gray-300 px-2"},Ne=["onClick"],Oe={key:0},Te={class:"border border-gray-300 px-2"},Ye={class:"border border-gray-300 px-2"},Be={class:"border border-gray-300 px-2"},Re={key:0,class:"text-green-500"},Fe={key:1,class:"text-red-500"},He={class:"border border-gray-300 px-2"},Ie={class:"flex gap-2"},lt={__name:"UserList",setup(A){const q=H(),{shifts:$}=D(q),d=X(),s=Z(),y=ce();b([]);const m=b(s.query.company||"all"),_=b(s.query.department||"all"),x=b(s.query.line_type||"all"),S=b(""),p=b(""),a=b(!1),i=re(),E=ie(),{companies:I}=D(E),{departments:z}=D(i);ee(()=>{y.fetchUsers(),E.fetchCompanies(),j(m.value)});const P=()=>{d.go(-1)};U(m,l=>{j(l),d.push({query:{...s.query,company:l}})}),U(_,l=>{d.push({query:{...s.query,department:l}})}),U(x,l=>{d.push({query:{...s.query,line_type:l}})});const j=async l=>{await i.fetchDepartments(l)},W=B(()=>{var h;let l=[...(y==null?void 0:y.users)||[]];m.value!=="all"&&(l=l.filter(t=>{var u;return((u=t==null?void 0:t.company)==null?void 0:u.id)==m.value})),_.value!=="all"&&(l=l.filter(t=>{var u;return((u=t==null?void 0:t.department)==null?void 0:u.id)==_.value})),x.value!=="all"&&(l=l.filter(t=>(t==null?void 0:t.type)==x.value)),(h=S.value)!=null&&h.id&&(l=l.filter(t=>(t==null?void 0:t.id)==S.value.id));const o={};return l.forEach(t=>{var n;const u=((n=t==null?void 0:t.company)==null?void 0:n.name)||"Unknown Company";o[u]||(o[u]=[]),o[u].push(t)}),o}),V=b("");function K(l){V.value=l.id,p.value=l,(l==null?void 0:l.company_id)!==void 0&&(q.fetchShifts(l==null?void 0:l.company_id),a.value=!a.value)}function G(){a.value=!1}async function J(){await y.fetchUsersExcelExport({data:{companyName:m.value}})}const N=l=>{if(l){const o=l.split(" "),h=o.slice(0,2).join(" "),t=o.length>2?`<br>${o.slice(2).join(" ")}`:"";return h+t}return""};return(l,o)=>{const h=te("RouterLink");return c(),r("div",ge,[e("div",Se,[e("button",{class:"btn-3",onClick:P},o[4]||(o[4]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),o[6]||(o[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),g(h,{to:{name:"UserAdd",query:{company:v(s).query.company}},class:"btn-2"},{default:M(()=>o[5]||(o[5]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[5]},8,["to"])]),e("div",ke,[e("div",null,[k(e("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>m.value=t),class:"input-1"},[o[7]||(o[7]=e("option",{value:"all",selected:""},"All Company",-1)),(c(!0),r(w,null,C(v(I),(t,u)=>(c(),r("option",{key:u,value:t.id},f(t==null?void 0:t.name),9,we))),128))],512),[[L,m.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>_.value=t),class:"input-1"},[o[8]||(o[8]=e("option",{value:"all",selected:""},"All Department",-1)),(c(!0),r(w,null,C(v(z),(t,u)=>(c(),r("option",{key:u,value:t.id},f(t==null?void 0:t.name),9,Ce))),128))],512),[[L,_.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>x.value=t),class:"input-1"},o[9]||(o[9]=[oe('<option value="all">All Category</option><option value="executive">Executive</option><option value="support_staff">Support Staff</option><option value="doctor">Doctor</option><option value="academy_body">Academy Body</option>',5)]),512),[[L,x.value]])]),g(ne,{modelValue:S.value,"onUpdate:modelValue":o[3]||(o[3]=t=>S.value=t),options:v(y).users,multiple:!1,label:"name","label-prefix":"employee_id",class:"w-1/3",placeholder:"Select user"},{option:M(({option:t})=>[g(de,{user:t,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),e("button",{type:"button",onClick:J,class:"btn-3"},o[10]||(o[10]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),F("Excel ")]))]),v(y).isLoading?(c(),r("div",Ue,[g(se)])):(c(),r("div",Ae,[(c(!0),r(w,null,C(W.value,(t,u)=>(c(),r("div",{key:u},[e("h2",qe,f(u)+" ("+f(t.length)+")",1),e("div",Me,[e("table",De,[o[13]||(o[13]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(c(!0),r(w,null,C(t,(n,Q)=>{var O;return c(),r("tr",{key:n.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",Le,f(Q+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:N(n==null?void 0:n.name)},null,8,$e),e("td",{class:"border border-gray-300 px-2",innerHTML:N((O=n==null?void 0:n.designation)==null?void 0:O.title)},null,8,Ee),e("td",je,f(n.role),1),e("td",Ve,[e("button",{type:"button",onClick:ze=>K(n),class:le(["btn-4 text-sm",n!=null&&n.current_shift?"bg-yellow-500 hover:bg-yellow-600":"btn-4"])},f(n!=null&&n.current_shift?"Change Shift":"Assign Shift"),11,Ne),V.value===n.id&&a.value?(c(),r("div",Oe,[g(xe,{isOpen:a.value,shifts:v($),hasShift:n==null?void 0:n.current_shift,employee:{id:p.value.id,name:p.value.name},onClose:G},null,8,["isOpen","shifts","hasShift","employee"])])):R("",!0)]),e("td",Te,f(n.phone),1),e("td",Ye,f(n.email||"নেই"),1),e("td",Be,[n.is_active?(c(),r("span",Re,"Active")):(c(),r("span",Fe,"Inactive"))]),e("td",He,[e("div",Ie,[g(h,{to:{name:"UserShow",params:{id:n.id},query:{company:v(s).query.company}},class:"btn-icon"},{default:M(()=>o[11]||(o[11]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[11]},1032,["to"]),g(h,{to:{name:"UserEdit",params:{id:n.id},query:{company:v(s).query.company}},class:"btn-icon"},{default:M(()=>o[12]||(o[12]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[12]},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{lt as default};
