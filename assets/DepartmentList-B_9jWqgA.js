import{u as U}from"./department-BDZ6QGHg.js";import{r as _,y as j,i as A,o as n,c as r,a as t,t as u,w as q,d as b,z as F,F as S,q as M,h as V,v as $,e as L,x as B,n as I,b as O,k}from"./index-h7mmMxW1.js";import{u as T}from"./company-CszXPeN3.js";import{_ as z,a as G}from"./HeaderWithButtons-Bb6nY50T.js";import{L as H}from"./LoaderView-BQ1Og2nT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={key:0,class:"modal-bg"},K={class:"modal-card"},P={class:"text-lg font-semibold mb-4"},Q={class:"mb-4"},R=["value"],W={class:"mb-4"},X={class:"mb-4"},Y={class:"mb-4"},Z={class:"mb-4"},ee={class:"flex justify-end"},te={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},se={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup(D,{emit:i}){const l=D,c=i,m=T(),d=m.companies,p=_(!1),v=_(!1),o=j({id:null,company_id:"",name:"",short_name:"",description:"",status:"Active"}),h=()=>{p.value=!1,o.id=null,o.company_id="",o.name="",o.short_name="",o.description="",o.status="Active"};A(()=>l.department,a=>{a&&typeof a=="object"&&Object.keys(a).length>0?(p.value=!0,o.id=a.id||null,o.company_id=a.company_id||"",o.name=a.name||"",o.short_name=a.short_name||"",o.description=a.description||"",o.status=a.status||"Active"):h()},{immediate:!0,deep:!0}),A(()=>l.show,async a=>{a&&!v.value&&await C()});const x=()=>{c("save",{...o}),h(),g()},g=()=>{h(),c("close")},C=async()=>{try{await m.fetchCompanies(),v.value=!0}catch(a){console.error("Failed to fetch companies:",a)}};return(a,e)=>D.show?(n(),r("div",J,[t("div",K,[t("h2",P,u(p.value?"Edit Department":"Add Department"),1),t("form",{onSubmit:q(x,["prevent"])},[t("div",Q,[e[6]||(e[6]=t("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),b(t("select",{id:"company_id","onUpdate:modelValue":e[0]||(e[0]=s=>o.company_id=s),class:"w-full border rounded px-3 py-2",required:""},[e[5]||(e[5]=t("option",{value:"",disabled:""},"Select a company",-1)),(n(!0),r(S,null,M(V(d),s=>(n(),r("option",{key:s.id,value:s.id},u(s.name),9,R))),128))],512),[[F,o.company_id]])]),t("div",W,[e[7]||(e[7]=t("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),b(t("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=s=>o.name=s),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[$,o.name]])]),t("div",X,[e[8]||(e[8]=t("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),b(t("input",{id:"short_name","onUpdate:modelValue":e[2]||(e[2]=s=>o.short_name=s),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[$,o.short_name]])]),t("div",Y,[e[9]||(e[9]=t("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),b(t("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=s=>o.description=s),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[$,o.description]])]),t("div",Z,[e[11]||(e[11]=t("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),b(t("select",{id:"status","onUpdate:modelValue":e[4]||(e[4]=s=>o.status=s),class:"w-full border rounded px-3 py-2",required:""},e[10]||(e[10]=[t("option",{value:"Active"},"Active",-1),t("option",{value:"Inactive"},"Inactive",-1)]),512),[[F,o.status]])]),t("div",ee,[t("button",{type:"button",onClick:g,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),t("button",te,u(p.value?"Update":"Create"),1)])],32)])])):L("",!0)}},oe={class:"my-container space-y-4"},ae={key:0,class:"text-center py-4"},le={key:1,class:"space-y-4"},ne={class:"title-md"},re={class:"overflow-x-auto"},de={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ie={class:"text-gray-600 text-sm"},ce={class:"py-3 px-2 text-left"},ue={class:"py-3 px-2 text-left whitespace-nowrap"},me={class:"py-3 px-2 text-center"},pe={class:"py-3 px-2 text-center"},fe={class:"flex item-center justify-center gap-4"},ye=["onClick"],ve=["onClick"],ke={__name:"DepartmentList",setup(D){const i=U(),l=B(),c=_(!1),m=_(!1),d=_(null),p=()=>{d.value=null,c.value=!0},v=()=>{c.value=!1},o=e=>{d.value=e,c.value=!0},h=e=>{d.value=e,m.value=!0},x=()=>{m.value=!1},g=async e=>{try{e.id?(await i.updateDepartment(e.id,e),l.success("Department updated successfully!")):(await i.createDepartment(e),l.success("Department added successfully!"))}catch(s){l.error("Failed to save department!"),console.error("Error handling save:",s)}finally{v()}},C=async()=>{var e;if(!((e=d.value)!=null&&e.id)){l.error("Invalid department selected for deletion!");return}try{await i.deleteDepartment(d.value.id),l.success("Department deleted successfully!")}catch(s){l.error("Failed to delete department!"),console.error("Error deleting department:",s)}finally{x()}},a=I(()=>{const e={};return i.departments.forEach(s=>{var w;const f=((w=s.company)==null?void 0:w.name)||"Unknown Company";e[f]||(e[f]=[]),e[f].push(s)}),e});return O(async()=>{try{await i.fetchDepartments()}catch(e){l.error("Failed to fetch departments!"),console.error("Error fetching departments:",e)}}),(e,s)=>{var f;return n(),r("div",oe,[k(G,{title:"Department List",onAdd:p}),V(i).loading?(n(),r("div",ae,[k(H)])):(n(),r("div",le,[(n(!0),r(S,null,M(a.value,(w,E)=>(n(),r("div",{key:E},[t("h2",ne,u(E),1),t("div",re,[t("table",de,[s[2]||(s[2]=t("thead",null,[t("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[t("th",{class:"py-3 px-2 text-left"},"Name"),t("th",{class:"py-3 px-2 text-left"},"Short Name"),t("th",{class:"py-3 px-2 text-center"},"Status"),t("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),t("tbody",ie,[(n(!0),r(S,null,M(w,y=>(n(),r("tr",{key:y.id,class:"border-b border-gray-200 hover:bg-gray-100"},[t("td",ce,u(y.name),1),t("td",ue,u(y.short_name),1),t("td",me,u(y.status),1),t("td",pe,[t("div",fe,[t("button",{onClick:N=>o(y),class:"text-blue-600 hover:text-blue-800"},s[0]||(s[0]=[t("i",{class:"fas fa-edit"},null,-1)]),8,ye),t("button",{onClick:N=>h(y),class:"text-red-600 hover:text-red-800"},s[1]||(s[1]=[t("i",{class:"fas fa-trash"},null,-1)]),8,ve)])])]))),128))])])])]))),128))])),k(se,{show:c.value,department:d.value,onClose:v,onSave:g},null,8,["show","department"]),k(z,{show:m.value,title:"Delete Department",message:`Are you sure you want to delete ${(f=d.value)==null?void 0:f.name}?`,onClose:x,onConfirm:C},null,8,["show","message"])])}}};export{ke as default};
