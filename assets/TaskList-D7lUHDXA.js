import{_ as ce}from"./CommentModal-BZKR65f2.js";import{_ as ke,a as fe}from"./TaskUserAssignForm-Dx3ByAPN.js";import{L as ve}from"./LoaderView-Cqw8cbFW.js";import{O as J}from"./OverlyModal-9D2xGhK9.js";import{_ as le,a as ge}from"./TaskAddForm-Biyu0cAF.js";import{_ as be}from"./TaskEditForm-Dwd_Ki5q.js";import{D as xe,q as c,c as i,o as a,a as t,h as D,v as ie,g,w as W,d as ue,b as de,r as P,e as me,A as X,n as we,f as U,p as x,F as E,C as ae,x as Y,t as Z,k as r,i as S,E as Q,j as oe,y as ee,u as Te,G as ne}from"./index-CwHJBxMl.js";import{_ as Ce}from"./MultiselectDropdown-DzQlwBuS.js";import{u as Ve}from"./company-BMq7ZAHX.js";import{_ as pe}from"./UserChip-CVyFRwgT.js";import{_ as ye}from"./TaskTreeView-p3pM-9yO.js";import{u as Ie}from"./task-priority-DlQz_lKT.js";import{u as Ae}from"./useTaskStore-Cm-YS5xW.js";import"./useCommentStore-DhFgiLo2.js";import"./datetime-q3Sn87-f.js";import"./TaskUrgencyInput-C2Jv_g_P.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-DpSoNFkA.js";import"./useRequirementStore-o1et01wv.js";import"./SectionLoading-BpZNk5ip.js";async function qe({params:b={}}={}){return xe.get("/tasks/employees",{params:b})}const Me={class:"text-gray-600 relative"},Se={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},re={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(b,{emit:k}){const d=b,u=k,f=n=>{u("update:modelValue",n||void 0)};let w=0;const C=c({get(){return d.modelValue},set(n){clearTimeout(w),w=setTimeout(f,500,n)}});return(n,l)=>(a(),i("div",Me,[l[3]||(l[3]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),D(t("input",{id:"search","onUpdate:modelValue":l[0]||(l[0]=m=>C.value=m),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[ie,C.value]]),t("div",Se,[C.value?(a(),i("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:l[1]||(l[1]=W(()=>f(""),["prevent"]))})):g("",!0),l[2]||(l[2]=t("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},Le={class:"mb-3 task-header"},$e={class:"flex justify-between items-start mb-4"},Ue={key:0,class:"ml-auto flex gap-6 items-center"},Ee={key:0,class:"flex gap-2 items-center"},_e={class:"flex flex-wrap items-center gap-2 mt-3"},De={class:"flex flex-wrap gap-4"},Pe={class:"relative w-full md:w-48"},Oe=["value"],he={key:1,class:"relative w-full md:w-72"},Be={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Ne={class:"text-gray-600 w-40 relative"},Re={class:"flex gap-4 items-center flex-shrink-0"},Fe={class:"flex gap-2"},je={class:"flex gap-2"},He={class:"flex gap-2"},ze={class:"text-gray-600 w-full md:w-40 relative"},Ge={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-5 gap-2"},We={key:1,class:"w-full flex justify-end gap-5 mt-4"},Ye={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(b,{emit:k}){const d=b,u=ue(),f=de(),w=c(T("company-id")),C=c(T("from-department-id")),n=c(T("to-department-id")),l=c(T("user-ids")),m=c(T("month")),v=c(T("status")),y=c(T("is-important")),V=c(T("is-urgent")),B=c(T("is-target")),O=c(j()),_=k,M=Ve(),A=P([]);function T(s){return{get:()=>d.modelValue[s]||"",set:e=>{_("update:modelValue",{...d.modelValue,[s]:e||void 0})}}}function j(){let s=0;const e=I=>{_("update:modelValue",{...d.modelValue,search:I||void 0})};return{get:()=>d.modelValue.search||"",set:I=>{clearTimeout(s),s=setTimeout(e,500,I)}}}const N=c(()=>H(l.value));async function R(){var s,e,I;if(d.isMyTask){const L=(s=d.modelValue)==null?void 0:s["company-id"],$=n.value,p={...L?{company_id:L}:{},...$?{department_ids:[$]}:{}};A.value=((I=(e=await qe({params:p}))==null?void 0:e.data)==null?void 0:I.employees)||[]}}me(async()=>{await R(),await M.fetchCompanies({with:"departments",ignore_permission:!0})});function H(s){return Array.isArray(A.value)&&A.value.find(e=>e.id==s)||null}function K(s){l.value=(s==null?void 0:s.id)||""}function z(){l.value=""}const G=c(()=>M==null?void 0:M.companies.filter(s=>s.id==w.value));return X(()=>n.value,R),X(()=>w.value,()=>{n.value!==""?n.value="":R()}),(s,e)=>{var L,$,p,h,q,te,se;const I=we("RouterLink");return a(),i(E,null,[t("div",Le,[t("div",$e,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),b.isMyTask?g("",!0):(a(),i("div",Ue,[b.listHasRearranged?(a(),i("div",Ee,[e[13]||(e[13]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=W(o=>_("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=W(o=>_("clickPriorityDiscard"),["prevent"]))},"Discard")])):g("",!0),t("button",{onClick:e[2]||(e[2]=o=>_("clickAddTask")),class:"btn-1"},"Add Task")]))]),t("div",_e,[t("div",De,[b.isMyTask?g("",!0):(a(),i(E,{key:0},[t("div",Pe,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),D(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>w.value=o),class:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[15]||(e[15]=t("option",{value:""},"--ALL COMPANY--",-1)),(a(!0),i(E,null,Y((L=r(M))==null?void 0:L.companies,o=>(a(),i("option",{key:o.id,value:o.id},Z(o.name),9,Oe))),128))],512),[[ae,w.value]])]),r(f).name!=="MyTaskList"?(a(),U(le,{key:0,modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value=o),companies:G.value||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:S(()=>e[17]||(e[17]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):g("",!0),r(u).isAdminMood&&((p=($=r(u))==null?void 0:$.user)==null?void 0:p.role)!=="employee"?(a(),i("div",he,[x(Ce,{modelValue:N.value,onSelect:K,onRemove:z,options:A.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full"},{option:S(({option:o})=>[x(pe,{user:o,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),N.value?(a(),i("div",Be,[t("button",{onClick:W(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):g("",!0),e[18]||(e[18]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):g("",!0)],64)),x(le,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=o=>C.value=o),companies:((h=r(M))==null?void 0:h.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:S(()=>e[19]||(e[19]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),t("div",Ne,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),D(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>v.value=o),class:"input-1"},e[20]||(e[20]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[ae,v.value]])]),t("div",Re,[t("label",Fe,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=o=>y.value=o)},null,512),[[Q,y.value]]),e[22]||(e[22]=t("span",null,"Important",-1))]),t("label",je,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=o=>V.value=o)},null,512),[[Q,V.value]]),e[23]||(e[23]=t("span",null,"Urgent",-1))]),t("label",He,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=o=>B.value=o)},null,512),[[Q,B.value]]),e[24]||(e[24]=t("span",null,"Is Target",-1))])]),t("div",ze,[e[25]||(e[25]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),D(t("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=o=>m.value=o),type:"month",class:"input-1",placeholder:"All month"},null,512),[[ie,m.value]])])]),b.isMyTask?(a(),U(re,{key:0,modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=o=>O.value=o),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):g("",!0)])]),t("div",Ge,[b.isMyTask?g("",!0):(a(),U(re,{key:0,modelValue:O.value,"onUpdate:modelValue":e[12]||(e[12]=o=>O.value=o),class:"w-full md:w-64 lg:w-96 md:ml-auto"},null,8,["modelValue"])),b.isMyTask?g("",!0):(a(),i("div",We,[x(I,{class:ee(["text-xs sm:text-sm btn-3 py-0.5",((q=r(f).query)==null?void 0:q.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...r(f).query,view:"userwise"}}},{default:S(()=>e[26]||(e[26]=[oe(" User Wise List ")])),_:1,__:[26]},8,["class","to"]),x(I,{class:ee(["text-xs sm:text-sm btn-3 py-0.5",((te=r(f).query)==null?void 0:te.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((se=r(f))==null?void 0:se.query)||{}).filter(o=>{var F;return((F=r(f))==null?void 0:F.query[o])!=="userwise"}).reduce((o,F)=>({...o,[F]:r(f).query[F]}),{})}}},{default:S(()=>e[27]||(e[27]=[oe(" TaskWise List ")])),_:1,__:[27]},8,["class","to"])]))])],64)}}},Ke={class:"w-full bg-white rounded"},Je=["rowspan"],Qe={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(b,{emit:k}){const d=b,u=k,f=c(()=>d.tasks.reduce((n,l)=>(n.push(...l.users.filter(m=>!n.find(v=>v.id==m.id&&m.id))),n),[]).filter(n=>d.selectedUserId?n.id==d.selectedUserId:!0)),w=n=>d.tasks.filter(v=>v.users.some(y=>y.id===n)),C=c(()=>f.value.map(n=>{const l=w(n.id);return{...n,tasks:l}}));return(n,l)=>(a(),i("div",null,[t("table",Ke,[t("tbody",null,[(a(!0),i(E,null,Y(C.value,m=>(a(),i(E,{key:m.id},[(a(!0),i(E,null,Y(m.tasks,(v,y)=>(a(),i("tr",{key:v.id},[y==0?(a(),i("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(m.tasks.length,1)},[x(pe,{user:m,class:"sticky top-[80px]"},null,8,["user"])],8,Je)):g("",!0),t("td",{class:ee(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":y==0,"border-b":m.tasks.length-1===y}])},[x(ye,{task:v,class:"!border-0 my-0",index:y,onCommentButtonClick:l[0]||(l[0]=V=>u("commentButtonClick",n.item.id)),onEditClick:l[1]||(l[1]=V=>u("editClick",V)),onAddClick:l[2]||(l[2]=V=>u("addClick",V)),onEmployeeAssignClick:l[3]||(l[3]=V=>u("employeeAssignClick",V))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Xe={class:"container mx-auto p-6 mt-2 relative bg-white rounded-md shadow-md"},Ze={class:"mb-4"},et={key:4},tt={key:0,class:"text-center py-4 text-red-500"},st={key:1},lt={class:"flex items-stretched"},at={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},ot=1,At={__name:"TaskList",setup(b){const k=Ae(),d=ue(),u=de(),f=Te(),w=P(!1),C=P(null),n=c(()=>{var s;return((s=d==null?void 0:d.user)==null?void 0:s.role)==="employee"||!(d!=null&&d.isAdminMood)?!0:!!u.query["user-ids"]}),l=P(null),m=P(!1),v=ne({parentId:0,requirementId:0}),y=ne({taskId:0,isOpen:!1}),V=P(null),B=P([]),{handleItemsPriorityUpdate:O,saveTaskPriority:_,listHasRearranged:M}=Ie(()=>k.taskListTree,0);me(async()=>{u.query.status||f.push({query:{...u.query,status:"not-completed"}}),await A()});async function A(){let s;u.name==="MyTaskList"?s=await k.fetchMyTasks({...u.query}):s=await k.fetchTasks({...u.query}),B.value=s.query_log||[]}const T=s=>{m.value=!0,v.parentId=s},j=s=>{y.taskId=s,y.isOpen=!0},N=s=>{C.value=s,w.value=!0},R=()=>{w.value=!1,C.value=null};async function H(){l.value=null,m.value=!1,v.parentId=0,await A()}async function K(){m.value=!1,v.parentId=0,await A()}async function z(){_()&&await A()}X(()=>({...u.query}),async()=>{await A()});const G=c({get(){return{...u.query}},set(s){localStorage.removeItem("sub_task_opened_list"),f.push({query:{...s}})}});return(s,e)=>{var I,L,$;return a(),i("div",Xe,[l.value?(a(),U(J,{key:0},{default:S(()=>[x(be,{taskId:l.value,onClose:e[0]||(e[0]=p=>l.value=null),onUpdated:H},null,8,["taskId"])]),_:1})):g("",!0),m.value?(a(),U(J,{key:1},{default:S(()=>[x(ge,{parentTaskId:v.parentId,requirementId:v.requirementId,onClose:K,onTaskCreated:H},null,8,["parentTaskId","requirementId"])]),_:1})):g("",!0),y.isOpen?(a(),U(J,{key:2,class:"*:max-w-4xl"},{default:S(()=>[x(ke,{taskId:y.taskId,onCancelClick:e[1]||(e[1]=()=>{y.isOpen=!1,y.taskId=0}),onSuccess:e[2]||(e[2]=()=>{y.isOpen=!1,y.taskId=0,A()})},null,8,["taskId"])]),_:1})):g("",!0),x(Ye,{modelValue:G.value,"onUpdate:modelValue":e[3]||(e[3]=p=>G.value=p),onClickAddTask:T,onClickPrioritySave:z,onClickPriorityDiscard:e[4]||(e[4]=()=>r(M)?V.value.resetItems:null),"list-has-rearranged":r(M),isMyTask:r(u).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((L=(I=r(u))==null?void 0:I.query)==null?void 0:L["query-log"])=="true"?(a(!0),i(E,{key:3},Y(B.value,(p,h)=>(a(),i("div",{key:h,class:"text-xs text-gray-500"},[t("div",Ze,Z(p.raw_query),1)]))),128)):g("",!0),r(k).loading?(a(),i("div",et,[x(ve)])):(a(),i(E,{key:5},[r(k).error?(a(),i("div",tt,Z(r(k).error),1)):r(k).tasks.length>0?(a(),i("div",st,[(($=r(u).query)==null?void 0:$.view)=="userwise"?(a(),U(Qe,{key:0,tasks:r(k).tasks,selectedUserId:r(u).query["user-ids"],onCommentButtonClick:e[5]||(e[5]=p=>N(p,s.task.id)),onEditClick:e[6]||(e[6]=p=>l.value=p),onAddClick:e[7]||(e[7]=p=>T(p)),onEmployeeAssignClick:e[8]||(e[8]=p=>j(p))},null,8,["tasks","selectedUserId"])):(a(),U(fe,{key:1,items:r(k).tasks,handle:"handle",onItemsUpdate:r(O),class:"space-y-4",ref_key:"draggableTaskList",ref:V},{item:S(({item:p,index:h})=>[t("div",lt,[x(ye,{task:p,index:h,showDraggableHandle:!n.value,onCommentButtonClick:e[9]||(e[9]=q=>N(q,s.task.id)),onEditClick:e[10]||(e[10]=q=>l.value=q),onAddClick:e[11]||(e[11]=q=>T(q)),onEmployeeAssignClick:e[12]||(e[12]=q=>j(q)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(a(),i("div",at," No tasks found. "))],64)),x(ce,{show:w.value,"commentable-id":C.value,"commentable-type":"task","user-id":ot,"on-close":R,onSubmitted:r(k).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{At as default};
