import{r as p,d as O,e as W,A as $,n as Y,c as l,o as r,a as t,f as z,g as _,h as k,v as N,p as V,k as c,t as g,j as C,B as M,F as x,y as w,w as E}from"./index-C1bkql9t.js";import{g as I}from"./datetime-Efw590t9.js";import{u as G}from"./company-BdLT_OVZ.js";import{u as H}from"./tags-BrINPR_b.js";import{u as J}from"./useTaskStore-CWLIiIwg.js";import{S as K}from"./SectionLoading-2j8Gclhf.js";import{_ as P}from"./MultiselectDropdown-aOvTGvyn.js";const Q={class:"px-4 max-h-[90vh] overflow-auto"},X={class:"sticky top-0 pt-4 -mx-4 px-4 border-b bg-white rounded-t-md"},Z={key:0,class:"text-center py-4 text-gray-500"},D={class:"mb-4"},ee={class:"mb-4"},te={key:0,class:"mb-4"},se={class:"mb-4"},oe={class:"block text-gray-600 text-sm mb-1 font-medium"},re=["label"],le=["value"],ae={class:"mb-4"},ie={class:"block text-gray-600 text-sm mb-1 font-medium"},ne=["label"],de=["value"],ue={class:"mb-4"},me={class:"sticky bottom-0 bg-white py-4 border-t"},pe={key:0,class:"mb-4 text-red-500 font-medium"},ce={key:1},ve={class:"flex items-center gap-4 justify-between"},be=["disabled"],he={__name:"TaskEditForm",props:{taskId:{type:[String,Number],required:!0}},emits:["updated","cancel"],setup(A,{emit:L}){const q=A,F=L,v=J(),y=p([]),U=H(),R=O(),h=G(),n=p(),i=p(!1),T=p([]),S=p(""),a=p({});W(async()=>{var s,e;i.value=!0,U.fetchTags("website"),n.value=(s=await v.fetchTask(q.taskId,{},{fetchOnly:!0,loadingBeforeFetch:!1}))==null?void 0:s.task,await h.fetchCompanies({with:"departments",ignore_permission:!0}),B(n.value),y.value=((e=n.value)==null?void 0:e.website_tags)||[],T.value=n.value.users,i.value=!1}),$(()=>n.value,s=>{B(s),T.value=s.users});function B(s){var e;a.value={title:s.title,description:s.description,requirement_id:s.requirement_id,from_department_id:s.from_department_id,to_department_id:s.to_department_id,...((e=R.user)==null?void 0:e.role)!=="employee"?{is_important:s.is_important,is_urgent:s.is_urgent,is_target:s.is_target,started_at:I(s.started_at),deadline:I(s.deadline)}:{}}}const j=async()=>{var s,e,b,f;i.value=!0;try{const u={...a.value,user_ids:((s=T.value)==null?void 0:s.map(m=>Number(m.id)))||[],website_tags:((e=y.value)==null?void 0:e.map(m=>Number(m.id)))||[]};await v.updateTask(q.taskId,u,{loadingBeforeFetch:!1}),F("updated")}catch(u){S.value=((f=(b=u.response)==null?void 0:b.data)==null?void 0:f.message)||"An error occurred while updating the task."}finally{i.value=!1}};return(s,e)=>{var f,u,m;const b=Y("RequiredIcon");return r(),l("div",Q,[t("div",X,[e[6]||(e[6]=t("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Edit Task",-1)),i.value?(r(),l("div",Z,"Loading form...")):_("",!0)]),t("form",{onSubmit:E(j,["prevent"]),class:"mt-4"},[t("div",D,[e[7]||(e[7]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task Title",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.title=o),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[N,a.value.title]])]),t("div",ee,[e[8]||(e[8]=t("label",{class:"text-gray-800"},"Websites",-1)),V(P,{options:c(U).tags,multiple:!0,modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=o=>y.value=o),label:"name","track-by":"id"},null,8,["options","modelValue"])]),(f=n.value)!=null&&f.requirement?(r(),l("div",te,[e[9]||(e[9]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Requirement",-1)),t("div",null,[t("p",null,g((m=(u=n.value)==null?void 0:u.requirement)==null?void 0:m.title),1)])])):_("",!0),t("div",se,[t("label",oe,[e[10]||(e[10]=C(" From Department ")),V(b)]),k(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.from_department_id=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[11]||(e[11]=t("option",{value:""},"--select department--",-1)),(r(!0),l(x,null,w(c(h).companies,o=>(r(),l("optgroup",{key:o.id,label:o.name},[(r(!0),l(x,null,w(o.departments,d=>(r(),l("option",{value:d.id,key:d.id},g(d.name),9,le))),128))],8,re))),128))],512),[[M,a.value.from_department_id]])]),t("div",ae,[t("label",ie,[e[12]||(e[12]=C(" To Department ")),V(b)]),k(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.to_department_id=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[13]||(e[13]=t("option",{value:""},"--select department--",-1)),(r(!0),l(x,null,w(c(h).companies,o=>(r(),l("optgroup",{key:o.id,label:o.name},[(r(!0),l(x,null,w(o.departments,d=>(r(),l("option",{value:d.id,key:d.id},g(d.name),9,de))),128))],8,ne))),128))],512),[[M,a.value.to_department_id]])]),t("div",ue,[e[14]||(e[14]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Description",-1)),k(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.description=o),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[N,a.value.description]])]),t("div",me,[c(v).error||S.value?(r(),l("div",pe,g(c(v).error||S.value),1)):_("",!0),c(v).error?(r(),l("hr",ce)):_("",!0),t("div",ve,[t("button",{type:"button",onClick:e[5]||(e[5]=E(o=>F("close"),["prevent"])),class:"btn-3"},"Cancel"),t("button",{disabled:i.value,type:"submit",class:"btn-2"},g(i.value?"Updating...":"Update Task"),9,be)])])],32),i.value?(r(),z(K,{key:0})):_("",!0)])}}};export{he as _};
