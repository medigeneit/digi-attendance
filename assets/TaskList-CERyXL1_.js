import{_ as ce}from"./CommentModal-Cu9qz1WU.js";import{_ as ke,a as fe}from"./TaskUserAssignForm-Dz-ujZIs.js";import{L as xe}from"./LoaderView-DR-ecsZZ.js";import{O as Z}from"./OverlyModal-BofY3SI1.js";import{_ as ge}from"./TaskAddForm-CyCfWY3L.js";import{_ as be}from"./TaskEditForm-CFqAfFs3.js";import{d as de,b as le,m as b,r as P,e as me,x as se,A as we,c as u,o as a,a as t,g as C,w as J,f as S,F,q as L,h as H,y as oe,n as G,t as Y,k as i,i as E,E as ee,v as Ce,j as te,p as ne,u as Te,s as re}from"./index-D2XudXqW.js";import{_ as Ie}from"./MultiselectDropdown-BFnL6X3G.js";import{g as Ae,u as Ve}from"./task-priority-BAfkDT3V.js";import{u as _e}from"./company-OF8UZBhv.js";import{_ as ie}from"./CompanyDepartmentSelectInput-oZFEmff0.js";import{_ as ue,m as pe}from"./task-tree-C6kTgALf.js";import{_ as ye}from"./UserChip-CuT18WaH.js";import{_ as ve}from"./TaskTreeViewWithSubTable-DZTJMN8y.js";import{u as Le}from"./useTaskStore-BXsc9aqp.js";import"./useCommentStore-CY0RD3ig.js";import"./datetime-DLUp6MRA.js";import"./TextWithHr-DuaRy-Qe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-OVJyamFG.js";import"./TaskUserChip-bVZRLwdM.js";import"./RequiredIcon-CL_Ct35-.js";import"./useRequirementStore-DUOwWl85.js";import"./requirement-awJOWhNu.js";import"./SectionLoading-C-Q1tCHD.js";import"./tags-eslYxDVY.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BWPmrLwM.js";import"./url-CePbr-gY.js";import"./TaskSupervisorAndEmployee-C1M2ReO0.js";const Me={class:"mb-3 task-header"},qe={class:"flex justify-between items-start mb-4"},Ue={key:0,class:"ml-auto flex gap-6 items-center"},Se={key:0,class:"flex gap-2 items-center"},$e={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ee={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},he={class:"relative w-full md:w-48 flex-grow"},De=["value"],Pe={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Oe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Be={class:"w-32 relative h-8"},Ne={class:"flex gap-4 items-center flex-shrink-0"},Fe={class:"flex gap-2"},je={class:"flex gap-2"},Re={class:"flex gap-2"},ze={class:"text-gray-600 w-full md:w-32 relative"},He={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},We={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},Ye={key:0,class:"text-[9px] text-green-800"},Ge=["onClick"],Ke={key:1,class:"flex justify-end gap-5"},Je={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(M,{emit:A}){const p=M,m=de(),T=le(),w=b(x("company-id")),q=b(x("from-department-id")),V=b(x("to-department-id")),y=b(x("user-ids")),n=b(x("month")),v=b(x("status")),k=b(x("is-important")),f=b(x("is-urgent")),_=b(x("is-target")),O=b(x("search")),j=A,$=_e(),h=P([]);function x(d){return{get:()=>p.modelValue[d]||"",set:e=>{j("update:modelValue",{...p.modelValue,[d]:e||void 0})}}}const B=b(()=>K(y.value));async function R(){var d,e,o;if(!p.isMyTask){const s=(d=p.modelValue)==null?void 0:d["company-id"],c=V.value,I={...s?{company_id:s}:{},...c?{department_ids:[c]}:{}};h.value=((o=(e=await Ae({params:I}))==null?void 0:e.data)==null?void 0:o.employees)||[]}}me(async()=>{await R(),await $.fetchCompanies({with:"departments",ignore_permission:!0}),await $.fetchMyCompanies({with:"departments"})});function K(d){return Array.isArray(h.value)&&h.value.find(e=>e.id==d)||null}function Q(d){y.value=(d==null?void 0:d.id)||""}function z(){y.value=""}se(()=>V.value,R),se(()=>w.value,()=>{V.value!==""?V.value="":R()});function N(d,e,{value:o,id:s,label:c,onCancel:I}={}){if(!d)return[];const g=Array.isArray(e)?e.find(r=>(r==null?void 0:r[s])==d):null;return g?[{label:c,value:g==null?void 0:g[o],id:g==null?void 0:g[s],onCancel:I}]:[]}const X=b(()=>{var s;const d=$.companies.reduce((c,I)=>[...c,...I.departments],[]),e=(c,{label:I,value:g,id:r,onCancel:D})=>c?[{label:I,value:g,id:r,onCancel:D}]:[],o=(c,{label:I,onCancel:g})=>{if(!c)return[];const r=new Date(c);return[{label:I,value:r.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:c,onCancel:g}]};return[...N(w.value,$.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{w.value=""}}),...N(q.value,d,{label:"From",value:"short_name",id:"id",onCancel:()=>{q.value=""}}),...N(V.value,d,{label:"To",value:"short_name",id:"id",onCancel:()=>{V.value=""}}),...N((s=B.value)==null?void 0:s.id,h.value,{label:"Employee",value:"name",id:"id",onCancel:z}),...N(v.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{v.value=""}}),...e(k.value,{label:"",value:"Important ",id:!0,onCancel:()=>{k.value=""}}),...e(f.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{f.value=""}}),...e(_.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{_.value=""}}),...o(n.value,{label:"",onCancel:()=>{n.value=""}})]});return(d,e)=>{var s,c,I,g,r,D,U,ae;const o=we("RouterLink");return a(),u(F,null,[t("div",Me,[t("div",qe,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),M.isMyTask?C("",!0):(a(),u("div",Ue,[M.listHasRearranged?(a(),u("div",Se,[e[13]||(e[13]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=J(l=>j("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=J(l=>j("clickPriorityDiscard"),["prevent"]))},"Discard")])):C("",!0),t("button",{onClick:e[2]||(e[2]=l=>j("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),t("div",$e,[t("div",Ee,[M.isMyTask?C("",!0):(a(),u(F,{key:0},[t("div",he,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),H(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>w.value=l),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[15]||(e[15]=t("option",{value:""},"--ALL COMPANY--",-1)),(a(!0),u(F,null,G((s=i($))==null?void 0:s.myCompanies,l=>(a(),u("option",{key:l.id,value:l.id},Y(l.name),9,De))),128))],512),[[oe,w.value]])]),L(ie,{modelValue:q.value,"onUpdate:modelValue":e[4]||(e[4]=l=>q.value=l),companies:((c=i($))==null?void 0:c.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:E(()=>e[17]||(e[17]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),i(T).name!=="MyTaskList"?(a(),S(ie,{key:0,modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l),companies:((I=i($))==null?void 0:I.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:E(()=>e[18]||(e[18]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):C("",!0),i(m).isAdminMood&&((r=(g=i(m))==null?void 0:g.user)==null?void 0:r.role)!=="employee"?(a(),u("div",Pe,[L(Ie,{modelValue:B.value,onSelect:Q,onRemove:z,options:h.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:E(({option:l})=>[L(ye,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),B.value?(a(),u("div",Oe,[t("button",{onClick:J(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):C("",!0),e[19]||(e[19]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):C("",!0)],64)),t("div",Be,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),H(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>v.value=l),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[20]||(e[20]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[oe,v.value]])]),t("div",Ne,[t("label",Fe,[H(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l)},null,512),[[ee,k.value]]),e[22]||(e[22]=t("span",null,"Important",-1))]),t("label",je,[H(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l)},null,512),[[ee,f.value]]),e[23]||(e[23]=t("span",null,"Urgent",-1))]),t("label",Re,[H(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=l=>_.value=l)},null,512),[[ee,_.value]]),e[24]||(e[24]=t("span",null,"Is Target",-1))])]),t("div",ze,[e[25]||(e[25]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),H(t("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=l=>n.value=l),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[Ce,n.value]])])]),M.isMyTask?(a(),S(ue,{key:0,modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=l=>O.value=l),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):C("",!0)])]),t("div",He,[M.isMyTask?C("",!0):(a(),S(ue,{key:0,modelValue:O.value,"onUpdate:modelValue":e[12]||(e[12]=l=>O.value=l),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),t("div",We,[(a(!0),u(F,null,G(X.value,l=>(a(),u("div",{key:l.label||l.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[t("div",null,[l.label?(a(),u("span",Ye,Y(l.label)+": ",1)):C("",!0),te(Y(l.value),1)]),t("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:J(l.onCancel,["prevent"])},e[26]||(e[26]=[t("i",{class:"fas fa-times-circle"},null,-1)]),8,Ge)]))),128))]),M.isMyTask?C("",!0):(a(),u("div",Ke,[L(o,{class:ne(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((D=i(T).query)==null?void 0:D.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...i(T).query,view:"userwise"}}},{default:E(()=>e[27]||(e[27]=[te(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),L(o,{class:ne(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((U=i(T).query)==null?void 0:U.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ae=i(T))==null?void 0:ae.query)||{}).filter(l=>{var W;return((W=i(T))==null?void 0:W.query[l])!=="userwise"}).reduce((l,W)=>({...l,[W]:i(T).query[W]}),{})}}},{default:E(()=>e[28]||(e[28]=[te(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},Qe={class:"w-full bg-white rounded"},Xe={class:"border p-4 align-top border-green-300 bg-blue-50"},Ze={class:"sticky top-[7rem] bg-white/80 py-2 z-40"},et={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(M,{emit:A}){const p=M,m=le(),T=A,w=b(()=>p.tasks.reduce((y,n)=>(y.push(...n.users.filter(v=>!y.find(k=>k.id==v.id&&v.id))),y),[]).filter(y=>p.selectedUserId?y.id==p.selectedUserId:!0)),q=y=>{const v=p.tasks.filter(k=>k.users.some(f=>f.id===y));return pe(v,{...m.query,"user-ids":y})},V=b(()=>w.value.map(y=>{const n=q(y.id);return{...y,tasks:n}}));return(y,n)=>(a(),u("div",null,[t("table",Qe,[t("tbody",null,[(a(!0),u(F,null,G(V.value,v=>(a(),u("tr",{key:v.id},[t("td",Xe,[t("div",null,[t("div",Ze,[L(ye,{user:v,class:""},null,8,["user"])]),(a(!0),u(F,null,G(v.tasks,(k,f)=>(a(),S(ve,{key:k.id,task:k,class:"!border-0 my-4",index:f,onCommentButtonClick:n[0]||(n[0]=_=>T("commentButtonClick",y.item.id)),onEditClick:n[1]||(n[1]=_=>T("editClick",_)),onAddClick:n[2]||(n[2]=_=>T("addClick",_)),onEmployeeAssignClick:n[3]||(n[3]=_=>T("employeeAssignClick",_))},null,8,["task","index"]))),128))])])]))),128))])])]))}},tt={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},st={class:"mb-4"},lt={class:"relative min-h-[30vh]"},at={key:0,class:"text-center py-4 text-red-500"},ot={key:1},nt={class:"flex items-stretched"},rt={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},it=1,Ot={__name:"TaskList",setup(M){const A=Le(),p=de(),m=le(),T=Te(),w=P(""),q=P(!1),V=P(null),y=b(()=>{var o;return((o=p==null?void 0:p.user)==null?void 0:o.role)==="employee"||!(p!=null&&p.isAdminMood)?!0:!!m.query["user-ids"]}),n=P(null),v=P(!1),k=re({parentId:0,requirementId:0}),f=re({taskId:0,isOpen:!1}),_=P(null),O=P([]),{handleItemsPriorityUpdate:j,saveTaskPriority:$,listHasRearranged:h}=Ve(()=>A.taskListTree,0);me(async()=>{w.value="loading",m.query.status?await x():T.push({query:{...m.query,status:"not-completed"}})});async function x(){let o;m.name==="MyTaskList"?o=await A.fetchMyTasks({...m.query,page:1}):o=await A.fetchTasks({...m.query,page:1},{infiniteScrolling:!1}),w.value="",O.value=o.query_log||[]}const B=o=>{v.value=!0,k.parentId=o},R=o=>{f.taskId=o,f.isOpen=!0},K=o=>{V.value=o,q.value=!0},Q=()=>{q.value=!1,V.value=null};async function z(){n.value=null,v.value=!1,k.parentId=0,w.value="loading",await x()}async function N(){v.value=!1,k.parentId=0,await x()}async function X(){w.value="loading",await $()&&await x()}se(()=>({...m.query}),async()=>{A.resetTaskList(),w.value="loading",await x()});const d=b({get(){return{...m.query}},set(o){localStorage.removeItem("sub_task_opened_list"),T.push({query:{...o}})}}),e=b(()=>{var s;const o={...m.query};return m.name=="MyTaskList"&&(o["user-ids"]=(s=p==null?void 0:p.user)==null?void 0:s.id),Array.isArray(A.tasks)?pe(A.tasks,o):[]});return(o,s)=>{var c,I,g;return a(),u("div",tt,[n.value?(a(),S(Z,{key:0},{default:E(()=>[L(be,{taskId:n.value,onClose:s[0]||(s[0]=r=>n.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):C("",!0),v.value?(a(),S(Z,{key:1},{default:E(()=>[L(ge,{parentTaskId:k.parentId,requirementId:k.requirementId,onClose:N,onTaskCreated:z},null,8,["parentTaskId","requirementId"])]),_:1})):C("",!0),f.isOpen?(a(),S(Z,{key:2,class:"*:max-w-4xl"},{default:E(()=>[L(ke,{taskId:f.taskId,onCancelClick:s[1]||(s[1]=()=>{f.isOpen=!1,f.taskId=0}),onSuccess:s[2]||(s[2]=()=>{f.isOpen=!1,f.taskId=0,w.value="loading",x()})},null,8,["taskId"])]),_:1})):C("",!0),L(Je,{modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=r=>d.value=r),onClickAddTask:B,onClickPrioritySave:X,onClickPriorityDiscard:s[4]||(s[4]=()=>i(h)?_.value.resetItems:null),"list-has-rearranged":i(h),isMyTask:i(m).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((I=(c=i(m))==null?void 0:c.query)==null?void 0:I["query-log"])=="true"?(a(!0),u(F,{key:3},G(O.value,(r,D)=>(a(),u("div",{key:D,class:"text-xs text-gray-500"},[t("div",st,Y(r.raw_query),1)]))),128)):C("",!0),t("div",lt,[i(A).error?(a(),u("div",at,Y(i(A).error),1)):i(A).tasks.length>0?(a(),u("div",ot,[((g=i(m).query)==null?void 0:g.view)=="userwise"?(a(),S(et,{key:0,tasks:e.value,selectedUserId:i(m).query["user-ids"],onCommentButtonClick:s[5]||(s[5]=r=>K(r,o.task.id)),onEditClick:s[6]||(s[6]=r=>n.value=r),onAddClick:s[7]||(s[7]=r=>B(r)),onEmployeeAssignClick:s[8]||(s[8]=r=>R(r))},null,8,["tasks","selectedUserId"])):(a(),S(fe,{key:1,items:e.value,handle:"handle",onItemsUpdate:i(j),class:"space-y-6",ref_key:"draggableTaskList",ref:_},{item:E(({item:r,index:D})=>[t("div",nt,[L(ve,{"is-my-task":i(m).name==="MyTaskList",task:r,index:D,showDraggableHandle:!y.value,onCommentButtonClick:s[9]||(s[9]=U=>K(U,o.task.id)),onEditClick:s[10]||(s[10]=U=>n.value=U),onAddClick:s[11]||(s[11]=U=>B(U)),onEmployeeAssignClick:s[12]||(s[12]=U=>R(U)),class:"!border-0 shadow hover:shadow-md"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):w.value!=="loading"?(a(),u("div",rt," No tasks found. ")):C("",!0),w.value==="loading"?(a(),S(xe,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):C("",!0)]),L(ce,{show:q.value,"commentable-id":V.value,"commentable-type":"task","user-id":it,"on-close":Q,onSubmitted:i(A).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Ot as default};
