import{O as v,N as x,r as p,x as h}from"./index-CYcJXZvR.js";import{o as F}from"./url-CePbr-gY.js";async function E(l,{params:u={}}={}){return v.get(`/todos/${l}/settings`,{params:u})}async function G(l,u){return v.post(`/todos/${l}/settings`,u)}async function H(l,u,{params:f={}}={}){const n=F(f);return v.delete(`/todos/${l}/settings/${u}${n?`?${n}`:""}`)}async function L({params:l={}}={}){return v.get("/todo-dates",{params:l})}async function P(l){return v.post("/todo-dates",l)}async function j(l,u){return v.get(`/todo-dates/${l}`,u)}async function C(l,u){return v.patch(`/my-todo-dates/${l}/status`,u)}async function O(l,{params:u={}}={}){const f=F(u);return v.delete(`/todo-dates/${l}${f?"?"+f:""}`)}const Q=x("todo-date",()=>{const l=p(null),u=p(!1),f=p(!1),n=p(null),s=p([]),D=async t=>{var e,r,o;u.value=!0,n.value=null;try{const a=await L({params:t});s.value=((e=a.data)==null?void 0:e.todo_dates)||[],T()}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"TodoDates load failed",a}finally{u.value=!1}};function T(){s.value=[...s.value.sort((t,e)=>(t==null?void 0:t.user_id)!==(e==null?void 0:e.user_id)?(t==null?void 0:t.user_id)-(e==null?void 0:e.user_id):t.priority!==e.priority?t.priority-e.priority:e.id-t.id)]}const w=async t=>{var e,r,o;u.value=!0,n.value=null;try{const a=await v.get("/my-todo-dates",{params:t});s.value=((e=a.data)==null?void 0:e.todo_dates)||[],T()}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"TodoDates load failed",a}finally{u.value=!1}},_=t=>{var e;return(e=s.value)==null?void 0:e.filter(r=>r.date==t)},$=async t=>{var e,r;u.value=!0,n.value=null;try{const o=await j(t);l.value=o.data.todo_date}catch(o){throw n.value=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||"Todo load failed",o}finally{u.value=!1}},S=async t=>{var e,r,o;u.value=!0,n.value=null;try{const a=await P(t);return s.value=[...s.value,(e=a.data)==null?void 0:e.todo_date],T(),a.data}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todo create failed",a}finally{u.value=!1}},M=t=>{s.value=[...s.value,t],T()},m=async(t,e)=>{var r,o;u.value=!0,n.value=null;try{const a=await m(t,e);return s.value=s.value.map(c=>{var y,d,i,g;return c.id==((d=(y=a.data)==null?void 0:y.todo)==null?void 0:d.id)?c.user?{...(i=a.data)==null?void 0:i.todo,user:{...c.user}}:{...(g=a.data)==null?void 0:g.todo}:{...c}}),a.data}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todo update failed",a}finally{u.value=!1}},N=async(t,e)=>{var r,o;u.value=!0,n.value=null;try{await C(t,{status:e}),s.value=s.value.map(a=>a.id===t?{...a,status:e}:{...a})}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to update todo status",a}finally{u.value=!1}},b=async(t,{date:e}={})=>{var r,o;u.value=!0,f.value=!0,n.value=null;try{const a=await v.put("/my-todo-dates/rearrange",{ids:t,date:e});s.value=s.value.map(c=>{var i;const d=(((i=a.data)==null?void 0:i.changes)||[]).find(g=>g.id==c.id);return d?{...c,priority:d.priority}:c}),T()}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todo rearranging failed",a}finally{f.value=!0,u.value=!1}};async function q(t){var e,r;u.value=!0,n.value=null;try{await O(t),s.value=s.value.filter(o=>o.id!==t)}catch(o){throw n.value=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||"Todo delete failed",o}finally{u.value=!1}}return{loading:h(()=>u.value),error:h(()=>n.value),todo_dates:h(()=>s.value),todo_date:h(()=>l.value),fetchTodoDates:D,fetchTodoDate:$,createTodoDate:S,updateTodoDate:m,rearrangeMyTodoDates:b,deleteTodoDate:q,fetchMyTodoDates:w,updateStatus:N,getTodoDatesByDate:_,setNewTodoDate:M}}),I=x("todo",()=>{const l=p(null),u=p(!1),f=p(!1),n=p(null),s=p([]),D=Q(),T=async t=>{var e,r,o;u.value=!0,n.value=null;try{const a=await v.get("/todos",{params:t});s.value=((e=a.data)==null?void 0:e.todos)||[],w()}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todos load failed",a}finally{u.value=!1}};function w(){s.value=[...s.value.sort((t,e)=>(t==null?void 0:t.user_id)!==(e==null?void 0:e.user_id)?(t==null?void 0:t.user_id)-(e==null?void 0:e.user_id):t.priority!==e.priority?t.priority-e.priority:e.id-t.id)]}const _=async t=>{var e,r,o;u.value=!0,n.value=null;try{const a=await v.get("/my-todos",{params:t});s.value=((e=a.data)==null?void 0:e.todos)||[],w()}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todos load failed",a}finally{u.value=!1}},$=t=>{var e;return(e=s.value)==null?void 0:e.filter(r=>r.date==t)},S=async t=>{var e,r;u.value=!0,n.value=null;try{const o=await v.get(`/todos/${t}`);l.value=o.data}catch(o){throw n.value=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||"Todo load failed",o}finally{u.value=!1}},M=async(t,{returnWith:e}={})=>{var r,o,a,c,y;u.value=!0,n.value=null;try{const d=await v.post("/todos",t,{params:{return_with:e}});return s.value=[...s.value,(r=d.data)==null?void 0:r.todo],(o=d==null?void 0:d.data)!=null&&o.todo_date&&D.setNewTodoDate((a=d==null?void 0:d.data)==null?void 0:a.todo_date),w(),d.data}catch(d){throw n.value=((y=(c=d.response)==null?void 0:c.data)==null?void 0:y.message)||"Todo create failed",d}finally{u.value=!1}},m=async(t,e)=>{var r,o;u.value=!0,n.value=null;try{const a=await v.put(`/todos/${t}`,e);return s.value=s.value.map(c=>{var y,d,i,g;return c.id==((d=(y=a.data)==null?void 0:y.todo)==null?void 0:d.id)?c.user?{...(i=a.data)==null?void 0:i.todo,user:{...c.user}}:{...(g=a.data)==null?void 0:g.todo}:{...c}}),a.data}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todo update failed",a}finally{u.value=!1}},N=async(t,e)=>{var r,o;u.value=!0,n.value=null;try{await v.put(`/todos/status/${t}`,{status:e}),s.value=s.value.map(a=>a.id===t?{...a,status:e}:{...a})}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to update todo status",a}finally{u.value=!1}},b=async(t,{date:e}={})=>{var r,o;u.value=!0,f.value=!0,n.value=null;try{const a=await v.put("/my-todos/rearrange",{ids:t,date:e});s.value=s.value.map(c=>{var i;const d=(((i=a.data)==null?void 0:i.changes)||[]).find(g=>g.id==c.id);return d?{...c,priority:d.priority}:c}),w()}catch(a){throw n.value=((o=(r=a.response)==null?void 0:r.data)==null?void 0:o.message)||"Todo rearranging failed",a}finally{f.value=!0,u.value=!1}},q=async t=>{var e,r;u.value=!0,n.value=null;try{await v.delete(`/todos/${t}`),s.value=s.value.filter(o=>o.id!==t)}catch(o){throw n.value=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.message)||"Todo delete failed",o}finally{u.value=!1}};return{todos:h(()=>s.value),todo:h(()=>l.value),loading:h(()=>u.value),error:h(()=>n.value),fetchTodos:T,fetchTodo:S,createTodo:M,updateTodo:m,rearrangeMyTodos:b,deleteTodo:q,fetchMyTodos:_,updateTodoStatus:N,getTodosByDate:$}});export{Q as a,G as b,H as d,E as f,I as u};
