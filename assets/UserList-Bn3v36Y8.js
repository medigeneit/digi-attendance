import{r as _,m as ee,n as C,z as E,c as i,g as O,o as d,a as e,j as te,t as f,k as x,h as S,D as q,F as D,q as M,v as X,u as fe,b as me,e as ue,A as ye,x as y,i as w,l as _e,s as G,X as Q}from"./index-DTbXQvub.js";import{L as ve}from"./LoaderView-BmgYN-mN.js";import{u as oe}from"./shift-DT3THDgl.js";import{d as Z}from"./dayjs.min-Cbbdfn5l.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as xe}from"./WeekendAssignModal-D4WmX0IR.js";import{_ as he}from"./MultiselectDropdown-C6JGDzp1.js";import{_ as ge}from"./UserChip-WmWi5Z0O.js";import{u as ke}from"./company-DyNzwqlv.js";import{u as Se}from"./department-7tJhsX_Y.js";import{u as we}from"./user-DoiH8AS_.js";const Ce={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},Ae={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},Ue={class:"text-lg font-semibold mb-4"},qe={class:"mb-4"},De=["value"],Me={class:"mb-4"},je={class:"mb-4"},$e={class:"flex justify-end gap-3 mt-4"},Ee={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(j,{emit:A}){const L=A,r=j,l=_({shift_id:"",employee_id:r.employee.id,start_date:"",end_date:""}),v=ee(()=>{const m=Object.keys(r.shifts)[0];return r.shifts[m]||[]});C(()=>r.employee,m=>{l.value.employee_id=(m==null?void 0:m.id)||0},{immediate:!0,deep:!0}),C(()=>r.isOpen,m=>{var n;m&&(r.hasShift?(l.value.shift_id=r.hasShift.shift_id||"",l.value.start_date=r.hasShift.start_date?Z(r.hasShift.start_date).format("YYYY-MM-DD"):"",l.value.end_date=r.hasShift.end_date?Z(r.hasShift.end_date).format("YYYY-MM-DD"):"",l.value.employee_id=((n=r.employee)==null?void 0:n.id)||""):(l.value.shift_id="",l.value.start_date="",l.value.end_date=""))},{immediate:!0});const u=()=>{L("close",!1)},b=oe(),{message:h}=E(b),g=async()=>{if(!l.value.shift_id||!l.value.start_date||!l.value.employee_id){alert("All fields are required!");return}try{const m={...l.value},n=await b.shiftAssign(m);console.log("Shift assigned successfully:",n),alert(r.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),u()}catch(m){console.error("Failed to assign shift:",m),alert("Failed to assign shift.")}};return(m,n)=>j.isOpen?(d(),i("div",Ce,[e("div",Ae,[e("h2",Ue,f(r.hasShift?"Update Shift for":"Assign Shift to")+" "+f(j.employee.name),1),te(" "+f(x(h))+" ",1),e("div",qe,[n[4]||(n[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),S(e("select",{"onUpdate:modelValue":n[0]||(n[0]=p=>l.value.shift_id=p),class:"w-full p-2 border rounded"},[n[3]||(n[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(d(!0),i(D,null,M(v.value,p=>(d(),i("option",{key:p==null?void 0:p.id,value:p==null?void 0:p.id},f(p==null?void 0:p.name),9,De))),128))],512),[[q,l.value.shift_id]])]),e("div",Me,[n[5]||(n[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),S(e("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=p=>l.value.start_date=p),class:"w-full border rounded p-2"},null,512),[[X,l.value.start_date]])]),e("div",je,[n[6]||(n[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),S(e("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=p=>l.value.end_date=p),class:"w-full border rounded p-2"},null,512),[[X,l.value.end_date]])]),e("div",$e,[e("button",{onClick:u,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:g,class:"px-4 py-2 bg-green-600 text-white rounded"},f(r.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:u,class:"absolute top-2 right-2 text-red-500 text-xl"},n[7]||(n[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):O("",!0)}},Le=be(Ee,[["__scopeId","data-v-c3e70801"]]),Oe={class:"space-y-2 px-4"},Ve={class:"flex items-center justify-between gap-2"},Ne={class:"flex gap-4"},Te={class:"flex flex-wrap items-center gap-4"},Ie=["value"],Ye=["value"],Be={key:0,class:"text-center py-4"},Re={key:1,class:"space-y-4"},Fe={class:"title-md"},We={class:"overflow-x-auto"},He={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ze={class:"border border-gray-300 px-2"},Pe=["innerHTML"],Je=["innerHTML"],Ke={class:"border border-gray-300 px-2"},Xe={class:"border border-gray-300 px-2"},Ge={class:"border border-gray-300 px-2"},Qe={class:"border border-gray-300 px-2"},Ze={class:"border border-gray-300 px-2 py-3"},et={class:"flex justify-center items-center gap-4"},tt={class:"text-sm text-gray-700"},ot={key:0,class:"text-green-600"},st={key:1,class:"text-red-500 italic"},at=["onClick"],lt={key:0},nt={key:1},it={key:0},dt={class:"border border-gray-300 px-2 py-3"},rt={class:"flex justify-center items-center gap-4"},pt={class:"text-sm text-gray-700"},ct={key:0,class:"text-green-600"},ft={key:1,class:"text-red-500 italic"},mt=["onClick"],ut={key:0},yt={key:1},_t={key:0},vt={class:"border border-gray-300 px-2"},bt={class:"border border-gray-300 px-2"},xt={class:"border border-gray-300 px-2"},ht={key:0,class:"text-green-500"},gt={key:1,class:"text-red-500"},kt={class:"border border-gray-300 px-2"},St={class:"flex gap-2"},Ot={__name:"UserList",setup(j){const A=oe(),{shifts:L}=E(A),r=fe(),l=me(),v=we(),u=_(l.query.company||"all"),b=_(l.query.department||"all"),h=_(l.query.line_type||"all"),g=_(l.query.status||"active"),m=_(""),n=_(""),p=_(!1),U=_(!1),V=Se(),N=ke(),{companies:se}=E(N),{departments:ae}=E(V);ue(()=>{v.fetchUsers(),N.fetchCompanies(),T(u.value)});const le=()=>{r.go(-1)};C(u,a=>{T(a),r.push({query:{...l.query,company:a}})}),C(b,a=>{r.push({query:{...l.query,department:a}})}),C(h,a=>{r.push({query:{...l.query,line_type:a}})}),C(g,a=>{r.push({query:{...l.query,status:a}})});const T=async a=>{await V.fetchDepartments(a)},ne=ee(()=>{var k;let a=[...(v==null?void 0:v.users)||[]];if(u.value!=="all"&&(a=a.filter(s=>{var c;return((c=s==null?void 0:s.company)==null?void 0:c.id)==u.value})),b.value!=="all"&&(a=a.filter(s=>{var c;return((c=s==null?void 0:s.department)==null?void 0:c.id)==b.value})),h.value!=="all"&&(a=a.filter(s=>(s==null?void 0:s.type)==h.value)),g.value){const s=g.value==="active"?1:0;a=a.filter(c=>(c==null?void 0:c.is_active)==s)}(k=m.value)!=null&&k.id&&(a=a.filter(s=>(s==null?void 0:s.id)==m.value.id));const o={};return a.forEach(s=>{var t;const c=((t=s==null?void 0:s.company)==null?void 0:t.name)||"Unknown Company";o[c]||(o[c]=[]),o[c].push(s)}),o}),$=_("");function ie(a){$.value=a.id,n.value=a,(a==null?void 0:a.company_id)!==void 0&&(A.fetchShifts(a==null?void 0:a.company_id),p.value=!p.value)}function de(a){$.value=a.id,n.value=a,(a==null?void 0:a.company_id)!==void 0&&(A.fetchShifts(a==null?void 0:a.company_id),U.value=!U.value)}function re(){p.value=!1}async function pe(){await v.fetchUsersExcelExport({data:{company_id:u.value,department_id:b.value,line_type:h.value,status:g.value}})}const I=a=>{if(a){const o=a.split(" "),k=o.slice(0,2).join(" "),s=o.length>2?`<br>${o.slice(2).join(" ")}`:"";return k+s}return""};return(a,o)=>{const k=ye("RouterLink");return d(),i("div",Oe,[e("div",Ve,[e("button",{class:"btn-3",onClick:le},o[6]||(o[6]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),o[9]||(o[9]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),e("div",Ne,[y(k,{to:{name:"UserAdd",query:{company:x(l).query.company}},class:"btn-2"},{default:w(()=>o[7]||(o[7]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[7]},8,["to"]),e("button",{type:"button",onClick:pe,class:"btn-3"},o[8]||(o[8]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),te("Excel ")]))])]),e("div",Te,[e("div",null,[S(e("select",{"onUpdate:modelValue":o[0]||(o[0]=s=>u.value=s),class:"input-1"},[o[10]||(o[10]=e("option",{value:"all",selected:""},"All Company",-1)),(d(!0),i(D,null,M(x(se),(s,c)=>(d(),i("option",{key:c,value:s.id},f(s==null?void 0:s.name),9,Ie))),128))],512),[[q,u.value]])]),e("div",null,[S(e("select",{"onUpdate:modelValue":o[1]||(o[1]=s=>b.value=s),class:"input-1"},[o[11]||(o[11]=e("option",{value:"all",selected:""},"All Department",-1)),(d(!0),i(D,null,M(x(ae),(s,c)=>(d(),i("option",{key:c,value:s.id},f(s==null?void 0:s.name),9,Ye))),128))],512),[[q,b.value]])]),e("div",null,[S(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>h.value=s),class:"input-1"},o[12]||(o[12]=[_e('<option value="all">All Category</option><option value="executive">Executive</option><option value="support_staff">Support Staff</option><option value="doctor">Doctor</option><option value="academy_body">Academy Body</option>',5)]),512),[[q,h.value]])]),e("div",null,[S(e("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>g.value=s),class:"input-1"},o[13]||(o[13]=[e("option",{value:"active"},"Active",-1),e("option",{value:"in_active"},"In Active",-1)]),512),[[q,g.value]])]),y(he,{modelValue:m.value,"onUpdate:modelValue":o[4]||(o[4]=s=>m.value=s),options:x(v).users,multiple:!1,label:"name","label-prefix":"employee_id",class:"w-1/3",placeholder:"Select user"},{option:w(({option:s})=>[y(ge,{user:s,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"])]),x(v).isLoading?(d(),i("div",Be,[y(ve)])):(d(),i("div",Re,[(d(!0),i(D,null,M(ne.value,(s,c)=>(d(),i("div",{key:c},[e("h2",Fe,f(c)+" ("+f(s.length)+")",1),e("div",We,[e("table",He,[o[20]||(o[20]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Finger ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Employee ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Joining Date"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Weekend"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(d(!0),i(D,null,M(s,(t,ce)=>{var Y,B,R,F,W,H,z,P,J;return d(),i("tr",{key:t.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ze,f(ce+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:I(t==null?void 0:t.name)},null,8,Pe),e("td",{class:"border border-gray-300 px-2",innerHTML:I((Y=t==null?void 0:t.designation)==null?void 0:Y.title)},null,8,Je),e("td",Ke,f(t==null?void 0:t.device_user_id),1),e("td",Xe,f(t==null?void 0:t.employee_id),1),e("td",Ge,f(t.joining_date),1),e("td",Qe,f(t.role),1),e("td",Ze,[e("div",et,[e("div",tt,[(R=(B=t.current_shift)==null?void 0:B.shift)!=null&&R.name?(d(),i("span",ot,f((F=t.current_shift.shift)==null?void 0:F.name),1)):(d(),i("span",st,"Not Assigned"))]),e("button",{type:"button",onClick:K=>ie(t),class:G(["px-3 py-1 rounded text-white text-xs transition-all duration-150",t!=null&&t.current_shift?"btn-1":"btn-2"])},[t!=null&&t.current_shift?(d(),i("span",lt,o[14]||(o[14]=[e("i",{class:"far fa-repeat-alt text-yellow-500 hover:text-yellow-600"},null,-1)]))):(d(),i("span",nt,o[15]||(o[15]=[e("i",{class:"far fa-plus"},null,-1)])))],10,at)]),y(Q,{name:"fade"},{default:w(()=>[$.value===t.id&&p.value?(d(),i("div",it,[y(Le,{isOpen:p.value,shifts:x(L),hasShift:t==null?void 0:t.current_shift,employee:{id:n.value.id,name:n.value.name},onClose:re},null,8,["isOpen","shifts","hasShift","employee"])])):O("",!0)]),_:2},1024)]),e("td",dt,[e("div",rt,[e("div",pt,[(W=t==null?void 0:t.assign_weekend)!=null&&W.weekends.length?(d(),i("span",ct,f((z=(H=t==null?void 0:t.assign_weekend)==null?void 0:H.weekends)==null?void 0:z.join(", ")),1)):(d(),i("span",ft,"Not Assigned"))]),e("button",{type:"button",onClick:K=>de(t),class:G(["px-3 py-1 rounded text-white text-xs transition-all duration-150",(P=t==null?void 0:t.assign_weekend)!=null&&P.weekends.length?"btn-1":"btn-2"])},[(J=t==null?void 0:t.assign_weekend)!=null&&J.weekends.length?(d(),i("span",ut,o[16]||(o[16]=[e("i",{class:"far fa-repeat-alt text-yellow-500 hover:text-yellow-600"},null,-1)]))):(d(),i("span",yt,o[17]||(o[17]=[e("i",{class:"far fa-plus"},null,-1)])))],10,mt)]),y(Q,{name:"fade"},{default:w(()=>[$.value===t.id&&U.value?(d(),i("div",_t,[y(xe,{isOpen:U.value,assign_weekend:t==null?void 0:t.assign_weekend,userId:t.id,onClose:o[5]||(o[5]=K=>U.value=!1)},null,8,["isOpen","assign_weekend","userId"])])):O("",!0)]),_:2},1024)]),e("td",vt,f(t.phone),1),e("td",bt,f(t.email||"নেই"),1),e("td",xt,[t.is_active?(d(),i("span",ht,"Active")):(d(),i("span",gt,"Inactive"))]),e("td",kt,[e("div",St,[y(k,{to:{name:"UserShow",params:{id:t.id},query:{company:x(l).query.company}},class:"btn-icon"},{default:w(()=>o[18]||(o[18]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[18]},1032,["to"]),y(k,{to:{name:"UserEdit",params:{id:t.id},query:{company:x(l).query.company}},class:"btn-icon"},{default:w(()=>o[19]||(o[19]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[19]},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{Ot as default};
