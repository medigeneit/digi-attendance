import{r as h,y as V,A as j,s as Y,o as r,c,a as e,t as p,l as B,h as _,d as A,C as R,F as M,x as q,v as O,e as F,b as W,m as S,n as $,f as G,p as K,q as J,g as Q}from"./index-faEahMGp.js";import{L as X}from"./LoaderView-KuHHRxzB.js";import{u as H}from"./shift-B1DZXmob.js";import{d as T}from"./dayjs.min-Cbbdfn5l.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ee}from"./MultiselectDropdown-Cw54AWao.js";import{u as te}from"./user-BeK-eVSc.js";import"./vue-multiselect.esm-Dm1fhep6.js";const se={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},oe={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},ae={class:"text-lg font-semibold mb-4"},le={class:"mb-4"},ne=["value"],de={class:"mb-4"},ie={class:"mb-4"},re={class:"flex justify-end gap-3 mt-4"},ce={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(C,{emit:U}){const L=U,n=C,o=h({shift_id:"",employee_id:n.employee.id,start_date:"",end_date:""}),y=V(()=>{const d=Object.keys(n.shifts)[0];return n.shifts[d]||[]});j(()=>n.employee,d=>{o.value.employee_id=(d==null?void 0:d.id)||0},{immediate:!0,deep:!0}),j(()=>n.isOpen,d=>{var a;d&&(n.hasShift?(o.value.shift_id=n.hasShift.shift_id||"",o.value.start_date=n.hasShift.start_date?T(n.hasShift.start_date).format("YYYY-MM-DD"):"",o.value.end_date=n.hasShift.end_date?T(n.hasShift.end_date).format("YYYY-MM-DD"):"",o.value.employee_id=((a=n.employee)==null?void 0:a.id)||""):(o.value.shift_id="",o.value.start_date="",o.value.end_date=""))},{immediate:!0});const v=()=>{L("close",!1)},m=H(),{message:g}=Y(m),k=async()=>{if(!o.value.shift_id||!o.value.start_date||!o.value.employee_id){alert("All fields are required!");return}try{const d={...o.value},a=await m.shiftAssign(d);console.log("Shift assigned successfully:",a),alert(n.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),v()}catch(d){console.error("Failed to assign shift:",d),alert("Failed to assign shift.")}};return(d,a)=>C.isOpen?(r(),c("div",se,[e("div",oe,[e("h2",ae,p(n.hasShift?"Update Shift for":"Assign Shift to")+" "+p(C.employee.name),1),B(" "+p(_(g))+" ",1),e("div",le,[a[4]||(a[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),A(e("select",{"onUpdate:modelValue":a[0]||(a[0]=i=>o.value.shift_id=i),class:"w-full p-2 border rounded"},[a[3]||(a[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(r(!0),c(M,null,q(y.value,i=>(r(),c("option",{key:i==null?void 0:i.id,value:i==null?void 0:i.id},p(i==null?void 0:i.name),9,ne))),128))],512),[[R,o.value.shift_id]])]),e("div",de,[a[5]||(a[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),A(e("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=i=>o.value.start_date=i),class:"w-full border rounded p-2"},null,512),[[O,o.value.start_date]])]),e("div",ie,[a[6]||(a[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),A(e("input",{type:"date","onUpdate:modelValue":a[2]||(a[2]=i=>o.value.end_date=i),class:"w-full border rounded p-2"},null,512),[[O,o.value.end_date]])]),e("div",re,[e("button",{onClick:v,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:k,class:"px-4 py-2 bg-green-600 text-white rounded"},p(n.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:v,class:"absolute top-2 right-2 text-red-500 text-xl"},a[7]||(a[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):F("",!0)}},fe=Z(ce,[["__scopeId","data-v-c3e70801"]]),pe={class:"space-y-2 px-4"},ue={class:"flex items-center justify-between gap-2"},me={class:"flex items-center gap-4"},ye={key:0,class:"text-center py-4"},be={key:1,class:"space-y-4"},he={class:"title-md"},_e={class:"overflow-x-auto"},ve={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ge={class:"border border-gray-300 px-2"},xe=["innerHTML"],Se=["innerHTML"],ke={class:"border border-gray-300 px-2"},we={class:"border border-gray-300 px-2"},Ce=["onClick"],Ue={key:0},Ae={class:"border border-gray-300 px-2"},Me={class:"border border-gray-300 px-2"},qe={class:"border border-gray-300 px-2"},Le={key:0,class:"text-green-500"},$e={key:1,class:"text-red-500"},je={class:"border border-gray-300 px-2"},Ee={class:"flex gap-2"},Fe={__name:"UserList",setup(C){const U=H(),{shifts:L}=Y(U),n=Q(),o=G(),y=te(),v=h([]),m=h(o.query.company||"all"),g=h(""),k=h(""),d=h(!1);W(()=>{y.fetchUsers()});const a=()=>{n.go(-1)};j(m,l=>{n.push({query:{...o.query,company:l}})});const i=V(()=>{var f;const l={},s=new Set;y==null||y.users.forEach(u=>{var x;const t=((x=u==null?void 0:u.company)==null?void 0:x.name)||"Unknown Company";l[t]||(l[t]=[]),l[t].push(u),s.add(t)}),v.value=Array.from(s);let b=l;if(m.value!=="all"&&(b={[m.value]:l[m.value]||[]}),(f=g.value)!=null&&f.id){const u={};for(const[t,x]of Object.entries(b)){const w=x.filter(N=>N.id===g.value.id);w.length&&(u[t]=w)}return u}return b}),E=h("");function I(l){E.value=l.id,k.value=l,(l==null?void 0:l.company_id)!==void 0&&(U.fetchShifts(l==null?void 0:l.company_id),d.value=!d.value)}function z(){d.value=!1}async function P(){await y.fetchUsersExcelExport({data:{companyName:m.value}})}const D=l=>{if(l){const s=l.split(" "),b=s.slice(0,2).join(" "),f=s.length>2?`<br>${s.slice(2).join(" ")}`:"";return b+f}return""};return(l,s)=>{const b=K("RouterLink");return r(),c("div",pe,[e("div",ue,[e("button",{class:"btn-3",onClick:a},s[2]||(s[2]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),s[4]||(s[4]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),S(b,{to:{name:"UserAdd",query:{company:_(o).query.company}},class:"btn-2"},{default:$(()=>s[3]||(s[3]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1},8,["to"])]),e("div",me,[e("div",null,[A(e("select",{"onUpdate:modelValue":s[0]||(s[0]=f=>m.value=f),class:"input-1"},[s[5]||(s[5]=e("option",{value:"all",selected:""},"All Company",-1)),(r(!0),c(M,null,q(v.value,(f,u)=>(r(),c("option",{key:u},p(f),1))),128))],512),[[R,m.value]])]),S(ee,{modelValue:g.value,"onUpdate:modelValue":s[1]||(s[1]=f=>g.value=f),options:_(y).users,multiple:!1,label:"name",class:"w-1/3",placeholder:"Select user"},null,8,["modelValue","options"]),e("button",{type:"button",onClick:P,class:"btn-3"},s[6]||(s[6]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),B("Excel ")]))]),_(y).isLoading?(r(),c("div",ye,[S(X)])):(r(),c("div",be,[(r(!0),c(M,null,q(i.value,(f,u)=>(r(),c("div",{key:u},[e("h2",he,p(u)+" ("+p(f.length)+")",1),e("div",_e,[e("table",ve,[s[9]||(s[9]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(r(!0),c(M,null,q(f,(t,x)=>{var w;return r(),c("tr",{key:t.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ge,p(x+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:D(t==null?void 0:t.name)},null,8,xe),e("td",{class:"border border-gray-300 px-2",innerHTML:D((w=t==null?void 0:t.designation)==null?void 0:w.title)},null,8,Se),e("td",ke,p(t.role),1),e("td",we,[e("button",{type:"button",onClick:N=>I(t),class:J(["btn-4 text-sm",t!=null&&t.current_shift?"bg-yellow-500 hover:bg-yellow-600":"btn-4"])},p(t!=null&&t.current_shift?"Change Shift":"Assign Shift"),11,Ce),E.value===t.id&&d.value?(r(),c("div",Ue,[S(fe,{isOpen:d.value,shifts:_(L),hasShift:t==null?void 0:t.current_shift,employee:{id:k.value.id,name:k.value.name},onClose:z},null,8,["isOpen","shifts","hasShift","employee"])])):F("",!0)]),e("td",Ae,p(t.phone),1),e("td",Me,p(t.email||"নেই"),1),e("td",qe,[t.is_active?(r(),c("span",Le,"Active")):(r(),c("span",$e,"Inactive"))]),e("td",je,[e("div",Ee,[S(b,{to:{name:"UserShow",params:{id:t.id},query:{company:_(o).query.company}},class:"btn-icon"},{default:$(()=>s[7]||(s[7]=[e("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"]),S(b,{to:{name:"UserEdit",params:{id:t.id},query:{company:_(o).query.company}},class:"btn-icon"},{default:$(()=>s[8]||(s[8]=[e("i",{class:"far fa-edit"},null,-1)])),_:2},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{Fe as default};
