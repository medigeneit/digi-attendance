import{c as a,o as s,F as $,x as L,m as p,p as _,I as Y,G as re,q as x,f as u,y as b,a as t,z as ae,n as w,t as m,T as le,l as y,B as K,k as Z,b as ne,r as Q,A as oe,w as S,h as ie}from"./index-gcJKwDZY.js";import{g as W}from"./datetime-BISRKKpq.js";import{_ as X}from"./UserChip-D09Eok3F.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"mt-3"},ue={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(e,{emit:o}){const l=o;return(c,i)=>(s(),a("div",de,[(s(!0),a($,null,L(e.childrenTasks,(f,g)=>(s(),p(lt,{key:f.id,index:g,task:f,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:i[0]||(i[0]=k=>l("editClick",k)),onAddClick:i[1]||(i[1]=k=>l("addClick",k))},{"item-end":_(({task:k,level:n})=>[Y(c.$slots,"treeItemEnd",{task:k,level:n})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ce=re({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:o}){const l=e,c=x(function(){return l.task.completed_count}),i=x(()=>l.task.children_task_count===0?l.task.status==="COMPLETED"?100:0:c.value/l.task.children_task_count*100),f=x(()=>{const g=i.value;let k,n,v;return g===100?(k="bg-green-50",n="bg-green-200",v="text-green-600 "):g<100&&(k="bg-red-50",n="bg-red-200",v="text-red-600 "),{container:k,bar:n,text:v}});return o({completedPercentage:i.value,completedSubTaskCount:c.value}),(g,k)=>(s(),a("div",null,[g.task.children_task_count>0?(s(),a("div",{key:0,class:b(["rounded-full border py-0.5 relative overflow-hidden h-6",f.value.container]),style:{width:"180px"}},[t("div",{class:b(["z-10 absolute top-0 bottom-0",f.value.bar]),style:ae(`width: ${i.value}%`)},null,6),t("span",{class:b(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",f.value.text])},[t("span",null,[t("span",null,m(c.value),1),k[0]||(k[0]=w(" / ")),t("span",null,m(g.task.children_task_count),1)])],2)],2)):u("",!0)]))}}),fe={key:0},ke={__name:"TaskStatus",props:{status:{type:String,required:!0},progressPercent:{type:Number,required:!0}},setup(e){const o=e,l=x(()=>{switch(o.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),c=x(()=>{switch(o.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(i,f)=>(s(),a("div",{class:b(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",l.value])},[t("i",{class:b(c.value)},null,2),t("span",null,m(e.status),1),e.progressPercent!==null||e.progressPercent!==void 0?(s(),a("span",fe,m(e.progressPercent)+"% ",1)):u("",!0)],2))}},me={class:"relative"},ge={key:0,class:"text-gray-500 text-xs"},xe={key:2,class:"text-sm text-gray-500 group/users"},be={class:"cursor-pointer hover:underline text-blue-600"},ve={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg"},he={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:()=>null},isTargetTask:{Boolean,default:!1}},setup(e){const o=e,l=x(()=>o.users.slice(0,2)),c=x(()=>o.users.slice(2));function i(g){if(typeof o.routeTo=="function")return o.routeTo(g)}const f=x(()=>typeof o.routeTo=="function"?le:"div");return(g,k)=>(s(),a("div",me,[o.users.length===0?(s(),a("div",ge,"Not Assigned To Anyone")):(s(!0),a($,{key:1},L(l.value,(n,v)=>(s(),p(K(f.value),{key:v,to:i(n)},{default:_(()=>[y(X,{class:b(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask}]),user:n},null,8,["class","user"])]),_:2},1032,["to"]))),128)),c.value.length>0?(s(),a("div",xe,[t("div",be," + "+m(c.value.length)+" more users ",1),t("div",ve,[(s(!0),a($,null,L(c.value,(n,v)=>(s(),p(K(f.value),{key:v,to:i(n),class:"w-full block mb-2"},{default:_(()=>[y(X,{class:b(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:n},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):u("",!0)]))}},ye={},pe={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function _e(e,o){return s(),a("span",pe,"IMPORTANT")}const we=ee(ye,[["render",_e]]),Te={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(o,l)=>{const c=Z("RouterLink");return s(),p(c,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:_(()=>[t("div",null,m(e.task.title),1)]),_:1},8,["to"])}}},Ce={},$e={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function Se(e,o){return s(),a("span",$e,"URGENT")}const Le=ee(Ce,[["render",Se]]),Ne={class:"flex w-full"},Be={key:0,class:"border-l border-gray-200 last:border-l-0"},Pe={class:"items-start grid grid-cols-4 gap-4 group"},Ee={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},Re={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},Ae={key:0,class:"text-xl font-semibold text-sky-500"},De={key:1,class:"text-sm text-gray-500 mt-2"},qe={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Ie={class:"flex items-center gap-6 flex-none lg:w-full order-0 lg:order-1"},Oe={class:"flex gap-4 items-center"},je={class:"text-gray-500 text-sm"},Ue={class:"text-red-500 text-sm"},Me={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},ze={class:"col-span-full flex items-center my-2 lg:my-0 justify-center flex-wrap gap-x-3 gap-y-2"},Ge={class:"text-xs px-2 py-0.5 rounded-full border bg-sky-500 text-white"},Ve={class:"text-xs px-2 py-0.5 rounded-full border bg-blue-500 text-white"},Fe={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4"},He={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Je={key:1,class:"text-gray-500"},Ke={class:"font-semibold text-green-800"},Qe={key:2,class:"ml-4 text-gray-500"},We={class:"text-red-500 font-semibold"},Xe={class:"mt-4 col-span-full"},Ye={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},Ze={class:"text-xs text-gray-500 flex gap-3 order-1 sm:order-0"},et=["href"],tt={class:"flex items-center sm:ml-auto order-0 sm:order-1"},st={key:0,class:"flex gap-2 ml-4 items-center text-xs"},rt=["href"],at={class:"ml-0"},lt={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick"],setup(e,{emit:o}){const l=e,c=ne(),i=Q(null),f=o;function g(d){f("addClick",d)}function k(d){f("editClick",d)}const n=Q([]),v=localStorage.getItem("sub_task_opened_list");if(v)try{n.value=JSON.parse(v)}catch{n.value=[]}const N=x(()=>W(l.task.started_at)),B=x(()=>W(l.task.deadline)),T=x({get:()=>n.value.includes(l.task.id),set:d=>{const r=n.value.includes(l.task.id);d&&!r?n.value.push(l.task.id):!d&&r&&(n.value=n.value.filter(C=>C!==l.task.id))}});oe(n,d=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(d))},{deep:!0});const P=x(()=>{var d,r;return((r=(d=l.task)==null?void 0:d.children_tasks)==null?void 0:r.length)>0});function te(){l.task.children_tasks.length>0&&(T.value=!T.value)}return(d,r)=>{var E,R,A,D,q,I,O,j,U,M,z,G,V,F,H,J;const C=Z("RouterLink");return s(),a("div",Ne,[e.treeLevel>0?(s(),a("div",Be,r[3]||(r[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):u("",!0),t("div",{class:b(["flex-grow border-2 rounded py-3 px-3",{"bg-green-100  ":((E=i.value)==null?void 0:E.completedPercentage)===100,"bg-white hover:bg-gray-50":((R=i.value)==null?void 0:R.completedPercentage)<100,"shadow-sm":e.treeLevel>0,"border-sky-500":e.index%2===0,"border-pink-300":e.index%2===1}])},[t("div",Pe,[t("div",Ee,[t("div",Re,[e.index!==void 0?(s(),a("div",Ae,m(e.index+1)+". ",1)):u("",!0),y(Te,{task:e.task},null,8,["task"]),(A=e.task)!=null&&A.requirement?(s(),a("p",De," Requirement: "+m((q=(D=e.task)==null?void 0:D.requirement)==null?void 0:q.title),1)):u("",!0)]),t("div",qe,[y(ke,{status:(I=e.task)==null?void 0:I.status,progressPercent:((O=e.task)==null?void 0:O.progress_percent)||0},null,8,["status","progressPercent"]),y(ce,{task:e.task,ref_key:"progress",ref:i,class:"text-sm"},null,8,["task"])]),t("div",Ie,[t("div",Oe,[e.showDraggableHandle?(s(),a("button",{key:0,onMousedown:r[0]||(r[0]=S((...h)=>d.handleDragging&&d.handleDragging(...h),["stop"])),class:"handle"},r[4]||(r[4]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):u("",!0),t("span",je," #"+m(e.task.id),1),t("div",Ue,m(e.treeLevel),1)]),t("div",Me,[(j=e.task)!=null&&j.is_important?(s(),p(we,{key:0})):u("",!0),(U=e.task)!=null&&U.is_urgent?(s(),p(Le,{key:1})):u("",!0)])])]),t("div",ze,[e.treeLevel===0?(s(),a($,{key:0},[t("div",Ge,m(((z=(M=e.task)==null?void 0:M.from_department)==null?void 0:z.name)||"--"),1),r[5]||(r[5]=t("span",{class:"text-2xl text-gray-400"},"â‡’",-1)),t("div",Ve,m(((V=(G=e.task)==null?void 0:G.to_department)==null?void 0:V.name)||"--"),1)],64)):u("",!0),y(he,{class:"flex items-center justify-center flex-wrap gap-x-3",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:h=>({query:{...ie(c).query,view:"userwise","company-id":h.company_id,"user-ids":h.id}})},null,8,["users","isTargetTask","routeTo"]),y(C,{to:{name:"TaskUserAssign",params:{id:(F=e.task)==null?void 0:F.id}},title:"Add/Remove User",class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},{default:_(()=>r[6]||(r[6]=[t("i",{class:"fas fa-users-cog"},null,-1)])),_:1,__:[6]},8,["to"])])]),t("div",Fe,[e.task.is_target?(s(),a("div",He," TARGET TASK ")):u("",!0),N.value?(s(),a("span",Je,[r[7]||(r[7]=w(" Started: ")),t("span",Ke,m(N.value),1)])):u("",!0),B.value?(s(),a("span",Qe,[r[8]||(r[8]=w(" Deadline: ")),t("span",We,m(B.value),1)])):u("",!0)]),t("div",Xe,[t("div",Ye,[t("div",Ze,[t("button",{class:b([{"text-yellow-600 font-semibold  inline-block  ":P.value},"flex items-center gap-1 group"]),onClick:te},[t("i",{class:b([T.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:b(P.value?"group-hover:underline":"")}," Sub Tasks ("+m((H=e.task.children_tasks)==null?void 0:H.length)+") ",3)],2),e.treeLevel<2?(s(),a("a",{key:0,href:`/tasks/add?parent_id=${l.task.id}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:r[1]||(r[1]=S(h=>f("addClick",l.task.id),["stop","prevent"]))},r[9]||(r[9]=[t("i",{class:"fas fa-plus"},null,-1),w(" Add Sub Task ")]),8,et)):u("",!0)]),t("div",tt,[e.hideButtons?u("",!0):(s(),a("div",st,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:r[2]||(r[2]=S(h=>f("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},r[10]||(r[10]=[t("i",{class:"fas fa-edit"},null,-1),w(" Edit ")]),8,rt),y(C,{to:{name:"TaskReports",params:{id:(J=e.task)==null?void 0:J.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:_(()=>r[11]||(r[11]=[t("i",{class:"far fa-file-alt"},null,-1),w(" Reports ")])),_:1,__:[11]},8,["to"])]))])]),t("div",at,[T.value?(s(),p(ue,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:k,onAddClick:g},{"tree-item-end":_(({task:h,level:se})=>[Y(d.$slots,"item-end",{level:se,task:h})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):u("",!0)])])],2)])}}};export{lt as _,ke as a,ce as b};
