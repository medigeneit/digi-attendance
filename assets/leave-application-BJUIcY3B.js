import{S as W,r as v,Q as u,aa as X}from"./index-DKvvHbAy.js";const O=W("leaveApplication",()=>{const d=v([]),s=v([]),f=v(null),o=v(!1),i=v(null),A=v(new Date().toISOString().substring(0,7)),I=v(new Date().getFullYear()),h=v(null),w=v([]),x=v(""),F=v(null),E=v(null),$=v([]),L=v(null);async function g(a={}){var l,n;o.value=!0,i.value=null;try{const t=await u.get("/leave-applications",{params:a});t.data?s.value=t.data:s.value=[]}catch(t){i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to fetch leave applications"}finally{o.value=!1}}const S=async(a,l)=>{var n,t;if(!a||!l){i.value="Invalid user ID or month";return}o.value=!0;try{const e=await u.get(`/user/${a}/application/monthly/${l}/log`);console.log({response:e}),d.value=e.data.applications}catch(e){i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Something went wrong",console.error(i.value)}finally{o.value=!1}},_=async(a,l)=>{var n,t;i.value=null,o.value=!0;try{if(typeof a=="object"||!l){const y=typeof a=="object"?a:{},m=y.month||l;if(!m)throw new Error("Month is required");const{companyId:z=null,departmentId:G=null,employee_id:J,line_type:K,includeEmpty:V=!1}=y,{data:p}=await u.get("/reports/monthly-applications",{params:{month:m,company_id:z||void 0,department_id:G||void 0,employee_id:J||null,line_type:K||"all",include_empty:V?1:0}});return $.value=Array.isArray(p==null?void 0:p.results)?p.results:[],L.value=(p==null?void 0:p.month)||m,p}const e=a,r=l;if(!e||!r)throw new Error("Invalid user ID or month");const{data:c}=await u.get(`/user/application/monthly/${encodeURIComponent(r)}/report`,{params:{user_id:e}});return d.value=(c==null?void 0:c.applications)||[],E.value=(c==null?void 0:c.user)||null,F.value=(c==null?void 0:c.month)||r,c}catch(e){return console.error(e),i.value=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Something went wrong",null}finally{o.value=!1}};async function b(a={}){var l,n,t,e,r;o.value=!0,i.value=null;try{const c=await u.get("/yearly-user-leave-applications",{params:a});c.data?(s.value=(l=c==null?void 0:c.data)==null?void 0:l.leave_applications,h.value=(n=c==null?void 0:c.data)==null?void 0:n.user,w.value=(t=c==null?void 0:c.data)==null?void 0:t.leave_balances):(s.value=[],h.value=[])}catch(c){i.value=((r=(e=c.response)==null?void 0:e.data)==null?void 0:r.message)||"Failed to fetch leave applications"}finally{o.value=!1}}async function j(a={}){var l,n;o.value=!0,i.value=null;try{const t=await u.get("/my-leave-applications",{params:a});s.value=t.data.data}catch(t){i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to fetch leave applications"}finally{o.value=!1}}async function C(a){var l,n,t,e;o.value=!0,i.value=null;try{const r=await u.post("/leave-applications/store",a);return s.value.push((l=r==null?void 0:r.data)==null?void 0:l.data),(n=r==null?void 0:r.data)==null?void 0:n.data}catch(r){throw i.value=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to store leave application",new Error(i.value)}finally{o.value=!1}}async function D(a){var l,n,t;o.value=!0,i.value=null;try{console.log(111);const e=await u.post("/admin-leave-applications/store",a);return console.log(e),(l=e==null?void 0:e.data)==null?void 0:l.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to store leave application",new Error(i.value)}finally{o.value=!1}}async function M(a){var l,n;o.value=!0,i.value=null;try{await u.delete(`/my-leave-application/destroy/${a}`),await g()}catch(t){throw i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to store leave application",new Error(i.value)}finally{o.value=!1}}const R=async a=>{var l,n;try{return o.value=!0,(await u.post("cental-attachment-upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(t){i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Something went wrong"}finally{o.value=!1}};async function U(a,l){var n,t;o.value=!0,i.value=null;try{const e=await u.post(`/leave-applications/${a}/update`,l),r=s.value.findIndex(c=>c.id===a);return r!==-1&&(s.value[r]=e.data.data),e.data.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to update leave application",new Error(i.value)}finally{o.value=!1}}const B=async(a,l)=>{var n,t;o.value=!0,i.value=null;try{const e=await u.put(`/leave-attachment/${a}`,l),r=s.value.findIndex(c=>c.id===a);return r!==-1&&(s.value[r]=e.data.data),e.data.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||`Failed to update application leave (ID: ${a})`,console.error(`Error updating application leave with id ${a}:`,e),new Error(i.value)}finally{o.value=!1}};async function Y(a){var l,n;o.value=!0,i.value=null;try{const t=await u.get(`/leave-applications/${a}`);f.value=t==null?void 0:t.data,await X().fetchApprovalPermissions("leave_applications",f.value.id)}catch(t){i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to fetch leave application"}finally{o.value=!1}}async function q(a){var l,n;o.value=!0,i.value=null;try{const t=await u.post(`/leave-applications/${a.id}/handover-accept`,a),e=s.value.findIndex(r=>r.id===(a==null?void 0:a.id));return e!==-1&&(s.value[e]=t.data.data),t.data.data}catch(t){throw i.value=((n=(l=t.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to accept handover",new Error(i.value)}finally{o.value=!1}}async function H(a){var l,n,t;o.value=!0,i.value=null;try{const e=await u.post(`/leave-applications/${a.id}/incharge-accept`,a),r=s.value.findIndex(c=>c.id===(a==null?void 0:a.id));return r!==-1&&(s.value[r]=e.data.data),(l=e==null?void 0:e.data)==null?void 0:l.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept in-charge approval",new Error(i.value)}finally{o.value=!1}}async function N(a){var l,n,t;o.value=!0,i.value=null;try{const e=await u.post(`/leave-applications/${a.id}/coordinator-accept`,a),r=s.value.findIndex(c=>c.id===(a==null?void 0:a.id));return r!==-1&&(s.value[r]=e.data.data),(l=e==null?void 0:e.data)==null?void 0:l.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept coordinator approval",new Error(i.value)}finally{o.value=!1}}async function P(a){var l,n,t;o.value=!0,i.value=null;try{const e=await u.post(`/leave-applications/${a.id}/operational-admin-accept`,a),r=s.value.findIndex(c=>c.id===(a==null?void 0:a.id));return r!==-1&&(s.value[r]=e.data.data),(l=e==null?void 0:e.data)==null?void 0:l.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept operational admin approval",new Error(i.value)}finally{o.value=!1}}async function Q(a){var l,n,t;o.value=!0,i.value=null;try{const e=await u.post(`/leave-applications/${a.id}/recommend-by-accept`,a),r=s.value.findIndex(c=>c.id===(a==null?void 0:a.id));return r!==-1&&(s.value[r]=e.data.data),(l=e==null?void 0:e.data)==null?void 0:l.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept recommend by approval",new Error(i.value)}finally{o.value=!1}}async function T(a){var l,n,t;o.value=!0,i.value=null;try{const e=await u.post(`/leave-applications/${a==null?void 0:a.id}/approved-by-accept`,a),r=s.value.findIndex(c=>c.id===(a==null?void 0:a.id));return r!==-1&&(s.value[r]=e.data.data),(l=e==null?void 0:e.data)==null?void 0:l.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to accept approval by admin",new Error(i.value)}finally{o.value=!1}}async function k(a,l){var n,t;o.value=!0,i.value=null;try{const e=await u.post(`/leave-applications/${a}/reject`,l),r=s.value.findIndex(c=>c.id===a);return r!==-1&&(s.value[r]=e.data.data),e.data.data}catch(e){throw i.value=((t=(n=e.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to reject leave application",new Error(i.value)}finally{o.value=!1}}return{leaveApplications:s,leaveApplication:f,applicationLog:d,loading:o,error:i,selectedMonth:A,selectedYear:I,user:h,selectedStatus:x,fetchLeaveApplications:g,storeLeaveApplication:C,updateLeaveApplication:U,fetchLeaveApplicationById:Y,acceptHandover:q,acceptInCharge:H,acceptCoordinator:N,acceptOperationalAdmin:P,acceptRecommendBy:Q,acceptApprovedBy:T,rejectLeaveApplication:k,fetchMyLeaveApplications:j,deleteLeaveApplication:M,fetchFileUpload:R,uploadLeaveApplicationAttachment:B,fetchYearlyUserLeaveApplications:b,getMonthlyApplicationLog:S,storeAdminLeaveApplication:D,leave_balances:w,getMonthlyApplicationSummary:_}});export{O as u};
