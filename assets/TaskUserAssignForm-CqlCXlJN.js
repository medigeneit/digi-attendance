import{x as R,j as z,o as t,m as k,d as S,a as s,s as J,X as K,c as i,k as c,w as B,g as ee,r as w,h as P,t as C,n as A,F as W,e as se,l as H,v as X}from"./index-9-9A3XjL.js";import{g as Y}from"./datetime-y2WWmmYq.js";import{u as te}from"./user-D8qPZT-l.js";import{u as le}from"./useTaskStore-CY9G47eL.js";import{L as ae}from"./LoaderView-D1k9g25K.js";import{T as oe}from"./TextWithHr-BoBFzSl9.js";import{_ as re,a as ne}from"./TaskUrgencyInput-dR3oPee8.js";import{_ as ie}from"./DraggableList.vue_vue_type_script_setup_true_lang-DAUiiXcu.js";import{S as ue}from"./SelectDropdown-CDYBaUHA.js";import{_ as F}from"./UserChip-Dn7-9lfD.js";const de={class:"w-full"},me=["onClick"],pe={key:2,class:"btn-icon size-6 bg-blue-200 text-blue-800 border-blue-300"},ce={key:3,class:"btn-icon size-8 ml-auto bg-blue-200 text-blue-800 border-blue-300"},G={__name:"TaskAssignEmployeeInput",props:{modelValue:{type:Array,default:()=>[]},employees:{type:Array,required:!0},listType:{type:String,default:"employee"},placeholder:{type:String,default:""},isRemovable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(d,{emit:V}){const b=d,v=V,h=R({get(){return b.modelValue},set(p){v("update:modelValue",p)}});function m(p){h.value=[...p],console.log({newList:p})}function g(){return b.listType==="supervisor"}function o(p){return b.listType==="employee"&&p===0}return(p,u)=>(t(),z(ue,{modelValue:h.value,"onUpdate:modelValue":u[0]||(u[0]=x=>h.value=x),options:d.employees,placeholder:d.placeholder,class:"border-gray-300 bg-sky-50/10 !rounded-2xl shadow-sm",multiple:"","hide-selected-value":""},{"selected-options":k(({items:x,removeItem:l,getOption:a})=>[s("div",de,[S(ie,{items:x||[],handle:"handle",class:"flex flex-col gap-x-4 gap-y-2 w-full",onItemsUpdate:m},{item:k(({item:T,index:f})=>[S(F,{user:a(T),isRemovable:f>0,isSortable:f>0,"avatar-size":o(f)?"medium":"small","avatar-class":["transition"],class:J(["w-full flex bg-sky-100/40 !shadow-sm border-sky-200 "]),onRemoveClick:()=>l(T),onClick:E=>o(f)?E.stopPropagation():null},K({after:k(()=>[!o(f)||g()?(t(),i("button",{key:0,class:"btn-icon size-6 ml-auto font-bold text-base text-red-600/60 hover:text-red-600 border border-red-200 flex items-center justify-center",onClick:B(E=>l(T),["prevent","stop"])},u[2]||(u[2]=[s("i",{class:"fas fa-times"},null,-1)]),8,me)):c("",!0),x.length>1&&!o(f)&&!g()?(t(),i("button",{key:1,type:"button",class:"btn-icon size-6 handle text-gray-500 hover:text-gray-800",onClick:B(()=>null,["stop"])},u[3]||(u[3]=[s("i",{class:"fas fa-arrows"},null,-1)]))):c("",!0),g()?(t(),i("div",pe,u[4]||(u[4]=[s("i",{class:"fas fa-user-cowboy text-base"},null,-1)]))):o(f)?(t(),i("div",ce,u[5]||(u[5]=[s("i",{class:"fas fa-user-crown text-xl"},null,-1)]))):c("",!0)]),_:2},[o(f)?{name:"title-bottom",fn:k(()=>[u[1]||(u[1]=s("span",{class:"text-xs italic text-gray-400"},"Responsible for Task",-1))]),key:"0"}:void 0]),1032,["user","isRemovable","isSortable","avatar-size","onRemoveClick","onClick"])]),_:2},1032,["items"])])]),option:k(({option:x})=>[S(F,{user:x,class:"w-full border-gray-300"},null,8,["user"])]),_:1},8,["modelValue","options","placeholder"]))}},ve={class:"ml-auto flex gap-1"},fe={key:0,class:"size-8 border rounded-full bg-blue-200 text-blue-800 border-blue-300 text-center flex items-center justify-center"},ye={key:2,type:"button",class:"size-6 border rounded-full bg-red-100 text-red-400 border-red-200 hover:text-red-800 hover:bg-red-200 handle"},be={__name:"TaskUserChip",props:{user:Object,isRemovable:{type:Boolean,default:!1},isSortable:{type:Boolean,default:!1},userType:{type:String,default:"employee"}},emits:["removeClick"],setup(d,{emit:V}){const b=d,v=V,h=R(()=>({"mr-auto w-full h-10 border-blue-500 !bg-blue-100":b.userType==="main-employee"})),m=R(()=>({"!h-8 !w-8 !bg-green-500":b.userType==="main-employee"}));return(g,o)=>(t(),z(F,{user:d.user,class:J(h.value),avatarClass:m.value,"hide-employee-id":!0},K({after:k(()=>[s("div",ve,[d.userType==="main-employee"?(t(),i("span",fe,o[2]||(o[2]=[s("i",{class:"fas fa-user-crown text-xl"},null,-1)]))):c("",!0),d.isRemovable?(t(),i("button",{key:1,class:"size-6 border rounded-full hover:bg-red-400 hover:text-white clear-icon",onClick:o[0]||(o[0]=B(p=>v("removeClick",d.user),["prevent"]))}," Ã— ")):c("",!0),d.isSortable&&d.userType!=="supervisor"?(t(),i("button",ye,o[3]||(o[3]=[s("i",{class:"fas fa-arrows"},null,-1)]))):c("",!0)])]),_:2},[d.userType==="main-employee"?{name:"user-bottom",fn:k(()=>[o[1]||(o[1]=s("div",{class:"text-blue-500"},"Responsible Employee",-1))]),key:"0"}:void 0]),1032,["user","class","avatarClass"]))}},ge={class:"px-4 rounded border max-h-[98vh] overflow-auto",ref:"taskFormContainerRef"},xe={class:"bg-white z-20 sticky top-0 -mx-4 px-4"},_e={class:"col-span-full mb-2 font-semibold text-gray-800 text-sm line-clamp-3 mb-4"},ke={class:"min-h-[150px]"},he={key:1,class:"grid grid-cols-4 gap-8 mb-4 items-stretch"},we={class:"col-span-2 flex flex-col"},Se={key:0,class:"mb-4"},Te={class:"text-base"},Ce={key:2,class:"flex gap-x-3 gap-y-4 flex-wrap border p-2 rounded items-center flex-grow justify-center"},Ve={key:1,class:"text-center w-full text-sm text-gray-400 py-2"},Ue={class:"col-span-2 w-full flex flex-col"},$e={key:0,class:"mb-4"},ze={class:"text-base"},Re={class:"flex items-end col-span-full md:col-span-2 gap-4"},Ee={class:"w-1/2"},Ae={class:"w-1/2"},Be={class:"block text-gray-600 text-sm mb-1 font-medium"},Fe={class:"bg-white border-t px-4 -mx-4 py-4 sticky bottom-0"},Me={key:0,class:"mb-4 text-red-500 font-medium"},Ie={key:1,class:"mb-4 text-blue-500 font-medium"},Ne={class:"flex justify-between items-center gap-4"},je=["disabled"],Je={__name:"TaskUserAssignForm",props:{taskId:{type:[Number,String],required:!0}},emits:["success","cancelClick"],setup(d,{emit:V}){var M;const b=le(),v=ee(),h=w([]),m=w(""),g=w(null),o=w([]),p=w([]),u=d,x=te(),l=w(null),a=w(((M=v.user)==null?void 0:M.role)=="employee"?{}:{is_important:!1,is_urgent:!1,is_target:!1,assigned_at:"",deadline:""}),T=V;P(async()=>{var e;m.value="loading";const r=await b.fetchTask(u.taskId,{with_parent:"true",with_department_users:"true"},{loadingBeforeFetch:!1,fetchOnly:!0});l.value=r.task,o.value=(r==null?void 0:r.to_department_users)||[],Z(l.value),h.value=l.value.users,p.value=((e=l.value)==null?void 0:e.supervisors)||[],m.value=""});const f=R(()=>{var r,e;return[...o.value,...(e=(r=l.value)==null?void 0:r.users)!=null&&e.length?[...l.value.users]:[]]}),E=R(()=>{var e,y;return[...x.users||[],...(y=(e=l.value)==null?void 0:e.supervisors)!=null&&y.length?[...l.value.supervisors]:[]]}),Q=async()=>{var r,e;m.value="submitting",g.value=null;try{await b.updateTask(u.taskId,a.value,{loadingBeforeFetch:!1}),T("success")}catch(y){g.value=((e=(r=y.response)==null?void 0:r.data)==null?void 0:e.message)||"Assign users failed"}finally{m.value=""}};function Z(r){var e,y,U,$;a.value=((e=v.user)==null?void 0:e.role)=="employee"?{user_ids:(y=l.value.users)==null?void 0:y.map(_=>_.id)}:{is_important:r.is_important,is_urgent:r.is_urgent,is_target:r.is_target,assigned_at:Y(r.assigned_at),deadline:Y(r.deadline),user_ids:(U=l.value.users)==null?void 0:U.map(_=>_.id),supervisor_ids:($=l.value.supervisors)==null?void 0:$.map(_=>_.id)}}return P(async()=>{await x.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"})}),(r,e)=>{var y,U,$,_,I,N,j,D,O,q,L;return t(),i("div",ge,[s("div",xe,[e[8]||(e[8]=s("h2",{class:"text-xl font-semibold text-gray-800 mb-1 mt-4"},"Manage Employee(s) for Task",-1)),e[9]||(e[9]=s("hr",{class:"mb-4 !mt-0"},null,-1)),s("h3",_e,C((y=l.value)==null?void 0:y.title),1)]),s("form",{onSubmit:B(Q,["prevent"]),class:"relative min-h-40"},[s("div",ke,[m.value==="loading"?(t(),z(ae,{key:0,class:"absolute inset-0 border-0 shadow-none"})):(t(),i("div",he,[s("div",we,[(U=l.value)!=null&&U.from_department?(t(),i("div",Se,[e[10]||(e[10]=s("div",{class:"text-sm text-gray-500"},"Task From Department",-1)),s("div",Te,C((_=($=l.value)==null?void 0:$.from_department)==null?void 0:_.name),1)])):c("",!0),e[11]||(e[11]=s("label",{class:"block uppercase text-xs text-gray-600"}," Supervisors ",-1)),((N=(I=A(v))==null?void 0:I.user)==null?void 0:N.role)!=="employee"&&A(v).isAdminMood?(t(),z(G,{key:1,employees:E.value,"list-type":"supervisor",isRemovable:!0,modelValue:a.value.supervisor_ids,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.supervisor_ids=n),class:"flex-grow",placeholder:"--No Supervisor assigned--"},null,8,["employees","modelValue"])):(t(),i("div",Ce,[(p.value||[]).length>0?(t(!0),i(W,{key:0},se(p.value,n=>(t(),z(be,{key:n.id,user:n},null,8,["user"]))),128)):(t(),i("div",Ve," No Supervisor assigned "))]))]),s("div",Ue,[(j=l.value)!=null&&j.to_department?(t(),i("div",$e,[e[12]||(e[12]=s("div",{class:"text-sm text-gray-500"},"Task To Department",-1)),s("div",ze,C((O=(D=l.value)==null?void 0:D.to_department)==null?void 0:O.name),1)])):c("",!0),e[13]||(e[13]=s("label",{class:"block uppercase text-xs text-gray-600"}," Employees ",-1)),S(G,{employees:f.value,modelValue:a.value.user_ids,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.user_ids=n),class:"flex-grow",placeholder:"--No employee(s) assigned--"},null,8,["employees","modelValue"])]),((L=(q=A(v))==null?void 0:q.user)==null?void 0:L.role)!=="employee"&&A(v).isAdminMood?(t(),i(W,{key:0},[S(oe,{class:"col-span-full"},{default:k(()=>e[14]||(e[14]=[s("div",{class:"px-2"},[s("b",{class:"fas fa-cog text-gray-400"}),s("span",{class:"text-gray-700 ml-2"},"Task Settings for Employee")],-1)])),_:1,__:[14]}),S(re,{class:"col-span-full",isImportant:a.value.is_important,"onUpdate:isImportant":e[2]||(e[2]=n=>a.value.is_important=n),isUrgent:a.value.is_urgent,"onUpdate:isUrgent":e[3]||(e[3]=n=>a.value.is_urgent=n)},null,8,["isImportant","isUrgent"]),S(ne,{modelValue:a.value.is_target,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.is_target=n),class:"col-span-full md:col-span-2 mt-4"},null,8,["modelValue"]),s("div",Re,[s("div",Ee,[e[15]||(e[15]=s("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Assign Date",-1)),H(s("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>a.value.assigned_at=n),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[X,a.value.assigned_at]])]),s("div",Ae,[s("label",Be,C(a.value.is_target?"Target":"")+" Deadline",1),H(s("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>a.value.deadline=n),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[X,a.value.deadline]])])])],64)):c("",!0)]))]),s("div",Fe,[g.value?(t(),i("div",Me,C(g.value),1)):c("",!0),m.value=="submitting"?(t(),i("div",Ie," Saving changes... ")):c("",!0),s("div",Ne,[s("button",{type:"button",onClick:e[7]||(e[7]=n=>T("cancelClick")),class:"btn-3"},"Cancel"),s("button",{disabled:m.value=="submitting"||m.value=="loading",type:"submit",class:"btn-2"},C(m.value=="submitting"?"Saving...":"Save"),9,je)])])],32)],512)}}};export{Je as _};
