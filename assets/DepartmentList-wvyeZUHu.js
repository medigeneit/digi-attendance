import{B as G,r as v,z as X,p as q,q as M,e as P,c as m,g as O,o as d,a as e,t as r,w as Y,h as E,A as H,F as T,x as R,k as h,y as x,v as j,a1 as Z,f as J,n as K,j as ee}from"./index-ClaaluW8.js";import{u as te}from"./company-D6CcQdzV.js";import{u as oe}from"./user-D05YM68B.js";import{_ as U}from"./EmployeeDropdownInput-C1TeAHJt.js";import{_ as se,a as ae}from"./HeaderWithButtons-BbvzKdfa.js";import{L as le}from"./LoaderView-CUJ4748I.js";import{u as ne}from"./department-Ca_AsQjW.js";import"./SelectDropdown-nP4mpZXc.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-CShIBmiR.js";const ie={key:0,class:"modal-bg"},re={class:"modal-card"},de={class:"text-lg font-semibold"},ce={class:"mb-4"},ue=["value"],me={class:"mb-4"},pe={class:"mb-4"},_e={class:"mb-4"},ye={class:"mb-4"},fe={class:"mb-4"},be={class:"mb-4"},ve={class:"mb-4"},he={class:"mb-4"},xe={class:"mb-4"},ge={class:"flex justify-end"},we={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},ke={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup(L,{emit:p}){const i=L,y=p,_=te(),c=oe(),{companies:N,employees:I}=G(_),{users:g}=G(c),C=v(null),w=v(""),V=v(""),k=v(!1),B=v(!1),t=X({id:null,company_id:"",incharge_id:"",coordinator_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:"",name:"",short_name:"",description:"",status:"Active"}),n=q(()=>w.value?w.value.id:null),f=q(()=>V.value?V.value.id:null);M(n,s=>{t.incharge_id=s}),M(f,s=>{t.coordinator_id=s});const b=()=>{k.value=!1,t.id=null,t.company_id="",t.incharge_id="",t.coordinator_id="",t.name="",t.short_name="",t.description="",t.status="Active",t.operational_admin_user_id="",t.recommend_by_user_id="",t.approved_by_user_id=""};M(()=>i.department,s=>{var o,a,u,A,D;s&&typeof s=="object"&&Object.keys(s).length>0?(k.value=!0,t.id=s.id||null,t.company_id=s.company_id||"",t.incharge_id=((o=s.in_charge)==null?void 0:o.id)||"",t.coordinator_id=((a=s.coordinator)==null?void 0:a.id)||"",t.name=s.name||"",t.short_name=s.short_name||"",t.description=s.description||"",t.status=s.status||"Active",t.operational_admin_user_id=((u=s.operational_admin)==null?void 0:u.id)||"",t.recommend_by_user_id=((A=s.recommend_by)==null?void 0:A.id)||"",t.approved_by_user_id=((D=s.approved_by)==null?void 0:D.id)||""):b()},{immediate:!0,deep:!0}),M(()=>i.show,async s=>{s&&!B.value&&await $()}),M(()=>t.company_id,async s=>{s&&await S(s)});const F=()=>{console.log({departmentForm:t}),y("save",{...t}),b(),l()},l=()=>{b(),y("close")},$=async()=>{try{await _.fetchCompanies(),B.value=!0}catch(s){console.error("Failed to fetch companies:",s)}},S=async s=>{s&&(await _.fetchEmployee(s),w.value=_.employees.find(o=>{var a,u;return o.id===((u=(a=i.department)==null?void 0:a.in_charge)==null?void 0:u.id)}))};return P(async()=>{var s;console.log("DepartmentModal: onMounted"),await $(),i.department.company_id&&await S(i.department.company_id),await c.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"}),V.value=(s=c.users)==null?void 0:s.find(o=>{var a,u;return o.id===((u=(a=i.department)==null?void 0:a.coordinator)==null?void 0:u.id)})}),(s,o)=>L.show?(d(),m("div",ie,[e("div",re,[e("h2",de,r(k.value?"Edit Department":"Add Department"),1),e("form",{onSubmit:Y(F,["prevent"])},[e("div",{class:"max-h-[70vh] overflow-y-auto border-y my-4",ref_key:"formInputs",ref:C},[e("div",ce,[o[11]||(o[11]=e("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),E(e("select",{id:"company_id","onUpdate:modelValue":o[0]||(o[0]=a=>t.company_id=a),class:"w-full border rounded px-3 py-2",required:""},[o[10]||(o[10]=e("option",{value:"",disabled:""},"Select a company",-1)),(d(!0),m(T,null,R(h(N),a=>(d(),m("option",{key:a.id,value:a.id},r(a.name),9,ue))),128))],512),[[H,t.company_id]])]),e("div",me,[o[12]||(o[12]=e("label",{for:"incharge_id",class:"block text-sm font-medium mb-2"},"In-Charge",-1)),x(U,{options:h(I),modelValue:t.incharge_id,"onUpdate:modelValue":o[1]||(o[1]=a=>t.incharge_id=a),label:"label",placeholder:"--Select--",class:"h-10",containment:C.value},null,8,["options","modelValue","containment"])]),e("div",pe,[o[13]||(o[13]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Coordinator",-1)),x(U,{options:h(g),modelValue:t.coordinator_id,"onUpdate:modelValue":o[2]||(o[2]=a=>t.coordinator_id=a),label:"label",placeholder:"--Select--",class:"h-10",containment:C.value},null,8,["options","modelValue","containment"])]),e("div",_e,[o[14]||(o[14]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Operational Admin",-1)),x(U,{options:h(g),modelValue:t.operational_admin_user_id,"onUpdate:modelValue":o[3]||(o[3]=a=>t.operational_admin_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",ye,[o[15]||(o[15]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Recommend By",-1)),x(U,{options:h(g),modelValue:t.recommend_by_user_id,"onUpdate:modelValue":o[4]||(o[4]=a=>t.recommend_by_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",fe,[o[16]||(o[16]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Approved By",-1)),x(U,{options:h(g),modelValue:t.approved_by_user_id,"onUpdate:modelValue":o[5]||(o[5]=a=>t.approved_by_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",be,[o[17]||(o[17]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),E(e("input",{id:"name","onUpdate:modelValue":o[6]||(o[6]=a=>t.name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[j,t.name]])]),e("div",ve,[o[18]||(o[18]=e("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),E(e("input",{id:"short_name","onUpdate:modelValue":o[7]||(o[7]=a=>t.short_name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[j,t.short_name]])]),e("div",he,[o[19]||(o[19]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),E(e("textarea",{id:"description","onUpdate:modelValue":o[8]||(o[8]=a=>t.description=a),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[j,t.description]])]),e("div",xe,[o[21]||(o[21]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),E(e("select",{id:"status","onUpdate:modelValue":o[9]||(o[9]=a=>t.status=a),class:"w-full border rounded px-3 py-2",required:""},o[20]||(o[20]=[e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)]),512),[[H,t.status]])])],512),e("div",ge,[e("button",{type:"button",onClick:l,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",we,r(k.value?"Update":"Create"),1)])],32)])])):O("",!0)}},Ce={class:"my-container space-y-4"},Ve={key:0,class:"text-center py-4"},$e={key:1,class:"space-y-4"},Se={class:"title-md"},Ae={class:"overflow-x-auto"},De={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},Me={class:"text-gray-600 text-sm"},Ee={class:"py-3 px-2 text-center"},Ue={class:"py-3 px-2 text-left"},Ie={class:"py-3 px-4 text-left"},Be={class:"whitespace-nowrap mb-1"},Fe={class:"text-gray-800"},Le={class:"whitespace-nowrap mb-1"},Ne={class:"text-gray-800"},je={class:"whitespace-nowrap"},qe={class:"text-gray-800"},Oe={class:"py-3 px-2 text-left"},Te={class:"whitespace-nowrap"},Re={class:"text-gray-800"},ze={class:"whitespace-nowrap"},We={class:"text-gray-800"},Ge={class:"py-3 px-2 text-center text-gray-800 font-semibold"},He={class:"py-3 px-2 text-center"},Je={class:"py-3 px-6 text-center"},Ke={class:"flex item-center justify-center gap-4"},Pe=["onClick"],Qe=["onClick"],it={__name:"DepartmentList",setup(L){const p=ne(),i=Z(),y=v(!1),_=v(!1),c=v(null),N=()=>{c.value=null,y.value=!0},I=()=>{y.value=!1},g=t=>{c.value=t,y.value=!0},C=t=>{c.value=t,_.value=!0},w=()=>{_.value=!1},V=async t=>{try{t.id?(await p.updateDepartment(t.id,t),i.success("Department updated successfully!"),await p.fetchDepartments()):(await p.createDepartment(t),i.success("Department added successfully!"))}catch(n){i.error("Failed to save department!"),console.error("Error handling save:",n)}finally{I()}},k=async()=>{var t;if(!((t=c.value)!=null&&t.id)){i.error("Invalid department selected for deletion!");return}try{await p.deleteDepartment(c.value.id),i.success("Department deleted successfully!")}catch(n){i.error("Failed to delete department!"),console.error("Error deleting department:",n)}finally{w()}},B=q(()=>{const t={};return p.departments.forEach(n=>{var b;const f=((b=n.company)==null?void 0:b.name)||"Unknown Company";t[f]||(t[f]=[]),t[f].push(n)}),t});return P(async()=>{try{await p.fetchDepartments()}catch(t){i.error("Failed to fetch departments!"),console.error("Error fetching departments:",t)}}),(t,n)=>{var f;return d(),m("div",Ce,[x(se,{title:"Department List",onAdd:N}),h(p).loading?(d(),m("div",Ve,[x(le)])):(d(),m("div",$e,[(d(!0),m(T,null,R(B.value,(b,F)=>(d(),m("div",{key:F},[e("h2",Se,r(F),1),e("div",Ae,[e("table",De,[n[7]||(n[7]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-center"},"#"),e("th",{class:"py-3 px-2 text-left"},"Department Name"),e("th",{class:"py-3 px-4 text-left whitespace-nowrap"}," In-Charge, Coordinator & Operational Admin "),e("th",{class:"py-3 px-2 text-left"},"Administration"),e("th",{class:"py-3 px-2 text-center"},"Employee"),e("th",{class:"py-3 px-2 text-center"},"Status"),e("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),e("tbody",Me,[(d(!0),m(T,null,R(b,(l,$)=>{var S,s,o,a,u,A,D,z,W;return d(),m("tr",{key:$,class:"border-b border-gray-200 hover:bg-blue-100"},[e("td",Ee,r($+=1),1),e("td",Ue,[e("div",null,r(l.name),1),e("strong",null,r(l.short_name),1)]),e("td",Ie,[e("div",Be,[n[0]||(n[0]=e("span",{class:"text-gray-400 font-semibold"},"In-Charge: ",-1)),e("span",Fe,r(((S=l.in_charge)==null?void 0:S.name)||"-"),1)]),e("div",Le,[n[1]||(n[1]=e("span",{class:"text-gray-400 font-semibold"},"Coordinator: ",-1)),e("span",Ne,r(((s=l.coordinator)==null?void 0:s.name)||"-"),1)]),e("div",je,[n[2]||(n[2]=e("span",{class:"text-gray-400 font-semibold"},"Operational Admin: ",-1)),e("span",qe,r(((o=l.operational_admin)==null?void 0:o.name)||"-"),1)])]),e("td",Oe,[e("div",Te,[n[3]||(n[3]=e("span",{class:"text-gray-400 font-semibold"},"Recommend By: ",-1)),e("span",Re,r(((a=l==null?void 0:l.recommend_by)==null?void 0:a.name)||"-"),1)]),e("div",ze,[n[4]||(n[4]=e("span",{class:"text-gray-400 font-semibold"},"Approved By: ",-1)),e("span",We,r(((u=l==null?void 0:l.approved_by)==null?void 0:u.name)||"-"),1)])]),e("td",Ge,r(l==null?void 0:l.users_count),1),e("td",He,[e("div",{class:K(["flex gap-1 items-center",{"text-green-500":((A=l==null?void 0:l.status)==null?void 0:A.toLowerCase())=="active","text-red-400":((D=l==null?void 0:l.status)==null?void 0:D.toLowerCase())=="inactive"}])},[e("i",{class:K(["fas",{"fa-check-circle":((z=l==null?void 0:l.status)==null?void 0:z.toLowerCase())=="active","fa-times-circle":((W=l==null?void 0:l.status)==null?void 0:W.toLowerCase())=="inactive"}])},null,2),ee(" "+r(l.status),1)],2)]),e("td",Je,[e("div",Ke,[e("button",{onClick:Q=>g(l),class:"text-blue-600 hover:text-blue-800"},n[5]||(n[5]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Pe),e("button",{onClick:Q=>C(l),class:"text-red-600 hover:text-red-800"},n[6]||(n[6]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Qe)])])])}),128))])])])]))),128))])),y.value?(d(),J(ke,{key:2,show:y.value,department:c.value,onClose:I,onSave:V},null,8,["show","department"])):O("",!0),_.value?(d(),J(ae,{key:3,show:_.value,title:"Delete Department",message:`Are you sure you want to delete ${(f=c.value)==null?void 0:f.name}?`,onClose:w,onConfirm:k},null,8,["show","message"])):O("",!0)])}}};export{it as default};
