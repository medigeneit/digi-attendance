import{r as m,e as q,z as A,c as f,o as g,a as o,f as B,g as w,w as k,F as D,p as u,k as d,i as I,j as z,x as E,t as F,b as U,u as j}from"./index-DsySH2c9.js";import{_ as N}from"./CompanyDepartmentSelectInput-RdKdO0p4.js";import{R as T}from"./RequiredIcon-88ZWF6il.js";import{f as L,u as M}from"./requirement-BRBmG_ED.js";import{u as R}from"./company-D0txNeU_.js";import{u as W}from"./tags-B5sbZUXv.js";import{L as G}from"./LoaderView-BJ0vPtRR.js";import{S as H}from"./SelectDropdown-DHWYI_iN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"sticky top-0 pt-4 bg-white z-10"},K={class:"mb-4"},O={class:"block text-gray-600 text-sm mb1 font-medium"},P={class:"block text-gray-600 text-sm mb-1 font-medium"},Q={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},X={class:"flex items-center justify-between gap-4"},Y=["disabled"],Z={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(V,{emit:y}){const p=V,b=y,n=W(),x=R(),a=m(""),l=m([]),C=m(),_=m(""),S=m(),i=m({from_department_id:"",to_department_id:"",website_tags:[]});q(async()=>{var t;a.value="loading",n.fetchTags("website"),await x.fetchCompanies({with:"departments",ignore_permission:!0}),C.value=(t=(await L(p.requirementId)).data)==null?void 0:t.requirement,a.value=""}),A(C,function(t){var e;t&&(i.value.from_department_id=t.from_department_id,i.value.to_department_id=t.to_department_id,Array.isArray(t==null?void 0:t.website_tags)&&((e=t.website_tags)==null?void 0:e.length)>0&&(l.value=t.website_tags))});async function $(){var e,c,v,r;a.value="submitting";const t={...i.value,...l.value&&Array.isArray(l.value)?{website_tags:l.value.map(s=>s.id)}:{}};console.log({payload:t});try{const s=await M(p.requirementId,t);b("update",s),a.value="created",_.value=(e=s==null?void 0:s.data)==null?void 0:e.message}catch(s){b("error",(c=s==null?void 0:s.response)==null?void 0:c.data),_.value=(r=(v=s==null?void 0:s.response)==null?void 0:v.data)==null?void 0:r.message,a.value="error"}}return(t,e)=>{var c,v;return g(),f("div",{ref_key:"containerRef",ref:S,class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[o("div",J,[e[5]||(e[5]=o("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[6]||(e[6]=o("hr",{class:"mb-4"},null,-1)),o("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=k(r=>b("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),o("form",{onSubmit:k($,["prevent"]),class:"z-0"},[a.value!=="loading"&&a.value!=="submitting"?(g(),f(D,{key:0},[o("div",K,[e[7]||(e[7]=o("label",{class:"text-gray-800"},"Websites",-1)),u(H,{options:d(n).tags,modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value=r),multiple:"",label:"name",containment:S.value},null,8,["options","modelValue","containment"])]),u(N,{modelValue:i.value.from_department_id,"onUpdate:modelValue":e[2]||(e[2]=r=>i.value.from_department_id=r),companies:((c=d(x))==null?void 0:c.companies)||[],class:"mb-4"},{label:I(()=>[o("label",O,[e[8]||(e[8]=z(" From Department ")),u(T)])]),_:1},8,["modelValue","companies"]),u(N,{modelValue:i.value.to_department_id,"onUpdate:modelValue":e[3]||(e[3]=r=>i.value.to_department_id=r),companies:((v=d(x))==null?void 0:v.companies)||[],class:"mb-4"},{label:I(()=>[o("label",P,[e[9]||(e[9]=z(" To Department ")),u(T)])]),_:1},8,["modelValue","companies"])],64)):w("",!0),o("div",Q,[_.value?(g(),f("div",{key:0,class:E(["mb-4 font-medium text-center",{"text-red-500":a.value=="error","text-green-500":a.value=="created"}])},F(_.value),3)):w("",!0),o("div",X,[o("button",{type:"button",onClick:e[4]||(e[4]=k(r=>b("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),o("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},F(a.value=="submitting"?"Saving...":"Save"),9,Y)])])],32),a.value==="loading"||a.value==="submitting"?(g(),B(G,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):w("",!0)],512)}}},h={class:"container mx-auto p-6"},me={__name:"RequirementEdit",setup(V){const y=U(),p=j();return(b,n)=>(g(),f("div",h,[u(Z,{requirementId:d(y).params.id,onUpdate:n[0]||(n[0]=()=>d(p).back()),onCancelClick:n[1]||(n[1]=()=>d(p).back())},null,8,["requirementId"])]))}};export{me as default};
