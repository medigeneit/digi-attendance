import{_ as Z}from"./CommentModal-Bmch3I5L.js";import{g as ee,u as te,O as Q,_ as se}from"./task-priority-DP5dn0IP.js";import{L as le}from"./LoaderView-z66KBcgT.js";import{_ as ae}from"./TaskAddForm-DQqvAlI3.js";import{_ as oe}from"./TaskEditForm-DmTD-cQj.js";import{q as w,s as ne,A as J,e as K,c as u,o as s,a as t,f as $,w as F,g as D,C as W,F as q,y as M,t as N,h as p,l as b,p as E,D as z,v as re,n as ie,b as de,u as ue,r as V,E as me,m as B}from"./index-uGTI6_9B.js";import{_ as ce}from"./MultiselectDropdown-CpaV3Fjo.js";import{u as pe}from"./company-CP0w-MAC.js";import{_ as X}from"./UserChip-CKu1SAw4.js";import{_ as Y}from"./TaskTreeView-DxdokOyS.js";import{u as ke}from"./useTaskStore-BY4OOEvW.js";import"./useCommentStore-cc9IVzz_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-C5v8QGqc.js";import"./SectionLoading-Bxd7PL_x.js";import"./vue-multiselect.esm-D2Y5-0et.js";const fe={class:"mb-3 task-header"},ve={class:"flex justify-between items-center"},ye={class:"ml-auto flex gap-6 items-center"},ge={key:0,class:"flex gap-2 items-center"},xe={class:"flex flex-wrap items-center gap-2 mt-3"},_e={class:"flex flex-wrap gap-4 w-full"},Ce={class:"text-gray-600 w-full md:w-44"},we=["value"],be={class:"relative w-full md:w-52"},Te={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},he={class:"text-gray-600 w-40"},Ie={class:"flex gap-4 items-center flex-shrink-0"},Ve={class:"flex gap-2"},$e={class:"flex gap-2"},qe={class:"text-gray-600 w-full md:w-40 md:ml-auto"},Ue={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(U,{emit:k}){const i=U,C=w(n("company-id")),T=w(n("user-ids")),h=w(n("month")),I=w(n("status")),l=w(n("is-important")),a=w(n("is-urgent")),o=k,c=pe(),{companies:x,employees:f}=ne(c);function n(d){return{get:()=>i.modelValue[d]||"",set:e=>{console.log("---SETTING modelValue: ",{key:d,value:e}),o("update:modelValue",{...i.modelValue,[d]:e||void 0})}}}const v=w(()=>S(T.value));async function y(d){d&&await c.fetchEmployee(d)}J(()=>C.value,y),K(async()=>{var d,e;await c.fetchCompanies(),(d=i.modelValue)!=null&&d["company-id"]&&await y((e=i.modelValue)==null?void 0:e["company-id"])});function S(d){return f.value.find(e=>e.id==d)||null}function L(d){T.value=(d==null?void 0:d.id)||""}function P(){T.value=""}return(d,e)=>(s(),u("div",fe,[t("div",ve,[e[9]||(e[9]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",ye,[U.listHasRearranged?(s(),u("div",ge,[e[8]||(e[8]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=F(r=>o("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=F(r=>o("clickPriorityDiscard"),["prevent"]))},"Discard")])):$("",!0),t("button",{onClick:e[2]||(e[2]=r=>o("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",xe,[t("div",_e,[t("div",Ce,[D(t("select",{id:"company-filter","onUpdate:modelValue":e[3]||(e[3]=r=>C.value=r),class:"input-1"},[e[10]||(e[10]=t("option",{value:""},"All Company",-1)),(s(!0),u(q,null,M(p(x),r=>(s(),u("option",{key:r.id,value:r.id},N(r.name),9,we))),128))],512),[[W,C.value]])]),t("div",be,[b(ce,{modelValue:v.value,onSelect:L,onRemove:P,options:p(f),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employee",class:"text-gray-600 w-full"},{option:E(({option:r})=>[b(X,{user:r,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),v.value?(s(),u("div",Te,[t("button",{onClick:F(P,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):$("",!0)]),t("div",he,[D(t("select",{"onUpdate:modelValue":e[4]||(e[4]=r=>I.value=r),class:"input-1"},e[11]||(e[11]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[W,I.value]])]),t("div",Ie,[t("label",Ve,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=r=>l.value=r),value:"1"},null,512),[[z,l.value]]),e[12]||(e[12]=t("span",null,"Important",-1))]),t("label",$e,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=r=>a.value=r),value:"1"},null,512),[[z,a.value]]),e[13]||(e[13]=t("span",null,"Urgent",-1))])]),t("div",qe,[D(t("input",{id:"month-filter","onUpdate:modelValue":e[7]||(e[7]=r=>h.value=r),type:"month",class:"input-1"},null,512),[[re,h.value]])])])])]))}},Se={class:"w-full bg-white rounded"},Ae=["rowspan"],De={class:""},Ee={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(U,{emit:k}){const i=U,C=k,T=w(()=>i.tasks.reduce((l,a)=>(l.push(...a.users.filter(o=>!l.find(c=>c.id==o.id&&o.id))),l),[]).filter(l=>i.selectedUserId?l.id==i.selectedUserId:!0)),h=l=>{const a=i.tasks,o=new Map(a.map(n=>[n.id,n])),c=new Set,x=[],f=a.filter(n=>n.users.some(v=>v.id===l));for(const n of f){c.has(n.id)||(c.add(n.id),x.push(n));let v=n.parent_id;for(;v&&o.has(v)&&!c.has(v);){const y=o.get(v);c.add(y.id),x.push(y),v=y.parent_id}}return x},I=w(()=>T.value.map(l=>{const a=ee(h(l.id),0);return{...l,tasks:a}}));return(l,a)=>(s(),u("div",null,[t("table",Se,[t("tbody",null,[(s(!0),u(q,null,M(I.value,o=>(s(),u(q,{key:o.id},[(s(!0),u(q,null,M(o.tasks,(c,x)=>(s(),u("tr",{key:c.id},[x==0?(s(),u("td",{key:0,class:"border p-4 align-top",rowspan:Math.max(o.tasks.length,1)},[b(X,{user:o,class:"sticky top-[80px]"},null,8,["user"])],8,Ae)):$("",!0),t("td",De,[b(Y,{task:c,class:"!border-0",index:x,onCommentButtonClick:a[0]||(a[0]=f=>C("commentButtonClick",l.item.id)),onEditClick:a[1]||(a[1]=f=>C("editClick",f)),onAddClick:a[2]||(a[2]=f=>C("addClick",f))},{"item-override":E(({task:f,level:n})=>[ie(N({task:f,level:n}),1)]),_:2},1032,["task","index"])])]))),128))],64))),128))])])]))}},Le={class:"container mx-auto p-6 relative"},Pe={class:"mb-4"},Be={key:3},Me={key:0,class:"text-center py-4 text-red-500"},Ne={key:1,class:"space-y-4"},Re={class:"flex items-stretched"},Fe={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},He=1,ot={__name:"TaskList",setup(U){const k=ke(),i=de(),C=ue(),T=V(!1),h=V(null),I=V(!1),l=V(null),a=V(!1),o=me({parentId:0,requirementId:0}),c=V(null),x=V([]),{handleItemsPriorityUpdate:f,saveTaskPriority:n,listHasRearranged:v}=te(()=>k.taskListTree,0);K(async()=>{i.query.status||C.push({query:{...i.query,status:"not-completed"}}),await y()});async function y(){I.value=!!i.query["user-ids"];const _=await k.fetchTasks({...i.query},{loadingBeforeFetch:!0});console.log({dataQuery:_.query_log}),x.value=_.query_log||[]}const S=_=>{a.value=!0,o.parentId=_},L=_=>{h.value=_,T.value=!0},P=()=>{T.value=!1,h.value=null};async function d(){l.value=null,a.value=!1,o.parentId=0,await y()}async function e(){a.value=!1,o.parentId=0,await y()}async function r(){n()&&await y()}J(()=>({...i.query}),async()=>await y());const H=w({get(){return{...i.query}},set(_){C.push({query:{..._}})}});return(_,m)=>{var j,O,G;return s(),u("div",Le,[l.value?(s(),B(Q,{key:0},{default:E(()=>[b(oe,{taskId:l.value,class:"rounded-full",onClose:m[0]||(m[0]=g=>l.value=null),onUpdated:d},null,8,["taskId"])]),_:1})):$("",!0),a.value?(s(),B(Q,{key:1},{default:E(()=>[b(ae,{parentTaskId:o.parentId,requirementId:o.requirementId,class:"rounded-full",onClose:e,onTaskCreated:d},null,8,["parentTaskId","requirementId"])]),_:1})):$("",!0),b(Ue,{modelValue:H.value,"onUpdate:modelValue":m[1]||(m[1]=g=>H.value=g),onClickAddTask:S,onClickPrioritySave:r,onClickPriorityDiscard:m[2]||(m[2]=()=>p(v)?c.value.resetItems:null),"list-has-rearranged":p(v),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((O=(j=p(i))==null?void 0:j.query)==null?void 0:O["query-log"])=="true"?(s(!0),u(q,{key:2},M(x.value,(g,R)=>(s(),u("div",{key:R,class:"text-xs text-gray-500"},[t("div",Pe,N(g.raw_query),1)]))),128)):$("",!0),p(k).loading?(s(),u("div",Be,[b(le)])):(s(),u(q,{key:4},[p(k).error?(s(),u("div",Me,N(p(k).error),1)):p(k).tasks.length>0?(s(),u("div",Ne,[((G=p(i).query)==null?void 0:G.view)=="userwise"?(s(),B(Ee,{key:0,tasks:p(k).tasks,selectedUserId:p(i).query["user-ids"],onCommentButtonClick:m[3]||(m[3]=g=>L(g,_.task.id)),onEditClick:m[4]||(m[4]=g=>l.value=g),onAddClick:m[5]||(m[5]=g=>S(g))},null,8,["tasks","selectedUserId"])):(s(),B(se,{key:1,items:p(k).taskListTree,handle:"handle",onItemsUpdate:p(f),class:"space-y-4",ref_key:"draggableTaskList",ref:c},{item:E(({item:g,index:R})=>[t("div",Re,[b(Y,{task:g,index:R,showDraggableHandle:!I.value,onCommentButtonClick:m[6]||(m[6]=A=>L(A,_.task.id)),onEditClick:m[7]||(m[7]=A=>l.value=A),onAddClick:m[8]||(m[8]=A=>S(A)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(s(),u("div",Fe," No tasks found. "))],64)),b(Z,{show:T.value,"commentable-id":h.value,"commentable-type":"task","user-id":He,"on-close":P,onSubmitted:p(k).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{ot as default};
