import{r as x,e as L,c as o,o as n,a as e,f as U,g as v,w as C,F as A,h as j,j as T,p as D,v as P,i as S,B as ge,t as q,d as Re,m as Q,n as ke,y as J,x as M,k as we,N as Ie,K as _e,J as Se,b as De,u as Te,z as V}from"./index-DXTp_J5-.js";import{L as B}from"./LoaderView-BsfxHkMg.js";import{O}from"./OverlyModal-97C5z6dw.js";import{_ as G}from"./DescriptionView-BKo1yKIU.js";import{R as he}from"./RequiredIcon-DDoFnVoU.js";import{f as W,s as Ee}from"./requirement-gbPYsnq2.js";import{a as Ne,f as Y,d as Ue,u as Ae,b as je,_ as Pe}from"./TaskAddForm-5xjPDpZ_.js";import{u as qe}from"./department-CzlAFeFb.js";import{S as $e}from"./SelectDropdown-LYgWPLoM.js";import{_ as H}from"./UserChip-HHlw8xNG.js";import{u as Ce}from"./user-DlVAm2BZ.js";import{_ as Fe}from"./TaskUserChip-6F0kOdTV.js";import{u as Le}from"./useTaskStore-BV5dcOsi.js";import{_ as Ve}from"./TaskSelectionInput-BaZCjC8V.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-BCJhJPTK.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-h6226M-k.js";import"./SectionLoading-B_0gNBsG.js";import"./TextWithHr-BcVrEiO_.js";import"./TaskUrgencyInput-DuQNwgGN.js";const Oe={class:"sticky top-0 pt-4 bg-white z-10"},Me={class:"mb-4"},Be={class:"block text-gray-600 text-sm mb-1 font-medium"},ze={class:"mb-4"},Ge={class:"mb-4"},He={class:"mb-4"},We={class:"mb-4"},Ke={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Qe={key:0,class:"mb-4 text-red-500 font-medium"},Je={key:1,class:"mb-4"},Ye={class:"flex items-center justify-between gap-4"},Xe=["disabled"],Ze={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["create","closeClick","error"],setup(b,{emit:N}){const g=b,f=N,a=qe(),_=x(),u=x(""),d=x(),r=x({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),y=x([]);async function l(){var t,c;u.value="submitting";const s={...r.value};console.log({payload:s});try{const R=await Ne(g.requirementId,s);f("create",R),u.value="create"}catch(R){u.value="error",d.value=((c=(t=R.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to create requirement detail",f("error",d.value)}}return L(async()=>{var t;const s=((t=(await W(g.requirementId)).data)==null?void 0:t.requirement)||{};y.value=await a.fetchDepartmentEmployee([s.from_department_id])}),(s,t)=>(n(),o("div",{class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative",ref_key:"formContainerRef",ref:_},[e("div",Oe,[t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement",-1)),t[8]||(t[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=C(c=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:C(l,["prevent"]),class:"z-0"},[u.value!=="loading"?(n(),o(A,{key:0},[e("div",Me,[e("label",Be,[t[9]||(t[9]=T("Title ")),D(he)]),j(e("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>r.value.title=c),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,r.value.title]])]),e("div",ze,[t[10]||(t[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Details",-1)),j(e("textarea",{rows:"10","onUpdate:modelValue":t[2]||(t[2]=c=>r.value.description=c),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,r.value.description]])]),e("div",Ge,[t[12]||(t[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),D($e,{modelValue:r.value.supervisor_id,"onUpdate:modelValue":t[3]||(t[3]=c=>r.value.supervisor_id=c),options:y.value,placeholder:"--NO SUPERVISOR--",containment:_.value,clearable:"",class:"h-10"},{"list-header":S(()=>t[11]||(t[11]=[e("div",{class:"px-3 pt-2 pb-1 shadow-md text-xs uppercase bg-gray-50 text-gray-500"}," Employees ",-1)])),option:S(({option:c})=>[D(H,{user:c||{},class:"pr-5 -mx-1"},null,8,["user"])]),"selected-option":S(({option:c})=>[c?(n(),U(H,{key:0,user:c||{},class:"pr-4"},null,8,["user"])):v("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",He,[t[14]||(t[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),j(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[4]||(t[4]=c=>r.value.priority=c)},t[13]||(t[13]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ge,r.value.priority]])]),e("div",We,[t[15]||(t[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),j(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=c=>r.value.better_to_complete_on=c),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,r.value.better_to_complete_on]])])],64)):v("",!0),e("div",Ke,[d.value?(n(),o("div",Qe,q(d.value),1)):v("",!0),d.value?(n(),o("hr",Je)):v("",!0),e("div",Ye,[e("button",{type:"button",onClick:t[6]||(t[6]=C(c=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:u.value=="loading"||u.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},q(u.value=="submitting"?"Saving...":"Add Requirement"),9,Xe)])])],32),u.value==="loading"||u.value==="submitting"?(n(),U(B,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):v("",!0)],512))}},et={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},tt={class:"mb-4"},st={class:"font-semibold"},nt={class:"mb-4"},rt={class:"line-clamp-2"},it={key:1,class:"min-h-40"},lt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ot={key:0,class:"mb-4 text-red-500 font-medium"},at={key:1,class:"mb-4"},dt={class:"flex items-center justify-between gap-4"},ut=["disabled"],mt={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(b,{emit:N}){const g=b,f=N,a=Ce(),_=x(null),u=x(""),d=x(),r=x([]);async function y(){var l,s;u.value="submitting";try{const t=await Ue(g.requirementId,g.detailId);f("delete",t),u.value="create"}catch(t){u.value="error",d.value=((s=(l=t.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to update requirement detail: "+t,f("error",d.value)}}return L(async()=>{var l,s,t;u.value="loading";try{r.value=await a.fetchDepartmentWiseEmployees(),_.value=(l=(await Y(g.requirementId,g.detailId)).data)==null?void 0:l.detail}catch(c){d.value=((t=(s=c.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to fetch requirement detail"}finally{u.value=""}}),(l,s)=>{var t,c;return n(),o("div",et,[s[4]||(s[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:C(y,["prevent"]),class:"z-0"},[u.value!=="loading"?(n(),o(A,{key:0},[e("div",tt,[s[1]||(s[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",st,q((t=_.value)==null?void 0:t.title),1)]),e("div",nt,[s[2]||(s[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",rt,q((c=_.value)==null?void 0:c.description),1)]),s[3]||(s[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),o("div",it)),e("div",lt,[d.value?(n(),o("div",ot,q(d.value),1)):v("",!0),d.value?(n(),o("hr",at)):v("",!0),e("div",dt,[e("button",{type:"button",onClick:s[0]||(s[0]=C(R=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:u.value=="loading"||u.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},q(u.value=="submitting"?"Deleting...":"Delete"),9,ut)])])],32),u.value==="loading"||u.value==="submitting"?(n(),U(B,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):v("",!0)])}}},pt={class:"sticky top-0 pt-4 bg-white z-10"},ct={class:"mb-4"},bt={class:"block text-gray-600 text-sm mb-1 font-medium"},vt={class:"mb-4"},ft={class:"mb-4"},yt={key:0,class:"relative w-full"},xt={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},gt={class:"mb-4"},kt={class:"mb-4"},wt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},_t={key:0,class:"mb-4 text-red-500 font-medium"},ht={key:1,class:"mb-4"},qt={class:"flex items-center justify-between gap-4"},$t=["disabled"],Ct={__name:"RequirementDetailEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(b,{emit:N}){const g=b,f=N,a=x(),_=Ce(),u=qe(),d=x(null),r=x(""),y=x(),l=x({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),s=x([]),t=x([]);async function c(){var m,E;r.value="submitting";const R={...l.value};try{const k=await Ae(g.requirementId,g.detailId,R);f("update",k),r.value="create"}catch(k){r.value="error",y.value=((E=(m=k.response)==null?void 0:m.data)==null?void 0:E.message)||"Failed to update requirement detail",f("error",y.value)}}return L(async()=>{var R,m,E,k,p,h,I,w;r.value="loading";try{s.value=await _.fetchDepartmentWiseEmployees();const i=((R=(await W(g.requirementId)).data)==null?void 0:R.requirement)||{};t.value=await u.fetchDepartmentEmployee([i.from_department_id]),d.value=(m=(await Y(g.requirementId,g.detailId)).data)==null?void 0:m.detail,l.value={title:(E=d.value)==null?void 0:E.title,description:(k=d.value)==null?void 0:k.description,priority:(p=d.value)==null?void 0:p.priority,supervisor_id:(h=d.value)==null?void 0:h.supervisor_id};const K=new Date(d.value.better_to_complete_on);l.value.better_to_complete_on=K.toISOString().split("T")[0]}catch(i){y.value=((w=(I=i.response)==null?void 0:I.data)==null?void 0:w.message)||"Failed to fetch requirement detail"}finally{r.value=""}}),(R,m)=>{var E;return n(),o("div",{ref_key:"formContainerRef",ref:a,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",pt,[m[8]||(m[8]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),m[9]||(m[9]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:m[0]||(m[0]=C(k=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:C(c,["prevent"]),class:"z-0"},[r.value!=="loading"?(n(),o(A,{key:0},[e("div",ct,[e("label",bt,[m[10]||(m[10]=T("Title ")),D(he)]),j(e("input",{"onUpdate:modelValue":m[1]||(m[1]=k=>l.value.title=k),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,l.value.title]])]),e("div",vt,[m[11]||(m[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),j(e("textarea",{rows:"10","onUpdate:modelValue":m[2]||(m[2]=k=>l.value.description=k),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,l.value.description]])]),e("div",ft,[m[12]||(m[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),D($e,{modelValue:l.value.supervisor_id,"onUpdate:modelValue":m[4]||(m[4]=k=>l.value.supervisor_id=k),options:[...t.value,...t.value.find(k=>{var p,h;return k.id==((h=(p=d.value)==null?void 0:p.supervisor)==null?void 0:h.id)})?[]:[(E=d.value)==null?void 0:E.supervisor]],containment:a.value,placeholder:"--NO SUPERVISOR--",class:"h-10"},{option:S(({option:k})=>[D(H,{user:k||{}},null,8,["user"])]),"selected-option":S(({option:k})=>[k?(n(),o("div",yt,[D(H,{user:k||{}},null,8,["user"]),l.value.supervisor_id?(n(),o("div",xt,[e("button",{onClick:m[3]||(m[3]=C(p=>l.value.supervisor_id=null,["prevent"])),class:"text-gray-6 font-semibold 00 hover:text-red-700"}," Ã— ")])):v("",!0)])):v("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",gt,[m[14]||(m[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),j(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":m[5]||(m[5]=k=>l.value.priority=k)},m[13]||(m[13]=[e("option",{value:null},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ge,l.value.priority]])]),e("div",kt,[m[15]||(m[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),j(e("input",{type:"date","onUpdate:modelValue":m[6]||(m[6]=k=>l.value.better_to_complete_on=k),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,l.value.better_to_complete_on]])])],64)):v("",!0),e("div",wt,[y.value?(n(),o("div",_t,q(y.value),1)):v("",!0),y.value?(n(),o("hr",ht)):v("",!0),e("div",qt,[e("button",{type:"button",onClick:m[7]||(m[7]=C(k=>f("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:r.value=="loading"||r.value=="submitting",type:"submit",class:"btn-2"},q(r.value=="submitting"?"Saving...":"Edit"),9,$t)])])],32),r.value==="loading"||r.value==="submitting"?(n(),U(B,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):v("",!0)],512)}}},Rt=["rowspan"],It={class:"text-2xl font-medium"},St=["rowspan"],Dt={class:"text-lg font-semibold mb-2 flex items-start gap-3"},Tt={key:0},Et={key:0,class:"mb-5"},Nt=["innerHTML"],Ut={class:"flex items-end"},At={key:0,class:"mt-4 flex justify-between items-end print:pb-0"},jt={class:""},Pt={key:1,class:"ml-auto flex gap-6 items-center"},Ft=["rowspan"],Lt={class:"text-center print:text-xs"},Vt={class:"border-2 border-gray-700 p-3 text-center"},Ot=["title"],Mt={class:"border-2 border-gray-700 p-3"},Bt={class:"whitespace-nowrap text-center print:whitespace-break-spaces"},zt={key:0,class:"print:text-xs"},Gt={key:1,class:"text-gray-500"},Ht={key:0,colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Wt={key:1,class:"text-red-400"},Kt={key:2,class:"text-blue-400"},Qt={key:0},Jt={colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Yt={key:1,class:"text-red-400"},Xt={key:2,class:"text-blue-400"},Zt={__name:"RequirementDetailTableRow",props:{detail:{type:Object},requirement:{type:Object},serial:{type:Number},isPrinting:{type:Boolean}},emits:["editClick","deleteClick","taskCreateClick"],setup(b,{emit:N}){const g=b,f=N,a=Re(),_=Q(()=>{var d,r,y;return((r=(d=g.detail)==null?void 0:d.tasks)==null?void 0:r.length)>0?(y=g.detail)==null?void 0:y.tasks:[{id:0}]});function u(){var d,r,y,l,s;if(a.user.role!=="super_admin"&&((d=a.user)==null?void 0:d.id)!==((y=(r=g.requirement)==null?void 0:r.to_department)==null?void 0:y.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(s=(l=g.requirement)==null?void 0:l.to_department)==null?void 0:s.name}'s In charge can create or assign.`);f("taskCreateClick",g.detail)}return(d,r)=>{const y=ke("RouterLink");return n(),o(A,null,[(n(!0),o(A,null,J(_.value,(l,s)=>{var t,c,R,m,E,k,p,h,I;return n(),o("tr",{key:l.id,class:"group/item border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},[s===0?(n(),o(A,{key:0},[e("td",{class:"border-2 border-gray-700 p-3 align-top",rowspan:(((c=(t=b.detail)==null?void 0:t.tasks)==null?void 0:c.length)||1)+(b.isPrinting?0:1)},[e("span",It,q(b.serial),1)],8,Rt),e("td",{class:"border-2 border-gray-700 p-3",rowspan:(((m=(R=b.detail)==null?void 0:R.tasks)==null?void 0:m.length)||1)+(b.isPrinting?0:1)},[e("div",null,[e("div",Dt,[D(G,{"line-clamp":"3",class:"grow"},{default:S(()=>[T(q(b.detail.title),1)]),btnText:S(({lineClampClass:w})=>[T(q(w?"More":"Less"),1)]),_:1}),b.detail.priority?(n(),o("div",Tt,[e("span",{class:M(["font-semibold text-sm",{"text-yellow-600 ":b.detail.priority=="IMPORTANT","text-red-700 ":b.detail.priority=="URGENT"}])},q(b.detail.priority),3)])):v("",!0)]),r[3]||(r[3]=e("hr",{class:"mb-4 -mx-4"},null,-1)),b.detail.description?(n(),o("div",Et,[r[2]||(r[2]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),D(G,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"}},{default:S(()=>[e("p",{innerHTML:b.detail.description,class:"text-justify"},null,8,Nt)]),_:1})])):v("",!0)]),e("div",Ut,[b.detail.supervisor?(n(),o("div",At,[e("div",jt,[r[4]||(r[4]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Supervisor:",-1)),D(Fe,{user:b.detail.supervisor},null,8,["user"])])])):v("",!0),d.state!="loading"&&!((E=b.requirement)!=null&&E.status)||((p=(k=we(a))==null?void 0:k.user)==null?void 0:p.role)=="super_admin"?(n(),o("div",Pt,[e("button",{class:"btn-2",onClick:r[0]||(r[0]=C(w=>f("editClick",b.detail),["prevent"]))},r[5]||(r[5]=[e("i",{class:"fas fa-edit"},null,-1),T("Edit ")])),e("button",{class:"btn-2-red",onClick:r[1]||(r[1]=C(w=>f("deleteClick",b.detail),["prevent"]))},r[6]||(r[6]=[e("i",{class:"fas fa-trash-alt"},null,-1),T("Delete ")]))])):v("",!0)])],8,St),e("td",{class:"border-2 border-gray-700 p-3 whitespace-nowrap print:whitespace-break-spaces print:px-0",rowspan:(((I=(h=b.detail)==null?void 0:h.tasks)==null?void 0:I.length)||1)+(b.isPrinting?0:1)},[e("div",Lt,q(new Date(b.detail.better_to_complete_on).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)],8,Ft)],64)):v("",!0),l.id?(n(),o(A,{key:1},[e("td",Vt,[D(y,{to:{name:"RequirementTaskShow",params:{id:l.id}},class:"hover:underline text-gray-900 hover:text-blue-600 whitespace-nowrap block",target:"_blank"},{default:S(()=>[T(q(l.id)+" ",1),e("i",{title:l.status,class:M(["ml-1",{"fad fa-exclamation-circle text-red-600":l.status=="PENDING","fad fa-exclamation-square text-yellow-600":l.status=="IN_PROGRESS","fad fa-check-circle text-green-600":l.status=="COMPLETED"}])},null,10,Ot)]),_:2},1032,["to"])]),e("td",Mt,[e("div",Bt,[l.deadline?(n(),o("div",zt,q(new Date(l.deadline).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)):(n(),o("div",Gt,"-"))])])],64)):(n(),o(A,{key:2},[b.isPrinting?(n(),o("td",Ht,[b.requirement.status=="approved"?(n(),o("button",{key:0,onClick:C(u,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"},r[7]||(r[7]=[e("i",{class:"fas fa-plus-circle"},null,-1),T(" Create / Assign Task ")]))):b.requirement.status=="rejected"?(n(),o("div",Wt,"Task Rejected")):(n(),o("div",Kt,"Approval Pending"))])):v("",!0)],64))])}),128)),b.isPrinting?v("",!0):(n(),o("tr",Qt,[e("td",Jt,[b.requirement.status=="approved"?(n(),o("button",{key:0,onClick:C(u,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"},r[8]||(r[8]=[e("i",{class:"fas fa-plus-circle"},null,-1),T(" Create / Assign Task ")]))):b.requirement.status=="rejected"?(n(),o("div",Yt,"Task Rejected")):(n(),o("div",Xt,"Approval Pending"))])]))],64)}}},es={class:"sticky top-0 pt-4 bg-white z-10"},ts={class:"mb-4"},ss={class:"mb-4"},ns={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},rs={key:0,class:"mb-4 text-red-500 font-medium"},is={key:1,class:"mb-4"},ls={class:"flex items-center justify-between gap-4"},os=["disabled"],as={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(b,{emit:N}){const g=b,f=N,a=x(),_=x(null),u=x(""),d=x(),r=x({feedback:""});async function y(){var l,s;u.value="submitting";try{const t=await je(g.requirementId,g.detailId,r.value.feedback);f("update",t),u.value="create"}catch(t){u.value="error",d.value=((s=(l=t.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to update requirement detail",f("error",d.value)}}return L(async()=>{var l,s,t,c;u.value="loading";try{await W(g.requirementId),_.value=(l=(await Y(g.requirementId,g.detailId)).data)==null?void 0:l.detail,r.value={feedback:(s=_.value)==null?void 0:s.feedback}}catch(R){d.value=((c=(t=R.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to fetch requirement detail"}finally{u.value=""}}),(l,s)=>{var t;return n(),o("div",{ref_key:"formContainerRef",ref:a,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",es,[s[3]||(s[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),s[4]||(s[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:s[0]||(s[0]=C(c=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:C(y,["prevent"]),class:"z-0"},[u.value!=="loading"?(n(),o(A,{key:0},[e("div",ts,[s[5]||(s[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),D(G,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:S(()=>{var c;return[T(q((c=_.value)==null?void 0:c.title),1)]}),_:1})]),e("div",ss,[s[6]||(s[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),j(e("textarea",{rows:"5","onUpdate:modelValue":s[1]||(s[1]=c=>r.value.feedback=c),placeholder:"Enter requirement feedback",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[P,r.value.feedback]])])],64)):v("",!0),e("div",ns,[d.value?(n(),o("div",rs,q(d.value),1)):v("",!0),d.value?(n(),o("hr",is)):v("",!0),e("div",ls,[e("button",{type:"button",onClick:s[2]||(s[2]=C(c=>f("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:u.value=="loading"||u.value=="submitting",type:"submit",class:"btn-2"},q(u.value=="submitting"?"Saving...":(t=_.value)!=null&&t.feedback?"Update Feedback":"Add Feedback"),9,os)])])],32),u.value==="loading"||u.value==="submitting"?(n(),U(B,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):v("",!0)],512)}}},ds={class:"flex justify-center items-center"},us={class:"modal-card"},ms=["required"],ps={class:"flex"},cs={class:"flex justify-between gap-2 mt-4"},bs=["disabled"],vs=["disabled"],fs={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(b,{emit:N}){const g=b,f=N,a=x(255),_=Q(()=>a.value-l.value.length),u=Ie(),d=x(null),r=x(null),y=x(null),l=x(""),s=x(!1),t=Q(()=>y.value!==null);function c(p){y.value=p,l.value="",k()}function R(){y.value=null,l.value=""}async function m(){var p,h;if(y.value==="reject"&&!l.value)return u.error("Rejection Reason is required!");if(typeof g.onSubmit=="function")return g.onSubmit({note:l.value,action:y.value});f("loading",!0),s.value=!0;try{await Ee(g.requirementId,{note:l.value}),f("success"),R()}catch(I){return f("error",I),u.error(((h=(p=I==null?void 0:I.response)==null?void 0:p.data)==null?void 0:h.message)||"Submission failed!")}finally{f("loading",!1),s.value=!1}}function E(p){var h,I;t.value&&(p.key==="ArrowLeft"?(h=r.value)==null||h.focus():p.key==="ArrowRight"&&((I=d.value)==null||I.focus()))}function k(){Se(()=>{var p;(p=d.value)==null||p.focus()})}return L(()=>{window.addEventListener("keydown",E)}),_e(()=>{window.removeEventListener("keydown",E)}),(p,h)=>(n(),o("div",null,[e("div",ds,[e("button",{onClick:h[0]||(h[0]=I=>c("accept"))},h[3]||(h[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),t.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:C(R,["self"])},[e("div",us,[h[4]||(h[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[j(e("textarea",{"onUpdate:modelValue":h[1]||(h[1]=I=>l.value=I),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:y.value==="reject",onInput:h[2]||(h[2]=I=>l.value.length>a.value?l.value=l.value.slice(0,a.value):null)},null,40,ms),[[P,l.value]]),e("div",ps,[e("div",{class:M(["ml-auto inline-block text-sm text-gray-500",l.value.length>=a.value?"text-red-500":""])}," left "+q(_.value)+"/"+q(a.value)+" words ",3)])]),e("div",cs,[e("button",{ref_key:"cancelBtnRef",ref:r,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:R,disabled:s.value}," Cancel ",8,bs),e("button",{ref_key:"confirmBtnRef",ref:d,class:M(["focus:ring-2 ring-offset-2 disabled:opacity-30",y.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:m,disabled:s.value}," Confirm Submission ",10,vs)])])])):v("",!0)]))}},ys={class:"text-left p-4"},xs={class:"flex items-center gap-6 justify-center my-16"},gs={key:0,class:"border rounded-md"},ks={__name:"TaskParentIdSelector",props:{fromDepartmentId:{type:Number},requirementDetail:{type:Object}},emits:["parentIdSelect","cancelClick","assignTask"],setup(b,{emit:N}){const g=b,f=N,a=Le(),_=x(""),u=x(null),d=x(""),r=x(!1);async function y(){await a.setTaskRequirement(d.value,g.requirementDetail.id),f("assignTask")}return(l,s)=>(n(),o("div",ys,[e("div",xs,[e("button",{onClick:s[0]||(s[0]=C(t=>f("parentIdSelect",0,_.value),["prevent"])),class:"btn-3"}," Add New Task "),s[4]||(s[4]=e("span",null,"or",-1)),e("button",{class:M({"btn-3":_.value!=="direct-assign","btn-2":_.value=="direct-assign"}),onClick:s[1]||(s[1]=C(()=>_.value="direct-assign",["prevent"]))}," Assign Task ",2)]),_.value&&!u.value?(n(),o("div",gs,[e("form",{onSubmit:C(y,["prevent"]),class:"p-4 flex items-end"},[D(Ve,{class:"flex-grow mr-4 h-12",taskId:d.value,"onUpdate:taskId":s[2]||(s[2]=t=>d.value=t),show:r.value,"onUpdate:show":s[3]||(s[3]=t=>r.value=t),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":b.fromDepartmentId}},null,8,["taskId","show","taskQueryParams"]),s[5]||(s[5]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):v("",!0)]))}},ws={class:"container mx-auto p-6 print:p-0 w-full print:max-w-full"},_s={class:"bg-white rounded shadow print:shadow-none p-4 print:p-0 relative"},hs={class:"flex items-start"},qs={class:"mb-4 text-lg print:black print:font-bold"},$s={class:"ml-auto print:hidden flex gap-2 items-center"},Cs={class:"mb-4 flex items-center gap-1 print:mb-1"},Rs={class:"font-bold print:text-gray-900"},Is={class:"mb-3 flex items-center gap-3 print:mb-1"},Ss={class:"print:text-gray-900"},Ds={key:0,class:"mb-3 flex items-center gap-3 print:mb-1"},Ts={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},Es={key:1,class:"mb-3 flex items-center gap-3 print:mb-1"},Ns={class:"print:text-gray-900"},Us={key:0,class:"overflow-x-auto print:overflow-visible"},As={class:"w-full table-auto print:table-fixed"},js={colspan:"2",class:"w-[30%] border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap px-3 py-1 print:whitespace-normal"},Ps={class:""},Fs={class:"p-3 border-2 border-gray-800",colspan:"5"},Ls={class:"font-semibold text-gray-500 print:text-gray-800 text-sm mb-1"},Vs={key:0},Os=["innerHTML"],Ms=["onClick"],Bs={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},zs={class:"flex flex-col items-end"},Gs={key:2,class:"mt-2 text-right print:hidden"},bn={__name:"RequirementShow",setup(b){const N=De(),g=Te(),f=x(""),a=x(null),_=V({open:!1}),u=V({detail:null,open:!1}),d=V({detail:null,open:!1}),r=V({detail:null,open:!1}),y=x(!1),l=()=>y.value=!0,s=()=>y.value=!1;L(async()=>{await t(),window.addEventListener("beforeprint",l),window.addEventListener("afterprint",s)}),_e(()=>{window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",s)});async function t(){var w;f.value="loading",a.value=(w=(await W(N.params.id)).data)==null?void 0:w.requirement,f.value=""}function c(w){console.log({detail:w}),p.modalShown=!0,p.from_department_id=a.value.from_department_id,p.to_department_id=a.value.to_department_id,p.taskDefaultValues={title:"",description:"",from_department_id:a.value.from_department_id,to_department_id:a.value.to_department_id,is_important:(w==null?void 0:w.priority)=="IMPORTANT",is_urgent:(w==null?void 0:w.priority)=="URGENT",supervisor_ids:w!=null&&w.supervisor_id?[w==null?void 0:w.supervisor_id]:[]},p.requirementDetail=w}function R(){_.open=!0}function m(w){u.open=!0,u.detail=w}function E(w){r.open=!0,r.detail=w}function k(){setTimeout(()=>window.print()),y.value=!0}const p=V({parentId:null,modalShown:!1,requirementId:0,taskDefaultValues:{},requirementDetail:null});async function h(){p.parentId=0,p.parentId=null,p.modalShown=!1,p.requirementDetail=null,f.value="loading",await t()}async function I(){p.parentId=null,p.modalShown=!1,p.requirementDetail=null}return(w,i)=>{var X,Z,ee,te,se,ne,re,ie,le,oe,ae,de,ue,me,pe,ce,be,ve,fe;const K=ke("RouterLink");return n(),o("div",ws,[_.open?(n(),U(O,{key:0,class:"*:max-w-4xl"},{default:S(()=>[D(Ze,{requirementId:a.value.id,onCloseClick:i[0]||(i[0]=$=>_.open=!1),onCreate:i[1]||(i[1]=async()=>{_.open=!1,await t()})},null,8,["requirementId"])]),_:1})):v("",!0),u.open?(n(),U(O,{key:1},{default:S(()=>{var $;return[D(Ct,{requirementId:a.value.id,detailId:($=u.detail)==null?void 0:$.id,onCloseClick:i[2]||(i[2]=F=>u.open=!1),onUpdate:i[3]||(i[3]=async()=>{u.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):v("",!0),d.open?(n(),U(O,{key:2},{default:S(()=>{var $;return[D(as,{requirementId:a.value.id,detailId:($=d.detail)==null?void 0:$.id,onCloseClick:i[4]||(i[4]=F=>d.open=!1),onUpdate:i[5]||(i[5]=async()=>{d.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):v("",!0),r.open?(n(),U(O,{key:3},{default:S(()=>{var $;return[D(mt,{requirementId:a.value.id,detailId:($=r.detail)==null?void 0:$.id,onCloseClick:i[6]||(i[6]=F=>r.open=!1),onDelete:i[7]||(i[7]=async()=>{r.open=!1,await t()})},null,8,["requirementId","detailId"])]}),_:1})):v("",!0),p.modalShown?(n(),U(O,{key:4,class:"*:relative"},{default:S(()=>{var $,F;return[e("button",{onClick:C(I,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},i[10]||(i[10]=[e("i",{class:"fas fa-times-circle"},null,-1)])),p.parentId===null?(n(),U(ks,{key:0,"from-department-id":($=a.value)==null?void 0:$.from_department_id,requirementDetail:p==null?void 0:p.requirementDetail,onParentIdSelect:i[8]||(i[8]=z=>p.parentId=z),onCancelClick:I,onAssignTask:h},null,8,["from-department-id","requirementDetail"])):(n(),U(Pe,{key:1,parentTaskId:p.parentId,requirementDetailId:(F=p==null?void 0:p.requirementDetail)==null?void 0:F.id,requirementId:a.value.id,onClose:I,onTaskCreated:h,defaultValues:p.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["parentTaskId","requirementDetailId","requirementId","defaultValues"]))]}),_:1})):v("",!0),e("div",_s,[e("div",hs,[e("div",qs,[i[11]||(i[11]=e("div",{class:"text-gray-800 leading-none"},"To",-1)),e("div",null,q((Z=(X=a.value)==null?void 0:X.to_department)==null?void 0:Z.name),1)]),e("div",$s,[(((ee=a.value)==null?void 0:ee.details)||[]).length>0?(n(),o("button",{key:0,class:"btn-3 font-semibold !pl-2 !pr-4",onClick:C(k,["prevent"])},i[12]||(i[12]=[e("i",{class:"fad fa-print text-xl"},null,-1),T("Print ")]))):v("",!0),e("button",{class:"btn-3",onClick:i[9]||(i[9]=C(()=>we(g).back(),["prevent"]))},"Back"),D(K,{class:"btn-2",to:`/requirements/edit/${(te=a.value)==null?void 0:te.id}`},{default:S(()=>i[13]||(i[13]=[T("Edit")])),_:1,__:[13]},8,["to"])])]),i[28]||(i[28]=e("div",{class:"text-center text-xl font-bold mb-2 underline"},"Requirement Form",-1)),e("div",Cs,[i[14]||(i[14]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",Rs,q((se=a.value)==null?void 0:se.id),1)]),e("div",Is,[i[15]||(i[15]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),e("div",Ss,q((re=(ne=a.value)==null?void 0:ne.from_department)==null?void 0:re.name),1)]),((le=(ie=a.value)==null?void 0:ie.website_tags)==null?void 0:le.length)>0?(n(),o("div",Ds,[i[16]||(i[16]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",Ts,[(n(!0),o(A,null,J(((oe=a.value)==null?void 0:oe.website_tags)||[],$=>(n(),o("div",{key:$.id,class:"border px-2 rounded-md bg-gray-50 shadow-sm whitespace-nowrap"},q($.name),1))),128))])])):v("",!0),(ae=a.value)!=null&&ae.submission_date?(n(),o("div",Es,[i[17]||(i[17]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",Ns,q(new Date((de=a.value)==null?void 0:de.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)])):v("",!0),i[29]||(i[29]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[i[27]||(i[27]=e("div",{class:"flex items-end mb-3"},[e("h2",{class:"text-xl font-semibold"},"Requirements"),e("div",{class:"ml-auto print:hidden flex gap-2 text-sm"})],-1)),(((ue=a.value)==null?void 0:ue.details)||[]).length>0?(n(),o("div",Us,[e("table",As,[e("thead",null,[e("tr",null,[i[18]||(i[18]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-left px-4 print:px-2 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[8%]"}," SL ",-1)),i[19]||(i[19]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap print:whitespace-normal w-[65%]"}," Requirement Details ",-1)),i[20]||(i[20]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Better To Complete ",-1)),e("th",js," For '"+q(((me=a.value.to_department)==null?void 0:me.short_name)||((pe=a.value.to_department)==null?void 0:pe.name))+"' Use ",1)]),i[21]||(i[21]=e("tr",null,[e("td",{class:"whitespace-nowrap border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold print:text-xs"}," Task No "),e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:text-xs print:p-0"}," Expected Date ")],-1))]),e("tbody",null,[(n(!0),o(A,null,J(((ce=a.value)==null?void 0:ce.details)||[],($,F)=>{var z,ye,xe;return n(),o(A,{key:$.id},[D(Zt,{requirement:a.value,detail:$,serial:F+1,onEditClick:m,onDeleteClick:E,onTaskCreateClick:c,isPrinting:y.value},null,8,["requirement","detail","serial","isPrinting"]),e("tr",Ps,[e("td",Fs,[e("div",Ls," '"+q(((z=a.value.to_department)==null?void 0:z.short_name)||((ye=a.value.to_department)==null?void 0:ye.name))+"' Feedback ",1),f.value!="loading"&&((xe=a.value)!=null&&xe.status)?(n(),o("div",Vs,[$!=null&&$.feedback?(n(),U(G,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:S(()=>[e("p",{class:"text-sky-800 text-sm text-justify",innerHTML:$==null?void 0:$.feedback},null,8,Os)]),_:2},1024)):v("",!0),e("div",null,[e("button",{class:"btn-3 print:hidden",onClick:C(()=>{d.open=!0,d.detail=$},["prevent"])},q($.feedback?"Update Feedback":"Add feedback"),9,Ms)])])):v("",!0)])])],64)}),128))])])])):v("",!0),f.value!="loading"&&!((be=a.value)!=null&&be.status)?(n(),o("div",Bs,[e("button",{class:"btn-2 pl-2 text-base",onClick:C(R,["prevent"])},i[22]||(i[22]=[e("i",{class:"fad fa-plus-circle text-2xl mr-2"},null,-1),T("Add Requirement ")])),e("div",zs,[D(fs,{"requirement-id":(ve=a.value)==null?void 0:ve.id,onSuccess:t},{heading:S(()=>i[23]||(i[23]=[T(" Requirement Submission ")])),acceptButtonLabel:S(()=>i[24]||(i[24]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),T("Submit Requirement ")],-1)])),submitButtonLabel:S(()=>i[25]||(i[25]=[T(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):v("",!0),f.value!="loading"&&!((fe=a.value)!=null&&fe.status)?(n(),o("div",Gs,i[26]||(i[26]=[e("p",{class:"text-yellow-800 text-sm"},[e("span",{class:"fas fa-exclamation-circle"}),T(" After submitting you cannot add requirement no more ")],-1)]))):v("",!0)]),f.value==="loading"?(n(),U(B,{key:2,class:"absolute inset-0 bg-opacity-90"})):v("",!0)])])}}};export{bn as default};
