import{_ as ue,r as h,G as ce,x as T,h as me,y as ve,q as fe,c,o as d,O as C,j as N,a as o,d as D,N as O,k as y,t as v,m as Z,P as ge,F as Y,e as ye,b as be,T as he,Z as pe,W as xe,A as _e,s as M}from"./index-Cw913uWY.js";import{u as we}from"./user-fMaxvxRI.js";const ke={class:"flex items-start gap-2"},Se={class:"leading-tight"},$e={class:"font-medium text-gray-800"},Be={key:0,class:"text-xs text-gray-500"},Ee={class:"flex items-start gap-3"},Te={class:"flex-1 min-w-0"},Ce={class:"font-semibold text-gray-900 leading-tight truncate"},Ue={class:"text-xs text-gray-500 leading-tight"},ze={key:0},Le={key:1,class:"mx-1"},He={key:2},Ie={key:0,class:"text-[11px] text-gray-500"},Me={class:"text-blue-500 mt-1 text-[11px]"},De={class:"mt-3 grid grid-cols-[110px_1fr] gap-x-3 gap-y-1 text-xs"},Oe={class:"text-gray-500"},Ae={class:"text-gray-800 font-medium truncate"},Fe={key:0,class:"mt-3"},Ne=["href"],Re={key:1,class:"mt-2 text-[11px] text-indigo-600"},je={key:2,class:"mt-2 text-[11px] text-red-600"},Pe=120,We={__name:"UserHoverBubble",props:{user:{type:Object,default:()=>({})}},setup(t){const g=t,R=we(),p=h(!1),x=h(!1),b=h(""),_=h(null),w=h(!1),k=h(null),S=h({}),$=h(null),m=ce({trigger:!1,bubble:!1});let U=null;const j=new Date,K=`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}`,B=()=>{U&&(clearTimeout(U),U=null)},Q={executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},l=T(()=>({...g.user||{},..._.value||{}})),z=T(()=>{var e,a;return Q[(e=l.value)==null?void 0:e.type]||((a=l.value)==null?void 0:a.type)||""}),P=T(()=>{var i,u,f;const e=l.value||{},a=(e==null?void 0:e.id)||(e==null?void 0:e.user_id)||(e==null?void 0:e.employee_id);if(!a)return"";const r=((i=e==null?void 0:e.department)==null?void 0:i.id)||(e==null?void 0:e.department_id),n=((f=(u=e==null?void 0:e.department)==null?void 0:u.company)==null?void 0:f.id)||(e==null?void 0:e.company_id),s=new URLSearchParams;return r&&s.set("department_id",r),n&&s.set("company_id",n),s.set("employee_id",a),s.set("date",K),`/hrd/em-attendance?${s.toString()}`}),X=T(()=>{var r,n,s,i,u;const e=l.value||{};return[{label:"Employee ID",value:e.employee_id||e.employeeId||e.id},{label:"Employment type",value:e.employment_type},{label:"Email",value:e.email},{label:"Phone",value:e.phone||e.contact_number||e.mobile},{label:"Designation",value:(r=e.designation)==null?void 0:r.title},{label:"Department",value:(n=e.department)==null?void 0:n.name},{label:"Company",value:((i=(s=e.department)==null?void 0:s.company)==null?void 0:i.name)||((u=e.company)==null?void 0:u.name)},{label:"Line Type",value:z.value},{label:"Blood Group",value:e.blood}].map(f=>({...f,value:f.value||"-"}))}),ee=T(()=>{var a,r,n,s,i,u;if(!((a=g.user)!=null&&a.id))return!1;const e=l.value||{};return!e.email||!(e.phone||e.contact_number||e.mobile)||!((r=e.department)!=null&&r.name)||!((n=e.designation)!=null&&n.name)||!((i=(s=e.department)==null?void 0:s.company)!=null&&i.name||(u=e.company)!=null&&u.name)}),te=()=>{_.value=null,w.value=!1,b.value=""},ae=async()=>{var e;if(!(!ee.value||!((e=g.user)!=null&&e.id)||w.value||x.value)){x.value=!0,b.value="";try{const a=await R.fetchUser(g.user.id);a&&(_.value=a),w.value=!0}catch{b.value="Unable to load full profile right now."}finally{x.value=!1}}},W=()=>{var E;const e=k.value;if(!e)return;const a=e.getBoundingClientRect(),r=320,n=12,s=((E=$.value)==null?void 0:E.offsetHeight)||0,i=window.innerHeight-a.bottom-8,u=a.top-8,f=s&&s>i&&u>i,H=Math.min(Math.max(a.left,n),window.innerWidth-r-n),I=f?a.top-s-8:a.bottom+8;S.value={top:`${Math.max(I,n)}px`,left:`${H}px`,width:`${Math.min(r,window.innerWidth-n*2)}px`}},V=async()=>{p.value=!0,await _e(),W(),await ae()},se=()=>{p.value=!1},A=()=>{m.trigger||m.bubble||(B(),U=setTimeout(()=>{!m.trigger&&!m.bubble&&se()},Pe))},L=()=>{p.value&&W()};me(()=>{window.addEventListener("resize",L),window.addEventListener("scroll",L,!0)}),ve(()=>{window.removeEventListener("resize",L),window.removeEventListener("scroll",L,!0),B()}),fe(()=>{var e;return(e=g.user)==null?void 0:e.id},()=>{te()});const le=()=>{B(),m.trigger=!0,V()},ne=()=>{m.trigger=!1,A()},oe=()=>{B(),m.trigger=!0,V()},re=()=>{m.trigger=!1,A()},ie=()=>{B(),m.bubble=!0},de=()=>{m.bubble=!1,A()};return(e,a)=>(d(),c("div",xe({class:"relative flex items-start"},e.$attrs,{onMouseenter:le,onMouseleave:ne,onFocusin:oe,onFocusout:re,ref_key:"triggerRef",ref:k}),[C(e.$slots,"trigger",{user:l.value},()=>{var r,n,s,i,u;return[o("div",ke,[D(O,{size:"medium",user:l.value,class:"inline-block align-middle"},null,8,["user"]),o("div",Se,[o("div",$e,v(((r=l.value)==null?void 0:r.name)||"Unknown user"),1),(s=(n=l.value)==null?void 0:n.department)!=null&&s.name?(d(),c("div",Be,v((u=(i=l.value)==null?void 0:i.department)==null?void 0:u.name),1)):y("",!0)])])]},!0),(d(),N(pe,{to:"body"},[D(he,{name:"fade-scale"},{default:Z(()=>{var r,n,s,i,u,f,H,I,E,q,G,J;return[p.value?(d(),c("div",{key:0,class:"fixed z-[5000000] rounded-xl border border-gray-200 bg-white p-4 shadow-xl overflow-y-auto max-h-[40vh] w-80 md:w-96",style:ge(S.value),ref_key:"bubbleRef",ref:$,onMouseenter:ie,onMouseleave:de},[o("div",Ee,[D(O,{user:l.value,size:"xlarge"},null,8,["user"]),o("div",Te,[o("div",Ce,v(((r=l.value)==null?void 0:r.name)||"Unknown user"),1),o("div",Ue,[(s=(n=l.value)==null?void 0:n.designation)!=null&&s.title?(d(),c("span",ze,v((u=(i=l.value)==null?void 0:i.designation)==null?void 0:u.title),1)):y("",!0),(H=(f=l.value)==null?void 0:f.designation)!=null&&H.title&&z.value?(d(),c("span",Le," • ")):y("",!0),z.value?(d(),c("span",He,v(z.value),1)):y("",!0)]),(I=l.value)!=null&&I.employee_id?(d(),c("div",Ie," ID: "+v((E=l.value)==null?void 0:E.employee_id),1)):y("",!0),o("div",Me," Shift: "+v(((J=(G=(q=l.value)==null?void 0:q.current_shift)==null?void 0:G.shift)==null?void 0:J.name)||"N/A"),1),o("div",null,[C(e.$slots,"afterHeader",{user:l.value},void 0,!0)])])]),o("dl",De,[(d(!0),c(Y,null,ye(X.value,F=>(d(),c(Y,{key:F.label},[o("dt",Oe,v(F.label),1),o("dd",Ae,v(F.value),1)],64))),128))]),P.value?(d(),c("div",Fe,[o("a",{href:P.value,target:"_blank",rel:"noopener",class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md shadow-sm"},a[0]||(a[0]=[o("i",{class:"far fa-external-link-alt"},null,-1),be(" Open Job Card ")]),8,Ne)])):y("",!0),x.value?(d(),c("div",Re,"Loading more details…")):b.value?(d(),c("div",je,v(b.value),1)):y("",!0)],36)):y("",!0)]}),_:3})]))],16))}},Ve=ue(We,[["__scopeId","data-v-d65c7fc5"]]),qe=["title"],Ge={class:"text-xs"},Je={key:0,class:"text-gray-400 mr-1 whitespace-nowrap"},Ke={__name:"UserChip",props:{user:Object,hideEmployeeId:{type:Boolean,default:!1},avatarClass:{type:[String,Object],default:""},avatarSize:{type:String,default:"small"},titleClass:{type:[String,Object],default:""},showDetailsOnAvatarHover:{type:Boolean,default:!1}},setup(t){return(g,R)=>{var p,x,b,_,w,k,S,$,m;return d(),c("div",{class:"inline-flex items-center border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm gap-1",title:`${(p=t.user)!=null&&p.id?((x=t.user)==null?void 0:x.id)+" - ":""} ${(b=t.user)!=null&&b.employee_id?((_=t.user)==null?void 0:_.employee_id)+" - ":""} ${(w=t.user)==null?void 0:w.name}`},[t.showDetailsOnAvatarHover?(d(),N(Ve,{key:0,user:t.user},{trigger:Z(()=>[D(O,{user:t.user,class:M(["avatar !text-xs",t.avatarClass]),size:t.avatarSize},null,8,["user","class","size"])]),_:1},8,["user"])):(d(),N(O,{key:1,user:t.user,class:M(["avatar !text-xs",t.avatarClass]),size:t.avatarSize},null,8,["user","class","size"])),o("div",Ge,[o("div",{class:M(["flex items-center",t.titleClass])},[(k=t.user)!=null&&k.employee_id&&!t.hideEmployeeId?(d(),c("span",Je,v((S=t.user)==null?void 0:S.employee_id)+" - ",1)):y("",!0),o("div",null,[o("span",{class:M(["text-gray-800 font-semibold w-full line-clamp-1",{"  ":(($=t.user)==null?void 0:$.employee_id)&&!t.hideEmployeeId}])},v((m=t.user)==null?void 0:m.name),3),C(g.$slots,"name-bottom")])],2),C(g.$slots,"title-bottom")]),C(g.$slots,"after",{user:t.user})],8,qe)}}};export{Ve as U,Ke as _};
