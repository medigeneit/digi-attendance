import{_ as ye,r as h,h as me,U as ge,x as T,A as be,q as re,c as i,o as u,a as f,i as he,O as g,j,k as J,F as I,e as Z,t as k,w as x,v as ue,z as B,b as D,s as Q,J as we,P as ke,Z as xe}from"./index-CrCS1_v2.js";const Se={class:"w-full h-full"},$e={key:0,class:"flex flex-wrap items-center gap-2 w-full h-full justify-items-stretch py-1.5"},Ve={class:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm"},Be=["onClick"],Ce={key:1,class:"text-gray-400"},Oe=["placeholder","onKeydown"],Ke={key:1,class:"flex items-center h-full"},Le=["title"],Ge={key:1,class:"text-gray-500 text-sm"},Ae={class:"flex items-center gap-0.5"},Ee={key:0,class:"px-2 pt-2"},Te={class:"max-h-60 overflow-y-auto py-2"},je={key:0},Ie={class:"mx-2 text-sm font-semibold"},De={class:"px-2 text-sm text-gray-700"},Me=["onClick","onKeydown"],Re=["onClick","onKeydown"],ze={key:1,class:"px-3 py-2 text-gray-500 min-h-24 flex justify-center items-center -mt-2"},M=6,Fe={__name:"SelectDropdown",props:{options:{type:Array,required:!0},modelValue:{type:[Object,Array,String,Number,null],default:null},placeholder:{type:String,default:null},multiple:{type:Boolean,default:!1},label:{type:String,default:"label"},value:{type:String,default:"id"},clearable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},searchBy:{type:Function,default:null},position:{type:String,default:"auto",validator:r=>["top","left","right","bottom","auto"].includes(r)},containment:{type:Object,default:()=>window},taggable:{type:Boolean,default:!1},createOption:Function,hideSelectedValue:{type:Boolean,default:!1},isOptionGroup:{type:Boolean,default:!1},optGroupOptionKey:{type:String,default:"children"},groupLabel:{type:String,default:"name"},teleportTarget:{type:String,default:"body"}},emits:["update:modelValue","input","open","close","search","search:focus","search:blur","option:selecting","option:selected","option:deselecting","option:deselected"],setup(r,{emit:ie}){const n=r,a=ie,d=h(!1),c=h(""),X=h(null),Y=h(null),R=h(),z=h(),C=h(n.position),F=h(""),S=h(0),_=h({});function ee(e){var o,s;const l=(o=R.value)==null?void 0:o.contains(e.target),t=(s=z.value)==null?void 0:s.contains(e.target);!l&&!t&&d.value&&(d.value=!1,a("close"))}function N(e){var t;return(n.isOptionGroup?((t=W(e))==null?void 0:t[n.optGroupOptionKey])||[]:n.options).find(o=>(o==null?void 0:o[n.value])==e)}function te(e){console.log(`handleKeydown:${e.key}`),!(!d.value||n.isOptionGroup)&&(e.key==="ArrowDown"?(e.preventDefault(),S.value<L.value.length&&S.value++):e.key==="ArrowUp"&&(e.preventDefault(),S.value>0&&S.value--))}const le=()=>P(d.value),ne=()=>P(d.value),de=e=>{if(!(!d.value||n.isOptionGroup)&&S.value>=0&&e.key==="Enter"){const l=L.value[S.value];l&&w(l)}};me(()=>{var e;document.addEventListener("click",ee),window.addEventListener("keydown",te),(e=n.containment)==null||e.addEventListener("scroll",le),window.addEventListener("resize",ne),setTimeout(()=>{var l;(l=Y.value)==null||l.focus()})}),ge(()=>{var e;document.removeEventListener("click",ee),window.removeEventListener("keydown",te),(e=n.containment)==null||e.removeEventListener("scroll",le),window.removeEventListener("resize",ne)});const ce=T(()=>n.multiple||n.taggable),p=T(()=>n.multiple||n.taggable?Array.isArray(n.modelValue)?n.modelValue:[]:n.modelValue),O=e=>(e==null?void 0:e[n.label])??(e==null?void 0:e.label)??e,K=e=>{let l=[];if(n.isOptionGroup){const o=W(e);l=(o==null?void 0:o[n.optGroupOptionKey])||[]}else l=n.options;const t=l.find(o=>typeof o=="string"||typeof o=="number"?String(o)===String(e):(o==null?void 0:o[n.value])==e);return t?(t==null?void 0:t[n.label])??(t==null?void 0:t.label)??t:n.taggable?e:null},v=e=>typeof e=="object"?(e==null?void 0:e[n.value])??(e==null?void 0:e.value)??e:typeof e=="string"||typeof e=="number"?e:"",fe=()=>{n.disabled||(d.value=!d.value,a(d.value?"open":"close"),d.value&&setTimeout(()=>{var e;(e=X.value)==null||e.focus()},0))},G=e=>{const l=v(e);return n.multiple||n.taggable?p.value.some(t=>v(t)===l):v(p.value)===l},w=(e,l=null)=>{if(console.log({parentOption:l}),l&&(F.value=l),n.multiple||n.taggable)if(G(e)){a("option:deselecting",e);const t=p.value.filter(o=>v(o)!==v(e));a("update:modelValue",t),a("option:deselected",e)}else{a("option:selecting",e);const t=[...p.value,v(e)];a("update:modelValue",t),a("option:selected",e)}else a("option:selected",e),typeof n.modelValue=="object"&&n.modelValue?a("update:modelValue",e):a("update:modelValue",v(e));d.value=!1,a("close"),a("input",e),c.value=""},U=e=>{const l=p.value.filter(t=>v(t)!==v(e));a("update:modelValue",l),a("option:deselected",e)},L=T(()=>{if(!n.searchable)return n.options;const e=(c.value||"").trim();if(!e)return H(n.options);const l=e.toLowerCase(),{options:t,isOptionGroup:o,searchBy:s,optGroupOptionKey:$}=n;if(!o)return typeof s=="function"?s(t,l):H(t).filter(V=>{const y=O(V);return y&&y.toLowerCase().includes(l)});const b=[],A=$||"children";for(let V=0;V<t.length;V++){const y=t[V],m=(y==null?void 0:y[A])||[],q=typeof s=="function"?s(m,l):(()=>{const se=[];for(let E=0;E<m.length;E++){const ae=O(m[E]);ae&&ae.toLowerCase().includes(l)&&se.push(m[E])}return se})();q.length>0&&(q.length===m.length?b.push(y):b.push({...y,[A]:H(q)}))}return b}),H=e=>Array.isArray(e)?n.hideSelectedValue?e.filter(l=>!G(l)):[...e]:[];async function P(e){if(!e)return null;await be();const l=R.value,t=z.value;if(!(l&&t))return null;const o=n.containment||window,s=l.getBoundingClientRect(),$=t.getBoundingClientRect(),b=typeof o.getBoundingClientRect=="function"?o.getBoundingClientRect():null,A=((b==null?void 0:b.bottom)??window.innerHeight)-s.bottom,V=s.top-((b==null?void 0:b.top)??0),y=$.height;n.position==="auto"?C.value=A<y&&V>y?"top":"bottom":C.value=n.position;const m={position:"fixed",minWidth:`${s.width}px`,left:`${s.left}px`,top:`${s.bottom+M}px`};C.value==="top"?m.top=`${s.top-y-M}px`:C.value==="left"?(m.left=`${s.left-$.width-M}px`,m.top=`${s.top}px`):C.value==="right"&&(m.left=`${s.right+M}px`,m.top=`${s.top}px`),_.value=m}const oe=T(()=>L.value.find(e=>O(e).toLowerCase()===c.value.toLowerCase()));function pe(e){if(c.value.length===0&&n.taggable&&Array.isArray(n.modelValue)){const l=[...n.modelValue];l.pop(),a("update:modelValue",l)}}function ve(e){if(e.preventDefault(),!(!n.taggable||!c.value.trim())){if(oe.value)w(oe.value);else{const l=n.createOption?n.createOption(c.value):c.value.trim();a("option:created",l),a("option:selected",l),a("input",l),a("update:modelValue",[...n.modelValue,l])}c.value="",e.target.focus()}}function W(e){return n.options.find(l=>{var t;return(t=l==null?void 0:l[n.optGroupOptionKey])==null?void 0:t.some(o=>(o==null?void 0:o[n.value])==e)})}return re(()=>n.modelValue,e=>{n.isOptionGroup&&(F.value=W(e))}),re(d,P),(e,l)=>(u(),i("div",{class:"border rounded-md cursor-pointer relative",ref_key:"dropdownRef",ref:R},[f("div",{class:Q(["flex items-center justify-between px-2 h-full gap-2",{"bg-gray-100":r.disabled}]),onClick:fe,tabindex:"0"},[f("div",Se,[ce.value?(u(),i("div",$e,[Array.isArray(p.value)&&p.value.length>0?g(e.$slots,"selected-options",{key:0,items:p.value,removeItem:t=>U(t),getOption:N,label:K},()=>[(u(!0),i(I,null,Z(p.value,t=>g(e.$slots,"selected-option",{key:v(t),option:N(t),removeItem:o=>U(o)},()=>[f("span",Ve,[f("span",null,k(K(t)),1),f("button",{onClick:x(o=>U(t),["prevent","stop"]),type:"button",class:"ml-1 text-xs"}," × ",8,Be)])],!0)),128))],!0):r.taggable?j("",!0):(u(),i("span",Ce,k(r.placeholder||"Select.."),1)),r.taggable?J((u(),i("input",{key:2,"onUpdate:modelValue":l[0]||(l[0]=t=>c.value=t),ref_key:"tagSearchInput",ref:Y,type:"text",class:"flex-grow px-2 py-1 rounded outline-none",placeholder:r.placeholder||"Type and enter to add",onKeydown:[B(x(ve,["prevent","stop"]),["enter"]),B(pe,["backspace"])],onKeyup:l[1]||(l[1]=()=>d.value=!!c.value),onFocus:l[2]||(l[2]=t=>e.$emit("search:focus")),onBlur:l[3]||(l[3]=t=>e.$emit("search:blur"))},null,40,Oe)),[[ue,c.value]]):j("",!0)])):(u(),i("div",Ke,[g(e.$slots,"selected-option",{option:N(r.modelValue),group:F.value},()=>[K(p.value)?(u(),i("span",{key:0,class:"line-clamp-1",title:K(p.value)},k(K(p.value)),9,Le)):(u(),i("span",Ge,k(r.placeholder||"Select..."),1))],!0)]))]),f("div",Ae,[n.modelValue&&r.clearable&&!n.disabled?(u(),i("button",{key:0,onClick:l[4]||(l[4]=x(()=>a("update:modelValue",""),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700 text-xl",title:"Clear selection"},[g(e.$slots,"clear-icon",{},()=>[l[9]||(l[9]=D(" × "))],!0)])):j("",!0),g(e.$slots,"open-indicator",{},()=>[l[10]||(l[10]=f("svg",{class:"w-4 h-4 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M19 9l-7 7-7-7"})],-1))],!0)])],2),(u(),he(xe,{to:r.teleportTarget||"body",disabled:!r.teleportTarget},[J(f("div",{class:"fixed border rounded shadow-[0px_0px_10px_0px_rgba(0,0,0,0.25)] z-[50000000] border-teal-500 bg-white",ref_key:"dropdownMenuRef",ref:z,style:ke(_.value)},[r.searchable&&!r.taggable?(u(),i("div",Ee,[g(e.$slots,"search",{},()=>[J(f("input",{type:"text","onUpdate:modelValue":l[5]||(l[5]=t=>c.value=t),ref_key:"searchInput",ref:X,class:"w-full px-2 py-1 border rounded outline-blue-400 focus:outline-1",placeholder:"Search...",onFocus:l[6]||(l[6]=t=>e.$emit("search:focus")),onBlur:l[7]||(l[7]=t=>e.$emit("search:blur")),onKeydown:l[8]||(l[8]=B(x(t=>de(t),["stop"]),["enter"]))},null,544),[[ue,c.value]])],!0)])):j("",!0),g(e.$slots,"list-header",{},void 0,!0),f("ul",Te,[L.value.length?(u(!0),i(I,{key:0},Z(L.value,(t,o)=>(u(),i(I,{key:v(t)},[r.isOptionGroup?(u(),i("li",je,[f("div",Ie,k(t==null?void 0:t[r.groupLabel]),1),f("ul",De,[(u(!0),i(I,null,Z((t==null?void 0:t[r.optGroupOptionKey])||[],s=>(u(),i("li",{key:v(s),tabindex:"0",class:Q([{"bg-blue-50":G(s)},"px-3 py-1 my-0.5 hover:bg-blue-100 focus:bg-blue-100 focus:outline-blue-500 cursor-pointer"]),onClick:$=>w(s,t),onKeydown:[B(x($=>w(s,t),["prevent"]),["space"]),B(x($=>w(s,t),["prevent"]),["enter"])]},[g(e.$slots,"option",{option:s,group:t},()=>[D(k(O(s)),1)],!0)],42,Me))),128))])])):(u(),i("li",{key:1,tabindex:"0",class:Q([{"bg-blue-50":G(t),"border border-blue-700":S.value===o},"px-3 py-1 my-0.5 hover:bg-blue-100 focus:bg-blue-100 focus:outline-blue-500 cursor-pointer"]),onClick:s=>w(t),onKeydown:[B(x(s=>w(t),["prevent"]),["space"]),B(x(s=>w(t),["prevent"]),["enter"])]},[g(e.$slots,"option",{option:t},()=>[D(k(O(t)),1)],!0)],42,Re))],64))),128)):(u(),i("li",ze,[g(e.$slots,"no-options",{},()=>[D(k(r.taggable?"No option found, Enter to add":"No options found"),1)],!0)]))]),g(e.$slots,"list-footer",{},void 0,!0)],4),[[we,d.value]])],8,["to","disabled"]))],512))}},Ue=ye(Fe,[["__scopeId","data-v-e0e1f975"]]);export{Ue as S};
