import{i as L,s as R,A as B,r as V,p as D,b as j,q as S,c as n,a as l,w as I,d,z as k,F as P,x as z,h as i,v,e as U,D as C,k as c,l as m,m as G,n as $,o as r,t as H,g as J}from"./index-D9fyjAEt.js";import{_ as K}from"./TextEditor-C4Nmb0K7.js";import{u as O}from"./company-DJKPBlYY.js";import{u as Q}from"./department-CYVzg-7a.js";import{u as W}from"./notice-BvYK0bEP.js";import{s as N}from"./vue-multiselect.esm-JKg8_ZwO.js";const X={class:"my-container space-y-2"},Y={class:"card-bg md:p-8 p-4 mx-4"},Z={class:"grid gap-4"},h={class:"border p-4 rounded-md bg-gray-100"},ee={class:"grid md:grid-cols-2 gap-4"},le=["value"],te={key:0},se={key:1},oe={class:"col-span-2 flex justify-between gap-8"},ae={class:"w-full"},de={class:"w-full"},ne={class:"col-span-full"},ie={class:"col-span-full"},re={class:"flex justify-center gap-4"},ce={__name:"NoticeAdd",setup(pe){const g=L(),A=J(),f=W(),w=O(),p=Q(),{companies:E}=R(w),s=B({title:"",type:1,description:"",published_at:"",expired_at:"",company_id:"all",file:"",all_departments:!1,all_employees:!1}),u=V([]),x=D(()=>u.value.map(o=>o.id)),y=V([]),_=D(()=>y.value.map(o=>o.id)),T=()=>{s.value.all_departments&&(x.value=[])},q=()=>{s.value.all_employees&&(_.value=[])};j(async()=>{await w.fetchCompanies()}),S(()=>s.company_id,async o=>{await p.fetchDepartments(o)}),S(u,o=>{const e=o.map(a=>a.id);p.fetchDepartmentEmployee(e)});const F=async o=>{var a;const e=o.target.files[0];if(e){const t=new FormData;t.append("file",e),console.log({file:e});const b=await f.fetchFileUpload(t);s.file=(a=b==null?void 0:b.data)==null?void 0:a.url}},M=async()=>{var o,e;try{const a={title:s.title,type:s.type,description:s.description,published_at:s.published_at,expired_at:s.expired_at,company_id:s.company_id,department_id:s.department_id,department_ids:x.value,employee_ids:_.value,file:s.file};await f.createNotice(a),g.success("Notice created successfully"),await f.fetchNotices(),A.replace("/hrd/notice")}catch(a){const t=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to save user";g.error(t),console.error(t)}};return(o,e)=>{const a=$("RouterLink");return r(),n("div",X,[l("div",Y,[e[25]||(e[25]=l("h2",{class:"title-lg text-center"},"Add Notice",-1)),l("form",{onSubmit:I(M,["prevent"]),class:"space-y-4"},[l("div",Z,[l("div",h,[e[21]||(e[21]=l("p",{class:"title-md"},"Notice Info",-1)),e[22]||(e[22]=l("hr",{class:"my-2"},null,-1)),l("div",ee,[l("div",null,[e[11]||(e[11]=l("label",null,"Company *",-1)),d(l("select",{id:"company_id","onUpdate:modelValue":e[0]||(e[0]=t=>s.company_id=t),class:"w-full border rounded px-3 py-2",required:""},[e[10]||(e[10]=l("option",{value:""},"All Company",-1)),(r(!0),n(P,null,z(i(E),t=>(r(),n("option",{key:t==null?void 0:t.id,value:t==null?void 0:t.id},H(t==null?void 0:t.name),9,le))),128))],512),[[k,s.company_id]])]),l("div",null,[e[13]||(e[13]=l("label",null,"Type*",-1)),d(l("select",{id:"type","onUpdate:modelValue":e[1]||(e[1]=t=>s.type=t),class:"w-full border rounded px-3 py-2",required:""},e[12]||(e[12]=[l("option",{value:"1"},"General",-1),l("option",{value:"2"},"Policy",-1)]),512),[[k,s.type]])]),s.type!=="2"?(r(),n("div",te,[e[14]||(e[14]=l("label",null,"Publish Date*",-1)),d(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.published_at=t),type:"date",class:"w-full p-2 border rounded",required:""},null,512),[[v,s.published_at]])])):U("",!0),s.type!=="2"?(r(),n("div",se,[e[15]||(e[15]=l("label",null,"Expired Date*",-1)),d(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.expired_at=t),type:"date",class:"w-full p-2 border rounded",required:""},null,512),[[v,s.expired_at]])])):U("",!0),l("div",oe,[l("div",ae,[l("label",null,[d(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>s.all_departments=t),onChange:T},null,544),[[C,s.all_departments]]),e[16]||(e[16]=c(" Select All Departments "))]),m(i(N),{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value=t),options:i(p).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",class:"w-full p-2 border rounded",disabled:s.all_departments},null,8,["modelValue","options","disabled"])]),l("div",de,[l("label",null,[d(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=t=>s.all_employees=t),onChange:q},null,544),[[C,s.all_employees]]),e[17]||(e[17]=c(" Select All Employees "))]),m(i(N),{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=t=>y.value=t),options:i(p).employees,multiple:!0,searchable:!0,"track-by":"id",label:"name",class:"w-full p-2 border rounded",placeholder:"Select Employees",disabled:s.all_employees},null,8,["modelValue","options","disabled"])])]),l("div",ne,[e[18]||(e[18]=l("label",null,"Title*",-1)),d(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>s.title=t),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[v,s.title]])]),l("div",null,[e[19]||(e[19]=l("label",null,"File",-1)),l("input",{onChange:F,type:"file",class:"w-full p-2 border rounded"},null,32)]),l("div",ie,[e[20]||(e[20]=l("label",null,"Description",-1)),m(K,{modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=t=>s.description=t),cols:"30",rows:"10",class:"w-full"},null,8,["modelValue"])])])])]),l("div",re,[m(a,{to:{name:"UserList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:G(()=>e[23]||(e[23]=[c(" Cancel ")])),_:1}),e[24]||(e[24]=l("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32)])])}}};export{ce as default};
