import{D as Y,r as $,G,q as V,h as J,c as u,k as T,o as c,a as e,t as d,w as Z,d as M,l as K,v as Q,n as A,F as O,e as q,A as W,u as ee,x as P,S as te,U as se,P as oe}from"./index-D25JIjXx.js";import{_ as H}from"./MultiselectDropdown-Av6vdJZM.js";import{u as re}from"./department-BVYZ5K1U.js";import{u as ne}from"./user-BB8L4P9-.js";import{_ as le}from"./DeleteModal-j-TlMzIm.js";import{_ as de}from"./HeaderWithButtons-6f8L3C7g.js";import{L as ae}from"./LoaderView-DthaVd7u.js";import{u as ie}from"./leave-approval-CddrV_T0.js";const ue={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},ce={class:"bg-white rounded-lg shadow-lg w-full max-w-lg"},pe={class:"px-6 py-4 border-b"},_e={class:"text-lg font-bold capitalize"},me={key:0},ye=["for"],be={class:"flex justify-end space-x-4"},ge={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"},fe={__name:"LeaveApprovalModal",props:{show:{type:Boolean,required:!0},leaveApproval:{type:Object,default:null},approvalType:{type:String,default:"leave"}},emits:["close","save"],setup(U,{emit:F}){const a=U,h=F,v=ne(),N=re(),{departments:j}=Y(N),m=$(!1),_=$(null),p=G({id:null,name:"",department_id:null,in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null,type:a.approvalType}),f=G({in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null}),D=()=>{Object.keys(f).forEach(o=>{f[o]=v.users.find(i=>i.id===p[o])||null})};Object.keys(f).forEach(o=>{V(()=>f[o],i=>{p[o]=i?i.id:null})});const R=()=>{Object.assign(p,{id:null,name:"",department_id:null,in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null,type:a.approvalType}),Object.assign(f,{in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null}),_.value=null,m.value=!1},S=async()=>{var y,x;await W();const o=p.department_id||((y=a.leaveApproval)==null?void 0:y.department_id)||null;if(!o){_.value=null;return}const i=(j.value||[]).find(E=>E.id===o);_.value=i||((x=a.leaveApproval)==null?void 0:x.department)||null};V(()=>a.leaveApproval,async o=>{var i;o?(m.value=!0,Object.assign(p,{id:o.id??null,name:o.name??"",department_id:o.department_id??((i=o.department)==null?void 0:i.id)??null,in_charge_user_id:o.in_charge_user_id??null,coordinator_user_id:o.coordinator_user_id??null,operational_admin_user_id:o.operational_admin_user_id??null,recommend_by_user_id:o.recommend_by_user_id??null,approved_by_user_id:o.approved_by_user_id??null,type:o.type??a.approvalType}),D(),await S()):R()},{immediate:!0}),V(()=>_.value,o=>{p.department_id=(o==null?void 0:o.id)||null}),V(()=>j.value,async()=>{a.leaveApproval&&await S()},{deep:!0});const I=()=>{if(!p.name||!p.approved_by_user_id){alert("Name and Approved By are required!");return}h("save",{...p,type:p.type||a.approvalType}),B()};V(()=>a.approvalType,o=>{a.leaveApproval||(p.type=o)});const B=()=>{R(),h("close")};return J(async()=>{await Promise.all([v.fetchUsers(),N.fetchDepartments()]),await S()}),(o,i)=>U.show?(c(),u("div",ue,[e("div",ce,[e("div",pe,[e("h3",_e,d(m.value?"Edit":"Add")+" "+d(U.approvalType)+" Approval ",1)]),e("form",{onSubmit:Z(I,["prevent"]),class:"p-6 space-y-4"},[e("div",null,[i[2]||(i[2]=e("label",{for:"name",class:"block text-sm font-medium"},"Approval Name",-1)),K(e("input",{id:"name","onUpdate:modelValue":i[0]||(i[0]=y=>p.name=y),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter approval name",required:""},null,512),[[Q,p.name]])]),M(H,{modelValue:_.value,"onUpdate:modelValue":i[1]||(i[1]=y=>_.value=y),multiple:!1,label:"name","top-label":"Select Department",options:A(j),placeholder:"Choose department"},null,8,["modelValue","options"]),(c(),u(O,null,q({in_charge_user_id:"In-Charge",coordinator_user_id:"Coordinator",operational_admin_user_id:"Operational Admin",recommend_by_user_id:"Recommend By",approved_by_user_id:"Approved By"},(y,x)=>(c(),u(O,{key:x},[U.approvalType==="leave"||!["operational_admin_user_id"].includes(x)?(c(),u("div",me,[e("label",{for:x,class:"block text-sm font-medium"},d(y),9,ye),M(H,{modelValue:f[x],"onUpdate:modelValue":E=>f[x]=E,multiple:!1,label:"name","top-label":`Select ${y}`,"label-prefix":"employee_id",options:A(v).users},null,8,["modelValue","onUpdate:modelValue","top-label","options"])])):T("",!0)],64))),64)),e("div",be,[e("button",{type:"button",onClick:B,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400"}," Cancel "),e("button",ge,d(m.value?"Update":"Create"),1)])],32)])])):T("",!0)}},xe={class:"my-container space-y-4"},ve={class:"p-3 space-y-4"},he={class:"flex flex-col md:flex-row md:items-center gap-3"},we={class:"flex-1"},ke={class:"relative"},Ce={class:"flex items-center gap-2 text-sm text-gray-600"},$e={class:"space-y-2"},Ne={key:0,class:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm flex justify-center"},je={key:1,class:"space-y-2"},Se={class:"min-w-0"},Te={class:"text-lg font-semibold text-gray-900 truncate"},Me={class:"overflow-hidden rounded-b-xl"},Ue={class:"md:hidden px-4 py-4 space-y-3"},De={class:"flex items-start justify-between gap-3"},Be={class:"min-w-0"},Ee={class:"font-semibold text-gray-900 truncate"},Le={class:"text-sm text-gray-500 truncate"},Ve={class:"flex gap-2"},Oe=["onClick"],Re=["onClick"],ze={class:"mt-3 grid grid-cols-1 gap-2 text-sm"},qe={class:"flex justify-between gap-2"},Fe={class:"text-gray-900"},Ie={class:"flex justify-between gap-2"},Pe={class:"text-gray-900"},Ae={key:0,class:"flex justify-between gap-2"},Ge={class:"text-gray-900"},He={class:"flex justify-between gap-2"},Je={class:"text-gray-900"},Ke={class:"flex justify-between gap-2"},Qe={class:"text-gray-900"},We={class:"hidden md:block"},Xe={class:"overflow-x-auto overflow-y-visible"},Ye={class:"min-w-full text-sm"},Ze={class:"bg-gray-50 text-gray-600 text-xs uppercase tracking-wide"},et={key:0,class:"py-3 px-4 text-left"},tt={class:"divide-y divide-gray-100"},st={class:"py-3 px-4 text-gray-700"},ot={class:"py-3 px-4 font-medium text-gray-900"},rt={class:"py-3 px-4 text-gray-700"},nt={class:"py-3 px-4 text-gray-700"},lt={key:0,class:"py-3 px-4 text-gray-700"},dt={class:"py-3 px-4 text-gray-700"},at={class:"py-3 px-4 text-gray-700"},it={class:"py-3 px-4"},ut={class:"flex justify-center gap-2"},ct=["onClick"],pt=["onClick"],_t={key:2,class:"bg-white rounded-xl border border-dashed border-gray-300 shadow-sm p-6 text-center"},mt={class:"text-sm text-gray-500"},kt={__name:"LeaveApprovalList",setup(U){const F=ee(),a=P(()=>F.currentRoute.value.name==="LeaveApprovalList"?"leave":"other"),h=ie(),v=te(),N=$(!1),j=$(!1),m=$(null),_=$(""),p=$(null),f=$(0),D=async()=>{await W(),f.value=p.value?Math.ceil(p.value.getBoundingClientRect().height):0},R=P(()=>{const l=_.value.trim().toLowerCase(),s=h.leaveApprovals||[];return l?s.filter(r=>{var t,b,g,w,k,C;return[r==null?void 0:r.name,(t=r==null?void 0:r.department)==null?void 0:t.name,(b=r==null?void 0:r.in_charge_user)==null?void 0:b.name,(g=r==null?void 0:r.coordinator_user)==null?void 0:g.name,(w=r==null?void 0:r.operational_admin_user)==null?void 0:w.name,(k=r==null?void 0:r.recommend_by_user)==null?void 0:k.name,(C=r==null?void 0:r.approved_by_user)==null?void 0:C.name].filter(Boolean).join(" ").toLowerCase().includes(l)}):s}),S=P(()=>{const s=(R.value||[]).reduce((n,t)=>{var g;const b=((g=t==null?void 0:t.department)==null?void 0:g.name)||"Unassigned Department";return n[b]||(n[b]=[]),n[b].push(t),n},{}),r=Object.entries(s);return r.sort((n,t)=>n[0]==="Unassigned Department"?1:t[0]==="Unassigned Department"?-1:n[0].localeCompare(t[0])),r.map(([n,t])=>({department:n,approvals:t}))}),I=()=>{m.value=null,N.value=!0},B=l=>{m.value={...l},N.value=!0},o=()=>{N.value=!1},i=l=>{m.value=l,j.value=!0},y=()=>{j.value=!1},x=async()=>{var l;if(!((l=m.value)!=null&&l.id)){v.error("Invalid leave approval selected for deletion!");return}try{await h.deleteLeaveApproval(m.value.id),v.success("Leave approval deleted successfully!")}catch(s){v.error("Failed to delete leave approval!"),console.error("Error deleting leave approval:",s)}finally{y()}},E=async l=>{l.id||(l={...l,type:a.value});const s=l.id?"updateLeaveApproval":"createLeaveApproval",r=l.id?"Leave approval updated successfully!":"Leave approval added successfully!";try{await h[s](l.id||l,l),v.success(r)}catch(n){v.error("Failed to save leave approval!"),console.error("Error saving leave approval:",n)}finally{o()}};return J(async()=>{h.fetchLeaveApprovals({type:a.value}),await D(),window.addEventListener("resize",D)}),se(()=>{window.removeEventListener("resize",D)}),(l,s)=>{var r;return c(),u("div",xe,[e("div",{ref_key:"toolbarRef",ref:p,class:"sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-gray-200"},[e("div",ve,[M(de,{title:`${a.value} Approvals`,onAdd:I},null,8,["title"]),e("div",he,[e("div",we,[e("div",ke,[s[2]||(s[2]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"},"ðŸ”Ž",-1)),K(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>_.value=n),type:"text",placeholder:"Search by name / dept / approver...",class:"w-full pl-9 pr-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-200"},null,512),[[Q,_.value]])])]),e("div",Ce,[_.value?(c(),u("button",{key:0,onClick:s[1]||(s[1]=n=>_.value=""),class:"px-3 py-2 rounded-lg border border-gray-200 hover:bg-gray-50 text-gray-700"}," Clear ")):T("",!0)])])])],512),e("div",$e,[A(h).loading?(c(),u("div",Ne,[M(ae,{class:"shadow-none"})])):S.value.length?(c(),u("div",je,[(c(!0),u(O,null,q(S.value,n=>(c(),u("section",{key:n.department,class:"bg-white rounded-xl border border-gray-100 shadow-sm"},[e("div",{class:"sticky z-40 px-4 py-1 rounded border-b border-gray-200 bg-white/95 backdrop-blur flex flex-wrap gap-3 items-center justify-between",style:oe({top:f.value+"px"})},[e("div",Se,[e("p",Te,d(n.department),1)])],4),e("div",Me,[e("div",Ue,[(c(!0),u(O,null,q(n.approvals,(t,b)=>{var g,w,k,C,L,z;return c(),u("div",{key:(t==null?void 0:t.id)??`mobile-${n.department}-${b}`,class:"bg-gray-50 rounded-xl border border-gray-100 p-4 shadow-sm"},[e("div",De,[e("div",Be,[e("div",Ee,d((t==null?void 0:t.name)||"N/A"),1),e("div",Le,d(((g=t==null?void 0:t.department)==null?void 0:g.name)||"N/A"),1)]),e("div",Ve,[e("button",{onClick:X=>B(t),class:"px-3 py-2 rounded-lg border border-blue-200 text-blue-700 hover:bg-blue-50",title:"Edit"}," âœï¸ ",8,Oe),e("button",{onClick:X=>i(t),class:"px-3 py-2 rounded-lg border border-red-200 text-red-700 hover:bg-red-50",title:"Delete"}," ðŸ—‘ï¸ ",8,Re)])]),e("div",ze,[e("div",qe,[s[3]||(s[3]=e("span",{class:"text-gray-500"},"In-Charge",-1)),e("span",Fe,d(((w=t==null?void 0:t.in_charge_user)==null?void 0:w.name)||"N/A"),1)]),e("div",Ie,[s[4]||(s[4]=e("span",{class:"text-gray-500"},"Coordinator",-1)),e("span",Pe,d(((k=t==null?void 0:t.coordinator_user)==null?void 0:k.name)||"N/A"),1)]),a.value==="leave"?(c(),u("div",Ae,[s[5]||(s[5]=e("span",{class:"text-gray-500"},"Operational Admin",-1)),e("span",Ge,d(((C=t==null?void 0:t.operational_admin_user)==null?void 0:C.name)||"N/A"),1)])):T("",!0),e("div",He,[s[6]||(s[6]=e("span",{class:"text-gray-500"},"Recommend By",-1)),e("span",Je,d(((L=t==null?void 0:t.recommend_by_user)==null?void 0:L.name)||"N/A"),1)]),e("div",Ke,[s[7]||(s[7]=e("span",{class:"text-gray-500"},"Approved By",-1)),e("span",Qe,d(((z=t==null?void 0:t.approved_by_user)==null?void 0:z.name)||"N/A"),1)])])])}),128))]),e("div",We,[e("div",Xe,[e("table",Ye,[e("thead",Ze,[e("tr",null,[s[8]||(s[8]=e("th",{class:"py-3 px-4 text-left w-12"},"#",-1)),s[9]||(s[9]=e("th",{class:"py-3 px-4 text-left"},"Name",-1)),s[10]||(s[10]=e("th",{class:"py-3 px-4 text-left"},"In-Charge",-1)),s[11]||(s[11]=e("th",{class:"py-3 px-4 text-left"},"Coordinator",-1)),a.value==="leave"?(c(),u("th",et," Operational Admin ")):T("",!0),s[12]||(s[12]=e("th",{class:"py-3 px-4 text-left"},"Recommend By",-1)),s[13]||(s[13]=e("th",{class:"py-3 px-4 text-left"},"Approved By",-1)),s[14]||(s[14]=e("th",{class:"py-3 px-4 text-center w-28"},"Actions",-1))])]),e("tbody",tt,[(c(!0),u(O,null,q(n.approvals,(t,b)=>{var g,w,k,C,L;return c(),u("tr",{key:(t==null?void 0:t.id)??`desktop-${n.department}-${b}`,class:"hover:bg-blue-50"},[e("td",st,d(b+1),1),e("td",ot,d((t==null?void 0:t.name)||"N/A"),1),e("td",rt,d(((g=t==null?void 0:t.in_charge_user)==null?void 0:g.name)||"N/A"),1),e("td",nt,d(((w=t==null?void 0:t.coordinator_user)==null?void 0:w.name)||"N/A"),1),a.value==="leave"?(c(),u("td",lt,d(((k=t==null?void 0:t.operational_admin_user)==null?void 0:k.name)||"N/A"),1)):T("",!0),e("td",dt,d(((C=t==null?void 0:t.recommend_by_user)==null?void 0:C.name)||"N/A"),1),e("td",at,d(((L=t==null?void 0:t.approved_by_user)==null?void 0:L.name)||"N/A"),1),e("td",it,[e("div",ut,[e("button",{onClick:z=>B(t),class:"px-3 py-2 rounded-lg border border-blue-200 text-blue-700 hover:bg-blue-50",title:"Edit"}," âœï¸ ",8,ct),e("button",{onClick:z=>i(t),class:"px-3 py-2 rounded-lg border border-red-200 text-red-700 hover:bg-red-50",title:"Delete"},s[15]||(s[15]=[e("i",{class:"fas fa-trash"},null,-1)]),8,pt)])])])}),128))])])])])])]))),128))])):(c(),u("div",_t,[s[16]||(s[16]=e("div",{class:"text-3xl"},"ðŸ“­",-1)),s[17]||(s[17]=e("div",{class:"mt-2 font-semibold text-gray-900"},"No leave approvals found",-1)),e("div",mt,d(_.value?"Try adjusting your search terms.":"Add a leave approval using the + button."),1)]))]),M(fe,{show:N.value,leaveApproval:m.value,approvalType:a.value,onClose:o,onSave:E},null,8,["show","leaveApproval","approvalType"]),M(le,{show:j.value,title:`Delete ${a.value} Approval`,message:`Are you sure you want to delete ${(r=m.value)==null?void 0:r.name}?`,onClose:y,onConfirm:x},null,8,["show","title","message"])])}}};export{kt as default};
