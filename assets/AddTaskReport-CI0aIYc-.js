import{b as U,d as Y,r as i,u as $,e as q,m as M,x as H,A as z,c as n,o as u,a as s,t as v,k as b,j as d,w as G,h as y,q as h,y as J,F as w,n as V,v as C,i as K}from"./index-CjQ6e_c5.js";import{R as F}from"./RequiredIcon-BK9hTXfO.js";import{u as O}from"./useTaskReportStore-BP6yB9tl.js";import{u as P}from"./useTaskStore-C-o0n4Jt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"mt-6"},W={class:"max-w-xl w-full mx-auto bg-white border p-4 rounded-md shadow"},X={class:"col-span-full text-red-800 font-semibold"},Z={key:0,class:"w-full flex items-center justify-center h-40 text-red-500 text-xl text-center"},tt={key:0,class:"col-span-full"},st={class:"font-semibold"},et={key:1,class:"col-span-full"},ot={class:"block text-gray-600 text-sm mb-1 font-medium"},at=["value"],lt={class:"col-span-full"},rt={class:"col-span-2"},nt={for:"report_date",class:"block text-gray-600 text-sm mb-1 font-medium"},ut={class:"flex justify-between col-span-full"},kt={__name:"AddTaskReport",setup(dt){const L=U(),R=O(),l=P(),S=Y(),_=L.params.id,m=i(""),T=i(0),f=i(E()),A=i(0),N=i(0),c=i(""),g=i(""),j=$();q(async()=>{await l.fetchTask(_),l.task.children_task_count==0&&(g.value=l.task.status)});function D(e,t=[]){const r=[];for(const o of e){const k=[...t,o.title];o.children_tasks.length===0?o.users.some(a=>{var p;return a.id==((p=S.user)==null?void 0:p.id)})&&r.push({id:o.id,title:o.title,status:o.status,task_parents:t,user_ids:o.users.map(a=>a.id)}):r.push(...D(o.children_tasks,k))}return r}const x=M(()=>l.task.children_task_count>0?D(l.tasks):[]),B=async()=>{var r;const e=T.value*60+A.value,t={c_length:l.task.children_task_count,task_id:l.task.children_task_count>0?c.value:(r=l.task)==null?void 0:r.id,title:m.value,report_date:f.value,progress:N.value,status:g.value,duration:e};console.log({payload:t});try{const o=await R.createTaskReport(t);console.log("Submitted:",o.data),m.value="",f.value="",T.value=0,A.value=0,j.push({name:"TaskReports",params:{id:_}})}catch(o){console.error("Error submitting report:",o)}};function E(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}H(()=>c.value,function(){const e=x.value.find(t=>t.id==c.value);console.log({selectedTask:e}),e&&(g.value=e.status)});const I=M(()=>{var e;return l.task.children_task_count>0&&x.value.length>0||l.task.children_task_count===0&&(((e=l.task)==null?void 0:e.users)||[]).some(t=>{var r;return t.id==((r=S.user)==null?void 0:r.id)})});return(e,t)=>{var o,k;const r=z("RouterLink");return u(),n("div",Q,[s("div",W,[s("div",X,v((o=b(R))==null?void 0:o.error),1),I.value?(u(),n("form",{key:1,onSubmit:G(B,["prevent"]),class:"grid gap-x-4 gap-y-6 grid-cols-4"},[t[12]||(t[12]=s("h2",{class:"text-2xl font-bold col-span-full border-b pb-1"},"Add Report",-1)),b(l).task.children_task_count===0?(u(),n("div",tt,[t[4]||(t[4]=d(" Add Report on ")),s("span",st,v((k=b(l).task)==null?void 0:k.title),1),t[5]||(t[5]=s("hr",{class:"mt-1"},null,-1))])):(u(),n("div",et,[s("label",ot,[t[6]||(t[6]=d(" Task ")),h(F)]),y(s("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a)},[t[7]||(t[7]=s("option",{value:""},"--select---",-1)),(u(!0),n(w,null,V(x.value,a=>(u(),n("option",{key:a.id,class:"w-full",value:a.id},[d(v(a.title)+" ",1),(u(!0),n(w,null,V(a.task_parents,p=>(u(),n(w,{key:p},[d(" â†µ "+v(p),1)],64))),128))],8,at))),128))],512),[[J,c.value]])])),s("div",lt,[t[8]||(t[8]=s("label",{for:"title",class:"block text-gray-600 text-sm mb-1 font-medium"},[d("Report "),s("span",{class:"text-gray-400"},"(optional)")],-1)),y(s("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=a=>m.value=a),type:"text",class:"border rounded p-2 w-full",placeholder:"Enter report title"},null,512),[[C,m.value]])]),s("div",rt,[s("label",nt,[t[9]||(t[9]=d(" Report Date ")),h(F)]),y(s("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>f.value=a),id:"report_date",type:"date",class:"border rounded p-2 w-full"},null,512),[[C,f.value]])]),t[13]||(t[13]=s("hr",{class:"col-span-full border-dashed"},null,-1)),s("div",ut,[t[11]||(t[11]=s("button",{type:"submit",class:"btn-2"},"Submit",-1)),h(r,{type:"submit",class:"btn-3",to:{name:"TaskReports",params:{id:b(_)}}},{default:K(()=>t[10]||(t[10]=[d("Cancel")])),_:1,__:[10]},8,["to"])])],32)):(u(),n("div",Z,t[3]||(t[3]=[d(" You Are Not Assigned to this task. "),s("br",null,null,-1),d("You cannot add a report. ")])))])])}}};export{kt as default};
