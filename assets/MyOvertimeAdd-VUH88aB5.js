import{u as $,f as W,g as j,r as k,h as E,q as P,c as u,o as i,a as t,d as N,w as Q,j as q,k as g,v as O,H as I,t as c,F as D,e as U,m as p,b as X,i as Y}from"./index-CV3YfIay.js";import{L as z}from"./LoaderView-BrOYjnB9.js";import{_ as G}from"./TimePickerAsFloatHour-BVw63sZ2.js";import{_ as J}from"./TodoItemCard-C1bz59g5.js";import{b as K}from"./datetime-BEfC2TVK.js";import{u as Z}from"./attendance-CoblJrwj.js";import{u as ee}from"./department-D1Ml3iWp.js";import{u as te}from"./overtime-CG_48epD.js";import{u as se}from"./useTodoDateStore-BkDL13CL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DepartmentChip-CIvUrmqP.js";import"./UserChip-C8rOJaZI.js";import"./url-CePbr-gY.js";const oe={class:"max-w-xl mx-auto p-4 space-y-4"},ae={key:0,class:"text-center"},ne={class:"grid grid-cols-2 gap-2 md:gap-4"},re=["max"],le={class:"input-1 w-full text-center px-1 bg-gray-300"},ie={class:"input-1 w-full text-center px-1 bg-gray-300"},ue={class:"input-1 w-full text-center px-1 bg-gray-300"},de={class:"flex items-center"},me={class:"col-span-full"},ce=["label"],pe=["value"],fe={key:0},ve={class:"text-gray-700 mb-2 border-b"},_e={class:"font-semibold text-sky-800 ml-2"},ge={class:"ml-1"},ye={class:"max-h-[150px] overflow-y-auto"},he={key:1,class:"text-red-500 text-sm"},be=1,xe=24,Ae={__name:"MyOvertimeAdd",setup(we){const S=$(),f=W(),M=ee(),y=te(),T=Z(),h=j(),b=se(),x=k(!1),v=k({}),n=k({date:"",duty_type:"",request_overtime_hours:"",assigned_in_charge_user_id:"",work_details:""}),d=o=>typeof o=="string"?o.replace(/\+/g," ").trim():"",C=(o,e,a)=>Math.max(e,Math.min(a,o)),A=o=>{const e=d(o);if(!e)return null;const a=e.match(/(\d+)\s*h/i),s=e.match(/(\d+)\s*m/i);if(a||s){const r=a?parseInt(a[1],10):0,m=s?parseInt(s[1],10):0;return r+m/60}if(/^\d{1,2}:\d{1,2}$/.test(e)){const[r,m]=e.split(":").map(_=>parseInt(_,10));if(Number.isFinite(r)&&Number.isFinite(m))return r+m/60}const l=Number(e);return Number.isFinite(l)?l:null},V=o=>{const e=d(o);if(!e)return null;const a=e.split(/\s+/),l=(a.length>=2?`${a[a.length-2]} ${a[a.length-1]}`:e).match(/^(\d{1,2}):(\d{2})\s*([AP]M)$/i);if(!l)return null;let r=parseInt(l[1],10);const m=parseInt(l[2],10),_=l[3].toUpperCase();return _==="PM"&&r!==12&&(r+=12),_==="AM"&&r===12&&(r=0),r*60+m},B=(o,e)=>{const a=V(o),s=V(e);if(a==null||s==null)return null;let l=s-a;return l<0&&(l+=24*60),l/60},H=o=>{if(!o)return"";const e=new Date(o);if(isNaN(e.getTime()))return"";const a=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0");return`${a}-${s}`},w=async()=>{var a,s,l;if(!n.value.date)return;const o=(a=h.user)==null?void 0:a.id;if(!o)return;const e=H(n.value.date);x.value=!0;try{await T.getMonthlyAttendanceByShift(o,e),v.value=await T.getUserDailyLogsByDate(o,n.value.date)}finally{x.value=!1}try{await b.fetchMyTodoDates({"start-date":n.value.date,"end-date":n.value.date})}catch(r){console.error((l=(s=r.response)==null?void 0:s.date)==null?void 0:l.message)}},F=async()=>{const o=f.query||{},e=d(o.date),a=d(o.start_time),s=d(o.end_time),l=d(o.request_overtime_hours);e&&(n.value.date=e,await w());let r=A(l);r==null&&(a||s)&&(r=B(a,s)),Number.isFinite(r)&&(n.value.request_overtime_hours=C(Math.round(r*100)/100,be,xe))},L=()=>{S.go(-1)},R=async()=>{await y.createOvertime(n.value),S.push({name:"MyOvertimeList"})};return E(async()=>{var o,e;(o=h.user)!=null&&o.id||await h.fetchUser(),await F(),!n.value.date&&((e=f.query)!=null&&e.date)&&(n.value.date=d(f.query.date),await w()),await M.fetchDepartments("all")}),P(()=>f.query,async()=>{await F()},{deep:!0}),(o,e)=>{var a;return i(),u("div",oe,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:L},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Overtime Request Form",-1))]),x.value?(i(),u("div",ae,[N(z)])):(i(),u("form",{key:1,onSubmit:Q(R,["prevent"]),class:"space-y-4 card-bg md:p-8 p-4 text-sm md:text-base"},[t("div",ne,[t("div",null,[e[7]||(e[7]=t("label",{for:"date",class:"block text-sm font-medium"},"Date",-1)),g(t("input",{onChange:w,type:"date",id:"date","onUpdate:modelValue":e[0]||(e[0]=s=>n.value.date=s),class:"input-1 w-full",required:"",max:new Date(Date.now()-864e5).toISOString().split("T")[0]},null,40,re),[[O,n.value.date]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"duty_type",class:"block text-sm font-medium"},"Duty Type",-1)),g(t("select",{id:"duty_type","onUpdate:modelValue":e[1]||(e[1]=s=>n.value.duty_type=s),class:"input-1 w-full",required:""},e[8]||(e[8]=[t("option",{value:"",selected:"",disabled:""},"--Duty Type--",-1),t("option",{value:"WL"},"WL",-1),t("option",{value:"HD"},"HD",-1),t("option",{value:"OVT"},"OVT",-1)]),512),[[I,n.value.duty_type]])]),t("div",null,[e[10]||(e[10]=t("span",{class:"block text-sm font-medium"},"Check In",-1)),t("div",le,c(v.value.entry_time||"--:--"),1)]),t("div",null,[e[11]||(e[11]=t("span",{class:"block text-sm font-medium"},"Check Out",-1)),t("div",ie,c(v.value.exit_time||"--:--"),1)]),t("div",null,[e[12]||(e[12]=t("span",{class:"block text-sm font-medium"},"Working Hour",-1)),t("div",ue,c(v.value.working_hours||"-"),1)]),t("div",null,[e[13]||(e[13]=t("label",{for:"request_overtime_hours",class:"block text-sm font-medium"}," Request Overtime ",-1)),t("div",de,[N(G,{modelValue:n.value.request_overtime_hours,"onUpdate:modelValue":e[2]||(e[2]=s=>n.value.request_overtime_hours=s),"minute-interval":5,required:!0,"hour-min":1,"hour-max":24},null,8,["modelValue"])])]),t("div",me,[e[15]||(e[15]=t("label",{for:"assigned_in_charge_user_id",class:"block text-sm font-medium"}," In-Charge ",-1)),g(t("select",{id:"assigned_in_charge_user_id","onUpdate:modelValue":e[3]||(e[3]=s=>n.value.assigned_in_charge_user_id=s),class:"input-1 w-full",required:""},[e[14]||(e[14]=t("option",{value:"",selected:"",disabled:""},"--In-Charge--",-1)),(i(!0),u(D,null,U(p(M).departments,s=>(i(),u(D,{key:s.id},[s.in_charge?(i(),u("optgroup",{key:0,label:s.name},[t("option",{value:s.in_charge.id},c(s.in_charge.name),9,pe)],8,ce)):q("",!0)],64))),128))],512),[[I,n.value.assigned_in_charge_user_id]])])]),t("div",null,[e[16]||(e[16]=t("label",{for:"assigned_in_charge_user_id",class:"block text-sm font-medium"}," Details (Reason / Work description) ",-1)),g(t("textarea",{rows:"6","onUpdate:modelValue":e[4]||(e[4]=s=>n.value.work_details=s),class:"input-1 w-full",required:""},null,512),[[O,n.value.work_details]])]),(a=p(b).todo_dates)!=null&&a.length&&n.value.date?(i(),u("div",fe,[t("h4",ve,[e[18]||(e[18]=X(" Todos on ")),t("span",_e,[e[17]||(e[17]=t("i",{class:"fas fa-calendar-day"},null,-1)),t("span",ge,c(p(K)(n.value.date,{weekDay:"long"})),1)])]),t("div",ye,[(i(!0),u(D,null,U(p(b).todo_dates,s=>(i(),Y(J,{key:s.id,"todo-date":s,"hide-department":"","hide-user":"","hide-btns":""},null,8,["todo-date"]))),128))])])):q("",!0),e[19]||(e[19]=t("hr",null,null,-1)),p(y).error?(i(),u("div",he,c(p(y).error),1)):q("",!0),e[20]||(e[20]=t("div",{class:"flex justify-center"},[t("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{Ae as default};
