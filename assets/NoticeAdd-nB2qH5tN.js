import{i as L,s as x,z as M,r as _,p as V,b as R,q as S,c as a,a as t,w as A,d as r,A as D,F as B,x as j,h as n,v as c,e as v,l as m,m as P,n as z,o as i,t as G,k as I,g as $}from"./index-Di9HX-FD.js";import{_ as H,s as k}from"./vue-multiselect.esm-C5s-6Qwq.js";import{u as J}from"./company-D-nlre5i.js";import{u as K}from"./department-CZE23vGv.js";import{u as O}from"./notice-B2dYXvpD.js";const Q={class:"my-container space-y-2"},W={class:"card-bg md:p-8 p-4 mx-4"},X={class:"grid gap-4"},Y={class:"border p-4 rounded-md bg-gray-100"},Z={class:"grid md:grid-cols-2 gap-4"},h=["value"],ee={key:0},te={key:1},le={class:"col-span-2 flex justify-between gap-8"},se={class:"w-full"},oe={key:0,class:"w-full"},de={class:"col-span-full"},ae={class:"col-span-full"},ie={class:"flex justify-center gap-4"},ye={__name:"NoticeAdd",setup(re){const w=L(),N=$(),f=O(),g=J(),u=K(),{companies:U}=x(g),{employees:C}=x(u),s=M({title:"",type:1,description:"",published_at:"",expired_at:"",company_id:"",department_id:"",department_ids:[],file:""}),p=_([]),T=V(()=>p.value.map(o=>o.id)),y=_([]),q=V(()=>y.value.map(o=>o.id));R(async()=>{await g.fetchCompanies()}),S(()=>s.company_id,async o=>{o&&(await u.fetchDepartments(o),s.department_id="")}),S(p,o=>{const e=o.map(d=>d.id);u.fetchDepartmentEmployee(e)});const E=async o=>{var d;const e=o.target.files[0];if(e){const l=new FormData;l.append("file",e),console.log({file:e});const b=await f.fetchFileUpload(l);s.file=(d=b==null?void 0:b.data)==null?void 0:d.url}},F=async()=>{var o,e;try{const d={title:s.title,type:s.type,description:s.description,published_at:s.published_at,expired_at:s.expired_at,company_id:s.company_id,department_id:s.department_id,department_ids:T.value,employee_ids:q.value,file:s.file};await f.createNotice(d),w.success("Notice created successfully"),await f.fetchNotices(),N.replace("/hrd/notice")}catch(d){const l=((e=(o=d.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to save user";w.error(l),console.error(l)}};return(o,e)=>{const d=z("RouterLink");return i(),a("div",Q,[t("div",W,[e[23]||(e[23]=t("h2",{class:"title-lg text-center"},"Add Notice",-1)),t("form",{onSubmit:A(F,["prevent"]),class:"space-y-4"},[t("div",X,[t("div",Y,[e[19]||(e[19]=t("p",{class:"title-md"},"Notice Info",-1)),e[20]||(e[20]=t("hr",{class:"my-2"},null,-1)),t("div",Z,[t("div",null,[e[9]||(e[9]=t("label",null,"Company *",-1)),r(t("select",{id:"company_id","onUpdate:modelValue":e[0]||(e[0]=l=>s.company_id=l),class:"w-full border rounded px-3 py-2",required:""},[e[8]||(e[8]=t("option",{value:"",disabled:""},"Select a company",-1)),(i(!0),a(B,null,j(n(U),l=>(i(),a("option",{key:l==null?void 0:l.id,value:l==null?void 0:l.id},G(l==null?void 0:l.name),9,h))),128))],512),[[D,s.company_id]])]),t("div",null,[e[11]||(e[11]=t("label",null,"Type*",-1)),r(t("select",{id:"type","onUpdate:modelValue":e[1]||(e[1]=l=>s.type=l),class:"w-full border rounded px-3 py-2",required:""},e[10]||(e[10]=[t("option",{value:"1"},"General",-1),t("option",{value:"2"},"Policy",-1)]),512),[[D,s.type]])]),s.type!=="2"?(i(),a("div",ee,[e[12]||(e[12]=t("label",null,"Publish Date*",-1)),r(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>s.published_at=l),type:"date",class:"w-full p-2 border rounded",required:""},null,512),[[c,s.published_at]])])):v("",!0),s.type!=="2"?(i(),a("div",te,[e[13]||(e[13]=t("label",null,"Expired Date*",-1)),r(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>s.expired_at=l),type:"date",class:"w-full p-2 border rounded",required:""},null,512),[[c,s.expired_at]])])):v("",!0),t("div",le,[t("div",se,[e[14]||(e[14]=t("label",null,"Departments",-1)),m(n(k),{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),options:n(u).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",class:"w-full p-2 border rounded"},null,8,["modelValue","options"])]),s.type!=="2"?(i(),a("div",oe,[e[15]||(e[15]=t("label",null,"Employees",-1)),m(n(k),{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=l=>y.value=l),options:n(C),multiple:!0,searchable:!0,placeholder:"Select Employee","track-by":"id",label:"name",class:"w-full p-2 border rounded"},null,8,["modelValue","options"])])):v("",!0)]),t("div",de,[e[16]||(e[16]=t("label",null,"Title*",-1)),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.title=l),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[c,s.title]])]),t("div",null,[e[17]||(e[17]=t("label",null,"File",-1)),t("input",{onChange:E,type:"file",class:"w-full p-2 border rounded"},null,32)]),t("div",ae,[e[18]||(e[18]=t("label",null,"Description",-1)),m(H,{modelValue:s.description,"onUpdate:modelValue":e[7]||(e[7]=l=>s.description=l),cols:"30",rows:"10",class:"w-full"},null,8,["modelValue"])])])])]),t("div",ie,[m(d,{to:{name:"UserList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:P(()=>e[21]||(e[21]=[I(" Cancel ")])),_:1}),e[22]||(e[22]=t("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32)])])}}};export{ye as default};
