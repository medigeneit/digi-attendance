import{_ as se}from"./CommentModal-Bn7XOLF_.js";import{_ as te}from"./DraggableList.vue_vue_type_script_setup_true_lang-CDWSGZq2.js";import{L as ae}from"./LoaderView-C8rHgrc9.js";import{O as S}from"./OverlyModal-B23PtDfb.js";import{_ as oe}from"./TaskAddForm-B3zEYw1d.js";import{_ as re}from"./TaskEditForm-C4I2vUsU.js";import{_ as ie}from"./TaskHeader-D80n_qFs.js";import{_ as W}from"./TaskTreeViewWithSubTable-DOf6j3-g.js";import{a as ne}from"./TaskUserAssignForm-Belt9dgK.js";import{_ as le}from"./UserChip-CewQ4lys.js";import{m as J}from"./task-tree-wODDhwOu.js";import{f as K,x as A,c as p,o,a as f,F as B,e as E,j as T,d as I,i as _,g as de,u as ue,r as C,G as z,h as me,q as ke,S as pe,l as L,m,t as G}from"./index-QwKgx1Ce.js";import{u as ce}from"./task-priority-Cd00U6lr.js";import{u as ye}from"./useTaskStore-Db595xcN.js";import"./useCommentStore-DTfCmtvs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-vhxgpp3A.js";import"./company-YtbXbHEY.js";import"./requirement-Bz-aKCHu.js";import"./CompanyDepartmentSelectInput-oq6OhQpL.js";import"./SelectDropdown-CTaY800K.js";import"./SectionLoading-DubAHirX.js";import"./TextEditor-KMoEosbt.js";import"./TextWithHr-DwA_fMIh.js";import"./TaskUrgencyInput-DpYld8Py.js";import"./datetime-BEfC2TVK.js";import"./tags-RPnoKFbg.js";import"./MultiselectDropdown-DRBS93G7.js";import"./task-xzwmdYw-.js";import"./url-CePbr-gY.js";import"./EmployeeDropdownInput-DEuFRH5x.js";import"./SearchInput-DKF3Tcsg.js";import"./TaskUrgentBadge-YPDdPLHm.js";import"./TaskTitle-P0el3eG0.js";import"./TaskAssignedUsers-CTbDv9bt.js";import"./TaskIsClosedBadge-kO2I6TxT.js";import"./TaskSupervisorAndEmployee-CzKm-ou5.js";import"./user-gWgq3i1q.js";const fe={class:"w-full"},ve={class:"w-full table-fixed bg-white rounded-md"},ge={class:"border rounded-md align-top bg-blue-50"},Ce={key:0,class:"sticky top-16 py-2 px-2 z-40 bg-blue-100/70"},Te={class:"space-y-4 mt-4"},Ie={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup($,{emit:d}){const i=$,a=K(),v=d,c=A(()=>i.tasks.reduce((r,s)=>(r.push(...s.users.filter(n=>!r.find(k=>k.id==n.id&&n.id))),r),[]).filter(r=>i.selectedUserId?r.id==i.selectedUserId:!0)),q=r=>{const n=i.tasks.filter(k=>k.users.some(u=>u.id===r));return J(n,{...a.query,"user-ids":r})},x=A(()=>c.value.map(r=>{const s=q(r.id);return{...r,tasks:s}}));return(r,s)=>(o(),p("div",fe,[f("table",ve,[f("tbody",null,[(o(!0),p(B,null,E(x.value,n=>{var k;return o(),p("tr",{key:n.id},[f("td",ge,[f("div",null,[((k=n.tasks)==null?void 0:k.length)>0?(o(),p("div",Ce,[I(le,{user:n,class:""},null,8,["user"])])):T("",!0),f("div",Te,[(o(!0),p(B,null,E(n.tasks,(u,M)=>(o(),_(W,{key:u.id,task:u,class:"!border-0",index:M,isMyTask:$.isMyTask,onCommentButtonClick:s[0]||(s[0]=y=>v("commentButtonClick",r.item.id)),onEditClick:s[1]||(s[1]=y=>v("editClick",y)),onAddClick:s[2]||(s[2]=y=>v("addClick",y)),onEmployeeAssignClick:s[3]||(s[3]=y=>v("employeeAssignClick",y))},null,8,["task","index","isMyTask"]))),128))])])])])}),128))])])]))}},_e={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},be={class:"mb-4"},we={class:"relative min-h-[26vh]"},qe={key:0,class:"text-center py-4 text-red-500"},xe={key:1},Ae={class:"flex items-stretched"},Me={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},Le=1,cs={__name:"TaskList",setup($){const d=ye(),i=de(),a=K(),v=ue(),c=C(""),q=C(!1),x=C(null),r=A(()=>{var t;return((t=i==null?void 0:i.user)==null?void 0:t.role)==="employee"||!(i!=null&&i.isAdminMood)?!0:!!a.query["user-ids"]}),s=C(null),n=C(!1),k=z({parentId:0,requirementId:0}),u=z({taskId:0,isOpen:!1}),M=C(null),y=C([]),{handleItemsPriorityUpdate:Q,saveTaskPriority:X,listHasRearranged:F}=ce(()=>d.taskListTree,0);me(async()=>{console.log("Task List Mounted"),c.value="loading",a.query.status||v.push({query:{...a.query,status:"not-completed"}}),await w()});let b;async function w(){let t;b=new AbortController,console.log({taskAbortController:b}),a.name==="MyTaskList"?t=await d.fetchMyTasks({...a.query,page:1},{signal:b.signal}):t=await d.fetchTasks({...a.query,page:1},{signal:b.signal}),c.value="",y.value=t.query_log||[]}const h=t=>{n.value=!0,k.parentId=t},O=t=>{u.taskId=t,u.isOpen=!0},P=t=>{x.value=t,q.value=!0},Y=()=>{q.value=!1,x.value=null};async function V(){s.value=null,n.value=!1,k.parentId=0,c.value="loading",await w()}async function Z(){n.value=!1,k.parentId=0,await w()}async function ee(){c.value="loading",await X()&&await w()}ke(()=>({...a.query}),async()=>{try{d.resetTaskList(),c.value="loading",await w()}catch{console.warn("...")}});const D=A({get(){return{...a.query}},set(t){localStorage.removeItem("sub_task_opened_list"),v.push({query:{...t}})}}),N=A(()=>{var e;const t={...a.query};return a.name=="MyTaskList"&&(t["user-ids"]=(e=i==null?void 0:i.user)==null?void 0:e.id),Array.isArray(d.tasks)?J(d.tasks,t):[]});return pe(()=>{d.tasks.value=null,b&&b.abort()}),(t,e)=>{var H,R,j;return o(),p("div",_e,[s.value?(o(),_(S,{key:0},{default:L(()=>[I(re,{taskId:s.value,onClose:e[0]||(e[0]=l=>s.value=null),onUpdated:V},null,8,["taskId"])]),_:1})):T("",!0),n.value?(o(),_(S,{key:1},{default:L(()=>[I(oe,{parentTaskId:k.parentId,requirementId:k.requirementId,onClose:Z,onTaskCreated:V},null,8,["parentTaskId","requirementId"])]),_:1})):T("",!0),u.isOpen?(o(),_(S,{key:2,class:"*:max-w-4xl"},{default:L(()=>[I(ne,{taskId:u.taskId,onCancelClick:e[1]||(e[1]=()=>{u.isOpen=!1,u.taskId=0}),onSuccess:e[2]||(e[2]=()=>{u.isOpen=!1,u.taskId=0,c.value="loading",w()})},null,8,["taskId"])]),_:1})):T("",!0),I(ie,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=l=>D.value=l),onClickAddTask:h,onClickPrioritySave:ee,onClickPriorityDiscard:e[4]||(e[4]=()=>m(F)?M.value.resetItems:null),"list-has-rearranged":m(F),isMyTask:m(a).name==="MyTaskList"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((R=(H=m(a))==null?void 0:H.query)==null?void 0:R["query-log"])=="true"?(o(!0),p(B,{key:3},E(y.value,(l,U)=>(o(),p("div",{key:U,class:"text-xs text-gray-500"},[f("div",be,G(l.raw_query),1)]))),128)):T("",!0),f("div",we,[m(d).error?(o(),p("div",qe,G(m(d).error),1)):m(d).tasks.length>0?(o(),p("div",xe,[((j=m(a).query)==null?void 0:j.view)=="userwise"?(o(),_(Ie,{key:0,tasks:N.value,selectedUserId:m(a).query["user-ids"],isMyTask:m(a).name==="MyTaskList",onCommentButtonClick:e[5]||(e[5]=l=>P(l,t.task.id)),onEditClick:e[6]||(e[6]=l=>s.value=l),onAddClick:e[7]||(e[7]=l=>h(l)),onEmployeeAssignClick:e[8]||(e[8]=l=>O(l))},null,8,["tasks","selectedUserId","isMyTask"])):(o(),_(te,{key:1,items:N.value,handle:"handle",onItemsUpdate:m(Q),class:"space-y-6",ref_key:"draggableTaskList",ref:M},{item:L(({item:l,index:U})=>[f("div",Ae,[I(W,{isMyTask:m(a).name==="MyTaskList",task:l,index:U,showDraggableHandle:!r.value,onCommentButtonClick:e[9]||(e[9]=g=>P(g,t.task.id)),onEditClick:e[10]||(e[10]=g=>s.value=g),onAddClick:e[11]||(e[11]=g=>h(g)),onEmployeeAssignClick:e[12]||(e[12]=g=>O(g)),class:"!border-0 shadow hover:shadow-md"},null,8,["isMyTask","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):c.value!=="loading"?(o(),p("div",Me," No tasks found. ")):T("",!0),c.value==="loading"?(o(),_(ae,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):T("",!0)]),I(se,{show:q.value,"commentable-id":x.value,"commentable-type":"task","user-id":Le,"on-close":Y,onSubmitted:m(d).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{cs as default};
