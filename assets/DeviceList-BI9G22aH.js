import{M as ee,r as f,D as S,c as r,o,a as e,g as _,p as j,t as g,s as se,x as te,w as le,h,v as F,C as A,a1 as ne,e as ae,q as U,f as ie,k as P,F as E,n as L,K as oe}from"./index-C0UlG9qU.js";import{u as B,a as re}from"./zk-user-vGn6bsQi.js";import{_ as ue,a as z}from"./HeaderWithButtons-D92S1-kr.js";import{L as de}from"./LoaderView-CQ5bMfYU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ce=ee("zkFinger",()=>{const w=f(!1),m=f(null),k=f(null),y=f(null);async function d(c,l){var i;try{const{data:p}=await S.post(`/users/${encodeURIComponent(c)}/fingers/${l}/push`);return p}catch(p){throw((i=p.response)==null?void 0:i.data)||p}}async function a(c,{limit:l=null,offset:i=null}={}){var p;try{const v=new URLSearchParams;l!==null&&v.append("limit",String(l)),i!==null&&v.append("offset",String(i));const $=v.toString().length>0?`/devices/${c}/pull-fingerprints?`+v.toString():`/devices/${c}/pull-fingerprints`,{data:D}=await S.post($);return y.value=D,D}catch(v){throw((p=v.response)==null?void 0:p.data)||v}}async function C(c,{diff:l=!0}={}){var i;try{const p=l?"?diff=true":"?diff=false",{data:v}=await S.post(`/devices/${c}/push-fingerprints${p}`);return v}catch(p){throw((i=p.response)==null?void 0:i.data)||p}}async function b(c,l){var i;try{const{data:p}=await S.post(`/devices/${c}/users/${encodeURIComponent(l)}/pull-fingers`);return y.value=p,p}catch(p){throw((i=p.response)==null?void 0:i.data)||p}}async function u(c){var l,i,p;w.value=!0,m.value=null;try{const{data:v}=await S.get(`/users/${encodeURIComponent(c)}/verify`);return k.value=v,v}catch(v){throw m.value=((i=(l=v.response)==null?void 0:l.data)==null?void 0:i.message)||v.message,((p=v.response)==null?void 0:p.data)||v}finally{w.value=!1}}return{loading:w,error:m,verifyResult:k,lastPullSummary:y,pushFinger:d,pullFingerprintsFromDevice:a,pushFingerprintsToDevice:C,pullUserFingersFromDevice:b,verifyUser:u}}),pe={class:"flex justify-center items-center gap-2"},ve={__name:"CheckDeviceConnection",props:{device:Object},setup(w){const m=B(),k=w,y=f(!1),d=f(""),a=f(!1),C=async()=>{a.value=!0;const b=await m.checkDeviceConnection(k.device.id);y.value=b,d.value=b?"success":"Failed",a.value=!1,setTimeout(()=>{d.value=!1},1e3*60)};return(b,u)=>(o(),r("div",pe,[e("button",{onClick:C,class:"text-blue-600 hover:text-blue-800"},[e("i",{class:j(["fas fa-sync-alt",{"animate-spin":a.value}])},null,2)]),d.value?(o(),r("span",{key:0,class:j(y.value?"text-green-600":"text-red-600")},g(d.value),3)):_("",!0)]))}},fe={key:0,class:"modal-bg"},me={class:"modal-card"},be={class:"text-lg font-semibold mb-4"},ge={class:"mb-4"},ye={class:"mb-4"},he={class:"mb-4"},xe={class:"mb-4"},_e={class:"mb-4"},we={class:"mb-4"},ke={class:"flex justify-end"},Ce={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},$e={__name:"DeviceModal",props:{show:{type:Boolean,required:!0},device:{type:Object,default:null}},emits:["close","save"],setup(w,{emit:m}){const k=w,y=m,d=f(!1),a=se({id:null,name:"",ip_address:"",port:"",serial_number:"",firmware:"",status:"active"}),C=()=>{d.value=!1,a.id=null,a.name="",a.ip_address="",a.port="",a.serial_number="",a.firmware="",a.status="active"};te(()=>k.device,c=>{c&&typeof c=="object"&&Object.keys(c).length>0?(d.value=!0,a.id=c.id||null,a.name=c.name||"",a.ip_address=c.ip_address||"",a.port=c.port||"",a.serial_number=c.serial_number||"",a.firmware=c.firmware||"",a.status=c.status||"active"):C()},{immediate:!0,deep:!0});const b=()=>{y("save",{...a}),u()},u=()=>{y("close")};return(c,l)=>w.show?(o(),r("div",fe,[e("div",me,[e("h2",be,g(d.value?"Edit Device":"Add Device"),1),e("form",{onSubmit:le(b,["prevent"])},[e("div",ge,[l[6]||(l[6]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),h(e("input",{id:"name","onUpdate:modelValue":l[0]||(l[0]=i=>a.name=i),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter device name",required:""},null,512),[[F,a.name]])]),e("div",ye,[l[7]||(l[7]=e("label",{for:"ip_address",class:"block text-sm font-medium mb-2"},"IP Address",-1)),h(e("input",{id:"ip_address","onUpdate:modelValue":l[1]||(l[1]=i=>a.ip_address=i),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter IP address",required:""},null,512),[[F,a.ip_address]])]),e("div",he,[l[8]||(l[8]=e("label",{for:"port",class:"block text-sm font-medium mb-2"},"Port",-1)),h(e("input",{id:"port","onUpdate:modelValue":l[2]||(l[2]=i=>a.port=i),type:"number",class:"w-full border rounded px-3 py-2",placeholder:"Enter port",required:""},null,512),[[F,a.port]])]),e("div",xe,[l[9]||(l[9]=e("label",{for:"serial_number",class:"block text-sm font-medium mb-2"},"Serial Number",-1)),h(e("input",{id:"serial_number","onUpdate:modelValue":l[3]||(l[3]=i=>a.serial_number=i),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter serial number (optional)"},null,512),[[F,a.serial_number]])]),e("div",_e,[l[10]||(l[10]=e("label",{for:"firmware",class:"block text-sm font-medium mb-2"},"Firmware",-1)),h(e("input",{id:"firmware","onUpdate:modelValue":l[4]||(l[4]=i=>a.firmware=i),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter firmware version (optional)"},null,512),[[F,a.firmware]])]),e("div",we,[l[12]||(l[12]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),h(e("select",{id:"status","onUpdate:modelValue":l[5]||(l[5]=i=>a.status=i),class:"w-full border rounded px-3 py-2",required:""},l[11]||(l[11]=[e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1),e("option",{value:"error"},"Error",-1)]),512),[[A,a.status]])]),e("div",ke,[e("button",{type:"button",onClick:u,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",Ce,g(d.value?"Update":"Create"),1)])],32)])])):_("",!0)}},De={class:"my-container space-y-2"},Fe={key:1},Pe={key:0,class:"grid gap-4 md:grid-cols-3"},Se={key:0,class:"absolute inset-0 bg-white/60 grid place-items-center rounded-xl z-10"},Ue={class:"flex items-start justify-between"},Ie={class:"text-base font-semibold"},Me={class:"text-xs text-gray-500"},Ve={class:"mt-2"},Ee={class:"mt-3 flex flex-wrap items-center gap-3"},Le=["disabled","onClick"],je={key:0,class:"fas fa-users"},Ae={key:1,class:"fas fa-circle-notch fa-spin"},Te=["disabled","onClick"],qe={key:0,class:"fas fa-fingerprint"},ze={key:1,class:"fas fa-circle-notch fa-spin"},Be=["disabled","onClick"],Ne={key:0,class:"fas fa-cloud-upload-alt"},Oe={key:1,class:"fas fa-circle-notch fa-spin"},Re=["disabled","onClick"],Ke={key:0,class:"fas fa-sync-alt"},We={key:1,class:"fas fa-circle-notch fa-spin"},Ze=["onClick"],Ge={key:1,class:"mt-2 text-[11px] text-gray-500"},He={key:1,class:"text-center text-red-500 py-8"},Je={key:2,class:"fixed inset-0 bg-black/40 grid place-items-center z-50"},Qe={class:"bg-white rounded-lg w-full max-w-md p-5 shadow relative"},Xe={key:0,class:"absolute inset-0 bg-white/60 grid place-items-center rounded-lg"},Ye={class:"space-y-3"},es=["value"],ss={class:"grid grid-cols-2 gap-3"},ts={class:"mt-4 flex justify-end gap-2"},ls=["disabled"],ns=["disabled"],as={key:0,class:"fas fa-circle-notch fa-spin mr-1"},is={key:3,class:"fixed inset-0 bg-black/40 grid place-items-center z-50"},os={class:"bg-white rounded-lg w-full max-w-md p-5 shadow relative"},rs={key:0,class:"absolute inset-0 bg-white/60 grid place-items-center rounded-lg"},us={class:"space-y-3"},ds=["value"],cs={class:"inline-flex items-center gap-2 text-sm"},ps={class:"mt-4 flex justify-end gap-2"},vs=["disabled"],fs=["disabled"],ms={key:0,class:"fas fa-circle-notch fa-spin mr-1"},_s={__name:"DeviceList",setup(w){const m=B(),k=re(),y=ce(),d=ne(),a=f(!1),C=f(!1),b=f(null),u=f({running:!1,deviceId:null,label:""}),c=f(!1),l=f(null),i=f(null),p=f(null),v=f(!1),$=f(null),D=f(!0),I=f(!1),M=f(null),N=()=>{b.value=null,a.value=!0},O=n=>{b.value=n,a.value=!0},R=()=>{a.value=!1},K=async n=>{try{n.id?(await m.updateDevice(n.id,n),d.success("Device updated successfully!")):(await m.createDevice(n),d.success("Device added successfully!")),await m.fetchDevices()}catch(s){d.error("Failed to save device!"),console.error("Error handling save:",s)}},T=()=>{C.value=!1},W=async()=>{if(!b.value||!b.value.id){d.error("Invalid device selected for deletion!");return}try{await m.deleteDevice(b.value.id),d.warning("Device deleted successfully!"),await m.fetchDevices()}catch(n){d.error("Failed to delete device!"),console.error("Error deleting device:",n)}finally{T()}};ae(async()=>{await m.fetchDevices()});async function Z(n){try{u.value={running:!0,deviceId:n.id,label:"pull-users"};const s=await k.pullUsersFromDevice(n.id);d.success(`Pulled ${s.users_pulled} / Updated ${s.users_updated} (Device: ${n.name})`)}catch(s){d.error((s==null?void 0:s.message)||"Pull users failed")}finally{u.value={running:!1,deviceId:null,label:""}}}function G(n){l.value=n.id,i.value=null,p.value=null,c.value=!0}function H(n){$.value=n.id,D.value=!0,v.value=!0}async function J(){if(l.value)try{u.value={running:!0,deviceId:l.value,label:"pull-fp"};const n=await y.pullFingerprintsFromDevice(l.value,{limit:i.value??null,offset:p.value??null});d.success(`Fingerprints pulled: ${n.fingerprints_pulled}`)}catch(n){d.error((n==null?void 0:n.message)||"Pull fingerprints failed")}finally{u.value={running:!1,deviceId:null,label:""},c.value=!1}}async function Q(){if(!$.value){d.warning("Device এবং ZK User ID দিন");return}try{u.value={running:!0,deviceId:$.value,label:"push-fp-to-device"};const n=await y.pushFingerprintsToDevice($.value,{diff:D.value});d.success("User fingerprints pushed to device successfully")}catch(n){d.error((n==null?void 0:n.message)||"Push to device failed")}finally{u.value={running:!1,deviceId:null,label:""},v.value=!1}}function X(n){M.value=n.id,I.value=!0}async function Y(){if(M.value)try{u.value={running:!0,deviceId:M.value,label:"catchup"};const n=await k.syncCatchupUsers(M.value,{diff:!0});d.success(`Synced: ${n.usersSynced}, Skipped: ${n.skipped}, Failed: ${n.failed}`)}catch(n){d.error((n==null?void 0:n.message)||"Catch-up failed")}finally{u.value={running:!1,deviceId:null,label:""},I.value=!1}}const x=(n,s=null)=>u.value.running&&u.value.deviceId===n.id&&(s?u.value.label===s:!0);return(n,s)=>{var q;return o(),r("div",De,[U(ue,{title:"Device List",onAdd:N}),P(m).loading?(o(),ie(de,{key:0})):(o(),r("div",Fe,[P(m).devices&&P(m).devices.length?(o(),r("div",Pe,[(o(!0),r(E,null,L(P(m).devices,t=>(o(),r("div",{key:t.id,class:"relative rounded-xl border p-4 shadow bg-white hover:shadow-md transition"},[x(t)?(o(),r("div",Se,s[8]||(s[8]=[e("i",{class:"fas fa-circle-notch fa-spin text-2xl"},null,-1)]))):_("",!0),e("div",Ue,[e("div",null,[e("div",Ie,g(t.name),1),e("div",Me,g(t.ip_address)+" : "+g(t.port),1)]),e("span",{class:j(["text-xs px-2 py-0.5 rounded",t.status==="active"?"bg-green-100 text-green-700":t.status==="inactive"?"bg-gray-100 text-gray-600":"bg-red-100 text-red-700"])},g(t.status),3)]),e("div",Ve,[U(ve,{device:t},null,8,["device"])]),e("div",Ee,[e("button",{class:"text-indigo-600 hover:text-indigo-800",disabled:x(t),onClick:V=>Z(t),title:"Pull Users"},[x(t,"pull-users")?(o(),r("i",Ae)):(o(),r("i",je))],8,Le),e("button",{class:"text-teal-600 hover:text-teal-800",disabled:x(t),onClick:V=>G(t),title:"Pull Fingerprints"},[x(t,"pull-fp")?(o(),r("i",ze)):(o(),r("i",qe))],8,Te),e("button",{class:"text-purple-600 hover:text-purple-800",disabled:x(t),onClick:V=>H(t),title:"Push ALL fingerprints → this device"},[x(t,"push-fp-to-device")?(o(),r("i",Oe)):(o(),r("i",Ne))],8,Be),e("button",{class:"text-amber-600 hover:text-amber-800",disabled:x(t),onClick:V=>X(t),title:"Sync Catch-up (diff)"},[x(t,"catchup")?(o(),r("i",We)):(o(),r("i",Ke))],8,Re),e("button",{class:"text-blue-600 hover:text-blue-800 ml-auto",onClick:V=>O(t),title:"Edit"},s[9]||(s[9]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ze)]),x(t)?(o(),r("div",Ge," Working: "+g(u.value.label),1)):_("",!0)]))),128))])):(o(),r("div",He,"No devices found"))])),U($e,{show:a.value,device:b.value,onClose:R,onSave:K},null,8,["show","device"]),U(z,{show:C.value,title:"Delete Device",message:`Are you sure you want to delete ${(q=b.value)==null?void 0:q.name}?`,onClose:T,onConfirm:W},null,8,["show","message"]),c.value?(o(),r("div",Je,[e("div",Qe,[u.value.running?(o(),r("div",Xe,s[10]||(s[10]=[e("i",{class:"fas fa-circle-notch fa-spin text-2xl"},null,-1)]))):_("",!0),s[15]||(s[15]=e("h3",{class:"text-lg font-semibold mb-3"},"Pull Fingerprints (Options)",-1)),e("div",Ye,[e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm mb-1"},"Device",-1)),h(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>l.value=t),class:"w-full border rounded p-2"},[s[11]||(s[11]=e("option",{disabled:"",value:""},"-- Select device --",-1)),(o(!0),r(E,null,L(P(m).devices,t=>(o(),r("option",{key:t.id,value:t.id},g(t.name)+" ("+g(t.ip_address)+") ",9,es))),128))],512),[[A,l.value]])]),e("div",ss,[e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm mb-1"},"Limit (optional)",-1)),h(e("input",{type:"number","onUpdate:modelValue":s[1]||(s[1]=t=>i.value=t),min:"1",class:"w-full border rounded p-2",placeholder:"e.g. 100"},null,512),[[F,i.value,void 0,{number:!0}]])]),e("div",null,[s[14]||(s[14]=e("label",{class:"block text-sm mb-1"},"Offset (optional)",-1)),h(e("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=t=>p.value=t),min:"0",class:"w-full border rounded p-2",placeholder:"e.g. 0"},null,512),[[F,p.value,void 0,{number:!0}]])])])]),e("div",ts,[e("button",{onClick:s[3]||(s[3]=t=>c.value=!1),class:"px-3 py-2 border rounded",disabled:u.value.running}," Cancel ",8,ls),e("button",{onClick:J,class:"px-3 py-2 bg-teal-600 text-white rounded",disabled:u.value.running},[u.value.running?(o(),r("i",as)):_("",!0),e("span",null,g(u.value.running?"Working...":"Pull"),1)],8,ns)])])])):_("",!0),v.value?(o(),r("div",is,[e("div",os,[u.value.running?(o(),r("div",rs,s[16]||(s[16]=[e("i",{class:"fas fa-circle-notch fa-spin text-2xl"},null,-1)]))):_("",!0),s[20]||(s[20]=e("h3",{class:"text-lg font-semibold mb-3"},"Push ALL fingerprints → this device",-1)),e("div",us,[e("div",null,[s[18]||(s[18]=e("label",{class:"block text-sm mb-1"},"Device",-1)),h(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>$.value=t),class:"w-full border rounded p-2"},[s[17]||(s[17]=e("option",{disabled:"",value:""},"-- Select device --",-1)),(o(!0),r(E,null,L(P(m).devices,t=>(o(),r("option",{key:t.id,value:t.id},g(t.name)+" ("+g(t.ip_address)+") ",9,ds))),128))],512),[[A,$.value]])]),e("label",cs,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=t=>D.value=t)},null,512),[[oe,D.value]]),s[19]||(s[19]=e("span",null,"Send missing only (diff)",-1))])]),e("div",ps,[e("button",{onClick:s[6]||(s[6]=t=>v.value=!1),class:"px-3 py-2 border rounded",disabled:u.value.running}," Cancel ",8,vs),e("button",{onClick:Q,class:"px-3 py-2 bg-purple-600 text-white rounded",disabled:u.value.running},[u.value.running?(o(),r("i",ms)):_("",!0),e("span",null,g(u.value.running?"Working...":"Push"),1)],8,fs)])])])):_("",!0),U(z,{show:I.value,title:"Sync Catch-up",message:"এই ডিভাইসে যেগুলো নেই, শুধু সেগুলো পুশ করা হবে (user-only, diff). Proceed?",onClose:s[7]||(s[7]=t=>I.value=!1),onConfirm:Y},null,8,["show"])])}}};export{_s as default};
