import{r as C,G as Le,x as $,q as de,c as r,o,a as e,N as Ce,w as xe,s as L,d as te,k as Pe,v as Ve,h as _e,y as Re,i as Ye,M as Ne,j as _,t as p,l as be,O as Qe,F as A,e as ee,b as fe,T as Xe,Y as Ze,V as qe,A as Ge,f as et,u as tt,D as We,m as ye}from"./index-cUvxau2G.js";import{L as nt}from"./LoaderView-DhLYgoHt.js";import{_ as st}from"./EmployeeFilter-7xKjH6Nb.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as at}from"./user-Dl4fJkLu.js";import{g as Je,b as ge}from"./datetime-BEfC2TVK.js";import{u as ot}from"./attendance-DcfRHh5V.js";import{u as rt}from"./company-CQsmAhZr.js";import{u as lt}from"./department-Bitrp3yK.js";import{u as it}from"./useTodoDateStore-DqpLvnyB.js";import"./EmployeeDropdownInput-DAFlyeqR.js";import"./SelectDropdown-FBJEFT8f.js";import"./UserChip-ari49t3M.js";import"./url-CePbr-gY.js";const dt={class:"px-4 py-4 md:py-3 bg-white rounded-md border"},pt={class:"flex flex-wrap items-center gap-3"},ut=["disabled"],ct={class:"print-hide"},mt={class:"flex flex-col md:flex-row flex-wrap items-end md:ml-auto w-full md:w-auto gap-x-3 gap-y-4 print-hide"},yt={class:"flex items-center justify-between w-full md:w-auto gap-3"},gt={class:"relative h-[32px] w-[150px] sm:w-[170px]"},bt={class:"relative h-[32px] w-[150px] sm:w-[170px]"},ft={__name:"TodoReportHeading",props:{loading:{type:Boolean,default:!1},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},employeeId:{type:[String,Number],default:""},lineType:{type:String,default:"all"},startDate:{type:String,default:""},endDate:{type:String,default:""}},emits:["reloadClick","change"],setup(Q,{expose:N,emit:pe}){const c=Q,U=C(null),M=pe,u=Le({companyId:String(c.companyId||""),departmentId:c.departmentId!==""&&c.departmentId!=null?String(c.departmentId):"",employeeId:String(c.employeeId||""),lineType:c.lineType||"all",startDate:c.startDate||"",endDate:c.endDate||""}),F=$(()=>({companyId:u.companyId,departmentId:u.departmentId,employeeId:u.employeeId,lineType:u.lineType,startDate:u.startDate,endDate:u.endDate}));function X(){M("change",{...F.value})}de(()=>[c.companyId,c.departmentId,c.employeeId,c.lineType,c.startDate,c.endDate],()=>{u.companyId=String(c.companyId||""),u.departmentId=c.departmentId!==""&&c.departmentId!=null?String(c.departmentId):"",u.employeeId=String(c.employeeId||""),u.lineType=c.lineType||"all",u.startDate=c.startDate||"",u.endDate=c.endDate||""});function V(t){const d=new Date(u.startDate);d.setDate(d.getDate()+t),u.startDate=d.toISOString().split("T")[0];const m=new Date(u.endDate);m.setDate(m.getDate()+t),u.endDate=m.toISOString().split("T")[0]}return de(F,X,{deep:!0}),N({employees:$(()=>{var t;return((t=U.value)==null?void 0:t.employees)||[]})}),(t,d)=>(o(),r("div",dt,[e("div",pt,[Ce(t.$slots,"before",{},void 0,!0),e("button",{class:L(["btn-icon print-hide",{"animate-spin !bg-opacity-0":Q.loading}]),onClick:d[0]||(d[0]=xe(m=>M("reloadClick"),["prevent"])),disabled:Q.loading,title:"Reload"},[e("i",{class:L(["fas fa-redo",[Q.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,ut),e("span",ct,[Ce(t.$slots,"after",{},void 0,!0)]),e("div",mt,[te(st,{ref_key:"employeeFilterRef",ref:U,company_id:u.companyId,"onUpdate:company_id":d[1]||(d[1]=m=>u.companyId=m),department_id:u.departmentId,"onUpdate:department_id":d[2]||(d[2]=m=>u.departmentId=m),employee_id:u.employeeId,"onUpdate:employee_id":d[3]||(d[3]=m=>u.employeeId=m),line_type:u.lineType,"onUpdate:line_type":d[4]||(d[4]=m=>u.lineType=m),"with-type":!0,class:"flex-1 gap-y-4 md:flex items-center justify-between w-full md:w-auto"},null,8,["company_id","department_id","employee_id","line_type"]),e("div",yt,[e("button",{class:"btn-3 px-3 rounded size-[31px]",onClick:d[5]||(d[5]=xe(()=>V(-1),["prevent"]))},d[9]||(d[9]=[e("span",{class:"fas fa-arrow-left"},null,-1)])),e("div",gt,[d[10]||(d[10]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Start Date",-1)),Pe(e("input",{type:"date","onUpdate:modelValue":d[6]||(d[6]=m=>u.startDate=m),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[Ve,u.startDate]])]),e("div",bt,[d[11]||(d[11]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"End Date",-1)),Pe(e("input",{type:"date","onUpdate:modelValue":d[7]||(d[7]=m=>u.endDate=m),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[Ve,u.endDate]])]),e("button",{class:"btn-3 px-3 rounded size-[31px]",onClick:d[8]||(d[8]=xe(()=>V(1),["prevent"]))},d[12]||(d[12]=[e("span",{class:"fas fa-arrow-right"},null,-1)]))])])])]))}},xt=Ke(ft,[["__scopeId","data-v-c25b1fcb"]]),vt={class:"flex items-start gap-2"},wt={class:"leading-tight"},ht={class:"font-medium text-gray-800"},_t={key:0,class:"text-xs text-gray-500"},Dt={class:"flex items-start gap-3"},kt={class:"flex-1 min-w-0"},Tt={class:"font-semibold text-gray-900 leading-tight truncate"},St={class:"text-xs text-gray-500 leading-tight"},It={key:0},$t={key:1,class:"mx-1"},Ct={key:2},Rt={key:0,class:"text-[11px] text-gray-500"},Nt={class:"mt-3 grid grid-cols-[110px_1fr] gap-x-3 gap-y-1 text-xs"},Lt={class:"text-gray-500"},Et={class:"text-gray-800 font-medium truncate"},At={key:0,class:"mt-3"},Ut=["href"],Bt={key:1,class:"mt-2 text-[11px] text-indigo-600"},Mt={key:2,class:"mt-2 text-[11px] text-red-600"},zt=120,jt={__name:"UserHoverBubble",props:{user:{type:Object,default:()=>({})}},setup(Q){const N=Q,pe=at(),c=C(!1),U=C(!1),M=C(""),u=C(null),F=C(!1),X=C(null),V=C({}),t=C(null),d=Le({trigger:!1,bubble:!1});let m=null;const ve=new Date,De=`${ve.getFullYear()}-${String(ve.getMonth()+1).padStart(2,"0")}`,Z=()=>{m&&(clearTimeout(m),m=null)},j={executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},b=$(()=>({...N.user||{},...u.value||{}})),W=$(()=>{var a,f;return j[(a=b.value)==null?void 0:a.line_type]||((f=b.value)==null?void 0:f.line_type)||""}),ne=$(()=>{var k,S,B;const a=b.value||{},f=(a==null?void 0:a.id)||(a==null?void 0:a.user_id)||(a==null?void 0:a.employee_id);if(!f)return"";const D=((k=a==null?void 0:a.department)==null?void 0:k.id)||(a==null?void 0:a.department_id),x=((B=(S=a==null?void 0:a.department)==null?void 0:S.company)==null?void 0:B.id)||(a==null?void 0:a.company_id),v=new URLSearchParams;return D&&v.set("department_id",D),x&&v.set("company_id",x),v.set("employee_id",f),v.set("date",De),`/hrd/em-attendance?${v.toString()}`}),we=$(()=>{var D,x,v,k,S;const a=b.value||{};return[{label:"Employee ID",value:a.employee_id||a.employeeId||a.id},{label:"Email",value:a.email},{label:"Phone",value:a.phone||a.contact_number||a.mobile},{label:"Designation",value:(D=a.designation)==null?void 0:D.name},{label:"Department",value:(x=a.department)==null?void 0:x.name},{label:"Company",value:((k=(v=a.department)==null?void 0:v.company)==null?void 0:k.name)||((S=a.company)==null?void 0:S.name)},{label:"Line Type",value:W.value}].map(B=>({...B,value:B.value||"-"}))}),se=$(()=>{var f,D,x,v,k,S;if(!((f=N.user)!=null&&f.id))return!1;const a=b.value||{};return!a.email||!(a.phone||a.contact_number||a.mobile)||!((D=a.department)!=null&&D.name)||!((x=a.designation)!=null&&x.name)||!((k=(v=a.department)==null?void 0:v.company)!=null&&k.name||(S=a.company)!=null&&S.name)}),ue=()=>{u.value=null,F.value=!1,M.value=""},q=async()=>{var a;if(!(!se.value||!((a=N.user)!=null&&a.id)||F.value||U.value)){U.value=!0,M.value="";try{const f=await pe.fetchUser(N.user.id);f&&(u.value=f),F.value=!0}catch{M.value="Unable to load full profile right now."}finally{U.value=!1}}},ae=()=>{var J;const a=X.value;if(!a)return;const f=a.getBoundingClientRect(),D=320,x=12,v=((J=t.value)==null?void 0:J.offsetHeight)||0,k=window.innerHeight-f.bottom-8,S=f.top-8,B=v&&v>k&&S>k,le=Math.min(Math.max(f.left,x),window.innerWidth-D-x),O=B?f.top-v-8:f.bottom+8;V.value={top:`${Math.max(O,x)}px`,left:`${le}px`,width:`${Math.min(D,window.innerWidth-x*2)}px`}},ce=async()=>{c.value=!0,await Ge(),ae(),await q()},E=()=>{c.value=!1},oe=()=>{d.trigger||d.bubble||(Z(),m=setTimeout(()=>{!d.trigger&&!d.bubble&&E()},zt))},re=()=>{c.value&&ae()};_e(()=>{window.addEventListener("resize",re),window.addEventListener("scroll",re,!0)}),Re(()=>{window.removeEventListener("resize",re),window.removeEventListener("scroll",re,!0),Z()}),de(()=>{var a;return(a=N.user)==null?void 0:a.id},()=>{ue()});const he=()=>{Z(),d.trigger=!0,ce()},ke=()=>{d.trigger=!1,oe()},Te=()=>{Z(),d.trigger=!0,ce()},me=()=>{d.trigger=!1,oe()},Se=()=>{Z(),d.bubble=!0},Ie=()=>{d.bubble=!1,oe()};return(a,f)=>(o(),r("div",qe({class:"relative flex items-start"},a.$attrs,{onMouseenter:he,onMouseleave:ke,onFocusin:Te,onFocusout:me,ref_key:"triggerRef",ref:X}),[Ce(a.$slots,"trigger",{user:b.value},()=>{var D,x,v,k,S;return[e("div",vt,[te(Ne,{size:"medium",user:b.value,class:"inline-block align-middle"},null,8,["user"]),e("div",wt,[e("div",ht,p(((D=b.value)==null?void 0:D.name)||"Unknown user"),1),(v=(x=b.value)==null?void 0:x.department)!=null&&v.name?(o(),r("div",_t,p((S=(k=b.value)==null?void 0:k.department)==null?void 0:S.name),1)):_("",!0)])])]},!0),(o(),Ye(Ze,{to:"body"},[te(Xe,{name:"fade-scale"},{default:be(()=>{var D,x,v,k,S,B,le,O,J;return[c.value?(o(),r("div",{key:0,class:"fixed z-50 rounded-xl border border-gray-200 bg-white p-4 shadow-xl",style:Qe(V.value),ref_key:"bubbleRef",ref:t,onMouseenter:Se,onMouseleave:Ie},[e("div",Dt,[te(Ne,{user:b.value,size:"xlarge"},null,8,["user"]),e("div",kt,[e("div",Tt,p(((D=b.value)==null?void 0:D.name)||"Unknown user"),1),e("div",St,[(v=(x=b.value)==null?void 0:x.designation)!=null&&v.name?(o(),r("span",It,p((S=(k=b.value)==null?void 0:k.designation)==null?void 0:S.name),1)):_("",!0),(le=(B=b.value)==null?void 0:B.designation)!=null&&le.name&&W.value?(o(),r("span",$t," • ")):_("",!0),W.value?(o(),r("span",Ct,p(W.value),1)):_("",!0)]),(O=b.value)!=null&&O.employee_id?(o(),r("div",Rt," ID: "+p((J=b.value)==null?void 0:J.employee_id),1)):_("",!0)])]),e("dl",Nt,[(o(!0),r(A,null,ee(we.value,ie=>(o(),r(A,{key:ie.label},[e("dt",Lt,p(ie.label),1),e("dd",Et,p(ie.value),1)],64))),128))]),ne.value?(o(),r("div",At,[e("a",{href:ne.value,target:"_blank",rel:"noopener",class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md shadow-sm"},f[0]||(f[0]=[e("i",{class:"far fa-external-link-alt"},null,-1),fe(" Open Job Card ")]),8,Ut)])):_("",!0),U.value?(o(),r("div",Bt," Loading more details… ")):M.value?(o(),r("div",Mt,p(M.value),1)):_("",!0)],36)):_("",!0)]}),_:1})]))],16))}},Ot=Ke(jt,[["__scopeId","data-v-a98fab14"]]),Ht={class:"container print:flex-grow mx-auto print:w-full print:px-0 print:py-0"},Ft=["disabled"],Pt={key:0,class:"bg-white border rounded-md mb-2 p-4 text-sm print:border-0 print:mb-2 print:px-0 print:w-full relative overflow-visible z-40"},Vt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-7 gap-y-2 gap-x-6"},Wt={class:"font-medium text-gray-800"},Jt={class:"col-span-2"},Yt={class:"font-medium text-gray-800"},Kt={class:"inline-flex items-center gap-5 font-bold"},Qt={class:"text-gray-700"},Xt={key:0,class:"mt-2 w-[280px] sm:w-[320px] lg:w-[280px] xl:w-[320px] bg-white border border-gray-200 rounded-md p-3 shadow-lg text-left absolute right-0"},Zt={class:"flex items-center justify-between mb-2"},qt={class:"text-[11px] text-gray-500"},Gt={class:"space-y-3 max-h-56 overflow-auto pr-1 z-50"},en={class:"pt-2 border-t border-dashed border-gray-200"},tn={class:"text-[11px] text-gray-500 uppercase tracking-wide mb-1 flex items-center justify-between"},nn={class:"flex items-center gap-2"},sn={key:0,class:"bg-red-500 rounded-md px-1.5 text-white text-center"},an={key:0,class:"flex flex-wrap gap-2"},on={key:0,class:"text-xs text-gray-400"},rn=["title"],ln={class:"block max-w-[160px] truncate"},dn={class:"text-[11px] text-gray-500 uppercase tracking-wide mb-1"},pn={key:0,class:"bg-green-500 rounded-md px-1.5 text-white text-center"},un={class:"flex flex-wrap gap-2"},cn={key:0,class:"text-xs text-gray-400"},mn=["title"],yn={class:"block max-w-[160px] truncate"},gn={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[70vh] flex flex-col items-center justify-center space-y-4"},bn={key:3,class:"overflow-x-auto md:overflow-clip bg-white border border-t-0 rounded-md shadow-sm print:shadow-none print:rounded-none print:border-gray-400"},fn={class:"min-w-full text-left text-sm border-separate border-spacing-0"},xn={class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},vn={class:"border-y print:border-gray-400 sticky md:top-[123px] z-30 rounded-t-md"},wn={class:"px-4 py-3 border md:w-[100px] print:w-auto print:border-l print:border-l-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center whitespace-nowrap"},hn={class:"flex items-center justify-between gap-2"},_n={class:"ml-1 text-[10px] text-gray-500"},Dn={key:0,class:"px-4 py-3 border bg-white bg-opacity-70 backdrop-blur-sm text-center"},kn={class:"divide-y divide-gray-200"},Tn={key:0},Sn=["colspan"],In=["rowspan"],$n={class:"sticky top-[180px] bg-white text-center"},Cn=["rowspan"],Rn={class:"flex"},Nn={key:0,class:"text-xs text-gray-500"},Ln=["rowspan"],En={class:"sticky top-[180px] bg-white"},An={key:0,class:"text-[11px] text-gray-500 mt-2"},Un={key:0,class:"grid grid-cols-2 gap-4"},Bn={class:"rounded-md bg-indigo-50 border border-indigo-100 px-2"},Mn={class:"flex gap-1 items-center justify-between"},zn={class:"font-semibold text-indigo-700 text-xs whitespace-nowrap"},jn={class:"flex gap-1 items-center justify-between"},On={class:"rounded-md bg-indigo-50 border border-indigo-100 px-2"},Hn={class:"flex gap-1 items-center justify-between"},Fn={class:"font-semibold text-indigo-700 text-xs whitespace-nowrap"},Pn={class:"flex gap-1 items-center justify-between"},Vn={key:1,class:"mt-1 text-gray-500 text-center"},Wn=["rowspan"],Jn={class:"sticky top-[180px] bg-white"},Yn={class:"font-medium"},Kn={class:"text-gray-400 mr-2"},Qn={class:"text-xs text-gray-500"},$e="border-b-2 border-b-blue-200",ps={__name:"TodoReportView",setup(Q){var J,ie,Ee,Ae,Ue,Be;const N=et(),pe=tt(),c=it(),U=rt(),M=lt(),{companies:u}=We(U),{departments:F}=We(M),X=C(null),V=Je(new Date),t=Le({companyId:((J=N.query)==null?void 0:J.company_id)||"",departmentId:((ie=N.query)==null?void 0:ie.department_id)||"",employeeId:((Ee=N.query)==null?void 0:Ee.employee_id)||"",lineType:((Ae=N.query)==null?void 0:Ae.line_type)||"all",startDate:((Ue=N.query)==null?void 0:Ue.start_date)||V,endDate:((Be=N.query)==null?void 0:Be.end_date)||V}),d=$(()=>{if(!t.startDate||!t.endDate)return[];const s=new Date(t.startDate),n=new Date(t.endDate);if(Number.isNaN(s.getTime())||Number.isNaN(n.getTime()))return[];const i=s<=n?1:-1,y=new Date(s),g=[];for(;g.push(Je(y)),y.getTime()!==n.getTime();)y.setDate(y.getDate()+i);return g}),m=$(()=>{var n;return[...((n=X.value)==null?void 0:n.employees)||[]].filter(i=>t.employeeId?String(i.id)===String(t.employeeId):!0).sort((i,y)=>{var g,I;return(((g=i.user)==null?void 0:g.name)||"").localeCompare(((I=y.user)==null?void 0:I.name)||"")}).map(i=>{const y=c.todo_dates.filter(l=>{var T;return String((T=l.user)==null?void 0:T.id)===String(i.id)});let g=d.value.map(l=>{const T=y.filter(H=>H.date===l);return T.length?{date:l,rowSpan:T.length,todos:T}:{date:l,rowSpan:1,todos:[{id:`empty-${i.id}-${l}`,isPlaceholder:!0,title:"",date:l}]}});g.length||(g=[{date:null,rowSpan:1,todos:[{id:`empty-${i.id}`,isPlaceholder:!0,title:""}]}]);const I=g.reduce((l,T)=>l+T.rowSpan,0);return{user:i,dates:g,rowSpan:Math.max(1,I)}})}),ve=$(()=>{if(!t.startDate||!t.endDate)return"";const s=ge(t.startDate,{weekDay:"long"}),n=ge(t.endDate,{weekDay:"long"});return`${s} ~ ${n}`}),De=$(()=>U.employees||[]),Z={all:"All Types",executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},j=$(()=>{var g,I,l,T,H,Y,K,w;const s=t.companyId&&((g=u.value)!=null&&g.length)?(I=u.value.find(R=>String(R.id)===String(t.companyId)))==null?void 0:I.name:null,n=t.departmentId&&((l=F.value)!=null&&l.length)?(T=F.value.find(R=>String(R.id)===String(t.departmentId)))==null?void 0:T.name:null;let i=null;t.employeeId&&(i=((Y=(H=De.value)==null?void 0:H.find(R=>String(R.id)===String(t.employeeId)))==null?void 0:Y.name)||((w=(K=m.value.find(R=>{var G;return String(((G=R.user)==null?void 0:G.id)||"")===String(t.employeeId)}))==null?void 0:K.user)==null?void 0:w.name)||null);const y=t.startDate===t.endDate&&t.startDate?ge(t.startDate,{weekDay:"long"}):ve.value||"-";return{company:s||(t.companyId?`#${t.companyId}`:"All Companies"),department:n||(t.departmentId?`#${t.departmentId}`:"All Departments"),employee:i||(t.employeeId?`#${t.employeeId}`:"All Employees"),lineType:Z[t.lineType]||t.lineType||"All Types",dateRange:y}}),b=C(!1),W=C(null),ne=$(()=>{var s;return((s=m.value)==null?void 0:s.length)||0}),we=$(()=>{var s,n;return Math.max(0,ne.value-(((n=(s=E.value)==null?void 0:s.withoutTodos)==null?void 0:n.length)||0))}),se=C(!0),ue=C(!1),q=C(!1),ae=C(null),ce=s=>{b.value&&W.value&&(W.value.contains(s.target)||(b.value=!1))},E=$(()=>{var s;return(s=m.value)!=null&&s.length?m.value.reduce((n,i,y)=>{var l,T,H,Y,K,w;const g=i.dates.reduce((R,G)=>R+G.todos.filter(P=>!P.isPlaceholder).length,0),I={id:((l=i.user)==null?void 0:l.id)??((T=i.user)==null?void 0:T.user_id)??((H=i.user)==null?void 0:H.uid)??((Y=i.user)==null?void 0:Y.email)??`${((K=i.user)==null?void 0:K.name)||"unknown"}-${y}`,name:((w=i.user)==null?void 0:w.name)||"Unknown user"};return g>0?n.withTodos.push(I):n.withoutTodos.push(I),n},{withTodos:[],withoutTodos:[]}):{withTodos:[],withoutTodos:[]}}),oe=$(()=>{if(!q.value)return m.value;const s=new Set((E.value.withoutTodos||[]).map(n=>String(n.id??n.name??"")));return m.value.filter(n=>{var y,g,I,l,T;const i=((y=n.user)==null?void 0:y.id)??((g=n.user)==null?void 0:g.user_id)??((I=n.user)==null?void 0:I.uid)??((l=n.user)==null?void 0:l.email)??((T=n.user)==null?void 0:T.name)??"";return!s.has(String(i))})});function re(){q.value=!q.value,ue.value=q.value}const he=s=>{ue.value&&ae.value&&(ae.value.contains(s.target)||(ue.value=!1))},ke=s=>s==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":s==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":s==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200";function Te(){pe.replace({query:{...N.query,company_id:t.companyId||void 0,department_id:t.departmentId||void 0,employee_id:t.employeeId||void 0,line_type:t.lineType||void 0,start_date:t.startDate||void 0,end_date:t.endDate||void 0}})}async function me(){!t.companyId||!t.startDate||!t.endDate||(await c.fetchTodoDates({"company-id":t.companyId,"department-id":t.departmentId,"employee-id":t.employeeId,"line-type":t.lineType,"start-date":t.startDate,"end-date":t.endDate}),k())}function Se(s){t.companyId=s.companyId||"",t.departmentId=s.departmentId||"",t.employeeId=s.employeeId||"",t.lineType=s.lineType||"all",t.startDate=s.startDate||"",t.endDate=s.endDate||""}function Ie(){window.print()}const a=$(()=>t.startDate===t.endDate);de(()=>t.companyId,s=>{s&&(M.fetchDepartments(s),U.fetchEmployee(s))},{immediate:!0}),de(()=>({...t}),(s,n)=>{JSON.stringify(s)!==JSON.stringify(n)&&(Te(),me())},{deep:!0}),de(()=>N.query,s=>{t.companyId=(s==null?void 0:s.company_id)||t.companyId,t.departmentId=(s==null?void 0:s.department_id)||t.departmentId,t.employeeId=(s==null?void 0:s.employee_id)||t.employeeId,t.lineType=(s==null?void 0:s.line_type)||t.lineType,t.startDate=(s==null?void 0:s.start_date)||t.startDate,t.endDate=(s==null?void 0:s.end_date)||t.endDate}),_e(()=>{U.fetchCompanies({ignore_permission:!0}),me()}),_e(()=>{document.addEventListener("click",ce,!0)}),Re(()=>{document.removeEventListener("click",ce,!0)}),_e(()=>{document.addEventListener("click",he,!0)}),Re(()=>{document.removeEventListener("click",he,!0)});const f=ot(),D=C([]),x=C(!1),v=$(()=>t.startDate===t.endDate),k=async()=>{if(!(!t.companyId||!t.startDate||!t.endDate)){x.value=!0;try{const s=await f.getDateRangeAttendanceSummary(t.startDate,t.endDate,t.companyId,t.lineType,t.employeeId,!0);s&&(D.value=s)}finally{x.value=!1}}};function S(s,n){var y;const i=((y=D.value)==null?void 0:y.find(g=>String(g.employee_id)===String(s)))||null;return i?!n&&v.value?(i==null?void 0:i.attendance[t.startDate])||null:(i==null?void 0:i.attendance[n])||null:null}function B(s,n){const i=S(s,n);return i?{hasData:!0,in:i.in||"-",out:i.out||"-",late:i.late||"-",early:i.early||"-",comment:i.comment||"-"}:{hasData:!1,in:"-",out:"-",late:"-",early:"-",comment:"-"}}function le(s,n,i,y){const g=i===s.dates.length-1,I=y===n.todos.length-1;return g&&I}function O(s,n,i,y){return le(s,n,i,y)?$e:""}return(s,n)=>{var i,y,g,I;return o(),r("div",Ht,[te(xt,{ref_key:"headingRef",ref:X,"company-id":t.companyId,"department-id":t.departmentId,"employee-id":t.employeeId,"line-type":t.lineType,"start-date":t.startDate,"end-date":t.endDate,loading:ye(c).loading,class:"mb-4 print:px-0 print:py-0 print:mb-2 print:border-0 print:border-b print:border-gray-400 print:rounded-none print:w-full sticky top-[58px] z-50",onChange:Se,onReloadClick:me},{before:be(()=>n[3]||(n[3]=[e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-800"},"Todo Report")],-1)])),after:be(()=>[e("button",{type:"button",class:"btn-icon print-hide disabled:opacity-35 cursor-pointer disabled:cursor-not-allowed",onClick:xe(Ie,["prevent"]),disabled:ye(c).loading},n[4]||(n[4]=[e("i",{class:"fas fa-print"},null,-1)]),8,Ft)]),_:1},8,["company-id","department-id","employee-id","line-type","start-date","end-date","loading"]),t.companyId&&t.startDate&&t.endDate?(o(),r("div",Pt,[e("div",Vt,[e("div",null,[n[5]||(n[5]=e("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Company",-1)),e("div",Wt,p(j.value.company),1)]),e("div",null,[n[6]||(n[6]=e("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Department",-1)),e("div",{class:L(["font-medium",[j.value.department=="All Departments"?"text-gray-400":"text-gray-800"]])},p(j.value.department),3)]),e("div",null,[n[7]||(n[7]=e("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Line Type",-1)),e("div",{class:L(["font-medium",[j.value.lineType=="All Types"?"text-gray-400":"text-gray-800"]])},p(j.value.lineType),3)]),e("div",null,[n[8]||(n[8]=e("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Employee",-1)),e("div",{class:L(["font-medium",[j.value.employee=="All Employees"?"text-gray-400":"text-gray-800"]])},p(j.value.employee),3)]),e("div",Jt,[n[9]||(n[9]=e("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Date",-1)),e("div",Yt,p(j.value.dateRange),1)]),e("div",{ref_key:"assignmentSummaryRef",ref:W,class:"print-hide relative"},[e("button",{type:"button",class:"px-3 bg-white text-gray-700 hover:bg-gray-50 w-full text-bg text-right",onClick:n[0]||(n[0]=l=>b.value=!b.value)},[n[10]||(n[10]=e("div",{class:"uppercase"},"Todo given",-1)),e("div",Kt,[e("div",Qt,p(we.value)+" / "+p(ne.value),1),e("i",{class:L(["fas",[b.value?"fa-chevron-up":"fa-chevron-down"]])},null,2)])]),b.value?(o(),r("div",Xt,[e("div",Zt,[n[11]||(n[11]=e("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Todo Status",-1)),e("div",qt,p(we.value)+" given / "+p(ne.value)+" selected ",1)]),e("div",Gt,[e("div",en,[e("div",tn,[e("div",nn,[n[12]||(n[12]=e("span",null,"Not given todos",-1)),(i=E.value.withoutTodos)!=null&&i.length?(o(),r("span",sn,p((y=E.value.withoutTodos)==null?void 0:y.length),1)):_("",!0)]),e("button",{type:"button",class:"text-[10px] px-2 py-1 rounded border border-gray-200 text-gray-600 hover:bg-gray-50",onClick:n[1]||(n[1]=l=>se.value=!se.value)},p(se.value?"Hide":"Show"),1)]),se.value?(o(),r("div",an,[E.value.withoutTodos.length?_("",!0):(o(),r("span",on," Everyone has todos ")),(o(!0),r(A,null,ee(E.value.withoutTodos,l=>(o(),r("span",{key:`without-${l.id}`,class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-red-50 text-red-700 border border-red-100 text-xs max-w-full",title:l.name},[n[13]||(n[13]=e("i",{class:"fas fa-exclamation-circle"},null,-1)),e("span",ln,p(l.name),1)],8,rn))),128))])):_("",!0)]),e("div",null,[e("div",dn,[n[14]||(n[14]=fe(" Given todos ")),(g=E.value.withTodos)!=null&&g.length?(o(),r("span",pn,p((I=E.value.withTodos)==null?void 0:I.length),1)):_("",!0)]),e("div",un,[E.value.withTodos.length?_("",!0):(o(),r("span",cn," No todos assigned ")),(o(!0),r(A,null,ee(E.value.withTodos,l=>(o(),r("span",{key:`with-${l.id}`,class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100 text-xs max-w-full",title:l.name},[n[15]||(n[15]=e("i",{class:"fas fa-check-circle"},null,-1)),e("span",yn,p(l.name),1)],8,mn))),128))])])])])):_("",!0)],512)])])):_("",!0),!t.companyId||!t.startDate||!t.endDate?(o(),r("div",gn,n[16]||(n[16]=[e("i",{class:"fad fa-tasks text-4xl"},null,-1),e("div",{class:"empty-state glass-panel"},[e("p",{class:"text-base font-semibold text-rose-500"}," Select company and date range to view the report. "),e("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)]))):ye(c).loading?(o(),Ye(nt,{key:2},{default:be(()=>n[17]||(n[17]=[fe("Loading report...")])),_:1,__:[17]})):(o(),r("div",bn,[e("table",fn,[e("thead",xn,[e("tr",vn,[n[19]||(n[19]=e("th",{class:"px-4 py-3 border w-[10px] bg-white bg-opacity-70 backdrop-blur-sm rounded-tl-md print:rounded-tl-none text-center"}," sl ",-1)),e("th",wn,[e("div",hn,[n[18]||(n[18]=e("span",null,"Employee Name",-1)),t.employeeId?_("",!0):(o(),r("div",{key:0,class:"relative hidden md:block print:hidden",ref_key:"tableNoTodosRef",ref:ae},[e("button",{type:"button",class:"text-[11px] px-2 py-1 rounded border border-gray-200 text-gray-600 hover:bg-gray-50",onClick:n[2]||(n[2]=xe(l=>re(),["stop"]))},[fe(" No Todos ("+p(E.value.withoutTodos.length)+") ",1),e("span",_n,p(q.value?"Hidden":"Showing"),1)])],512))])]),a.value?_("",!0):(o(),r("th",Dn," Date ")),n[20]||(n[20]=e("th",{class:"px-4 py-3 border bg-white text-center"},"Todo",-1)),n[21]||(n[21]=e("th",{class:"px-4 py-3 border print:border-r print:border-gray-400 bg-white bg-opacity-70 backdrop-blur-sm text-center rounded-tr-md print:rounded-tr-none"}," Status ",-1))])]),e("tbody",kn,[oe.value.length===0?(o(),r("tr",Tn,[e("td",{colspan:a.value?4:5,class:"px-4 py-6 text-center text-gray-500"},n[22]||(n[22]=[e("div",null,[e("i",{class:"fas fa-tasks fa-2x text-gray-300 mb-2"})],-1),e("div",null,"No todos.",-1)]),8,Sn)])):_("",!0),(o(!0),r(A,null,ee(oe.value,(l,T)=>{var H,Y,K;return o(),r(A,{key:((H=l.user)==null?void 0:H.id)||(((K=(Y=l.dates[0])==null?void 0:Y.todos[0])==null?void 0:K.id)??Math.random())},[(o(!0),r(A,null,ee(l.dates,(w,R)=>{var G;return o(),r(A,{key:`${((G=l.user)==null?void 0:G.id)||"u"}-${w.date}`},[(o(!0),r(A,null,ee(w.todos,(P,z)=>{var Me,ze,je,Oe;return o(),r("tr",{key:P.id||`${((Me=l.user)==null?void 0:Me.id)||"u"}-${w.date||"empty"}-${z}`,class:"border odd:bg-white even:bg-gray-50 hover:bg-gray-100"},[R===0&&z===0?(o(),r("td",{key:0,rowspan:l.rowSpan||1,class:L(["px-4 py-3 align-top font-bold text-xl text-gray-800 whitespace-nowrap border-l border-t border-b bg-white",$e])},[e("div",$n,p(T+1),1)],8,In)):_("",!0),R===0&&z===0?(o(),r("td",{key:1,rowspan:l.rowSpan||1,class:L(["px-4 py-3 align-top font-medium text-gray-800 whitespace-nowrap border-l border-t border-b bg-white",$e])},[te(Ot,{user:l.user,class:"sticky top-[180px] bg-white"},{trigger:be(({user:h})=>{var He,Fe;return[e("div",Rn,[te(Ne,{size:"medium",user:h,class:"inline-block mr-2 align-middle"},null,8,["user"]),e("div",null,[e("div",null,p((h==null?void 0:h.name)||"Unknown user"),1),(He=h==null?void 0:h.department)!=null&&He.name?(o(),r("div",Nn,p((Fe=h==null?void 0:h.department)==null?void 0:Fe.name),1)):_("",!0)])])]}),_:2},1032,["user"])],8,Cn)):_("",!0),P.isPlaceholder?(o(),r(A,{key:2},[z===0&&!a.value?(o(),r("td",{key:0,rowspan:w.rowSpan||1,class:L(["px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap border-l border-t bg-white",O(l,w,R,z)])},[e("div",En,p(ye(ge)(w.date)||w.date||"-"),1)],10,Ln)):_("",!0),e("td",{class:L(["border-l border-t border-r bg-white px-3 py-3 text-center",O(l,w,R,z)]),colspan:"2"},[n[27]||(n[27]=e("div",{class:"flex items-center justify-center gap-2 text-red-600 text-sm font-medium opacity-70"},[e("i",{class:"far fa-clipboard-list text-red-400"}),e("span",null,"No todos was provided.")],-1)),x.value?(o(),r("div",An," Loading attendance… ")):(o(!0),r(A,{key:1},ee([B((ze=l==null?void 0:l.user)==null?void 0:ze.id,w==null?void 0:w.date)],h=>(o(),r("div",{key:h.comment,class:"min-w-[180px] mt-3 text-[11px] text-red-600 text-left inline-block align-top"},[h.hasData?(o(),r("div",Un,[h.in==="-"&&h.out==="-"?(o(),r("div",{key:0,class:L(["text-center flex items-center justify-center rounded-md bg-slate-50 border text-xs border-dashed px-2 py-1.5 col-span-2",[{"text-red-500 border-red-300":h.comment==="Absent","text-blue-500 border-blue-300":h.comment!=="Absent"}]])},p(h.comment),3)):(o(),r(A,{key:1},[e("div",Bn,[e("div",Mn,[n[23]||(n[23]=e("span",{class:"text-[10px] uppercase text-gray-500 tracking-wide"}," In ",-1)),e("span",zn,p(h.in),1)]),e("div",jn,[n[24]||(n[24]=e("span",{class:"text-[10px] uppercase text-gray-500 tracking-wide"}," Late ",-1)),e("div",null,p(h.late),1)])]),e("div",On,[e("div",Hn,[n[25]||(n[25]=e("span",{class:"text-[10px] uppercase text-gray-500 tracking-wide"}," Out ",-1)),e("span",Fn,p(h.out),1)]),e("div",Pn,[n[26]||(n[26]=e("span",{class:"text-[10px] uppercase text-gray-500 tracking-wide"}," Early ",-1)),e("div",null,p(h.out!=="-"?h.early:"-"),1)])])],64))])):(o(),r("div",Vn," Attendance data unavailable. "))]))),128))],2)],64)):(o(),r(A,{key:3},[z===0&&!a.value?(o(),r("td",{key:0,rowspan:w.rowSpan||1,class:L(["px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap border-l border-t bg-white",O(l,w,R,z)])},[e("div",Jn,p(ye(ge)(w.date)||w.date||"-"),1)],10,Wn)):_("",!0),e("td",{class:L(["px-4 py-3 text-gray-800 border-l border-t",O(l,w,R,z)])},[e("div",Yn,[e("span",Kn,p(z+1)+".",1),fe(" "+p(P.title),1)]),e("div",Qn,p(((je=P.todoable)==null?void 0:je.title)||((Oe=P.todoable_type)==null?void 0:Oe.split("\\").pop())||""),1)],2),e("td",{class:L(["px-4 py-3 border-l border-t border-r text-center",O(l,w,R,z)])},[e("span",{class:L(["text-xs font-semibold px-2.5 py-1 rounded-full",ke(P.status)])},p(P.status||"N/A"),3)],2)],64))])}),128))],64)}),128))],64)}),128))])])]))])}}};export{ps as default};
