import{u as G,f as J,D as O,r as u,x as $,q as Q,h as W,p as X,c as m,o as f,a as t,d as g,l as N,k as C,H as V,n as Z,m as a,t as l,b as h,F as ee,e as te}from"./index-BUxtDSZU.js";import{L as oe}from"./LoaderView-CH3n26uW.js";import{u as se}from"./monthly-kpi-forms-DjvKwLYN.js";import{_ as F}from"./FlexibleDatePicker-CJOm1zc6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"space-y-4 px-4"},ne={class:"flex items-center justify-between gap-2"},le={class:"flex flex-wrap gap-2 p-3 rounded border border-white/20 bg-white/60 backdrop-blur-md shadow-sm supports-[backdrop-filter]:bg-white/50 sticky top-14"},re={class:"flex flex-wrap justify-start items-center gap-4"},de={class:"md:col-span-3 relative"},ie={class:"md:col-span-3"},ue={class:"md:col-span-3"},pe={class:"md:col-span-3"},me={class:"relative"},fe={class:"relative"},ge={class:"relative"},ve={key:0,class:"py-8 text-center"},ye={key:1,class:"rounded-md border border-red-200 bg-red-50 p-3 text-red-700"},ce={key:2,class:"rounded-xl border bg-white p-8 text-center text-gray-600"},be={key:3,class:"overflow-x-auto rounded-xl border bg-white shadow-sm"},_e={class:"min-w-full text-sm"},xe={class:"bg-gray-100 text-left text-gray-700"},he={class:"px-3 py-2"},we={class:"px-3 py-2 capitalize"},ke={class:"px-3 py-2"},Ce={class:"px-3 py-2"},Ve={class:"px-3 py-2"},Pe={class:"px-3 py-2"},Me={class:"px-3 py-2 text-right"},Se={class:"inline-flex gap-1"},$e=["onClick"],Ne={class:"flex items-center justify-between gap-3 border-t px-3 py-2 text-sm"},Fe={class:"text-gray-600"},qe={class:"font-medium"},De={class:"font-medium"},Le={class:"font-medium"},Ue={class:"flex items-center gap-1"},Te=["disabled"],Be={class:"px-2"},Ke=["disabled"],He={__name:"MonthlyKpiFormList",setup(Ae){const q=G(),d=J(),v=se(),{items:D,meta:n,isLoading:A,error:L,hasNextPage:E,hasPrevPage:R}=O(v),w=u(d.query.type??""),y=u(d.query.month??""),c=u(d.query.date_from??""),b=u(d.query.date_to??""),p=u(d.query.sort_by??"created_at"),i=u(d.query.sort_dir??"desc"),_=u(Number(d.query.per_page??15)),k=u(Number(d.query.page??1)),j=s=>String(s??"").padStart(2,"0"),P=s=>{const e=new Date;if(!s)return{year:e.getFullYear(),month:e.getMonth()+1,day:1};const[x="",o=""]=String(s).split("-");return{year:Number(x)||e.getFullYear(),month:Number(o)||e.getMonth()+1,day:1}},M=s=>`${s.year}-${j(s.month)}`,U=$({get(){return P(y.value)},set(s){s&&(y.value=M(s))}}),T=$({get(){return P(c.value)},set(s){s&&(c.value=M(s))}}),B=$({get(){return P(b.value)},set(s){s&&(b.value=M(s))}});function Y(){q.replace({query:{type:w.value||void 0,month:y.value||void 0,date_from:c.value||void 0,date_to:b.value||void 0,sort_by:p.value!=="created_at"?p.value:void 0,sort_dir:i.value!=="desc"?i.value:void 0,per_page:_.value!==15?String(_.value):void 0,page:v.meta.current_page>1?String(v.meta.current_page):void 0}})}async function r(s={}){await v.fetchList({type:w.value||"",month:y.value||"",date_from:c.value||"",date_to:b.value||"",sort_by:p.value,sort_dir:i.value,per_page:_.value,page:k.value,...s}),k.value=v.meta.current_page,Y()}function S(s){p.value===s?i.value=i.value==="asc"?"desc":"asc":(p.value=s,i.value="asc"),r({page:1})}function z(){q.go(-1)}function K(s){k.value=Number(s),r({page:k.value})}function H(s){return s.end_month?`${s.start_month} → ${s.end_month}`:s.start_month}return Q([y,c,b],()=>{r({page:1})}),W(()=>r()),(s,e)=>{const x=X("RouterLink");return f(),m("div",ae,[t("div",ne,[t("button",{class:"btn-3",onClick:z},e[16]||(e[16]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[18]||(e[18]=t("h1",{class:"title-md md:title-lg"},"Monthly KPI Forms",-1)),g(x,{to:{name:"MonthlyKpiFormCreate"},class:"btn-2"},{default:N(()=>e[17]||(e[17]=[t("span",{class:"hidden md:flex"},"Add New",-1),t("i",{class:"far fa-plus"},null,-1)])),_:1,__:[17]})]),t("div",le,[t("div",re,[t("div",de,[e[20]||(e[20]=t("label",{class:"top-label top-0"},"Type",-1)),C(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),onChange:e[1]||(e[1]=o=>r({page:1})),class:"mt-1 w-full rounded-md border px-3 py-1 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"},e[19]||(e[19]=[t("option",{value:""},"All",-1),t("option",{value:"admin"},"Admin",-1),t("option",{value:"exchange"},"Exchange",-1),t("option",{value:"staff"},"Staff",-1)]),544),[[V,w.value]])]),t("div",ie,[g(F,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=o=>U.value=o),"show-year":!1,"show-month":!0,"show-date":!1,label:"Covers Month"},null,8,["modelValue"])]),t("div",ue,[g(F,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=o=>T.value=o),"show-year":!1,"show-month":!0,"show-date":!1,label:"From (period)"},null,8,["modelValue"])]),t("div",pe,[g(F,{modelValue:B.value,"onUpdate:modelValue":e[4]||(e[4]=o=>B.value=o),"show-year":!1,"show-month":!0,"show-date":!1,label:"To (period)"},null,8,["modelValue"])]),t("div",me,[e[22]||(e[22]=t("label",{class:"top-label top-0"},"Sort By",-1)),C(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>p.value=o),onChange:e[6]||(e[6]=o=>r({page:1})),class:"mt-1 w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"},e[21]||(e[21]=[Z('<option value="created_at">Created Date</option><option value="updated_at">Updated</option><option value="start_month">Start</option><option value="end_month">End</option><option value="type">Type</option><option value="performance_max_mark">Perf. Max</option><option value="monthly_target_marks">Target</option>',7)]),544),[[V,p.value]])]),t("div",fe,[e[24]||(e[24]=t("label",{class:"top-label top-0"},"Direction",-1)),C(t("select",{"onUpdate:modelValue":e[7]||(e[7]=o=>i.value=o),onChange:e[8]||(e[8]=o=>r({page:1})),class:"mt-1 w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"},e[23]||(e[23]=[t("option",{value:"desc"},"Desc",-1),t("option",{value:"asc"},"Asc",-1)]),544),[[V,i.value]])]),t("div",ge,[e[26]||(e[26]=t("label",{class:"top-label top-0"},"Per Page",-1)),C(t("select",{"onUpdate:modelValue":e[9]||(e[9]=o=>_.value=o),onChange:e[10]||(e[10]=o=>r({page:1})),class:"mt-1 w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"},e[25]||(e[25]=[t("option",{value:10},"10",-1),t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1)]),544),[[V,_.value,void 0,{number:!0}]])])])]),a(A)?(f(),m("div",ve,[g(oe)])):a(L)?(f(),m("div",ye,l(a(L)),1)):a(D).length===0?(f(),m("div",ce,[e[28]||(e[28]=h(" No forms found. ")),g(x,{to:{name:"MonthlyKpiFormCreate"},class:"ml-2 text-indigo-600 underline"},{default:N(()=>e[27]||(e[27]=[h("Create one")])),_:1,__:[27]})])):(f(),m("div",be,[t("table",_e,[t("thead",null,[t("tr",xe,[e[29]||(e[29]=t("th",{class:"px-3 py-2 w-12"},"#",-1)),t("th",{class:"px-3 py-2 cursor-pointer",onClick:e[11]||(e[11]=o=>S("type"))},"Type"),t("th",{class:"px-3 py-2 cursor-pointer",onClick:e[12]||(e[12]=o=>S("start_month"))},"Period"),e[30]||(e[30]=t("th",{class:"px-3 py-2"},"Perf.Max",-1)),e[31]||(e[31]=t("th",{class:"px-3 py-2"},"Target",-1)),t("th",{class:"px-3 py-2 cursor-pointer",onClick:e[13]||(e[13]=o=>S("updated_at"))},"Updated"),e[32]||(e[32]=t("th",{class:"px-3 py-2 text-right w-28"},"Actions",-1))])]),t("tbody",null,[(f(!0),m(ee,null,te(a(D),(o,I)=>(f(),m("tr",{key:o.id,class:"border-t hover:bg-gray-50"},[t("td",he,l((a(n).current_page-1)*a(n).per_page+I+1),1),t("td",we,l(o.type),1),t("td",ke,l(H(o)),1),t("td",Ce,l(o.performance_mark),1),t("td",Ve,l(o.target_marks),1),t("td",Pe,l(new Date(o.updated_at||o.created_at).toLocaleString()),1),t("td",Me,[t("div",Se,[g(x,{to:{name:"MonthlyKpiFormEdit",params:{id:o.id}},class:"btn-icon",title:"Edit"},{default:N(()=>e[33]||(e[33]=[t("i",{class:"far fa-edit"},null,-1)])),_:2,__:[33]},1032,["to"]),t("button",{class:"btn-icon text-red-600 hover:text-red-700",title:"Delete",onClick:async()=>{s.confirm(`Delete form ${o.id}?`)&&(await a(v).deleteForm(o.id),await r())}},e[34]||(e[34]=[t("i",{class:"far fa-trash-alt"},null,-1)]),8,$e)])])]))),128))])]),t("div",Ne,[t("div",Fe,[e[35]||(e[35]=h(" Showing ")),t("span",qe,l((a(n).current_page-1)*a(n).per_page+1),1),e[36]||(e[36]=h(" – ")),t("span",De,l(Math.min(a(n).current_page*a(n).per_page,a(n).total)),1),e[37]||(e[37]=h(" of ")),t("span",Le,l(a(n).total),1)]),t("div",Ue,[t("button",{class:"rounded-md border px-3 py-1 disabled:opacity-50",disabled:!a(R),onClick:e[14]||(e[14]=o=>K(a(n).current_page-1))},"Prev",8,Te),t("span",Be,"Page "+l(a(n).current_page)+" / "+l(a(n).last_page),1),t("button",{class:"rounded-md border px-3 py-1 disabled:opacity-50",disabled:!a(E),onClick:e[15]||(e[15]=o=>K(a(n).current_page+1))},"Next",8,Ke)])])]))])}}};export{He as default};
