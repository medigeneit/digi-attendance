import{u as C,N as E,s as L,r as g,b as I,x as q,o as i,c as v,d as B,v as O,a as r,e as _,t as m,h as k,F as V,q as z,p as F,j as S,m as N,g as G,f as Z,n as K}from"./index-C_QgQvEF.js";import{u as H}from"./leave-application-DUugIzJ0.js";import{u as P}from"./exchange-CxVhTClq.js";import{u as Q}from"./short-leave-uUYx9sds.js";const W={key:0,class:"text-center space-y-2 print:hidden"},X={key:0,class:"mt-2"},Y={class:"flex justify-end gap-2 pt-2"},M={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(j){const f=C(),p=E(),y=P(),{user:x}=L(f),A=j,t=g(null);I(()=>{t.value=JSON.parse(JSON.stringify(A.application))});const u=g(!1),c=g(""),o=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.handoverAccept(a),await l())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.inChargeAccept(a),await l()),alert("In-Charge approved!")}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.recommendByAccept(a),await l())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure to final approval?")&&(await y.approvedByAccept(a),await l())}}],s=q(()=>o.find(a=>{var n,d,b,w;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((b=t.value)!=null&&b[a.approved_field])&&((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id:!1})),h=()=>{u.value&&c.value?(e(),u.value=!1):u.value=!0};async function e(){try{await y.rejectExchange(t.value.id,c.value),alert("Exchange application rejected!"),c.value="",await l(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function l(a){await p.markAsRead(A.notificationId)}return(a,n)=>s.value&&t.value?(i(),v("div",W,[u.value?(i(),v("div",X,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):_("",!0),r("div",Y,[r("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:n[1]||(n[1]=d=>s.value.action(t.value.id))}," Approve "),r("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:h}," Reject ")])])):_("",!0)}},ee={key:0,class:"text-center space-y-2 print:hidden"},ae={key:0,class:"mt-2"},te={class:"flex justify-end gap-2 pt-2"},oe={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(j){const f=C(),p=H(),y=E(),{user:x}=L(f),A=j,t=g(null);I(()=>{t.value=JSON.parse(JSON.stringify(A.application))});const u=g(!1),c=g(""),o=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptHandover(a),await l())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptInCharge(a),await l())}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptCoordinator(a),await l())}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptOperationalAdmin(a),await l())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptRecommendBy(a),await l())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptApprovedBy(a),await l())}}],s=q(()=>o.find(a=>{var b,w,R,$;if(!t.value)return!1;if(a.key==="handover")return a.condition();const n=!!((b=t.value)!=null&&b[a.approved_field]),d=((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id;return((R=t.value)==null?void 0:R.status)!=="Rejected"&&(($=t.value)==null?void 0:$.status)!=="Approved"&&!n&&d})),h=()=>{u.value&&c.value?(e(),u.value=!1):u.value=!0};async function e(){try{await p.rejectLeaveApplication(t.value.id,{rejection_reason:c.value}),alert("Application rejected!"),c.value="",await l(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function l(a){await y.markAsRead(A.notificationId)}return(a,n)=>s.value&&t.value?(i(),v("div",ee,[u.value?(i(),v("div",ae,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):_("",!0),r("div",te,[r("button",{class:"btn-2",onClick:n[1]||(n[1]=d=>s.value.action(t.value.id))},"Approve"),r("button",{class:"btn-1",onClick:h},"Reject")])])):_("",!0)}},ne={key:0,class:"text-center space-y-2 print:hidden"},re={key:0,class:"mt-2"},se={class:"flex justify-end gap-2 pt-2"},ie={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(j){const f=C(),p=Q(),y=E(),{user:x}=L(f),A=j,t=g(null);I(()=>{t.value=JSON.parse(JSON.stringify(A.application))});const u=g(!1),c=g(""),o=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.handoverAccept(a),await l())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.inChargeAccept(a),await l())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.recommendByAccept(a),await l())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.approvedByAccept(a),await l())}}],s=q(()=>o.find(a=>{var n,d,b,w;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((b=t.value)!=null&&b[a.approved_field])&&((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id:!1})),h=()=>{u.value&&c.value?(e(),u.value=!1):u.value=!0};async function e(){try{await p.rejectShortLeave(t.value.id,c.value),alert("Application rejected!"),c.value="",await l(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function l(a){await y.markAsRead(A.notificationId)}return(a,n)=>s.value&&t.value?(i(),v("div",ne,[u.value?(i(),v("div",re,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):_("",!0),r("div",se,[u.value?_("",!0):(i(),v("button",{key:0,class:"btn-2",onClick:n[1]||(n[1]=d=>s.value.action(t.value.id))}," Approve ")),r("button",{class:"btn-1",onClick:h},m(u.value?"Submit":"Reject"),1)])])):_("",!0)}},ce={class:"space-y-6 px-4 py-4"},le={class:"text-2xl font-semibold capitalize text-gray-700"},de={key:0,class:"space-y-4"},pe={class:"flex items-start gap-4"},ue={class:"text-2xl text-blue-500"},_e={class:"flex-1"},ve={class:"text-gray-800 font-medium"},fe={class:"text-gray-800 font-medium"},ye={class:"text-red-600 text-sm font-semibold"},he={key:0,class:"text-xs text-gray-400"},ge={key:0,class:"grid gap-1"},be={class:"flex items-center gap-4"},we=["href"],xe={class:"grow-0 w-full"},Ae={key:0,class:"text-xs font-semibold"},ke={class:"text-xs text-gray-400"},me={key:1,class:"text-center text-red-500 py-10"},Le={__name:"NotificationList",setup(j){G();const f=Z(),p=E(),{notifications:y}=L(p);H();const x=C();L(x),g(!1),g({}),g({}),I(()=>{p.fetchNotifications()});const A=(o,s)=>{if(!o)return"application not found";switch(s){case"leaveApplication":return`Last Office ( ${o.last_working_date} ) → Join Date ( ${o.resumption_date} )`;case"shortLeave":return`Short Leave on ${o.date} form ${c(o.start_time)??"N/A"} to ${o.end_time?c(o.end_time):"N/A"}`;case"exchange":return o.exchange_type==="offday"?`Exchange (Offday): ${o.exchange_date} → ${o.current_date}`:o.exchange_type==="shift"?`Exchange (${o.exchange_type}) on ${o.current_date} (${(o==null?void 0:o.shift_name)??"No Shift"})`:`Exchange (${o.exchange_type})`;case"offday":return o.exchange_type==="offday"?`Exchange (Offday): ${o.exchange_date} → ${o.current_date}`:`Exchange (${o.exchange_type})`;default:return"Unknown Event"}},t=o=>{switch(o){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"exchange":return"fas fa-random";case"offday":return"fas fa-random";default:return"fas fa-bell"}},u=o=>new Date(o).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),c=o=>{const[s,h]=o.split(":").map(Number),e=new Date;return e.setHours(s,h),e.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(o,s)=>{const h=K("RouterLink");return i(),v("div",ce,[r("h2",le,m(k(f).query.type.replace(/([A-Z])/g," $1")),1),k(y)[k(f).query.type]?(i(),v("div",de,[(i(!0),v(V,null,z(k(y)[k(f).query.type],(e,l)=>{var a,n,d,b,w,R,$,J,T,D,U;return i(),v("div",{key:e.id,class:"bg-white p-4 rounded-xl shadow border"},[r("div",pe,[r("div",ue,[r("i",{class:F(t(e.event_type))},null,2)]),r("div",_e,[r("p",ve,m((a=e.event_model)==null?void 0:a.user_name),1),r("p",fe,"Reason: "+m((n=e.event_model)==null?void 0:n.reason),1),r("p",ye,m(A(e.event_model,e.event_type)),1),(d=e==null?void 0:e.event_model)!=null&&d.total_leave_days_without_week?(i(),v("p",he," Total Leave: "+m(e==null?void 0:e.event_model.total_leave_days_without_week)+" days ",1)):_("",!0)]),e!=null&&e.event_model?(i(),v("div",ge,[r("div",be,[e!=null&&e.event_model.attachment?(i(),v("a",{key:0,href:(b=e==null?void 0:e.event_model)==null?void 0:b.attachment,target:"_blank",class:"btn-1"},s[0]||(s[0]=[r("i",{class:"fad fa-link"},null,-1)]),8,we)):_("",!0),k(f).query.type==="leaveApplication"?(i(),S(h,{key:1,to:{name:"LeaveApplicationShow",params:{id:(w=e==null?void 0:e.event_model)==null?void 0:w.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[1]||(s[1]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),k(f).query.type==="shortLeave"?(i(),S(h,{key:2,to:{name:"ShortLeaveShow",params:{id:(R=e==null?void 0:e.event_model)==null?void 0:R.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[2]||(s[2]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),k(f).query.type==="exchange"?(i(),S(h,{key:3,to:{name:(($=e==null?void 0:e.event_model)==null?void 0:$.exchange_type)=="offday"?"ExchangeOffdayShow":"ExchangeShiftShow",params:{id:(J=e==null?void 0:e.event_model)==null?void 0:J.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[3]||(s[3]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),k(f).query.type==="offday"?(i(),S(h,{key:4,to:{name:"ExchangeOffdayShow",params:{id:(T=e==null?void 0:e.event_model)==null?void 0:T.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[4]||(s[4]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0)]),r("div",xe,[(D=e==null?void 0:e.event_model)!=null&&D.type?(i(),v("p",Ae," Type : "+m((U=e==null?void 0:e.event_model)==null?void 0:U.type),1)):_("",!0),r("p",ke,m(u(e.created_at)),1)])])):_("",!0)]),e!=null&&e.event_model&&e.event_type==="leaveApplication"?(i(),S(oe,{key:0,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):_("",!0),e!=null&&e.event_model&&e.event_type==="shortLeave"?(i(),S(ie,{key:1,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):_("",!0),e!=null&&e.event_model&&(e.event_type==="offday"||e.event_type==="offday")?(i(),S(M,{key:2,application:e.event_model,notificationId:e.id},null,8,["application","notificationId"])):_("",!0)])}),128))])):(i(),v("div",me,"No notifications found."))])}}};export{Le as default};
