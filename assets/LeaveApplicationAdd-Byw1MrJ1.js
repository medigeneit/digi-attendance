import{u as N,r as w,p as S,b as R,N as F,c as r,a as t,l as C,m as E,j as H,w as $,d as p,v as f,t as m,e as y,F as k,x as _,A as j,h as L,n as q,o,k as W,g as I}from"./index-Di9HX-FD.js";import{u as Y}from"./leave-application-iYUcPioV.js";import{u as z}from"./leave-type-DS-gTwWS.js";import{u as G}from"./user-B-dFo4G-.js";import{L as J}from"./LoaderView-Co2yz8-O.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"my-container max-w-3xl space-y-4"},O={class:"flex items-center justify-between gap-2"},P={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Q={key:0,class:""},X={class:"text-blue-600 font-medium"},Z={key:1},ee={class:"bg-gray-100 p-2 rounded-md"},te={class:"font-semibold"},ae={class:"flex flex-wrap gap-2"},se=["name","value"],le=["value"],ne={key:2,class:"text-red-500 text-sm"},ve={__name:"LeaveApplicationAdd",setup(oe){const b=I(),h=Y(),x=z(),D=G(),d=N(),s=w({leave_type_id:"",last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:""}),g=w(!1),v=w(null),c=S(()=>{const l=s.value.last_working_date,e=s.value.resumption_date;if(!l||!e)return[];const i=new Date(l),a=new Date(e);if(a<=i)return[];const u=[];let n=new Date(i);for(n.setDate(n.getDate()+1);n<a;){const T=n.getFullYear(),B=(n.getMonth()+1).toString().padStart(2,"0"),M=n.getDate().toString().padStart(2,"0");u.push(`${T}-${B}-${M}`),n.setDate(n.getDate()+1)}return u}),A=S(()=>{const l=s.value.last_working_date,e=s.value.resumption_date;if(!l||!e)return"";const i=new Date(l);return new Date(e)<=i?"Resumption date must be after Last Working Date.":c.value.length===0?"No leave days between the selected dates.":`Total leave days: ${c.value.length}`}),V=async()=>{var l;g.value=!0,v.value=null;try{const e={user_id:(l=d==null?void 0:d.user)==null?void 0:l.id,...s.value},i=await h.storeLeaveApplication(e);b.push({name:"LeaveApplicationShow",params:{id:i.id}})}catch(e){v.value=e.message||"Failed to submit leave application"}finally{g.value=!1}};R(()=>{F(()=>{var e;const l=(e=d==null?void 0:d.user)==null?void 0:e.company_id;l&&x.fetchLeaveTypes(l)}),D.fetchUsers()});const U=()=>{b.go(-1)};return(l,e)=>{const i=q("RouterLink");return o(),r("div",K,[t("div",O,[t("button",{class:"btn-3",onClick:U},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),t("div",null,[C(i,{to:"/my-applications",class:"btn-2"},{default:E(()=>e[6]||(e[6]=[W("Home")])),_:1})])]),g.value?(o(),H(J,{key:0})):(o(),r("form",{key:1,onSubmit:$(V,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[t("div",P,[t("div",null,[e[8]||(e[8]=t("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),p(t("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=a=>s.value.last_working_date=a),class:"input-1 w-full",required:""},null,512),[[f,s.value.last_working_date]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),p(t("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=a=>s.value.resumption_date=a),class:"input-1 w-full",required:""},null,512),[[f,s.value.resumption_date]])])]),s.value.last_working_date&&s.value.resumption_date?(o(),r("div",Q,[t("p",X,m(A.value),1)])):y("",!0),c.value.length?(o(),r("div",Z,[e[10]||(e[10]=t("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),t("div",ee,[(o(!0),r(k,null,_(c.value,(a,u)=>(o(),r("div",{key:u,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[t("div",te,m(a),1),t("div",ae,[(o(!0),r(k,null,_(L(x).leaveTypes,n=>(o(),r("label",{key:n.id,class:"flex items-center space-x-1"},[t("input",{type:"radio",name:"leaveType-"+u,value:n.id},null,8,se),t("span",null,m(n.name),1)]))),128))])]))),128))])])):y("",!0),t("div",null,[e[11]||(e[11]=t("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),p(t("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.reason=a),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[f,s.value.reason]])]),t("div",null,[e[12]||(e[12]=t("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),p(t("textarea",{id:"works-in-hand","onUpdate:modelValue":e[3]||(e[3]=a=>s.value.works_in_hand=a),class:"input-1 w-full",placeholder:"Enter details of works in hand"},null,512),[[f,s.value.works_in_hand]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),p(t("select",{id:"handover-user","onUpdate:modelValue":e[4]||(e[4]=a=>s.value.handover_user_id=a),class:"input-1 w-full",required:""},[e[13]||(e[13]=t("option",{value:""},"Select Handover User",-1)),(o(!0),r(k,null,_(L(D).users,a=>(o(),r("option",{key:a.id,value:a.id},m(a==null?void 0:a.name),9,le))),128))],512),[[j,s.value.handover_user_id]])]),v.value?(o(),r("div",ne,m(v.value),1)):y("",!0),e[15]||(e[15]=t("div",{class:"flex justify-end"},[t("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{ve as default};
