import{_ as xe,g as ge,D as ve,f as be,u as he,G as _e,r as le,x as y,q,h as we,c as i,o as a,a as e,k as b,j as ke,w as C,l as re,v as ae,t as r,n as E,d as U,m as K,b as I,F as A,e as W,N as de,s as Ie}from"./index-CEefkZR2.js";import{_ as De}from"./EmployeeFilter-CmRMEUy_.js";import{L as Oe}from"./LoaderView-ogd5Bevp.js";import{U as Te}from"./UserChip-DTkJIjfw.js";import{g as ie,m as Ne,c as Me,b as z,a as Q}from"./datetime-Du_mcDA9.js";import{j as Ce}from"./url-Buz9GlSr.js";import{u as Ee}from"./useTodoDateStore-Dp55o8zv.js";import"./company-DQyFVY6H.js";import"./department-DfmO9SeQ.js";import"./EmployeeDropdownInput-CnTzTzBr.js";import"./SelectDropdown-CON2EJFi.js";import"./user-_PNzAIDG.js";const Se={class:"container mx-auto print:w-full print:px-0 print:py-0"},Pe={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},Re={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},je={key:0,class:"relative h-[32px] flex gap-1 ml-auto justify-end print:hidden"},Le={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Ue={key:1,class:"text-gray-400"},Ae=["disabled"],Be={key:0,class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0 shadow-sm"},Ge={class:"flex flex-wrap items-center gap-3"},Fe={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Ve={class:"relative h-[32px] flex"},$e={key:0,class:"text-xs text-blue-600 flex items-center gap-2 w-full md:w-auto md:ml-auto"},qe={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},Ke={key:3,class:"space-y-4"},We={key:0,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},ze={class:"text-sm text-gray-700"},Qe={class:"font-semibold"},Ye={class:"text-sm text-gray-700"},He={class:"font-semibold"},Je={class:"text-sm text-gray-700"},Xe={class:"font-semibold text-green-600"},Ze={class:"text-sm text-gray-700"},et={class:"font-semibold text-blue-600"},tt={class:"text-sm text-gray-700"},st={class:"font-semibold text-amber-600"},nt={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},ot={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},lt={key:0,class:"flex items-center gap-3"},rt={class:"font-semibold text-gray-800"},at=["href"],dt={class:"text-xs text-gray-500"},it={class:"text-[11px] text-blue-800"},ut={key:0,class:"font-bold"},pt={key:1,class:"flex items-center gap-3"},mt={class:"font-semibold text-gray-800"},ct={class:"text-xs text-gray-500"},yt={class:"text-[11px] text-blue-800"},ft={key:0,class:"font-bold"},xt={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},gt={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},vt={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},bt={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},ht={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},_t={class:"overflow-x-auto"},wt={class:"min-w-full text-left text-sm border-separate border-spacing-0"},kt={key:0},It={class:"bg-gray-100/50"},Dt={colspan:"4",class:"px-4 py-2 border font-bold text-blue-800 text-xs uppercase tracking-wider"},Ot={class:"ml-2 font-normal text-gray-500"},Tt={class:"px-4 py-3 text-center border"},Nt={class:"px-4 py-3 border"},Mt={class:"font-semibold text-gray-800"},Ct={class:"text-xs text-gray-500"},Et={class:"px-4 py-3 border text-xs text-gray-700"},St={class:"px-4 py-3 border text-center"},Pt={__name:"PersonalActivityReportView",props:{selfOnly:{type:Boolean,default:!1}},setup(B){const m=B,S=Ee(),ue=ge(),{user:D}=ve(ue),P=be(),pe=he(),o=_e({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),d=le(""),Y=le(null),O=y(()=>{if(!d.value)return"";const[s,t]=d.value.split("-").map(Number);return!s||!t?"":ie(new Date(s,t-1,1))}),T=y(()=>{if(!d.value)return"";const[s,t]=d.value.split("-").map(Number);return!s||!t?"":ie(Ne(new Date(s,t-1,1)))}),G=y(()=>d.value?Me(`${d.value}-01`):""),k=y(()=>O.value&&T.value?`${z(O.value)} ~ ${z(T.value)}`:""),F=y(()=>{var s;return m.selfOnly?((s=D.value)==null?void 0:s.company_id)||"":o.companyId}),H=y(()=>!O.value||!T.value?!1:m.selfOnly?!!h.value&&!!F.value:!!F.value),J=y(()=>S.todo_dates||[]),h=y(()=>{var s;return(s=D.value)!=null&&s.id?String(D.value.id):""});function me(s){o.companyId=s.company_id||"",o.departmentId=s.department_id||"",o.employeeId=m.selfOnly?h.value:s.employee_id||"",o.lineType=s.line_type||"all"}function ce(s){return s==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":s==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":s==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"}function X(s){var t,n;return s.todo_id||s.todoId||((t=s.todo)==null?void 0:t.id)||((n=s.todo)==null?void 0:n.todo_id)||s.id||`${s.title}-${s.date}`}const Z=y(()=>{var x;if(m.selfOnly&&D.value)return[D.value];const s=((x=Y.value)==null?void 0:x.employees)||[];if(s.length)return s;const t=[],n=new Set;return J.value.forEach(g=>{const v=g.user;if(!v||!v.id)return;const _=String(v.id);n.has(_)||(n.add(_),t.push(v))}),t}),ye=y(()=>o.employeeId?Z.value.filter(s=>String(s.id)===String(o.employeeId)):Z.value),R=y(()=>ye.value.map(s=>{const t=J.value.filter(l=>{var u;return String(((u=l.user)==null?void 0:u.id)??l.user_id)===String(s.id)}),n={};for(const l of t){const u=X(l),c=n[u],f=new Date(l.date),p=c?new Date(c.date):null;(!c||p&&f>p)&&(n[u]=l)}const x={WORKING:1,PENDING:2,DEPENDANT:3,COMPLETED:4,BACK_LOG:5},g=Object.values(n).sort((l,u)=>{const c=new Date(l.date).getTime(),f=new Date(u.date).getTime();if(c!==f)return f-c;const p=x[l.status]||999,w=x[u.status]||999;return p!==w?p-w:(l.priority||0)-(u.priority||0)}),v=g.reduce((l,u)=>{var p,w,N,M;const c=((w=(p=u.todo)==null?void 0:p.todo_project)==null?void 0:w.id)||"others",f=((M=(N=u.todo)==null?void 0:N.todo_project)==null?void 0:M.title)||"Others";return l[c]||(l[c]={id:c,name:f,todos:[]}),l[c].todos.push(u),l},{}),_=Object.values(v).sort((l,u)=>l.id==="others"?1:u.id==="others"?-1:l.name.localeCompare(u.name)),L={total:g.length,completed:g.filter(l=>l.status==="COMPLETED").length,working:g.filter(l=>l.status==="WORKING").length,pending:g.filter(l=>l.status==="PENDING").length};return{user:s,projects:_,totals:L}}).sort((s,t)=>{var n,x;return(((n=s.user)==null?void 0:n.name)||"").localeCompare(((x=t.user)==null?void 0:x.name)||"")})),j=y(()=>R.value.reduce((s,t)=>({totalTodos:s.totalTodos+t.totals.total,completed:s.completed+t.totals.completed,working:s.working+t.totals.working,pending:s.pending+t.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));function ee(){console.log("syncQuery",o),pe.replace({query:{...P.query,month:d.value||void 0,...m.selfOnly?{}:{company_id:o.companyId||void 0,department_id:o.departmentId||void 0,employee_id:o.employeeId||void 0,line_type:o.lineType||void 0}}})}async function V(){H.value&&await S.fetchTodoDates({"company-id":F.value||void 0,"department-id":m.selfOnly?void 0:o.departmentId,"employee-id":m.selfOnly?h.value:o.employeeId,"line-type":m.selfOnly?void 0:o.lineType,"start-date":O.value,"end-date":T.value})}function $(){m.selfOnly&&h.value&&(o.employeeId=h.value)}function te(){const s=P.query||{};d.value=typeof s.month=="string"&&s.month?s.month:d.value||Q(new Date),o.companyId=m.selfOnly?"":s.company_id||"",o.departmentId=m.selfOnly?"":s.department_id||"",o.employeeId=m.selfOnly?h.value:s.employee_id||"",o.lineType=m.selfOnly?"all":s.line_type||"all",$()}q(()=>[o.companyId,o.departmentId,o.employeeId,o.lineType,O.value,T.value,d.value],()=>{$(),ee(),V()}),q(()=>P.query,()=>{te()}),q(h,()=>{$(),ee(),V()}),we(()=>{d.value=d.value||Q(new Date),te(),V()});function fe(){window.print()}function se(s){const t=d.value?new Date(`${d.value}-01`):new Date;t.setMonth(t.getMonth()+s),d.value=Q(t)}function ne(){se(-1)}function oe(){se(1)}return(s,t)=>(a(),i("div",Se,[e("div",Pe,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),e("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),e("span",Re,[m.selfOnly?(a(),i("div",je,[e("button",{class:"btn-3 h-[32px] px-3",onClick:C(ne,["prevent"])},t[6]||(t[6]=[e("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),e("div",Le,[t[7]||(t[7]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),re(e("input",{id:"month",type:"month","onUpdate:modelValue":t[0]||(t[0]=n=>d.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ae,d.value]])]),e("button",{class:"btn-3 h-[32px] px-3",onClick:C(oe,["prevent"])},t[8]||(t[8]=[e("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])):b("",!0),t[9]||(t[9]=e("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),e("span",null,r(G.value),1),k.value?(a(),i("span",Ue,"("+r(k.value)+")",1)):b("",!0)]),e("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:C(fe,["prevent"]),disabled:E(S).loading,title:"Print"},t[10]||(t[10]=[e("i",{class:"fas fa-print"},null,-1)]),8,Ae)]),m.selfOnly?b("",!0):(a(),i("div",Be,[e("div",Ge,[U(De,{ref_key:"employeeFilterRef",ref:Y,company_id:o.companyId,"onUpdate:company_id":t[2]||(t[2]=n=>o.companyId=n),department_id:o.departmentId,"onUpdate:department_id":t[3]||(t[3]=n=>o.departmentId=n),employee_id:o.employeeId,"onUpdate:employee_id":t[4]||(t[4]=n=>o.employeeId=n),line_type:o.lineType,"onUpdate:line_type":t[5]||(t[5]=n=>o.lineType=n),"initial-value":E(P).query,onFilterChange:me,class:"flex-1 min-w-[240px]"},{default:K(()=>[e("div",Fe,[e("button",{class:"btn-3 h-[32px] px-3",onClick:C(ne,["prevent"])},t[12]||(t[12]=[e("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),e("div",Ve,[t[13]||(t[13]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),re(e("input",{id:"month",type:"month","onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ae,d.value]])]),e("button",{class:"btn-3 h-[32px] px-3",onClick:C(oe,["prevent"])},t[14]||(t[14]=[e("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),m.selfOnly?(a(),i("div",$e,[t[15]||(t[15]=e("i",{class:"fas fa-user-lock"},null,-1)),I(" Showing only my todos (Employee ID: "+r(h.value||"loading...")+") ",1)])):b("",!0)])])),H.value?E(S).loading?(a(),ke(Oe,{key:2},{default:K(()=>t[17]||(t[17]=[I("Loading report...")])),_:1,__:[17]})):(a(),i("div",Ke,[B.selfOnly?b("",!0):(a(),i("div",We,[e("div",ze,[t[18]||(t[18]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",Qe,r(R.value.length),1)]),e("div",Ye,[t[19]||(t[19]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),e("div",He,r(j.value.totalTodos),1)]),e("div",Je,[t[20]||(t[20]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),e("div",Xe,r(j.value.completed),1)]),e("div",Ze,[t[21]||(t[21]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),e("div",et,r(j.value.working),1)]),e("div",tt,[t[22]||(t[22]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),e("div",st,r(j.value.pending),1)])])),R.value.length===0?(a(),i("div",nt," No data available for the selected month. ")):b("",!0),(a(!0),i(A,null,W(R.value,(n,x)=>{var g,v,_,L,l,u,c;return a(),i("div",{key:((g=n.user)==null?void 0:g.id)||x,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[e("div",ot,[B.selfOnly?(a(),i("div",pt,[U(de,{user:n.user,size:"medium"},null,8,["user"]),e("div",null,[e("div",mt,r(((l=n.user)==null?void 0:l.name)||"Unknown user"),1),e("div",ct,r(((c=(u=n.user)==null?void 0:u.department)==null?void 0:c.name)||"-"),1),e("div",yt,[I(" Month: "+r(G.value)+" ",1),k.value?(a(),i("span",ft,"("+r(k.value)+")",1)):b("",!0)])])])):(a(),i("div",lt,[U(Te,{user:n.user},{trigger:K(()=>[U(de,{user:n.user,size:"medium"},null,8,["user"])]),_:2},1032,["user"]),e("div",null,[e("div",rt,[e("a",{href:E(Ce)(n.user,d.value),target:"_blank",rel:"noopener",class:"inline-flex hover:underline"},[e("div",null,[I(r(((v=n.user)==null?void 0:v.name)||"Unknown user")+" ",1),t[23]||(t[23]=e("i",{class:"far fa-external-link-alt print:hidden"},null,-1))])],8,at)]),e("div",dt,r(((L=(_=n.user)==null?void 0:_.department)==null?void 0:L.name)||"-"),1),e("div",it,[I(" Month: "+r(G.value)+" ",1),k.value?(a(),i("span",ut,"("+r(k.value)+")",1)):b("",!0)])])])),e("div",xt,[e("span",gt," Total "+r(n.totals.total),1),e("span",vt," Done "+r(n.totals.completed),1),e("span",bt," Working "+r(n.totals.working),1),e("span",ht," Pending "+r(n.totals.pending),1)])]),e("div",_t,[e("table",wt,[t[26]||(t[26]=e("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[e("tr",{class:"border-b"},[e("th",{class:"px-4 py-3 border text-center w-12"},"sl"),e("th",{class:"px-4 py-3 border text-left"},"Todo"),e("th",{class:"px-4 py-3 border text-left"},"Last Activity"),e("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),e("tbody",null,[n.projects.length===0?(a(),i("tr",kt,t[24]||(t[24]=[e("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-400 border rounded-b"}," No activity recorded for this month. ",-1)]))):b("",!0),(a(!0),i(A,null,W(n.projects,f=>(a(),i(A,{key:f.id},[e("tr",It,[e("td",Dt,[t[25]||(t[25]=e("i",{class:"fas fa-project-diagram mr-2"},null,-1)),I(" "+r(f.name)+" ",1),e("span",Ot,"("+r(f.todos.length)+" todos)",1)])]),(a(!0),i(A,null,W(f.todos,(p,w)=>{var N,M;return a(),i("tr",{key:X(p),class:"border-b"},[e("td",Tt,r(w+1),1),e("td",Nt,[e("div",Mt,r(p.title),1),e("div",Ct,r(((M=(N=p.todo)==null?void 0:N.todoable)==null?void 0:M.title)||""),1)]),e("td",Et,r(E(z)(p.date)||p.date),1),e("td",St,[e("div",{class:Ie(["inline-block text-xs font-semibold px-2.5 py-1 rounded-full whitespace-nowrap",ce(p.status)])},r(p.status==="WORKING"?"IN PROGRESS":p.status||"N/A"),3)])])}),128))],64))),128))])])])])}),128))])):(a(),i("div",qe,t[16]||(t[16]=[e("i",{class:"fad fa-tasks text-4xl"},null,-1),e("div",{class:"empty-state glass-panel"},[e("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),e("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)])))]))}},Wt=xe(Pt,[["__scopeId","data-v-87aaaf3d"]]);export{Wt as default};
