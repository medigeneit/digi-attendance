import{L as Q}from"./LoaderView-DzHiIcn8.js";import{r as j,x as U,e as V,A as H,c as m,o as a,J as L,a as e,F as A,y as q,t as S,g,w as $,q as B,n as P,f as _,G as ae,i as R,k as T,d as te,m as ie,j as z,H as oe,I as pe,K as ve,T as fe,h as de,v as re,U as K,V as Y}from"./index-XVuZyahg.js";import{f as ge,h as be,b as X,g as J,i as he,j as ke}from"./datetime-BixRpIok.js";import{u as G}from"./useTodoStore-BgX1kPwK.js";import{_ as xe}from"./DraggableList.vue_vue_type_script_setup_true_lang-xhLAgrPX.js";import{_ as we}from"./UserChip-C-UXiN3x.js";import{O as ee}from"./OverlyModal-Bw5OLpXF.js";import{u as Ce}from"./useTaskStore-DZ1ggQF6.js";const $e={class:"grid grid-cols-7 *:text-center *:p-2 *:border-r *:border-b *:text-blue-800 *:text-sm"},De={class:"flex flex-col"},Te={key:0,class:"p-2 border-r border-t"},Se={__name:"CalenderView",props:{month:{type:String,required:!0,validator:o=>/^\d{4}-(0[1-9]|1[0-2])$/.test(o)}},emits:["change"],setup(o,{emit:D}){const d=o,n=D,y=j(),t=j(),r=j(),v=j(),l=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function u(x,i,h,C){const w=[];for(let N=h-1;N>=0;N--){const f=C-N,M=new Date(x,i-1,f);w.push({date:M,day:M.getDate(),month:M.getMonth()+1,year:M.getFullYear(),isCurrentMonth:!1})}return w}function b(x,i,h){const C=[];for(let w=1;w<=h;w++){const f={date:new Date(x,i,w),day:w,month:i+1,year:x,isCurrentMonth:!0};C.push(f)}return C}function p(x,i,h){const C=[...x],w=Math.ceil(C.length/7)*7,N=1;for(let f=0;C.length<w;f++){const M=new Date(i,h+1,N+f);C.push({date:M,day:M.getDate(),month:M.getMonth()+1,year:M.getFullYear(),isCurrentMonth:!1})}return C}function s(x,i){const h=new Date(x,i,1),w=new Date(x,i+1,0).getDate(),f=(h.getDay()+1)%7,E=new Date(x,i,0).getDate();let O=[];O=[...u(x,i,f,E)];const F=b(x,i,w);return r.value=F[0],v.value=F[F.length-1],O=[...O,...F],O=[...p(O,x,i)],y.value=O[0],t.value=O[O.length-1],O}const c=U(()=>{const[x,i]=d.month.split("-"),h=parseInt(x),C=parseInt(i)-1;return console.log({yearStr:x,monthStr:i}),s(h,C)}),k=U(()=>{const x=c.value,i=[];for(let h=0;h<x.length;h+=7)i.push(x.slice(h,h+7));return i});function I(){n("change",{gridStartDate:y.value,gridEndDate:t.value,startOfMonth:r.value,endOfMonth:v.value})}return V(()=>I()),H(()=>d.month,I),(x,i)=>(a(),m("div",null,[L(x.$slots,"calender-top"),e("div",$e,[(a(),m(A,null,q(l,h=>e("div",{key:h},S(h),1)),64))]),e("div",De,[(a(!0),m(A,null,q(k.value,(h,C)=>(a(),m("div",{class:"week grid grid-cols-7 min-h-28 items-stretch",key:C},[(a(!0),m(A,null,q(h,(w,N)=>L(x.$slots,"date",{key:N,day:w.day,month:w.month,year:w.year,weekday:(w.date.getDay()+1)%7,isCurrentMonth:w.isCurrentMonth,yearMonthDate:`${w.year}-${String(w.month).padStart(2,"0")}-${String(w.day).padStart(2,"0")}`},()=>{var f;return[w!=null&&w.date?(a(),m("div",Te,S((f=w==null?void 0:w.date)==null?void 0:f.getDate()),1)):g("",!0)]})),128))]))),128))]),L(x.$slots,"calender-bottom")]))}},Ie={class:"px-4 py-2 flex items-center lg:justify-start flex-wrap bg-gray-50 group md:gap-x-2 gap-y-4"},Me=["disabled"],Ee=["value"],Re=["value"],Oe={key:2,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},Ne=["value"],Le={key:3,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},je=["value"],Pe={__name:"TodoHeading",props:{selected:{type:Object,default:()=>({type:"month-view",month:"",day:"",year:"",week:""})},loading:{type:Boolean,default:!1}},emits:["reloadClick",,"change"],setup(o,{emit:D}){const d=o,n=[{value:"month-view",label:"Monthly"},{value:"day-view",label:"Daily"}],y=D,t=j();function r(i){t.value=i,y("change",{...d.selected,type:i})}H(()=>{var i;return(i=d.selected)==null?void 0:i.type},i=>r(i),{immediate:!0});const v=U(()=>t.value=="month-view"&&d.selected.year&&d.selected.month?[d.selected.year,d.selected.month-1,1]:t.value=="day-view"&&d.selected.year&&d.selected.month&&d.selected.day?[d.selected.year,d.selected.month-1,d.selected.day]:[new Date().getFullYear(),new Date().getMonth(),new Date().getDate()]);function l(){t.value=="month-view"&&k(new Date)}function u(){if(t.value=="month-view"){const i=new Date(...v.value);i.setMonth(i.getMonth()+1),k(i)}}function b(){if(t.value=="month-view"){const i=new Date(...v.value);i.setMonth(i.getMonth()-1),k(i)}}function p(){t.value=="day-view"&&k(new Date)}function s(){if(t.value=="day-view"){const i=new Date(...v.value);i.setDate(i.getDate()+1),k(i)}}function c(){if(t.value=="day-view"){const i=new Date(...v.value);i.setDate(i.getDate()-1),k(i)}}function k(i){y("change",{type:t.value,month:i.getMonth()+1,day:i.getDate(),year:i.getFullYear(),week:i.getDay()})}const I=U(()=>t.value=="month-view"?`${d.selected.year}-${d.selected.month.toString().padStart(2,"0")}`:t.value=="day-view"?`${d.selected.year}-${d.selected.month.toString().padStart(2,"0")}-${d.selected.day.toString().padStart(2,"0")}`:d.selected),x=i=>{var h,C;if(t.value=="month-view"){const[w,N]=(h=i.target.value)==null?void 0:h.split("-").map(Number),f=new Date(w,N-1,1);k(f)}if(t.value=="day-view"){const w=new Date((C=i.target)==null?void 0:C.value);k(w)}};return(i,h)=>(a(),m("div",null,[e("div",Ie,[L(i.$slots,"before",{selected:o.selected}),e("button",{class:B(["px-2 py-2 disabled:text-gray-300 border size-[32px] flex items-center justify-center rounded-full",{"animate-spin !bg-opacity-0":o.loading}]),onClick:h[0]||(h[0]=$(C=>y("reloadClick"),["prevent"])),disabled:o.loading},[e("i",{class:B(["fas fa-redo",[o.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,Me),L(i.$slots,"typeSelection",{selected:o.selected,types:n,changeType:r},()=>[e("select",{class:"px-2 h-7 border rounded",value:t.value,onChange:h[1]||(h[1]=C=>r(C.target.value))},[(a(),m(A,null,q(n,C=>e("option",{value:C.value,key:C.id},S(C.label),9,Re)),64))],40,Ee)]),t.value=="month-view"?(a(),m("button",{key:0,class:"h-7",onClick:$(l,["prevent"])})):g("",!0),t.value=="day-view"?(a(),m("button",{key:1,class:"h-7",onClick:$(p,["prevent"])})):g("",!0),L(i.$slots,"inner",{selected:o.selected}),t.value=="month-view"?(a(),m("div",Oe,[e("button",{class:"btn-3 px-3 rounded h-7",onClick:$(b,["prevent"])},h[2]||(h[2]=[e("span",{class:"fas fa-arrow-left"},null,-1)])),t.value=="month-view"?(a(),m("input",{key:0,type:"month",value:I.value,onInput:x,class:"border-2 px-2 rounded border-blue-900"},null,40,Ne)):g("",!0),e("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:$(u,["prevent"])},h[3]||(h[3]=[e("span",{class:"fas fa-arrow-right"},null,-1)]))])):g("",!0),t.value=="day-view"?(a(),m("div",Le,[e("button",{class:"btn-3 px-3 rounded h-7",onClick:$(c,["prevent"])},h[4]||(h[4]=[e("span",{class:"fas fa-arrow-left"},null,-1)])),t.value=="day-view"?(a(),m("input",{key:0,type:"date",value:I.value,onInput:x,class:"border-2 px-2 rounded border-blue-900 w-28"},null,40,je)):g("",!0),e("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:$(s,["prevent"])},h[5]||(h[5]=[e("span",{class:"fas fa-arrow-right"},null,-1)]))])):g("",!0),L(i.$slots,"after",{selected:o.selected})]),L(i.$slots,"bottom",{selected:o.selected})]))}},_e={key:0,class:"fa fa-exclamation-square",title:"Pending"},Ue={key:1,class:"fa fa-pause",title:"Working"},Fe={key:2,class:"fa fa-check-square",title:"Completed"},ne={__name:"TodoStatusIcon",props:{todo:{type:Object,required:!0}},setup(o){const D=o,d=U(()=>{switch(D.todo.status){case"PENDING":return"text-red-400";case"WORKING":return"text-yellow-600";case"COMPLETED":return"text-green-400"}return""});return(n,y)=>(a(),m("span",{class:B(d.value)},[o.todo.status=="PENDING"?(a(),m("i",_e)):g("",!0),o.todo.status=="WORKING"?(a(),m("i",Ue)):g("",!0),o.todo.status=="COMPLETED"?(a(),m("i",Fe)):g("",!0)],2))}},ze=["title","onClick"],Ae={class:"line-clamp-1"},Be={key:0,class:"text-purple-600 text-center"},ue={__name:"TodosInDate",props:{date:{type:String,required:!0},maxItems:{type:[Number,String],default:3}},emits:["clickTodo"],setup(o,{emit:D}){const d=o,n=D,{getTodosByDate:y}=G(),t=U(()=>{let r=[],v=!1,l=[];if(typeof y=="function"){const u=y(d.date);if(l=Array.isArray(u)?u:[],d.maxItems==="all")return{all:l,items:l,moreItemsCount:0};r=l.slice(0,d.maxItems),v=l.length-r.length}return{all:l,items:r,moreItemsCount:v}});return(r,v)=>(a(),m("div",null,[t.value.items.length===0?L(r.$slots,"noTodos",{key:0},()=>[v[0]||(v[0]=e("div",{class:"text-gray-400 text-center"},"No todos",-1))]):(a(),m(A,{key:1},[L(r.$slots,"todoItems",{todos:t.value.items,allTodos:t.value.items,moreItemsCount:t.value.moreItemsCount},()=>[(a(!0),m(A,null,q(t.value.items,l=>L(r.$slots,"todoItem",{key:l.id,todo:l,moreItemsCount:t.value.moreItemsCount},()=>{var u,b,p,s;return[e("div",{title:`${l==null?void 0:l.title} ${l!=null&&l.user?`
by:`:""} ${(u=l==null?void 0:l.user)==null?void 0:u.name} ${(b=l==null?void 0:l.user)!=null&&b.department?`
DEPT:`:""} ${(s=(p=l.user)==null?void 0:p.department)==null?void 0:s.name}`,class:B(["px-1 mb-2 text-sm rounded cursor-pointer flex items-center gap-2",{"bg-sky-50 text-sky-900 hover:bg-sky-700 hover:text-white border border-sky-300":l.status!=="COMPLETED","bg-green-500 text-white":l.status==="COMPLETED"}]),onClick:$(c=>n("clickTodo",l),["prevent","stop"])},[P(ne,{todo:l,class:B(["text-sm",[l.status=="COMPLETED"?"!text-white":""]])},null,8,["todo","class"]),e("div",Ae,S(l.title),1),l.user?(a(),_(ae,{key:0,user:l.user,size:"xsmall",class:"ml-auto"},null,8,["user"])):g("",!0)],10,ze)]})),128))]),t.value.moreItemsCount>0?(a(),m("div",Be," + "+S(t.value.moreItemsCount)+" more todo"+S(t.value.moreItemsCount>1?"s":""),1)):g("",!0)],64))]))}},We={class:"relative"},qe=["onClick","onKeypress"],Ge={class:"flex items-center justify-center"},He=["onClick"],Ve={__name:"TodosInCalenderView",props:{month:{type:String,required:!0,validator:o=>/^\d{4}-(0[1-9]|1[0-2])$/.test(o)}},emits:["dateClick","clickTodo","clickDateCell"],setup(o,{emit:D}){const d=D;function n(t,r){t.isTrusted&&t.ctrlKey&&t.which==10&&d("dateClick",r)}function y(t){const[r,v,l]=String(t).split("-").map(Number),u=new Date(r,v-1,l);return be(u)}return(t,r)=>(a(),m("div",We,[o.month?(a(),_(Se,{key:0,month:o.month,class:"border-t border-blue-200/50 relative"},{date:R(({day:v,month:l,yearMonthDate:u,isCurrentMonth:b})=>[e("div",{tabindex:"0",class:B(["border p-4 cursor-pointer group/date relative focus:outline-slate-400",{"bg-sky-50   border-sky-300 focus:bg-sky-50 focus:outline-sky-400":y(u),"hover:bg-slate-50  hover:border-slate-300 focus:bg-slate-50 ":!y(u)}]),onClick:$(p=>d("dateClick",u),["prevent","stop"]),onKeypress:$(p=>n(p,u),["prevent"])},[e("button",{tabindex:"1",class:B([{"text-gray-300 hover:bg-sky-200  hover:text-white":!b,"text-sky-400 hover:bg-sky-200":b},"text-center mb-2 font-semibold w-full rounded"])},S(v)+" "+S(b?"":T(ge)(l-1)),3),e("div",null,[P(ue,{date:u,onClickTodo:r[0]||(r[0]=p=>d("clickTodo",p))},{noTodos:R(()=>r[1]||(r[1]=[e("span",null,null,-1)])),_:2},1032,["date"])]),e("div",Ge,[e("button",{onClick:$(p=>d("clickDateCell",u),["prevent","stop"]),class:"btn-3 !py-1 invisible group-hover/date:visible text-sm text-red-800/40"},r[2]||(r[2]=[e("i",{class:"fas fa-plus"},null,-1),e("span",{class:"hidden lg:inline whitespace-nowrap"}," Add todo ",-1)]),8,He)])],42,qe)]),_:1},8,["month"])):g("",!0)]))}},Ke={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},ce={__name:"DepartmentChip",props:{department:Object},setup(o){return(D,d)=>{var n;return a(),m("div",Ke,S((n=o.department)==null?void 0:n.name),1)}}},Ye={class:""},Je={key:0,class:"mt-1 flex items-center gap-2"},Qe={key:0,class:"line-clamp-2 text-gray-500 whitespace-nowrap mr-2"},Xe={class:"md:ml-auto w-full md:w-auto flex items-center justify-center gap-2"},Ze={key:0,class:"flex items-center gap-1 text-red-600"},et={__name:"TodoItemCard",props:{todo:{type:Object,required:!0},hideDepartment:{type:Boolean,default:!1},hideUser:{type:Boolean,default:!1},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","clickDelete","clickChangeStatus","clickDelete"],setup(o,{emit:D}){const d=te(),n=D;return(y,t)=>{var v,l,u;const r=ie("RouterLink");return a(),m("div",{class:B(["px-4 py-4 md:py-2 cursor-pointer flex flex-wrap items-center gap-y-2 gap-x-4",{"bg-green-100":o.todo.status=="COMPLETED","hover:bg-gray-50":o.todo.status!="COMPLETED"}]),onClick:t[4]||(t[4]=$(b=>n("clickTodo",o.todo),["prevent"]))},[P(ne,{todo:o.todo},null,8,["todo"]),e("div",Ye,[e("div",{class:B(["line-clamp-1",{"text-green-800":o.todo.status=="COMPLETED","text-blue-800":o.todo.status!="COMPLETED"}])},S(o.todo.id)+" - "+S(o.todo.title),3),o.todo.user?(a(),m("div",Je,[o.hideUser?g("",!0):(a(),_(we,{key:0,user:o.todo.user,"avatar-size":"xsmall"},null,8,["user"])),o.hideDepartment?g("",!0):(a(),_(ce,{key:1,department:(l=(v=o.todo)==null?void 0:v.user)==null?void 0:l.department},null,8,["department"]))])):g("",!0)]),o.todo.todo_type&&o.todo.todo_type_id?(a(),m("div",Qe,[z(S(o.todo.todo_type)+" id: ",1),P(r,{class:"text-blue-600 font-semibold underline hover:text-sky-400",onClick:$(b=>null,["stop"]),to:{name:o.userRole=="employee"?"MyTaskShow":"TaskShow",params:{id:o.todo.todo_type_id}}},{default:R(()=>[t[5]||(t[5]=e("i",{class:"fas fa-link"},null,-1)),z(" "+S(o.todo.todo_type_id),1)]),_:1,__:[5]},8,["to"])])):g("",!0),e("div",Xe,[o.todo.status=="WORKING"?(a(),m("div",Ze,t[6]||(t[6]=[e("span",{class:"fas fa-circle animate-pulse text-xs"},null,-1),e("span",{class:"text-xs"},"Working",-1)]))):g("",!0),o.todo.user_id===((u=T(d).user)==null?void 0:u.id)?(a(),m(A,{key:1},[o.todo.status==="WORKING"?(a(),m("button",{key:0,title:"Mark as Completed",class:"btn-icon bg-transparent text-green-400 border-green-400 border hover:bg-green-400 hover:text-white",onClick:t[0]||(t[0]=$(()=>n("clickChangeStatus",o.todo,"COMPLETED"),["prevent","stop"]))},t[7]||(t[7]=[e("i",{class:"fas fa-check"},null,-1)]))):g("",!0),o.todo.status==="PENDING"?(a(),m("button",{key:1,title:"Start Working",class:"btn-icon bg-transparent text-red-400 border-red-400 border hover:bg-red-400 hover:text-white",onClick:t[1]||(t[1]=$(()=>n("clickChangeStatus",o.todo,"WORKING"),["prevent","stop"]))},t[8]||(t[8]=[e("i",{class:"fas fa-play ml-[4px]"},null,-1)]))):g("",!0),e("button",{class:"btn-icon bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:t[2]||(t[2]=$(b=>n("clickEdit",o.todo),["prevent","stop"]))},t[9]||(t[9]=[e("i",{class:"fas fa-pen"},null,-1)])),e("button",{class:"btn-icon bg-red-400 text-white hover:bg-red-600 hover:text-white",onClick:t[3]||(t[3]=$(()=>n("clickDelete",o.todo),["prevent","stop"]))},t[10]||(t[10]=[e("i",{class:"fas fa-trash-alt"},null,-1)]))],64)):g("",!0),e("button",{onClick:$(()=>null,["stop","prevent"]),class:"btn-icon bg-gray-400 text-white hover:bg-gray-600 hover:text-white handle"},t[11]||(t[11]=[e("i",{class:"fas fa-arrows-alt-v"},null,-1)]))])],2)}}},tt={class:"border rounded-md"},ot={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},nt={class:"font-semibold flex items-center gap-2"},st={class:"text-white text-base"},lt={class:"ml-auto flex items-center gap-2"},at={key:0,class:"flex items-center gap-3 mr-6"},it=["disabled"],dt=["disabled"],rt=["date"],ut={key:1,class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"},ct={__name:"UserTodos",props:{todos:{type:Array,required:!0},user:{type:Object,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","update"],setup(o,{emit:D}){const d=o,n=j(null),y=D,t=G();async function r(u){confirm(`Are your sure want to delete todo
'${u==null?void 0:u.title}'`)&&(await t.deleteTodo(u.id),y("update"))}async function v(u,b){confirm(`Are your sure?
want to change status to ${b} 
todo: '${u==null?void 0:u.title}'`)&&(await t.updateTodoStatus(u.id,b),y("update"))}async function l(){var b;const u=(b=n==null?void 0:n.value.items)==null?void 0:b.map(p=>p.id);await t.rearrangeMyTodos(u,{date:d.date}),y("update")}return(u,b)=>{var p,s;return a(),m("div",tt,[e("div",ot,[e("div",nt,[P(ae,{user:o.user},null,8,["user"]),e("div",st,S(o.user.label),1)]),e("div",lt,[(p=n.value)!=null&&p.isItemsChanged?(a(),m("div",at,[e("button",{onClick:b[0]||(b[0]=$(()=>l(),["prevent"])),class:"btn-2 disabled:opacity-40 disabled:pointer-events-none",disabled:T(t).updatingPriority}," Save Rearranged ",8,it),e("button",{onClick:b[1]||(b[1]=$(()=>n.value.resetItems(),["prevent"])),class:"btn-3 disabled:opacity-40 disabled:pointer-events-none",disabled:T(t).updatingPriority}," Discard ",8,dt)])):g("",!0),P(ce,{department:(s=o.user)==null?void 0:s.department,class:"px-2"},null,8,["department"])])]),e("div",{date:u.date,"max-items":"all",class:"w-full"},[o.todos.length>0?(a(),_(xe,{key:0,items:o.todos,ref_key:"draggableTodos",ref:n,handle:"handle"},{item:R(({item:c})=>[P(et,{todo:c,onClickTodo:k=>y("clickTodo",k),onClickEdit:k=>y("clickEdit",k),onClickDelete:k=>r(k),onClickChangeStatus:(k,I)=>v(k,I),"hide-department":"","hide-user":"",class:"border-b border-sky-200",userRole:o.userRole},null,8,["todo","onClickTodo","onClickEdit","onClickDelete","onClickChangeStatus","userRole"])]),_:1},8,["items"])):g("",!0),o.todos.length===0?(a(),m("div",ut," No Todos ")):g("",!0)],8,rt)])}}},mt={class:"relative bg-white p-4"},yt={key:0,class:"text-red-500 text-sm border border-red-300 max-w-6xl mx-auto py-2 gap-2 shadow-sm rounded flex items-center px-3"},pt={class:"max-w-6xl mx-auto border rounded my-5"},vt={class:"text-gray-700 border-b py-2 px-4 flex items-center"},ft={class:"text-lg font-semibold"},gt={key:0,class:"ml-auto flex items-center gap-2"},bt={__name:"TodosInDailyView",props:{date:{type:String,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickAdd","clickEdit","clickDelete","clickChangeStatus","backClick","update"],setup(o,{emit:D}){const d=o,n=D,y=te(),t=G(),r=U(()=>new Date(d.date)),v=l=>{if(d.userRole=="employee")return[{...y.user,todos:l}];const u={};return l.forEach(b=>{const p=b.user.id;u[p]||(u[p]={...b.user,todos:[]}),u[p].todos.push(b)}),Object.values(u)};return(l,u)=>(a(),m("div",mt,[T(t).error?(a(),m("div",yt,[u[5]||(u[5]=e("i",{class:"fad fa-exclamation-circle"},null,-1)),e("div",null,S(T(t).error),1)])):g("",!0),e("div",pt,[e("div",vt,[e("button",{class:"fa fa-arrow-left btn-icon mr-2",onClick:u[0]||(u[0]=$(b=>n("backClick"),["prevent"]))}),e("div",ft,S(T(X)(r.value,{weekDay:"long"}))+" "+S(l.type),1),o.userRole=="employee"?(a(),m("div",gt,[e("button",{class:"btn btn-icon",onClick:u[1]||(u[1]=$(b=>n("clickAdd",d.date),["prevent"]))},u[6]||(u[6]=[e("i",{class:"fas fa-plus"},null,-1)]))])):g("",!0)]),P(ue,{date:o.date,"max-items":"all",class:"w-full space-y-4 p-2"},{todoItems:R(({allTodos:b})=>[(a(!0),m(A,null,q(v(b),p=>(a(),_(ct,{key:p.id,todos:(p==null?void 0:p.todos)||[],user:p,onClickTodo:u[2]||(u[2]=s=>n("clickTodo",s)),onClickEdit:u[3]||(u[3]=s=>n("clickEdit",s)),onUpdate:u[4]||(u[4]=s=>n("update")),"user-role":o.userRole},null,8,["todos","user","user-role"]))),128))]),noTodos:R(()=>u[7]||(u[7]=[e("div",{class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"}," No Todos ",-1)])),_:1},8,["date"])])]))}},ht={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md"},kt={key:0,class:"mb-4 text-red-500 font-medium"},xt={key:1,class:"mb-4 text-blue-500 font-medium"},wt={class:"flex justify-between items-center gap-4"},Ct=["disabled"],me={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(o,{emit:D}){const d=D;return(n,y)=>(a(),m("form",{onSubmit:y[1]||(y[1]=$(t=>d("submit"),["prevent"]))},[L(n.$slots,"default"),e("div",ht,[o.error?(a(),m("div",kt,S(o.error),1)):g("",!0),o.isSubmitting?(a(),m("div",xt,"Saving changes...")):g("",!0),L(n.$slots,"footer",{},()=>[e("div",wt,[e("button",{type:"button",onClick:y[0]||(y[0]=t=>d("clickCancel")),class:"btn-3"},"Cancel"),e("button",{disabled:o.isSubmitting||o.isLoading,type:"submit",class:"btn-2"},S(o.isSubmitting?"Saving...":"Save"),9,Ct)])])])],32))}},$t={class:"border"},Dt={class:"flex items-center py-1"},Tt=["onClick"],St={key:0,class:"border ml-4 mt-4"},It={class:"line-clamp-1 group-hover/sub:text-green-500"},Mt=["onClick"],Et={key:0,class:"border ml-4 mt-2"},Rt={class:"line-clamp-1 group-hover/subSub:text-purple-800"},Ot=["onClick"],ye={__name:"TodoTypeInput",props:{todoType:{type:String,default:"task"},todoTypeId:{type:[String,Number],default:null},show:{type:Boolean,default:!1}},emits:["update:todoType","update:todoTypeId","update:show"],setup(o,{emit:D}){const d=o,n=D,y=U({get:()=>d.todoType,set:c=>n("update:todoType",c)}),t=U({get:()=>d.todoTypeId,set:c=>n("update:todoTypeId",c)}),r=U({get:()=>d.show,set:c=>n("update:show",c)}),v=j(null),l=j({});function u(){if(!(v!=null&&v.value))return;const c=v.value.getBoundingClientRect(),k=window.innerHeight,I=300,i=k-c.bottom<I;l.value={position:"fixed",top:i?c.top-I+"px":c.bottom+"px",left:c.left+"px",width:c.width+"px",zIndex:5e3}}function b(c){t.value=c.id,r.value=!1}function p(c){t.value="",r.value=!1}V(async()=>{await oe(),window.addEventListener("resize",u),document.addEventListener("scroll",u),r.value=!0,y.value="task"});const s=Ce();return H(()=>r.value,async c=>{c&&await s.fetchMyTasks()}),pe(()=>{window.removeEventListener("resize",u),document.removeEventListener("scroll",u)}),(c,k)=>(a(),m("div",{class:"relative",ref_key:"anchor",ref:v},[e("div",{class:B(["w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 cursor-pointer flex items-center",t.value?"":"text-gray-400"]),onClick:k[0]||(k[0]=$(()=>{r.value=!0,u()},["stop"]))},[z(S(t.value||"Click to select todo")+" ",1),t.value?(a(),m("button",{key:0,class:"btn-icon fas fa-times !size-8 text-sm ml-auto",onClick:$(p,["prevent","stop"])})):g("",!0)],2),(a(),_(fe,{to:"body"},[r.value?(a(),m("div",{key:0,style:ve(l.value),class:"fixed h-[300px] bg-white rounded-b-md overflow-y-auto shadow-lg border z-[5000] p-4"},[e("div",$t,[(a(!0),m(A,null,q(T(s).tasks,I=>{var x;return a(),m("div",{key:I.id,class:"px-2 border-b py-3 over text-sm relative group/main"},[e("div",Dt,[e("div",{class:B(["line-clamp-2 mr-4 ",{"text-red-50 bg-green-800 px-2":I.id==t.value},{"group-hover/main:text-blue-500":I.id!=t.value}])},S(I.title),3),e("button",{class:"border btn-2 ml-auto",onClick:$(()=>b(I),["prevent"])}," Select ",8,Tt)]),(x=I==null?void 0:I.children_tasks)!=null&&x.length?(a(),m("div",St,[(a(!0),m(A,null,q((I==null?void 0:I.children_tasks)||[],i=>{var h;return a(),m("div",{key:i.id,class:"px-2 border-b py-3 over text-sm relative group/sub"},[e("div",It,S(i.title),1),e("button",{class:"border absolute right-2 top-1 btn-2 from-green-100 to-green-50 border-green-700 text-green-800 hover:text-green-900",onClick:$(()=>b(i),["prevent"])}," Select ",8,Mt),(h=i==null?void 0:i.children_tasks)!=null&&h.length?(a(),m("div",Et,[(a(!0),m(A,null,q((i==null?void 0:i.children_tasks)||[],C=>(a(),m("div",{key:C.id,class:"px-2 border-b py-4 over text-sm relative group/subSub"},[e("div",Rt,S(C.title),1),e("button",{class:"border absolute right-2 top-2 btn-2 from-green-100 to-purple-50 border-purple-700 text-purple-800 hover:text-purple-900",onClick:$(()=>b(C),["prevent"])}," Select ",8,Ot)]))),128))])):g("",!0)])}),128))])):g("",!0)])}),128))])],4)):g("",!0)]))],512))}},Nt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Lt={class:"mb-2"},jt={class:"mb-4"},Pt={class:"mb-4"},_t={__name:"TodoAddForm",props:{date:{type:String,default:J(new Date)},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(o,{emit:D}){const d=o,n=j(),y=j(!1),t=j(),r=G(),v=D,l=j({title:"",date:d.date||"",todo_type:"",todo_type_id:""});async function u(){var p;try{n.value="submitting",(p=l.value)!=null&&p.todo_type_id||(l.value={title:l.value.title,date:l.value.date}),await r.createTodo(l.value,{returnWith:d.userRole!=="employee"?"user,department,company":""}),v("update")}finally{n.value=""}}const b=U(()=>new Date(d.date));return V(async()=>{var p;await oe(),(p=t.value)==null||p.focus()}),(p,s)=>(a(),m("div",{onClick:s[5]||(s[5]=c=>y.value=!1)},[T(r).loading?(a(),_(Q,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:R(()=>s[6]||(s[6]=[z(" Loading... ")])),_:1,__:[6]})):g("",!0),P(me,{onSubmit:u,onClickCancel:s[4]||(s[4]=c=>v("cancelClick")),isSubmitting:n.value=="submitting",error:T(r).error,class:"rounded-md relative"},{default:R(()=>[s[10]||(s[10]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),e("div",Nt,[e("div",Lt,[s[7]||(s[7]=e("span",{class:"font-semibold"}," Date ",-1)),e("span",null,S(T(X)(b.value,{weekDay:"long"})),1)]),e("div",jt,[s[8]||(s[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),de(e("input",{ref_key:"titleRef",ref:t,"onUpdate:modelValue":s[0]||(s[0]=c=>l.value.title=c),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[re,l.value.title]])]),e("div",Pt,[s[9]||(s[9]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),P(ye,{show:y.value,"onUpdate:show":s[1]||(s[1]=c=>y.value=c),todoType:l.value.todo_type,"onUpdate:todoType":s[2]||(s[2]=c=>l.value.todo_type=c),todoTypeId:l.value.todo_type_id,"onUpdate:todoTypeId":s[3]||(s[3]=c=>l.value.todo_type_id=c)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","error"])]))}},Ut={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Ft={class:"mb-2"},zt={class:"mb-4"},At={class:"mb-4"},Bt={__name:"TodoEditForm",props:{date:{type:String,default:J(new Date)},todo:{type:Object,default:()=>{}}},emits:["update","cancelClick"],setup(o,{emit:D}){const d=o,n=j(),y=j(!1),t=j(),r=G(),v=D,l=j({title:"",todo_type:"task",todo_type_id:""});async function u(){var s,c,k;await r.fetchTodo((s=d.todo)==null?void 0:s.id),l.value.title=(c=r.todo)==null?void 0:c.title,l.value.todo_type_id=(k=r.todo)==null?void 0:k.todoable_id}async function b(){n.value="submitting",console.log({form:l.value});try{await r.updateTodo(d.todo.id,l.value),v("update")}finally{n.value=""}}const p=U(()=>new Date(d.todo.date));return V(async()=>{var s;await u(),await oe(),(s=t.value)==null||s.focus()}),(s,c)=>(a(),m("div",{class:"relative",onClick:c[5]||(c[5]=k=>y.value=!1)},[T(r).loading?(a(),_(Q,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:R(()=>c[6]||(c[6]=[z(" Loading... ")])),_:1,__:[6]})):g("",!0),P(me,{onSubmit:b,onClickCancel:c[4]||(c[4]=k=>v("cancelClick")),isSubmitting:n.value=="submitting",isLoading:T(r).loading,error:T(r).error,id:"todoEditForm"},{default:R(()=>[c[10]||(c[10]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),e("div",Ut,[e("div",Ft,[c[7]||(c[7]=e("span",{class:"font-semibold"}," Date ",-1)),e("span",null,S(T(X)(p.value,{weekDay:"long"})),1)]),e("div",zt,[c[8]||(c[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),de(e("input",{ref_key:"titleRef",ref:t,"onUpdate:modelValue":c[0]||(c[0]=k=>l.value.title=k),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[re,l.value.title]])]),e("div",At,[c[9]||(c[9]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),P(ye,{show:y.value,"onUpdate:show":c[1]||(c[1]=k=>y.value=k),todoType:l.value.todo_type,"onUpdate:todoType":c[2]||(c[2]=k=>l.value.todo_type=k),todoTypeId:l.value.todo_type_id,"onUpdate:todoTypeId":c[3]||(c[3]=k=>l.value.todo_type_id=k)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","isLoading","error"])]))}},Wt={class:"relative"},qt={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},Gt={class:"mb-4"},Ht={class:"mb-4"},Vt={key:0,class:"mt-1 flex items-center gap-2"},Kt={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},Yt={class:"flex items-center gap-4"},Jt={key:0,class:"flex items-center gap-2"},Qt={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},Xt={key:0,class:"ml-auto flex items-center gap-2"},Zt={__name:"TodoShow",props:{todo:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update"],setup(o,{emit:D}){const d=o,n=G(),y=te(),t=D;async function r(){var p;await n.fetchTodo((p=d.todo)==null?void 0:p.id)}const v=U(()=>{var p,s;return(p=n.todo)!=null&&p.date?new Date((s=n.todo)==null?void 0:s.date):null}),l=U(()=>{var p;return d.todo.user_id===((p=y.user)==null?void 0:p.id)});async function u(p){var s;confirm(`Are your sure want to delete todo
'${(s=n.todo)==null?void 0:s.title}'`)&&(await n.deleteTodo(p.id),t("update"))}async function b(p,s){var c;confirm(`Are your sure want to compete todo
'${(c=n.todo)==null?void 0:c.title}'`)&&(await n.updateTodoStatus(p.id,s),t("update"))}return V(async()=>{await r()}),(p,s)=>{var k,I,x,i,h,C,w,N;const c=ie("UserChip");return a(),m("div",Wt,[T(n).loading?(a(),_(Q,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:R(()=>s[5]||(s[5]=[z(" Loading... ")])),_:1,__:[5]})):g("",!0),e("div",null,[s[11]||(s[11]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),e("div",qt,[e("div",Gt,[s[6]||(s[6]=e("div",{class:"font-semibold text-xs text-gray-500"},"Date",-1)),e("span",null,S(T(X)(v.value,{weekDay:"long"})),1)]),e("div",Ht,[s[7]||(s[7]=e("div",{class:"text-xs text-gray-500"},"Todo",-1)),z(" "+S((k=T(n).todo)==null?void 0:k.title),1)]),o.todo.user?(a(),m("div",Vt,[P(c,{user:o.todo.user,"avatar-size":"xsmall"},null,8,["user"]),e("div",Kt,S((x=(I=o.todo.user)==null?void 0:I.department)==null?void 0:x.name),1)])):g("",!0),e("div",null,[s[10]||(s[10]=e("div",{class:"text-xs text-gray-500"},"Status",-1)),e("div",Yt,[e("div",null,[(i=T(n))!=null&&i.todo?(a(),_(ne,{key:0,todo:(h=T(n))==null?void 0:h.todo},null,8,["todo"])):g("",!0),z(" "+S((C=T(n).todo)==null?void 0:C.status),1)]),l.value&&!T(n).loading?(a(),m("div",Jt,[((w=T(n).todo)==null?void 0:w.status)==="PENDING"?(a(),m("button",{key:0,class:"btn-2 from-yellow-700 to-yellow-500 text-white hover:bg-green-600 hover:text-white",onClick:s[0]||(s[0]=$(()=>b(T(n).todo,"WORKING"),["prevent","stop"]))},s[8]||(s[8]=[e("i",{class:"fas fa-exclamation-circle"},null,-1),z(" Change to Working ")]))):g("",!0),((N=T(n).todo)==null?void 0:N.status)==="WORKING"?(a(),m("button",{key:1,class:"btn-2 from-green-700 to-green-300 text-white hover:bg-green-600 hover:text-white",onClick:s[1]||(s[1]=$(()=>b(T(n).todo,"COMPLETED"),["prevent","stop"]))},s[9]||(s[9]=[e("i",{class:"fas fa-check"},null,-1),z(" Make Complete ")]))):g("",!0)])):g("",!0)])])])]),e("div",Qt,[e("button",{type:"button",onClick:s[2]||(s[2]=f=>t("cancelClick")),class:"btn-3"},"Cancel"),l.value&&!T(n).loading?(a(),m("div",Xt,[e("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:s[3]||(s[3]=$(f=>t("clickEdit",T(n).todo),["prevent","stop"]))},s[12]||(s[12]=[e("i",{class:"fas fa-pen"},null,-1),z(" Edit ")])),e("button",{class:"btn-2-red",onClick:s[4]||(s[4]=$(()=>u(T(n).todo),["prevent","stop"]))},s[13]||(s[13]=[e("i",{class:"fas fa-trash-alt"},null,-1),z(" Delete ")]))])):g("",!0)])])}}},eo={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","update","clickEdit","clickDelete","clickChangeStatus"],setup(o,{emit:D}){const d=D;function n(){d("update")}return(y,t)=>(a(),m(A,null,[o.todoModal.action=="add"?(a(),_(ee,{key:0},{default:R(()=>{var r;return[P(_t,{onCancelClick:t[0]||(t[0]=v=>d("cancelClick")),onUpdate:n,date:(r=o.todoModal)==null?void 0:r.date,userRole:o.userRole},null,8,["date","userRole"])]}),_:1})):g("",!0),o.todoModal.action=="edit"?(a(),_(ee,{key:1},{default:R(()=>{var r;return[P(Bt,{onCancelClick:t[1]||(t[1]=v=>d("cancelClick")),onUpdate:n,todo:(r=o.todoModal)==null?void 0:r.todo,userRole:o.userRole},null,8,["todo","userRole"])]}),_:1})):g("",!0),o.todoModal.action=="show"?(a(),_(ee,{key:2},{default:R(()=>{var r;return[P(Zt,{onCancelClick:t[2]||(t[2]=v=>d("cancelClick")),onUpdate:n,onClickEdit:t[3]||(t[3]=v=>d("clickEdit",v)),onClickDelete:t[4]||(t[4]=v=>d("clickDelete",v)),onClickChangeStatus:t[5]||(t[5]=(v,l)=>d("clickChangeStatus",v,l)),todo:(r=o.todoModal)==null?void 0:r.todo,userRole:o.userRole},null,8,["todo","userRole"])]}),_:1})):g("",!0)],64))}},to={class:"border bg-white relative"},co={__name:"TodoSection",props:{year:{type:Number,default:()=>new Date().getFullYear()},month:{type:Number,default:()=>new Date().getMonth()+1},day:{type:Number,default:()=>new Date().getDate()},week:{type:Number,default:()=>new Date().getDay()},type:{type:String,default:"month-view"},companyId:{type:String,default:""},departmentId:{type:String,default:""},employeeId:{type:String,default:""},lineType:{type:String,default:""},status:{type:String,default:""},userRole:{type:String,default:"employee"}},emits:["changeInput"],setup(o,{emit:D}){const d=new Date,n=o,y=j({type:"month-view",month:d.getMonth()+1,day:d.getDate(),year:d.getFullYear(),week:d.getDay()}),t=D;H(()=>({...y.value}),f=>{t("changeInput",f)}),H(()=>({year:n.year,month:n.month,day:n.day,week:n.week,type:n.type}),f=>{y.value={...f}},{immediate:!0});const r=j({action:null}),v=G();async function l(){await N()}function u(){r.value={...r.value,action:""}}async function b(f,M){await v.updateTodoStatus(f,M)}async function p(f){await v.deleteTodo(f)}function s(){y.value={...y.value,type:"month-view"}}function c(f){y.value={...y.value,...f}}function k(f){const[M,E,O]=f.split("-").map(Number);y.value={...y.value,type:"day-view",year:M,month:E,day:O}}function I(f){r.value={...r.value,action:"show",todo:f}}function x(f){r.value={...r.value,action:"edit",todo:f}}function i(f){r.value={...r.value,action:"add",date:f}}function h(){r.value={action:null,todo:null}}const C=U(()=>{var O,W,F,Z,se,le;const f=(W=(O=y.value)==null?void 0:O.year)==null?void 0:W.toString(),M=(Z=(F=y.value)==null?void 0:F.month)==null?void 0:Z.toString().padStart(2,"0"),E=(le=(se=y.value)==null?void 0:se.day)==null?void 0:le.toString().padStart(2,"0");return`${f}-${M}-${E}`}),w=U(()=>{var E,O,W,F;const f=(O=(E=y.value)==null?void 0:E.year)==null?void 0:O.toString(),M=(F=(W=y.value)==null?void 0:W.month)==null?void 0:F.toString().padStart(2,"0");return`${f}-${M}`});async function N(){const[f,M]=[Number(n.year),Number(n.month)],E=J(new Date(f,M-1,1)),O=J(he(f,M-1));console.log("FETCHING...",{startDate1:E,endDate1:O});const[W,F]=ke(f,M-1);console.log("FETCHING...",{startDate:W,endDate:F}),n.userRole=="employee"?await v.fetchMyTodos({"start-date":W,"end-date":F}):await v.fetchTodos({"company-id":n.companyId,"department-id":n.departmentId,"employee-id":n.employeeId,"line-type":n.lineType,"start-date":W,"end-date":F,status:n.status})}return V(async()=>{await N()}),H(()=>({"company-id":n.companyId,"department-id":n.departmentId,"employee-id":n.employeeId,"line-type":n.lineType,status:n.status,month:n.month}),()=>N()),(f,M)=>(a(),m("div",null,[e("div",to,[T(v).loading?(a(),_(Q,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:R(()=>M[0]||(M[0]=[z(" Loading... ")])),_:1,__:[0]})):g("",!0),P(Pe,{selected:y.value,class:"border-b shadow z-20",onChange:c,onReloadClick:l},{before:R(E=>[L(f.$slots,"beforeHeader",K(Y(E)))]),inner:R(E=>[L(f.$slots,"innerHeader",K(Y(E)))]),after:R(E=>[L(f.$slots,"afterHeader",K(Y(E)))]),bottom:R(E=>[L(f.$slots,"bottomHeader",K(Y(E)))]),typeSelection:R(E=>[L(f.$slots,"typeSelection",K(Y(E)))]),_:3},8,["selected"]),y.value.type=="month-view"?(a(),_(Ve,{key:1,month:w.value,class:"bg-white",onDateClick:k,onClickTodo:I,onClickDateCell:i},null,8,["month"])):g("",!0),y.value.type=="day-view"?(a(),_(bt,{key:2,date:C.value,userRole:o.userRole,onClickTodo:I,onClickEdit:x,onClickAdd:i,onClickDelete:p,onClickChangeStatus:b,onBackClick:s,onUpdate:u},null,8,["date","userRole"])):g("",!0)]),P(eo,{todoModal:r.value,userRole:o.userRole,onCancelClick:h,onUpdate:u,onClickEdit:x},null,8,["todoModal","userRole"])]))}};export{Se as _,co as a};
