import{_ as ae}from"./CommentModal-Cg4je0R5.js";import{u as ne,O as Z,_ as re}from"./task-priority-JLLsVywq.js";import{L as ie}from"./LoaderView-CkU8ir37.js";import{_ as ue}from"./TaskAddForm-B5WrOAL7.js";import{_ as de}from"./TaskEditForm-VuX9Mrh5.js";import{q as b,s as me,A as te,e as se,c as i,o,a as t,f as L,w as H,g as V,C as j,F as U,x as B,t as N,h as r,l as k,p as S,D as z,v as pe,y as O,b as ce,u as ye,r as $,E as ve,k as fe,m as R,n as ee}from"./index-Lkck5I2M.js";import{_ as ke}from"./MultiselectDropdown-CAs_PuFG.js";import{u as be}from"./company-DhZlv3Ja.js";import{_ as le}from"./UserChip-DQGIOQYS.js";import{_ as oe}from"./TaskTreeView-BtrG9WyL.js";import{u as ge}from"./useTaskStore-BvIxqdKo.js";import"./useCommentStore-DiqCd8PF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-MfOiS9m-.js";import"./useRequirementStore-9ilGWlU-.js";import"./SectionLoading-OusMJhsA.js";import"./vue-multiselect.esm-C1nYzVk5.js";import"./datetime-BISRKKpq.js";const xe={class:"mb-3 task-header"},we={class:"flex justify-between items-center"},Ce={class:"ml-auto flex gap-6 items-center"},Te={key:0,class:"flex gap-2 items-center"},_e={class:"flex flex-wrap items-center gap-2 mt-3"},qe={class:"flex flex-wrap gap-4 w-full"},Ie={class:"text-gray-600 w-full md:w-64 relative"},Ve=["value"],$e={class:"text-gray-600 w-full md:w-64 relative"},Ue=["value"],Ae={class:"relative w-full md:w-72"},Se={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Le={class:"text-gray-600 w-40 relative"},he={class:"flex gap-4 items-center flex-shrink-0"},Ee={class:"flex gap-2"},De={class:"flex gap-2"},Pe={class:"flex gap-2"},Be={class:"text-gray-600 w-full md:w-40 md:ml-auto relative"},Me={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(h,{emit:y}){const l=h,f=b(g("company-id")),w=b(g("user-ids")),_=b(g("month")),I=b(g("status")),a=b(g("is-important")),u=b(g("is-urgent")),d=b(g("is-target")),c=y,v=be(),{companies:C,employees:E}=me(v);function g(m){return{get:()=>l.modelValue[m]||"",set:e=>{console.log("---SETTING modelValue: ",{key:m,value:e}),c("update:modelValue",{...l.modelValue,[m]:e||void 0})}}}const q=b(()=>M(w.value));async function A(m){m&&await v.fetchEmployee(m)}te(()=>f.value,A),se(async()=>{var m,e;await v.fetchCompanies(),(m=l.modelValue)!=null&&m["company-id"]&&await A((e=l.modelValue)==null?void 0:e["company-id"])});function M(m){return Array.isArray(E.value)&&E.value.find(e=>e.id==m)||null}function F(m){w.value=(m==null?void 0:m.id)||""}function D(){w.value=""}return(m,e)=>(o(),i("div",xe,[t("div",we,[e[11]||(e[11]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",Ce,[h.listHasRearranged?(o(),i("div",Te,[e[10]||(e[10]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=H(s=>c("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=H(s=>c("clickPriorityDiscard"),["prevent"]))},"Discard")])):L("",!0),t("button",{onClick:e[2]||(e[2]=s=>c("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",_e,[t("div",qe,[t("div",Ie,[e[13]||(e[13]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Company",-1)),V(t("select",{id:"company-filter","onUpdate:modelValue":e[3]||(e[3]=s=>f.value=s),class:"input-1"},[e[12]||(e[12]=t("option",{value:""},"All Company",-1)),(o(!0),i(U,null,B(r(C),s=>(o(),i("option",{key:s.id,value:s.id},N(s.name),9,Ve))),128))],512),[[j,f.value]])]),t("div",$e,[e[15]||(e[15]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Company",-1)),V(t("select",{id:"company-filter","onUpdate:modelValue":e[4]||(e[4]=s=>f.value=s),class:"input-1"},[e[14]||(e[14]=t("option",{value:""},"All Company",-1)),(o(!0),i(U,null,B(r(C),s=>(o(),i("option",{key:s.id,value:s.id},N(s.name),9,Ue))),128))],512),[[j,f.value]])]),t("div",Ae,[k(ke,{modelValue:q.value,onSelect:F,onRemove:D,options:r(E),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employees",class:"text-gray-600 w-full"},{option:S(({option:s})=>[k(le,{user:s,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),q.value?(o(),i("div",Se,[t("button",{onClick:H(D,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):L("",!0),e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))]),t("div",Le,[e[18]||(e[18]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),V(t("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>I.value=s),class:"input-1"},e[17]||(e[17]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[j,I.value]])]),t("div",he,[t("label",Ee,[V(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>a.value=s)},null,512),[[z,a.value]]),e[19]||(e[19]=t("span",null,"Important",-1))]),t("label",De,[V(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>u.value=s)},null,512),[[z,u.value]]),e[20]||(e[20]=t("span",null,"Urgent",-1))]),t("label",Pe,[V(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>d.value=s)},null,512),[[z,d.value]]),e[21]||(e[21]=t("span",null,"Is Target",-1))])]),t("div",Be,[e[22]||(e[22]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),V(t("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=s=>_.value=s),type:"month",class:"input-1",placeholder:"All month"},null,512),[[pe,_.value]])])])])]))}},Re={class:"w-full bg-white rounded"},Ne=["rowspan"],Fe={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(h,{emit:y}){const l=h,f=y,w=b(()=>l.tasks.reduce((a,u)=>(a.push(...u.users.filter(d=>!a.find(c=>c.id==d.id&&d.id))),a),[]).filter(a=>l.selectedUserId?a.id==l.selectedUserId:!0)),_=a=>l.tasks.filter(c=>c.users.some(v=>v.id===a)),I=b(()=>w.value.map(a=>{const u=_(a.id);return{...a,tasks:u}}));return(a,u)=>(o(),i("div",null,[t("table",Re,[t("tbody",null,[(o(!0),i(U,null,B(I.value,d=>(o(),i(U,{key:d.id},[(o(!0),i(U,null,B(d.tasks,(c,v)=>(o(),i("tr",{key:c.id},[v==0?(o(),i("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(d.tasks.length,1)},[k(le,{user:d,class:"sticky top-[80px]"},null,8,["user"])],8,Ne)):L("",!0),t("td",{class:O(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":v==0,"border-b":d.tasks.length-1===v}])},[k(oe,{task:c,class:"!border-0 my-0",index:v,onCommentButtonClick:u[0]||(u[0]=C=>f("commentButtonClick",a.item.id)),onEditClick:u[1]||(u[1]=C=>f("editClick",C)),onAddClick:u[2]||(u[2]=C=>f("addClick",C))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},He={class:"container mx-auto p-6 relative"},je={class:"mb-4"},ze={class:"w-full flex justify-end gap-5 mb-1"},Oe={key:3},We={key:0,class:"text-center py-4 text-red-500"},Ge={key:1},Je={class:"flex items-stretched"},Ke={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Qe=1,vt={__name:"TaskList",setup(h){const y=ge(),l=ce(),f=ye(),w=$(!1),_=$(null),I=$(!1),a=$(null),u=$(!1),d=ve({parentId:0,requirementId:0}),c=$(null),v=$([]),{handleItemsPriorityUpdate:C,saveTaskPriority:E,listHasRearranged:g}=ne(()=>y.taskListTree,0);se(async()=>{l.query.status||f.push({query:{...l.query,status:"not-completed"}}),await q()});async function q(){I.value=!!l.query["user-ids"];const x=await y.fetchTasks({...l.query},{newList:!0,loadingBeforeFetch:!0});v.value=x.query_log||[]}const A=x=>{u.value=!0,d.parentId=x},M=x=>{_.value=x,w.value=!0},F=()=>{w.value=!1,_.value=null};async function D(){a.value=null,u.value=!1,d.parentId=0,await q()}async function m(){u.value=!1,d.parentId=0,await q()}async function e(){E()&&await q()}te(()=>({...l.query}),async()=>{await q()});const s=b({get(){return{...l.query}},set(x){localStorage.removeItem("sub_task_opened_list"),f.push({query:{...x}})}});return(x,n)=>{var G,J,K,Q,X,Y;const W=fe("RouterLink");return o(),i("div",He,[a.value?(o(),R(Z,{key:0},{default:S(()=>[k(de,{taskId:a.value,onClose:n[0]||(n[0]=p=>a.value=null),onUpdated:D},null,8,["taskId"])]),_:1})):L("",!0),u.value?(o(),R(Z,{key:1},{default:S(()=>[k(ue,{parentTaskId:d.parentId,requirementId:d.requirementId,onClose:m,onTaskCreated:D},null,8,["parentTaskId","requirementId"])]),_:1})):L("",!0),k(Me,{modelValue:s.value,"onUpdate:modelValue":n[1]||(n[1]=p=>s.value=p),onClickAddTask:A,onClickPrioritySave:e,onClickPriorityDiscard:n[2]||(n[2]=()=>r(g)?c.value.resetItems:null),"list-has-rearranged":r(g),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((J=(G=r(l))==null?void 0:G.query)==null?void 0:J["query-log"])=="true"?(o(!0),i(U,{key:2},B(v.value,(p,T)=>(o(),i("div",{key:T,class:"text-xs text-gray-500"},[t("div",je,N(p.raw_query),1)]))),128)):L("",!0),t("div",ze,[k(W,{class:O(["text-sm btn-3 py-0.5",((K=r(l).query)==null?void 0:K.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...r(l).query,view:"userwise"}}},{default:S(()=>n[9]||(n[9]=[ee(" User Wise List ")])),_:1,__:[9]},8,["class","to"]),k(W,{class:O(["text-sm btn-3 py-0.5",((Q=r(l).query)==null?void 0:Q.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((X=r(l))==null?void 0:X.query)||{}).filter(p=>{var T;return((T=r(l))==null?void 0:T.query[p])!=="userwise"}).reduce((p,T)=>({...p,[T]:r(l).query[T]}),{})}}},{default:S(()=>n[10]||(n[10]=[ee(" TaskWise List ")])),_:1,__:[10]},8,["class","to"])]),r(y).loading?(o(),i("div",Oe,[k(ie)])):(o(),i(U,{key:4},[r(y).error?(o(),i("div",We,N(r(y).error),1)):r(y).tasks.length>0?(o(),i("div",Ge,[((Y=r(l).query)==null?void 0:Y.view)=="userwise"?(o(),R(Fe,{key:0,tasks:r(y).tasks,selectedUserId:r(l).query["user-ids"],onCommentButtonClick:n[3]||(n[3]=p=>M(p,x.task.id)),onEditClick:n[4]||(n[4]=p=>a.value=p),onAddClick:n[5]||(n[5]=p=>A(p))},null,8,["tasks","selectedUserId"])):(o(),R(re,{key:1,items:r(y).tasks,handle:"handle",onItemsUpdate:r(C),class:"space-y-4",ref_key:"draggableTaskList",ref:c},{item:S(({item:p,index:T})=>[t("div",Je,[k(oe,{task:p,index:T,showDraggableHandle:!I.value,onCommentButtonClick:n[6]||(n[6]=P=>M(P,x.task.id)),onEditClick:n[7]||(n[7]=P=>a.value=P),onAddClick:n[8]||(n[8]=P=>A(P)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(o(),i("div",Ke," No tasks found. "))],64)),k(ae,{show:w.value,"commentable-id":_.value,"commentable-type":"task","user-id":Qe,"on-close":F,onSubmitted:r(y).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{vt as default};
