import{_ as oe}from"./CommentModal-D9Bc3-fz.js";import{g as ne,u as ie,O as Y,_ as re}from"./task-priority-DJzgg5FE.js";import{L as de}from"./LoaderView-CmLXpktX.js";import{_ as ue}from"./TaskAddForm-iAox5R90.js";import{_ as me}from"./TaskEditForm-DYb_5UZq.js";import{q as C,s as ce,A as te,e as se,c as u,o as a,a as t,f as L,w as H,g as S,C as Z,F as A,x as R,t as N,h as r,l as w,p as $,D as j,v as pe,n as O,b as ke,u as fe,r as V,E as ye,k as ve,m as M,y as ee}from"./index-DCh533pS.js";import{_ as ge}from"./MultiselectDropdown-Cduld0nF.js";import{u as xe}from"./company-C9Oj2PBw.js";import{_ as le}from"./UserChip-lDU56xHp.js";import{_ as ae}from"./TaskTreeView-D6VtVAty.js";import{u as we}from"./useTaskStore-D37FlHCk.js";import"./useCommentStore-BsZ3cSk_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-jXbmCBBK.js";import"./SectionLoading-C5gy5NKB.js";import"./vue-multiselect.esm-8W_Fs5tN.js";const be={class:"mb-3 task-header"},Ce={class:"flex justify-between items-center"},_e={class:"ml-auto flex gap-6 items-center"},Te={key:0,class:"flex gap-2 items-center"},Ie={class:"flex flex-wrap items-center gap-2 mt-3"},he={class:"flex flex-wrap gap-4 w-full"},qe={class:"text-gray-600 w-full md:w-64"},Ve=["value"],$e={class:"relative w-full md:w-72"},Ue={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Se={class:"text-gray-600 w-40"},Le={class:"flex gap-4 items-center flex-shrink-0"},Ae={class:"flex gap-2"},De={class:"flex gap-2"},Ee={class:"flex gap-2"},Pe={class:"text-gray-600 w-full md:w-40 md:ml-auto"},Be={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(D,{emit:y}){const s=D,_=C(m("company-id")),T=C(m("user-ids")),h=C(m("month")),q=C(m("status")),o=C(m("is-important")),i=C(m("is-urgent")),d=C(m("is-target")),p=y,v=xe(),{companies:g,employees:k}=ce(v);function m(c){return{get:()=>s.modelValue[c]||"",set:e=>{console.log("---SETTING modelValue: ",{key:c,value:e}),p("update:modelValue",{...s.modelValue,[c]:e||void 0})}}}const x=C(()=>B(T.value));async function U(c){c&&await v.fetchEmployee(c)}te(()=>_.value,U),se(async()=>{var c,e;await v.fetchCompanies(),(c=s.modelValue)!=null&&c["company-id"]&&await U((e=s.modelValue)==null?void 0:e["company-id"])});function B(c){return k.value.find(e=>e.id==c)||null}function F(c){T.value=(c==null?void 0:c.id)||""}function E(){T.value=""}return(c,e)=>(a(),u("div",be,[t("div",Ce,[e[10]||(e[10]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",_e,[D.listHasRearranged?(a(),u("div",Te,[e[9]||(e[9]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=H(l=>p("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=H(l=>p("clickPriorityDiscard"),["prevent"]))},"Discard")])):L("",!0),t("button",{onClick:e[2]||(e[2]=l=>p("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",Ie,[t("div",he,[t("div",qe,[S(t("select",{id:"company-filter","onUpdate:modelValue":e[3]||(e[3]=l=>_.value=l),class:"input-1"},[e[11]||(e[11]=t("option",{value:""},"All Company",-1)),(a(!0),u(A,null,R(r(g),l=>(a(),u("option",{key:l.id,value:l.id},N(l.name),9,Ve))),128))],512),[[Z,_.value]])]),t("div",$e,[w(ge,{modelValue:x.value,onSelect:F,onRemove:E,options:r(k),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employee",class:"text-gray-600 w-full"},{option:$(({option:l})=>[w(le,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),x.value?(a(),u("div",Ue,[t("button",{onClick:H(E,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):L("",!0)]),t("div",Se,[S(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>q.value=l),class:"input-1"},e[12]||(e[12]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[Z,q.value]])]),t("div",Le,[t("label",Ae,[S(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>o.value=l)},null,512),[[j,o.value]]),e[13]||(e[13]=t("span",null,"Important",-1))]),t("label",De,[S(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=l=>i.value=l)},null,512),[[j,i.value]]),e[14]||(e[14]=t("span",null,"Urgent",-1))]),t("label",Ee,[S(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>d.value=l)},null,512),[[j,d.value]]),e[15]||(e[15]=t("span",null,"Is Target",-1))])]),t("div",Pe,[S(t("input",{id:"month-filter","onUpdate:modelValue":e[8]||(e[8]=l=>h.value=l),type:"month",class:"input-1"},null,512),[[pe,h.value]])])])])]))}},Me={class:"w-full bg-white rounded"},Re=["rowspan"],Ne={class:""},Fe={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(D,{emit:y}){const s=D,_=y,T=C(()=>s.tasks.reduce((o,i)=>(o.push(...i.users.filter(d=>!o.find(p=>p.id==d.id&&d.id))),o),[]).filter(o=>s.selectedUserId?o.id==s.selectedUserId:!0)),h=o=>{const i=s.tasks,d=new Map(i.map(k=>[k.id,k])),p=new Set,v=[],g=i.filter(k=>k.users.some(m=>m.id===o));for(const k of g){p.has(k.id)||(p.add(k.id),v.push(k));let m=k.parent_id;for(;m&&d.has(m)&&!p.has(m);){const x=d.get(m);p.add(x.id),v.push(x),m=x.parent_id}}return v},q=C(()=>T.value.map(o=>{const i=ne(h(o.id),0);return{...o,tasks:i}}));return(o,i)=>(a(),u("div",null,[t("table",Me,[t("tbody",null,[(a(!0),u(A,null,R(q.value,d=>(a(),u(A,{key:d.id},[(a(!0),u(A,null,R(d.tasks,(p,v)=>(a(),u("tr",{key:p.id},[v==0?(a(),u("td",{key:0,class:"border p-4 align-top",rowspan:Math.max(d.tasks.length,1)},[w(le,{user:d,class:"sticky top-[80px]"},null,8,["user"])],8,Re)):L("",!0),t("td",Ne,[w(ae,{task:p,class:"!border-0",index:v,onCommentButtonClick:i[0]||(i[0]=g=>_("commentButtonClick",o.item.id)),onEditClick:i[1]||(i[1]=g=>_("editClick",g)),onAddClick:i[2]||(i[2]=g=>_("addClick",g))},{"item-override":$(({task:g,level:k})=>[O(N({task:g,level:k}),1)]),_:2},1032,["task","index"])])]))),128))],64))),128))])])]))}},He={class:"container mx-auto p-6 relative"},je={class:"mb-4"},Oe={class:"w-full flex justify-end gap-5 mb-1"},We={key:3},Ge={key:0,class:"text-center py-4 text-red-500"},ze={key:1},Qe={class:"flex items-stretched"},Je={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Ke=1,pt={__name:"TaskList",setup(D){const y=we(),s=ke(),_=fe(),T=V(!1),h=V(null),q=V(!1),o=V(null),i=V(!1),d=ye({parentId:0,requirementId:0}),p=V(null),v=V([]),{handleItemsPriorityUpdate:g,saveTaskPriority:k,listHasRearranged:m}=ie(()=>y.taskListTree,0);se(async()=>{s.query.status||_.push({query:{...s.query,status:"not-completed"}}),await x()});async function x(){q.value=!!s.query["user-ids"];const b=await y.fetchTasks({...s.query},{loadingBeforeFetch:!0});console.log({dataQuery:b.query_log}),v.value=b.query_log||[]}const U=b=>{i.value=!0,d.parentId=b},B=b=>{h.value=b,T.value=!0},F=()=>{T.value=!1,h.value=null};async function E(){o.value=null,i.value=!1,d.parentId=0,await x()}async function c(){i.value=!1,d.parentId=0,await x()}async function e(){k()&&await x()}te(()=>({...s.query}),async()=>await x());const l=C({get(){return{...s.query}},set(b){_.push({query:{...b}})}});return(b,n)=>{var G,z,Q,J,K,X;const W=ve("RouterLink");return a(),u("div",He,[o.value?(a(),M(Y,{key:0},{default:$(()=>[w(me,{taskId:o.value,class:"rounded-full",onClose:n[0]||(n[0]=f=>o.value=null),onUpdated:E},null,8,["taskId"])]),_:1})):L("",!0),i.value?(a(),M(Y,{key:1},{default:$(()=>[w(ue,{parentTaskId:d.parentId,requirementId:d.requirementId,class:"rounded-full",onClose:c,onTaskCreated:E},null,8,["parentTaskId","requirementId"])]),_:1})):L("",!0),w(Be,{modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=f=>l.value=f),onClickAddTask:U,onClickPrioritySave:e,onClickPriorityDiscard:n[2]||(n[2]=()=>r(m)?p.value.resetItems:null),"list-has-rearranged":r(m),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((z=(G=r(s))==null?void 0:G.query)==null?void 0:z["query-log"])=="true"?(a(!0),u(A,{key:2},R(v.value,(f,I)=>(a(),u("div",{key:I,class:"text-xs text-gray-500"},[t("div",je,N(f.raw_query),1)]))),128)):L("",!0),t("div",Oe,[w(W,{class:ee(["text-sm btn-3 py-0.5",((Q=r(s).query)==null?void 0:Q.view)==="userwise"?"bg-blue-500 text-white":""]),to:{name:"TaskList",query:{...r(s).query,view:"userwise"}}},{default:$(()=>n[9]||(n[9]=[O(" User Wise List ")])),_:1},8,["class","to"]),w(W,{class:ee(["text-sm btn-3 py-0.5",((J=r(s).query)==null?void 0:J.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{name:"TaskList",query:{...Object.keys(((K=r(s))==null?void 0:K.query)||{}).filter(f=>{var I;return((I=r(s))==null?void 0:I.query[f])!=="userwise"}).reduce((f,I)=>({...f,[I]:r(s).query[I]}),{})}}},{default:$(()=>n[10]||(n[10]=[O(" TaskWise List ")])),_:1},8,["class","to"])]),r(y).loading?(a(),u("div",We,[w(de)])):(a(),u(A,{key:4},[r(y).error?(a(),u("div",Ge,N(r(y).error),1)):r(y).tasks.length>0?(a(),u("div",ze,[((X=r(s).query)==null?void 0:X.view)=="userwise"?(a(),M(Fe,{key:0,tasks:r(y).tasks,selectedUserId:r(s).query["user-ids"],onCommentButtonClick:n[3]||(n[3]=f=>B(f,b.task.id)),onEditClick:n[4]||(n[4]=f=>o.value=f),onAddClick:n[5]||(n[5]=f=>U(f))},null,8,["tasks","selectedUserId"])):(a(),M(re,{key:1,items:r(y).taskListTree,handle:"handle",onItemsUpdate:r(g),class:"space-y-4",ref_key:"draggableTaskList",ref:p},{item:$(({item:f,index:I})=>[t("div",Qe,[w(ae,{task:f,index:I,showDraggableHandle:!q.value,onCommentButtonClick:n[6]||(n[6]=P=>B(P,b.task.id)),onEditClick:n[7]||(n[7]=P=>o.value=P),onAddClick:n[8]||(n[8]=P=>U(P)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(a(),u("div",Je," No tasks found. "))],64)),w(oe,{show:T.value,"commentable-id":h.value,"commentable-type":"task","user-id":Ke,"on-close":F,onSubmitted:r(y).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{pt as default};
