import{r as p,x as E,q as Q,h as N,y as B,c as f,o as u,a as n,j as W,s as v,w as s,k,O as I,b as Y,t as S,F as Z,e as _,a6 as ee}from"./index-DPHCVBXr.js";const te={class:"w-full mx-auto"},ne={class:"flex items-center gap-2 flex-wrap bg-gray-100 p-2"},oe={class:"relative alignment-dropdown"},se={key:0,class:"absolute flex bg-white border border-gray-300 rounded mt-1 z-10"},le={class:"relative color-dropdown"},re={key:0,class:"absolute bg-white border border-gray-300 rounded mt-1 z-10 p-2 flex gap-1"},ae={class:"relative font-size-dropdown"},ie={key:0,class:"absolute bg-white border border-gray-300 rounded mt-1 z-10"},ue=["onMousedown"],de=["src"],fe={key:1,class:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-[10px] uppercase text-gray-500 font-bold border border-gray-300"},ve={class:"flex flex-col"},pe={class:"text-sm font-medium"},ce={key:0,class:"text-[10px] text-gray-500 leading-none"},be={__name:"TextEditor",props:{modelValue:{type:String,default:""},mentionableUsers:{type:Array,default:()=>[]},currentUser:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(V,{emit:K}){const L=V,H=K,d=p(null),i=p(!1),$=p(""),c=p(0),z=p({top:0,left:0}),b=E(()=>{const o=L.mentionableUsers.filter(e=>{var t;return e.id!==((t=L.currentUser)==null?void 0:t.id)});return $.value?o.filter(e=>e.name.toLowerCase().includes($.value.toLowerCase())):o}),l=p({bold:!1,italic:!1,underline:!1,insertUnorderedList:!1,insertOrderedList:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,foreColor:"",fontSize:"16px"}),y=p(!1),x=p(!1),C=p(!1),F={1:"10px",2:"13px",3:"16px",4:"18px",5:"24px",6:"32px",7:"48px"},P=E(()=>l.value.justifyLeft?"fa-align-left":l.value.justifyCenter?"fa-align-center":l.value.justifyRight?"fa-align-right":"fa-align-left"),G=E(()=>l.value.foreColor||"black");Q(()=>L.modelValue,o=>{d.value&&d.value.innerHTML!==o&&(d.value.innerHTML=o)});const r=(o,e=null)=>{document.execCommand(o,!1,e),O()},A=()=>{H("update:modelValue",d.value.innerHTML)},O=()=>{l.value={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),insertUnorderedList:document.queryCommandState("insertUnorderedList"),insertOrderedList:document.queryCommandState("insertOrderedList"),justifyLeft:document.queryCommandState("justifyLeft"),justifyCenter:document.queryCommandState("justifyCenter"),justifyRight:document.queryCommandState("justifyRight"),foreColor:document.queryCommandValue("foreColor"),fontSize:F[document.queryCommandValue("fontSize")]||"16px"}},D=()=>{O()},R=()=>{const o=window.getSelection();if(!o.rangeCount)return;const e=o.getRangeAt(0).cloneRange();e.collapse(!1);const t=e.getClientRects();if(t.length>0){const a=t[0];d.value.getBoundingClientRect(),z.value={top:a.bottom+5,left:a.left}}},X=o=>{i.value&&(o.key==="ArrowDown"?(o.preventDefault(),c.value=(c.value+1)%b.value.length):o.key==="ArrowUp"?(o.preventDefault(),c.value=(c.value-1+b.value.length)%b.value.length):o.key==="Enter"?(o.preventDefault(),b.value[c.value]&&T(b.value[c.value])):o.key==="Escape"&&(i.value=!1))},J=o=>{const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0);if(t.startContainer.nodeType!==Node.TEXT_NODE){i.value=!1;return}const a=t.startContainer.textContent.substring(0,t.startOffset),g=a.lastIndexOf("@"),j=a.lastIndexOf(" "),m=a.lastIndexOf(`
`),w=Math.max(j,m);if(g!==-1&&g>=w){if(g>0&&!/\s/.test(a[g-1])){i.value=!1;return}const q=a.substring(g+1);if(q.includes(" ")){i.value=!1;return}$.value=q,i.value=!0,c.value=0,R()}else i.value=!1},T=o=>{const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0),a=t.startContainer,j=a.textContent.substring(0,t.startOffset).lastIndexOf("@");if(j!==-1){t.setStart(a,j),t.deleteContents();const m=document.createElement("span");m.className="mention-item text-blue-600 font-semibold",m.dataset.userId=o.id,m.textContent=`@${o.name}`,m.contentEditable="false",t.insertNode(m);const w=document.createTextNode("Â ");m.after(w),t.setStartAfter(w),t.setEndAfter(w),e.removeAllRanges(),e.addRange(t)}i.value=!1,A()};N(()=>{document.addEventListener("selectionchange",D),d.value.addEventListener("paste",o=>{o.preventDefault();const e=o.clipboardData.getData("text/plain");document.execCommand("insertText",!1,e)}),d.value.innerHTML=L.modelValue}),B(()=>{document.removeEventListener("selectionchange",D)});const U=o=>{!o.target.closest(".alignment-dropdown")&&!o.target.closest(".color-dropdown")&&!o.target.closest(".font-size-dropdown")&&(y.value=!1,x.value=!1,C.value=!1),d.value&&!d.value.contains(o.target)&&(i.value=!1)},M=o=>{o.key==="Escape"&&(i.value=!1,y.value=!1,x.value=!1,C.value=!1)},h=()=>{i.value&&R()};return N(()=>{document.addEventListener("click",U),document.addEventListener("keydown",M),window.addEventListener("scroll",h,!0)}),B(()=>{document.removeEventListener("click",U),document.removeEventListener("keydown",M),window.removeEventListener("scroll",h,!0)}),(o,e)=>(u(),f("div",te,[n("div",ne,[n("button",{type:"button",onClick:e[0]||(e[0]=s(t=>r("bold"),["stop","prevent"])),class:v([{"bg-blue-200 text-blue-700":l.value.bold,"hover:bg-gray-200":!l.value.bold},"p-2 flex items-center justify-center transition"])},e[22]||(e[22]=[n("i",{class:"fas fa-bold"},null,-1)]),2),n("button",{type:"button",onClick:e[1]||(e[1]=s(t=>r("italic"),["stop","prevent"])),class:v([{"bg-blue-200 text-blue-700":l.value.italic,"hover:bg-gray-200":!l.value.italic},"p-2 rounded flex items-center justify-center transition"])},e[23]||(e[23]=[n("i",{class:"fas fa-italic"},null,-1)]),2),n("button",{type:"button",onClick:e[2]||(e[2]=s(t=>r("underline"),["stop","prevent"])),class:v([{"bg-blue-200 text-blue-700":l.value.underline,"hover:bg-gray-200":!l.value.underline},"p-2 rounded flex items-center justify-center transition"])},e[24]||(e[24]=[n("i",{class:"fas fa-underline"},null,-1)]),2),n("button",{type:"button",onClick:e[3]||(e[3]=s(t=>r("insertUnorderedList"),["stop","prevent"])),class:v([{"bg-blue-200 text-blue-700":l.value.insertUnorderedList,"hover:bg-gray-200":!l.value.insertUnorderedList},"p-2 rounded flex items-center justify-center transition"])},e[25]||(e[25]=[n("i",{class:"fas fa-list-ul"},null,-1)]),2),n("button",{type:"button",onClick:e[4]||(e[4]=s(t=>r("insertOrderedList"),["stop","prevent"])),class:v([{"bg-blue-200 text-blue-700":l.value.insertOrderedList,"hover:bg-gray-200":!l.value.insertOrderedList},"p-2 rounded flex items-center justify-center transition"])},e[26]||(e[26]=[n("i",{class:"fas fa-list-ol"},null,-1)]),2),n("div",oe,[n("button",{onClick:e[5]||(e[5]=s(t=>y.value=!y.value,["stop","prevent"])),class:"p-2 rounded flex gap-2 items-center justify-center transition hover:bg-gray-200"},[n("i",{class:v(`fas ${P.value}`)},null,2),e[27]||(e[27]=n("i",{class:"fas fa-chevron-down ml-1"},null,-1))]),y.value?(u(),f("div",se,[n("button",{onClick:e[6]||(e[6]=s(t=>r("justifyLeft"),["stop","prevent"])),class:v([{"bg-blue-200 text-blue-700":l.value.justifyLeft,"hover:bg-gray-200":!l.value.justifyLeft},"p-2 flex items-center justify-center"])},e[28]||(e[28]=[n("i",{class:"fas fa-align-left"},null,-1)]),2),n("button",{onClick:e[7]||(e[7]=s(t=>r("justifyCenter"),["stop","prevent"])),class:v([{"bg-blue-200 text-blue-700":l.value.justifyCenter,"hover:bg-gray-200":!l.value.justifyCenter},"p-2 flex items-center justify-center"])},e[29]||(e[29]=[n("i",{class:"fas fa-align-center"},null,-1)]),2),n("button",{onClick:e[8]||(e[8]=s(t=>r("justifyRight"),["stop","prevent"])),class:v([{"bg-blue-200 text-blue-700":l.value.justifyRight,"hover:bg-gray-200":!l.value.justifyRight},"p-2 flex items-center justify-center"])},e[30]||(e[30]=[n("i",{class:"fas fa-align-right"},null,-1)]),2)])):k("",!0)]),n("div",le,[n("button",{onClick:e[9]||(e[9]=s(t=>x.value=!x.value,["stop","prevent"])),class:"p-2 rounded flex gap-2 items-center justify-center transition hover:bg-gray-200"},[n("span",{style:I({color:G.value})},e[31]||(e[31]=[n("i",{class:"fas fa-palette"},null,-1)]),4),e[32]||(e[32]=n("i",{class:"fas fa-chevron-down ml-1"},null,-1))]),x.value?(u(),f("div",re,[n("button",{onClick:e[10]||(e[10]=s(t=>r("foreColor","black"),["stop","prevent"])),class:"size-4",style:{background:"black"}}),n("button",{onClick:e[11]||(e[11]=s(t=>r("foreColor","red"),["stop","prevent"])),class:"size-4",style:{background:"red"}}),n("button",{onClick:e[12]||(e[12]=s(t=>r("foreColor","green"),["stop","prevent"])),class:"size-4",style:{background:"green"}}),n("button",{onClick:e[13]||(e[13]=s(t=>r("foreColor","blue"),["stop","prevent"])),class:"size-4",style:{background:"blue"}})])):k("",!0)]),n("div",ae,[n("button",{onClick:e[14]||(e[14]=s(t=>C.value=!C.value,["stop","prevent"])),class:"p-2 rounded flex gap-2 items-center justify-center transition hover:bg-gray-200"},[Y(S(l.value.fontSize)+" ",1),e[33]||(e[33]=n("i",{class:"fas fa-chevron-down ml-1"},null,-1))]),C.value?(u(),f("div",ie,[n("button",{onClick:e[15]||(e[15]=s(t=>r("fontSize","1"),["stop","prevent"])),class:"p-2"},"10px"),n("button",{onClick:e[16]||(e[16]=s(t=>r("fontSize","2"),["stop","prevent"])),class:"p-2"},"13px"),n("button",{onClick:e[17]||(e[17]=s(t=>r("fontSize","3"),["stop","prevent"])),class:"p-2"},"16px"),n("button",{onClick:e[18]||(e[18]=s(t=>r("fontSize","4"),["stop","prevent"])),class:"p-2"},"18px"),n("button",{onClick:e[19]||(e[19]=s(t=>r("fontSize","5"),["stop","prevent"])),class:"p-2"},"24px"),n("button",{onClick:e[20]||(e[20]=s(t=>r("fontSize","6"),["stop","prevent"])),class:"p-2"},"32px"),n("button",{onClick:e[21]||(e[21]=s(t=>r("fontSize","7"),["stop","prevent"])),class:"p-2"},"48px")])):k("",!0)])]),n("div",{ref_key:"editor",ref:d,contenteditable:"true",onInput:A,onKeyup:J,onKeydown:X,class:"editable-div border border-gray-300 p-4 rounded-md min-h-[200px] focus:outline-sky-600 max-h-[1000px] bg-white overflow-auto resize-y whitespace-normal",placeholder:"Description"},null,544),(u(),W(ee,{to:"body"},[i.value&&b.value.length?(u(),f("div",{key:0,class:"fixed z-[9999] bg-white border border-gray-300 rounded shadow-lg max-h-60 overflow-y-auto min-w-[200px]",style:I({top:`${z.value.top}px`,left:`${z.value.left}px`})},[(u(!0),f(Z,null,_(b.value,(t,a)=>(u(),f("div",{key:t.id,onMousedown:s(g=>T(t),["prevent"]),class:v(["px-4 py-2 cursor-pointer flex items-center gap-2 hover:bg-blue-50 border-b last:border-0",{"bg-blue-100":a===c.value}])},[t.photo?(u(),f("img",{key:0,src:t.photo,class:"w-6 h-6 rounded-full object-cover",alt:""},null,8,de)):(u(),f("div",fe,S(t.name.charAt(0)),1)),n("div",ve,[n("span",pe,S(t.name),1),t.department?(u(),f("span",ce,S(t.department.short_name||t.department.name),1)):k("",!0)])],42,ue))),128))],4)):k("",!0)]))]))}};export{be as _};
