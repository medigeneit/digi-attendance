import{u as O,K as j,r as u,y as R,o as n,c as d,a as e,w as A,d as i,L as U,e as D,q as I,s as z,j as K,b as H,A as J,k as $,h as B,v as y,C as Q,F,x as W,m as N,n as X,p as Y,t as Z,l as ee,g as se}from"./index-BFO7VWut.js";import{L as oe}from"./LoaderView-Ce2jqIF0.js";import{_ as te}from"./PhotoModal-B7o1aFmD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"modal-bg"},ae={class:"modal-card"},re={class:"grid gap-2 space-y-3"},ne={class:"relative"},de=["type"],ue={key:0,class:"far fa-eye"},ie={key:1,class:"far fa-eye-slash"},pe={class:"relative"},fe=["type"],ce={key:0,class:"far fa-eye"},me={key:1,class:"far fa-eye-slash"},ve={class:"relative"},be=["type"],we={key:0,class:"far fa-eye"},ye={key:1,class:"far fa-eye-slash"},ge={key:0,class:"text-red-500"},xe={class:"flex justify-center gap-4"},_e={__name:"ChangePasswordModal",props:{user:Object},emits:["close","updated"],setup(L,{emit:t}){const g=t,m=O(),o=j({old_password:"",new_password:"",confirm_password:""}),p=u(!1),v=u(!1),b=u(!1),w=()=>p.value=!p.value,x=()=>v.value=!v.value,C=()=>b.value=!b.value,f=R(()=>o.confirm_password?o.new_password===o.confirm_password:!0),_=async()=>{if(!f.value){alert("New Password and Confirm Password do not match!");return}const h={old_password:o.old_password,new_password:o.new_password,confirm_password:o.confirm_password};await m.changePassword(h),g("updated"),g("close")};return(h,a)=>(n(),d("div",le,[e("div",ae,[a[7]||(a[7]=e("h2",{class:"text-xl font-bold text-center"},"Change Password",-1)),e("form",{onSubmit:A(_,["prevent"]),class:"space-y-4"},[e("div",re,[e("div",ne,[a[4]||(a[4]=e("label",{class:""},"Old Password",-1)),i(e("input",{"onUpdate:modelValue":a[0]||(a[0]=c=>o.old_password=c),type:p.value?"text":"password",class:"w-full p-2 border rounded pr-10",required:""},null,8,de),[[U,o.old_password]]),e("button",{type:"button",onClick:w,class:"absolute inset-y-0 right-2 mt-6 flex items-center px-2 text-gray-600"},[p.value?(n(),d("i",ue)):(n(),d("i",ie))])]),e("div",pe,[a[5]||(a[5]=e("label",{class:""},"New Password",-1)),i(e("input",{"onUpdate:modelValue":a[1]||(a[1]=c=>o.new_password=c),type:v.value?"text":"password",class:"w-full p-2 border rounded pr-10",required:""},null,8,fe),[[U,o.new_password]]),e("button",{type:"button",onClick:x,class:"absolute inset-y-0 right-2 mt-6 flex items-center px-2 text-gray-600"},[v.value?(n(),d("i",ce)):(n(),d("i",me))])]),e("div",ve,[a[6]||(a[6]=e("label",{class:""},"Confirm Password",-1)),i(e("input",{"onUpdate:modelValue":a[2]||(a[2]=c=>o.confirm_password=c),type:b.value?"text":"password",class:"w-full p-2 border rounded pr-10",required:""},null,8,be),[[U,o.confirm_password]]),e("button",{type:"button",onClick:C,class:"absolute inset-y-0 right-2 mt-6 flex items-center px-2 text-gray-600"},[b.value?(n(),d("i",we)):(n(),d("i",ye))])]),f.value?D("",!0):(n(),d("p",ge,"Passwords do not match!"))]),e("div",xe,[e("button",{type:"submit",class:I(["btn-2",{"pointer-events-none bg-blue-300":!f.value}])}," Set password ",2),e("button",{type:"button",onClick:a[3]||(a[3]=c=>g("close")),class:"btn-3"},"Cancel")])],32)])]))}},he={class:"my-container space-y-2"},Pe={class:"card-bg md:p-8 p-4 mx-4"},Ce={class:"grid gap-4"},ke={class:"border p-4 rounded-md bg-gray-100"},Ue={class:"flex justify-center w-full"},Se=["src"],Ve={class:"grid md:grid-cols-2 gap-4"},Me={class:"space-y-2"},$e=["value"],Be={class:"flex justify-center gap-4"},Ae={__name:"ProfileEdit",setup(L){const t=j({name:"",phone:"",email:"",nid:"",date_of_birth:"",address:"",blood:""}),g=["A+","A-","B+","B-","AB+","AB-","O+","O-"],m=O(),{user:o}=z(m),p=K(),v=se(),b=u(!1),w=u(!1),x=u(!1),C=u(null),f=u(null),_=u(!1),h=u(!1);H(()=>{o.value&&S()}),J(o,r=>{r&&S()});const a=()=>{C.value=o.value.photo,x.value=!0},c=()=>{x.value=!1,f.value=null},q=()=>{w.value=!1},T=r=>{f.value=r},S=()=>{var r,s,k,P,l,V,M;t.name=((r=o.value)==null?void 0:r.name)||"",t.phone=((s=o.value)==null?void 0:s.phone)||"",t.email=((k=o.value)==null?void 0:k.email)||"",t.address=((P=o.value)==null?void 0:P.address)||"",t.nid=((l=o.value)==null?void 0:l.nid)||"",t.blood=((V=o.value)==null?void 0:V.blood)||"",t.date_of_birth=((M=o.value)==null?void 0:M.date_of_birth)||""},E=async()=>{try{await m.updateProfile(t),p.success("Profile updated successfully!"),v.push({name:"MyProfile"})}catch(r){console.error("Failed to update profile:",r),p.error(m.error||"Failed to save profile!");return}},G=async()=>{if(console.log(f.value),!f.value)return;const r=new FormData;r.append("photo",f.value),r.append("user_id",o.value.id),console.log({formData:r});try{_.value=!0,await m.uploadProfilePhoto(r),h.value=!0,setTimeout(()=>{c(),_.value=!1,h.value=!1},1500),p.success("Image updated successfully!")}catch(s){console.error("Failed to upload photo:",s),p.error(m.error||"Failed to save profile!")}finally{_.value=!1}};return(r,s)=>{var P;const k=Y("RouterLink");return n(),d(F,null,[e("div",he,[e("div",Pe,[s[21]||(s[21]=e("h2",{class:"title-lg text-center"},"Edit Profile",-1)),b.value?(n(),$(oe,{key:0,class:"bg-gray-100 border shadow-none"})):(n(),d("form",{key:1,onSubmit:A(E,["prevent"]),class:"space-y-4"},[e("div",Ce,[e("div",ke,[e("div",Ue,[e("div",{onClick:a,class:"relative bg-gray-200 w-40 h-40 rounded-full overflow-hidden mx-auto flex items-center justify-center"},[e("img",{class:"object-cover w-full h-full",src:((P=B(o))==null?void 0:P.photo)||"/default-avatar.png",alt:"Profile Photo"},null,8,Se),s[8]||(s[8]=e("div",{class:"absolute inset-0 flex items-end justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity"},[e("button",{type:"button",class:"btn-2 px-3 py-1 text-sm rounded-md mb-2"}," Change ")],-1))])]),s[17]||(s[17]=e("p",{class:"title-md"},"Personal Info",-1)),s[18]||(s[18]=e("hr",{class:"my-2"},null,-1)),e("div",Ve,[e("div",null,[s[9]||(s[9]=e("label",null,"Name",-1)),i(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>t.name=l),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[y,t.name]])]),e("div",null,[s[10]||(s[10]=e("label",null,"Phone",-1)),i(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>t.phone=l),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[y,t.phone]])]),e("div",null,[s[11]||(s[11]=e("label",null,"Email",-1)),i(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>t.email=l),type:"email",class:"w-full p-2 border rounded"},null,512),[[y,t.email]])]),e("div",Me,[s[13]||(s[13]=e("label",{for:"bloodGroup",class:"text-gray-700 flex items-center gap-2"}," Blood Group ",-1)),i(e("select",{id:"bloodGroup","onUpdate:modelValue":s[3]||(s[3]=l=>t.blood=l),class:"py-2 px-4 border rounded w-full"},[s[12]||(s[12]=e("option",{disabled:"",value:""},"Select blood group",-1)),(n(),d(F,null,W(g,l=>e("option",{key:l,value:l},Z(l),9,$e)),64))],512),[[Q,t.blood]])]),e("div",null,[s[14]||(s[14]=e("label",null,"NID",-1)),i(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>t.nid=l),type:"text",class:"w-full p-2 border rounded"},null,512),[[y,t.nid]])]),e("div",null,[s[15]||(s[15]=e("label",null,"Date of Birth",-1)),i(e("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>t.date_of_birth=l),type:"date",class:"w-full p-2 border rounded"},null,512),[[y,t.date_of_birth]])]),e("div",null,[s[16]||(s[16]=e("label",null,"Address",-1)),i(e("textarea",{"onUpdate:modelValue":s[6]||(s[6]=l=>t.address=l),rows:"2",class:"w-full p-2 border rounded"},null,512),[[y,t.address]])])])])]),e("div",Be,[N(k,{to:{name:"MyProfile"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:X(()=>s[19]||(s[19]=[ee(" Cancel ")])),_:1}),s[20]||(s[20]=e("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1)),e("button",{type:"button",onClick:s[7]||(s[7]=l=>w.value=!w.value),class:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"}," Change Password ")])],32))])]),w.value?(n(),$(_e,{key:0,onClose:q,user:B(o)},null,8,["user"])):D("",!0),N(te,{imageSrc:C.value,isOpen:x.value,onClose:c,onFileSelected:T,onUploadPhoto:G},null,8,["imageSrc","isOpen"])],64)}}};export{Ae as default};
