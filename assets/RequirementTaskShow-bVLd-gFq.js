import{d as Ct,b as wt,u as Tt,r as Z,z as tt,e as $t,x as D,A as et,m as st,c as d,o as l,f as _,g as y,n as m,i as v,k as n,F as b,a,y as L,j as C,t as g,q as at,I as Dt,w as ot}from"./index-Cd4VWL73.js";import{L as nt}from"./LoaderView-CPXVE8EI.js";import{O as j}from"./OverlyModal-JSam_IuL.js";import{_ as lt}from"./DepartmentChip-Cb7fVPK7.js";import{_ as St}from"./DescriptionView-CVmiIUnm.js";import{_ as it}from"./TaskAssignedUsers-DL0x6W5_.js";import{_ as At,a as Mt,b as Ut}from"./TaskStatusManager-B08bgAx_.js";import{_ as Lt}from"./TaskStatus-C7PAPMYV.js";import{_ as jt,a as Et}from"./TodoCreateEditShow-BH0dSH2g.js";import{d as Rt,b as Bt}from"./datetime-DcVwRp76.js";import{s as rt}from"./dom-BKn8Ftnz.js";import{u as Vt}from"./useTaskStore-DTZKnrYW.js";import{a as zt}from"./useTodoStore-BYHRYoJX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-CgjdktaJ.js";import"./task-DGuGhAHM.js";import"./url-CePbr-gY.js";const It={class:"container mx-auto p-6"},Nt={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},qt={key:0,class:"text-sm mb-2 border-b","aria-label":"Breadcrumb"},Ft={class:"flex items-center gap-2"},Ht={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},Ot=["title"],Pt={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},Wt={class:"grid grid-cols-12 gap-x-8 gap-y-3"},Gt={class:"col-span-full lg:col-span-9 row-span-10"},Jt={class:"font-medium text-xl flex items-center gap-2"},Kt={class:"mt-2 col-span-full flex items-center"},Qt={class:"text-gray-400 text-xs"},Xt={class:"flex items-center gap-0.5"},Yt={class:"text-sky-400 text-sm font-semibold"},Zt=["innerHTML"],te={class:"flex justify-between items-end mt-6 mb-2"},ee={key:0,class:"border flex items-center justify-center h-96 rounded bg-gray-50 text-sm italic"},se={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},ae={class:"font-semibold flex items-center gap-2"},oe={class:"text-white text-base"},ne={class:"col-span-full lg:col-span-3 space-y-4 sticky top-16"},le={class:"flex items-start justify-center !text-lg mb-4"},ie={class:"border col-span-3 p-3 rounded shadow"},re={class:"flex items-center gap-2 mb-4"},de={class:"flex items-center gap-2 mb-4"},ue={class:"flex items-center gap-4 flex-wrap justify-between col-span-3"},ce=["disabled"],pe={key:2},me={key:1,class:"text-center py-4 text-red-500"},Le={__name:"RequirementTaskShow",setup(fe){const s=Vt(),dt=Ct(),E=zt(),u=wt(),A=Tt(),x=Z(""),S=tt({open:!1,task:null});$t(async()=>{x.value="loading",await k(u.params.id),x.value="",u.hash=="#sub-tasks"&&setTimeout(()=>rt(u.hash,66),0)});const h=tt({user:null,type:""});async function k(e){await s.fetchTask(e,{with_todos:"true"})}async function ut(){await k(u.params.id),h.user=null,h.type=""}const ct=e=>{A.push({name:"TaskEdit",params:{id:e}})},R=D(()=>{var e,t;return s.task?((e=s.task)==null?void 0:e.parent_id)==0?{name:M.value?"MyTaskList":"TaskList"}:{params:{id:(t=s.task)==null?void 0:t.parent_id},query:{"is-my-task":M.value}}:null});function pt(){S.open=!1,console.log({STATE:"Deleted",backLink:R.value}),A.push(R.value)}const M=D(()=>u.name=="MyTaskShow"||!!u.query["is-my-task"]),U=(e,t=!1)=>({id:e==null?void 0:e.id,title:e==null?void 0:e.title,status:e==null?void 0:e.status,is_current_page:t}),mt=D(()=>{var e,t;return(t=(e=s==null?void 0:s.task)==null?void 0:e.users)==null?void 0:t.find(i=>{var p;return((p=dt.user)==null?void 0:p.id)==i.id})}),B=D(()=>{var t,i,p,f,w,T;const e=[];return(t=s==null?void 0:s.task)!=null&&t.parent&&(e.push(U((i=s.task)==null?void 0:i.parent)),(f=(p=s==null?void 0:s.task)==null?void 0:p.parent)!=null&&f.parent&&e.push(U((T=(w=s.task)==null?void 0:w.parent)==null?void 0:T.parent))),[...e.reverse(),U(s.task,!0)]});et(()=>u.params.id,async e=>{x.value="changing",await k(e),x.value=""}),et(()=>u.hash,async function(){setTimeout(()=>rt(u.hash,66),0)});const c=Z({action:null}),V=D(()=>{const t=((s==null?void 0:s.task_todo_dates)||[]).reduce((i,p)=>{const f=p.date;return i[f]||(i[f]=[]),i[f].push(p),i},{});return Object.keys(t).sort((i,p)=>new Date(p)-new Date(i)).map(i=>({date:i,todo_dates:t[i]}))});function ft(){c.value={...c.value,action:""},k(u.params.id)}function yt(){c.value={...c.value,action:""},k(u.params.id)}function z(e){console.log({todo:e}),c.value={...c.value,action:"edit",todo:e}}function kt(e,t){console.log({yearMonthDay:t,todoId:e}),c.value={...c.value,action:"addDate",date:t,todo_id:e,formReadonlyValues:{date:!0}}}function _t(){c.value={action:null,todo:null}}function vt(e){console.log({todo:e}),c.value={...c.value,action:"show",todo:e}}function gt(){var e;c.value={...c.value,action:"add",todoTypeId:(e=u.params)==null?void 0:e.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}async function xt(e,t){var i;confirm(`Are your sure?
want to change status to ${t} 
todo: '${e==null?void 0:e.title}'`)&&(await E.updateStatus(e.id,t),k((i=u.params)==null?void 0:i.id))}async function ht(e){var t;confirm(`Are your sure want to delete todo
'${e==null?void 0:e.title}'`)&&(await E.deleteTodoDate(e.id),k((t=u.params)==null?void 0:t.id))}return(e,t)=>{var f,w,T,I,N,q,F,H,O,P,W,G,J,K,Q,X,Y;const i=st("RouterLink"),p=st("router-view");return l(),d("div",It,[h.user?(l(),_(j,{key:0},{default:v(()=>[m(At,{task:n(s).task,user:h.user,type:h.type,onCloseClick:t[0]||(t[0]=o=>h.user=null),onUpdateDate:ut},null,8,["task","user","type"])]),_:1})):y("",!0),S.open?(l(),_(j,{key:1},{default:v(()=>[m(Mt,{onCloseClick:t[1]||(t[1]=o=>S.open=!1),task:S.task,onDelete:pt},null,8,["task"])]),_:1})):y("",!0),x.value==="loading"?(l(),_(nt,{key:2,class:"h-[80vh] items-center justify-center"})):(l(),d("div",Nt,[n(s).task?(l(),d(b,{key:0},[B.value.length>1?(l(),d("nav",qt,[a("ol",Ft,[(l(!0),d(b,null,L(B.value,(o,r)=>(l(),d(b,{key:o.id},[r>0?(l(),d("li",Ht,"/")):y("",!0),a("li",{title:o==null?void 0:o.title,class:"text-gray-600 line-clamp-1"},[o.is_current_page?(l(),d("span",Pt,g(o==null?void 0:o.title),1)):(l(),_(i,{key:0,to:`${M.value?"/my-tasks":"/tasks"}/${o.id}`,class:at(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":r>0,"whitespace-nowrap":r===0}])},{default:v(()=>[C(g(o==null?void 0:o.title),1)]),_:2},1032,["to","class"]))],8,Ot)],64))),128))])])):y("",!0),a("div",Wt,[a("div",Gt,[a("div",null,[a("h2",Jt,[a("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:t[2]||(t[2]=o=>n(A).back())},t[7]||(t[7]=[a("i",{class:"fas fa-arrow-left"},null,-1)])),C(" "+g(n(s).task.title),1)]),a("div",Kt,[a("div",Qt,[t[8]||(t[8]=a("i",{class:"fas fa-clock"},null,-1)),C(" "+g(n(Rt)(n(s).task.created_at)),1)]),(f=n(s).task)!=null&&f.created_by_user?(l(),d(b,{key:0},[t[9]||(t[9]=a("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),a("div",Xt,[m(Dt,{user:(w=n(s).task)==null?void 0:w.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),a("div",Yt,g((I=(T=n(s).task)==null?void 0:T.created_by_user)==null?void 0:I.label),1)])],64)):y("",!0)])]),m(St,null,{default:v(()=>{var o;return[a("p",{innerHTML:(o=n(s).task)==null?void 0:o.description,class:"text-justify"},null,8,Zt)]}),_:1}),a("div",null,[a("div",te,[t[11]||(t[11]=a("h3",{class:"font-semibold text-xl"},"Todos",-1)),mt.value?(l(),d("button",{key:0,class:"btn btn-3 h-8",onClick:t[3]||(t[3]=ot(()=>gt(),["prevent"]))},t[10]||(t[10]=[a("i",{class:"fas fa-plus"},null,-1),C(" Add Todo ")]))):y("",!0)]),a("div",null,[V.value.length===0?(l(),d("div",ee," No Todos ")):y("",!0),(l(!0),d(b,null,L(V.value,o=>(l(),d("div",{key:o.date,class:"border rounded-md overflow-hidden mb-4"},[a("div",se,[a("div",ae,[a("div",oe,g(n(Bt)(o.date)),1)])]),a("div",null,[(l(!0),d(b,null,L((o==null?void 0:o.todo_dates)||[],r=>(l(),_(jt,{key:r.id,todoDate:r,onClickTodo:$=>vt($),onClickEdit:()=>z(r==null?void 0:r.todo),onClickChangeStatus:($,bt)=>xt($,bt),onClickDelete:$=>ht($),"hide-sorting-btn":"",class:"border-b border-sky-200"},null,8,["todoDate","onClickTodo","onClickEdit","onClickChangeStatus","onClickDelete"]))),128))])]))),128))])])]),a("div",ne,[(N=n(s))!=null&&N.task?(l(),_(Ut,{key:0,task:((q=n(s))==null?void 0:q.task)||{},class:"col-span-full",onUpdateStatus:t[4]||(t[4]=()=>{var o,r;return k((r=(o=n(s))==null?void 0:o.task)==null?void 0:r.id)}),"hide-timeline":""},{top:v(()=>{var o,r;return[a("div",le,[m(Lt,{status:(o=n(s).task)==null?void 0:o.status,progressPercent:(r=n(s).task)==null?void 0:r.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"])])]}),_:1},8,["task"])):y("",!0),a("div",ie,[a("div",null,[a("div",re,[t[12]||(t[12]=a("div",{class:"text-gray-500 text-sm"},"From",-1)),m(lt,{department:(H=(F=n(s))==null?void 0:F.task)==null?void 0:H.from_department},null,8,["department"])]),t[13]||(t[13]=a("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisors",-1)),m(it,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((P=(O=n(s))==null?void 0:O.task)==null?void 0:P.supervisors)||[],listType:"supervisors",maxItem:3},null,8,["users"])]),t[16]||(t[16]=a("hr",{class:"my-4"},null,-1)),a("div",null,[a("div",de,[t[14]||(t[14]=a("div",{class:"text-gray-500 text-sm"},"To",-1)),m(lt,{department:(G=(W=n(s))==null?void 0:W.task)==null?void 0:G.to_department},null,8,["department"])]),t[15]||(t[15]=a("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Assigned Users",-1)),m(it,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((K=(J=n(s))==null?void 0:J.task)==null?void 0:K.users)||[],isTargetTask:(X=(Q=n(s))==null?void 0:Q.task)==null?void 0:X.is_target,maxItem:5},null,8,["users","isTargetTask"])])]),a("div",ue,[m(i,{to:{name:"TaskUserAssign",params:{id:(Y=n(s).task)==null?void 0:Y.id}},class:at(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",n(s).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:t[5]||(t[5]=o=>o.stopPropagation())},{default:v(()=>t[17]||(t[17]=[a("i",{class:"fas fa-users-cog"},null,-1),C(" Assign Users ")])),_:1,__:[17]},8,["to","class"]),a("button",{onClick:t[6]||(t[6]=ot(o=>{var r;return ct((r=n(s).task)==null?void 0:r.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!n(s).task.closed_at},t[18]||(t[18]=[a("i",{class:"fas fa-edit"},null,-1),C(" Edit ")]),8,ce)])])]),n(u).name==="TaskReportAdd"?(l(),_(j,{key:1,class:"*:bg-transparent"},{default:v(()=>[m(p)]),_:1})):(l(),d("section",pe,[m(p)]))],64)):(l(),d("div",me,g(n(s).error),1)),x.value==="changing"?(l(),_(nt,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):y("",!0)])),m(Et,{userRole:"employee",todoModal:c.value,onCancelClick:_t,onTodoUpdate:ft,onTodoDateUpdate:yt,onClickEdit:z,onClickAddTodoDate:kt},null,8,["todoModal"])])}}};export{Le as default};
