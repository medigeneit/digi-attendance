import{d as B,s as R,r as g,q as A,A as q,e as L,c as f,o as b,m as M,f as x,a as t,w as E,h as k,n as d,t as y,g as r,l as w,v as T,D as I,C as z,y as O}from"./index-BEuGw95S.js";import{R as S}from"./RequiredIcon-DajCXdEC.js";import{u as G}from"./useRequirementStore-DFoTEndk.js";import{u as P}from"./useTaskStore-B8Pakvx_.js";import{S as h}from"./SectionLoading-CiZ0mXJF.js";const F={class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 relative"},K={key:0,class:"text-center mt-2 mb-6"},$={class:"text-sky-600"},j={key:1,class:"text-center mt-2 mb-6"},H={class:"text-sky-600"},J={class:"mb-4"},Q={class:"block text-gray-600 text-sm mb-1 font-medium"},W={class:"mb-4"},X={class:"flex gap-1 items-center"},Y={class:"flex gap-1 items-center"},Z={class:"grid grid-cols-2 gap-4 mb-4"},ee={class:"block text-gray-600 text-sm mb-1 font-medium"},te={class:"mt-8"},se={class:"grid grid-cols-2 gap-4 mb-4 mt-4"},le={class:"mb-4"},oe={class:"block text-gray-600 text-sm mb-1 font-medium"},ae={class:"mb-4"},re={class:"block text-gray-600 text-sm mb-1 font-medium"},ne={class:"mb-4"},ie={key:2,class:"mb-4 text-red-500 font-medium"},de={class:"flex items-center gap-4"},ue=["disabled"],ge={__name:"TaskAddForm",props:{parentTaskId:{type:Number,required:!0},requirementId:{type:Number}},emits:["taskCreated","close","error","ok"],setup(C,{emit:D}){const i=C,c=D,u=P();B();const _=G(),{requirement:m}=R(_),n=g(),N=g([]),V=A(()=>N.value.map(o=>o.id)),a=g(""),s=g({title:"",user_ids:[],priority:0,status:"PENDING",description:"",is_important:!1,is_urgent:!1});q(V,o=>{s.value.user_ids=o}),L(async()=>{a.value=""}),q(()=>({parentTaskId:i.parentTaskId,requirement:i.requirementId}),async()=>{var o;i.requirementId>0&&await _.fetchRequirement(i.requirementId),i.parentTaskId>0&&(n.value=(o=await u.fetchTask(i.parentTaskId,{},{loadingBeforeFetch:!1,fetchOnly:!0}))==null?void 0:o.task,console.log({t:n.value})),a.value="initialized"},{initial:!0,immediate:!0});async function U(){var e,p;a.value="loading";const o={...s.value,parent_id:((e=n==null?void 0:n.value)==null?void 0:e.id)||0,requirement_id:((p=m==null?void 0:m.value)==null?void 0:p.id)||null};try{await u.createTask(o,{loadingBeforeCreate:!1}),c("taskCreated"),a.value="taskCreated"}catch(v){console.log({err:v}),c("error",u.error),a.value="taskCreatingError"}}return(o,e)=>{var p,v;return b(),f("div",F,[a.value=="loading"?(b(),M(h,{key:0})):x("",!0),e[22]||(e[22]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Task",-1)),e[23]||(e[23]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/60 mb-4 text-xs",onClick:e[0]||(e[0]=E(l=>c("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. "),t("form",{onSubmit:E(U,["prevent"])},[C.requirementId&&((p=k(m))!=null&&p.title)?(b(),f("p",K,[e[10]||(e[10]=d(" Task under requirement ")),t("span",$,y(k(m).title),1)])):x("",!0),C.parentTaskId&&((v=n.value)!=null&&v.title)?(b(),f("p",j,[e[11]||(e[11]=d(" Sub task under ")),t("span",H,y(n.value.title),1)])):x("",!0),t("div",J,[t("label",Q,[e[12]||(e[12]=d("Task Title ")),w(S)]),r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.title=l),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,s.value.title]])]),t("div",W,[t("label",X,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=l=>s.value.is_important=l),class:"size-4"},null,512),[[I,s.value.is_important]]),e[13]||(e[13]=t("span",{class:"block text-gray-600 text-base pt-1 mb-1 font-medium"},"Important",-1))]),t("label",Y,[r(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=l=>s.value.is_urgent=l),class:"size-4"},null,512),[[I,s.value.is_urgent]]),e[14]||(e[14]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Urgent",-1))])]),t("div",Z,[t("div",null,[t("label",ee,[e[15]||(e[15]=d("Status ")),w(S)]),r(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.status=l),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[16]||(e[16]=[t("option",{value:""},"--select---",-1),t("option",null,"PENDING",-1),t("option",null,"IN_PROGRESS",-1),t("option",null,"COMPLETED",-1),t("option",null,"BLOCKED",-1),t("option",null,"CANCELLED",-1),t("option",null,"BACK_LOG",-1)]),512),[[z,s.value.status]])])]),t("div",te,[t("label",{class:O(["flex gap-1 items-center mt-4 border rounded py-2 justify-center cursor-pointer",{"bg-yellow-200":s.value.is_target}])},[r(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>s.value.is_target=l),class:"size-6"},null,512),[[I,s.value.is_target]]),e[17]||(e[17]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Is Target Task",-1))],2)]),t("div",se,[t("div",le,[t("label",oe,[e[18]||(e[18]=d(" Start Date ")),w(S)]),r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.started_at=l),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,s.value.started_at]])]),t("div",ae,[t("label",re,[e[19]||(e[19]=d(" Deadline ")),w(S)]),r(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.deadline=l),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,s.value.deadline]])])]),t("div",ne,[e[20]||(e[20]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),r(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.value.description=l),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,s.value.description]])]),e[21]||(e[21]=t("hr",{class:"mb-4"},null,-1)),k(u).error?(b(),f("div",ie,y(k(u).error),1)):x("",!0),t("div",de,[t("button",{disabled:a.value=="loading",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},y(a.value=="loading"?"Saving...":"Save Task"),9,ue),t("button",{type:"button",onClick:e[9]||(e[9]=l=>c("close")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32)])}}};export{ge as _};
