import{u as j,D as g,r as c,q as B,h as L,c as n,o as l,a as e,n as r,d as M,F as b,e as _,l as v,k,H as N,t as C,Q as S}from"./index-B_xL3wTw.js";import{_ as R}from"./MultiselectDropdown-BUX1xUhi.js";import{u as F}from"./company-CdUUMSCi.js";import{u as q}from"./department-Bu9nG0Jr.js";import{u as E}from"./user-DlGKWADD.js";import{u as H}from"./userPermissionStore-B-NZKWeh.js";const Q={class:"max-w-4xl mx-auto px-4 py-8 space-y-6"},T={class:"flex items-center justify-between gap-3"},z={class:"rounded-2xl border border-slate-200 bg-white shadow-sm p-6 space-y-6"},G={class:"space-y-4"},I={class:"flex items-center justify-between"},J=["onClick"],K=["onUpdate:modelValue","onChange"],O=["value"],W={key:0},X={class:"space-y-2"},Y={class:"flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-2 text-sm bg-white"},Z=["onUpdate:modelValue"],ee={key:0,class:"grid grid-cols-1 sm:grid-cols-2 gap-2"},se=["value","onUpdate:modelValue"],te={class:"truncate"},oe={class:"flex items-center justify-end gap-2 pt-2"},ae=["disabled"],ne={key:0},le={key:1},be={__name:"PermissionAdd",setup(re){const x=E(),d=H(),u=j(),f=F(),y=q(),{users:w}=g(x),{companies:U}=g(f),p=c(null),i=c({user_id:"",companies:[]}),m=c({});B(p,a=>{i.value.user_id=(a==null?void 0:a.id)||""});const P=async a=>{a.department_ids=[],await y.fetchDepartments(a.company_id),m.value[a.company_id]=y.departments},D=()=>{i.value.companies.push({company_id:"",department_ids:[]})},V=a=>{i.value.companies.splice(a,1)},A=async()=>{try{await d.createPermission(i.value),u.push({name:"PermissionList"})}catch{alert(d.error)}};return L(()=>{x.fetchUsers({type:"admin"}),f.fetchCompanies()}),(a,s)=>(l(),n("div",Q,[e("header",T,[s[4]||(s[4]=e("div",null,[e("h2",{class:"text-xl font-semibold text-slate-900"},"Add Permission"),e("p",{class:"text-xs text-slate-500"},"Assign user access by company and department.")],-1)),e("button",{class:"btn-3",onClick:s[0]||(s[0]=t=>r(u).push({name:"PermissionList"}))},s[3]||(s[3]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)]))]),e("div",z,[M(R,{modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=t=>p.value=t),options:r(w),multiple:!1,label:"label","top-label":"Select User",placeholder:"Select employee"},null,8,["modelValue","options"]),e("div",{class:"flex items-center justify-between"},[s[5]||(s[5]=e("div",{class:"text-sm font-semibold text-slate-800"},"Companies",-1)),e("button",{type:"button",class:"inline-flex items-center gap-1 rounded-lg border border-slate-200 px-3 py-1.5 text-sm hover:bg-slate-50",onClick:D}," + Add Company ")]),e("div",G,[(l(!0),n(b,null,_(i.value.companies,(t,h)=>(l(),n("div",{key:h,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 space-y-3"},[e("div",I,[s[6]||(s[6]=e("label",{class:"text-sm font-medium text-slate-700"},"Company",-1)),e("button",{onClick:o=>V(h),class:"text-xs text-red-600 hover:text-red-700"},"Remove",8,J)]),v(e("select",{"onUpdate:modelValue":o=>t.company_id=o,onChange:o=>P(t),class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm bg-white"},[s[7]||(s[7]=e("option",{value:""},"-- Select Company --",-1)),(l(!0),n(b,null,_(r(U),o=>(l(),n("option",{key:o.id,value:o.id},C(o.name),9,O))),128))],40,K),[[N,t.company_id]]),t.company_id&&m.value[t.company_id]&&m.value[t.company_id].length?(l(),n("div",W,[s[9]||(s[9]=e("label",{class:"block text-sm font-medium text-slate-700 mb-2 mt-3"},"Departments",-1)),e("div",X,[e("label",Y,[v(e("input",{type:"checkbox",value:"*","onUpdate:modelValue":o=>t.department_ids=o,class:"h-4 w-4"},null,8,Z),[[S,t.department_ids]]),s[8]||(s[8]=e("span",{class:"font-medium"},"All Departments",-1))]),t.department_ids.includes("*")?k("",!0):(l(),n("div",ee,[(l(!0),n(b,null,_(m.value[t.company_id],o=>(l(),n("label",{key:o.id,class:"flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-2 text-sm bg-white hover:bg-slate-50"},[v(e("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":$=>t.department_ids=$,class:"h-4 w-4"},null,8,se),[[S,t.department_ids]]),e("span",te,C(o.name),1)]))),128))]))])])):k("",!0)]))),128))]),e("div",oe,[e("button",{type:"button",class:"btn-3",onClick:s[2]||(s[2]=t=>r(u).push({name:"PermissionList"}))},"Cancel"),e("button",{onClick:A,disabled:r(d).loading,class:"btn-2"},[r(d).loading?(l(),n("span",ne,"Saving...")):(l(),n("span",le,"Save Permission"))],8,ae)])])]))}};export{be as default};
