import{u as q,d as z,r as f,q as D,a3 as V,A,e as Y,n as I,c as m,o as v,a,f as J,p as C,i as O,j as P,w as G,g as x,h as c,v as g,t as k,F as E,x as R,k as B,a4 as L}from"./index-CRy9uoYJ.js";import{L as K}from"./LoaderView-Ae8WPiEn.js";import{_ as Q}from"./MultiselectDropdown-BD4KFPet.js";import{u as X}from"./holiday-BcODJ9g4.js";import{u as Z}from"./leave-application-C1skXL0G.js";import{u as ee}from"./leave-type-XGdf9psq.js";import{u as ae}from"./user-BcV91j2k.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"my-container max-w-3xl space-y-4"},se={class:"flex items-center justify-between gap-2"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ne={key:0,class:""},oe={class:"text-blue-600 font-medium"},re={key:1,class:"bg-gray-100 p-2 rounded-md"},de={class:"font-semibold"},ie={class:"flex flex-wrap gap-2"},ue=["name","value","onUpdate:modelValue","disabled"],pe={class:"flex items-center space-x-1"},ve=["name","onUpdate:modelValue"],me={class:"flex items-center space-x-1"},ce=["name","onUpdate:modelValue"],fe={key:2,class:"text-red-500 text-sm"},Le={__name:"LeaveApplicationAdd",setup(ye){const T=q(),H=Z(),y=ee(),U=ae(),d=z(),S=X(),w=f(""),o=f({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),i=f([]),b=f([]),h=f(!1),_=f(null),M=D(()=>{var l,e,r;return((e=(l=d==null?void 0:d.user)==null?void 0:l.assign_weekend)==null?void 0:e.weekends)||((r=d==null?void 0:d.user)==null?void 0:r.weekends)}),u=D(()=>{const l=o.value.last_working_date,e=o.value.resumption_date;if(!l||!e)return[];const r=new Date(l),t=new Date(e);if(t<=r)return[];const n=[];let s=new Date(r);for(s.setDate(s.getDate()+1);s<t;){const p=s.getFullYear(),j=(s.getMonth()+1).toString().padStart(2,"0"),F=s.getDate().toString().padStart(2,"0");n.push(`${p}-${j}-${F}`),s.setDate(s.getDate()+1)}return n}),N=D(()=>{const l=o.value.last_working_date,e=o.value.resumption_date;if(!l||!e)return"";const r=new Date(l);return new Date(e)<=r?"Resumption date must be after Last Working Date.":u.value.length===0?"No leave days between the selected dates.":`Total leave days: ${u.value.length}`});V(async()=>{var l;u.value.length&&y.leaveTypes.length&&(await S.fetchHolidays({company_id:(l=d==null?void 0:d.user)==null?void 0:l.company_id,start_date:u.value[0],end_date:u.value[u.value.length-1]}),u.value.forEach(async(e,r)=>{const t=new Date(e).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),n=t.charAt(0).toUpperCase()+t.slice(1);M.value.includes(n)&&(i.value[r]="weekend"),S.holidayDates.includes(e)&&(i.value[r]="holiday")}))}),A(()=>w.value,l=>{o.value.handover_user_id=l==null?void 0:l.id}),A(i,l=>{const e={};l.forEach(t=>{typeof t=="number"&&(e[t]=(e[t]||0)+1)});const r=y.leaveTypes.filter(t=>(e[t.id]||0)>t.remaining_days);r.length?(b.value=r.map(t=>t.name),alert(`You have exceeded remaining days for: ${b.value.join(", ")}`)):b.value=[]});const W=async()=>{var l;h.value=!0,_.value=null;try{const e=u.value.map((s,p)=>({date:s,leave_type_id:i.value[p]!=="weekend"&&i.value[p]!=="holiday"?i.value[p]:null})).filter(s=>s.leave_type_id!==null),r=u.value.map((s,p)=>({date:s,leave_type_id:i.value[p]||""})).filter(s=>s.leave_type_id!==null),t={user_id:(l=d==null?void 0:d.user)==null?void 0:l.id,last_working_date:o.value.last_working_date,resumption_date:o.value.resumption_date,reason:o.value.reason,works_in_hand:o.value.works_in_hand,handover_user_id:o.value.handover_user_id,leave_days:e,json_data:r},n=await H.storeLeaveApplication(t);n&&T.push({name:"LeaveApplicationShow",params:{id:n==null?void 0:n.id}})}catch(e){_.value=e.message||"Failed to submit leave application"}finally{h.value=!1}};Y(()=>{V(()=>{var e;const l=(e=d==null?void 0:d.user)==null?void 0:e.company_id;l&&y.fetchLeaveTypes(l)}),U.fetchTypeWiseEmployees({except:"auth"})});const $=()=>{T.go(-1)};return(l,e)=>{const r=I("RouterLink");return v(),m("div",te,[a("div",se,[a("button",{class:"btn-3",onClick:$},e[5]||(e[5]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=a("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),a("div",null,[C(r,{to:"/applications",class:"btn-2"},{default:O(()=>e[6]||(e[6]=[P("Home")])),_:1,__:[6]})])]),h.value?(v(),J(K,{key:0})):(v(),m("form",{key:1,onSubmit:G(W,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[a("div",le,[a("div",null,[e[8]||(e[8]=a("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),c(a("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=t=>o.value.last_working_date=t),class:"input-1 w-full",required:""},null,512),[[g,o.value.last_working_date]])]),a("div",null,[e[9]||(e[9]=a("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),c(a("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=t=>o.value.resumption_date=t),class:"input-1 w-full",required:""},null,512),[[g,o.value.resumption_date]])])]),o.value.last_working_date&&o.value.resumption_date?(v(),m("div",ne,[a("p",oe,k(N.value),1)])):x("",!0),u.value.length?(v(),m("div",re,[e[12]||(e[12]=a("h2",{class:"text-lg font-semibold"},"Leave Days ",-1)),a("div",null,[(v(!0),m(E,null,R(u.value,(t,n)=>(v(),m("div",{key:n,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[a("div",de,k(t),1),a("div",ie,[(v(!0),m(E,null,R(B(y).leaveTypes,s=>(v(),m("label",{key:s.id,class:"flex items-center space-x-1"},[c(a("input",{type:"radio",name:"leaveType-"+n,value:s.id,"onUpdate:modelValue":p=>i.value[n]=p,disabled:i.value.filter(p=>p===s.id).length>=s.remaining_days},null,8,ue),[[L,i.value[n]]]),a("span",null,k(s.leave_type),1)]))),128)),a("label",pe,[c(a("input",{type:"radio",name:"leaveType-"+n,value:"weekend","onUpdate:modelValue":s=>i.value[n]=s},null,8,ve),[[L,i.value[n]]]),e[10]||(e[10]=a("span",null,"Weekend",-1))]),a("label",me,[c(a("input",{type:"radio",name:"leaveType-"+n,value:"holiday","onUpdate:modelValue":s=>i.value[n]=s},null,8,ce),[[L,i.value[n]]]),e[11]||(e[11]=a("span",null," Holiday",-1))])])]))),128))])])):x("",!0),a("div",null,[e[13]||(e[13]=a("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),c(a("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=t=>o.value.reason=t),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[g,o.value.reason]])]),a("div",null,[e[14]||(e[14]=a("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),C(Q,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),options:B(U).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])]),a("div",null,[e[15]||(e[15]=a("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),c(a("textarea",{id:"works-in-hand","onUpdate:modelValue":e[4]||(e[4]=t=>o.value.works_in_hand=t),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[g,o.value.works_in_hand]])]),_.value?(v(),m("div",fe,k(_.value),1)):x("",!0),e[16]||(e[16]=a("div",{class:"flex justify-end"},[a("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{Le as default};
