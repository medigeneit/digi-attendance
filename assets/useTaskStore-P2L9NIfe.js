import{J as E,r as d,q as f,K as o}from"./index-CRy9uoYJ.js";const A=E("task",()=>{const i=d([]),v=d(null),c=d(!1),n=d(null),p=async(e,r,{updateStoreData:a=!0})=>{var s,t;a==!0&&(c.value=!0,n.value=null);try{await o.post(`/tasks/${e}/assign-users`,{user_ids:r}),await y(e)}catch(l){throw a==!0&&(n.value=((t=(s=l.response)==null?void 0:s.data)==null?void 0:t.message)||"Assign users failed"),l}finally{a==!0&&(c.value=!1)}},w=async e=>{var r,a,s;n.value=null;try{const t=await o.get("/tasks",{params:e});return i.value=((r=t.data)==null?void 0:r.tasks)||[],t.data}catch(t){throw n.value=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",t}},T=async(e,{}={})=>{var r,a,s;n.value=null;try{const t=await o.get("/my-tasks",{params:e});return i.value=((r=t.data)==null?void 0:r.tasks)||[],t.data}catch(t){throw n.value=((s=(a=t.response)==null?void 0:a.data)==null?void 0:s.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",t),t}};function k(e,r=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>a.parent_id===r).map(a=>({...a,children_tasks:k(e,a.id)}))}function h(){return k(i.value,0)}function m(){const e=[],r=(a,s=0,t="")=>{a.forEach(l=>{e.push({...l,depth:s,idPath:t+l.id}),l.children_tasks&&l.children_tasks.length&&r(l.children_tasks,s+1,t+l.id+"-")})};return r(h()),e}const y=async(e,r={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var s,t,l;a.fetchOnly||(c.value=!0),n.value=null;try{const u=await o.get(`/tasks/${e}`,{params:r});return a.fetchOnly||(v.value=((s=u.data)==null?void 0:s.task)||{},i.value=u.data.sub_tasks||[]),u.data}catch(u){const g=((l=(t=u.response)==null?void 0:t.data)==null?void 0:l.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(n.value=g),g}finally{a.fetchOnly||(c.value=!1)}},$=async(e,r={loadingBeforeCreate:!1})=>{var a,s,t,l;r.loadingBeforeCreate&&(c.value=!0),n.value=null;try{const u=await o.post("/tasks",e);return(a=u.data)!=null&&a.data&&i.value.push((s=u.data)==null?void 0:s.data),u.data.data}catch(u){throw n.value=((l=(t=u.response)==null?void 0:t.data)==null?void 0:l.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",u),u}finally{r.loadingBeforeCreate&&(c.value=!1)}},_=async(e,r,{loadingBeforeFetch:a=!0})=>{a&&(c.value=!0),n.value=null;try{const s=await o.put(`/tasks/${e}`,r),t=i.value.findIndex(l=>l.id===e);return t!==-1&&(i.value[t]=s.data.data),s.data.data}catch(s){throw s}finally{a&&(c.value=!1)}},O=async(e,r)=>(await o.put(`/tasks/${e}/update-priorities`,{task_ids:r})).data,C=async e=>{var r,a;c.value=!0,n.value=null;try{await o.delete(`/tasks/${e}`),i.value=i.value.filter(s=>s.id!==e)}catch(s){n.value=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,s)}finally{c.value=!1}};return{tasks:f(()=>i.value),task:f(()=>v.value),loading:f(()=>c.value),error:f(()=>n.value),taskListTree:f(h),flattenedTasks:f(m),fetchTasks:w,fetchMyTasks:T,fetchTask:y,createTask:$,updateTask:_,deleteTask:C,assignUsers:p,updateTaskPriorities:O}});export{A as u};
