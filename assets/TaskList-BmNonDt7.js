import{q as $,c as k,o as r,a,F as q,y as D,f as T,l as g,p as U,n as X,t as M,s as Y,b as Z,u as ee,r as C,D as te,e as se,A as L,m as h,g as ae,C as ne,h as f,w as R}from"./index-v2nHsjtM.js";import{_ as oe}from"./CommentModal-C86_oxey.js";import{g as le,u as re,O as H,_ as ie}from"./task-priority-CNIEzLFe.js";import{_ as de}from"./MultiselectDropdown-lH0xVgUH.js";import{_ as ue}from"./TaskAddForm-DM7XUyKq.js";import{_ as me}from"./TaskEditForm-CA9XefvE.js";import{_ as O}from"./TaskTreeView-CriKUNEW.js";import{_ as ce}from"./UserChip-fCBol3n7.js";import{u as pe}from"./company-Dd-DDZhG.js";import{u as fe}from"./useTaskStore-CGvVBAm8.js";import"./useCommentStore-DLn2yBb4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-CD9M7tLz.js";import"./useRequirementStore-DrHH-0Se.js";import"./SectionLoading-DYRW-PjQ.js";const ke={class:"w-full bg-white rounded"},ye=["rowspan"],ve={class:""},_e={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(V,{emit:y}){const _=V,w=y,x=$(()=>_.tasks.reduce((o,n)=>(o.push(...n.users.filter(i=>!o.find(d=>d.id==i.id&&i.id))),o),[]).filter(o=>_.selectedUserId?o.id==_.selectedUserId:!0)),m=o=>{const n=_.tasks,i=new Map(n.map(t=>[t.id,t])),d=new Set,c=[],p=n.filter(t=>t.users.some(u=>u.id===o));for(const t of p){d.has(t.id)||(d.add(t.id),c.push(t));let u=t.parent_id;for(;u&&i.has(u)&&!d.has(u);){const v=i.get(u);d.add(v.id),c.push(v),u=v.parent_id}}return c},S=$(()=>x.value.map(o=>{const n=le(m(o.id),0);return{...o,tasks:n}}));return(o,n)=>(r(),k("div",null,[a("table",ke,[a("tbody",null,[(r(!0),k(q,null,D(S.value,i=>(r(),k(q,{key:i.id},[(r(!0),k(q,null,D(i.tasks,(d,c)=>(r(),k("tr",{key:d.id},[c==0?(r(),k("td",{key:0,class:"border p-4 align-top",rowspan:Math.max(i.tasks.length,1)},[g(ce,{user:i,class:"sticky top-[80px]"},null,8,["user"])],8,ye)):T("",!0),a("td",ve,[g(O,{task:d,class:"!border-0",index:c,onCommentButtonClick:n[0]||(n[0]=p=>w("commentButtonClick",o.item.id)),onEditClick:n[1]||(n[1]=p=>w("editClick",p)),onAddClick:n[2]||(n[2]=p=>w("addClick",p))},{"item-override":U(({task:p,level:t})=>[X(M({task:p,level:t}),1)]),_:2},1032,["task","index"])])]))),128))],64))),128))])])]))}},Ce={class:"container mx-auto p-6 relative"},ge={class:"mb-3"},we={class:"flex flex-wrap items-center gap-2 mt-3"},be={class:"flex gap-4"},Ie={class:"flex-shrink-0 w-full md:w-64 text-gray-600"},Te=["value"],xe={class:"ml-auto flex gap-6 items-center"},he={key:0,class:"flex gap-2 items-center"},qe={key:2,class:"text-center py-4 text-red-500"},Ue={class:"space-y-4"},$e={class:"flex items-stretched"},Se=1,Qe={__name:"TaskList",setup(V){const y=fe(),_=pe(),{companies:w,employees:x}=Y(_),m=Z(),S=ee(),o=C(!1),n=C(null),i=$(E("company-id")),d=$(E("user-id")),c=C(),p=C(!1),t=C(null),u=C(!1),v=te({parentId:0,requirementId:0}),B=C(null);se(async()=>{await _.fetchCompanies(),await b()});const A=l=>{u.value=!0,v.parentId=l};function E(l){return{set:e=>{S.push({query:{...m.query,[l]:e||void 0}})},get:()=>m.query[l]||""}}const P=l=>{n.value=l,o.value=!0},j=()=>{o.value=!1,n.value=null};L(()=>i.value,async l=>{l&&(await _.fetchEmployee(l),c.value=x.value.find(e=>e.id==d.value)||null)},{initial:!0,immediate:!0}),L(()=>({"user-id":m.query["user-id"],"company-id":m.query["company-id"]}),async()=>{b()});async function b(){p.value=!!m.query["user-id"],await y.fetchTasks({user_ids:m.query["user-id"]||void 0,company_id:m.query["company-id"]||void 0},{loadingBeforeFetch:!0})}async function F(){t.value=null,u.value=!1,v.parentId=0,await b()}async function G(){u.value=!1,v.parentId=0,await b()}L(c,l=>{d.value=l==null?void 0:l.id});const{handleItemsPriorityUpdate:Q,saveTaskPriority:W,listHasRearranged:z}=re(()=>y.taskListTree,0);async function J(){W()&&await b()}return(l,e)=>{var N;return r(),k("div",Ce,[t.value?(r(),h(H,{key:0},{default:U(()=>[g(me,{taskId:t.value,class:"rounded-full",onClose:e[0]||(e[0]=s=>t.value=null),onUpdated:F},null,8,["taskId"])]),_:1})):T("",!0),u.value?(r(),h(H,{key:1},{default:U(()=>[g(ue,{parentTaskId:v.parentId,requirementId:v.requirementId,class:"rounded-full",onClose:G,onTaskCreated:F},null,8,["parentTaskId","requirementId"])]),_:1})):T("",!0),a("div",ge,[e[12]||(e[12]=a("div",{class:"flex justify-between items-center"},[a("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),a("div",we,[a("div",be,[a("div",Ie,[ae(a("select",{id:"company-filter","onUpdate:modelValue":e[1]||(e[1]=s=>i.value=s),class:"input-1 h-full"},[e[10]||(e[10]=a("option",{value:""},"Select Company",-1)),(r(!0),k(q,null,D(f(w),s=>(r(),k("option",{key:s.id,value:s.id},M(s.name),9,Te))),128))],512),[[ne,i.value]])]),g(de,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=s=>c.value=s),options:f(x),multiple:!1,label:"name","label-prefix":"id",placeholder:"Please select employee...",class:"w-full md:w-64 text-gray-600"},null,8,["modelValue","options"])]),a("div",xe,[f(z)?(r(),k("div",he,[e[11]||(e[11]=a("span",{class:"text-red-500"},"Priority Changed",-1)),a("button",{class:"btn-3",onClick:R(J,["prevent"])},"Save"),a("button",{class:"btn-3",onClick:e[3]||(e[3]=R((...s)=>B.value.resetItems&&B.value.resetItems(...s),["prevent"]))},"Discard")])):T("",!0),a("button",{onClick:A,class:"btn-1"},"Add Task")])])]),f(y).error?(r(),k("div",qe,M(f(y).error),1)):T("",!0),a("div",Ue,[((N=f(m).query)==null?void 0:N.view)=="userwise"?(r(),h(_e,{key:0,tasks:f(y).tasks,selectedUserId:f(m).query["user-id"],onCommentButtonClick:e[4]||(e[4]=s=>P(s,l.task.id)),onEditClick:e[5]||(e[5]=s=>t.value=s),onAddClick:e[6]||(e[6]=s=>A(s))},null,8,["tasks","selectedUserId"])):(r(),h(ie,{key:1,items:f(y).taskListTree,handle:"handle",onItemsUpdate:f(Q),class:"space-y-4",ref_key:"draggableTaskList",ref:B},{item:U(({item:s,index:K})=>[a("div",$e,[g(O,{task:s,index:K,class:"!border-0",onCommentButtonClick:e[7]||(e[7]=I=>P(I,l.task.id)),onEditClick:e[8]||(e[8]=I=>t.value=I),onAddClick:e[9]||(e[9]=I=>A(I)),showDraggableHandle:!p.value},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))]),g(oe,{show:o.value,"commentable-id":n.value,"commentable-type":"task","user-id":Se,"on-close":j,onSubmitted:f(y).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Qe as default};
