import{_ as re}from"./CommentModal-DjYZ-DXN.js";import{u as ie,O as X,_ as ue}from"./task-priority-az1ga_BB.js";import{L as de}from"./LoaderView-Ism07Ips.js";import{_ as Y,a as me}from"./TaskAddForm-CQUM3HZ6.js";import{_ as pe}from"./TaskEditForm-CLuQEteB.js";import{b as se,q as y,s as ce,e as le,A as ae,c as d,o,a as s,f as x,w as z,m as h,h as a,p as U,l as T,g as A,C as ye,D as O,v as Z,F as B,x as W,y as G,u as fe,r as L,E as ke,k as ve,t as ee,n as te}from"./index-CmUG1yhs.js";import{_ as be}from"./MultiselectDropdown-D356SxOO.js";import{u as ge}from"./company-aohV4kn8.js";import{_ as oe}from"./UserChip-ZJ1tCDPx.js";import{_ as ne}from"./TaskTreeView-Cwgs7bY9.js";import{u as xe}from"./useTaskStore-4-eUWnlM.js";import"./useCommentStore-DVB-QPM8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-DEwiI6_z.js";import"./useRequirementStore-BWjq6WW3.js";import"./SectionLoading-D9PJxhmG.js";import"./vue-multiselect.esm-DdA1cBwq.js";import"./datetime-BISRKKpq.js";const we={class:"mb-3 task-header"},Ce={class:"flex justify-between items-center"},Te={class:"ml-auto flex gap-6 items-center"},Ve={key:0,class:"flex gap-2 items-center"},_e={class:"flex flex-wrap items-center gap-2 mt-3"},Ie={class:"flex flex-wrap gap-4 w-full"},qe={key:2,class:"relative w-full md:w-72"},$e={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},he={class:"text-gray-600 w-40 relative"},Ue={class:"flex gap-4 items-center flex-shrink-0"},Se={class:"flex gap-2"},Le={class:"flex gap-2"},Ae={class:"flex gap-2"},De={class:"text-gray-600 w-full md:w-40 relative"},Me={class:"text-gray-600 w-full border lg:w-48 md:ml-auto relative"},Ee={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(D,{emit:p}){const l=D,w=se(),q=y(v("from-department-id")),b=y(v("to-department-id")),$=y(v("user-ids")),r=y(v("month")),i=y(v("status")),u=y(v("is-important")),f=y(v("is-urgent")),k=y(v("is-target")),V=y(P()),S=p,C=ge(),{employees:_}=ce(C);function v(t){return{get:()=>l.modelValue[t]||"",set:e=>{S("update:modelValue",{...l.modelValue,[t]:e||void 0})}}}function P(){let t=0;const e=g=>{S("update:modelValue",{...l.modelValue,search:g||void 0})};return{get:()=>l.modelValue.search||"",set:g=>{clearTimeout(t),t=setTimeout(e,500,g)}}}const R=y(()=>j($.value));async function N(t){t&&await C.fetchEmployee(t)}async function H(){if(b.value){const t=C.companies.find(e=>e.departments.some(g=>g.id==b.value));await C.fetchEmployee(t.id)}}le(async()=>{var t,e;await C.fetchCompanies({with:"departments",ignore_permission:!0}),(t=l.modelValue)!=null&&t["company-id"]&&await N((e=l.modelValue)==null?void 0:e["company-id"])});function j(t){return Array.isArray(_.value)&&_.value.find(e=>e.id==t)||null}function F(t){$.value=(t==null?void 0:t.id)||""}function c(){$.value=""}return ae(()=>b.value,H),(t,e)=>{var g,M;return o(),d("div",we,[s("div",Ce,[e[12]||(e[12]=s("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),s("div",Te,[D.listHasRearranged?(o(),d("div",Ve,[e[11]||(e[11]=s("span",{class:"text-red-500"},"Priority Changed",-1)),s("button",{class:"btn-3",onClick:e[0]||(e[0]=z(n=>S("clickPrioritySave"),["prevent"]))},"Save"),s("button",{class:"btn-3",onClick:e[1]||(e[1]=z(n=>S("clickPriorityDiscard"),["prevent"]))},"Discard")])):x("",!0),s("button",{onClick:e[2]||(e[2]=n=>S("clickAddTask")),class:"btn-1"},"Add Task")])]),s("div",_e,[s("div",Ie,[a(w).name!=="MyTaskList"?(o(),h(Y,{key:0,modelValue:q.value,"onUpdate:modelValue":e[3]||(e[3]=n=>q.value=n),companies:((g=a(C))==null?void 0:g.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"}},{label:U(()=>e[13]||(e[13]=[s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," From Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),a(w).name!=="MyTaskList"?(o(),h(Y,{key:1,modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=n=>b.value=n),companies:((M=a(C))==null?void 0:M.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"}},{label:U(()=>e[14]||(e[14]=[s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," To Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),a(w).name!=="MyTaskList"?(o(),d("div",qe,[T(be,{modelValue:R.value,onSelect:F,onRemove:c,options:a(_),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employees",class:"text-gray-600 w-full"},{option:U(({option:n})=>[T(oe,{user:n,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),R.value?(o(),d("div",$e,[s("button",{onClick:z(c,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):x("",!0),e[15]||(e[15]=s("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):x("",!0),s("div",he,[e[17]||(e[17]=s("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),A(s("select",{"onUpdate:modelValue":e[5]||(e[5]=n=>i.value=n),class:"input-1"},e[16]||(e[16]=[s("option",{value:""},"All Tasks",-1),s("option",{value:"not-completed"},"Not Completed",-1),s("option",{value:"only-completed"},"Completed",-1)]),512),[[ye,i.value]])]),s("div",Ue,[s("label",Se,[A(s("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=n=>u.value=n)},null,512),[[O,u.value]]),e[18]||(e[18]=s("span",null,"Important",-1))]),s("label",Le,[A(s("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=n=>f.value=n)},null,512),[[O,f.value]]),e[19]||(e[19]=s("span",null,"Urgent",-1))]),s("label",Ae,[A(s("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=n=>k.value=n)},null,512),[[O,k.value]]),e[20]||(e[20]=s("span",null,"Is Target",-1))])]),s("div",De,[e[21]||(e[21]=s("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),A(s("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=n=>r.value=n),type:"month",class:"input-1",placeholder:"All month"},null,512),[[Z,r.value]])]),s("div",Me,[e[22]||(e[22]=s("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),A(s("input",{id:"search","onUpdate:modelValue":e[10]||(e[10]=n=>V.value=n),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[Z,V.value]]),e[23]||(e[23]=s("i",{class:"fas fa-search absolute right-2 top-[50%] translate-y-[-50%]"},null,-1))])])])])}}},Be={class:"w-full bg-white rounded"},Pe=["rowspan"],Re={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(D,{emit:p}){const l=D,w=p,q=y(()=>l.tasks.reduce((r,i)=>(r.push(...i.users.filter(u=>!r.find(f=>f.id==u.id&&u.id))),r),[]).filter(r=>l.selectedUserId?r.id==l.selectedUserId:!0)),b=r=>l.tasks.filter(f=>f.users.some(k=>k.id===r)),$=y(()=>q.value.map(r=>{const i=b(r.id);return{...r,tasks:i}}));return(r,i)=>(o(),d("div",null,[s("table",Be,[s("tbody",null,[(o(!0),d(B,null,W($.value,u=>(o(),d(B,{key:u.id},[(o(!0),d(B,null,W(u.tasks,(f,k)=>(o(),d("tr",{key:f.id},[k==0?(o(),d("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(u.tasks.length,1)},[T(oe,{user:u,class:"sticky top-[80px]"},null,8,["user"])],8,Pe)):x("",!0),s("td",{class:G(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":k==0,"border-b":u.tasks.length-1===k}])},[T(ne,{task:f,class:"!border-0 my-0",index:k,onCommentButtonClick:i[0]||(i[0]=V=>w("commentButtonClick",r.item.id)),onEditClick:i[1]||(i[1]=V=>w("editClick",V)),onAddClick:i[2]||(i[2]=V=>w("addClick",V))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Ne={class:"container mx-auto p-6 relative"},Fe={class:"mb-4"},He={class:"w-full flex justify-end gap-5 mb-1"},je={key:3},ze={key:0,class:"text-center py-4 text-red-500"},Oe={key:1},We={class:"flex items-stretched"},Ge={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Je=1,ct={__name:"TaskList",setup(D){const p=xe(),l=se(),w=fe(),q=L(!1),b=L(null),$=L(!1),r=L(null),i=L(!1),u=ke({parentId:0,requirementId:0}),f=L(null),k=L([]),{handleItemsPriorityUpdate:V,saveTaskPriority:S,listHasRearranged:C}=ie(()=>p.taskListTree,0);le(async()=>{l.query.status||w.push({query:{...l.query,status:"not-completed"}}),await _()});async function _(){$.value=!!l.query["user-ids"];const c=await p.fetchTasks({...l.query},{newList:!0,loadingBeforeFetch:!0});k.value=c.query_log||[]}const v=c=>{i.value=!0,u.parentId=c},P=c=>{b.value=c,q.value=!0},R=()=>{q.value=!1,b.value=null};async function N(){r.value=null,i.value=!1,u.parentId=0,await _()}async function H(){i.value=!1,u.parentId=0,await _()}async function j(){S()&&await _()}ae(()=>({...l.query}),async()=>{await _()});const F=y({get(){return{...l.query}},set(c){localStorage.removeItem("sub_task_opened_list"),w.push({query:{...c}})}});return(c,t)=>{var g,M,n,J,K,Q;const e=ve("RouterLink");return o(),d("div",Ne,[r.value?(o(),h(X,{key:0},{default:U(()=>[T(pe,{taskId:r.value,onClose:t[0]||(t[0]=m=>r.value=null),onUpdated:N},null,8,["taskId"])]),_:1})):x("",!0),i.value?(o(),h(X,{key:1},{default:U(()=>[T(me,{parentTaskId:u.parentId,requirementId:u.requirementId,onClose:H,onTaskCreated:N},null,8,["parentTaskId","requirementId"])]),_:1})):x("",!0),T(Ee,{modelValue:F.value,"onUpdate:modelValue":t[1]||(t[1]=m=>F.value=m),onClickAddTask:v,onClickPrioritySave:j,onClickPriorityDiscard:t[2]||(t[2]=()=>a(C)?f.value.resetItems:null),"list-has-rearranged":a(C),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((M=(g=a(l))==null?void 0:g.query)==null?void 0:M["query-log"])=="true"?(o(!0),d(B,{key:2},W(k.value,(m,I)=>(o(),d("div",{key:I,class:"text-xs text-gray-500"},[s("div",Fe,ee(m.raw_query),1)]))),128)):x("",!0),s("div",He,[a(l).name!=="MyTaskList"?(o(),h(e,{key:0,class:G(["text-sm btn-3 py-0.5",((n=a(l).query)==null?void 0:n.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...a(l).query,view:"userwise"}}},{default:U(()=>t[9]||(t[9]=[te(" User Wise List ")])),_:1,__:[9]},8,["class","to"])):x("",!0),a(l).name!=="MyTaskList"?(o(),h(e,{key:1,class:G(["text-sm btn-3 py-0.5",((J=a(l).query)==null?void 0:J.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((K=a(l))==null?void 0:K.query)||{}).filter(m=>{var I;return((I=a(l))==null?void 0:I.query[m])!=="userwise"}).reduce((m,I)=>({...m,[I]:a(l).query[I]}),{})}}},{default:U(()=>t[10]||(t[10]=[te(" TaskWise List ")])),_:1,__:[10]},8,["class","to"])):x("",!0)]),a(p).loading?(o(),d("div",je,[T(de)])):(o(),d(B,{key:4},[a(p).error?(o(),d("div",ze,ee(a(p).error),1)):a(p).tasks.length>0?(o(),d("div",Oe,[((Q=a(l).query)==null?void 0:Q.view)=="userwise"?(o(),h(Re,{key:0,tasks:a(p).tasks,selectedUserId:a(l).query["user-ids"],onCommentButtonClick:t[3]||(t[3]=m=>P(m,c.task.id)),onEditClick:t[4]||(t[4]=m=>r.value=m),onAddClick:t[5]||(t[5]=m=>v(m))},null,8,["tasks","selectedUserId"])):(o(),h(ue,{key:1,items:a(p).tasks,handle:"handle",onItemsUpdate:a(V),class:"space-y-4",ref_key:"draggableTaskList",ref:f},{item:U(({item:m,index:I})=>[s("div",We,[T(ne,{task:m,index:I,showDraggableHandle:!$.value,onCommentButtonClick:t[6]||(t[6]=E=>P(E,c.task.id)),onEditClick:t[7]||(t[7]=E=>r.value=E),onAddClick:t[8]||(t[8]=E=>v(E)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(o(),d("div",Ge," No tasks found. "))],64)),T(re,{show:q.value,"commentable-id":b.value,"commentable-type":"task","user-id":Je,"on-close":R,onSubmitted:a(p).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{ct as default};
