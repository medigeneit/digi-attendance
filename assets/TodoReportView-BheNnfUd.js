import{G as ne,x as R,q as E,c as p,o as i,a as t,N as q,w as de,s as I,d as se,k as ee,v as te,f as ue,u as ce,D as ae,h as ge,j as C,i as xe,l as B,m as M,t as y,b as fe,F as N,e as O}from"./index-BL1KzWGA.js";import{L as be}from"./LoaderView-96HMDrLM.js";import{_ as De}from"./EmployeeFilter-CEs1B07P.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as ve,b as U}from"./datetime-BEfC2TVK.js";import{u as we}from"./company-BkyIhJZV.js";import{u as _e}from"./department-ZHs8ATHn.js";import{u as Se}from"./useTodoDateStore-CHMT2UMt.js";import"./EmployeeDropdownInput-Yq9epU2Z.js";import"./SelectDropdown-CVwiX7w-.js";import"./UserChip-DAk9t6u3.js";import"./url-CePbr-gY.js";const Te={class:"px-4 py-4 md:py-3 bg-white rounded-md border"},he={class:"flex flex-wrap items-center gap-3"},ke=["disabled"],$e={class:"print-hide"},Ce={class:"flex flex-col md:flex-row flex-wrap items-end md:ml-auto w-full md:w-auto gap-x-3 gap-y-4 print-hide"},Ne={class:"flex items-center justify-between w-full md:w-auto gap-3"},Re={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Ee={class:"relative h-[32px] w-[150px] sm:w-[170px]"},Ae={__name:"TodoReportHeading",props:{loading:{type:Boolean,default:!1},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},employeeId:{type:[String,Number],default:""},lineType:{type:String,default:"all"},startDate:{type:String,default:""},endDate:{type:String,default:""}},emits:["reloadClick","change"],setup(v,{emit:u}){const r=v,D=u,d=ne({companyId:String(r.companyId||""),departmentId:r.departmentId!==""&&r.departmentId!=null?String(r.departmentId):"",employeeId:String(r.employeeId||""),lineType:r.lineType||"all",startDate:r.startDate||"",endDate:r.endDate||""}),w=R(()=>({companyId:d.companyId,departmentId:d.departmentId,employeeId:d.employeeId,lineType:d.lineType,startDate:d.startDate,endDate:d.endDate}));function A(){D("change",{...w.value})}return E(()=>[r.companyId,r.departmentId,r.employeeId,r.lineType,r.startDate,r.endDate],()=>{d.companyId=String(r.companyId||""),d.departmentId=r.departmentId!==""&&r.departmentId!=null?String(r.departmentId):"",d.employeeId=String(r.employeeId||""),d.lineType=r.lineType||"all",d.startDate=r.startDate||"",d.endDate=r.endDate||""}),E(w,A,{deep:!0}),(_,o)=>(i(),p("div",Te,[t("div",he,[q(_.$slots,"before",{},void 0,!0),t("button",{class:I(["btn-icon print-hide",{"animate-spin !bg-opacity-0":v.loading}]),onClick:o[0]||(o[0]=de(e=>D("reloadClick"),["prevent"])),disabled:v.loading,title:"Reload"},[t("i",{class:I(["fas fa-redo",[v.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,ke),t("span",$e,[q(_.$slots,"after",{},void 0,!0)]),t("div",Ce,[se(De,{company_id:d.companyId,"onUpdate:company_id":o[1]||(o[1]=e=>d.companyId=e),department_id:d.departmentId,"onUpdate:department_id":o[2]||(o[2]=e=>d.departmentId=e),employee_id:d.employeeId,"onUpdate:employee_id":o[3]||(o[3]=e=>d.employeeId=e),line_type:d.lineType,"onUpdate:line_type":o[4]||(o[4]=e=>d.lineType=e),"with-type":!0,class:"flex-1 gap-y-4 md:flex items-center justify-between w-full md:w-auto"},null,8,["company_id","department_id","employee_id","line_type"]),t("div",Ne,[t("div",Re,[o[7]||(o[7]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Start Date",-1)),ee(t("input",{type:"date","onUpdate:modelValue":o[5]||(o[5]=e=>d.startDate=e),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[te,d.startDate]])]),t("div",Ee,[o[8]||(o[8]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"End Date",-1)),ee(t("input",{type:"date","onUpdate:modelValue":o[6]||(o[6]=e=>d.endDate=e),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[te,d.endDate]])])])])])]))}},Ue=Ie(Ae,[["__scopeId","data-v-ee9b6763"]]),Le={class:"container mx-auto px-4 py-6"},Ve={key:0,class:"bg-white border rounded-md mb-2 p-4 text-sm print:border-0 print:mb-2"},Be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-y-2 gap-x-6"},Me={class:"font-medium text-gray-800"},Oe={class:"col-span-2"},je={class:"font-medium text-gray-800"},Fe={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},ze={key:3,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Pe={key:4,class:"overflow-x-auto bg-white border rounded-md shadow-sm"},He={class:"min-w-full text-left text-sm"},Je={class:"divide-y divide-gray-200"},Ke=["rowspan"],Qe={key:0,class:"text-xs text-gray-500"},We={key:1,class:"text-[11px] text-gray-400"},Ye=["rowspan"],Xe={class:"px-4 py-3 text-gray-800"},Ze={class:"font-medium"},Ge={class:"text-xs text-gray-500"},qe={class:"px-4 py-3"},yt={__name:"TodoReportView",setup(v){var j,F,z,P,H,J;const u=ue(),r=ce(),D=Se(),d=we(),w=_e(),{companies:A}=ae(d),{departments:_}=ae(w),o=ve(new Date),e=ne({companyId:((j=u.query)==null?void 0:j.company_id)||"",departmentId:((F=u.query)==null?void 0:F.department_id)||"",employeeId:((z=u.query)==null?void 0:z.employee_id)||"",lineType:((P=u.query)==null?void 0:P.line_type)||"all",startDate:((H=u.query)==null?void 0:H.start_date)||o,endDate:((J=u.query)==null?void 0:J.end_date)||o}),L=R(()=>{const a={};return D.todo_dates.forEach(n=>{var l;const s=((l=n.user)==null?void 0:l.id)||`unknown-${n.id}`,m=n.date||"unknown-date";a[s]||(a[s]={user:n.user,dates:{}}),a[s].dates[m]||(a[s].dates[m]={date:m,todos:[]}),a[s].dates[m].todos.push(n)}),Object.values(a).map(n=>{const s=Object.values(n.dates).map(l=>({...l,rowSpan:l.todos.length})).sort((l,g)=>new Date(l.date)-new Date(g.date)),m=s.reduce((l,g)=>l+g.rowSpan,0);return{user:n.user,dates:s,rowSpan:m}}).sort((n,s)=>{var m,l;return(((m=n.user)==null?void 0:m.name)||"").localeCompare(((l=s.user)==null?void 0:l.name)||"")})}),re=R(()=>{if(!e.startDate||!e.endDate)return"";const a=U(e.startDate,{weekDay:"long"}),n=U(e.endDate,{weekDay:"long"});return`${a} ~ ${n}`}),oe=R(()=>d.employees||[]),le={all:"All Types",executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},b=R(()=>{var l,g,x,S,f,T,h,k;const a=e.companyId&&((l=A.value)!=null&&l.length)?(g=A.value.find(c=>String(c.id)===String(e.companyId)))==null?void 0:g.name:null,n=e.departmentId&&((x=_.value)!=null&&x.length)?(S=_.value.find(c=>String(c.id)===String(e.departmentId)))==null?void 0:S.name:null;let s=null;e.employeeId&&(s=((T=(f=oe.value)==null?void 0:f.find(c=>String(c.id)===String(e.employeeId)))==null?void 0:T.name)||((k=(h=L.value.find(c=>{var $;return String((($=c.user)==null?void 0:$.id)||"")===String(e.employeeId)}))==null?void 0:h.user)==null?void 0:k.name)||null);const m=e.startDate===e.endDate&&e.startDate?U(e.startDate,{weekDay:"long"}):re.value||"-";return{company:a||(e.companyId?`#${e.companyId}`:"All Companies"),department:n||(e.departmentId?`#${e.departmentId}`:"All Departments"),employee:s||(e.employeeId?`#${e.employeeId}`:"All Employees"),lineType:le[e.lineType]||e.lineType||"All Types",dateRange:m}}),ie=a=>a==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":a==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":a==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200";function pe(){r.replace({query:{...u.query,company_id:e.companyId||void 0,department_id:e.departmentId||void 0,employee_id:e.employeeId||void 0,line_type:e.lineType||void 0,start_date:e.startDate||void 0,end_date:e.endDate||void 0}})}async function V(){!e.companyId||!e.startDate||!e.endDate||await D.fetchTodoDates({"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate})}function me(a){e.companyId=a.companyId||"",e.departmentId=a.departmentId||"",e.employeeId=a.employeeId||"",e.lineType=a.lineType||"all",e.startDate=a.startDate||"",e.endDate=a.endDate||""}function ye(){window.print()}return E(()=>e.companyId,a=>{a&&(w.fetchDepartments(a),d.fetchEmployee(a))},{immediate:!0}),E(()=>({...e}),(a,n)=>{JSON.stringify(a)!==JSON.stringify(n)&&(pe(),V())},{deep:!0}),E(()=>u.query,a=>{e.companyId=(a==null?void 0:a.company_id)||e.companyId,e.departmentId=(a==null?void 0:a.department_id)||e.departmentId,e.employeeId=(a==null?void 0:a.employee_id)||e.employeeId,e.lineType=(a==null?void 0:a.line_type)||e.lineType,e.startDate=(a==null?void 0:a.start_date)||e.startDate,e.endDate=(a==null?void 0:a.end_date)||e.endDate}),ge(()=>{d.fetchCompanies({ignore_permission:!0}),V()}),(a,n)=>(i(),p("div",Le,[se(Ue,{"company-id":e.companyId,"department-id":e.departmentId,"employee-id":e.employeeId,"line-type":e.lineType,"start-date":e.startDate,"end-date":e.endDate,loading:M(D).loading,class:"mb-4",onChange:me,onReloadClick:V},{before:B(()=>n[0]||(n[0]=[t("div",null,[t("h1",{class:"text-xl font-semibold text-gray-800"},"Todo Report")],-1)])),after:B(()=>[t("button",{type:"button",class:"btn-icon print-hide",onClick:de(ye,["prevent"])},n[1]||(n[1]=[t("i",{class:"fas fa-print"},null,-1)]))]),_:1},8,["company-id","department-id","employee-id","line-type","start-date","end-date","loading"]),e.companyId&&e.startDate&&e.endDate?(i(),p("div",Ve,[t("div",Be,[t("div",null,[n[2]||(n[2]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Company",-1)),t("div",Me,y(b.value.company),1)]),t("div",null,[n[3]||(n[3]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Department",-1)),t("div",{class:I(["font-medium",[b.value.department=="All Departments"?"text-gray-400":"text-gray-800"]])},y(b.value.department),3)]),t("div",null,[n[4]||(n[4]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Line Type",-1)),t("div",{class:I(["font-medium",[b.value.lineType=="All Types"?"text-gray-400":"text-gray-800"]])},y(b.value.lineType),3)]),t("div",null,[n[5]||(n[5]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Employee",-1)),t("div",{class:I(["font-medium",[b.value.employee=="All Employees"?"text-gray-400":"text-gray-800"]])},y(b.value.employee),3)]),t("div",Oe,[n[6]||(n[6]=t("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Date",-1)),t("div",je,y(b.value.dateRange),1)])])])):C("",!0),!e.companyId||!e.startDate||!e.endDate?(i(),p("div",Fe,n[7]||(n[7]=[t("p",{class:"text-red-500"},"Select company and date range to view the report.",-1)]))):M(D).loading?(i(),xe(be,{key:2},{default:B(()=>n[8]||(n[8]=[fe("Loading report...")])),_:1,__:[8]})):L.value.length===0?(i(),p("div",ze,n[9]||(n[9]=[t("div",null,[t("i",{class:"fas fa-tasks fa-2x text-gray-300 mb-2"})],-1),t("div",null,"No todos.",-1)]))):(i(),p("div",Pe,[t("table",He,[n[10]||(n[10]=t("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[t("tr",{class:"border-b"},[t("th",{class:"px-4 py-3 border-r"},"Name"),t("th",{class:"px-4 py-3 border-x"},"Date"),t("th",{class:"px-4 py-3 border-l"},"Todo"),t("th",{class:"px-4 py-3"},"Status")])],-1)),t("tbody",Je,[(i(!0),p(N,null,O(L.value,s=>{var m,l,g;return i(),p(N,{key:((m=s.user)==null?void 0:m.id)||(((g=(l=s.dates[0])==null?void 0:l.todos[0])==null?void 0:g.id)??Math.random())},[(i(!0),p(N,null,O(s.dates,x=>{var S;return i(),p(N,{key:`${((S=s.user)==null?void 0:S.id)||"u"}-${x.date}`},[(i(!0),p(N,null,O(x.todos,(f,T)=>{var h,k,c,$,K,Q,W,Y,X,Z,G;return i(),p("tr",{key:f.id,class:"hover:bg-gray-50"},[x===s.dates[0]&&T===0?(i(),p("td",{key:0,rowspan:s.rowSpan,class:"px-4 py-3 align-top font-medium text-gray-800 whitespace-nowrap border-r"},[t("div",null,y(((h=s.user)==null?void 0:h.name)||"Unknown user"),1),(c=(k=s.user)==null?void 0:k.department)!=null&&c.name?(i(),p("div",Qe,y((K=($=s.user)==null?void 0:$.department)==null?void 0:K.name),1)):C("",!0),(W=(Q=s.user)==null?void 0:Q.company)!=null&&W.name?(i(),p("div",We,y((X=(Y=s.user)==null?void 0:Y.company)==null?void 0:X.name),1)):C("",!0)],8,Ke)):C("",!0),T===0?(i(),p("td",{key:1,rowspan:x.rowSpan,class:"px-4 py-3 align-top text-xs text-gray-700 whitespace-nowrap border-r"},y(M(U)(x.date)||x.date||"-"),9,Ye)):C("",!0),t("td",Xe,[t("div",Ze,y(f.title),1),t("div",Ge,y(((Z=f.todoable)==null?void 0:Z.title)||((G=f.todoable_type)==null?void 0:G.split("\\").pop())||""),1)]),t("td",qe,[t("span",{class:I(["text-xs font-semibold px-2.5 py-1 rounded-full",ie(f.status)])},y(f.status||"N/A"),3)])])}),128))],64)}),128))],64)}),128))])])]))]))}};export{yt as default};
