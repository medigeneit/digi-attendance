import{_ as f}from"./ApprovalItem-av1YYu_I.js";import{L as ct}from"./LoaderView-BfmkEiZN.js";import{_ as pt}from"./ShareComponent-DRfFlIdZ.js";import{g as vt,u as bt,f as yt,x,r as y,q as mt,c as r,o as n,a as e,j as Xe,k as u,b as i,t as l,F as D,e as B,d as _,s as C}from"./index-DBGyLoPZ.js";import{u as gt}from"./leave-application-O5jwjb7S.js";import"./AcceptAndRejectHandler-C11ilK2C.js";const ft={class:"my-container max-w-3xl space-y-6"},xt={class:"flex items-center justify-between gap-2 print:hidden"},_t={key:1,class:"w-[88px]"},kt={key:1,class:"card-bg p-4 md:p-8 print:text-black"},ht={class:"text-center space-y-3"},wt={class:"text-sm text-slate-600"},Dt={class:"flex items-center justify-center gap-2 print:hidden"},At={key:2,class:"card-bg p-4 md:p-8 print:text-black"},Lt={class:"title-lg text-center"},jt={class:"text-center text-sm"},Rt={class:"space-y-4"},Tt={class:"grid md:grid-cols-2 print:grid-cols-2 gap-8"},Bt={class:"text-sm"},Ct={class:"pt-6"},St={key:0},Ft={key:1,class:"font-semibold"},Mt={class:"flex justify-end gap-4"},Ut={class:"table-auto border border-black bg-white text-xs"},Et={class:"border border-black px-2"},Pt={class:"border border-black px-2"},Wt={class:"border border-black px-2"},It={class:"font-bold"},Nt={class:"border border-black px-2"},$t={class:"table-auto border border-black bg-white text-xs"},zt={class:"border border-black"},Gt={colspan:"2",class:"border border-black px-2 w-32"},Ot={class:"border border-black px-2"},Vt={class:"border border-black px-2"},qt={class:"font-bold"},Ht={class:"border border-black px-2"},Jt={class:"grid print:grid-cols-2 md:grid-cols-2 gap-1 text-sm list-none px-2"},Yt={class:"col-span-full"},Xt={class:"text-sm"},Zt={class:"whitespace-pre-line"},Kt={class:"pt-8 grid grid-cols-2"},Qt={class:"text-sm"},es={class:"font-bold"},ts={class:"text-blue-700 print:text-black"},ss={class:"overflow-x-auto"},as={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},ls={class:"border border-gray-500 px-4 py-0.5 text-left"},os={class:"border border-gray-500 px-4 py-0.5 text-left"},ns={class:"border border-gray-500 px-4 py-0.5 text-center"},rs={class:"border border-gray-500 px-4 py-0.5 text-center"},is={class:"border border-gray-500 px-4 py-0.5 text-center"},ds={class:"space-y-14"},us={class:"flex items-center gap-4 justify-center"},cs={key:0},ps={key:0,class:"text-xs text-slate-600"},vs={class:"grid md:grid-cols-3 print:grid-cols-3 gap-4 text-sm items-end"},bs={class:"flex justify-evenly text-sm items-end"},ys={class:"mt-10 print:hidden space-y-3"},ms={key:0,class:"border rounded-lg bg-white p-3 flex items-center gap-3"},gs={class:"shrink-0"},fs=["src"],xs={key:1,class:"h-16 w-16 grid place-items-center rounded-md border text-slate-500"},_s={class:"min-w-0 flex-1"},ks={class:"text-sm font-medium truncate"},hs=["href"],ws={key:0,class:"flex gap-2"},Ds=["disabled"],As=["disabled"],Ls=["disabled"],js=["accept"],Rs={key:0,class:"mt-3 text-sm inline-flex items-center gap-2"},Ts={key:2,class:"text-green-600 text-sm"},Bs={key:3,class:"text-red-600 text-sm"},Ze="JPG, PNG, WEBP, PDF",M=10,Ws={__name:"LeaveApplicationShow",setup(Cs){const S=vt(),v=gt(),U=bt(),Ke=yt(),A=x(()=>Ke.params.id),L=y(!0),g=y(""),p=y(!1),k=y(""),h=y(""),j=y(null),R=y(!1),E=y(null),P=["image/jpeg","image/png","image/webp","application/pdf"],a=x(()=>v.leaveApplication),W=x(()=>{var s;return typeof((s=a.value)==null?void 0:s.attachment)=="string"&&a.value.attachment.length>0}),I=x(()=>{var s,t;return((s=a.value)==null?void 0:s.user_id)===((t=S==null?void 0:S.user)==null?void 0:t.id)}),N=x(()=>g.value||v.error||""),$=async s=>{var t;if(L.value=!0,g.value="",!s){g.value="Invalid leave application id",L.value=!1;return}try{await v.fetchLeaveApplicationById(s),v.error?g.value=v.error:(t=a.value)!=null&&t.id||(g.value="Leave Application not found")}catch(d){console.error("Failed to load leave application:",d),g.value="Failed to load leave application"}finally{L.value=!1}};mt(()=>A.value,async s=>{await $(s)},{immediate:!0});const z=()=>U.go(-1),Qe=()=>window.print(),et=()=>U.push({name:"MyLeaveApplications"}),tt=()=>$(A.value),G=s=>{if(!s)return"";const t=new Date(s),d=t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),b=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${d} , ${b}`},T=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",st=s=>/\.(png|jpe?g|webp|gif)$/i.test(s||""),at=s=>{try{const t=new URL(s);return decodeURIComponent(t.pathname.split("/").pop()||"attachment")}catch{return(s||"").split("/").pop()||"attachment"}},F=s=>{k.value=s,h.value="",setTimeout(()=>k.value="",2500)},w=s=>{h.value=s,k.value="",setTimeout(()=>h.value="",3500)},O=x(()=>{const s=a.value;if(!s||!s.last_working_date||!s.resumption_date)return 0;const t=new Date(s.last_working_date),d=new Date(s.resumption_date);return Math.ceil((d-t)/(1e3*60*60*24))-1}),m=async()=>{await v.fetchLeaveApplicationById(A.value)},lt=s=>P.includes(s.type)?s.size/(1024*1024)>M?(w(`Max file size ${M} MB`),!1):!0:(w(`Only ${Ze} allowed`),!1),V=async s=>{await v.uploadLeaveApplicationAttachment(A.value,{attachment:s}),await m()},q=async s=>{if(!(!s||!lt(s))){p.value=!0;try{const t=new FormData;t.append("file",s),t.append("folder","leave-application");const d=await v.fetchFileUpload(t);E.value=d==null?void 0:d.url,await V(E.value),F("Attachment uploaded")}catch(t){console.error("Upload failed:",t),w("Upload failed. Try again.")}finally{p.value=!1,j.value&&(j.value.value="")}}},ot=async s=>{var d;const t=(d=s.target.files)==null?void 0:d[0];t&&await q(t)},nt=s=>{s.preventDefault(),R.value=!0},rt=s=>{s.preventDefault(),R.value=!1},it=async s=>{var d,b;s.preventDefault(),R.value=!1;const t=(b=(d=s.dataTransfer)==null?void 0:d.files)==null?void 0:b[0];t&&await q(t)},H=()=>{var s;return(s=j.value)==null?void 0:s.click()},dt=async()=>{var s;try{await navigator.clipboard.writeText(((s=a.value)==null?void 0:s.attachment)||""),F("Link copied")}catch{w("Copy failed")}},ut=async()=>{if(W.value&&confirm("Remove current attachment?")){p.value=!0;try{await V(null),F("Attachment removed")}catch(s){console.error("Remove failed:",s),w("Failed to remove attachment")}finally{p.value=!1}}};return(s,t)=>{var d,b,J,Y,X,Z,K,Q,ee,te,se,ae,le,oe,ne,re,ie,de,ue,ce,pe,ve,be,ye,me,ge,fe,xe,_e,ke,he,we,De,Ae,Le,je,Re,Te,Be,Ce,Se,Fe,Me,Ue,Ee,Pe,We,Ie,Ne,$e,ze,Ge,Oe,Ve,qe,He,Je,Ye;return n(),r("div",ft,[e("div",xt,[e("button",{class:"btn-3",onClick:z},t[0]||(t[0]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[2]||(t[2]=e("h1",{class:"title-md md:title-xl flex-wrap text-center"},"Leave Application",-1)),(d=a.value)!=null&&d.id?(n(),r("button",{key:0,class:"btn-2",onClick:Qe},t[1]||(t[1]=[e("i",{class:"far fa-print"},null,-1),i(" Print")]))):(n(),r("div",_t))]),L.value?(n(),Xe(ct,{key:0})):(b=a.value)!=null&&b.id?(n(),r("div",At,[e("div",null,[e("h1",Lt,l((X=(Y=(J=a.value)==null?void 0:J.user)==null?void 0:Y.company)==null?void 0:X.name),1),e("p",jt,l((K=(Z=a.value)==null?void 0:Z.user)==null?void 0:K.company.address),1)]),e("div",Rt,[e("div",Tt,[e("div",null,[t[6]||(t[6]=e("p",null,"To",-1)),t[7]||(t[7]=e("p",{class:"font-bold"},"Managing Director",-1)),e("p",null,l((te=(ee=(Q=a.value)==null?void 0:Q.user)==null?void 0:ee.company)==null?void 0:te.name),1),e("p",Bt,l((ae=(se=a.value)==null?void 0:se.user)==null?void 0:ae.company.address),1),e("p",Ct,[t[4]||(t[4]=e("b",null,"Subject:",-1)),t[5]||(t[5]=i(" Leave Application for ")),(n(!0),r(D,null,B((le=a.value)==null?void 0:le.leave_types,(o,c)=>(n(),r(D,{key:c},[c&&o.days?(n(),r("span",St,", ")):u("",!0),o.days?(n(),r("span",Ft,l(o.type),1)):u("",!0)],64))),128))])]),e("div",Mt,[e("div",null,[t[11]||(t[11]=e("h1",{class:"font-semibold"},"Summary",-1)),e("table",Ut,[t[10]||(t[10]=e("thead",null,[e("tr",{class:"bg-gray-200 border border-black"},[e("th",{class:"border border-black px-2"},"Type"),e("th",{class:"border border-black px-2"},"Days")])],-1)),e("tbody",null,[(n(!0),r(D,null,B((oe=a.value)==null?void 0:oe.leave_types,(o,c)=>(n(),r("tr",{key:c,class:"border border-black"},[e("td",Et,l(o.type),1),e("td",Pt,l(o.days),1)]))),128)),e("tr",null,[t[8]||(t[8]=e("td",{class:"border-black px-2"},"WL/GHD",-1)),e("td",Wt,l(O.value-((re=(ne=a.value)==null?void 0:ne.leave_days)==null?void 0:re.length)),1)]),e("tr",It,[t[9]||(t[9]=e("td",{class:"border border-black px-2"},"Total",-1)),e("td",Nt,l(O.value),1)])])])]),e("div",null,[t[15]||(t[15]=e("h1",{class:"font-semibold"},"Last Leave",-1)),e("table",$t,[e("thead",null,[t[12]||(t[12]=e("tr",{class:"bg-gray-200 border border-black"},[e("th",{colspan:"2",class:"border border-black px-2"},"Date")],-1)),e("tr",zt,[e("td",Gt,l(T((de=(ie=a.value)==null?void 0:ie.last_leave)==null?void 0:de.date)||"N/A"),1)]),t[13]||(t[13]=e("tr",{class:"bg-gray-200 border border-black"},[e("th",{class:"border border-black px-2"},"Type"),e("th",{class:"border border-black px-2"},"Days")],-1))]),e("tbody",null,[(n(!0),r(D,null,B((ce=(ue=a.value)==null?void 0:ue.last_leave)==null?void 0:ce.types,(o,c)=>(n(),r("tr",{key:c,class:"border border-black"},[e("td",Ot,l(o==null?void 0:o.type),1),e("td",Vt,l(o==null?void 0:o.days),1)]))),128)),e("tr",qt,[t[14]||(t[14]=e("td",{class:"border border-black px-2"},"Total",-1)),e("td",Ht,l((ve=(pe=a.value)==null?void 0:pe.last_leave)!=null&&ve.types?a.value.last_leave.types.reduce((o,c)=>o+c.days,0):0),1)])])])])])]),e("div",null,[t[23]||(t[23]=e("h3",{class:"font-bold"},"Leave Details:",-1)),e("div",Jt,[e("li",null,[t[16]||(t[16]=e("strong",null,"Leave Days:",-1)),i(" "+l((be=a.value)==null?void 0:be.leave_period),1)]),e("li",null,[t[17]||(t[17]=e("strong",null,"Total Days:",-1)),i(" "+l((ye=a.value)==null?void 0:ye.total_leave_days),1)]),e("li",null,[t[18]||(t[18]=e("strong",null,"Weekends:",-1)),i(" "+l((xe=(fe=(ge=(me=a.value)==null?void 0:me.user)==null?void 0:ge.assign_weekend)==null?void 0:fe.weekends)==null?void 0:xe.join(", ")),1)]),e("li",null,[t[19]||(t[19]=e("strong",null,"Last Working Date:",-1)),i(" "+l(T((_e=a.value)==null?void 0:_e.last_working_date)),1)]),e("li",null,[t[20]||(t[20]=e("strong",null,"Resumption Date:",-1)),i(" "+l(T((ke=a.value)==null?void 0:ke.resumption_date)),1)]),e("li",null,[t[21]||(t[21]=e("strong",null,"Create Date:",-1)),i(" "+l(G((he=a.value)==null?void 0:he.created_at)),1)]),e("li",Yt,[t[22]||(t[22]=e("strong",null,"Reason: ",-1)),i(l(((we=a.value)==null?void 0:we.reason)||"No reason provided"),1)])])]),e("div",Xt,[e("p",Zt,[t[24]||(t[24]=e("strong",null,"Works in Hand: ",-1)),i(l(((De=a.value)==null?void 0:De.works_in_hand)||"No details provided"),1)])]),e("div",Kt,[e("div",Qt,[t[30]||(t[30]=e("hr",{class:"w-44 border-black hidden print:block my-1"},null,-1)),e("p",es,[t[25]||(t[25]=e("strong",null,"Applicant: ",-1)),e("span",ts,l((Le=(Ae=a.value)==null?void 0:Ae.user)==null?void 0:Le.name),1)]),e("p",null,[t[26]||(t[26]=e("strong",null,"Designation:",-1)),i(" "+l((Te=(Re=(je=a.value)==null?void 0:je.user)==null?void 0:Re.designation)==null?void 0:Te.title),1)]),e("p",null,[t[27]||(t[27]=e("strong",null,"Department:",-1)),i(" "+l((Se=(Ce=(Be=a.value)==null?void 0:Be.user)==null?void 0:Ce.department)==null?void 0:Se.name),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"Phone:",-1)),i(" "+l((Me=(Fe=a.value)==null?void 0:Fe.user)==null?void 0:Me.phone),1)]),e("p",null,[t[29]||(t[29]=e("strong",null,"Joining Date:",-1)),i(" "+l(T((Ee=(Ue=a.value)==null?void 0:Ue.user)==null?void 0:Ee.joining_date)),1)])]),_(f,{application:a.value,type:"leave_applications",item:"handover",onAction:m},null,8,["application"])]),e("div",null,[t[32]||(t[32]=e("h1",{class:"font-bold"},"Leave Balance",-1)),e("div",ss,[e("table",as,[t[31]||(t[31]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-500 px-4 py-0.5 text-left"},"Leave Type"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-left"},"Year"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Total Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Used Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Pending Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Remaining Days")])],-1)),e("tbody",null,[(n(!0),r(D,null,B((Pe=a.value)==null?void 0:Pe.leave_balance,(o,c)=>(n(),r("tr",{key:c,class:"hover:bg-blue-200"},[e("td",ls,l(o.name),1),e("td",os,l(o==null?void 0:o.year),1),e("td",ns,l(o==null?void 0:o.annual_quota),1),e("td",rs,l(o.used_days),1),e("td",is,l(o.pending_days),1),e("td",{class:C(["border border-gray-500 px-4 py-0.5 text-center",{"text-green-600 font-bold":o.remaining_days>0,"text-red-600 font-bold":o.remaining_days===0}])},l(o.remaining_days),3)]))),128))])])])])]),e("div",ds,[e("div",us,[t[33]||(t[33]=e("span",{class:"text-sm font-semibold"},"Leave Application Status : ",-1)),e("span",{class:C(["inline-flex items-center gap-2 px-3 py-1.5 font-semibold rounded-full text-xs ring-1",{"bg-yellow-50  text-yellow-800 ring-yellow-200":((We=a.value)==null?void 0:We.status)==="Pending","bg-green-50 text-green-700 ring-green-200":((Ie=a.value)==null?void 0:Ie.status)==="Approved","bg-red-50 text-red-700 ring-red-200":((Ne=a.value)==null?void 0:Ne.status)==="Rejected"}])},[e("span",{class:C(["h-1.5 w-1.5 rounded-full",{"bg-yellow-500":(($e=a.value)==null?void 0:$e.status)==="Pending","bg-green-600":((ze=a.value)==null?void 0:ze.status)==="Approved","bg-red-600":((Ge=a.value)==null?void 0:Ge.status)==="Rejected"}])},null,2),i(" "+l(((Oe=a.value)==null?void 0:Oe.status)||"N/A"),1)],2)]),((Ve=a.value)==null?void 0:Ve.status)==="Rejected"?(n(),r("div",cs,[e("p",null,[t[34]||(t[34]=e("b",null,"Rejected by: ",-1)),i(" "+l((He=(qe=a.value)==null?void 0:qe.rejected_by_user)==null?void 0:He.name),1)]),e("p",null,[t[35]||(t[35]=e("b",null,"Rejection Reason: ",-1)),i(" "+l(a.value.rejection_reason),1)]),(Je=a.value)!=null&&Je.rejected_at?(n(),r("p",ps,[t[36]||(t[36]=e("i",{class:"far fa-clock"},null,-1)),i(" "+l(G(a.value.rejected_at)),1)])):u("",!0)])):u("",!0),e("div",vs,[_(f,{application:a.value,type:"leave_applications",item:"in_charge",onAction:m},null,8,["application"]),_(f,{application:a.value,type:"leave_applications",item:"coordinator",onAction:m},null,8,["application"]),_(f,{application:a.value,type:"leave_applications",item:"operational_admin",onAction:m},null,8,["application"])]),e("div",bs,[_(f,{application:a.value,type:"leave_applications",item:"recommend_by",onAction:m},null,8,["application"]),_(f,{application:a.value,type:"leave_applications",item:"approved_by",onAction:m},null,8,["application"])])])])):(n(),r("div",kt,[e("div",ht,[t[3]||(t[3]=e("h2",{class:"title-lg"},"Leave Application not found",-1)),e("p",wt,l(N.value||"Leave Application not found"),1),e("div",Dt,[e("button",{class:"btn-3",onClick:z},"Back"),e("button",{class:"btn-2",onClick:et},"Leave Applications"),N.value?(n(),r("button",{key:0,class:"btn-3",onClick:tt},"Retry")):u("",!0)])])])),e("section",ys,[W.value?(n(),r("div",ms,[e("div",gs,[st(a.value.attachment)?(n(),r("img",{key:0,src:a.value.attachment,alt:"Attachment preview",class:"h-16 w-16 object-cover rounded-md border"},null,8,fs)):(n(),r("div",xs,t[37]||(t[37]=[e("i",{class:"far fa-file text-2xl"},null,-1)])))]),e("div",_s,[e("p",ks,l(at(a.value.attachment)),1),e("a",{href:a.value.attachment,target:"_blank",class:"text-blue-600 underline text-xs"},"Open link",8,hs)]),I.value?(n(),r("div",ws,[e("button",{class:"px-3 py-1.5 rounded-md border text-sm",onClick:dt,disabled:p.value},"Copy link",8,Ds),e("button",{class:"px-3 py-1.5 rounded-md border text-sm",onClick:H,disabled:p.value},"Replace",8,As),e("button",{class:"px-3 py-1.5 rounded-md border text-sm text-red-600",onClick:ut,disabled:p.value},"Remove",8,Ls)])):u("",!0)])):u("",!0),I.value?(n(),r("div",{key:1,class:C(["rounded-xl border-2 border-dashed p-6 transition grid place-items-center text-center",[R.value?"border-blue-500 bg-blue-50":"border-slate-300 hover:border-slate-400",p.value?"opacity-60 pointer-events-none":""]]),onDragover:nt,onDragleave:rt,onDrop:it},[e("div",{class:"space-y-2"},[t[39]||(t[39]=e("i",{class:"far fa-cloud-upload-alt text-3xl"},null,-1)),e("p",{class:"text-sm text-slate-600"},[t[38]||(t[38]=i(" Drag & drop your file here, or ")),e("button",{class:"text-blue-700 underline font-medium",type:"button",onClick:H},"browse")]),e("p",{class:"text-xs text-slate-500"}," Allowed: "+l(Ze)+" • Max "+l(M)+" MB ")]),e("input",{ref_key:"fileInput",ref:j,class:"hidden",type:"file",accept:P.join(","),onChange:ot},null,40,js),p.value?(n(),r("div",Rs,t[40]||(t[40]=[e("i",{class:"far fa-circle-notch fa-spin"},null,-1),i(" Uploading… ")]))):u("",!0)],34)):u("",!0),k.value?(n(),r("p",Ts,l(k.value),1)):u("",!0),h.value?(n(),r("p",Bs,l(h.value),1)):u("",!0)]),(Ye=a.value)!=null&&Ye.id?(n(),Xe(pt,{key:3})):u("",!0)])}}};export{Ws as default};
