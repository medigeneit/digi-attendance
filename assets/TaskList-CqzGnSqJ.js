import{_ as ve}from"./CommentModal-CaNKAxnI.js";import{_ as fe,a as ke}from"./TaskUserAssignForm-CzxDRJVu.js";import{L as xe}from"./LoaderView-wvjR9FYU.js";import{O as X}from"./OverlyModal-JYPTQOoU.js";import{_ as ge}from"./TaskAddForm-DjEDfu9F.js";import{_ as be}from"./TaskEditForm-CRejE_f-.js";import{r as q,m as w,c as u,o as a,a as t,h as j,v as ue,g as x,w as W,d as de,b as me,e as pe,z as te,n as we,f as U,F as D,p as S,B as oe,q as Y,t as K,k as i,i as $,K as Z,j as ee,x as se,u as Ce,D as ne}from"./index-C3KpHwgY.js";import{_ as Te}from"./MultiselectDropdown-D9PHQn99.js";import{g as Ie,u as Ve}from"./task-priority-BEKnQ66W.js";import{u as Ae}from"./company-C83UBk3Q.js";import{_ as re}from"./CompanyDepartmentSelectInput-Ciq1YdD-.js";import{_ as ce}from"./UserChip-C8s88wRV.js";import{_ as ye}from"./TaskTreeView-UmoytLSd.js";import{u as Me}from"./useTaskStore-CU2zYb_G.js";import"./useCommentStore-Cu-YxC73.js";import"./datetime-q3Sn87-f.js";import"./TextWithHr-DmHqXk5d.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-CvUEZ8sj.js";import"./TaskUserChip-w_Miv336.js";import"./RequiredIcon-ByS9wFA6.js";import"./useRequirementStore-Dvn-h9eS.js";import"./requirement-B8AqBqKH.js";import"./SectionLoading-B7ynzTpt.js";import"./tags-BQiTcB3o.js";import"./url-CePbr-gY.js";const Se={class:"text-gray-600 relative"},Le={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},ie={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(L,{emit:C}){const v=L,d=q(),I=C,y=m=>{I("update:modelValue",m||void 0)};let M=0;const n=w({get(){return v.modelValue},set(m){clearTimeout(M),M=setTimeout(y,500,m)}});return(m,o)=>(a(),u("div",Se,[o[3]||(o[3]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),j(t("input",{ref_key:"searchInput",ref:d,id:"search","onUpdate:modelValue":o[0]||(o[0]=f=>n.value=f),type:"text",class:"!pr-7 w-full rounded-md px-2 py-1 border-2 border-gray-400 placeholder:text-sm focus:outline-gray-400",placeholder:"Search by main task title"},null,512),[[ue,n.value]]),t("div",Le,[n.value?(a(),u("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:o[1]||(o[1]=W(()=>{y(""),d.value.focus()},["prevent"]))})):x("",!0),o[2]||(o[2]=t("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},_e={class:"mb-3 task-header"},he={class:"flex justify-between items-start mb-4"},qe={key:0,class:"ml-auto flex gap-6 items-center"},Ue={key:0,class:"flex gap-2 items-center"},$e={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ee={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},De={class:"relative w-full md:w-48 flex-grow"},Pe=["value"],Be={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Oe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Ne={class:"w-32 relative h-8"},je={class:"flex gap-4 items-center flex-shrink-0"},Fe={class:"flex gap-2"},Re={class:"flex gap-2"},ze={class:"flex gap-2"},He={class:"text-gray-600 w-full md:w-32 relative"},We={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6"},Ke={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},Ye={key:0,class:"text-[9px] text-green-800"},Ge=["onClick"],Je={key:1,class:"flex justify-end gap-5"},Qe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(L,{emit:C}){const v=L,d=de(),I=me(),y=w(b("company-id")),M=w(b("from-department-id")),n=w(b("to-department-id")),m=w(b("user-ids")),o=w(b("month")),f=w(b("status")),g=w(b("is-important")),c=w(b("is-urgent")),P=w(b("is-target")),B=w(b("search")),F=C,h=Ae(),E=q([]);function b(p){return{get:()=>v.modelValue[p]||"",set:e=>{F("update:modelValue",{...v.modelValue,[p]:e||void 0})}}}const O=w(()=>G(m.value));async function R(){var p,e,l;if(!v.isMyTask){const V=(p=v.modelValue)==null?void 0:p["company-id"],k=n.value,T={...V?{company_id:V}:{},...k?{department_ids:[k]}:{}};E.value=((l=(e=await Ie({params:T}))==null?void 0:e.data)==null?void 0:l.employees)||[]}}pe(async()=>{await R(),await h.fetchCompanies({with:"departments",ignore_permission:!0}),await h.fetchMyCompanies({with:"departments"})});function G(p){return Array.isArray(E.value)&&E.value.find(e=>e.id==p)||null}function J(p){m.value=(p==null?void 0:p.id)||""}function z(){m.value=""}te(()=>n.value,R),te(()=>y.value,()=>{n.value!==""?n.value="":R()});function N(p,e,{value:l,id:V,label:k,onCancel:T}={}){if(!p)return[];const r=Array.isArray(e)?e.find(A=>(A==null?void 0:A[V])==p):null;return r?[{label:k,value:r==null?void 0:r[l],id:r==null?void 0:r[V],onCancel:T}]:[]}const Q=w(()=>{var V;const p=h.companies.reduce((k,T)=>[...k,...T.departments],[]),e=(k,{label:T,value:r,id:A,onCancel:_})=>k?[{label:T,value:r,id:A,onCancel:_}]:[],l=(k,{label:T,onCancel:r})=>{if(!k)return[];const A=new Date(k);return[{label:T,value:A.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:k,onCancel:r}]};return[...N(y.value,h.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{y.value=""}}),...N(M.value,p,{label:"From",value:"short_name",id:"id",onCancel:()=>{M.value=""}}),...N(n.value,p,{label:"To",value:"short_name",id:"id",onCancel:()=>{n.value=""}}),...N((V=O.value)==null?void 0:V.id,E.value,{label:"Employee",value:"name",id:"id",onCancel:z}),...N(f.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{f.value=""}}),...e(g.value,{label:"",value:"Important ",id:!0,onCancel:()=>{g.value=""}}),...e(c.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{c.value=""}}),...e(P.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{P.value=""}}),...l(o.value,{label:"",onCancel:()=>{o.value=""}})]});return(p,e)=>{var V,k,T,r,A,_,le,ae;const l=we("RouterLink");return a(),u(D,null,[t("div",_e,[t("div",he,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),L.isMyTask?x("",!0):(a(),u("div",qe,[L.listHasRearranged?(a(),u("div",Ue,[e[13]||(e[13]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=W(s=>F("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=W(s=>F("clickPriorityDiscard"),["prevent"]))},"Discard")])):x("",!0),t("button",{onClick:e[2]||(e[2]=s=>F("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),t("div",$e,[t("div",Ee,[L.isMyTask?x("",!0):(a(),u(D,{key:0},[t("div",De,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),j(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>y.value=s),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[15]||(e[15]=t("option",{value:""},"--ALL COMPANY--",-1)),(a(!0),u(D,null,Y((V=i(h))==null?void 0:V.myCompanies,s=>(a(),u("option",{key:s.id,value:s.id},K(s.name),9,Pe))),128))],512),[[oe,y.value]])]),S(re,{modelValue:M.value,"onUpdate:modelValue":e[4]||(e[4]=s=>M.value=s),companies:((k=i(h))==null?void 0:k.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:$(()=>e[17]||(e[17]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),i(I).name!=="MyTaskList"?(a(),U(re,{key:0,modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=s=>n.value=s),companies:((T=i(h))==null?void 0:T.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:$(()=>e[18]||(e[18]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),i(d).isAdminMood&&((A=(r=i(d))==null?void 0:r.user)==null?void 0:A.role)!=="employee"?(a(),u("div",Be,[S(Te,{modelValue:O.value,onSelect:J,onRemove:z,options:E.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:$(({option:s})=>[S(ce,{user:s,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),O.value?(a(),u("div",Oe,[t("button",{onClick:W(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):x("",!0),e[19]||(e[19]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):x("",!0)],64)),t("div",Ne,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),j(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>f.value=s),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[20]||(e[20]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[oe,f.value]])]),t("div",je,[t("label",Fe,[j(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>g.value=s)},null,512),[[Z,g.value]]),e[22]||(e[22]=t("span",null,"Important",-1))]),t("label",Re,[j(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>c.value=s)},null,512),[[Z,c.value]]),e[23]||(e[23]=t("span",null,"Urgent",-1))]),t("label",ze,[j(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=s=>P.value=s)},null,512),[[Z,P.value]]),e[24]||(e[24]=t("span",null,"Is Target",-1))])]),t("div",He,[e[25]||(e[25]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),j(t("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=s=>o.value=s),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[ue,o.value]])])]),L.isMyTask?(a(),U(ie,{key:0,modelValue:B.value,"onUpdate:modelValue":e[11]||(e[11]=s=>B.value=s),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):x("",!0)])]),t("div",We,[L.isMyTask?x("",!0):(a(),U(ie,{key:0,modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=s=>B.value=s),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),t("div",Ke,[(a(!0),u(D,null,Y(Q.value,s=>(a(),u("div",{key:s.label||s.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[t("div",null,[s.label?(a(),u("span",Ye,K(s.label)+": ",1)):x("",!0),ee(K(s.value),1)]),t("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:W(s.onCancel,["prevent"])},e[26]||(e[26]=[t("i",{class:"fas fa-times-circle"},null,-1)]),8,Ge)]))),128))]),L.isMyTask?x("",!0):(a(),u("div",Je,[S(l,{class:se(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((_=i(I).query)==null?void 0:_.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...i(I).query,view:"userwise"}}},{default:$(()=>e[27]||(e[27]=[ee(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),S(l,{class:se(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((le=i(I).query)==null?void 0:le.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ae=i(I))==null?void 0:ae.query)||{}).filter(s=>{var H;return((H=i(I))==null?void 0:H.query[s])!=="userwise"}).reduce((s,H)=>({...s,[H]:i(I).query[H]}),{})}}},{default:$(()=>e[28]||(e[28]=[ee(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},Xe={class:"w-full bg-white rounded"},Ze=["rowspan"],et={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(L,{emit:C}){const v=L,d=C,I=w(()=>v.tasks.reduce((n,m)=>(n.push(...m.users.filter(o=>!n.find(f=>f.id==o.id&&o.id))),n),[]).filter(n=>v.selectedUserId?n.id==v.selectedUserId:!0)),y=n=>v.tasks.filter(f=>f.users.some(g=>g.id===n)),M=w(()=>I.value.map(n=>{const m=y(n.id);return{...n,tasks:m}}));return(n,m)=>(a(),u("div",null,[t("table",Xe,[t("tbody",null,[(a(!0),u(D,null,Y(M.value,o=>(a(),u(D,{key:o.id},[(a(!0),u(D,null,Y(o.tasks,(f,g)=>(a(),u("tr",{key:f.id},[g==0?(a(),u("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(o.tasks.length,1)},[S(ce,{user:o,class:"sticky top-[80px]"},null,8,["user"])],8,Ze)):x("",!0),t("td",{class:se(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":g==0,"border-b":o.tasks.length-1===g}])},[S(ye,{task:f,class:"!border-0 my-0",index:g,onCommentButtonClick:m[0]||(m[0]=c=>d("commentButtonClick",n.item.id)),onEditClick:m[1]||(m[1]=c=>d("editClick",c)),onAddClick:m[2]||(m[2]=c=>d("addClick",c)),onEmployeeAssignClick:m[3]||(m[3]=c=>d("employeeAssignClick",c))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},tt={class:"max-w-full mx-4 p-6 mt-2 relative bg-white rounded-md shadow-md"},st={class:"mb-4"},lt={class:"relative min-h-[30vh]"},at={key:0,class:"text-center py-4 text-red-500"},ot={key:1},nt={class:"flex items-stretched"},rt={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},it=1,Et={__name:"TaskList",setup(L){const C=Me(),v=de(),d=me(),I=Ce(),y=q(""),M=q(!1),n=q(null),m=w(()=>{var e;return((e=v==null?void 0:v.user)==null?void 0:e.role)==="employee"||!(v!=null&&v.isAdminMood)?!0:!!d.query["user-ids"]}),o=q(null),f=q(!1),g=ne({parentId:0,requirementId:0}),c=ne({taskId:0,isOpen:!1}),P=q(null),B=q([]),{handleItemsPriorityUpdate:F,saveTaskPriority:h,listHasRearranged:E}=Ve(()=>C.taskListTree,0);pe(async()=>{y.value="loading",d.query.status?await b():I.push({query:{...d.query,status:"not-completed"}})});async function b(){let e;d.name==="MyTaskList"?e=await C.fetchMyTasks({...d.query,page:1}):e=await C.fetchTasks({...d.query,page:1},{infiniteScrolling:!1}),y.value="",B.value=e.query_log||[]}const O=e=>{f.value=!0,g.parentId=e},R=e=>{c.taskId=e,c.isOpen=!0},G=e=>{n.value=e,M.value=!0},J=()=>{M.value=!1,n.value=null};async function z(){o.value=null,f.value=!1,g.parentId=0,y.value="loading",await b()}async function N(){f.value=!1,g.parentId=0,await b()}async function Q(){y.value="loading",await h()&&await b()}te(()=>({...d.query}),async()=>{C.resetTaskList(),y.value="loading",await b()});const p=w({get(){return{...d.query}},set(e){localStorage.removeItem("sub_task_opened_list"),I.push({query:{...e}})}});return(e,l)=>{var V,k,T;return a(),u("div",tt,[o.value?(a(),U(X,{key:0},{default:$(()=>[S(be,{taskId:o.value,onClose:l[0]||(l[0]=r=>o.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):x("",!0),f.value?(a(),U(X,{key:1},{default:$(()=>[S(ge,{parentTaskId:g.parentId,requirementId:g.requirementId,onClose:N,onTaskCreated:z},null,8,["parentTaskId","requirementId"])]),_:1})):x("",!0),c.isOpen?(a(),U(X,{key:2,class:"*:max-w-4xl"},{default:$(()=>[S(fe,{taskId:c.taskId,onCancelClick:l[1]||(l[1]=()=>{c.isOpen=!1,c.taskId=0}),onSuccess:l[2]||(l[2]=()=>{c.isOpen=!1,c.taskId=0,y.value="loading",b()})},null,8,["taskId"])]),_:1})):x("",!0),S(Qe,{modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=r=>p.value=r),onClickAddTask:O,onClickPrioritySave:Q,onClickPriorityDiscard:l[4]||(l[4]=()=>i(E)?P.value.resetItems:null),"list-has-rearranged":i(E),isMyTask:i(d).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((k=(V=i(d))==null?void 0:V.query)==null?void 0:k["query-log"])=="true"?(a(!0),u(D,{key:3},Y(B.value,(r,A)=>(a(),u("div",{key:A,class:"text-xs text-gray-500"},[t("div",st,K(r.raw_query),1)]))),128)):x("",!0),t("div",lt,[i(C).error?(a(),u("div",at,K(i(C).error),1)):i(C).tasks.length>0?(a(),u("div",ot,[((T=i(d).query)==null?void 0:T.view)=="userwise"?(a(),U(et,{key:0,tasks:i(C).tasks,selectedUserId:i(d).query["user-ids"],onCommentButtonClick:l[5]||(l[5]=r=>G(r,e.task.id)),onEditClick:l[6]||(l[6]=r=>o.value=r),onAddClick:l[7]||(l[7]=r=>O(r)),onEmployeeAssignClick:l[8]||(l[8]=r=>R(r))},null,8,["tasks","selectedUserId"])):(a(),U(ke,{key:1,items:i(C).tasks,handle:"handle",onItemsUpdate:i(F),class:"space-y-4",ref_key:"draggableTaskList",ref:P},{item:$(({item:r,index:A})=>[t("div",nt,[S(ye,{"is-my-task":i(d).name==="MyTaskList",task:r,index:A,showDraggableHandle:!m.value,onCommentButtonClick:l[9]||(l[9]=_=>G(_,e.task.id)),onEditClick:l[10]||(l[10]=_=>o.value=_),onAddClick:l[11]||(l[11]=_=>O(_)),onEmployeeAssignClick:l[12]||(l[12]=_=>R(_)),class:"!border-0"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):y.value!=="loading"?(a(),u("div",rt," No tasks found. ")):x("",!0),y.value==="loading"?(a(),U(xe,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):x("",!0)]),S(ve,{show:M.value,"commentable-id":n.value,"commentable-type":"task","user-id":it,"on-close":J,onSubmitted:i(C).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Et as default};
