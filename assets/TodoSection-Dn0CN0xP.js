import{L as Z}from"./LoaderView-Cno6SEk6.js";import{r as F,x as A,e as _,A as Y,c as v,o as i,J as N,a as t,F as G,y as z,t as T,g as f,w as D,q as V,n as L,f as j,G as ie,i as O,k as C,d as ne,H as de,j as q,h as J,v as Q,m as me,T as K,U as H}from"./index-CtyYLalG.js";import{f as ye,h as ve,b as ee,g as X,i as pe,j as fe}from"./datetime-BixRpIok.js";import{u as B}from"./useTodoStore-CHLATu__.js";import{_ as ge}from"./DraggableList.vue_vue_type_script_setup_true_lang-CT2LBurO.js";import{_ as be}from"./UserChip-C_fwtTpn.js";import{O as oe}from"./OverlyModal-DgF8eaEO.js";const ke={class:"grid grid-cols-7 *:text-center *:p-2 *:border-r *:border-b *:text-blue-800 *:text-sm"},he={class:"flex flex-col"},xe={key:0,class:"p-2 border-r border-t"},Ce={__name:"CalenderView",props:{month:{type:String,required:!0,validator:o=>/^\d{4}-(0[1-9]|1[0-2])$/.test(o)}},emits:["change"],setup(o,{emit:w}){const a=o,n=w,y=F(),e=F(),u=F(),m=F(),c=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function r(h,d,b,x){const k=[];for(let R=b-1;R>=0;R--){const p=x-R,$=new Date(h,d-1,p);k.push({date:$,day:$.getDate(),month:$.getMonth()+1,year:$.getFullYear(),isCurrentMonth:!1})}return k}function g(h,d,b){const x=[];for(let k=1;k<=b;k++){const p={date:new Date(h,d,k),day:k,month:d+1,year:h,isCurrentMonth:!0};x.push(p)}return x}function l(h,d,b){const x=[...h],k=Math.ceil(x.length/7)*7,R=1;for(let p=0;x.length<k;p++){const $=new Date(d,b+1,R+p);x.push({date:$,day:$.getDate(),month:$.getMonth()+1,year:$.getFullYear(),isCurrentMonth:!1})}return x}function s(h,d){const b=new Date(h,d,1),k=new Date(h,d+1,0).getDate(),p=(b.getDay()+1)%7,I=new Date(h,d,0).getDate();let E=[];E=[...r(h,d,p,I)];const P=g(h,d,k);return u.value=P[0],m.value=P[P.length-1],E=[...E,...P],E=[...l(E,h,d)],y.value=E[0],e.value=E[E.length-1],E}const M=A(()=>{const[h,d]=a.month.split("-"),b=parseInt(h),x=parseInt(d)-1;return console.log({yearStr:h,monthStr:d}),s(b,x)}),S=A(()=>{const h=M.value,d=[];for(let b=0;b<h.length;b+=7)d.push(h.slice(b,b+7));return d});function U(){n("change",{gridStartDate:y.value,gridEndDate:e.value,startOfMonth:u.value,endOfMonth:m.value})}return _(()=>U()),Y(()=>a.month,U),(h,d)=>(i(),v("div",null,[N(h.$slots,"calender-top"),t("div",ke,[(i(),v(G,null,z(c,b=>t("div",{key:b},T(b),1)),64))]),t("div",he,[(i(!0),v(G,null,z(S.value,(b,x)=>(i(),v("div",{class:"week grid grid-cols-7 min-h-28 items-stretch",key:x},[(i(!0),v(G,null,z(b,(k,R)=>N(h.$slots,"date",{key:R,day:k.day,month:k.month,year:k.year,weekday:(k.date.getDay()+1)%7,isCurrentMonth:k.isCurrentMonth,yearMonthDate:`${k.year}-${String(k.month).padStart(2,"0")}-${String(k.day).padStart(2,"0")}`},()=>{var p;return[k!=null&&k.date?(i(),v("div",xe,T((p=k==null?void 0:k.date)==null?void 0:p.getDate()),1)):f("",!0)]})),128))]))),128))]),N(h.$slots,"calender-bottom")]))}},we={class:"px-4 py-2 flex items-center lg:justify-start flex-wrap bg-gray-50 group md:gap-x-2 gap-y-4"},De=["disabled"],$e=["value"],Te=["value"],Se={key:2,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},Me=["value"],Ie={key:3,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},Ee=["value"],Oe={__name:"TodoHeading",props:{selected:{type:Object,default:()=>({type:"month-view",month:"",day:"",year:"",week:""})},loading:{type:Boolean,default:!1}},emits:["reloadClick",,"change"],setup(o,{emit:w}){const a=o,n=[{value:"month-view",label:"Monthly"},{value:"day-view",label:"Daily"}],y=w,e=F();function u(d){e.value=d,y("change",{...a.selected,type:d})}Y(()=>{var d;return(d=a.selected)==null?void 0:d.type},d=>u(d),{immediate:!0});const m=A(()=>e.value=="month-view"&&a.selected.year&&a.selected.month?[a.selected.year,a.selected.month-1,1]:e.value=="day-view"&&a.selected.year&&a.selected.month&&a.selected.day?[a.selected.year,a.selected.month-1,a.selected.day]:[new Date().getFullYear(),new Date().getMonth(),new Date().getDate()]);function c(){e.value=="month-view"&&S(new Date)}function r(){if(e.value=="month-view"){const d=new Date(...m.value);d.setMonth(d.getMonth()+1),S(d)}}function g(){if(e.value=="month-view"){const d=new Date(...m.value);d.setMonth(d.getMonth()-1),S(d)}}function l(){e.value=="day-view"&&S(new Date)}function s(){if(e.value=="day-view"){const d=new Date(...m.value);d.setDate(d.getDate()+1),S(d)}}function M(){if(e.value=="day-view"){const d=new Date(...m.value);d.setDate(d.getDate()-1),S(d)}}function S(d){y("change",{type:e.value,month:d.getMonth()+1,day:d.getDate(),year:d.getFullYear(),week:d.getDay()})}const U=A(()=>e.value=="month-view"?`${a.selected.year}-${a.selected.month.toString().padStart(2,"0")}`:e.value=="day-view"?`${a.selected.year}-${a.selected.month.toString().padStart(2,"0")}-${a.selected.day.toString().padStart(2,"0")}`:a.selected),h=d=>{var b,x;if(e.value=="month-view"){const[k,R]=(b=d.target.value)==null?void 0:b.split("-").map(Number),p=new Date(k,R-1,1);S(p)}if(e.value=="day-view"){const k=new Date((x=d.target)==null?void 0:x.value);S(k)}};return(d,b)=>(i(),v("div",null,[t("div",we,[N(d.$slots,"before",{selected:o.selected}),t("button",{class:V(["px-2 py-2 disabled:text-gray-300 border size-[32px] flex items-center justify-center rounded-full",{"animate-spin !bg-opacity-0":o.loading}]),onClick:b[0]||(b[0]=D(x=>y("reloadClick"),["prevent"])),disabled:o.loading},[t("i",{class:V(["fas fa-redo",[o.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,De),N(d.$slots,"typeSelection",{selected:o.selected,types:n,changeType:u},()=>[t("select",{class:"px-2 h-7 border rounded",value:e.value,onChange:b[1]||(b[1]=x=>u(x.target.value))},[(i(),v(G,null,z(n,x=>t("option",{value:x.value,key:x.id},T(x.label),9,Te)),64))],40,$e)]),e.value=="month-view"?(i(),v("button",{key:0,class:"h-7",onClick:D(c,["prevent"])})):f("",!0),e.value=="day-view"?(i(),v("button",{key:1,class:"h-7",onClick:D(l,["prevent"])})):f("",!0),N(d.$slots,"inner",{selected:o.selected}),e.value=="month-view"?(i(),v("div",Se,[t("button",{class:"btn-3 px-3 rounded h-7",onClick:D(g,["prevent"])},b[2]||(b[2]=[t("span",{class:"fas fa-arrow-left"},null,-1)])),e.value=="month-view"?(i(),v("input",{key:0,type:"month",value:U.value,onInput:h,class:"border-2 px-2 rounded border-blue-900"},null,40,Me)):f("",!0),t("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:D(r,["prevent"])},b[3]||(b[3]=[t("span",{class:"fas fa-arrow-right"},null,-1)]))])):f("",!0),e.value=="day-view"?(i(),v("div",Ie,[t("button",{class:"btn-3 px-3 rounded h-7",onClick:D(M,["prevent"])},b[4]||(b[4]=[t("span",{class:"fas fa-arrow-left"},null,-1)])),e.value=="day-view"?(i(),v("input",{key:0,type:"date",value:U.value,onInput:h,class:"border-2 px-2 rounded border-blue-900 w-28"},null,40,Ee)):f("",!0),t("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:D(s,["prevent"])},b[5]||(b[5]=[t("span",{class:"fas fa-arrow-right"},null,-1)]))])):f("",!0),N(d.$slots,"after",{selected:o.selected})]),N(d.$slots,"bottom",{selected:o.selected})]))}},Re={key:0,class:"fa fa-exclamation-square",title:"Pending"},Ne={key:1,class:"fa fa-pause",title:"Working"},je={key:2,class:"fa fa-check-square",title:"Completed"},se={__name:"TodoStatusIcon",props:{todo:{type:Object,required:!0}},setup(o){const w=o,a=A(()=>{switch(w.todo.status){case"PENDING":return"text-red-400";case"WORKING":return"text-yellow-600";case"COMPLETED":return"text-green-400"}return""});return(n,y)=>(i(),v("span",{class:V(a.value)},[o.todo.status=="PENDING"?(i(),v("i",Re)):f("",!0),o.todo.status=="WORKING"?(i(),v("i",Ne)):f("",!0),o.todo.status=="COMPLETED"?(i(),v("i",je)):f("",!0)],2))}},Le=["title","onClick"],Pe={class:"line-clamp-1"},Fe={key:0,class:"text-purple-600 text-center"},re={__name:"TodosInDate",props:{date:{type:String,required:!0},maxItems:{type:[Number,String],default:3}},emits:["clickTodo"],setup(o,{emit:w}){const a=o,n=w,{getTodosByDate:y}=B(),e=A(()=>{let u=[],m=!1,c=[];if(typeof y=="function"){const r=y(a.date);if(c=Array.isArray(r)?r:[],a.maxItems==="all")return{all:c,items:c,moreItemsCount:0};u=c.slice(0,a.maxItems),m=c.length-u.length}return{all:c,items:u,moreItemsCount:m}});return(u,m)=>(i(),v("div",null,[e.value.items.length===0?N(u.$slots,"noTodos",{key:0},()=>[m[0]||(m[0]=t("div",{class:"text-gray-400 text-center"},"No todos",-1))]):(i(),v(G,{key:1},[N(u.$slots,"todoItems",{todos:e.value.items,allTodos:e.value.items,moreItemsCount:e.value.moreItemsCount},()=>[(i(!0),v(G,null,z(e.value.items,c=>N(u.$slots,"todoItem",{key:c.id,todo:c,moreItemsCount:e.value.moreItemsCount},()=>{var r,g,l,s;return[t("div",{title:`${c==null?void 0:c.title} ${c!=null&&c.user?`
by:`:""} ${(r=c==null?void 0:c.user)==null?void 0:r.name} ${(g=c==null?void 0:c.user)!=null&&g.department?`
DEPT:`:""} ${(s=(l=c.user)==null?void 0:l.department)==null?void 0:s.name}`,class:V(["px-1 mb-2 text-sm rounded cursor-pointer flex items-center gap-2",{"bg-sky-50 text-sky-900 hover:bg-sky-700 hover:text-white border border-sky-300":c.status!=="COMPLETED","bg-green-500 text-white":c.status==="COMPLETED"}]),onClick:D(M=>n("clickTodo",c),["prevent","stop"])},[L(se,{todo:c,class:V(["text-sm",[c.status=="COMPLETED"?"!text-white":""]])},null,8,["todo","class"]),t("div",Pe,T(c.title),1),c.user?(i(),j(ie,{key:0,user:c.user,size:"xsmall",class:"ml-auto"},null,8,["user"])):f("",!0)],10,Le)]})),128))]),e.value.moreItemsCount>0?(i(),v("div",Fe," + "+T(e.value.moreItemsCount)+" more todo"+T(e.value.moreItemsCount>1?"s":""),1)):f("",!0)],64))]))}},Ue={class:"relative"},Ae=["onClick","onKeypress"],We={class:"flex items-center justify-center"},qe=["onClick"],Ge={__name:"TodosInCalenderView",props:{month:{type:String,required:!0,validator:o=>/^\d{4}-(0[1-9]|1[0-2])$/.test(o)}},emits:["dateClick","clickTodo","clickDateCell"],setup(o,{emit:w}){const a=w;function n(e,u){e.isTrusted&&e.ctrlKey&&e.which==10&&a("dateClick",u)}function y(e){const[u,m,c]=String(e).split("-").map(Number),r=new Date(u,m-1,c);return ve(r)}return(e,u)=>(i(),v("div",Ue,[o.month?(i(),j(Ce,{key:0,month:o.month,class:"border-t border-blue-200/50 relative"},{date:O(({day:m,month:c,yearMonthDate:r,isCurrentMonth:g})=>[t("div",{tabindex:"0",class:V(["border p-4 cursor-pointer group/date relative focus:outline-slate-400",{"bg-sky-50   border-sky-300 focus:bg-sky-50 focus:outline-sky-400":y(r),"hover:bg-slate-50  hover:border-slate-300 focus:bg-slate-50 ":!y(r)}]),onClick:D(l=>a("dateClick",r),["prevent","stop"]),onKeypress:D(l=>n(l,r),["prevent"])},[t("button",{tabindex:"1",class:V([{"text-gray-300 hover:bg-sky-200  hover:text-white":!g,"text-sky-400 hover:bg-sky-200":g},"text-center mb-2 font-semibold w-full rounded"])},T(m)+" "+T(g?"":C(ye)(c-1)),3),t("div",null,[L(re,{date:r,onClickTodo:u[0]||(u[0]=l=>a("clickTodo",l))},{noTodos:O(()=>u[1]||(u[1]=[t("span",null,null,-1)])),_:2},1032,["date"])]),t("div",We,[t("button",{onClick:D(l=>a("clickDateCell",r),["prevent","stop"]),class:"btn-3 !py-1 invisible group-hover/date:visible text-sm text-red-800/40"},u[2]||(u[2]=[t("i",{class:"fas fa-plus"},null,-1),t("span",{class:"hidden lg:inline whitespace-nowrap"}," Add todo ",-1)]),8,qe)])],42,Ae)]),_:1},8,["month"])):f("",!0)]))}},Ve={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},ue={__name:"DepartmentChip",props:{department:Object},setup(o){return(w,a)=>{var n;return i(),v("div",Ve,T((n=o.department)==null?void 0:n.name),1)}}},Be={class:"ml-4"},ze={key:0,class:"mt-1 flex items-center gap-2"},Ke={key:0,class:"line-clamp-2 ml-4 text-gray-500"},He={class:"ml-auto flex items-center gap-2"},Ye={key:0,class:"flex items-center gap-1 text-red-600"},_e={__name:"TodoItemCard",props:{todo:{type:Object,required:!0},hideDepartment:{type:Boolean,default:!1},hideUser:{type:Boolean,default:!1}},emits:["clickTodo","clickEdit","clickDelete","clickChangeStatus","clickDelete"],setup(o,{emit:w}){const a=ne(),n=w;return(y,e)=>{var u,m,c;return i(),v("div",{class:V(["px-4 py-2 cursor-pointer flex items-center",{"bg-green-100":o.todo.status=="COMPLETED","hover:bg-gray-50":o.todo.status!="COMPLETED"}]),onClick:e[4]||(e[4]=D(r=>n("clickTodo",o.todo),["prevent"]))},[L(se,{todo:o.todo},null,8,["todo"]),t("div",Be,[t("div",{class:V(["line-clamp-1",{"text-green-800":o.todo.status=="COMPLETED","text-blue-800":o.todo.status!="COMPLETED"}])},T(o.todo.id)+" - "+T(o.todo.title),3),o.todo.user?(i(),v("div",ze,[o.hideUser?f("",!0):(i(),j(be,{key:0,user:o.todo.user,"avatar-size":"xsmall"},null,8,["user"])),o.hideDepartment?f("",!0):(i(),j(ue,{key:1,department:(m=(u=o.todo)==null?void 0:u.user)==null?void 0:m.department},null,8,["department"]))])):f("",!0)]),o.todo.todo_type&&o.todo.todo_type_id?(i(),v("div",Ke,T(o.todo.todo_type)+" id: "+T(o.todo.todo_type_id),1)):f("",!0),t("div",He,[o.todo.status=="WORKING"?(i(),v("div",Ye,e[5]||(e[5]=[t("span",{class:"fas fa-circle animate-pulse text-xs"},null,-1),t("span",{class:"text-xs"},"Working",-1)]))):f("",!0),o.todo.user_id===((c=C(a).user)==null?void 0:c.id)?(i(),v(G,{key:1},[o.todo.status==="WORKING"?(i(),v("button",{key:0,title:"Mark as Completed",class:"btn-icon bg-transparent text-green-400 border-green-400 border hover:bg-green-400 hover:text-white",onClick:e[0]||(e[0]=D(()=>n("clickChangeStatus",o.todo,"COMPLETED"),["prevent","stop"]))},e[6]||(e[6]=[t("i",{class:"fas fa-check"},null,-1)]))):f("",!0),o.todo.status==="PENDING"?(i(),v("button",{key:1,title:"Start Working",class:"btn-icon bg-transparent text-red-400 border-red-400 border hover:bg-red-400 hover:text-white",onClick:e[1]||(e[1]=D(()=>n("clickChangeStatus",o.todo,"WORKING"),["prevent","stop"]))},e[7]||(e[7]=[t("i",{class:"fas fa-play ml-[4px]"},null,-1)]))):f("",!0),t("button",{class:"btn-icon bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:e[2]||(e[2]=D(r=>n("clickEdit",o.todo),["prevent","stop"]))},e[8]||(e[8]=[t("i",{class:"fas fa-pen"},null,-1)])),t("button",{class:"btn-icon bg-red-400 text-white hover:bg-red-600 hover:text-white",onClick:e[3]||(e[3]=D(()=>n("clickDelete",o.todo),["prevent","stop"]))},e[9]||(e[9]=[t("i",{class:"fas fa-trash-alt"},null,-1)]))],64)):f("",!0),t("button",{onClick:D(()=>null,["stop","prevent"]),class:"btn-icon bg-gray-400 text-white hover:bg-gray-600 hover:text-white handle"},e[10]||(e[10]=[t("i",{class:"fas fa-arrows-alt-v"},null,-1)]))])],2)}}},Je={class:"border rounded-md"},Qe={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},Xe={class:"font-semibold flex items-center gap-2"},Ze={class:"text-white text-base"},et={class:"ml-auto flex items-center gap-2"},tt={key:0,class:"flex items-center gap-3 mr-6"},ot=["disabled"],nt=["disabled"],st=["date"],at={key:1,class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"},lt={__name:"UserTodos",props:{todos:{type:Array,required:!0},user:{type:Object,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","update"],setup(o,{emit:w}){const a=o,n=F(null),y=w,e=B();async function u(r){confirm(`Are your sure want to delete todo
'${r==null?void 0:r.title}'`)&&(await e.deleteTodo(r.id),y("update"))}async function m(r,g){confirm(`Are your sure?
want to change status to ${g} 
todo: '${r==null?void 0:r.title}'`)&&(await e.updateTodoStatus(r.id,g),y("update"))}async function c(){var g;const r=(g=n==null?void 0:n.value.items)==null?void 0:g.map(l=>l.id);await e.rearrangeMyTodos(r,{date:a.date}),y("update")}return(r,g)=>{var l,s;return i(),v("div",Je,[t("div",Qe,[t("div",Xe,[L(ie,{user:o.user},null,8,["user"]),t("div",Ze,T(o.user.label),1)]),t("div",et,[(l=n.value)!=null&&l.isItemsChanged?(i(),v("div",tt,[t("button",{onClick:g[0]||(g[0]=D(()=>c(),["prevent"])),class:"btn-2 disabled:opacity-40 disabled:pointer-events-none",disabled:C(e).updatingPriority}," Save Rearranged ",8,ot),t("button",{onClick:g[1]||(g[1]=D(()=>n.value.resetItems(),["prevent"])),class:"btn-3 disabled:opacity-40 disabled:pointer-events-none",disabled:C(e).updatingPriority}," Discard ",8,nt)])):f("",!0),L(ue,{department:(s=o.user)==null?void 0:s.department,class:"px-2"},null,8,["department"])])]),t("div",{date:r.date,"max-items":"all",class:"w-full"},[o.todos.length>0?(i(),j(ge,{key:0,items:o.todos,ref_key:"draggableTodos",ref:n,handle:"handle"},{item:O(({item:M})=>[L(_e,{todo:M,onClickTodo:S=>y("clickTodo",S),onClickEdit:S=>y("clickEdit",S),onClickDelete:S=>u(S),onClickChangeStatus:(S,U)=>m(S,U),"hide-department":"","hide-user":"",class:"border-b border-sky-200"},null,8,["todo","onClickTodo","onClickEdit","onClickDelete","onClickChangeStatus"])]),_:1},8,["items"])):f("",!0),o.todos.length===0?(i(),v("div",at," No Todos ")):f("",!0)],8,st)])}}},it={class:"relative bg-white p-4"},dt={key:0,class:"text-red-500 text-sm border border-red-300 max-w-6xl mx-auto py-2 gap-2 shadow-sm rounded flex items-center px-3"},rt={class:"max-w-6xl mx-auto border rounded my-5"},ut={class:"text-gray-700 border-b py-2 px-4 flex items-center"},ct={class:"text-lg font-semibold"},mt={key:0,class:"ml-auto flex items-center gap-2"},yt={__name:"TodosInDailyView",props:{date:{type:String,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickAdd","clickEdit","clickDelete","clickChangeStatus","backClick","update"],setup(o,{emit:w}){const a=o,n=w,y=ne(),e=B(),u=A(()=>new Date(a.date)),m=c=>{if(a.userRole=="employee")return[{...y.user,todos:c}];const r={};return c.forEach(g=>{const l=g.user.id;r[l]||(r[l]={...g.user,todos:[]}),r[l].todos.push(g)}),Object.values(r)};return(c,r)=>(i(),v("div",it,[C(e).error?(i(),v("div",dt,[r[5]||(r[5]=t("i",{class:"fad fa-exclamation-circle"},null,-1)),t("div",null,T(C(e).error),1)])):f("",!0),t("div",rt,[t("div",ut,[t("button",{class:"fa fa-arrow-left btn-icon mr-2",onClick:r[0]||(r[0]=D(g=>n("backClick"),["prevent"]))}),t("div",ct,T(C(ee)(u.value,{weekDay:"long"}))+" "+T(c.type),1),o.userRole=="employee"?(i(),v("div",mt,[t("button",{class:"btn btn-icon",onClick:r[1]||(r[1]=D(g=>n("clickAdd",a.date),["prevent"]))},r[6]||(r[6]=[t("i",{class:"fas fa-plus"},null,-1)]))])):f("",!0)]),L(re,{date:o.date,"max-items":"all",class:"w-full space-y-4 p-2"},{todoItems:O(({allTodos:g})=>[(i(!0),v(G,null,z(m(g),l=>(i(),j(lt,{key:l.id,todos:(l==null?void 0:l.todos)||[],user:l,onClickTodo:r[2]||(r[2]=s=>n("clickTodo",s)),onClickEdit:r[3]||(r[3]=s=>n("clickEdit",s)),onUpdate:r[4]||(r[4]=s=>n("update"))},null,8,["todos","user"]))),128))]),noTodos:O(()=>r[7]||(r[7]=[t("div",{class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"}," No Todos ",-1)])),_:1},8,["date"])])]))}},vt={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md"},pt={key:0,class:"mb-4 text-red-500 font-medium"},ft={key:1,class:"mb-4 text-blue-500 font-medium"},gt={class:"flex justify-between items-center gap-4"},bt=["disabled"],ce={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(o,{emit:w}){const a=w;return(n,y)=>(i(),v("form",{onSubmit:y[1]||(y[1]=D(e=>a("submit"),["prevent"]))},[N(n.$slots,"default"),t("div",vt,[o.error?(i(),v("div",pt,T(o.error),1)):f("",!0),o.isSubmitting?(i(),v("div",ft,"Saving changes...")):f("",!0),N(n.$slots,"footer",{},()=>[t("div",gt,[t("button",{type:"button",onClick:y[0]||(y[0]=e=>a("clickCancel")),class:"btn-3"},"Cancel"),t("button",{disabled:o.isSubmitting||o.isLoading,type:"submit",class:"btn-2"},T(o.isSubmitting?"Saving...":"Save"),9,bt)])])])],32))}},kt={class:""},ht={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},xt={class:"mb-2"},Ct={class:"mb-4"},wt={class:"mb-4"},Dt={__name:"TodoAddForm",props:{date:{type:String,default:X(new Date)},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(o,{emit:w}){const a=o,n=F(),y=F(),e=B(),u=w,m=F({title:"",date:a.date||"",task_id:""});async function c(){try{n.value="submitting",await e.createTodo(m.value,{returnWith:a.userRole!=="employee"?"user,department,company":""}),u("update")}finally{n.value=""}}const r=A(()=>new Date(a.date));return _(async()=>{var g;await de(),(g=y.value)==null||g.focus()}),(g,l)=>(i(),v("div",kt,[C(e).loading?(i(),j(Z,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:O(()=>l[3]||(l[3]=[q(" Loading... ")])),_:1,__:[3]})):f("",!0),L(ce,{onSubmit:c,onClickCancel:l[2]||(l[2]=s=>u("cancelClick")),isSubmitting:n.value=="submitting",error:C(e).error,class:"rounded-md relative"},{default:O(()=>[l[7]||(l[7]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),t("div",ht,[t("div",xt,[l[4]||(l[4]=t("span",{class:"font-semibold"}," Date ",-1)),t("span",null,T(C(ee)(r.value,{weekDay:"long"})),1)]),t("div",Ct,[l[5]||(l[5]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),J(t("input",{ref_key:"titleRef",ref:y,"onUpdate:modelValue":l[0]||(l[0]=s=>m.value.title=s),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.title]])]),t("div",wt,[l[6]||(l[6]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),J(t("input",{"onUpdate:modelValue":l[1]||(l[1]=s=>m.value.task_id=s),placeholder:"Enter a task id",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.task_id]])])])]),_:1,__:[7]},8,["isSubmitting","error"])]))}},$t={class:"relative"},Tt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},St={class:"mb-2"},Mt={class:"mb-4"},It={class:"mb-4"},Et={__name:"TodoEditForm",props:{date:{type:String,default:X(new Date)},todo:{type:Object,default:()=>{}}},emits:["update","cancelClick"],setup(o,{emit:w}){const a=o,n=F(),y=F(),e=B(),u=w,m=F({title:"",todo_type:"task",todo_type_id:""});async function c(){var l,s,M;await e.fetchTodo((l=a.todo)==null?void 0:l.id),m.value.title=(s=e.todo)==null?void 0:s.title,m.value.todo_type_id=(M=e.todo)==null?void 0:M.todoable_id}async function r(){n.value="submitting";try{await e.updateTodo(a.todo.id,m.value),u("update")}finally{n.value=""}}const g=A(()=>new Date(a.todo.date));return _(async()=>{var l;await c(),await de(),(l=y.value)==null||l.focus()}),(l,s)=>(i(),v("div",$t,[C(e).loading?(i(),j(Z,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:O(()=>s[3]||(s[3]=[q(" Loading... ")])),_:1,__:[3]})):f("",!0),L(ce,{onSubmit:r,onClickCancel:s[2]||(s[2]=M=>u("cancelClick")),isSubmitting:n.value=="submitting",isLoading:C(e).loading,error:C(e).error},{default:O(()=>[s[7]||(s[7]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),t("div",Tt,[t("div",St,[s[4]||(s[4]=t("span",{class:"font-semibold"}," Date ",-1)),t("span",null,T(C(ee)(g.value,{weekDay:"long"})),1)]),t("div",Mt,[s[5]||(s[5]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),J(t("input",{ref_key:"titleRef",ref:y,"onUpdate:modelValue":s[0]||(s[0]=M=>m.value.title=M),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.title]])]),t("div",It,[s[6]||(s[6]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),J(t("input",{"onUpdate:modelValue":s[1]||(s[1]=M=>m.value.todo_type_id=M),placeholder:"Enter a task id",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Q,m.value.todo_type_id]])])])]),_:1,__:[7]},8,["isSubmitting","isLoading","error"])]))}},Ot={class:"relative"},Rt={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},Nt={class:"mb-4"},jt={class:"mb-4"},Lt={key:0,class:"mt-1 flex items-center gap-2"},Pt={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},Ft={class:"flex items-center gap-4"},Ut={key:0,class:"flex items-center gap-2"},At={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},Wt={key:0,class:"ml-auto flex items-center gap-2"},qt={__name:"TodoShow",props:{todo:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update"],setup(o,{emit:w}){const a=o,n=B(),y=ne(),e=w;async function u(){var l;await n.fetchTodo((l=a.todo)==null?void 0:l.id)}const m=A(()=>{var l,s;return(l=n.todo)!=null&&l.date?new Date((s=n.todo)==null?void 0:s.date):null}),c=A(()=>{var l;return a.todo.user_id===((l=y.user)==null?void 0:l.id)});async function r(l){var s;confirm(`Are your sure want to delete todo
'${(s=n.todo)==null?void 0:s.title}'`)&&(await n.deleteTodo(l.id),e("update"))}async function g(l,s){var M;confirm(`Are your sure want to compete todo
'${(M=n.todo)==null?void 0:M.title}'`)&&(await n.updateTodoStatus(l.id,s),e("update"))}return _(async()=>{await u()}),(l,s)=>{var S,U,h,d,b,x,k,R;const M=me("UserChip");return i(),v("div",Ot,[C(n).loading?(i(),j(Z,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:O(()=>s[5]||(s[5]=[q(" Loading... ")])),_:1,__:[5]})):f("",!0),t("div",null,[s[11]||(s[11]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),t("div",Rt,[t("div",Nt,[s[6]||(s[6]=t("div",{class:"font-semibold text-xs text-gray-500"},"Date",-1)),t("span",null,T(C(ee)(m.value,{weekDay:"long"})),1)]),t("div",jt,[s[7]||(s[7]=t("div",{class:"text-xs text-gray-500"},"Todo",-1)),q(" "+T((S=C(n).todo)==null?void 0:S.title),1)]),o.todo.user?(i(),v("div",Lt,[L(M,{user:o.todo.user,"avatar-size":"xsmall"},null,8,["user"]),t("div",Pt,T((h=(U=o.todo.user)==null?void 0:U.department)==null?void 0:h.name),1)])):f("",!0),t("div",null,[s[10]||(s[10]=t("div",{class:"text-xs text-gray-500"},"Status",-1)),t("div",Ft,[t("div",null,[(d=C(n))!=null&&d.todo?(i(),j(se,{key:0,todo:(b=C(n))==null?void 0:b.todo},null,8,["todo"])):f("",!0),q(" "+T((x=C(n).todo)==null?void 0:x.status),1)]),c.value&&!C(n).loading?(i(),v("div",Ut,[((k=C(n).todo)==null?void 0:k.status)==="PENDING"?(i(),v("button",{key:0,class:"btn-2 from-yellow-700 to-yellow-500 text-white hover:bg-green-600 hover:text-white",onClick:s[0]||(s[0]=D(()=>g(C(n).todo,"WORKING"),["prevent","stop"]))},s[8]||(s[8]=[t("i",{class:"fas fa-exclamation-circle"},null,-1),q(" Change to Working ")]))):f("",!0),((R=C(n).todo)==null?void 0:R.status)==="WORKING"?(i(),v("button",{key:1,class:"btn-2 from-green-700 to-green-300 text-white hover:bg-green-600 hover:text-white",onClick:s[1]||(s[1]=D(()=>g(C(n).todo,"COMPLETED"),["prevent","stop"]))},s[9]||(s[9]=[t("i",{class:"fas fa-check"},null,-1),q(" Make Complete ")]))):f("",!0)])):f("",!0)])])])]),t("div",At,[t("button",{type:"button",onClick:s[2]||(s[2]=p=>e("cancelClick")),class:"btn-3"},"Cancel"),c.value&&!C(n).loading?(i(),v("div",Wt,[t("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:s[3]||(s[3]=D(p=>e("clickEdit",C(n).todo),["prevent","stop"]))},s[12]||(s[12]=[t("i",{class:"fas fa-pen"},null,-1),q(" Edit ")])),t("button",{class:"btn-2-red",onClick:s[4]||(s[4]=D(()=>r(C(n).todo),["prevent","stop"]))},s[13]||(s[13]=[t("i",{class:"fas fa-trash-alt"},null,-1),q(" Delete ")]))])):f("",!0)])])}}},Gt={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","update","clickEdit","clickDelete","clickChangeStatus"],setup(o,{emit:w}){const a=w;function n(){a("update")}return(y,e)=>(i(),v(G,null,[o.todoModal.action=="add"?(i(),j(oe,{key:0},{default:O(()=>{var u;return[L(Dt,{onCancelClick:e[0]||(e[0]=m=>a("cancelClick")),onUpdate:n,date:(u=o.todoModal)==null?void 0:u.date,userRole:o.userRole},null,8,["date","userRole"])]}),_:1})):f("",!0),o.todoModal.action=="edit"?(i(),j(oe,{key:1},{default:O(()=>{var u;return[L(Et,{onCancelClick:e[1]||(e[1]=m=>a("cancelClick")),onUpdate:n,todo:(u=o.todoModal)==null?void 0:u.todo,userRole:o.userRole},null,8,["todo","userRole"])]}),_:1})):f("",!0),o.todoModal.action=="show"?(i(),j(oe,{key:2},{default:O(()=>{var u;return[L(qt,{onCancelClick:e[2]||(e[2]=m=>a("cancelClick")),onUpdate:n,onClickEdit:e[3]||(e[3]=m=>a("clickEdit",m)),onClickDelete:e[4]||(e[4]=m=>a("clickDelete",m)),onClickChangeStatus:e[5]||(e[5]=(m,c)=>a("clickChangeStatus",m,c)),todo:(u=o.todoModal)==null?void 0:u.todo,userRole:o.userRole},null,8,["todo","userRole"])]}),_:1})):f("",!0)],64))}},Vt={class:"border bg-white relative"},Qt={__name:"TodoSection",props:{year:{type:Number,default:()=>new Date().getFullYear()},month:{type:Number,default:()=>new Date().getMonth()+1},day:{type:Number,default:()=>new Date().getDate()},week:{type:Number,default:()=>new Date().getDay()},type:{type:String,default:"month-view"},companyId:{type:String,default:""},departmentId:{type:String,default:""},employeeId:{type:String,default:""},lineType:{type:String,default:""},status:{type:String,default:""},userRole:{type:String,default:"employee"}},emits:["changeInput"],setup(o,{emit:w}){const a=new Date,n=o,y=F({type:"month-view",month:a.getMonth()+1,day:a.getDate(),year:a.getFullYear(),week:a.getDay()}),e=w;Y(()=>({...y.value}),p=>{e("changeInput",p)}),Y(()=>({year:n.year,month:n.month,day:n.day,week:n.week,type:n.type}),p=>{y.value={...p}},{immediate:!0});const u=F({action:null}),m=B();async function c(){await R()}function r(){u.value={...u.value,action:""}}async function g(p,$){await m.updateTodoStatus(p,$)}async function l(p){await m.deleteTodo(p)}function s(){y.value={...y.value,type:"month-view"}}function M(p){y.value={...y.value,...p}}function S(p){const[$,I,E]=p.split("-").map(Number);y.value={...y.value,type:"day-view",year:$,month:I,day:E}}function U(p){u.value={...u.value,action:"show",todo:p}}function h(p){u.value={...u.value,action:"edit",todo:p}}function d(p){u.value={...u.value,action:"add",date:p}}function b(){u.value={action:null,todo:null}}const x=A(()=>{var E,W,P,te,ae,le;const p=(W=(E=y.value)==null?void 0:E.year)==null?void 0:W.toString(),$=(te=(P=y.value)==null?void 0:P.month)==null?void 0:te.toString().padStart(2,"0"),I=(le=(ae=y.value)==null?void 0:ae.day)==null?void 0:le.toString().padStart(2,"0");return`${p}-${$}-${I}`}),k=A(()=>{var I,E,W,P;const p=(E=(I=y.value)==null?void 0:I.year)==null?void 0:E.toString(),$=(P=(W=y.value)==null?void 0:W.month)==null?void 0:P.toString().padStart(2,"0");return`${p}-${$}`});async function R(){const[p,$]=[Number(n.year),Number(n.month)],I=X(new Date(p,$-1,1)),E=X(pe(p,$-1));console.log("FETCHING...",{startDate1:I,endDate1:E});const[W,P]=fe(p,$-1);console.log("FETCHING...",{startDate:W,endDate:P}),n.userRole=="employee"?await m.fetchMyTodos({"start-date":W,"end-date":P}):await m.fetchTodos({"company-id":n.companyId,"department-id":n.departmentId,"employee-id":n.employeeId,"line-type":n.lineType,"start-date":W,"end-date":P,status:n.status})}return _(async()=>{await R()}),Y(()=>({"company-id":n.companyId,"department-id":n.departmentId,"employee-id":n.employeeId,"line-type":n.lineType,status:n.status,month:n.month}),()=>R()),(p,$)=>(i(),v("div",null,[t("div",Vt,[C(m).loading?(i(),j(Z,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:O(()=>$[0]||($[0]=[q(" Loading... ")])),_:1,__:[0]})):f("",!0),L(Oe,{selected:y.value,class:"border-b shadow z-20",onChange:M,onReloadClick:c},{before:O(I=>[N(p.$slots,"beforeHeader",K(H(I)))]),inner:O(I=>[N(p.$slots,"innerHeader",K(H(I)))]),after:O(I=>[N(p.$slots,"afterHeader",K(H(I)))]),bottom:O(I=>[N(p.$slots,"bottomHeader",K(H(I)))]),typeSelection:O(I=>[N(p.$slots,"typeSelection",K(H(I)))]),_:3},8,["selected"]),y.value.type=="month-view"?(i(),j(Ge,{key:1,month:k.value,class:"bg-white",onDateClick:S,onClickTodo:U,onClickDateCell:d},null,8,["month"])):f("",!0),y.value.type=="day-view"?(i(),j(yt,{key:2,date:x.value,userRole:o.userRole,onClickTodo:U,onClickEdit:h,onClickAdd:d,onClickDelete:l,onClickChangeStatus:g,onBackClick:s,onUpdate:r},null,8,["date","userRole"])):f("",!0)]),L(Gt,{todoModal:u.value,userRole:o.userRole,onCancelClick:b,onUpdate:r,onClickEdit:h},null,8,["todoModal","userRole"])]))}};export{Ce as _,Qt as a};
