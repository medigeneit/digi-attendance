import{_ as ye}from"./CommentModal-C03Es96z.js";import{_ as ce,a as ke}from"./TaskUserAssignForm-Bp1YcVym.js";import{L as ve}from"./LoaderView-BhFrP01D.js";import{O as Q}from"./OverlyModal-qcFOnwwV.js";import{_ as fe}from"./TaskAddForm-WXRxnGGN.js";import{_ as ge}from"./TaskEditForm-D-LuUnaA.js";import{r as q,q as b,c as m,o as a,a as t,h as D,v as re,g as f,w as G,d as ie,b as ue,e as de,A as Z,n as be,f as L,F as P,p as I,C as se,x as K,t as ee,k as r,i as S,D as X,j as le,y as te,u as xe,E as ae}from"./index-DWU35BE7.js";import{_ as we}from"./MultiselectDropdown-CN8JIn2p.js";import{g as Te,u as Ce}from"./task-priority-Rlsp0F-m.js";import{u as Ie}from"./company-BGjkJtXz.js";import{_ as oe}from"./CompanyDepartmentSelectInput-3AceEmmK.js";import{_ as me}from"./UserChip-BrrzscWp.js";import{_ as pe}from"./TaskTreeView-Bt0N4n0R.js";import{u as Ve}from"./useTaskStore-CJtz_j_L.js";import"./useCommentStore-CswnRW7k.js";import"./datetime-q3Sn87-f.js";import"./TextWithHr-DuXz0_jU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-Bt3xUN7J.js";import"./RequiredIcon-Dcafa4gK.js";import"./useRequirementStore-CB_pOjwa.js";import"./SectionLoading-Uzsz-QX_.js";const Ae={class:"text-gray-600 relative"},Me={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},ne={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(V,{emit:x}){const p=V,i=q(),T=x,c=u=>{T("update:modelValue",u||void 0)};let A=0;const n=b({get(){return p.modelValue},set(u){clearTimeout(A),A=setTimeout(c,500,u)}});return(u,o)=>(a(),m("div",Ae,[o[3]||(o[3]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),D(t("input",{ref_key:"searchInput",ref:i,id:"search","onUpdate:modelValue":o[0]||(o[0]=g=>n.value=g),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[re,n.value]]),t("div",Me,[n.value?(a(),m("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:o[1]||(o[1]=G(()=>{c(""),i.value.focus()},["prevent"]))})):f("",!0),o[2]||(o[2]=t("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},qe={class:"mb-3 task-header"},Le={class:"flex justify-between items-start mb-4"},Se={key:0,class:"ml-auto flex gap-6 items-center"},$e={key:0,class:"flex gap-2 items-center"},Ue={class:"flex flex-wrap items-center gap-2 mt-3"},Ee={class:"flex flex-wrap gap-4"},_e={class:"relative w-full md:w-48"},De=["value"],Pe={key:1,class:"relative w-full md:w-72"},he={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Oe={class:"text-gray-600 w-40 relative"},Be={class:"flex gap-4 items-center flex-shrink-0"},Ne={class:"flex gap-2"},Re={class:"flex gap-2"},Fe={class:"flex gap-2"},je={class:"text-gray-600 w-full md:w-40 relative"},ze={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-5 gap-2"},He={key:1,class:"w-full flex justify-end gap-5 mt-4"},We={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(V,{emit:x}){const p=V,i=ie(),T=ue(),c=b(k("company-id")),A=b(k("from-department-id")),n=b(k("to-department-id")),u=b(k("user-ids")),o=b(k("month")),g=b(k("status")),w=b(k("is-important")),y=b(k("is-urgent")),F=b(k("is-target")),U=b(k("search")),h=x,O=Ie(),E=q([]);function k(C){return{get:()=>p.modelValue[C]||"",set:e=>{h("update:modelValue",{...p.modelValue,[C]:e||void 0})}}}const B=b(()=>Y(u.value));async function N(){var C,e,$;if(!p.isMyTask){const d=(C=p.modelValue)==null?void 0:C["company-id"],s=n.value,_={...d?{company_id:d}:{},...s?{department_ids:[s]}:{}};E.value=(($=(e=await Te({params:_}))==null?void 0:e.data)==null?void 0:$.employees)||[]}}de(async()=>{await N(),await O.fetchCompanies({with:"departments"})});function Y(C){return Array.isArray(E.value)&&E.value.find(e=>e.id==C)||null}function J(C){u.value=(C==null?void 0:C.id)||""}function j(){u.value=""}return Z(()=>n.value,N),Z(()=>c.value,()=>{n.value!==""?n.value="":N()}),(C,e)=>{var d,s,_,z,H,v,R,M;const $=be("RouterLink");return a(),m(P,null,[t("div",qe,[t("div",Le,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),V.isMyTask?f("",!0):(a(),m("div",Se,[V.listHasRearranged?(a(),m("div",$e,[e[13]||(e[13]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=G(l=>h("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=G(l=>h("clickPriorityDiscard"),["prevent"]))},"Discard")])):f("",!0),t("button",{onClick:e[2]||(e[2]=l=>h("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),t("div",Ue,[t("div",Ee,[V.isMyTask?f("",!0):(a(),m(P,{key:0},[t("div",_e,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),D(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>c.value=l),class:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[15]||(e[15]=t("option",{value:""},"--ALL COMPANY--",-1)),(a(!0),m(P,null,K((d=r(O))==null?void 0:d.companies,l=>(a(),m("option",{key:l.id,value:l.id},ee(l.name),9,De))),128))],512),[[se,c.value]])]),I(oe,{modelValue:A.value,"onUpdate:modelValue":e[4]||(e[4]=l=>A.value=l),companies:((s=r(O))==null?void 0:s.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:S(()=>e[17]||(e[17]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),r(T).name!=="MyTaskList"?(a(),L(oe,{key:0,modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value=l),companies:((_=r(O))==null?void 0:_.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:S(()=>e[18]||(e[18]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):f("",!0),r(i).isAdminMood&&((H=(z=r(i))==null?void 0:z.user)==null?void 0:H.role)!=="employee"?(a(),m("div",Pe,[I(we,{modelValue:B.value,onSelect:J,onRemove:j,options:E.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full"},{option:S(({option:l})=>[I(me,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),B.value?(a(),m("div",he,[t("button",{onClick:G(j,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):f("",!0),e[19]||(e[19]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):f("",!0)],64)),t("div",Oe,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),D(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>g.value=l),class:"input-1"},e[20]||(e[20]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[se,g.value]])]),t("div",Be,[t("label",Ne,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>w.value=l)},null,512),[[X,w.value]]),e[22]||(e[22]=t("span",null,"Important",-1))]),t("label",Re,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>y.value=l)},null,512),[[X,y.value]]),e[23]||(e[23]=t("span",null,"Urgent",-1))]),t("label",Fe,[D(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=l=>F.value=l)},null,512),[[X,F.value]]),e[24]||(e[24]=t("span",null,"Is Target",-1))])]),t("div",je,[e[25]||(e[25]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),D(t("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=l=>o.value=l),type:"month",class:"input-1",placeholder:"All month"},null,512),[[re,o.value]])])]),V.isMyTask?(a(),L(ne,{key:0,modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=l=>U.value=l),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):f("",!0)])]),t("div",ze,[V.isMyTask?f("",!0):(a(),L(ne,{key:0,modelValue:U.value,"onUpdate:modelValue":e[12]||(e[12]=l=>U.value=l),class:"w-full md:w-64 lg:w-96 md:ml-auto"},null,8,["modelValue"])),V.isMyTask?f("",!0):(a(),m("div",He,[I($,{class:te(["text-xs sm:text-sm btn-3 py-0.5",((v=r(T).query)==null?void 0:v.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...r(T).query,view:"userwise"}}},{default:S(()=>e[26]||(e[26]=[le(" User Wise List ")])),_:1,__:[26]},8,["class","to"]),I($,{class:te(["text-xs sm:text-sm btn-3 py-0.5",((R=r(T).query)==null?void 0:R.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((M=r(T))==null?void 0:M.query)||{}).filter(l=>{var W;return((W=r(T))==null?void 0:W.query[l])!=="userwise"}).reduce((l,W)=>({...l,[W]:r(T).query[W]}),{})}}},{default:S(()=>e[27]||(e[27]=[le(" TaskWise List ")])),_:1,__:[27]},8,["class","to"])]))])],64)}}},Ye={class:"w-full bg-white rounded"},Ge=["rowspan"],Ke={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(V,{emit:x}){const p=V,i=x,T=b(()=>p.tasks.reduce((n,u)=>(n.push(...u.users.filter(o=>!n.find(g=>g.id==o.id&&o.id))),n),[]).filter(n=>p.selectedUserId?n.id==p.selectedUserId:!0)),c=n=>p.tasks.filter(g=>g.users.some(w=>w.id===n)),A=b(()=>T.value.map(n=>{const u=c(n.id);return{...n,tasks:u}}));return(n,u)=>(a(),m("div",null,[t("table",Ye,[t("tbody",null,[(a(!0),m(P,null,K(A.value,o=>(a(),m(P,{key:o.id},[(a(!0),m(P,null,K(o.tasks,(g,w)=>(a(),m("tr",{key:g.id},[w==0?(a(),m("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(o.tasks.length,1)},[I(me,{user:o,class:"sticky top-[80px]"},null,8,["user"])],8,Ge)):f("",!0),t("td",{class:te(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":w==0,"border-b":o.tasks.length-1===w}])},[I(pe,{task:g,class:"!border-0 my-0",index:w,onCommentButtonClick:u[0]||(u[0]=y=>i("commentButtonClick",n.item.id)),onEditClick:u[1]||(u[1]=y=>i("editClick",y)),onAddClick:u[2]||(u[2]=y=>i("addClick",y)),onEmployeeAssignClick:u[3]||(u[3]=y=>i("employeeAssignClick",y))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Je={class:"container mx-auto p-6 mt-2 relative bg-white rounded-md shadow-md"},Qe={class:"mb-4"},Xe={class:"relative min-h-[30vh]"},Ze={key:0,class:"text-center py-4 text-red-500"},et={key:1},tt={class:"flex items-stretched"},st={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},lt=1,At={__name:"TaskList",setup(V){const x=Ve(),p=ie(),i=ue(),T=xe(),c=q(""),A=q(!1),n=q(null),u=b(()=>{var d;return((d=p==null?void 0:p.user)==null?void 0:d.role)==="employee"||!(p!=null&&p.isAdminMood)?!0:!!i.query["user-ids"]}),o=q(null),g=q(!1),w=ae({parentId:0,requirementId:0}),y=ae({taskId:0,isOpen:!1}),F=q(null),U=q([]),{handleItemsPriorityUpdate:h,saveTaskPriority:O,listHasRearranged:E}=Ce(()=>x.taskListTree,0);de(async()=>{c.value="loading",i.query.status||T.push({query:{...i.query,status:"not-completed"}}),await k()});async function k(){let d;i.name==="MyTaskList"?d=await x.fetchMyTasks({...i.query}):d=await x.fetchTasks({...i.query}),c.value="",U.value=d.query_log||[]}const B=d=>{g.value=!0,w.parentId=d},N=d=>{y.taskId=d,y.isOpen=!0},Y=d=>{n.value=d,A.value=!0},J=()=>{A.value=!1,n.value=null};async function j(){o.value=null,g.value=!1,w.parentId=0,c.value="loading",await k()}async function C(){g.value=!1,w.parentId=0,await k()}async function e(){c.value="loading",await O()&&await k()}Z(()=>({...i.query}),async()=>{c.value="loading",await k()});const $=b({get(){return{...i.query}},set(d){localStorage.removeItem("sub_task_opened_list"),T.push({query:{...d}})}});return(d,s)=>{var _,z,H;return a(),m("div",Je,[o.value?(a(),L(Q,{key:0},{default:S(()=>[I(ge,{taskId:o.value,onClose:s[0]||(s[0]=v=>o.value=null),onUpdated:j},null,8,["taskId"])]),_:1})):f("",!0),g.value?(a(),L(Q,{key:1},{default:S(()=>[I(fe,{parentTaskId:w.parentId,requirementId:w.requirementId,onClose:C,onTaskCreated:j},null,8,["parentTaskId","requirementId"])]),_:1})):f("",!0),y.isOpen?(a(),L(Q,{key:2,class:"*:max-w-4xl"},{default:S(()=>[I(ce,{taskId:y.taskId,onCancelClick:s[1]||(s[1]=()=>{y.isOpen=!1,y.taskId=0}),onSuccess:s[2]||(s[2]=()=>{y.isOpen=!1,y.taskId=0,c.value="loading",k()})},null,8,["taskId"])]),_:1})):f("",!0),I(We,{modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=v=>$.value=v),onClickAddTask:B,onClickPrioritySave:e,onClickPriorityDiscard:s[4]||(s[4]=()=>r(E)?F.value.resetItems:null),"list-has-rearranged":r(E),isMyTask:r(i).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((z=(_=r(i))==null?void 0:_.query)==null?void 0:z["query-log"])=="true"?(a(!0),m(P,{key:3},K(U.value,(v,R)=>(a(),m("div",{key:R,class:"text-xs text-gray-500"},[t("div",Qe,ee(v.raw_query),1)]))),128)):f("",!0),t("div",Xe,[r(x).error?(a(),m("div",Ze,ee(r(x).error),1)):r(x).tasks.length>0?(a(),m("div",et,[((H=r(i).query)==null?void 0:H.view)=="userwise"?(a(),L(Ke,{key:0,tasks:r(x).tasks,selectedUserId:r(i).query["user-ids"],onCommentButtonClick:s[5]||(s[5]=v=>Y(v,d.task.id)),onEditClick:s[6]||(s[6]=v=>o.value=v),onAddClick:s[7]||(s[7]=v=>B(v)),onEmployeeAssignClick:s[8]||(s[8]=v=>N(v))},null,8,["tasks","selectedUserId"])):(a(),L(ke,{key:1,items:r(x).tasks,handle:"handle",onItemsUpdate:r(h),class:"space-y-4",ref_key:"draggableTaskList",ref:F},{item:S(({item:v,index:R})=>[t("div",tt,[I(pe,{"is-my-task":r(i).name==="MyTaskList",task:v,index:R,showDraggableHandle:!u.value,onCommentButtonClick:s[9]||(s[9]=M=>Y(M,d.task.id)),onEditClick:s[10]||(s[10]=M=>o.value=M),onAddClick:s[11]||(s[11]=M=>B(M)),onEmployeeAssignClick:s[12]||(s[12]=M=>N(M)),class:"!border-0"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):c.value!=="loading"?(a(),m("div",st," No tasks found. ")):f("",!0),c.value==="loading"?(a(),L(ve,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):f("",!0)]),I(ye,{show:A.value,"commentable-id":n.value,"commentable-type":"task","user-id":lt,"on-close":J,onSubmitted:r(x).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{At as default};
