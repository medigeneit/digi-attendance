import{M as b,r as v,m as d,C as i}from"./index-Cw8jGluf.js";const q=b("task",()=>{const u=v([]),y=v(null),c=v(!1),o=v(null),h=v(1),g=v(!0),m=async(e,t,{updateStoreData:a=!0})=>{var s,r;a==!0&&(c.value=!0,o.value=null);try{await i.post(`/tasks/${e}/assign-users`,{user_ids:t}),await T(e)}catch(l){throw a==!0&&(o.value=((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.message)||"Assign users failed"),l}finally{a==!0&&(c.value=!1)}};function _(){h.value=1,u.value=[]}const $=async(e,{infiniteScrolling:t=!1}={})=>{var a,s,r,l,n;if(o.value=null,c.value)return null;try{const f={...e,...t?{page:h.value,per_page:50}:{per_page:5e3}};c.value=!0;const k=await i.get("/tasks",{params:f});if(t){const A=(((a=k.data)==null?void 0:a.tasks)||[]).filter(B=>!u.value.some(M=>M.id==B.id));g.value=((s=k.data)==null?void 0:s.all_status_count)>0,u.value=[...u.value,...A],h.value++}else u.value=((r=k.data)==null?void 0:r.tasks)||[];return c.value=!1,k.data}catch(f){throw o.value=((n=(l=f.response)==null?void 0:l.data)==null?void 0:n.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",f}},C=async(e,{}={})=>{var t,a,s;o.value=null;try{const r=await i.get("/my-tasks",{params:e});return u.value=((t=r.data)==null?void 0:t.tasks)||[],r.data}catch(r){throw o.value=((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",r),r}};function p(e,t=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>a.parent_id===t).map(a=>({...a,children_tasks:p(e,a.id)}))}function w(){return p(u.value,0)}function O(){const e=[],t=(a,s=0,r="")=>{a.forEach(l=>{e.push({...l,depth:s,idPath:r+l.id}),l.children_tasks&&l.children_tasks.length&&t(l.children_tasks,s+1,r+l.id+"-")})};return t(w()),e}const T=async(e,t={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var s,r,l;a.fetchOnly||(c.value=!0),o.value=null;try{const n=await i.get(`/tasks/${e}`,{params:t});return a.fetchOnly||(y.value=((s=n.data)==null?void 0:s.task)||{},u.value=n.data.sub_tasks||[]),n.data}catch(n){const f=((l=(r=n.response)==null?void 0:r.data)==null?void 0:l.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(o.value=f),f}finally{a.fetchOnly||(c.value=!1)}},E=async(e,t={loadingBeforeCreate:!1})=>{var a,s,r,l;t.loadingBeforeCreate&&(c.value=!0),o.value=null;try{const n=await i.post("/tasks",e);return(a=n.data)!=null&&a.data&&u.value.push((s=n.data)==null?void 0:s.data),n.data.data}catch(n){throw o.value=((l=(r=n.response)==null?void 0:r.data)==null?void 0:l.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",n),n}finally{t.loadingBeforeCreate&&(c.value=!1)}},L=async(e,t,{loadingBeforeFetch:a=!0})=>{a&&(c.value=!0),o.value=null;try{const s=await i.put(`/tasks/${e}`,t),r=u.value.findIndex(l=>l.id===e);return r!==-1&&(u.value[r]=s.data.data),s.data.data}catch(s){throw s}finally{a&&(c.value=!1)}},P=async(e,t)=>(await i.put(`/tasks/${e}/update-priorities`,{task_ids:t})).data,x=async e=>{var t,a;c.value=!0,o.value=null;try{await i.delete(`/tasks/${e}`),u.value=u.value.filter(s=>s.id!==e)}catch(s){o.value=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,s)}finally{c.value=!1}};return{tasks:d(()=>u.value),task:d(()=>y.value),loading:d(()=>c.value),error:d(()=>o.value),taskListTree:d(w),flattenedTasks:d(O),fetchTasks:$,hasMoreTask:g,fetchMyTasks:C,resetTaskList:_,fetchTask:T,createTask:E,updateTask:L,deleteTask:x,assignUsers:m,updateTaskPriorities:P}});export{q as u};
