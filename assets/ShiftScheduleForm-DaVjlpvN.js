import{J as oe,r as h,K as O,s as K,q as L,A as H,e as ne,c as r,o as u,a as s,f as re,g as _,C as I,F as x,x as D,t as g,h as Y,l as ue,v as de,y as U,z as j,n as P,E as ie}from"./index-qwVrkjAn.js";import{_ as ce}from"./MultiselectDropdown-gWNC3QQj.js";import{u as ve}from"./company-CnSgrNuS.js";import{u as fe}from"./department-CNySSHw0.js";import{u as pe}from"./shift-BLEigpOi.js";import{d as T}from"./dayjs.min-Cbbdfn5l.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-CguTR8os.js";const me=oe("shiftSchedule",()=>{const F=h([]),S=h(!1);return{schedules:F,defaultShift:S,fetchSchedules:async v=>{var m,M,V;const i=await O.get("/shift-schedules",v);return F.value=(m=i==null?void 0:i.data)==null?void 0:m.schedules,S.value=(M=i==null?void 0:i.data)==null?void 0:M.default_shift,(V=i.data)==null?void 0:V.schedules},saveSchedules:async v=>{await O.post("/shift-schedules",{schedules:v==null?void 0:v.payload})},fetchDefaultSchedules:async v=>{const i=await O.get("/default-shift-schedules",v);return F.value=i==null?void 0:i.data,i.data}}}),ye={class:"p-4 max-w-[1600px] mx-auto"},ge={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},Se=["value"],be=["value"],xe=["value"],De={key:0,class:"text-yellow-600 font-medium mb-2 p-2 border rounded border-black"},we={class:"flex flex-wrap gap-3 mb-4 p-4 bg-white rounded sticky top-16"},Ee=["onClick"],ke={class:"text-sm"},Ce={class:"overflow-auto"},_e={class:"table-auto w-full border text-sm"},Fe={class:"sticky top-0 bg-white z-10"},Ae={class:"text-xs text-gray-400"},Ne={class:"border p-2"},Me=["value"],Ve={class:"border p-2 whitespace-nowrap"},We={class:"border p-2"},$e=["onClick"],Be=["onClick"],Ke=["title"],Ye={__name:"ShiftScheduleForm",setup(F){const S=me(),k=ve(),A=pe(),N=fe(),{defaultShift:v}=K(S),{companies:i,employees:m}=K(k),{departments:M}=K(N),{shifts:V}=K(A),b=h(T().format("YYYY-MM")),y=h(""),w=h(""),W=h(""),f=h(""),d=h({}),c=h([]),E=h({WEEKEND:"#B91C1C",HOLIDAY:"#6B7280"}),z=["#FF5733","#33C1FF","#33FF57","#FF33D4","#FFD633","#7D33FF","#FF8C33","#33FFF0","#B833FF","#3375FF","#FF3333","#33FFAA"],$=L(()=>Object.values(V.value||{}).flat());function q(){let l=0;$.value.forEach(e=>{E.value[e.id]||(E.value[e.id]=z[l%z.length],l++)})}const B=L(()=>Array.from({length:T(b.value).daysInMonth()},(l,e)=>e+1)),J=l=>{const e=`${b.value}-${String(l).padStart(2,"0")}`;return T(e).format("ddd")},Q=(l,e)=>{var a,o;const t=(o=(a=d.value)==null?void 0:a[l])==null?void 0:o[e];return t?t==="WEEKEND"||t==="HOLIDAY"?{backgroundColor:E.value[t]||"#D1D5DB"}:{backgroundColor:E.value[t]||"#D1D5DB"}:{backgroundColor:"#D1D5DB"}},X=(l,e)=>{var o,p;const t=(p=(o=d.value)==null?void 0:o[l])==null?void 0:p[e],a=$.value.find(n=>n.id===t);return(a==null?void 0:a.name)||""},Z=(l,e)=>{c.value.includes(parseInt(l))&&f.value&&(d.value[l]||(d.value[l]={}),d.value[l][e]=f.value)},R=l=>{c.value.includes(parseInt(l))&&f.value&&(d.value[l]||(d.value[l]={}),B.value.forEach(e=>{d.value[l][e]=f.value}))},ee=()=>{c.value.forEach(R)},te=()=>{c.value.forEach(l=>{var a;const e=m.value.find(o=>o.id===parseInt(l)),t=((a=e==null?void 0:e.weekends)==null?void 0:a.map(o=>o.slice(0,3)))||[];d.value[l]||(d.value[l]={}),B.value.forEach(o=>{const p=J(o);t.includes(p)&&(d.value[l][o]="WEEKEND")})})},le=async()=>{if(!c.value.length){alert("Please select employees before saving.");return}if(!confirm("Are you sure you want to save the schedule?"))return;const l=[];for(const[e,t]of Object.entries(d.value))if(c.value.includes(parseInt(e)))for(const[a,o]of Object.entries(t)){let p=null,n=null;o==="WEEKEND"||o==="HOLIDAY"?n=o:p=o,l.push({employee_id:parseInt(e),date:`${b.value}-${String(a).padStart(2,"0")}`,shift_id:p,status:n})}if(console.log({payload:l}),!l.length){alert("No schedule data to save.");return}try{await S.saveSchedules({payload:l}),alert("Shift schedule saved successfully!")}catch(e){console.error("Failed to save schedule",e),alert("Something went wrong while saving.")}};H(y,async l=>{l&&(w.value="",c.value=[],m.value=[],d.value={},await k.fetchEmployee(l),await N.fetchDepartments({companyId:l}),await A.fetchShifts({companyId:l}),q())}),H(w,async l=>{if(l){const e={companyId:y.value,departmentIds:[l]},t=await N.fetchDepartmentEmployee(e);m.value=t,c.value=[],await G(y.value,l,b.value)}}),H(b,async l=>{l&&y.value&&w.value&&(await k.fetchEmployee(y.value),await A.fetchShifts({companyId:y.value}),q(),await G(y.value,w.value,l))});const se=L(()=>W.value?m.value.filter(l=>{var e;return l.id===parseInt((e=W.value)==null?void 0:e.id)}):m.value);ne(async()=>{await k.fetchCompanies()});const G=async(l,e,t)=>{try{if(!l||!e||!t){alert("Company, Department, and Month are required to load schedule.");return}d.value={},c.value=[],v.value=!1;let o=await S.fetchSchedules({params:{company_id:l,department_id:e,month:t}})||[];const p={};if(!o.length){const n=await S.fetchDefaultSchedules({params:{company_id:l,department_id:e,month:t}});console.warn("[Fallback Schedule Loaded]",n),alert("No saved schedule found. Default schedule loaded."),o=n,v.value=!0}o.forEach(n=>{if(!(n!=null&&n.employee_id)||!(n!=null&&n.date))return;const C=n.employee_id,ae=parseInt(n.date.split("-")[2]);p[C]||(p[C]={}),p[C][ae]=n.shift_id||n.status,!v.value&&!c.value.includes(C)&&c.value.push(C)}),d.value=p}catch(a){console.error("Failed to load schedule data:",a),alert("Error loading schedule. Please try again or contact admin.")}};return(l,e)=>(u(),r("div",ye,[e[16]||(e[16]=s("h2",{class:"text-center title-lg mb-4"},"Monthly Shift Schedule Plan",-1)),s("div",ge,[_(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),class:"p-2 border rounded"},[e[8]||(e[8]=s("option",{value:""},"Select Company",-1)),(u(!0),r(x,null,D(Y(i),t=>(u(),r("option",{key:t.id,value:t.id},g(t.name),9,Se))),128))],512),[[I,y.value]]),_(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),class:"p-2 border rounded"},[e[9]||(e[9]=s("option",{value:""},"- Department -",-1)),(u(!0),r(x,null,D(Y(M),t=>(u(),r("option",{key:t.id,value:t.id},g(t.name),9,be))),128))],512),[[I,w.value]]),s("div",null,[ue(ce,{modelValue:W.value,"onUpdate:modelValue":e[2]||(e[2]=t=>W.value=t),options:Y(m),multiple:!1,label:"name","label-prefix":"employee_id",placeholder:"Select user"},null,8,["modelValue","options"])]),_(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),class:"p-2 border rounded"},[e[10]||(e[10]=s("option",{value:""},"- Shift -",-1)),(u(!0),r(x,null,D($.value,t=>(u(),r("option",{key:t.id,value:t.id},g(t.name),9,xe))),128))],512),[[I,f.value]]),_(s("input",{type:"month","onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),class:"p-2 border rounded"},null,512),[[de,b.value]])]),Y(v)?(u(),r("p",De," âš  Showing default schedule from current shift. Select employees manually before saving. ")):re("",!0),s("div",we,[(u(!0),r(x,null,D($.value,t=>(u(),r("div",{key:t.id,class:U(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":f.value===t.id}]),onClick:a=>f.value=t.id},[s("div",{class:"w-5 h-5 rounded",style:j({backgroundColor:E.value[t.id]||"#ccc"})},null,4),s("span",ke,g(t.name),1)],10,Ee))),128)),s("div",{class:U(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":f.value==="HOLIDAY"}]),onClick:e[5]||(e[5]=t=>f.value="HOLIDAY")},e[11]||(e[11]=[s("div",{class:"w-5 h-5 rounded bg-gray-500"},null,-1),s("span",{class:"text-sm"},"Holiday",-1)]),2),s("div",{class:U(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":f.value==="WEEKEND"}]),onClick:e[6]||(e[6]=t=>f.value="WEEKEND")},[s("div",{class:"w-5 h-5 rounded",style:j({backgroundColor:E.value.WEEKEND})},null,4),e[12]||(e[12]=s("span",{class:"text-sm"},"Weekend",-1))],2)]),s("div",{class:"mb-4 flex gap-4"},[s("button",{onClick:ee,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),s("button",{onClick:te,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),s("div",Ce,[s("table",_e,[s("thead",Fe,[s("tr",null,[e[13]||(e[13]=s("th",{class:"border p-2"},"Emp ID",-1)),e[14]||(e[14]=s("th",{class:"border p-2"},"Name",-1)),e[15]||(e[15]=s("th",{class:"border p-2"},"Action",-1)),(u(!0),r(x,null,D(B.value,t=>(u(),r("th",{key:t,class:"border text-center p-1 w-10"},[P(g(t)+" ",1),s("div",Ae,g(J(t)),1)]))),128))])]),s("tbody",null,[(u(!0),r(x,null,D(se.value,t=>(u(),r("tr",{key:t.id},[s("td",Ne,[_(s("input",{type:"checkbox",class:"mr-2",value:t.id,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value=a)},null,8,Me),[[ie,c.value]]),P(" "+g(t.code),1)]),s("td",Ve,g(t.name),1),s("td",We,[s("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:a=>R(t.id)}," Apply to All Dates ",8,$e)]),(u(!0),r(x,null,D(B.value,a=>(u(),r("td",{key:a,class:"border text-center cursor-pointer",onClick:o=>Z(t.id,a)},[s("div",{title:X(t.id,a),style:j(Q(t.id,a)),class:"w-full h-6"},null,12,Ke)],8,Be))),128))]))),128))])])]),s("div",{class:"mb-4 flex justify-center mt-4"},[s("button",{onClick:le,class:"btn-2"},"ðŸ’¾ Save Schedule")])]))}},qe=he(Ye,[["__scopeId","data-v-65185f4d"]]);export{qe as default};
