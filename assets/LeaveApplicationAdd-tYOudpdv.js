import{u as Q,g as X,r as _,D as Z,x as b,h as ee,q as H,aa as te,p as ae,c as m,o as u,a as t,i as se,d as j,l as le,b as k,w as oe,j as y,k as g,v as D,t as p,F as E,e as F,s as L,m as z,ad as A}from"./index-RrCjYlRB.js";import{L as ne}from"./LoaderView-DRhDy6zl.js";import{_ as re}from"./MultiselectDropdown-BDc3Zx0c.js";import{u as de}from"./holiday-BXBCa4pg.js";import{u as ie}from"./leave-application-DYwDphFf.js";import{u as ue}from"./leave-type-CAPD8KCx.js";import{u as me}from"./user-BJcisL-J.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"my-container max-w-4xl space-y-6"},ce={class:"rounded-2xl border border-slate-200 bg-white/80 p-4 shadow-sm md:p-6"},ve={class:"flex flex-wrap items-center justify-between gap-3"},fe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},be={key:0,class:"rounded-lg bg-blue-50 p-3 text-sm text-blue-700"},ge={key:1,class:"grid gap-3 rounded-xl border border-slate-100 bg-slate-50 p-4 sm:grid-cols-2 lg:grid-cols-4"},we={class:"rounded-lg bg-white p-3 shadow-sm"},ye={class:"text-2xl font-semibold text-slate-800"},xe={class:"rounded-lg bg-white p-3 shadow-sm"},_e={class:"text-xl font-semibold text-slate-800"},he={class:"rounded-lg bg-white p-3 shadow-sm"},ke={class:"text-xl font-semibold text-slate-800"},De={class:"rounded-lg bg-white p-3 shadow-sm"},Le={class:"text-xl font-semibold text-amber-600"},Ue={key:2,class:"flex items-start gap-3 rounded-lg border border-amber-200 bg-amber-50/80 p-4 text-amber-800 shadow-sm"},Se={class:"text-sm"},Te={key:3,class:"space-y-4"},Ve={class:"max-h-[28rem] space-y-3 overflow-y-auto pr-1"},Ae={class:"flex flex-wrap items-center justify-between gap-3"},Be={class:"font-semibold text-slate-900"},Me={class:"mt-1 flex flex-wrap gap-2"},Ne=["name","value","onUpdate:modelValue","disabled"],Re=["name","onUpdate:modelValue"],We=["name","onUpdate:modelValue"],Ce={class:"space-y-1"},He={class:"space-y-1"},je={class:"space-y-1"},Ee={key:4,class:"flex items-start gap-3 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700 shadow-sm"},Fe={class:"flex-1 text-sm leading-5"},ze={class:"mt-0.5"},Qe={__name:"LeaveApplicationAdd",setup($e){const B=Q(),$=ie(),i=X();ue();const f=me(),M=de(),U=_(""),{userLeaveBalance:x}=Z(f),d=_({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),n=_([]),S=_(!1),h=_(null),T=b(()=>{const a={};return n.value.forEach(e=>{typeof e=="number"&&(a[e]=(a[e]||0)+1)}),a}),V=a=>{const e=Number(a==null?void 0:a.remaining_days);return Number.isFinite(e)?e:1/0},N=b(()=>{var a;return(a=x.value)!=null&&a.length?x.value.map(e=>{const r=T.value[e.id]||0,o=V(e);return{id:e.id,name:e.name,used:r,remain:o}}).filter(e=>e.remain!==1/0&&e.used>e.remain):[]}),R=b(()=>N.value.length?`You have exceeded remaining days for: ${N.value.map(e=>e.name).join(", ")}`:""),w=b(()=>{const a=c.value.length;if(!a)return{total:0,weekends:0,holidays:0,assigned:0,pending:0};let e=0,r=0,o=0;n.value.forEach(l=>{l==="weekend"?e+=1:l==="holiday"?r+=1:l&&(o+=1)});const s=Math.max(a-(e+r+o),0);return{total:a,weekends:e,holidays:r,assigned:o,pending:s}}),q=a=>new Date(a).toLocaleString("en-us",{weekday:"long"}),I=a=>{const e=x.value.find(r=>r.id===a);return(e==null?void 0:e.name)||""},P=a=>{const e=V(a);if(e===1/0)return"∞";const r=T.value[a.id]||0;return Math.max(e-r,0)},W=(a,e)=>{const r=V(a);return r===1/0||e===a.id?!1:(T.value[a.id]||0)>=r};ee(async()=>{var a;try{(a=i==null?void 0:i.user)!=null&&a.id&&f.userLeaveBalance.length===0&&await f.fetchUserLeaveBalances(i.user.id),await f.fetchTypeWiseEmployees({except:"auth"})}catch(e){console.error("Error while initializing leave form:",e)}}),H(()=>{var a;return(a=i.user)==null?void 0:a.id},async a=>{a&&f.userLeaveBalance.length===0&&await f.fetchUserLeaveBalances(a)});const Y=b(()=>{var a,e,r;return((e=(a=i==null?void 0:i.user)==null?void 0:a.assign_weekend)==null?void 0:e.weekends)||((r=i==null?void 0:i.user)==null?void 0:r.weekends)}),c=b(()=>{const a=d.value.last_working_date,e=d.value.resumption_date;if(!a||!e)return[];const r=new Date(a),o=new Date(e);if(o<=r)return[];const s=[];let l=new Date(r);for(l.setDate(l.getDate()+1);l<o;){const v=l.getFullYear(),G=(l.getMonth()+1).toString().padStart(2,"0"),K=l.getDate().toString().padStart(2,"0");s.push(`${v}-${G}-${K}`),l.setDate(l.getDate()+1)}return s}),C=b(()=>{const a=d.value.last_working_date,e=d.value.resumption_date;if(!a||!e)return"";const r=new Date(a);return new Date(e)<=r?"Resumption date must be after Last Working Date.":c.value.length===0?"No leave days between the selected dates.":null});te(async()=>{var a;c.value.length&&x.value.length&&(await M.fetchHolidays({company_id:(a=i==null?void 0:i.user)==null?void 0:a.company_id,start_date:c.value[0],end_date:c.value[c.value.length-1]}),c.value.forEach(async(e,r)=>{const o=new Date(e).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),s=o.charAt(0).toUpperCase()+o.slice(1);Y.value.includes(s)&&(n.value[r]="weekend"),M.holidayDates.includes(e)&&(n.value[r]="holiday")}))}),H(()=>U.value,a=>{d.value.handover_user_id=a==null?void 0:a.id});const J=async()=>{var a;S.value=!0,h.value=null;try{const e=c.value.map((l,v)=>({date:l,leave_type_id:n.value[v]!=="weekend"&&n.value[v]!=="holiday"?n.value[v]:null})).filter(l=>l.leave_type_id!==null),r=c.value.map((l,v)=>({date:l,leave_type_id:n.value[v]||""})).filter(l=>l.leave_type_id!==null),o={user_id:(a=i==null?void 0:i.user)==null?void 0:a.id,last_working_date:d.value.last_working_date,resumption_date:d.value.resumption_date,reason:d.value.reason,works_in_hand:d.value.works_in_hand,handover_user_id:d.value.handover_user_id,leave_days:e,json_data:r},s=await $.storeLeaveApplication(o);s&&B.push({name:"LeaveApplicationShow",params:{id:s==null?void 0:s.id}})}catch(e){h.value=e.message||"Failed to submit leave application"}finally{S.value=!1}},O=()=>{B.go(-1)};return(a,e)=>{const r=ae("RouterLink");return u(),m("div",pe,[t("section",ce,[t("div",ve,[t("button",{class:"btn-3",onClick:O},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=t("div",{class:"text-center"},[t("h1",{class:"title-md md:title-lg"},"Leave Application"),t("p",{class:"text-xs text-slate-500 md:text-sm"}," Pick your dates, assign leave types, and tell us who is covering while you’re away. ")],-1)),j(r,{to:"/applications",class:"btn-2"},{default:le(()=>e[6]||(e[6]=[k("Home")])),_:1,__:[6]})])]),S.value?(u(),se(ne,{key:0})):(u(),m("form",{key:1,onSubmit:oe(J,["prevent"]),class:"relative space-y-6 rounded-2xl border border-slate-200 bg-white/80 p-4 pb-24 shadow-lg md:p-8 md:pb-28"},[t("div",fe,[t("div",null,[e[8]||(e[8]=t("label",{for:"last-working-date",class:"block text-sm font-medium text-slate-600"},"Last Working Date",-1)),g(t("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=o=>d.value.last_working_date=o),class:"input-1 mt-1 w-full",required:""},null,512),[[D,d.value.last_working_date]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"resumption-date",class:"block text-sm font-medium text-slate-600"},"Resumption Date",-1)),g(t("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=o=>d.value.resumption_date=o),class:"input-1 mt-1 w-full",required:""},null,512),[[D,d.value.resumption_date]])])]),d.value.last_working_date&&d.value.resumption_date&&C.value?(u(),m("div",be,p(C.value),1)):y("",!0),w.value.total?(u(),m("div",ge,[t("div",we,[e[10]||(e[10]=t("p",{class:"text-xs uppercase text-slate-400"},"Total Days",-1)),t("p",ye,p(w.value.total),1)]),t("div",xe,[e[11]||(e[11]=t("p",{class:"text-xs uppercase text-slate-400"},"Assigned",-1)),t("p",_e,p(w.value.assigned),1)]),t("div",he,[e[12]||(e[12]=t("p",{class:"text-xs uppercase text-slate-400"},"Weekend / Holiday",-1)),t("p",ke,p(w.value.weekends+w.value.holidays),1)]),t("div",De,[e[13]||(e[13]=t("p",{class:"text-xs uppercase text-slate-400"},"Still Unassigned",-1)),t("p",Le,p(w.value.pending),1)])])):y("",!0),R.value?(u(),m("div",Ue,[e[14]||(e[14]=t("i",{class:"fas fa-info-circle mt-1 text-amber-500"},null,-1)),t("p",Se,p(R.value),1)])):y("",!0),c.value.length?(u(),m("div",Te,[e[17]||(e[17]=t("div",{class:"flex flex-wrap items-center justify-between gap-2"},[t("h2",{class:"text-lg font-semibold text-slate-700"},"Leave Days"),t("p",{class:"text-xs text-slate-500"},"Tap a badge to classify each date")],-1)),t("div",Ve,[(u(!0),m(E,null,F(c.value,(o,s)=>(u(),m("div",{key:s,class:"rounded-2xl border border-slate-100 bg-white px-3 py-2 shadow-sm transition hover:border-blue-200 hover:shadow-md"},[t("div",Ae,[t("div",null,[t("p",Be,p(o)+" ("+p(q(o))+") ",1)]),n.value[s]?(u(),m("span",{key:0,class:L(["inline-flex items-center rounded-full px-3 text-xs font-semibold",{"bg-amber-50 text-amber-700":n.value[s]==="weekend","bg-emerald-50 text-emerald-700":n.value[s]==="holiday","bg-blue-50 text-blue-700":n.value[s]!=="weekend"&&n.value[s]!=="holiday"}])},p(n.value[s]==="weekend"?"Weekend":n.value[s]==="holiday"?"Holiday":I(n.value[s])),3)):y("",!0)]),t("div",Me,[(u(!0),m(E,null,F(z(x),l=>(u(),m("label",{key:l.id,class:L(["cursor-pointer rounded-full border px-3 py-1 text-sm font-medium transition",[n.value[s]===l.id?"border-blue-500 bg-blue-50 text-blue-700":"border-slate-200 text-slate-600",W(l,n.value[s])?"cursor-not-allowed opacity-40":""]])},[g(t("input",{type:"radio",class:"sr-only",name:"leaveType-"+s,value:l.id,"onUpdate:modelValue":v=>n.value[s]=v,disabled:W(l,n.value[s])},null,8,Ne),[[A,n.value[s]]]),t("span",null,p(l.name)+" ("+p(P(l))+")",1)],2))),128)),t("label",{class:L(["cursor-pointer rounded-full px-3 py-1 text-sm font-medium transition",n.value[s]==="weekend"?"border-amber-400 bg-amber-50 text-amber-700":"border-slate-200 text-slate-600 hover:border-amber-200 hover:text-amber-700"])},[g(t("input",{type:"radio",class:"sr-only",name:"leaveType-"+s,value:"weekend","onUpdate:modelValue":l=>n.value[s]=l},null,8,Re),[[A,n.value[s]]]),e[15]||(e[15]=k(" Weekend "))],2),t("label",{class:L(["cursor-pointer rounded-full px-3 py-1 text-sm font-medium transition",n.value[s]==="holiday"?"border-emerald-400 bg-emerald-50 text-emerald-700":"border-slate-200 text-slate-600 hover:border-emerald-200 hover:text-emerald-700"])},[g(t("input",{type:"radio",class:"sr-only",name:"leaveType-"+s,value:"holiday","onUpdate:modelValue":l=>n.value[s]=l},null,8,We),[[A,n.value[s]]]),e[16]||(e[16]=k(" Holiday "))],2)])]))),128))])])):y("",!0),t("div",Ce,[e[18]||(e[18]=t("label",{for:"reason",class:"text-sm font-medium text-slate-600"},"Reason",-1)),g(t("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=o=>d.value.reason=o),class:"input-1 w-full",placeholder:"Let approvers know why you need the time off",rows:"3"},null,512),[[D,d.value.reason]])]),t("div",He,[e[19]||(e[19]=t("label",{for:"handover-user",class:"text-sm font-medium text-slate-600"},"Handover User",-1)),j(re,{modelValue:U.value,"onUpdate:modelValue":e[3]||(e[3]=o=>U.value=o),options:z(f).users,multiple:!1,label:"label",placeholder:"Search teammate",class:"z-50","top-label":"User"},null,8,["modelValue","options"])]),t("div",je,[e[20]||(e[20]=t("label",{for:"works-in-hand",class:"text-sm font-medium text-slate-600"},"Works in Hand",-1)),g(t("textarea",{id:"works-in-hand","onUpdate:modelValue":e[4]||(e[4]=o=>d.value.works_in_hand=o),class:"input-1 w-full",placeholder:"Share current deliverables so the team has context",rows:"6"},null,512),[[D,d.value.works_in_hand]])]),h.value?(u(),m("div",Ee,[e[22]||(e[22]=t("div",{class:"flex-shrink-0"},[t("i",{class:"fas fa-exclamation-triangle text-red-500"})],-1)),t("div",Fe,[e[21]||(e[21]=t("p",{class:"font-medium"},"Something went wrong!",-1)),t("p",ze,p(h.value),1)])])):y("",!0),e[23]||(e[23]=t("div",{class:"sticky inset-x-0 bottom-0 -mx-4 flex justify-end border-t border-slate-100 bg-white/95 px-4 py-4 backdrop-blur supports-[backdrop-filter]:bg-white/80 md:-mx-8 md:px-8"},[t("button",{type:"submit",class:"btn-2 inline-flex items-center gap-2 shadow-md"},[t("i",{class:"far fa-paper-plane"}),k(" Submit Application ")])],-1))],32))])}}};export{Qe as default};
