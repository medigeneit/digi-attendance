import{s as R,b as j,u as G,r as m,y as S,D as P,e as Q,A as w,c as l,o as a,m as B,f as V,a as o,l as c,p as $,g as z,C as H,F as A,x as E,t as F,h as n}from"./index-D9pNkE95.js";import{_ as J}from"./CommentModal-B6G_mGhP.js";import{O as L}from"./OverlyModal-BceE6Jgu.js";import{_ as K}from"./MultiselectDropdown-P_e2oaaj.js";import{_ as W}from"./TaskAddForm-rMwkRbeH.js";import{_ as X}from"./TaskEditForm-C4k9Bw5m.js";import{_ as Y}from"./TaskTreeView-UTjDx87d.js";import{u as Z}from"./company-C_2-KNvg.js";import{u as ee}from"./useTaskStore-aZN5S7_h.js";import"./useCommentStore-NbQlaWmA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-Bmzyn5we.js";import"./useRequirementStore-CajhLxRD.js";const te={class:"container mx-auto p-6 relative"},se={class:"mb-3"},ae={class:"flex flex-wrap items-center gap-2 mt-3"},oe={class:"flex gap-4"},le={class:"flex-shrink-0 w-full md:w-64 text-gray-600"},ne=["value"],re={key:2,class:"text-center py-4 text-gray-500"},de={key:3,class:"text-center py-4 text-red-500"},ie={key:4,class:"space-y-4"},ue=1,Ie={__name:"TaskList",setup(me){const r=ee(),v=Z(),{companies:D,employees:h}=R(v),d=j(),M=G(),k=m(!1),_=m(null),x=S(I("company-id")),g=S(I("user-id")),p=m(),i=m(null),C=m(!1),f=P({parentId:0,requirementId:0});Q(async()=>{await v.fetchCompanies(),await y()});const b=t=>{C.value=!0,f.parentId=t};function I(t){return{set:e=>{M.push({query:{...d.query,[t]:e||void 0}})},get:()=>d.query[t]||""}}const U=t=>{_.value=t,k.value=!0},N=()=>{k.value=!1,_.value=null};w(()=>x.value,async t=>{t&&(await v.fetchEmployee(t),p.value=h.value.find(e=>e.id==g.value)||null)},{initial:!0,immediate:!0}),w(()=>({"user-id":d.query["user-id"],"company-id":d.query["company-id"]}),async()=>{y()});async function y(){await r.fetchTasks({user_ids:d.query["user-id"]||void 0,company_id:d.query["company-id"]||void 0},{loadingBeforeFetch:!1})}async function T(){i.value=null,await y()}async function O(){C.value=!1,f.parentId=0,await y()}return w(p,t=>{g.value=t==null?void 0:t.id}),(t,e)=>{var q;return a(),l("div",te,[i.value?(a(),B(L,{key:0},{default:$(()=>[c(X,{taskId:i.value,class:"rounded-full",onClose:e[0]||(e[0]=s=>i.value=null),onUpdated:T},null,8,["taskId"])]),_:1})):V("",!0),C.value?(a(),B(L,{key:1},{default:$(()=>[c(W,{parentTaskId:f.parentId,requirementId:f.requirementId,class:"rounded-full",onClose:O,onCreated:T},null,8,["parentTaskId","requirementId"])]),_:1})):V("",!0),o("div",se,[e[6]||(e[6]=o("div",{class:"flex justify-between items-center"},[o("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),o("div",ae,[o("div",oe,[o("div",le,[z(o("select",{id:"company-filter","onUpdate:modelValue":e[1]||(e[1]=s=>x.value=s),class:"input-1 h-full"},[e[5]||(e[5]=o("option",{value:""},"Select Company",-1)),(a(!0),l(A,null,E(n(D),s=>(a(),l("option",{key:s.id,value:s.id},F(s.name),9,ne))),128))],512),[[H,x.value]])]),c(K,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=s=>p.value=s),options:n(h),multiple:!1,label:"name","label-prefix":"id",placeholder:"Please select employee...",class:"w-full md:w-64 text-gray-600"},null,8,["modelValue","options"])]),o("button",{onClick:b,class:"btn-1 ml-auto"},"Add Task")])]),n(r).loading?(a(),l("div",re,"Loading tasks...")):n(r).error?(a(),l("div",de,F(n(r).error),1)):(a(),l("div",ie,[(a(!0),l(A,null,E(((q=n(r))==null?void 0:q.taskListTree)||[],s=>(a(),l("div",{key:s.id,class:"rounded-lg border bg-white overflow-hidden"},[c(Y,{task:s,class:"!border-0",onCommentButtonClick:u=>U(u,s.id),onEditClick:e[3]||(e[3]=u=>i.value=u),onAddClick:e[4]||(e[4]=u=>b(u))},null,8,["task","onCommentButtonClick"])]))),128))])),c(J,{show:k.value,"commentable-id":_.value,"commentable-type":"task","user-id":ue,"on-close":N,onSubmitted:n(r).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Ie as default};
