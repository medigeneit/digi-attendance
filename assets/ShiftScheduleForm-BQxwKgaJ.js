import{Q as se,r as v,R as F,s as K,q as U,A as T,e as le,c as n,o as r,a as l,f as ae,g as _,C as j,F as y,y as b,t as g,h as I,l as oe,v as ne,x as V,n as q,P as re}from"./index-B4oGRh81.js";import{_ as ue}from"./MultiselectDropdown-CwSj4CoB.js";import{u as ie}from"./company-0SzHuuR8.js";import{u as de}from"./department-kk37dX43.js";import{u as ce}from"./shift-BxQDyErW.js";import{d as Y}from"./dayjs.min-Cbbdfn5l.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-C4rywuoe.js";const ve=se("shiftSchedule",()=>{const k=v([]);return{schedules:k,fetchSchedules:async d=>{const u=await F.get("/shift-schedules",d);return k.value=u==null?void 0:u.data,u.data},saveSchedules:async d=>{await F.post("/shift-schedules",{schedules:d==null?void 0:d.payload})},fetchDefaultSchedules:async d=>{const u=await F.get("/default-shift-schedules",d);return k.value=u==null?void 0:u.data,u.data}}}),fe={class:"p-4 max-w-[1600px] mx-auto"},he={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},me=["value"],ge=["value"],ye=["value"],be={key:0,class:"text-yellow-600 font-medium mb-2 p-2 border rounded border-black"},Se={class:"flex flex-wrap gap-3 mb-4 p-4 bg-white rounded sticky top-16"},we=["onClick"],xe={class:"text-sm"},Ee={class:"overflow-auto"},_e={class:"table-auto w-full border text-sm"},ke={class:"sticky top-0 bg-white z-10"},Ce={class:"text-xs text-gray-400"},De={class:"border p-2"},Ne=["value"],Me={class:"border p-2 whitespace-nowrap"},Ve={class:"border p-2"},We=["onClick"],Ae=["onClick"],$e=["title"],Fe={__name:"ShiftScheduleForm",setup(k){const C=ve(),S=ie(),D=ce(),d=de(),u=v(!1),{companies:L,employees:w}=K(S),{departments:Q}=K(d),{shifts:G}=K(D),f=v(Y().format("YYYY-MM")),h=v(""),W=v(""),N=v(""),c=v(""),i=v({}),p=v([]),x=v({WEEKEND:"bg-red-700"}),B=["bg-green-700","bg-pink-600","bg-blue-800","bg-cyan-600","bg-red-300","bg-purple-700","bg-yellow-500","bg-indigo-500","bg-amber-600"],M=U(()=>Object.values(G.value||{}).flat());function O(){const s=M.value;let t=0;s.forEach(e=>{x.value[e.id]=B[t%B.length],t++}),x.value.WEEKEND="bg-red-700"}const E=U(()=>Array.from({length:Y(f.value).daysInMonth()},(s,t)=>t+1)),z=s=>{const t=`${f.value}-${String(s).padStart(2,"0")}`;return Y(t).format("ddd")},H=(s,t)=>{var o,a;const e=(a=(o=i.value)==null?void 0:o[s])==null?void 0:a[t];return e?["WEEKEND"].includes(e)?x.value[e]||"bg-gray-300":x.value[parseInt(e)]||"bg-gray-300":"bg-gray-300"},J=(s,t)=>{var a,m;const e=(m=(a=i.value)==null?void 0:a[s])==null?void 0:m[t],o=M.value.find($=>$.id===e);return(o==null?void 0:o.name)||""},X=(s,t)=>{p.value.includes(parseInt(s))&&c.value&&(i.value[s]||(i.value[s]={}),i.value[s][t]=c.value)},R=s=>{p.value.includes(parseInt(s))&&c.value&&(i.value[s]||(i.value[s]={}),E.value.forEach(t=>{i.value[s][t]=c.value}))},Z=()=>{p.value.forEach(s=>{R(s)})},P=()=>{p.value.forEach(s=>{var o;const t=w.value.find(a=>a.id===parseInt(s)),e=((o=t==null?void 0:t.weekends)==null?void 0:o.map(a=>a.slice(0,3)))||[];i.value[s]||(i.value[s]={}),E.value.forEach(a=>{const m=z(a);e.includes(m)&&(i.value[s][a]="WEEKEND")})})},ee=async()=>{const s=Object.entries(i.value).flatMap(([t,e])=>p.value.includes(parseInt(t))?Object.entries(e).map(([o,a])=>({employee_id:parseInt(t),date:`${f.value}-${String(o).padStart(2,"0")}`,shift_id:a})):[]);try{await C.saveSchedules({payload:s}),alert("Shift schedule saved successfully!")}catch(t){console.error("Failed to save schedule",t),alert("Something went wrong while saving.")}};T(h,async s=>{s&&(await S.fetchEmployee(s),await d.fetchDepartments({companyId:s}),await D.fetchShifts({companyId:s}),O(),await A(s,f.value))}),T(W,async s=>{if(s){const t={companyId:h.value,departmentIds:s?[s]:[]},e=await d.fetchDepartmentEmployee(t);w.value=e,p.value=[],await A(h.value,f.value)}}),T(f,async s=>{s&&(await S.fetchEmployee(h.value),await D.fetchShifts({companyId:h.value}),O(),await A(h.value,s))});const te=U(()=>N.value?w.value.filter(s=>{var t;return s.id===parseInt((t=N.value)==null?void 0:t.id)}):w.value);le(async()=>{await S.fetchCompanies()});const A=async(s,t)=>{try{let e=await C.fetchSchedules({params:{company_id:s,month:t}});const o={};if(e.length)u.value=!1;else{const a=await C.fetchDefaultSchedules({params:{company_id:s,month:t}});console.log("[Fallback Schedule]",a),e=a,p.value=[],u.value=!0}console.log(E.value),e.forEach(a=>{!u.value&&!p.value.includes(a.employee_id)&&p.value.push(a.employee_id),c.value=a==null?void 0:a.shift_id;const m=a.employee_id,$=parseInt(a.date.split("-")[2]);o[m]||(o[m]={}),o[m][$]=a.shift_id||"WEEKEND"}),i.value=o}catch(e){console.error("Failed to load schedule data:",e)}};return(s,t)=>(r(),n("div",fe,[l("div",he,[_(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),class:"p-2 border rounded"},[t[7]||(t[7]=l("option",{value:""},"Select Company",-1)),(r(!0),n(y,null,b(I(L),e=>(r(),n("option",{key:e.id,value:e.id},g(e.name),9,me))),128))],512),[[j,h.value]]),_(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>W.value=e),class:"p-2 border rounded"},[t[8]||(t[8]=l("option",{value:""},"- Department -",-1)),(r(!0),n(y,null,b(I(Q),e=>(r(),n("option",{key:e.id,value:e.id},g(e.name),9,ge))),128))],512),[[j,W.value]]),l("div",null,[oe(ue,{modelValue:N.value,"onUpdate:modelValue":t[2]||(t[2]=e=>N.value=e),options:I(w),multiple:!1,label:"name","label-prefix":"employee_id",placeholder:"Select user"},null,8,["modelValue","options"])]),_(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>c.value=e),class:"p-2 border rounded"},[t[9]||(t[9]=l("option",{value:""},"- Shift -",-1)),(r(!0),n(y,null,b(M.value,e=>(r(),n("option",{key:e.id,value:e.id},g(e.name),9,ye))),128))],512),[[j,c.value]]),_(l("input",{type:"month","onUpdate:modelValue":t[4]||(t[4]=e=>f.value=e),class:"p-2 border rounded"},null,512),[[ne,f.value]])]),u.value?(r(),n("p",be," âš  Showing default schedule from current shift. Select employees manually before saving. ")):ae("",!0),l("div",Se,[(r(!0),n(y,null,b(M.value,e=>(r(),n("div",{key:e.id,class:V(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":c.value===e.id}]),onClick:o=>c.value=e.id},[l("div",{class:V(["w-5 h-5 rounded",x.value[e.id]||"bg-gray-300"])},null,2),l("span",xe,g(e.name),1)],10,we))),128)),l("div",{class:V(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":c.value==="WEEKEND"}]),onClick:t[5]||(t[5]=e=>c.value="WEEKEND")},t[10]||(t[10]=[l("div",{class:"w-5 h-5 rounded bg-red-700"},null,-1),l("span",{class:"text-sm"},"Weekend",-1)]),2)]),l("div",{class:"mb-4 flex gap-4"},[l("button",{onClick:Z,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),l("button",{onClick:P,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),l("div",Ee,[l("table",_e,[l("thead",ke,[l("tr",null,[t[11]||(t[11]=l("th",{class:"border p-2"},"Emp ID",-1)),t[12]||(t[12]=l("th",{class:"border p-2"},"Name",-1)),t[13]||(t[13]=l("th",{class:"border p-2"},"Action",-1)),(r(!0),n(y,null,b(E.value,e=>(r(),n("th",{key:e,class:"border text-center p-1 w-10"},[q(g(e)+" ",1),l("div",Ce,g(z(e)),1)]))),128))])]),l("tbody",null,[(r(!0),n(y,null,b(te.value,e=>(r(),n("tr",{key:e.id},[l("td",De,[_(l("input",{type:"checkbox",class:"mr-2",value:e.id,"onUpdate:modelValue":t[6]||(t[6]=o=>p.value=o)},null,8,Ne),[[re,p.value]]),q(" "+g(e.code),1)]),l("td",Me,g(e.name),1),l("td",Ve,[l("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:o=>R(e.id)}," Apply to All Dates ",8,We)]),(r(!0),n(y,null,b(E.value,o=>(r(),n("td",{key:o,class:"border text-center cursor-pointer",onClick:a=>X(e.id,o)},[l("div",{title:J(e.id,o),class:V([H(e.id,o),"w-full h-6"])},null,10,$e)],8,Ae))),128))]))),128))])])]),l("div",{class:"mb-4 mt-4"},[l("button",{onClick:ee,class:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow"}," ðŸ’¾ Save Schedule ")])]))}},ze=pe(Fe,[["__scopeId","data-v-e7523623"]]);export{ze as default};
