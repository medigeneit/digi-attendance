import{r as p,G as se,x as y,h as ne,y as oe,q as le,c as d,o as i,N as re,i as ie,a as c,d as C,M as A,j as g,t as v,l as de,O as ce,F as P,e as ue,b as me,T as ve,Y as pe,V as ge,A as be}from"./index-rim-Johs.js";import{u as fe}from"./user-BXd-M3xm.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const he={class:"flex items-start gap-2"},ye={class:"leading-tight"},xe={class:"font-medium text-gray-800"},we={key:0,class:"text-xs text-gray-500"},ke={class:"flex items-start gap-3"},Te={class:"flex-1 min-w-0"},Be={class:"font-semibold text-gray-900 leading-tight truncate"},Ue={class:"text-xs text-gray-500 leading-tight"},Le={key:0},Se={key:1,class:"mx-1"},Ee={key:2},Me={key:0,class:"text-[11px] text-gray-500"},$e={class:"mt-3 grid grid-cols-[110px_1fr] gap-x-3 gap-y-1 text-xs"},Ce={class:"text-gray-500"},De={class:"text-gray-800 font-medium truncate"},He={key:0,class:"mt-3"},Ie=["href"],Fe={key:1,class:"mt-2 text-[11px] text-indigo-600"},Re={key:2,class:"mt-2 text-[11px] text-red-600"},ze=120,Ne={__name:"UserHoverBubble",props:{user:{type:Object,default:()=>({})}},setup(V){const b=V,O=fe(),x=p(!1),w=p(!1),f=p(""),S=p(null),E=p(!1),D=p(null),H=p({}),I=p(null),u=se({trigger:!1,bubble:!1});let k=null;const F=new Date,W=`${F.getFullYear()}-${String(F.getMonth()+1).padStart(2,"0")}`,_=()=>{k&&(clearTimeout(k),k=null)},j={executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},n=y(()=>({...b.user||{},...S.value||{}})),T=y(()=>{var e,t;return j[(e=n.value)==null?void 0:e.line_type]||((t=n.value)==null?void 0:t.line_type)||""}),R=y(()=>{var l,r,m;const e=n.value||{},t=(e==null?void 0:e.id)||(e==null?void 0:e.user_id)||(e==null?void 0:e.employee_id);if(!t)return"";const o=((l=e==null?void 0:e.department)==null?void 0:l.id)||(e==null?void 0:e.department_id),s=((m=(r=e==null?void 0:e.department)==null?void 0:r.company)==null?void 0:m.id)||(e==null?void 0:e.company_id),a=new URLSearchParams;return o&&a.set("department_id",o),s&&a.set("company_id",s),a.set("employee_id",t),a.set("date",W),`/hrd/em-attendance?${a.toString()}`}),q=y(()=>{var o,s,a,l,r;const e=n.value||{};return[{label:"Employee ID",value:e.employee_id||e.employeeId||e.id},{label:"Email",value:e.email},{label:"Phone",value:e.phone||e.contact_number||e.mobile},{label:"Designation",value:(o=e.designation)==null?void 0:o.name},{label:"Department",value:(s=e.department)==null?void 0:s.name},{label:"Company",value:((l=(a=e.department)==null?void 0:a.company)==null?void 0:l.name)||((r=e.company)==null?void 0:r.name)},{label:"Line Type",value:T.value}].map(m=>({...m,value:m.value||"-"}))}),Y=y(()=>{var t,o,s,a,l,r;if(!((t=b.user)!=null&&t.id))return!1;const e=n.value||{};return!e.email||!(e.phone||e.contact_number||e.mobile)||!((o=e.department)!=null&&o.name)||!((s=e.designation)!=null&&s.name)||!((l=(a=e.department)==null?void 0:a.company)!=null&&l.name||(r=e.company)!=null&&r.name)}),G=()=>{S.value=null,E.value=!1,f.value=""},J=async()=>{var e;if(!(!Y.value||!((e=b.user)!=null&&e.id)||E.value||w.value)){w.value=!0,f.value="";try{const t=await O.fetchUser(b.user.id);t&&(S.value=t),E.value=!0}catch{f.value="Unable to load full profile right now."}finally{w.value=!1}}},z=()=>{var h;const e=D.value;if(!e)return;const t=e.getBoundingClientRect(),o=320,s=12,a=((h=I.value)==null?void 0:h.offsetHeight)||0,l=window.innerHeight-t.bottom-8,r=t.top-8,m=a&&a>l&&r>l,U=Math.min(Math.max(t.left,s),window.innerWidth-o-s),L=m?t.top-a-8:t.bottom+8;H.value={top:`${Math.max(L,s)}px`,left:`${U}px`,width:`${Math.min(o,window.innerWidth-s*2)}px`}},N=async()=>{x.value=!0,await be(),z(),await J()},K=()=>{x.value=!1},M=()=>{u.trigger||u.bubble||(_(),k=setTimeout(()=>{!u.trigger&&!u.bubble&&K()},ze))},B=()=>{x.value&&z()};ne(()=>{window.addEventListener("resize",B),window.addEventListener("scroll",B,!0)}),oe(()=>{window.removeEventListener("resize",B),window.removeEventListener("scroll",B,!0),_()}),le(()=>{var e;return(e=b.user)==null?void 0:e.id},()=>{G()});const Q=()=>{_(),u.trigger=!0,N()},X=()=>{u.trigger=!1,M()},Z=()=>{_(),u.trigger=!0,N()},ee=()=>{u.trigger=!1,M()},te=()=>{_(),u.bubble=!0},ae=()=>{u.bubble=!1,M()};return(e,t)=>(i(),d("div",ge({class:"relative flex items-start"},e.$attrs,{onMouseenter:Q,onMouseleave:X,onFocusin:Z,onFocusout:ee,ref_key:"triggerRef",ref:D}),[re(e.$slots,"trigger",{user:n.value},()=>{var o,s,a,l,r;return[c("div",he,[C(A,{size:"medium",user:n.value,class:"inline-block align-middle"},null,8,["user"]),c("div",ye,[c("div",xe,v(((o=n.value)==null?void 0:o.name)||"Unknown user"),1),(a=(s=n.value)==null?void 0:s.department)!=null&&a.name?(i(),d("div",we,v((r=(l=n.value)==null?void 0:l.department)==null?void 0:r.name),1)):g("",!0)])])]},!0),(i(),ie(pe,{to:"body"},[C(ve,{name:"fade-scale"},{default:de(()=>{var o,s,a,l,r,m,U,L,h;return[x.value?(i(),d("div",{key:0,class:"fixed z-50 rounded-xl border border-gray-200 bg-white p-4 shadow-xl",style:ce(H.value),ref_key:"bubbleRef",ref:I,onMouseenter:te,onMouseleave:ae},[c("div",ke,[C(A,{user:n.value,size:"xlarge"},null,8,["user"]),c("div",Te,[c("div",Be,v(((o=n.value)==null?void 0:o.name)||"Unknown user"),1),c("div",Ue,[(a=(s=n.value)==null?void 0:s.designation)!=null&&a.name?(i(),d("span",Le,v((r=(l=n.value)==null?void 0:l.designation)==null?void 0:r.name),1)):g("",!0),(U=(m=n.value)==null?void 0:m.designation)!=null&&U.name&&T.value?(i(),d("span",Se," • ")):g("",!0),T.value?(i(),d("span",Ee,v(T.value),1)):g("",!0)]),(L=n.value)!=null&&L.employee_id?(i(),d("div",Me," ID: "+v((h=n.value)==null?void 0:h.employee_id),1)):g("",!0)])]),c("dl",$e,[(i(!0),d(P,null,ue(q.value,$=>(i(),d(P,{key:$.label},[c("dt",Ce,v($.label),1),c("dd",De,v($.value),1)],64))),128))]),R.value?(i(),d("div",He,[c("a",{href:R.value,target:"_blank",rel:"noopener",class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md shadow-sm"},t[0]||(t[0]=[c("i",{class:"far fa-external-link-alt"},null,-1),me(" Open Job Card ")]),8,Ie)])):g("",!0),w.value?(i(),d("div",Fe," Loading more details… ")):f.value?(i(),d("div",Re,v(f.value),1)):g("",!0)],36)):g("",!0)]}),_:1})]))],16))}},Oe=_e(Ne,[["__scopeId","data-v-a98fab14"]]);export{Oe as U};
