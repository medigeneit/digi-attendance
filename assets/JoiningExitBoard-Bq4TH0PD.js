import{b as E,u as P,z as K,A,c as S,o as h,n as Q,a as n,k as j,J as Z,P as G,r as y,x as F,Q as q,g as V,h as z,v as H,q as M,B as W,j as L,t as T,F as X,y as ee,M as D,e as te,f as ne}from"./index-BRRNElZb.js";import{_ as se}from"./EmployeeFilter-B0VbbMpq.js";import"./company-Bhcz6yah.js";import"./department-D6h550-H.js";import"./EmployeeDropdownInput-aJmnit59.js";import"./SelectDropdown-knYUWSIs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-C9f1zGDf.js";const ae={class:"flex flex-wrap items-end gap-3"},le={__name:"BoardFilters",props:{modelValue:{type:Object,required:!0},companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(O,{emit:i}){const x=O,_=i,f=E(),v=P(),b={type:"joining"},w=(r={})=>({type:r.type??b.type,company_id:r.companyId??null,department_id:r.departmentId??null,employee_id:r.employeeId??null,line_type:r.lineType??null}),c=(r={})=>({type:r.type??b.type,companyId:r.company_id??null,departmentId:r.department_id??null,employeeId:r.employee_id??null,lineType:r.line_type??null}),a=K(w(x.modelValue));let o=!1;function u(){o||_("update:modelValue",{...c(a)})}const I=["type","company_id","department_id","employee_id","line_type"],k=r=>r===""||r===null||r===void 0||r==="all";function l(){const r={};return!k(a.type)&&String(a.type)!==b.type&&(r.type=String(a.type)),k(a.company_id)||(r.company_id=String(a.company_id)),k(a.department_id)||(r.department_id=String(a.department_id)),k(a.employee_id)||(r.employee_id=String(a.employee_id)),k(a.line_type)||(r.line_type=String(a.line_type)),r}function s(r={}){const p={...f.query};for(const C of I)delete p[C];const m={...p,...l(),...r};for(const C of Object.keys(m)){const $=m[C];($===""||$===null||$===void 0)&&delete m[C]}return m}let t=null;function B({replace:r=!0,partial:p={},debounce:m=150}={}){t&&clearTimeout(t),t=setTimeout(()=>{const C=s(p);(r?v.replace({query:C}):v.push({query:C})).catch(()=>{})},m)}function N(){const r={...c(a)};_("submit",r),B({replace:!0,debounce:0})}return A(()=>x.modelValue,r=>{const p=w(r||{});let m=!1;for(const C of Object.keys(p))if(a[C]!==p[C]){m=!0;break}m&&(o=!0,Object.assign(a,p),Z(()=>{o=!1}))},{deep:!0}),A(()=>[a.type,a.company_id,a.department_id,a.employee_id,a.line_type],()=>{u(),B({replace:!0,debounce:150})}),(r,p)=>(h(),S("div",ae,[Q(se,{company_id:a.company_id,"onUpdate:company_id":p[0]||(p[0]=m=>a.company_id=m),department_id:a.department_id,"onUpdate:department_id":p[1]||(p[1]=m=>a.department_id=m),employee_id:a.employee_id,"onUpdate:employee_id":p[2]||(p[2]=m=>a.employee_id=m),line_type:a.line_type,"onUpdate:line_type":p[3]||(p[3]=m=>a.line_type=m),"with-type":!0,"initial-value":j(f).query,companies:O.companies,departments:O.departments,onFilterChange:p[4]||(p[4]=m=>{Object.assign(a,m)})},null,8,["company_id","department_id","employee_id","line_type","initial-value","companies","departments"]),n("button",{class:"btn-2 py-1",onClick:N}," Apply ")]))}},R=G("checklistBoard",()=>{const O=y(!1),i=y(null),x=y("joining"),_=y(null),f=y(null),v=y(""),b=y([]),w=y([]),c=y(Object.create(null)),a=y(null),o=e=>typeof e=="string"?e.toLowerCase():"",u=e=>Array.isArray(e)?e:[],I=e=>{var d;return((d=e==null?void 0:e.data)==null?void 0:d.data)??(e==null?void 0:e.data)},k=e=>{var d,g;return((d=e==null?void 0:e.company)==null?void 0:d.name)||(e==null?void 0:e.company_name)||((g=e==null?void 0:e.organization)==null?void 0:g.name)||"—"},l=e=>{var d,g;return((d=e==null?void 0:e.department)==null?void 0:d.name)||((g=e==null?void 0:e.dept)==null?void 0:g.name)||(e==null?void 0:e.department_name)||"—"},s=e=>{var d;return((d=e==null?void 0:e.position)==null?void 0:d.title)||(e==null?void 0:e.designation)||"—"},t=(e={})=>{const d={type:x.value||void 0,company_id:_.value||void 0,department_id:f.value||void 0,search:(v.value||"").trim()||void 0,template_id:N.value||void 0};return Object.keys(d).forEach(g=>(d[g]==null||d[g]==="")&&delete d[g]),{...d,...e}},B=F(()=>{const e=o(x.value);return b.value.find(d=>o(d==null?void 0:d.type)===e)||null}),N=F(()=>{var e;return((e=B.value)==null?void 0:e.id)??null});async function r(e={}){try{const d=await q.get("/checklist-templates",{params:e});b.value=u(I(d))}catch(d){throw b.value=[],i.value=d,d}}async function p(e={}){if(a.value)try{await a.value}catch{}O.value=!0,i.value=null;const d=t(e),g=(async()=>{try{const U=await q.get("/users-checklists",{params:d});w.value=u(I(U))}catch(U){throw w.value=[],i.value=U,U}finally{O.value=!1,a.value=null}})();return a.value=g,g}async function m({withUsers:e=!0,templateParams:d={},userParams:g={}}={}){O.value=!0,i.value=null;try{b.value.length||await r(d),e&&await p(g)}catch(U){throw i.value=U,U}finally{O.value=!1}}function C(e){w.value=u(e)}function $(e={}){"type"in e&&(x.value=e.type),"companyId"in e&&(_.value=e.companyId),"departmentId"in e&&(f.value=e.departmentId),"search"in e&&(v.value=e.search)}function J(){x.value="joining",_.value=null,f.value=null,v.value=""}function Y(){c.value=Object.create(null)}return{loading:O,error:i,type:x,companyId:_,departmentId:f,search:v,templates:b,users:w,rows:c,templateByType:B,templateId:N,companyNameOf:k,departmentNameOf:l,positionTitleOf:s,loadBoard:m,loadTemplates:r,loadUsers:p,setUsers:C,setFilters:$,resetFilters:J,clearRowCache:Y}}),oe={class:"space-y-6"},re={class:"flex flex-wrap items-center gap-3"},ie={class:"relative"},de={class:"flex items-center gap-2"},ce={class:"rounded-lg border p-1 text-xs"},pe={class:"rounded-lg border p-1 text-xs"},me={class:"ml-auto"},ue={class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs text-blue-700",title:"You must select a template to create/open checklists"},ye={class:"ml-1 font-medium"},_e={class:"overflow-x-auto rounded-xl border shadow-sm"},fe={class:"min-w-full text-sm"},ve={class:"p-2"},ge={class:"p-3"},he={class:"flex items-center gap-3"},xe=["title"],be=["src"],we={key:1},Ie={class:"font-medium leading-tight"},ke={class:"text-xs text-gray-500"},Te={key:0,class:"mr-2"},Se={class:"hidden sm:inline"},Be={class:"p-3"},Ce=["title"],Oe={class:"p-3"},je={class:"relative w-full rounded-full bg-gray-200 h-2 overflow-hidden"},Ue=["title"],$e={class:"mt-1 flex items-center justify-between text-xs text-gray-600"},Ne={class:"p-3"},Ve={class:"p-3"},Me=["disabled","title","onClick"],Ae={key:0,class:"text-gray-600"},Fe={key:1,class:"rounded-xl border border-dashed p-10 text-center text-sm text-gray-500"},Le={__name:"ChecklistBoardTable",setup(O){const i=R(),x=P(),_=y(""),f=y(!1),v=y("progress_desc"),b=l=>i.rows[String(l.id)]||{},w=(l,s,t)=>Math.min(Math.max(Number(l||0),s),t),c=l=>{const t=b(l).percent??(l==null?void 0:l.percent)??0;return w(t,0,100)},a=l=>{var t;const s=((t=l==null?void 0:l.checklist)==null?void 0:t.required_completion_percent)??100;return w(s,1,100)},o=l=>{const s=c(l),t=a(l);return s>=t?"completed":s>0?"in_progress":"not_started"},u=l=>{const s=B=>String(B||"").toLowerCase(),t=s(_.value);return t?[l.name,l.employee_id,l.department,l.designation].some(B=>s(B).includes(t)):!0};function I(l){const s=i.templateId;s&&x.push({name:"checklist.create",params:{userId:l.id,templateId:s}})}const k=F(()=>{let l=(i.users||[]).filter(u);return f.value&&(l=l.filter(s=>c(s)<a(s))),v.value==="name_asc"?l=[...l].sort((s,t)=>(s.name||"").localeCompare(t.name||"")):v.value==="progress_asc"?l=[...l].sort((s,t)=>c(s)-c(t)):l=[...l].sort((s,t)=>c(t)-c(s)),l});return(l,s)=>(h(),S("div",oe,[n("div",re,[n("div",ie,[z(n("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>_.value=t),type:"search",placeholder:"Search name / ID / dept / designation…",class:"w-72 max-w-full rounded-lg border bg-white/90 px-9 py-2 text-sm outline-none ring-0 focus:border-gray-400"},null,512),[[H,_.value]]),s[5]||(s[5]=n("svg",{class:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M12.9 14.32a8 8 0 111.414-1.414l3.387 3.387a1 1 0 01-1.414 1.414L12.9 14.32zM14 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1)),_.value?(h(),S("button",{key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",onClick:s[1]||(s[1]=t=>_.value="")},"✕")):V("",!0)]),n("div",de,[n("div",ce,[n("button",{class:M(["rounded-md px-2 py-1",f.value?"":"bg-gray-900 text-white"]),onClick:s[2]||(s[2]=t=>f.value=!1)},"All",2),n("button",{class:M(["rounded-md px-2 py-1",f.value?"bg-gray-900 text-white":""]),onClick:s[3]||(s[3]=t=>f.value=!0),title:"Show only users who are below their required target"},"Only Missing",2)]),n("div",pe,[z(n("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>v.value=t),class:"rounded-md px-2 py-1 outline-none"},s[6]||(s[6]=[n("option",{value:"progress_desc"},"Sort: Progress ↓",-1),n("option",{value:"progress_asc"},"Sort: Progress ↑",-1),n("option",{value:"name_asc"},"Sort: Name A–Z",-1)]),512),[[W,v.value]])])]),n("div",me,[n("span",ue,[s[7]||(s[7]=L(" Template: ")),n("span",ye,T(j(i).templateId||"Not selected"),1)])])]),n("div",_e,[n("table",fe,[s[8]||(s[8]=n("thead",{class:"sticky top-0 bg-gray-50/90 backdrop-blur"},[n("tr",{class:"text-left border-b"},[n("th",{class:"p-2"},"#"),n("th",{class:"p-2 min-w-[220px]"},"User"),n("th",{class:"p-2 min-w-[180px]"},"Position"),n("th",{class:"p-2 w-72"},"Progress"),n("th",{class:"p-2 w-28"},"Status"),n("th",{class:"p-2 w-40"},"Actions")])],-1)),n("tbody",null,[(h(!0),S(X,null,ee(k.value,(t,B)=>(h(),S("tr",{key:B,class:"border-b hover:bg-gray-50"},[n("td",ve,T(B+=1),1),n("td",ge,[n("div",he,[n("div",{class:"flex h-9 w-9 shrink-0 items-center justify-center rounded-full bg-gray-200 text-xs font-semibold text-gray-700",title:t.name},[t.avatar?(h(),S("img",{key:0,src:t.avatar,alt:"",class:"h-9 w-9 rounded-full object-cover"},null,8,be)):(h(),S("span",we,T((t.name||t.full_name||t.email||"??").slice(0,2).toUpperCase()),1))],8,xe),n("div",null,[n("div",Ie,T(t.name||t.full_name||t.email),1),n("div",ke,[t.employee_id?(h(),S("span",Te,"ID: "+T(t.employee_id),1)):V("",!0),n("span",Se,"Dept: "+T(t.department),1)])])])]),n("td",Be,[n("div",{class:"truncate",title:t.designation},T(t.designation||"—"),9,Ce)]),n("td",Oe,[n("div",je,[n("div",{class:"pointer-events-none absolute top-0 h-2 w-0.5 bg-gray-600/60",style:D({left:`calc(${a(t)}% - 1px)`}),title:`Target ${a(t)}%`},null,12,Ue),n("div",{class:"h-2 bg-green-500",style:D({width:c(t)+"%"})},null,4)]),n("div",$e,[n("span",null,"Actual: "+T(c(t))+"%",1),n("span",null,"Target: "+T(a(t))+"%",1)])]),n("td",Ne,[n("span",{class:M(["inline-flex items-center rounded-full px-2 py-0.5 text-xs capitalize",{"bg-green-100 text-green-700":o(t)==="completed","bg-amber-100 text-amber-700":o(t)==="in_progress","bg-gray-100 text-gray-700":o(t)==="not_started"}])},T(o(t)),3)]),n("td",Ve,[n("button",{class:"btn-2 py-1",disabled:!j(i).templateId,title:j(i).templateId?"":"Select a template first",onClick:N=>I(t)},T(t!=null&&t.checklist?"Open":"Create"),9,Me)])]))),128))])])]),j(i).loading?(h(),S("div",Ae,"Loading…")):!j(i).loading&&k.value.length===0?(h(),S("div",Fe," No users found for the current filters. ")):V("",!0)]))}},Pe={class:"p-6 space-y-6"},qe={class:"flex items-center justify-between"},ze={class:"text-2xl font-semibold"},De={class:"text-gray-500"},Ee={key:0,class:"text-gray-600"},Qe={key:1,class:"text-red-600"},Xe={__name:"JoiningExitBoard",setup(O){const i=R(),x=E(),_=P(),f=y([]),v=y([]),b=(o={})=>({type:o.type??i.type,companyId:o.company_id?Number(o.company_id):null,departmentId:o.department_id?Number(o.department_id):null,employeeId:o.employee_id?Number(o.employee_id):null,lineType:o.line_type??null,search:o.search??i.search}),w=(o={})=>{const u={type:o.type||void 0,company_id:o.companyId||void 0,department_id:o.departmentId||void 0,employee_id:o.employeeId||void 0,line_type:o.lineType||void 0,search:o.search||void 0};return Object.keys(u).forEach(I=>(u[I]==null||u[I]==="")&&delete u[I]),u},c=y({type:i.type,companyId:i.companyId,departmentId:i.departmentId,employeeId:null,lineType:null,search:i.search});A(c,o=>{i.type=o.type,i.companyId=o.companyId??null,i.departmentId=o.departmentId??null,i.search=o.search??"",_.replace({query:{...x.query,...w(o)}})},{deep:!0,immediate:!0});async function a(){await i.loadUsers({type:c.value.type,company_id:c.value.companyId,department_id:c.value.departmentId,employee_id:c.value.employeeId,line_type:c.value.lineType,search:c.value.search})}return te(async()=>{Object.assign(c.value,b(x.query)),await i.loadBoard({withUsers:!0,userParams:w(c.value)})}),(o,u)=>{var I,k;return h(),S("div",Pe,[n("div",qe,[n("h1",ze,[n("b",null,T(((I=j(i).templateByType)==null?void 0:I.name)||"—"),1),u[1]||(u[1]=L(" Board"))]),n("div",De,[u[2]||(u[2]=L(" Template: ")),n("b",null,T(((k=j(i).templateByType)==null?void 0:k.name)||"—"),1)])]),Q(le,{modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=l=>c.value=l),companies:f.value,departments:v.value,onSubmit:a},null,8,["modelValue","companies","departments"]),j(i).loading?(h(),S("div",Ee,"Loading…")):j(i).error?(h(),S("div",Qe,"Failed to load.")):(h(),ne(Le,{key:2}))])}}};export{Xe as default};
