import{P as L,r as f,x as d,Q as i}from"./index-3qC0V9yO.js";const M=L("task",()=>{const o=f([]),k=f([]),h=f(null),u=f(!1),n=f(null),T=f(1),m=f(!0),$=async(e,l,{updateStoreData:a=!0})=>{var s,r;a==!0&&(u.value=!0,n.value=null);try{await i.post(`/tasks/${e}/assign-users`,{user_ids:l}),await p(e)}catch(t){throw a==!0&&(n.value=((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Assign users failed"),t}finally{a==!0&&(u.value=!1)}};function _(){T.value=1,o.value=[]}async function E(e,l={}){var a,s,r;n.value=null;try{const t={...e,per_page:5e3};u.value=!0;const c=await i.get("/tasks",{params:t,...l});return o.value=((a=c.data)==null?void 0:a.tasks)||[],u.value=!1,c.data}catch(t){throw n.value=((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",t}}const O=async(e,l)=>{var a,s,r;n.value=null;try{const t=await i.get("/my-tasks",{params:e,...l});return o.value=((a=t.data)==null?void 0:a.tasks)||[],t.data}catch(t){throw n.value=((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",t),t}};function y(e,l=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>(a==null?void 0:a.parent_id)===l).map(a=>({...a,children_tasks:y(e,a.id)}))}function g(){return y(o.value,0)}function P(){const e=[],l=(a,s=0,r="")=>{a.forEach(t=>{e.push({...t,depth:s,idPath:r+t.id}),t.children_tasks&&t.children_tasks.length&&l(t.children_tasks,s+1,r+t.id+"-")})};return l(g()),e}const p=async(e,l={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var s,r,t,c;a.fetchOnly||(u.value=!0),n.value=null;try{const v=await i.get(`/tasks/${e}`,{params:l});return a.fetchOnly||(h.value=((s=v.data)==null?void 0:s.task)||{},k.value=((r=v.data)==null?void 0:r.todos)||{},o.value=v.data.sub_tasks||[]),v.data}catch(v){const w=((c=(t=v.response)==null?void 0:t.data)==null?void 0:c.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(n.value=w),w}finally{a.fetchOnly||(u.value=!1)}},x=async(e,l={loadingBeforeCreate:!1})=>{var a,s,r,t;l.loadingBeforeCreate&&(u.value=!0),n.value=null;try{const c=await i.post("/tasks",e);return(a=c.data)!=null&&a.data&&o.value.push((s=c.data)==null?void 0:s.data),c.data.data}catch(c){throw n.value=((t=(r=c.response)==null?void 0:r.data)==null?void 0:t.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",c),c}finally{l.loadingBeforeCreate&&(u.value=!1)}},C=async(e,l,{loadingBeforeFetch:a=!0})=>{a&&(u.value=!0),n.value=null;try{const s=await i.put(`/tasks/${e}`,l),r=o.value.findIndex(t=>t.id===e);return r!==-1&&(o.value[r]=s.data.data),s.data.data}catch(s){throw s}finally{a&&(u.value=!1)}},q=async(e,l)=>(await i.put(`/tasks/${e}/update-priorities`,{task_ids:l})).data,A=async e=>{var l,a;u.value=!0,n.value=null;try{await i.delete(`/tasks/${e}`),o.value=o.value.filter(s=>s.id!==e)}catch(s){throw n.value=((a=(l=s.response)==null?void 0:l.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,s),s}finally{u.value=!1}},B=async(e,l)=>{var a,s;u.value=!0,n.value=null;try{await i.patch(`/tasks/${e}/update-requirement-detail/${l}`),o.value=o.value.filter(r=>r.id!==e)}catch(r){throw n.value=((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.message)||`টাস্ক (ID: ${e}) রেকয়্যারমেন্ট সেট করতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,r),r}finally{u.value=!1}};return{tasks:d(()=>o.value),task_todos:d(()=>k.value),task:d(()=>h.value),loading:d(()=>u.value),error:d(()=>n.value),taskListTree:d(g),flattenedTasks:d(P),fetchTasks:E,hasMoreTask:m,fetchMyTasks:O,resetTaskList:_,fetchTask:p,createTask:x,updateTask:C,deleteTask:A,assignUsers:$,updateTaskPriorities:q,setTaskRequirement:B}});export{M as u};
