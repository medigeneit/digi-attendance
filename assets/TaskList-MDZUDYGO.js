import{_ as $e}from"./CommentModal-dcuzo8R7.js";import{_ as _e,a as Ae}from"./TaskUserAssignForm-D-110V1R.js";import{L as Ie}from"./LoaderView-byiXXYap.js";import{O as ae}from"./OverlyModal-BJWT5bOs.js";import{_ as Se}from"./TaskAddForm-DNh4wUNK.js";import{_ as Le}from"./TaskEditForm-BY4KLOZ0.js";import{r as U,m as g,c as n,o as s,a as e,h as Y,v as me,g as r,w as F,d as ce,b as le,e as pe,x as se,z as fe,f as M,F as O,q as $,C as re,n as Q,t as A,k as f,i as P,E as oe,j as D,p as J,G as Ve,u as Me,s as ie}from"./index-VpHfIBoX.js";import{_ as qe}from"./MultiselectDropdown-DFjyyDwE.js";import{g as De,m as ye,u as Ee}from"./task-priority-DRfwHsP0.js";import{u as Ue}from"./company-kNSZBPBP.js";import{_ as de}from"./CompanyDepartmentSelectInput-CeaXr3mG.js";import{_ as ke}from"./UserChip-CICxS5Ck.js";import{_ as ve,a as Be,b as ge,c as xe,T as be,d as he,e as Pe}from"./TaskUrgentBadge-B421ZJn4.js";import{b as we,a as te}from"./datetime-DLUp6MRA.js";import{o as Oe}from"./url-CePbr-gY.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as je}from"./useTaskStore-BrbvzJcq.js";import"./useCommentStore-DotFMPEM.js";import"./TextWithHr-DKkwcesb.js";import"./TaskUrgencyInput-G2EuWzgN.js";import"./TaskUserChip-CtTr6sgP.js";import"./RequiredIcon-BwEdpRgf.js";import"./useRequirementStore-Do3_D6vr.js";import"./requirement-sRqaJvU6.js";import"./SectionLoading-Di_XqmUC.js";import"./tags-CN9VGsk3.js";const Re={class:"text-gray-600 relative"},Fe={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},ue={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(a,{emit:C}){const u=a,c=U(),h=C,p=y=>{h("update:modelValue",y||void 0)};let S=0;const T=g({get(){return u.modelValue},set(y){clearTimeout(S),S=setTimeout(p,500,y)}});return(y,l)=>(s(),n("div",Re,[l[3]||(l[3]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),Y(e("input",{ref_key:"searchInput",ref:c,id:"search","onUpdate:modelValue":l[0]||(l[0]=k=>T.value=k),type:"text",class:"!pr-7 w-full rounded-md px-2 py-1 border-2 border-gray-400 placeholder:text-sm focus:outline-gray-400",placeholder:"Search by main task title"},null,512),[[me,T.value]]),e("div",Fe,[T.value?(s(),n("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:l[1]||(l[1]=F(()=>{p(""),c.value.focus()},["prevent"]))})):r("",!0),l[2]||(l[2]=e("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},He={class:"mb-3 task-header"},ze={class:"flex justify-between items-start mb-4"},We={key:0,class:"ml-auto flex gap-6 items-center"},Ge={key:0,class:"flex gap-2 items-center"},Je={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ke={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Ye={class:"relative w-full md:w-48 flex-grow"},Qe=["value"],Xe={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Ze={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},et={class:"w-32 relative h-8"},tt={class:"flex gap-4 items-center flex-shrink-0"},st={class:"flex gap-2"},lt={class:"flex gap-2"},at={class:"flex gap-2"},ot={class:"text-gray-600 w-full md:w-32 relative"},nt={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},rt={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},it={key:0,class:"text-[9px] text-green-800"},dt=["onClick"],ut={key:1,class:"flex justify-end gap-5"},mt={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(a,{emit:C}){const u=a,c=ce(),h=le(),p=g(o("company-id")),S=g(o("from-department-id")),T=g(o("to-department-id")),y=g(o("user-ids")),l=g(o("month")),k=g(o("status")),_=g(o("is-important")),w=g(o("is-urgent")),L=g(o("is-target")),N=g(o("search")),W=C,E=Ue(),v=U([]);function o(b){return{get:()=>u.modelValue[b]||"",set:t=>{W("update:modelValue",{...u.modelValue,[b]:t||void 0})}}}const B=g(()=>K(y.value));async function H(){var b,t,i;if(!u.isMyTask){const d=(b=u.modelValue)==null?void 0:b["company-id"],I=T.value,q={...d?{company_id:d}:{},...I?{department_ids:[I]}:{}};v.value=((i=(t=await De({params:q}))==null?void 0:t.data)==null?void 0:i.employees)||[]}}pe(async()=>{await H(),await E.fetchCompanies({with:"departments",ignore_permission:!0}),await E.fetchMyCompanies({with:"departments"})});function K(b){return Array.isArray(v.value)&&v.value.find(t=>t.id==b)||null}function X(b){y.value=(b==null?void 0:b.id)||""}function z(){y.value=""}se(()=>T.value,H),se(()=>p.value,()=>{T.value!==""?T.value="":H()});function j(b,t,{value:i,id:d,label:I,onCancel:q}={}){if(!b)return[];const V=Array.isArray(t)?t.find(x=>(x==null?void 0:x[d])==b):null;return V?[{label:I,value:V==null?void 0:V[i],id:V==null?void 0:V[d],onCancel:q}]:[]}const Z=g(()=>{var d;const b=E.companies.reduce((I,q)=>[...I,...q.departments],[]),t=(I,{label:q,value:V,id:x,onCancel:G})=>I?[{label:q,value:V,id:x,onCancel:G}]:[],i=(I,{label:q,onCancel:V})=>{if(!I)return[];const x=new Date(I);return[{label:q,value:x.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:I,onCancel:V}]};return[...j(p.value,E.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{p.value=""}}),...j(S.value,b,{label:"From",value:"short_name",id:"id",onCancel:()=>{S.value=""}}),...j(T.value,b,{label:"To",value:"short_name",id:"id",onCancel:()=>{T.value=""}}),...j((d=B.value)==null?void 0:d.id,v.value,{label:"Employee",value:"name",id:"id",onCancel:z}),...j(k.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{k.value=""}}),...t(_.value,{label:"",value:"Important ",id:!0,onCancel:()=>{_.value=""}}),...t(w.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{w.value=""}}),...t(L.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{L.value=""}}),...i(l.value,{label:"",onCancel:()=>{l.value=""}})]});return(b,t)=>{var d,I,q,V,x,G,R,ne;const i=fe("RouterLink");return s(),n(O,null,[e("div",He,[e("div",ze,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),a.isMyTask?r("",!0):(s(),n("div",We,[a.listHasRearranged?(s(),n("div",Ge,[t[13]||(t[13]=e("span",{class:"text-red-500"},"Priority Changed",-1)),e("button",{class:"btn-3",onClick:t[0]||(t[0]=F(m=>W("clickPrioritySave"),["prevent"]))},"Save"),e("button",{class:"btn-3",onClick:t[1]||(t[1]=F(m=>W("clickPriorityDiscard"),["prevent"]))},"Discard")])):r("",!0),e("button",{onClick:t[2]||(t[2]=m=>W("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),e("div",Je,[e("div",Ke,[a.isMyTask?r("",!0):(s(),n(O,{key:0},[e("div",Ye,[t[16]||(t[16]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),Y(e("select",{"onUpdate:modelValue":t[3]||(t[3]=m=>p.value=m),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[t[15]||(t[15]=e("option",{value:""},"--ALL COMPANY--",-1)),(s(!0),n(O,null,Q((d=f(E))==null?void 0:d.myCompanies,m=>(s(),n("option",{key:m.id,value:m.id},A(m.name),9,Qe))),128))],512),[[re,p.value]])]),$(de,{modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=m=>S.value=m),companies:((I=f(E))==null?void 0:I.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:P(()=>t[17]||(t[17]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),f(h).name!=="MyTaskList"?(s(),M(de,{key:0,modelValue:T.value,"onUpdate:modelValue":t[5]||(t[5]=m=>T.value=m),companies:((q=f(E))==null?void 0:q.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:P(()=>t[18]||(t[18]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):r("",!0),f(c).isAdminMood&&((x=(V=f(c))==null?void 0:V.user)==null?void 0:x.role)!=="employee"?(s(),n("div",Xe,[$(qe,{modelValue:B.value,onSelect:X,onRemove:z,options:v.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:P(({option:m})=>[$(ke,{user:m,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),B.value?(s(),n("div",Ze,[e("button",{onClick:F(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):r("",!0),t[19]||(t[19]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):r("",!0)],64)),e("div",et,[t[21]||(t[21]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),Y(e("select",{"onUpdate:modelValue":t[6]||(t[6]=m=>k.value=m),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},t[20]||(t[20]=[e("option",{value:""},"--ALL TASKS--",-1),e("option",{value:"not-completed"},"Not Completed",-1),e("option",{value:"only-completed"},"Completed",-1)]),512),[[re,k.value]])]),e("div",tt,[e("label",st,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=m=>_.value=m)},null,512),[[oe,_.value]]),t[22]||(t[22]=e("span",null,"Important",-1))]),e("label",lt,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=m=>w.value=m)},null,512),[[oe,w.value]]),t[23]||(t[23]=e("span",null,"Urgent",-1))]),e("label",at,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=m=>L.value=m)},null,512),[[oe,L.value]]),t[24]||(t[24]=e("span",null,"Is Target",-1))])]),e("div",ot,[t[25]||(t[25]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),Y(e("input",{id:"month-filter","onUpdate:modelValue":t[10]||(t[10]=m=>l.value=m),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[me,l.value]])])]),a.isMyTask?(s(),M(ue,{key:0,modelValue:N.value,"onUpdate:modelValue":t[11]||(t[11]=m=>N.value=m),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):r("",!0)])]),e("div",nt,[a.isMyTask?r("",!0):(s(),M(ue,{key:0,modelValue:N.value,"onUpdate:modelValue":t[12]||(t[12]=m=>N.value=m),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),e("div",rt,[(s(!0),n(O,null,Q(Z.value,m=>(s(),n("div",{key:m.label||m.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[e("div",null,[m.label?(s(),n("span",it,A(m.label)+": ",1)):r("",!0),D(A(m.value),1)]),e("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:F(m.onCancel,["prevent"])},t[26]||(t[26]=[e("i",{class:"fas fa-times-circle"},null,-1)]),8,dt)]))),128))]),a.isMyTask?r("",!0):(s(),n("div",ut,[$(i,{class:J(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((G=f(h).query)==null?void 0:G.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...f(h).query,view:"userwise"}}},{default:P(()=>t[27]||(t[27]=[D(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),$(i,{class:J(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((R=f(h).query)==null?void 0:R.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ne=f(h))==null?void 0:ne.query)||{}).filter(m=>{var ee;return((ee=f(h))==null?void 0:ee.query[m])!=="userwise"}).reduce((m,ee)=>({...m,[ee]:f(h).query[ee]}),{})}}},{default:P(()=>t[28]||(t[28]=[D(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},ct={},pt={class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"};function ft(a,C){return s(),n("div",pt,C[0]||(C[0]=[e("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),D("CLOSED ")]))}const Ce=Ne(ct,[["render",ft]]),yt={class:"mt-3 -mx-3"},kt={class:"w-full"},vt={class:"border-y pr-2 pl-8 py-2 border-gray-300"},gt={class:"mb-1 flex items-center gap-3"},xt={key:0,class:"text-base font-semibold text-purple-600"},bt={class:"flex items-center flex-none lg:w-full order-0 lg:order-1 mb-2"},ht={class:"text-gray-400 text-xs mr-4"},wt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ct={class:"border-y px-2 py-4 border-gray-300"},Tt={class:"flex"},$t={class:"border-y py-4 pl-2 pr-4 border-gray-300"},_t={class:"flex justify-end gap-2"},At={key:0},It={colspan:"10",class:"py-2 px-8"},St={class:"text-sm"},Lt={key:0,class:"text-red-800 italic"},Vt={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:2}},emits:["editClick","addClick","employeeAssignClick"],setup(a,{emit:C}){const u=a,c=U(!1),h=g(()=>c.value?u.childrenTasks:u.childrenTasks.slice(0,u.maxItem)),p=g(()=>c.value?[]:u.childrenTasks.slice(u.maxItem));function S(){c.value=!c.value}return(T,y)=>(s(),n("div",yt,[e("table",kt,[e("tbody",null,[(s(!0),n(O,null,Q(h.value,(l,k)=>(s(),n("tr",{key:l.id,class:J(["",{" bg-lime-400/20":l.status=="COMPLETED"," bg-white hover:bg-slate-50":l.status!=="COMPLETED"}])},[e("td",vt,[e("div",gt,[k!==void 0?(s(),n("div",xt,A(k+1)+". ",1)):r("",!0),$(ve,{titleClass:"text-sm",task:l,"sub-tasks-open":!1,"is-my-task":T.isMyTask},null,8,["task","is-my-task"])]),e("div",bt,[e("div",ht,[y[0]||(y[0]=e("i",{class:"fas fa-clock"},null,-1)),D(" "+A(f(we)(l.created_at)),1)]),e("div",wt,[l!=null&&l.is_important?(s(),M(be,{key:0})):r("",!0),l!=null&&l.is_urgent?(s(),M(he,{key:1})):r("",!0)])])]),e("td",Ct,[e("div",Tt,[$(Be,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:l.users||[],isTargetTask:l.is_target,maxItem:1},null,8,["users","isTargetTask"])])]),e("td",$t,[e("div",_t,[l.closed_at?(s(),M(Ce,{key:0})):r("",!0),$(ge,{status:l==null?void 0:l.status,progressPercent:(l==null?void 0:l.progress_percent)||0},null,8,["status","progressPercent"]),$(xe,{ref_for:!0,ref:"progress",task:l,class:"text-sm"},null,8,["task"])])])],2))),128)),a.childrenTasks.length>0?(s(),n("tr",At,[e("td",It,[e("div",St,[p.value.length>0?(s(),n("span",Lt,A(p.value.length)+" More sub task"+A(p.value.length>1?"s":""),1)):r("",!0),p.value.length>0||c.value?(s(),n("button",{key:1,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent ml-2",onClick:F(S,["prevent","stop"])},A(c.value?"Hide":"Show")+" All ",1)):r("",!0)])])])):r("",!0)])])]))}},Mt={class:"flex w-full text-gray-800 bg-white"},qt={key:0,class:"border-l border-gray-200 last:border-l-0"},Dt={class:"items-start grid grid-cols-4 gap-4 group"},Et={class:"flex items-start gap-6 w-full pb-4"},Ut={class:"flex-grow w-6/12"},Bt={class:"flex gap-2"},Pt={key:0,class:"text-xl font-semibold text-blue-500"},Ot={class:"flex items-center mb-2"},Nt={key:0,class:"flex gap-4 items-center mr-3"},jt={key:1,class:"text-gray-500 text-sm"},Rt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ft={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},Ht={class:"text-xs text-gray-400 whitespace-nowrap"},zt={class:"justify-end items-center gap-2 ml-auto flex flex-wrap w-[350px]"},Wt={class:"text-gray-400 text-xs col-span-full flex justify-between"},Gt={class:"ml-auto flex flex-wrap gap-2 mb-2 items-start"},Jt={class:"ml-0 col-span-full"},Kt={class:"text-xs text-gray-400 flex gap-3 sm:order-0"},Yt=["href"],Qt={class:"mt-2 col-span-full"},Xt={class:"flex gap-3 items-end"},Zt={class:"text-right text-sm flex gap-4 mt-4 opacity-80"},es={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},ts={key:1,class:"text-gray-500 text-sm"},ss={class:"font-semibold text-blue-800"},ls={key:2,class:"ml-4 text-gray-500 text-sm"},as={class:"text-blue-500 font-semibold"},os={key:3,class:"text-gray-500 text-sm"},ns={class:"font-semibold text-blue-800"},rs={key:4,class:"text-gray-500 text-sm"},is={class:"font-semibold text-blue-800"},ds={class:"flex items-center sm:ml-auto order-0 sm:order-1"},us={key:0,class:"flex gap-2 ml-4 items-center text-xs"},ms=["href"],cs=["href"],Te={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(a,{emit:C}){const u=a,c=le(),h=U(null),p=C;function S(v){p("addClick",v)}function T(v){p("editClick",v)}function y(v){p("employeeAssignClick",v)}const l=U([]),k=localStorage.getItem("sub_task_opened_list");if(k)try{l.value=JSON.parse(k)}catch{l.value=[]}const _=g(()=>te(u.task.assigned_at||u.task.created_at)),w=g(()=>te(u.task.deadline)),L=g(()=>te(u.task.started_at)),N=g(()=>te(u.task.completed_at)),W=g({get:()=>l.value.includes(u.task.id),set:v=>{const o=l.value.includes(u.task.id);v&&!o?l.value.push(u.task.id):!v&&o&&(l.value=l.value.filter(B=>B!==u.task.id))}});se(l,v=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(v))},{deep:!0});const E=g(()=>{var v,o;return((o=(v=u.task)==null?void 0:v.children_tasks)==null?void 0:o.length)>0});return(v,o)=>{var H,K,X,z,j,Z,b,t;const B=fe("RouterLink");return s(),n("div",Mt,[a.treeLevel>0?(s(),n("div",qt,o[4]||(o[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):r("",!0),e("div",{class:J(["flex-grow border-2 rounded pb-3 px-3",{"border-blue-500":a.index%2===0,"border-pink-300":a.index%2===1}])},[e("div",Dt,[e("div",{class:J(["col-span-full md:col-span-full border-b -mx-3 px-3 pt-3 shadow-md shadow-slate-100 flex flex-wrap z-30",{"bg-blue-100/30  ":a.task.closed_at,"bg-green-100  ":((H=h.value)==null?void 0:H.completedPercentage)===100,"bg-white hover:bg-gray-50":((K=h.value)==null?void 0:K.completedPercentage)<100&&!a.task.closed_at,"shadow-sm":a.treeLevel>0}])},[e("div",Et,[e("div",Ut,[e("div",Bt,[a.index!==void 0?(s(),n("div",Pt,A(a.index+1)+". ",1)):r("",!0),$(ve,{task:a.task,"sub-tasks-open":W.value,"is-my-task":a.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",Ot,[a.showDraggableHandle||a.task.serial?(s(),n("div",Nt,[a.showDraggableHandle?(s(),n("button",{key:0,onMousedown:o[0]||(o[0]=F((...i)=>v.handleDragging&&v.handleDragging(...i),["stop"])),class:"handle"},o[5]||(o[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):r("",!0),a.task.serial?(s(),n("span",jt," #"+A(a.task.serial),1)):r("",!0)])):r("",!0),e("div",Rt,[a.treeLevel===0?(s(),n("div",Ft," Main ")):r("",!0),(X=a.task)!=null&&X.is_important?(s(),M(be,{key:1,class:"flex-none"})):r("",!0),(z=a.task)!=null&&z.is_urgent?(s(),M(he,{key:2,class:"flex-none"})):r("",!0)])]),e("div",Ht,[o[6]||(o[6]=e("i",{class:"fas fa-clock"},null,-1)),D(" "+A(f(we)(a.task.created_at)),1)])]),a.hideAssignedUsers?r("",!0):(s(),M(Pe,{key:0,task:a.task,"tree-level":a.treeLevel,class:"flex-nowrap w-1/2","employee-route-to":i=>({query:{...f(c).query,view:"userwise","company-id":i.company_id,"user-ids":i.id}})},null,8,["task","tree-level","employee-route-to"])),e("div",zt,[a.task.closed_at?(s(),M(Ce,{key:0})):r("",!0),$(ge,{status:(j=a.task)==null?void 0:j.status,progressPercent:((Z=a.task)==null?void 0:Z.progress_percent)||0,class:"w-[150px] text-center !border-2"},null,8,["status","progressPercent"]),$(xe,{ref_key:"progress",ref:h,task:a.task,class:"text-sm w-[150px] text-center"},null,8,["task"])])])],2),e("div",Wt,[e("div",Gt,[(s(!0),n(O,null,Q(a.task.website_tags||[],i=>(s(),n("div",{class:"border bg-gray-50 text-xs px-2 rounded-lg shadow-sm text-gray-700 bg-gradient-to-b to-slate-50 from-blue-100",key:i.id},A(i.name),1))),128))])]),e("div",Jt,[e("div",{class:J({"ml-6":E.value})},[e("div",Kt,[e("h2",{class:J([{"text-blue-600 font-semibold  inline-block  ":E.value},"flex items-center gap-1 group"])},[e("span",null," Sub Tasks ("+A((b=a.task.children_tasks)==null?void 0:b.length)+") ",1)],2),!a.task.closed_at&&!a.hideButtons?(s(),n(O,{key:0},[a.treeLevel<2?(s(),n("a",{key:0,href:`/tasks/add?parent_id=${u.task.id}&back-to=${encodeURIComponent(f(c).path+"?"+f(Oe)(f(c).query)).toLowerCase()}`,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:o[1]||(o[1]=F(i=>p("addClick",u.task.id),["stop","prevent"]))},o[7]||(o[7]=[e("i",{class:"fas fa-plus"},null,-1),D(" Add Sub Task ")]),8,Yt)):r("",!0)],64)):r("",!0)])],2),$(Vt,{childrenTasks:a.task.children_tasks,"hide-buttons":a.hideButtons,"hide-assigned-users":a.hideAssignedUsers,"parent-tree-level":a.treeLevel,onEditClick:T,onAddClick:S,onEmployeeAssignClick:y},{"tree-item-end":P(({task:i,level:d})=>[Ve(v.$slots,"item-end",{level:d,task:i})]),_:3},8,["childrenTasks","hide-buttons","hide-assigned-users","parent-tree-level"])])]),e("div",Qt,[e("div",Xt,[e("div",Zt,[a.task.is_target?(s(),n("div",es,o[8]||(o[8]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),D(" TARGET TASK ")]))):r("",!0),_.value?(s(),n("span",ts,[o[9]||(o[9]=D(" Assign: ")),e("span",ss,A(_.value),1)])):r("",!0),w.value?(s(),n("span",ls,[o[10]||(o[10]=D(" Deadline: ")),e("span",as,A(w.value),1)])):r("",!0),L.value?(s(),n("span",os,[o[11]||(o[11]=D(" Started: ")),e("span",ns,A(L.value),1)])):r("",!0),N.value?(s(),n("span",rs,[o[12]||(o[12]=D(" Completed: ")),e("span",is,A(N.value),1)])):r("",!0)]),e("div",ds,[a.hideButtons?r("",!0):(s(),n("div",us,[a.task.is_closed?r("",!0):(s(),n("a",{key:0,href:`/tasks/edit/${a.task.id}`,onClick:o[2]||(o[2]=F(i=>p("editClick",a.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},o[13]||(o[13]=[e("i",{class:"fas fa-edit"},null,-1),D(" Edit ")]),8,ms)),a.task.is_closed?r("",!0):(s(),n("a",{key:1,href:`/tasks/${a.task.id}/assign-users`,onClick:o[3]||(o[3]=F(i=>p("employeeAssignClick",a.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},o[14]||(o[14]=[e("i",{class:"fas fa-users-cog"},null,-1),D(" Manage Employee & Supervisor ")]),8,cs)),$(B,{to:{name:"TaskReports",params:{id:(t=a.task)==null?void 0:t.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:P(()=>o[15]||(o[15]=[e("i",{class:"far fa-file-alt"},null,-1),D(" Reports ")])),_:1,__:[15]},8,["to"])]))])])])],2)])}}},ps={class:"w-full bg-white rounded"},fs=["rowspan"],ys={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(a,{emit:C}){const u=a,c=le(),h=C,p=g(()=>u.tasks.reduce((y,l)=>(y.push(...l.users.filter(k=>!y.find(_=>_.id==k.id&&k.id))),y),[]).filter(y=>u.selectedUserId?y.id==u.selectedUserId:!0)),S=y=>{const k=u.tasks.filter(_=>_.users.some(w=>w.id===y));return ye(k,{...c.query,"user-ids":y})},T=g(()=>p.value.map(y=>{const l=S(y.id);return{...y,tasks:l}}));return(y,l)=>(s(),n("div",null,[e("table",ps,[e("tbody",null,[(s(!0),n(O,null,Q(T.value,k=>(s(),n(O,{key:k.id},[(s(!0),n(O,null,Q(k.tasks,(_,w)=>(s(),n("tr",{key:_.id},[w==0?(s(),n("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(k.tasks.length,1)},[$(ke,{user:k,class:"sticky top-[8rem]"},null,8,["user"])],8,fs)):r("",!0),e("td",{class:J(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":w==0,"border-b":k.tasks.length-1===w}])},[$(Te,{task:_,class:"!border-0 my-0",index:w,onCommentButtonClick:l[0]||(l[0]=L=>h("commentButtonClick",y.item.id)),onEditClick:l[1]||(l[1]=L=>h("editClick",L)),onAddClick:l[2]||(l[2]=L=>h("addClick",L)),onEmployeeAssignClick:l[3]||(l[3]=L=>h("employeeAssignClick",L))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},ks={class:"max-w-full mx-4 p-6 mt-2 relative bg-white rounded-md shadow-md"},vs={class:"mb-4"},gs={class:"relative min-h-[30vh]"},xs={key:0,class:"text-center py-4 text-red-500"},bs={key:1},hs={class:"flex items-stretched"},ws={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},Cs=1,Ys={__name:"TaskList",setup(a){const C=je(),u=ce(),c=le(),h=Me(),p=U(""),S=U(!1),T=U(null),y=g(()=>{var i;return((i=u==null?void 0:u.user)==null?void 0:i.role)==="employee"||!(u!=null&&u.isAdminMood)?!0:!!c.query["user-ids"]}),l=U(null),k=U(!1),_=ie({parentId:0,requirementId:0}),w=ie({taskId:0,isOpen:!1}),L=U(null),N=U([]),{handleItemsPriorityUpdate:W,saveTaskPriority:E,listHasRearranged:v}=Ee(()=>C.taskListTree,0);pe(async()=>{p.value="loading",c.query.status?await o():h.push({query:{...c.query,status:"not-completed"}})});async function o(){let i;c.name==="MyTaskList"?i=await C.fetchMyTasks({...c.query,page:1}):i=await C.fetchTasks({...c.query,page:1},{infiniteScrolling:!1}),p.value="",N.value=i.query_log||[]}const B=i=>{k.value=!0,_.parentId=i},H=i=>{w.taskId=i,w.isOpen=!0},K=i=>{T.value=i,S.value=!0},X=()=>{S.value=!1,T.value=null};async function z(){l.value=null,k.value=!1,_.parentId=0,p.value="loading",await o()}async function j(){k.value=!1,_.parentId=0,await o()}async function Z(){p.value="loading",await E()&&await o()}se(()=>({...c.query}),async()=>{C.resetTaskList(),p.value="loading",await o()});const b=g({get(){return{...c.query}},set(i){localStorage.removeItem("sub_task_opened_list"),h.push({query:{...i}})}}),t=g(()=>{var d;const i={...c.query};return c.name=="MyTaskList"&&(i["user-ids"]=(d=u==null?void 0:u.user)==null?void 0:d.id),Array.isArray(C.tasks)?ye(C.tasks,i):[]});return(i,d)=>{var I,q,V;return s(),n("div",ks,[l.value?(s(),M(ae,{key:0},{default:P(()=>[$(Le,{taskId:l.value,onClose:d[0]||(d[0]=x=>l.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):r("",!0),k.value?(s(),M(ae,{key:1},{default:P(()=>[$(Se,{parentTaskId:_.parentId,requirementId:_.requirementId,onClose:j,onTaskCreated:z},null,8,["parentTaskId","requirementId"])]),_:1})):r("",!0),w.isOpen?(s(),M(ae,{key:2,class:"*:max-w-4xl"},{default:P(()=>[$(_e,{taskId:w.taskId,onCancelClick:d[1]||(d[1]=()=>{w.isOpen=!1,w.taskId=0}),onSuccess:d[2]||(d[2]=()=>{w.isOpen=!1,w.taskId=0,p.value="loading",o()})},null,8,["taskId"])]),_:1})):r("",!0),$(mt,{modelValue:b.value,"onUpdate:modelValue":d[3]||(d[3]=x=>b.value=x),onClickAddTask:B,onClickPrioritySave:Z,onClickPriorityDiscard:d[4]||(d[4]=()=>f(v)?L.value.resetItems:null),"list-has-rearranged":f(v),isMyTask:f(c).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((q=(I=f(c))==null?void 0:I.query)==null?void 0:q["query-log"])=="true"?(s(!0),n(O,{key:3},Q(N.value,(x,G)=>(s(),n("div",{key:G,class:"text-xs text-gray-500"},[e("div",vs,A(x.raw_query),1)]))),128)):r("",!0),e("div",gs,[f(C).error?(s(),n("div",xs,A(f(C).error),1)):f(C).tasks.length>0?(s(),n("div",bs,[((V=f(c).query)==null?void 0:V.view)=="userwise"?(s(),M(ys,{key:0,tasks:t.value,selectedUserId:f(c).query["user-ids"],onCommentButtonClick:d[5]||(d[5]=x=>K(x,i.task.id)),onEditClick:d[6]||(d[6]=x=>l.value=x),onAddClick:d[7]||(d[7]=x=>B(x)),onEmployeeAssignClick:d[8]||(d[8]=x=>H(x))},null,8,["tasks","selectedUserId"])):(s(),M(Ae,{key:1,items:t.value,handle:"handle",onItemsUpdate:f(W),class:"space-y-6",ref_key:"draggableTaskList",ref:L},{item:P(({item:x,index:G})=>[e("div",hs,[$(Te,{"is-my-task":f(c).name==="MyTaskList",task:x,index:G,showDraggableHandle:!y.value,onCommentButtonClick:d[9]||(d[9]=R=>K(R,i.task.id)),onEditClick:d[10]||(d[10]=R=>l.value=R),onAddClick:d[11]||(d[11]=R=>B(R)),onEmployeeAssignClick:d[12]||(d[12]=R=>H(R)),class:"!border-0 shadow hover:shadow-md"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):p.value!=="loading"?(s(),n("div",ws," No tasks found. ")):r("",!0),p.value==="loading"?(s(),M(Ie,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):r("",!0)]),$($e,{show:S.value,"commentable-id":T.value,"commentable-type":"task","user-id":Cs,"on-close":X,onSubmitted:f(C).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Ys as default};
