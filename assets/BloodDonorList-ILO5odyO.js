import{D as T,x as F,c as r,o,a as t,d as j,n as e,k as f,l as _,v as $,G as V,F as L,e as M,t as u,b as C,z as I,w as P,s as O,r as J,q as E,y as Y,P as q,h as Z,j as tt}from"./index-DCWLOIGo.js";import{useBloodDonorAdminStore as R}from"./bloodDonorAdmin-CL8ghTnk.js";import{_ as Q}from"./EmployeeFilter-Crq2yq5q.js";import{_ as et}from"./PaginationBar-BQBOiWuy.js";import{u as st}from"./user-BXQTIvG7.js";import"./company-DQ1I4_0G.js";import"./department-DrB_Ep9J.js";import"./EmployeeDropdownInput-orJ4HKUe.js";import"./SelectDropdown-jECWKL_3.js";import"./UserChip-Dd0kdDSE.js";const it={class:"rounded-xl border border-zinc-200 bg-white p-4"},lt={class:"mb-4 rounded-lg border border-zinc-200 bg-zinc-50 p-2"},nt={class:"grid grid-cols-1 gap-3 md:grid-cols-4"},at={class:"space-y-1"},ot={class:"space-y-1"},dt={class:"space-y-1"},rt=["value"],pt={class:"space-y-1"},ct={key:0,class:"space-y-1"},ut={class:"space-y-1"},mt={class:"space-y-1"},xt={class:"space-y-1"},bt={class:"flex items-end gap-2"},yt={class:"flex-1 space-y-1"},vt=["disabled"],_t={__name:"BloodDonorFilters",setup(A){const b=R(),{filters:p,loading:h}=T(b),v=F(()=>p.value.availability==="soon"),w=["A+","A-","B+","B-","AB+","AB-","O+","O-"];return(U,l)=>(o(),r("div",it,[t("div",lt,[j(Q,{company_id:e(p).company_id,"onUpdate:company_id":l[0]||(l[0]=a=>e(p).company_id=a),department_id:e(p).department_id,"onUpdate:department_id":l[1]||(l[1]=a=>e(p).department_id=a),employee_id:e(p).employee_id,"onUpdate:employee_id":l[2]||(l[2]=a=>e(p).employee_id=a),line_type:e(p).line_type,"onUpdate:line_type":l[3]||(l[3]=a=>e(p).line_type=a),"with-type":!0,"initial-value":e(p),class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"])]),t("div",nt,[t("div",at,[l[14]||(l[14]=t("label",{class:"text-xs text-zinc-600"},"Search",-1)),_(t("input",{"onUpdate:modelValue":l[4]||(l[4]=a=>e(p).search=a),class:"input-1 h-9 w-full text-sm",placeholder:"Name / phone / ID"},null,512),[[$,e(p).search,void 0,{trim:!0}]])]),t("div",ot,[l[15]||(l[15]=t("label",{class:"text-xs text-zinc-600"},"Address",-1)),_(t("input",{"onUpdate:modelValue":l[5]||(l[5]=a=>e(p).address=a),class:"input-1 h-9 w-full text-sm",placeholder:"Street, city, area"},null,512),[[$,e(p).address,void 0,{trim:!0}]])]),t("div",dt,[l[17]||(l[17]=t("label",{class:"text-xs text-zinc-600"},"Blood Group",-1)),_(t("select",{"onUpdate:modelValue":l[6]||(l[6]=a=>e(p).blood_group=a),class:"input-1 h-9 w-full text-sm"},[l[16]||(l[16]=t("option",{value:""},"All",-1)),(o(),r(L,null,M(w,a=>t("option",{key:a,value:a},u(a),9,rt)),64))],512),[[V,e(p).blood_group]])]),t("div",pt,[l[19]||(l[19]=t("label",{class:"text-xs text-zinc-600"},"Availability",-1)),_(t("select",{"onUpdate:modelValue":l[7]||(l[7]=a=>e(p).availability=a),class:"input-1 h-9 w-full text-sm"},l[18]||(l[18]=[t("option",{value:"all"},"All",-1),t("option",{value:"available"},"Available",-1),t("option",{value:"not_available"},"Not Available",-1),t("option",{value:"soon"},"Reset in 15 days",-1)]),512),[[V,e(p).availability]])]),v.value?(o(),r("div",ct,[l[20]||(l[20]=t("label",{class:"text-xs text-zinc-600"},"Soon Days",-1)),_(t("input",{"onUpdate:modelValue":l[8]||(l[8]=a=>e(p).soon_days=a),type:"number",min:"1",max:"365",class:"input-1 h-9 w-full text-sm"},null,512),[[$,e(p).soon_days,void 0,{number:!0}]])])):f("",!0),t("div",ut,[l[22]||(l[22]=t("label",{class:"text-xs text-zinc-600"},"Status",-1)),_(t("select",{"onUpdate:modelValue":l[9]||(l[9]=a=>e(p).status=a),class:"input-1 h-9 w-full text-sm"},l[21]||(l[21]=[t("option",{value:""},"All",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1),t("option",{value:"blocked"},"Blocked",-1)]),512),[[V,e(p).status]])]),t("div",mt,[l[23]||(l[23]=t("label",{class:"text-xs text-zinc-600"},"Last Donation From",-1)),_(t("input",{"onUpdate:modelValue":l[10]||(l[10]=a=>e(p).last_donation_from=a),type:"date",class:"input-1 h-9 w-full text-sm"},null,512),[[$,e(p).last_donation_from]])]),t("div",xt,[l[24]||(l[24]=t("label",{class:"text-xs text-zinc-600"},"Last Donation To",-1)),_(t("input",{"onUpdate:modelValue":l[11]||(l[11]=a=>e(p).last_donation_to=a),type:"date",class:"input-1 h-9 w-full text-sm"},null,512),[[$,e(p).last_donation_to]])]),t("div",bt,[t("div",yt,[l[26]||(l[26]=t("label",{class:"text-xs text-zinc-600"},"Per Page",-1)),_(t("select",{"onUpdate:modelValue":l[12]||(l[12]=a=>e(p).per_page=a),class:"input-1 h-9 w-full text-sm"},l[25]||(l[25]=[t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1)]),512),[[V,e(p).per_page,void 0,{number:!0}]])]),t("button",{class:"btn-3 h-9",disabled:e(h),onClick:l[13]||(l[13]=a=>e(b).resetFilters())}," Reset ",8,vt)])])]))}},gt={class:"rounded-xl border border-zinc-200 bg-white shadow-sm"},ft={class:"flex items-start justify-between gap-3 border-b border-zinc-100 px-4 py-3"},ht={class:"shrink-0 text-xs text-zinc-500"},zt={key:0,class:"inline-flex items-center gap-2"},wt={key:1,class:"inline-flex items-center gap-2"},kt={class:"max-h-[70vh] overflow-auto"},$t={class:"w-full table-fixed text-[12px]"},At={class:"divide-y divide-zinc-100"},Ut=["onClick","onKeydown"],Nt={class:"sticky left-0 z-10 bg-white group-hover:bg-sky-50 px-4 py-2.5 font-medium text-zinc-900"},Dt={class:"px-4 py-2.5"},St={class:"flex items-start gap-3 min-w-0"},Bt=["title"],Ct={class:"min-w-0"},Vt={class:"flex items-center gap-2 min-w-0"},jt={class:"truncate font-semibold text-zinc-900"},Lt={key:0,class:"shrink-0 text-[11px] text-zinc-400"},Pt={class:"mt-0.5 line-clamp-1 text-[11px] text-zinc-500"},Et={class:"px-4 py-2.5"},Mt={class:"min-w-0"},Ot=["title"],Ft=["title"],Tt={class:"px-4 py-2.5"},Rt={class:"min-w-0"},Gt={class:"font-semibold"},Ht=["href"],Kt={class:"tabular-nums"},It={key:1,class:"text-zinc-500"},qt=["title"],Jt={key:1,class:"mt-0.5 text-[11px] text-zinc-400"},Qt={class:"px-4 py-2.5"},Wt={class:"inline-flex items-center rounded-md bg-zinc-900 px-2 py-1 text-[11px] font-semibold text-white"},Xt={class:"px-4 py-2.5"},Yt={class:"flex items-center gap-2"},Zt={key:0,class:"text-[11px] text-zinc-500"},te={class:"px-4 py-2.5 text-zinc-800"},ee={class:"font-medium tabular-nums"},se={class:"px-4 py-2.5"},ie={class:"sticky right-0 z-10 bg-white group-hover:bg-sky-50 px-4 py-2.5 border-l border-zinc-100 text-right"},le=["onClick"],ne={key:0},ae={__name:"BloodDonorTable",props:{donors:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},meta:{type:Object,default:()=>({page:1,per_page:25})}},emits:["edit"],setup(A,{emit:b}){const p=A,h=b,v=F(()=>{var i,k;const n=Number(((i=p.meta)==null?void 0:i.page)||1),d=Number(((k=p.meta)==null?void 0:k.per_page)||25);return(n-1)*d}),w=n=>n===!0||n===1||n==="1"||n==="true",U=n=>w(n==null?void 0:n.is_available),l=n=>U(n)?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":"bg-rose-50 text-rose-700 ring-1 ring-rose-200",a=n=>{switch(String(n||"").toLowerCase()){case"active":return"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200";case"inactive":return"bg-amber-50 text-amber-700 ring-1 ring-amber-200";case"blocked":return"bg-rose-50 text-rose-700 ring-1 ring-rose-200";default:return"bg-zinc-50 text-zinc-700 ring-1 ring-zinc-200"}},B=n=>{if(!n)return"—";const d=new Date(n);return Number.isNaN(d.getTime())?"—":d.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})},y=n=>{if(!n)return null;const d=String(n).replace(/[^\d+]/g,"");return d?`tel:${d}`:null},x=n=>{var d,i;return(n==null?void 0:n.company_name)||((d=n==null?void 0:n.company)==null?void 0:d.name)||((i=n==null?void 0:n.organization)==null?void 0:i.name)||"N/A"},z=n=>{var d,i;return(n==null?void 0:n.department_name)||((d=n==null?void 0:n.department)==null?void 0:d.name)||((i=n==null?void 0:n.team)==null?void 0:i.name)||"N/A"},N=n=>{const d=String(n||"").trim();return d?d.split(/\s+/).slice(0,2).map(k=>{var S;return(S=k[0])==null?void 0:S.toUpperCase()}).join(""):"—"},D=n=>h("edit",n);return(n,d)=>(o(),r("div",gt,[t("div",ft,[d[3]||(d[3]=t("div",{class:"min-w-0"},[t("div",{class:"text-sm font-semibold text-zinc-900"},"Donors"),t("div",{class:"mt-0.5 text-xs text-zinc-500"}," Click a row (or History) to update donor history. ")],-1)),t("div",ht,[A.loading?(o(),r("span",zt,d[1]||(d[1]=[t("span",{class:"h-2 w-2 animate-pulse rounded-full bg-zinc-300"},null,-1),C(" Loading… ")]))):(o(),r("span",wt,[d[2]||(d[2]=t("span",{class:"h-2 w-2 rounded-full bg-emerald-400"},null,-1)),C(" "+u(A.donors.length)+" rows ",1)]))])]),t("div",kt,[t("table",$t,[d[7]||(d[7]=t("colgroup",null,[t("col",{class:"w-14"}),t("col",{class:"w-[280px]"}),t("col",{class:"w-[240px]"}),t("col",{class:"w-[220px]"}),t("col",{class:"w-20"}),t("col",{class:"w-[210px]"}),t("col",{class:"w-28"}),t("col",{class:"w-28"}),t("col",{class:"w-24"})],-1)),d[8]||(d[8]=t("thead",{class:"sticky top-0 z-20 bg-zinc-50/95 backdrop-blur"},[t("tr",{class:"text-left text-[10.5px] font-semibold uppercase tracking-wide text-zinc-600"},[t("th",{class:"sticky left-0 z-30 bg-zinc-50/95 px-4 py-2.5"},"SL"),t("th",{class:"px-4 py-2.5"},"Donor"),t("th",{class:"px-4 py-2.5"},"Organization"),t("th",{class:"px-4 py-2.5"},"Contact"),t("th",{class:"px-4 py-2.5"},"Blood"),t("th",{class:"px-4 py-2.5"},"Availability"),t("th",{class:"px-4 py-2.5"},"Last"),t("th",{class:"px-4 py-2.5"},"Status"),t("th",{class:"sticky right-0 z-30 bg-zinc-50/95 px-4 py-2.5 text-right border-l border-zinc-100"}," Action ")])],-1)),t("tbody",At,[A.loading?(o(),r(L,{key:0},M(10,i=>t("tr",{key:`sk-${i}`,class:"animate-pulse"},d[4]||(d[4]=[t("td",{class:"sticky left-0 z-10 bg-white px-4 py-2.5"},[t("div",{class:"h-3 w-8 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-64 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-56 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-52 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-12 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-44 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-20 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-2.5"},[t("div",{class:"h-3 w-16 rounded bg-zinc-100"})],-1),t("td",{class:"sticky right-0 z-10 bg-white px-4 py-2.5 border-l border-zinc-100"},[t("div",{class:"ml-auto h-7 w-20 rounded bg-zinc-100"})],-1)]))),64)):(o(),r(L,{key:1},[(o(!0),r(L,null,M(A.donors,(i,k)=>(o(),r("tr",{key:(i==null?void 0:i.id)??k,class:"group cursor-pointer hover:bg-sky-50 focus-within:bg-sky-50",role:"button",tabindex:"0",title:"Open history update",onClick:S=>D(i),onKeydown:[I(P(S=>D(i),["prevent"]),["enter"]),I(P(S=>D(i),["prevent"]),["space"])]},[t("td",Nt,u(v.value+k+1),1),t("td",Dt,[t("div",St,[t("div",{class:"mt-0.5 flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-zinc-100 text-[11px] font-bold text-zinc-700",title:(i==null?void 0:i.name)||""},u(N(i==null?void 0:i.name)),9,Bt),t("div",Ct,[t("div",Vt,[t("div",jt,u((i==null?void 0:i.name)||"N/A"),1),i!=null&&i.id?(o(),r("span",Lt,"#"+u(i.id),1)):f("",!0)]),t("div",Pt,u((i==null?void 0:i.availability_note)||"Ready to support"),1)])])]),t("td",Et,[t("div",Mt,[t("div",{class:"truncate text-zinc-900",title:x(i)},u(x(i)),9,Ot),t("div",{class:"mt-0.5 truncate text-[11px] text-zinc-500",title:z(i)},u(z(i)),9,Ft)])]),t("td",Tt,[t("div",Rt,[t("div",Gt,[y(i==null?void 0:i.phone)?(o(),r("a",{key:0,href:y(i==null?void 0:i.phone),class:"inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-500",onClick:d[0]||(d[0]=P(()=>{},["stop"]))},[d[5]||(d[5]=t("span",{"aria-hidden":"true"},"☎",-1)),t("span",Kt,u(i==null?void 0:i.phone),1)],8,Ht)):(o(),r("span",It,u((i==null?void 0:i.phone)||"N/A"),1))]),i!=null&&i.address?(o(),r("div",{key:0,class:"mt-0.5 line-clamp-1 text-[11px] text-zinc-500",title:i.address},u(i.address),9,qt)):(o(),r("div",Jt,"—"))])]),t("td",Qt,[t("span",Wt,u((i==null?void 0:i.blood)||"N/A"),1)]),t("td",Xt,[t("div",Yt,[t("span",{class:O(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold",l(i)])},u(U(i)?"Available":"Not available"),3),i!=null&&i.available_from?(o(),r("span",Zt,u(B(i.available_from)),1)):f("",!0)])]),t("td",te,[t("span",ee,u(B(i==null?void 0:i.last_donation_date)),1)]),t("td",se,[t("span",{class:O(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold capitalize",a(i==null?void 0:i.status)])},u((i==null?void 0:i.status)||"N/A"),3)]),t("td",ie,[t("button",{type:"button",class:"inline-flex items-center justify-center rounded-lg border border-zinc-200 bg-white px-2.5 py-1.5 text-[11px] font-semibold text-zinc-700 shadow-sm hover:bg-zinc-50 focus:outline-none focus:ring-2 focus:ring-sky-200",onClick:P(S=>h("edit",i),["stop"])}," History ",8,le)])],40,Ut))),128)),A.donors.length===0?(o(),r("tr",ne,d[6]||(d[6]=[t("td",{colspan:"9",class:"px-4 py-12 text-center text-sm text-zinc-500"}," No donors found. ",-1)]))):f("",!0)],64))])])])]))}},oe={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center px-4 py-6 top-4"},de={class:"relative w-full max-w-6xl overflow-hidden rounded-2xl bg-white shadow-2xl ring-1 ring-black/5"},re={class:"sticky top-0 z-20 flex items-start justify-between gap-3 border-b bg-white/90 px-6 py-4 backdrop-blur"},pe=["disabled"],ce={class:"max-h-[76vh] overflow-y-auto px-6 py-5"},ue={key:0,class:"mb-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700"},me={class:"mb-5 rounded-2xl border border-zinc-200 bg-white p-4"},xe={class:"mb-2 flex items-start justify-between gap-3"},be={key:0,class:"rounded-full bg-zinc-100 px-2.5 py-1 text-xs text-zinc-700"},ye={class:"font-semibold"},ve={class:"grid grid-cols-1 gap-5 lg:grid-cols-12"},_e={class:"lg:col-span-4 space-y-5"},ge={class:"rounded-2xl border border-zinc-200 bg-white p-4"},fe={key:0,class:"space-y-2 text-sm"},he={class:"flex justify-between gap-3"},ze={class:"font-medium text-zinc-900 text-right"},we={class:"flex justify-between gap-3"},ke={class:"font-medium text-zinc-900"},$e={class:"flex justify-between gap-3"},Ae={class:"font-medium text-zinc-900 text-right"},Ue={key:1,class:"text-sm text-zinc-500"},Ne={class:"rounded-2xl border border-zinc-200 bg-white p-4"},De={class:"mb-3 flex items-start justify-between gap-3"},Se={key:0,class:"text-xs text-zinc-500"},Be={key:0,class:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-3 text-sm text-rose-700"},Ce={key:1,class:"space-y-2"},Ve={key:2,class:"rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-3 text-sm text-zinc-600"},je={key:3,class:"max-h-[320px] overflow-auto pr-1 space-y-2"},Le={class:"flex items-start justify-between gap-3"},Pe={class:"min-w-0"},Ee={class:"text-sm font-semibold text-zinc-900"},Me={class:"mt-0.5 text-xs text-zinc-500"},Oe={key:0,class:"mt-1 line-clamp-2 text-xs text-zinc-600"},Fe={class:"flex flex-col items-end gap-1 shrink-0"},Te={class:"lg:col-span-8 space-y-5"},Re={class:"rounded-2xl border border-zinc-200 bg-white p-4"},Ge={class:"mb-3 flex items-start justify-between gap-3"},He={key:0,class:"text-xs text-zinc-500"},Ke={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ie={class:"flex items-center justify-between rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-2"},qe=["disabled"],Je={class:"flex items-center justify-between rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-2"},Qe=["disabled"],We={class:"space-y-1"},Xe=["disabled"],Ye={key:0,class:"text-xs text-rose-600"},Ze={class:"space-y-1"},ts=["disabled"],es={class:"space-y-1 md:col-span-2"},ss=["disabled"],is={key:0,class:"space-y-1 md:col-span-2"},ls=["disabled"],ns={class:"rounded-2xl border border-zinc-200 bg-white p-4"},as={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},os={class:"space-y-1"},ds=["disabled"],rs={class:"space-y-1 md:col-span-2"},ps=["disabled"],cs={class:"sticky bottom-0 z-20 flex items-center justify-between border-t bg-zinc-50 px-6 py-3"},us={class:"flex items-center gap-2"},ms=["disabled"],xs=["disabled"],bs={key:0},ys={key:1},vs={__name:"DonorAdminModal",setup(A){const b=R(),p=st(),{modalOpen:h,saving:v,formError:w,errors:U,selectedUser:l,histories:a,loadingHistories:B,historiesError:y,form:x}=T(b),z=J({company_id:"",department_id:"",employee_id:"",line_type:"all"}),N=F(()=>l.value),D=()=>b.closeModal(),n=m=>{m.key==="Escape"&&D()};E(h,m=>{var s;m?(window.addEventListener("keydown",n),(s=l.value)!=null&&s.id&&(z.value.employee_id=String(l.value.id))):(window.removeEventListener("keydown",n),z.value={company_id:"",department_id:"",employee_id:"",line_type:"all"})},{immediate:!0}),Y(()=>window.removeEventListener("keydown",n)),E(()=>x.value.last_donation_date,m=>b.setLastDonationDate(m)),E(()=>x.value.has_disease,m=>{m||(x.value.disease_note="")});const d=m=>{var g;const s=(g=U.value)==null?void 0:g[m];return s?Array.isArray(s)?s[0]||"":String(s):""},i=m=>m===!0||m===1||m==="1"||m==="true",k=m=>i(m==null?void 0:m.is_available),S=m=>k(m)?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":"bg-rose-50 text-rose-700 ring-1 ring-rose-200",W=m=>m==="active"?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":m==="inactive"?"bg-amber-50 text-amber-700 ring-1 ring-amber-200":m==="blocked"?"bg-rose-50 text-rose-700 ring-1 ring-rose-200":"bg-zinc-50 text-zinc-700 ring-1 ring-zinc-200",G=m=>{if(!m)return"—";const s=new Date(m);return Number.isNaN(s.getTime())?"—":s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})},X=async m=>{if(!m)return;const g=await p.fetchUser(m)||p.user;g!=null&&g.id&&b.openModalForUser({id:g.id,name:g.name,phone:g.phone,blood_group:g.blood_group||g.blood,address:g.address,alternate_phone:g.alternate_phone})};return(m,s)=>{var g,H,K;return e(h)?(o(),r("div",oe,[t("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-[2px]",onClick:s[0]||(s[0]=c=>e(v)?null:D)}),t("div",de,[t("div",re,[s[15]||(s[15]=t("div",{class:"space-y-0.5"},[t("h3",{class:"text-base font-semibold text-zinc-900"},"Update Donor Profile"),t("p",{class:"text-xs text-zinc-500"},"Admin panel • update donor availability & donation entry")],-1)),t("button",{type:"button",class:"inline-flex h-9 w-9 items-center justify-center rounded-full text-zinc-500 hover:bg-zinc-100 hover:text-zinc-700 disabled:opacity-50",onClick:D,disabled:e(v),"aria-label":"Close",title:"Close"},s[14]||(s[14]=[t("i",{class:"far fa-times"},null,-1)]),8,pe)]),t("div",ce,[e(w)?(o(),r("div",ue,u(e(w)),1)):f("",!0),t("div",me,[t("div",xe,[s[17]||(s[17]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Select employee"),t("p",{class:"text-xs text-zinc-500"},"Choose who you want to update")],-1)),(g=N.value)!=null&&g.blood_group?(o(),r("span",be,[s[16]||(s[16]=C(" Blood: ")),t("b",ye,u(N.value.blood_group),1)])):f("",!0)]),j(Q,{company_id:z.value.company_id,"onUpdate:company_id":s[1]||(s[1]=c=>z.value.company_id=c),department_id:z.value.department_id,"onUpdate:department_id":s[2]||(s[2]=c=>z.value.department_id=c),employee_id:z.value.employee_id,"onUpdate:employee_id":[s[3]||(s[3]=c=>z.value.employee_id=c),X],line_type:z.value.line_type,"onUpdate:line_type":s[4]||(s[4]=c=>z.value.line_type=c),"with-type":!0,"initial-value":z.value,class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"])]),t("div",ve,[t("div",_e,[t("div",ge,[s[21]||(s[21]=t("div",{class:"mb-3"},[t("h4",{class:"text-sm font-semibold text-zinc-900"},"User info")],-1)),N.value?(o(),r("div",fe,[t("div",he,[s[18]||(s[18]=t("span",{class:"text-zinc-500"},"Name",-1)),t("span",ze,u(N.value.name||"N/A"),1)]),t("div",we,[s[19]||(s[19]=t("span",{class:"text-zinc-500"},"Phone",-1)),t("span",ke,u(N.value.phone||"N/A"),1)]),t("div",$e,[s[20]||(s[20]=t("span",{class:"text-zinc-500"},"Address",-1)),t("span",Ae,u(N.value.address||"N/A"),1)])])):(o(),r("div",Ue,"Select an employee to view details."))]),t("div",Ne,[t("div",De,[s[22]||(s[22]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Donation history")],-1)),(H=e(a))!=null&&H.length?(o(),r("span",Se,u(e(a).length)+" items",1)):f("",!0)]),e(y)?(o(),r("div",Be,u(e(y)),1)):e(B)?(o(),r("div",Ce,s[23]||(s[23]=[t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1),t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1),t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1)]))):(K=e(a))!=null&&K.length?(o(),r("div",je,[(o(!0),r(L,null,M(e(a),c=>(o(),r("div",{key:c.id,class:"rounded-xl border border-zinc-200 p-3 hover:bg-zinc-50 transition"},[t("div",Le,[t("div",Pe,[t("div",Ee,u(G(c.last_donation_date)),1),t("div",Me," Available from: "+u(G(c.available_from)),1),c.availability_note?(o(),r("div",Oe,u(c.availability_note),1)):f("",!0)]),t("div",Fe,[t("span",{class:O(["rounded-full px-2 py-0.5 text-[11px] font-semibold",S(c)])},u(k(c)?"Available":"Not available"),3),t("span",{class:O(["rounded-full px-2 py-0.5 text-[11px] font-semibold",W(c.status)])},u(c.status||"N/A"),3)])])]))),128))])):(o(),r("div",Ve,s[24]||(s[24]=[C(" No donation history yet. "),t("div",{class:"mt-1 text-xs text-zinc-500"},"Create an entry from the form to the right.",-1)])))])]),t("div",Te,[t("div",Re,[t("div",Ge,[s[25]||(s[25]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Availability")],-1)),e(x).user_id?(o(),r("span",He,"User ID: "+u(e(x).user_id),1)):f("",!0)]),t("div",Ke,[t("div",Ie,[s[26]||(s[26]=t("div",null,[t("div",{class:"text-sm font-medium text-zinc-800"},"Available for donation"),t("div",{class:"text-xs text-zinc-500"},"Visible to seekers")],-1)),_(t("input",{"onUpdate:modelValue":s[5]||(s[5]=c=>e(x).is_available=c),type:"checkbox",class:"h-5 w-5",disabled:e(v)},null,8,qe),[[q,e(x).is_available]])]),t("div",Je,[s[27]||(s[27]=t("div",null,[t("div",{class:"text-sm font-medium text-zinc-800"},"Has disease"),t("div",{class:"text-xs text-zinc-500"},"Optional disclosure")],-1)),_(t("input",{"onUpdate:modelValue":s[6]||(s[6]=c=>e(x).has_disease=c),type:"checkbox",class:"h-5 w-5",disabled:e(v)},null,8,Qe),[[q,e(x).has_disease]])]),t("div",We,[s[28]||(s[28]=t("label",{class:"text-xs font-medium text-zinc-600"},"Last donation date *",-1)),_(t("input",{"onUpdate:modelValue":s[7]||(s[7]=c=>e(x).last_donation_date=c),type:"date",class:"input-1 h-10 w-full text-sm",disabled:e(v)},null,8,Xe),[[$,e(x).last_donation_date]]),d("last_donation_date")?(o(),r("div",Ye,u(d("last_donation_date")),1)):f("",!0)]),t("div",Ze,[s[29]||(s[29]=t("label",{class:"text-xs font-medium text-zinc-600"},"Available from",-1)),_(t("input",{"onUpdate:modelValue":s[8]||(s[8]=c=>e(x).available_from=c),type:"date",class:"input-1 h-10 w-full text-sm bg-zinc-100",readonly:"",disabled:e(v)},null,8,ts),[[$,e(x).available_from]])]),t("div",es,[s[30]||(s[30]=t("label",{class:"text-xs font-medium text-zinc-600"},"Availability note",-1)),_(t("input",{"onUpdate:modelValue":s[9]||(s[9]=c=>e(x).availability_note=c),class:"input-1 h-10 w-full text-sm",disabled:e(v)},null,8,ss),[[$,e(x).availability_note,void 0,{trim:!0}]])]),e(x).has_disease?(o(),r("div",is,[s[31]||(s[31]=t("label",{class:"text-xs font-medium text-zinc-600"},"Disease note",-1)),_(t("textarea",{"onUpdate:modelValue":s[10]||(s[10]=c=>e(x).disease_note=c),class:"input-1 min-h-[90px] w-full text-sm",disabled:e(v)},null,8,ls),[[$,e(x).disease_note,void 0,{trim:!0}]])])):f("",!0)])]),t("div",ns,[s[35]||(s[35]=t("div",{class:"mb-3"},[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Status & notes"),t("p",{class:"text-xs text-zinc-500"},"Visibility + internal remark")],-1)),t("div",as,[t("div",os,[s[33]||(s[33]=t("label",{class:"text-xs font-medium text-zinc-600"},"Status",-1)),_(t("select",{"onUpdate:modelValue":s[11]||(s[11]=c=>e(x).status=c),class:"input-1 h-10 w-full text-sm",disabled:e(v)},s[32]||(s[32]=[t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1),t("option",{value:"blocked"},"Blocked",-1)]),8,ds),[[V,e(x).status]])]),t("div",rs,[s[34]||(s[34]=t("label",{class:"text-xs font-medium text-zinc-600"},"Notes",-1)),_(t("textarea",{"onUpdate:modelValue":s[12]||(s[12]=c=>e(x).notes=c),class:"input-1 min-h-[110px] w-full text-sm",disabled:e(v)},null,8,ps),[[$,e(x).notes,void 0,{trim:!0}]])])])])])])]),t("div",cs,[s[36]||(s[36]=t("div",{class:"text-xs text-zinc-500"},[C(" Press "),t("span",{class:"rounded bg-white px-1.5 py-0.5 ring-1 ring-zinc-200"},"Esc"),C(" to close ")],-1)),t("div",us,[t("button",{type:"button",class:"btn-3",onClick:D,disabled:e(v)},"Cancel",8,ms),t("button",{type:"button",class:"btn-1",disabled:e(v)||!e(x).user_id||!e(x).last_donation_date,onClick:s[13]||(s[13]=c=>e(b).saveHistory())},[e(v)?(o(),r("span",bs,"Saving...")):(o(),r("span",ys,"Save"))],8,xs)])])])])):f("",!0)}}},_s={class:"space-y-4 p-5"},gs={key:0,class:"rounded-md border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700"},fs={key:1,class:"rounded-lg border border-dashed border-zinc-300 bg-white p-6 text-center text-sm text-zinc-500"},Bs={__name:"BloodDonorList",setup(A){const b=R(),{donors:p,meta:h,loading:v,error:w}=T(b),U=J(!1);Z(async()=>{U.value=!0,await b.fetchDonors()});const l=F(()=>JSON.stringify(b.filters));E(l,async()=>{U.value&&(b.setPage(1),await b.fetchDonors())});const a=async y=>{b.setPage(y),await b.fetchDonors()},B=y=>{b.openModalForUser({id:y.id,name:y.name,phone:y.phone,blood_group:y.blood,address:y.address,alternate_phone:y.alternate_phone}),b.form.user_id=String(y.id),b.form.is_available=!!Number(y.is_available||0),b.form.status=y.status||"inactive",b.form.availability_note=y.availability_note||"",b.form.notes=y.notes||"",b.form.last_donation_date=y.last_donation_date||"",b.setLastDonationDate(b.form.last_donation_date)};return(y,x)=>(o(),r("div",_s,[x[0]||(x[0]=t("div",{class:"flex items-center justify-between"},[t("h1",{class:"title-md md:title-lg"},"Blood Donors"),t("div",{class:"text-sm text-zinc-500"},"Admin only")],-1)),j(_t),e(w)?(o(),r("div",gs,u(e(w)),1)):f("",!0),j(ae,{donors:e(p),loading:e(v),meta:e(h),onEdit:B},null,8,["donors","loading","meta"]),!e(v)&&e(p).length===0&&!e(w)?(o(),r("div",fs," No donors found. Try adjusting the filters. ")):f("",!0),e(h).total>0?(o(),tt(et,{key:2,page:e(h).page,"per-page":e(h).per_page,total:e(h).total,"last-page":e(h).last_page,onPageChange:a},null,8,["page","per-page","total","last-page"])):f("",!0),j(vs)]))}};export{Bs as default};
