import{r as p,x as D,q as se,h as F,y as P,c as v,o as u,a as s,j as oe,s as c,w as o,k as j,O as U,b as le,t as L,F as G,e as X,a7 as re}from"./index-kBroZu5q.js";const ae={class:"w-full mx-auto"},ie={class:"flex items-center gap-2 flex-wrap bg-gray-100 p-2"},ue={class:"relative alignment-dropdown"},de={key:0,class:"absolute flex bg-white border border-gray-300 rounded mt-1 z-10"},fe={class:"relative color-dropdown"},ve={key:0,class:"absolute bg-white border border-gray-300 rounded mt-1 z-10 p-2 flex gap-1"},pe={class:"relative font-size-dropdown"},ce={key:0,class:"absolute bg-white border border-gray-300 rounded mt-1 z-10"},me=["onMousedown"],be=["src"],ge={key:1,class:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-[10px] uppercase text-gray-500 font-bold border border-gray-300"},ye={class:"flex flex-col"},xe={class:"text-sm font-medium"},Ce={key:0,class:"text-[10px] text-gray-500 leading-none"},we=["onMousedown"],ke={class:"flex items-center justify-between gap-2 w-full"},Le={class:"text-sm font-medium text-gray-800 truncate"},Se={class:"text-[10px] font-bold text-amber-600 shrink-0"},je={class:"flex items-center gap-2 mt-0.5"},he={class:"text-[9px] uppercase font-bold px-1 rounded bg-gray-100 text-gray-500 border border-gray-200"},Ee={__name:"TextEditor",props:{modelValue:{type:String,default:""},mentionableUsers:{type:Array,default:()=>[]},mentionableTasks:{type:Array,default:()=>[]},currentUser:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(J,{expose:Q,emit:W}){const S=J,Y=W,m=p(null);Q({focus:()=>{var n;(n=m.value)==null||n.focus()}});const d=p(!1),f=p(!1),O=p(""),T=p(""),y=p(0),x=p(0),h=p({top:0,left:0}),C=D(()=>{const n=S.mentionableUsers.filter(e=>{var t;return e.id!==((t=S.currentUser)==null?void 0:t.id)});return O.value?n.filter(e=>e.name.toLowerCase().includes(O.value.toLowerCase())):n}),w=D(()=>T.value?S.mentionableTasks.filter(n=>n.title.toLowerCase().includes(T.value.toLowerCase())||String(n.id).includes(T.value)):S.mentionableTasks),l=p({bold:!1,italic:!1,underline:!1,insertUnorderedList:!1,insertOrderedList:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,foreColor:"",fontSize:"16px"}),$=p(!1),z=p(!1),E=p(!1),Z={1:"10px",2:"13px",3:"16px",4:"18px",5:"24px",6:"32px",7:"48px"},_=D(()=>l.value.justifyLeft?"fa-align-left":l.value.justifyCenter?"fa-align-center":l.value.justifyRight?"fa-align-right":"fa-align-left"),ee=D(()=>l.value.foreColor||"black");se(()=>S.modelValue,n=>{m.value&&m.value.innerHTML!==n&&(m.value.innerHTML=n)});const r=(n,e=null)=>{document.execCommand(n,!1,e),N()},R=()=>{Y("update:modelValue",m.value.innerHTML)},N=()=>{l.value={bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),insertUnorderedList:document.queryCommandState("insertUnorderedList"),insertOrderedList:document.queryCommandState("insertOrderedList"),justifyLeft:document.queryCommandState("justifyLeft"),justifyCenter:document.queryCommandState("justifyCenter"),justifyRight:document.queryCommandState("justifyRight"),foreColor:document.queryCommandValue("foreColor"),fontSize:Z[document.queryCommandValue("fontSize")]||"16px"}},I=()=>{N()},M=()=>{const n=window.getSelection();if(!n.rangeCount)return;const e=n.getRangeAt(0).cloneRange();e.collapse(!1);const t=e.getClientRects();if(t.length>0){const a=t[0];h.value={top:a.bottom+5,left:a.left}}},te=n=>{d.value?n.key==="ArrowDown"?(n.preventDefault(),y.value=(y.value+1)%C.value.length):n.key==="ArrowUp"?(n.preventDefault(),y.value=(y.value-1+C.value.length)%C.value.length):n.key==="Enter"?(n.preventDefault(),C.value[y.value]&&q(C.value[y.value])):n.key==="Escape"&&(d.value=!1):f.value&&(n.key==="ArrowDown"?(n.preventDefault(),x.value=(x.value+1)%w.value.length):n.key==="ArrowUp"?(n.preventDefault(),x.value=(x.value-1+w.value.length)%w.value.length):n.key==="Enter"?(n.preventDefault(),w.value[x.value]&&B(w.value[x.value])):n.key==="Escape"&&(f.value=!1))},ne=()=>{const n=window.getSelection();if(!n.rangeCount)return;const e=n.getRangeAt(0);if(e.startContainer.nodeType!==Node.TEXT_NODE){d.value=!1,f.value=!1;return}const t=e.startContainer.textContent.substring(0,e.startOffset),a=t.lastIndexOf("@"),g=t.lastIndexOf("#"),k=t.lastIndexOf(" "),i=t.lastIndexOf(`
`),b=Math.max(k,i);if(a!==-1&&a>=b)if(a>0&&!/\s/.test(t[a-1]))d.value=!1;else{const A=t.substring(a+1);if(A.includes(" "))d.value=!1;else{O.value=A,d.value=!0,f.value=!1,y.value=0,M();return}}else d.value=!1;if(g!==-1&&g>=b)if(g>0&&!/\s/.test(t[g-1]))f.value=!1;else{const A=t.substring(g+1);if(A.includes(" "))f.value=!1;else{T.value=A,f.value=!0,d.value=!1,x.value=0,M();return}}else f.value=!1},q=n=>{const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0),a=t.startContainer,k=a.textContent.substring(0,t.startOffset).lastIndexOf("@");if(k!==-1){t.setStart(a,k),t.deleteContents();const i=document.createElement("span");i.className="mention-item text-blue-600 font-semibold",i.dataset.userId=n.id,i.textContent=`@${n.name}`,i.contentEditable="false",t.insertNode(i);const b=document.createTextNode(" ");i.after(b),t.setStartAfter(b),t.setEndAfter(b),e.removeAllRanges(),e.addRange(t)}d.value=!1,R()},B=n=>{const e=window.getSelection();if(!e.rangeCount)return;const t=e.getRangeAt(0),a=t.startContainer,k=a.textContent.substring(0,t.startOffset).lastIndexOf("#");if(k!==-1){t.setStart(a,k),t.deleteContents();const i=document.createElement("span");i.className="task-mention text-amber-600 font-semibold cursor-pointer underline",i.dataset.taskId=n.id,i.textContent=`#${n.id}`,i.title=n.title,i.contentEditable="false",t.insertNode(i);const b=document.createTextNode(" ");i.after(b),t.setStartAfter(b),t.setEndAfter(b),e.removeAllRanges(),e.addRange(t)}f.value=!1,R()};F(()=>{document.addEventListener("selectionchange",I),m.value.addEventListener("paste",n=>{n.preventDefault();const e=n.clipboardData.getData("text/plain");document.execCommand("insertText",!1,e)}),m.value.innerHTML=S.modelValue}),P(()=>{document.removeEventListener("selectionchange",I)});const V=n=>{!n.target.closest(".alignment-dropdown")&&!n.target.closest(".color-dropdown")&&!n.target.closest(".font-size-dropdown")&&($.value=!1,z.value=!1,E.value=!1),m.value&&!m.value.contains(n.target)&&(d.value=!1,f.value=!1)},H=n=>{n.key==="Escape"&&(d.value=!1,f.value=!1,$.value=!1,z.value=!1,E.value=!1)},K=()=>{(d.value||f.value)&&M()};return F(()=>{document.addEventListener("click",V),document.addEventListener("keydown",H),window.addEventListener("scroll",K,!0)}),P(()=>{document.removeEventListener("click",V),document.removeEventListener("keydown",H),window.removeEventListener("scroll",K,!0)}),(n,e)=>(u(),v("div",ae,[s("div",ie,[s("button",{type:"button",onClick:e[0]||(e[0]=o(t=>r("bold"),["stop","prevent"])),class:c([{"bg-blue-200 text-blue-700":l.value.bold,"hover:bg-gray-200":!l.value.bold},"p-2 flex items-center justify-center transition"])},e[22]||(e[22]=[s("i",{class:"fas fa-bold"},null,-1)]),2),s("button",{type:"button",onClick:e[1]||(e[1]=o(t=>r("italic"),["stop","prevent"])),class:c([{"bg-blue-200 text-blue-700":l.value.italic,"hover:bg-gray-200":!l.value.italic},"p-2 rounded flex items-center justify-center transition"])},e[23]||(e[23]=[s("i",{class:"fas fa-italic"},null,-1)]),2),s("button",{type:"button",onClick:e[2]||(e[2]=o(t=>r("underline"),["stop","prevent"])),class:c([{"bg-blue-200 text-blue-700":l.value.underline,"hover:bg-gray-200":!l.value.underline},"p-2 rounded flex items-center justify-center transition"])},e[24]||(e[24]=[s("i",{class:"fas fa-underline"},null,-1)]),2),s("button",{type:"button",onClick:e[3]||(e[3]=o(t=>r("insertUnorderedList"),["stop","prevent"])),class:c([{"bg-blue-200 text-blue-700":l.value.insertUnorderedList,"hover:bg-gray-200":!l.value.insertUnorderedList},"p-2 rounded flex items-center justify-center transition"])},e[25]||(e[25]=[s("i",{class:"fas fa-list-ul"},null,-1)]),2),s("button",{type:"button",onClick:e[4]||(e[4]=o(t=>r("insertOrderedList"),["stop","prevent"])),class:c([{"bg-blue-200 text-blue-700":l.value.insertOrderedList,"hover:bg-gray-200":!l.value.insertOrderedList},"p-2 rounded flex items-center justify-center transition"])},e[26]||(e[26]=[s("i",{class:"fas fa-list-ol"},null,-1)]),2),s("div",ue,[s("button",{onClick:e[5]||(e[5]=o(t=>$.value=!$.value,["stop","prevent"])),class:"p-2 rounded flex gap-2 items-center justify-center transition hover:bg-gray-200"},[s("i",{class:c(`fas ${_.value}`)},null,2),e[27]||(e[27]=s("i",{class:"fas fa-chevron-down ml-1"},null,-1))]),$.value?(u(),v("div",de,[s("button",{onClick:e[6]||(e[6]=o(t=>r("justifyLeft"),["stop","prevent"])),class:c([{"bg-blue-200 text-blue-700":l.value.justifyLeft,"hover:bg-gray-200":!l.value.justifyLeft},"p-2 flex items-center justify-center"])},e[28]||(e[28]=[s("i",{class:"fas fa-align-left"},null,-1)]),2),s("button",{onClick:e[7]||(e[7]=o(t=>r("justifyCenter"),["stop","prevent"])),class:c([{"bg-blue-200 text-blue-700":l.value.justifyCenter,"hover:bg-gray-200":!l.value.justifyCenter},"p-2 flex items-center justify-center"])},e[29]||(e[29]=[s("i",{class:"fas fa-align-center"},null,-1)]),2),s("button",{onClick:e[8]||(e[8]=o(t=>r("justifyRight"),["stop","prevent"])),class:c([{"bg-blue-200 text-blue-700":l.value.justifyRight,"hover:bg-gray-200":!l.value.justifyRight},"p-2 flex items-center justify-center"])},e[30]||(e[30]=[s("i",{class:"fas fa-align-right"},null,-1)]),2)])):j("",!0)]),s("div",fe,[s("button",{onClick:e[9]||(e[9]=o(t=>z.value=!z.value,["stop","prevent"])),class:"p-2 rounded flex gap-2 items-center justify-center transition hover:bg-gray-200"},[s("span",{style:U({color:ee.value})},e[31]||(e[31]=[s("i",{class:"fas fa-palette"},null,-1)]),4),e[32]||(e[32]=s("i",{class:"fas fa-chevron-down ml-1"},null,-1))]),z.value?(u(),v("div",ve,[s("button",{onClick:e[10]||(e[10]=o(t=>r("foreColor","black"),["stop","prevent"])),class:"size-4",style:{background:"black"}}),s("button",{onClick:e[11]||(e[11]=o(t=>r("foreColor","red"),["stop","prevent"])),class:"size-4",style:{background:"red"}}),s("button",{onClick:e[12]||(e[12]=o(t=>r("foreColor","green"),["stop","prevent"])),class:"size-4",style:{background:"green"}}),s("button",{onClick:e[13]||(e[13]=o(t=>r("foreColor","blue"),["stop","prevent"])),class:"size-4",style:{background:"blue"}})])):j("",!0)]),s("div",pe,[s("button",{onClick:e[14]||(e[14]=o(t=>E.value=!E.value,["stop","prevent"])),class:"p-2 rounded flex gap-2 items-center justify-center transition hover:bg-gray-200"},[le(L(l.value.fontSize)+" ",1),e[33]||(e[33]=s("i",{class:"fas fa-chevron-down ml-1"},null,-1))]),E.value?(u(),v("div",ce,[s("button",{onClick:e[15]||(e[15]=o(t=>r("fontSize","1"),["stop","prevent"])),class:"p-2"},"10px"),s("button",{onClick:e[16]||(e[16]=o(t=>r("fontSize","2"),["stop","prevent"])),class:"p-2"},"13px"),s("button",{onClick:e[17]||(e[17]=o(t=>r("fontSize","3"),["stop","prevent"])),class:"p-2"},"16px"),s("button",{onClick:e[18]||(e[18]=o(t=>r("fontSize","4"),["stop","prevent"])),class:"p-2"},"18px"),s("button",{onClick:e[19]||(e[19]=o(t=>r("fontSize","5"),["stop","prevent"])),class:"p-2"},"24px"),s("button",{onClick:e[20]||(e[20]=o(t=>r("fontSize","6"),["stop","prevent"])),class:"p-2"},"32px"),s("button",{onClick:e[21]||(e[21]=o(t=>r("fontSize","7"),["stop","prevent"])),class:"p-2"},"48px")])):j("",!0)])]),s("div",{ref_key:"editor",ref:m,contenteditable:"true",onInput:R,onKeyup:ne,onKeydown:te,class:"editable-div border border-gray-300 p-4 rounded-md min-h-[200px] focus:outline-sky-600 max-h-[1000px] bg-white overflow-auto resize-y whitespace-normal",placeholder:"Description"},null,544),(u(),oe(re,{to:"body"},[d.value&&C.value.length?(u(),v("div",{key:0,class:"fixed z-[9999] bg-white border border-gray-300 rounded shadow-lg max-h-60 overflow-y-auto min-w-[200px]",style:U({top:`${h.value.top}px`,left:`${h.value.left}px`})},[(u(!0),v(G,null,X(C.value,(t,a)=>(u(),v("div",{key:t.id,onMousedown:o(g=>q(t),["prevent"]),class:c(["px-4 py-2 cursor-pointer flex items-center gap-2 hover:bg-blue-50 border-b last:border-0",{"bg-blue-100":a===y.value}])},[t.photo?(u(),v("img",{key:0,src:t.photo,class:"w-6 h-6 rounded-full object-cover",alt:""},null,8,be)):(u(),v("div",ge,L(t.name.charAt(0)),1)),s("div",ye,[s("span",xe,L(t.name),1),t.department?(u(),v("span",Ce,L(t.department.short_name||t.department.name),1)):j("",!0)])],42,me))),128))],4)):j("",!0),f.value&&w.value.length?(u(),v("div",{key:1,class:"fixed z-[9999] bg-white border border-gray-300 rounded shadow-lg max-h-60 overflow-y-auto min-w-[250px]",style:U({top:`${h.value.top}px`,left:`${h.value.left}px`})},[(u(!0),v(G,null,X(w.value,(t,a)=>(u(),v("div",{key:t.id,onMousedown:o(g=>B(t),["prevent"]),class:c(["px-4 py-2 cursor-pointer flex flex-col hover:bg-amber-50 border-b last:border-0",{"bg-amber-100":a===x.value}])},[s("div",ke,[s("span",Le,L(t.title),1),s("span",Se,"#"+L(t.id),1)]),s("div",je,[s("span",he,L(t.status),1)])],42,we))),128))],4)):j("",!0)]))]))}};export{Ee as _};
