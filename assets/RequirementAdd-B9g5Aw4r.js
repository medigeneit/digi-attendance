import{s as U,r as v,m as j,z as A,e as D,c as l,o as a,a as t,f as L,g as c,w,k as o,j as g,t as _,p as b,F as M,i as C,u as W}from"./index-DAvUzAED.js";import{_ as N}from"./CompanyDepartmentSelectInput-B-DiMtEs.js";import{R as I}from"./RequiredIcon-uJKmq-sr.js";import{a as E}from"./requirement-BTnUbB1A.js";import{u as G}from"./company-Bakhb-Z9.js";import{u as H}from"./tags-FU1yCq58.js";import{u as J}from"./useRequirementStore-CdTS4r3F.js";import{u as K}from"./useTaskStore-DJ71wtzW.js";import{L as O}from"./LoaderView-Dbu2g8oy.js";import{_ as P}from"./MultiselectDropdown-mVfOvqoV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"max-h-[90vh] overflow-auto max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},X={class:"sticky top-0 pt-4 bg-white z-10"},Y={key:0,class:"text-center mt-2 mb-6"},Z={class:"text-sky-600"},ee={key:1,class:"text-center mt-2 mb-6"},te={class:"text-sky-600"},se={class:"mb-4"},oe={class:"block text-gray-600 text-sm mb1 font-medium"},ae={class:"block text-gray-600 text-sm mb-1 font-medium"},re={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ne={key:0,class:"mb-4 text-red-500 font-medium"},ie={key:1,class:"mb-4"},le={class:"flex items-center justify-between gap-4"},me=["disabled"],ue={__name:"RequirementAddForm",props:{parentTaskId:{type:[Number,String],required:!0},requirementId:{type:[Number,String]}},emits:["taskCreated","close","error"],setup(f,{emit:x}){const m=x,r=K(),u=H(),d=G(),$=J(),{requirement:h}=U($),y=v(),F=v([]),z=j(()=>F.value.map(n=>n.id)),s=v(""),k=v([]),p=v({from_department_id:"",to_department_id:"",website_tags:[]});A(z,n=>{p.value.user_ids=n}),D(async()=>{s.value="loading",u.fetchTags("website"),await d.fetchCompanies({with:"departments",ignore_permission:!0}),s.value=""});async function B(){s.value="submitting";const n={...p.value,website_tags:[k.value.id]};console.log({payload:n});try{const e=await E(n);m("create",e),s.value="create"}catch{m("error",r.error),s.value="error"}}return(n,e)=>{var q,S,V,R,T;return a(),l("div",Q,[t("div",X,[e[5]||(e[5]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Requirement",-1)),e[6]||(e[6]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=w(i=>m("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),t("form",{onSubmit:w(B,["prevent"]),class:"z-0"},[f.requirementId&&((q=o(h))!=null&&q.title)?(a(),l("p",Y,[e[7]||(e[7]=g(" Task under requirement ")),t("span",Z,_(o(h).title),1)])):c("",!0),f.parentTaskId&&((S=y.value)!=null&&S.title)?(a(),l("p",ee,[e[8]||(e[8]=g(" Sub task under ")),t("span",te,_(y.value.title),1)])):c("",!0),t("div",se,[e[9]||(e[9]=t("label",{class:"text-gray-800"},"Websites",-1)),b(P,{options:o(u).tags,modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=i=>k.value=i),label:"name","track-by":"id"},null,8,["options","modelValue"])]),s.value!=="loading"&&!(f.parentTaskId&&((V=y.value)!=null&&V.title))?(a(),l(M,{key:2},[b(N,{modelValue:p.value.from_department_id,"onUpdate:modelValue":e[2]||(e[2]=i=>p.value.from_department_id=i),companies:((R=o(d))==null?void 0:R.companies)||[],class:"mb-4"},{label:C(()=>[t("label",oe,[e[10]||(e[10]=g(" From Department ")),b(I)])]),_:1},8,["modelValue","companies"]),b(N,{modelValue:p.value.to_department_id,"onUpdate:modelValue":e[3]||(e[3]=i=>p.value.to_department_id=i),companies:((T=o(d))==null?void 0:T.companies)||[],class:"mb-4"},{label:C(()=>[t("label",ae,[e[11]||(e[11]=g(" To Department ")),b(I)])]),_:1},8,["modelValue","companies"])],64)):c("",!0),t("div",re,[o(r).error?(a(),l("div",ne,_(o(r).error),1)):c("",!0),o(r).error?(a(),l("hr",ie)):c("",!0),t("div",le,[t("button",{disabled:s.value=="loading"||s.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},_(s.value=="submitting"?"Saving...":"Next"),9,me),t("button",{type:"button",onClick:e[4]||(e[4]=w(i=>m("close"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])])],32),s.value==="loading"||s.value==="submitting"?(a(),L(O,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)])}}},de={class:"container mx-auto p-6"},he={__name:"RequirementAdd",setup(f){const x=W();function m(r){var d;const u=((d=r.data)==null?void 0:d.requirement)||null;u&&x.push({name:"RequirementShow",params:{id:u.id}})}return(r,u)=>(a(),l("div",de,[b(ue,{onCreate:m})]))}};export{he as default};
