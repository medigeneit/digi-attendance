import{_ as de}from"./CommentModal-Crd4jHAN.js";import{_ as me,a as pe}from"./TaskUserAssignForm-jXrjhZ25.js";import{L as ye}from"./LoaderView-2y8hRWTC.js";import{O as X}from"./OverlyModal-C74IdHBu.js";import{_ as ce}from"./TaskAddForm-BQgtHnQ7.js";import{_ as ve}from"./TaskEditForm-Cif2vWhB.js";import{d as ne,b as te,p as f,r as O,e as re,q as ee,C as ke,c as d,o,a as l,g as V,f as D,F as R,y as L,i as E,t as z,k as r,h as j,A as fe,H as Y,v as ge,x as Q,j as Z,w as be,n as se,u as xe,z as le,I as we}from"./index-XaBu5W-t.js";import{g as Te,u as Ce}from"./task-priority-BetRi5Yx.js";import{u as Ie}from"./company-CUjkeftj.js";import{_ as ae}from"./CompanyDepartmentSelectInput-D7B3hA_U.js";import{_ as Me}from"./EmployeeDropdownInput-D9RMSCaL.js";import{_ as oe,m as ie}from"./task-tree-C1QYVKfb.js";import{S as Ve}from"./SelectDropdown-D0Z5Ty1F.js";import{_ as ue}from"./TaskTreeViewWithSubTable-C082hNr8.js";import{_ as Ae}from"./UserChip-BlCQdXkO.js";import{u as _e}from"./useTaskStore-CMmqiQah.js";import"./useCommentStore-DgF_J_Ud.js";import"./datetime-C4Yr_jSk.js";import"./TextWithHr-Cc4R5KgV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-CRajDTWu.js";import"./MultiselectDropdown-MfQzgLZv.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-ChJifQUX.js";import"./TaskUserChip-iZtvw5AT.js";import"./RequiredIcon-dEPUVqs3.js";import"./useRequirementStore-CpXSYM6y.js";import"./requirement-CLf649Rq.js";import"./SectionLoading-DMFiHK-y.js";import"./tags-vO1aVilN.js";import"./url-CePbr-gY.js";import"./TaskSupervisorAndEmployee-GMOoy601.js";const qe={class:"mb-3 task-header"},Ue={class:"flex justify-between items-start mb-4"},Le={key:0,class:"ml-auto flex gap-6 items-center"},he={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},$e={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},De={class:"relative"},Ee=["title"],Se={key:0},Be={key:1,class:"text-gray-500 whitespace-nowrap"},Oe={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Pe={class:"relative"},Fe={class:"w-32 relative h-10"},Ne={class:"flex gap-4 items-center flex-shrink-0"},je={class:"flex gap-2"},ze={class:"flex gap-2"},Re={class:"flex gap-2"},He={class:"text-gray-600 w-full md:w-32 relative"},We={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},Ge={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},Ke={key:0,class:"text-[9px] text-green-800"},Je=["onClick"],Qe={key:1,class:"flex justify-end gap-5"},Xe={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup($,{emit:w}){const m=$,i=ne(),T=te(),y=f(x("company-id")),h=f(x("from-department-id")),A=f(x("to-department-id")),u=f(x("user-ids")),n=f(x("month")),c=f(x("status")),g=f(x("is-important")),b=f(x("is-urgent")),I=f(x("is-target")),P=f(x("search")),H=w,_=Ie(),S=O([]);function x(v){return{get:()=>m.modelValue[v]||"",set:e=>{H("update:modelValue",{...m.modelValue,[v]:e||void 0})}}}const B=f(()=>W(u.value));async function N(){var v,e,M;if(!m.isMyTask){const a=(v=m.modelValue)==null?void 0:v["company-id"],t=A.value,C={...a?{company_id:a}:{},...t?{department_ids:[t]}:{}};S.value=((M=(e=await Te({params:C}))==null?void 0:e.data)==null?void 0:M.employees)||[]}}re(async()=>{await _.fetchCompanies({with:"departments",ignore_permission:!0}),await _.fetchMyCompanies({with:"departments"}),await N()});function W(v){return Array.isArray(S.value)&&S.value.find(e=>e.id==v)||null}function G(){u.value=""}ee(()=>A.value,N),ee(()=>y.value,()=>{h.value="",A.value=""});function F(v,e,{value:M,id:a,label:t,onCancel:C}={}){if(!v)return[];const k=Array.isArray(e)?e.find(q=>(q==null?void 0:q[a])==v):null;return k?[{label:t,value:typeof M=="function"?M(k):k==null?void 0:k[M],id:k==null?void 0:k[a],onCancel:C}]:[]}const K=f(()=>{var a;const v=_.companies.reduce((t,C)=>[...t,...C.departments],[]),e=(t,{label:C,value:k,id:q,onCancel:p})=>t?[{label:C,value:k,id:q,onCancel:p}]:[],M=(t,{label:C,onCancel:k})=>{if(!t)return[];const q=new Date(t);return[{label:C,value:q.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:t,onCancel:k}]};return[...F(y.value,_.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{y.value=""}}),...F(h.value,v,{id:"id",label:"From",value:t=>t.short_name||t.name,onCancel:()=>{h.value=""}}),...F(A.value,v,{id:"id",label:"To",value:t=>t.short_name||t.name,onCancel:()=>{A.value=""}}),...F((a=B.value)==null?void 0:a.id,S.value,{label:"Employee",value:"name",id:"id",onCancel:G}),...F(c.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{c.value=""}}),...e(g.value,{label:"",value:"Important ",id:!0,onCancel:()=>{g.value=""}}),...e(b.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{b.value=""}}),...e(I.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{I.value=""}}),...M(n.value,{label:"",onCancel:()=>{n.value=""}})]}),J=f(()=>y.value?_==null?void 0:_.companies.filter(v=>v.id==y.value):_==null?void 0:_.companies);return(v,e)=>{var a,t,C,k,q,p;const M=ke("RouterLink");return o(),d("div",null,[l("div",qe,[l("div",Ue,[e[12]||(e[12]=l("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),$.isMyTask?V("",!0):(o(),d("div",Le,[l("button",{onClick:e[0]||(e[0]=s=>H("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),l("div",he,[l("div",$e,[$.isMyTask?V("",!0):(o(),d(R,{key:0},[l("div",De,[L(Ve,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=s=>y.value=s),options:((a=r(_))==null?void 0:a.companies)||[],label:"name",id:"id",class:"border-2 border-gray-300 rounded h-[40px] w-full md:w-48 bg-white text-sm",clearable:""},{"selected-option":E(({option:s})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:s==null?void 0:s.name},[s!=null&&s.name?(o(),d("span",Se,z(s==null?void 0:s.name),1)):(o(),d("span",Be,"--Select Company--"))],8,Ee)]),_:1},8,["modelValue","options"]),e[13]||(e[13]=l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),L(ae,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=s=>h.value=s),companies:J.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300"},defaultOption:"--ALL DEPARTMENT--"},{label:E(()=>e[14]||(e[14]=[l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),r(T).name!=="MyTaskList"?(o(),D(ae,{key:0,modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=s=>A.value=s),companies:J.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300  "},defaultOption:"--ALL DEPARTMENT--"},{label:E(()=>e[15]||(e[15]=[l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):V("",!0),r(i).isAdminMood&&((C=(t=r(i))==null?void 0:t.user)==null?void 0:C.role)!=="employee"?(o(),d("div",Oe,[l("div",Pe,[L(Me,{employees:S.value,modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),class:"border-2 border-gray-300 rounded h-[40px] w-full bg-white !text-sm"},null,8,["employees","modelValue"]),e[16]||(e[16]=l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))]),e[17]||(e[17]=l("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):V("",!0)],64)),l("div",Fe,[e[19]||(e[19]=l("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),j(l("select",{"onUpdate:modelValue":e[5]||(e[5]=s=>c.value=s),class:"h-full text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[18]||(e[18]=[l("option",{value:""},"--ALL TASKS--",-1),l("option",{value:"not-completed"},"Not Completed",-1),l("option",{value:"only-completed"},"Completed",-1)]),512),[[fe,c.value]])]),l("div",Ne,[l("label",je,[j(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s)},null,512),[[Y,g.value]]),e[20]||(e[20]=l("span",null,"Important",-1))]),l("label",ze,[j(l("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>b.value=s)},null,512),[[Y,b.value]]),e[21]||(e[21]=l("span",null,"Urgent",-1))]),l("label",Re,[j(l("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=s=>I.value=s)},null,512),[[Y,I.value]]),e[22]||(e[22]=l("span",null,"Is Target",-1))])]),l("div",He,[e[23]||(e[23]=l("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),j(l("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=s=>n.value=s),type:"month",class:"h-10 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[ge,n.value]])])]),$.isMyTask?(o(),D(oe,{key:0,modelValue:P.value,"onUpdate:modelValue":e[10]||(e[10]=s=>P.value=s),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):V("",!0)])]),l("div",We,[$.isMyTask?V("",!0):(o(),D(oe,{key:0,modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=s=>P.value=s),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),l("div",Ge,[(o(!0),d(R,null,Q(K.value,s=>(o(),d("div",{key:s.label||s.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[l("div",null,[s.label?(o(),d("span",Ke,z(s.label)+": ",1)):V("",!0),Z(z(s.value),1)]),l("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:be(s.onCancel,["prevent"])},e[24]||(e[24]=[l("i",{class:"fas fa-times-circle"},null,-1)]),8,Je)]))),128))]),$.isMyTask?V("",!0):(o(),d("div",Qe,[L(M,{class:se(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((k=r(T).query)==null?void 0:k.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...r(T).query,view:"userwise"}}},{default:E(()=>e[25]||(e[25]=[Z(" User Wise List ")])),_:1,__:[25]},8,["class","to"]),L(M,{class:se(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((q=r(T).query)==null?void 0:q.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((p=r(T))==null?void 0:p.query)||{}).filter(s=>{var U;return((U=r(T))==null?void 0:U.query[s])!=="userwise"}).reduce((s,U)=>({...s,[U]:r(T).query[U]}),{})}}},{default:E(()=>e[26]||(e[26]=[Z(" TaskWise List ")])),_:1,__:[26]},8,["class","to"])]))])])}}},Ye={class:"w-full bg-white rounded"},Ze={class:"border p-4 align-top border-green-300 bg-blue-50"},et={class:"sticky top-[7rem] bg-white/80 py-2 z-40"},tt={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup($,{emit:w}){const m=$,i=te(),T=w,y=f(()=>m.tasks.reduce((u,n)=>(u.push(...n.users.filter(c=>!u.find(g=>g.id==c.id&&c.id))),u),[]).filter(u=>m.selectedUserId?u.id==m.selectedUserId:!0)),h=u=>{const c=m.tasks.filter(g=>g.users.some(b=>b.id===u));return ie(c,{...i.query,"user-ids":u})},A=f(()=>y.value.map(u=>{const n=h(u.id);return{...u,tasks:n}}));return(u,n)=>(o(),d("div",null,[l("table",Ye,[l("tbody",null,[(o(!0),d(R,null,Q(A.value,c=>(o(),d("tr",{key:c.id},[l("td",Ze,[l("div",null,[l("div",et,[L(Ae,{user:c,class:""},null,8,["user"])]),(o(!0),d(R,null,Q(c.tasks,(g,b)=>(o(),D(ue,{key:g.id,task:g,class:"!border-0 my-4",index:b,isMyTask:$.isMyTask,onCommentButtonClick:n[0]||(n[0]=I=>T("commentButtonClick",u.item.id)),onEditClick:n[1]||(n[1]=I=>T("editClick",I)),onAddClick:n[2]||(n[2]=I=>T("addClick",I)),onEmployeeAssignClick:n[3]||(n[3]=I=>T("employeeAssignClick",I))},null,8,["task","index","isMyTask"]))),128))])])]))),128))])])]))}},st={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},lt={class:"mb-4"},at={class:"relative min-h-[30vh]"},ot={key:0,class:"text-center py-4 text-red-500"},nt={key:1},rt={class:"flex items-stretched"},it={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},ut=1,Nt={__name:"TaskList",setup($){const w=_e(),m=ne(),i=te(),T=xe(),y=O(""),h=O(!1),A=O(null),u=f(()=>{var a;return((a=m==null?void 0:m.user)==null?void 0:a.role)==="employee"||!(m!=null&&m.isAdminMood)?!0:!!i.query["user-ids"]}),n=O(null),c=O(!1),g=le({parentId:0,requirementId:0}),b=le({taskId:0,isOpen:!1}),I=O(null),P=O([]),{handleItemsPriorityUpdate:H,saveTaskPriority:_,listHasRearranged:S}=Ce(()=>w.taskListTree,0);re(async()=>{console.log("Task List Mounted"),y.value="loading",i.query.status||T.push({query:{...i.query,status:"not-completed"}}),await B()});let x;async function B(){let a;x=new AbortController,console.log({taskAbortController:x}),i.name==="MyTaskList"?a=await w.fetchMyTasks({...i.query,page:1},{signal:x.signal}):a=await w.fetchTasks({...i.query,page:1},{signal:x.signal}),y.value="",P.value=a.query_log||[]}const N=a=>{c.value=!0,g.parentId=a},W=a=>{b.taskId=a,b.isOpen=!0},G=a=>{A.value=a,h.value=!0},F=()=>{h.value=!1,A.value=null};async function K(){n.value=null,c.value=!1,g.parentId=0,y.value="loading",await B()}async function J(){c.value=!1,g.parentId=0,await B()}async function v(){y.value="loading",await _()&&await B()}ee(()=>({...i.query}),async()=>{try{w.resetTaskList(),y.value="loading",await B()}catch{console.warn("...")}});const e=f({get(){return{...i.query}},set(a){localStorage.removeItem("sub_task_opened_list"),T.push({query:{...a}})}}),M=f(()=>{var t;const a={...i.query};return i.name=="MyTaskList"&&(a["user-ids"]=(t=m==null?void 0:m.user)==null?void 0:t.id),Array.isArray(w.tasks)?ie(w.tasks,a):[]});return we(()=>{w.tasks.value=null,x&&x.abort()}),(a,t)=>{var C,k,q;return o(),d("div",st,[n.value?(o(),D(X,{key:0},{default:E(()=>[L(ve,{taskId:n.value,onClose:t[0]||(t[0]=p=>n.value=null),onUpdated:K},null,8,["taskId"])]),_:1})):V("",!0),c.value?(o(),D(X,{key:1},{default:E(()=>[L(ce,{parentTaskId:g.parentId,requirementId:g.requirementId,onClose:J,onTaskCreated:K},null,8,["parentTaskId","requirementId"])]),_:1})):V("",!0),b.isOpen?(o(),D(X,{key:2,class:"*:max-w-4xl"},{default:E(()=>[L(me,{taskId:b.taskId,onCancelClick:t[1]||(t[1]=()=>{b.isOpen=!1,b.taskId=0}),onSuccess:t[2]||(t[2]=()=>{b.isOpen=!1,b.taskId=0,y.value="loading",B()})},null,8,["taskId"])]),_:1})):V("",!0),L(Xe,{modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=p=>e.value=p),onClickAddTask:N,onClickPrioritySave:v,onClickPriorityDiscard:t[4]||(t[4]=()=>r(S)?I.value.resetItems:null),"list-has-rearranged":r(S),isMyTask:r(i).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((k=(C=r(i))==null?void 0:C.query)==null?void 0:k["query-log"])=="true"?(o(!0),d(R,{key:3},Q(P.value,(p,s)=>(o(),d("div",{key:s,class:"text-xs text-gray-500"},[l("div",lt,z(p.raw_query),1)]))),128)):V("",!0),l("div",at,[r(w).error?(o(),d("div",ot,z(r(w).error),1)):r(w).tasks.length>0?(o(),d("div",nt,[((q=r(i).query)==null?void 0:q.view)=="userwise"?(o(),D(tt,{key:0,tasks:M.value,selectedUserId:r(i).query["user-ids"],isMyTask:r(i).name==="MyTaskList",onCommentButtonClick:t[5]||(t[5]=p=>G(p,a.task.id)),onEditClick:t[6]||(t[6]=p=>n.value=p),onAddClick:t[7]||(t[7]=p=>N(p)),onEmployeeAssignClick:t[8]||(t[8]=p=>W(p))},null,8,["tasks","selectedUserId","isMyTask"])):(o(),D(pe,{key:1,items:M.value,handle:"handle",onItemsUpdate:r(H),class:"space-y-6",ref_key:"draggableTaskList",ref:I},{item:E(({item:p,index:s})=>[l("div",rt,[L(ue,{isMyTask:r(i).name==="MyTaskList",task:p,index:s,showDraggableHandle:!u.value,onCommentButtonClick:t[9]||(t[9]=U=>G(U,a.task.id)),onEditClick:t[10]||(t[10]=U=>n.value=U),onAddClick:t[11]||(t[11]=U=>N(U)),onEmployeeAssignClick:t[12]||(t[12]=U=>W(U)),class:"!border-0 shadow hover:shadow-md"},null,8,["isMyTask","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):y.value!=="loading"?(o(),d("div",it," No tasks found. ")):V("",!0),y.value==="loading"?(o(),D(ye,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):V("",!0)]),L(de,{show:h.value,"commentable-id":A.value,"commentable-type":"task","user-id":ut,"on-close":F,onSubmitted:r(w).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Nt as default};
