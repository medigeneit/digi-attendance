import{r as M,b as F,m as p,c as r,o as a,g as i,a as e,F as U,y as Z,x as A,t as d,p as h,j as y,k as x,f,w as b,A as ee,n as te,i as V,L as se}from"./index-BaOyklmU.js";import{_ as H,T as J,a as G,b as K}from"./TaskUrgentBadge-BAMpnIhQ.js";import{_ as ae,a as Q}from"./TaskAssignedUsers-BtXVizL_.js";import{d as W,b as w}from"./datetime-Efw590t9.js";import{o as le}from"./url-CePbr-gY.js";import{T as X}from"./TaskIsClosedBadge-CVMrEAKv.js";import{_ as ie}from"./TaskSupervisorAndEmployee-DH4hhWXp.js";const re={class:"w-full"},ne={key:0,class:"w-full"},oe={class:"border-y text-center py-2 px-1 border-gray-200"},de={key:0,class:"text-base font-semibold text-purple-600"},ce={class:"border px-3 py-1 border-gray-200 relative"},ue={class:"flex items-center justify-between gap-2"},ge={class:"flex items-center gap-3"},xe={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},ye={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},fe={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},ke={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},me=["href","onClick"],pe={class:"border px-3 py-1 border-gray-200"},he={class:"flex gap-2 justify-between items-center relative w-full"},be={class:"shrink-0"},we=["href","onClick"],ve={class:"border px-3 py-1 border-gray-200 text-center"},Te={key:0,class:"text-gray-500 text-sm"},$e={class:"font-semibold text-blue-800 whitespace-nowrap"},Ce={class:"border px-3 py-1 border-gray-200 text-center"},_e={key:0,class:"ml-4 text-gray-500 text-sm"},Ae={class:"text-blue-500 font-semibold whitespace-nowrap"},Be={class:"border px-3 py-1 border-gray-200 text-center"},De={key:0,class:"text-gray-500 text-sm whitespace-nowrap"},Le={class:"font-semibold text-blue-800"},Se={class:"border-y px-3 border-gray-200 sticky right-0 border-l bg-sky-50"},Me={class:"flex justify-end flex-wrap gap-2 py-2"},je={class:"flex gap-1 items-center text-sm"},ze={key:1,class:"text-red-800 italic"},Ee=["href"],Ne={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},parentTask:{type:Object},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick"],setup(t,{emit:B}){const c=t,k=M(!1),C=F(),m=p(()=>k.value?c.childrenTasks:c.childrenTasks.slice(0,c.maxItem)),v=p(()=>k.value?[]:c.childrenTasks.slice(c.maxItem));function D(){k.value=!k.value}const u=B;return(L,n)=>{var T;return a(),r("div",re,[((T=t.childrenTasks)==null?void 0:T.length)>0?(a(),r("table",ne,[n[5]||(n[5]=e("thead",null,[e("tr",null,[e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Date "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Started "),e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(a(!0),r(U,null,Z(m.value,(s,$)=>{var _;return a(),r("tr",{key:s.id,class:A(["group/sub-task-row",{" bg-green-400/20":s.status=="COMPLETED"," bg-white hover:bg-slate-50":s.status!=="COMPLETED"}])},[e("td",oe,[$!==void 0?(a(),r("div",de,d($+1)+". ",1)):i("",!0)]),e("td",ce,[e("div",ue,[e("div",null,[e("div",ge,[h(H,{titleClass:"text-sm",task:s,"sub-tasks-open":!1,isMyTask:t.isMyTask,to:t.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",xe,[e("div",ye,[n[1]||(n[1]=e("i",{class:"fas fa-clock"},null,-1)),y(" "+d(x(W)(s.created_at)),1)]),e("div",fe,[s!=null&&s.is_important?(a(),f(J,{key:0})):i("",!0),s!=null&&s.is_urgent?(a(),f(G,{key:1})):i("",!0)]),e("div",ke,[n[2]||(n[2]=e("i",{class:"fas fa-tasks"},null,-1)),y(" "+d(s==null?void 0:s.todos_count),1)])])]),!s.is_closed&&!t.hideButtons?(a(),r("a",{key:0,href:`/tasks/edit/${s.id}`,onClick:b(o=>u("editClick",s.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},n[3]||(n[3]=[e("i",{class:"fas fa-edit"},null,-1)]),8,me)):i("",!0)])]),e("td",pe,[e("div",he,[h(ae,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:s.users||[],isTargetTask:s.is_target,maxItem:1,"route-to":o=>`/tasks?status=not-completed&view=userwise&user-ids=${o.id}`},null,8,["users","isTargetTask","route-to"]),e("div",be,[!s.is_closed&&!t.hideButtons?(a(),r("a",{key:0,href:`/tasks/${s.id}/assign-users`,onClick:b(o=>u("employeeAssignClick",s.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},n[4]||(n[4]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,we)):i("",!0)])])]),e("td",ve,[s.assigned_at?(a(),r("span",Te,[e("span",$e,d(x(w)(s.assigned_at)),1)])):i("",!0)]),e("td",Ce,[s.deadline?(a(),r("span",_e,[e("span",Ae,d(x(w)(s.deadline)),1)])):i("",!0)]),e("td",Be,[s.started_at?(a(),r("span",De,[e("span",Le,d(x(w)(s.started_at)),1)])):i("",!0)]),e("td",Se,[e("div",Me,[s.closed_at?(a(),f(X,{key:0})):i("",!0),h(Q,{status:s==null?void 0:s.status,progressPercent:(s==null?void 0:s.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((_=s==null?void 0:s.children_tasks)==null?void 0:_.length)>0?(a(),f(K,{key:1,ref_for:!0,ref:"progress",task:s,class:"text-sm w-full"},null,8,["task"])):i("",!0)])])],2)}),128))])])):i("",!0),e("div",je,[t.childrenTasks.length>0?(a(),r(U,{key:0},[v.value.length>0||k.value?(a(),r("button",{key:0,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border ml-2 mt-2",onClick:b(D,["prevent","stop"])},d(k.value?"Show Less":"Show All"),1)):i("",!0),v.value.length>0?(a(),r("span",ze,d(v.value.length)+" More sub task"+d(v.value.length>1?"s":""),1)):i("",!0)],64)):i("",!0),t.parentTask.level<2&&!t.hideButtons?(a(),r("a",{key:1,href:`/tasks/add?parent_id=${t.parentTask.id}&back-to=${encodeURIComponent(x(C).path+"?"+x(le)(x(C).query)).toLowerCase()}`,class:A(["hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-indigo-300 mt-2",{"ml-2":t.childrenTasks.length===0,"ml-3":t.childrenTasks.length>0}]),onClick:n[0]||(n[0]=b(s=>u("addClick",t.parentTask.id),["stop","prevent"]))},n[6]||(n[6]=[e("i",{class:"fas fa-plus"},null,-1),y(" Add Sub Task ")]),10,Ee)):i("",!0)])])}}},Ie={class:"flex w-full text-gray-800 bg-white"},Oe={key:0,class:"border-l border-gray-200 last:border-l-0"},Pe={class:"items-start group"},Re={class:"flex items-start justify-between w-full gap-4 mb-2"},qe={class:"flex gap-2 flex-grow items-center"},Ue={key:0,class:"text-xl font-semibold text-blue-500"},Ve={class:"justify-end items-center gap-2 ml-auto flex flex-wrap flex-shrink-0 sticky right-4"},Fe={class:"flex items-center justify-between gap-16 w-full"},He={class:"flex-shrink-0"},Je={class:"flex items-center"},Ge={key:0,class:"flex gap-4 items-center mr-3"},Ke={key:1,class:"text-gray-500 text-sm"},Qe={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},We={class:"text-xs text-gray-400 whitespace-nowrap"},Xe={class:"children-task-table ml-0 col-span-full"},Ye={class:"flex gap-3 items-center px-3 flex-wrap gap-y-8"},Ze={class:"text-right text-sm flex items-center gap-4 mt-2 opacity-80"},et={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 whitespace-nowrap"},tt={key:1,class:"text-sm"},st={class:"text-blue-500 font-semibold whitespace-nowrap"},at={key:2,class:"text-sm"},lt={class:"font-semibold text-blue-800 whitespace-nowrap"},it={key:3,class:"text-sm"},rt={class:"font-semibold text-blue-500 whitespace-nowrap"},nt={key:4,class:"text-sm"},ot={class:"font-semibold text-green-500 whitespace-nowrap"},dt={class:"flex items-center justify-center w-full md:w-auto sm:ml-auto"},ct={key:0,class:"flex gap-2 ml-4 items-center text-xs"},ut=["href"],gt=["href"],bt={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(t,{emit:B}){const c=t,k=F(),C=M(null),m=B;function v(o){m("editClick",o)}function D(o){m("employeeAssignClick",o)}const u=M([]),L=localStorage.getItem("sub_task_opened_list");if(L)try{u.value=JSON.parse(L)}catch{u.value=[]}const n=p(()=>w(c.task.assigned_at)),T=p(()=>w(c.task.deadline)),s=p(()=>w(c.task.started_at)),$=p(()=>w(c.task.completed_at)),_=p({get:()=>u.value.includes(c.task.id),set:o=>{const l=u.value.includes(c.task.id);o&&!l?u.value.push(c.task.id):!o&&l&&(u.value=u.value.filter(S=>S!==c.task.id))}});return ee(u,o=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(o))},{deep:!0}),(o,l)=>{var j,z,E,N,I,O,P,R,q;const S=te("RouterLink");return a(),r("div",Ie,[t.treeLevel>0?(a(),r("div",Oe,l[4]||(l[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):i("",!0),e("div",{class:A(["flex-grow rounded pb-3 overflow-y-auto",{"border-2":t.index,"border-blue-500":t.index%2===0,"border-pink-300":t.index%2===1,"bg-blue-100/30  ":t.task.closed_at,"bg-green-100  ":((j=t.task)==null?void 0:j.progress_percent)===100,"bg-white hover:bg-gray-50":((z=t.task)==null?void 0:z.progress_percent)<100&&!t.task.closed_at}])},[e("div",Pe,[e("div",{class:A(["task-details py-3 shadow-slate-100 flex flex-wrap z-30 pl-3",{"shadow-sm":t.treeLevel>0}])},[e("div",Re,[e("div",qe,[t.index!==void 0?(a(),r("div",Ue,d(t.index+1)+". ",1)):i("",!0),h(H,{task:t.task,"sub-tasks-open":_.value,"is-my-task":t.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",Ve,[t.task.closed_at?(a(),f(X,{key:0})):i("",!0),h(Q,{status:(E=t.task)==null?void 0:E.status,progressPercent:((N=t.task)==null?void 0:N.progress_percent)||0,class:"w-[150px] text-center !border-2"},null,8,["status","progressPercent"]),((O=(I=t.task)==null?void 0:I.children_tasks)==null?void 0:O.length)>0?(a(),f(K,{key:1,ref_key:"progress",ref:C,task:t.task,class:"text-sm w-[150px] text-center"},null,8,["task"])):i("",!0)])]),e("div",Fe,[e("div",He,[e("div",Je,[t.showDraggableHandle||t.task.serial?(a(),r("div",Ge,[t.showDraggableHandle?(a(),r("button",{key:0,onMousedown:l[0]||(l[0]=b((...g)=>o.handleDragging&&o.handleDragging(...g),["stop"])),class:"handle"},l[5]||(l[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):i("",!0),t.task.serial?(a(),r("span",Ke," #"+d(t.task.serial),1)):i("",!0)])):i("",!0),e("div",Qe,[e("div",We,[l[6]||(l[6]=e("i",{class:"fas fa-clock"},null,-1)),y(" "+d(x(W)(t.task.created_at)),1)]),(P=t.task)!=null&&P.is_important?(a(),f(J,{key:0,class:"flex-none"})):i("",!0),(R=t.task)!=null&&R.is_urgent?(a(),f(G,{key:1,class:"flex-none"})):i("",!0)])])]),t.hideAssignedUsers?i("",!0):(a(),f(ie,{key:0,task:t.task,"tree-level":t.treeLevel,class:"flex-nowrap grow shrink","employee-route-to":g=>({query:{...x(k).query,view:"userwise","company-id":g.company_id,"user-ids":g.id}})},null,8,["task","tree-level","employee-route-to"]))])],2),e("div",Xe,[h(Ne,{childrenTasks:t.task.children_tasks,parentTask:t.task,isMyTask:t.isMyTask,"hide-buttons":t.hideButtons,"hide-assigned-users":t.hideAssignedUsers,"parent-tree-level":t.treeLevel,onEditClick:v,onAddClick:l[1]||(l[1]=g=>m("addClick",g)),onEmployeeAssignClick:D},{"tree-item-end":V(({task:g,level:Y})=>[se(o.$slots,"item-end",{level:Y,task:g})]),_:3},8,["childrenTasks","parentTask","isMyTask","hide-buttons","hide-assigned-users","parent-tree-level"])])]),e("div",Ye,[e("div",Ze,[t.task.is_target?(a(),r("div",et,l[7]||(l[7]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),y(" TARGET TASK ")]))):i("",!0),T.value?(a(),r("span",tt,[l[8]||(l[8]=e("span",{class:"italic text-gray-500"},"Deadline: ",-1)),e("span",st,d(T.value),1)])):i("",!0),n.value?(a(),r("span",at,[l[9]||(l[9]=e("span",{class:"italic text-gray-500"},"Assign: ",-1)),e("span",lt,d(n.value),1)])):i("",!0),s.value?(a(),r("span",it,[l[10]||(l[10]=e("span",{class:"italic text-gray-500"},"Started: ",-1)),e("span",rt,d(s.value),1)])):i("",!0),$.value?(a(),r("span",nt,[l[12]||(l[12]=e("span",{class:"italic text-gray-500"},"Completed: ",-1)),e("span",ot,[y(d($.value)+" ",1),l[11]||(l[11]=e("i",{class:"fas fa-check-circle"},null,-1))])])):i("",!0)]),e("div",dt,[t.hideButtons?i("",!0):(a(),r("div",ct,[t.task.is_closed?i("",!0):(a(),r("a",{key:0,href:`/tasks/edit/${t.task.id}`,onClick:l[2]||(l[2]=b(g=>m("editClick",t.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs whitespace-nowrap"},l[13]||(l[13]=[e("i",{class:"fas fa-edit"},null,-1),y(" Edit ")]),8,ut)),t.task.is_closed?i("",!0):(a(),r("a",{key:1,href:`/tasks/${t.task.id}/assign-users`,onClick:l[3]||(l[3]=b(g=>m("employeeAssignClick",t.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2 whitespace-nowrap"},l[14]||(l[14]=[e("i",{class:"fas fa-users-cog"},null,-1),y(" Manage ")]),8,gt)),h(S,{to:{name:"TaskReports",params:{id:(q=t.task)==null?void 0:q.id},query:{"is-my-task":t.isMyTask},hash:"#task-reports"},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2 whitespace-nowrap"},{default:V(()=>l[15]||(l[15]=[e("i",{class:"far fa-file-alt"},null,-1),y(" Reports ")])),_:1,__:[15]},8,["to"])]))])])],2)])}}};export{bt as _};
