import{u as le,D as ae,h as oe,r as p,x,aa as ie,p as re,c as a,o,a as t,d as f,l as v,k as D,j as d,v as ne,H as $,s as L,b as c,P as de,F as b,e as w,t as r,m as ue,z as ce,T as pe}from"./index-DwjCuk-z.js";import{L as xe}from"./LoaderView-BjZy94g6.js";import{u as me}from"./notice-Cg7SzuRk.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"space-y-4 px-4 pb-6"},be={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},_e={class:"flex flex-wrap items-center gap-3"},ye={class:"flex gap-2"},he={class:"sticky top-14 z-10 rounded-2xl border border-slate-200 bg-white/90 backdrop-blur p-3 print:hidden"},ge={class:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between"},we={class:"flex-1"},ke={class:"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2"},Ne={class:"flex flex-wrap items-center gap-2"},Ce=["title"],Me={class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm"},Ae={class:"mt-3"},De={class:"mt-2 flex gap-2 overflow-x-auto pb-1"},Le=["onClick"],Te={class:"ml-1 rounded-full bg-white/20 px-2 py-0.5 text-[10px] font-bold"},Ee={key:0,class:"flex justify-center py-12"},Se={key:0,class:"rounded-2xl border border-dashed border-slate-300 bg-white p-8 text-center text-sm text-slate-500"},Pe={class:"space-y-3 md:hidden"},je={class:"flex items-start justify-between gap-3"},Ve={class:"min-w-0"},Be=["title"],Ue={class:"mt-1 text-[11px] text-slate-500"},Fe={key:0},Re={class:"mt-2 flex flex-wrap gap-1"},$e={key:0,class:"mt-3 text-sm text-slate-600 line-clamp-3"},ze={class:"mt-3 flex items-center justify-between"},Oe={class:"flex items-center gap-2"},He={key:0,class:"rounded-full bg-rose-50 px-2 py-0.5 text-[11px] font-semibold text-rose-700"},Ke={key:1,class:"rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-semibold text-emerald-700"},qe={class:"flex gap-2"},Ge=["onClick"],We={class:"hidden md:block rounded-2xl border border-slate-200 bg-white shadow-sm"},Ie={class:"min-w-full table-auto divide-y divide-slate-200 text-sm"},Je={class:"divide-y divide-slate-100"},Qe={class:"px-4 py-3 font-medium text-slate-600"},Xe={class:"px-4 py-3"},Ye={class:"flex items-start gap-2"},Ze={class:"min-w-0"},et=["title"],tt=["title"],st={class:"mt-0.5 text-[11px] text-slate-500"},lt={key:0,class:"mr-2 rounded-full bg-rose-50 px-2 py-0.5 font-semibold text-rose-700"},at={key:1,class:"rounded-full bg-emerald-50 px-2 py-0.5 font-semibold text-emerald-700"},ot=["onClick"],it={class:"px-4 py-3"},rt={class:"px-4 py-3"},nt={class:"flex flex-wrap gap-1 max-w-[22rem]"},dt={class:"px-4 py-3 text-slate-600"},ut={class:"px-4 py-3 text-slate-600"},ct={class:"px-4 py-3 text-center"},pt={class:"px-4 py-3 text-center"},xt={class:"flex items-center justify-center gap-2"},mt={key:0,class:"flex flex-wrap items-center justify-between gap-2 pt-2"},ft={class:"text-xs text-slate-500"},vt={class:"text-slate-800"},bt={class:"text-slate-800"},_t={class:"text-slate-800"},yt={class:"flex items-center gap-2"},ht=["disabled"],gt=["disabled"],wt={class:"relative w-full max-w-3xl overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-xl"},kt={class:"border-b border-slate-200 p-5"},Nt={class:"flex items-start justify-between gap-4"},Ct={class:"min-w-0"},Mt={class:"text-lg font-semibold text-slate-900 truncate"},At={class:"mt-1 text-xs text-slate-500"},Dt={key:0},Lt={class:"mt-2 flex flex-wrap gap-2"},Tt={key:0,class:"rounded-full bg-rose-50 px-3 py-1 text-[11px] font-semibold text-rose-700"},Et={key:1,class:"rounded-full bg-emerald-50 px-3 py-1 text-[11px] font-semibold text-emerald-700"},St={class:"mt-2 flex flex-wrap gap-1"},Pt={class:"max-h-[70vh] overflow-y-auto p-5"},jt={key:0,class:"prose prose-sm max-w-none text-slate-700"},Vt=["innerHTML"],Bt={key:1,class:"text-sm text-slate-500"},Ut={key:2,class:"mt-5 rounded-xl border border-slate-200 bg-slate-50 p-4"},Ft=["href"],Rt={class:"border-t border-slate-200 p-4 flex items-center justify-end gap-2"},$t={__name:"NoticeList",setup(zt){const W=le(),B=me(),{notices:z}=ae(B);oe(()=>{B.fetchNotices()});const I=()=>W.go(-1),y=p(""),k=p("all"),N=p("all"),T=p(!0),C=p("published_at"),h=p("desc"),g=p(15),E=p(1),U=p(!1),n=p(null),O=l=>{n.value=l,U.value=!0},M=()=>{U.value=!1,n.value=null},S=l=>(l||"").toLowerCase().trim().replace(/\s+/g,"_"),A=l=>!l||l==="all"?"All employees":l.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");function J(l){if(l==null)return["all"];if(Array.isArray(l)){const i=l.map(s=>S(String(s))).filter(Boolean);return i.length?i:["all"]}const e=String(l).trim();if(!e)return["all"];if(e.startsWith("[")&&e.endsWith("]"))try{const i=JSON.parse(e);if(Array.isArray(i)){const s=i.map(u=>S(String(u))).filter(Boolean);return s.length?s:["all"]}}catch{}return[S(e)].filter(Boolean).length?[S(e)]:["all"]}const P=l=>{if(!l)return"-";const e=new Date(l);return Number.isNaN(e.getTime())?"-":e.toLocaleString("en-US",{month:"short",year:"numeric",day:"numeric"})},H=l=>{if(!l)return"-";const e=new Date(l);return Number.isNaN(e.getTime())?"-":e.toLocaleString()},Q=l=>l?String(l).replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim():"",X=l=>Number(l)===1?{label:"General",classes:"bg-sky-100 text-sky-700 border-sky-200"}:Number(l)===2?{label:"Policy",classes:"bg-amber-100 text-amber-700 border-amber-200"}:{label:"Other",classes:"bg-slate-100 text-slate-700 border-slate-200"},Y=l=>{const e=l==null?void 0:l.expired_at;if(!e)return!1;const i=new Date(e);return Number.isNaN(i.getTime())?!1:i.getTime()<Date.now()},F=x(()=>(Array.isArray(z.value)?z.value:[]).map(e=>{var m;const i=J(e==null?void 0:e.receiver_type),s=Array.isArray(e==null?void 0:e.companies_notice)?e.companies_notice:[],u=s.length>0?s.map(V=>V.name).join(", "):((m=e==null?void 0:e.company)==null?void 0:m.name)||"Multiple Companies";return{...e,_companyName:u,_typeMeta:X(e==null?void 0:e.type),_receivers:i,_receiversLabel:i.map(A).join(", "),_plainDesc:Q(e==null?void 0:e.description),_expired:Y(e)}})),Z=x(()=>{const l=new Map;return l.set("all",0),F.value.forEach(i=>{i._receivers.forEach(s=>{l.set(s,(l.get(s)||0)+1)})}),l.set("all",F.value.length),Array.from(l.entries()).sort((i,s)=>i[0]==="all"?-1:s[0]==="all"?1:(s[1]||0)-(i[1]||0)).map(([i,s])=>({key:i,count:s}))}),ee=x(()=>{const l=y.value.trim().toLowerCase();return F.value.filter(e=>!(k.value!=="all"&&!e._receivers.includes(k.value)||N.value!=="all"&&String(e==null?void 0:e.type)!==String(N.value)||!T.value&&e._expired||l&&![(e==null?void 0:e.title)||"",(e==null?void 0:e._companyName)||"",(e==null?void 0:e._receiversLabel)||"",(e==null?void 0:e._plainDesc)||""].join(" ").toLowerCase().includes(l)))}),K=x(()=>{const l=[...ee.value],e=h.value==="asc"?1:-1,i=s=>C.value==="title"?((s==null?void 0:s.title)||"").toLowerCase():C.value==="expired_at"?new Date((s==null?void 0:s.expired_at)||0).getTime():new Date((s==null?void 0:s.published_at)||0).getTime();return l.sort((s,u)=>{const m=i(s),V=i(u);return m<V?-1*e:m>V?1*e:0}),l}),R=x(()=>K.value.length),j=x(()=>Math.max(1,Math.ceil(R.value/Number(g.value||15)))),_=x(()=>Math.min(Math.max(1,E.value),j.value)),q=x(()=>{const l=Number(g.value||15),e=(_.value-1)*l;return K.value.slice(e,e+l)});function te(){E.value=1}const se=x(()=>[y.value,k.value,N.value,T.value,C.value,h.value,g.value].join("|"));ie(()=>{se.value,te()});const G=x(()=>R.value>0);return(l,e)=>{const i=re("RouterLink");return o(),a("div",ve,[t("div",be,[e[11]||(e[11]=t("div",{class:"space-y-1"},[t("p",{class:"text-xs font-semibold uppercase tracking-wider text-slate-500"},"Notice management"),t("h1",{class:"text-2xl font-semibold text-slate-900"},"Notice List"),t("p",{class:"text-sm text-slate-500"}," Search, filter by receiver/type, preview notice, and manage quickly. ")],-1)),t("div",_e,[t("div",ye,[t("button",{class:"btn-3",onClick:I},e[9]||(e[9]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),f(i,{to:{name:"NoticeAdd"},class:"btn-2"},{default:v(()=>e[10]||(e[10]=[t("span",{class:"hidden md:flex"},"Add New",-1),t("i",{class:"far fa-plus"},null,-1)])),_:1,__:[10]})])])]),t("div",he,[t("div",ge,[t("div",we,[t("div",ke,[e[12]||(e[12]=t("i",{class:"far fa-search text-slate-400"},null,-1)),D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),type:"text",placeholder:"Search title, company, receivers, description...",class:"w-full bg-transparent text-sm outline-none"},null,512),[[ne,y.value]]),y.value?(o(),a("button",{key:0,type:"button",class:"text-xs font-semibold text-slate-500 hover:text-slate-900",onClick:e[1]||(e[1]=s=>y.value="")}," Clear ")):d("",!0)])]),t("div",Ne,[D(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>N.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-400/40"},e[13]||(e[13]=[t("option",{value:"all"},"All types",-1),t("option",{value:"1"},"General",-1),t("option",{value:"2"},"Policy",-1)]),512),[[$,N.value]]),D(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>C.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-400/40"},e[14]||(e[14]=[t("option",{value:"published_at"},"Sort: Published",-1),t("option",{value:"expired_at"},"Sort: Expiry",-1),t("option",{value:"title"},"Sort: Title",-1)]),512),[[$,C.value]]),t("button",{type:"button",class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50",onClick:e[4]||(e[4]=s=>h.value=h.value==="asc"?"desc":"asc"),title:h.value==="asc"?"Ascending":"Descending"},[t("i",{class:L(["far",h.value==="asc"?"fa-sort-amount-up":"fa-sort-amount-down"])},null,2)],8,Ce),t("label",Me,[D(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>T.value=s),type:"checkbox",class:"h-4 w-4 accent-sky-600"},null,512),[[de,T.value]]),e[15]||(e[15]=c(" Show expired "))]),D(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-400/40"},e[16]||(e[16]=[t("option",{value:10},"10",-1),t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1)]),512),[[$,g.value,void 0,{number:!0}]])])]),t("div",Ae,[e[17]||(e[17]=t("div",{class:"flex items-center gap-2"},[t("p",{class:"text-xs font-semibold uppercase tracking-wider text-slate-500"},"Receivers"),t("div",{class:"h-px flex-1 bg-slate-100"})],-1)),t("div",De,[(o(!0),a(b,null,w(Z.value,s=>(o(),a("button",{key:s.key,type:"button",class:L(["shrink-0 rounded-full border px-3 py-1 text-xs font-semibold transition",s.key===k.value?"border-sky-600 bg-sky-600 text-white":"border-slate-200 bg-white text-slate-600 hover:border-slate-400"]),onClick:u=>k.value=s.key},[c(r(A(s.key))+" ",1),t("span",Te,r(s.count),1)],10,Le))),128))])])]),ue(B).isLoading?(o(),a("div",Ee,[f(xe)])):(o(),a(b,{key:1},[G.value?(o(),a(b,{key:1},[t("div",Pe,[(o(!0),a(b,null,w(q.value,s=>(o(),a("div",{key:"m-"+s.id,class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},[t("div",je,[t("div",Ve,[t("div",{class:"text-sm font-semibold text-slate-900 truncate",title:s.title},r(s.title||"Untitled"),9,Be),t("div",Ue,[c(r(s._companyName)+" • Published "+r(P(s.published_at))+" ",1),s.expired_at?(o(),a("span",Fe," • Expires "+r(P(s.expired_at)),1)):d("",!0)])]),t("span",{class:L(["shrink-0 rounded-full border px-2 py-0.5 text-[11px] font-semibold",s._typeMeta.classes])},r(s._typeMeta.label),3)]),t("div",Re,[(o(!0),a(b,null,w(s._receivers,u=>(o(),a("span",{key:s.id+"-"+u,class:"rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-600"},r(A(u)),1))),128))]),s._plainDesc?(o(),a("p",$e,r(s._plainDesc),1)):d("",!0),t("div",ze,[t("div",Oe,[s._expired?(o(),a("span",He," Expired ")):d("",!0),s.file?(o(),a("span",Ke," Attachment ")):d("",!0)]),t("div",qe,[t("button",{class:"btn-4 gap-2",type:"button",onClick:u=>O(s)},e[18]||(e[18]=[t("i",{class:"far fa-eye"},null,-1),c(" Preview ")]),8,Ge),f(i,{to:{name:"NoticeEdit",params:{id:s.id}},class:"btn-4 gap-2"},{default:v(()=>e[19]||(e[19]=[t("i",{class:"far fa-edit"},null,-1),c(" Edit ")])),_:2,__:[19]},1032,["to"])])])]))),128))]),t("div",We,[t("table",Ie,[e[24]||(e[24]=t("thead",null,[t("tr",{class:"text-left text-xs uppercase tracking-widest text-slate-500 sticky top-44 z-50 bg-slate-50"},[t("th",{class:"px-4 py-3 font-medium"},"#"),t("th",{class:"px-4 py-3 font-medium"},"Title"),t("th",{class:"px-4 py-3 font-medium"},"Type"),t("th",{class:"px-4 py-3 font-medium"},"Receivers"),t("th",{class:"px-4 py-3 font-medium"},"Published"),t("th",{class:"px-4 py-3 font-medium"},"Expires"),t("th",{class:"px-4 py-3 font-medium text-center"},"Feedback"),t("th",{class:"px-4 py-3 font-medium text-center"},"Actions")])],-1)),t("tbody",Je,[(o(!0),a(b,null,w(q.value,(s,u)=>(o(),a("tr",{key:s.id,class:"hover:bg-slate-50"},[t("td",Qe,r((_.value-1)*Number(g.value)+u+1),1),t("td",Xe,[t("div",Ye,[t("div",Ze,[t("div",{class:"font-semibold text-slate-900 truncate max-w-[22rem]",title:s.title},r(s.title||"Untitled"),9,et),t("div",{class:"truncate block max-w-[15rem] mt-1 text-xs",title:s._companyName},r(s._companyName),9,tt),t("div",st,[s._expired?(o(),a("span",lt,"Expired")):d("",!0),s.file?(o(),a("span",at,"Attachment")):d("",!0)])]),t("button",{type:"button",class:"shrink-0 rounded-lg border border-slate-200 bg-white px-2 py-1 text-xs font-semibold text-slate-600 hover:bg-slate-50",onClick:m=>O(s),title:"Preview"},e[20]||(e[20]=[t("i",{class:"far fa-eye"},null,-1)]),8,ot)])]),t("td",it,[t("span",{class:L(["inline-flex items-center rounded-full border px-3 py-1 text-[11px] font-semibold",s._typeMeta.classes])},r(s._typeMeta.label),3)]),t("td",rt,[t("div",nt,[(o(!0),a(b,null,w(s._receivers,m=>(o(),a("span",{key:s.id+"-"+m,class:"rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-600"},r(A(m)),1))),128))])]),t("td",dt,r(P(s.published_at)),1),t("td",ut,r(P(s.expired_at)),1),t("td",ct,[f(i,{to:{name:"NoticeFeedbackShow",params:{id:s.id}},class:"btn-4 gap-2"},{default:v(()=>[e[21]||(e[21]=t("i",{class:"far fa-comments"},null,-1)),t("span",null,r((s==null?void 0:s.user_feedback_count)||0),1)]),_:2,__:[21]},1032,["to"])]),t("td",pt,[t("div",xt,[f(i,{to:{name:"MyNoticeDetails",params:{id:s.id}},class:"btn-icon",title:"View details"},{default:v(()=>e[22]||(e[22]=[t("i",{class:"far fa-eye"},null,-1)])),_:2,__:[22]},1032,["to"]),f(i,{to:{name:"NoticeEdit",params:{id:s.id}},class:"btn-icon",title:"Edit"},{default:v(()=>e[23]||(e[23]=[t("i",{class:"far fa-edit"},null,-1)])),_:2,__:[23]},1032,["to"])])])]))),128))])])]),G.value?(o(),a("div",mt,[t("div",ft,[e[25]||(e[25]=c(" Page ")),t("b",vt,r(_.value),1),e[26]||(e[26]=c(" of ")),t("b",bt,r(j.value),1),e[27]||(e[27]=c(" • Total ")),t("b",_t,r(R.value),1)]),t("div",yt,[t("button",{type:"button",class:"rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-50",disabled:_.value<=1,onClick:e[7]||(e[7]=s=>E.value=Math.max(1,_.value-1))}," Prev ",8,ht),t("button",{type:"button",class:"rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-50",disabled:_.value>=j.value,onClick:e[8]||(e[8]=s=>E.value=Math.min(j.value,_.value+1))}," Next ",8,gt)])])):d("",!0)],64)):(o(),a("div",Se," No notices found for current filters. "))],64)),f(pe,{name:"fade-scale"},{default:v(()=>[U.value&&n.value?(o(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:ce(M,["escape","window"])},[t("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:M}),t("div",wt,[t("div",kt,[t("div",Nt,[t("div",Ct,[t("h3",Mt,r(n.value.title||"Untitled"),1),t("p",At,[c(r(n.value._companyName)+" • Published "+r(H(n.value.published_at))+" ",1),n.value.expired_at?(o(),a("span",Dt," • Expires "+r(H(n.value.expired_at)),1)):d("",!0)]),t("div",Lt,[t("span",{class:L(["rounded-full border px-3 py-1 text-[11px] font-semibold",n.value._typeMeta.classes])},r(n.value._typeMeta.label),3),n.value._expired?(o(),a("span",Tt," Expired ")):d("",!0),n.value.file?(o(),a("span",Et," Attachment available ")):d("",!0)]),t("div",St,[(o(!0),a(b,null,w(n.value._receivers,s=>(o(),a("span",{key:"pv-"+n.value.id+"-"+s,class:"rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-600"},r(A(s)),1))),128))])]),t("button",{type:"button",class:"rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50",onClick:M}," Close ")])]),t("div",Pt,[n.value.description?(o(),a("div",jt,[t("div",{innerHTML:n.value.description},null,8,Vt)])):(o(),a("div",Bt,"No description.")),n.value.file?(o(),a("div",Ut,[e[29]||(e[29]=t("div",{class:"text-xs font-semibold text-slate-700"},"Attachment",-1)),t("a",{class:"mt-1 inline-flex items-center gap-2 text-sm font-semibold text-sky-700 hover:text-sky-900",href:n.value.file,target:"_blank",rel:"noopener"},e[28]||(e[28]=[t("i",{class:"far fa-paperclip"},null,-1),c(" Open file ")]),8,Ft)])):d("",!0)]),t("div",Rt,[f(i,{to:{name:"MyNoticeDetails",params:{id:n.value.id}},class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50",onClick:M},{default:v(()=>e[30]||(e[30]=[c(" Open details ")])),_:1,__:[30]},8,["to"]),f(i,{to:{name:"NoticeEdit",params:{id:n.value.id}},class:"btn-2",onClick:M},{default:v(()=>e[31]||(e[31]=[c(" Edit ")])),_:1,__:[31]},8,["to"])])])],32)):d("",!0)]),_:1})])}}},Gt=fe($t,[["__scopeId","data-v-a9927426"]]);export{Gt as default};
