import{d as X,b as tt,p as D,r as U,c as o,o as s,a as t,g as v,s as J,F as B,k as d,w as L,t as g,y as w,i as P,z as Z,f as I,h as et,A as $t,m as gt,e as st,I as wt,q as Y,j as C,v as _t,x as W,J as Ct,G as ft,n as R,u as St,K as Dt,C as yt}from"./index-Dv63NlYr.js";import{L as Q}from"./LoaderView-goTXKRjE.js";import{O as H}from"./OverlyModal-CRf9MnR9.js";import{m as It,_ as Et}from"./task-tree-BSgKnIxX.js";import{_ as Pt}from"./TaskAddForm-C5BCYsBa.js";import{_ as Lt}from"./TaskEditForm-BjYB2w_H.js";import{_ as Ut}from"./TaskTreeView-BKbRvON0.js";import{a as At,_ as Mt}from"./TaskUserAssignForm-B-feHTHh.js";import{u as Nt,r as Ot,d as jt,a as Rt}from"./task-priority-BvojEPM2.js";import{b as Bt,c as Ft,e as Vt,T as Gt,d as qt}from"./TaskSupervisorAndEmployee-ByeipAIT.js";import{b as z,g as Ht,d as zt}from"./datetime-C4Yr_jSk.js";import{_ as vt}from"./UserChip-D0kXhYve.js";import{s as bt}from"./dom-CCkG-r61.js";import{u as Kt}from"./useTaskStore-DPC-Iaz5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-By3nBQZZ.js";import"./company-DxO0Yqjl.js";import"./useRequirementStore-DRxAEZtY.js";import"./requirement-DGlXHM0b.js";import"./CompanyDepartmentSelectInput-RWPcwl3i.js";import"./SectionLoading-1fHLVpsK.js";import"./TextWithHr-BDSHth5b.js";import"./TaskUrgencyInput-9fH6Dfbg.js";import"./tags-KLAnR6jM.js";import"./MultiselectDropdown-DONU5T0k.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-ij4IjyOA.js";import"./url-CePbr-gY.js";import"./TaskUserChip-COI46vGj.js";const Wt={class:"mb-3"},Zt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Jt={key:1,class:"text-center py-4 text-gray-500"},Yt={key:2,class:"text-center py-4 text-red-500"},Qt={key:3,class:"space-y-4"},Xt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(k,{emit:a}){const e=k,c=X(),u=tt(),p=D(()=>{var b;return!!(((b=c==null?void 0:c.user)==null?void 0:b.role)!=="employee"&&(c!=null&&c.isAdminMood))}),x=a,y=U(null),{handleItemsPriorityUpdate:r,saveTaskPriority:m,listHasRearranged:i}=Nt(()=>e.tasks,e.parentId),h=async()=>{await m(),x("updatePriority")};return(b,_)=>(s(),o("div",null,[t("div",Wt,[J(b.$slots,"task:header")]),p.value?(s(),o(B,{key:0},[d(i)?(s(),o("div",Zt,[_[4]||(_[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:L(h,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:_[0]||(_[0]=L((...$)=>y.value.resetItems&&y.value.resetItems(...$),["prevent"]))},"Discard")])):v("",!0)],64)):v("",!0),k.loading?(s(),o("div",Jt,"Loading tasks...")):k.error?(s(),o("div",Yt,g(k.error),1)):(s(),o("div",Qt,[w(At,{items:k.tasks,handle:"handle",onItemsUpdate:d(r),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:y},{item:P(({item:$,index:N})=>[w(Ut,{isMyTask:d(u).name=="MyTaskShow",index:N,task:$,showDraggableHandle:p.value,"tree-level":k.treeLevel,class:"!border-0",onCommentButtonClick:M=>x("commentButtonClick",$.id),onEditClick:_[1]||(_[1]=M=>x("editClick",M)),onAddClick:_[2]||(_[2]=M=>x("addClick",M)),onEmployeeAssignClick:_[3]||(_[3]=M=>x("employeeAssignClick",M))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},te={class:"flex justify-between mt-5"},ee={class:"flex justify-between items-center gap-4"},se={class:"w-32 relative h-8 mx-4"},ae={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},le={key:3,class:"border p-4 rounded text-center text-gray-500 italic"},ne={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(k,{emit:a}){const e=k,c=tt(),u=X(),p=U(""),x=U("not-completed"),y=Z({taskId:0,isOpen:!1}),r=a,m=U(),i=Z({show:!1,parentId:e.parentId,requirementId:null}),h=A=>{i.show=!0,i.parentId=A};function b(){i.show=!1,i.parentId=e.parentId,r("created")}function _(){r("assignUser")}function $(){m.value=!1,r("updated")}function N(){i.show=!1,i.parentId=e.parentId}const M=D(()=>{var A;return Array.isArray(e.subTasks)?It(e.subTasks,{status:x.value,...c.name=="MyTaskShow"?{"user-ids":(A=u==null?void 0:u.user)==null?void 0:A.id}:{}}).filter(f=>{var l,n,E;return p.value?(E=(l=f==null?void 0:f.title)==null?void 0:l.toUpperCase())==null?void 0:E.includes((n=p.value)==null?void 0:n.toUpperCase()):!0}):[]});return(A,f)=>{var l;return s(),o("div",null,[m.value?(s(),I(H,{key:0},{default:P(()=>[w(Lt,{taskId:m.value,onClose:f[0]||(f[0]=n=>m.value=null),onUpdated:$},null,8,["taskId"])]),_:1})):v("",!0),i.show?(s(),I(H,{key:1},{default:P(()=>[w(Pt,{parentTaskId:i.parentId,requirementId:i.requirementId,onTaskCreated:b,onError:A.handleTaskError,onClose:N},null,8,["parentTaskId","requirementId","onError"])]),_:1})):v("",!0),y.isOpen?(s(),I(H,{key:2},{default:P(()=>[w(Mt,{taskId:y.taskId,onCancelClick:f[1]||(f[1]=()=>{y.isOpen=!1,y.taskId=0}),onSuccess:f[2]||(f[2]=()=>{y.isOpen=!1,y.taskId=0,_()})},null,8,["taskId"])]),_:1})):v("",!0),w(Xt,{tasks:M.value,parentId:k.parentId,treeLevel:k.treeLevel,onAddClick:f[6]||(f[6]=n=>h(n)),onEditClick:f[7]||(f[7]=n=>m.value=n),onUpdatePriority:f[8]||(f[8]=n=>r("updatePriority")),onEmployeeAssignClick:f[9]||(f[9]=n=>{y.taskId=n,y.isOpen=!0})},{"task:header":P(()=>{var n;return[t("div",te,[t("div",ee,[f[12]||(f[12]=t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks",-1)),((n=e==null?void 0:e.subTasks)==null?void 0:n.length)>0?(s(),o(B,{key:0},[w(Et,{modelValue:p.value,"onUpdate:modelValue":f[3]||(f[3]=E=>p.value=E),class:"w-full md:w-48 md:ml-auto h-8","debounce-time":0},null,8,["modelValue"]),t("div",se,[f[11]||(f[11]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),et(t("select",{"onUpdate:modelValue":f[4]||(f[4]=E=>x.value=E),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},f[10]||(f[10]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[$t,x.value]])])],64)):v("",!0)]),k.subTaskIsCreatable?(s(),o("div",ae,[t("button",{class:"btn-1 ml-auto",onClick:f[5]||(f[5]=L(()=>h(k.parentId),["prevent"]))}," Add Sub Task ")])):v("",!0)])]}),_:1},8,["tasks","parentId","treeLevel"]),((l=M.value)==null?void 0:l.length)===0&&k.treeLevel<=2?(s(),o("div",le," No Sub Tasks ")):v("",!0)])}}},oe={key:0},re={key:0},ie={key:1},de={key:2},ue={key:3},ce={key:1},pe=gt({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(k){const a=k;let e=0;const c=U(x());let u;function p(){return a.millisecond&&typeof a.millisecond=="number"}function x(){p()?e&&(e-=1e3):e=new Date(a.targetDateTime).getTime()-new Date().getTime();const b=Math.floor(e/1e3%60),_=Math.floor(e/1e3/60%60),$=Math.floor(e/(1e3*60*60)%24),N=Math.floor(e/(1e3*60*60*24));return{total:e,days:N,hours:$,minutes:_,seconds:b}}function y(){c.value=x()}st(()=>{p()&&(e=a.millisecond),console.log("MOUNTED"),y(),u=setInterval(()=>{y(),c.value.total<=0&&clearInterval(u)},1e3)}),wt(()=>clearInterval(u)),Y(()=>a.targetDateTime,()=>{y(),clearInterval(u)});const r=D(()=>c.value.days.toString().padStart(2,"0")),m=D(()=>c.value.hours.toString().padStart(2,"0")),i=D(()=>c.value.minutes.toString().padStart(2,"0")),h=D(()=>c.value.seconds.toString().padStart(2,"0"));return(b,_)=>c.value.total>0?(s(),o("span",oe,[!b.hideIfZeroValue||r.value!="00"?(s(),o("span",re,g(r.value)+"d : ",1)):v("",!0),!b.hideIfZeroValue||m.value!="00"?(s(),o("span",ie,g(m.value)+"h : ",1)):v("",!0),!b.hideIfZeroValue||i.value!="00"?(s(),o("span",de,g(i.value)+"m : ",1)):v("",!0),!b.hideIfZeroValue||h.value!="00"?(s(),o("span",ue,g(h.value)+"s",1)):v("",!0)])):(s(),o("span",ce,[J(b.$slots,"expired")]))}}),ke={class:"mb-2 mt-6"},me={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},fe={class:"flex justify-center"},ye={class:"py-6 w-full text-center"},ve={class:"block mb-2"},be={class:"font-semibold text-red-600 mx-2 text-xl"},xe={class:"mt-2"},ge={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},_e={class:"flex justify-between items-center"},he={key:0},Te={key:1},$e={key:0,class:"btn-2-red"},we={key:1,class:"btn-2-red"},xt=5e3,Ce={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(k,{emit:a}){const e=k,c=U(""),u=U(""),p=a,x=U("");let y=0;async function r(){var h,b;if(!c.value)return x.value="Type the task title on input box";clearTimeout(y);try{x.value="",u.value==="deleted"?(u.value="restoring",await Ot(e.task.id),u.value="restored"):(u.value="deleting",await jt(e.task.id,{params:{security_check:c.value}}),u.value="deleted"),u.value=="deleted"?y=setTimeout(()=>{i()},xt):p("closeClick")}catch(_){u.value="error",x.value=((b=(h=_.response)==null?void 0:h.data)==null?void 0:b.message)||`Failed to update ${e.type}`}}function m(){u.value==="deleted"&&i(),p("closeClick")}function i(){u.value="",p("delete")}return(h,b)=>{var _,$;return s(),o("form",{class:"p-4 relative",onSubmit:L(r,["prevent"])},[b[7]||(b[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",ke,[b[1]||(b[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,g((_=k.task)==null?void 0:_.title),1)]),u.value=="deleted"?(s(),o("div",me,b[2]||(b[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(s(),o(B,{key:1},[t("div",fe,[t("div",ye,[t("label",ve,[b[3]||(b[3]=C(" Type ")),t("span",be,g(($=k.task)==null?void 0:$.title),1),b[4]||(b[4]=C(" and submit to delete "))]),et(t("input",{type:"text","onUpdate:modelValue":b[0]||(b[0]=N=>c.value=N),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[_t,c.value]])])]),b[5]||(b[5]=t("hr",null,null,-1)),t("div",xe,[x.value?(s(),o("div",ge,g(x.value),1)):v("",!0)])],64)),t("div",_e,[t("button",{class:"btn-3",type:"button",onClick:L(m,["prevent"])},[u.value=="deleted"?(s(),o("span",he,"Delete")):(s(),o("span",Te," Close "))]),u.value=="deleted"?(s(),o("button",$e,[b[6]||(b[6]=C(" Undo Delete in ")),u.value=="deleted"?(s(),I(pe,{key:0,"hide-if-zero-value":!0,millisecond:xt})):v("",!0)])):(s(),o("button",we,"Delete"))]),u.value=="deleting"||u.value=="restoring"?(s(),I(Q,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:P(()=>[C(g(String(u.value).charAt(0).toUpperCase()+String(u.value).slice(1)),1)]),_:1})):v("",!0)],32)}}},Se=k=>k==null?void 0:k.reduce((a,e)=>a+e.task_weight,0),ht=(k,a)=>{const e=Se(k);return k.map(c=>{const u=a.filter(p=>p.user_id===c.id).reduce((p,x)=>p+x.progress,0);return{...c,task_progress:Math.floor(u*(c.task_weight/e)),user_progress:u}})},De=(k,a)=>{let e=0;const c=[],u=y=>y.status==="COMPLETED",p=y=>y.users.some(r=>r.id===a),x=(y,r)=>{y.forEach(m=>{const i=p(m);c[r]=c[r]||{user_id:a,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const h=i&&m.children_tasks.length===0;c[r].total_assigned+=i?1:0,c[r].total_assigned_on_leaf_task+=h?1:0,e+=h?1:0,i&&u(m)&&(c[r].completed_count++,m.children_tasks.length),m.children_tasks.length>0&&x(m.children_tasks,r+1)})};return x(k,0),{sub_task_infos:c,assigned_on_any_leaf_task:e>0}},Ie=(k,a)=>k.map(e=>({...e,...De(a,e.id)})),Ee={key:0,class:"min-w-full bg-white rounded overflow-hidden"},Pe={class:"py-0.5 text-bg font-semibold"},Le={class:"bg-gray-50"},Ue={class:"px-2 py-1 border-y"},Ae={class:"px-2 py-1 border-y"},Me={key:0,class:"text-sm text-gray-400"},Ne={key:1},Oe={key:1,class:"min-w-full bg-white rounded overflow-hidden"},je={class:"py-0.5 text-bg font-semibold"},Re={class:"px-2 py-1 border-y text-center"},Be={class:"px-2 py-1 border-y border-r"},Fe={class:"px-2 py-1 border-y text-center"},Ve={class:"px-2 py-1 border-y text-center"},Ge=gt({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(k){const a=k,e=D(()=>ht(a.task.users,a.task.task_reports||[])),c=D(()=>Ie(a.task.users,a.subTasks));return(u,p)=>{var x,y;return a.task.children_task_count>0?(s(),o("table",Ee,[t("caption",Pe,[J(u.$slots,"caption",{},()=>[p[0]||(p[0]=C("Progress"))])]),t("thead",Le,[t("tr",null,[p[1]||(p[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),p[2]||(p[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(s(!0),o(B,null,W(((y=(x=c.value[0]||{})==null?void 0:x.sub_task_infos)==null?void 0:y.length)||1,r=>(s(),o("th",{key:r,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},g(r===1?"Completed Sub Task":"")+" "+g(r===2?"Completed Sub Sub Task":"")+" "+g(r===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(s(!0),o(B,null,W(c.value,(r,m)=>(s(),o("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ue,g(m+1),1),t("td",Ae,[w(vt,{user:r},null,8,["user"])]),(s(!0),o(B,null,W(r.sub_task_infos,(i,h)=>(s(),o("td",{class:"px-2 py-1 border-y text-center",key:h},[i.total_assigned===0||!r.assigned_on_any_leaf_task?(s(),o("div",Me," Not Assigned To Any Task ")):(s(),o("div",Ne,g(i.completed_count)+" / "+g(i.total_assigned),1))]))),128))]))),128))])])):(s(),o("table",Oe,[t("caption",je,[J(u.$slots,"caption",{},()=>[p[3]||(p[3]=C("Progress"))])]),p[4]||(p[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(s(!0),o(B,null,W(e.value,(r,m)=>(s(),o("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Re,g(m+1),1),t("td",Be,[w(vt,{user:r},null,8,["user"])]),t("td",Fe,g(d(z)(r.task_started_at)),1),t("td",Ve,g(d(z)(r.task_finished_at)),1)]))),128))])]))}}}),qe=Ct("task-user",()=>({updateUserStartDate:async(e,c,u)=>await ft.patch(`/task-user/task/${e}/user/${c}/update-start-date/${u}`),updateUserFinishDate:async(e,c,u)=>await ft.patch(`/task-user/task/${e}/user/${c}/update-finish-date/${u}`)})),He={class:"border-b text-center"},ze={key:0},Ke={key:1},We={class:"text-center font-semibold text-blue-800 my-4"},Ze={class:"flex justify-center w-full"},Je={class:"py-6 w-4/12"},Ye={class:"block text-xs font-semibold"},Qe={class:"mt-3"},Xe={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},ts={class:"flex justify-between items-center"},Tt={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(k,{emit:a}){const e=k,c=a,u=qe(),p=U(""),x=U("");async function y(){var m,i;console.log({date:p.value});try{e.type=="start-date"?await u.updateUserStartDate(e.task.id,e.user.id,p.value||"0"):e.type=="finish-date"&&await u.updateUserFinishDate(e.task.id,e.user.id,p.value||"0"),c("updateDate")}catch(h){x.value=((i=(m=h.response)==null?void 0:m.data)==null?void 0:i.message)||`Failed to update ${e.type}`}}function r(m){if(m){const i=e.type==="start-date"?m.started_at:m.completed_at;p.value=Ht(i)}}return Y(()=>e.task,m=>{r(m)},{immediate:!0}),st(()=>{r(e.task)}),(m,i)=>(s(),o("form",{class:"p-4",onSubmit:L(y,["prevent"])},[t("div",He,[k.type=="start-date"?(s(),o("h2",ze,"Edit Start Date")):k.type=="finish-date"?(s(),o("h2",Ke,"Edit Completed Date")):v("",!0)]),t("div",We,g(k.task.title),1),t("div",Ze,[t("div",Je,[t("label",Ye,g(k.type=="start-date"?"Start date":"Completed date"),1),et(t("input",{type:"date","onUpdate:modelValue":i[0]||(i[0]=h=>p.value=h),class:"border py-2 px-4 rounded-md w-full"},null,512),[[_t,p.value]])])]),i[3]||(i[3]=t("hr",{class:"mt-4"},null,-1)),t("div",Qe,[x.value?(s(),o("div",Xe,g(x.value),1)):v("",!0)]),t("div",ts,[t("button",{class:"btn-3",onClick:i[1]||(i[1]=L(h=>c("closeClick"),["prevent"]))},"Close"),i[2]||(i[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},es={key:0},ss={key:1,class:"flex"},as={class:"border-r-2 border-dashed pr-6 border-gray-300"},ls={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},ns={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},os={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},rs={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},is={key:0},ds=["disabled"],us=["disabled"],cs={class:"text-lg font-semibold text-gray-700"},ps={class:"text-sm text-gray-500"},ks={class:"flex flex-grow justify-center items-center"},ms={key:0,class:"flex flex-col justify-center items-center"},fs={key:1},ys={key:1},vs={key:2,class:"flex justify-center items-center flex-col"},bs={key:3,class:"flex flex-col justify-center items-center"},xs={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},gs={class:"my-6"},_s={class:"text-center font-semibold text-blue-800 mb-4"},hs={class:"text-center my-1"},Ts={class:"border px-2 rounded-md bg-gray-50"},$s={class:"text-red-600 text-center mt-2 text-sm"},ws={class:"flex justify-between mt-3"},Cs={class:"btn-2"},Ss={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(k,{emit:a}){const e=k,c=a,u=X(),p=U(""),x=U(),y=U(),r=Z({user:null,type:""});function m(l){r.user=u.user,r.type=l}const i={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},h=D(()=>(i==null?void 0:i[_.value])||0),b=D(()=>{var l;return{"bg-yellow-50":_.value==="IN_PROGRESS","bg-green-50":_.value==="COMPLETED","bg-red-50":_.value==="PENDING","bg-blue-50":(l=e.task)==null?void 0:l.closed_at}}),_=D(()=>{var l;return(l=e.task)==null?void 0:l.status}),$=D(()=>_.value=="PENDING"?"Start":_.value=="IN_PROGRESS"?"Finish":_.value=="COMPLETED"?"Close":""),N=D(()=>$.value=="Start"?"Start Task":$.value=="Finish"?"Finish Task":$.value=="Close"?"Close Task":"");async function M(){var l,n;x.value="submitting";try{await Rt(e.task.id,{status:p.value}),p.value="",c("updateStatus")}catch(E){y.value=(n=(l=E.response)==null?void 0:l.data)==null?void 0:n.message,c("error")}finally{x.value=""}}const A=D(()=>$.value=="Start"?"fas fa-play-circle text-blue-500":$.value=="Finish"?"fas fa-stop-circle text-blue-500":""),f=D(()=>{var l,n,E,F,V,G,T,q;return[{date:z((l=e.task)==null?void 0:l.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((n=e.task)!=null&&n.assigned_at)},{date:z((E=e.task)==null?void 0:E.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((F=e.task)!=null&&F.started_at)||h.value>=i.IN_PROGRESS},{date:z((V=e.task)==null?void 0:V.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((G=e.task)!=null&&G.completed_at)||h.value>=i.COMPLETED},{date:z((T=e.task)==null?void 0:T.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((q=e.task)!=null&&q.deadline)}].sort((O,j)=>O.date===null||j.date===null||new Date(O.date)==new Date(j.date)?O.serial-j.serial:new Date(O.date)-new Date(j.date))});return(l,n)=>{var E,F,V,G;return s(),o("div",{class:R(["border py-8 px-4 rounded",b.value])},[_.value==="BLOCKED"?(s(),o("div",es,n[8]||(n[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(s(),o("div",ss,[t("div",as,[(E=e.task)!=null&&E.is_target?(s(),o("div",ls,n[9]||(n[9]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),C(" TARGET TASK ")]))):v("",!0),t("ol",ns,[(s(!0),o(B,null,W(f.value,(T,q)=>{var O,j;return s(),o("li",{class:"ml-5",key:q},[t("div",os,[T.active?(s(),o("i",{key:0,class:R([T.icon,"text-xs"])},null,2)):v("",!0)]),t("div",{class:R({"opacity-30":!T.active})},[t("div",rs,[T.date?(s(),o("span",is,g(T.date),1)):v("",!0),((O=e.task)==null?void 0:O.children_task_count)===0&&T.status==="started"&&T.active?(s(),o("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:n[0]||(n[0]=L(()=>m("start-date"),["prevent"])),disabled:!!e.task.closed_at},g(T.date?"Edit":"Set Date"),9,ds)):v("",!0),((j=e.task)==null?void 0:j.children_task_count)===0&&T.active&&T.status==="completed"?(s(),o("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:n[1]||(n[1]=L(()=>m("finish-date"),["prevent"])),disabled:!!e.task.closed_at},g(T.date?"Edit":"Set Date"),9,us)):v("",!0)]),t("h3",cs,g(T.title),1),t("p",ps,g(T.description),1)],2)])}),128))])]),t("div",ks,[(F=k.task)!=null&&F.closed_at?(s(),o("div",ms,n[10]||(n[10]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):_.value==="PENDING"?(s(),o("div",fs,[((V=k.task)==null?void 0:V.children_task_count)===0?(s(),o("button",{key:0,class:"btn-3 mt-2",onClick:n[2]||(n[2]=L(T=>p.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(s(),o("div",ys,n[11]||(n[11]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),t("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):_.value==="IN_PROGRESS"?(s(),o("div",vs,[n[12]||(n[12]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),n[13]||(n[13]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((G=k.task)==null?void 0:G.children_task_count)===0?(s(),o("button",{key:0,class:"btn-3",onClick:n[3]||(n[3]=L(T=>p.value="COMPLETED",["prevent"]))}," Finish Task ")):v("",!0)])):_.value==="COMPLETED"?(s(),o("div",bs,[n[14]||(n[14]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),n[15]||(n[15]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:n[4]||(n[4]=L(T=>p.value="CLOSED",["prevent"]))},"Close Task")])):v("",!0)])])),p.value?(s(),I(H,{key:2},{default:P(()=>{var T;return[t("form",{class:"p-4 rounded relative",onSubmit:L(M,["prevent"])},[x.value==="submitting"?(s(),I(Q,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:P(()=>n[16]||(n[16]=[C("Submitting!")])),_:1,__:[16]})):v("",!0),t("h3",xs,g(N.value),1),t("div",gs,[t("div",_s,g((T=k.task)==null?void 0:T.title),1),n[19]||(n[19]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",hs,[n[17]||(n[17]=C(" Want to ")),t("span",Ts,[t("i",{class:R(["text-sm",A.value])},null,2),C(" "+g($.value),1)]),n[18]||(n[18]=C(" the task? "))])]),n[20]||(n[20]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",$s,g(y.value),1),t("div",ws,[t("button",{class:"btn-3",onClick:n[5]||(n[5]=L(q=>p.value="",["prevent"]))},"Cancel"),t("button",Cs,[t("i",{class:R(["text-xl text-white",A.value])},null,2),C(" "+g($.value)+" Task ",1)])])])],32)]}),_:1})):v("",!0),r!=null&&r.user?(s(),I(H,{key:3},{default:P(()=>[w(Tt,{task:e.task,user:r.user,type:r.type,onCloseClick:n[6]||(n[6]=T=>r.user=null),onUpdateDate:n[7]||(n[7]=()=>{r.user=null,r.type=null,c("updateStatus")})},null,8,["task","user","type"])]),_:1})):v("",!0)],2)}}},Ds={class:"container mx-auto p-6"},Is={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},Es={class:"grid grid-cols-4"},Ps={class:"mb-4 flex col-span-full"},Ls={class:"font-medium text-xl"},Us={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},As={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-2 py-[2px] rounded-full border border-green-200 opacity-80"},Ms={class:"text-gray-400 text-xs mt-2 col-span-full"},Ns={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},Os={class:"col-span-full mb-4"},js=["innerHTML"],Rs={key:0,class:"mt-4 col-span-full mb-6"},Bs={class:"mt-2 py-2 flex flex-col lg:flex-row gap-y-4 justify-center items-center gap-2 col-span-full"},Fs={class:"flex items-center gap-4 flex-wrap justify-center"},Vs=["disabled"],Gs={class:"lg:ml-auto flex gap-4 items-center"},qs={key:0},Hs={key:2},zs={key:1,class:"text-center py-4 text-red-500"},_a={__name:"TaskShow",setup(k){const a=Kt(),e=tt(),c=St(),u=U(""),p=D(()=>a.tasks),x=U({}),y=Z({open:!1,task:null}),r=U(!0);st(async()=>{u.value="loading",await i(e.params.id),u.value="",e.hash=="#sub-tasks"&&Dt(()=>{console.log({hash:document.getElementById(e.hash)}),bt(e.hash)})});const m=Z({user:null,type:""});async function i(f){await a.fetchTask(f)}const h=D(()=>ht(a.task.users,a.task.task_reports||[]));async function b(){await i(e.params.id),m.user=null,m.type=""}const _=f=>{c.push({name:"TaskEdit",params:{id:f}})},$=D(()=>{var f,l;return a.task?((f=a.task)==null?void 0:f.parent_id)==0?{name:A.value?"MyTaskList":"TaskList"}:{params:{id:(l=a.task)==null?void 0:l.parent_id},query:{"is-my-task":A.value}}:null});function N(){y.open=!0,y.task=a.task}function M(){y.open=!1,console.log({STATE:"Deleted",backLink:$.value}),c.push($.value)}const A=D(()=>e.name=="MyTaskShow"||!!e.query["is-my-task"]);return Y(()=>e.params.id,async f=>{u.value="changing",await i(f),u.value=""}),Y(()=>e.hash,async function(){setTimeout(bt,0,e.hash)}),(f,l)=>{var F,V,G,T,q,O,j,at,lt,nt,ot,rt,it,dt,ut,ct,pt,kt,mt;const n=yt("RouterLink"),E=yt("router-view");return s(),o("div",Ds,[C(g(d(e).hash)+" ",1),m.user?(s(),I(H,{key:0},{default:P(()=>[w(Tt,{task:d(a).task,user:m.user,type:m.type,onCloseClick:l[0]||(l[0]=S=>m.user=null),onUpdateDate:b},null,8,["task","user","type"])]),_:1})):v("",!0),y.open?(s(),I(H,{key:1},{default:P(()=>[w(Ce,{onCloseClick:l[1]||(l[1]=S=>y.open=!1),task:y.task,onDelete:M},null,8,["task"])]),_:1})):v("",!0),u.value==="loading"?(s(),I(Q,{key:2})):(s(),o("div",Is,[d(a).task?(s(),o(B,{key:0},[t("section",Es,[t("div",Ps,[t("div",null,[t("h2",Ls,g(d(a).task.title),1),t("div",Us,[d(a).task.parent_id==0?(s(),o("div",As," MAIN TASK ")):v("",!0),(F=d(a).task)!=null&&F.is_important?(s(),I(Gt,{key:1})):v("",!0),(V=d(a).task)!=null&&V.is_urgent?(s(),I(qt,{key:2})):v("",!0)]),t("div",Ms,[l[14]||(l[14]=t("i",{class:"fas fa-clock"},null,-1)),C(" "+g(d(zt)(d(a).task.created_at)),1)])]),t("div",Ns,[w(Bt,{status:(G=d(a).task)==null?void 0:G.status,progressPercent:(T=d(a).task)==null?void 0:T.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),d(a).task?(s(),I(Ft,{key:0,task:d(a).task,ref_key:"progress",ref:x,class:"!text-lg"},null,8,["task"])):v("",!0)])]),t("div",Os,[t("p",{innerHTML:(q=d(a).task)==null?void 0:q.description,class:R(["text-gray-700",{"line-clamp-3":r.value}])},null,10,js),((j=(O=d(a).task)==null?void 0:O.description)==null?void 0:j.length)>=600?(s(),o("button",{key:0,class:"text-blue-500 mt-2",onClick:l[2]||(l[2]=L(S=>r.value=!r.value,["prevent"]))}," Show "+g(r.value?"More":"Less"),1)):v("",!0)]),w(Vt,{task:(at=d(a))==null?void 0:at.task,"tree-level":(nt=(lt=d(a))==null?void 0:lt.task)==null?void 0:nt.level,class:"justify-center border col-span-full border-dashed rounded-lg"},null,8,["task","tree-level"]),d(a).task.children_task_count>0?(s(),o("section",Rs,[w(Ge,{"task-users":((ot=d(a).task)==null?void 0:ot.users)||[],task:d(a).task,"sub-tasks":d(a).tasks,"progress-users":h.value},{caption:P(()=>l[15]||(l[15]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):v("",!0),(rt=d(a))!=null&&rt.task?(s(),I(Ss,{key:1,task:((it=d(a))==null?void 0:it.task)||{},class:"col-span-full mt-4",onUpdateStatus:l[3]||(l[3]=()=>{var S,K;return i((K=(S=d(a))==null?void 0:S.task)==null?void 0:K.id)})},null,8,["task"])):v("",!0),t("div",Bs,[t("div",Fs,[t("button",{onClick:l[4]||(l[4]=L(S=>{var K;return _((K=d(a).task)==null?void 0:K.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!d(a).task.closed_at},l[16]||(l[16]=[t("i",{class:"fas fa-edit"},null,-1),C(" Edit ")]),8,Vs),w(n,{to:{name:"TaskUserAssign",params:{id:(dt=d(a).task)==null?void 0:dt.id}},class:R(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",d(a).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:l[5]||(l[5]=S=>S.stopPropagation())},{default:P(()=>l[17]||(l[17]=[t("i",{class:"fas fa-users-cog"},null,-1),C(" Assign Users ")])),_:1,__:[17]},8,["to","class"]),t("button",{class:"border-2 border-indigo-500 hover:bg-indigo-500 hover:text-white text-indigo-500 font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none whitespace-nowrap",onClick:l[6]||(l[6]=S=>d(c).back())},l[18]||(l[18]=[t("i",{class:"fas fa-arrow-left"},null,-1),C(" Back ")])),w(n,{to:$.value,class:"border-2 border-indigo-500 hover:bg-indigo-500 hover:text-white ml-2 text-indigo-500 font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none whitespace-nowrap",onClick:l[7]||(l[7]=S=>S.stopPropagation())},{default:P(()=>l[19]||(l[19]=[t("i",{class:"fas fa-arrow-left"},null,-1),C(" Parent Task ")])),_:1,__:[19]},8,["to"])]),t("div",Gs,[((ut=d(a).task)==null?void 0:ut.children_task_count)===0&&((ct=d(a).task)==null?void 0:ct.status)==="PENDING"?(s(),o("button",{key:0,class:"btn-2-red h-8",onClick:L(N,["prevent"])}," Delete ")):v("",!0),p.value.length>0?(s(),I(n,{key:1,to:{name:A.value||d(e).query["is-my-task"]?"MyTaskShow":"TaskShow",params:{id:(pt=d(a).task)==null?void 0:pt.id},hash:"#sub-tasks"},onClick:l[8]||(l[8]=S=>S.stopPropagation()),class:R(["py-0.5 btn-3 ml-auto text-sm h-8 whitespace-nowrap",{"bg-blue-500 text-white":d(e).name=="TaskShow"||d(e).name==="MyTaskShow"}])},{default:P(()=>l[20]||(l[20]=[t("i",{class:"fal fa-list-ul"},null,-1),C(" Sub Tasks ")])),_:1,__:[20]},8,["to","class"])):v("",!0),w(n,{to:{name:"TaskReports",params:{id:(kt=d(a).task)==null?void 0:kt.id},query:{"is-my-task":A.value},hash:"#task-reports"},onClick:l[9]||(l[9]=S=>S.stopPropagation()),class:R(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":d(e).name=="TaskReports"}])},{default:P(()=>l[21]||(l[21]=[t("i",{class:"fal fa-file-alt"},null,-1),C(" Reports ")])),_:1,__:[21]},8,["to","class"])])])]),l[22]||(l[22]=t("div",{id:"sub-tasks"},null,-1)),(d(e).name=="TaskShow"||d(e).name==="MyTaskShow")&&((mt=d(a).task)==null?void 0:mt.level)<=2?(s(),o("section",qs,[w(ne,{subTasks:p.value,"parent-id":d(e).params.id,"sub-task-is-creatable":!d(a).task.closed_at,"tree-level":d(a).task.level+1,onCreated:l[10]||(l[10]=S=>i(d(e).params.id)),onUpdated:l[11]||(l[11]=S=>i(d(e).params.id)),onUpdatePriority:l[12]||(l[12]=S=>i(d(e).params.id)),onAssignUser:l[13]||(l[13]=S=>i(d(e).params.id))},null,8,["subTasks","parent-id","sub-task-is-creatable","tree-level"])])):v("",!0),d(e).name==="TaskReportAdd"?(s(),I(H,{key:1,class:"*:bg-transparent"},{default:P(()=>[w(E)]),_:1})):(s(),o("section",Hs,[w(E)]))],64)):(s(),o("div",zs,g(d(a).error),1)),u.value==="changing"?(s(),I(Q,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):v("",!0)]))])}}};export{_a as default};
