import{d as tt,b as et,m as w,r as A,c as n,o as s,a as t,g as y,G as Q,F as j,k as u,w as E,t as x,q as S,i as U,s as Y,f as I,h as st,y as Tt,H as xt,e as at,I as $t,x as lt,j as P,v as gt,n as J,J as St,D as ft,p as O,u as Ct,A as yt}from"./index-D6IyOSuI.js";import{L as X}from"./LoaderView-CbihmVPO.js";import{O as Z}from"./OverlyModal-B0gA-vm1.js";import{m as wt,_ as Dt}from"./task-tree-B72YDchZ.js";import{_ as It}from"./TaskAddForm-BK1qk1uN.js";import{_ as Et}from"./TaskEditForm-prQpnop5.js";import{_ as Pt}from"./TaskTreeView-3mjFfxbN.js";import{a as Lt,_ as Ut}from"./TaskUserAssignForm-TMMMjrTa.js";import{u as At,r as Mt,d as Nt,a as Ot}from"./task-priority-D_u_AmYP.js";import{b as jt,c as Rt,e as Ft,T as Bt,d as Vt}from"./TaskSupervisorAndEmployee-wtbQIrZ5.js";import{a as z,g as Gt,b as qt}from"./datetime-DLUp6MRA.js";import{_ as vt}from"./UserChip-Qp-JYzPq.js";import{u as Ht}from"./useTaskStore-BFHzYgjO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-CJ0wjOIP.js";import"./company-B6Y6Xppm.js";import"./useRequirementStore-DtM33zsp.js";import"./requirement-BitkRrN0.js";import"./CompanyDepartmentSelectInput-B-OOxYrO.js";import"./SectionLoading-GHLmBLrt.js";import"./TextWithHr-Dbie8If8.js";import"./TaskUrgencyInput-BBWPhgvt.js";import"./tags-C-kpyLIT.js";import"./MultiselectDropdown-DRun3tzX.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DhCdI7Zc.js";import"./url-CePbr-gY.js";import"./TaskUserChip-sJUoJXai.js";const Wt={class:"mb-3"},Zt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},zt={key:1,class:"text-center py-4 text-gray-500"},Kt={key:2,class:"text-center py-4 text-red-500"},Jt={key:3,class:"space-y-4"},Yt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(k,{emit:a}){const e=k,c=tt(),d=et(),p=w(()=>{var v;return!!(((v=c==null?void 0:c.user)==null?void 0:v.role)!=="employee"&&(c!=null&&c.isAdminMood))}),b=a,f=A(null),{handleItemsPriorityUpdate:i,saveTaskPriority:m,listHasRearranged:r}=At(()=>e.tasks,e.parentId),_=async()=>{await m(),b("updatePriority")};return(v,g)=>(s(),n("div",null,[t("div",Wt,[Q(v.$slots,"task:header")]),p.value?(s(),n(j,{key:0},[u(r)?(s(),n("div",Zt,[g[4]||(g[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:E(_,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:g[0]||(g[0]=E((...$)=>f.value.resetItems&&f.value.resetItems(...$),["prevent"]))},"Discard")])):y("",!0)],64)):y("",!0),k.loading?(s(),n("div",zt,"Loading tasks...")):k.error?(s(),n("div",Kt,x(k.error),1)):(s(),n("div",Jt,[S(Lt,{items:k.tasks,handle:"handle",onItemsUpdate:u(i),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:f},{item:U(({item:$,index:N})=>[S(Pt,{isMyTask:u(d).name=="MyTaskShow",index:N,task:$,showDraggableHandle:p.value,"tree-level":k.treeLevel,class:"!border-0",onCommentButtonClick:M=>b("commentButtonClick",$.id),onEditClick:g[1]||(g[1]=M=>b("editClick",M)),onAddClick:g[2]||(g[2]=M=>b("addClick",M)),onEmployeeAssignClick:g[3]||(g[3]=M=>b("employeeAssignClick",M))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Qt={class:"flex justify-between mt-5"},Xt={class:"flex justify-between items-center gap-4"},te={class:"w-32 relative h-8 mx-4"},ee={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},se={key:3,class:"border p-4 rounded text-center text-gray-500 italic"},ae={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(k,{emit:a}){const e=k,c=et(),d=tt(),p=A(""),b=A("not-completed"),f=Y({taskId:0,isOpen:!1}),i=a,m=A(),r=Y({show:!1,parentId:e.parentId,requirementId:null}),_=C=>{r.show=!0,r.parentId=C,console.log({addForm:r})};function v(){r.show=!1,r.parentId=e.parentId,i("created")}function g(){i("assignUser")}function $(){m.value=!1,i("updated")}function N(){r.show=!1,r.parentId=e.parentId}const M=w(()=>{var C;return Array.isArray(e.subTasks)?wt(e.subTasks,{status:b.value,...c.name=="MyTaskShow"?{"user-ids":(C=d==null?void 0:d.user)==null?void 0:C.id}:{}}).filter(l=>{var T,o,D;return p.value?(D=(T=l==null?void 0:l.title)==null?void 0:T.toUpperCase())==null?void 0:D.includes((o=p.value)==null?void 0:o.toUpperCase()):!0}):[]});return(C,l)=>{var T;return s(),n("div",null,[m.value?(s(),I(Z,{key:0},{default:U(()=>[S(Et,{taskId:m.value,onClose:l[0]||(l[0]=o=>m.value=null),onUpdated:$},null,8,["taskId"])]),_:1})):y("",!0),r.show?(s(),I(Z,{key:1},{default:U(()=>[S(It,{parentTaskId:r.parentId,requirementId:r.requirementId,onTaskCreated:v,onError:C.handleTaskError,onClose:N},null,8,["parentTaskId","requirementId","onError"])]),_:1})):y("",!0),f.isOpen?(s(),I(Z,{key:2},{default:U(()=>[S(Ut,{taskId:f.taskId,onCancelClick:l[1]||(l[1]=()=>{f.isOpen=!1,f.taskId=0}),onSuccess:l[2]||(l[2]=()=>{f.isOpen=!1,f.taskId=0,g()})},null,8,["taskId"])]),_:1})):y("",!0),S(Yt,{tasks:M.value,parentId:k.parentId,treeLevel:k.treeLevel,onAddClick:l[6]||(l[6]=o=>_(o)),onEditClick:l[7]||(l[7]=o=>m.value=o),onUpdatePriority:l[8]||(l[8]=o=>i("updatePriority")),onEmployeeAssignClick:l[9]||(l[9]=o=>{f.taskId=o,f.isOpen=!0})},{"task:header":U(()=>{var o;return[t("div",Qt,[t("div",Xt,[l[12]||(l[12]=t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks",-1)),((o=e==null?void 0:e.subTasks)==null?void 0:o.length)>0?(s(),n(j,{key:0},[S(Dt,{modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=D=>p.value=D),class:"w-full md:w-48 md:ml-auto h-8","debounce-time":0},null,8,["modelValue"]),t("div",te,[l[11]||(l[11]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),st(t("select",{"onUpdate:modelValue":l[4]||(l[4]=D=>b.value=D),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},l[10]||(l[10]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[Tt,b.value]])])],64)):y("",!0)]),k.subTaskIsCreatable?(s(),n("div",ee,[t("button",{class:"btn-1 ml-auto",onClick:l[5]||(l[5]=E(()=>_(k.parentId),["prevent"]))}," Add Sub Task ")])):y("",!0)])]}),_:1},8,["tasks","parentId","treeLevel"]),((T=M.value)==null?void 0:T.length)===0&&k.treeLevel<=2?(s(),n("div",se," No Sub Tasks ")):y("",!0)])}}},le={key:0},ne={key:0},oe={key:1},re={key:2},ie={key:3},de={key:1},ue=xt({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(k){const a=k;let e=0;const c=A(b());let d;function p(){return a.millisecond&&typeof a.millisecond=="number"}function b(){p()?e&&(e-=1e3):e=new Date(a.targetDateTime).getTime()-new Date().getTime();const v=Math.floor(e/1e3%60),g=Math.floor(e/1e3/60%60),$=Math.floor(e/(1e3*60*60)%24),N=Math.floor(e/(1e3*60*60*24));return{total:e,days:N,hours:$,minutes:g,seconds:v}}function f(){c.value=b()}at(()=>{p()&&(e=a.millisecond),console.log("MOUNTED"),f(),d=setInterval(()=>{f(),c.value.total<=0&&clearInterval(d)},1e3)}),$t(()=>clearInterval(d)),lt(()=>a.targetDateTime,()=>{f(),clearInterval(d)});const i=w(()=>c.value.days.toString().padStart(2,"0")),m=w(()=>c.value.hours.toString().padStart(2,"0")),r=w(()=>c.value.minutes.toString().padStart(2,"0")),_=w(()=>c.value.seconds.toString().padStart(2,"0"));return(v,g)=>c.value.total>0?(s(),n("span",le,[!v.hideIfZeroValue||i.value!="00"?(s(),n("span",ne,x(i.value)+"d : ",1)):y("",!0),!v.hideIfZeroValue||m.value!="00"?(s(),n("span",oe,x(m.value)+"h : ",1)):y("",!0),!v.hideIfZeroValue||r.value!="00"?(s(),n("span",re,x(r.value)+"m : ",1)):y("",!0),!v.hideIfZeroValue||_.value!="00"?(s(),n("span",ie,x(_.value)+"s",1)):y("",!0)])):(s(),n("span",de,[Q(v.$slots,"expired")]))}}),ce={class:"mb-2 mt-6"},pe={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},ke={class:"flex justify-center"},me={class:"py-6 w-full text-center"},fe={class:"block mb-2"},ye={class:"font-semibold text-red-600 mx-2 text-xl"},ve={class:"mt-2"},be={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},xe={class:"flex justify-between items-center"},ge={key:0},_e={key:1},he={key:0,class:"btn-2-red"},Te={key:1,class:"btn-2-red"},bt=5e3,$e={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(k,{emit:a}){const e=k,c=A(""),d=A(""),p=a,b=A("");let f=0;async function i(){var _,v;if(!c.value)return b.value="Type the task title on input box";clearTimeout(f);try{b.value="",d.value==="deleted"?(d.value="restoring",await Mt(e.task.id),d.value="restored"):(d.value="deleting",await Nt(e.task.id,{params:{security_check:c.value}}),d.value="deleted"),d.value=="deleted"?f=setTimeout(()=>{r()},bt):p("closeClick")}catch(g){d.value="error",b.value=((v=(_=g.response)==null?void 0:_.data)==null?void 0:v.message)||`Failed to update ${e.type}`}}function m(){d.value==="deleted"&&r(),p("closeClick")}function r(){d.value="",p("delete")}return(_,v)=>{var g,$;return s(),n("form",{class:"p-4 relative",onSubmit:E(i,["prevent"])},[v[7]||(v[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",ce,[v[1]||(v[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,x((g=k.task)==null?void 0:g.title),1)]),d.value=="deleted"?(s(),n("div",pe,v[2]||(v[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(s(),n(j,{key:1},[t("div",ke,[t("div",me,[t("label",fe,[v[3]||(v[3]=P(" Type ")),t("span",ye,x(($=k.task)==null?void 0:$.title),1),v[4]||(v[4]=P(" and submit to delete "))]),st(t("input",{type:"text","onUpdate:modelValue":v[0]||(v[0]=N=>c.value=N),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[gt,c.value]])])]),v[5]||(v[5]=t("hr",null,null,-1)),t("div",ve,[b.value?(s(),n("div",be,x(b.value),1)):y("",!0)])],64)),t("div",xe,[t("button",{class:"btn-3",type:"button",onClick:E(m,["prevent"])},[d.value=="deleted"?(s(),n("span",ge,"Delete")):(s(),n("span",_e," Close "))]),d.value=="deleted"?(s(),n("button",he,[v[6]||(v[6]=P(" Undo Delete in ")),d.value=="deleted"?(s(),I(ue,{key:0,"hide-if-zero-value":!0,millisecond:bt})):y("",!0)])):(s(),n("button",Te,"Delete"))]),d.value=="deleting"||d.value=="restoring"?(s(),I(X,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:U(()=>[P(x(String(d.value).charAt(0).toUpperCase()+String(d.value).slice(1)),1)]),_:1})):y("",!0)],32)}}},Se=k=>k==null?void 0:k.reduce((a,e)=>a+e.task_weight,0),_t=(k,a)=>{const e=Se(k);return k.map(c=>{const d=a.filter(p=>p.user_id===c.id).reduce((p,b)=>p+b.progress,0);return{...c,task_progress:Math.floor(d*(c.task_weight/e)),user_progress:d}})},Ce=(k,a)=>{let e=0;const c=[],d=f=>f.status==="COMPLETED",p=f=>f.users.some(i=>i.id===a),b=(f,i)=>{f.forEach(m=>{const r=p(m);c[i]=c[i]||{user_id:a,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const _=r&&m.children_tasks.length===0;c[i].total_assigned+=r?1:0,c[i].total_assigned_on_leaf_task+=_?1:0,e+=_?1:0,r&&d(m)&&(c[i].completed_count++,m.children_tasks.length),m.children_tasks.length>0&&b(m.children_tasks,i+1)})};return b(k,0),{sub_task_infos:c,assigned_on_any_leaf_task:e>0}},we=(k,a)=>k.map(e=>({...e,...Ce(a,e.id)})),De={key:0,class:"min-w-full bg-white rounded overflow-hidden"},Ie={class:"py-0.5 text-bg font-semibold"},Ee={class:"bg-gray-50"},Pe={class:"px-2 py-1 border-y"},Le={class:"px-2 py-1 border-y"},Ue={key:0,class:"text-sm text-gray-400"},Ae={key:1},Me={key:1,class:"min-w-full bg-white rounded overflow-hidden"},Ne={class:"py-0.5 text-bg font-semibold"},Oe={class:"px-2 py-1 border-y text-center"},je={class:"px-2 py-1 border-y border-r"},Re={class:"px-2 py-1 border-y text-center"},Fe={class:"px-2 py-1 border-y text-center"},Be=xt({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(k){const a=k,e=w(()=>_t(a.task.users,a.task.task_reports||[])),c=w(()=>we(a.task.users,a.subTasks));return(d,p)=>{var b,f;return a.task.children_task_count>0?(s(),n("table",De,[t("caption",Ie,[Q(d.$slots,"caption",{},()=>[p[0]||(p[0]=P("Progress"))])]),t("thead",Ee,[t("tr",null,[p[1]||(p[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),p[2]||(p[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(s(!0),n(j,null,J(((f=(b=c.value[0]||{})==null?void 0:b.sub_task_infos)==null?void 0:f.length)||1,i=>(s(),n("th",{key:i,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},x(i===1?"Completed Sub Task":"")+" "+x(i===2?"Completed Sub Sub Task":"")+" "+x(i===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(s(!0),n(j,null,J(c.value,(i,m)=>(s(),n("tr",{key:i.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Pe,x(m+1),1),t("td",Le,[S(vt,{user:i},null,8,["user"])]),(s(!0),n(j,null,J(i.sub_task_infos,(r,_)=>(s(),n("td",{class:"px-2 py-1 border-y text-center",key:_},[r.total_assigned===0||!i.assigned_on_any_leaf_task?(s(),n("div",Ue," Not Assigned To Any Task ")):(s(),n("div",Ae,x(r.completed_count)+" / "+x(r.total_assigned),1))]))),128))]))),128))])])):(s(),n("table",Me,[t("caption",Ne,[Q(d.$slots,"caption",{},()=>[p[3]||(p[3]=P("Progress"))])]),p[4]||(p[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(s(!0),n(j,null,J(e.value,(i,m)=>(s(),n("tr",{key:i.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Oe,x(m+1),1),t("td",je,[S(vt,{user:i},null,8,["user"])]),t("td",Re,x(u(z)(i.task_started_at)),1),t("td",Fe,x(u(z)(i.task_finished_at)),1)]))),128))])]))}}}),Ve=St("task-user",()=>({updateUserStartDate:async(e,c,d)=>await ft.patch(`/task-user/task/${e}/user/${c}/update-start-date/${d}`),updateUserFinishDate:async(e,c,d)=>await ft.patch(`/task-user/task/${e}/user/${c}/update-finish-date/${d}`)})),Ge={class:"border-b text-center"},qe={key:0},He={key:1},We={class:"text-center font-semibold text-blue-800 my-4"},Ze={class:"flex justify-center w-full"},ze={class:"py-6 w-4/12"},Ke={class:"block text-xs font-semibold"},Je={class:"mt-3"},Ye={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Qe={class:"flex justify-between items-center"},ht={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(k,{emit:a}){const e=k,c=a,d=Ve(),p=A(""),b=A("");async function f(){var m,r;console.log({date:p.value});try{e.type=="start-date"?await d.updateUserStartDate(e.task.id,e.user.id,p.value||"0"):e.type=="finish-date"&&await d.updateUserFinishDate(e.task.id,e.user.id,p.value||"0"),c("updateDate")}catch(_){b.value=((r=(m=_.response)==null?void 0:m.data)==null?void 0:r.message)||`Failed to update ${e.type}`}}function i(m){if(m){const r=e.type==="start-date"?m.started_at:m.completed_at;p.value=Gt(r)}}return lt(()=>e.task,m=>{i(m)},{immediate:!0}),at(()=>{i(e.task)}),(m,r)=>(s(),n("form",{class:"p-4",onSubmit:E(f,["prevent"])},[t("div",Ge,[k.type=="start-date"?(s(),n("h2",qe,"Edit Start Date")):k.type=="finish-date"?(s(),n("h2",He,"Edit Completed Date")):y("",!0)]),t("div",We,x(k.task.title),1),t("div",Ze,[t("div",ze,[t("label",Ke,x(k.type=="start-date"?"Start date":"Completed date"),1),st(t("input",{type:"date","onUpdate:modelValue":r[0]||(r[0]=_=>p.value=_),class:"border py-2 px-4 rounded-md w-full"},null,512),[[gt,p.value]])])]),r[3]||(r[3]=t("hr",{class:"mt-4"},null,-1)),t("div",Je,[b.value?(s(),n("div",Ye,x(b.value),1)):y("",!0)]),t("div",Qe,[t("button",{class:"btn-3",onClick:r[1]||(r[1]=E(_=>c("closeClick"),["prevent"]))},"Close"),r[2]||(r[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},Xe={key:0},ts={key:1,class:"flex"},es={class:"border-r-2 border-dashed pr-6 border-gray-300"},ss={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},as={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},ls={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},ns={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},os={key:0},rs=["disabled"],is=["disabled"],ds={class:"text-lg font-semibold text-gray-700"},us={class:"text-sm text-gray-500"},cs={class:"flex flex-grow justify-center items-center"},ps={key:0,class:"flex flex-col justify-center items-center"},ks={key:1},ms={key:1},fs={key:2,class:"flex justify-center items-center flex-col"},ys={key:3,class:"flex flex-col justify-center items-center"},vs={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},bs={class:"my-6"},xs={class:"text-center font-semibold text-blue-800 mb-4"},gs={class:"text-center my-1"},_s={class:"border px-2 rounded-md bg-gray-50"},hs={class:"text-red-600 text-center mt-2 text-sm"},Ts={class:"flex justify-between mt-3"},$s={class:"btn-2"},Ss={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(k,{emit:a}){const e=k,c=a,d=tt(),p=A(""),b=A(),f=A(),i=Y({user:null,type:""});function m(T){i.user=d.user,i.type=T}const r={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},_=w(()=>(r==null?void 0:r[g.value])||0),v=w(()=>{var T;return{"bg-yellow-50":g.value==="IN_PROGRESS","bg-green-50":g.value==="COMPLETED","bg-red-50":g.value==="PENDING","bg-blue-50":(T=e.task)==null?void 0:T.closed_at}}),g=w(()=>{var T;return(T=e.task)==null?void 0:T.status}),$=w(()=>g.value=="PENDING"?"Start":g.value=="IN_PROGRESS"?"Finish":g.value=="COMPLETED"?"Close":""),N=w(()=>$.value=="Start"?"Start Task":$.value=="Finish"?"Finish Task":$.value=="Close"?"Close Task":"");async function M(){var T,o;b.value="submitting";try{await Ot(e.task.id,{status:p.value}),p.value="",c("updateStatus")}catch(D){f.value=(o=(T=D.response)==null?void 0:T.data)==null?void 0:o.message,c("error")}finally{b.value=""}}const C=w(()=>$.value=="Start"?"fas fa-play-circle text-blue-500":$.value=="Finish"?"fas fa-stop-circle text-blue-500":""),l=w(()=>{var T,o,D,R,F,B,h,V,G,q;return[{date:z(((T=e.task)==null?void 0:T.assigned_at)||((o=e.task)==null?void 0:o.created_at)),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((D=e.task)!=null&&D.assigned_at)||!!((R=e.task)!=null&&R.created_at)},{date:z((F=e.task)==null?void 0:F.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((B=e.task)!=null&&B.started_at)||_.value>=r.IN_PROGRESS},{date:z((h=e.task)==null?void 0:h.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((V=e.task)!=null&&V.completed_at)||_.value>=r.COMPLETED},{date:z((G=e.task)==null?void 0:G.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((q=e.task)!=null&&q.deadline)}].sort((H,W)=>H.date===null||W.date===null||new Date(H.date)==new Date(W.date)?H.serial-W.serial:new Date(H.date)-new Date(W.date))});return(T,o)=>{var D,R,F,B;return s(),n("div",{class:O(["border py-8 px-4 rounded",v.value])},[g.value==="BLOCKED"?(s(),n("div",Xe,o[8]||(o[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(s(),n("div",ts,[t("div",es,[(D=e.task)!=null&&D.is_target?(s(),n("div",ss,o[9]||(o[9]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),P(" TARGET TASK ")]))):y("",!0),t("ol",as,[(s(!0),n(j,null,J(l.value,(h,V)=>{var G,q;return s(),n("li",{class:"ml-5",key:V},[t("div",ls,[h.active?(s(),n("i",{key:0,class:O([h.icon,"text-xs"])},null,2)):y("",!0)]),t("div",{class:O({"opacity-30":!h.active})},[t("div",ns,[h.date?(s(),n("span",os,x(h.date),1)):y("",!0),((G=e.task)==null?void 0:G.children_task_count)===0&&h.status==="started"&&h.active?(s(),n("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:o[0]||(o[0]=E(()=>m("start-date"),["prevent"])),disabled:!!e.task.closed_at},x(h.date?"Edit":"Set Date"),9,rs)):y("",!0),((q=e.task)==null?void 0:q.children_task_count)===0&&h.active&&h.status==="completed"?(s(),n("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:o[1]||(o[1]=E(()=>m("finish-date"),["prevent"])),disabled:!!e.task.closed_at},x(h.date?"Edit":"Set Date"),9,is)):y("",!0)]),t("h3",ds,x(h.title),1),t("p",us,x(h.description),1)],2)])}),128))])]),t("div",cs,[(R=k.task)!=null&&R.closed_at?(s(),n("div",ps,o[10]||(o[10]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):g.value==="PENDING"?(s(),n("div",ks,[((F=k.task)==null?void 0:F.children_task_count)===0?(s(),n("button",{key:0,class:"btn-3 mt-2",onClick:o[2]||(o[2]=E(h=>p.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(s(),n("div",ms,o[11]||(o[11]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),t("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):g.value==="IN_PROGRESS"?(s(),n("div",fs,[o[12]||(o[12]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),o[13]||(o[13]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((B=k.task)==null?void 0:B.children_task_count)===0?(s(),n("button",{key:0,class:"btn-3",onClick:o[3]||(o[3]=E(h=>p.value="COMPLETED",["prevent"]))}," Finish Task ")):y("",!0)])):g.value==="COMPLETED"?(s(),n("div",ys,[o[14]||(o[14]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),o[15]||(o[15]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:o[4]||(o[4]=E(h=>p.value="CLOSED",["prevent"]))},"Close Task")])):y("",!0)])])),p.value?(s(),I(Z,{key:2},{default:U(()=>{var h;return[t("form",{class:"p-4 rounded relative",onSubmit:E(M,["prevent"])},[b.value==="submitting"?(s(),I(X,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:U(()=>o[16]||(o[16]=[P("Submitting!")])),_:1,__:[16]})):y("",!0),t("h3",vs,x(N.value),1),t("div",bs,[t("div",xs,x((h=k.task)==null?void 0:h.title),1),o[19]||(o[19]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",gs,[o[17]||(o[17]=P(" Want to ")),t("span",_s,[t("i",{class:O(["text-sm",C.value])},null,2),P(" "+x($.value),1)]),o[18]||(o[18]=P(" the task? "))])]),o[20]||(o[20]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",hs,x(f.value),1),t("div",Ts,[t("button",{class:"btn-3",onClick:o[5]||(o[5]=E(V=>p.value="",["prevent"]))},"Cancel"),t("button",$s,[t("i",{class:O(["text-xl text-white",C.value])},null,2),P(" "+x($.value)+" Task ",1)])])])],32)]}),_:1})):y("",!0),i!=null&&i.user?(s(),I(Z,{key:3},{default:U(()=>[S(ht,{task:e.task,user:i.user,type:i.type,onCloseClick:o[6]||(o[6]=h=>i.user=null),onUpdateDate:o[7]||(o[7]=()=>{i.user=null,i.type=null,c("updateStatus")})},null,8,["task","user","type"])]),_:1})):y("",!0)],2)}}},Cs={class:"container mx-auto p-6"},ws={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},Ds={class:"grid grid-cols-4"},Is={class:"mb-4 flex col-span-full"},Es={class:"font-medium text-xl"},Ps={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},Ls={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-2 py-[2px] rounded-full border border-green-200 opacity-80"},Us={class:"text-gray-400 text-xs mt-2 col-span-full"},As={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},Ms={class:"col-span-full mb-4"},Ns=["innerHTML"],Os={key:0,class:"mt-4 col-span-full mb-6"},js={class:"mt-6 py-2 flex justify-center items-center gap-2 col-span-full"},Rs=["disabled"],Fs={class:"ml-auto flex gap-4"},Bs={key:0},Vs={key:1},Gs={key:1,class:"text-center py-4 text-red-500"},va={__name:"TaskShow",setup(k){const a=Ht(),e=et(),c=Ct(),d=A(""),p=w(()=>a.tasks),b=A({}),f=Y({open:!1,task:null}),i=A(!0);at(async()=>{d.value="loading",await r(e.params.id),d.value=""});const m=Y({user:null,type:""});async function r(C){await a.fetchTask(C)}const _=w(()=>_t(a.task.users,a.task.task_reports||[]));async function v(){await r(e.params.id),m.user=null,m.type=""}const g=C=>{c.push({name:"TaskEdit",params:{id:C}})},$=w(()=>{var C,l;return a.task?((C=a.task)==null?void 0:C.parent_id)==0?{name:e.name==="MyTaskShow"?"MyTaskList":"TaskList"}:{params:{id:(l=a.task)==null?void 0:l.parent_id}}:null});function N(){f.open=!0,f.task=a.task}function M(){f.open=!1,console.log({STATE:"Deleted",backLink:$.value}),c.push($.value)}return lt(()=>e.params.id,async C=>{d.value="changing",await r(C),d.value=""}),(C,l)=>{var D,R,F,B,h,V,G,q,H,W,nt,ot,rt,it,dt,ut,ct,pt,kt;const T=yt("RouterLink"),o=yt("router-view");return s(),n("div",Cs,[m.user?(s(),I(Z,{key:0},{default:U(()=>[S(ht,{task:u(a).task,user:m.user,type:m.type,onCloseClick:l[0]||(l[0]=L=>m.user=null),onUpdateDate:v},null,8,["task","user","type"])]),_:1})):y("",!0),f.open?(s(),I(Z,{key:1},{default:U(()=>[S($e,{onCloseClick:l[1]||(l[1]=L=>f.open=!1),task:f.task,onDelete:M},null,8,["task"])]),_:1})):y("",!0),d.value==="loading"?(s(),I(X,{key:2})):(s(),n("div",ws,[u(a).task?(s(),n(j,{key:0},[t("section",Ds,[t("div",Is,[t("div",null,[t("h2",Es,x(u(a).task.title),1),t("div",Ps,[u(a).task.parent_id==0?(s(),n("div",Ls," MAIN TASK ")):y("",!0),(D=u(a).task)!=null&&D.is_important?(s(),I(Bt,{key:1})):y("",!0),(R=u(a).task)!=null&&R.is_urgent?(s(),I(Vt,{key:2})):y("",!0)]),t("div",Us,[l[13]||(l[13]=t("i",{class:"fas fa-clock"},null,-1)),P(" "+x(u(qt)(u(a).task.created_at)),1)])]),t("div",As,[S(jt,{status:(F=u(a).task)==null?void 0:F.status,progressPercent:(B=u(a).task)==null?void 0:B.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),u(a).task?(s(),I(Rt,{key:0,task:u(a).task,ref_key:"progress",ref:b,class:"!text-lg"},null,8,["task"])):y("",!0)])]),t("div",Ms,[t("p",{innerHTML:(h=u(a).task)==null?void 0:h.description,class:O(["text-gray-700",{"line-clamp-3":i.value}])},null,10,Ns),((G=(V=u(a).task)==null?void 0:V.description)==null?void 0:G.length)>=600?(s(),n("button",{key:0,class:"text-blue-500 mt-2",onClick:l[2]||(l[2]=E(L=>i.value=!i.value,["prevent"]))}," Show "+x(i.value?"More":"Less"),1)):y("",!0)]),S(Ft,{task:(q=u(a))==null?void 0:q.task,"tree-level":(W=(H=u(a))==null?void 0:H.task)==null?void 0:W.level,class:"justify-center border col-span-full border-dashed rounded-lg"},null,8,["task","tree-level"]),u(a).task.children_task_count>0?(s(),n("section",Os,[S(Be,{"task-users":((nt=u(a).task)==null?void 0:nt.users)||[],task:u(a).task,"sub-tasks":u(a).tasks,"progress-users":_.value},{caption:U(()=>l[14]||(l[14]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):y("",!0),(ot=u(a))!=null&&ot.task?(s(),I(Ss,{key:1,task:((rt=u(a))==null?void 0:rt.task)||{},class:"col-span-full mt-4",onUpdateStatus:l[3]||(l[3]=L=>{var K,mt;return r((mt=(K=u(a))==null?void 0:K.task)==null?void 0:mt.id)})},null,8,["task"])):y("",!0),t("div",js,[t("button",{onClick:l[4]||(l[4]=E(L=>{var K;return g((K=u(a).task)==null?void 0:K.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!u(a).task.closed_at}," Edit ",8,Rs),S(T,{to:{name:"TaskUserAssign",params:{id:(it=u(a).task)==null?void 0:it.id}},class:O(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",u(a).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:l[5]||(l[5]=L=>L.stopPropagation())},{default:U(()=>l[15]||(l[15]=[t("i",{class:"fas fa-user-plus"},null,-1),P(" Assign Users ")])),_:1,__:[15]},8,["to","class"]),S(T,{to:$.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none",onClick:l[6]||(l[6]=L=>L.stopPropagation())},{default:U(()=>l[16]||(l[16]=[t("i",{class:"fas fa-arrow-left"},null,-1),P(" Back ")])),_:1,__:[16]},8,["to"]),t("div",Fs,[((dt=u(a).task)==null?void 0:dt.children_task_count)===0&&((ut=u(a).task)==null?void 0:ut.status)==="PENDING"?(s(),n("button",{key:0,class:"btn-2-red h-8",onClick:E(N,["prevent"])}," Delete ")):y("",!0),p.value.length>0?(s(),I(T,{key:1,to:{name:"TaskShow",params:{id:(ct=u(a).task)==null?void 0:ct.id}},onClick:l[7]||(l[7]=L=>L.stopPropagation()),class:O(["py-0.5 btn-3 ml-auto text-sm h-8",{"bg-blue-500 text-white":u(e).name=="TaskShow"||u(e).name==="MyTaskShow"}])},{default:U(()=>l[17]||(l[17]=[t("i",{class:"fal fa-list-ul"},null,-1),P(" Sub Tasks ")])),_:1,__:[17]},8,["to","class"])):y("",!0),S(T,{to:{name:"TaskReports",params:{id:(pt=u(a).task)==null?void 0:pt.id}},onClick:l[8]||(l[8]=L=>L.stopPropagation()),class:O(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":u(e).name=="TaskReports"}])},{default:U(()=>l[18]||(l[18]=[t("i",{class:"fal fa-file-alt"},null,-1),P(" Reports ")])),_:1,__:[18]},8,["to","class"])])])]),(u(e).name=="TaskShow"||u(e).name==="MyTaskShow")&&((kt=u(a).task)==null?void 0:kt.level)<=2?(s(),n("section",Bs,[S(ae,{subTasks:p.value,"parent-id":u(e).params.id,"tree-level":u(a).task.level+1,onCreated:l[9]||(l[9]=L=>r(u(e).params.id)),onUpdated:l[10]||(l[10]=L=>r(u(e).params.id)),onUpdatePriority:l[11]||(l[11]=L=>r(u(e).params.id)),onAssignUser:l[12]||(l[12]=L=>r(u(e).params.id)),"sub-task-is-creatable":!u(a).task.closed_at},null,8,["subTasks","parent-id","tree-level","sub-task-is-creatable"])])):(s(),n("section",Vs,[S(o)]))],64)):(s(),n("div",Gs,x(u(a).error),1)),d.value==="changing"?(s(),I(X,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):y("",!0)]))])}}};export{va as default};
