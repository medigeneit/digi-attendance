import{d as gt,z as Q,m as w,c as i,o,a as e,g as f,j,F as M,y as H,x as G,t as h,w as W,b as St,u as $t,r as ct,e as Et,A as pt,n as mt,f as $,p as k,i as E,k as l,I as Mt}from"./index-BM9pAJxJ.js";import{L as kt}from"./LoaderView-DHG6m2i5.js";import{O as J}from"./OverlyModal-X9X4hls0.js";import{_ as ft}from"./DepartmentChip-BMXbzcLO.js";import{_ as _t}from"./DescriptionView-NdYUcI0k.js";import{_ as yt,a as At}from"./TaskAssignedUsers-BzdoCVBl.js";import{_ as Rt,a as Lt,b as Ut}from"./TaskStatusManager-DF9v7pkb.js";import{_ as jt}from"./TodoItemCard-B5s9ssH3.js";import{b as B,d as Nt}from"./datetime-Efw590t9.js";import{s as vt}from"./dom-BKn8Ftnz.js";import{u as Ot}from"./useTaskStore-Crd_UmLT.js";import{u as Pt}from"./useTodoDateStore-DtcOps8j.js";import{_ as Vt}from"./TodoCreateEditShow-Ma7IMsfC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BY1wU38o.js";import"./task-DpaKqMQx.js";import"./url-CePbr-gY.js";import"./requirement-DcSDPlrq.js";import"./useTodoStore-BAMpqTJ9.js";import"./TaskSelectionInput-BqnG2-qu.js";import"./TaskTitle-DF3fZMuR.js";const qt={class:"border-gray-300"},zt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Bt={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Gt={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},Ft={key:0,class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-2 justify-between"},Ht={key:0},Wt=["disabled"],Kt=["disabled"],Jt={class:"text-base font-semibold text-gray-700"},Qt={__name:"TaskTimeline",props:{task:{type:Object}},emits:["updateStatus","error"],setup(X,{emit:s}){const c=X,F=gt(),p=Q({user:null,type:""});function A(y){p.user=F.user,p.type=y}const g={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},D=w(()=>(g==null?void 0:g[_.value])||0),C=w(()=>{var y;return{"bg-yellow-50":_.value==="IN_PROGRESS","bg-green-50":_.value==="COMPLETED","bg-red-50":_.value==="PENDING","bg-blue-50":(y=c.task)==null?void 0:y.closed_at}}),_=w(()=>{var y;return(y=c.task)==null?void 0:y.status}),K=w(()=>{var y,x,S,r,R,T,d,N;return[{date:B((y=c.task)==null?void 0:y.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((x=c.task)!=null&&x.assigned_at)},{date:B((S=c.task)==null?void 0:S.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((r=c.task)!=null&&r.started_at)||D.value>=g.IN_PROGRESS},{date:B((R=c.task)==null?void 0:R.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((T=c.task)!=null&&T.completed_at)||D.value>=g.COMPLETED},{date:B((d=c.task)==null?void 0:d.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((N=c.task)!=null&&N.deadline)}].sort((L,U)=>L.date===null||U.date===null||new Date(L.date)==new Date(U.date)?L.serial-U.serial:new Date(L.date)-new Date(U.date))});return(y,x)=>{var S;return o(),i("div",{class:G(["border py-8 px-4 rounded",C.value])},[e("div",qt,[(S=c.task)!=null&&S.is_target?(o(),i("div",zt,x[2]||(x[2]=[e("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),j(" TARGET TASK ")]))):f("",!0),e("ol",Bt,[(o(!0),i(M,null,H(K.value,(r,R)=>{var T,d;return o(),i("li",{class:"ml-5",key:R},[e("div",Gt,[r.active?(o(),i("i",{key:0,class:G([r.icon,"text-xs"])},null,2)):f("",!0)]),e("div",{class:G({"opacity-30":!r.active})},[r.active?(o(),i("div",Ft,[r.date?(o(),i("span",Ht,h(r.date),1)):f("",!0),((T=c.task)==null?void 0:T.children_task_count)===0&&r.status==="started"&&r.active?(o(),i("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:x[0]||(x[0]=W(()=>A("start-date"),["prevent"])),disabled:!!c.task.closed_at},h(r.date?"Edit":"Set Date"),9,Wt)):f("",!0),((d=c.task)==null?void 0:d.children_task_count)===0&&r.active&&r.status==="completed"?(o(),i("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:x[1]||(x[1]=W(()=>A("finish-date"),["prevent"])),disabled:!!c.task.closed_at},h(r.date?"Edit":"Set Date"),9,Kt)):f("",!0)])):f("",!0),e("h3",Jt,h(r.title),1)],2)])}),128))])])],2)}}},Xt={class:"container mx-auto px-4"},Yt={key:3,class:"w-full xl:max-w-8xl min-h-64 mx-auto relative"},Zt={key:0,class:"text-sm mb-4 border-b","aria-label":"Breadcrumb"},It={class:"flex items-center gap-2"},te={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},ee=["title"],se=["to"],ae={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},oe={class:"grid grid-cols-12 gap-x-4 gap-y-3"},ne={class:"col-span-full md:col-span-7 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},le={class:"font-medium text-md flex items-start gap-2"},ie={class:"mt-2 col-span-full flex items-center"},re={class:"text-gray-400 text-xs"},de={class:"flex items-center gap-0.5"},ue={class:"text-sky-400 text-sm font-semibold"},ce=["innerHTML"],pe={class:"flex justify-between items-end mt-6 mb-2"},me={key:0,class:"border flex items-center justify-center h-96 rounded bg-gray-50 text-sm italic"},ke={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},fe={class:"font-semibold flex items-center gap-2"},_e={class:"text-white text-base"},ye={class:"col-span-full md:col-span-5 xl:col-span-4 2xl:col-span-3 space-y-4 sticky top-[74px] bg-white shadow rounded-lg p-4 pb-0"},ve={class:"border col-span-3 p-3 rounded-md"},ge={class:"flex items-center gap-2 mb-4"},xe={class:"flex items-center gap-2 mb-4"},he={class:"flex items-start justify-center !text-lg mb-4"},be={key:1,class:"flex items-center gap-4 flex-wrap justify-between col-span-3 sticky bottom-0 bg-white py-4"},we=["disabled"],Ce={key:2,class:"h-1"},Te={key:2},De={key:1,class:"text-center py-4 text-red-500"},Je={__name:"RequirementTaskShow",setup(X){const s=Ot(),c=gt(),F=Pt(),p=St(),A=$t(),g=ct(""),D=Q({open:!1,task:null});Et(async()=>{g.value="loading",await _(p.params.id),g.value="",p.hash=="#sub-tasks"&&setTimeout(()=>vt(p.hash,66),0)});const C=Q({user:null,type:""});async function _(a){await s.fetchTask(a,{with_todos:"true"})}async function K(){await _(p.params.id),C.user=null,C.type=""}const y=a=>{A.push({name:"TaskEdit",params:{id:a}})},x=w(()=>{var a,t;return s.task?((a=s.task)==null?void 0:a.parent_id)==0?{name:r.value?"MyTaskList":"TaskList"}:{params:{id:(t=s.task)==null?void 0:t.parent_id},query:{"is-my-task":r.value}}:null});function S(){D.open=!1,console.log({STATE:"Deleted",backLink:x.value}),A.push(x.value)}const r=w(()=>p.name=="MyTaskShow"||!!p.query["is-my-task"]),R=w(()=>{var a,t;return(t=(a=s==null?void 0:s.task)==null?void 0:a.users)==null?void 0:t.find(u=>{var v;return((v=c.user)==null?void 0:v.id)==u.id})}),T=w(()=>{var t,u,v,b,O,P,V,q;const a=[];return(u=(t=s.task)==null?void 0:t.requirement_detail)!=null&&u.id&&a.push({id:(b=(v=s.task)==null?void 0:v.requirement_detail)==null?void 0:b.id,title:(P=(O=s.task)==null?void 0:O.requirement_detail)==null?void 0:P.title,is_current_page:!1}),a.push({id:(V=s.task)==null?void 0:V.id,title:(q=s.task)==null?void 0:q.title,is_current_page:!0}),a});pt(()=>p.params.id,async a=>{g.value="changing",await _(a),g.value=""}),pt(()=>p.hash,async function(){setTimeout(()=>vt(p.hash,66),0)});const d=ct({action:null}),N=w(()=>{const t=((s==null?void 0:s.task_todo_dates)||[]).reduce((u,v)=>{const b=v.date;return u[b]||(u[b]=[]),u[b].push(v),u},{});return Object.keys(t).sort((u,v)=>new Date(v)-new Date(u)).map(u=>({date:u,todo_dates:t[u]}))});function L(){d.value={...d.value,action:""},_(p.params.id)}function U(){d.value={...d.value,action:""},_(p.params.id)}function Y(a){console.log({todo:a}),d.value={...d.value,action:"edit",todo:a}}function xt(a,t){console.log({yearMonthDay:t,todoId:a}),d.value={...d.value,action:"addDate",date:t,todo_id:a,formReadonlyValues:{date:!0}}}function ht(){d.value={action:null,todo:null}}function bt(a){console.log({todo:a}),d.value={...d.value,action:"show",todo:a}}function wt(){var a;d.value={...d.value,action:"add",todoTypeId:(a=p.params)==null?void 0:a.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}async function Ct(a,t){var u;confirm(`Are your sure?
want to change status to ${t} 
todo: '${a==null?void 0:a.title}'`)&&(await F.updateStatus(a.id,t),_((u=p.params)==null?void 0:u.id))}async function Tt(a){var t;confirm(`Are your sure want to delete todo
'${a==null?void 0:a.title}'`)&&(await F.deleteTodoDate(a.id),_((t=p.params)==null?void 0:t.id))}return(a,t)=>{var b,O,P,V,q,Z,I,tt,et,st,at,ot,nt,lt,it,rt,dt,ut;const u=mt("RouterLink"),v=mt("router-view");return o(),i("div",Xt,[C.user?(o(),$(J,{key:0},{default:E(()=>[k(Rt,{task:l(s).task,user:C.user,type:C.type,onCloseClick:t[0]||(t[0]=n=>C.user=null),onUpdateDate:K},null,8,["task","user","type"])]),_:1})):f("",!0),D.open?(o(),$(J,{key:1},{default:E(()=>[k(Lt,{onCloseClick:t[1]||(t[1]=n=>D.open=!1),task:D.task,onDelete:S},null,8,["task"])]),_:1})):f("",!0),g.value==="loading"?(o(),$(kt,{key:2,class:"h-[80vh] items-center justify-center"})):(o(),i("div",Yt,[l(s).task?(o(),i(M,{key:0},[T.value.length>1?(o(),i("nav",Zt,[e("ol",It,[(o(!0),i(M,null,H(T.value,(n,m)=>(o(),i(M,{key:n.id},[m>0?(o(),i("li",te,"/")):f("",!0),e("li",{title:n==null?void 0:n.title,class:"text-gray-600 line-clamp-1"},[n.is_current_page?(o(),i("span",ae,h(n==null?void 0:n.title),1)):(o(),i("div",{key:0,to:`${r.value?"/my-tasks":"/tasks"}/${n.id}`,class:G(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":m>0,"whitespace-nowrap":m===0}])},h(n==null?void 0:n.title),11,se))],8,ee)],64))),128))])])):f("",!0),e("div",oe,[e("div",ne,[e("div",null,[e("h2",le,[e("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:t[2]||(t[2]=n=>l(A).back())},t[7]||(t[7]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),k(_t,null,{default:E(()=>[j(h(l(s).task.title),1)]),_:1})]),e("div",ie,[e("div",re,[t[8]||(t[8]=e("i",{class:"fas fa-clock"},null,-1)),j(" "+h(l(Nt)(l(s).task.created_at)),1)]),(b=l(s).task)!=null&&b.created_by_user?(o(),i(M,{key:0},[t[9]||(t[9]=e("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),e("div",de,[k(Mt,{user:(O=l(s).task)==null?void 0:O.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),e("div",ue,h((V=(P=l(s).task)==null?void 0:P.created_by_user)==null?void 0:V.label),1)])],64)):f("",!0)])]),k(_t,null,{default:E(()=>{var n;return[e("p",{innerHTML:(n=l(s).task)==null?void 0:n.description,class:"text-justify"},null,8,ce)]}),_:1}),e("div",null,[e("div",pe,[t[11]||(t[11]=e("h3",{class:"font-semibold text-xl"},"Todos",-1)),R.value?(o(),i("button",{key:0,class:"btn btn-3 h-8",onClick:t[3]||(t[3]=W(()=>wt(),["prevent"]))},t[10]||(t[10]=[e("i",{class:"fas fa-plus"},null,-1),j(" Add Todo ")]))):f("",!0)]),e("div",null,[N.value.length===0?(o(),i("div",me," No Todos ")):f("",!0),(o(!0),i(M,null,H(N.value,n=>(o(),i("div",{key:n.date,class:"border rounded-md overflow-hidden mb-4"},[e("div",ke,[e("div",fe,[e("div",_e,h(l(B)(n.date)),1)])]),e("div",null,[(o(!0),i(M,null,H((n==null?void 0:n.todo_dates)||[],m=>(o(),$(jt,{key:m.id,todoDate:m,onClickTodo:z=>bt(z),onClickEdit:()=>Y(m==null?void 0:m.todo),onClickChangeStatus:(z,Dt)=>Ct(z,Dt),onClickDelete:z=>Tt(z),"hide-sorting-btn":"",class:"border-b border-sky-200"},null,8,["todoDate","onClickTodo","onClickEdit","onClickChangeStatus","onClickDelete"]))),128))])]))),128))])])]),e("div",ye,[e("div",ve,[e("div",null,[e("div",ge,[t[12]||(t[12]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),k(ft,{department:(Z=(q=l(s))==null?void 0:q.task)==null?void 0:Z.from_department,"short-name":!0},null,8,["department"])]),t[13]||(t[13]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisors",-1)),k(yt,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((tt=(I=l(s))==null?void 0:I.task)==null?void 0:tt.supervisors)||[],listType:"supervisors",maxItem:3},null,8,["users"])]),t[16]||(t[16]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",xe,[t[14]||(t[14]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),k(ft,{department:(st=(et=l(s))==null?void 0:et.task)==null?void 0:st.to_department,"short-name":!0},null,8,["department"])]),t[15]||(t[15]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Assigned Users",-1)),k(yt,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((ot=(at=l(s))==null?void 0:at.task)==null?void 0:ot.users)||[],isTargetTask:(lt=(nt=l(s))==null?void 0:nt.task)==null?void 0:lt.is_target,maxItem:5},null,8,["users","isTargetTask"])])]),k(Qt,{task:(it=l(s))==null?void 0:it.task},null,8,["task"]),(rt=l(s))!=null&&rt.task?(o(),$(Ut,{key:0,task:((dt=l(s))==null?void 0:dt.task)||{},class:"col-span-full",onUpdateStatus:t[4]||(t[4]=()=>{var n,m;return _((m=(n=l(s))==null?void 0:n.task)==null?void 0:m.id)}),"hide-timeline":""},{top:E(()=>{var n,m;return[e("div",he,[k(At,{status:(n=l(s).task)==null?void 0:n.status,progressPercent:(m=l(s).task)==null?void 0:m.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"])])]}),_:1},8,["task"])):f("",!0),l(c).isAdminMood?(o(),i("div",be,[k(u,{to:{name:"TaskUserAssign",params:{id:(ut=l(s).task)==null?void 0:ut.id}},class:G(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",l(s).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:t[5]||(t[5]=n=>n.stopPropagation())},{default:E(()=>t[17]||(t[17]=[e("i",{class:"fas fa-users-cog"},null,-1),j(" Assign Users ")])),_:1,__:[17]},8,["to","class"]),e("button",{onClick:t[6]||(t[6]=W(n=>{var m;return y((m=l(s).task)==null?void 0:m.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!l(s).task.closed_at},t[18]||(t[18]=[e("i",{class:"fas fa-edit"},null,-1),j(" Edit ")]),8,we)])):(o(),i("div",Ce))])]),l(p).name==="TaskReportAdd"?(o(),$(J,{key:1,class:"*:bg-transparent"},{default:E(()=>[k(v)]),_:1})):(o(),i("section",Te,[k(v)]))],64)):(o(),i("div",De,h(l(s).error),1)),g.value==="changing"?(o(),$(kt,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):f("",!0)])),k(Vt,{userRole:"employee",todoModal:d.value,onCancelClick:ht,onTodoUpdate:L,onTodoDateUpdate:U,onClickEdit:Y,onClickAddTodoDate:xt},null,8,["todoModal"])])}}};export{Je as default};
