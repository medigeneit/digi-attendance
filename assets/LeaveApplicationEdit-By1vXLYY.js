import{d as O,u as Q,b as X,q as f,r as k,e as ee,Y as ae,A as te,k as le,c as v,o as p,a,m as se,l as j,p as oe,n as ne,w as ie,f as E,g as c,v as U,t as T,F as $,y as q,h as I,Z as R}from"./index-CaN6P4fo.js";import{L as re}from"./LoaderView-en2CJy4M.js";import{_ as de}from"./MultiselectDropdown-DLRqYmDg.js";import{u as ue}from"./holiday-C-pW65hc.js";import{u as pe}from"./leave-application-Bb7PF9BB.js";import{u as ve}from"./leave-type-D1I_yM2L.js";import{u as ce}from"./user-BEeZK1YU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-DB08kEaY.js";const me={class:"my-container max-w-3xl space-y-4"},_e={class:"flex items-center justify-between gap-2"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye={key:0,class:""},we={class:"text-blue-600 font-medium"},ke={key:1,class:"bg-gray-100 p-2 rounded-md"},ge={class:"font-semibold"},he={class:"flex flex-wrap gap-2"},be=["name","value","onUpdate:modelValue"],De={class:"flex items-center space-x-1"},Ae=["name","onUpdate:modelValue"],Se={class:"flex items-center space-x-1"},xe=["name","onUpdate:modelValue"],Le={key:2,class:"text-red-500 text-sm"},Ne={__name:"LeaveApplicationEdit",setup(Ue){const m=O(),r=pe(),B=Q(),H=X(),y=ve(),g=ce(),Y=ue(),V=f(()=>r.leaveApplication),z=f(()=>H.params.id),h=k(null),l=k({user_id:"",last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]});ee(async()=>{var e,i,s,t,o,_,A,S,C,F,M,N;const{id:n}=H.params;try{await r.fetchLeaveApplicationById(n);const x=(s=(i=(e=r.leaveApplication)==null?void 0:e.user)==null?void 0:i.company)==null?void 0:s.id;if(x&&await y.fetchLeaveTypes(x),r.leaveApplication&&(await g.fetchTypeWiseEmployees({type:r.leaveApplication.user.type,except:[r.leaveApplication.user.id]}),g.users.length>0)){const w=f(()=>g.users.filter(L=>{var W;return L.id===((W=r.leaveApplication)==null?void 0:W.handover_user_id)})[0]||{});console.log("users",w.value),h.value=w.value}r.leaveApplication&&(l.value.user_id=(t=r.leaveApplication)==null?void 0:t.user_id,l.value.last_working_date=(o=r.leaveApplication)==null?void 0:o.last_working_date,l.value.resumption_date=(_=r.leaveApplication)==null?void 0:_.resumption_date,l.value.reason=(A=r.leaveApplication)==null?void 0:A.reason,l.value.works_in_hand=(S=r.leaveApplication)==null?void 0:S.works_in_hand,l.value.handover_user_id=(C=r.leaveApplication)==null?void 0:C.handover_user_id,l.value.leave_days=(F=r.leaveApplication)==null?void 0:F.leave_days,(M=r.leaveApplication)!=null&&M.json_data&&((N=r.leaveApplication)==null||N.json_data.forEach((w,L)=>{w.leave_type_id?d.value[L]=w.leave_type_id:d.value[L]=y.leaveTypes[0].id})))}catch(x){console.error("Failed to load leave application:",x)}finally{b.value=!1}});const d=k([]),b=k(!1),D=k(null),J=f(()=>{var n,e,i;return((e=(n=m==null?void 0:m.user)==null?void 0:n.assign_weekend)==null?void 0:e.weekends)||((i=m==null?void 0:m.user)==null?void 0:i.weekends)}),u=f(()=>{const n=l.value.last_working_date,e=l.value.resumption_date;if(!n||!e)return[];const i=new Date(n),s=new Date(e);if(s<=i)return[];const t=[];let o=new Date(i);for(o.setDate(o.getDate()+1);o<s;){const _=o.getFullYear(),A=(o.getMonth()+1).toString().padStart(2,"0"),S=o.getDate().toString().padStart(2,"0");t.push(`${_}-${A}-${S}`),o.setDate(o.getDate()+1)}return t}),P=f(()=>{const n=l.value.last_working_date,e=l.value.resumption_date;if(!n||!e)return"";const i=new Date(n);return new Date(e)<=i?"Resumption date must be after Last Working Date.":u.value.length===0?"No leave days between the selected dates.":`Total leave days: ${u.value.length}`});ae(()=>{u.value.length&&y.leaveTypes.length&&(d.value.length!==u.value.length&&(d.value=u.value.map(()=>y.leaveTypes[0].id)),u.value.forEach(async(n,e)=>{const i=new Date(n).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),s=i.charAt(0).toUpperCase()+i.slice(1);J.value.includes(s)&&(d.value[e]="weekend"),await K(n)&&(d.value[e]="holiday")}))}),te(()=>h.value,n=>{l.value.handover_user_id=n==null?void 0:n.id});const Z=async()=>{var n;b.value=!0,D.value=null;try{const e=u.value.map((t,o)=>({date:t,leave_type_id:d.value[o]!=="weekend"&&d.value[o]!=="holiday"?d.value[o]:null})).filter(t=>t.leave_type_id!==null),i=u.value.map((t,o)=>({date:t,leave_type_id:d.value[o]||""})).filter(t=>t.leave_type_id!==null),s={id:z.value,user_id:(n=V==null?void 0:V.value)==null?void 0:n.user_id,last_working_date:l.value.last_working_date,resumption_date:l.value.resumption_date,reason:l.value.reason,works_in_hand:l.value.works_in_hand,handover_user_id:l.value.handover_user_id,leave_days:e,json_data:i};if(s.id){const t=await r.updateLeaveApplication(s.id,s);t&&B.push({name:"LeaveApplicationShow",params:{id:t==null?void 0:t.id}})}}catch(e){D.value=e.message||"Failed to submit leave application"}finally{b.value=!1}},G=()=>{B.go(-1)},K=async n=>{var e;try{return(((e=(await Y.fetchHolidays({start_date:n}))[0])==null?void 0:e.start_date)||[]).includes(n)}catch(i){return console.error("Error fetching holidays:",i),!1}};return(n,e)=>{const i=le("RouterLink");return p(),v("div",me,[a("div",_e,[a("button",{class:"btn-3",onClick:G},e[5]||(e[5]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=a("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),a("div",null,[j(i,{to:"/my-applications",class:"btn-2"},{default:oe(()=>e[6]||(e[6]=[ne("Home")])),_:1})])]),b.value?(p(),se(re,{key:0})):(p(),v("form",{key:1,onSubmit:ie(Z,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[a("div",fe,[a("div",null,[e[8]||(e[8]=a("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),c(a("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=s=>l.value.last_working_date=s),class:"input-1 w-full",required:""},null,512),[[U,l.value.last_working_date]])]),a("div",null,[e[9]||(e[9]=a("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),c(a("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=s=>l.value.resumption_date=s),class:"input-1 w-full",required:""},null,512),[[U,l.value.resumption_date]])])]),l.value.last_working_date&&l.value.resumption_date?(p(),v("div",ye,[a("p",we,T(P.value),1)])):E("",!0),u.value.length?(p(),v("div",ke,[e[12]||(e[12]=a("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),a("div",null,[(p(!0),v($,null,q(u.value,(s,t)=>(p(),v("div",{key:t,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[a("div",ge,T(s),1),a("div",he,[(p(!0),v($,null,q(I(y).leaveTypes,o=>(p(),v("label",{key:o.id,class:"flex items-center space-x-1"},[c(a("input",{type:"radio",name:"leaveType-"+t,value:o.id,"onUpdate:modelValue":_=>d.value[t]=_},null,8,be),[[R,d.value[t]]]),a("span",null,T(o.name),1)]))),128)),a("label",De,[c(a("input",{type:"radio",name:"leaveType-"+t,value:"weekend","onUpdate:modelValue":o=>d.value[t]=o},null,8,Ae),[[R,d.value[t]]]),e[10]||(e[10]=a("span",null,"Weekend",-1))]),a("label",Se,[c(a("input",{type:"radio",name:"leaveType-"+t,value:"holiday","onUpdate:modelValue":o=>d.value[t]=o},null,8,xe),[[R,d.value[t]]]),e[11]||(e[11]=a("span",null," Holiday",-1))])])]))),128))])])):E("",!0),a("div",null,[e[13]||(e[13]=a("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),c(a("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=s=>l.value.reason=s),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[U,l.value.reason]])]),a("div",null,[e[14]||(e[14]=a("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),j(de,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=s=>h.value=s),options:I(g).users,multiple:!1,label:"label",placeholder:"Select user"},null,8,["modelValue","options"])]),a("div",null,[e[15]||(e[15]=a("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),c(a("textarea",{id:"works-in-hand","onUpdate:modelValue":e[4]||(e[4]=s=>l.value.works_in_hand=s),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[U,l.value.works_in_hand]])]),D.value?(p(),v("div",Le,T(D.value),1)):E("",!0),e[16]||(e[16]=a("div",{class:"flex justify-end"},[a("button",{type:"submit",class:"btn-1"},"Update")],-1))],32))])}}};export{Ne as default};
