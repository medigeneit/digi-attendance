import{C as ee,r as k,c as a,o as n,a as e,f as N,g as d,w as C,F as U,h as j,j as q,p as $,v as M,B as te,t as f,s as P,m as G,z as H,e as W,k as y,i as F,b as se,D as B,q as L}from"./index-DAvUzAED.js";import{L as E}from"./LoaderView-Dbu2g8oy.js";import{O}from"./OverlyModal-CTzvoroF.js";import{R as A}from"./RequiredIcon-uJKmq-sr.js";import{_ as z}from"./CompanyDepartmentSelectInput-B-DiMtEs.js";import{a as J,f as le}from"./requirement-BTnUbB1A.js";import{u as K}from"./company-Bakhb-Z9.js";import{u as Q}from"./tags-FU1yCq58.js";import{u as X}from"./useRequirementStore-CdTS4r3F.js";import{u as Y}from"./useTaskStore-DJ71wtzW.js";import{_ as Z}from"./MultiselectDropdown-mVfOvqoV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";async function oe(u,D){return ee.post(`/requirements/${u}/details`,D)}const ie={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},ne={class:"sticky top-0 pt-4 bg-white z-10"},re={class:"mb-4"},ae={class:"block text-gray-600 text-sm mb-1 font-medium"},de={class:"mb-4"},ue={class:"mb-4"},me={class:"mb-4"},pe={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},be={key:0,class:"mb-4 text-red-500 font-medium"},ve={key:1,class:"mb-4"},ce={class:"flex items-center justify-between gap-4"},fe=["disabled"],xe={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["taskCreated","closeClick","error"],setup(u,{emit:D}){const p=u,r=D,s=k(""),m=k(),b=k({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null});async function R(){var l,v;s.value="submitting";const _={...b.value};console.log({payload:_});try{const o=await oe(p.requirementId,_);r("create",o),s.value="create"}catch(o){s.value="error",m.value=((v=(l=o.response)==null?void 0:l.data)==null?void 0:v.message)||"Failed to create requirement detail",r("error",m.value)}}return(_,l)=>(n(),a("div",ie,[e("div",ne,[l[6]||(l[6]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement Details",-1)),l[7]||(l[7]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:l[0]||(l[0]=C(v=>r("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:C(R,["prevent"]),class:"z-0"},[s.value!=="loading"?(n(),a(U,{key:0},[e("div",re,[e("label",ae,[l[8]||(l[8]=q("Title ")),$(A)]),j(e("input",{"onUpdate:modelValue":l[1]||(l[1]=v=>b.value.title=v),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[M,b.value.title]])]),e("div",de,[l[10]||(l[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),j(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":l[2]||(l[2]=v=>b.value.priority=v)},l[9]||(l[9]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[te,b.value.priority]])]),e("div",ue,[l[11]||(l[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),j(e("input",{type:"date","onUpdate:modelValue":l[3]||(l[3]=v=>b.value.better_to_complete_on=v),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[M,b.value.better_to_complete_on]])]),e("div",me,[l[12]||(l[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),j(e("textarea",{rows:"10","onUpdate:modelValue":l[4]||(l[4]=v=>b.value.description=v),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[M,b.value.description]])])],64)):d("",!0),e("div",pe,[m.value?(n(),a("div",be,f(m.value),1)):d("",!0),m.value?(n(),a("hr",ve)):d("",!0),e("div",ce,[e("button",{disabled:s.value=="loading"||s.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},f(s.value=="submitting"?"Saving...":"Add Detail"),9,fe),e("button",{type:"button",onClick:l[5]||(l[5]=C(v=>r("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])])],32),s.value==="loading"||s.value==="submitting"?(n(),N(E,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):d("",!0)]))}},ge={class:"border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},ye={class:"text-lg font-semibold mb-2"},ke={class:"line-clamp-5 mb-5"},_e={class:"text-justify"},we={class:"flex items-end"},$e={class:"text-blue-400 font-semibold"},qe={class:"ml-auto flex gap-6 items-center"},Ce={__name:"RequirementDetailCard",props:{detail:{type:Object},serial:{type:Number}},emits:["editClick","deleteClick"],setup(u,{emit:D}){const p=D;return(r,s)=>(n(),a("div",ge,[e("div",null,[e("div",ye,[e("span",null,f(u.serial)+". "+f(u.detail.title),1)]),s[3]||(s[3]=e("hr",{class:"mb-4 -mx-4"},null,-1)),e("div",ke,[s[2]||(s[2]=e("div",{class:"text-gray-500 mr-2 text-xs uppercase font-semibold"},"Description",-1)),e("p",_e,f(u.detail.description),1)])]),e("div",we,[e("div",null,[e("div",null,[s[4]||(s[4]=e("span",{class:"text-gray-500 mr-2 text-xs uppercase font-semibold"},"Priority:",-1)),e("span",$e,f(u.detail.priority),1)]),e("div",null,[s[5]||(s[5]=e("span",{class:"text-gray-500 mr-2 text-xs uppercase font-semibold"},"Better To Complete:",-1)),e("span",null,f(u.detail.better_to_complete_on),1)])]),e("div",qe,[e("button",{class:"btn-2",onClick:s[0]||(s[0]=C(m=>p("editClick",u.detail),["prevent"]))},s[6]||(s[6]=[e("i",{class:"fas fa-edit"},null,-1),q("Edit ")])),e("button",{class:"btn-2-red",onClick:s[1]||(s[1]=C(m=>p("deleteClick",u.detail),["prevent"]))},s[7]||(s[7]=[e("i",{class:"fas fa-trash-alt"},null,-1),q("Delete ")]))])])]))}},De={class:"max-h-[90vh] overflow-auto max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Re={class:"sticky top-0 pt-4 bg-white z-10"},Ve={key:0,class:"text-center mt-2 mb-6"},Se={class:"text-sky-600"},Te={key:1,class:"text-center mt-2 mb-6"},he={class:"text-sky-600"},Ne={class:"mb-4"},Fe={class:"block text-gray-600 text-sm mb1 font-medium"},Ie={class:"block text-gray-600 text-sm mb-1 font-medium"},Ue={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Ae={key:0,class:"mb-4 text-red-500 font-medium"},je={key:1,class:"mb-4"},ze={class:"flex items-center justify-between gap-4"},Ee=["disabled"],Me={__name:"RequirementDetailDeleteForm",props:{parentTaskId:{type:[Number,String],required:!0},requirementId:{type:[Number,String]}},emits:["taskCreated","closeClick","error"],setup(u,{emit:D}){const p=D,r=Y(),s=Q(),m=K(),b=X(),{requirement:R}=P(b),_=k(),l=k([]),v=G(()=>l.value.map(c=>c.id)),o=k(""),i=k([]),g=k({from_department_id:"",to_department_id:"",website_tags:[]});H(v,c=>{g.value.user_ids=c}),W(async()=>{o.value="loading",s.fetchTags("website"),await m.fetchCompanies({with:"departments",ignore_permission:!0}),o.value=""});async function I(){o.value="submitting";const c={...g.value,website_tags:[i.value.id]};console.log({payload:c});try{const t=await J(c);p("create",t),o.value="create"}catch{p("error",r.error),o.value="error"}}return(c,t)=>{var V,S,T,h,w;return n(),a("div",De,[e("div",Re,[t[5]||(t[5]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Requirement",-1)),t[6]||(t[6]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=C(x=>p("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:C(I,["prevent"]),class:"z-0"},[u.requirementId&&((V=y(R))!=null&&V.title)?(n(),a("p",Ve,[t[7]||(t[7]=q(" Task under requirement ")),e("span",Se,f(y(R).title),1)])):d("",!0),u.parentTaskId&&((S=_.value)!=null&&S.title)?(n(),a("p",Te,[t[8]||(t[8]=q(" Sub task under ")),e("span",he,f(_.value.title),1)])):d("",!0),e("div",Ne,[t[9]||(t[9]=e("label",{class:"text-gray-800"},"Websites",-1)),$(Z,{options:y(s).tags,modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=x=>i.value=x),label:"name","track-by":"id"},null,8,["options","modelValue"])]),o.value!=="loading"&&!(u.parentTaskId&&((T=_.value)!=null&&T.title))?(n(),a(U,{key:2},[$(z,{modelValue:g.value.from_department_id,"onUpdate:modelValue":t[2]||(t[2]=x=>g.value.from_department_id=x),companies:((h=y(m))==null?void 0:h.companies)||[],class:"mb-4"},{label:F(()=>[e("label",Fe,[t[10]||(t[10]=q(" From Department ")),$(A)])]),_:1},8,["modelValue","companies"]),$(z,{modelValue:g.value.to_department_id,"onUpdate:modelValue":t[3]||(t[3]=x=>g.value.to_department_id=x),companies:((w=y(m))==null?void 0:w.companies)||[],class:"mb-4"},{label:F(()=>[e("label",Ie,[t[11]||(t[11]=q(" To Department ")),$(A)])]),_:1},8,["modelValue","companies"])],64)):d("",!0),e("div",Ue,[y(r).error?(n(),a("div",Ae,f(y(r).error),1)):d("",!0),y(r).error?(n(),a("hr",je)):d("",!0),e("div",ze,[e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},f(o.value=="submitting"?"Saving...":"Next"),9,Ee),e("button",{type:"button",onClick:t[4]||(t[4]=C(x=>p("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])])],32),o.value==="loading"||o.value==="submitting"?(n(),N(E,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):d("",!0)])}}},Be={class:"max-h-[90vh] overflow-auto max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Oe={class:"sticky top-0 pt-4 bg-white z-10"},We={key:0,class:"text-center mt-2 mb-6"},Le={class:"text-sky-600"},Pe={key:1,class:"text-center mt-2 mb-6"},Ge={class:"text-sky-600"},He={class:"mb-4"},Je={class:"block text-gray-600 text-sm mb1 font-medium"},Ke={class:"block text-gray-600 text-sm mb-1 font-medium"},Qe={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Xe={key:0,class:"mb-4 text-red-500 font-medium"},Ye={key:1,class:"mb-4"},Ze={class:"flex items-center justify-between gap-4"},et=["disabled"],tt={__name:"RequirementDetailEditForm",props:{parentTaskId:{type:[Number,String],required:!0},requirementId:{type:[Number,String]}},emits:["taskCreated","closeClick","error"],setup(u,{emit:D}){const p=D,r=Y(),s=Q(),m=K(),b=X(),{requirement:R}=P(b),_=k(),l=k([]),v=G(()=>l.value.map(c=>c.id)),o=k(""),i=k([]),g=k({from_department_id:"",to_department_id:"",website_tags:[]});H(v,c=>{g.value.user_ids=c}),W(async()=>{o.value="loading",s.fetchTags("website"),await m.fetchCompanies({with:"departments",ignore_permission:!0}),o.value=""});async function I(){o.value="submitting";const c={...g.value,website_tags:[i.value.id]};console.log({payload:c});try{const t=await J(c);p("create",t),o.value="create"}catch{p("error",r.error),o.value="error"}}return(c,t)=>{var V,S,T,h,w;return n(),a("div",Be,[e("div",Oe,[t[5]||(t[5]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Requirement",-1)),t[6]||(t[6]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=C(x=>p("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:C(I,["prevent"]),class:"z-0"},[u.requirementId&&((V=y(R))!=null&&V.title)?(n(),a("p",We,[t[7]||(t[7]=q(" Task under requirement ")),e("span",Le,f(y(R).title),1)])):d("",!0),u.parentTaskId&&((S=_.value)!=null&&S.title)?(n(),a("p",Pe,[t[8]||(t[8]=q(" Sub task under ")),e("span",Ge,f(_.value.title),1)])):d("",!0),e("div",He,[t[9]||(t[9]=e("label",{class:"text-gray-800"},"Websites",-1)),$(Z,{options:y(s).tags,modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=x=>i.value=x),label:"name","track-by":"id"},null,8,["options","modelValue"])]),o.value!=="loading"&&!(u.parentTaskId&&((T=_.value)!=null&&T.title))?(n(),a(U,{key:2},[$(z,{modelValue:g.value.from_department_id,"onUpdate:modelValue":t[2]||(t[2]=x=>g.value.from_department_id=x),companies:((h=y(m))==null?void 0:h.companies)||[],class:"mb-4"},{label:F(()=>[e("label",Je,[t[10]||(t[10]=q(" From Department ")),$(A)])]),_:1},8,["modelValue","companies"]),$(z,{modelValue:g.value.to_department_id,"onUpdate:modelValue":t[3]||(t[3]=x=>g.value.to_department_id=x),companies:((w=y(m))==null?void 0:w.companies)||[],class:"mb-4"},{label:F(()=>[e("label",Ke,[t[11]||(t[11]=q(" To Department ")),$(A)])]),_:1},8,["modelValue","companies"])],64)):d("",!0),e("div",Qe,[y(r).error?(n(),a("div",Xe,f(y(r).error),1)):d("",!0),y(r).error?(n(),a("hr",Ye)):d("",!0),e("div",Ze,[e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},f(o.value=="submitting"?"Saving...":"Next"),9,et),e("button",{type:"button",onClick:t[4]||(t[4]=C(x=>p("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])])],32),o.value==="loading"||o.value==="submitting"?(n(),N(E,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):d("",!0)])}}},st={class:"container mx-auto p-6"},lt={class:"bg-white rounded shadow p-4 relative"},ot={class:"mb-4"},it={class:"mb-4"},nt={class:"mb-4"},rt={class:"flex items-center mb-6"},at={class:"ml-auto"},dt={key:0},ut={key:1,class:"border min-h-28 rounded-md flex items-center justify-center"},$t={__name:"RequirementShow",setup(u){const D=se(),p=k(""),r=k(null),s=B({open:!1}),m=B({detail:null,open:!1}),b=B({detail:null,open:!1});W(async()=>{await R()});async function R(){var o;p.value="loading",r.value=(o=(await le(D.params.id)).data)==null?void 0:o.requirement,p.value=""}function _(){s.open=!0}function l(o){m.open=!0,m.detail=o}function v(o){b.open=!0,b.detail=o}return(o,i)=>{var g,I,c,t,V,S,T,h;return n(),a("div",st,[s.open?(n(),N(O,{key:0,class:"*:max-w-4xl"},{default:F(()=>[$(xe,{"requirement-id":r.value.id,onCloseClick:i[0]||(i[0]=w=>s.open=!1),onCreate:i[1]||(i[1]=async()=>{s.open=!1,await R()})},null,8,["requirement-id"])]),_:1})):d("",!0),m.open?(n(),N(O,{key:1},{default:F(()=>[$(tt,{onCloseClick:i[2]||(i[2]=w=>m.open=!1)})]),_:1})):d("",!0),b.open?(n(),N(O,{key:2},{default:F(()=>[$(Me,{onCloseClick:i[3]||(i[3]=w=>b.open=!1)})]),_:1})):d("",!0),e("div",lt,[i[10]||(i[10]=e("div",{class:"text-center text-xl font-bold mb-2"},"Requirement Form",-1)),i[11]||(i[11]=e("hr",{class:"mb-4"},null,-1)),e("div",ot,[i[4]||(i[4]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",null,[(n(!0),a(U,null,L(((g=r.value)==null?void 0:g.website_tags)||[],w=>(n(),a("div",{key:w.id},f(w.name),1))),128))])]),e("div",it,[i[5]||(i[5]=e("div",{class:"text-gray-500 text-sm"},"From Department",-1)),e("div",null,f((c=(I=r.value)==null?void 0:I.from_department)==null?void 0:c.name),1)]),e("div",nt,[i[6]||(i[6]=e("div",{class:"text-gray-500 text-sm"},"To Department",-1)),e("div",null,f((V=(t=r.value)==null?void 0:t.to_department)==null?void 0:V.name),1)]),i[12]||(i[12]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",rt,[i[8]||(i[8]=e("h2",{class:"text-xl font-semibold"},"Requirement Details",-1)),e("div",at,[(((S=r.value)==null?void 0:S.details)||[]).length>0?(n(),a("button",{key:0,class:"btn-4 font-semibold",onClick:C(_,["prevent"])},i[7]||(i[7]=[e("i",{class:"fad fa-plus-circle text-2xl"},null,-1),q("Add More Details ")]))):d("",!0)])]),(((T=r.value)==null?void 0:T.details)||[]).length>0?(n(),a("div",dt,[(n(!0),a(U,null,L(((h=r.value)==null?void 0:h.details)||[],(w,x)=>(n(),N(Ce,{key:w.id,detail:w,serial:x+1,onEditClick:l,onDeleteClick:v},null,8,["detail","serial"]))),128))])):(n(),a("div",ut,[e("button",{class:"btn-4 font-semibold",onClick:C(_,["prevent"])},i[9]||(i[9]=[e("i",{class:"fad fa-plus-circle text-2xl"},null,-1),q("Add Requirement Details ")]))]))]),p.value==="loading"?(n(),N(E,{key:0,class:"absolute inset-0 bg-opacity-90"})):d("",!0)])])}}};export{$t as default};
