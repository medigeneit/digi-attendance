import{L as ie}from"./LoaderView-BWH3yK-J.js";import{O as N}from"./OverlyModal-BBzYGEI9.js";import{_ as X}from"./DepartmentChip-BFSmOiUI.js";import{_ as ne}from"./TaskAddForm-D_0kains.js";import{_ as le}from"./TaskEditForm-AZUwU1gV.js";import{_ as de}from"./TaskHeader-BbSCUvfY.js";import{_ as ue}from"./TaskUserAssignForm-OOYPHUrd.js";import{b as te,m as V,n as me,c as i,o as r,g as d,a as e,F as I,y as S,x as F,f as w,t as _,i as j,j as U,k as p,p as g,w as Y,u as ce,r as B,d as pe,z as Z,e as ye,A as G,I as fe}from"./index-B3Hd-J4V.js";import{u as _e}from"./task-priority-CqnwP9Xm.js";import{u as ge}from"./useRequirementStore-2yvwRGcE.js";import{u as ke}from"./useTaskStore-qSEPCDoi.js";import{_ as xe,T as ve,a as be,b as he}from"./TaskUrgentBadge-BN_WSZ9R.js";import{_ as we,a as Te}from"./TaskAssignedUsers-DEVFCooI.js";import{T as Ce}from"./TaskIsClosedBadge-C4tWnD54.js";import{d as $e,b as Le}from"./datetime-Efw590t9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-CMhhVb4r.js";import"./company-DLU6Z8dF.js";import"./requirement-B9Ew3LAf.js";import"./CompanyDepartmentSelectInput-B8pddDX2.js";import"./SelectDropdown-BT8FDQlc.js";import"./SectionLoading-BxOBXMRr.js";import"./TextWithHr-D49j8H2r.js";import"./TaskUrgencyInput-BREJp-2H.js";import"./tags-C3X1U-c3.js";import"./MultiselectDropdown-B8PSGjFy.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-CvFWOcEu.js";import"./task-D8tLwgfr.js";import"./url-CePbr-gY.js";import"./EmployeeDropdownInput-DwPwf6Y4.js";import"./UserChip-e5GXvWMS.js";import"./SearchInput-DTPkrRZd.js";import"./user-DhgZrbk9.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-DwNCvCWS.js";import"./TaskUserChip-BvwVIgwp.js";import"./TaskTitle-BmbdCfce.js";const qe={class:"w-full p-1"},Ie={key:0,class:"w-full rounded-b"},Ae={class:"group/dept"},Re={class:"flex gap-1 items-start text-base"},Me={class:"font-bold text-lime-600"},Be={key:0},Se={class:"ml-auto"},De=["onClick"],ze={class:"border text-center py-2 px-1 border-gray-200"},Ee={key:0,class:"font-semibold text-purple-400 text-sm"},Oe={class:"border px-3 py-1 border-gray-200 relative"},Pe={class:"flex items-center justify-between gap-2"},Ue={class:"flex items-center gap-3 mb-0.5"},Ve={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Fe={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},je={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ne={class:"text-xs flex items-center gap-1 text-sky-400 ml-4"},He={class:"text-xs flex items-center gap-1 text-sky-400 ml-3"},Ke=["href","onClick"],Je={class:"border px-3 py-1 border-gray-200"},Qe={class:"flex gap-2 justify-between items-center relative w-full"},We={key:0,class:"shrink-0"},Xe=["href","onClick"],Ye={class:"border px-3 py-1 border-gray-200 text-center"},Ze={key:0,class:"ml-4 text-gray-500 text-sm"},Ge={class:"text-blue-500 font-semibold whitespace-nowrap"},et={class:"border px-3 border-gray-200 sticky right-0 border-l bg-gray-50"},tt={class:"flex justify-end flex-wrap gap-2 py-2"},ee={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick","clickAddClick"],setup(L,{emit:k}){const D=L,u=te(),A=V(()=>D.tasks.reduce((x,o)=>{var b;const q=((b=o.requirement)==null?void 0:b.id)||"-",c=[...x],a=c.find(T=>(T==null?void 0:T.key)==q);return a?a.tasks=[...a.tasks,o]:c.push({key:q,position:o!=null&&o.requirement?0:1,...(o==null?void 0:o.requirement)||{title:"(Other tasks)",id:0},tasks:[o]}),c},[]).sort((x,o)=>x.position-o.position)),f=k;return(x,o)=>{var c;const q=me("RouterLink");return r(),i("div",qe,[((c=L.tasks)==null?void 0:c.length)>0?(r(),i("table",Ie,[o[6]||(o[6]=e("thead",null,[e("tr",null,[e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(r(!0),i(I,null,S(A.value,(a,b)=>{var T;return r(),i(I,{key:a.id},[e("tr",Ae,[e("th",{colspan:"10",class:F(["font-semibold",[(b>0,"")]])},[e("div",{class:F(["text-left -mx-[2px] -mb-[1px] py-2 px-2 flex items-center border border-b-0 rounded-t bg-emerald-50",[a.id===0?"text-gray-500":"text-sky-800",b>0?"mt-4":""]])},[e("div",Re,[e("div",Me,_(b+1)+".",1),a.id===0?(r(),i("p",Be,_(a.title),1)):(r(),w(q,{key:1,to:`requirements/show/${a.id}`,class:"line-clamp-2 hover:underline"},{default:j(()=>[U(_(a.title),1)]),_:2},1032,["to"]))]),e("div",Se,[((T=p(u))==null?void 0:T.name)=="RequirementTaskList"?(r(),i("button",{key:0,onClick:t=>f("clickAddTask",{requirement_id:a==null?void 0:a.id,from_department_id:a==null?void 0:a.from_department_id,to_department_id:a==null?void 0:a.to_department_id},{requirement_id:!0,from_department_id:!0,to_department_id:!0}),class:"btn-2 whitespace-nowrap h-6 px-3 opacity-20 group-hover/dept:opacity-100"},o[0]||(o[0]=[e("i",{class:"fas fa-plus-circle"},null,-1),U(" Add Task ")]),8,De)):d("",!0)])],2)],2)]),(r(!0),i(I,null,S(a.tasks,(t,R)=>{var z,M;return r(),i("tr",{key:t.id,class:F(["group/sub-task-row",{" bg-green-400/20":t.status=="COMPLETED"," bg-white hover:bg-slate-50":t.status!=="COMPLETED"}])},[e("td",ze,[R!==void 0?(r(),i("div",Ee,_(b+1)+"."+_(R+1),1)):d("",!0)]),e("td",Oe,[e("div",Pe,[e("div",null,[e("div",Ue,[g(xe,{titleClass:"text-sm",task:t,"sub-tasks-open":!1,isMyTask:p(u).name=="RequirementList",to:L.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",Ve,[e("div",Fe,[o[1]||(o[1]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,_(p($e)(t.created_at)),1)]),e("div",je,[t!=null&&t.is_important?(r(),w(ve,{key:0})):d("",!0),t!=null&&t.is_urgent?(r(),w(be,{key:1})):d("",!0)]),e("div",Ne,[o[2]||(o[2]=e("i",{class:"fas fa-tasks"},null,-1)),U(" "+_(t==null?void 0:t.todos_count),1)]),e("div",He,[o[3]||(o[3]=e("i",{class:"fas fa-book"},null,-1)),U(" "+_((z=t==null?void 0:t.requirement)==null?void 0:z.id),1)])])]),!t.closed_at&&!L.hideButtons?(r(),i("a",{key:0,href:`/tasks/edit/${t.id}`,onClick:Y(v=>f("editClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},o[4]||(o[4]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Ke)):d("",!0)])]),e("td",Je,[e("div",Qe,[g(we,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:t.users||[],isTargetTask:t.is_target,maxItem:1,"route-to":v=>`/requirement-tasks?status=not-completed&view=userwise&user-ids=${v.id}`},null,8,["users","isTargetTask","route-to"]),t.closed_at?d("",!0):(r(),i("div",We,[L.hideButtons?d("",!0):(r(),i("a",{key:0,href:`/tasks/${t.id}/assign-users`,onClick:Y(v=>f("employeeAssignClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},o[5]||(o[5]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,Xe))]))])]),e("td",Ye,[t.deadline?(r(),i("span",Ze,[e("span",Ge,_(p(Le)(t.deadline)),1)])):d("",!0)]),e("td",et,[e("div",tt,[t.closed_at?(r(),w(Ce,{key:0})):d("",!0),g(Te,{status:t==null?void 0:t.status,progressPercent:(t==null?void 0:t.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((M=t==null?void 0:t.children_tasks)==null?void 0:M.length)>0?(r(),w(he,{key:1,ref_for:!0,ref:"progress",task:t,class:"text-sm w-full"},null,8,["task"])):d("",!0)])])],2)}),128))],64)}),128))])])):d("",!0)])}}},st={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},rt={class:"mb-4"},ot={key:4,class:"text-center py-4 text-red-500"},at={class:"relative min-h-[20vh]"},it={key:0,class:"space-y-6"},nt={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},lt={class:"font-semibold flex items-center gap-2"},dt={class:"text-white text-base"},ut={class:"rounded-b-md overflow-y-auto"},mt={key:1,class:"space-y-6"},ct={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},pt={class:"font-semibold flex items-center gap-2"},yt={class:"ml-auto"},ft=["onClick"],_t={class:"rounded-b-md overflow-y-auto"},gt={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},es={__name:"RequirementTaskList",setup(L){const k=ke(),D=ge(),u=te(),A=ce(),f=B(""),x=B(null),o=B(!1),q=pe(),c=Z({parentId:0,requirementId:0,params:{}}),a=Z({taskId:0,isOpen:!1}),b=V(()=>{const n=u.query["user-ids"]||null,s=(k.tasks||[]).flatMap(y=>{var h;return n?(h=y.users)==null?void 0:h.filter(O=>n.includes(O.id)):y.users});return[...new Map(s.map(y=>[y.id,y])).values()].sort((y,h)=>y.id-h.id)}),T=V(()=>(k.tasks||[]).reduce((n,s)=>{const C=`${s.from_department_id}-${s.to_department_id}`,y=n.find(h=>h.key==C);return y?y.tasks=[...y.tasks,s]:n.push({key:C,from_department:s.from_department,to_department:s.to_department,tasks:[s]}),n},[])),t=B(null),R=B([]),{saveTaskPriority:z,listHasRearranged:M}=_e(()=>k.taskListTree,0);ye(()=>{console.log("Task List Mounted"),f.value="loading",v()});async function v(){console.log({name:u.name}),u.name=="RequirementTaskList"&&await k.fetchAllTasks({...u.query,page:1}),u.name=="MyRequirementTaskList"&&await k.fetchAllMyTasks({...u.query,page:1}),f.value="",R.value=[]}const E=(n,s)=>{o.value=!0,c.params=n,c.readonlyValues=s},H=n=>{a.taskId=n,a.isOpen=!0};async function K(){x.value=null,o.value=!1,f.value="loading",c.params={},await v()}async function se(){o.value=!1,c.params={},await v()}async function re(){f.value="loading",await z()&&await v()}function oe(n){return k.tasks.filter(s=>(s.users||[]).some(C=>C.id===n))}G(()=>({...u.query}),async()=>{try{k.resetTaskList(),f.value="loading",await v()}catch(n){console.warn(n)}}),G(()=>q.isAdminMood,n=>{n?A.push({name:"RequirementTaskList",query:u.query}):A.push({name:"MyRequirementTaskList",query:u.query})});const J=V({get(){return{...u.query}},set(n){localStorage.removeItem("sub_task_opened_list"),A.push({query:{...n}})}});function ae(n){return{name:"RequirementTaskShow",params:{id:(n==null?void 0:n.id)||0}}}return(n,s)=>{var C,y,h,O,Q;return r(),i("div",st,[x.value?(r(),w(N,{key:0},{default:j(()=>[g(le,{taskId:x.value,onClose:s[0]||(s[0]=l=>x.value=null),onUpdated:K},null,8,["taskId"])]),_:1})):d("",!0),o.value?(r(),w(N,{key:1},{default:j(()=>{var l,m;return[g(ne,{parentTaskId:c.parentId,requirementId:(l=c.params)==null?void 0:l.requirement_id,requirementDetailId:(m=c.params)==null?void 0:m.requirement_detail_id,"default-values":c.params,"readonly-fields":c.readonlyValues,onClose:se,onTaskCreated:K},null,8,["parentTaskId","requirementId","requirementDetailId","default-values","readonly-fields"])]}),_:1})):d("",!0),a.isOpen?(r(),w(N,{key:2,class:"*:max-w-4xl"},{default:j(()=>[g(ue,{taskId:a.taskId,onCancelClick:s[1]||(s[1]=()=>{a.isOpen=!1,a.taskId=0}),onSuccess:s[2]||(s[2]=()=>{a.isOpen=!1,a.taskId=0,f.value="loading",v()})},null,8,["taskId"])]),_:1})):d("",!0),g(de,{modelValue:J.value,"onUpdate:modelValue":s[3]||(s[3]=l=>J.value=l),onClickAddTask:E,onClickPrioritySave:re,onClickPriorityDiscard:s[4]||(s[4]=()=>p(M)?t.value.resetItems:null),"list-has-rearranged":p(M),isMyTask:p(u).name==="MyRequirementTaskList",class:"mb-4"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((y=(C=p(u))==null?void 0:C.query)==null?void 0:y["query-log"])=="true"?(r(!0),i(I,{key:3},S(R.value,(l,m)=>(r(),i("div",{key:m,class:"text-xs text-gray-500"},[e("div",rt,_(l.raw_query),1)]))),128)):d("",!0),p(D).error?(r(),i("div",ot,_(p(D).error),1)):d("",!0),e("div",at,[((h=p(u).query)==null?void 0:h.view)==="userwise"?(r(),i("div",it,[(r(!0),i(I,null,S(b.value,l=>(r(),i("div",{key:l.id,class:"rounded-md border-2 border-sky-300"},[e("div",nt,[e("div",lt,[g(fe,{user:l},null,8,["user"]),e("div",dt,_(l.label),1)])]),e("div",ut,[g(ee,{tasks:oe(l.id),onEditClick:s[5]||(s[5]=m=>x.value=m),onAddClick:s[6]||(s[6]=m=>E(m)),onEmployeeAssignClick:s[7]||(s[7]=m=>H(m)),taskLinkTo:m=>({name:"RequirementTaskShow",params:{id:(m==null?void 0:m.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128))])):(r(),i("div",mt,[(r(!0),i(I,null,S(T.value,l=>{var m,W;return r(),i("div",{key:l.key,class:"rounded-md border-2 border-sky-300"},[e("div",ct,[e("div",pt,[s[11]||(s[11]=e("span",{class:"text-white text-sm"},"From",-1)),g(X,{department:l.from_department},null,8,["department"]),s[12]||(s[12]=e("span",{class:"text-white text-sm"},"To",-1)),g(X,{department:l.to_department},null,8,["department"])]),e("div",yt,[((m=p(u))==null?void 0:m.name)=="RequirementTaskList"?(r(),i("button",{key:0,onClick:()=>{var $,P;return E({from_department_id:($=l==null?void 0:l.from_department)==null?void 0:$.id,to_department_id:(P=l==null?void 0:l.to_department)==null?void 0:P.id},{from_department_id:!0,to_department_id:!0})},class:"btn-3 h-6 whitespace-nowrap bg-white border-white px-2"}," Add Task ",8,ft)):d("",!0)])]),e("div",_t,[g(ee,{tasks:l.tasks,groupBy:"requirement",onEditClick:s[8]||(s[8]=$=>x.value=$),onClickAddTask:s[9]||(s[9]=($,P)=>E($,P)),onEmployeeAssignClick:s[10]||(s[10]=$=>H($)),hideButtons:((W=p(u))==null?void 0:W.name)!=="RequirementTaskList",taskLinkTo:ae},null,8,["tasks","hideButtons"])])])}),128))])),f.value!=="loading"&&((O=p(k).tasks)==null?void 0:O.length)===0?(r(),i("div",gt," No tasks ")):d("",!0),f.value==="loading"?(r(),w(ie,{key:3,class:F(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((Q=p(k).tasks)==null?void 0:Q.length)===0?"justify-center":""]])},null,8,["class"])):d("",!0)])])}}};export{es as default};
