import{E as oe,r as h,x as I,G,d as F,c as i,g as E,k as y,o as a,a as t,F as $,y as z,q as L,j as B,t as T,A as R,e as O,n as C,h as J,v as W,H as K,u as X,w as Z,f as V,l as re,I as le,J as q,m as ie,i as ee,b as de}from"./index-Lmun8hku.js";import{u as ue}from"./company-BZP1mQsk.js";import{u as ce}from"./department-DEIhVnl_.js";import{u as ve}from"./user-pkkXRakB.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N=oe("chat",()=>{const o=h(!1),e=h(null),r=h(!1),s=h(!1),n=h(!1),d=h([]),m=h({}),p=h(null),v=h([]),b=h(""),f=I(()=>{var _,w;return((_=d.value)==null?void 0:_.length)===0?{}:(w=d.value)==null?void 0:w.find(c=>parseInt(c.id)===parseInt(p.value))}),x=I(()=>{const _=d.value||[];if(_.length===0)return[];const w=(b.value||"").toLowerCase().trim(),c=w?_.filter(l=>((l==null?void 0:l.title)||"").toLowerCase().includes(w)):_.slice();return c.sort((l,u)=>{const k=Number.isFinite(+(l==null?void 0:l.sort_by))?+l.sort_by:Number.NEGATIVE_INFINITY,A=Number.isFinite(+(u==null?void 0:u.sort_by))?+u.sort_by:Number.NEGATIVE_INFINITY;return k===A?((l==null?void 0:l.title)||"").localeCompare((u==null?void 0:u.title)||""):A-k}),c});return{loading:o,error:e,openAddModal:r,openAddMemberModal:s,showMobileConversationList:n,searchText:b,conversations:d,filteredConversations:x,conversation:m,activeConversationId:p,activeConversation:f,messages:v,fetchUserConversations:async(_={})=>{var w,c;o.value=!0,e.value=null;try{const l=await G.get("/chat/conversations",{params:_});d.value=l.data}catch(l){e.value=((c=(w=l.response)==null?void 0:w.data)==null?void 0:c.message)||"ডাটা লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching conversations:",l)}finally{o.value=!1}},addConversationMembers:async(_,w={})=>{var c,l,u,k,A,H;if(_){o.value=!0,e.value=null;try{const S=await G.post(`/chat/conversations/${_}/add-members`,w);return(c=S==null?void 0:S.data)!=null&&c.message&&((u=v.value)==null||u.push((l=S.data)==null?void 0:l.message)),(k=S==null?void 0:S.data)!=null&&k.conversation&&(d.value=d.value.map(j=>parseInt(j.id)===parseInt(_)?S.data.conversation:j)),S.data}catch(S){e.value=((H=(A=S.response)==null?void 0:A.data)==null?void 0:H.message)||"ডাটা Create করতে ব্যর্থ হয়েছে।",console.error("Error creating conversation:",S)}finally{o.value=!1}}},createConversation:async(_={})=>{var w,c;o.value=!0,e.value=null;try{const l=await G.post("/chat/conversations",_);return p.value=l.data.id,l.data.id}catch(l){e.value=((c=(w=l.response)==null?void 0:w.data)==null?void 0:c.message)||"ডাটা Create করতে ব্যর্থ হয়েছে।",console.error("Error creating conversation:",l)}finally{o.value=!1}},fetchConversationById:async _=>{var w,c;o.value=!0,e.value=null,m.value={};try{const l=await G.get(`/chat/conversations/${_}`);m.value=l.data}catch(l){e.value=((c=(w=l.response)==null?void 0:w.data)==null?void 0:c.message)||"ডাটা লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching conversation:",l)}finally{o.value=!1}},fetchConversationMessages:async(_,w={})=>{var c,l;o.value=!0,e.value=null,v.value=[];try{const u=await G.get(`/chat/conversations/${_}/messages`,{params:w});v.value=u.data}catch(u){e.value=((l=(c=u.response)==null?void 0:c.data)==null?void 0:l.message)||"ডাটা লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching messages:",u)}finally{o.value=!1}},createConversationMessage:async(_,w={})=>{var c,l,u,k,A,H,S;if(_){o.value=!0,e.value=null;try{const j=await G.post(`/chat/conversations/${_}/messages`,w);return(c=j==null?void 0:j.data)!=null&&c.message&&((u=v.value)==null||u.push((l=j.data)==null?void 0:l.message)),(k=j==null?void 0:j.data)!=null&&k.conversation&&(d.value=d.value.map(Q=>parseInt(Q.id)===parseInt(_)?j.data.conversation:Q)),(A=j.data)==null?void 0:A.message}catch(j){e.value=((S=(H=j.response)==null?void 0:H.data)==null?void 0:S.message)||"ডাটা Create করতে ব্যর্থ হয়েছে।",console.error("Error creating conversation:",j)}finally{o.value=!1}}}}}),te={__name:"AddNewButton",setup(o){const e=N(),r=F(),s=()=>{e.openAddModal=!0};return(n,d)=>{var m;return["admin","super_admin","developer"].includes((m=y(r).user)==null?void 0:m.role)?(a(),i("div",{key:0,onClick:s,title:"Add New Conversation",class:"size-10 shrink-0 grow-0 flex justify-center items-center"},d[0]||(d[0]=[t("i",{class:"fas fa-comment-alt-plus text-3xl cursor-pointer text-[#24A1DE]"},null,-1)]))):E("",!0)}}},pe={class:"flex justify-center items-center gap-3"},fe=["onClick"],ye={__name:"ConversationTypeSelector",props:{modelValue:{type:String,default:""},onSelect:{tyep:Function,default:()=>{}}},emits:["update:modelValue"],setup(o,{emit:e}){const r=o,s=e,n=I(()=>[{label:"Direct",value:"direct",iconClass:"fas fa-handshake"},{label:"Group",value:"group",iconClass:"fas fa-users"}]);function d(m){s("update:modelValue",m.value),r.onSelect()}return(m,p)=>(a(),i("div",pe,[(a(!0),i($,null,z(n.value,v=>(a(),i("button",{key:v.value,class:L(["cursor-pointer px-6 py-1 border rounded-lg transition font-bold",o.modelValue===v.value?"bg-sky-600 text-white border-sky-600":"hover:bg-gray-50"]),onClick:b=>d(v)},[t("i",{class:L(v.iconClass)},null,2),B(" "+T(v.label),1)],10,fe))),128))]))}},ge={class:"flex flex-col md:flex-row justify-center md:items-center gap-2"},xe=["value"],he={__name:"GroupTitleInput",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(o,{emit:e}){return(r,s)=>(a(),i("div",ge,[s[1]||(s[1]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"}," Group Title ",-1)),t("input",{id:"title",value:o.modelValue,onInput:s[0]||(s[0]=n=>r.$emit("update:modelValue",n.target.value)),type:"text",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},null,40,xe)]))}},be={class:"grid sm:grid-cols-2 gap-4"},_e={class:"flex flex-row justify-center items-center gap-2"},we=["value"],Ce=["value"],ke={class:"flex flex-row justify-center items-center gap-2"},Ie=["value","disabled"],$e=["value"],Me={__name:"CompanyDepartmentFilter",props:{companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""}},emits:["update:companyId","update:departmentId"],setup(o,{emit:e}){return(r,s)=>(a(),i("div",be,[t("div",_e,[s[3]||(s[3]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Company",-1)),t("select",{value:o.companyId,onChange:s[0]||(s[0]=n=>r.$emit("update:companyId",n.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},[s[2]||(s[2]=t("option",{value:""},"-- Company --",-1)),(a(!0),i($,null,z(o.companies,n=>(a(),i("option",{key:n.id,value:n.id},T(n.name),9,Ce))),128))],40,we)]),t("div",ke,[s[5]||(s[5]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Department",-1)),t("select",{value:o.departmentId,disabled:!o.companyId,onChange:s[1]||(s[1]=n=>r.$emit("update:departmentId",n.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60"},[s[4]||(s[4]=t("option",{value:""},"-- Department --",-1)),(a(!0),i($,null,z(o.departments,n=>(a(),i("option",{key:n.id,value:n.id},T(n.name),9,$e))),128))],40,Ie)])]))}},Ue={class:"grid gap-2"},Ae={key:0,class:"flex flex-wrap gap-2"},Se={class:"font-medium"},je=["onClick"],Ee={class:"flex items-center gap-2"},Le=["disabled"],Te={class:"max-h-72 overflow-y-auto rounded-lg rounded-t-none border"},De={key:0,class:"p-4 text-gray-500 text-center"},Ne={key:0,class:"p-4 text-center text-gray-600"},Ve={key:1,class:"divide-y"},He=["for"],ze={class:"w-full grow flex items-center gap-3"},Be=["title"],Ge={class:"leading-tight"},Oe={class:"font-medium text-sm md:text-base"},Re={class:"text-xs text-gray-500"},Fe={class:"w-14 md:w-auto md:shrink-0 inline-flex justify-center items-center text-right"},qe={key:0,class:"text-gray-500 text-xs text-center"},Pe=["id","type","name","checked","onChange"],se={__name:"UserPicker",props:{mode:{type:String,required:!0},users:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},selectedUserIds:{type:Array,default:()=>[]},alreadyAddedUserIds:{type:Array,default:()=>[]}},emits:["update:companyId","update:departmentId","update:selectedUserIds"],setup(o,{emit:e}){const r=o,s=e,n=ue(),d=ce(),m=ve(),p=F(),v=I({get:()=>r.companyId,set:c=>s("update:companyId",c)}),b=I({get:()=>r.departmentId,set:c=>s("update:departmentId",c)}),f=I({get:()=>r.selectedUserIds,set:c=>s("update:selectedUserIds",c)}),x=I(()=>n.companies||[]),M=I(()=>d.departments||[]),D=I(()=>m.users||[]),g=I(()=>{var c;return(c=r.users)!=null&&c.length?r.users:D.value}),U=h(""),P=I(()=>{if(!U.value.trim())return g.value;const c=U.value.trim().toLowerCase();return g.value.filter(l=>{const u=(l.name||"").toLowerCase(),k=String(l.employee_id||"").toLowerCase(),A=String(l.phone||"").toLowerCase(),H=String(l.email||"").toLowerCase();return u.includes(c)||k.includes(c)||A.includes(c)||H.includes(c)})}),Y=I(()=>!v.value);function _(c){let l=[...f.value];const u=l.indexOf(c.id);r.mode==="direct"?l=u>=0?[]:[c.id]:u>=0?l.splice(u,1):l.push(c.id),f.value=l}function w(c){var u;const l=(u=g.value)==null?void 0:u.find(k=>parseInt(k.id)==parseInt(c));return l?l.name||l.employee_id||l.id:""}return R(()=>v.value,async(c,l)=>{c!==l&&(b.value="",f.value=[],c&&await d.fetchDepartments(c),await m.fetchUsers({company_id:c||null,department_id:null}))}),R(()=>b.value,async(c,l)=>{c!==l&&(f.value=[],v.value&&await m.fetchUsers({company_id:v.value,department_id:c||null}))}),O(async()=>{!x.value.length&&n.fetchCompanies&&await n.fetchCompanies(),v.value&&(await d.fetchDepartments(v.value),await m.fetchUsers({company_id:v.value,department_id:b.value||null}))}),(c,l)=>(a(),i($,null,[C(Me,{"company-id":v.value,"onUpdate:companyId":l[0]||(l[0]=u=>v.value=u),"department-id":b.value,"onUpdate:departmentId":l[1]||(l[1]=u=>b.value=u),companies:x.value,departments:M.value},null,8,["company-id","department-id","companies","departments"]),t("div",Ue,[o.mode==="group"&&o.selectedUserIds.length?(a(),i("div",Ae,[(a(!0),i($,null,z(o.selectedUserIds,u=>(a(),i("span",{key:u,class:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm"},[t("span",Se,T(w(u)),1),t("button",{type:"button",class:"text-red-600",onClick:k=>f.value=o.selectedUserIds.filter(A=>A!==u)}," ✕ ",8,je)]))),128))])):E("",!0),t("div",null,[t("div",Ee,[J(t("input",{"onUpdate:modelValue":l[2]||(l[2]=u=>U.value=u),type:"search",disabled:Y.value,class:"flex-1 px-3 py-2 border rounded-lg rounded-b-none focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60",placeholder:"Search by Name / Employee ID / Phone"},null,8,Le),[[W,U.value]])]),t("div",Te,[Y.value?(a(),i("div",De,"Company নির্বাচন করুন।")):(a(),i($,{key:1},[P.value.length?(a(),i("div",Ve,[(a(!0),i($,null,z(P.value,u=>{var k,A;return a(),i($,{key:u.id},[((A=(k=y(p))==null?void 0:k.user)==null?void 0:A.id)!==u.id?(a(),i("label",{key:0,for:`userId${u.id}`,class:"flex items-center justify-between gap-3 p-3 hover:bg-gray-50"},[t("div",ze,[t("div",{class:"border rounded-full",title:u.name},[C(K,{user:u,size:"medium"},null,8,["user"])],8,Be),t("div",Ge,[t("div",Oe,T(u.name||"User #"+(u.employee_id??u.id)),1),t("div",Re,T(u.employee_id||u.phone||u.email||""),1)])]),t("div",Fe,[o.alreadyAddedUserIds.includes(u.id)?(a(),i("span",qe," Already Added ")):(a(),i("input",{key:1,id:`userId${u.id}`,type:o.mode==="direct"?"radio":"checkbox",name:o.mode==="direct"?"direct-user":"group-users",checked:o.selectedUserIds.includes(u.id),onChange:H=>_(u),class:"size-5"},null,40,Pe))])],8,He)):E("",!0)],64)}),128))])):(a(),i("div",Ne," কোন ইউজার পাওয়া যায়নি। "))],64))])])])],64))}},Ye={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},Ke={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[100vh] md:max-h-[90%] overflow-y-auto"},Je={class:"flex flex-col gap-y-2 md:flex-row justify-between items-center"},We={key:0,class:"mt-4"},Qe={key:1,class:"text-red-600 text-sm"},Xe={class:"flex justify-between"},Ze=["disabled"],et={__name:"AddNewConversationModal",setup(o){const e={DIRECT:"direct",GROUP:"group"},r=N(),s=X(),n=h(""),d=h(""),m=h(""),p=h(""),v=h([]),b=h(""),f=()=>{r.openAddModal=!1,x()};function x(){n.value="",d.value="",m.value="",p.value="",v.value=[],b.value=""}async function M(){var g;if(b.value="",!n.value){b.value="দয়া করে Conversation টাইপ নির্বাচন করুন।";return}if(((g=v.value)==null?void 0:g.length)==0){b.value="User নির্বাচন করুন।";return}const D=await r.createConversation({type:n.value,title:n.value=="group"?p.value:"",user_ids:v.value});r.openAddModal=!1,s.push({name:"Conversation Message",params:{conversationId:D}}),r.showMobileConversationList=!1,r.fetchUserConversations()}return(D,g)=>y(r).openAddModal?(a(),i("div",Ye,[t("div",Ke,[t("div",Je,[g[5]||(g[5]=t("h2",{class:"text-xl text-center font-semibold"},"Add New Conversation",-1)),C(ye,{modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=U=>n.value=U),onSelect:()=>v.value=[]},null,8,["modelValue","onSelect"])]),g[9]||(g[9]=t("hr",{class:"mt-4"},null,-1)),n.value?(a(),i("form",{key:1,class:"space-y-3 mt-3",onSubmit:Z(M,["prevent"])},[n.value===e.GROUP?(a(),V(he,{key:0,modelValue:p.value,"onUpdate:modelValue":g[1]||(g[1]=U=>p.value=U)},null,8,["modelValue"])):E("",!0),C(se,{mode:n.value,"company-id":d.value,"onUpdate:companyId":g[2]||(g[2]=U=>d.value=U),"department-id":m.value,"onUpdate:departmentId":g[3]||(g[3]=U=>m.value=U),selectedUserIds:v.value,"onUpdate:selectedUserIds":g[4]||(g[4]=U=>v.value=U)},null,8,["mode","company-id","department-id","selectedUserIds"]),b.value?(a(),i("p",Qe,T(b.value),1)):E("",!0),g[8]||(g[8]=t("hr",null,null,-1)),t("div",Xe,[t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:f}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:n.value===e.DIRECT?v.value.length!==1:!p.value.trim()||v.value.length<2}," Create ",8,Ze)])],32)):(a(),i("div",We,[t("div",{class:"rounded-md border border-dashed p-4 text-center text-gray-600"},[g[6]||(g[6]=t("div",{class:"py-4 text-xl leading-loose"},[B(" Conversation টাইপ (Direct / Group) সিলেক্ট করুন, "),t("br"),B(" তারপর নিচে ফিল্টার দেখাবে। ")],-1)),g[7]||(g[7]=t("p",{class:"pb-1"},"অথবা,",-1)),t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:f}," Cancel ")])]))])])):E("",!0)}},tt={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},st={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90%] overflow-y-auto"},nt={key:0,class:"text-red-600 text-sm"},at={class:"flex justify-between"},ot=["disabled"],rt={__name:"AddNewMemberModal",setup(o){const e=N(),r=F();X();const s=h(""),n=h(""),d=h([]),m=h(""),p=()=>{e.openAddMemberModal=!1,v()};function v(){s.value="",n.value="",d.value=[],m.value=""}async function b(){var f;if(m.value="",((f=d.value)==null?void 0:f.length)==0){m.value="User নির্বাচন করুন।";return}e.activeConversationId&&await e.addConversationMembers(e.activeConversationId,{user_ids:d.value}),e.openAddMemberModal=!1}return O(async()=>{e.activeConversationId&&await e.fetchConversationById(e.activeConversationId)}),(f,x)=>{var M,D;return y(e).openAddMemberModal&&y(e).activeConversationId&&y(e).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((M=y(r).user)==null?void 0:M.role)?(a(),i("div",tt,[t("div",st,[x[4]||(x[4]=re('<div class="flex justify-between items-center"><h2 class="text-xl text-center">Add New Members</h2><button class="bg-sky-600 text-white border-sky-600 cursor-pointer px-6 py-1 border rounded-lg transition font-bold"><i class="fas fa-users"></i> Group </button></div><hr class="mt-4">',2)),t("form",{class:"space-y-3 mt-3",onSubmit:Z(b,["prevent"])},[C(se,{mode:"group","company-id":s.value,"onUpdate:companyId":x[0]||(x[0]=g=>s.value=g),"department-id":n.value,"onUpdate:departmentId":x[1]||(x[1]=g=>n.value=g),selectedUserIds:d.value,"onUpdate:selectedUserIds":x[2]||(x[2]=g=>d.value=g),alreadyAddedUserIds:((D=y(e).conversation)==null?void 0:D.user_ids)||[]},null,8,["company-id","department-id","selectedUserIds","alreadyAddedUserIds"]),m.value?(a(),i("p",nt,T(m.value),1)):E("",!0),x[3]||(x[3]=t("hr",null,null,-1)),t("div",at,[t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:p}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:d.value.length<1}," Create ",8,ot)])],32)])])):E("",!0)}}},lt={key:0,class:"flex flex-wrap gap-x-0.5 md:gap-x-1 items-center justify-center"},it={class:"text-xs md:text-sm"},dt=["innerHTML"],ut={key:1},ct={class:"border rounded-lg max-w-lg w-full min-w-40 md:min-w-80"},vt={class:"grow w-full flex items-center gap-1"},mt={class:"font-semibold sm:inline-block text-sm line-clamp-1"},pt={class:"shrink md:shrink-0 text-[10px] md:text-xs mt-1 text-right"},ft=["innerHTML"],yt={__name:"ChatMessageCard",props:{message:{type:Object,required:!0}},setup(o){F();const e=o,r=I(()=>e.message.is_own_message),s=I(()=>e.message.type==="system");return(n,d)=>{var m,p;return a(),i("div",{class:L(["flex px-2 md:px-4",{"justify-end pl-6 md:pl-12":!s.value&&r.value,"justify-start pr-6 md:pr-12":!s.value&&!r.value,"justify-center":s.value}])},[s.value?(a(),i("div",lt,[d[0]||(d[0]=t("i",{class:"far fa-cog text-gray-700 text-xs md:text-base"},null,-1)),t("strong",it,T(r.value?"You":(m=o.message.sender)==null?void 0:m.name),1),t("div",{innerHTML:o.message.body,class:"block text-xs md:text-sm italic whitespace-pre-wrap break-words leading-relaxed"},null,8,dt)])):(a(),i("div",ut,[t("div",ct,[t("div",{class:L(["flex justify-between items-center p-1 rounded-t-lg gap-1 md:gap-4",{"bg-[#24A1DE] text-white":r.value,"bg-gray-200 text-black":!r.value}])},[t("div",vt,[C(K,{user:o.message.sender,size:"small"},null,8,["user"]),t("div",mt,T((p=o.message.sender)==null?void 0:p.name),1)]),t("div",pt,T(o.message.send_at),1)],2),t("div",{class:"block py-1 px-2 rounded-b-lg bg-white text-xs md:text-sm whitespace-pre-wrap break-words leading-relaxed",innerHTML:o.message.body},null,8,ft)]),t("div",{class:L(["flex",{"justify-end":r.value,"justify-start":!r.value}])},[t("div",{class:L(["flex flex-wrap gap-1 max-w-[280px] pt-1",{"justify-end":r.value,"justify-start":!r.value}])},[(a(!0),i($,null,z(o.message.last_reader_photos,v=>(a(),i($,{key:v},[v?(a(),V(K,{key:0,user:{photo:v},size:"xsmall"},null,8,["user"])):E("",!0)],64))),128))],2)],2)]))],2)}}},gt={},xt={class:"flex justify-center items-center py-4"};function ht(o,e){return a(),i("div",xt,e[0]||(e[0]=[t("i",{class:"fas fa-spinner fa-spin text-2xl text-[#24A1DE]"},null,-1)]))}const ne=me(gt,[["render",ht]]),bt={key:1,class:"text-red-500 text-center my-4"},_t={key:2,class:"text-center text-gray-500 my-4"},wt={key:0,class:"text-xs text-gray-400 text-center py-2"},Ct={__name:"ChatMessageContainer",setup(o){const e=N(),r=h(!1),s=h(null),n=h(!0),d=h(!1),m=(f,x=80)=>f.scrollHeight-f.scrollTop-f.clientHeight<x,p=async(f="auto")=>{await q();const x=s.value;x&&(x.scrollTo({top:x.scrollHeight,behavior:f}),n.value=!0)},v=async()=>{const f=s.value;if(f&&(n.value=m(f),f.scrollTop<=0&&e.hasMore&&!d.value)){d.value=!0;const x=f.scrollHeight,M=f.scrollTop;try{await e.fetchOlderMessages(e.activeConversationId),await q();const D=f.scrollHeight;f.scrollTop=D-(x-M)}catch{}finally{d.value=!1}}},b=async()=>{r.value=!0;try{e.activeConversationId&&(await e.fetchConversationMessages(e.activeConversationId),await p("auto"))}catch{}finally{r.value=!1}};return O(()=>{b()}),R(()=>e.activeConversationId,async(f,x)=>{f&&f!==x&&await b()}),R(()=>e.messages.length,async(f,x)=>{const M=s.value;M&&f>x&&m(M,120)&&await p("smooth")}),I(()=>!n.value&&!!e.activeConversationId),(f,x)=>(a(),i("div",{ref_key:"scrollEl",ref:s,onScroll:v,class:L(["w-full overflow-y-auto h-[calc(100dvh-150px)] scrollbar-hide relative flex flex-col",{"items-center justify-center":!y(e).activeConversationId||y(e).error||r.value}])},[r.value?(a(),V(ne,{key:0})):E("",!0),y(e).error?(a(),i("div",bt,T(y(e).error),1)):y(e).activeConversationId?(a(),i($,{key:3},[d.value?(a(),i("div",wt,"Loading older…")):E("",!0),(a(!0),i($,null,z(y(e).messages,M=>(a(),V(yt,{key:M.id,message:M,class:"w-full my-4"},null,8,["message"]))),128))],64)):(a(),i("div",_t," Please select a conversation to view messages. ")),le(f.$slots,"default")],34))}},kt={key:0},It={__name:"AddNewMemberButton",setup(o){const e=N(),r=F();return(s,n)=>{var d;return y(e).activeConversationId&&y(e).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((d=y(r).user)==null?void 0:d.role)?(a(),i("div",kt,[t("div",{class:"size-8 rounded-full text-sm border flex justify-center items-center cursor-pointer",title:"Add New Members",onClick:n[0]||(n[0]=m=>y(e).openAddMemberModal=!0)},n[1]||(n[1]=[t("i",{class:"fas fa-user-plus"},null,-1)]))])):E("",!0)}}},$t={class:"min-w-max size-8 md:size-12 flex justify-center items-center text-[#24A1DE] bg-white rounded-full overflow-hidden border"},Mt=["src"],Ut={key:0,class:"fas fa-users md:text-3xl"},At={key:1,class:"fas fa-user md:text-3xl"},ae={__name:"ConversationAvatar",props:{conversation:{type:Object,required:!0}},setup(o){const e=h(!0);return(r,s)=>{var n,d;return a(),i("div",null,[t("div",$t,[(n=o.conversation)!=null&&n.avatar&&e.value?(a(),i("img",{key:0,onError:s[0]||(s[0]=m=>e.value=!1),src:(d=o.conversation)==null?void 0:d.avatar,alt:"Photo",class:"object-cover w-full h-full aspect-square"},null,40,Mt)):(a(),i($,{key:1},[o.conversation.type==="group"?(a(),i("i",Ut)):(a(),i("i",At))],64))])])}}},St={class:"bg-[#24A1DE] border-b border-[#24A1DE] text-white h-[48px] md:h-[56px] flex items-center"},jt={key:0,class:"w-full flex items-center justify-start gap-2 px-1 py-[3px]"},Et={class:"md:text-lg font-semibold line-clamp-1"},Lt={key:0,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Tt={key:1,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Dt={__name:"ConversationHeader",setup(o){const e=N();return(r,s)=>{var n,d,m;return a(),i("div",St,[(d=(n=y(e))==null?void 0:n.activeConversation)!=null&&d.id?(a(),i("div",jt,[C(ae,{conversation:y(e).activeConversation},null,8,["conversation"]),t("div",null,[t("h3",Et,T((m=y(e).activeConversation)==null?void 0:m.title),1),y(e).activeConversation.type==="group"?(a(),i("div",Lt,s[0]||(s[0]=[t("i",{class:"fas fa-users"},null,-1),t("i",{class:"line-clamp-1"},"Group chatting",-1)]))):(a(),i("div",Tt,s[1]||(s[1]=[t("i",{class:"fas fa-handshake"},null,-1),t("i",{class:"line-clamp-1"},"One to One chatting",-1)])))]),C(It,{class:"ml-auto md:mr-3"})])):E("",!0)])}}},Nt={class:"flex items-center gap-2"},Vt=["title"],Ht=["innerHTML"],zt={__name:"ConversationListItem",props:{conversation:{type:Object,required:!0}},setup(o){const e=N(),r=o,s=I(()=>parseInt(r.conversation.id)===parseInt(e.activeConversationId));return(n,d)=>{var p;const m=ie("RouterLink");return(p=o.conversation)!=null&&p.id?(a(),V(m,{key:0,to:`/chatting/${o.conversation.id}`,class:L(["block p-1.5 md:p-3 border-b cursor-pointer hover:bg-[#24A1DE] hover:text-white group hover:opacity-90",{"bg-[#24A1DE] text-white":s.value}]),onClick:d[0]||(d[0]=v=>y(e).showMobileConversationList=!1)},{default:ee(()=>[t("div",Nt,[C(ae,{conversation:o.conversation},null,8,["conversation"]),t("div",{class:L([{hidden:!y(e).showMobileConversationList},"md:block"])},[t("h3",{title:o.conversation.title,class:"md:text-lg font-semibold line-clamp-1"},T(o.conversation.title),9,Vt),t("div",{class:L(["text-xs md:text-sm group-hover:text-gray-50 line-clamp-1",{"text-gray-50":s.value,"text-gray-600":!s.value}]),innerHTML:o.conversation.subtitle},null,10,Ht)],2)])]),_:1},8,["to","class"])):E("",!0)}}},Bt={class:"flex flex-col items-center justify-center p-4 text-center text-gray-600"},Gt={__name:"ConversationNotFoundMessage",setup(o){return(e,r)=>(a(),i("div",Bt,[r[0]||(r[0]=t("i",{class:"fas fa-info-circle text-xl"},null,-1)),r[1]||(r[1]=t("p",{class:"mt-2 mb-4"},[B(" No conversations found. "),t("br"),B(" Start a new conversation! ")],-1)),C(te)]))}},Ot={class:"overflow-y-auto h-[calc(100dvh-150px)] scrollbar-hide text-blue-900 bg-white border-0"},Rt={__name:"ConversationList",setup(o){const e=N(),r=h(!1);return O(async()=>{r.value=!0,await e.fetchUserConversations(),r.value=!1}),(s,n)=>(a(),i("div",null,[t("div",Ot,[r.value?(a(),V(ne,{key:0})):y(e).conversations.length===0?(a(),V(Gt,{key:1})):(a(!0),i($,{key:2},z(y(e).filteredConversations,d=>(a(),V(zt,{key:d.id,conversation:d},null,8,["conversation"]))),128))])]))}},Ft={for:"search",class:"grow shrink relative block"},qt={__name:"SearchConversation",setup(o){const e=N();return(r,s)=>(a(),i("label",Ft,[s[1]||(s[1]=t("i",{class:"fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-[#24A1DE]"},null,-1)),J(t("input",{id:"search",placeholder:"Search Conversations...",type:"search",class:"input-1 pl-10 pr-2 rounded-b-none border-none outline-[#24a0deb0] py-[11px] md:py-[15px] rounded-none rounded-tl-lg","onUpdate:modelValue":s[0]||(s[0]=n=>y(e).searchText=n)},null,512),[[W,y(e).searchText]])]))}},Pt={class:"flex items-start gap-2"},Yt={class:"w-full border-2 border-blue-100 rounded-xl bg-gray-100 px-1.5 pt-1.5 pb-0"},Kt={__name:"SendMessageBox",setup(o){const e=N(),r=h(""),s=h(null);function n(){const p=s.value;p&&(p.style.height="auto",p.style.height=p.scrollHeight+"px")}async function d(){var b;const p=r.value.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim();if(!e.activeConversationId||!p)return;const v=await e.createConversationMessage(e.activeConversationId,{type:"text",body:p,format:"plain"});r.value="",await q(),n(),(b=e==null?void 0:e.bumpConversationToTop)==null||b.call(e,e.activeConversationId,v)}function m(p){p.isComposing||p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),d())}return O(()=>q(n)),(p,v)=>(a(),i("div",Pt,[v[2]||(v[2]=t("label",{class:"hidden bg-gray-100 text-gray-600 rounded-full px-3 py-2 hover:bg-gray-500 hover:text-white cursor-pointer"},[t("input",{type:"file",class:"hidden",accept:"image/jpg,image/jpeg,image/png,image/gif,application/pdf"}),t("i",{class:"far fa-paperclip text-xl"})],-1)),t("div",Yt,[J(t("textarea",{ref_key:"taRef",ref:s,"onUpdate:modelValue":v[0]||(v[0]=b=>r.value=b),onInput:n,onKeydown:m,name:"body",rows:"1",placeholder:"Write a message…",class:"w-full resize-none overflow-hidden bg-transparent outline-none leading-6 max-h-32 mb-0"},null,544),[[W,r.value]])]),t("button",{type:"button",onClick:d,class:"bg-blue-100 text-blue-600 rounded-full px-3 py-2 hover:bg-blue-600 hover:text-white"},v[1]||(v[1]=[t("i",{class:"far fa-paper-plane text-xl"},null,-1)]))]))}},Jt={class:"my-container"},Wt={class:"flex overflow-hidden border-[#24A1DE] border rounded-lg"},Qt={class:"h-[48px] md:h-[56px] flex justify-center items-center border-b border-[#24A1DE] bg-white rounded-tl-lg"},Xt={key:0,class:"my-8 text-center px-4 grid justify-center items-center gap-2"},as={__name:"ChattingList",setup(o){const e=N(),r=de();return R(()=>r.params.conversationId,s=>{e.activeConversationId=s},{immediate:!0}),O(()=>{e.showMobileConversationList=!r.params.conversationId}),(s,n)=>(a(),i($,null,[t("div",Jt,[t("div",Wt,[t("div",{class:L(["min-w-11 md:block grow-0 shrink-0 md:w-[280px] lg:w-[360px] xl:w-[400px] rounded-l-lg",{"w-full":y(e).showMobileConversationList}])},[t("div",Qt,[t("div",{onClick:n[0]||(n[0]=d=>y(e).showMobileConversationList=!0),class:L(["md:hidden flex justify-center items-center text-2xl text-[#24A1DE]",{hidden:y(e).showMobileConversationList}])},n[1]||(n[1]=[t("i",{class:"fas fa-bars"},null,-1)]),2),t("div",{class:L([y(e).showMobileConversationList?"flex":"hidden","w-full md:flex items-center justify-between"])},[C(qt),C(te)],2)]),C(Rt)],2),t("div",{class:L(["md:block relative grow shrink border-l rounded-r-lg overflow-hidden bg-gray-100 border-[#24A1DE]",{hidden:y(e).showMobileConversationList}])},[y(e).activeConversationId?(a(),i($,{key:1},[C(Dt),C(Ct,null,{default:ee(()=>[C(Kt,{class:"bg-white border-t border-[#24A1DE] sticky bottom-0 mt-auto z-10 w-full p-2"})]),_:1})],64)):(a(),i("div",Xt,n[2]||(n[2]=[t("i",{class:"fad text-blue-600 fa-info-circle text-4xl md:text-7xl"},null,-1),t("p",{class:"text-gray-500 md:text-4xl"},[B(" Select a conversation "),t("br"),B(" to start chatting ")],-1)])))],2)])]),C(et),y(e).openAddMemberModal?(a(),V(rt,{key:0})):E("",!0)],64))}};export{as as default};
