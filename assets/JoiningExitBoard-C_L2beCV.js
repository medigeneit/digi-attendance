import{b as G,u as H,z as W,A as F,e as X,c as g,o as v,a as s,n as ee,h as Q,B as te,k as j,J as le,P as re,r as k,x as J,Q as z,g as A,v as ie,q as L,j as Y,t as w,F as K,y as Z,M as R,f as de}from"./index-Eg-XCLes.js";import{_ as pe}from"./EmployeeFilter-CMKhz277.js";import"./company-BCpSyv1e.js";import"./department-CdHxm22d.js";import"./EmployeeDropdownInput-BvPs8qxj.js";import"./SelectDropdown-CF4aDV-M.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-CnWdmoqs.js";const ce={class:"flex flex-wrap items-end gap-3"},ye={__name:"BoardFilters",props:{modelValue:{type:Object,required:!0},companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup($,{emit:d}){const T=$,B=d,b=G(),C=H(),h={type:null,user_type:"Probationary"},P=(o={})=>({type:o.type??h.type,company_id:o.companyId??null,department_id:o.departmentId??null,employee_id:o.employeeId??null,line_type:o.lineType??null,user_type:o.user_type??h.user_type}),y=(o={})=>({type:o.type??h.type,companyId:o.company_id??null,departmentId:o.department_id??null,employeeId:o.employee_id??null,lineType:o.line_type??null,user_type:o.user_type??h.user_type}),l=W(P(T.modelValue));let r=!1;function f(){r||B("update:modelValue",{...y(l)})}const I=["type","company_id","department_id","employee_id","line_type","user_type"],u=o=>o===""||o===null||o===void 0||o==="all";function N(){const o={};return!u(l.type)&&String(l.type)!==String(h.type)&&(o.type=String(l.type)),u(l.company_id)||(o.company_id=String(l.company_id)),u(l.department_id)||(o.department_id=String(l.department_id)),u(l.employee_id)||(o.employee_id=String(l.employee_id)),u(l.line_type)||(o.line_type=String(l.line_type)),!u(l.user_type)&&String(l.user_type)!==h.user_type&&(o.user_type=String(l.user_type)),o}function V(o={}){const p={...b.query};for(const S of I)delete p[S];const c={...p,...N(),...o};for(const S of Object.keys(c)){const _=c[S];(_===""||_===null||_===void 0)&&delete c[S]}return c}let U=null;function O({replace:o=!0,partial:p={},debounce:c=150}={}){U&&clearTimeout(U),U=setTimeout(()=>{const S=V(p);(o?C.replace({query:S}):C.push({query:S})).catch(()=>{})},c)}function D(){const o={...y(l)};B("submit",o),O({replace:!0,debounce:0})}return F(()=>T.modelValue,o=>{const p=P(o||{});let c=!1;for(const S of Object.keys(p))if(l[S]!==p[S]){c=!0;break}c&&(r=!0,Object.assign(l,p),le(()=>{r=!1}))},{deep:!0}),F(()=>[l.type,l.company_id,l.department_id,l.employee_id,l.line_type,l.user_type],()=>{f(),O({replace:!0,debounce:150})}),X(()=>{b.query.user_type&&(l.user_type=String(b.query.user_type))}),F(()=>b.query.user_type,o=>{o!=null&&(l.user_type=String(o))}),(o,p)=>(v(),g("div",ce,[s("div",null,[p[7]||(p[7]=s("label",{class:"block text-xs text-gray-500 mb-1"},"User Type",-1)),Q(s("select",{"onUpdate:modelValue":p[0]||(p[0]=c=>l.user_type=c),class:"border rounded px-2 py-1"},p[6]||(p[6]=[s("option",{value:"Probationary"},"Probationary",-1),s("option",{value:"Permanent"},"Permanent",-1)]),512),[[te,l.user_type]])]),ee(pe,{company_id:l.company_id,"onUpdate:company_id":p[1]||(p[1]=c=>l.company_id=c),department_id:l.department_id,"onUpdate:department_id":p[2]||(p[2]=c=>l.department_id=c),employee_id:l.employee_id,"onUpdate:employee_id":p[3]||(p[3]=c=>l.employee_id=c),line_type:l.line_type,"onUpdate:line_type":p[4]||(p[4]=c=>l.line_type=c),"with-type":!0,"initial-value":j(b).query,companies:$.companies,departments:$.departments,onFilterChange:p[5]||(p[5]=c=>{Object.assign(l,c)})},null,8,["company_id","department_id","employee_id","line_type","initial-value","companies","departments"]),s("button",{class:"btn-2 py-1",onClick:D}," Apply ")]))}},ne=re("checklistBoard",()=>{const $=k(!1),d=k(null),T=k("joining"),B=k("Probationary"),b=k(null),C=k(null),h=k(""),P=k([]),y=k([]),l=k(Object.create(null)),r=k(null),f=n=>typeof n=="string"?n.toLowerCase():"",I=n=>Array.isArray(n)?n:[],u=n=>{var i;return((i=n==null?void 0:n.data)==null?void 0:i.data)??(n==null?void 0:n.data)},N=n=>{var i,m;return((i=n==null?void 0:n.company)==null?void 0:i.name)||(n==null?void 0:n.company_name)||((m=n==null?void 0:n.organization)==null?void 0:m.name)||"—"},V=n=>{var i,m;return((i=n==null?void 0:n.department)==null?void 0:i.name)||((m=n==null?void 0:n.dept)==null?void 0:m.name)||(n==null?void 0:n.department_name)||"—"},U=n=>{var i;return((i=n==null?void 0:n.position)==null?void 0:i.title)||(n==null?void 0:n.designation)||"—"},O=(n={})=>{const i={user_type:B.value||void 0,type:T.value||void 0,company_id:b.value||void 0,department_id:C.value||void 0,search:(h.value||"").trim()||void 0,template_id:o.value||void 0};return Object.keys(i).forEach(m=>(i[m]==null||i[m]==="")&&delete i[m]),{...i,...n}},D=J(()=>{const n=f(T.value);return P.value.find(i=>f(i==null?void 0:i.type)===n)||null}),o=J(()=>{var n;return((n=D.value)==null?void 0:n.id)??null});async function p(n={}){try{const i=await z.get("/checklist-templates",{params:n});P.value=I(u(i))}catch(i){throw P.value=[],d.value=i,i}}async function c(n,i){const{data:m}=await z.patch(`/user/${n}/employment-type`,{employment_type:i}),M=y.value.findIndex(E=>E.id===n);return M!==-1&&(this.users[M]={...this.users[M],employment_type:T}),this.rows[n]&&(this.rows[n]={...this.rows[n]}),m}async function S(n={}){if(r.value)try{await r.value}catch{}$.value=!0,d.value=null;const i=O(n),m=(async()=>{try{const M=await z.get("/users-checklists",{params:i});y.value=I(u(M))}catch(M){throw y.value=[],d.value=M,M}finally{$.value=!1,r.value=null}})();return r.value=m,m}async function _({withUsers:n=!0,templateParams:i={},userParams:m={}}={}){$.value=!0,d.value=null;try{P.value.length||await p(i),n&&await S(m)}catch(M){throw d.value=M,M}finally{$.value=!1}}function e(n){y.value=I(n)}function a(n={}){"type"in n&&(T.value=n.type),"companyId"in n&&(b.value=n.companyId),"departmentId"in n&&(C.value=n.departmentId),"search"in n&&(h.value=n.search)}function t(){T.value="joining",b.value=null,C.value=null,h.value=""}function x(){l.value=Object.create(null)}return{loading:$,error:d,type:T,companyId:b,departmentId:C,search:h,templates:P,users:y,rows:l,templateByType:D,templateId:o,companyNameOf:N,departmentNameOf:V,positionTitleOf:U,loadBoard:_,loadTemplates:p,loadUsers:S,setUsers:e,setFilters:a,resetFilters:t,clearRowCache:x,updateEmploymentType:c}}),me={class:"space-y-4"},ue={class:"flex flex-wrap items-center gap-2"},_e={class:"relative"},fe={class:"rounded-lg border p-1 text-xs"},ve={class:"ml-auto"},be={class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs text-blue-700"},he={class:"ml-1 font-medium"},ge={class:"overflow-x-auto rounded-xl border shadow-sm"},xe={class:"min-w-full text-[13px]"},we={class:"p-2"},ke={class:"p-2"},Ie={class:"flex items-center gap-2"},Se={class:"relative h-8 w-8 shrink-0"},Te=["src"],Ce={key:1,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 text-[11px] font-semibold text-gray-700"},Me={class:"min-w-0"},Pe={class:"font-medium truncate"},Be={class:"text-[11px] text-gray-500 space-x-2 truncate"},Ne={key:0},$e={class:"hidden sm:inline"},je={class:"p-2 hidden md:table-cell"},De=["title"],Ue={class:"p-2"},Oe={class:"relative w-full rounded-full bg-gray-200 h-2 overflow-hidden"},Le=["title"],Ve=["title"],Ae={class:"mt-1 flex items-center justify-between text-[11px] text-gray-600"},Ee={key:0,class:"mt-1"},Fe=["title"],qe={class:"mt-1 flex items-center justify-between text-[11px] text-gray-600"},ze={key:0},Re={key:1,class:"text-red-600"},Qe={class:"p-2"},Je={class:"flex items-center gap-2"},Ye={class:"relative"},He=["disabled","value","onChange"],Ke=["value"],Ze={key:0,class:"absolute right-2 top-1/2 h-3 w-3 -translate-y-1/2 animate-spin text-gray-400",viewBox:"0 0 24 24"},Ge={class:"p-2"},We=["disabled","title","onClick"],Xe={key:0,class:"text-gray-600 text-sm"},et={key:1,class:"rounded-xl border border-dashed p-10 text-center text-sm text-gray-500"},tt={__name:"ChecklistBoardTable",setup($){const d=ne(),T=H(),B=k(""),b=k(!1),C=k("progress_desc"),h=W({}),P=e=>{var a;return((a=d.rows)==null?void 0:a[String(e==null?void 0:e.id)])||{}},y=(e,a,t)=>Math.min(Math.max(Number(e||0),a),t),l=e=>e<0?0:e>100?100:Math.round(e),r=e=>e?new Date(e):null,f=(e,a)=>{const t=new Date(e.getTime()),x=t.getMonth()+(a||0);return t.setMonth(x),t.getMonth()!==(x%12+12)%12&&t.setDate(0),t},I=(e,a)=>Math.round((e-a)/864e5),u=e=>{const t=P(e).percent??(e==null?void 0:e.percent)??0;return y(t,0,100)},N=e=>{var a;return y(((a=e==null?void 0:e.checklist)==null?void 0:a.required_completion_percent)??100,1,100)},V=e=>{const a=x=>String(x||"").toLowerCase(),t=a(B.value);return t?[e==null?void 0:e.name,e==null?void 0:e.employee_id,e==null?void 0:e.department,e==null?void 0:e.designation].filter(Boolean).some(x=>a(x).includes(t)):!0};function U(e){const a=d.templateId;a&&T.push({name:"checklist.create",params:{userId:e.id,templateId:a}})}const O=J(()=>{let e=(d.users||[]).filter(V);return b.value&&(e=e.filter(a=>u(a)<N(a))),C.value==="name_asc"?e=[...e].sort((a,t)=>(a.name||"").localeCompare(t.name||"")):C.value==="progress_asc"?e=[...e].sort((a,t)=>u(a)-u(t)):e=[...e].sort((a,t)=>u(t)-u(a)),e}),D=[{value:"probationary",label:"Probationary"},{value:"permanent",label:"Permanent"}],o=e=>String(e||"").toLowerCase(),p=e=>{var t;const a=o(e);return((t=D.find(x=>x.value===a))==null?void 0:t.label)||"—"},c=e=>{const a=o(e);return a==="probationary"?"bg-amber-50 text-amber-700 ring-amber-200":a==="permanent"?"bg-green-50 text-green-700 ring-green-200":"bg-gray-50 text-gray-700 ring-gray-200"};async function S(e,a){if(!(e!=null&&e.id))return;const t=o(a),x=o(e.employment_type);if(!D.some(m=>m.value===t)||x===t)return;const n=p(e.employment_type),i=p(t);h[e.id]=!0,e.employment_type=i;try{await d.updateEmploymentType(e.id,i)}catch(m){e.employment_type=n,console.error(m),alert("Failed to update employment type. Please try again.")}finally{h[e.id]=!1}}function _(e){if(!(o(e==null?void 0:e.employment_type)==="probationary"))return{enabled:!1};const t=r(e==null?void 0:e.probation_start_at)||r(e==null?void 0:e.probation_start_date)||r(e==null?void 0:e.joining_date)||r(e==null?void 0:e.join_date)||r(e==null?void 0:e.created_at),x=Number(e==null?void 0:e.probation_months)||Number(e==null?void 0:e.provisional_month)||Number(e==null?void 0:e.probation_duration_months)||6,n=Number(e==null?void 0:e.probation_extension_months)||Number(e==null?void 0:e.extended_provisional_month)||0;if(!t||Number.isNaN(x))return{enabled:!1};const i=Math.max(1,x+(n||0)),m=f(t,i),M=new Date,E=Math.max(1,I(m,t)),se=Math.max(0,Math.min(E,I(M,t))),q=I(m,M),ae=l(se/E*100),oe=q<0?"overdue":q<=14?"near_end":"active";return{enabled:!0,start:t,end:m,pct:ae,leftDays:q,status:oe}}return(e,a)=>(v(),g("div",me,[s("div",ue,[s("div",_e,[Q(s("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>B.value=t),type:"search",placeholder:"Search name / ID / dept / designation…",class:"w-64 md:w-80 max-w-full rounded-lg border bg-white/90 px-8 py-2 text-sm outline-none focus:border-gray-400"},null,512),[[ie,B.value]]),a[5]||(a[5]=s("svg",{class:"pointer-events-none absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M12.9 14.32a8 8 0 111.414-1.414l3.387 3.387a1 1 0 01-1.414 1.414L12.9 14.32zM14 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1)),B.value?(v(),g("button",{key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",onClick:a[1]||(a[1]=t=>B.value=""),"aria-label":"Clear search"},"✕")):A("",!0)]),s("div",fe,[s("button",{class:L(["rounded-md px-2 py-1",b.value?"":"bg-gray-900 text-white"]),onClick:a[2]||(a[2]=t=>b.value=!1)},"All",2),s("button",{class:L(["rounded-md px-2 py-1",b.value?"bg-gray-900 text-white":""]),onClick:a[3]||(a[3]=t=>b.value=!0),title:"Show only users below their checklist target"},"Only Missing",2)]),Q(s("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>C.value=t),class:"rounded-md border bg-white px-2 py-1 text-xs outline-none"},a[6]||(a[6]=[s("option",{value:"progress_desc"},"Sort: Progress ↓",-1),s("option",{value:"progress_asc"},"Sort: Progress ↑",-1),s("option",{value:"name_asc"},"Sort: Name A–Z",-1)]),512),[[te,C.value]]),s("div",ve,[s("span",be,[a[7]||(a[7]=Y(" Template: ")),s("span",he,w(j(d).templateId||"Not selected"),1)])])]),s("div",ge,[s("table",xe,[a[9]||(a[9]=s("thead",{class:"sticky top-0 bg-gray-50/90 backdrop-blur"},[s("tr",{class:"text-left border-b"},[s("th",{class:"p-2 w-10"},"#"),s("th",{class:"p-2 min-w-[220px]"},"User"),s("th",{class:"p-2 hidden md:table-cell min-w-[160px]"},"Role"),s("th",{class:"p-2 min-w-[260px]"},"Progress"),s("th",{class:"p-2 w-44"},"Status"),s("th",{class:"p-2 w-36"},"Actions")])],-1)),s("tbody",null,[(v(!0),g(K,null,Z(O.value,(t,x)=>(v(),g("tr",{key:t.id,class:"border-b hover:bg-gray-50/70"},[s("td",we,w(x+1),1),s("td",ke,[s("div",Ie,[s("div",Se,[t.avatar?(v(),g("img",{key:0,src:t.avatar,alt:"",class:"h-8 w-8 rounded-full object-cover"},null,8,Te)):(v(),g("div",Ce,w((t.name||t.full_name||t.email||"??").slice(0,2).toUpperCase()),1))]),s("div",Me,[s("div",Pe,w(t.name||t.full_name||t.email),1),s("div",Be,[t.employee_id?(v(),g("span",Ne,"ID: "+w(t.employee_id),1)):A("",!0),s("span",$e,"Dept: "+w(t.department||"—"),1)])])])]),s("td",je,[s("div",{class:"truncate",title:t.designation},w(t.designation||"—"),9,De)]),s("td",Ue,[s("div",Oe,[s("div",{class:"pointer-events-none absolute top-0 h-2 w-0.5 bg-gray-600/60",style:R({left:`calc(${N(t)}% - 1px)`}),title:`Checklist target ${N(t)}%`},null,12,Le),s("div",{class:L(["h-2 transition-all",u(t)>=N(t)?"bg-green-500":"bg-amber-500"]),style:R({width:u(t)+"%"}),title:`Checklist: ${u(t)}% (Target ${N(t)}%)`},null,14,Ve)]),s("div",Ae,[s("span",null,"Actual: "+w(u(t))+"%",1),s("span",null,"Target: "+w(N(t))+"%",1)]),_(t).enabled?(v(),g("div",Ee,[s("div",{class:L(["relative w-full rounded-full h-1.5 overflow-hidden",{"bg-amber-100":_(t).status!=="overdue","bg-red-100":_(t).status==="overdue"}]),title:`Probation ${_(t).pct}% | Ends ${_(t).end.toLocaleDateString()}`},[s("div",{class:L(["h-1.5 transition-all",{"bg-amber-500":_(t).status==="active","bg-orange-500":_(t).status==="near_end","bg-red-500":_(t).status==="overdue"}]),style:R({width:_(t).pct+"%"})},null,6)],10,Fe),s("div",qe,[s("span",null,"Probation: "+w(_(t).pct)+"%",1),_(t).leftDays>=0?(v(),g("span",ze,w(_(t).leftDays)+"d left ",1)):(v(),g("span",Re," Overdue "+w(Math.abs(_(t).leftDays))+"d ",1))])])):A("",!0)]),s("td",Qe,[s("div",Je,[s("span",{class:L(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] ring-1",c(t.employment_type)])},w(p(t.employment_type)),3),s("div",Ye,[s("select",{disabled:!!h[t.id],value:o(t.employment_type),class:"rounded-md border bg-white px-2 py-1 text-[11px] outline-none disabled:opacity-50",onChange:n=>S(t,n.target.value),"aria-label":"Change employment type"},[(v(),g(K,null,Z(D,n=>s("option",{key:n.value,value:n.value},w(n.label),9,Ke)),64))],40,He),h[t.id]?(v(),g("svg",Ze,a[8]||(a[8]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3",fill:"none"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3A5 5 0 007 12H4z"},null,-1)]))):A("",!0)])])]),s("td",Ge,[s("button",{class:"px-3 py-1.5 rounded-md text-[12px] font-medium bg-gray-900 text-white hover:bg-black disabled:opacity-40",disabled:!j(d).templateId,title:j(d).templateId?"":"Select a template first",onClick:n=>U(t)},w(t!=null&&t.checklist?"Open":"Create"),9,We)])]))),128))])])]),j(d).loading?(v(),g("div",Xe,"Loading…")):!j(d).loading&&O.value.length===0?(v(),g("div",et," No users found for the current filters. ")):A("",!0)]))}},nt={class:"p-6 space-y-6"},st={class:"flex items-center justify-between"},at={class:"text-2xl font-semibold"},ot={class:"text-gray-500"},lt={key:0,class:"text-gray-600"},rt={key:1,class:"text-red-600"},ft={__name:"JoiningExitBoard",setup($){const d=ne(),T=G(),B=H(),b=k([]),C=k([]),h=(r={})=>({type:r.type??d.type,companyId:r.company_id?Number(r.company_id):null,departmentId:r.department_id?Number(r.department_id):null,employeeId:r.employee_id?Number(r.employee_id):null,lineType:r.line_type??null,user_type:r.user_type??null,search:r.search??d.search}),P=(r={})=>{const f={type:r.type||void 0,company_id:r.companyId||void 0,department_id:r.departmentId||void 0,employee_id:r.employeeId||void 0,line_type:r.lineType||void 0,user_type:r.user_type||void 0,search:r.search||void 0};return Object.keys(f).forEach(I=>(f[I]==null||f[I]==="")&&delete f[I]),f},y=k({type:d.type,companyId:d.companyId,departmentId:d.departmentId,employeeId:null,lineType:null,user_type:null,search:d.search});F(y,r=>{d.type=r.type,d.user_type=r.user_type,d.companyId=r.companyId??null,d.departmentId=r.departmentId??null,d.search=r.search??"",B.replace({query:{...T.query,...P(r)}})},{deep:!0,immediate:!0});async function l(){await d.loadUsers({type:y.value.type,company_id:y.value.companyId,department_id:y.value.departmentId,employee_id:y.value.employeeId,line_type:y.value.lineType,user_type:y.value.user_type,search:y.value.search})}return X(async()=>{Object.assign(y.value,h(T.query)),await d.loadBoard({withUsers:!0,userParams:P(y.value)})}),(r,f)=>{var I,u;return v(),g("div",nt,[s("div",st,[s("h1",at,[s("b",null,w(((I=j(d).templateByType)==null?void 0:I.name)||"—"),1),f[1]||(f[1]=Y(" Board"))]),s("div",ot,[f[2]||(f[2]=Y(" Template: ")),s("b",null,w(((u=j(d).templateByType)==null?void 0:u.name)||"—"),1)])]),ee(ye,{modelValue:y.value,"onUpdate:modelValue":f[0]||(f[0]=N=>y.value=N),companies:b.value,departments:C.value,onSubmit:l},null,8,["modelValue","companies","departments"]),j(d).loading?(v(),g("div",lt,"Loading…")):j(d).error?(v(),g("div",rt,"Failed to load.")):(v(),de(tt,{key:2}))])}}};export{ft as default};
