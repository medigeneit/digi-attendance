import{r as y,m as ie,x as q,y as L,c,g as O,o as i,a as e,j as de,t as f,k,h as S,C as U,F as D,n as E,v as ae,u as be,b as ge,e as xe,z as ke,q as x,i as w,l as Se,p as j,f as se,X as le}from"./index-BPkOAd5y.js";import{L as we}from"./LoaderView-CH9YA-QO.js";import{u as re}from"./shift-CQm7Hp42.js";import{d as ne}from"./dayjs.min-Cbbdfn5l.js";import{_ as qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as Ce}from"./WeekendAssignModal-CA-Liff3.js";import{_ as Ae}from"./MultiselectDropdown-pUPKx0mQ.js";import{_ as Ue}from"./UserChip-B3wVOpci.js";import{u as De}from"./company-QFYmMYrv.js";import{u as Ee}from"./department-BcE_6z2Y.js";import{u as Me}from"./user-DK6hRhGD.js";const $e={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},je={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},Le={class:"text-lg font-semibold mb-4"},Oe={class:"mb-4"},Ie=["value"],Ne={class:"mb-4"},Te={class:"mb-4"},Be={class:"flex justify-end gap-3 mt-4"},Ye={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(M,{emit:C}){const I=C,d=M,l=y({shift_id:"",employee_id:d.employee.id,start_date:"",end_date:""}),_=ie(()=>{const m=Object.keys(d.shifts)[0];return d.shifts[m]||[]});q(()=>d.employee,m=>{l.value.employee_id=(m==null?void 0:m.id)||0},{immediate:!0,deep:!0}),q(()=>d.isOpen,m=>{var n;m&&(d.hasShift?(l.value.shift_id=d.hasShift.shift_id||"",l.value.start_date=d.hasShift.start_date?ne(d.hasShift.start_date).format("YYYY-MM-DD"):"",l.value.end_date=d.hasShift.end_date?ne(d.hasShift.end_date).format("YYYY-MM-DD"):"",l.value.employee_id=((n=d.employee)==null?void 0:n.id)||""):(l.value.shift_id="",l.value.start_date="",l.value.end_date=""))},{immediate:!0});const u=()=>{I("close",!1)},v=re(),{message:h}=L(v),b=async()=>{if(!l.value.shift_id||!l.value.start_date||!l.value.employee_id){alert("All fields are required!");return}try{const m={...l.value},n=await v.shiftAssign(m);console.log("Shift assigned successfully:",n),alert(d.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),u()}catch(m){console.error("Failed to assign shift:",m),alert("Failed to assign shift.")}};return(m,n)=>M.isOpen?(i(),c("div",$e,[e("div",je,[e("h2",Le,f(d.hasShift?"Update Shift for":"Assign Shift to")+" "+f(M.employee.name),1),de(" "+f(k(h))+" ",1),e("div",Oe,[n[4]||(n[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),S(e("select",{"onUpdate:modelValue":n[0]||(n[0]=r=>l.value.shift_id=r),class:"w-full p-2 border rounded"},[n[3]||(n[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(i(!0),c(D,null,E(_.value,r=>(i(),c("option",{key:r==null?void 0:r.id,value:r==null?void 0:r.id},f(r==null?void 0:r.name),9,Ie))),128))],512),[[U,l.value.shift_id]])]),e("div",Ne,[n[5]||(n[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),S(e("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=r=>l.value.start_date=r),class:"w-full border rounded p-2"},null,512),[[ae,l.value.start_date]])]),e("div",Te,[n[6]||(n[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),S(e("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=r=>l.value.end_date=r),class:"w-full border rounded p-2"},null,512),[[ae,l.value.end_date]])]),e("div",Be,[e("button",{onClick:u,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:b,class:"px-4 py-2 bg-green-600 text-white rounded"},f(d.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:u,class:"absolute top-2 right-2 text-red-500 text-xl"},n[7]||(n[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):O("",!0)}},Fe=qe(Ye,[["__scopeId","data-v-c3e70801"]]),We={class:"space-y-2 px-4"},Re={class:"flex items-center justify-between gap-2"},He={class:"flex gap-4"},ze={class:"grid md:grid-cols-4 items-center gap-4"},Ve=["value"],Pe=["value"],Je={key:0,class:"text-center py-4"},Ke={key:1,class:"space-y-4"},Xe={key:0,class:"text-center py-2 text-lg italic text-gray-500"},Ge={class:"title-md"},Qe={class:"overflow-x-auto"},Ze={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},et={class:"border border-gray-300 px-2"},tt=["innerHTML"],ot=["innerHTML"],at={class:"border border-gray-300 px-2"},st={class:"border border-gray-300 px-2"},lt={class:"border border-gray-300 px-2"},nt={class:"border border-gray-300 px-2"},it={class:"border border-gray-300 px-3 py-3"},dt={class:"flex items-center justify-between gap-2"},rt={key:0,class:"text-sm font-medium text-green-700"},ct={key:1,class:"text-sm italic text-red-500"},pt=["onClick","title"],ft={class:"border border-gray-300 px-3 py-3"},mt={class:"flex items-center justify-between gap-2"},yt={key:0,class:"text-sm font-medium text-green-700"},ut={key:1,class:"text-sm italic text-red-500"},vt=["onClick","title"],_t={class:"border border-gray-300 px-2"},ht={class:"border border-gray-300 px-2"},bt={class:"border border-gray-300 px-2"},gt={key:0,class:"text-green-500"},xt={key:1,class:"text-red-500"},kt={class:"border border-gray-300 px-2"},St={class:"flex gap-2"},Ot={__name:"UserList",setup(M){const C=re(),{shifts:I}=L(C),d=be(),l=ge(),_=Me(),u=y(l.query.company||"all"),v=y(l.query.department||"all"),h=y(l.query.line_type||"all"),b=y(l.query.status||"active"),m=y(""),n=y(""),r=y(!1),A=y(!1),N=Ee(),T=De(),{companies:ce}=L(T),{departments:pe}=L(N),B=y([]);xe(async()=>{await T.fetchCompanies();const t=l.query.company,o=l.query.department;t&&(await W(t),await Y(t)),o&&await R(o)});const fe=()=>{d.go(-1)},me=()=>{_.fetchUsers({company_id:l.query.company,department_id:l.query.department,line_type:l.query.line_type,status:l.query.status,user_id:l.query.employee_id})};q(u,async(t,o)=>{!t||t===o||(Y(t),W(t),l.query.company!==t&&d.push({query:{...l.query,company:t}}))}),q(v,async(t,o)=>{!t||t===o||(R(t),l.query.department!==t&&d.push({query:{...l.query,department:t}}))}),q(h,t=>{d.push({query:{...l.query,line_type:t}})}),q(b,t=>{d.push({query:{...l.query,status:t}})});const Y=async t=>{await N.fetchDepartments(t)},F=ie(()=>{var g;let t=[...(_==null?void 0:_.users)||[]];if(u.value!=="all"&&(t=t.filter(s=>{var p;return((p=s==null?void 0:s.company)==null?void 0:p.id)==u.value})),v.value!=="all"&&(t=t.filter(s=>{var p;return((p=s==null?void 0:s.department)==null?void 0:p.id)==v.value})),h.value!=="all"&&(t=t.filter(s=>(s==null?void 0:s.type)==h.value)),b.value){const s=b.value==="active"?1:0;t=t.filter(p=>(p==null?void 0:p.is_active)==s)}(g=m.value)!=null&&g.id&&(t=t.filter(s=>(s==null?void 0:s.id)==m.value.id));const o={};return t.forEach(s=>{var a;const p=((a=s==null?void 0:s.company)==null?void 0:a.name)||"Unknown Company";o[p]||(o[p]=[]),o[p].push(s)}),o}),$=y("");function ye(t){$.value=t.id,n.value=t,(t==null?void 0:t.company_id)!==void 0&&(C.fetchShifts(t==null?void 0:t.company_id),r.value=!r.value)}function ue(t){$.value=t.id,n.value=t,(t==null?void 0:t.company_id)!==void 0&&(C.fetchShifts(t==null?void 0:t.company_id),A.value=!A.value)}function ve(){r.value=!1}async function _e(){await _.fetchUsersExcelExport({data:{company_id:u.value,department_id:v.value,line_type:h.value,status:b.value}})}const W=async t=>{try{const o=await T.fetchEmployees(t);B.value=o.data}catch(o){console.error("Failed to fetch employees by company:",o)}},R=async t=>{try{const o=await N.fetchDepartmentEmployee({departmentIds:[t]});B.value=o}catch(o){console.error("Failed to fetch employees by department:",o)}},H=t=>{if(t){const o=t.split(" "),g=o.slice(0,2).join(" "),s=o.length>2?`<br>${o.slice(2).join(" ")}`:"";return g+s}return""};return(t,o)=>{const g=ke("RouterLink");return i(),c("div",We,[e("div",Re,[e("button",{class:"btn-3",onClick:fe},o[7]||(o[7]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),o[10]||(o[10]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),e("div",He,[x(g,{to:{name:"UserAdd",query:{company:k(l).query.company}},class:"btn-2"},{default:w(()=>o[8]||(o[8]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[8]},8,["to"]),e("button",{type:"button",onClick:_e,class:"btn-3"},o[9]||(o[9]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),de("Excel ")]))])]),e("div",ze,[e("div",null,[S(e("select",{"onUpdate:modelValue":o[0]||(o[0]=s=>u.value=s),class:"input-1"},[o[11]||(o[11]=e("option",{value:"all",selected:""},"All Company",-1)),(i(!0),c(D,null,E(k(ce),(s,p)=>(i(),c("option",{key:p,value:s.id},f(s==null?void 0:s.name),9,Ve))),128))],512),[[U,u.value]])]),e("div",null,[S(e("select",{"onUpdate:modelValue":o[1]||(o[1]=s=>v.value=s),class:"input-1"},[o[12]||(o[12]=e("option",{value:"all",selected:""},"All Department",-1)),(i(!0),c(D,null,E(k(pe),(s,p)=>(i(),c("option",{key:p,value:s.id},f(s==null?void 0:s.name),9,Pe))),128))],512),[[U,v.value]])]),e("div",null,[S(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>h.value=s),class:"input-1"},o[13]||(o[13]=[Se('<option value="all">All Category</option><option value="executive">Executive</option><option value="support_staff">Support Staff</option><option value="doctor">Doctor</option><option value="academy_body">Academy Body</option>',5)]),512),[[U,h.value]])]),e("div",null,[S(e("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>b.value=s),class:"input-1"},o[14]||(o[14]=[e("option",{value:"active"},"Active",-1),e("option",{value:"in_active"},"In Active",-1)]),512),[[U,b.value]])]),x(Ae,{modelValue:m.value,"onUpdate:modelValue":o[4]||(o[4]=s=>m.value=s),options:B.value,multiple:!1,label:"name","label-prefix":"employee_id",placeholder:"Select user"},{option:w(({option:s})=>[x(Ue,{user:s,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),e("div",{class:"btn-2",onClick:o[5]||(o[5]=s=>me())},"Search")]),k(_).isLoading?(i(),c("div",Je,[x(we)])):(i(),c("div",Ke,[F.value.length?O("",!0):(i(),c("div",Xe," User not found ")),(i(!0),c(D,null,E(F.value,(s,p)=>(i(),c("div",{key:p},[e("h2",Ge,f(p)+" ("+f(s.length)+")",1),e("div",Qe,[e("table",Ze,[o[17]||(o[17]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Finger ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Employee ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Joining Date"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Weekend"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(i(!0),c(D,null,E(s,(a,he)=>{var z,V,P,J,K,X,G,Q,Z,ee,te;return i(),c("tr",{key:a.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",et,f(he+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:H(a==null?void 0:a.name)},null,8,tt),e("td",{class:"border border-gray-300 px-2",innerHTML:H((z=a==null?void 0:a.designation)==null?void 0:z.title)},null,8,ot),e("td",at,f(a==null?void 0:a.device_user_id),1),e("td",st,f(a==null?void 0:a.employee_id),1),e("td",lt,f(a.joining_date),1),e("td",nt,f(a.role),1),e("td",it,[e("div",dt,[e("div",null,[(P=(V=a.current_shift)==null?void 0:V.shift)!=null&&P.name?(i(),c("span",rt,f(a.current_shift.shift.name),1)):(i(),c("span",ct,"Not Assigned"))]),e("button",{onClick:oe=>ye(a),title:a!=null&&a.current_shift?"Change Shift":"Assign Shift",class:j(["p-2 rounded-full transition hover:scale-110 focus:outline-none",a!=null&&a.current_shift?"bg-yellow-100 text-yellow-700":"bg-emerald-600 text-white"])},[e("i",{class:j(a!=null&&a.current_shift?"fas fa-pen":"fas fa-plus")},null,2)],10,pt)]),x(le,{name:"fade"},{default:w(()=>[$.value===a.id&&r.value?(i(),se(Fe,{key:0,isOpen:r.value,shifts:k(I),hasShift:a==null?void 0:a.current_shift,employee:{id:n.value.id,name:n.value.name},onClose:ve},null,8,["isOpen","shifts","hasShift","employee"])):O("",!0)]),_:2},1024)]),e("td",ft,[e("div",mt,[e("div",null,[(K=(J=a==null?void 0:a.assign_weekend)==null?void 0:J.weekends)!=null&&K.length?(i(),c("span",yt,f(a.assign_weekend.weekends.join(", ")),1)):(i(),c("span",ut,"Not Assigned"))]),e("button",{onClick:oe=>ue(a),title:(G=(X=a==null?void 0:a.assign_weekend)==null?void 0:X.weekends)!=null&&G.length?"Edit Weekend":"Assign Weekend",class:j(["p-2 rounded-full transition hover:scale-110 focus:outline-none",(Z=(Q=a==null?void 0:a.assign_weekend)==null?void 0:Q.weekends)!=null&&Z.length?"bg-yellow-100 text-yellow-700":"bg-emerald-600 text-white"])},[e("i",{class:j((te=(ee=a==null?void 0:a.assign_weekend)==null?void 0:ee.weekends)!=null&&te.length?"fas fa-pen":"fas fa-plus")},null,2)],10,vt)]),x(le,{name:"fade"},{default:w(()=>[$.value===a.id&&A.value?(i(),se(Ce,{key:0,isOpen:A.value,assign_weekend:a.assign_weekend,userId:a.id,onClose:o[6]||(o[6]=oe=>A.value=!1)},null,8,["isOpen","assign_weekend","userId"])):O("",!0)]),_:2},1024)]),e("td",_t,f(a.phone),1),e("td",ht,f(a.email||"নেই"),1),e("td",bt,[a.is_active?(i(),c("span",gt,"Active")):(i(),c("span",xt,"Inactive"))]),e("td",kt,[e("div",St,[x(g,{to:{name:"UserShow",params:{id:a.id},query:{company:k(l).query.company}},class:"btn-icon"},{default:w(()=>o[15]||(o[15]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[15]},1032,["to"]),x(g,{to:{name:"UserEdit",params:{id:a.id},query:{company:k(l).query.company}},class:"btn-icon"},{default:w(()=>o[16]||(o[16]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[16]},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{Ot as default};
