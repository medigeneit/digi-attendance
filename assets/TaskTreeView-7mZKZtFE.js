import{o as r,c as d,F as O,x as R,k as $,r as V,y as A,A as D,p as I,a as t,e as f,m as w,n as _,l as h,t as c,q as b,z as M}from"./index-D39fohVM.js";const U={class:"mt-3"},F={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(s,{emit:y}){const l=y;return(m,u)=>(r(),d("div",U,[(r(!0),d(O,null,R(s.childrenTasks,k=>(r(),$(ce,{key:k.id,task:k,class:"mb-3","hide-buttons":s.hideButtons,"tree-level":s.parentTreeLevel+1,onEditClick:x=>l("editClick",k.id),onAddClick:x=>l("addClick",k.id)},null,8,["task","hide-buttons","tree-level","onEditClick","onAddClick"]))),128))]))}},J={class:"flex w-full"},G={key:0,class:"border-l border-gray-200 last:border-l-0"},H={class:"items-start grid grid-cols-3"},K={class:""},Q={key:0,class:"text-sm text-gray-500 mt-2"},W={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},X={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},Y={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},Z={class:"flex items-start flex-wrap gap-3"},ee={class:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-medium text-gray-600"},te={class:"text-xs text-gray-700 mr-2"},se={class:"flex justify-end items-center gap-2"},le={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200"},ne={class:"text-sm"},ae={class:"mt-4"},re={class:"flex items-center"},ie={key:0,class:"fas fa-caret-down text-gray-400 group-hover:text-sky-400"},oe={key:1,class:"fas fa-caret-right text-gray-400 group-hover:text-sky-400"},de={key:0,class:"flex gap-2 ml-auto items-center text-xs"},ue={class:"ml-0"},ce={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0}},emits:["commentButtonClick","editClick","addClick"],setup(s,{emit:y}){const l=s,m=y,u=V([]),k=localStorage.getItem("sub_task_opened_list");if(k)try{u.value=JSON.parse(k)}catch{u.value=[]}const x=A({get:()=>u.value.includes(l.task.id),set:n=>{const e=u.value.includes(l.task.id);n&&!e?u.value.push(l.task.id):!n&&e&&(u.value=u.value.filter(a=>a!==l.task.id))}});D(u,n=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(n))},{deep:!0});const q=A(()=>{var n,e,a,i;return{"hover:underline hover:text-sky-400 cursor-pointer":((e=(n=l.task)==null?void 0:n.children_tasks)==null?void 0:e.length)>0,"cursor-default pointer-none":((i=(a=l.task)==null?void 0:a.children_tasks)==null?void 0:i.length)===0}}),j=n=>n.split(" ").map(e=>e[0]).join("").toUpperCase(),C=()=>{const n=v();let e,a,i;return n===100?(e="bg-green-50",a="bg-green-200",i="text-green-600 "):n<100&&(e="bg-red-50",a="bg-red-200",i="text-red-600 "),{container:e,bar:a,text:i}};function z(){l.task.children_tasks.length>0&&(x.value=!x.value)}function L(){if(l.task.children_tasks.length===0)return l.task.status==="COMPLETED"?1:0;const n=e=>{let a=0;for(let i=0;i<e.length;i++){const g=e[i];if(g.children_tasks.length===0)g.status==="COMPLETED"&&(a+=1);else{const p=g.children_tasks.length;n(g.children_tasks)===p&&(a+=1)}}return a};return n(l.task.children_tasks)}function v(){return l.task.children_tasks.length===0?l.task.status==="COMPLETED"?100:0:L()/l.task.children_tasks.length*100}return(n,e)=>{var i,g,p,T,B,E,S,N;const a=I("RouterLink");return r(),d("div",J,[s.treeLevel>0?(r(),d("div",G,e[4]||(e[4]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):f("",!0),t("div",{class:b(["flex-grow border rounded py-3 group px-3",{"bg-green-50 ":v()===100,"bg-gray-50":v()<100,"shadow-sm":s.treeLevel>0}])},[t("div",H,[t("div",K,[w(a,{to:{name:"TaskShow",params:{id:s.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:_(()=>[h(c(s.task.title),1)]),_:1},8,["to"]),(i=s.task)!=null&&i.requirement?(r(),d("p",Q," Requirement: "+c((p=(g=s.task)==null?void 0:g.requirement)==null?void 0:p.title),1)):f("",!0),t("div",W,[(T=s.task)!=null&&T.is_important?(r(),d("span",X,"IMPORTANT")):f("",!0),(B=s.task)!=null&&B.is_urgent?(r(),d("span",Y,"URGENT")):f("",!0)])]),t("div",Z,[(r(!0),d(O,null,R(s.task.users,(o,P)=>(r(),d("div",{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",key:P},[t("div",ee,c(j(o==null?void 0:o.name)),1),t("span",te,c(o.id)+" - "+c(o==null?void 0:o.name),1)]))),128))]),t("div",se,[t("span",le,c(s.task.status),1),t("div",ne,[t("div",{class:b(["rounded-full border py-0.5 text-xs relative overflow-hidden h-6",C().container]),style:{width:"180px"}},[t("div",{class:b(["z-10 absolute top-0 bottom-0",C().bar]),style:M(`width: ${v()}%`)},null,6),t("span",{class:b(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",C().text])},[t("span",null,[t("span",null,c(L()),1),e[5]||(e[5]=h(" / ")),t("span",null,c(s.task.children_tasks.length||1),1)])],2)],2)])])]),t("div",ae,[t("div",re,[t("div",{class:"flex gap-3 group items-center",onClick:z},[x.value?(r(),d("i",ie)):(r(),d("i",oe)),t("span",{class:b([q.value,"text-xs text-gray-500"])}," Sub Tasks ("+c((E=s.task.children_tasks)==null?void 0:E.length)+") ",3)]),s.hideButtons?f("",!0):(r(),d("div",de,[t("button",{onClick:e[0]||(e[0]=o=>m("editClick",s.task.id)),class:"btn-2 py-0.5 text-xs"},e[6]||(e[6]=[t("i",{class:"fas fa-edit"},null,-1),h(" Edit ")])),w(a,{to:{name:"TaskReports",params:{id:(S=s.task)==null?void 0:S.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:_(()=>e[7]||(e[7]=[t("i",{class:"far fa-file-alt"},null,-1),h(" Reports ")])),_:1},8,["to"]),w(a,{to:{name:"TaskUserAssign",params:{id:(N=s.task)==null?void 0:N.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:_(()=>e[8]||(e[8]=[t("i",{class:"fas fa-user-plus"},null,-1),h(" Assign Users ")])),_:1},8,["to"]),t("button",{class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2",onClick:e[1]||(e[1]=o=>m("addClick",l.task.id))},e[9]||(e[9]=[t("i",{class:"fas fa-plus"},null,-1),h(" Add Sub Task ")]))]))]),t("div",ue,[x.value?(r(),$(F,{key:0,childrenTasks:s.task.children_tasks,"hide-buttons":s.hideButtons,"parent-tree-level":s.treeLevel,onEditClick:e[2]||(e[2]=o=>m("editClick",o)),onAddClick:e[3]||(e[3]=o=>m("addClick",o))},null,8,["childrenTasks","hide-buttons","parent-tree-level"])):f("",!0)])])],2)])}}};export{ce as _};
