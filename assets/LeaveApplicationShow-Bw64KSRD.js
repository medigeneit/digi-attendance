import{_ as g}from"./ApprovalItem-CbHdPQBv.js";import{L as st}from"./LoaderView-Yl21KWhV.js";import{_ as at}from"./ShareComponent-ltYAolkc.js";import{g as lt,u as ot,f as nt,x as k,r as m,h as rt,c as r,o as n,a as e,j as it,d as y,b as i,t as l,F as w,e as j,k as c,s as R}from"./index-B5mbdBci.js";import{u as dt}from"./leave-application-Da2czHPX.js";import"./AcceptAndRejectHandler-Df0fC53L.js";const ut={class:"my-container max-w-3xl space-y-6"},ct={key:1,class:"card-bg p-4 md:p-8 print:text-black"},pt={class:"title-lg text-center"},bt={class:"text-center text-sm"},vt={class:"space-y-4"},mt={class:"grid md:grid-cols-2 print:grid-cols-2 gap-8"},yt={class:"text-sm"},gt={class:"pt-6"},ft={key:0},xt={key:1,class:"font-semibold"},_t={class:"flex justify-end gap-4"},ht={class:"table-auto border border-black bg-white text-xs"},kt={class:"border border-black px-2"},wt={class:"border border-black px-2"},Dt={class:"border border-black px-2"},At={class:"font-bold"},Lt={class:"border border-black px-2"},jt={class:"table-auto border border-black bg-white text-xs"},Rt={class:"border border-black"},Tt={colspan:"2",class:"border border-black px-2 w-32"},Bt={class:"border border-black px-2"},St={class:"border border-black px-2"},Ct={class:"font-bold"},Ft={class:"border border-black px-2"},Mt={class:"grid print:grid-cols-2 md:grid-cols-2 gap-1 text-sm list-none px-2"},Ut={class:"col-span-full"},Et={class:"text-sm"},Pt={class:"whitespace-pre-line"},Wt={class:"pt-8 grid grid-cols-2"},Nt={class:"text-sm"},It={class:"font-bold"},$t={class:"text-blue-700 print:text-black"},zt={class:"overflow-x-auto"},Gt={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},Ot={class:"border border-gray-500 px-4 py-0.5 text-left"},Vt={class:"border border-gray-500 px-4 py-0.5 text-left"},Ht={class:"border border-gray-500 px-4 py-0.5 text-center"},Jt={class:"border border-gray-500 px-4 py-0.5 text-center"},Yt={class:"border border-gray-500 px-4 py-0.5 text-center"},qt={class:"space-y-14"},Xt={class:"flex items-center gap-4 justify-center"},Zt={key:0},Kt={key:0,class:"text-xs text-slate-600"},Qt={class:"grid md:grid-cols-3 print:grid-cols-3 gap-4 text-sm items-end"},es={class:"flex justify-evenly text-sm items-end"},ts={class:"mt-10 print:hidden space-y-3"},ss={key:0,class:"border rounded-lg bg-white p-3 flex items-center gap-3"},as={class:"shrink-0"},ls=["src"],os={key:1,class:"h-16 w-16 grid place-items-center rounded-md border text-slate-500"},ns={class:"min-w-0 flex-1"},rs={class:"text-sm font-medium truncate"},is=["href"],ds={key:0,class:"flex gap-2"},us=["disabled"],cs=["disabled"],ps=["disabled"],bs=["accept"],vs={key:0,class:"mt-3 text-sm inline-flex items-center gap-2"},ms={key:2,class:"text-green-600 text-sm"},ys={key:3,class:"text-red-600 text-sm"},ze="JPG, PNG, WEBP, PDF",C=10,Ds={__name:"LeaveApplicationShow",setup(gs){const T=lt(),f=dt(),Ge=ot(),Oe=nt(),B=k(()=>Oe.params.id),F=m(!0),p=m(!1),x=m(""),_=m(""),D=m(null),A=m(!1),M=m(null),U=["image/jpeg","image/png","image/webp","application/pdf"],a=k(()=>f.leaveApplication),E=k(()=>{var s;return typeof((s=a.value)==null?void 0:s.attachment)=="string"&&a.value.attachment.length>0}),P=k(()=>{var s,t;return((s=a.value)==null?void 0:s.user_id)===((t=T==null?void 0:T.user)==null?void 0:t.id)});rt(async()=>{try{await f.fetchLeaveApplicationById(B.value)}catch(s){console.error("Failed to load leave application:",s)}finally{F.value=!1}});const Ve=()=>Ge.go(-1),He=()=>window.print(),W=s=>{if(!s)return"";const t=new Date(s),d=t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),b=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${d} , ${b}`},L=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",Je=s=>/\.(png|jpe?g|webp|gif)$/i.test(s||""),Ye=s=>{try{const t=new URL(s);return decodeURIComponent(t.pathname.split("/").pop()||"attachment")}catch{return(s||"").split("/").pop()||"attachment"}},S=s=>{x.value=s,_.value="",setTimeout(()=>x.value="",2500)},h=s=>{_.value=s,x.value="",setTimeout(()=>_.value="",3500)},N=k(()=>{const s=a.value;if(!s||!s.last_working_date||!s.resumption_date)return 0;const t=new Date(s.last_working_date),d=new Date(s.resumption_date);return Math.ceil((d-t)/(1e3*60*60*24))-1}),v=async()=>{await f.fetchLeaveApplicationById(B.value)},qe=s=>U.includes(s.type)?s.size/(1024*1024)>C?(h(`Max file size ${C} MB`),!1):!0:(h(`Only ${ze} allowed`),!1),I=async s=>{await f.uploadLeaveApplicationAttachment(B.value,{attachment:s}),await v()},$=async s=>{if(!(!s||!qe(s))){p.value=!0;try{const t=new FormData;t.append("file",s),t.append("folder","leave-application");const d=await f.fetchFileUpload(t);M.value=d==null?void 0:d.url,await I(M.value),S("Attachment uploaded")}catch(t){console.error("Upload failed:",t),h("Upload failed. Try again.")}finally{p.value=!1,D.value&&(D.value.value="")}}},Xe=async s=>{var d;const t=(d=s.target.files)==null?void 0:d[0];t&&await $(t)},Ze=s=>{s.preventDefault(),A.value=!0},Ke=s=>{s.preventDefault(),A.value=!1},Qe=async s=>{var d,b;s.preventDefault(),A.value=!1;const t=(b=(d=s.dataTransfer)==null?void 0:d.files)==null?void 0:b[0];t&&await $(t)},z=()=>{var s;return(s=D.value)==null?void 0:s.click()},et=async()=>{var s;try{await navigator.clipboard.writeText(((s=a.value)==null?void 0:s.attachment)||""),S("Link copied")}catch{h("Copy failed")}},tt=async()=>{if(E.value&&confirm("Remove current attachment?")){p.value=!0;try{await I(null),S("Attachment removed")}catch(s){console.error("Remove failed:",s),h("Failed to remove attachment")}finally{p.value=!1}}};return(s,t)=>{var d,b,G,O,V,H,J,Y,q,X,Z,K,Q,ee,te,se,ae,le,oe,ne,re,ie,de,ue,ce,pe,be,ve,me,ye,ge,fe,xe,_e,he,ke,we,De,Ae,Le,je,Re,Te,Be,Se,Ce,Fe,Me,Ue,Ee,Pe,We,Ne,Ie,$e;return n(),r("div",ut,[e("div",{class:"flex items-center justify-between gap-2 print:hidden"},[e("button",{class:"btn-3",onClick:Ve},t[0]||(t[0]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[2]||(t[2]=e("h1",{class:"title-md md:title-xl flex-wrap text-center"},"Leave Application",-1)),e("button",{class:"btn-2",onClick:He},t[1]||(t[1]=[e("i",{class:"far fa-print"},null,-1),i(" Print")]))]),F.value?(n(),it(st,{key:0})):(n(),r("div",ct,[e("div",null,[e("h1",pt,l((G=(b=(d=a.value)==null?void 0:d.user)==null?void 0:b.company)==null?void 0:G.name),1),e("p",bt,l((V=(O=a.value)==null?void 0:O.user)==null?void 0:V.company.address),1)]),e("div",vt,[e("div",mt,[e("div",null,[t[5]||(t[5]=e("p",null,"To",-1)),t[6]||(t[6]=e("p",{class:"font-bold"},"Managing Director",-1)),e("p",null,l((Y=(J=(H=a.value)==null?void 0:H.user)==null?void 0:J.company)==null?void 0:Y.name),1),e("p",yt,l((X=(q=a.value)==null?void 0:q.user)==null?void 0:X.company.address),1),e("p",gt,[t[3]||(t[3]=e("b",null,"Subject:",-1)),t[4]||(t[4]=i(" Leave Application for ")),(n(!0),r(w,null,j((Z=a.value)==null?void 0:Z.leave_types,(o,u)=>(n(),r(w,{key:u},[u&&o.days?(n(),r("span",ft,", ")):c("",!0),o.days?(n(),r("span",xt,l(o.type),1)):c("",!0)],64))),128))])]),e("div",_t,[e("div",null,[t[10]||(t[10]=e("h1",{class:"font-semibold"},"Summary",-1)),e("table",ht,[t[9]||(t[9]=e("thead",null,[e("tr",{class:"bg-gray-200 border border-black"},[e("th",{class:"border border-black px-2"},"Type"),e("th",{class:"border border-black px-2"},"Days")])],-1)),e("tbody",null,[(n(!0),r(w,null,j((K=a.value)==null?void 0:K.leave_types,(o,u)=>(n(),r("tr",{key:u,class:"border border-black"},[e("td",kt,l(o.type),1),e("td",wt,l(o.days),1)]))),128)),e("tr",null,[t[7]||(t[7]=e("td",{class:"border-black px-2"},"WL/GHD",-1)),e("td",Dt,l(N.value-((ee=(Q=a.value)==null?void 0:Q.leave_days)==null?void 0:ee.length)),1)]),e("tr",At,[t[8]||(t[8]=e("td",{class:"border border-black px-2"},"Total",-1)),e("td",Lt,l(N.value),1)])])])]),e("div",null,[t[14]||(t[14]=e("h1",{class:"font-semibold"},"Last Leave",-1)),e("table",jt,[e("thead",null,[t[11]||(t[11]=e("tr",{class:"bg-gray-200 border border-black"},[e("th",{colspan:"2",class:"border border-black px-2"},"Date")],-1)),e("tr",Rt,[e("td",Tt,l(L((se=(te=a.value)==null?void 0:te.last_leave)==null?void 0:se.date)||"N/A"),1)]),t[12]||(t[12]=e("tr",{class:"bg-gray-200 border border-black"},[e("th",{class:"border border-black px-2"},"Type"),e("th",{class:"border border-black px-2"},"Days")],-1))]),e("tbody",null,[(n(!0),r(w,null,j((le=(ae=a.value)==null?void 0:ae.last_leave)==null?void 0:le.types,(o,u)=>(n(),r("tr",{key:u,class:"border border-black"},[e("td",Bt,l(o==null?void 0:o.type),1),e("td",St,l(o==null?void 0:o.days),1)]))),128)),e("tr",Ct,[t[13]||(t[13]=e("td",{class:"border border-black px-2"},"Total",-1)),e("td",Ft,l((ne=(oe=a.value)==null?void 0:oe.last_leave)!=null&&ne.types?a.value.last_leave.types.reduce((o,u)=>o+u.days,0):0),1)])])])])])]),e("div",null,[t[22]||(t[22]=e("h3",{class:"font-bold"},"Leave Details:",-1)),e("div",Mt,[e("li",null,[t[15]||(t[15]=e("strong",null,"Leave Days:",-1)),i(" "+l((re=a.value)==null?void 0:re.leave_period),1)]),e("li",null,[t[16]||(t[16]=e("strong",null,"Total Days:",-1)),i(" "+l((ie=a.value)==null?void 0:ie.total_leave_days),1)]),e("li",null,[t[17]||(t[17]=e("strong",null,"Weekends:",-1)),i(" "+l((pe=(ce=(ue=(de=a.value)==null?void 0:de.user)==null?void 0:ue.assign_weekend)==null?void 0:ce.weekends)==null?void 0:pe.join(", ")),1)]),e("li",null,[t[18]||(t[18]=e("strong",null,"Last Working Date:",-1)),i(" "+l(L((be=a.value)==null?void 0:be.last_working_date)),1)]),e("li",null,[t[19]||(t[19]=e("strong",null,"Resumption Date:",-1)),i(" "+l(L((ve=a.value)==null?void 0:ve.resumption_date)),1)]),e("li",null,[t[20]||(t[20]=e("strong",null,"Create Date:",-1)),i(" "+l(W((me=a.value)==null?void 0:me.created_at)),1)]),e("li",Ut,[t[21]||(t[21]=e("strong",null,"Reason: ",-1)),i(l(((ye=a.value)==null?void 0:ye.reason)||"No reason provided"),1)])])]),e("div",Et,[e("p",Pt,[t[23]||(t[23]=e("strong",null,"Works in Hand: ",-1)),i(l(((ge=a.value)==null?void 0:ge.works_in_hand)||"No details provided"),1)])]),e("div",Wt,[e("div",Nt,[t[29]||(t[29]=e("hr",{class:"w-44 border-black hidden print:block my-1"},null,-1)),e("p",It,[t[24]||(t[24]=e("strong",null,"Applicant: ",-1)),e("span",$t,l((xe=(fe=a.value)==null?void 0:fe.user)==null?void 0:xe.name),1)]),e("p",null,[t[25]||(t[25]=e("strong",null,"Designation:",-1)),i(" "+l((ke=(he=(_e=a.value)==null?void 0:_e.user)==null?void 0:he.designation)==null?void 0:ke.title),1)]),e("p",null,[t[26]||(t[26]=e("strong",null,"Department:",-1)),i(" "+l((Ae=(De=(we=a.value)==null?void 0:we.user)==null?void 0:De.department)==null?void 0:Ae.name),1)]),e("p",null,[t[27]||(t[27]=e("strong",null,"Phone:",-1)),i(" "+l((je=(Le=a.value)==null?void 0:Le.user)==null?void 0:je.phone),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"Joining Date:",-1)),i(" "+l(L((Te=(Re=a.value)==null?void 0:Re.user)==null?void 0:Te.joining_date)),1)])]),y(g,{application:a.value,type:"leave_applications",item:"handover",onAction:v},null,8,["application"])]),e("div",null,[t[31]||(t[31]=e("h1",{class:"font-bold"},"Leave Balance",-1)),e("div",zt,[e("table",Gt,[t[30]||(t[30]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-500 px-4 py-0.5 text-left"},"Leave Type"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-left"},"Year"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Total Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Used Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Pending Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Remaining Days")])],-1)),e("tbody",null,[(n(!0),r(w,null,j((Be=a.value)==null?void 0:Be.leave_balance,(o,u)=>(n(),r("tr",{key:u,class:"hover:bg-blue-200"},[e("td",Ot,l(o.name),1),e("td",Vt,l(o==null?void 0:o.year),1),e("td",Ht,l(o==null?void 0:o.annual_quota),1),e("td",Jt,l(o.used_days),1),e("td",Yt,l(o.pending_days),1),e("td",{class:R(["border border-gray-500 px-4 py-0.5 text-center",{"text-green-600 font-bold":o.remaining_days>0,"text-red-600 font-bold":o.remaining_days===0}])},l(o.remaining_days),3)]))),128))])])])])]),e("div",qt,[e("div",Xt,[t[32]||(t[32]=e("span",{class:"text-sm font-semibold"},"Leave Application Status : ",-1)),e("span",{class:R(["inline-flex items-center gap-2 px-3 py-1.5 font-semibold rounded-full text-xs ring-1",{"bg-yellow-50  text-yellow-800 ring-yellow-200":((Se=a.value)==null?void 0:Se.status)==="Pending","bg-green-50 text-green-700 ring-green-200":((Ce=a.value)==null?void 0:Ce.status)==="Approved","bg-red-50 text-red-700 ring-red-200":((Fe=a.value)==null?void 0:Fe.status)==="Rejected"}])},[e("span",{class:R(["h-1.5 w-1.5 rounded-full",{"bg-yellow-500":((Me=a.value)==null?void 0:Me.status)==="Pending","bg-green-600":((Ue=a.value)==null?void 0:Ue.status)==="Approved","bg-red-600":((Ee=a.value)==null?void 0:Ee.status)==="Rejected"}])},null,2),i(" "+l(((Pe=a.value)==null?void 0:Pe.status)||"N/A"),1)],2)]),((We=a.value)==null?void 0:We.status)==="Rejected"?(n(),r("div",Zt,[e("p",null,[t[33]||(t[33]=e("b",null,"Rejected by: ",-1)),i(" "+l((Ie=(Ne=a.value)==null?void 0:Ne.rejected_by_user)==null?void 0:Ie.name),1)]),e("p",null,[t[34]||(t[34]=e("b",null,"Rejection Reason: ",-1)),i(" "+l(a.value.rejection_reason),1)]),($e=a.value)!=null&&$e.rejected_at?(n(),r("p",Kt,[t[35]||(t[35]=e("i",{class:"far fa-clock"},null,-1)),i(" "+l(W(a.value.rejected_at)),1)])):c("",!0)])):c("",!0),e("div",Qt,[y(g,{application:a.value,type:"leave_applications",item:"in_charge",onAction:v},null,8,["application"]),y(g,{application:a.value,type:"leave_applications",item:"coordinator",onAction:v},null,8,["application"]),y(g,{application:a.value,type:"leave_applications",item:"operational_admin",onAction:v},null,8,["application"])]),e("div",es,[y(g,{application:a.value,type:"leave_applications",item:"recommend_by",onAction:v},null,8,["application"]),y(g,{application:a.value,type:"leave_applications",item:"approved_by",onAction:v},null,8,["application"])])])])),e("section",ts,[E.value?(n(),r("div",ss,[e("div",as,[Je(a.value.attachment)?(n(),r("img",{key:0,src:a.value.attachment,alt:"Attachment preview",class:"h-16 w-16 object-cover rounded-md border"},null,8,ls)):(n(),r("div",os,t[36]||(t[36]=[e("i",{class:"far fa-file text-2xl"},null,-1)])))]),e("div",ns,[e("p",rs,l(Ye(a.value.attachment)),1),e("a",{href:a.value.attachment,target:"_blank",class:"text-blue-600 underline text-xs"},"Open link",8,is)]),P.value?(n(),r("div",ds,[e("button",{class:"px-3 py-1.5 rounded-md border text-sm",onClick:et,disabled:p.value},"Copy link",8,us),e("button",{class:"px-3 py-1.5 rounded-md border text-sm",onClick:z,disabled:p.value},"Replace",8,cs),e("button",{class:"px-3 py-1.5 rounded-md border text-sm text-red-600",onClick:tt,disabled:p.value},"Remove",8,ps)])):c("",!0)])):c("",!0),P.value?(n(),r("div",{key:1,class:R(["rounded-xl border-2 border-dashed p-6 transition grid place-items-center text-center",[A.value?"border-blue-500 bg-blue-50":"border-slate-300 hover:border-slate-400",p.value?"opacity-60 pointer-events-none":""]]),onDragover:Ze,onDragleave:Ke,onDrop:Qe},[e("div",{class:"space-y-2"},[t[38]||(t[38]=e("i",{class:"far fa-cloud-upload-alt text-3xl"},null,-1)),e("p",{class:"text-sm text-slate-600"},[t[37]||(t[37]=i(" Drag & drop your file here, or ")),e("button",{class:"text-blue-700 underline font-medium",type:"button",onClick:z},"browse")]),e("p",{class:"text-xs text-slate-500"}," Allowed: "+l(ze)+" • Max "+l(C)+" MB ")]),e("input",{ref_key:"fileInput",ref:D,class:"hidden",type:"file",accept:U.join(","),onChange:Xe},null,40,bs),p.value?(n(),r("div",vs,t[39]||(t[39]=[e("i",{class:"far fa-circle-notch fa-spin"},null,-1),i(" Uploading… ")]))):c("",!0)],34)):c("",!0),x.value?(n(),r("p",ms,l(x.value),1)):c("",!0),_.value?(n(),r("p",ys,l(_.value),1)):c("",!0)]),y(at)])}}};export{Ds as default};
