import{N as zt,j as Ot,u as Gt,r as y,y as Jt,b as Kt,c as n,a as t,l as r,k as Qt,t as l,h as p,e as i,q as Xt,m as Dt,n as Yt,d as $t,v as It,F as Zt,f as es,o,g as ts}from"./index-B7En1lXJ.js";import{L as ss}from"./LoaderView-zFXZN7M5.js";import{_ as ls}from"./ScreenshotCapture-CIi2hpwD.js";import{_ as as}from"./ShareComponent-PEgGT2FG.js";import{u as os}from"./short-leave-BVo28dGx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ns={class:"my-container max-w-3xl space-y-6"},rs={key:1,class:"bg-white rounded space-y-2 p-4 md:p-8",id:"leave-application"},is={class:"flex justify-end"},us={class:"font-medium"},ds={class:"gap-y-1"},vs={class:"gap-y-1"},ps={class:""},cs={class:"grid md:grid-cols-2"},ms={class:"grid md:grid-cols-2 gap-4 pt-10 items-center"},_s={key:0,class:"print:hidden"},ys={class:"text-xs"},fs={class:"flex gap-2"},bs={class:"font-semibold text-sm"},gs={key:0,class:"text-green-600 print:text-black"},hs={key:1,class:"pl-2 text-yellow-700"},xs={class:"text-xs text-gray-500"},ks={class:"text-center"},ws={class:"title-md"},As={key:0},js={class:"grid grid-cols-2 text-sm md:text-base md:grid-cols-3 md:gap-4"},Cs={class:"pt-10"},Ss={key:0},Ls={key:1},Ns={key:2,class:"print:hidden"},Rs={class:"text-xs text-blue-600"},Fs={class:"flex gap-4"},Bs={class:"font-semibold text-sm"},Ds={key:0,class:"text-green-600"},$s={key:1,class:"pl-2 text-yellow-700"},Is={class:"text-xs text-gray-500"},Vs={class:"pt-10"},Ms={key:0},Ps={key:1},Ts={key:2,class:"print:hidden"},Us={class:"text-xs text-blue-600"},qs={class:"flex gap-4"},Es={class:"font-semibold text-sm"},Ws={key:0,class:"text-green-600"},Hs={key:1,class:"pl-2 text-yellow-700"},zs={class:"text-xs text-gray-500"},Os={class:"pt-10"},Gs={key:0},Js={key:1},Ks={key:2,class:"print:hidden"},Qs={class:"text-xs text-blue-600"},Xs={class:"flex gap-4"},Ys={class:"font-semibold text-sm"},Zs={key:0,class:"text-green-600"},el={key:1,class:"pl-2 text-yellow-700"},tl={class:"text-xs text-gray-500"},sl={key:0,class:"mb-2"},ll=["href"],al={key:0,class:"modal-bg"},ol={class:"modal-card"},nl={class:"flex justify-end gap-2 mt-4"},rl={key:1,class:"modal-bg"},il={class:"modal-card"},ul={class:"flex justify-end gap-2 mt-4"},fl={__name:"ShortLeaveShow",setup(dl){const f=zt(),A=Ot(),Vt=ts(),c=es(),d=os(),b=Gt(),j=y(null),C=y(!0),g=y(!1),h=y(""),x=y(!1),m=y(""),s=Jt(()=>d.shortLeave);Kt(async()=>{const{id:a}=c.params;try{await d.fetchShortLeaveById(a)}catch(e){console.error("Failed to fetch short leave details:",e)}finally{C.value=!1}});let S=y("");function k(a){S.value=a,x.value=!0}async function Mt(){Ut(S.value),x.value=!1}const Pt=async()=>{try{await d.rejectShortLeave(c.params.id,h.value),alert("Short leave rejected successfully!"),g.value=!1,h.value="",await d.fetchShortLeaveById(c.params.id),N()}catch(a){console.error("Failed to reject short leave:",a),alert("Failed to reject short leave.")}},Tt=async()=>{try{const a={attachment:j.value};await d.uploadShortLeaveAttachment(c.params.id,a)}catch(a){console.error("Failed to reject short leave:",a),alert("Failed to reject short leave.")}},w=()=>{g.value=!0},Ut=async a=>{try{const{id:e}=c.params;console.log(a,e,m.value),a==="handover"&&await d.handoverAccept({id:e,note:m.value}),a==="inCharge"&&await d.inChargeAccept({id:e,note:m.value}),a==="recommend"&&await d.recommendByAccept({id:e,note:m.value}),a==="approve"&&await d.approvedByAccept({id:e,note:m.value}),alert(`${a} accepted successfully!`),await d.fetchShortLeaveById(e),N()}catch(e){console.error(`Failed to accept ${a}:`,e),alert(`Failed to accept ${a}.`)}},qt=()=>Vt.go(-1);function Et(){window.print()}const Wt=async a=>{const e=a.target.files[0];if(e){const _=new FormData;_.append("file",e);const u=await d.fetchFileUpload(_);j.value=u==null?void 0:u.url,u!=null&&u.url?(Tt(),A.success("File uploaded successfully!")):A.error("Failed to upload file!")}},Ht=a=>new Date(a).toISOString().slice(0,10),L=a=>{if(!a)return"N/A";const[e,_]=a.split(":").map(Number),u=new Date;return u.setHours(e,_),u.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};async function N(){c.query.notifyId&&await f.markAsRead(c.query.notifyId)}return(a,e)=>{var _,u,R,F,B,D,$,I,V,M,P,T,U,q,E,W,H,z,O,G,J,K,Q,X,Y,Z,ee,te,se,le,ae,oe,ne,re,ie,ue,de,ve,pe,ce,me,_e,ye,fe,be,ge,he,xe,ke,we,Ae,je,Ce,Se,Le,Ne,Re,Fe,Be,De,$e,Ie,Ve,Me,Pe,Te,Ue,qe,Ee,We,He,ze,Oe,Ge,Je,Ke,Qe,Xe,Ye,Ze,et,tt,st,lt,at,ot,nt,rt,it,ut,dt,vt,pt,ct,mt,_t,yt,ft,bt,gt,ht,xt,kt,wt,At,jt,Ct,St,Lt,Nt,Rt,Ft,Bt;return o(),n(Zt,null,[t("div",ns,[t("div",{class:"flex items-center justify-between gap-2 print:hidden"},[t("button",{class:"btn-3",onClick:qt},e[8]||(e[8]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[10]||(e[10]=t("h1",{class:"title-lg flex-wrap text-center"},"Short Leave Details",-1)),t("div",null,[t("button",{class:"btn-2",onClick:Et},e[9]||(e[9]=[t("i",{class:"far fa-print"},null,-1),r(" Print ")]))])]),C.value?(o(),Qt(ss,{key:0})):(o(),n("div",rs,[e[43]||(e[43]=t("div",null,[t("h1",{class:"title-lg text-center"},"Short Leave Application")],-1)),t("div",is,[t("div",null,"Date: "+l(Ht((_=s.value)==null?void 0:_.created_at)),1)]),t("div",null,[t("p",us,[e[11]||(e[11]=r(" Name: ")),t("b",null,l((R=(u=s.value)==null?void 0:u.user)==null?void 0:R.name),1)]),t("div",ds,[t("p",null,[e[12]||(e[12]=r(" Designation: ")),t("b",null,l((D=(B=(F=s.value)==null?void 0:F.user)==null?void 0:B.designation)==null?void 0:D.title),1)])]),t("div",vs,[t("p",null,[e[13]||(e[13]=r(" Department: ")),t("b",null,l((V=(I=($=s.value)==null?void 0:$.user)==null?void 0:I.company)==null?void 0:V.name),1)])])]),t("div",ps,[t("div",cs,[t("div",null,[e[14]||(e[14]=t("b",null,"From:",-1)),r(" "+l((M=s.value)!=null&&M.start_time?L((P=s.value)==null?void 0:P.start_time):""),1)]),t("div",null,[e[15]||(e[15]=t("b",null,"To:",-1)),r(" "+l((T=s.value)!=null&&T.end_time?L((U=s.value)==null?void 0:U.end_time):""),1)]),t("div",null,[e[16]||(e[16]=t("b",null,"Short Leave Date:",-1)),r(" "+l((q=s.value)==null?void 0:q.date),1)]),t("div",null,[e[17]||(e[17]=t("b",null,"Total Minutes:",-1)),r(" "+l((E=s.value)==null?void 0:E.total_minutes),1)])]),t("div",ms,[t("div",null,[e[18]||(e[18]=t("b",null,"Reason:",-1)),r(" "+l(((W=s.value)==null?void 0:W.reason)||"N/A"),1)]),t("div",null,[t("p",null,l(((z=(H=s.value)==null?void 0:H.handover_user)==null?void 0:z.name)||"Not assigned"),1),(O=p(f).approvalPermissions)!=null&&O.allow_handover&&!((G=s.value)!=null&&G.status)&&((J=s.value)==null?void 0:J.handover_user_id)===((Q=(K=p(b))==null?void 0:K.user)==null?void 0:Q.id)?(o(),n("div",_s,[t("p",ys,[r(l((Y=(X=s.value)==null?void 0:X.user)==null?void 0:Y.name)+" has assigned you for his handover. ",1),e[19]||(e[19]=t("br",null,null,-1)),e[20]||(e[20]=r(" Do you agree? "))]),t("div",fs,[t("button",{class:"font-bold text-lg text-green-600 px-2",onClick:e[0]||(e[0]=v=>k("handover"))}," ✔ "),e[21]||(e[21]=t("button",{class:"px-2"},"❌",-1))])])):i("",!0),e[24]||(e[24]=t("hr",{class:"w-44 border-black mt-1"},null,-1)),t("h4",bs,[e[23]||(e[23]=r(" Handover ")),(Z=s.value)!=null&&Z.handover_user_id&&((ee=s.value)!=null&&ee.status)?(o(),n("span",gs," (✔) ")):i("",!0),(te=s.value)!=null&&te.handover_user_id&&!((se=s.value)!=null&&se.status)?(o(),n("span",hs,e[22]||(e[22]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)]),t("p",xs,l((le=s.value)==null?void 0:le.handover_note),1)])])]),e[44]||(e[44]=t("hr",null,null,-1)),t("div",ks,[t("h3",ws,[e[25]||(e[25]=r(" Approvals ")),t("span",{class:Xt({"text-yellow-500":((ae=s.value)==null?void 0:ae.status)==="Pending","text-green-500":((oe=s.value)==null?void 0:oe.status)==="Approved","text-red-500":((ne=s.value)==null?void 0:ne.status)==="Rejected"})}," ("+l(((re=s.value)==null?void 0:re.status)||"N/A")+") ",3)]),((ie=s.value)==null?void 0:ie.status)==="Rejected"?(o(),n("div",As,[t("div",null,[e[26]||(e[26]=t("b",null,"Rejected By:",-1)),r(" "+l(((de=(ue=s.value)==null?void 0:ue.rejected_by_user)==null?void 0:de.name)||"N/A"),1)]),t("div",null,[e[27]||(e[27]=t("b",null,"Rejection Reason:",-1)),r(" "+l(((ve=s.value)==null?void 0:ve.rejection_reason)||"N/A"),1)])])):i("",!0)]),t("div",js,[t("div",Cs,[(pe=s.value)!=null&&pe.in_charge_user?(o(),n("p",Ss,l(((me=(ce=s.value)==null?void 0:ce.in_charge_user)==null?void 0:me.name)||""),1)):(o(),n("p",Ls,l(((be=(fe=(ye=(_e=s.value)==null?void 0:_e.user)==null?void 0:ye.other_approval)==null?void 0:fe.in_charge_user)==null?void 0:be.name)||"N/A"),1)),(ge=p(f).approvalPermissions)!=null&&ge.allow_in_charge&&((he=s.value)==null?void 0:he.status)!=="Rejected"&&((xe=s.value)==null?void 0:xe.status)!=="Approved"&&!((ke=s.value)!=null&&ke.in_charge_user_id)&&((je=(Ae=(we=s.value)==null?void 0:we.user)==null?void 0:Ae.other_approval)==null?void 0:je.in_charge_user_id)===((Se=(Ce=p(b))==null?void 0:Ce.user)==null?void 0:Se.id)?(o(),n("div",Ns,[t("p",Rs,[r(l((Ne=(Le=s.value)==null?void 0:Le.user)==null?void 0:Ne.name)+" has submitted an application. ",1),e[28]||(e[28]=t("br",null,null,-1)),e[29]||(e[29]=r(" Will you forward it? "))]),t("div",Fs,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[1]||(e[1]=v=>k("inCharge"))}," ✔ "),t("button",{class:"",onClick:w},"❌")])])):i("",!0),e[32]||(e[32]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",Bs,[e[31]||(e[31]=r(" In-Charge ")),(Re=s.value)!=null&&Re.in_charge_user_id?(o(),n("span",Ds,"(✔)")):i("",!0),!((Fe=s.value)!=null&&Fe.in_charge_user_id)&&(($e=(De=(Be=s.value)==null?void 0:Be.user)==null?void 0:De.other_approval)!=null&&$e.in_charge_user)?(o(),n("span",$s,e[30]||(e[30]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)]),t("p",Is,l((Ie=s.value)==null?void 0:Ie.in_charge_note),1)]),t("div",Vs,[(Ve=s.value)!=null&&Ve.recommend_by_user?(o(),n("p",Ms,l(((Pe=(Me=s.value)==null?void 0:Me.recommend_by_user)==null?void 0:Pe.name)||""),1)):(o(),n("p",Ps,l(((Ee=(qe=(Ue=(Te=s.value)==null?void 0:Te.user)==null?void 0:Ue.other_approval)==null?void 0:qe.recommend_by_user)==null?void 0:Ee.name)||"N/A"),1)),(We=p(f).approvalPermissions)!=null&&We.allow_recommend_by&&((He=s.value)==null?void 0:He.status)!=="Rejected"&&((ze=s.value)==null?void 0:ze.status)!=="Approved"&&!((Oe=s.value)!=null&&Oe.recommend_by_user_id)&&((Ke=(Je=(Ge=s.value)==null?void 0:Ge.user)==null?void 0:Je.other_approval)==null?void 0:Ke.recommend_by_user_id)===((Xe=(Qe=p(b))==null?void 0:Qe.user)==null?void 0:Xe.id)?(o(),n("div",Ts,[t("p",Us,[r(l((Ze=(Ye=s.value)==null?void 0:Ye.user)==null?void 0:Ze.name)+" has submitted an application.",1),e[33]||(e[33]=t("br",null,null,-1)),e[34]||(e[34]=r(" Will you recommend it? "))]),t("div",qs,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[2]||(e[2]=v=>k("recommend"))}," ✔ "),t("button",{class:"",onClick:w},"❌")])])):i("",!0),e[37]||(e[37]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",Es,[e[36]||(e[36]=r(" Recommend By ")),(et=s.value)!=null&&et.recommend_by_user_id?(o(),n("span",Ws,"(✔)")):i("",!0),!((tt=s.value)!=null&&tt.recommend_by_user_id)&&((at=(lt=(st=s.value)==null?void 0:st.user)==null?void 0:lt.other_approval)!=null&&at.recommend_by_user)?(o(),n("span",Hs,e[35]||(e[35]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)]),t("p",zs,l((ot=s.value)==null?void 0:ot.recommend_by_note),1)]),t("div",Os,[(nt=s.value)!=null&&nt.approved_by_user?(o(),n("p",Gs,l(((it=(rt=s.value)==null?void 0:rt.approved_by_user)==null?void 0:it.name)||""),1)):(o(),n("p",Js,l(((pt=(vt=(dt=(ut=s.value)==null?void 0:ut.user)==null?void 0:dt.other_approval)==null?void 0:vt.approved_by_user)==null?void 0:pt.name)||"N/A"),1)),(ct=p(f).approvalPermissions)!=null&&ct.allow_approved_by&&((mt=s.value)==null?void 0:mt.status)!=="Rejected"&&((_t=s.value)==null?void 0:_t.status)!=="Approved"&&!((yt=s.value)!=null&&yt.approved_by_user_id)&&((gt=(bt=(ft=s.value)==null?void 0:ft.user)==null?void 0:bt.other_approval)==null?void 0:gt.approved_by_user_id)===((xt=(ht=p(b))==null?void 0:ht.user)==null?void 0:xt.id)?(o(),n("div",Ks,[t("p",Qs,[r(l((wt=(kt=s.value)==null?void 0:kt.user)==null?void 0:wt.name)+" has submitted an application.",1),e[38]||(e[38]=t("br",null,null,-1)),e[39]||(e[39]=r(" Will you accept it? "))]),t("div",Xs,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[3]||(e[3]=v=>k("approve"))}," ✔ "),t("button",{class:"",onClick:w},"❌")])])):i("",!0),e[42]||(e[42]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",Ys,[e[41]||(e[41]=r(" Approved By ")),(At=s.value)!=null&&At.approved_by_user_id?(o(),n("span",Zs,"(✔)")):i("",!0),!((jt=s.value)!=null&&jt.approved_by_user_id)&&((Lt=(St=(Ct=s.value)==null?void 0:Ct.user)==null?void 0:St.other_approval)!=null&&Lt.approved_by_user)?(o(),n("span",el,e[40]||(e[40]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)]),t("p",tl,l((Nt=s.value)==null?void 0:Nt.approved_by_note),1)])])])),t("div",null,[t("div",null,[e[45]||(e[45]=t("label",null,"Attachment",-1)),(Rt=s.value)!=null&&Rt.attachment&&typeof((Ft=s.value)==null?void 0:Ft.attachment)=="string"?(o(),n("div",sl,[t("a",{href:(Bt=s.value)==null?void 0:Bt.attachment,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,ll)])):i("",!0),t("input",{type:"file",onChange:Wt,class:"w-full p-2 border rounded"},null,32)])]),Dt(as,null,{default:Yt(()=>[Dt(ls,{targetId:"leave-application",platform:"whatsapp"})]),_:1})]),x.value?(o(),n("div",al,[t("div",ol,[e[46]||(e[46]=t("h3",{class:"title-lg"},"Accept Application",-1)),$t(t("input",{"onUpdate:modelValue":e[4]||(e[4]=v=>m.value=v),rows:"4",placeholder:"Enter rejection reason...",class:"w-full border rounded-lg p-2 text-gray-700"},null,512),[[It,m.value]]),t("div",nl,[t("button",{class:"btn-3",onClick:e[5]||(e[5]=v=>x.value=!1)},"Cancel"),t("button",{class:"btn-2 bg-red-500 text-white",onClick:Mt},"Confirm")])])])):i("",!0),g.value?(o(),n("div",rl,[t("div",il,[e[47]||(e[47]=t("h3",{class:"title-lg"},"Reject Short Leave",-1)),$t(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=v=>h.value=v),rows:"4",placeholder:"Enter rejection reason...",class:"w-full border rounded-lg p-2 text-gray-700"},null,512),[[It,h.value]]),t("div",ul,[t("button",{class:"btn-3",onClick:e[7]||(e[7]=v=>g.value=!1)},"Cancel"),t("button",{class:"btn-2 bg-red-500 text-white",onClick:Pt},"Confirm")])])])):i("",!0)],64)}}};export{fl as default};
