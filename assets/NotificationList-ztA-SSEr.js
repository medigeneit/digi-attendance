import{u as C,N as q,s as L,r as h,b as I,x as E,o as s,c as _,d as B,v as O,a as r,e as c,t as m,h as b,F as K,q as P,p as Q,j as A,m as R,g as W,f as X,n as Y}from"./index-ttz_00yE.js";import{u as Z}from"./leave-application-BCiabvVF.js";import{u as M}from"./exchange-B6kkgbhz.js";import{u as ee}from"./short-leave-DdefJtNi.js";const ae={key:0,class:"text-center space-y-2 print:hidden"},te={key:0,class:"mt-2"},oe={class:"flex justify-end gap-2 pt-2"},ne={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(j){const f=C(),p=q(),y=M(),{user:x}=L(f),k=j,t=h(null);I(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=h(!1),l=h(""),S=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.handoverAccept(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.inChargeAccept(a),await e()),alert("In-Charge approved!")}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.recommendByAccept(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure to final approval?")&&(await y.approvedByAccept(a),await e())}}],o=E(()=>S.find(a=>{var n,d,g,w;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((g=t.value)!=null&&g[a.approved_field])&&((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id:!1})),i=()=>{u.value&&l.value?(v(),u.value=!1):u.value=!0};async function v(){try{await y.rejectExchange(t.value.id,l.value),alert("Exchange application rejected!"),l.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await p.markAsRead(k.notificationId)}return(a,n)=>o.value&&t.value?(s(),_("div",ae,[u.value?(s(),_("div",te,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>l.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,l.value]])])):c("",!0),r("div",oe,[r("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))}," Approve "),r("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:i}," Reject ")])])):c("",!0)}},re={key:0,class:"text-center space-y-2 print:hidden"},se={key:0,class:"mt-2"},ie={class:"flex justify-end gap-2 pt-2"},G={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(j){const f=C(),p=Z(),y=q(),{user:x}=L(f),k=j,t=h(null);I(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=h(!1),l=h(""),S=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptHandover(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptInCharge(a),await e())}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptCoordinator(a),await e())}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptOperationalAdmin(a),await e())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptRecommendBy(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptApprovedBy(a),await e())}}],o=E(()=>S.find(a=>{var g,w,$,N;if(!t.value)return!1;if(a.key==="handover")return a.condition();const n=!!((g=t.value)!=null&&g[a.approved_field]),d=((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id;return(($=t.value)==null?void 0:$.status)!=="Rejected"&&((N=t.value)==null?void 0:N.status)!=="Approved"&&!n&&d})),i=()=>{u.value&&l.value?(v(),u.value=!1):u.value=!0};async function v(){try{await p.rejectLeaveApplication(t.value.id,{rejection_reason:l.value}),alert("Application rejected!"),l.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await y.markAsRead(k.notificationId)}return(a,n)=>o.value&&t.value?(s(),_("div",re,[u.value?(s(),_("div",se,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>l.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,l.value]])])):c("",!0),r("div",ie,[r("button",{class:"btn-2",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))},"Approve"),r("button",{class:"btn-1",onClick:i},"Reject")])])):c("",!0)}},ce={key:0,class:"text-center space-y-2 print:hidden"},le={key:0,class:"mt-2"},de={class:"flex justify-end gap-2 pt-2"},pe={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(j){const f=C(),p=ee(),y=q(),{user:x}=L(f),k=j,t=h(null);I(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=h(!1),l=h(""),S=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.handoverAccept(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.inChargeAccept(a),await e())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.recommendByAccept(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.approvedByAccept(a),await e())}}],o=E(()=>S.find(a=>{var n,d,g,w;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((g=t.value)!=null&&g[a.approved_field])&&((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id:!1})),i=()=>{u.value&&l.value?(v(),u.value=!1):u.value=!0};async function v(){try{await p.rejectShortLeave(t.value.id,l.value),alert("Application rejected!"),l.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await y.markAsRead(k.notificationId)}return(a,n)=>o.value&&t.value?(s(),_("div",ce,[u.value?(s(),_("div",le,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>l.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,l.value]])])):c("",!0),r("div",de,[u.value?c("",!0):(s(),_("button",{key:0,class:"btn-2",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))}," Approve ")),r("button",{class:"btn-1",onClick:i},m(u.value?"Submit":"Reject"),1)])])):c("",!0)}},ue={class:"space-y-6 px-4 py-4"},_e={class:"text-2xl font-semibold capitalize text-gray-700"},ve={key:0,class:"space-y-4"},fe={class:"flex items-start gap-4"},ye={class:"text-2xl text-blue-500"},he={class:"flex-1"},ge={class:"text-gray-800 font-medium"},we={key:0,class:"text-gray-800 font-medium"},be={class:"text-red-600 text-sm font-semibold"},xe={key:1,class:"text-xs text-gray-400"},ke={key:0,class:"grid gap-1"},Ae={class:"flex items-center gap-4"},Se=["href"],me={class:"grow-0 w-full"},je={key:0,class:"text-xs font-semibold"},Re={class:"text-xs text-gray-400"},$e={key:1,class:"text-center text-red-500 py-10"},Ie={__name:"NotificationList",setup(j){W();const f=X(),p=q(),{notifications:y}=L(p);Z();const x=C();L(x),h(!1),h({}),h({}),I(()=>{p.fetchNotifications()});const k=(o,i)=>{if(!o)return"application not found";switch(i){case"leaveApplication":return`Last Office ( ${o.last_working_date} ) → Join Date ( ${o.resumption_date} )`;case"shortLeave":return`Short Leave on ${o.date} form ${S(o.start_time)??"N/A"} to ${o.end_time?S(o.end_time):"N/A"}`;case"shift":return o.exchange_type==="shift"?`Exchange (${o.exchange_type}) on ${o.current_date} (${(o==null?void 0:o.shift_name)??"No Shift"})`:`Exchange (${o.exchange_type})`;case"offday":return o.exchange_type==="offday"?`Exchange (Offday): ${o.exchange_date} → ${o.current_date}`:`Exchange (${o.exchange_type})`;case"manualAttendance":const v=o.check_in?l(o.check_in):"N/A",e=o.check_out?l(o.check_out):"N/A";return`Checked in (${v}) → Checked out (${e})`;default:return"Unknown Event"}},t=o=>{switch(o){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"manualAttendance":return"fas fa-clock";case"exchange":return"fas fa-random";case"offday":return"fas fa-random";default:return"fas fa-bell"}},u=o=>new Date(o).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});function l(o){const i={year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"2-digit",hour12:!0};return new Date(o).toLocaleString("en-US",i)}const S=o=>{const[i,v]=o.split(":").map(Number),e=new Date;return e.setHours(i,v),e.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(o,i)=>{const v=Y("RouterLink");return s(),_("div",ue,[r("h2",_e,m(b(f).query.type.replace(/([A-Z])/g," $1")),1),b(y)[b(f).query.type]?(s(),_("div",ve,[(s(!0),_(K,null,P(b(y)[b(f).query.type],(e,a)=>{var n,d,g,w,$,N,D,T,J,U,H,V,z,F;return s(),_("div",{key:e.id,class:"bg-white p-4 rounded-xl shadow border"},[r("div",fe,[r("div",ye,[r("i",{class:Q(t(e.event_type))},null,2)]),r("div",he,[r("p",ge,m((n=e.event_model)==null?void 0:n.user_name),1),(d=e.event_model)!=null&&d.reason?(s(),_("p",we," Reason: "+m((g=e.event_model)==null?void 0:g.reason),1)):c("",!0),r("p",be,m(k(e.event_model,e.event_type)),1),(w=e==null?void 0:e.event_model)!=null&&w.total_leave_days_without_week?(s(),_("p",xe," Total Leave: "+m(e==null?void 0:e.event_model.total_leave_days_without_week)+" days ",1)):c("",!0)]),e!=null&&e.event_model?(s(),_("div",ke,[r("div",Ae,[e!=null&&e.event_model.attachment?(s(),_("a",{key:0,href:($=e==null?void 0:e.event_model)==null?void 0:$.attachment,target:"_blank",class:"btn-1"},i[0]||(i[0]=[r("i",{class:"fad fa-link"},null,-1)]),8,Se)):c("",!0),b(f).query.type==="leaveApplication"?(s(),A(v,{key:1,to:{name:"LeaveApplicationShow",params:{id:(N=e==null?void 0:e.event_model)==null?void 0:N.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:R(()=>i[1]||(i[1]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):c("",!0),b(f).query.type==="shortLeave"?(s(),A(v,{key:2,to:{name:"ShortLeaveShow",params:{id:(D=e==null?void 0:e.event_model)==null?void 0:D.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:R(()=>i[2]||(i[2]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):c("",!0),b(f).query.type==="exchange"?(s(),A(v,{key:3,to:{name:((T=e==null?void 0:e.event_model)==null?void 0:T.exchange_type)=="offday"?"ExchangeOffdayShow":"ExchangeShiftShow",params:{id:(J=e==null?void 0:e.event_model)==null?void 0:J.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:R(()=>i[3]||(i[3]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):c("",!0),b(f).query.type==="offday"?(s(),A(v,{key:4,to:{name:"ExchangeOffdayShow",params:{id:(U=e==null?void 0:e.event_model)==null?void 0:U.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:R(()=>i[4]||(i[4]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):c("",!0),b(f).query.type==="shift"?(s(),A(v,{key:5,to:{name:"ExchangeShiftShow",params:{id:(H=e==null?void 0:e.event_model)==null?void 0:H.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:R(()=>i[5]||(i[5]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):c("",!0),b(f).query.type==="manualAttendance"?(s(),A(v,{key:6,to:{name:"ExchangeShiftShow",params:{id:(V=e==null?void 0:e.event_model)==null?void 0:V.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:R(()=>i[6]||(i[6]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):c("",!0)]),r("div",me,[(z=e==null?void 0:e.event_model)!=null&&z.type?(s(),_("p",je," Type : "+m((F=e==null?void 0:e.event_model)==null?void 0:F.type),1)):c("",!0),r("p",Re,m(u(e.created_at)),1)])])):c("",!0)]),e!=null&&e.event_model&&e.event_type==="leaveApplication"?(s(),A(G,{key:0,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):c("",!0),e!=null&&e.event_model&&e.event_type==="manualAttendance"?(s(),A(G,{key:1,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):c("",!0),e!=null&&e.event_model&&e.event_type==="shortLeave"?(s(),A(pe,{key:2,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):c("",!0),e!=null&&e.event_model&&(e.event_type==="offday"||e.event_type==="shift")?(s(),A(ne,{key:3,application:e.event_model,notificationId:e.id},null,8,["application","notificationId"])):c("",!0)])}),128))])):(s(),_("div",$e,"No notifications found."))])}}};export{Ie as default};
