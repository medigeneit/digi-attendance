import{r as v,e as S,c,o as m,a as t,f as N,g as b,w as _,F as T,p as d,i as w,j as k,k as l,t as h,u as $}from"./index-CvTkKZxT.js";import{_ as V}from"./CompanyDepartmentSelectInput-CO0FeI29.js";import{R as C}from"./RequiredIcon-D1R9JQ7W.js";import{a as A}from"./requirement-DHW761qp.js";import{u as F}from"./company-CFwoZYfP.js";import{u as B}from"./tags-BinLyY7I.js";import{u as j}from"./useTaskStore-DhnIiy3V.js";import{L as z}from"./LoaderView-DUC2TBRd.js";import{_ as M}from"./MultiselectDropdown-CDetHa1T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"max-h-[90vh] overflow-auto max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},L={class:"sticky top-0 pt-4 bg-white z-10"},W={class:"block text-gray-600 text-sm mb1 font-medium"},D={class:"block text-gray-600 text-sm mb-1 font-medium"},E={class:"mb-4"},I={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},G={key:0,class:"mb-4 text-red-500 font-medium"},H={key:1,class:"mb-4"},J={class:"flex items-center justify-between gap-4"},K=["disabled"],O={__name:"RequirementAddForm",emits:["create","cancelClick","error"],setup(q,{emit:f}){const i=f,o=j(),n=B(),a=F(),s=v(""),u=v([]),p=v({from_department_id:"",to_department_id:"",website_tags:[]});S(async()=>{s.value="loading",n.fetchTags("website"),await a.fetchCompanies({with:"departments",ignore_permission:!0}),await a.fetchMyCompanies({with:"departments"}),s.value=""});async function R(){s.value="submitting";const g={...p.value,...u.value&&Array.isArray(u.value)?{website_tags:u.value.map(e=>e.id)}:{}};try{const e=await A(g);i("create",e),s.value="create"}catch{i("error",o.error),s.value="error"}}return(g,e)=>{var y,x;return m(),c("div",U,[t("div",L,[e[5]||(e[5]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Requirement",-1)),e[6]||(e[6]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=_(r=>i("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),t("form",{onSubmit:_(R,["prevent"]),class:"z-0"},[s.value!=="loading"&&s.value!=="submitting"?(m(),c(T,{key:0},[d(V,{modelValue:p.value.from_department_id,"onUpdate:modelValue":e[1]||(e[1]=r=>p.value.from_department_id=r),companies:((y=l(a))==null?void 0:y.myCompanies)||[],class:"mb-4"},{label:w(()=>[t("label",W,[e[7]||(e[7]=k(" From ")),d(C)])]),_:1},8,["modelValue","companies"]),d(V,{modelValue:p.value.to_department_id,"onUpdate:modelValue":e[2]||(e[2]=r=>p.value.to_department_id=r),companies:((x=l(a))==null?void 0:x.companies)||[],class:"mb-4"},{label:w(()=>[t("label",D,[e[8]||(e[8]=k(" To ")),d(C)])]),_:1},8,["modelValue","companies"]),t("div",E,[e[9]||(e[9]=t("label",{class:"text-gray-800"},"Websites",-1)),d(M,{options:l(n).tags,modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=r=>u.value=r),multiple:!0,label:"name","track-by":"id"},null,8,["options","modelValue"])])],64)):b("",!0),t("div",I,[l(o).error?(m(),c("div",G,h(l(o).error),1)):b("",!0),l(o).error?(m(),c("hr",H)):b("",!0),t("div",J,[t("button",{type:"button",onClick:e[4]||(e[4]=_(r=>i("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),t("button",{disabled:s.value=="loading"||s.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},h(s.value=="submitting"?"Saving...":"Next"),9,K)])])],32),s.value==="loading"||s.value==="submitting"?(m(),N(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):b("",!0)])}}},P={class:"container mx-auto p-6"},ie={__name:"RequirementAdd",setup(q){const f=$();function i(o){var a;const n=((a=o.data)==null?void 0:a.requirement)||null;n&&f.push({name:"RequirementShow",params:{id:n.id}})}return(o,n)=>(m(),c("div",P,[d(O,{onCreate:i})]))}};export{ie as default};
