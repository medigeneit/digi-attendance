import{G as A,r as f,p as d,H as i}from"./index-CijbHKK9.js";const L=A("task",()=>{const o=f([]),v=f(null),c=f(!1),u=f(null),p=f(1),T=f(!0),w=async(e,r,{updateStoreData:a=!0})=>{var t,n;a==!0&&(c.value=!0,u.value=null);try{await i.post(`/tasks/${e}/assign-users`,{user_ids:r}),await y(e)}catch(s){throw a==!0&&(u.value=((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Assign users failed"),s}finally{a==!0&&(c.value=!1)}};function m(){p.value=1,o.value=[]}async function _(e,r={}){var a,t,n;u.value=null;try{const s={...e,per_page:5e3};c.value=!0;const l=await i.get("/tasks",{params:s,...r});return o.value=((a=l.data)==null?void 0:a.tasks)||[],c.value=!1,l.data}catch(s){throw u.value=((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",s}}const $=async(e,r)=>{var a,t,n;u.value=null;try{const s=await i.get("/my-tasks",{params:e,...r});return o.value=((a=s.data)==null?void 0:a.tasks)||[],s.data}catch(s){throw u.value=((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",s),s}};function k(e,r=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>a.parent_id===r).map(a=>({...a,children_tasks:k(e,a.id)}))}function h(){return k(o.value,0)}function O(){const e=[],r=(a,t=0,n="")=>{a.forEach(s=>{e.push({...s,depth:t,idPath:n+s.id}),s.children_tasks&&s.children_tasks.length&&r(s.children_tasks,t+1,n+s.id+"-")})};return r(h()),e}const y=async(e,r={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,n,s;a.fetchOnly||(c.value=!0),u.value=null;try{const l=await i.get(`/tasks/${e}`,{params:r});return a.fetchOnly||(v.value=((t=l.data)==null?void 0:t.task)||{},o.value=l.data.sub_tasks||[]),l.data}catch(l){const g=((s=(n=l.response)==null?void 0:n.data)==null?void 0:s.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(u.value=g),g}finally{a.fetchOnly||(c.value=!1)}},C=async(e,r={loadingBeforeCreate:!1})=>{var a,t,n,s;r.loadingBeforeCreate&&(c.value=!0),u.value=null;try{const l=await i.post("/tasks",e);return(a=l.data)!=null&&a.data&&o.value.push((t=l.data)==null?void 0:t.data),l.data.data}catch(l){throw u.value=((s=(n=l.response)==null?void 0:n.data)==null?void 0:s.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",l),l}finally{r.loadingBeforeCreate&&(c.value=!1)}},E=async(e,r,{loadingBeforeFetch:a=!0})=>{a&&(c.value=!0),u.value=null;try{const t=await i.put(`/tasks/${e}`,r),n=o.value.findIndex(s=>s.id===e);return n!==-1&&(o.value[n]=t.data.data),t.data.data}catch(t){throw t}finally{a&&(c.value=!1)}},P=async(e,r)=>(await i.put(`/tasks/${e}/update-priorities`,{task_ids:r})).data,x=async e=>{var r,a;c.value=!0,u.value=null;try{await i.delete(`/tasks/${e}`),o.value=o.value.filter(t=>t.id!==e)}catch(t){u.value=((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,t)}finally{c.value=!1}};return{tasks:d(()=>o.value),task:d(()=>v.value),loading:d(()=>c.value),error:d(()=>u.value),taskListTree:d(h),flattenedTasks:d(O),fetchTasks:_,hasMoreTask:T,fetchMyTasks:$,resetTaskList:m,fetchTask:y,createTask:C,updateTask:E,deleteTask:x,assignUsers:w,updateTaskPriorities:P}});export{L as u};
