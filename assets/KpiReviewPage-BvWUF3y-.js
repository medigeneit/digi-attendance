import{x as p,r as w,c as r,o,a as s,k as h,t as i,P as R,n as se,F as C,e as M,s as oe,f as Ns,g as As,q as me,l as xe,H as Cs,v as He,j as et,d as Ms,b as te,J as Es,m as Is,z as Ps,T as Ts,C as qt}from"./index-CjQTiVLp.js";import{u as js}from"./kpi-CEvwAya7.js";const Rs={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Gs={class:"flex items-center justify-between border-b bg-slate-50 px-3 py-2 gap-2"},Hs={class:"flex items-center gap-2 min-w-0"},zs={class:"text-sm font-semibold text-slate-800 truncate"},Ds={key:0,class:"text-[11px] text-slate-500 truncate"},Bs={key:1,class:"flex items-center gap-2 shrink-0"},Ks={class:"inline-flex items-center rounded-xl border bg-white p-1 shadow-sm"},Os=["disabled"],Qs=["disabled"],Vs=["disabled"],qs={class:"overflow-auto"},Us={key:0,class:"min-w-[980px] w-full text-[11px]"},Ys={class:"bg-slate-50 sticky top-0 z-10"},Ws={class:"text-slate-700"},Js={class:"text-[11px] font-semibold"},Xs={class:"text-[10px] text-slate-500 flex flex-col items-center"},Zs=["title"],el={key:0,class:"mt-0.5 inline-flex items-center gap-1 rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-semibold text-blue-700 border border-blue-200"},tl={class:"bg-slate-100/80 border-t"},sl=["colspan"],ll={class:"flex items-start justify-between gap-2"},al=["title"],nl={class:"opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition shrink-0"},ol={class:"inline-flex items-center rounded-lg border bg-white p-0.5 shadow-sm"},rl=["disabled","onClick"],il=["disabled","onClick"],ul=["disabled","onClick"],dl=["disabled","onClick"],cl=["disabled","onClick"],vl={key:0,class:"flex items-center justify-center"},ml=["max","value","onInput","onBlur","aria-label"],xl={key:1,class:"text-slate-700 tabular-nums"},pl={key:2,class:"text-slate-300"},bl={class:"bg-slate-50 border-t"},fl={class:"font-semibold text-slate-900 tabular-nums"},yl={class:"text-[10px] text-slate-500 tabular-nums"},gl={class:"mt-1 h-1 rounded bg-slate-200 overflow-hidden"},hl={key:1,class:"text-slate-300"},_l={key:1,class:"w-full text-[11px]"},kl={class:"sticky top-0 bg-white z-10"},wl={class:"bg-slate-100 text-slate-700"},$l={class:"text-left px-2 py-2 w-[34%] font-medium"},Fl={class:"px-2 py-2 text-center text-slate-500"},Sl=["title"],Ll={class:"px-2 py-2 text-center text-slate-700 tabular-nums"},Nl={class:"px-2 py-2 text-center"},Al=["max","value","onInput","onBlur"],Cl={key:1,class:"text-slate-700 tabular-nums"},Ml={class:"bg-slate-50 border-t"},El={class:"px-2 py-2 text-center font-semibold text-slate-800 tabular-nums"},Il={class:"px-2 py-2 text-center font-semibold text-slate-900 tabular-nums"},we=44,ze=320,Ze=84,Ut=Object.assign({name:"KpiGroupTable"},{__name:"KpiGroupTable",props:{group:{type:Object,required:!0},isPersonal:{type:Boolean,default:!1},lanes:{type:Array,default:()=>[]},editableLaneKey:{type:String,default:null},canEdit:{type:Boolean,default:!1},marks:{type:Object,default:()=>({})},headerLabel:{type:String,default:""},itemLabel:{type:String,default:"Item"},helperText:{type:String,default:""},showQuickFillGroup:{type:Boolean,default:!1},autoFillLabel:{type:String,default:""},autoFillVisible:{type:Boolean,default:!1},onAutoFill:{type:Function,default:null},serialMap:{type:Object,default:()=>({})},getLaneMark:{type:Function,default:()=>""},getHrMark:{type:Function,default:()=>""},onMarkChange:{type:Function,default:null},onCap:{type:Function,default:null},onQuickFillItem:{type:Function,default:null},onQuickFillGroup:{type:Function,default:null}},setup(x){const $=x,J=we,L=we+ze,le=p(()=>Array.isArray($.lanes)?$.lanes:[]),I=p(()=>{var b;return Array.isArray((b=$.group)==null?void 0:b.items)?$.group.items:[]}),De=p(()=>$.showQuickFillGroup||$.isPersonal&&$.canEdit),re=b=>{if(b===""||b==null)return null;const u=Number(b);return Number.isFinite(u)?u:null},k=b=>{const u=Number(b);return Number.isFinite(u)?u:0},P=(b,u,a)=>Math.min(Math.max(b,u),a),X=p(()=>I.value.reduce((b,u)=>b+k(u==null?void 0:u.max),0)),ie=p(()=>I.value.reduce((b,u)=>{var g;const a=(g=$.marks)==null?void 0:g[u.id],y=a===""||a==null?0:Number(a),_=k(u==null?void 0:u.max);return b+P(k(y),0,_)},0)),ue=(b,u)=>{var a;return((a=$.serialMap)==null?void 0:a[b.id])??u+1},G=w(!1),H=b=>(b==null?void 0:b.key)===$.editableLaneKey&&!!(b!=null&&b.can_current_user_review),ae=(b,u)=>{var a,y;return!b||!u?null:H(b)?re((a=$.marks)==null?void 0:a[u.id]):b!=null&&b.can_view_marks?re((y=$.getLaneMark)==null?void 0:y.call($,b.key,u.id)):null},j=p(()=>{const b={},u=k(X.value);return le.value.forEach(a=>{const y=H(a)||!!(a!=null&&a.can_view_marks);if(!(a!=null&&a.key))return;let _=0,g=!1;I.value.forEach(K=>{const Fe=ae(a,K);if(Fe==null)return;g=!0;const Be=k(K==null?void 0:K.max);_+=P(k(Fe),0,Be)});const B=u>0?Math.round(_/u*100):0;b[a.key]={got:Number(_.toFixed(2)),max:Number(u.toFixed(2)),percent:B,hasData:g,canShow:y}}),b}),z=p(()=>{const b=le.value;if(G.value)return b;const u=b.filter(a=>{var y,_;return H(a)?!0:!!((_=(y=j.value)==null?void 0:y[a.key])!=null&&_.hasData)});return u.length?u:b}),ne=b=>{var y;const u=(y=j.value)==null?void 0:y[b];return!u||!u.max?"0%":`${P(u.got/u.max*100,0,100)}%`},D=b=>{var a;if(!$.canEdit)return!1;const u=(a=$.marks)==null?void 0:a[b.id];return u===""||u==null},Z=(b,u)=>{var y;const a=u===""?"":Number(u);u!==""&&Number.isNaN(a)||(y=$.onMarkChange)==null||y.call($,b,a)},$e=(b,u)=>{var a;return(a=$.onCap)==null?void 0:a.call($,b,u)};return(b,u)=>(o(),r("section",Rs,[s("div",Gs,[s("div",Hs,[s("div",zs,i(x.headerLabel),1),x.isPersonal&&le.value.length>1?(o(),r("button",{key:0,type:"button",class:"shrink-0 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[10px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:u[0]||(u[0]=a=>G.value=!G.value)},i(G.value?"Show only filled lanes":"Show all lanes"),1)):h("",!0)]),x.helperText?(o(),r("div",Ds,i(x.helperText),1)):h("",!0),De.value?(o(),r("div",Bs,[s("div",Ks,[s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg text-slate-700 hover:bg-slate-100 disabled:opacity-40",onClick:u[1]||(u[1]=a=>{var y;return(y=x.onQuickFillGroup)==null?void 0:y.call(x,x.group,"half")}),disabled:!x.canEdit}," All 1/2 ",8,Os),s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg text-slate-700 hover:bg-slate-100 disabled:opacity-40",onClick:u[2]||(u[2]=a=>{var y;return(y=x.onQuickFillGroup)==null?void 0:y.call(x,x.group,"threeQuarter")}),disabled:!x.canEdit}," All 3/4 ",8,Qs),s("button",{type:"button",class:"px-3 py-1 text-[11px] font-semibold rounded-lg bg-slate-900 text-white hover:bg-slate-800 disabled:opacity-40",onClick:u[3]||(u[3]=a=>{var y;return(y=x.onQuickFillGroup)==null?void 0:y.call(x,x.group,"full")}),disabled:!x.canEdit}," All Full ",8,Vs)]),x.autoFillVisible?(o(),r("button",{key:0,type:"button",class:"rounded-full border border-slate-300 bg-white px-2.5 py-1 text-[10px] font-semibold text-slate-600 hover:border-slate-400",onClick:u[4]||(u[4]=a=>{var y;return(y=x.onAutoFill)==null?void 0:y.call(x)})},i(x.autoFillLabel),1)):h("",!0)])):h("",!0)]),s("div",qs,[x.isPersonal?(o(),r("table",Us,[s("thead",Ys,[s("tr",Ws,[s("th",{class:"sticky left-0 z-20 bg-slate-50 px-2 py-2 text-center font-medium",style:R({width:we+"px"})}," # ",4),s("th",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-left font-medium",style:R({left:se(J)+"px",width:ze+"px"})},i(x.itemLabel),5),s("th",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-center font-medium",style:R({left:L+"px",width:Ze+"px"})}," Max ",4),(o(!0),r(C,null,M(z.value,a=>(o(),r("th",{key:a.key,class:"px-2 py-2 text-center font-medium"},[s("div",Js,i(a.label||a.key),1),s("div",Xs,[s("span",{class:"truncate max-w-[140px]",title:a.assigned_user_name||""},i(a.assigned_user_name||"-"),9,Zs),H(a)?(o(),r("span",el," ✎ You can edit ")):h("",!0)])]))),128))])]),s("tbody",null,[s("tr",tl,[s("td",{colspan:3+z.value.length,class:"px-2 py-2 font-medium text-slate-800"},i(x.group.label||"Personal"),9,sl)]),(o(!0),r(C,null,M(I.value,(a,y)=>(o(),r("tr",{key:a.id,class:oe(["border-t hover:bg-slate-50/60 group",D(a)?"bg-rose-50/30 border-l-4 border-rose-400":""])},[s("td",{class:"sticky left-0 z-10 bg-white px-2 py-2 text-center text-slate-500",style:R({width:we+"px"})},i(ue(a,y)),5),s("td",{class:"sticky z-10 bg-white px-2 py-2 align-top",style:R({left:se(J)+"px",width:ze+"px"})},[s("div",ll,[s("div",{class:"font-medium text-slate-800 truncate pr-2",title:a.label},i(a.label),9,al),s("div",nl,[s("div",ol,[s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,a.id,a.max,"zero"))},title:"Set 0"}," 0 ",8,rl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,a.id,a.max,"quarter"))},title:"Set 25%"}," ¼ ",8,il),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,a.id,a.max,"half"))},title:"Set 50%"}," ½ ",8,ul),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md text-slate-700 hover:bg-slate-100 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,a.id,a.max,"threeQuarter"))},title:"Set 75%"}," ¾ ",8,dl),s("button",{type:"button",class:"px-2 py-1 text-[11px] font-semibold rounded-md bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-40",disabled:!x.canEdit,onClick:_=>{var g;return x.canEdit&&((g=x.onQuickFillItem)==null?void 0:g.call(x,a.id,a.max,"full"))},title:"Set 100%"}," Full ",8,cl)])])])],4),s("td",{class:"sticky z-10 bg-white px-2 py-2 text-center text-slate-700 tabular-nums",style:R({left:L+"px",width:Ze+"px"})},i(k(a.max).toFixed(1).replace(/\.0$/,"")),5),(o(!0),r(C,null,M(z.value,_=>(o(),r("td",{key:_.key,class:"px-2 py-2 text-center"},[H(_)?(o(),r("div",vl,[s("input",{type:"number",step:"0.1",min:"0",max:a.max,value:x.marks[a.id]??"",onInput:g=>Z(a.id,g.target.value),onBlur:g=>$e(a.id,a.max),inputmode:"decimal",class:oe(["w-16 text-right rounded-md px-2 py-1 text-[11px] focus:outline-none focus:ring-2 focus:ring-indigo-200 border tabular-nums",D(a)?"border-rose-300 bg-rose-50/40":"border-slate-200"]),"aria-label":`Score for ${a.label}`},null,42,ml)])):_.can_view_marks?(o(),r("div",xl,i($.getLaneMark(_.key,a.id)||"—"),1)):(o(),r("div",pl,"—"))]))),128))],2))),128)),s("tr",bl,[s("td",{class:"sticky left-0 z-20 bg-slate-50 px-2 py-2",style:R({width:we+"px"})},null,4),s("td",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-right font-medium text-slate-700",style:R({left:se(J)+"px",width:ze+"px"})}," Group Total ",4),s("td",{class:"sticky z-20 bg-slate-50 px-2 py-2 text-center font-semibold text-slate-800 tabular-nums",style:R({left:L+"px",width:Ze+"px"})},i(X.value.toFixed(2)),5),(o(!0),r(C,null,M(z.value,a=>{var y,_,g,B;return o(),r("td",{key:a.key,class:"px-2 py-2 text-center align-top"},[(_=(y=j.value)==null?void 0:y[a.key])!=null&&_.canShow&&(H(a)||(B=(g=j.value)==null?void 0:g[a.key])!=null&&B.hasData)?(o(),r(C,{key:0},[s("div",fl,i(j.value[a.key].got.toFixed(2)),1),s("div",yl," / "+i(j.value[a.key].max.toFixed(2))+" · "+i(j.value[a.key].percent)+"% ",1),s("div",gl,[s("div",{class:"h-1 bg-slate-900/40",style:R({width:ne(a.key)})},null,4)])],64)):(o(),r("div",hl,"—"))])}),128))])])])):(o(),r("table",_l,[s("thead",kl,[s("tr",wl,[u[5]||(u[5]=s("th",{class:"px-2 py-2 w-[36px] text-center font-medium"},"#",-1)),s("th",$l,i(x.itemLabel),1),u[6]||(u[6]=s("th",{class:"px-2 py-2 text-center w-[70px] font-medium"},"Max",-1)),u[7]||(u[7]=s("th",{class:"px-2 py-2 text-center w-[90px] font-medium"},"HR Score",-1))])]),s("tbody",null,[(o(!0),r(C,null,M(I.value,(a,y)=>(o(),r("tr",{key:a.id,class:oe(["border-t hover:bg-slate-50/60",D(a)?"bg-rose-50/30 border-l-4 border-rose-400":""])},[s("td",Fl,i(y+1),1),s("td",{class:"px-2 py-2 font-medium text-slate-800 truncate",title:a.label},i(a.label),9,Sl),s("td",Ll,i(k(a.max).toFixed(1).replace(/\.0$/,"")),1),s("td",Nl,[x.canEdit?(o(),r("input",{key:0,type:"number",step:"0.1",min:"0",max:a.max,value:x.marks[a.id]??"",onInput:_=>Z(a.id,_.target.value),onBlur:_=>$e(a.id,a.max),class:oe(["w-16 text-right rounded-md px-2 py-1 text-[11px] focus:outline-none focus:ring-2 focus:ring-indigo-200 border tabular-nums",D(a)?"border-rose-300 bg-rose-50/40":"border-slate-200"])},null,42,Al)):(o(),r("span",Cl,i($.getHrMark(a.id)||"—"),1))])],2))),128)),s("tr",Ml,[u[8]||(u[8]=s("td",null,null,-1)),u[9]||(u[9]=s("td",{class:"px-2 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),s("td",El,i(X.value.toFixed(2)),1),s("td",Il,i(ie.value.toFixed(2)),1)])])]))])]))}}),Pl={key:0,class:"space-y-4"},Tl={class:"flex items-start justify-between gap-3"},jl={class:"text-sm font-semibold text-slate-900"},Rl={class:"text-xs text-slate-500"},Gl={key:0,class:"text-xs text-slate-400"},Hl={class:"flex flex-wrap items-center gap-2"},zl=["onClick"],Dl={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Bl={key:1,class:"rounded-xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-700"},Kl={key:2,class:"space-y-3"},Ol={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Ql={key:1,class:"space-y-3"},Vl={class:"flex items-start justify-between gap-3"},ql={class:"min-w-0"},Ul=["title"],Yl={class:"mt-0.5 text-[11px] text-slate-500"},Wl={key:0},Jl={key:1},Xl={class:"shrink-0"},Zl=["onUpdate:modelValue"],ea=["value"],ta={class:"mt-2"},sa=["onUpdate:modelValue"],la={class:"flex items-center justify-end gap-2 pt-2"},aa=["disabled"],na=["disabled"],oa={key:1,class:"max-w-7xl mx-auto px-4 py-6 space-y-6"},ra={key:0,class:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700"},ia={key:1,class:"rounded-2xl border border-slate-200 bg-slate-50 px-4 py-10 text-sm text-slate-600"},ua={class:"border rounded-2xl bg-white/80 backdrop-blur px-4 py-3 shadow-sm"},da={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},ca={class:"space-y-1"},va={class:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1"},ma={class:"text-xs text-indigo-900"},xa={class:"text-sm text-slate-600"},pa={class:"font-medium text-slate-800"},ba={class:"flex flex-wrap gap-2 text-xs mt-0.5"},fa={key:0,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},ya={class:"ml-1 font-medium text-slate-800"},ga={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},ha={class:"ml-1 font-medium text-slate-800"},_a={class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},ka={key:0,class:"ml-1 inline-flex items-center gap-1"},wa={class:"font-semibold text-slate-800"},$a={class:"font-semibold text-emerald-700"},Fa={key:1,class:"ml-1 inline-flex items-center gap-1"},Sa={key:2,class:"ml-1 font-semibold text-slate-800"},La={class:"flex items-end gap-4"},Na={class:"text-right"},Aa={class:"text-lg font-bold text-slate-900"},Ca={class:"text-slate-400"},Ma={class:"text-xs text-slate-500"},Ea={key:0},Ia={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Pa={class:"text-xs text-slate-500"},Ta={key:0,class:"p-4 text-sm font-bold text-slate-500"},ja=["innerHTML"],Ra={key:2,class:"mt-2 flex flex-wrap items-center justify-between gap-3 rounded-2xl border bg-white px-4 py-3 shadow-sm"},Ga={class:"text-sm text-slate-600"},Ha={class:"text-slate-900"},za={class:"text-slate-400"},Da=["disabled"],Ba={class:"mt-2"},Ka={class:"grid gap-4 lg:grid-cols-5"},Oa={key:0,class:"space-y-4 lg:col-span-3"},Qa={key:0,class:"sticky top-6 border rounded-2xl bg-white shadow-sm"},Va={class:"flex flex-wrap items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},qa={class:"flex flex-wrap items-center gap-2 text-[11px] text-slate-500"},Ua={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Ya={key:0,class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Wa={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Ja={class:"p-4 space-y-4 max-h-[360px] overflow-y-auto"},Xa={class:"flex flex-wrap gap-2 border-b border-slate-100 pb-3"},Za=["onClick"],en={class:"space-y-4"},tn={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},sn={class:"rounded-xl border bg-slate-50 p-3"},ln={class:"flex items-center justify-between"},an={class:"text-[11px] px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200"},nn={class:"mt-1 text-sm font-semibold text-slate-900"},on={class:"text-xs text-slate-500"},rn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},un={class:"rounded-xl border bg-slate-50 p-3"},dn={class:"flex items-center justify-between"},cn={class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-200"},vn={class:"mt-1 text-sm font-semibold text-slate-900"},mn={class:"text-xs text-slate-500"},xn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},pn={class:"rounded-xl border bg-slate-50 p-3 sm:col-span-2"},bn={class:"flex items-center justify-between"},fn={class:"text-[11px] px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 border border-emerald-200"},yn={class:"mt-1 text-sm font-semibold text-slate-900"},gn={class:"text-xs text-slate-500"},hn={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},_n={class:"border-t pt-2 text-xs"},kn={key:0,class:"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs space-y-2"},wn={class:"grid grid-cols-2 gap-2"},$n={class:"font-medium text-slate-800"},Fn={class:"font-medium text-slate-800"},Sn={class:"font-medium text-slate-800"},Ln={class:"font-medium text-slate-800"},Nn={class:"font-medium text-slate-800"},An={class:"font-medium text-slate-800"},Cn={key:1,class:"border rounded-2xl bg-white shadow-sm"},Mn={class:"flex items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},En={class:"text-[11px] text-slate-500"},In={class:"p-4 space-y-3"},Pn={class:"max-h-96 overflow-auto border rounded-xl"},Tn={class:"min-w-full text-xs text-left"},jn={class:"px-2 py-2"},Rn={class:"font-semibold text-slate-700"},Gn={key:0,class:"mt-0.5 text-[11px] text-slate-400"},Hn={class:"px-2 py-2 text-right"},zn=["onClick"],Dn={key:3,class:"rounded-2xl bg-white border shadow-sm px-4 py-4 space-y-4"},Bn={class:"grid gap-4 md:grid-cols-3"},Kn={class:"space-y-3"},On={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},Qn={key:0,class:"text-[11px] text-emerald-600"},Vn={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},qn={class:"flex flex-wrap gap-1.5"},Un=["onClick","disabled"],Yn={class:"space-y-1"},Wn={class:"space-y-3"},Jn={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},Xn={key:0,class:"text-[11px] text-amber-600"},Zn={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},eo={class:"flex flex-wrap gap-1.5"},to=["onClick","disabled"],so={class:"space-y-1"},lo={class:"space-y-3"},ao={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},no={key:0,class:"text-[11px] text-sky-600"},oo={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},ro={class:"flex flex-wrap gap-1.5"},io=["onClick","disabled"],uo={class:"space-y-1"},co={class:"mt-2 flex flex-col gap-3 border-t pt-3 md:flex-row md:items-center md:justify-between"},vo={class:"flex flex-wrap items-center gap-2"},mo=["disabled"],xo={class:"relative w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true"},po={class:"flex items-start justify-between gap-3"},bo={class:"text-lg font-semibold text-slate-900"},fo={class:"text-xs text-slate-500"},yo={key:0,class:"text-xs text-slate-400 mt-1"},go={class:"mt-5 space-y-4 text-sm text-slate-700"},ho={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},_o={key:0},ko={key:1,class:"text-slate-400"},wo={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},$o={key:0},Fo={key:1,class:"text-slate-400"},So={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},Lo={key:0},No={key:1,class:"text-slate-400"},Ao=15e3,Co={__name:"KpiReviewForm",props:{mode:{type:String,default:"full"},allowedLanes:{type:Array,default:()=>["supv_director","da"]},groupFilter:{type:String,default:null},initialLane:{type:String,default:""},employeeId:{type:[Number,String],default:null},employeeName:{type:String,default:""},year:{type:Number,default:null}},emits:["saved"],setup(x,{emit:$}){const J=Ns(),L=js(),le=As(),I=x,De=$,re=p(()=>I.mode==="compact"),k=w({}),P=w({}),X=w(""),ie=w(""),ue=w(""),G=w(null),H=w(null),ae=w(!1),j=w(!1),z=w(""),ne=p(()=>{const e=Number(I.employeeId);return Number.isFinite(e)&&e>0?e:null}),D=p(()=>{const e=Number(I.year);return Number.isFinite(e)&&e>0?e:new Date().getFullYear()}),Z=p(()=>I.groupFilter?String(I.groupFilter):"personal"),$e=p(()=>Z.value?Z.value.replace(/_/g," "):"personal"),b=p(()=>{const e=Array.isArray(I.allowedLanes)?I.allowedLanes.filter(Boolean):[];return e.length?e:["supv_director","da"]}),u=w(I.initialLane||b.value[0]||""),a=w([]),y=w({}),_=w({}),g=w(!1),B=w(!1),K=w(""),Fe=p(()=>{var e;return I.employeeName||((e=P.value)==null?void 0:e.name)||"Employee"}),Be={supv_director:"Supv. Director",da:"DA"},tt=e=>Be[e]||e;function Yt(e){return Array.isArray(e)?e.map((t,l)=>{const n=(t==null?void 0:t.id)??(t==null?void 0:t.item_id)??(t==null?void 0:t.kpi_item_id)??(t==null?void 0:t.kpi_id)??l,v=(t==null?void 0:t.title)??(t==null?void 0:t.name)??(t==null?void 0:t.label)??`Item ${l+1}`,c=(t==null?void 0:t.weight)??(t==null?void 0:t.weightage)??(t==null?void 0:t.weight_value)??(t==null?void 0:t.score_weight)??null,d=(t==null?void 0:t.max_score)??(t==null?void 0:t.max)??(t==null?void 0:t.max_marks)??(t==null?void 0:t.score_max)??0,f=(t==null?void 0:t.score)??(t==null?void 0:t.mark)??(t==null?void 0:t.obtained)??(t==null?void 0:t.value)??null,S=(t==null?void 0:t.comment)??(t==null?void 0:t.note)??(t==null?void 0:t.remark)??"";return{id:n,title:v,weight:c,maxScore:d,score:f,comment:S}}):[]}function Wt(e){const t=Number(e);if(!Number.isFinite(t)||t<=0)return[0];const l=Number.isInteger(t)?1:.5,n=[];for(let v=0;v<=t+1e-4;v+=l){const c=l===1?Math.round(v):Number(v.toFixed(1));n.push(c)}return n[n.length-1]!==t&&n.push(t),n}async function Jt(){var e,t,l,n;if(re.value&&!(!ne.value||!D.value||!u.value)){g.value=!0,K.value="";try{const{data:v}=await qt.get(`/kpi/yearly/${D.value}/employees/${ne.value}/marking-form`,{params:{lane:u.value,group:Z.value}}),c=(v==null?void 0:v.data)??v??{},d=(c==null?void 0:c.items)||((e=c==null?void 0:c.form)==null?void 0:e.items)||((t=c==null?void 0:c.group)==null?void 0:t.items)||(c==null?void 0:c.data)||[],f=Yt(d),S={},N={};f.forEach(E=>{var ge,he;const je=(ge=c==null?void 0:c.marks)==null?void 0:ge[E.id],Re=(he=c==null?void 0:c.comments)==null?void 0:he[E.id],ve=E.score??je??0,Ge=E.comment??Re??"";S[E.id]=ve===""||ve==null?0:Number(ve),N[E.id]=Ge??""}),a.value=f,y.value=S,_.value=N}catch(v){K.value=((n=(l=v==null?void 0:v.response)==null?void 0:l.data)==null?void 0:n.message)||"Failed to load KPI marking form.",a.value=[]}finally{g.value=!1}}}async function st(e){var t,l;if(!(!ne.value||!D.value||!u.value)){B.value=!0,K.value="";try{const n=a.value.map(c=>({item_id:c.id,score:Number(y.value[c.id]??0),comment:_.value[c.id]??""})),v={lane:u.value,group:Z.value,submit:!!e,items:n,marks:{...y.value},comments:{..._.value}};await qt.post(`/kpi/yearly/${D.value}/employees/${ne.value}/marking-form`,v),De("saved")}catch(n){K.value=((l=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to save KPI marking form."}finally{B.value=!1}}}me(()=>I.initialLane,e=>{e&&(u.value=e)}),me(b,e=>{e.length&&(e.includes(u.value)||(u.value=e[0]))},{immediate:!0}),me([re,u,ne,D,Z],([e,t,l,n,v])=>{!e||!t||!l||!n||!v||Jt()},{immediate:!0});const lt=w([]),at=w({}),Ke=w(!1),Se=p(()=>{var e;return((e=L.cycle)==null?void 0:e.groups_json)||[]}),Xt=p(()=>{var n;const e=L.cycle||{},t=Array.isArray(e==null?void 0:e.groups_json)?e.groups_json:[];return(e==null?void 0:e.slug)==="support_staff"&&t.length===1&&((n=t[0])==null?void 0:n.id)==="personal"?"staff":"executive"}),ee=p(()=>Xt.value==="staff"),nt=e=>{if(!e)return!1;const t=String(e.id||"").toLowerCase(),l=String(e.label||"").toLowerCase();return t==="personal"||t==="personal_evaluation"||t==="personal_eval"?!0:l.includes("personal")},U=p(()=>Se.value.find(nt)||null),O=p(()=>ee.value?[]:Se.value.filter(e=>!nt(e))),Zt=(e,t)=>(e==null?void 0:e.label)||`Group ${t+1}`,es=e=>/^hr\d*$/i.test(e)||e==="hr",ot=e=>es((e==null?void 0:e.key)||"")||(e==null?void 0:e.is_hr_lane)===!0,Le=p(()=>[...lt.value||[]].sort((e,t)=>(e.rank??999)-(t.rank??999))),Oe=p(()=>Le.value.filter(ot)),rt=p(()=>Le.value.filter(e=>!ot(e))),Qe=p(()=>ee.value?Le.value:rt.value),Y=p(()=>{var e;return((e=Qe.value.find(t=>t.can_current_user_review))==null?void 0:e.key)||null}),ts=p(()=>Qe.value.find(e=>e.key===Y.value)||null),ss=p(()=>{var e;return((e=ts.value)==null?void 0:e.rank)??null}),ls=p(()=>{var e;return Number(((e=le==null?void 0:le.user)==null?void 0:e.id)||0)}),Ve=p(()=>{const e=ls.value;if(!e)return null;const t=Oe.value.find(l=>Number(l.assigned_user_id)===e);return t||Oe.value.find(l=>l.can_current_user_review)||null}),Q=p(()=>{var e;return((e=Ve.value)==null?void 0:e.key)||null}),as=p(()=>!!(Ve.value&&Ve.value.can_current_user_review)),V=p(()=>!!(Ke.value||as.value)),Ne=p(()=>!!Y.value),ns=p(()=>{if(ee.value||!V.value)return!1;const e=Y.value,t=Q.value;return!e||!t||e===t?!1:O.value.length>0}),qe=p(()=>ee.value?Y.value:V.value&&Q.value?Q.value:Y.value),it=p(()=>!!(qe.value&&Q.value&&qe.value===Q.value));function pe(e){var n;const t=(n=at.value)==null?void 0:n[e];return t?(Array.isArray(t)?t:[t]).reduce((v,c)=>{if(!c)return v;if(!v)return c;const d=new Date(c.submitted_at||0).getTime(),f=new Date(v.submitted_at||0).getTime();return d>f?c:v},null):null}function ut(e,t){var n;const l=pe(e);return((n=l==null?void 0:l.marks)==null?void 0:n[t])??""}function dt(e){var l,n,v;if(Q.value){const c=pe(Q.value),d=(l=c==null?void 0:c.marks)==null?void 0:l[e];if(d!=null)return d}let t=null;for(const c of Oe.value){const d=pe(c.key);if(!d||((n=d==null?void 0:d.marks)==null?void 0:n[e])==null)continue;if(!t){t=d;continue}const f=new Date(d.submitted_at||0).getTime(),S=new Date(t.submitted_at||0).getTime();f>S&&(t=d)}return((v=t==null?void 0:t.marks)==null?void 0:v[e])??""}function ct(e,t){k.value[e]=t===""?"":Number(t)}function be(e,t){const l=Number(k.value[e]??0);l<0&&(k.value[e]=0),l>Number(t)&&(k.value[e]=Number(t))}function vt(e,t,l){l==="zero"?k.value[e]=0:l==="quarter"?k.value[e]=Number(t)/4:l==="half"?k.value[e]=Number(t)/2:l==="threeQuarter"?k.value[e]=Number((Number(t)*.75).toFixed(1)):l==="full"&&(k.value[e]=Number(t)),be(e,t)}function os(e,t){e.items.forEach(l=>vt(l.id,l.max,t))}const fe=p(()=>{let e=0,t=0;const l=U.value;l&&Array.isArray(l.items)&&l.items.forEach(v=>{e+=Number(v.max||0);const c=Number(k.value[v.id]||0);t+=Math.min(Math.max(c,0),Number(v.max||0))});const n=e>0?t/e*100:0;return{max:Number(e.toFixed(2)),got:Number(t.toFixed(2)),percent:Number(n.toFixed(2))}}),rs=p(()=>!!G.value&&typeof G.value=="object"),is=p(()=>{var e;return((e=G.value)==null?void 0:e.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),us=p(()=>{var e;return((e=G.value)==null?void 0:e.year)??null}),ds=p(()=>{var e;return((e=H.value)==null?void 0:e.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),cs=p(()=>{var e;return((e=H.value)==null?void 0:e.year)??null}),q=w("target"),mt=[{key:"target",label:"Annual Target"},{key:"performance",label:"Annual Performance"}],xt=p(()=>{var e;return((e=G.value)==null?void 0:e.months_total_form)??0}),vs=p(()=>{var e;return((e=H.value)==null?void 0:e.months_total_form)??xt.value}),F=p(()=>q.value==="target"?is.value:ds.value),pt=p(()=>{var e,t;return Number(((t=(e=F.value)==null?void 0:e.per_form_yearly)==null?void 0:t.final)||0)}),bt=p(()=>{var e,t;return Number(((t=(e=F.value)==null?void 0:e.per_scored_month)==null?void 0:t.max)||0)}),ms=p(()=>bt.value?Math.round(pt.value/bt.value*100):0),ft=p(()=>V.value&&!ee.value),Ue=p(()=>q.value==="target"?us.value:cs.value),yt=p(()=>q.value==="target"?xt.value:vs.value),gt=p(()=>{var e;return((e=mt.find(t=>t.key===q.value))==null?void 0:e.label)||"Annual Target"});me(q,()=>{ae.value=!1});const ht=e=>String(e||"").toLowerCase(),_t=(e,t)=>e?t==="target"?e.id==="monthly_target"?!0:ht(e.label).includes("monthly target"):t==="performance"?e.id==="execution"?!0:ht(e.label).includes("execution")||String(e.label||"").includes("কার্যসম্পাদন"):!1:!1,xs=e=>O.value.find(t=>_t(t,e))||null,kt=(e,{overwrite:t}={overwrite:!1})=>{if(!ft.value)return;const l=xs(e);if(!l||!Array.isArray(l.items)||l.items.length===0)return;const n=l.items,v=n.every(f=>Number(k.value[f.id]||0)===0);if(!t&&!v)return;const c=pt.value,d=n.reduce((f,S)=>f+Number(S.max||0),0);if(d){if(n.length===1){const f=n[0];k.value[f.id]=Math.min(c,Number(f.max||0)),be(f.id,f.max);return}n.forEach(f=>{const S=Number(f.max||0)/d*c,N=Number(S.toFixed(1));k.value[f.id]=N,be(f.id,f.max)})}},ps=p(()=>`Auto: ${q.value==="target"?"Annual Target":"Annual Performance"} (${ms.value}%)`);me(q,e=>{kt(e,{overwrite:!1})},{immediate:!0});const Ae=p(()=>{const e=ee.value?Le.value:rt.value,t=[],l=it.value||V.value?1/0:ss.value??null,n=v=>{if(!v)return[];const c=[];if(Array.isArray(v))c.push(...v);else if(typeof v=="string"&&v.trim())c.push(v.trim());else return[];const d=new Set;return c.reduce((f,S)=>{const N=typeof S=="string"?S.trim():"";return!N||d.has(N)||(d.add(N),f.push(N)),f},[])};return e.forEach(v=>{const c=v.key;if(!c||l!=null&&(v.rank??999)>l)return;const d=pe(c);if(!d)return;const f=n(d.strengths),S=n(d.gaps),N=n(d.suggestions);!f.length&&!S.length&&!N.length||t.push({key:c,lane:c,label:v.label||(d==null?void 0:d.lane_label)||c,reviewer_id:d.reviewer_id,reviewer_name:d.reviewer_name,strengths:f,gaps:S,suggestions:N,submitted_at:d.submitted_at??null})}),t}),bs=e=>{const t=new Set;return Ae.value.forEach(l=>{(Array.isArray(l[e])?l[e]:[]).forEach(v=>{const c=typeof v=="string"?v.trim():"";c&&t.add(c)})}),Array.from(t)},wt=e=>{if(!Array.isArray(e))return[];const t=new Set;return e.forEach(l=>{const n=typeof l=="string"?l.trim():"";n&&t.add(n)}),Array.from(t)},Ce=p(()=>wt(L.strengths)),Me=p(()=>wt(L.gaps)),Ee=p(()=>bs("suggestions"));w([]),w([]),w([]);const Ye=w(!1),T=w(null);function fs(e){T.value=e,Ye.value=!0}function We(){Ye.value=!1,T.value=null}const $t={strengths:X,gaps:ie,suggestions:ue};function ys(e,t){const l=(t||"").trim();return l?e!=null&&e.trim()?`${e.trim()}
${l}`:l:e}function Ie(e,t){const l=$t[e];if(!l)return!1;const n=(l.value||"").split(`
`).map(c=>c.trim()).filter(Boolean),v=(t||"").trim();return v?n.includes(v):!1}function Je(e,t){const l=$t[e];if(!l)return;const n=typeof t=="string"?t.trim():"";n&&(Ie(e,n)||(l.value=ys(l.value,n)))}const de=w(!1);let ye=null;const gs=()=>{de.value=!de.value,ye&&(clearTimeout(ye),ye=null),de.value&&(ye=setTimeout(()=>{de.value=!1,ye=null},Ao))},hs=p(()=>{const e={};let t=1;const l=U.value;return l&&Array.isArray(l.items)&&l.items.forEach(n=>{e[n.id]=t++}),e});function Pe(e){return(Array.isArray(e==null?void 0:e.items)?e.items:[]).map(l=>l.id).filter(l=>l!=null)}function Ft(e){const t={};return(Array.isArray(e)?e:[]).forEach(l=>{var n;t[l]=Number(((n=k.value)==null?void 0:n[l])??0)}),t}function St(e){return Ft(Pe(e))}function Lt(e){const t=[];(Array.isArray(e)?e:[]).forEach(n=>{t.push(...Pe(n))});const l=Array.from(new Set(t));return Ft(l)}const _s=p(()=>!Y.value||!U.value?!1:Object.keys(St(U.value)).length>0),ks=p(()=>!V.value||!Q.value||!Array.isArray(O.value)||O.value.length===0?!1:Object.keys(Lt(O.value)).length>0);function Nt(e,t){if(!e||!(t!=null&&t.length))return!1;const l=pe(e),n=l==null?void 0:l.marks;if(!n)return!1;let v=!1;return t.forEach(c=>{const d=n==null?void 0:n[c];d!==""&&d!=null&&(k.value[c]=Number(d),v=!0)}),v}const Te=e=>{if(typeof e!="string")return e;const t=e.trim();if(!t)return e;try{return JSON.parse(t)}catch{return e}};function ws(e,t=0){const l=(e==null?void 0:e.key)??(e==null?void 0:e.lane_key)??(e==null?void 0:e.laneKey)??(e==null?void 0:e.lane)??"",n=(e==null?void 0:e.label)??(e==null?void 0:e.lane_label)??(e==null?void 0:e.title)??l,v=(e==null?void 0:e.rank)??(e==null?void 0:e.order)??(e==null?void 0:e.priority)??999,c=(e==null?void 0:e.assigned_user_id)??(e==null?void 0:e.assignee_id)??(e==null?void 0:e.reviewer_id)??null,d=(e==null?void 0:e.assigned_user_name)??(e==null?void 0:e.assignee_name)??(e==null?void 0:e.reviewer_name)??"",f=(e==null?void 0:e.can_current_user_review)??(e==null?void 0:e.can_review)??!1,S=(e==null?void 0:e.can_view_marks)??!0;return{...e,key:String(l),label:String(n),rank:Number(v??999),assigned_user_id:c==null?null:Number(c),assigned_user_name:String(d||""),can_current_user_review:!!f,can_view_marks:!!S,_idx:t}}function $s(e){const t={},l=e&&typeof e=="object"?e:{};return Object.keys(l).forEach(n=>{const v=l[n],c=Array.isArray(v)?v:v?[v]:[];t[n]=c.map(d=>{const f=Te((d==null?void 0:d.marks)??(d==null?void 0:d.marks_json)??{});return{...d,marks:f&&typeof f=="object"?f:{},strengths:Te(d==null?void 0:d.strengths),gaps:Te(d==null?void 0:d.gaps),suggestions:Te(d==null?void 0:d.suggestions)}})}),t}const Xe=p(()=>Number(J.params.employeeId)),At=e=>{var d;P.value=e.employee||{},G.value=(e==null?void 0:e.annual_target_avg_marks)||null,H.value=(e==null?void 0:e.annual_performance_avg_marks)||null,lt.value=Array.isArray(e==null?void 0:e.lanes)?e.lanes.map(ws):[],at.value=$s((e==null?void 0:e.reviews_by_lane)||{}),Ke.value=!!(((d=e==null?void 0:e.meta)==null?void 0:d.is_hr)??(e==null?void 0:e.hr)??!1),k.value={},(Array.isArray(Se.value)?Se.value:[]).forEach(f=>{(Array.isArray(f==null?void 0:f.items)?f.items:[]).forEach(N=>{k.value[N.id]=0})});const l=Pe(U.value),n=Y.value,v=Q.value;!Nt(n,l)&&v&&Nt(v,l),V.value&&O.value.length&&O.value.forEach(f=>{Pe(f).forEach(N=>{let E=v?ut(v,N):"";(E===""||E==null)&&(E=dt(N)),E!==""&&E!=null&&(k.value[N]=Number(E))})})},Fs=async e=>{var t,l;if(e){j.value=!0,z.value="";try{await L.fetchActiveCycle(e);const n=await L.fetchLanes(L.cycle.id,e);At(n)}catch(n){z.value=((l=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:l.message)||(n==null?void 0:n.message)||"Failed to load KPI review data."}finally{j.value=!1}}},Ct=async()=>{var e,t,l;if(!(!Xe.value||!((e=L.cycle)!=null&&e.id))){j.value=!0,z.value="";try{const n=await L.fetchLanes(L.cycle.id,Xe.value);At(n)}catch(n){z.value=((l=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:l.message)||(n==null?void 0:n.message)||"Failed to refresh KPI review data."}finally{j.value=!1}}};me(Xe,async(e,t)=>{!e||t&&e===t||await Fs(e)},{immediate:!0});async function Ss(){var n,v,c;const e=Number(J.params.employeeId),t=(n=L.cycle)==null?void 0:n.id,l=Y.value;if(!t||!e)return alert("Invalid cycle/employee.");if(!l||!U.value)return alert("Unable to determine personal reviewer lane.");try{await L.submitReview({cycle_id:t,employee_id:e,reviewer_lane:l,marks:St(U.value),strengths:"",gaps:"",suggestions:""}),await Ct(),alert("Personal review submitted")}catch(d){const f=((c=(v=d==null?void 0:d.response)==null?void 0:v.data)==null?void 0:c.message)||(d==null?void 0:d.message)||"Failed to submit personal review.";alert(f)}}async function Ls(){var n,v,c;const e=Number(J.params.employeeId),t=(n=L.cycle)==null?void 0:n.id,l=Q.value;if(!t||!e)return alert("Invalid cycle/employee.");if(!l)return alert("Unable to determine HR reviewer lane.");try{await L.submitReview({cycle_id:t,employee_id:e,reviewer_lane:l,marks:Lt(O.value),strengths:X.value,gaps:ie.value,suggestions:ue.value}),await Ct(),alert("HR review submitted")}catch(d){const f=((c=(v=d==null?void 0:d.response)==null?void 0:v.data)==null?void 0:c.message)||(d==null?void 0:d.message)||"Failed to submit HR review.";alert(f)}}function W(e){const t=Number(e??0);return isNaN(t)?"0.00":t.toFixed(2)}function ce(e,t){const l=Number(e??0),n=Number(t??0);return n>0?Math.round(l/n*100):0}return(e,t)=>{var l,n,v,c,d,f,S,N,E,je,Re,ve,Ge,ge,he,Mt,Et,It,Pt,Tt,jt,Rt,Gt,Ht,zt,Dt,Bt,Kt,Ot,Qt;return re.value?(o(),r("div",Pl,[s("div",Tl,[s("div",null,[s("div",jl,i(Fe.value),1),s("div",Rl," Year "+i(D.value)+" / Group "+i($e.value),1)]),u.value?(o(),r("div",Gl," Lane: "+i(tt(u.value)),1)):h("",!0)]),s("div",Hl,[(o(!0),r(C,null,M(b.value,m=>(o(),r("button",{key:m,type:"button",class:oe(["rounded-full border px-3 py-1 text-xs font-semibold transition",m===u.value?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-600 border-slate-200 hover:border-slate-300"]),onClick:A=>u.value=m},i(tt(m)),11,zl))),128))]),g.value?(o(),r("div",Dl," Loading KPI items... ")):K.value?(o(),r("div",Bl,i(K.value),1)):(o(),r("div",Kl,[a.value.length?(o(),r("div",Ql,[(o(!0),r(C,null,M(a.value,m=>(o(),r("div",{key:m.id,class:"rounded-xl border border-slate-200 bg-white p-3"},[s("div",Vl,[s("div",ql,[s("div",{class:"text-sm font-semibold text-slate-900 truncate",title:m.title},i(m.title),9,Ul),s("div",Yl,[m.weight!=null?(o(),r("span",Wl,"Weight: "+i(m.weight),1)):h("",!0),m.maxScore!=null?(o(),r("span",Jl," / Max: "+i(m.maxScore),1)):h("",!0)])]),s("div",Xl,[xe(s("select",{"onUpdate:modelValue":A=>y.value[m.id]=A,class:"rounded-lg border border-slate-300 bg-white px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50"},[(o(!0),r(C,null,M(Wt(m.maxScore),A=>(o(),r("option",{key:A,value:A},i(A),9,ea))),128))],8,Zl),[[Cs,y.value[m.id],void 0,{number:!0}]])])]),s("div",ta,[t[7]||(t[7]=s("label",{class:"block text-[11px] font-medium text-slate-500"},"Comment (optional)",-1)),xe(s("textarea",{"onUpdate:modelValue":A=>_.value[m.id]=A,rows:"2",class:"mt-1 w-full rounded-lg border border-slate-200 px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/40",placeholder:"Add a note if needed"},null,8,sa),[[He,_.value[m.id]]])])]))),128))])):(o(),r("div",Ol," No KPI items found for this lane. "))])),s("div",la,[s("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50 disabled:opacity-50",disabled:B.value||g.value||!a.value.length,onClick:t[0]||(t[0]=m=>st(!1))},i(B.value?"Saving...":"Save Draft"),9,aa),s("button",{type:"button",class:"rounded-lg bg-emerald-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-emerald-700 disabled:opacity-50",disabled:B.value||g.value||!a.value.length,onClick:t[1]||(t[1]=m=>st(!0))},i(B.value?"Saving...":"Submit"),9,na)])])):(o(),r("div",oa,[z.value?(o(),r("div",ra,i(z.value),1)):h("",!0),j.value?(o(),r("div",ia," Loading KPI review... ")):(o(),r(C,{key:2},[s("header",ua,[s("div",da,[s("div",ca,[s("div",va,[t[8]||(t[8]=s("span",{class:"text-xs font-semibold text-indigo-700"},"KPI Cycle",-1)),s("span",ma,i((l=se(L).cycle)==null?void 0:l.title),1)]),s("div",xa,[s("div",pa,i(((n=P.value)==null?void 0:n.name)||"Employee"),1),s("div",ba,[(c=(v=P.value)==null?void 0:v.designation)!=null&&c.title?(o(),r("span",fa,[t[9]||(t[9]=te(" Designation: ")),s("span",ya,i(P.value.designation.title),1)])):h("",!0),(f=(d=P.value)==null?void 0:d.department)!=null&&f.name?(o(),r("span",ga,[t[10]||(t[10]=te(" Department: ")),s("span",ha,i(P.value.department.name),1)])):h("",!0),s("span",_a,[t[14]||(t[14]=te(" Reviewing as: ")),ns.value?(o(),r("span",ka,[s("span",wa,i(Y.value),1),t[11]||(t[11]=s("span",{class:"text-slate-400"},"+",-1)),s("span",$a,i(Q.value),1),t[12]||(t[12]=s("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," dual mode ",-1))])):it.value?(o(),r("span",Fa,t[13]||(t[13]=[s("span",{class:"font-semibold text-emerald-700"},"HR",-1),s("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," HR mode ",-1)]))):(o(),r("span",Sa,i(qe.value||"No lane"),1))])])])]),s("div",La,[s("div",Na,[t[15]||(t[15]=s("div",{class:"text-[11px] uppercase tracking-wide text-slate-500"}," Personal group total ",-1)),s("div",Aa,[te(i(fe.value.got.toFixed(2))+" ",1),s("span",Ca,"/ "+i(fe.value.max.toFixed(2)),1)]),s("div",Ma,i(fe.value.percent.toFixed(2))+"% achieved ",1)]),Ke.value?(o(),r("button",{key:0,onClick:t[2]||(t[2]=m=>se(L).submitFinalResult(se(L).cycle.id,se(J).params.employeeId)),class:"inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-medium text-white shadow hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-300 focus:outline-none"},t[16]||(t[16]=[s("span",null,"Finalize & Lock",-1)]))):h("",!0)])])]),(S=P.value)!=null&&S.active_criteria?(o(),r("div",Ea,[s("section",Ia,[s("button",{type:"button",class:"w-full flex items-center justify-between border-b bg-slate-50 px-4 py-2 text-left",onClick:gs},[t[17]||(t[17]=s("div",{class:"text-sm font-semibold text-slate-800"},"কার্যসম্পাদন বিষয়",-1)),s("div",Pa,i(de.value?"Hide":"Show"),1)]),xe(s("div",null,[((E=(N=P.value)==null?void 0:N.active_criteria)==null?void 0:E.length)===0?(o(),r("div",Ta," -- ")):h("",!0),(o(!0),r(C,null,M(P.value.active_criteria,m=>(o(),r("div",{class:"p-4 text-sm text-slate-700",key:m.id},[s("div",{class:"print:block richtext print:break-inside-avoid",innerHTML:m==null?void 0:m.description},null,8,ja)]))),128))],512),[[Es,de.value]])])])):h("",!0),se(L).cycle&&U.value?(o(),et(Ut,{key:1,group:U.value,"is-personal":!0,lanes:Qe.value,"editable-lane-key":Y.value,"can-edit":Ne.value,marks:k.value,"header-label":"Personal Evaluation","item-label":((je=U.value)==null?void 0:je.label)||"Personal","helper-text":ee.value?"All reviewer lanes score the Personal table.":Ne.value&&V.value?"Submit Personal and HR reviews separately using the buttons below.":"Fill only your lane; others appear as read-only.","serial-map":hs.value,"get-lane-mark":ut,"on-mark-change":ct,"on-cap":be,"on-quick-fill-item":vt},null,8,["group","lanes","editable-lane-key","can-edit","marks","item-label","helper-text","serial-map"])):h("",!0),Ne.value?(o(),r("div",Ra,[s("div",Ga,[t[18]||(t[18]=te(" Personal total: ")),s("b",Ha,i(fe.value.got.toFixed(2)),1),s("span",za,"/ "+i(fe.value.max.toFixed(2)),1)]),s("button",{onClick:Ss,disabled:!_s.value,class:"inline-flex items-center justify-center rounded-xl bg-slate-900 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-slate-800 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-slate-300"}," Submit Personal ",8,Da)])):h("",!0),s("section",Ba,[s("div",Ka,[O.value.length?(o(),r("div",Oa,[(o(!0),r(C,null,M(O.value,(m,A)=>(o(),et(Ut,{key:A,group:m,"is-personal":!1,"can-edit":V.value,marks:k.value,"header-label":`Group ${A+1} - ${Zt(m,A)}`,"item-label":"Item","show-quick-fill-group":!0,"auto-fill-visible":ft.value&&_t(m,q.value),"auto-fill-label":ps.value,"on-auto-fill":()=>kt(q.value,{overwrite:!0}),"get-hr-mark":dt,"on-mark-change":ct,"on-cap":be,"on-quick-fill-group":os},null,8,["group","can-edit","marks","header-label","auto-fill-visible","auto-fill-label","on-auto-fill"]))),128))])):h("",!0),s("aside",{class:oe(["space-y-4 sticky top-10 z-50",[O.value.length===0?"lg:col-span-full":"lg:col-span-2"]])},[!ee.value&&rs.value&&V.value?(o(),r("section",Qa,[s("header",Va,[t[19]||(t[19]=s("span",null,"Annual Summary",-1)),s("div",qa,[s("span",Ua,i(gt.value),1),Ue.value?(o(),r("span",Ya," Year "+i(Ue.value),1)):h("",!0),s("span",Wa,i(yt.value)+" month(s) ",1)])]),s("div",Ja,[s("div",Xa,[(o(),r(C,null,M(mt,m=>s("button",{key:m.key,type:"button",onClick:A=>q.value=m.key,class:oe(["px-3 py-1 rounded-full text-xs font-semibold transition",q.value===m.key?"bg-slate-900 text-white shadow":"border border-slate-200 text-slate-700 bg-white hover:border-slate-400"])},i(m.label),11,Za)),64))]),s("div",en,[s("div",tn,[s("div",sn,[s("div",ln,[t[20]||(t[20]=s("span",{class:"text-xs font-medium text-slate-600"},"Incharge",-1)),s("span",an,i(ce((Re=F.value.per_scored_month)==null?void 0:Re.incharge,(ve=F.value.per_scored_month)==null?void 0:ve.max))+"% ",1)]),s("div",nn,[te(i(W((Ge=F.value.per_scored_month)==null?void 0:Ge.incharge))+" ",1),s("span",on,"/ "+i(W((ge=F.value.per_scored_month)==null?void 0:ge.max)),1)]),s("div",rn,[s("div",{class:"h-2 bg-blue-500",style:R({width:ce((he=F.value.per_scored_month)==null?void 0:he.incharge,(Mt=F.value.per_scored_month)==null?void 0:Mt.max)+"%"})},null,4)])]),s("div",un,[s("div",dn,[t[21]||(t[21]=s("span",{class:"text-xs font-medium text-slate-600"},"Coordinator",-1)),s("span",cn,i(ce((Et=F.value.per_scored_month)==null?void 0:Et.coordinator,(It=F.value.per_scored_month)==null?void 0:It.max))+"% ",1)]),s("div",vn,[te(i(W((Pt=F.value.per_scored_month)==null?void 0:Pt.coordinator))+" ",1),s("span",mn,"/ "+i(W((Tt=F.value.per_scored_month)==null?void 0:Tt.max)),1)]),s("div",xn,[s("div",{class:"h-2 bg-violet-500",style:R({width:ce((jt=F.value.per_scored_month)==null?void 0:jt.coordinator,(Rt=F.value.per_scored_month)==null?void 0:Rt.max)+"%"})},null,4)])]),s("div",pn,[s("div",bn,[t[22]||(t[22]=s("span",{class:"text-xs font-medium text-slate-600"},"Final",-1)),s("span",fn,i(ce((Gt=F.value.per_form_yearly)==null?void 0:Gt.final,(Ht=F.value.per_scored_month)==null?void 0:Ht.max))+"% ",1)]),s("div",yn,[te(i(W((zt=F.value.per_form_yearly)==null?void 0:zt.final))+" ",1),s("span",gn,"/ "+i(W((Dt=F.value.per_scored_month)==null?void 0:Dt.max)),1)]),s("div",hn,[s("div",{class:"h-2 bg-emerald-500",style:R({width:ce((Bt=F.value.per_form_yearly)==null?void 0:Bt.final,(Kt=F.value.per_scored_month)==null?void 0:Kt.max)+"%"})},null,4)])])]),s("div",_n,[s("button",{class:"text-xs px-3 py-1.5 rounded-md border hover:bg-slate-50",onClick:t[3]||(t[3]=m=>ae.value=!ae.value)},i(ae.value?"Hide details":"Show "+gt.value+" details"),1),ae.value?(o(),r("div",kn,[s("div",wn,[t[23]||(t[23]=s("div",{class:"text-slate-500"},"Year",-1)),s("div",$n,i(Ue.value||"-"),1),t[24]||(t[24]=s("div",{class:"text-slate-500"},"Months counted",-1)),s("div",Fn,i(yt.value),1),t[25]||(t[25]=s("div",{class:"text-slate-500"},"Max",-1)),s("div",Sn,i(W((Ot=F.value.per_scored_month)==null?void 0:Ot.max)),1),t[26]||(t[26]=s("div",{class:"text-slate-500"},"Final avg",-1)),s("div",Ln,i(W((Qt=F.value.per_form_yearly)==null?void 0:Qt.final)),1),t[27]||(t[27]=s("div",{class:"text-slate-500"},"Percent (simple)",-1)),s("div",Nn,i(W(F.value.percent_simple))+"%",1),t[28]||(t[28]=s("div",{class:"text-slate-500"},"Percent (weighted)",-1)),s("div",An,i(W(F.value.percent_weighted))+"%",1)])])):h("",!0)])])])])):h("",!0),Ae.value.length?(o(),r("section",Cn,[s("header",Mn,[t[29]||(t[29]=s("span",null,"Review Comments",-1)),s("span",En,i(Ae.value.length)+" lane(s) ",1)]),s("div",In,[s("div",Pn,[s("table",Tn,[t[31]||(t[31]=s("thead",{class:"text-[11px] text-slate-600 uppercase tracking-wide bg-slate-50"},[s("tr",null,[s("th",{class:"px-2 py-2 w-[140px]"},"Lane"),s("th",{class:"px-2 py-2 text-right"},"Details")])],-1)),s("tbody",null,[(o(!0),r(C,null,M(Ae.value,m=>(o(),r("tr",{key:m.key,class:"border-t hover:bg-slate-50/60 align-top"},[s("td",jn,[s("div",Rn,i(m.label),1),m.submitted_at?(o(),r("div",Gn,i(new Date(m.submitted_at).toLocaleDateString()),1)):h("",!0)]),s("td",Hn,[s("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:A=>fs(m)},t[30]||(t[30]=[s("span",null,"View comments",-1),s("span",{class:"text-[10px] text-slate-400"},"Strengths · Gaps · Suggestions",-1)]),8,zn)])]))),128))])])])])])):h("",!0)],2)])]),Ne.value||V.value?(o(),r("section",Dn,[t[38]||(t[38]=s("header",{class:"flex items-center justify-between mb-1"},[s("div",null,[s("h2",{class:"text-sm font-semibold text-slate-800"},"Overall Review Notes"),s("p",{class:"text-[11px] text-slate-500"},"Use saved hints or write your own detailed comments.")])],-1)),s("div",Bn,[s("div",Kn,[s("header",On,[t[32]||(t[32]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-emerald-500 text-base leading-none"},"★"),s("span",null,"Strengths")],-1)),Ce.value.length?(o(),r("span",Qn,i(Ce.value.length)+" saved hint(s) ",1)):h("",!0)]),Ce.value.length?(o(),r("div",Vn,[s("div",qn,[(o(!0),r(C,null,M(Ce.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("strengths",m),disabled:Ie("strengths",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,Un))),128))])])):h("",!0),s("div",Yn,[t[33]||(t[33]=s("label",{class:"text-[11px] font-medium text-slate-500"}," Key Strength(s) ",-1)),xe(s("textarea",{"onUpdate:modelValue":t[4]||(t[4]=m=>X.value=m),placeholder:"e.g. Strong ownership, proactive problem solving…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[He,X.value]])])]),s("div",Wn,[s("header",Jn,[t[34]||(t[34]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-amber-500 text-base leading-none"},"!"),s("span",null,"Gaps")],-1)),Me.value.length?(o(),r("span",Xn,i(Me.value.length)+" saved hint(s) ",1)):h("",!0)]),Me.value.length?(o(),r("div",Zn,[s("div",eo,[(o(!0),r(C,null,M(Me.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("gaps",m),disabled:Ie("gaps",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-amber-300 hover:bg-amber-50 hover:text-amber-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,to))),128))])])):h("",!0),s("div",so,[t[35]||(t[35]=s("label",{class:"text-[11px] font-medium text-slate-500"},"GAP(s)",-1)),xe(s("textarea",{"onUpdate:modelValue":t[5]||(t[5]=m=>ie.value=m),placeholder:"e.g. Needs improvement in documentation, communication…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-amber-200"},null,512),[[He,ie.value]])])]),s("div",lo,[s("header",ao,[t[36]||(t[36]=s("div",{class:"flex items-center gap-1"},[s("span",{class:"text-sky-500 text-base leading-none"},"✱"),s("span",null,"Suggestions / Training")],-1)),Ee.value.length?(o(),r("span",no,i(Ee.value.length)+" common suggestion(s) ",1)):h("",!0)]),Ee.value.length?(o(),r("div",oo,[s("div",ro,[(o(!0),r(C,null,M(Ee.value,m=>(o(),r("button",{key:m,type:"button",onClick:A=>Je("suggestions",m),disabled:Ie("suggestions",m),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-sky-300 hover:bg-sky-50 hover:text-sky-800 disabled:opacity-40 disabled:cursor-not-allowed"},i(m),9,io))),128))])])):h("",!0),s("div",uo,[t[37]||(t[37]=s("label",{class:"text-[11px] font-medium text-slate-500"}," Suggestions / Development plan ",-1)),xe(s("textarea",{"onUpdate:modelValue":t[6]||(t[6]=m=>ue.value=m),placeholder:"Specific actions, training plans, timeline and expectations…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-sky-200"},null,512),[[He,ue.value]])])])])])):h("",!0),s("div",co,[t[39]||(t[39]=s("div",{class:"text-sm text-slate-600"},"HR review (other groups)",-1)),s("div",vo,[V.value?(o(),r("button",{key:0,onClick:Ls,disabled:!ks.value,class:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-emerald-700 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-emerald-300"}," Submit HR Review ",8,mo)):h("",!0)])]),Ms(Ts,{name:"fade-scale"},{default:Is(()=>{var m,A,Vt;return[Ye.value&&T.value?(o(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:Ps(We,["escape","window"])},[s("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:We}),s("div",xo,[s("div",po,[s("div",null,[s("p",bo,i(T.value.label),1),s("p",fo," Lane: "+i(T.value.lane)+" - Reviewed by "+i(T.value.reviewer_name||"––"),1),T.value.submitted_at?(o(),r("p",yo,i(new Date(T.value.submitted_at).toLocaleString()),1)):h("",!0)]),s("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:We}," Close ")]),s("div",go,[s("div",null,[t[40]||(t[40]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Strengths",-1)),s("div",ho,[(m=T.value.strengths)!=null&&m.length?(o(),r("div",_o,[(o(!0),r(C,null,M(T.value.strengths,(_e,ke)=>(o(),r("p",{key:"modal-strength-"+ke},"- "+i(_e),1))),128))])):(o(),r("p",ko,"No strengths entered."))])]),s("div",null,[t[41]||(t[41]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Gaps",-1)),s("div",wo,[(A=T.value.gaps)!=null&&A.length?(o(),r("div",$o,[(o(!0),r(C,null,M(T.value.gaps,(_e,ke)=>(o(),r("p",{key:"modal-gap-"+ke},"- "+i(_e),1))),128))])):(o(),r("p",Fo,"No gaps recorded."))])]),s("div",null,[t[42]||(t[42]=s("div",{class:"text-xs font-semibold text-slate-500 uppercase"},"Suggestions",-1)),s("div",So,[(Vt=T.value.suggestions)!=null&&Vt.length?(o(),r("div",Lo,[(o(!0),r(C,null,M(T.value.suggestions,(_e,ke)=>(o(),r("p",{key:"modal-sug-"+ke},"- "+i(_e),1))),128))])):(o(),r("p",No,"No suggestions provided."))])])])])],32)):h("",!0)]}),_:1})],64))]))}}},Io={__name:"KpiReviewPage",setup(x){return($,J)=>(o(),et(Co))}};export{Io as default};
