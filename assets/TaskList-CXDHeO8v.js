import{_ as ne}from"./CommentModal-BotW2_kg.js";import{u as re,O as X,_ as ie}from"./task-priority-CLWW-vjT.js";import{L as ue}from"./LoaderView-B3C55RfA.js";import{_ as Y,a as de}from"./TaskAddForm-DhFu9fUs.js";import{_ as me}from"./TaskEditForm-Bj429hW-.js";import{b as te,q as v,s as pe,e as se,A as le,c as m,o,a as t,f as x,w as H,m as I,h as a,p as $,l as C,g as M,C as ce,D as j,v as ye,F as E,x as z,y as O,u as fe,r as U,E as ke,k as ve,t as Z,n as ee}from"./index-Cm3H2O_d.js";import{_ as be}from"./MultiselectDropdown-7IRT_Okm.js";import{u as ge}from"./company-_aBE4E1r.js";import{_ as ae}from"./UserChip-C2tfULM-.js";import{_ as oe}from"./TaskTreeView-CVwPHbXG.js";import{u as xe}from"./useTaskStore-Bmdse3li.js";import"./useCommentStore-tklK0exu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-B9ojG9MU.js";import"./useRequirementStore-D4AXF-Xs.js";import"./SectionLoading-B3ZmYvpk.js";import"./vue-multiselect.esm-CB4WH6hy.js";import"./datetime-BISRKKpq.js";const we={class:"mb-3 task-header"},Ce={class:"flex justify-between items-center"},Te={class:"ml-auto flex gap-6 items-center"},_e={key:0,class:"flex gap-2 items-center"},Ve={class:"flex flex-wrap items-center gap-2 mt-3"},qe={class:"flex flex-wrap gap-4 w-full"},Ie={key:2,class:"relative w-full md:w-72"},$e={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Ue={class:"text-gray-600 w-40 relative"},Le={class:"flex gap-4 items-center flex-shrink-0"},Se={class:"flex gap-2"},he={class:"flex gap-2"},Ae={class:"flex gap-2"},De={class:"text-gray-600 w-full md:w-40 md:ml-auto relative"},Me={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(h,{emit:y}){const s=h,w=te(),V=v(c("from-department-id")),b=v(c("to-department-id")),q=v(c("user-ids")),n=v(c("month")),u=v(c("status")),d=v(c("is-important")),f=v(c("is-urgent")),k=v(c("is-target")),g=y,T=ge(),{employees:L}=pe(T);function c(i){return{get:()=>s.modelValue[i]||"",set:e=>{g("update:modelValue",{...s.modelValue,[i]:e||void 0})}}}const S=v(()=>P(q.value));async function B(i){i&&await T.fetchEmployee(i)}async function N(){if(b.value){const i=T.companies.find(e=>e.departments.some(l=>l.id==b.value));await T.fetchEmployee(i.id)}}se(async()=>{var i,e;await T.fetchCompanies({with:"departments",ignore_permission:!0}),(i=s.modelValue)!=null&&i["company-id"]&&await B((e=s.modelValue)==null?void 0:e["company-id"])});function P(i){return Array.isArray(L.value)&&L.value.find(e=>e.id==i)||null}function F(i){q.value=(i==null?void 0:i.id)||""}function R(){q.value=""}return le(()=>b.value,N),(i,e)=>{var l,A;return o(),m("div",we,[t("div",Ce,[e[11]||(e[11]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",Te,[h.listHasRearranged?(o(),m("div",_e,[e[10]||(e[10]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=H(r=>g("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=H(r=>g("clickPriorityDiscard"),["prevent"]))},"Discard")])):x("",!0),t("button",{onClick:e[2]||(e[2]=r=>g("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",Ve,[t("div",qe,[a(w).name!=="MyTaskList"?(o(),I(Y,{key:0,modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=r=>V.value=r),companies:((l=a(T))==null?void 0:l.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"}},{label:$(()=>e[12]||(e[12]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," From Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),a(w).name!=="MyTaskList"?(o(),I(Y,{key:1,modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=r=>b.value=r),companies:((A=a(T))==null?void 0:A.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"}},{label:$(()=>e[13]||(e[13]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," To Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),a(w).name!=="MyTaskList"?(o(),m("div",Ie,[C(be,{modelValue:S.value,onSelect:F,onRemove:R,options:a(L),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employees",class:"text-gray-600 w-full"},{option:$(({option:r})=>[C(ae,{user:r,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),S.value?(o(),m("div",$e,[t("button",{onClick:H(R,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):x("",!0),e[14]||(e[14]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):x("",!0),t("div",Ue,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),M(t("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>u.value=r),class:"input-1"},e[15]||(e[15]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[ce,u.value]])]),t("div",Le,[t("label",Se,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=r=>d.value=r)},null,512),[[j,d.value]]),e[17]||(e[17]=t("span",null,"Important",-1))]),t("label",he,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=r=>f.value=r)},null,512),[[j,f.value]]),e[18]||(e[18]=t("span",null,"Urgent",-1))]),t("label",Ae,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=r=>k.value=r)},null,512),[[j,k.value]]),e[19]||(e[19]=t("span",null,"Is Target",-1))])]),t("div",De,[e[20]||(e[20]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),M(t("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=r=>n.value=r),type:"month",class:"input-1",placeholder:"All month"},null,512),[[ye,n.value]])])])])])}}},Ee={class:"w-full bg-white rounded"},Be=["rowspan"],Pe={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(h,{emit:y}){const s=h,w=y,V=v(()=>s.tasks.reduce((n,u)=>(n.push(...u.users.filter(d=>!n.find(f=>f.id==d.id&&d.id))),n),[]).filter(n=>s.selectedUserId?n.id==s.selectedUserId:!0)),b=n=>s.tasks.filter(f=>f.users.some(k=>k.id===n)),q=v(()=>V.value.map(n=>{const u=b(n.id);return{...n,tasks:u}}));return(n,u)=>(o(),m("div",null,[t("table",Ee,[t("tbody",null,[(o(!0),m(E,null,z(q.value,d=>(o(),m(E,{key:d.id},[(o(!0),m(E,null,z(d.tasks,(f,k)=>(o(),m("tr",{key:f.id},[k==0?(o(),m("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(d.tasks.length,1)},[C(ae,{user:d,class:"sticky top-[80px]"},null,8,["user"])],8,Be)):x("",!0),t("td",{class:O(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":k==0,"border-b":d.tasks.length-1===k}])},[C(oe,{task:f,class:"!border-0 my-0",index:k,onCommentButtonClick:u[0]||(u[0]=g=>w("commentButtonClick",n.item.id)),onEditClick:u[1]||(u[1]=g=>w("editClick",g)),onAddClick:u[2]||(u[2]=g=>w("addClick",g))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Re={class:"container mx-auto p-6 relative"},Ne={class:"mb-4"},Fe={class:"w-full flex justify-end gap-5 mb-1"},He={key:3},je={key:0,class:"text-center py-4 text-red-500"},ze={key:1},Oe={class:"flex items-stretched"},We={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Ge=1,pt={__name:"TaskList",setup(h){const y=xe(),s=te(),w=fe(),V=U(!1),b=U(null),q=U(!1),n=U(null),u=U(!1),d=ke({parentId:0,requirementId:0}),f=U(null),k=U([]),{handleItemsPriorityUpdate:g,saveTaskPriority:T,listHasRearranged:L}=re(()=>y.taskListTree,0);se(async()=>{s.query.status||w.push({query:{...s.query,status:"not-completed"}}),await c()});async function c(){q.value=!!s.query["user-ids"];const e=await y.fetchTasks({...s.query},{newList:!0,loadingBeforeFetch:!0});k.value=e.query_log||[]}const S=e=>{u.value=!0,d.parentId=e},B=e=>{b.value=e,V.value=!0},N=()=>{V.value=!1,b.value=null};async function P(){n.value=null,u.value=!1,d.parentId=0,await c()}async function F(){u.value=!1,d.parentId=0,await c()}async function R(){T()&&await c()}le(()=>({...s.query}),async()=>{await c()});const i=v({get(){return{...s.query}},set(e){localStorage.removeItem("sub_task_opened_list"),w.push({query:{...e}})}});return(e,l)=>{var r,W,G,J,K,Q;const A=ve("RouterLink");return o(),m("div",Re,[n.value?(o(),I(X,{key:0},{default:$(()=>[C(me,{taskId:n.value,onClose:l[0]||(l[0]=p=>n.value=null),onUpdated:P},null,8,["taskId"])]),_:1})):x("",!0),u.value?(o(),I(X,{key:1},{default:$(()=>[C(de,{parentTaskId:d.parentId,requirementId:d.requirementId,onClose:F,onTaskCreated:P},null,8,["parentTaskId","requirementId"])]),_:1})):x("",!0),C(Me,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=p=>i.value=p),onClickAddTask:S,onClickPrioritySave:R,onClickPriorityDiscard:l[2]||(l[2]=()=>a(L)?f.value.resetItems:null),"list-has-rearranged":a(L),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((W=(r=a(s))==null?void 0:r.query)==null?void 0:W["query-log"])=="true"?(o(!0),m(E,{key:2},z(k.value,(p,_)=>(o(),m("div",{key:_,class:"text-xs text-gray-500"},[t("div",Ne,Z(p.raw_query),1)]))),128)):x("",!0),t("div",Fe,[a(s).name!=="MyTaskList"?(o(),I(A,{key:0,class:O(["text-sm btn-3 py-0.5",((G=a(s).query)==null?void 0:G.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...a(s).query,view:"userwise"}}},{default:$(()=>l[9]||(l[9]=[ee(" User Wise List ")])),_:1,__:[9]},8,["class","to"])):x("",!0),a(s).name!=="MyTaskList"?(o(),I(A,{key:1,class:O(["text-sm btn-3 py-0.5",((J=a(s).query)==null?void 0:J.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((K=a(s))==null?void 0:K.query)||{}).filter(p=>{var _;return((_=a(s))==null?void 0:_.query[p])!=="userwise"}).reduce((p,_)=>({...p,[_]:a(s).query[_]}),{})}}},{default:$(()=>l[10]||(l[10]=[ee(" TaskWise List ")])),_:1,__:[10]},8,["class","to"])):x("",!0)]),a(y).loading?(o(),m("div",He,[C(ue)])):(o(),m(E,{key:4},[a(y).error?(o(),m("div",je,Z(a(y).error),1)):a(y).tasks.length>0?(o(),m("div",ze,[((Q=a(s).query)==null?void 0:Q.view)=="userwise"?(o(),I(Pe,{key:0,tasks:a(y).tasks,selectedUserId:a(s).query["user-ids"],onCommentButtonClick:l[3]||(l[3]=p=>B(p,e.task.id)),onEditClick:l[4]||(l[4]=p=>n.value=p),onAddClick:l[5]||(l[5]=p=>S(p))},null,8,["tasks","selectedUserId"])):(o(),I(ie,{key:1,items:a(y).tasks,handle:"handle",onItemsUpdate:a(g),class:"space-y-4",ref_key:"draggableTaskList",ref:f},{item:$(({item:p,index:_})=>[t("div",Oe,[C(oe,{task:p,index:_,showDraggableHandle:!q.value,onCommentButtonClick:l[6]||(l[6]=D=>B(D,e.task.id)),onEditClick:l[7]||(l[7]=D=>n.value=D),onAddClick:l[8]||(l[8]=D=>S(D)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(o(),m("div",We," No tasks found. "))],64)),C(ne,{show:V.value,"commentable-id":b.value,"commentable-type":"task","user-id":Ge,"on-close":N,onSubmitted:a(y).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{pt as default};
