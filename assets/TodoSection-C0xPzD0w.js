import{L as X}from"./LoaderView-TCV5H681.js";import{r as P,x as F,e as K,A as H,c as y,o as a,L,a as o,F as B,y as G,t as S,g,w as D,q as W,n as U,f as R,I as ie,i as M,k as T,d as oe,m as de,j as A,J as ne,K as fe,M as ge,V as be,h as re,v as ue,W as Y,X as _}from"./index-CIjS4kno.js";import{f as ke,h as ce,b as Q,g as J,i as he,j as xe}from"./datetime-DcVwRp76.js";import{u as V}from"./useTodoStore-C-QTW-HU.js";import{_ as we}from"./DraggableList.vue_vue_type_script_setup_true_lang-BkoYdy9e.js";import{_ as Ce}from"./UserChip-BSENd8QR.js";import{O as ee}from"./OverlyModal-LfUASW9J.js";import{u as $e}from"./useTaskStore-CzRBZSaA.js";const Te={class:"grid grid-cols-7 *:text-center *:p-2 *:border-r *:border-b *:text-blue-800 *:text-sm"},De={class:"flex flex-col"},Se={key:0,class:"p-2 border-r border-t"},Ie={__name:"CalenderView",props:{month:{type:String,required:!0,validator:t=>/^\d{4}-(0[1-9]|1[0-2])$/.test(t)}},emits:["change"],setup(t,{emit:C}){const d=t,n=C,m=P(),e=P(),i=P(),v=P(),l=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function r(x,u,k,$){const w=[];for(let j=k-1;j>=0;j--){const f=$-j,I=new Date(x,u-1,f);w.push({date:I,day:I.getDate(),month:I.getMonth()+1,year:I.getFullYear(),isCurrentMonth:!1})}return w}function b(x,u,k){const $=[];for(let w=1;w<=k;w++){const f={date:new Date(x,u,w),day:w,month:u+1,year:x,isCurrentMonth:!0};$.push(f)}return $}function p(x,u,k){const $=[...x],w=Math.ceil($.length/7)*7,j=1;for(let f=0;$.length<w;f++){const I=new Date(u,k+1,j+f);$.push({date:I,day:I.getDate(),month:I.getMonth()+1,year:I.getFullYear(),isCurrentMonth:!1})}return $}function s(x,u){const k=new Date(x,u,1),w=new Date(x,u+1,0).getDate(),f=(k.getDay()+1)%7,E=new Date(x,u,0).getDate();let N=[];N=[...r(x,u,f,E)];const z=b(x,u,w);return i.value=z[0],v.value=z[z.length-1],N=[...N,...z],N=[...p(N,x,u)],m.value=N[0],e.value=N[N.length-1],N}const c=F(()=>{const[x,u]=d.month.split("-"),k=parseInt(x),$=parseInt(u)-1;return console.log({yearStr:x,monthStr:u}),s(k,$)}),h=F(()=>{const x=c.value,u=[];for(let k=0;k<x.length;k+=7)u.push(x.slice(k,k+7));return u});function O(){n("change",{gridStartDate:m.value,gridEndDate:e.value,startOfMonth:i.value,endOfMonth:v.value})}return K(()=>O()),H(()=>d.month,O),(x,u)=>(a(),y("div",null,[L(x.$slots,"calender-top"),o("div",Te,[(a(),y(B,null,G(l,k=>o("div",{key:k},S(k),1)),64))]),o("div",De,[(a(!0),y(B,null,G(h.value,(k,$)=>(a(),y("div",{class:"week grid grid-cols-7 min-h-28 items-stretch",key:$},[(a(!0),y(B,null,G(k,(w,j)=>L(x.$slots,"date",{key:j,day:w.day,month:w.month,year:w.year,weekday:(w.date.getDay()+1)%7,isCurrentMonth:w.isCurrentMonth,yearMonthDate:`${w.year}-${String(w.month).padStart(2,"0")}-${String(w.day).padStart(2,"0")}`},()=>{var f;return[w!=null&&w.date?(a(),y("div",Se,S((f=w==null?void 0:w.date)==null?void 0:f.getDate()),1)):g("",!0)]})),128))]))),128))]),L(x.$slots,"calender-bottom")]))}},Me={class:"px-4 py-2 flex items-center lg:justify-start flex-wrap bg-gray-50 group md:gap-x-2 gap-y-4"},Ee=["disabled"],Re=["value"],Oe=["value"],Ne={key:2,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},Le=["value"],je={key:3,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},Pe=["value"],Ue={__name:"TodoHeading",props:{selected:{type:Object,default:()=>({type:"month-view",month:"",day:"",year:"",week:""})},loading:{type:Boolean,default:!1}},emits:["reloadClick",,"change"],setup(t,{emit:C}){const d=t,n=[{value:"month-view",label:"Monthly"},{value:"day-view",label:"Daily"}],m=C,e=P();function i(u){e.value=u,m("change",{...d.selected,type:u})}H(()=>{var u;return(u=d.selected)==null?void 0:u.type},u=>i(u),{immediate:!0});const v=F(()=>e.value=="month-view"&&d.selected.year&&d.selected.month?[d.selected.year,d.selected.month-1,1]:e.value=="day-view"&&d.selected.year&&d.selected.month&&d.selected.day?[d.selected.year,d.selected.month-1,d.selected.day]:[new Date().getFullYear(),new Date().getMonth(),new Date().getDate()]);function l(){e.value=="month-view"&&h(new Date)}function r(){if(e.value=="month-view"){const u=new Date(...v.value);u.setMonth(u.getMonth()+1),h(u)}}function b(){if(e.value=="month-view"){const u=new Date(...v.value);u.setMonth(u.getMonth()-1),h(u)}}function p(){e.value=="day-view"&&h(new Date)}function s(){if(e.value=="day-view"){const u=new Date(...v.value);u.setDate(u.getDate()+1),h(u)}}function c(){if(e.value=="day-view"){const u=new Date(...v.value);u.setDate(u.getDate()-1),h(u)}}function h(u){m("change",{type:e.value,month:u.getMonth()+1,day:u.getDate(),year:u.getFullYear(),week:u.getDay()})}const O=F(()=>e.value=="month-view"?`${d.selected.year}-${d.selected.month.toString().padStart(2,"0")}`:e.value=="day-view"?`${d.selected.year}-${d.selected.month.toString().padStart(2,"0")}-${d.selected.day.toString().padStart(2,"0")}`:d.selected),x=u=>{var k,$;if(e.value=="month-view"){const[w,j]=(k=u.target.value)==null?void 0:k.split("-").map(Number),f=new Date(w,j-1,1);h(f)}if(e.value=="day-view"){const w=new Date(($=u.target)==null?void 0:$.value);h(w)}};return(u,k)=>(a(),y("div",null,[o("div",Me,[L(u.$slots,"before",{selected:t.selected}),o("button",{class:W(["px-2 py-2 disabled:text-gray-300 border size-[32px] flex items-center justify-center rounded-full",{"animate-spin !bg-opacity-0":t.loading}]),onClick:k[0]||(k[0]=D($=>m("reloadClick"),["prevent"])),disabled:t.loading},[o("i",{class:W(["fas fa-redo",[t.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,Ee),L(u.$slots,"typeSelection",{selected:t.selected,types:n,changeType:i},()=>[o("select",{class:"px-2 h-7 border rounded",value:e.value,onChange:k[1]||(k[1]=$=>i($.target.value))},[(a(),y(B,null,G(n,$=>o("option",{value:$.value,key:$.id},S($.label),9,Oe)),64))],40,Re)]),e.value=="month-view"?(a(),y("button",{key:0,class:"h-7",onClick:D(l,["prevent"])})):g("",!0),e.value=="day-view"?(a(),y("button",{key:1,class:"h-7",onClick:D(p,["prevent"])})):g("",!0),L(u.$slots,"inner",{selected:t.selected}),e.value=="month-view"?(a(),y("div",Ne,[o("button",{class:"btn-3 px-3 rounded h-7",onClick:D(b,["prevent"])},k[2]||(k[2]=[o("span",{class:"fas fa-arrow-left"},null,-1)])),e.value=="month-view"?(a(),y("input",{key:0,type:"month",value:O.value,onInput:x,class:"border-2 px-2 rounded border-blue-900"},null,40,Le)):g("",!0),o("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:D(r,["prevent"])},k[3]||(k[3]=[o("span",{class:"fas fa-arrow-right"},null,-1)]))])):g("",!0),e.value=="day-view"?(a(),y("div",je,[o("button",{class:"btn-3 px-3 rounded h-7",onClick:D(c,["prevent"])},k[4]||(k[4]=[o("span",{class:"fas fa-arrow-left"},null,-1)])),e.value=="day-view"?(a(),y("input",{key:0,type:"date",value:O.value,onInput:x,class:"border-2 px-2 rounded border-blue-900 w-28"},null,40,Pe)):g("",!0),o("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:D(s,["prevent"])},k[5]||(k[5]=[o("span",{class:"fas fa-arrow-right"},null,-1)]))])):g("",!0),L(u.$slots,"after",{selected:t.selected})]),L(u.$slots,"bottom",{selected:t.selected})]))}},Fe={key:0,class:"fa fa-exclamation-square",title:"Pending"},ze={key:1,class:"fa fa-pause",title:"Working"},Ae={key:2,class:"fa fa-check-square",title:"Completed"},se={__name:"TodoStatusIcon",props:{todo:{type:Object,required:!0}},setup(t){const C=t,d=F(()=>{switch(C.todo.status){case"PENDING":return"text-red-400";case"WORKING":return"text-yellow-600";case"COMPLETED":return"text-green-400"}return""});return(n,m)=>(a(),y("span",{class:W(d.value)},[t.todo.status=="PENDING"?(a(),y("i",Fe)):g("",!0),t.todo.status=="WORKING"?(a(),y("i",ze)):g("",!0),t.todo.status=="COMPLETED"?(a(),y("i",Ae)):g("",!0)],2))}},Be=["title","onClick"],We={class:"line-clamp-1"},qe={key:0,class:"text-purple-600 text-center"},me={__name:"TodosInDate",props:{date:{type:String,required:!0},maxItems:{type:[Number,String],default:3}},emits:["clickTodo"],setup(t,{emit:C}){const d=t,n=C,{getTodosByDate:m}=V(),e=F(()=>{let i=[],v=!1,l=[];if(typeof m=="function"){const r=m(d.date);if(l=Array.isArray(r)?r:[],d.maxItems==="all")return{all:l,items:l,moreItemsCount:0};i=l.slice(0,d.maxItems),v=l.length-i.length}return{all:l,items:i,moreItemsCount:v}});return(i,v)=>(a(),y("div",null,[e.value.items.length===0?L(i.$slots,"noTodos",{key:0},()=>[v[0]||(v[0]=o("div",{class:"text-gray-400 text-center"},"No todos",-1))]):(a(),y(B,{key:1},[L(i.$slots,"todoItems",{todos:e.value.items,allTodos:e.value.items,moreItemsCount:e.value.moreItemsCount},()=>[(a(!0),y(B,null,G(e.value.items,l=>L(i.$slots,"todoItem",{key:l.id,todo:l,moreItemsCount:e.value.moreItemsCount},()=>{var r,b,p,s;return[o("div",{title:`${l==null?void 0:l.title} ${l!=null&&l.user?`
by:`:""} ${(r=l==null?void 0:l.user)==null?void 0:r.name} ${(b=l==null?void 0:l.user)!=null&&b.department?`
DEPT:`:""} ${(s=(p=l.user)==null?void 0:p.department)==null?void 0:s.name}`,class:W(["px-1 mb-2 text-sm rounded cursor-pointer flex items-center gap-2",{"bg-sky-50 text-sky-900 hover:bg-sky-700 hover:text-white border border-sky-300":l.status!=="COMPLETED","bg-green-500 text-white":l.status==="COMPLETED"}]),onClick:D(c=>n("clickTodo",l),["prevent","stop"])},[U(se,{todo:l,class:W(["text-sm",[l.status=="COMPLETED"?"!text-white":""]])},null,8,["todo","class"]),o("div",We,S(l.title),1),l.user?(a(),R(ie,{key:0,user:l.user,size:"xsmall",class:"ml-auto"},null,8,["user"])):g("",!0)],10,Be)]})),128))]),e.value.moreItemsCount>0?(a(),y("div",qe," + "+S(e.value.moreItemsCount)+" more todo"+S(e.value.moreItemsCount>1?"s":""),1)):g("",!0)],64))]))}},Ge={class:"relative"},Ve=["onClick","onKeypress"],He={class:"flex items-center justify-center"},Ke=["onClick"],Ye={__name:"TodosInCalenderView",props:{month:{type:String,required:!0,validator:t=>/^\d{4}-(0[1-9]|1[0-2])$/.test(t)}},emits:["dateClick","clickTodo","clickDateCell"],setup(t,{emit:C}){const d=C;function n(e,i){e.isTrusted&&e.ctrlKey&&e.which==10&&d("dateClick",i)}function m(e){const[i,v,l]=String(e).split("-").map(Number),r=new Date(i,v-1,l);return ce(r)}return(e,i)=>(a(),y("div",Ge,[t.month?(a(),R(Ie,{key:0,month:t.month,class:"border-t border-blue-200/50 relative"},{date:M(({day:v,month:l,yearMonthDate:r,isCurrentMonth:b})=>[o("div",{tabindex:"0",class:W(["border p-4 cursor-pointer group/date relative focus:outline-slate-400",{"bg-sky-50   border-sky-300 focus:bg-sky-50 focus:outline-sky-400":m(r),"hover:bg-slate-50  hover:border-slate-300 focus:bg-slate-50 ":!m(r)}]),onClick:D(p=>d("dateClick",r),["prevent","stop"]),onKeypress:D(p=>n(p,r),["prevent"])},[o("button",{tabindex:"1",class:W([{"text-gray-300 hover:bg-sky-200  hover:text-white":!b,"text-sky-400 hover:bg-sky-200":b},"text-center mb-2 font-semibold w-full rounded"])},S(v)+" "+S(b?"":T(ke)(l-1)),3),o("div",null,[U(me,{date:r,onClickTodo:i[0]||(i[0]=p=>d("clickTodo",p))},{noTodos:M(()=>i[1]||(i[1]=[o("span",null,null,-1)])),_:2},1032,["date"])]),o("div",He,[o("button",{onClick:D(p=>d("clickDateCell",r),["prevent","stop"]),class:"btn-3 !py-1 invisible group-hover/date:visible text-sm text-red-800/40"},i[2]||(i[2]=[o("i",{class:"fas fa-plus"},null,-1),o("span",{class:"hidden lg:inline whitespace-nowrap"}," Add todo ",-1)]),8,Ke)])],42,Ve)]),_:1},8,["month"])):g("",!0)]))}},_e={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},ye={__name:"DepartmentChip",props:{department:Object},setup(t){return(C,d)=>{var n;return a(),y("div",_e,S((n=t.department)==null?void 0:n.name),1)}}},Je={class:""},Xe={key:0,class:"mt-1 flex items-center gap-2"},Qe={key:0,class:"line-clamp-2 text-gray-500 whitespace-nowrap mr-2"},Ze={class:"md:ml-auto w-full md:w-auto flex items-center justify-center gap-2"},et={key:0,class:"flex items-center gap-1 text-red-600"},tt={__name:"TodoItemCard",props:{todo:{type:Object,required:!0},hideDepartment:{type:Boolean,default:!1},hideUser:{type:Boolean,default:!1},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","clickDelete","clickChangeStatus","clickDelete"],setup(t,{emit:C}){const d=oe(),n=C;return(m,e)=>{var v,l,r;const i=de("RouterLink");return a(),y("div",{class:W(["px-4 py-4 md:py-2 cursor-pointer flex flex-wrap items-center gap-y-2 gap-x-4",{"bg-green-100":t.todo.status=="COMPLETED","hover:bg-gray-50":t.todo.status!="COMPLETED"}]),onClick:e[4]||(e[4]=D(b=>n("clickTodo",t.todo),["prevent"]))},[U(se,{todo:t.todo},null,8,["todo"]),o("div",Je,[o("div",{class:W(["line-clamp-1",{"text-green-800":t.todo.status=="COMPLETED","text-blue-800":t.todo.status!="COMPLETED"}])},S(t.todo.id)+" - "+S(t.todo.title),3),t.todo.user?(a(),y("div",Xe,[t.hideUser?g("",!0):(a(),R(Ce,{key:0,user:t.todo.user,"avatar-size":"xsmall"},null,8,["user"])),t.hideDepartment?g("",!0):(a(),R(ye,{key:1,department:(l=(v=t.todo)==null?void 0:v.user)==null?void 0:l.department},null,8,["department"]))])):g("",!0)]),t.todo.todo_type&&t.todo.todo_type_id?(a(),y("div",Qe,[A(S(t.todo.todo_type)+" ",1),U(i,{class:"text-blue-600 font-semibold underline hover:text-sky-400",onClick:D(b=>null,["stop"]),to:{name:t.userRole=="employee"?"MyTaskShow":"TaskShow",params:{id:t.todo.todo_type_id}}},{default:M(()=>[e[5]||(e[5]=o("i",{class:"fas fa-link"},null,-1)),A(" "+S(t.todo.todo_type_id),1)]),_:1,__:[5]},8,["to"])])):g("",!0),o("div",Ze,[t.todo.status=="WORKING"?(a(),y("div",et,e[6]||(e[6]=[o("span",{class:"fas fa-circle animate-pulse text-xs"},null,-1),o("span",{class:"text-xs"},"Working",-1)]))):g("",!0),t.todo.user_id===((r=T(d).user)==null?void 0:r.id)?(a(),y(B,{key:1},[t.todo.status==="WORKING"?(a(),y("button",{key:0,title:"Mark as Completed",class:"btn-icon bg-transparent text-green-400 border-green-400 border hover:bg-green-400 hover:text-white",onClick:e[0]||(e[0]=D(()=>n("clickChangeStatus",t.todo,"COMPLETED"),["prevent","stop"]))},e[7]||(e[7]=[o("i",{class:"fas fa-check"},null,-1)]))):g("",!0),t.todo.status==="PENDING"?(a(),y("button",{key:1,title:"Start Working",class:"btn-icon bg-transparent text-red-400 border-red-400 border hover:bg-red-400 hover:text-white",onClick:e[1]||(e[1]=D(()=>n("clickChangeStatus",t.todo,"WORKING"),["prevent","stop"]))},e[8]||(e[8]=[o("i",{class:"fas fa-play ml-[4px]"},null,-1)]))):g("",!0),o("button",{class:"btn-icon bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:e[2]||(e[2]=D(b=>n("clickEdit",t.todo),["prevent","stop"]))},e[9]||(e[9]=[o("i",{class:"fas fa-pen"},null,-1)])),o("button",{class:"btn-icon bg-red-400 text-white hover:bg-red-600 hover:text-white",onClick:e[3]||(e[3]=D(()=>n("clickDelete",t.todo),["prevent","stop"]))},e[10]||(e[10]=[o("i",{class:"fas fa-trash-alt"},null,-1)]))],64)):g("",!0),o("button",{onClick:D(()=>null,["stop","prevent"]),class:"btn-icon bg-gray-400 text-white hover:bg-gray-600 hover:text-white handle"},e[11]||(e[11]=[o("i",{class:"fas fa-arrows-alt-v"},null,-1)]))])],2)}}},ot={class:"border rounded-md"},nt={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},st={class:"font-semibold flex items-center gap-2"},lt={class:"text-white text-base"},at={class:"ml-auto flex items-center gap-2"},it={key:0,class:"flex items-center gap-3 mr-6"},dt=["disabled"],rt=["disabled"],ut=["date"],ct={key:1,class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"},mt={__name:"UserTodos",props:{todos:{type:Array,required:!0},user:{type:Object,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","update"],setup(t,{emit:C}){const d=t,n=P(null),m=C,e=V();async function i(r){confirm(`Are your sure want to delete todo
'${r==null?void 0:r.title}'`)&&(await e.deleteTodo(r.id),m("update"))}async function v(r,b){confirm(`Are your sure?
want to change status to ${b} 
todo: '${r==null?void 0:r.title}'`)&&(await e.updateTodoStatus(r.id,b),m("update"))}async function l(){var b;const r=(b=n==null?void 0:n.value.items)==null?void 0:b.map(p=>p.id);await e.rearrangeMyTodos(r,{date:d.date}),m("update")}return(r,b)=>{var p,s;return a(),y("div",ot,[o("div",nt,[o("div",st,[U(ie,{user:t.user},null,8,["user"]),o("div",lt,S(t.user.label),1)]),o("div",at,[(p=n.value)!=null&&p.isItemsChanged?(a(),y("div",it,[o("button",{onClick:b[0]||(b[0]=D(()=>l(),["prevent"])),class:"btn-2 disabled:opacity-40 disabled:pointer-events-none",disabled:T(e).updatingPriority}," Save Rearranged ",8,dt),o("button",{onClick:b[1]||(b[1]=D(()=>n.value.resetItems(),["prevent"])),class:"btn-3 disabled:opacity-40 disabled:pointer-events-none",disabled:T(e).updatingPriority}," Discard ",8,rt)])):g("",!0),U(ye,{department:(s=t.user)==null?void 0:s.department,class:"px-2"},null,8,["department"])])]),o("div",{date:r.date,"max-items":"all",class:"w-full"},[t.todos.length>0?(a(),R(we,{key:0,items:t.todos,ref_key:"draggableTodos",ref:n,handle:"handle"},{item:M(({item:c})=>[U(tt,{todo:c,onClickTodo:h=>m("clickTodo",h),onClickEdit:h=>m("clickEdit",h),onClickDelete:h=>i(h),onClickChangeStatus:(h,O)=>v(h,O),"hide-department":"","hide-user":"",class:"border-b border-sky-200",userRole:t.userRole},null,8,["todo","onClickTodo","onClickEdit","onClickDelete","onClickChangeStatus","userRole"])]),_:1},8,["items"])):g("",!0),t.todos.length===0?(a(),y("div",ct," No Todos ")):g("",!0)],8,ut)])}}},yt={class:"relative bg-white p-4"},vt={key:0,class:"text-red-500 text-sm border border-red-300 max-w-6xl mx-auto py-2 gap-2 shadow-sm rounded flex items-center px-3"},pt={class:"max-w-6xl mx-auto border rounded my-5"},ft={class:"text-gray-700 border-b py-2 px-4 flex items-center"},gt={class:"text-lg font-semibold flex items-center gap-2"},bt={key:0,class:"rounded-md border text-xs px-2 py-[1px] text-red-500 border-red-500 bg-red-50"},kt={key:0,class:"ml-auto flex items-center gap-2"},ht={__name:"TodosInDailyView",props:{date:{type:String,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickAdd","clickEdit","clickDelete","clickChangeStatus","backClick","update"],setup(t,{emit:C}){const d=t,n=C,m=oe(),e=V(),i=F(()=>new Date(d.date)),v=l=>{if(d.userRole=="employee")return[{...m.user,todos:l}];const r={};return l.forEach(b=>{const p=b.user.id;r[p]||(r[p]={...b.user,todos:[]}),r[p].todos.push(b)}),Object.values(r)};return(l,r)=>(a(),y("div",yt,[T(e).error?(a(),y("div",vt,[r[5]||(r[5]=o("i",{class:"fad fa-exclamation-circle"},null,-1)),o("div",null,S(T(e).error),1)])):g("",!0),o("div",pt,[o("div",ft,[o("button",{class:"fa fa-arrow-left btn-icon mr-2",onClick:r[0]||(r[0]=D(b=>n("backClick"),["prevent"]))}),o("div",gt,[A(S(T(Q)(i.value,{weekDay:"long"}))+" ",1),T(ce)(t.date)?(a(),y("span",bt,"Today")):g("",!0)]),t.userRole=="employee"?(a(),y("div",kt,[o("button",{class:"btn btn-icon",onClick:r[1]||(r[1]=D(b=>n("clickAdd",d.date),["prevent"]))},r[6]||(r[6]=[o("i",{class:"fas fa-plus"},null,-1)]))])):g("",!0)]),U(me,{date:t.date,"max-items":"all",class:"w-full space-y-4 p-2"},{todoItems:M(({allTodos:b})=>[(a(!0),y(B,null,G(v(b),p=>(a(),R(mt,{key:p.id,todos:(p==null?void 0:p.todos)||[],user:p,onClickTodo:r[2]||(r[2]=s=>n("clickTodo",s)),onClickEdit:r[3]||(r[3]=s=>n("clickEdit",s)),onUpdate:r[4]||(r[4]=s=>n("update")),"user-role":t.userRole},null,8,["todos","user","user-role"]))),128))]),noTodos:M(()=>r[7]||(r[7]=[o("div",{class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"}," No Todos ",-1)])),_:1},8,["date"])])]))}},xt={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md"},wt={key:0,class:"mb-4 text-red-500 font-medium"},Ct={key:1,class:"mb-4 text-blue-500 font-medium"},$t={class:"flex justify-between items-center gap-4"},Tt=["disabled"],ve={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(t,{emit:C}){const d=C;return(n,m)=>(a(),y("form",{onSubmit:m[1]||(m[1]=D(e=>d("submit"),["prevent"]))},[L(n.$slots,"default"),o("div",xt,[t.error?(a(),y("div",wt,S(t.error),1)):g("",!0),t.isSubmitting?(a(),y("div",Ct,"Saving changes...")):g("",!0),L(n.$slots,"footer",{},()=>[o("div",$t,[o("button",{type:"button",onClick:m[0]||(m[0]=e=>d("clickCancel")),class:"btn-3"},"Cancel"),o("button",{disabled:t.isSubmitting||t.isLoading,type:"submit",class:"btn-2"},S(t.isSubmitting?"Saving...":"Save"),9,Tt)])])])],32))}},Dt={class:"px-2 border-b py-3 over text-sm relative"},St={class:"flex items-center py-1"},te={__name:"TodoInputTaskItem",props:{task:Object,level:Number,selected:Number},emits:["select"],setup(t,{emit:C}){const d=C;return(n,m)=>{var e,i,v;return a(),y("div",Dt,[o("div",St,[o("div",{class:W(["line-clamp-2 mr-4 ",{"text-red-50 bg-green-800 px-2":t.task.id==t.selected},{"hover:text-blue-500":t.task.id!=t.selected}])},S(t.task.id)+" - "+S(t.task.title),3),o("button",{class:"border btn-2 ml-auto",onClick:m[0]||(m[0]=D(()=>d("select",t.task),["prevent"]))}," Select ")]),(i=(e=t.task)==null?void 0:e.children_tasks)!=null&&i.length?L(n.$slots,"children",{key:0,childrenTasks:(v=t.task)==null?void 0:v.children_tasks,level:t.level+1}):g("",!0)])}}},It={class:"border"},Mt={class:"border ml-4 mt-4"},Et={class:"border ml-4 mt-4"},pe={__name:"TodoTypeInput",props:{todoType:{type:String,default:"task"},todoTypeId:{type:[String,Number],default:null},show:{type:Boolean,default:!1}},emits:["update:todoType","update:todoTypeId","update:show"],setup(t,{emit:C}){const d=t,n=C,m=F({get:()=>d.todoType,set:c=>n("update:todoType",c)}),e=F({get:()=>d.todoTypeId,set:c=>n("update:todoTypeId",c)}),i=F({get:()=>d.show,set:c=>n("update:show",c)}),v=P(null),l=P({});function r(){if(!(v!=null&&v.value))return;const c=v.value.getBoundingClientRect(),h=window.innerHeight,O=300,u=h-c.bottom<O;l.value={position:"fixed",top:u?c.top-O+"px":c.bottom+"px",left:c.left+"px",width:c.width+"px",zIndex:5e3}}function b(c){e.value=c.id,i.value=!1}function p(c){e.value="",i.value=!1}K(async()=>{await ne(),window.addEventListener("resize",r),document.addEventListener("scroll",r),i.value=!0,m.value="task"});const s=$e();return H(()=>i.value,async c=>{c&&await s.fetchMyTasks()}),fe(()=>{window.removeEventListener("resize",r),document.removeEventListener("scroll",r)}),(c,h)=>(a(),y("div",{class:"relative",ref_key:"anchor",ref:v},[o("div",{class:W(["w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 cursor-pointer flex items-center",e.value?"":"text-gray-400"]),onClick:h[0]||(h[0]=D(()=>{i.value=!0,r()},["stop"]))},[A(S(e.value||"Click to select todo")+" ",1),e.value?(a(),y("button",{key:0,class:"btn-icon fas fa-times !size-8 text-sm ml-auto",onClick:D(p,["prevent","stop"])})):g("",!0)],2),(a(),R(be,{to:"body"},[i.value?(a(),y("div",{key:0,style:ge(l.value),class:"fixed h-[300px] bg-white rounded-b-md overflow-y-auto shadow-lg border z-[5000] p-4"},[o("div",It,[(a(!0),y(B,null,G(T(s).tasks,O=>(a(),R(te,{key:O.id,task:O,onSelect:b,selected:e.value,class:"group/main"},{children:M(({childrenTasks:x})=>[o("div",Mt,[(a(!0),y(B,null,G(x,u=>(a(),R(te,{key:u.id,task:u,onSelect:b,selected:e.value},{children:M(({childrenTasks:k})=>[o("div",Et,[(a(!0),y(B,null,G(k,$=>(a(),R(te,{key:$.id,task:$,onSelect:b,selected:e.value},null,8,["task","selected"]))),128))])]),_:2},1032,["task","selected"]))),128))])]),_:2},1032,["task","selected"]))),128))])],4)):g("",!0)]))],512))}},Rt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Ot={class:"mb-2"},Nt={class:"mb-4"},Lt={class:"mb-4"},jt={__name:"TodoAddForm",props:{date:{type:String,default:J(new Date)},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(t,{emit:C}){const d=t,n=P(),m=P(!1),e=P(),i=V(),v=C,l=P({title:"",date:d.date||"",todo_type:"",todo_type_id:""});async function r(){var p;try{n.value="submitting",(p=l.value)!=null&&p.todo_type_id||(l.value={title:l.value.title,date:l.value.date}),await i.createTodo(l.value,{returnWith:d.userRole!=="employee"?"user,department,company":""}),v("update")}finally{n.value=""}}const b=F(()=>new Date(d.date));return K(async()=>{var p;await ne(),(p=e.value)==null||p.focus()}),(p,s)=>(a(),y("div",{onClick:s[5]||(s[5]=c=>m.value=!1)},[T(i).loading?(a(),R(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>s[6]||(s[6]=[A(" Loading... ")])),_:1,__:[6]})):g("",!0),U(ve,{onSubmit:r,onClickCancel:s[4]||(s[4]=c=>v("cancelClick")),isSubmitting:n.value=="submitting",error:T(i).error,class:"rounded-md relative"},{default:M(()=>[s[10]||(s[10]=o("div",{class:"border-b py-2 px-4"},[o("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),o("div",Rt,[o("div",Ot,[s[7]||(s[7]=o("span",{class:"font-semibold"}," Date ",-1)),o("span",null,S(T(Q)(b.value,{weekDay:"long"})),1)]),o("div",Nt,[s[8]||(s[8]=o("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),re(o("input",{ref_key:"titleRef",ref:e,"onUpdate:modelValue":s[0]||(s[0]=c=>l.value.title=c),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[ue,l.value.title]])]),o("div",Lt,[s[9]||(s[9]=o("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),U(pe,{show:m.value,"onUpdate:show":s[1]||(s[1]=c=>m.value=c),todoType:l.value.todo_type,"onUpdate:todoType":s[2]||(s[2]=c=>l.value.todo_type=c),todoTypeId:l.value.todo_type_id,"onUpdate:todoTypeId":s[3]||(s[3]=c=>l.value.todo_type_id=c)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","error"])]))}},Pt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Ut={class:"mb-2"},Ft={class:"mb-4"},zt={class:"mb-4"},At={__name:"TodoEditForm",props:{date:{type:String,default:J(new Date)},todo:{type:Object,default:()=>{}}},emits:["update","cancelClick"],setup(t,{emit:C}){const d=t,n=P(),m=P(!1),e=P(),i=V(),v=C,l=P({title:"",todo_type:"task",todo_type_id:""});async function r(){var s,c,h;await i.fetchTodo((s=d.todo)==null?void 0:s.id),l.value.title=(c=i.todo)==null?void 0:c.title,l.value.todo_type_id=(h=i.todo)==null?void 0:h.todoable_id}async function b(){n.value="submitting",console.log({form:l.value});try{await i.updateTodo(d.todo.id,l.value),v("update")}finally{n.value=""}}const p=F(()=>new Date(d.todo.date));return K(async()=>{var s;await r(),await ne(),(s=e.value)==null||s.focus()}),(s,c)=>(a(),y("div",{class:"relative",onClick:c[5]||(c[5]=h=>m.value=!1)},[T(i).loading?(a(),R(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>c[6]||(c[6]=[A(" Loading... ")])),_:1,__:[6]})):g("",!0),U(ve,{onSubmit:b,onClickCancel:c[4]||(c[4]=h=>v("cancelClick")),isSubmitting:n.value=="submitting",isLoading:T(i).loading,error:T(i).error,id:"todoEditForm"},{default:M(()=>[c[10]||(c[10]=o("div",{class:"border-b py-2 px-4"},[o("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),o("div",Pt,[o("div",Ut,[c[7]||(c[7]=o("span",{class:"font-semibold"}," Date ",-1)),o("span",null,S(T(Q)(p.value,{weekDay:"long"})),1)]),o("div",Ft,[c[8]||(c[8]=o("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),re(o("input",{ref_key:"titleRef",ref:e,"onUpdate:modelValue":c[0]||(c[0]=h=>l.value.title=h),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[ue,l.value.title]])]),o("div",zt,[c[9]||(c[9]=o("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),U(pe,{show:m.value,"onUpdate:show":c[1]||(c[1]=h=>m.value=h),todoType:l.value.todo_type,"onUpdate:todoType":c[2]||(c[2]=h=>l.value.todo_type=h),todoTypeId:l.value.todo_type_id,"onUpdate:todoTypeId":c[3]||(c[3]=h=>l.value.todo_type_id=h)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","isLoading","error"])]))}},Bt={class:"relative"},Wt={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},qt={class:"mb-4"},Gt={class:"mb-4"},Vt={key:0,class:"mt-1 flex items-center gap-2"},Ht={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},Kt={class:"flex items-center gap-4"},Yt={key:0,class:"flex items-center gap-2"},_t={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},Jt={key:0,class:"ml-auto flex items-center gap-2"},Xt={__name:"TodoShow",props:{todo:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update"],setup(t,{emit:C}){const d=t,n=V(),m=oe(),e=C;async function i(){var p;await n.fetchTodo((p=d.todo)==null?void 0:p.id)}const v=F(()=>{var p,s;return(p=n.todo)!=null&&p.date?new Date((s=n.todo)==null?void 0:s.date):null}),l=F(()=>{var p;return d.todo.user_id===((p=m.user)==null?void 0:p.id)});async function r(p){var s;confirm(`Are your sure want to delete todo
'${(s=n.todo)==null?void 0:s.title}'`)&&(await n.deleteTodo(p.id),e("update"))}async function b(p,s){var c;confirm(`Are your sure want to compete todo
'${(c=n.todo)==null?void 0:c.title}'`)&&(await n.updateTodoStatus(p.id,s),e("update"))}return K(async()=>{await i()}),(p,s)=>{var h,O,x,u,k,$,w,j;const c=de("UserChip");return a(),y("div",Bt,[T(n).loading?(a(),R(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>s[5]||(s[5]=[A(" Loading... ")])),_:1,__:[5]})):g("",!0),o("div",null,[s[11]||(s[11]=o("div",{class:"border-b py-2 px-4"},[o("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),o("div",Wt,[o("div",qt,[s[6]||(s[6]=o("div",{class:"font-semibold text-xs text-gray-500"},"Date",-1)),o("span",null,S(T(Q)(v.value,{weekDay:"long"})),1)]),o("div",Gt,[s[7]||(s[7]=o("div",{class:"text-xs text-gray-500"},"Todo",-1)),A(" "+S((h=T(n).todo)==null?void 0:h.title),1)]),t.todo.user?(a(),y("div",Vt,[U(c,{user:t.todo.user,"avatar-size":"xsmall"},null,8,["user"]),o("div",Ht,S((x=(O=t.todo.user)==null?void 0:O.department)==null?void 0:x.name),1)])):g("",!0),o("div",null,[s[10]||(s[10]=o("div",{class:"text-xs text-gray-500"},"Status",-1)),o("div",Kt,[o("div",null,[(u=T(n))!=null&&u.todo?(a(),R(se,{key:0,todo:(k=T(n))==null?void 0:k.todo},null,8,["todo"])):g("",!0),A(" "+S(($=T(n).todo)==null?void 0:$.status),1)]),l.value&&!T(n).loading?(a(),y("div",Yt,[((w=T(n).todo)==null?void 0:w.status)==="PENDING"?(a(),y("button",{key:0,class:"btn-2 from-yellow-700 to-yellow-500 text-white hover:bg-green-600 hover:text-white",onClick:s[0]||(s[0]=D(()=>b(T(n).todo,"WORKING"),["prevent","stop"]))},s[8]||(s[8]=[o("i",{class:"fas fa-exclamation-circle"},null,-1),A(" Change to Working ")]))):g("",!0),((j=T(n).todo)==null?void 0:j.status)==="WORKING"?(a(),y("button",{key:1,class:"btn-2 from-green-700 to-green-300 text-white hover:bg-green-600 hover:text-white",onClick:s[1]||(s[1]=D(()=>b(T(n).todo,"COMPLETED"),["prevent","stop"]))},s[9]||(s[9]=[o("i",{class:"fas fa-check"},null,-1),A(" Make Complete ")]))):g("",!0)])):g("",!0)])])])]),o("div",_t,[o("button",{type:"button",onClick:s[2]||(s[2]=f=>e("cancelClick")),class:"btn-3"},"Cancel"),l.value&&!T(n).loading?(a(),y("div",Jt,[o("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:s[3]||(s[3]=D(f=>e("clickEdit",T(n).todo),["prevent","stop"]))},s[12]||(s[12]=[o("i",{class:"fas fa-pen"},null,-1),A(" Edit ")])),o("button",{class:"btn-2-red",onClick:s[4]||(s[4]=D(()=>r(T(n).todo),["prevent","stop"]))},s[13]||(s[13]=[o("i",{class:"fas fa-trash-alt"},null,-1),A(" Delete ")]))])):g("",!0)])])}}},Qt={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","update","clickEdit","clickDelete","clickChangeStatus"],setup(t,{emit:C}){const d=C;function n(){d("update")}return(m,e)=>(a(),y(B,null,[t.todoModal.action=="add"?(a(),R(ee,{key:0},{default:M(()=>{var i;return[U(jt,{onCancelClick:e[0]||(e[0]=v=>d("cancelClick")),onUpdate:n,date:(i=t.todoModal)==null?void 0:i.date,userRole:t.userRole},null,8,["date","userRole"])]}),_:1})):g("",!0),t.todoModal.action=="edit"?(a(),R(ee,{key:1},{default:M(()=>{var i;return[U(At,{onCancelClick:e[1]||(e[1]=v=>d("cancelClick")),onUpdate:n,todo:(i=t.todoModal)==null?void 0:i.todo,userRole:t.userRole},null,8,["todo","userRole"])]}),_:1})):g("",!0),t.todoModal.action=="show"?(a(),R(ee,{key:2},{default:M(()=>{var i;return[U(Xt,{onCancelClick:e[2]||(e[2]=v=>d("cancelClick")),onUpdate:n,onClickEdit:e[3]||(e[3]=v=>d("clickEdit",v)),onClickDelete:e[4]||(e[4]=v=>d("clickDelete",v)),onClickChangeStatus:e[5]||(e[5]=(v,l)=>d("clickChangeStatus",v,l)),todo:(i=t.todoModal)==null?void 0:i.todo,userRole:t.userRole},null,8,["todo","userRole"])]}),_:1})):g("",!0)],64))}},Zt={class:"border bg-white relative"},ro={__name:"TodoSection",props:{year:{type:Number,default:()=>new Date().getFullYear()},month:{type:Number,default:()=>new Date().getMonth()+1},day:{type:Number,default:()=>new Date().getDate()},week:{type:Number,default:()=>new Date().getDay()},type:{type:String,default:"month-view"},companyId:{type:String,default:""},departmentId:{type:String,default:""},employeeId:{type:String,default:""},lineType:{type:String,default:""},status:{type:String,default:""},userRole:{type:String,default:"employee"}},emits:["changeInput"],setup(t,{emit:C}){const d=new Date,n=t,m=P({type:"month-view",month:d.getMonth()+1,day:d.getDate(),year:d.getFullYear(),week:d.getDay()}),e=C;H(()=>({...m.value}),f=>{e("changeInput",f)}),H(()=>({year:n.year,month:n.month,day:n.day,week:n.week,type:n.type}),f=>{m.value={...f}},{immediate:!0});const i=P({action:null}),v=V();async function l(){await j()}function r(){i.value={...i.value,action:""}}async function b(f,I){await v.updateTodoStatus(f,I)}async function p(f){await v.deleteTodo(f)}function s(){m.value={...m.value,type:"month-view"}}function c(f){m.value={...m.value,...f}}function h(f){const[I,E,N]=f.split("-").map(Number);m.value={...m.value,type:"day-view",year:I,month:E,day:N}}function O(f){i.value={...i.value,action:"show",todo:f}}function x(f){i.value={...i.value,action:"edit",todo:f}}function u(f){i.value={...i.value,action:"add",date:f}}function k(){i.value={action:null,todo:null}}const $=F(()=>{var N,q,z,Z,le,ae;const f=(q=(N=m.value)==null?void 0:N.year)==null?void 0:q.toString(),I=(Z=(z=m.value)==null?void 0:z.month)==null?void 0:Z.toString().padStart(2,"0"),E=(ae=(le=m.value)==null?void 0:le.day)==null?void 0:ae.toString().padStart(2,"0");return`${f}-${I}-${E}`}),w=F(()=>{var E,N,q,z;const f=(N=(E=m.value)==null?void 0:E.year)==null?void 0:N.toString(),I=(z=(q=m.value)==null?void 0:q.month)==null?void 0:z.toString().padStart(2,"0");return`${f}-${I}`});async function j(){const[f,I]=[Number(n.year),Number(n.month)],E=J(new Date(f,I-1,1)),N=J(he(f,I-1));console.log("FETCHING...",{startDate1:E,endDate1:N});const[q,z]=xe(f,I-1);console.log("FETCHING...",{startDate:q,endDate:z}),n.userRole=="employee"?await v.fetchMyTodos({"start-date":q,"end-date":z}):await v.fetchTodos({"company-id":n.companyId,"department-id":n.departmentId,"employee-id":n.employeeId,"line-type":n.lineType,"start-date":q,"end-date":z,status:n.status})}return K(async()=>{await j()}),H(()=>({"company-id":n.companyId,"department-id":n.departmentId,"employee-id":n.employeeId,"line-type":n.lineType,status:n.status,month:n.month}),()=>j()),(f,I)=>(a(),y("div",null,[o("div",Zt,[T(v).loading?(a(),R(X,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>I[0]||(I[0]=[A(" Loading... ")])),_:1,__:[0]})):g("",!0),U(Ue,{selected:m.value,class:"border-b shadow z-20",onChange:c,onReloadClick:l},{before:M(E=>[L(f.$slots,"beforeHeader",Y(_(E)))]),inner:M(E=>[L(f.$slots,"innerHeader",Y(_(E)))]),after:M(E=>[L(f.$slots,"afterHeader",Y(_(E)))]),bottom:M(E=>[L(f.$slots,"bottomHeader",Y(_(E)))]),typeSelection:M(E=>[L(f.$slots,"typeSelection",Y(_(E)))]),_:3},8,["selected"]),m.value.type=="month-view"?(a(),R(Ye,{key:1,month:w.value,class:"bg-white",onDateClick:h,onClickTodo:O,onClickDateCell:u},null,8,["month"])):g("",!0),m.value.type=="day-view"?(a(),R(ht,{key:2,date:$.value,userRole:t.userRole,onClickTodo:O,onClickEdit:x,onClickAdd:u,onClickDelete:p,onClickChangeStatus:b,onBackClick:s,onUpdate:r},null,8,["date","userRole"])):g("",!0)]),U(Qt,{todoModal:i.value,userRole:t.userRole,onCancelClick:k,onUpdate:r,onClickEdit:x},null,8,["todoModal","userRole"])]))}};export{Ie as _,ro as a};
