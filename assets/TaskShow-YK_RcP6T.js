import{G as Q,r as C,e as X,H as rt,A as Y,c as p,o,f as y,a as t,t as f,I as A,n as w,h as m,w as S,l as v,p as T,E as Z,m as $,F as tt,x as lt,J as it,K as G,g as dt,v as ut,b as pt,u as ct,d as mt,q as D,k as W,y as J}from"./index-DHdMSwfl.js";import{L as K}from"./LoaderView-DBA80MGF.js";import{u as kt,_ as ft,O as L}from"./task-priority-bUSaHuRm.js";import{a as yt}from"./TaskAddForm-CyjIliBz.js";import{_ as vt}from"./TaskEditForm-Git27wdX.js";import{_ as bt,a as gt,b as xt}from"./TaskTreeView-CK-aAHba.js";import{g as P}from"./datetime-BISRKKpq.js";import{_ as et}from"./UserChip-C3iY8mqg.js";import{u as _t}from"./useTaskStore-Cfblp836.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-qox8__F0.js";import"./company-BQ0dQuxV.js";import"./useRequirementStore-GwdKPLxY.js";import"./SectionLoading-DHcepByh.js";const ht={key:0},Tt={key:0},wt={key:1},$t=Q({__name:"CountdownTimer",props:{targetDateTime:{}},setup(l){const a=l,e=C(d());let r;function d(){const c=new Date(a.targetDateTime).getTime()-new Date().getTime(),g=Math.floor(c/1e3%60),_=Math.floor(c/1e3/60%60),i=Math.floor(c/(1e3*60*60)%24),u=Math.floor(c/(1e3*60*60*24));return{total:c,days:u,hours:i,minutes:_,seconds:g}}function n(){e.value=d()}return X(()=>{r=setInterval(()=>{n(),e.value.total<=0&&clearInterval(r)},1e3)}),rt(()=>clearInterval(r)),Y(()=>a.targetDateTime,()=>{n(),clearInterval(r)}),(c,g)=>e.value.total>0?(o(),p("div",ht,[e.value.days?(o(),p("span",Tt,f(e.value.days)+"d ",1)):y("",!0),t("span",null,f(e.value.hours.toString().padStart(2,"0"))+"h :",1),t("span",null,f(e.value.minutes.toString().padStart(2,"0"))+"m :",1),t("span",null,f(e.value.seconds.toString().padStart(2,"0"))+"s",1)])):(o(),p("div",wt,[A(c.$slots,"expired",{},()=>[g[0]||(g[0]=w("Timeâ€™s up!"))])]))}}),Ct={class:"mb-3"},St={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},It={key:1,class:"text-center py-4 text-gray-500"},Dt={key:2,class:"text-center py-4 text-red-500"},Ut={key:3,class:"space-y-4"},Pt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(l,{emit:a}){const e=l,r=a,d=C(null),{handleItemsPriorityUpdate:n,saveTaskPriority:c,listHasRearranged:g}=kt(()=>e.tasks,e.parentId),_=async()=>{await c(),r("updatePriority")};return(i,u)=>(o(),p("div",null,[t("div",Ct,[A(i.$slots,"task:header")]),m(g)?(o(),p("div",St,[u[3]||(u[3]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:S(_,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:u[0]||(u[0]=S((...k)=>d.value.resetItems&&d.value.resetItems(...k),["prevent"]))},"Discard")])):y("",!0),l.loading?(o(),p("div",It,"Loading tasks...")):l.error?(o(),p("div",Dt,f(l.error),1)):(o(),p("div",Ut,[v(ft,{items:l.tasks,handle:"handle",onItemsUpdate:m(n),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:d},{item:T(({item:k,index:h})=>[v(bt,{index:h,task:k,showDraggableHandle:!0,"tree-level":l.treeLevel,class:"!border-0",onCommentButtonClick:I=>r("commentButtonClick",k.id),onEditClick:u[1]||(u[1]=I=>r("editClick",I)),onAddClick:u[2]||(u[2]=I=>r("addClick",I))},null,8,["index","task","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Lt={class:"flex justify-between mt-5"},At={class:"flex flex-wrap items-center gap-2 mt-3"},Et={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(l,{emit:a}){const e=l,r=a,d=C(),n=Z({show:!1,parentId:e.parentId,requirementId:null}),c=u=>{n.show=!0,n.parentId=u,console.log({addForm:n})};function g(){n.show=!1,n.parentId=e.parentId,r("created")}function _(){d.value=!1,r("updated")}function i(){n.show=!1,n.parentId=e.parentId}return(u,k)=>(o(),p("div",null,[d.value?(o(),$(L,{key:0},{default:T(()=>[v(vt,{taskId:d.value,onClose:k[0]||(k[0]=h=>d.value=null),onUpdated:_},null,8,["taskId"])]),_:1})):y("",!0),n.show?(o(),$(L,{key:1},{default:T(()=>[v(yt,{parentTaskId:n.parentId,requirementId:n.requirementId,onTaskCreated:g,onError:u.handleTaskError,onClose:i},null,8,["parentTaskId","requirementId","onError"])]),_:1})):y("",!0),v(Pt,{tasks:l.subTasks,parentId:l.parentId,treeLevel:l.treeLevel,onAddClick:k[2]||(k[2]=h=>c(h)),onEditClick:k[3]||(k[3]=h=>d.value=h),onUpdatePriority:k[4]||(k[4]=h=>r("updatePriority"))},{"task:header":T(()=>[t("div",Lt,[k[5]||(k[5]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),t("div",At,[t("button",{class:"btn-1 ml-auto",onClick:k[1]||(k[1]=S(()=>c(l.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId","treeLevel"])]))}},Mt={class:"min-w-full bg-white rounded overflow-hidden"},Bt={class:"py-0.5 text-bg font-semibold"},Ft={class:"px-2 py-1 border-y"},Rt={class:"px-2 py-1 border-y"},Nt={class:"px-2 py-1 border-y text-center"},jt={class:"px-2 py-1 border-y text-center"},qt={class:"px-2 py-1 border-y text-center"},Vt={class:"px-2 py-1 border-y text-center"},Ot=Q({__name:"TaskProgressTable",props:{progressUsers:{}},setup(l){return(a,e)=>(o(),p("table",Mt,[t("caption",Bt,[A(a.$slots,"caption",{},()=>[e[0]||(e[0]=w("Progress"))])]),e[1]||(e[1]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," User Progress "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," Task Progress ")])],-1)),t("tbody",null,[(o(!0),p(tt,null,lt(a.progressUsers,(r,d)=>(o(),p("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ft,f(d+1),1),t("td",Rt,[v(et,{user:r},null,8,["user"])]),t("td",Nt,f(m(P)(r.started_at)),1),t("td",jt,f(m(P)(r.finished_at)),1),t("td",qt,f(r.user_progress)+"%",1),t("td",Vt,f(r.task_progress)+"%",1)]))),128))])]))}}),zt=it("task-user",()=>({updateUserStartDate:async(e,r,d)=>await G.patch(`/task-user/task/${e}/user/${r}/update-start-date/${d}`),updateUserFinishDate:async(e,r,d)=>await G.patch(`/task-user/task/${e}/user/${r}/update-finish-date/${d}`)})),Ht={class:"border-b text-center"},Gt={key:0},Wt={key:1},Jt={class:"mb-2 mt-6"},Kt={class:"flex justify-center"},Qt={class:"py-6"},Xt={class:"mt-2"},Yt={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Zt={class:"flex justify-between items-center"},te={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(l,{emit:a}){const e=l,r=a,d=zt(),n=C(""),c=C("");async function g(){var _,i;console.log({date:n.value});try{e.type=="start-date"?await d.updateUserStartDate(e.task.id,e.user.id,n.value||"0"):e.type=="finish-date"&&await d.updateUserFinishDate(e.task.id,e.user.id,n.value||"0"),r("updateDate")}catch(u){c.value=((i=(_=u.response)==null?void 0:_.data)==null?void 0:i.message)||`Failed to update ${e.type}`}}return(_,i)=>(o(),p("form",{class:"p-4",onSubmit:S(g,["prevent"])},[t("div",Ht,[l.type=="start-date"?(o(),p("h2",Gt,"Edit Start Date")):l.type=="finish-date"?(o(),p("h2",Wt,"Edit Finish Date")):y("",!0)]),t("div",Jt,[i[2]||(i[2]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,f(l.task.title),1)]),t("div",null,[i[3]||(i[3]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"User:",-1)),v(et,{user:l.user},null,8,["user"])]),t("div",Kt,[t("div",Qt,[i[4]||(i[4]=t("label",{class:"block text-xs font-semibold"},"Date",-1)),dt(t("input",{type:"date","onUpdate:modelValue":i[0]||(i[0]=u=>n.value=u),class:"border py-2 px-4 rounded-md",size:"8"},null,512),[[ut,n.value]])])]),t("div",Xt,[c.value?(o(),p("div",Yt,f(c.value),1)):y("",!0)]),t("div",Zt,[i[5]||(i[5]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1)),t("button",{class:"btn-3",onClick:i[1]||(i[1]=S(u=>r("closeClick"),["prevent"]))},"Close")])],32))}},ee=l=>l==null?void 0:l.reduce((a,e)=>a+e.task_weight,0),se=(l,a)=>{const e=ee(l);return l.map(r=>{const d=a.filter(n=>n.user_id===r.id).reduce((n,c)=>n+c.progress,0);return{...r,task_progress:Math.floor(d*(r.task_weight/e)),user_progress:d}})},ae={class:"container mx-auto p-6"},ne={key:2,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},oe={class:"grid grid-cols-4"},re={class:"mb-4 flex col-span-full"},le={class:"font-medium text-xl"},ie={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},de={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},ue={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},pe={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},ce={class:"mt-4 col-span-full mb-6"},me={class:"ml-auto text-right text-sm col-span-full"},ke={key:1,class:"text-gray-500"},fe={class:"font-semibold text-green-800"},ye={key:2,class:"ml-4 text-gray-500"},ve={class:"text-red-500 font-semibold"},be={class:"py-2 flex justify-center items-center gap-2 col-span-full"},ge=["disabled"],xe=["disabled"],_e={class:"ml-auto flex gap-4"},he={key:0},Te={key:1},we={key:1,class:"text-center py-4 text-red-500"},Ne={__name:"TaskShow",setup(l){const a=_t(),e=pt(),r=ct(),d=mt(),n=C(),c=C(""),g=D(()=>a.tasks),_=C({});X(async()=>{c.value="loading",await u(e.params.id),c.value=""});const i=Z({user:null,type:""});async function u(b){await a.fetchTask(b);const s=await a.fetchTasks({parent_id:b},{newList:!0,loadingBeforeFetch:!0});n.value=s.parent_task}const k=D(()=>se(a.task.users,a.task.task_reports)),h=D(()=>k.value.find(b=>{var s;return b.id===((s=d.user)==null?void 0:s.id)})),I=D(()=>P(a.task.started_at)),E=D(()=>P(a.task.deadline));function M(b){i.user=d.user,i.type=b}async function st(){await u(e.params.id),i.user=null,i.type=""}const at=b=>{r.push({name:"TaskEdit",params:{id:b}})},nt=D(()=>{var b,s;return n.value?((b=n.value)==null?void 0:b.parent_id)==0?{name:"TaskList"}:{name:"TaskShow",params:{id:(s=n.value)==null?void 0:s.parent_id}}:null});return Y(()=>e.params.id,async b=>{c.value="changing",await u(b),c.value=""}),(b,s)=>{var B,F,R,N,j,q,V,O,z;const U=W("RouterLink"),ot=W("router-view");return o(),p("div",ae,[i.user?(o(),$(L,{key:0},{default:T(()=>[v(te,{task:m(a).task,user:i.user,type:i.type,onCloseClick:s[0]||(s[0]=x=>i.user=null),onUpdateDate:st},null,8,["task","user","type"])]),_:1})):y("",!0),c.value==="loading"?(o(),$(K,{key:1})):(o(),p("div",ne,[m(a).task?(o(),p(tt,{key:0},[t("section",oe,[t("div",re,[t("div",null,[t("h2",le,f(m(a).task.title),1),t("div",ie,[(B=m(a).task)!=null&&B.is_important?(o(),p("span",de,"IMPORTANT")):y("",!0),(F=m(a).task)!=null&&F.is_urgent?(o(),p("span",ue,"URGENT")):y("",!0)])]),t("div",pe,[v(gt,{status:(R=n.value)==null?void 0:R.status,class:""},null,8,["status"]),n.value?(o(),$(xt,{key:0,task:n.value,ref_key:"progress",ref:_,class:"!text-lg"},null,8,["task"])):y("",!0)])]),t("section",ce,[v(Ot,{"progress-users":k.value},{caption:T(()=>s[11]||(s[11]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["progress-users"])]),t("div",me,[m(a).task.deadline?(o(),$($t,{key:0,targetDateTime:m(a).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):y("",!0),I.value?(o(),p("span",ke,[s[12]||(s[12]=w(" Started: ")),t("span",fe,f(I.value),1)])):y("",!0),E.value?(o(),p("span",ye,[s[13]||(s[13]=w(" Deadline: ")),t("span",ve,f(E.value),1)])):y("",!0)]),s[18]||(s[18]=t("hr",{class:"my-3 col-span-full"},null,-1)),t("div",be,[t("button",{onClick:s[1]||(s[1]=S(x=>{var H;return at((H=m(a).task)==null?void 0:H.id)},["stop"])),class:"btn-2 py-0.5"},"Edit"),v(U,{to:{name:"TaskUserAssign",params:{id:(N=m(a).task)==null?void 0:N.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[2]||(s[2]=x=>x.stopPropagation())},{default:T(()=>s[14]||(s[14]=[t("i",{class:"fas fa-user-plus"},null,-1),w(" Assign Users ")])),_:1,__:[14]},8,["to"]),v(U,{to:nt.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[3]||(s[3]=x=>x.stopPropagation())},{default:T(()=>s[15]||(s[15]=[t("i",{class:"fas fa-arrow-left"},null,-1),w(" Back ")])),_:1,__:[15]},8,["to"]),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:s[4]||(s[4]=S(()=>M("start-date"),["prevent"])),disabled:!!((j=h.value)!=null&&j.started_at)}," Set Started Date ",8,ge),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:s[5]||(s[5]=S(()=>M("finish-date"),["prevent"])),disabled:!!((q=h.value)!=null&&q.finished_at)}," Set Finish Date ",8,xe),t("div",_e,[g.value.length>0?(o(),$(U,{key:0,to:{name:"TaskShow",params:{id:(V=m(a).task)==null?void 0:V.id}},onClick:s[6]||(s[6]=x=>x.stopPropagation()),class:J(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":m(e).name=="TaskShow"}])},{default:T(()=>s[16]||(s[16]=[t("i",{class:"fal fa-list-ul"},null,-1),w(" Sub Tasks ")])),_:1,__:[16]},8,["to","class"])):y("",!0),v(U,{to:{name:"TaskReports",params:{id:(O=m(a).task)==null?void 0:O.id}},onClick:s[7]||(s[7]=x=>x.stopPropagation()),class:J(["py-1 btn-3",{"bg-blue-500 text-white":m(e).name=="TaskReports"}])},{default:T(()=>s[17]||(s[17]=[t("i",{class:"fal fa-file-alt"},null,-1),w(" Reports ")])),_:1,__:[17]},8,["to","class"])])])]),m(e).name=="TaskShow"&&((z=n.value)==null?void 0:z.level)<=2?(o(),p("section",he,[v(Et,{subTasks:g.value,"parent-id":m(e).params.id,"tree-level":m(a).task.level+1,onCreated:s[8]||(s[8]=x=>u(m(e).params.id)),onUpdated:s[9]||(s[9]=x=>u(m(e).params.id)),onUpdatePriority:s[10]||(s[10]=x=>u(m(e).params.id))},null,8,["subTasks","parent-id","tree-level"])])):(o(),p("section",Te,[v(ot)]))],64)):(o(),p("div",we,f(m(a).error),1)),c.value==="changing"?(o(),$(K,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):y("",!0)]))])}}};export{Ne as default};
