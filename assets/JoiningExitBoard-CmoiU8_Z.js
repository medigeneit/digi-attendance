import{b as oe,u as ne,z as le,A as G,e as re,c as f,o as _,a as s,p as ie,h as X,B as de,k as O,J as pe,Q as me,r as w,m as ee,N as W,g as F,v as ye,x as P,j as te,t as c,F as se,y as ae,M as J,f as ue}from"./index-D39C7jUI.js";import{_ as _e}from"./EmployeeFilter-B2G2UoG1.js";import"./company-CoGNll5v.js";import"./department-EsQWOWSt.js";import"./EmployeeDropdownInput-DGRlfV50.js";import"./SelectDropdown-CkWbq3D7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-CiNHzul6.js";const fe={class:"flex flex-wrap items-end gap-3"},be={__name:"BoardFilters",props:{modelValue:{type:Object,required:!0},companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(j,{emit:i}){const C=j,N=i,v=oe(),S=ne(),x={type:null,user_type:"Probationary"},T=(o={})=>({type:o.type??x.type,company_id:o.companyId??null,department_id:o.departmentId??null,employee_id:o.employeeId??null,line_type:o.lineType??null,user_type:o.user_type??x.user_type}),p=(o={})=>({type:o.type??x.type,companyId:o.company_id??null,departmentId:o.department_id??null,employeeId:o.employee_id??null,lineType:o.line_type??null,user_type:o.user_type??x.user_type}),l=le(T(C.modelValue));let r=!1;function b(){r||N("update:modelValue",{...p(l)})}const h=["type","company_id","department_id","employee_id","line_type","user_type"],y=o=>o===""||o===null||o===void 0||o==="all";function D(){const o={};return!y(l.type)&&String(l.type)!==String(x.type)&&(o.type=String(l.type)),y(l.company_id)||(o.company_id=String(l.company_id)),y(l.department_id)||(o.department_id=String(l.department_id)),y(l.employee_id)||(o.employee_id=String(l.employee_id)),y(l.line_type)||(o.line_type=String(l.line_type)),!y(l.user_type)&&String(l.user_type)!==x.user_type&&(o.user_type=String(l.user_type)),o}function q(o={}){const d={...v.query};for(const I of h)delete d[I];const m={...d,...D(),...o};for(const I of Object.keys(m)){const g=m[I];(g===""||g===null||g===void 0)&&delete m[I]}return m}let L=null;function V({replace:o=!0,partial:d={},debounce:m=150}={}){L&&clearTimeout(L),L=setTimeout(()=>{const I=q(d);(o?S.replace({query:I}):S.push({query:I})).catch(()=>{})},m)}function $(){const o={...p(l)};N("submit",o),V({replace:!0,debounce:0})}return G(()=>C.modelValue,o=>{const d=T(o||{});let m=!1;for(const I of Object.keys(d))if(l[I]!==d[I]){m=!0;break}m&&(r=!0,Object.assign(l,d),pe(()=>{r=!1}))},{deep:!0}),G(()=>[l.type,l.company_id,l.department_id,l.employee_id,l.line_type,l.user_type],()=>{b(),V({replace:!0,debounce:150})}),re(()=>{v.query.user_type&&(l.user_type=String(v.query.user_type))}),G(()=>v.query.user_type,o=>{o!=null&&(l.user_type=String(o))}),(o,d)=>(_(),f("div",fe,[s("div",null,[d[7]||(d[7]=s("label",{class:"block text-xs text-gray-500 mb-1"},"User Type",-1)),X(s("select",{"onUpdate:modelValue":d[0]||(d[0]=m=>l.user_type=m),class:"border rounded px-2 py-1"},d[6]||(d[6]=[s("option",{value:"Probationary"},"Probationary",-1),s("option",{value:"Permanent"},"Permanent",-1),s("option",{value:"Contract"},"Contract",-1)]),512),[[de,l.user_type]])]),ie(_e,{company_id:l.company_id,"onUpdate:company_id":d[1]||(d[1]=m=>l.company_id=m),department_id:l.department_id,"onUpdate:department_id":d[2]||(d[2]=m=>l.department_id=m),employee_id:l.employee_id,"onUpdate:employee_id":d[3]||(d[3]=m=>l.employee_id=m),line_type:l.line_type,"onUpdate:line_type":d[4]||(d[4]=m=>l.line_type=m),"with-type":!0,"initial-value":O(v).query,companies:j.companies,departments:j.departments,onFilterChange:d[5]||(d[5]=m=>{Object.assign(l,m)})},null,8,["company_id","department_id","employee_id","line_type","initial-value","companies","departments"]),s("button",{class:"btn-2 py-1",onClick:$}," Apply ")]))}},ce=me("checklistBoard",()=>{const j=w(!1),i=w(null),C=w("joining"),N=w("Probationary"),v=w(null),S=w(null),x=w(""),T=w([]),p=w([]),l=w(Object.create(null)),r=w(null),b=a=>typeof a=="string"?a.toLowerCase():"",h=a=>Array.isArray(a)?a:[],y=a=>{var e;return((e=a==null?void 0:a.data)==null?void 0:e.data)??(a==null?void 0:a.data)},D=a=>{var e,n;return((e=a==null?void 0:a.company)==null?void 0:e.name)||(a==null?void 0:a.company_name)||((n=a==null?void 0:a.organization)==null?void 0:n.name)||"—"},q=a=>{var e,n;return((e=a==null?void 0:a.department)==null?void 0:e.name)||((n=a==null?void 0:a.dept)==null?void 0:n.name)||(a==null?void 0:a.department_name)||"—"},L=a=>{var e;return((e=a==null?void 0:a.position)==null?void 0:e.title)||(a==null?void 0:a.designation)||"—"},V=(a={})=>{const e={user_type:N.value||void 0,type:C.value||void 0,company_id:v.value||void 0,department_id:S.value||void 0,search:(x.value||"").trim()||void 0,template_id:o.value||void 0};return Object.keys(e).forEach(n=>(e[n]==null||e[n]==="")&&delete e[n]),{...e,...a}},$=ee(()=>{const a=b(C.value);return T.value.find(e=>b(e==null?void 0:e.type)===a)||null}),o=ee(()=>{var a;return((a=$.value)==null?void 0:a.id)??null});async function d(a={}){try{const e=await W.get("/checklist-templates",{params:a});T.value=h(y(e))}catch(e){throw T.value=[],i.value=e,e}}async function m(a,e){const{data:n}=await W.patch(`/user/${a}/employment-type`,{employment_type:e}),t=p.value.findIndex(u=>u.id===a);return t!==-1&&(this.users[t]={...this.users[t],employment_type:C}),this.rows[a]&&(this.rows[a]={...this.rows[a]}),n}async function I(a={}){if(r.value)try{await r.value}catch{}j.value=!0,i.value=null;const e=V(a),n=(async()=>{try{const t=await W.get("/users-checklists",{params:e});p.value=h(y(t))}catch(t){throw p.value=[],i.value=t,t}finally{j.value=!1,r.value=null}})();return r.value=n,n}async function g({withUsers:a=!0,templateParams:e={},userParams:n={}}={}){j.value=!0,i.value=null;try{T.value.length||await d(e),a&&await I(n)}catch(t){throw i.value=t,t}finally{j.value=!1}}function M(a){p.value=h(a)}function U(a={}){"type"in a&&(C.value=a.type),"companyId"in a&&(v.value=a.companyId),"departmentId"in a&&(S.value=a.departmentId),"search"in a&&(x.value=a.search)}function Q(){C.value="joining",v.value=null,S.value=null,x.value=""}function Y(){l.value=Object.create(null)}return{loading:j,error:i,type:C,companyId:v,departmentId:S,search:x,templates:T,users:p,rows:l,templateByType:$,templateId:o,companyNameOf:D,departmentNameOf:q,positionTitleOf:L,loadBoard:g,loadTemplates:d,loadUsers:I,setUsers:M,setFilters:U,resetFilters:Q,clearRowCache:Y,updateEmploymentType:m}}),ge={class:"space-y-4"},he={class:"flex flex-wrap items-center gap-2"},ve={class:"relative"},xe={class:"rounded-lg border p-1 text-xs"},we={class:"ml-auto"},ke={class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs text-blue-700"},Ie={class:"ml-1 font-medium"},Me={class:"overflow-x-auto rounded-xl border shadow-sm"},Ce={class:"min-w-full text-[13px]"},Se={class:"p-2"},Te={class:"p-2"},De={class:"flex items-center gap-2"},Ne={class:"relative h-8 w-8 shrink-0"},je=["src"],Be={key:1,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 text-[11px] font-semibold text-gray-700"},Pe={class:"min-w-0"},Ue={class:"font-medium truncate"},Oe={class:"text-[11px] text-gray-500 space-x-2 truncate"},$e={key:0},Le={class:"hidden sm:inline"},Ve={class:"p-2 hidden md:table-cell"},Ae=["title"],Ee={class:"p-2 card-bg mt-2 mb-2"},Fe={class:"group relative w-full border-b"},qe={class:"relative h-2 w-full overflow-hidden rounded-full bg-gray-100 ring-1 ring-inset ring-gray-200"},ze=["aria-valuenow"],Re={class:"mt-1 flex items-center justify-between text-[11px] text-gray-600"},Qe={class:"flex items-center gap-2"},Je={class:"font-medium"},Ge={class:"hidden sm:inline"},Ye={class:"pointer-events-none absolute inset-x-0 -bottom-6 hidden justify-between text-[10px] text-gray-500 group-hover:flex"},He={key:0,class:"mt-1"},Ke={key:0},Ze={key:1,class:"text-red-600"},We={key:1,class:"mt-1"},Xe={key:0},et={key:1,class:"text-red-600"},tt={class:"p-2"},nt={class:"flex items-center gap-2"},st={class:"relative"},at=["disabled","value","onChange"],ot=["value"],lt={key:0,class:"absolute right-2 top-1/2 h-3 w-3 -translate-y-1/2 animate-spin text-gray-400",viewBox:"0 0 24 24"},rt={class:"p-2"},it=["disabled","title","onClick"],dt={key:0,class:"text-gray-600 text-sm"},ct={key:1,class:"rounded-xl border border-dashed p-10 text-center text-sm text-gray-500"},pt={__name:"ChecklistBoardTable",setup(j){const i=ce(),C=ne(),N=w(""),v=w(!1),S=w("progress_desc"),x=le({}),T=e=>{var n;return((n=i.rows)==null?void 0:n[String(e==null?void 0:e.id)])||{}},p=(e,n,t)=>Math.min(Math.max(Number(e||0),n),t),l=e=>e<0?0:e>100?100:Math.round(e),r=e=>e?new Date(e):null,b=(e,n)=>{const t=new Date(e.getTime()),u=t.getMonth()+(n||0);return t.setMonth(u),t.getMonth()!==(u%12+12)%12&&t.setDate(0),t},h=(e,n)=>Math.round((e-n)/864e5),y=e=>{const t=T(e).percent??(e==null?void 0:e.percent)??0;return p(t,0,100)},D=e=>{var n;return p(((n=e==null?void 0:e.checklist)==null?void 0:n.required_completion_percent)??100,1,100)},q=e=>{const n=u=>String(u||"").toLowerCase(),t=n(N.value);return t?[e==null?void 0:e.name,e==null?void 0:e.employee_id,e==null?void 0:e.department,e==null?void 0:e.designation].filter(Boolean).some(u=>n(u).includes(t)):!0};function L(e){const n=i.templateId;n&&C.push({name:"checklist.create",params:{userId:e.id,templateId:n}})}const V=ee(()=>{let e=(i.users||[]).filter(q);return v.value&&(e=e.filter(n=>y(n)<D(n))),S.value==="name_asc"?e=[...e].sort((n,t)=>(n.name||"").localeCompare(t.name||"")):S.value==="progress_asc"?e=[...e].sort((n,t)=>y(n)-y(t)):e=[...e].sort((n,t)=>y(t)-y(n)),e}),$=[{value:"probationary",label:"Probationary"},{value:"permanent",label:"Permanent"},{value:"contract",label:"Contract"}],o=e=>String(e||"").toLowerCase(),d=e=>{var t;const n=o(e);return((t=$.find(u=>u.value===n))==null?void 0:t.label)||"—"},m=e=>{const n=o(e);return n==="probationary"?"bg-amber-50 text-amber-700 ring-amber-200":n==="permanent"?"bg-green-50 text-green-700 ring-green-200":n==="contract"?"bg-blue-50 text-blue-700 ring-blue-200":"bg-gray-50 text-gray-700 ring-gray-200"};async function I(e,n){if(!(e!=null&&e.id))return;const t=o(n),u=o(e.employment_type);if(!$.some(B=>B.value===t)||u===t)return;const k=d(e.employment_type),E=d(t);x[e.id]=!0,e.employment_type=E;try{await i.updateEmploymentType(e.id,E)}catch(B){e.employment_type=k,console.error(B),alert("Failed to update employment type. Please try again.")}finally{x[e.id]=!1}}function g(e){if(!(o(e==null?void 0:e.employment_type)==="probationary"))return{enabled:!1};const t=r(e==null?void 0:e.joining_date)||r(e==null?void 0:e.created_at),u=Number(e==null?void 0:e.probation_months)||0,k=Number(e==null?void 0:e.probation_extension_months)||0;if(!t||Number.isNaN(u))return{enabled:!1};const E=Math.max(1,u+(k||0)),B=b(t,E),z=new Date,R=Math.max(1,h(B,t)),H=Math.max(0,Math.min(R,h(z,t))),A=h(B,z),K=l(H/R*100),Z=A<0?"overdue":A<=14?"near_end":"active";return{enabled:!0,start:t,end:B,pct:K,leftDays:A,status:Z}}function M(e){if(!(o(e==null?void 0:e.employment_type)==="contract"))return{enabled:!1};const t=r(e==null?void 0:e.joining_date)||r(e==null?void 0:e.created_at),u=Number((e==null?void 0:e.contract_month)??(e==null?void 0:e.contract_months)??(e==null?void 0:e.contract_duration_months)??0),k=Number((e==null?void 0:e.contract_extension_months)??0);if(!t||Number.isNaN(u)||u<=0)return{enabled:!1};const E=Math.max(1,u+(k||0)),B=b(t,E),z=new Date,R=Math.max(1,h(B,t)),H=Math.max(0,Math.min(R,h(z,t))),A=h(B,z),K=l(H/R*100),Z=A<0?"overdue":A<=30?"near_end":"active";return{enabled:!0,start:t,end:B,pct:K,leftDays:A,status:Z}}const U=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",Q=(e,n)=>{const t=p(e,0,100),u=p(n,1,100),k=Math.max(0,u-t);return t>=u?{text:"Met",tone:"ok",diff:0}:{text:`Short by ${k}%`,tone:"warn",diff:k}},Y=e=>e?"bg-gradient-to-r from-emerald-500 to-emerald-600":"bg-gradient-to-r from-amber-500 to-amber-600",a=(e,n="amber")=>e==="overdue"?{track:"bg-red-100",fill:"bg-red-500",tone:"text-red-600"}:e==="near_end"?{track:n==="blue"?"bg-indigo-100":"bg-orange-100",fill:n==="blue"?"bg-indigo-500":"bg-orange-500",tone:"text-gray-700"}:{track:n==="blue"?"bg-blue-100":"bg-amber-100",fill:n==="blue"?"bg-blue-500":"bg-amber-500",tone:"text-gray-600"};return(e,n)=>(_(),f("div",ge,[s("div",he,[s("div",ve,[X(s("input",{"onUpdate:modelValue":n[0]||(n[0]=t=>N.value=t),type:"search",placeholder:"Search name / ID / dept / designation…",class:"w-64 md:w-80 max-w-full rounded-lg border bg-white/90 px-8 py-2 text-sm outline-none focus:border-gray-400"},null,512),[[ye,N.value]]),n[5]||(n[5]=s("svg",{class:"pointer-events-none absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M12.9 14.32a8 8 0 111.414-1.414l3.387 3.387a1 1 0 01-1.414 1.414L12.9 14.32zM14 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1)),N.value?(_(),f("button",{key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",onClick:n[1]||(n[1]=t=>N.value=""),"aria-label":"Clear search"},"✕")):F("",!0)]),s("div",xe,[s("button",{class:P(["rounded-md px-2 py-1",v.value?"":"bg-gray-900 text-white"]),onClick:n[2]||(n[2]=t=>v.value=!1)},"All",2),s("button",{class:P(["rounded-md px-2 py-1",v.value?"bg-gray-900 text-white":""]),onClick:n[3]||(n[3]=t=>v.value=!0),title:"Show only users below their checklist target"},"Only Missing",2)]),X(s("select",{"onUpdate:modelValue":n[4]||(n[4]=t=>S.value=t),class:"rounded-md border bg-white px-2 py-1 text-xs outline-none"},n[6]||(n[6]=[s("option",{value:"progress_desc"},"Sort: Progress ↓",-1),s("option",{value:"progress_asc"},"Sort: Progress ↑",-1),s("option",{value:"name_asc"},"Sort: Name A–Z",-1)]),512),[[de,S.value]]),s("div",we,[s("span",ke,[n[7]||(n[7]=te(" Template: ")),s("span",Ie,c(O(i).templateId||"Not selected"),1)])])]),s("div",Me,[s("table",Ce,[n[10]||(n[10]=s("thead",{class:"sticky top-0 bg-gray-50/90 backdrop-blur"},[s("tr",{class:"text-left border-b"},[s("th",{class:"p-2 w-10"},"#"),s("th",{class:"p-2 min-w-[220px]"},"User"),s("th",{class:"p-2 hidden md:table-cell min-w-[160px]"},"Role"),s("th",{class:"p-2 min-w-[260px]"},"Progress"),s("th",{class:"p-2 w-44"},"Status"),s("th",{class:"p-2 w-36"},"Actions")])],-1)),s("tbody",null,[(_(!0),f(se,null,ae(V.value,(t,u)=>(_(),f("tr",{key:t.id,class:"border-b hover:bg-gray-50/70"},[s("td",Se,c(u+1),1),s("td",Te,[s("div",De,[s("div",Ne,[t.avatar?(_(),f("img",{key:0,src:t.avatar,alt:"",class:"h-8 w-8 rounded-full object-cover"},null,8,je)):(_(),f("div",Be,c((t.name||t.full_name||t.email||"??").slice(0,2).toUpperCase()),1))]),s("div",Pe,[s("div",Ue,c(t.name||t.full_name||t.email),1),s("div",Oe,[t.joining_date?(_(),f("span",$e,"Joining Date: "+c(t.joining_date),1)):F("",!0),s("span",Le,"Dept: "+c(t.department||"—"),1)])])])]),s("td",Ve,[s("div",{class:"truncate",title:t.designation},c(t.designation||"—"),9,Ae)]),s("td",Ee,[s("div",Fe,[s("div",qe,[s("div",{class:"pointer-events-none absolute top-0 h-2 w-0.5 bg-gray-600/60",style:J({left:`calc(${D(t)}% - 1px)`})},null,4),s("div",{class:P(["h-2 transition-all duration-500 ease-out will-change-[width]",Y(y(t)>=D(t))]),style:J({width:y(t)+"%"}),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":y(t),role:"progressbar"},null,14,ze)]),s("div",Re,[s("div",Qe,[s("span",Je,"Actual: "+c(y(t))+"%",1),s("span",Ge,"Target: "+c(D(t))+"%",1)]),s("span",{class:P(["rounded-full px-1.5 py-0.5 ring-1 text-[10px]",Q(y(t),D(t)).tone==="ok"?"bg-emerald-50 text-emerald-700 ring-emerald-200":"bg-amber-50 text-amber-700 ring-amber-200"])},c(Q(y(t),D(t)).text),3)]),s("div",Ye,[s("span",null,"Target marker indicates "+c(D(t))+"%",1),n[8]||(n[8]=s("span",null,"Progress updates live",-1))])]),g(t).enabled?(_(),f("div",He,[s("div",{class:P(["relative w-full h-1.5 overflow-hidden rounded-full",a(g(t).status).track])},[s("div",{class:P(["h-1.5 transition-all duration-500 ease-out",a(g(t).status).fill]),style:J({width:g(t).pct+"%"})},null,6)],2),s("div",{class:P(["mt-1 flex items-center justify-between text-[11px]",a(g(t).status).tone])},[s("span",null,"Probation: "+c(g(t).pct)+"%",1),g(t).leftDays>=0?(_(),f("span",Ke,c(U(g(t).start))+" → "+c(U(g(t).end))+" · "+c(g(t).leftDays)+"d left ",1)):(_(),f("span",Ze,c(U(g(t).start))+" → "+c(U(g(t).end))+" · Overdue "+c(Math.abs(g(t).leftDays))+"d ",1))],2)])):F("",!0),M(t).enabled?(_(),f("div",We,[s("div",{class:P(["relative w-full h-1.5 overflow-hidden rounded-full",a(M(t).status,"blue").track])},[s("div",{class:P(["h-1.5 transition-all duration-500 ease-out",a(M(t).status,"blue").fill]),style:J({width:M(t).pct+"%"})},null,6)],2),s("div",{class:P(["mt-1 flex items-center justify-between text-[11px]",a(M(t).status,"blue").tone])},[s("span",null,"Contract: "+c(M(t).pct)+"%",1),M(t).leftDays>=0?(_(),f("span",Xe,c(U(M(t).start))+" → "+c(U(M(t).end))+" · "+c(M(t).leftDays)+"d left ",1)):(_(),f("span",et,c(U(M(t).start))+" → "+c(U(M(t).end))+" · Expired "+c(Math.abs(M(t).leftDays))+"d ",1))],2)])):F("",!0)]),s("td",tt,[s("div",nt,[s("span",{class:P(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] ring-1",m(t.employment_type)])},c(d(t.employment_type)),3),s("div",st,[s("select",{disabled:!!x[t.id],value:o(t.employment_type),class:"rounded-md border bg-white px-2 py-1 text-[11px] outline-none disabled:opacity-50",onChange:k=>I(t,k.target.value),"aria-label":"Change employment type"},[(_(),f(se,null,ae($,k=>s("option",{key:k.value,value:k.value},c(k.label),9,ot)),64))],40,at),x[t.id]?(_(),f("svg",lt,n[9]||(n[9]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3",fill:"none"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3A5 5 0 007 12H4z"},null,-1)]))):F("",!0)])])]),s("td",rt,[s("button",{class:"px-3 py-1.5 rounded-md text-[12px] font-medium bg-gray-900 text-white hover:bg-black disabled:opacity-40",disabled:!O(i).templateId,title:O(i).templateId?"":"Select a template first",onClick:k=>L(t)},c(t!=null&&t.checklist?"Open":"Create"),9,it)])]))),128))])])]),O(i).loading?(_(),f("div",dt,"Loading…")):!O(i).loading&&V.value.length===0?(_(),f("div",ct," No users found for the current filters. ")):F("",!0)]))}},mt={class:"p-6 space-y-6"},yt={class:"flex items-center justify-between"},ut={class:"text-2xl font-semibold"},_t={class:"text-gray-500"},ft={key:0,class:"text-gray-600"},bt={key:1,class:"text-red-600"},Ct={__name:"JoiningExitBoard",setup(j){const i=ce(),C=oe(),N=ne(),v=w([]),S=w([]),x=(r={})=>({type:r.type??i.type,companyId:r.company_id?Number(r.company_id):null,departmentId:r.department_id?Number(r.department_id):null,employeeId:r.employee_id?Number(r.employee_id):null,lineType:r.line_type??null,user_type:r.user_type??null,search:r.search??i.search}),T=(r={})=>{const b={type:r.type||void 0,company_id:r.companyId||void 0,department_id:r.departmentId||void 0,employee_id:r.employeeId||void 0,line_type:r.lineType||void 0,user_type:r.user_type||void 0,search:r.search||void 0};return Object.keys(b).forEach(h=>(b[h]==null||b[h]==="")&&delete b[h]),b},p=w({type:i.type,companyId:i.companyId,departmentId:i.departmentId,employeeId:null,lineType:null,user_type:null,search:i.search});G(p,r=>{i.type=r.type,i.user_type=r.user_type,i.companyId=r.companyId??null,i.departmentId=r.departmentId??null,i.search=r.search??"",N.replace({query:{...C.query,...T(r)}})},{deep:!0,immediate:!0});async function l(){await i.loadUsers({type:p.value.type,company_id:p.value.companyId,department_id:p.value.departmentId,employee_id:p.value.employeeId,line_type:p.value.lineType,user_type:p.value.user_type,search:p.value.search})}return re(async()=>{Object.assign(p.value,x(C.query)),await i.loadBoard({withUsers:!0,userParams:T(p.value)})}),(r,b)=>{var h,y;return _(),f("div",mt,[s("div",yt,[s("h1",ut,[s("b",null,c(((h=O(i).templateByType)==null?void 0:h.name)||"—"),1),b[1]||(b[1]=te(" Board"))]),s("div",_t,[b[2]||(b[2]=te(" Template: ")),s("b",null,c(((y=O(i).templateByType)==null?void 0:y.name)||"—"),1)])]),ie(be,{modelValue:p.value,"onUpdate:modelValue":b[0]||(b[0]=D=>p.value=D),companies:v.value,departments:S.value,onSubmit:l},null,8,["modelValue","companies","departments"]),O(i).loading?(_(),f("div",ft,"Loading…")):O(i).error?(_(),f("div",bt,"Failed to load.")):(_(),ue(pt,{key:2}))])}}};export{Ct as default};
