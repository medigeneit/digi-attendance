import{D as Pe,f as Ye,u as Ee,x as v,G as Fe,r as N,q as ze,h as Ge,c as a,o as r,a as e,d as B,b as y,t as n,l as ee,k as te,m as Y,F as h,e as w,H as ye,v as $e,j as c,s as J,z as be,T as xe}from"./index-TYafwBxm.js";import{L as Me}from"./LoaderView-DdZSmz6C.js";import{_ as Ve}from"./EmployeeFilter-DXIcxPtD.js";import{u as qe}from"./kpi-report-CFMS4B8E.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company--OsnddoA.js";import"./department-Bh8IC_2Y.js";import"./EmployeeDropdownInput-CapeghD4.js";import"./SelectDropdown-Cv0ecQhv.js";import"./UserChip-BnbIgBM3.js";const Ue={class:"space-y-4 px-4 print:px-0"},Ie={class:"hidden print:block mx-auto text-center mb-3"},Oe={class:"text-sm text-gray-600"},Be={class:"font-medium"},Je={class:"font-medium"},He={class:"flex flex-wrap items-end gap-3 sticky top-14 z-10 bg-white/80 backdrop-blur print:hidden p-4 -mx-2 rounded-xl border border-gray-100"},We={class:"w-full flex items-start gap-3"},Qe={class:"flex gap-2"},Xe=["disabled"],Ze=["value"],et={class:"flex flex-wrap items-center gap-2 w-full"},tt=["value"],st=["disabled"],lt=["disabled"],nt={key:0,class:"py-10 text-center"},ot={key:1,class:"rounded-xl border border-red-200 bg-red-50 p-3 text-red-700",role:"alert"},at={class:"rounded-2xl border border-gray-200 bg-white shadow-sm p-4 print:hidden"},rt={class:"flex flex-wrap items-start justify-between gap-3"},it={class:"text-xs font-semibold uppercase tracking-[0.18em] text-indigo-500"},dt={class:"mt-1 text-lg font-semibold text-slate-900"},ut={class:"mt-1 flex flex-wrap gap-2 text-xs text-slate-600"},pt={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},ct={class:"text-slate-900"},_t={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},mt={class:"text-slate-900"},yt={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},bt={class:"text-slate-900"},xt={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},gt={class:"text-slate-900"},ft={key:0,class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},vt={class:"text-slate-900"},ht={class:"text-xs text-slate-500"},wt={class:"space-y-3 md:hidden"},kt={class:"flex items-start justify-between gap-3"},Nt={class:"min-w-0"},St=["title"],Ct={class:"mt-0.5 text-[11px] text-slate-500"},jt={key:0},Rt={key:1},Lt={key:2},At={key:3},Dt={class:"shrink-0"},Tt={key:0,class:"mt-2 grid grid-cols-4 gap-2"},Pt=["title"],Yt={class:"mt-1 flex flex-col items-center gap-1"},Et={class:"mt-3 flex items-center justify-between gap-3"},Ft=["onClick"],zt={key:0,class:"px-3 py-8 text-center text-gray-600"},Gt={class:"hidden md:block rounded-2xl border bg-white shadow-sm"},$t={class:"w-full text-sm"},Mt={class:"sticky top-40 z-[5] bg-gray-100/95 backdrop-blur"},Vt={class:"text-xs font-semibold text-slate-700"},qt={class:"sticky left-0 z-[4] border-r bg-inherit px-3 py-2 text-center"},Kt={class:"sticky z-[4] border-r bg-inherit px-3 py-2",style:{left:"3rem"}},Ut={class:"max-w-[17rem]"},It=["title"],Ot={class:"text-[11px] text-slate-500 truncate"},Bt={key:0},Jt={key:1},Ht={key:2},Wt={key:3},Qt={class:"border-r px-3 py-2 text-center"},Xt={class:"flex flex-col items-center gap-1"},Zt={class:"border-r px-3 py-2 text-center"},es={class:"inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[12px] font-semibold text-slate-700"},ts={class:"px-3 py-2"},ss={class:"space-y-1 text-[11px] text-slate-600"},ls={class:"mt-2 flex items-center justify-between gap-3"},ns=["onClick"],os={key:0},as={class:"relative max-w-2xl w-full rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true","aria-label":"Latest review details"},rs={class:"flex items-start justify-between gap-4"},is={class:"text-lg font-semibold text-slate-900"},ds={class:"text-xs text-slate-500"},us={key:0},ps={key:1},cs={class:"text-xs text-slate-500"},_s={class:"mt-4 space-y-4 text-slate-700"},ms={class:"rounded-xl border border-slate-200 bg-slate-50 p-4"},ys={class:"mt-3 space-y-2 text-xs text-slate-700"},bs={key:0},xs={class:"mt-1 text-slate-600"},gs={key:1},fs={class:"mt-1 text-slate-600"},vs={key:2},hs={class:"mt-1 text-slate-600"},ws={key:3,class:"text-slate-500"},ks={class:"relative max-w-3xl w-full rounded-2xl border border-slate-200 bg-white shadow-xl overflow-hidden",role:"dialog","aria-modal":"true","aria-label":"All reviewer comments"},Ns={class:"p-5 border-b border-slate-200 bg-white"},Ss={class:"flex items-start justify-between gap-4"},Cs={class:"min-w-0"},js={class:"text-lg font-semibold text-slate-900 truncate"},Rs={class:"mt-0.5 text-xs text-slate-500"},Ls={key:0},As={key:1},Ds={class:"mt-2 flex flex-wrap gap-2 text-[11px] text-slate-600"},Ts={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},Ps={class:"text-slate-900"},Ys={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},Es={class:"text-slate-900"},Fs={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},zs={class:"text-slate-900"},Gs={class:"max-h-[75vh] overflow-y-auto p-5 space-y-4"},$s={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Ms={class:"px-4 py-3 bg-slate-50 border-b border-slate-200 flex flex-wrap items-center justify-between gap-2"},Vs={class:"flex items-center gap-2 min-w-0"},qs=["title"],Ks={class:"text-[11px] text-slate-500 truncate"},Us={class:"flex flex-wrap gap-2 text-[11px] text-slate-600"},Is={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},Os={class:"text-slate-900"},Bs={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},Js={class:"text-slate-900"},Hs={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},Ws={class:"text-slate-900"},Qs={class:"p-4 space-y-3"},Xs={class:"flex flex-wrap items-start justify-between gap-2"},Zs={class:"min-w-0"},el={class:"text-sm font-semibold text-slate-900 truncate"},tl={class:"mt-0.5 text-[11px] text-slate-500"},sl={key:0},ll={class:"flex flex-wrap gap-2"},nl={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] font-semibold text-slate-700"},ol={key:0,class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] font-semibold text-slate-700"},al={class:"mt-3 space-y-2 text-xs text-slate-700"},rl={key:0},il={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},dl={key:1},ul={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},pl={key:2},cl={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},_l={key:3,class:"text-slate-500"},ml={key:0,class:"text-sm text-slate-500"},yl={__name:"YearlyKpiReport",setup(bl){const G=qe(),{reports:ge,isLoading:$,error:se}=Pe(G),L=Ye(),fe=Ee(),A=v(()=>({company_id:L.query.company_id??"",department_id:L.query.department_id??"",employee_id:L.query.employee_id??"",line_type:L.query.line_type??"executive"})),p=Fe({company_id:A.value.company_id,department_id:A.value.department_id,employee_id:A.value.employee_id,line_type:A.value.line_type}),le=N(!1),ne=new Date().getFullYear(),k=N(Number(L.query.year??ne)),oe=N([]);function ve(s=2020,t=ne+1){const i=[];for(let o=t;o>=s;o--)i.push(o);oe.value=i}const j=v(()=>ge.value||{}),H=v(()=>{var s;return((s=j.value)==null?void 0:s.cycle)||{}}),ae=v(()=>{var s;return((s=j.value)==null?void 0:s.filters)||{}}),S=v(()=>{var t;return[...Array.isArray((t=j.value)==null?void 0:t.lane_definitions)?j.value.lane_definitions:[]].sort((i,o)=>Number(i.rank||0)-Number(o.rank||0))}),M=v(()=>{var s;return((s=j.value)==null?void 0:s.summary)||{}}),he=v(()=>{var s;return Array.isArray((s=j.value)==null?void 0:s.data)?j.value.data:[]}),V=v(()=>{var t;if(S.value.length)return S.value.length;const s=Number(((t=H.value)==null?void 0:t.lane_count)??0);return Number.isFinite(s)&&s>0?s:0});function D(s){const t=Number(s);return Number.isFinite(t)?`${Math.round(t)}%`:"0%"}function T(s,t="-"){const i=(s??"").toString().trim();return i||t}function re(s){if(!s)return null;const t=new Date(s);return Number.isNaN(t.getTime())?null:t.toLocaleDateString()}function we(){return new Date().toLocaleString()}function P(s){return!Array.isArray(s)||s.length===0?null:s.join("; ")}function W(s){return Array.isArray(s)?s.map(t=>typeof t=="string"?t.trim():"").filter(t=>t!==""):typeof s=="string"?s.split(/[\r\n;]+/).map(t=>t.trim()).filter(t=>t!==""):[]}function ie(s){var o;const t=Number(((o=s==null?void 0:s.progress)==null?void 0:o.lanes_reviewed)??0),i=Number(V.value??0);return i?t>=i?"bg-emerald-50 text-emerald-700 border-emerald-200":t>0?"bg-amber-50 text-amber-700 border-amber-200":"bg-rose-50 text-rose-700 border-rose-200":"bg-slate-50 text-slate-600 border-slate-200"}function Q(s){var o;const t=Number(((o=s==null?void 0:s.progress)==null?void 0:o.lanes_reviewed)??0),i=Number(V.value??0);return i?`${t}/${i}`:`${t}`}function ke(s){if(!s)return"No reviews submitted yet";const t=s.reviewer_name||"Latest reviewer",i=s.reviewer_lane?` (${s.reviewer_lane})`:"",o=s.obtained_total??null,_=s.max_total??null,b=Number.isFinite(Number(o))&&Number.isFinite(Number(_))?`${Number(o)}/${Number(_)}`:o!==null?`${o}`:null,f=re(s.submitted_at),x=[`${t}${i}`];return b&&x.push(b),f&&x.push(f),x.join(" • ")}function q(s,t){var f;const o=(Array.isArray(s==null?void 0:s.lanes)?s.lanes:[]).find(x=>(x==null?void 0:x.key)===t)||null;if(!o)return{text:"-",cls:"bg-slate-50 text-slate-500 border border-slate-200",percentText:"--"};const _=o.submitted_at||o.submittedAt||((f=o.review)==null?void 0:f.submitted_at),g=!!(o.completed??o.is_completed??o.review_submitted??_),b=o.average_marks??0;return g?{text:b,cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:b,cls:"bg-amber-50 text-amber-700 border-amber-200"}}const de=v(()=>he.value.map(s=>{var _,g,b;const t=s.employee||{},i=s.latest_review||null,o=s.comments||{};return{...s,_name:T(t.name),_company:T(t.company,""),_dept:T(t.department,""),_joining:re(t.joining_date),_type:T(t.type,""),latestReviewSummary:ke(i),latestReviewStrengths:P(i==null?void 0:i.strengths)||null,latestReviewGaps:P(i==null?void 0:i.gaps)||null,latestReviewSuggestions:P(i==null?void 0:i.suggestions)||null,aggregatedStrengthsList:W(o==null?void 0:o.strengths),aggregatedGapsList:W(o==null?void 0:o.gaps),aggregatedSuggestionsList:W(o==null?void 0:o.suggestions),aggregatedStrengths:P(o==null?void 0:o.strengths),aggregatedGaps:P(o==null?void 0:o.gaps),aggregatedSuggestions:P(o==null?void 0:o.suggestions),finalPercent:((_=s==null?void 0:s.kpi_result)==null?void 0:_.final_percent)??((g=s==null?void 0:s.kpi_result)==null?void 0:g.final_percentage)??((b=s==null?void 0:s.kpi_result)==null?void 0:b.final)??null}})),X=N(""),Z=N("all"),Ne=[{value:"all",label:"Any comment"},{value:"strengths",label:"Strengths"},{value:"gaps",label:"Gaps"},{value:"suggestions",label:"Suggestions"}],Se=v(()=>X.value.trim().toLowerCase()),Ce=v(()=>{const s=Se.value;return s?de.value.filter(t=>{const i=Z.value,o=[];return(i==="all"||i==="strengths")&&o.push(t.aggregatedStrengthsList||[]),(i==="all"||i==="gaps")&&o.push(t.aggregatedGapsList||[]),(i==="all"||i==="suggestions")&&o.push(t.aggregatedSuggestionsList||[]),o.some(_=>_.some(g=>g.toLowerCase().includes(s)))}):de.value}),K=v(()=>Ce.value),u=N(null),U=N(!1);function ue(s){u.value=s,U.value=!0}function R(){U.value=!1,u.value=null}const I=N(!1),O=N(!1);function je(){return{year:Number(k.value),company_id:p.company_id||void 0,department_id:p.department_id||void 0,employee_id:p.employee_id||void 0,line_type:p.line_type||void 0,flag:"excel"}}function Re(){return{year:Number(k.value),company_id:p.company_id||void 0,department_id:p.department_id||void 0,employee_id:p.employee_id||void 0,line_type:p.line_type||void 0,flag:"comment_excel"}}async function Le(){I.value=!0;try{await G.exportYearly(je())}catch(s){console.error("exportYearly failed:",s)}finally{I.value=!1}}async function Ae(){O.value=!0;try{await G.exportYearly(Re())}catch(s){console.error("exportYearly comment_excel failed:",s)}finally{O.value=!1}}function pe(s={}){const t={...L.query,...s};Object.keys(t).forEach(i=>{const o=t[i];(o==null||o==="")&&delete t[i]}),fe.replace({query:t})}async function ce(){try{p.company_id&&await G.fetchYearlyExecutive({year:Number(k.value),company_id:p.company_id||void 0,department_id:p.department_id||void 0,employee_id:p.employee_id||void 0,line_type:p.line_type||void 0})}catch(s){console.error("fetchYearlyExecutive failed:",s)}}function De(s={}){p.company_id=s.company_id??"",p.department_id=s.department_id??"",p.employee_id=s.employee_id??"",p.line_type=s.line_type??A.value.line_type??"executive",le.value=!0,pe({company_id:p.company_id||void 0,department_id:p.department_id||void 0,employee_id:p.employee_id||void 0,line_type:p.line_type||void 0,year:Number(k.value)}),ce()}ze(k,()=>{const s=Number(k.value);!Number.isInteger(s)||s<2e3||s>2100||le.value&&(pe({year:s}),ce())}),Ge(()=>{ve()});function _e(s){if(!s)return null;const t=new Date(s);return Number.isNaN(t.getTime())?null:t.toLocaleString()}const me=v(()=>{const s=u.value,t=Array.isArray(s==null?void 0:s.lanes)?s.lanes:[],i=new Map(S.value.map(_=>[_.key,Number(_.rank??0)]));return[...t].sort((_,g)=>{const b=i.get(_.key)??9999,f=i.get(g.key)??9999;return b-f}).map(_=>{var f;const b=[...Array.isArray(_.reviewers)?_.reviewers:[]].sort((x,E)=>{const l=new Date(x.submitted_at||x.updated_at||0).getTime();return new Date(E.submitted_at||E.updated_at||0).getTime()-l});return{..._,label:((f=S.value.find(x=>x.key===_.key))==null?void 0:f.label)||_.key,reviewers:b}})});return(s,t)=>{var i,o,_,g,b,f,x,E;return r(),a("div",Ue,[e("div",Ie,[t[10]||(t[10]=e("h1",{class:"text-xl font-semibold text-gray-900"},"Yearly KPI Report",-1)),e("div",Oe,[t[7]||(t[7]=y(" Cycle: ")),e("span",Be,n(((i=H.value)==null?void 0:i.slug)||"-"),1),t[8]||(t[8]=y(" • Year: ")),e("span",Je,n(k.value),1),t[9]||(t[9]=y(" • Generated: ")),e("span",null,n(we()),1)])]),e("div",He,[e("div",We,[B(Ve,{company_id:p.company_id,"onUpdate:company_id":t[1]||(t[1]=l=>p.company_id=l),department_id:p.department_id,"onUpdate:department_id":t[2]||(t[2]=l=>p.department_id=l),employee_id:p.employee_id,"onUpdate:employee_id":t[3]||(t[3]=l=>p.employee_id=l),line_type:p.line_type,"onUpdate:line_type":t[4]||(t[4]=l=>p.line_type=l),"initial-value":A.value,class:"w-full",onFilterChange:De},{default:ee(()=>[e("div",Qe,[t[11]||(t[11]=e("label",{for:"",class:"top-label -top-1"},"Year",-1)),te(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>k.value=l),class:"w-32 rounded-lg border border-gray-300 bg-white px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50 disabled:opacity-60",disabled:Y($),"aria-label":"Select year"},[(r(!0),a(h,null,w(oe.value,l=>(r(),a("option",{key:l,value:l},n(l),9,Ze))),128))],8,Xe),[[ye,k.value,void 0,{number:!0}]])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])]),e("div",et,[te(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>X.value=l),type:"search",placeholder:"Search gaps/strengths/suggestions",class:"flex-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"},null,512),[[$e,X.value]]),te(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>Z.value=l),class:"rounded-lg border border-gray-300 bg-white px-2 py-1 text-sm focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"},[(r(),a(h,null,w(Ne,l=>e("option",{key:l.value,value:l.value},n(l.label),9,tt)),64))],512),[[ye,Z.value]]),e("button",{class:"btn-1 rounded",onClick:Le,disabled:I.value||Y($)},[t[12]||(t[12]=e("i",{class:"far fa-file-excel mr-1 text-lg text-green-600"},null,-1)),y(" "+n(I.value?"Preparing...":"Download Excel"),1)],8,st),e("button",{class:"btn-1 rounded",onClick:Ae,disabled:O.value||Y($)},[t[13]||(t[13]=e("i",{class:"far fa-file-excel mr-1 text-lg text-green-600"},null,-1)),y(" "+n(O.value?"Preparing...":"Download Comments Excel"),1)],8,lt)])]),Y($)?(r(),a("div",nt,[B(Me)])):Y(se)?(r(),a("div",ot,n(Y(se)),1)):(r(),a(h,{key:2},[e("div",at,[e("div",rt,[e("div",null,[e("div",it," KPI Cycle • "+n(T((o=H.value)==null?void 0:o.slug)),1),e("h2",dt," Year "+n(k.value)+" • "+n(T(p.line_type)),1),e("div",ut,[e("span",pt,[t[14]||(t[14]=y(" Employees: ")),e("b",ct,n(((_=M.value)==null?void 0:_.total_employees)??0),1)]),e("span",_t,[t[15]||(t[15]=y(" With results: ")),e("b",mt,n(((g=M.value)==null?void 0:g.with_results)??0),1)]),e("span",yt,[t[16]||(t[16]=y(" Avg final: ")),e("b",bt,n(D(((b=M.value)==null?void 0:b.avg_final_percent)??0)),1)]),e("span",xt,[t[17]||(t[17]=y(" Completion: ")),e("b",gt,n(D(((f=M.value)==null?void 0:f.review_completion_percent)??0)),1)]),V.value?(r(),a("span",ft,[t[18]||(t[18]=y(" Lanes: ")),e("b",vt,n(V.value),1)])):c("",!0)])]),e("div",ht,[t[19]||(t[19]=e("div",null,[e("b",{class:"text-slate-700"},"API Filters")],-1)),e("div",null,"line_type: "+n(((x=ae.value)==null?void 0:x.line_type)??"-"),1),e("div",null,"submitted_only: "+n((E=ae.value)!=null&&E.submitted_only?"true":"false"),1)])])]),e("div",wt,[(r(!0),a(h,null,w(K.value,(l,m)=>{var C;return r(),a("div",{key:"m-"+(((C=l.employee)==null?void 0:C.id)??m),class:"rounded-2xl border border-gray-200 bg-white shadow-sm p-3"},[e("div",kt,[e("div",Nt,[e("div",{class:"text-sm font-semibold text-slate-900 truncate",title:l._name},n(m+1)+". "+n(l._name),9,St),e("div",Ct,[l._dept?(r(),a("span",jt,n(l._dept),1)):c("",!0),l._dept&&l._company?(r(),a("span",Rt," • ")):c("",!0),l._company?(r(),a("span",Lt,n(l._company),1)):c("",!0),l._joining?(r(),a("span",At," • Joined "+n(l._joining),1)):c("",!0)])]),e("div",Dt,[e("span",{class:J(["inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] font-semibold",ie(l)])},n(Q(l)),3)])]),S.value.length?(r(),a("div",Tt,[(r(!0),a(h,null,w(S.value,d=>(r(),a("div",{key:"m-lane-"+d.key,class:"rounded-xl border p-2 text-center"},[e("div",{class:"text-[10px] font-medium text-slate-600 truncate",title:d.label},n(d.label),9,Pt),e("div",Yt,[e("span",{class:J(["inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-[11px] font-semibold",q(l,d.key).cls])},n(q(l,d.key).text),3)])]))),128))])):c("",!0),e("div",Et,[e("button",{type:"button",class:"text-xs font-semibold text-sky-600 hover:text-sky-800",onClick:d=>ue(l)}," Open review modal ",8,Ft)])])}),128)),K.value.length===0?(r(),a("div",zt,"No data")):c("",!0)]),e("div",Gt,[e("table",$t,[e("thead",Mt,[e("tr",null,[t[20]||(t[20]=e("th",{class:"sticky left-0 z-[6] border-b border-r bg-gray-100/95 px-3 py-2 text-center",style:{"min-width":"3rem",width:"3rem"}}," SL ",-1)),t[21]||(t[21]=e("th",{class:"sticky z-[6] border-b border-r bg-gray-100/95 px-3 py-2 text-left",style:{left:"3rem",minWidth:"18rem",width:"18rem"}}," Employee ",-1)),t[22]||(t[22]=e("th",{class:"border-b border-r px-3 py-2 text-center",style:{"min-width":"7rem"}}," Progress ",-1)),(r(!0),a(h,null,w(S.value,l=>(r(),a("th",{key:"lane-head-"+l.key,class:"border-b border-r px-2 py-2 text-center",style:{"min-width":"6.5rem"}},[e("span",Vt,n(l.label),1)]))),128)),t[23]||(t[23]=e("th",{class:"border-b border-r px-3 py-2 text-center",style:{"min-width":"8rem"}}," Final ",-1)),t[24]||(t[24]=e("th",{class:"border-b px-3 py-2 text-left"}," All comments ",-1))])]),e("tbody",null,[(r(!0),a(h,null,w(K.value,(l,m)=>{var C;return r(),a("tr",{key:"d-"+(((C=l.employee)==null?void 0:C.id)??m),class:"border-t hover:bg-slate-50/80 transition-colors"},[e("td",qt,n(m+1),1),e("td",Kt,[e("div",Ut,[e("div",{class:"font-semibold text-slate-900 truncate",title:l._name},n(l._name),9,It),e("div",Ot,[l._dept?(r(),a("span",Bt,n(l._dept),1)):c("",!0),l._dept&&l._company?(r(),a("span",Jt," • ")):c("",!0),l._company?(r(),a("span",Ht,n(l._company),1)):c("",!0),l._joining?(r(),a("span",Wt," • Joined "+n(l._joining),1)):c("",!0)])])]),e("td",Qt,[e("span",{class:J(["inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-[12px] font-semibold",ie(l)])},n(Q(l)),3)]),(r(!0),a(h,null,w(S.value,d=>(r(),a("td",{key:"lane-"+d.key+"-"+m,class:"border-r px-2 py-2 text-center"},[e("div",Xt,[e("span",{class:J(["inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-[11px] font-semibold",q(l,d.key).cls])},n(q(l,d.key).text),3)])]))),128)),e("td",Zt,[e("span",es,n(l.finalPercent==null?"—":D(l.finalPercent)),1)]),e("td",ts,[e("div",ss,[e("div",ls,[e("button",{type:"button",class:"text-[11px] font-semibold text-sky-600 hover:text-sky-800",onClick:d=>ue(l)}," Open review modal ",8,ns)])])])])}),128)),K.value.length===0?(r(),a("tr",os,t[25]||(t[25]=[e("td",{colspan:"100",class:"px-3 py-8 text-center text-gray-600"},"No data",-1)]))):c("",!0)])])]),B(xe,{name:"fade-scale"},{default:ee(()=>[U.value&&u.value?(r(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:be(R,["escape","window"])},[e("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:R}),e("div",as,[e("div",rs,[e("div",null,[e("p",is,n(u.value._name),1),e("p",ds,[y(n(u.value._dept||"Department unknown")+" ",1),u.value._company?(r(),a("span",us," • "+n(u.value._company),1)):c("",!0),u.value._joining?(r(),a("span",ps," • Joined "+n(u.value._joining),1)):c("",!0)]),e("p",cs,"Line type: "+n(u.value._type),1)]),e("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")]),e("div",_s,[e("article",ms,[e("div",ys,[u.value.latestReviewStrengths?(r(),a("div",bs,[t[26]||(t[26]=e("span",{class:"font-semibold text-slate-800"},"Strengths:",-1)),e("div",xs,n(u.value.latestReviewStrengths),1)])):c("",!0),u.value.latestReviewGaps?(r(),a("div",gs,[t[27]||(t[27]=e("span",{class:"font-semibold text-slate-800"},"Gaps:",-1)),e("div",fs,n(u.value.latestReviewGaps),1)])):c("",!0),u.value.latestReviewSuggestions?(r(),a("div",vs,[t[28]||(t[28]=e("span",{class:"font-semibold text-slate-800"},"Suggestions:",-1)),e("div",hs,n(u.value.latestReviewSuggestions),1)])):c("",!0),!u.value.latestReviewStrengths&&!u.value.latestReviewGaps&&!u.value.latestReviewSuggestions?(r(),a("div",ws," No latest review comments ")):c("",!0)])])])])],32)):c("",!0)]),_:1})],64)),B(xe,{name:"fade-scale"},{default:ee(()=>{var l;return[U.value&&u.value?(r(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:be(R,["escape","window"])},[e("div",{class:"absolute inset-0","aria-hidden":"true",onClick:R}),e("div",ks,[e("div",Ns,[e("div",Ss,[e("div",Cs,[e("p",js,n(u.value._name),1),e("p",Rs,[y(n(u.value._dept||"Department unknown")+" ",1),u.value._company?(r(),a("span",Ls," • "+n(u.value._company),1)):c("",!0),u.value._joining?(r(),a("span",As," • Joined "+n(u.value._joining),1)):c("",!0)]),e("div",Ds,[e("span",Ts,[t[29]||(t[29]=y(" Progress: ")),e("b",Ps,n(Q(u.value)),1)]),e("span",Ys,[t[30]||(t[30]=y(" Final: ")),e("b",Es,n(u.value.finalPercent==null?"—":D(u.value.finalPercent)),1)]),e("span",Fs,[t[31]||(t[31]=y(" Reviews: ")),e("b",zs,n(((l=u.value.progress)==null?void 0:l.review_count)??0),1)])])]),e("button",{type:"button",class:"shrink-0 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")])]),e("div",Gs,[me.value.length?c("",!0):(r(),a("div",$s," No reviews found for this employee. ")),(r(!0),a(h,null,w(me.value,m=>{var C;return r(),a("div",{key:"lane-group-"+m.key,class:"rounded-2xl border border-slate-200 bg-white overflow-hidden"},[e("div",Ms,[e("div",Vs,[e("span",{class:"text-sm font-semibold text-slate-900 truncate",title:m.label},n(m.label),9,qs),e("span",Ks," (key: "+n(m.key)+") ",1)]),e("div",Us,[e("span",Is,[t[32]||(t[32]=y(" Count: ")),e("b",Os,n(m.count??((C=m.reviewers)==null?void 0:C.length)??0),1)]),e("span",Bs,[t[33]||(t[33]=y(" Avg: ")),e("b",Js,n(m.average_marks==null?"—":D(m.average_marks)),1)]),e("span",Hs,[t[34]||(t[34]=y(" Latest: ")),e("b",Ws,n(_e(m.latest_review_at)||"—"),1)])])]),e("div",Qs,[(r(!0),a(h,null,w(m.reviewers||[],(d,Te)=>(r(),a("div",{key:"rv-"+m.key+"-"+Te+"-"+(d.id??"x"),class:"rounded-xl border border-slate-200 bg-white p-3"},[e("div",Xs,[e("div",Zs,[e("div",el,n(d.name||"Reviewer"),1),e("div",tl,[y(" Lane: "+n(d.lane||m.key)+" ",1),d.submitted_at||d.updated_at?(r(),a("span",sl," • "+n(_e(d.submitted_at||d.updated_at)),1)):c("",!0)])]),e("div",ll,[e("span",nl,n(d.percent==null?"—":D(d.percent)),1),d.obtained_total!=null&&d.max_total!=null?(r(),a("span",ol,n(d.obtained_total),1)):c("",!0)])]),e("div",al,[d.strengths&&d.strengths.length?(r(),a("div",rl,[t[35]||(t[35]=e("div",{class:"font-semibold text-slate-900"},"Strengths",-1)),e("ul",il,[(r(!0),a(h,null,w(d.strengths,(F,z)=>(r(),a("li",{key:"s-"+z},n(F),1))),128))])])):c("",!0),d.gaps&&d.gaps.length?(r(),a("div",dl,[t[36]||(t[36]=e("div",{class:"font-semibold text-slate-900"},"Gaps",-1)),e("ul",ul,[(r(!0),a(h,null,w(d.gaps,(F,z)=>(r(),a("li",{key:"g-"+z},n(F),1))),128))])])):c("",!0),d.suggestions&&d.suggestions.length?(r(),a("div",pl,[t[37]||(t[37]=e("div",{class:"font-semibold text-slate-900"},"Suggestions",-1)),e("ul",cl,[(r(!0),a(h,null,w(d.suggestions,(F,z)=>(r(),a("li",{key:"u-"+z},n(F),1))),128))])])):c("",!0),(!d.strengths||!d.strengths.length)&&(!d.gaps||!d.gaps.length)&&(!d.suggestions||!d.suggestions.length)?(r(),a("div",_l," No comments in this review. ")):c("",!0)])]))),128)),!m.reviewers||m.reviewers.length===0?(r(),a("div",ml," No reviewers found in this lane. ")):c("",!0)])])}),128))]),e("div",{class:"p-4 border-t border-slate-200 bg-white flex items-center justify-end gap-2"},[e("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")])])],32)):c("",!0)]}),_:1})])}}},jl=Ke(yl,[["__scopeId","data-v-598b2d67"]]);export{jl as default};
