import{_ as R}from"./EmployeeFilter-RfQWoK17.js";import{_ as E}from"./FlexibleDatePicker-C_-_m3lE.js";import{L as I}from"./LoaderView-DrlR7xjA.js";import{u as O,U as Q}from"./UpdateOrCreate-Cq2yhj4b.js";import{g as z,u as G,f as H,r as m,x as g,q as w,h as J,c as u,o as d,a as e,j as N,d as D,m as K,t as l,k as j,F as Y,e as W,s as X,n as k}from"./index-BHrnLVaH.js";import"./company-BYQCX3og.js";import"./department-7oYwca9Q.js";import"./EmployeeDropdownInput-BuWcHQ3d.js";import"./SelectDropdown-DaO1l3SG.js";import"./UserChip-Dsc3ZxtS.js";import"./user-DKfck89E.js";import"./TimePickerAsFloatHour-C-m49Tj5.js";const Z={class:"px-4 space-y-5"},ee={class:"rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},te={class:"flex flex-wrap gap-2 p-3 rounded-2xl border border-white/20 bg-white/60 backdrop-blur-md shadow-sm supports-[backdrop-filter]:bg-white/50 sticky top-14"},ae={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},se={class:"rounded-2xl border border-slate-100 bg-slate-50 px-4 py-3"},oe={class:"text-2xl font-semibold text-slate-900"},le={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},re={class:"text-xl font-semibold text-amber-700"},ne={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},ie={class:"text-xl font-semibold text-emerald-700"},de={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},pe={class:"text-xl font-semibold text-rose-700"},ue={key:1,class:"rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden"},ce={class:"overflow-x-auto"},ye={class:"min-w-full text-sm"},me={class:"px-4 py-3"},_e={class:"px-4 py-3"},xe={class:"px-4 py-3"},fe={class:"px-4 py-3"},ve={class:"px-4 py-3"},he={class:"px-4 py-3"},be={class:"px-4 py-3"},ge={class:"px-4 py-3 text-right"},we={class:"flex items-center justify-end gap-2"},ke=["onClick"],Se={key:0,class:"px-4 py-10 text-center text-slate-500"},Ce={key:0},Pe={key:1},Ee={__name:"PayCutList",setup(Ne){const U=z(),q=G(),c=H(),p=O(),y=m(c.query.month||new Date().toISOString().slice(0,7)),L=a=>a.toString().padStart(2,"0"),r=m({year:Number(y.value.split("-")[0]||new Date().getFullYear()),month:Number(y.value.split("-")[1]||new Date().getMonth()+1),day:1}),i=g(()=>!r.value.year||!r.value.month?"":`${r.value.year}-${L(r.value.month)}`),s=m({company_id:c.query.company_id||"",department_id:c.query.department_id||"",line_type:c.query.line_type||"all",employee_id:c.query.employee_id||""}),f=m(!1);g(()=>p.paycuts.length);const _=g(()=>{const a={total:0,pending:0,approved:0,rejected:0},t=p.paycuts||[];return a.total=t.length,t.forEach(o=>{const n=(o.status||"").toLowerCase();n==="pending"?a.pending++:n==="approved"?a.approved++:n==="rejected"&&a.rejected++}),a}),A=a=>{const t=(a||"").toLowerCase();return t==="approved"?"text-emerald-700 bg-emerald-50 border border-emerald-100":t==="rejected"?"text-rose-700 bg-rose-50 border border-rose-100":t==="pending"?"text-amber-700 bg-amber-50 border border-amber-100":"text-slate-700 bg-slate-100 border border-slate-200"};async function v(){if(!i.value||!s.value.company_id){p.paycuts=[];return}const a={month:i.value,company_id:String(s.value.company_id)};s.value.employee_id&&(a.user_id=String(s.value.employee_id)),f.value=!0;try{await p.fetchPaycuts(a)}finally{f.value=!1}}function F(){const a={};return i.value&&(a.month=String(i.value)),s.value.company_id&&(a.company_id=String(s.value.company_id)),s.value.department_id&&(a.department_id=String(s.value.department_id)),s.value.employee_id&&(a.employee_id=String(s.value.employee_id)),s.value.line_type&&s.value.line_type!=="all"&&(a.line_type=String(s.value.line_type)),a}let h=null;function M(){h&&clearTimeout(h),h=setTimeout(()=>{const a=F();q.replace({query:a}).catch(()=>{})},120)}let b=null;const S=m("");async function T(){M();const a=JSON.stringify({m:i.value||"",c:s.value.company_id||"",d:s.value.department_id||"",t:s.value.line_type||"all",e:s.value.employee_id||""});a!==S.value&&(await v(),S.value=a)}function x(){b&&clearTimeout(b),b=setTimeout(T,200)}w(()=>({...s.value,month:i.value}),()=>x(),{deep:!0}),w(i,()=>{i.value&&(y.value=i.value,x())}),w(()=>c.query,a=>{const t=a.month||"";t!==y.value&&(y.value=t,r.value.year=Number(t.split("-")[0]||r.value.year),r.value.month=Number(t.split("-")[1]||r.value.month));const o={company_id:a.company_id||"",department_id:a.department_id||"",line_type:a.line_type||"all",employee_id:a.employee_id||""},n=s.value;(o.company_id!==n.company_id||o.department_id!==n.department_id||o.line_type!==n.line_type||o.employee_id!==n.employee_id)&&(s.value=o)}),J(async()=>{x()});function V(){x()}async function $(a){confirm("Are you sure you want to delete this paycut?")&&(await p.deletePaycut(a),await v())}const B=a=>a?new Date(a).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return(a,t)=>(d(),u("div",Z,[e("div",ee,[t[5]||(t[5]=e("div",null,[e("p",{class:"text-xs uppercase tracking-widest text-slate-500"},"Monthly Paycut"),e("h1",{class:"text-2xl font-semibold text-slate-900"},"Paycut log"),e("p",{class:"text-sm text-slate-500"},"Use filters to narrow down the report.")],-1)),e("div",te,[D(R,{company_id:s.value.company_id,"onUpdate:company_id":t[1]||(t[1]=o=>s.value.company_id=o),department_id:s.value.department_id,"onUpdate:department_id":t[2]||(t[2]=o=>s.value.department_id=o),employee_id:s.value.employee_id,"onUpdate:employee_id":t[3]||(t[3]=o=>s.value.employee_id=o),line_type:s.value.line_type,"onUpdate:line_type":t[4]||(t[4]=o=>s.value.line_type=o),"with-type":!0,"initial-value":a.$route.query,onFilterChange:V,class:"min-w-[220px]"},{default:K(()=>[D(E,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),"show-year":!1,"show-month":!0,"show-date":!1,label:"Month"},null,8,["modelValue"])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])])]),e("div",ae,[e("div",se,[t[6]||(t[6]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Total",-1)),e("p",oe,l(_.value.total),1)]),e("div",le,[t[7]||(t[7]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Pending",-1)),e("p",re,l(_.value.pending),1)]),e("div",ne,[t[8]||(t[8]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Approved",-1)),e("p",ie,l(_.value.approved),1)]),e("div",de,[t[9]||(t[9]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Rejected",-1)),e("p",pe,l(_.value.rejected),1)])]),f.value?(d(),N(I,{key:0})):(d(),u("div",ue,[e("div",ce,[e("table",ye,[t[11]||(t[11]=e("thead",{class:"bg-slate-50 text-xs uppercase tracking-wider text-slate-500"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left"},"#"),e("th",{class:"px-4 py-3 text-left"},"Employee"),e("th",{class:"px-4 py-3 text-left"},"Created Date"),e("th",{class:"px-4 py-3 text-left"},"Paycut Hours"),e("th",{class:"px-4 py-3 text-left"},"Reason"),e("th",{class:"px-4 py-3 text-left"},"Note"),e("th",{class:"px-4 py-3 text-left"},"Status"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(d(!0),u(Y,null,W(k(p).paycuts,(o,n)=>{var C,P;return d(),u("tr",{key:o.id,class:"border-t hover:bg-slate-50 transition-colors"},[e("td",me,l(n+1),1),e("td",_e,l(((C=o.user)==null?void 0:C.name)||"N/A"),1),e("td",xe,l(B(o.created_at)),1),e("td",fe,l(o.paycut_hours),1),e("td",ve,l(o.reason||"—"),1),e("td",he,l(o.note||"—"),1),e("td",be,[e("span",{class:X(["inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold tracking-wide border",A(o.status)])},l(o.status||"Pending"),3)]),e("td",ge,[e("div",we,[((P=k(U).user)==null?void 0:P.id)===8?(d(),N(Q,{key:0,userId:o.user_id,month:y.value,onUpdated:v},null,8,["userId","month"])):j("",!0),e("button",{type:"button",class:"text-red-500",onClick:De=>$(o.id)},t[10]||(t[10]=[e("i",{class:"fa fa-trash"},null,-1)]),8,ke)])])])}),128))])])]),k(p).paycuts.length?j("",!0):(d(),u("div",Se,[s.value.company_id?(d(),u("p",Pe,"No paycuts found for the selected filters.")):(d(),u("p",Ce,"Please select a company to load paycut data."))]))]))]))}};export{Ee as default};
