import{u as G,y as f,r as y,b as K,O as Q,A as X,c,a,m as M,n as Z,k as ee,w as ae,d as m,v as x,t as L,e as V,F as N,x as W,h as $,f as te,p as le,o as v,l as se,P as T,g as oe}from"./index-DmaVMTUz.js";import{L as ne}from"./LoaderView-Dye5BGZ5.js";import{_ as re}from"./MultiselectDropdown-Cy6arn7t.js";import{u as ie}from"./holiday-LHSBukgA.js";import{u as ue}from"./leave-application-CNvCtOi9.js";import{u as de}from"./leave-type-wcQakbaZ.js";import{u as pe}from"./user-ynlUMmH6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-BSVvaPqV.js";const ve={class:"my-container max-w-3xl space-y-4"},ce={class:"flex items-center justify-between gap-2"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},_e={key:0,class:""},fe={class:"text-blue-600 font-medium"},ye={key:1,class:"bg-gray-100 p-2 rounded-md"},we={class:"font-semibold"},ke={class:"flex flex-wrap gap-2"},ge=["name","value","onUpdate:modelValue"],he={class:"flex items-center space-x-1"},be=["name","onUpdate:modelValue"],De={class:"flex items-center space-x-1"},Ae=["name","onUpdate:modelValue"],Se={key:2,class:"text-red-500 text-sm"},Fe={__name:"LeaveApplicationEdit",setup(xe){const _=G(),i=ue(),R=oe(),B=te(),w=de(),k=pe(),j=ie(),U=f(()=>i.leaveApplication),I=f(()=>B.params.id),g=y(null),t=y({user_id:"",last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]});K(async()=>{var e,r,o,n,l,d,D,A,E,H;const{id:s}=B.params;try{await i.fetchLeaveApplicationById(s);const S=(o=(r=(e=i.leaveApplication)==null?void 0:e.user)==null?void 0:r.company)==null?void 0:o.id;if(S&&await w.fetchLeaveTypes(S),i.leaveApplication&&(await k.fetchUsers(),k.users.length>0)){const C=f(()=>k.users.filter(Y=>{var F;return Y.id===((F=i.leaveApplication)==null?void 0:F.handover_user_id)})[0]||{});console.log("users",C.value),g.value=C.value}i.leaveApplication&&(t.value.user_id=(n=i.leaveApplication)==null?void 0:n.user_id,t.value.last_working_date=(l=i.leaveApplication)==null?void 0:l.last_working_date,t.value.resumption_date=(d=i.leaveApplication)==null?void 0:d.resumption_date,t.value.reason=(D=i.leaveApplication)==null?void 0:D.reason,t.value.works_in_hand=(A=i.leaveApplication)==null?void 0:A.works_in_hand,t.value.handover_user_id=(E=i.leaveApplication)==null?void 0:E.handover_user_id,t.value.leave_days=(H=i.leaveApplication)==null?void 0:H.leave_days)}catch(S){console.error("Failed to load leave application:",S)}finally{h.value=!1}});const u=y([]),h=y(!1),b=y(null),q=f(()=>{var s,e,r;return((e=(s=_==null?void 0:_.user)==null?void 0:s.assign_weekend)==null?void 0:e.weekends)||((r=_==null?void 0:_.user)==null?void 0:r.weekends)}),p=f(()=>{const s=t.value.last_working_date,e=t.value.resumption_date;if(!s||!e)return[];const r=new Date(s),o=new Date(e);if(o<=r)return[];const n=[];let l=new Date(r);for(l.setDate(l.getDate()+1);l<o;){const d=l.getFullYear(),D=(l.getMonth()+1).toString().padStart(2,"0"),A=l.getDate().toString().padStart(2,"0");n.push(`${d}-${D}-${A}`),l.setDate(l.getDate()+1)}return n}),P=f(()=>{const s=t.value.last_working_date,e=t.value.resumption_date;if(!s||!e)return"";const r=new Date(s);return new Date(e)<=r?"Resumption date must be after Last Working Date.":p.value.length===0?"No leave days between the selected dates.":`Total leave days: ${p.value.length}`});Q(()=>{p.value.length&&w.leaveTypes.length&&(u.value.length!==p.value.length&&(u.value=p.value.map(()=>w.leaveTypes[0].id)),p.value.forEach(async(s,e)=>{const r=new Date(s).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),o=r.charAt(0).toUpperCase()+r.slice(1);q.value.includes(o)&&(u.value[e]="weekend"),await O(s)&&(u.value[e]="holiday")}))}),X(()=>g.value,s=>{t.value.handover_user_id=s==null?void 0:s.id});const z=async()=>{var s;h.value=!0,b.value=null;try{const e=p.value.map((l,d)=>({date:l,leave_type_id:u.value[d]!=="weekend"&&u.value[d]!=="holiday"?u.value[d]:null})).filter(l=>l.leave_type_id!==null),r=p.value.map((l,d)=>({date:l,leave_type_id:u.value[d]||""})).filter(l=>l.leave_type_id!==null),o={id:I.value,user_id:(s=U==null?void 0:U.value)==null?void 0:s.user_id,last_working_date:t.value.last_working_date,resumption_date:t.value.resumption_date,reason:t.value.reason,works_in_hand:t.value.works_in_hand,handover_user_id:t.value.handover_user_id,leave_days:e,json_data:r},n=await i.storeLeaveApplication(o);n&&R.push({name:"LeaveApplicationShow",params:{id:n==null?void 0:n.id}})}catch(e){b.value=e.message||"Failed to submit leave application"}finally{h.value=!1}},J=()=>{R.go(-1)},O=async s=>{var e;try{return(((e=(await j.fetchHolidays({start_date:s}))[0])==null?void 0:e.start_date)||[]).includes(s)}catch(r){return console.error("Error fetching holidays:",r),!1}};return(s,e)=>{const r=le("RouterLink");return v(),c("div",ve,[a("div",ce,[a("button",{class:"btn-3",onClick:J},e[5]||(e[5]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=a("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),a("div",null,[M(r,{to:"/my-applications",class:"btn-2"},{default:Z(()=>e[6]||(e[6]=[se("Home")])),_:1})])]),h.value?(v(),ee(ne,{key:0})):(v(),c("form",{key:1,onSubmit:ae(z,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[a("div",me,[a("div",null,[e[8]||(e[8]=a("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),m(a("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=o=>t.value.last_working_date=o),class:"input-1 w-full",required:""},null,512),[[x,t.value.last_working_date]])]),a("div",null,[e[9]||(e[9]=a("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),m(a("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=o=>t.value.resumption_date=o),class:"input-1 w-full",required:""},null,512),[[x,t.value.resumption_date]])])]),t.value.last_working_date&&t.value.resumption_date?(v(),c("div",_e,[a("p",fe,L(P.value),1)])):V("",!0),p.value.length?(v(),c("div",ye,[e[12]||(e[12]=a("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),a("div",null,[(v(!0),c(N,null,W(p.value,(o,n)=>(v(),c("div",{key:n,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[a("div",we,L(o),1),a("div",ke,[(v(!0),c(N,null,W($(w).leaveTypes,l=>(v(),c("label",{key:l.id,class:"flex items-center space-x-1"},[m(a("input",{type:"radio",name:"leaveType-"+n,value:l.id,"onUpdate:modelValue":d=>u.value[n]=d},null,8,ge),[[T,u.value[n]]]),a("span",null,L(l.name),1)]))),128)),a("label",he,[m(a("input",{type:"radio",name:"leaveType-"+n,value:"weekend","onUpdate:modelValue":l=>u.value[n]=l},null,8,be),[[T,u.value[n]]]),e[10]||(e[10]=a("span",null,"Weekend",-1))]),a("label",De,[m(a("input",{type:"radio",name:"leaveType-"+n,value:"holiday","onUpdate:modelValue":l=>u.value[n]=l},null,8,Ae),[[T,u.value[n]]]),e[11]||(e[11]=a("span",null," Holiday",-1))])])]))),128))])])):V("",!0),a("div",null,[e[13]||(e[13]=a("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),m(a("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=o=>t.value.reason=o),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[x,t.value.reason]])]),a("div",null,[e[14]||(e[14]=a("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),m(a("textarea",{id:"works-in-hand","onUpdate:modelValue":e[3]||(e[3]=o=>t.value.works_in_hand=o),class:"input-1 w-full",placeholder:"Enter details of works in hand"},null,512),[[x,t.value.works_in_hand]])]),a("div",null,[e[15]||(e[15]=a("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),M(re,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=o=>g.value=o),options:$(k).users,multiple:!1,label:"name",placeholder:"Select user"},null,8,["modelValue","options"])]),b.value?(v(),c("div",Se,L(b.value),1)):V("",!0),e[16]||(e[16]=a("div",{class:"flex justify-end"},[a("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{Fe as default};
