import{_ as N}from"./EmployeeFilter-PQgfxrZR.js";import{_ as V}from"./FlexibleDatePicker-CnsmjhtI.js";import{L as B}from"./LoaderView-D7eqSlTh.js";import{u as E}from"./attendance-TOZPdVH8.js";import{u as F,f as R,D as $,r,q as k,x as P,c as i,o as d,a as s,d as f,m as T,n as p,k as Y,F as j,e as z,t as y,s as K,b as O}from"./index-Ck--8GOP.js";import{S as W}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./company-Cp13ehi2.js";import"./department-BomZ8Cd_.js";import"./EmployeeDropdownInput-BvmFYTeI.js";import"./SelectDropdown-BYraj_i4.js";import"./UserChip-BHiXRNSK.js";import"./user-jxH749hX.js";const G={class:"space-y-4 px-4"},H={class:"flex flex-wrap gap-2 bg-white p-2 rounded-md shadow-md items-center"},I={key:0,class:"text-center py-4"},J={key:1,class:"space-y-4"},Q={key:0,class:"rounded-2xl border border-slate-200 bg-white shadow overflow-hidden"},X={class:"overflow-x-auto"},Z={class:"min-w-full text-sm text-slate-600"},ee={class:"divide-y divide-slate-100 bg-white"},te={class:"px-4 py-3 font-semibold text-slate-700"},le={class:"px-4 py-3"},se={class:"px-4 py-3 text-slate-800 font-medium"},ne={class:"px-4 py-3"},oe={class:"px-4 py-3"},ae={class:"px-4 py-3 text-emerald-600 font-semibold"},ie={class:"px-4 py-3 text-amber-600 font-semibold"},de={class:"px-4 py-3"},ye={key:0},ce={key:1,class:"text-xs text-slate-400 italic"},ue={class:"px-4 py-3"},pe={class:"inline-flex items-center gap-1 rounded-full bg-indigo-50 px-2 py-1 text-xs font-semibold text-indigo-700"},_e={key:0},me={key:1,class:"text-center text-red-500 text-xl italic mt-10"},Ue={__name:"LateAttendanceReport",setup(xe){const _=F(),c=R(),u=E(),{monthlyLateLogs:m,isLoading:q,selectedMonth:M}=$(u),S=t=>String(t??"").padStart(2,"0"),L=t=>{const l=new Date;if(!t)return{year:l.getFullYear(),month:l.getMonth()+1};const[e="",a=""]=t.split("-");return!e||!a?{year:l.getFullYear(),month:l.getMonth()+1}:{year:Number(e)||l.getFullYear(),month:Number(a)||l.getMonth()+1}},o=r(c.query.date||M.value||""),x=r(L(o.value)),n=r({company_id:"",department_id:"all",line_type:"all",employee_id:""}),U=()=>{var t,l,e,a;o.value&&(_.replace({query:{...c.query,date:o.value}}),(t=n.value)!=null&&t.company_id&&((l=n.value)!=null&&l.department_id)&&((e=n.value)!=null&&e.line_type)&&((a=n.value)!=null&&a.employee_id)&&v(n.value))};k(x,t=>{if(!t)return;const l=`${t.year}-${S(t.month)}`;o.value!==l&&(o.value=l)},{deep:!0}),k(o,()=>{U(),u.selectedMonth=o.value},{immediate:!0});const v=async t=>{t.company_id&&(t!=null&&t.department_id)&&(t!=null&&t.line_type)&&(t!=null&&t.line_type)&&(t!=null&&t.employee_id)&&o.value&&await u.getAttendanceLateReport(t==null?void 0:t.company_id,t==null?void 0:t.department_id,t==null?void 0:t.line_type,t==null?void 0:t.employee_id,o.value,"monthly")},A=async()=>{n.value.company_id&&n.value.employee_id&&o.value?await u.lateReportDownloadExcel(n.value.company_id,n.value.employee_id,o.value,"monthly"):W.fire({icon:"warning",title:"Missing Selection!",text:"Please select Company, Employee, and Month first!",confirmButtonText:"OK"})},C=()=>{_.go(-1)},D=async()=>{var t,l,e,a,h,g,b,w;_.replace({query:{...c.query,company_id:(t=n.value)==null?void 0:t.company_id,department_id:(l=n.value)==null?void 0:l.department_id,line_type:(e=n.value)==null?void 0:e.line_type,employee_id:(a=n.value)==null?void 0:a.employee_id,date:o.value}}),(h=n.value)!=null&&h.company_id&&((g=n.value)!=null&&g.department_id)&&((b=n.value)!=null&&b.line_type)&&((w=n.value)!=null&&w.employee_id)&&v(n.value)};return P(()=>({company_id:c.query.company_id||"",department_id:c.query.department_id||"all",line_type:c.query.line_type||"all",employee_id:c.query.employee_id||""})),(t,l)=>(d(),i("div",G,[s("div",{class:"flex items-center justify-between gap-2"},[s("button",{class:"btn-3",onClick:C},l[5]||(l[5]=[s("i",{class:"far fa-arrow-left"},null,-1),s("span",{class:"hidden md:flex"},"Back",-1)])),l[7]||(l[7]=s("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Late Reports",-1)),s("div",{class:"flex gap-4"},[s("button",{type:"button",onClick:A,class:"btn-3"},l[6]||(l[6]=[s("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1)]))])]),s("div",H,[f(N,{company_id:n.value.company_id,"onUpdate:company_id":l[1]||(l[1]=e=>n.value.company_id=e),department_id:n.value.department_id,"onUpdate:department_id":l[2]||(l[2]=e=>n.value.department_id=e),employee_id:n.value.employee_id,"onUpdate:employee_id":l[3]||(l[3]=e=>n.value.employee_id=e),line_type:n.value.line_type,"onUpdate:line_type":l[4]||(l[4]=e=>n.value.line_type=e),"with-type":!0,"initial-value":t.$route.query,onFilterChange:D},{default:T(()=>[f(V,{modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=e=>x.value=e),"show-year":!1,"show-month":!0,"show-date":!1,label:"Month"},null,8,["modelValue"])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])]),p(q)?(d(),i("div",I,[f(B)])):(d(),i("div",J,[n.value.company_id&&n.value.employee_id&&n.value.department_id?(d(),i("div",Q,[l[11]||(l[11]=s("div",{class:"flex items-center justify-between border-b border-slate-100 bg-slate-50 px-4 py-3 text-sm font-semibold text-slate-700"},[s("span",null,"Monthly late attendance"),s("span",{class:"text-xs text-slate-500"},"Updated after each filter change")],-1)),s("div",X,[s("table",Z,[l[10]||(l[10]=s("thead",{class:"text-[11px] uppercase tracking-wide text-slate-500"},[s("tr",{class:"bg-slate-100"},[s("th",{class:"py-3 px-4 text-left"},"#"),s("th",{class:"py-3 px-4 text-left"},"Date"),s("th",{class:"py-3 px-4 text-left"},"Employee"),s("th",{class:"py-3 px-4 text-left"},"Company"),s("th",{class:"py-3 px-4 text-left"},"Department"),s("th",{class:"py-3 px-4 text-left"},"Entry"),s("th",{class:"py-3 px-4 text-left"},"Late"),s("th",{class:"py-3 px-4 text-left"},"Application"),s("th",{class:"py-3 px-4 text-left"},"Shift")])],-1)),s("tbody",ee,[(d(!0),i(j,null,z(p(m),(e,a)=>(d(),i("tr",{key:e.id||a,class:"hover:bg-slate-50 transition-colors"},[s("td",te,y(a+1),1),s("td",le,y(e==null?void 0:e.date),1),s("td",se,y((e==null?void 0:e.user_name)||"Unknown"),1),s("td",ne,y((e==null?void 0:e.company_name)||"Unknown"),1),s("td",oe,y((e==null?void 0:e.department_name)||"Unknown"),1),s("td",ae,y(e.entry_time),1),s("td",ie,y(e.late_duration||"-"),1),s("td",de,[e!=null&&e.short_leave?(d(),i("div",ye,[s("span",{class:K(["rounded-full px-3 py-1 text-xs font-semibold",{"bg-green-100 text-emerald-700":e.short_leave.status==="Approved","bg-amber-100 text-amber-700":e.short_leave.status==="Pending","bg-rose-100 text-rose-700":e.short_leave.status&&e.short_leave.status!=="Approved"}])},y(e.short_leave.status||"Waiting"),3)])):(d(),i("div",ce,"No Application"))]),s("td",ue,[s("span",pe,[l[8]||(l[8]=s("i",{class:"far fa-shift fa-xs"},null,-1)),O(" "+y(e.shift_name||"-"),1)])])]))),128)),!p(m)||!p(m).length?(d(),i("tr",_e,l[9]||(l[9]=[s("td",{colspan:"9",class:"px-4 py-8 text-center text-slate-500"}," No late entries yet for the selected filters. ",-1)]))):Y("",!0)])])])])):(d(),i("div",me," Please select company, department and employee "))]))]))}};export{Ue as default};
