import{_ as $e}from"./EmployeeFilter-CkGMD-ya.js";import{_ as Se}from"./FlexibleDatePicker-DFOfwUiz.js";import{L as Ce}from"./LoaderView-Cr3rUGsS.js";import{U as ye}from"./UpdateOrCreate-e62UG3iC.js";import{x as S,c as _,o as p,t as l,B as He,r as y,C as X,_ as fe,S as Le,q as ie,a as t,d as q,m as ue,k as z,w as De,z as Fe,s as b,F as Y,l as Pe,v as Te,T as Me,A as be,u as Ne,f as Ae,g as Ie,D as ze,h as he,y as Re,p as Ue,j as _e,b as I,n as g,e as ee,P as qe}from"./index-DAcsHfV3.js";import{_ as Ee}from"./TimePickerAsFloatHour-Vtf2kxMQ.js";import{u as Be}from"./attendance-B31YG0Yz.js";import"./company-BZSJmag9.js";import"./department-BIqJQshB.js";import"./EmployeeDropdownInput-ZuC1jxge.js";import"./SelectDropdown-D__rop5G.js";import"./UserChip-CqkfkQLX.js";import"./user-CHNsgrBP.js";const ve={__name:"DisplayFormattedWorkingHours",props:["workingHours"],setup(E){const C=E,i=S(()=>{if(!C.workingHours)return"-";const v=Math.floor(C.workingHours),H=Math.round((C.workingHours-v)*60);return H?`${v}h ${H}m`:`${v}h`});return(v,H)=>(p(),_("span",null,l(i.value),1))}},Ve=He("payroll",()=>{const E=y([]),C=y(null),i=y(!1),v=y(null),H=y(new Date().toISOString().substring(0,7)),D=(d,u)=>{var w,J,h,P;const s=((J=(w=d==null?void 0:d.response)==null?void 0:w.data)==null?void 0:J.message)||(d==null?void 0:d.message)||u,r=new Error(s);return r.status=(h=d==null?void 0:d.response)==null?void 0:h.status,r.data=(P=d==null?void 0:d.response)==null?void 0:P.data,r};return{periods:E,period:C,loading:i,error:v,selectedMonth:H,fetchPeriods:async(d={})=>{var u;i.value=!0,v.value=null;try{const s=await X.get("/payroll",{params:d});return E.value=((u=s==null?void 0:s.data)==null?void 0:u.data)||(s==null?void 0:s.data)||[],s.data}catch(s){const r=D(s,"Failed to fetch payroll periods");throw v.value=r.message,r}finally{i.value=!1}},fetchUserPeriod:async(d,u)=>{var s;i.value=!0,v.value=null;try{const r=await X.get(`/payroll/${d}/${u}`);return C.value=r.data||null,C.value}catch(r){if(((s=r==null?void 0:r.response)==null?void 0:s.status)===404)return C.value=null,null;const w=D(r,"Failed to fetch user period");throw v.value=w.message,w}finally{i.value=!1}},upsertPeriod:async d=>{var u;i.value=!0,v.value=null;try{const s=await X.post("/payroll",d);return C.value=((u=s==null?void 0:s.data)==null?void 0:u.period)||(s==null?void 0:s.data)||null,s.data}catch(s){const r=D(s,"Failed to save payroll period");throw v.value=r.message,r}finally{i.value=!1}},updatePeriod:async(d,u)=>{var s;i.value=!0,v.value=null;try{const r=await X.put(`/payroll/${d}`,u);return C.value=((s=r==null?void 0:r.data)==null?void 0:s.period)||(r==null?void 0:r.data)||null,r.data}catch(r){const w=D(r,"Failed to update payroll period");throw v.value=w.message,w}finally{i.value=!1}},lockPeriod:async d=>{var u;i.value=!0,v.value=null;try{const s=await X.put(`/payroll/${d}/lock`);return C.value=((u=s==null?void 0:s.data)==null?void 0:u.period)||(s==null?void 0:s.data)||null,s.data}catch(s){const r=D(s,"Failed to lock payroll period");throw v.value=r.message,r}finally{i.value=!1}},unlockPeriod:async d=>{var u;i.value=!0,v.value=null;try{const s=await X.put(`/payroll/${d}/unlock`);return C.value=((u=s==null?void 0:s.data)==null?void 0:u.period)||(s==null?void 0:s.data)||null,s.data}catch(s){const r=D(s,"Failed to unlock payroll period");throw v.value=r.message,r}finally{i.value=!1}},deletePeriod:async d=>{var u;i.value=!0,v.value=null;try{return await X.delete(`/payroll/${d}`),E.value=E.value.filter(s=>s.id!==d),((u=C.value)==null?void 0:u.id)===d&&(C.value=null),!0}catch(s){const r=D(s,"Failed to delete payroll period");throw v.value=r.message,r}finally{i.value=!1}}}}),Oe={class:"modal-card max-w-lg"},je={class:"modal-card__head"},We=["disabled","title","aria-busy"],Ye={key:0,class:"inline-alert inline-alert--error"},Je={class:"min-w-0"},Ke={class:"text-xs opacity-80 truncate"},Ge={class:"modal-card__meta"},Xe={class:"meta-value"},Ze={class:"meta-value truncate"},Qe={class:"meta-value"},ge={key:0},et={class:"meta-value"},tt={class:"modal-card__body"},at={key:0,class:"skeleton"},st={class:"field-control flex flex-col gap-2"},lt={class:"flex items-center justify-between"},nt={class:"text-[11px] text-slate-400"},ot={key:0,class:"text-xs text-rose-600"},rt={key:1,class:"text-xs text-amber-600"},dt={class:"flex flex-col gap-2"},it={class:"flex items-center justify-between"},ut={class:"text-[11px] text-slate-400"},ct=["disabled"],pt={class:"modal-card__footer"},_t={class:"footer-status"},vt={class:"modal-card__actions"},mt=["disabled"],yt=["disabled","aria-busy"],ht={key:0,class:"loading-dots"},ft={key:1},bt={__name:"AddonModal",props:{userId:{type:[String,Number],required:!0},month:{type:String,required:!0},employeeName:{type:String,default:""}},emits:["updated"],setup(E,{emit:C}){const i=Le(),v=Ve(),H=y(0),D=y(279),F=E,x=C,V=y(!1),L=y(!1),O=y(!1),j=y(!1),m=y(""),d=y(""),u=y(""),s=y(null),r=y({payable_hour:0,note:""}),w=S(()=>{if(!F.month)return"";const[c,o]=F.month.split("-");return new Date(Number(c),Number(o)-1).toLocaleString("en",{month:"long",year:"numeric"})}),J=S(()=>{var c;return String(((c=s.value)==null?void 0:c.status)||"draft")}),h=S(()=>{var c,o;return J.value==="locked"||!!((c=s.value)!=null&&c.locked_at)||!!((o=s.value)!=null&&o.is_locked)}),P=S(()=>h.value?"Locked":"Draft"),K=S(()=>{var c;if(!((c=s.value)!=null&&c.locked_at))return"";try{return new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(s.value.locked_at))}catch{return String(s.value.locked_at)}}),W=S(()=>Number(d.value)),Z=S(()=>{const c=W.value;return Number.isFinite(c)&&c>=H.value&&c<=D.value}),le=S(()=>`Allowed: ${H.value}h – ${D.value}h per cycle`),Q=S(()=>d.value===""||Z.value?"":`Payable hours must be between ${H.value} and ${D.value}.`),R=S(()=>{var $,ae;const c=Number((($=r.value)==null?void 0:$.payable_hour)??0),o=String(((ae=r.value)==null?void 0:ae.note)??"");return Number(W.value)!==c||String(u.value||"")!==o}),T=S(()=>R.value&&Z.value&&!h.value&&!L.value),te=()=>{r.value={payable_hour:Number(d.value||0),note:String(u.value||"")}},M=()=>{var c,o;d.value=Number(((c=r.value)==null?void 0:c.payable_hour)??0),u.value=String(((o=r.value)==null?void 0:o.note)??"")},U=async()=>{var c,o;j.value=!0,m.value="";try{const $=await v.fetchUserPeriod(F.userId,F.month);s.value=$||null,d.value=Number(((c=s.value)==null?void 0:c.payable_hour)??0),u.value=((o=s.value)==null?void 0:o.note)||"",te()}catch($){console.error($),m.value=($==null?void 0:$.message)||"Failed to load payroll period",i.error(m.value),s.value=null,d.value=0,u.value="",te()}finally{j.value=!1}},ce=async()=>{V.value=!0,await be(),await U()},N=()=>{V.value=!1};ie(()=>[F.userId,F.month],async()=>{V.value&&await U()});const ne=async()=>{var c;if(!((c=s.value)!=null&&c.id)){i.info("Save once to create the period, then you can lock/unlock.");return}if(R.value&&!h.value){if(!window.confirm("You have unsaved changes. Continue without saving?"))return;M()}try{O.value=!0;const o=h.value?await v.unlockPeriod(s.value.id):await v.lockPeriod(s.value.id),$=(o==null?void 0:o.period)||(o==null?void 0:o.data)||o;s.value=$||s.value,x("updated",{period:s.value,userId:F.userId}),i.success(h.value?"Unlocked.":"Locked.")}catch(o){i.error((o==null?void 0:o.message)||"Failed to change status")}finally{O.value=!1}},pe=async()=>{if(!Z.value)return i.error(Q.value||"Invalid payable hours.");if(h.value)return i.error("This payroll period is locked.");try{L.value=!0;const c={user_id:F.userId,month:F.month,payable_hour:Number(d.value),note:String(u.value||"").trim()||null},o=await v.upsertPeriod(c),$=(o==null?void 0:o.period)||(o==null?void 0:o.data)||o;s.value=$||s.value,te(),x("updated",{period:s.value,userId:F.userId}),i.success("Saved."),N()}catch(c){i.error((c==null?void 0:c.message)||"Failed to save payroll period")}finally{L.value=!1}};return(c,o)=>(p(),_(Y,null,[t("button",{type:"button",class:"paycut-trigger",onClick:ce,title:"Adjust payable hours"},o[2]||(o[2]=[t("i",{class:"far fa-edit"},null,-1)])),q(Me,{name:"fade-scale"},{default:ue(()=>[V.value?(p(),_("div",{key:0,class:"modal-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"addon-modal-title",onKeydown:Fe(N,["esc"]),onClick:De(N,["self"])},[t("div",Oe,[t("header",je,[o[4]||(o[4]=t("div",{class:"icon-circle"},[t("i",{class:"fal fa-clock"})],-1)),o[5]||(o[5]=t("div",{class:"min-w-0"},[t("p",{id:"addon-modal-title",class:"modal-card__title"},"Payroll Period"),t("p",{class:"modal-card__subtitle"}," Set payable hours & notes. Lock to prevent edits. ")],-1)),t("div",{class:b(["status-chip",h.value?"status-chip--locked":"status-chip--draft"])},[t("i",{class:b(h.value?"far fa-lock":"far fa-pen")},null,2),t("span",null,l(P.value),1)],2),t("button",{class:"icon-button icon-button--lock",type:"button",disabled:O.value||j.value,title:h.value?"Unlock period":"Lock period","aria-busy":O.value,onClick:ne},[t("i",{class:b(O.value?"far fa-spinner-third fa-spin":h.value?"far fa-lock-open":"far fa-lock")},null,2)],8,We),t("button",{class:"icon-button",type:"button","aria-label":"Close",onClick:N},o[3]||(o[3]=[t("i",{class:"far fa-times"},null,-1)]))]),m.value?(p(),_("div",Ye,[o[7]||(o[7]=t("i",{class:"far fa-triangle-exclamation"},null,-1)),t("div",Je,[o[6]||(o[6]=t("p",{class:"font-semibold"},"Couldn’t load period",-1)),t("p",Ke,l(m.value),1)]),t("button",{class:"inline-alert__action",type:"button",onClick:U},"Retry")])):z("",!0),t("section",Ge,[t("div",null,[o[8]||(o[8]=t("p",{class:"meta-label"},"Month",-1)),t("p",Xe,l(w.value),1)]),t("div",null,[o[9]||(o[9]=t("p",{class:"meta-label"},"Employee",-1)),t("p",Ze,l(F.employeeName||"-"),1)]),t("div",null,[o[10]||(o[10]=t("p",{class:"meta-label"},"User",-1)),t("p",Qe,"#"+l(F.userId),1)]),h.value?(p(),_("div",ge,[o[11]||(o[11]=t("p",{class:"meta-label"},"Locked at",-1)),t("p",et,l(K.value||"-"),1)])):z("",!0)]),t("section",tt,[j.value?(p(),_("div",at,o[12]||(o[12]=[t("div",{class:"skeleton-line w-2/3"},null,-1),t("div",{class:"skeleton-box"},null,-1),t("div",{class:"skeleton-line w-1/2"},null,-1),t("div",{class:"skeleton-box h-20"},null,-1)]))):(p(),_(Y,{key:1},[t("div",st,[t("div",lt,[o[13]||(o[13]=t("label",{class:"field-label"},"Payable hours",-1)),t("span",nt,l(le.value),1)]),q(Ee,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=$=>d.value=$),"minute-interval":5,required:!0,"hour-min":H.value,"hour-max":D.value,disabled:h.value},null,8,["modelValue","hour-min","hour-max","disabled"]),Q.value?(p(),_("p",ot,l(Q.value),1)):h.value?(p(),_("p",rt," This period is locked — unlock to edit. ")):z("",!0)]),t("div",dt,[t("div",it,[o[14]||(o[14]=t("label",{class:"field-label"},"Note",-1)),t("span",ut,l((u.value||"").length)+"/1000",1)]),Pe(t("textarea",{class:"input-1",rows:"3","onUpdate:modelValue":o[1]||(o[1]=$=>u.value=$),disabled:h.value,placeholder:"Optional: explain changes…"},null,8,ct),[[Te,u.value]])])],64))]),t("footer",pt,[t("div",_t,[o[15]||(o[15]=t("i",{class:"fal fa-info-circle"},null,-1)),t("span",null,l(h.value?"Locked: no edits allowed.":R.value?"You have unsaved changes.":"No changes yet."),1)]),t("div",vt,[t("button",{class:"btn-3",type:"button",onClick:N},"Close"),h.value?z("",!0):(p(),_("button",{key:0,class:"btn-3",type:"button",disabled:!R.value||L.value,onClick:M,title:"Reset changes"}," Reset ",8,mt)),t("button",{class:"btn-2-green",type:"button",disabled:!T.value,"aria-busy":L.value,onClick:pe},[L.value?(p(),_("span",ht,"Saving...")):(p(),_("span",ft,l(R.value?"Save changes":"Saved"),1))],8,yt)])])])],32)):z("",!0)]),_:1})],64))}},xt=fe(bt,[["__scopeId","data-v-78a03b05"]]),wt={class:"px-4 space-y-4"},kt={class:"glass-panel px-4 py-3 bg-white/90 backdrop-blur border border-slate-100"},$t={class:"flex items-start justify-between gap-3"},St={class:"flex items-start gap-3 min-w-0"},Ct={class:"min-w-0"},Ht={class:"flex flex-wrap items-center gap-2"},Lt={key:0,class:"ml-1 text-[10px] font-normal"},Dt={class:"mt-1 text-xs text-slate-500"},Ft={class:"font-semibold"},Pt={class:"mt-1 text-sm text-red-500 font-bold"},Tt={class:"font-semibold text-slate-500"},Mt={class:"flex flex-wrap items-center justify-end gap-2"},Nt={class:"hidden lg:flex items-center gap-2"},At={class:"segmented-control"},It=["onClick"],zt={class:"hidden lg:flex items-center gap-2"},Rt={class:"segmented-control segmented-control--ghost"},Ut=["onClick"],qt=["disabled"],Et={class:"hidden sm:inline"},Bt={class:"sm:hidden"},Vt=["disabled","title"],Ot={class:"hidden sm:inline"},jt=["disabled"],Wt=["disabled"],Yt={class:"mt-3 flex flex-wrap items-center gap-2 lg:hidden"},Jt={class:"segmented-control"},Kt=["onClick"],Gt={class:"segmented-control segmented-control--ghost"},Xt=["onClick"],Zt={class:"glass-panel p-3 bg-white/90 backdrop-blur"},Qt={class:"flex items-center justify-start gap-4"},gt={class:"flex gap-2"},ea={key:3},ta={key:0,class:"empty-state"},aa={key:1,class:"empty-state glass-panel"},sa={key:2,class:"space-y-4"},la={key:0,class:"grid gap-3 md:grid-cols-2 xl:grid-cols-3"},na={class:"report-card__header"},oa={class:"report-card__title"},ra={class:"report-card__subtitle"},da={class:"report-card__body"},ia={class:"report-card__row"},ua={class:"text-gray-500 text-xs"},ca={class:"report-card__grid"},pa={class:"report-card__metric"},_a={class:"report-card__metric"},va={class:"report-card__metric"},ma={class:"report-card__metric"},ya={class:"report-card__metric"},ha={class:"report-card__metric"},fa={class:"report-card__metric"},ba={class:"report-card__metric"},xa={class:"report-card__footer"},wa={class:"flex items-center gap-3 text-xs text-gray-500"},ka={class:"min-w-full table-auto border-collapse"},$a={class:"text-center text-xs"},Sa={class:"td"},Ca={class:"td text-left"},Ha={class:"td text-left"},La={class:"td"},Da={class:"td"},Fa={class:"td"},Pa={class:"td"},Ta={class:"td"},Ma={class:"td"},Na={class:"td"},Aa={class:"td"},Ia={class:"td"},za={class:"td"},Ra={class:"td"},Ua={class:"td"},qa={class:"td"},Ea={class:"td"},Ba={class:"td text-xs"},Va={class:"text-[11px] text-gray-500"},Oa={class:"td"},ja={class:"td"},Wa={class:"td"},Ya={class:"td"},Ja={class:"td"},Ka={class:"w-10 text-xs text-gray-600"},Ga={class:"td"},Xa={class:"w-10 text-xs text-gray-600"},Za={class:"td"},Qa={class:"td"},ga={class:"flex gap-2 items-center"},es={class:"td"},ts={class:"td"},as={class:"td"},ss={class:"flex items-center justify-center gap-2"},ls={class:"td"},ns={class:"td"},os={class:"bg-gray-100 text-center text-sm font-semibold"},rs={class:"td"},ds={class:"td"},is={class:"td"},us={class:"td"},cs={class:"td"},ps={class:"td"},_s={class:"td"},vs={class:"td"},ms={class:"td"},ys={class:"td"},hs={__name:"MonthlyAttendanceSummaryReport",setup(E){const C=Ne(),i=Ae(),v=Ie(),H=Be(),{monthly_company_summary:D,reportMeta:F}=ze(H),x=n=>{const a=Number(n);return Number.isFinite(a)?a:0},V=y({}),L=(n,a)=>n.reduce((f,k)=>{try{const e=a.split(".").reduce((A,G)=>A?A[G]:void 0,k);return f+x(e)}catch{return f}},0),O=n=>String(n||"").padStart(2,"0"),j=n=>{const a=Number(n);return Number.isFinite(a)?a.toFixed(1):"0.0"},m=y(i.query.date&&String(i.query.date)||H.selectedMonth||""),d=n=>{const a={year:new Date().getFullYear(),month:new Date().getMonth()+1};if(!n)return a;const[f="",k=""]=String(n).split("-");return!f||!k?a:{year:Number(f)||a.year,month:Number(k)||a.month}},u=y(d(m.value)),s=y({company_id:i.query.company_id||"",department_id:i.query.department_id||"all",line_type:i.query.line_type||"all",employee_id:i.query.employee_id||""}),r=S(()=>Array.isArray(D.value)?D.value:[]),w=S(()=>!!(r.value[0]&&r.value[0].is_final)),J=S(()=>{const n=r.value[0];if(!n||!n.finalized_at)return"";try{const a=new Date(n.finalized_at);return new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(a)}catch{return String(n.finalized_at)}}),h=y(null);S(()=>{if(!h.value)return"Not refreshed yet";try{return new Intl.DateTimeFormat("en",{month:"short",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(h.value)}catch{return String(h.value)}});const P=S(()=>{const n=r.value;return{cl:L(n,"total_cl_leave"),ml:L(n,"total_ml_leave"),sl:L(n,"total_sl_leave"),wplDays:L(n,"total_wpl_leave"),otHour:L(n,"total_overtime_hours"),addOnHour:n.reduce((a,f)=>a+f.payroll,0),absentDays:L(n,"total_absent"),wplHour:L(n,"total_wpl_hour"),paycutHour:L(n,"approved_paycut"),payableHour:L(n,"payable_hour")}}),K=y("table"),W=y("compact"),Z=[{label:"Table",value:"table",icon:"fal fa-table"},{label:"Cards",value:"cards",icon:"fal fa-th-large"}],le=[{label:"Cozy",value:"cozy"},{label:"Compact",value:"compact"}],Q=S(()=>{const n=m.value;if(!n)return"Month not selected";const[a,f]=n.split("-").map(k=>Number(k));return!a||!f?n:new Intl.DateTimeFormat("en",{month:"long",year:"numeric"}).format(new Date(a,f-1))}),R=(n,a="0:00")=>n&&String(n).trim()!==""?n:a,T=y({toast:null,banner:null}),te=S(()=>{var a;const n=(a=T.value.toast)==null?void 0:a.type;return n==="success"?"border-emerald-200 bg-emerald-50 text-emerald-800":n==="error"?"border-rose-200 bg-rose-50 text-rose-800":"border-slate-200 bg-slate-50 text-slate-800"});function M(n,a){T.value.toast={type:n,text:a},window.clearTimeout(M._t),M._t=window.setTimeout(()=>T.value.toast=null,2500)}function U(n,a,f=4e3){T.value.banner={type:n,text:a},window.clearTimeout(U._b),U._b=window.setTimeout(()=>T.value.banner=null,f)}const ce=({period:n,userId:a})=>{!a||!n||(V.value={...V.value,[a]:n})},N=async()=>{const n=s.value.company_id,a=s.value.department_id,f=s.value.employee_id||"",k=s.value.line_type!=="all"?s.value.line_type:"";if(!n){M("info","Select a company first.");return}try{await H.getMonthlyAttendanceSummaryReport(n,a,k,f,m.value),h.value=new Date}catch(e){console.error("Failed:",e),M("error","Failed to load attendance data.")}},ne=n=>{const a=i.query;Object.keys(n).some(k=>String(a[k]??"")!==String(n[k]??""))&&C.replace({query:n})},pe=()=>{ne({...i.query,company_id:s.value.company_id||"",department_id:s.value.department_id||"all",line_type:s.value.line_type||"all",employee_id:s.value.employee_id||"",date:m.value||""})};ie(m,n=>ne({...i.query,date:n||""})),ie(u,n=>{if(!n)return;const a=`${n.year}-${O(n.month)}`;m.value!==a&&(m.value=a)},{deep:!0}),ie(m,n=>{const a=d(n);(!u.value||a.year!==u.value.year||a.month!==u.value.month)&&(u.value=a)}),he(()=>{s.value.company_id&&N()});const c=async()=>{if(!s.value.company_id)return;const n=s.value.line_type!=="all"?s.value.line_type:"";await H.downloadExcel(s.value.company_id,n,m.value)},o=async()=>{if(!s.value.company_id)return;const n=s.value.line_type!=="all"?s.value.line_type:"";await H.downloadPDF(s.value.company_id,n,m.value)},$=()=>C.go(-1),ae=async()=>N(),B=y(!1),xe=async()=>{if(!s.value.company_id||!m.value){M("info","Select company & month first.");return}const n=s.value.line_type!=="all"?s.value.line_type:"",a=s.value.employee_id||"",f=s.value.department_id||"";try{B.value=!0,U("info",`Recalculating snapshot for ${Q.value}…`,6e3),await H.recalculateMonthlySnapshot(s.value.company_id,f,n,a,m.value),await N(),U("success","✅ Snapshot refreshed — numbers updated on this page.")}catch(k){console.error("Failed recalc:",k),M("error","Failed to recalculate snapshot.")}finally{B.value=!1}},we=async()=>{if(!s.value.company_id||!m.value){M("info","Select company & month first.");return}const n=w.value?"unfinalize":"finalize",a=n==="finalize"?"Finalize":"Unfinalize",f=s.value.line_type!=="all"?s.value.line_type:"",k=s.value.employee_id||"";try{B.value=!0,U("info",`${a} in progress…`,6e3),await H.finalizeMonthlySnapshot(s.value.company_id,f,k,m.value,n),await N(),U("success",`✅ Month ${a.toLowerCase()}d successfully.`)}catch(e){console.error("Finalize failed:",e),M("error","Failed to change final status.")}finally{B.value=!1}},oe=y(null),re=y(null),me=y(260);let se=null;const de=async()=>{var k,e;await be();const n=((k=oe.value)==null?void 0:k.offsetHeight)||0,a=((e=re.value)==null?void 0:e.offsetHeight)||0,f=24;me.value=n+a+f},ke=S(()=>`max(320px, calc(100vh - ${me.value}px))`);return he(async()=>{await de(),typeof ResizeObserver<"u"?(se=new ResizeObserver(de),oe.value&&se.observe(oe.value),re.value&&se.observe(re.value)):window.addEventListener("resize",de)}),Re(()=>{se&&se.disconnect(),window.removeEventListener("resize",de)}),(n,a)=>{var k;const f=Ue("router-link");return p(),_("div",wt,[T.value.toast?(p(),_("div",{key:0,class:b(["fixed right-4 top-4 z-[90] rounded-xl border px-4 py-2 text-sm shadow-sm",te.value])},l(T.value.toast.text),3)):z("",!0),T.value.banner?(p(),_("div",{key:1,class:b(["sticky top-2 z-[80] rounded-2xl border px-4 py-2 text-sm shadow-sm",T.value.banner.type==="success"?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-slate-200 bg-slate-50 text-slate-800"])},l(T.value.banner.text),3)):z("",!0),t("div",{ref_key:"topBarRef",ref:oe,class:"sticky top-0 z-50"},[t("div",kt,[t("div",$t,[t("div",St,[t("button",{class:"btn-3 !h-10 !w-10 rounded-full shadow-sm",onClick:$},a[6]||(a[6]=[t("i",{class:"far fa-arrow-left text-sm"},null,-1)])),t("div",Ct,[a[15]||(a[15]=t("div",{class:"flex flex-wrap items-center gap-2"},[t("p",{class:"text-[11px] font-semibold uppercase tracking-[0.2em] text-slate-400"}," Monthly overview ")],-1)),t("div",Ht,[a[7]||(a[7]=t("h1",{class:"truncate text-base font-semibold text-slate-900"}," Monthly Attendance Summary ",-1)),r.value.length?(p(),_("span",{key:0,class:b(["inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-semibold",w.value?"bg-emerald-50 text-emerald-700":"bg-amber-50 text-amber-700"])},[t("span",{class:b(["inline-block h-2 w-2 rounded-full",w.value?"bg-emerald-500":"bg-amber-500"])},null,2),I(" "+l(w.value?"Finalized":"Draft")+" ",1),w.value&&J.value?(p(),_("span",Lt," ("+l(J.value)+") ",1)):z("",!0)],2)):z("",!0)]),t("p",Dt,[a[8]||(a[8]=I(" This page shows a ")),a[9]||(a[9]=t("span",{class:"font-semibold text-slate-700"},"snapshot",-1)),a[10]||(a[10]=I(" for ")),t("span",Ft,l(Q.value),1),a[11]||(a[11]=I(". ")),a[12]||(a[12]=t("span",{class:"ml-1 inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[11px] font-semibold text-amber-700"}," Click Recalculate to refresh all numbers on this report. ",-1))]),t("p",Pt,[a[13]||(a[13]=I(" Last calculate: ")),t("span",Tt,l((k=g(F))==null?void 0:k.last_update_human),1),a[14]||(a[14]=t("span",{class:"mx-2"},"•",-1)),I(" "+l(r.value.length)+" employees ",1)])])]),t("div",Mt,[t("div",Nt,[a[16]||(a[16]=t("span",{class:"toolbar-label"},"View",-1)),t("div",At,[(p(),_(Y,null,ee(Z,e=>t("button",{key:e.value,type:"button",class:b(["segmented-control__btn",{"is-active":K.value===e.value}]),onClick:A=>K.value=e.value},[t("i",{class:b(e.icon)},null,2),t("span",null,l(e.label),1)],10,It)),64))])]),t("div",zt,[a[17]||(a[17]=t("span",{class:"toolbar-label"},"Density",-1)),t("div",Rt,[(p(),_(Y,null,ee(le,e=>t("button",{key:e.value,type:"button",class:b(["segmented-control__btn",{"is-active":W.value===e.value}]),onClick:A=>W.value=e.value},l(e.label),11,Ut)),64))])]),t("button",{type:"button",class:"btn-2 inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",disabled:!s.value.company_id||!m.value||B.value||w.value,onClick:xe,title:"Rebuild snapshot for this month (updates all numbers on this page)"},[t("i",{class:b(["fal fa-rotate text-base",B.value?"animate-spin":""])},null,2),t("span",Et,l(B.value?"Recalculating…":"Recalculate"),1),t("span",Bt,l(B.value?"…":"Recalc"),1)],8,qt),t("button",{type:"button",class:b(["inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",w.value?"bg-slate-200 text-slate-800":"bg-emerald-500 text-white"]),disabled:!s.value.company_id||!m.value||B.value||r.value.length===0,onClick:we,title:w.value?"Unlock month for edits":"Lock month as final"},[t("i",{class:b(w.value?"fal fa-lock-open":"fal fa-lock")},null,2),t("span",Ot,l(w.value?"Unfinalize":"Finalize"),1)],10,Vt),t("button",{type:"button",onClick:c,class:"btn-1 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold shadow-sm disabled:opacity-50",disabled:!s.value.company_id},a[18]||(a[18]=[t("i",{class:"far fa-file-excel text-base text-green-500"},null,-1),t("span",{class:"hidden sm:inline"},"Excel",-1)]),8,jt),t("button",{type:"button",onClick:o,class:"btn-1 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold shadow-sm disabled:opacity-50",disabled:!s.value.company_id},a[19]||(a[19]=[t("i",{class:"fal fa-file-pdf text-base text-red-500"},null,-1),t("span",{class:"hidden sm:inline"},"PDF",-1)]),8,Wt)])]),t("div",Yt,[a[20]||(a[20]=t("span",{class:"toolbar-label"},"View",-1)),t("div",Jt,[(p(),_(Y,null,ee(Z,e=>t("button",{key:e.value,type:"button",class:b(["segmented-control__btn",{"is-active":K.value===e.value}]),onClick:A=>K.value=e.value},[t("i",{class:b(e.icon)},null,2),t("span",null,l(e.label),1)],10,Kt)),64))]),a[21]||(a[21]=t("span",{class:"toolbar-label ml-2"},"Density",-1)),t("div",Gt,[(p(),_(Y,null,ee(le,e=>t("button",{key:e.value,type:"button",class:b(["segmented-control__btn",{"is-active":W.value===e.value}]),onClick:A=>W.value=e.value},l(e.label),11,Xt)),64))])])])],512),t("div",{ref_key:"filterBarRef",ref:re,class:"sticky top-[92px] z-40"},[t("div",Zt,[t("div",Qt,[q($e,{company_id:s.value.company_id,"onUpdate:company_id":a[2]||(a[2]=e=>s.value.company_id=e),department_id:s.value.department_id,"onUpdate:department_id":a[3]||(a[3]=e=>s.value.department_id=e),employee_id:s.value.employee_id,"onUpdate:employee_id":a[4]||(a[4]=e=>s.value.employee_id=e),line_type:s.value.line_type,"onUpdate:line_type":a[5]||(a[5]=e=>s.value.line_type=e),"with-type":!0,"initial-value":n.$route.query,onFilterChange:pe,class:"w-full"},{default:ue(()=>[t("div",gt,[q(Se,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),"show-year":!1,"show-month":!0,"show-date":!1,label:"Month"},null,8,["modelValue"]),t("button",{type:"button",onClick:a[1]||(a[1]=e=>N()),class:"btn-2 rounded"}," Search ")])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])])])],512),g(H).isLoading?(p(),_e(Ce,{key:2})):(p(),_("div",ea,[s.value.company_id?r.value.length===0?(p(),_("div",aa,a[23]||(a[23]=[t("p",{class:"text-base font-semibold text-gray-700"},"No attendance found",-1),t("p",{class:"text-sm text-gray-500"},"Try a different set of filters or a different month.",-1)]))):(p(),_("div",sa,[K.value==="cards"?(p(),_("div",la,[(p(!0),_(Y,null,ee(r.value,(e,A)=>{var G;return p(),_("article",{key:`${(e==null?void 0:e.user_id)||"card"}-${A}`,class:b(["report-card",{"report-card--alert":e==null?void 0:e.under_target}])},[t("header",na,[t("div",null,[t("p",oa,l(e==null?void 0:e.user),1),t("p",ra,l(e==null?void 0:e.designation),1)]),t("span",{class:b(["report-card__tag",e!=null&&e.under_target?"report-card__tag--alert":"report-card__tag--ok"])},l(e!=null&&e.under_target?"Under target":"On track"),3)]),t("div",da,[t("div",ia,[a[24]||(a[24]=t("p",{class:"report-card__body-label"},"Working Hour",-1)),t("p",{class:b(["report-card__primary",e!=null&&e.under_target?"text-red-600":"text-emerald-600"])},[I(l(R(e==null?void 0:e.total_working_hours))+" ",1),t("span",ua,"/ "+l(R(e==null?void 0:e.total_shift_hours)),1)],2)]),t("div",ca,[t("div",null,[a[25]||(a[25]=t("p",{class:"report-card__body-label"},"Attendance",-1)),t("p",pa," P "+l(x(e==null?void 0:e.total_present))+" | L "+l(x(e==null?void 0:e.total_leave))+" | A "+l(x(e==null?void 0:e.total_absent)),1)]),t("div",null,[a[26]||(a[26]=t("p",{class:"report-card__body-label"},"Weekend",-1)),t("p",_a,l(x(e==null?void 0:e.total_weekend))+" days",1)]),t("div",null,[a[27]||(a[27]=t("p",{class:"report-card__body-label"},"Actual Late",-1)),t("p",va,l(x(e==null?void 0:e.actual_late_day))+"d / "+l(R(e==null?void 0:e.actual_late_hour)),1)]),t("div",null,[a[28]||(a[28]=t("p",{class:"report-card__body-label"},"Actual Early",-1)),t("p",ma,l(x(e==null?void 0:e.actual_early_day))+"d / "+l(R(e==null?void 0:e.actual_early_hour)),1)]),t("div",null,[a[29]||(a[29]=t("p",{class:"report-card__body-label"},"Short Leave",-1)),t("p",ya," First "+l(x(e==null?void 0:e.total_first_short_leave))+" | Last "+l(x(e==null?void 0:e.total_last_short_leave)),1)]),t("div",null,[a[30]||(a[30]=t("p",{class:"report-card__body-label"},"Leave Types",-1)),t("p",ha," CL "+l(x(e==null?void 0:e.total_cl_leave))+" | ML "+l(x(e==null?void 0:e.total_ml_leave))+" | SL "+l(x(e==null?void 0:e.total_sl_leave))+" | WPL "+l(x(e==null?void 0:e.total_wpl_leave)),1)]),t("div",null,[a[31]||(a[31]=t("p",{class:"report-card__body-label"},"Hours Impact",-1)),t("p",fa," OT "+l(x(e==null?void 0:e.total_overtime_hours))+"h | Payable "+l(x(e==null?void 0:e.payable_hour))+"h ",1)]),t("div",null,[a[32]||(a[32]=t("p",{class:"report-card__body-label"},"Deduction",-1)),t("p",ba,l(x(e==null?void 0:e.total_absent)*9)+"h + "+l(x(e==null?void 0:e.total_wpl_hour))+"h ",1)])])]),t("footer",xa,[t("div",wa,[q(ve,{workingHours:e==null?void 0:e.approved_paycut},null,8,["workingHours"]),((G=g(v).user)==null?void 0:G.id)===8?(p(),_e(ye,{key:0,class:"rounded-full bg-slate-100 px-2 py-1 text-[11px] font-semibold text-slate-600",userId:e==null?void 0:e.user_id,month:m.value,onUpdated:ae},null,8,["userId","month"])):z("",!0)]),q(f,{to:{name:"EmployeeAttendance",query:{...g(i).query,employee_id:e==null?void 0:e.user_id,date:m.value}},target:"_blank",class:"report-card__cta"},{default:ue(()=>a[33]||(a[33]=[I(" Job Card "),t("i",{class:"far fa-arrow-up-right-from-square text-xs"},null,-1)])),_:2,__:[33]},1032,["to"])])],2)}),128))])):(p(),_("div",{key:1,class:b(["table-shell",[W.value==="compact"?"table-density-compact":"table-density-cozy"]])},[t("div",{class:"table-scroll",style:qe({maxHeight:ke.value})},[t("table",ka,[a[39]||(a[39]=t("thead",{class:"sticky top-0 bg-white shadow-sm z-10"},[t("tr",{class:"bg-gray-50 text-sm"},[t("th",{rowspan:"2",class:"th"},"#"),t("th",{rowspan:"2",class:"th text-left"},"Employee Name"),t("th",{rowspan:"2",class:"th text-left"},"Designation"),t("th",{colspan:"6",class:"th"},"Attendance Summary"),t("th",{colspan:"2",class:"th"},"Actual Late"),t("th",{colspan:"2",class:"th"},"Remaining Late"),t("th",{colspan:"2",class:"th"},"Actual Early"),t("th",{colspan:"2",class:"th"},"Remaining Early"),t("th",{rowspan:"2",class:"th"},"Working Hour"),t("th",{colspan:"4",class:"th"},"Leave Day"),t("th",{colspan:"2",class:"th"},"Short Leave"),t("th",{colspan:"2",class:"th"},"Addition Hour"),t("th",{colspan:"3",class:"th"},"Deduction Hour"),t("th",{rowspan:"2",class:"th"},"Payable"),t("th",{rowspan:"2",class:"th"},"Action")]),t("tr",{class:"bg-gray-50 text-xs"},[t("th",{class:"th"},"TD"),t("th",{class:"th"},"TP"),t("th",{class:"th"},"TW"),t("th",{class:"th"},"TL"),t("th",{class:"th"},"TA"),t("th",{class:"th"},"THD"),t("th",{class:"th"},"Day"),t("th",{class:"th"},"Hour"),t("th",{class:"th"},"Day"),t("th",{class:"th"},"Hour"),t("th",{class:"th"},"Day"),t("th",{class:"th"},"Hour"),t("th",{class:"th"},"Day"),t("th",{class:"th"},"Hour"),t("th",{class:"th"},"CL"),t("th",{class:"th"},"ML"),t("th",{class:"th"},"SL"),t("th",{class:"th"},"WPL"),t("th",{class:"th"},"Delay"),t("th",{class:"th"},"Early"),t("th",{class:"th"},"OT Hour"),t("th",{class:"th"},"Add-on"),t("th",{class:"th"},"Absent"),t("th",{class:"th"},"WPL"),t("th",{class:"th"},"Pay-cut")])],-1)),t("tbody",$a,[(p(!0),_(Y,null,ee(r.value,(e,A)=>{var G;return p(),_("tr",{key:`${(e==null?void 0:e.user_id)||"u"}-${A}`,class:b(["border-b hover:bg-blue-50",{"table-row--alert":e==null?void 0:e.under_target}])},[t("td",Sa,l(A+1),1),t("td",Ca,l(e==null?void 0:e.user),1),t("td",Ha,l(e==null?void 0:e.designation),1),t("td",La,l(e==null?void 0:e.total_monthly_days),1),t("td",Da,l(e==null?void 0:e.total_present),1),t("td",Fa,l(e==null?void 0:e.total_weekend),1),t("td",Pa,l(e==null?void 0:e.total_leave),1),t("td",Ta,l(e==null?void 0:e.total_absent),1),t("td",Ma,l(e==null?void 0:e.total_holiday),1),t("td",Na,l(e==null?void 0:e.actual_late_day),1),t("td",Aa,l(e==null?void 0:e.actual_late_hour),1),t("td",Ia,l(e==null?void 0:e.total_remain_late_day),1),t("td",za,l(e==null?void 0:e.total_remain_late_hour),1),t("td",Ra,l(e==null?void 0:e.actual_early_day),1),t("td",Ua,l(e==null?void 0:e.actual_early_hour),1),t("td",qa,l(e==null?void 0:e.total_remain_early_day),1),t("td",Ea,l(e==null?void 0:e.total_remain_early_hour),1),t("td",Ba,[t("p",{class:b(["font-semibold",e!=null&&e.under_target?"text-red-600":"text-emerald-600"])},l(e==null?void 0:e.total_working_hours),3),t("p",Va,"of "+l(e==null?void 0:e.total_shift_hours),1)]),t("td",Oa,l(e==null?void 0:e.total_cl_leave),1),t("td",ja,l(e==null?void 0:e.total_ml_leave),1),t("td",Wa,l(e==null?void 0:e.total_sl_leave),1),t("td",Ya,l(e==null?void 0:e.total_wpl_leave),1),t("td",Ja,[t("p",Ka,[I(l((e==null?void 0:e.total_first_short_leave)||0)+" of ",1),t("span",{class:b({"text-red-600 font-bold":(e==null?void 0:e.actual_late_day)>=4})},l((e==null?void 0:e.actual_late_day)||0),3)])]),t("td",Ga,[t("p",Xa,[I(l((e==null?void 0:e.total_last_short_leave)||0)+" of ",1),t("span",{class:b({"text-red-600 font-bold":(e==null?void 0:e.actual_early_day)>=4})},l((e==null?void 0:e.actual_early_day)||0),3)])]),t("td",Za,l(e!=null&&e.total_overtime_hours?`${e==null?void 0:e.total_overtime_hours} H`:""),1),t("td",Qa,[t("div",ga,[q(ve,{workingHours:e==null?void 0:e.payroll},null,8,["workingHours"]),q(xt,{userId:e.user_id,employeeName:e.user,month:m.value,onUpdated:ce},null,8,["userId","employeeName","month"])])]),t("td",es,l(x(e==null?void 0:e.total_absent)*9)+"h",1),t("td",ts,l(e==null?void 0:e.total_wpl_hour)+"h",1),t("td",as,[t("div",ss,[q(ve,{workingHours:e==null?void 0:e.approved_paycut},null,8,["workingHours"]),((G=g(v).user)==null?void 0:G.id)===8?(p(),_e(ye,{key:0,class:"mr-2",userId:e==null?void 0:e.user_id,month:m.value,onUpdated:ae},null,8,["userId","month"])):z("",!0)])]),t("td",ls,l(e==null?void 0:e.payable_hour)+"h",1),t("td",ns,[q(f,{to:{name:"EmployeeAttendance",query:{...g(i).query,employee_id:e==null?void 0:e.user_id,date:m.value}},target:"_blank",class:"inline-flex w-20 items-center gap-1 rounded-md bg-blue-50 px-1 py-1 font-medium text-blue-700 hover:bg-blue-100"},{default:ue(()=>a[34]||(a[34]=[I(" Job Card "),t("i",{class:"far fa-arrow-up-right-from-square text-xs"},null,-1)])),_:2,__:[34]},1032,["to"])])],2)}),128))]),t("tfoot",null,[t("tr",os,[a[35]||(a[35]=t("td",{colspan:"18",class:"td"},"Total",-1)),t("td",rs,l(P.value.cl),1),t("td",ds,l(P.value.ml),1),t("td",is,l(P.value.sl),1),t("td",us,l(P.value.wplDays),1),a[36]||(a[36]=t("td",{class:"td"},null,-1)),a[37]||(a[37]=t("td",{class:"td"},null,-1)),t("td",cs,l(P.value.otHour),1),t("td",ps,l(j(P.value.addOnHour)),1),t("td",_s,l(P.value.absentDays)+" day",1),t("td",vs,l(P.value.wplHour),1),t("td",ms,l(P.value.paycutHour),1),t("td",ys,l(j(P.value.payableHour)),1),a[38]||(a[38]=t("td",{class:"td"},null,-1))])])])],4)],2))])):(p(),_("div",ta,a[22]||(a[22]=[t("p",{class:"text-base font-semibold text-red-500"},"Select a company to start the report.",-1),t("p",{class:"text-sm text-gray-500"},"Choose a company & filters above to preview this month.",-1)])))]))])}}},Ts=fe(hs,[["__scopeId","data-v-4546b35f"]]);export{Ts as default};
