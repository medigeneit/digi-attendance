import{r as g,e as ie,M as de,p as C,K as ce,q as te,c as r,o as u,a as d,h as z,s as m,g as j,F as M,x as P,t as b,w as h,v as le,X as x,j as T,n as D,Y as fe}from"./index-DFpoxfXA.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"w-full h-full"},me={key:0,class:"flex flex-wrap items-center gap-2 w-full h-full justify-items-stretch py-1.5"},ye={class:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm"},ge=["onClick"],be={key:1,class:"text-gray-400"},he=["placeholder","onKeydown"],we={key:1,class:"flex items-center h-full"},ke=["title"],xe={key:1,class:"text-gray-500"},Se={class:"flex items-center gap-0.5"},Ve={key:0,class:"px-2 pt-2"},$e={class:"max-h-60 overflow-y-auto py-2"},Be={key:0},Ce={class:"mx-2 text-sm font-semibold"},Ke={class:"px-2 text-sm text-gray-700"},Oe=["onClick","onKeydown"],Le=["onClick","onKeydown"],Ge={key:1,class:"px-3 py-2 text-gray-500 min-h-24 flex justify-center items-center -mt-2"},Ae={__name:"SelectDropdown",props:{options:{type:Array,required:!0},modelValue:{type:[Object,Array,String,Number,null],default:null},placeholder:{type:String,default:null},multiple:{type:Boolean,default:!1},label:{type:String,default:"label"},value:{type:String,default:"id"},clearable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},searchBy:{type:Function,default:null},position:{type:String,default:"auto",validator:a=>["top","left","right","bottom","auto"].includes(a)},containment:{type:Object,default:()=>window},taggable:{type:Boolean,default:!1},createOption:Function,hideSelectedValue:{type:Boolean,default:!1},isOptionGroup:{type:Boolean,default:!1},optGroupOptionKey:{type:String,default:"children"},groupLabel:{type:String,default:"name"}},emits:["update:modelValue","input","open","close","search","search:focus","search:blur","option:selecting","option:selected","option:deselecting","option:deselected"],setup(a,{emit:ne}){const n=a,s=ne,c=g(!1),i=g(""),W=g(null),X=g(null),K=g(),Y=g(),O=g(n.position),E=g("");function J(e){K.value&&!K.value.contains(e.target)&&c.value&&(c.value=!1,s("close"))}function I(e){var t;return(n.isOptionGroup?((t=U(e))==null?void 0:t[n.optGroupOptionKey])||[]:n.options).find(o=>(o==null?void 0:o[n.value])==e)}ie(()=>{var e;document.addEventListener("click",J),(e=n.containment)==null||e.addEventListener("scroll",()=>{H(c.value)}),setTimeout(()=>{var l;(l=X.value)==null||l.focus()})}),de(()=>{var e;document.removeEventListener("click",J),(e=n.containment)==null||e.removeEventListener("scroll",()=>H(c.value))});const oe=C(()=>n.multiple||n.taggable),se=C(()=>{const e={top:"bottom-[100%] mb-0.5",left:"right-[100%] mr-0.5",right:"left-[100%] ml-0.5",bottom:"top-[100%] mt-0.5"};return e[O.value]||e.bottom}),f=C(()=>n.multiple||n.taggable?Array.isArray(n.modelValue)?n.modelValue:[]:n.modelValue),S=e=>(e==null?void 0:e[n.label])??(e==null?void 0:e.label)??e,V=e=>{let l=[];if(n.isOptionGroup){const o=U(e);l=(o==null?void 0:o[n.optGroupOptionKey])||[]}else l=n.options;const t=l.find(o=>typeof o=="string"||typeof o=="number"?String(o)===String(e):(o==null?void 0:o[n.value])==e);return t?(t==null?void 0:t[n.label])??(t==null?void 0:t.label)??t:n.taggable?e:null},p=e=>typeof e=="object"?(e==null?void 0:e[n.value])??(e==null?void 0:e.value)??e:typeof e=="string"||typeof e=="number"?e:"",ae=()=>{n.disabled||(c.value=!c.value,s(c.value?"open":"close"),c.value&&setTimeout(()=>{var e;(e=W.value)==null||e.focus()},0))},L=e=>{const l=p(e);return n.multiple||n.taggable?f.value.some(t=>p(t)===l):p(f.value)===l},w=(e,l=null)=>{if(console.log({parentOption:l}),l&&(E.value=l),n.multiple||n.taggable)if(L(e)){s("option:deselecting",e);const t=f.value.filter(o=>p(o)!==p(e));s("update:modelValue",t),s("option:deselected",e)}else{s("option:selecting",e);const t=[...f.value,p(e)];s("update:modelValue",t),s("option:selected",e)}else s("option:selected",e),typeof n.modelValue=="object"&&n.modelValue?s("update:modelValue",e):s("update:modelValue",p(e));c.value=!1,s("close"),s("input",e),i.value=""},R=e=>{const l=f.value.filter(t=>p(t)!==p(e));s("update:modelValue",l),s("option:deselected",e)},F=C(()=>{if(!n.searchable)return n.options;const e=(i.value||"").trim();if(!e)return N(n.options);const l=e.toLowerCase(),{options:t,isOptionGroup:o,searchBy:v,optGroupOptionKey:G}=n;if(!o)return typeof v=="function"?v(t,l):N(t).filter($=>{const y=S($);return y&&y.toLowerCase().includes(l)});const k=[],Z=G||"children";for(let $=0;$<t.length;$++){const y=t[$],B=(y==null?void 0:y[Z])||[],q=typeof v=="function"?v(B,l):(()=>{const _=[];for(let A=0;A<B.length;A++){const ee=S(B[A]);ee&&ee.toLowerCase().includes(l)&&_.push(B[A])}return _})();q.length>0&&(q.length===B.length?k.push(y):k.push({...y,[Z]:N(q)}))}return k}),N=e=>Array.isArray(e)?n.hideSelectedValue?e.filter(l=>!L(l)):[...e]:[];async function H(e){if(!n.containment)return null;if(e&&n.position==="auto"){await ce();const l=K.value,t=Y.value;if(l&&t){console.log({cm:n.containment});const o=l.getBoundingClientRect(),v=t.offsetHeight,G=(n.containment.innerHeight||n.containment.clientHeight)-o.bottom,k=o.top;console.log({triggerRect:o,dropdownHeight:v,spaceBelow:G,spaceAbove:k}),k<v?O.value="bottom":O.value=G<v&&k>v?"top":"bottom"}}else O.value=n.position}const Q=C(()=>F.value.find(e=>S(e).toLowerCase()===i.value.toLowerCase()));function re(e){if(i.value.length===0&&n.taggable&&Array.isArray(n.modelValue)){const l=[...n.modelValue];l.pop(),s("update:modelValue",l)}}function ue(e){if(e.preventDefault(),!(!n.taggable||!i.value.trim())){if(Q.value)w(Q.value);else{const l=n.createOption?n.createOption(i.value):i.value.trim();s("option:created",l),s("option:selected",l),s("input",l),s("update:modelValue",[...n.modelValue,l])}i.value="",e.target.focus()}}function U(e){return n.options.find(l=>{var t;return(t=l==null?void 0:l[n.optGroupOptionKey])==null?void 0:t.some(o=>(o==null?void 0:o[n.value])==e)})}return te(()=>n.modelValue,e=>{n.isOptionGroup&&(E.value=U(e))}),te(c,H),(e,l)=>(u(),r("div",{class:"border rounded-md cursor-pointer relative",ref_key:"dropdownRef",ref:K},[d("div",{class:D(["flex items-center justify-between px-2 h-full gap-2",{"bg-gray-100":a.disabled}]),onClick:ae,tabindex:"0"},[d("div",ve,[oe.value?(u(),r("div",me,[Array.isArray(f.value)&&f.value.length>0?m(e.$slots,"selected-options",{key:0,items:f.value,removeItem:t=>R(t),getOption:I,label:V},()=>[(u(!0),r(M,null,P(f.value,t=>m(e.$slots,"selected-option",{key:p(t),option:I(t),removeItem:o=>R(o)},()=>[d("span",ye,[d("span",null,b(V(t)),1),d("button",{onClick:h(o=>R(t),["prevent","stop"]),type:"button",class:"ml-1 text-xs"}," × ",8,ge)])],!0)),128))],!0):a.taggable?j("",!0):(u(),r("span",be,b(a.placeholder||"Select.."),1)),a.taggable?z((u(),r("input",{key:2,"onUpdate:modelValue":l[0]||(l[0]=t=>i.value=t),ref_key:"tagSearchInput",ref:X,type:"text",class:"flex-grow px-2 py-1 rounded outline-none",placeholder:a.placeholder||"Type and enter to add",onKeydown:[x(h(ue,["prevent","stop"]),["enter"]),x(re,["backspace"])],onKeyup:l[1]||(l[1]=()=>c.value=!!i.value),onFocus:l[2]||(l[2]=t=>e.$emit("search:focus")),onBlur:l[3]||(l[3]=t=>e.$emit("search:blur"))},null,40,he)),[[le,i.value]]):j("",!0)])):(u(),r("div",we,[m(e.$slots,"selected-option",{option:I(a.modelValue),group:E.value},()=>[V(f.value)?(u(),r("span",{key:0,class:"line-clamp-1",title:V(f.value)},b(V(f.value)),9,ke)):(u(),r("span",xe,b(a.placeholder||"Select..."),1))],!0)]))]),d("div",Se,[n.modelValue&&a.clearable&&!n.disabled?(u(),r("button",{key:0,onClick:l[4]||(l[4]=h(()=>s("update:modelValue",""),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700 text-xl",title:"Clear selection"},[m(e.$slots,"clear-icon",{},()=>[l[9]||(l[9]=T(" × "))],!0)])):j("",!0),m(e.$slots,"open-indicator",{},()=>[l[10]||(l[10]=d("svg",{class:"w-4 h-4 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M19 9l-7 7-7-7"})],-1))],!0)])],2),z(d("div",{class:D(["absolute w-full border rounded shadow-[0px_0px_10px_0px_rgba(0,0,0,0.25)] z-50 border-teal-500 bg-white",se.value]),ref_key:"dropdownMenuRef",ref:Y},[a.searchable&&!a.taggable?(u(),r("div",Ve,[m(e.$slots,"search",{},()=>[z(d("input",{type:"text","onUpdate:modelValue":l[5]||(l[5]=t=>i.value=t),ref_key:"searchInput",ref:W,class:"w-full px-2 py-1 border rounded outline-blue-400 focus:outline-1",placeholder:"Search...",onFocus:l[6]||(l[6]=t=>e.$emit("search:focus")),onBlur:l[7]||(l[7]=t=>e.$emit("search:blur")),onKeydown:l[8]||(l[8]=x(h(t=>t.preventDefault(),["stop"]),["enter"]))},null,544),[[le,i.value]])],!0)])):j("",!0),m(e.$slots,"list-header",{},void 0,!0),d("ul",$e,[F.value.length?(u(!0),r(M,{key:0},P(F.value,t=>(u(),r(M,{key:p(t)},[a.isOptionGroup?(u(),r("li",Be,[d("div",Ce,b(t==null?void 0:t[a.groupLabel]),1),d("ul",Ke,[(u(!0),r(M,null,P((t==null?void 0:t[a.optGroupOptionKey])||[],o=>(u(),r("li",{key:p(o),tabindex:"0",class:D([{"bg-blue-50":L(o)},"px-3 py-1 my-0.5 hover:bg-blue-100 focus:bg-blue-100 focus:outline-blue-500 cursor-pointer"]),onClick:v=>w(o,t),onKeydown:[x(h(v=>w(o,t),["prevent"]),["space"]),x(h(v=>w(o,t),["prevent"]),["enter"])]},[m(e.$slots,"option",{option:o,group:t},()=>[T(b(S(o)),1)],!0)],42,Oe))),128))])])):(u(),r("li",{key:1,tabindex:"0",class:D([{"bg-blue-50":L(t)},"px-3 py-1 my-0.5 hover:bg-blue-100 focus:bg-blue-100 focus:outline-blue-500 cursor-pointer"]),onClick:o=>w(t),onKeydown:[x(h(o=>w(t),["prevent"]),["space"]),x(h(o=>w(t),["prevent"]),["enter"])]},[m(e.$slots,"option",{option:t},()=>[T(b(S(t)),1)],!0)],42,Le))],64))),128)):(u(),r("li",Ge,[m(e.$slots,"no-options",{},()=>[T(b(a.taggable?"No option found, Enter to add":"No options found"),1)],!0)]))]),m(e.$slots,"list-footer",{},void 0,!0)],2),[[fe,c.value]])],512))}},Te=pe(Ae,[["__scopeId","data-v-e5abfccd"]]);export{Te as S};
