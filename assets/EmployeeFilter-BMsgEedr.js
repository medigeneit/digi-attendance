import{D as $,r as y,x as g,h as I,q as m,c as u,o as p,a as s,j as b,d as x,l as w,t as V,w as L,N as P}from"./index-CXRXeaCb.js";import{u as R}from"./company-CVNK3tBw.js";import{u as G}from"./department-s8cOONWt.js";import{_ as H}from"./EmployeeDropdownInput-CGrTGuhL.js";import{S as T}from"./SelectDropdown-IWCE-gOx.js";const J={class:"grid grid-cols-1 md:grid-cols-5 gap-2"},K={class:"relative"},Q=["title"],W={key:0},X={key:1,class:"text-gray-500 whitespace-nowrap"},Y={class:"relative"},Z=["title"],ee={key:0},te={key:1,class:"text-gray-800 whitespace-nowrap"},le={key:0,class:"absolute inset-0 bg-white/50 cursor-not-allowed rounded","aria-hidden":"true"},ae={key:0,class:"relative"},ie={key:0,class:"relative w-full pr-6"},se={class:"flex items-center gap-2 text-sm text-gray-700"},de={class:"line-clamp-1"},ne={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},re={class:"relative"},oe={class:"relative"},ve={__name:"EmployeeFilter",props:{company_id:{type:[String,Number],default:""},department_id:{type:[String,Number],default:""},employee_id:{type:[String,Number],default:""},line_type:{type:String,default:"all"},withType:{type:Boolean,default:!0},initialValue:{type:Object,default:()=>({})}},emits:["update:company_id","update:department_id","update:employee_id","update:line_type","filter-change"],setup(k,{emit:z}){const a=k,r=z,v=R(),D=G(),{companies:A}=$(v),{departments:C}=$(D),o=y(String(a.company_id||a.initialValue.company_id||"")),d=y(a.department_id!==""?String(a.department_id):a.initialValue.department_id&&a.initialValue.department_id!=="all"?String(a.initialValue.department_id):""),i=y(a.withType?String(a.line_type||a.initialValue.line_type||"all"):null),n=y(String(a.employee_id||a.initialValue.employee_id||"")),O=g(()=>(A.value||[]).map(e=>({id:String(e.id),label:e.name}))),U=g(()=>(C.value||[]).map(e=>({id:String(e.id),label:e.name}))),F=g(()=>a.withType?[{id:"all",label:"All Types"},{id:"executive",label:"Executive"},{id:"support_staff",label:"Support Staff"},{id:"doctor",label:"Doctor"},{id:"academy_body",label:"Academy Body"}]:[]),E=g(()=>v.employees||[]),S=y([]);I(async()=>{await v.fetchCompanies({ignore_permission:!0}),o.value&&await N(o.value),_(),j()}),m(()=>a.company_id,e=>{const l=String(e||"");l!==o.value&&(o.value=l)}),m(()=>a.department_id,e=>{const l=e===""||e==null?"":String(e);l!==d.value&&(d.value=l)}),m(()=>a.employee_id,e=>{const l=String(e||"");l!==n.value&&(n.value=l)}),m(()=>a.line_type,e=>{if(!a.withType)return;const l=String(e||"all");l!==i.value&&(i.value=l)}),m(o,async e=>{d.value="",n.value="",S.value=[],r("update:company_id",e||""),r("update:department_id",""),r("update:employee_id",""),e?await N(e):C.value=[],_(),f()}),m([d,i],()=>{r("update:department_id",d.value||""),a.withType&&r("update:line_type",i.value||"all"),_(),f()}),m(n,()=>{r("update:employee_id",n.value||""),f()});async function N(e){await Promise.all([D.fetchDepartments(e),v.fetchEmployee(e)])}function B(e){return{...e,id:String(e.id),label:e.name||e.label||`${e.first_name??""} ${e.last_name??""}`.trim()}}function _(){let e=[...E.value];d.value&&d.value!=="all"&&(e=e.filter(t=>String(t.department_id)===String(d.value))),a.withType&&i.value&&i.value!=="all"&&(e=e.filter(t=>String(t.type)===String(i.value)));let l=e.map(B);if(n.value&&!l.some(c=>c.id===String(n.value))){const c=E.value.find(q=>String(q.id)===String(n.value));c&&(l=[B(c),...l])}S.value=l}function j(){r("update:company_id",o.value||""),r("update:department_id",d.value||""),a.withType&&r("update:line_type",i.value||"all"),r("update:employee_id",n.value||""),f()}let h=null;function f(){h&&clearTimeout(h),h=setTimeout(()=>r("filter-change",{company_id:o.value,department_id:d.value,line_type:i.value,employee_id:n.value}),0)}function M(){a.withType&&(i.value="all",_())}return(e,l)=>(p(),u("div",J,[s("div",K,[x(T,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=t=>o.value=t),options:O.value,class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white",clearable:""},{"selected-option":w(({option:t})=>[s("div",{class:"line-clamp-1 text-sm text-gray-900",title:t==null?void 0:t.label},[t!=null&&t.label?(p(),u("span",W,V(t==null?void 0:t.label),1)):(p(),u("span",X,"--Select Company--"))],8,Q)]),_:1},8,["modelValue","options"]),l[5]||(l[5]=s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),s("div",Y,[x(T,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=t=>d.value=t),options:U.value,class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white",clearable:""},{"selected-option":w(({option:t})=>[s("div",{class:"line-clamp-1 text-sm text-gray-900",title:t==null?void 0:t.label},[t!=null&&t.label?(p(),u("span",ee,V(t==null?void 0:t.label),1)):(p(),u("span",te,"--All Departments--"))],8,Z)]),_:1},8,["modelValue","options"]),l[6]||(l[6]=s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Department ",-1)),o.value?b("",!0):(p(),u("div",le))]),k.withType?(p(),u("div",ae,[x(T,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=t=>i.value=t),options:F.value,placeholder:"Select Type",class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white"},{"selected-option":w(({option:t})=>[t?(p(),u("div",ie,[s("div",se,[s("div",de,V(t==null?void 0:t.label),1)]),i.value&&i.value!=="all"?(p(),u("div",ne,[s("button",{onClick:l[2]||(l[2]=L(c=>M(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"}," Ã— ")])):b("",!0)])):b("",!0)]),_:1},8,["modelValue","options"]),l[7]||(l[7]=s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Line Type ",-1))])):b("",!0),s("div",re,[x(H,{employees:S.value,modelValue:n.value,"onUpdate:modelValue":l[4]||(l[4]=t=>n.value=t),class:"border-2 border-gray-300 rounded h-[32px] w-full bg-white"},null,8,["employees","modelValue"]),l[8]||(l[8]=s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))]),s("div",oe,[P(e.$slots,"default")])]))}};export{ve as _};
