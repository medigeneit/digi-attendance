import{G as tt,r as I,e as et,H as lt,A as st,c as u,o,f as b,a as t,t as y,I as A,n as $,h as r,w,l as x,p as h,E as at,m as D,F as nt,x as dt,J as ut,K as Y,g as pt,v as ct,b as mt,u as kt,d as ft,q as S,k as Z,y as E}from"./index-cwaexawB.js";import{u as yt,_ as xt,O as L,a as bt}from"./task-priority-Bq74uecO.js";import{_ as gt}from"./TaskAddForm-CrYEk-Be.js";import{_ as vt}from"./TaskEditForm-DYZXrMQO.js";import{_ as _t,g as U,a as ht}from"./TaskTreeView-BDd3ejS0.js";import{_ as ot}from"./UserChip-BdT-vmLL.js";import{u as Tt}from"./useTaskStore-D95uaveG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-C7SVfpTf.js";import"./SectionLoading-ML6AEPv5.js";const $t={key:0},wt={key:0},Ct={key:1},St=tt({__name:"CountdownTimer",props:{targetDateTime:{}},setup(i){const e=i,a=I(d());let n;function d(){const m=new Date(e.targetDateTime).getTime()-new Date().getTime(),g=Math.floor(m/1e3%60),f=Math.floor(m/1e3/60%60),p=Math.floor(m/(1e3*60*60)%24),k=Math.floor(m/(1e3*60*60*24));return{total:m,days:k,hours:p,minutes:f,seconds:g}}function l(){a.value=d()}return et(()=>{n=setInterval(()=>{l(),a.value.total<=0&&clearInterval(n)},1e3)}),lt(()=>clearInterval(n)),st(()=>e.targetDateTime,()=>{l(),clearInterval(n)}),(m,g)=>a.value.total>0?(o(),u("div",$t,[a.value.days?(o(),u("span",wt,y(a.value.days)+"d ",1)):b("",!0),t("span",null,y(a.value.hours.toString().padStart(2,"0"))+"h :",1),t("span",null,y(a.value.minutes.toString().padStart(2,"0"))+"m :",1),t("span",null,y(a.value.seconds.toString().padStart(2,"0"))+"s",1)])):(o(),u("div",Ct,[A(m.$slots,"expired",{},()=>[g[0]||(g[0]=$("Timeâ€™s up!"))])]))}}),It={class:"mb-3"},Dt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Pt={key:1,class:"text-center py-4 text-gray-500"},Ut={key:2,class:"text-center py-4 text-red-500"},Et={key:3,class:"space-y-4"},Lt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(i,{emit:e}){const a=i,n=e,d=I(null),{handleItemsPriorityUpdate:l,saveTaskPriority:m,listHasRearranged:g}=yt(()=>a.tasks,a.parentId),f=async()=>{await m(),n("updatePriority")};return(p,k)=>(o(),u("div",null,[t("div",It,[A(p.$slots,"task:header")]),r(g)?(o(),u("div",Dt,[k[3]||(k[3]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:w(f,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:k[0]||(k[0]=w((...c)=>d.value.resetItems&&d.value.resetItems(...c),["prevent"]))},"Discard")])):b("",!0),i.loading?(o(),u("div",Pt,"Loading tasks...")):i.error?(o(),u("div",Ut,y(i.error),1)):(o(),u("div",Et,[x(xt,{items:i.tasks,handle:"handle",onItemsUpdate:r(l),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:d},{item:h(({item:c,index:T})=>[x(_t,{index:T,task:c,class:"!border-0",onCommentButtonClick:C=>n("commentButtonClick",c.id),onEditClick:k[1]||(k[1]=C=>n("editClick",C)),onAddClick:k[2]||(k[2]=C=>n("addClick",C)),showDraggableHandle:!0},null,8,["index","task","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},At={class:"flex justify-between mt-5"},Mt={class:"flex flex-wrap items-center gap-2 mt-3"},Rt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(i,{emit:e}){const a=i,n=e,d=I(),l=at({show:!1,parentId:a.parentId,requirementId:null}),m=k=>{l.show=!0,l.parentId=k,console.log({addForm:l})};function g(){l.show=!1,l.parentId=a.parentId,n("created")}function f(){d.value=!1,n("updated")}function p(){l.show=!1,l.parentId=a.parentId}return(k,c)=>(o(),u("div",null,[d.value?(o(),D(L,{key:0},{default:h(()=>[x(vt,{taskId:d.value,onClose:c[0]||(c[0]=T=>d.value=null),onUpdated:f},null,8,["taskId"])]),_:1})):b("",!0),l.show?(o(),D(L,{key:1},{default:h(()=>[x(gt,{parentTaskId:l.parentId,requirementId:l.requirementId,onTaskCreated:g,onError:k.handleTaskError,onClose:p},null,8,["parentTaskId","requirementId","onError"])]),_:1})):b("",!0),x(Lt,{tasks:i.subTasks,parentId:i.parentId,onAddClick:c[2]||(c[2]=T=>m(T)),onEditClick:c[3]||(c[3]=T=>d.value=T),onUpdatePriority:c[4]||(c[4]=T=>n("updatePriority"))},{"task:header":h(()=>[t("div",At,[c[5]||(c[5]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),t("div",Mt,[t("button",{class:"btn-1 ml-auto",onClick:c[1]||(c[1]=w(()=>m(i.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId"])]))}},Bt={class:"min-w-full bg-white rounded overflow-hidden"},Ft={class:"py-0.5 text-bg font-semibold"},Nt={class:"px-2 py-1 border-y"},jt={class:"px-2 py-1 border-y"},Ot={class:"px-2 py-1 border-y text-center"},qt={class:"px-2 py-1 border-y text-center"},Vt={class:"px-2 py-1 border-y text-center"},Gt={class:"px-2 py-1 border-y text-center"},Ht=tt({__name:"TaskProgressTable",props:{progressUsers:{}},setup(i){return(e,a)=>(o(),u("table",Bt,[t("caption",Ft,[A(e.$slots,"caption",{},()=>[a[0]||(a[0]=$("Progress"))])]),a[1]||(a[1]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," User Progress "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," Task Progress ")])],-1)),t("tbody",null,[(o(!0),u(nt,null,dt(e.progressUsers,(n,d)=>(o(),u("tr",{key:n.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Nt,y(d+1),1),t("td",jt,[x(ot,{user:n},null,8,["user"])]),t("td",Ot,y(r(U)(n.started_at)),1),t("td",qt,y(r(U)(n.finished_at)),1),t("td",Vt,y(n.user_progress)+"%",1),t("td",Gt,y(n.task_progress)+"%",1)]))),128))])]))}}),zt=ut("task-user",()=>({updateUserStartDate:async(a,n,d)=>await Y.patch(`/task-user/task/${a}/user/${n}/update-start-date/${d}`),updateUserFinishDate:async(a,n,d)=>await Y.patch(`/task-user/task/${a}/user/${n}/update-finish-date/${d}`)})),Kt={class:"border-b text-center"},Wt={key:0},Jt={key:1},Qt={class:"mb-2 mt-6"},Xt={class:"flex justify-center"},Yt={class:"py-6"},Zt={class:"mt-2"},te={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},ee={class:"flex justify-between items-center"},se={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(i,{emit:e}){const a=i,n=e,d=zt(),l=I(""),m=I("");async function g(){var f,p;console.log({date:l.value});try{a.type=="start-date"?await d.updateUserStartDate(a.task.id,a.user.id,l.value||"0"):a.type=="finish-date"&&await d.updateUserFinishDate(a.task.id,a.user.id,l.value||"0"),n("updateDate")}catch(k){m.value=((p=(f=k.response)==null?void 0:f.data)==null?void 0:p.message)||`Failed to update ${a.type}`}}return(f,p)=>(o(),u("form",{class:"p-4",onSubmit:w(g,["prevent"])},[t("div",Kt,[i.type=="start-date"?(o(),u("h2",Wt,"Edit Start Date")):i.type=="finish-date"?(o(),u("h2",Jt,"Edit Finish Date")):b("",!0)]),t("div",Qt,[p[2]||(p[2]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,y(i.task.title),1)]),t("div",null,[p[3]||(p[3]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"User:",-1)),x(ot,{user:i.user},null,8,["user"])]),t("div",Xt,[t("div",Yt,[p[4]||(p[4]=t("label",{class:"block text-xs font-semibold"},"Date",-1)),pt(t("input",{type:"date","onUpdate:modelValue":p[0]||(p[0]=k=>l.value=k),class:"border py-2 px-4 rounded-md",size:"8"},null,512),[[ct,l.value]])])]),t("div",Zt,[m.value?(o(),u("div",te,y(m.value),1)):b("",!0)]),t("div",ee,[p[5]||(p[5]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1)),t("button",{class:"btn-3",onClick:p[1]||(p[1]=w(k=>n("closeClick"),["prevent"]))},"Close")])],32))}},ae=i=>i==null?void 0:i.reduce((e,a)=>e+a.task_weight,0),ne=(i,e)=>{const a=ae(i);return i.map(n=>{const d=e.filter(l=>l.user_id===n.id).reduce((l,m)=>l+m.progress,0);return{...n,task_progress:Math.floor(d*(n.task_weight/a)),user_progress:d}})},oe={class:"container mx-auto p-6"},re={class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6"},ie={class:"grid grid-cols-4"},le={class:"mb-4 flex col-span-full"},de={class:"font-medium text-xl"},ue={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},pe={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},ce={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},me={class:"text-right col-span-full md:col-span-1 ml-auto flex justify-center gap-4 !text-lg"},ke={class:"mt-4 col-span-full mb-6"},fe={class:"ml-auto text-right text-sm col-span-full"},ye={key:1,class:"text-gray-500"},xe={class:"font-semibold text-green-800"},be={key:2,class:"ml-4 text-gray-500"},ge={class:"text-red-500 font-semibold"},ve={class:"py-2 flex justify-center items-center gap-2 col-span-full"},_e=["disabled"],he=["disabled"],Te={class:"ml-auto flex gap-4"},$e={key:0},we={key:1},Ce={key:1,class:"text-center py-4 text-gray-500"},Se={key:2,class:"text-center py-4 text-red-500"},Fe={__name:"TaskShow",setup(i){const e=Tt(),a=mt(),n=kt(),d=ft(),l=bt(),m=S(()=>l.getTaskListTree()),g=I({});et(async()=>{});const f=at({user:null,type:""}),p=_=>{n.push({name:"TaskEdit",params:{id:_}})},k=S(()=>{var _,s;return e.task.parent_id==0?{name:"TaskList",params:{id:(_=e.task)==null?void 0:_.id}}:{name:"TaskShow",params:{id:(s=e.task)==null?void 0:s.parent_id}}});async function c(_){const s=await e.fetchTask(_);l.setTaskList(s.sub_tasks,e.task.id)}const T=S(()=>({...e.task,children_tasks:m.value})),C=S(()=>ne(e.task.users,e.task.task_reports)),M=S(()=>C.value.find(_=>{var s;return _.id===((s=d.user)==null?void 0:s.id)})),R=S(()=>U(e.task.started_at)),B=S(()=>U(e.task.deadline));function F(_){f.user=d.user,f.type=_}async function rt(){await c(e.task.id),f.user=null,f.type=""}return st(()=>a.params.id,c,{initial:!0,immediate:!0}),(_,s)=>{var N,j,O,q,V,G,H,z,K,W,J,Q;const P=Z("RouterLink"),it=Z("router-view");return o(),u("div",oe,[f.user?(o(),D(L,{key:0},{default:h(()=>[x(se,{task:r(e).task,user:f.user,type:f.type,onCloseClick:s[0]||(s[0]=v=>f.user=null),onUpdateDate:rt},null,8,["task","user","type"])]),_:1})):b("",!0),t("div",re,[r(e).task?(o(),u(nt,{key:0},[t("section",ie,[t("div",le,[t("div",null,[t("h2",de,y(r(e).task.title),1),t("div",ue,[(N=r(e).task)!=null&&N.is_important?(o(),u("span",pe,"IMPORTANT")):b("",!0),(j=r(e).task)!=null&&j.is_urgent?(o(),u("span",ce,"URGENT")):b("",!0)])]),t("div",me,[t("span",{class:E([{"bg-gray-200":((O=r(e).task)==null?void 0:O.status)==="PENDING","bg-blue-200":((q=r(e).task)==null?void 0:q.status)==="IN_PROGRESS","bg-green-200":((V=r(e).task)==null?void 0:V.status)==="COMPLETED","bg-red-200":((G=r(e).task)==null?void 0:G.status)==="BLOCKED"},"px-3 py-0.5 rounded-full text-sm h-6"])},y((H=r(e).task)==null?void 0:H.status),3),x(ht,{task:T.value,ref_key:"progress",ref:g,class:"!text-lg"},null,8,["task"])])]),t("section",ke,[x(Ht,{"progress-users":C.value},{caption:h(()=>s[11]||(s[11]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["progress-users"])]),t("div",fe,[r(e).task.deadline?(o(),D(St,{key:0,targetDateTime:r(e).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):b("",!0),R.value?(o(),u("span",ye,[s[12]||(s[12]=$(" Started: ")),t("span",xe,y(R.value),1)])):b("",!0),B.value?(o(),u("span",be,[s[13]||(s[13]=$(" Deadline: ")),t("span",ge,y(B.value),1)])):b("",!0)]),s[18]||(s[18]=t("hr",{class:"my-3 col-span-full"},null,-1)),t("div",ve,[t("button",{onClick:s[1]||(s[1]=w(v=>{var X;return p((X=r(e).task)==null?void 0:X.id)},["stop"])),class:"btn-2 py-0.5"},"Edit"),x(P,{to:{name:"TaskUserAssign",params:{id:(z=r(e).task)==null?void 0:z.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[2]||(s[2]=v=>v.stopPropagation())},{default:h(()=>s[14]||(s[14]=[t("i",{class:"fas fa-user-plus"},null,-1),$(" Assign Users ")])),_:1},8,["to"]),x(P,{to:k.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[3]||(s[3]=v=>v.stopPropagation())},{default:h(()=>s[15]||(s[15]=[t("i",{class:"fas fa-arrow-left"},null,-1),$(" Back ")])),_:1},8,["to"]),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:s[4]||(s[4]=w(()=>F("start-date"),["prevent"])),disabled:!!((K=M.value)!=null&&K.started_at)}," Set Started Date ",8,_e),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:s[5]||(s[5]=w(()=>F("finish-date"),["prevent"])),disabled:!!((W=M.value)!=null&&W.finished_at)}," Set Finish Date ",8,he),t("div",Te,[m.value.length>0?(o(),D(P,{key:0,to:{name:"TaskShow",params:{id:(J=r(e).task)==null?void 0:J.id}},onClick:s[6]||(s[6]=v=>v.stopPropagation()),class:E(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":r(a).name=="TaskShow"}])},{default:h(()=>s[16]||(s[16]=[t("i",{class:"fal fa-list-ul"},null,-1),$(" Sub Tasks ")])),_:1},8,["to","class"])):b("",!0),x(P,{to:{name:"TaskReports",params:{id:(Q=r(e).task)==null?void 0:Q.id}},onClick:s[7]||(s[7]=v=>v.stopPropagation()),class:E(["py-1 btn-3",{"bg-blue-500 text-white":r(a).name=="TaskReports"}])},{default:h(()=>s[17]||(s[17]=[t("i",{class:"fal fa-file-alt"},null,-1),$(" Reports ")])),_:1},8,["to","class"])])])]),r(a).name=="TaskShow"?(o(),u("section",$e,[x(Rt,{subTasks:m.value,"parent-id":r(a).params.id,onCreated:s[8]||(s[8]=v=>c(r(a).params.id)),onUpdated:s[9]||(s[9]=v=>c(r(a).params.id)),onUpdatePriority:s[10]||(s[10]=v=>c(r(a).params.id))},null,8,["subTasks","parent-id"])])):(o(),u("section",we,[x(it)]))],64)):r(e).loading?(o(),u("div",Ce," Loading task details... ")):(o(),u("div",Se,y(r(e).error),1))])])}}};export{Fe as default};
