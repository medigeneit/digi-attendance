import{G as ne,r as h,H as Y,B as $,p as O,q as H,e as re,c as f,o as p,a as s,g as ue,y as I,h as L,k as K,A as de,F as C,x as F,t as w,v as ie,n as U,D as j,j as P,K as ce}from"./index-BTj1byx0.js";import{_ as ve}from"./EmployeeDropdownInput-oJisjkyN.js";import{S as Q}from"./SelectDropdown-CIS-fovv.js";import{u as fe}from"./company-DPL6gNii.js";import{u as pe}from"./department--LbFrlOu.js";import{u as he}from"./shift-DhPXhLw8.js";import{d as T}from"./dayjs.min-Cbbdfn5l.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-Cuf8xPJn.js";const ye=ne("shiftSchedule",()=>{const _=h([]),S=h(!1);return{schedules:_,defaultShift:S,fetchSchedules:async i=>{var m,N,V;const u=await Y.get("/shift-schedules",i);return _.value=(m=u==null?void 0:u.data)==null?void 0:m.schedules,S.value=(N=u==null?void 0:u.data)==null?void 0:N.default_shift,(V=u.data)==null?void 0:V.schedules},saveSchedules:async i=>{await Y.post("/shift-schedules",{schedules:i==null?void 0:i.payload})},fetchDefaultSchedules:async i=>{const u=await Y.get("/default-shift-schedules",i);return _.value=u==null?void 0:u.data,u.data}}}),ge={class:"p-4 max-w-[1600px] mx-auto"},Se={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},be=["value"],De={key:0,class:"text-yellow-600 font-medium mb-2 p-2 border rounded border-black"},we={class:"flex flex-wrap gap-3 mb-4 p-4 bg-white rounded sticky top-16"},xe=["onClick"],Ee={class:"text-sm"},ke={class:"overflow-auto"},Ce={class:"table-auto w-full border text-sm"},Fe={class:"sticky top-0 bg-white z-10"},_e={class:"text-xs text-gray-400"},Ae={class:"border p-2"},Ne=["value"],Ve={class:"border p-2 whitespace-nowrap"},Me={class:"border p-2"},We=["onClick"],Be=["onClick"],$e=["title"],Ke={__name:"ShiftScheduleForm",setup(_){const S=ye(),x=fe(),A=he(),E=pe(),{defaultShift:i}=$(S),{companies:u,employees:m}=$(x),{departments:N}=$(E),{shifts:V}=$(A),b=h(T().format("YYYY-MM")),y=h(""),g=h("");h("");const M=h(""),c=h(""),r=h({}),d=h([]),D=h({WEEKEND:"#B91C1C",HOLIDAY:"#6B7280"}),z=["#FF5733","#33C1FF","#33FF57","#FF33D4","#FFD633","#7D33FF","#FF8C33","#33FFF0","#B833FF","#3375FF","#FF3333","#33FFAA"],W=O(()=>Object.values(V.value||{}).flat());function q(){let l=0;W.value.forEach(e=>{D.value[e.id]||(D.value[e.id]=z[l%z.length],l++)})}const B=O(()=>Array.from({length:T(b.value).daysInMonth()},(l,e)=>e+1)),G=l=>{const e=`${b.value}-${String(l).padStart(2,"0")}`;return T(e).format("ddd")},X=(l,e)=>{var a,o;const t=(o=(a=r.value)==null?void 0:a[l])==null?void 0:o[e];return t?t==="WEEKEND"||t==="HOLIDAY"?{backgroundColor:D.value[t]||"#D1D5DB"}:{backgroundColor:D.value[t]||"#D1D5DB"}:{backgroundColor:"#D1D5DB"}},Z=(l,e)=>{var o,v;const t=(v=(o=r.value)==null?void 0:o[l])==null?void 0:v[e],a=W.value.find(n=>n.id===t);return(a==null?void 0:a.name)||""},ee=(l,e)=>{d.value.includes(parseInt(l))&&c.value&&(r.value[l]||(r.value[l]={}),r.value[l][e]=c.value)},R=l=>{d.value.includes(parseInt(l))&&c.value&&(r.value[l]||(r.value[l]={}),B.value.forEach(e=>{r.value[l][e]=c.value}))},te=()=>{d.value.forEach(R)},le=()=>{d.value.forEach(l=>{var a;const e=m.value.find(o=>o.id===parseInt(l)),t=((a=e==null?void 0:e.weekends)==null?void 0:a.map(o=>o.slice(0,3)))||[];r.value[l]||(r.value[l]={}),B.value.forEach(o=>{const v=G(o);t.includes(v)&&(r.value[l][o]="WEEKEND")})})},se=async()=>{if(!d.value.length){alert("Please select employees before saving.");return}if(!confirm("Are you sure you want to save the schedule?"))return;const l=[];for(const[e,t]of Object.entries(r.value))if(d.value.includes(parseInt(e)))for(const[a,o]of Object.entries(t)){let v=null,n=null;o==="WEEKEND"||o==="HOLIDAY"?n=o:v=o,l.push({employee_id:parseInt(e),date:`${b.value}-${String(a).padStart(2,"0")}`,shift_id:v,status:n})}if(console.log({payload:l}),!l.length){alert("No schedule data to save.");return}try{await S.saveSchedules({payload:l}),alert("Shift schedule saved successfully!")}catch(e){console.error("Failed to save schedule",e),alert("Something went wrong while saving.")}};H(y,async l=>{l&&(g.value="",d.value=[],m.value=[],r.value={},await x.fetchEmployee(l),await E.fetchDepartments({companyId:l}),await A.fetchShifts({companyId:l}),q())}),H(g,async l=>{if(l){const e={departmentIds:[l]},t=await E.fetchDepartmentEmployee(e);m.value=t,d.value=[],await J(y.value,l,b.value)}}),H(b,async l=>{if(l&&y.value&&g.value){if(await x.fetchEmployee(y.value),y.value&&await A.fetchShifts({companyId:y.value}),g.value){const e=await E.fetchDepartmentEmployee({departmentIds:[g.value]});m.value=e}q(),await J(y.value,g.value,l)}});const ae=O(()=>M.value?m.value.filter(l=>l.id===parseInt(M.value)):m.value);re(async()=>{await x.fetchCompanies()});const J=async(l,e,t)=>{try{if(!l||!e||!t){alert("Company, Department, and Month are required to load schedule.");return}r.value={},d.value=[],i.value=!1;let o=await S.fetchSchedules({params:{company_id:l,department_id:e,month:t}})||[];const v={};if(!o.length){const n=await S.fetchDefaultSchedules({params:{company_id:l,department_id:e,month:t}});console.warn("[Fallback Schedule Loaded]",n),alert("No saved schedule found. Default schedule loaded."),o=n,i.value=!0}o.forEach(n=>{if(!(n!=null&&n.employee_id)||!(n!=null&&n.date))return;const k=n.employee_id,oe=parseInt(n.date.split("-")[2]);v[k]||(v[k]={}),v[k][oe]=n.shift_id||n.status,!i.value&&!d.value.includes(k)&&d.value.push(k)}),r.value=v}catch(a){console.error("Failed to load schedule data:",a),alert("Error loading schedule. Please try again or contact admin.")}};return(l,e)=>(p(),f("div",ge,[e[14]||(e[14]=s("h2",{class:"text-center title-lg mb-4"},"Monthly Shift Schedule Plan",-1)),s("div",Se,[I(Q,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),options:K(u),placeholder:"--Select Company--",class:"h-10",clearable:"",label:"name"},null,8,["modelValue","options"]),I(Q,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),options:K(N),placeholder:"--All Department--",class:"h-10",clearable:"",label:"name"},null,8,["modelValue","options"]),s("div",null,[I(ve,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=t=>M.value=t),employees:K(m),placeholder:"--Select User--",class:"h-10"},null,8,["modelValue","employees"])]),L(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>c.value=t),class:"h-10 px-2 border rounded"},[e[8]||(e[8]=s("option",{value:""},"- Shift -",-1)),(p(!0),f(C,null,F(W.value,t=>(p(),f("option",{key:t.id,value:t.id},w(t.name),9,be))),128))],512),[[de,c.value]]),L(s("input",{type:"month","onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t),class:"h-10 px-2 border rounded"},null,512),[[ie,b.value]])]),K(i)?(p(),f("p",De," âš  Showing default schedule from current shift. Select employees manually before saving. ")):ue("",!0),s("div",we,[(p(!0),f(C,null,F(W.value,t=>(p(),f("div",{key:t.id,class:U(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":c.value===t.id}]),onClick:a=>c.value=t.id},[s("div",{class:"w-5 h-5 rounded",style:j({backgroundColor:D.value[t.id]||"#ccc"})},null,4),s("span",Ee,w(t.name),1)],10,xe))),128)),s("div",{class:U(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":c.value==="HOLIDAY"}]),onClick:e[5]||(e[5]=t=>c.value="HOLIDAY")},e[9]||(e[9]=[s("div",{class:"w-5 h-5 rounded bg-gray-500"},null,-1),s("span",{class:"text-sm"},"Holiday",-1)]),2),s("div",{class:U(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":c.value==="WEEKEND"}]),onClick:e[6]||(e[6]=t=>c.value="WEEKEND")},[s("div",{class:"w-5 h-5 rounded",style:j({backgroundColor:D.value.WEEKEND})},null,4),e[10]||(e[10]=s("span",{class:"text-sm"},"Weekend",-1))],2)]),s("div",{class:"mb-4 flex gap-4"},[s("button",{onClick:te,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),s("button",{onClick:le,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),s("div",ke,[s("table",Ce,[s("thead",Fe,[s("tr",null,[e[11]||(e[11]=s("th",{class:"border p-2"},"Emp ID",-1)),e[12]||(e[12]=s("th",{class:"border p-2"},"Name",-1)),e[13]||(e[13]=s("th",{class:"border p-2"},"Action",-1)),(p(!0),f(C,null,F(B.value,t=>(p(),f("th",{key:t,class:"border text-center p-1 w-10"},[P(w(t)+" ",1),s("div",_e,w(G(t)),1)]))),128))])]),s("tbody",null,[(p(!0),f(C,null,F(ae.value,t=>(p(),f("tr",{key:t.id},[s("td",Ae,[L(s("input",{type:"checkbox",class:"mr-2",value:t.id,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value=a)},null,8,Ne),[[ce,d.value]]),P(" "+w(t.code),1)]),s("td",Ve,w(t.name),1),s("td",Me,[s("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:a=>R(t.id)}," Apply to All Dates ",8,We)]),(p(!0),f(C,null,F(B.value,a=>(p(),f("td",{key:a,class:"border text-center cursor-pointer",onClick:o=>ee(t.id,a)},[s("div",{title:Z(t.id,a),style:j(X(t.id,a)),class:"w-full h-6"},null,12,$e)],8,Be))),128))]))),128))])])]),s("div",{class:"mb-4 flex justify-center mt-4"},[s("button",{onClick:se,class:"btn-2"},"ðŸ’¾ Save Schedule")])]))}},qe=me(Ke,[["__scopeId","data-v-babe5fdf"]]);export{qe as default};
