import{b as P,r as E,x as f,A as G,m as K,c as i,o as a,g as l,a as t,q as j,n as g,t as c,f as m,w as h,j as u,k as R,i as q,L as W}from"./index-BwpyRo1n.js";import{_ as F}from"./TaskAssignedUsers-B-x6_r8E.js";import{_ as Q}from"./TaskStatus-jpVDucaT.js";import{b as x,d as X}from"./datetime-DcVwRp76.js";import{_ as Y,T as Z}from"./TaskTreeChildrenTable-XGqdxq9J.js";import{_,T as ee,a as se}from"./TaskUrgentBadge-B8IU20OI.js";import{_ as te}from"./TaskSupervisorAndEmployee-CPMrXJKf.js";const ae={class:"flex w-full text-gray-800 bg-white"},le={key:0,class:"border-l border-gray-200 last:border-l-0"},ie={class:"items-start group"},ne={class:"flex items-start justify-between w-full gap-4 mb-2"},oe={class:"flex gap-2 flex-grow items-center"},re={key:0,class:"text-xl font-semibold text-blue-500"},de={class:"justify-end items-center gap-2 ml-auto flex flex-wrap flex-shrink-0 sticky right-4"},ce={class:"flex items-center justify-between gap-16 w-full"},ue={class:"flex-shrink-0"},ke={class:"flex items-center"},fe={key:0,class:"flex gap-4 items-center mr-3"},me={key:1,class:"text-gray-500 text-sm"},ge={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},xe={class:"text-xs text-gray-400 whitespace-nowrap"},ye={class:"children-task-table ml-0 col-span-full"},he={class:"flex gap-3 items-center px-3 flex-wrap gap-y-8"},be={class:"text-right text-sm flex items-center gap-4 mt-2 opacity-80"},we={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 whitespace-nowrap"},ve={key:1,class:"text-sm"},pe={class:"text-blue-500 font-semibold whitespace-nowrap"},Te={key:2,class:"text-sm"},Ce={class:"font-semibold text-blue-800 whitespace-nowrap"},Be={key:3,class:"text-sm"},De={class:"font-semibold text-blue-500 whitespace-nowrap"},Ae={key:4,class:"text-sm"},Se={class:"font-semibold text-green-500 whitespace-nowrap"},$e={class:"flex items-center justify-center w-full md:w-auto sm:ml-auto"},Le={key:0,class:"flex gap-2 ml-4 items-center text-xs"},Me=["href"],Ne=["href"],Ue={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(e,{emit:V}){const r=e,I=P(),O=E(null),k=V;function U(n){k("editClick",n)}function H(n){k("employeeAssignClick",n)}const d=E([]),b=localStorage.getItem("sub_task_opened_list");if(b)try{d.value=JSON.parse(b)}catch{d.value=[]}const w=f(()=>x(r.task.assigned_at)),v=f(()=>x(r.task.deadline)),p=f(()=>x(r.task.started_at)),T=f(()=>x(r.task.completed_at)),z=f({get:()=>d.value.includes(r.task.id),set:n=>{const s=d.value.includes(r.task.id);n&&!s?d.value.push(r.task.id):!n&&s&&(d.value=d.value.filter(y=>y!==r.task.id))}});return G(d,n=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(n))},{deep:!0}),(n,s)=>{var C,B,D,A,S,$,L,M,N;const y=K("RouterLink");return a(),i("div",ae,[e.treeLevel>0?(a(),i("div",le,s[4]||(s[4]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):l("",!0),t("div",{class:j(["flex-grow rounded pb-3 overflow-y-auto",{"border-2":e.index,"border-blue-500":e.index%2===0,"border-pink-300":e.index%2===1,"bg-blue-100/30  ":e.task.closed_at,"bg-green-100  ":((C=e.task)==null?void 0:C.progress_percent)===100,"bg-white hover:bg-gray-50":((B=e.task)==null?void 0:B.progress_percent)<100&&!e.task.closed_at}])},[t("div",ie,[t("div",{class:j(["task-details py-3 shadow-slate-100 flex flex-wrap z-30 pl-3",{"shadow-sm":e.treeLevel>0}])},[t("div",ne,[t("div",oe,[e.index!==void 0?(a(),i("div",re,c(e.index+1)+". ",1)):l("",!0),g(_,{task:e.task,"sub-tasks-open":z.value,"is-my-task":e.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),t("div",de,[e.task.closed_at?(a(),m(Z,{key:0})):l("",!0),g(Q,{status:(D=e.task)==null?void 0:D.status,progressPercent:((A=e.task)==null?void 0:A.progress_percent)||0,class:"w-[150px] text-center !border-2"},null,8,["status","progressPercent"]),(($=(S=e.task)==null?void 0:S.children_tasks)==null?void 0:$.length)>0?(a(),m(F,{key:1,ref_key:"progress",ref:O,task:e.task,class:"text-sm w-[150px] text-center"},null,8,["task"])):l("",!0)])]),t("div",ce,[t("div",ue,[t("div",ke,[e.showDraggableHandle||e.task.serial?(a(),i("div",fe,[e.showDraggableHandle?(a(),i("button",{key:0,onMousedown:s[0]||(s[0]=h((...o)=>n.handleDragging&&n.handleDragging(...o),["stop"])),class:"handle"},s[5]||(s[5]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):l("",!0),e.task.serial?(a(),i("span",me," #"+c(e.task.serial),1)):l("",!0)])):l("",!0),t("div",ge,[t("div",xe,[s[6]||(s[6]=t("i",{class:"fas fa-clock"},null,-1)),u(" "+c(R(X)(e.task.created_at)),1)]),(L=e.task)!=null&&L.is_important?(a(),m(ee,{key:0,class:"flex-none"})):l("",!0),(M=e.task)!=null&&M.is_urgent?(a(),m(se,{key:1,class:"flex-none"})):l("",!0)])])]),e.hideAssignedUsers?l("",!0):(a(),m(te,{key:0,task:e.task,"tree-level":e.treeLevel,class:"flex-nowrap grow shrink","employee-route-to":o=>({query:{...R(I).query,view:"userwise","company-id":o.company_id,"user-ids":o.id}})},null,8,["task","tree-level","employee-route-to"]))])],2),t("div",ye,[g(Y,{childrenTasks:e.task.children_tasks,parentTask:e.task,isMyTask:e.isMyTask,"hide-buttons":e.hideButtons,"hide-assigned-users":e.hideAssignedUsers,"parent-tree-level":e.treeLevel,onEditClick:U,onAddClick:s[1]||(s[1]=o=>k("addClick",o)),onEmployeeAssignClick:H},{"tree-item-end":q(({task:o,level:J})=>[W(n.$slots,"item-end",{level:J,task:o})]),_:3},8,["childrenTasks","parentTask","isMyTask","hide-buttons","hide-assigned-users","parent-tree-level"])])]),t("div",he,[t("div",be,[e.task.is_target?(a(),i("div",we,s[7]||(s[7]=[t("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),u(" TARGET TASK ")]))):l("",!0),v.value?(a(),i("span",ve,[s[8]||(s[8]=t("span",{class:"italic text-gray-500"},"Deadline: ",-1)),t("span",pe,c(v.value),1)])):l("",!0),w.value?(a(),i("span",Te,[s[9]||(s[9]=t("span",{class:"italic text-gray-500"},"Assign: ",-1)),t("span",Ce,c(w.value),1)])):l("",!0),p.value?(a(),i("span",Be,[s[10]||(s[10]=t("span",{class:"italic text-gray-500"},"Started: ",-1)),t("span",De,c(p.value),1)])):l("",!0),T.value?(a(),i("span",Ae,[s[12]||(s[12]=t("span",{class:"italic text-gray-500"},"Completed: ",-1)),t("span",Se,[u(c(T.value)+" ",1),s[11]||(s[11]=t("i",{class:"fas fa-check-circle"},null,-1))])])):l("",!0)]),t("div",$e,[e.hideButtons?l("",!0):(a(),i("div",Le,[e.task.is_closed?l("",!0):(a(),i("a",{key:0,href:`/tasks/edit/${e.task.id}`,onClick:s[2]||(s[2]=h(o=>k("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs whitespace-nowrap"},s[13]||(s[13]=[t("i",{class:"fas fa-edit"},null,-1),u(" Edit ")]),8,Me)),e.task.is_closed?l("",!0):(a(),i("a",{key:1,href:`/tasks/${e.task.id}/assign-users`,onClick:s[3]||(s[3]=h(o=>k("employeeAssignClick",e.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2 whitespace-nowrap"},s[14]||(s[14]=[t("i",{class:"fas fa-users-cog"},null,-1),u(" Manage ")]),8,Ne)),g(y,{to:{name:"TaskReports",params:{id:(N=e.task)==null?void 0:N.id},query:{"is-my-task":e.isMyTask},hash:"#task-reports"},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2 whitespace-nowrap"},{default:q(()=>s[15]||(s[15]=[t("i",{class:"far fa-file-alt"},null,-1),u(" Reports ")])),_:1,__:[15]},8,["to"])]))])])],2)])}}};export{Ue as _};
