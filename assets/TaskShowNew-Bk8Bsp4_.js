import{G as K,r as S,e as Q,H as at,A as X,c as d,o,f as x,a as t,t as y,I as A,n as $,h as u,w,l as v,p as T,D as Y,m as D,F as Z,x as nt,J as ot,K as G,g as rt,v as lt,b as it,u as dt,d as ut,q as I,k as W,y as J}from"./index-CjYkxO9X.js";import{u as pt,_ as ct,O as L}from"./task-priority-mancjh3n.js";import{_ as mt}from"./TaskAddForm-B1A1jXVi.js";import{_ as kt}from"./TaskEditForm-CRdTh6KR.js";import{_ as ft,g as P,a as yt,b as vt}from"./TaskTreeView-BCesBKz2.js";import{_ as tt}from"./UserChip--iY73lgh.js";import{u as xt}from"./useTaskStore-CnYEowxa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-RbbAkHIn.js";import"./SectionLoading-BlWCzvwG.js";const bt={key:0},gt={key:0},_t={key:1},ht=K({__name:"CountdownTimer",props:{targetDateTime:{}},setup(r){const a=r,e=S(i());let n;function i(){const m=new Date(a.targetDateTime).getTime()-new Date().getTime(),b=Math.floor(m/1e3%60),f=Math.floor(m/1e3/60%60),c=Math.floor(m/(1e3*60*60)%24),k=Math.floor(m/(1e3*60*60*24));return{total:m,days:k,hours:c,minutes:f,seconds:b}}function l(){e.value=i()}return Q(()=>{n=setInterval(()=>{l(),e.value.total<=0&&clearInterval(n)},1e3)}),at(()=>clearInterval(n)),X(()=>a.targetDateTime,()=>{l(),clearInterval(n)}),(m,b)=>e.value.total>0?(o(),d("div",bt,[e.value.days?(o(),d("span",gt,y(e.value.days)+"d ",1)):x("",!0),t("span",null,y(e.value.hours.toString().padStart(2,"0"))+"h :",1),t("span",null,y(e.value.minutes.toString().padStart(2,"0"))+"m :",1),t("span",null,y(e.value.seconds.toString().padStart(2,"0"))+"s",1)])):(o(),d("div",_t,[A(m.$slots,"expired",{},()=>[b[0]||(b[0]=$("Timeâ€™s up!"))])]))}}),Tt={class:"mb-3"},$t={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},wt={key:1,class:"text-center py-4 text-gray-500"},Ct={key:2,class:"text-center py-4 text-red-500"},St={key:3,class:"space-y-4"},It={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(r,{emit:a}){const e=r,n=a,i=S(null),{handleItemsPriorityUpdate:l,saveTaskPriority:m,listHasRearranged:b}=pt(()=>e.tasks,e.parentId),f=async()=>{await m(),n("updatePriority")};return(c,k)=>(o(),d("div",null,[t("div",Tt,[A(c.$slots,"task:header")]),u(b)?(o(),d("div",$t,[k[3]||(k[3]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:w(f,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:k[0]||(k[0]=w((...p)=>i.value.resetItems&&i.value.resetItems(...p),["prevent"]))},"Discard")])):x("",!0),r.loading?(o(),d("div",wt,"Loading tasks...")):r.error?(o(),d("div",Ct,y(r.error),1)):(o(),d("div",St,[v(ct,{items:r.tasks,handle:"handle",onItemsUpdate:u(l),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:i},{item:T(({item:p,index:h})=>[v(ft,{index:h,task:p,showDraggableHandle:!0,"tree-level":r.treeLevel,class:"!border-0",onCommentButtonClick:C=>n("commentButtonClick",p.id),onEditClick:k[1]||(k[1]=C=>n("editClick",C)),onAddClick:k[2]||(k[2]=C=>n("addClick",C))},null,8,["index","task","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Dt={class:"flex justify-between mt-5"},Ut={class:"flex flex-wrap items-center gap-2 mt-3"},Pt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(r,{emit:a}){const e=r,n=a,i=S(),l=Y({show:!1,parentId:e.parentId,requirementId:null}),m=k=>{l.show=!0,l.parentId=k,console.log({addForm:l})};function b(){l.show=!1,l.parentId=e.parentId,n("created")}function f(){i.value=!1,n("updated")}function c(){l.show=!1,l.parentId=e.parentId}return(k,p)=>(o(),d("div",null,[i.value?(o(),D(L,{key:0},{default:T(()=>[v(kt,{taskId:i.value,onClose:p[0]||(p[0]=h=>i.value=null),onUpdated:f},null,8,["taskId"])]),_:1})):x("",!0),l.show?(o(),D(L,{key:1},{default:T(()=>[v(mt,{parentTaskId:l.parentId,requirementId:l.requirementId,onTaskCreated:b,onError:k.handleTaskError,onClose:c},null,8,["parentTaskId","requirementId","onError"])]),_:1})):x("",!0),v(It,{tasks:r.subTasks,parentId:r.parentId,treeLevel:r.treeLevel,onAddClick:p[2]||(p[2]=h=>m(h)),onEditClick:p[3]||(p[3]=h=>i.value=h),onUpdatePriority:p[4]||(p[4]=h=>n("updatePriority"))},{"task:header":T(()=>[t("div",Dt,[p[5]||(p[5]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),t("div",Ut,[t("button",{class:"btn-1 ml-auto",onClick:p[1]||(p[1]=w(()=>m(r.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId","treeLevel"])]))}},Lt={class:"min-w-full bg-white rounded overflow-hidden"},At={class:"py-0.5 text-bg font-semibold"},Et={class:"px-2 py-1 border-y"},Mt={class:"px-2 py-1 border-y"},Nt={class:"px-2 py-1 border-y text-center"},Bt={class:"px-2 py-1 border-y text-center"},Ft={class:"px-2 py-1 border-y text-center"},Rt={class:"px-2 py-1 border-y text-center"},jt=K({__name:"TaskProgressTable",props:{progressUsers:{}},setup(r){return(a,e)=>(o(),d("table",Lt,[t("caption",At,[A(a.$slots,"caption",{},()=>[e[0]||(e[0]=$("Progress"))])]),e[1]||(e[1]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," User Progress "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," Task Progress ")])],-1)),t("tbody",null,[(o(!0),d(Z,null,nt(a.progressUsers,(n,i)=>(o(),d("tr",{key:n.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Et,y(i+1),1),t("td",Mt,[v(tt,{user:n},null,8,["user"])]),t("td",Nt,y(u(P)(n.started_at)),1),t("td",Bt,y(u(P)(n.finished_at)),1),t("td",Ft,y(n.user_progress)+"%",1),t("td",Rt,y(n.task_progress)+"%",1)]))),128))])]))}}),qt=ot("task-user",()=>({updateUserStartDate:async(e,n,i)=>await G.patch(`/task-user/task/${e}/user/${n}/update-start-date/${i}`),updateUserFinishDate:async(e,n,i)=>await G.patch(`/task-user/task/${e}/user/${n}/update-finish-date/${i}`)})),Ot={class:"border-b text-center"},Vt={key:0},Ht={key:1},zt={class:"mb-2 mt-6"},Gt={class:"flex justify-center"},Wt={class:"py-6"},Jt={class:"mt-2"},Kt={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Qt={class:"flex justify-between items-center"},Xt={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(r,{emit:a}){const e=r,n=a,i=qt(),l=S(""),m=S("");async function b(){var f,c;console.log({date:l.value});try{e.type=="start-date"?await i.updateUserStartDate(e.task.id,e.user.id,l.value||"0"):e.type=="finish-date"&&await i.updateUserFinishDate(e.task.id,e.user.id,l.value||"0"),n("updateDate")}catch(k){m.value=((c=(f=k.response)==null?void 0:f.data)==null?void 0:c.message)||`Failed to update ${e.type}`}}return(f,c)=>(o(),d("form",{class:"p-4",onSubmit:w(b,["prevent"])},[t("div",Ot,[r.type=="start-date"?(o(),d("h2",Vt,"Edit Start Date")):r.type=="finish-date"?(o(),d("h2",Ht,"Edit Finish Date")):x("",!0)]),t("div",zt,[c[2]||(c[2]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,y(r.task.title),1)]),t("div",null,[c[3]||(c[3]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"User:",-1)),v(tt,{user:r.user},null,8,["user"])]),t("div",Gt,[t("div",Wt,[c[4]||(c[4]=t("label",{class:"block text-xs font-semibold"},"Date",-1)),rt(t("input",{type:"date","onUpdate:modelValue":c[0]||(c[0]=k=>l.value=k),class:"border py-2 px-4 rounded-md",size:"8"},null,512),[[lt,l.value]])])]),t("div",Jt,[m.value?(o(),d("div",Kt,y(m.value),1)):x("",!0)]),t("div",Qt,[c[5]||(c[5]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1)),t("button",{class:"btn-3",onClick:c[1]||(c[1]=w(k=>n("closeClick"),["prevent"]))},"Close")])],32))}},Yt=r=>r==null?void 0:r.reduce((a,e)=>a+e.task_weight,0),Zt=(r,a)=>{const e=Yt(r);return r.map(n=>{const i=a.filter(l=>l.user_id===n.id).reduce((l,m)=>l+m.progress,0);return{...n,task_progress:Math.floor(i*(n.task_weight/e)),user_progress:i}})},te={class:"container mx-auto p-6"},ee={class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6"},se={class:"grid grid-cols-4"},ae={class:"mb-4 flex col-span-full"},ne={class:"font-medium text-xl"},oe={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},re={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},le={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},ie={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},de={class:"mt-4 col-span-full mb-6"},ue={class:"ml-auto text-right text-sm col-span-full"},pe={key:1,class:"text-gray-500"},ce={class:"font-semibold text-green-800"},me={key:2,class:"ml-4 text-gray-500"},ke={class:"text-red-500 font-semibold"},fe={class:"py-2 flex justify-center items-center gap-2 col-span-full"},ye=["disabled"],ve=["disabled"],xe={class:"ml-auto flex gap-4"},be={key:0},ge={key:1},_e={key:1,class:"text-center py-4 text-gray-500"},he={key:2,class:"text-center py-4 text-red-500"},Ae={__name:"TaskShowNew",setup(r){const a=xt(),e=it(),n=dt(),i=ut(),l=S(),m=I(()=>a.tasks),b=S({});Q(async()=>{p(e.params.id)});const f=Y({user:null,type:""}),c=g=>{n.push({name:"TaskEdit",params:{id:g}})},k=I(()=>{var g,s;return a.task.parent_id==0?{name:"NewTaskList",params:{id:(g=a.task)==null?void 0:g.id}}:{name:"TaskShow",params:{id:(s=a.task)==null?void 0:s.parent_id}}});async function p(g){await a.fetchTask(g);const s=await a.fetchTasks({parent_id:g},{newList:!0,loadingBeforeFetch:!0});l.value=s.parent_task}const h=I(()=>Zt(a.task.users,a.task.task_reports)),C=I(()=>h.value.find(g=>{var s;return g.id===((s=i.user)==null?void 0:s.id)})),E=I(()=>P(a.task.started_at)),M=I(()=>P(a.task.deadline));function N(g){f.user=i.user,f.type=g}async function et(){await p(e.params.id),f.user=null,f.type=""}return X(()=>e.params.id,p),(g,s)=>{var B,F,R,j,q,O,V,H;const U=W("RouterLink"),st=W("router-view");return o(),d("div",te,[f.user?(o(),D(L,{key:0},{default:T(()=>[v(Xt,{task:u(a).task,user:f.user,type:f.type,onCloseClick:s[0]||(s[0]=_=>f.user=null),onUpdateDate:et},null,8,["task","user","type"])]),_:1})):x("",!0),t("div",ee,[u(a).task?(o(),d(Z,{key:0},[t("section",se,[t("div",ae,[t("div",null,[t("h2",ne,y(u(a).task.title),1),t("div",oe,[(B=u(a).task)!=null&&B.is_important?(o(),d("span",re,"IMPORTANT")):x("",!0),(F=u(a).task)!=null&&F.is_urgent?(o(),d("span",le,"URGENT")):x("",!0)])]),t("div",ie,[v(yt,{status:(R=l.value)==null?void 0:R.status,class:""},null,8,["status"]),l.value?(o(),D(vt,{key:0,task:l.value,ref_key:"progress",ref:b,class:"!text-lg"},null,8,["task"])):x("",!0)])]),t("section",de,[v(jt,{"progress-users":h.value},{caption:T(()=>s[11]||(s[11]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["progress-users"])]),t("div",ue,[u(a).task.deadline?(o(),D(ht,{key:0,targetDateTime:u(a).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):x("",!0),E.value?(o(),d("span",pe,[s[12]||(s[12]=$(" Started: ")),t("span",ce,y(E.value),1)])):x("",!0),M.value?(o(),d("span",me,[s[13]||(s[13]=$(" Deadline: ")),t("span",ke,y(M.value),1)])):x("",!0)]),s[18]||(s[18]=t("hr",{class:"my-3 col-span-full"},null,-1)),t("div",fe,[t("button",{onClick:s[1]||(s[1]=w(_=>{var z;return c((z=u(a).task)==null?void 0:z.id)},["stop"])),class:"btn-2 py-0.5"},"Edit"),v(U,{to:{name:"TaskUserAssign",params:{id:(j=u(a).task)==null?void 0:j.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[2]||(s[2]=_=>_.stopPropagation())},{default:T(()=>s[14]||(s[14]=[t("i",{class:"fas fa-user-plus"},null,-1),$(" Assign Users ")])),_:1,__:[14]},8,["to"]),v(U,{to:k.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[3]||(s[3]=_=>_.stopPropagation())},{default:T(()=>s[15]||(s[15]=[t("i",{class:"fas fa-arrow-left"},null,-1),$(" Back ")])),_:1,__:[15]},8,["to"]),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:s[4]||(s[4]=w(()=>N("start-date"),["prevent"])),disabled:!!((q=C.value)!=null&&q.started_at)}," Set Started Date ",8,ye),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:s[5]||(s[5]=w(()=>N("finish-date"),["prevent"])),disabled:!!((O=C.value)!=null&&O.finished_at)}," Set Finish Date ",8,ve),t("div",xe,[m.value.length>0?(o(),D(U,{key:0,to:{name:"TaskShow",params:{id:(V=u(a).task)==null?void 0:V.id}},onClick:s[6]||(s[6]=_=>_.stopPropagation()),class:J(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":u(e).name=="TaskShow"}])},{default:T(()=>s[16]||(s[16]=[t("i",{class:"fal fa-list-ul"},null,-1),$(" Sub Tasks ")])),_:1,__:[16]},8,["to","class"])):x("",!0),v(U,{to:{name:"TaskReports",params:{id:(H=u(a).task)==null?void 0:H.id}},onClick:s[7]||(s[7]=_=>_.stopPropagation()),class:J(["py-1 btn-3",{"bg-blue-500 text-white":u(e).name=="TaskReports"}])},{default:T(()=>s[17]||(s[17]=[t("i",{class:"fal fa-file-alt"},null,-1),$(" Reports ")])),_:1,__:[17]},8,["to","class"])])])]),u(e).name=="TaskShow"?(o(),d("section",be,[v(Pt,{subTasks:m.value,"parent-id":u(e).params.id,"tree-level":u(a).task.level+1,onCreated:s[8]||(s[8]=_=>p(u(e).params.id)),onUpdated:s[9]||(s[9]=_=>p(u(e).params.id)),onUpdatePriority:s[10]||(s[10]=_=>p(u(e).params.id))},null,8,["subTasks","parent-id","tree-level"])])):(o(),d("section",ge,[v(st)]))],64)):u(a).loading?(o(),d("div",_e," Loading task details... ")):(o(),d("div",he,y(u(a).error),1))])])}}};export{Ae as default};
