import{f as Ct,g as St,r as h,x as d,q as et,c as o,o as n,a as e,d as Ft,j as _,t as a,m as I,b as P,F as y,e as w,k as B,v as Y,s as tt,O as we,n as Mt,l as Lt,z as jt,T as At}from"./index-BUxtDSZU.js";import{u as Rt}from"./kpi-y__g0r3P.js";const Ht={class:"max-w-7xl mx-auto px-4 py-6 space-y-6"},$t={class:"border rounded-2xl bg-white/80 backdrop-blur px-4 py-3 shadow-sm"},Gt={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},Tt={class:"space-y-1"},Et={class:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1"},Pt={class:"text-xs text-indigo-900"},Vt={class:"text-sm text-slate-600"},Dt={class:"font-medium text-slate-800"},Kt={class:"flex flex-wrap gap-2 text-xs mt-0.5"},Ut={key:0,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},zt={class:"ml-1 font-medium text-slate-800"},Ot={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},It={class:"ml-1 font-medium text-slate-800"},Bt={class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},Yt={key:0,class:"ml-1 inline-flex items-center gap-1"},qt={key:1,class:"ml-1 font-semibold text-slate-800"},Qt={class:"flex items-end gap-4"},Wt={class:"text-right"},Jt={class:"text-lg font-bold text-slate-900"},Xt={class:"text-slate-400"},Zt={class:"text-xs text-slate-500"},es={key:0},ts={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},ss={key:0,class:"p-4 text-sm font-bold text-slate-500"},ls=["innerHTML"],as={key:1,class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},os={class:"overflow-auto"},ns={class:"min-w-[980px] w-full text-sm"},rs={class:"bg-slate-50 sticky top-0 z-10"},is={class:"text-slate-700"},ds={class:"font-medium"},us={class:"text-[11px] text-slate-500 flex flex-col items-center"},cs={key:0,class:"mt-0.5 inline-flex items-center rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-medium text-blue-700 border border-blue-200"},xs={class:"bg-slate-100/80 border-t"},ms=["colspan"],ps={class:"px-3 py-2 text-center text-slate-500"},vs={class:"px-3 py-2 align-top"},_s={class:"font-medium text-slate-800"},bs={class:"mt-1 flex gap-1 text-[11px] text-slate-500"},fs=["disabled","onClick"],hs=["disabled","onClick"],ys=["disabled","onClick"],gs={class:"px-3 py-2 text-center text-slate-700"},ws={key:0,class:"flex items-center justify-center"},ks=["max","onUpdate:modelValue","onChange"],Ns={key:1,class:"text-slate-700 text-sm"},Cs={key:2,class:"text-slate-300 text-sm"},Ss={class:"bg-slate-50 border-t"},Fs={class:"px-3 py-2 text-center font-semibold text-slate-800"},Ms=["colspan"],Ls={class:"font-semibold text-slate-900"},js={class:"text-slate-500"},As={class:"mt-2"},Rs={class:"grid gap-4 lg:grid-cols-5"},Hs={key:0,class:"space-y-4 lg:col-span-3"},$s={class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2.5"},Gs={class:"text-sm font-semibold text-slate-800"},Ts={class:"flex items-center gap-2 text-[11px] text-slate-500"},Es=["onClick","disabled"],Ps=["onClick","disabled"],Vs=["onClick","disabled"],Ds={class:"overflow-auto"},Ks={class:"w-full text-sm"},Us={class:"px-3 py-2 text-center text-slate-500"},zs={class:"px-3 py-2"},Os={class:"font-medium text-slate-800"},Is={class:"px-3 py-2 text-center text-slate-700"},Bs={class:"px-3 py-2 text-center"},Ys=["max","onUpdate:modelValue","onChange"],qs={key:1,class:"text-slate-700 text-sm"},Qs={class:"bg-slate-50 border-t"},Ws={class:"px-3 py-2 text-center font-semibold text-slate-800"},Js={class:"px-3 py-2 text-center text-sm"},Xs={key:0,class:"border rounded-2xl bg-white shadow-sm"},Zs={class:"flex flex-wrap items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},el={class:"flex flex-wrap items-center gap-2 text-[11px] text-slate-500"},tl={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},sl={key:0,class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},ll={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},al={class:"p-4 space-y-4 max-h-[360px] overflow-y-auto"},ol={class:"flex flex-wrap gap-2 border-b border-slate-100 pb-3"},nl=["onClick"],rl={class:"space-y-4"},il={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},dl={class:"rounded-xl border bg-slate-50 p-3"},ul={class:"flex items-center justify-between"},cl={class:"text-[11px] px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200"},xl={class:"mt-1 text-sm font-semibold text-slate-900"},ml={class:"text-xs text-slate-500"},pl={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},vl={class:"rounded-xl border bg-slate-50 p-3"},_l={class:"flex items-center justify-between"},bl={class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-200"},fl={class:"mt-1 text-sm font-semibold text-slate-900"},hl={class:"text-xs text-slate-500"},yl={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},gl={class:"rounded-xl border bg-slate-50 p-3 sm:col-span-2"},wl={class:"flex items-center justify-between"},kl={class:"text-[11px] px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 border border-emerald-200"},Nl={class:"mt-1 text-sm font-semibold text-slate-900"},Cl={class:"text-xs text-slate-500"},Sl={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},Fl={class:"border-t pt-2 text-xs"},Ml={key:0,class:"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs space-y-2"},Ll={class:"grid grid-cols-2 gap-2"},jl={class:"font-medium text-slate-800"},Al={class:"font-medium text-slate-800"},Rl={class:"font-medium text-slate-800"},Hl={class:"font-medium text-slate-800"},$l={class:"font-medium text-slate-800"},Gl={class:"font-medium text-slate-800"},Tl={class:"font-medium text-slate-800"},El={class:"font-medium text-slate-800"},Pl={class:"font-medium text-slate-800"},Vl={key:1,class:"border rounded-2xl bg-white shadow-sm"},Dl={class:"flex items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},Kl={class:"text-[11px] text-slate-500"},Ul={class:"p-4 space-y-3"},zl={class:"max-h-96 overflow-auto border rounded-xl"},Ol={class:"min-w-full text-xs text-left"},Il={class:"px-2 py-2"},Bl={class:"font-semibold text-slate-700"},Yl={key:0,class:"mt-0.5 text-[11px] text-slate-400"},ql={class:"px-2 py-2 text-right"},Ql=["onClick"],Wl={key:2,class:"rounded-2xl bg-white border shadow-sm px-4 py-4 space-y-4"},Jl={class:"grid gap-4 md:grid-cols-3"},Xl={class:"space-y-3"},Zl={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},ea={key:0,class:"text-[11px] text-emerald-600"},ta={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},sa={class:"flex flex-wrap gap-1.5"},la=["onClick","disabled"],aa={key:1,class:"text-[11px] text-slate-400"},oa={class:"space-y-1"},na={class:"space-y-3"},ra={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},ia={key:0,class:"text-[11px] text-amber-600"},da={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},ua={class:"flex flex-wrap gap-1.5"},ca=["onClick","disabled"],xa={key:1,class:"text-[11px] text-slate-400"},ma={class:"space-y-1"},pa={class:"space-y-3"},va={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},_a={key:0,class:"text-[11px] text-sky-600"},ba={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 h-40 overflow-y-auto"},fa={class:"flex flex-wrap gap-1.5"},ha=["onClick","disabled"],ya={class:"space-y-1"},ga={class:"mt-2 flex flex-col gap-3 border-t pt-3 md:flex-row md:items-center md:justify-between"},wa={class:"text-sm text-slate-600"},ka={class:"text-slate-900"},Na={class:"text-slate-400"},Ca=["disabled"],Sa={class:"relative w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true"},Fa={class:"flex items-start justify-between gap-3"},Ma={class:"text-lg font-semibold text-slate-900"},La={class:"text-xs text-slate-500"},ja={key:0,class:"text-xs text-slate-400 mt-1"},Aa={class:"mt-5 space-y-4 text-sm text-slate-700"},Ra={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},Ha={key:0},$a={key:1,class:"text-slate-400"},Ga={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},Ta={key:0},Ea={key:1,class:"text-slate-400"},Pa={class:"mt-2 min-h-[40px] space-y-1 text-[13px] text-slate-600"},Va={key:0},Da={key:1,class:"text-slate-400"},Oa={__name:"KpiReviewForm",setup(Ka){const ne=Ct(),N=Rt(),re=St(),b=h({}),j=h({}),q=h(""),Q=h(""),W=h(""),V=h(null),J=h(null),K=h(!1),ke=h([]),X=h({}),A=h(null),ie=h(!1),de=d(()=>{var s;return((s=N.cycle)==null?void 0:s.groups_json)||[]}),Ne=s=>(s==null?void 0:s.id)==="personal"||/personal/i.test((s==null?void 0:s.label)||""),H=d(()=>de.value.find(Ne)||null),U=d(()=>de.value.filter(s=>!Ne(s))),st=(s,t)=>(s==null?void 0:s.label)||`Group ${t+1}`,lt=s=>/^hr\d*$/i.test(s)||s==="hr",Ce=s=>lt((s==null?void 0:s.key)||"")||(s==null?void 0:s.is_hr_lane)===!0,Se=d(()=>[...ke.value||[]].sort((s,t)=>(s.rank??999)-(t.rank??999))),ue=d(()=>Se.value.filter(Ce)),$=d(()=>Se.value.filter(s=>!Ce(s))),at=d(()=>$.value.find(s=>s.key===A.value)||null),ot=d(()=>{var s;return((s=at.value)==null?void 0:s.rank)??null}),nt=d(()=>{var s;return Number(((s=re==null?void 0:re.user)==null?void 0:s.id)||0)}),ce=d(()=>{const s=nt.value;if(!s)return null;const t=ue.value.find(r=>Number(r.assigned_user_id)===s);return t||ue.value.find(r=>r.can_current_user_review)||null}),R=d(()=>{var s;return((s=ce.value)==null?void 0:s.key)||null}),rt=d(()=>!!(ce.value&&ce.value.can_current_user_review)),F=d(()=>!!(ie.value||rt.value)),G=d(()=>!!A.value&&$.value.some(s=>s.key===A.value&&s.can_current_user_review)),Z=d(()=>F.value&&R.value?R.value:A.value),Fe=d(()=>!!(Z.value&&R.value&&Z.value===R.value));function xe(s){var r;return(((r=X.value)==null?void 0:r[s])||[])[0]||null}function Me(s,t){var i;const r=xe(s);return((i=r==null?void 0:r.marks)==null?void 0:i[t])??""}function Le(s){var r,i,x,u;if(R.value){const f=xe(R.value),k=(r=f==null?void 0:f.marks)==null?void 0:r[s];if(k!=null)return k}let t=null;for(const f of ue.value){const m=(((i=X.value)==null?void 0:i[f.key])||[])[0];if(!(!m||((x=m==null?void 0:m.marks)==null?void 0:x[s])==null)){if(!t){t=m;continue}m.submitted_at&&t.submitted_at&&m.submitted_at>t.submitted_at&&(t=m)}}return((u=t==null?void 0:t.marks)==null?void 0:u[s])??""}function me(s,t){const r=Number(b.value[s]??0);r<0&&(b.value[s]=0),r>Number(t)&&(b.value[s]=Number(t))}function ee(s,t,r){r==="zero"?b.value[s]=0:r==="half"?b.value[s]=Number(t)/2:r==="threeQuarter"?b.value[s]=Number((Number(t)*.75).toFixed(1)):r==="full"&&(b.value[s]=Number(t)),me(s,t)}function pe(s,t){s.items.forEach(r=>ee(r.id,r.max,t))}const z=d(()=>{let s=0,t=0;const r=H.value;r&&r.items.forEach(x=>{s+=Number(x.max||0);const u=Number(b.value[x.id]||0);t+=Math.min(Math.max(u,0),Number(x.max||0))});const i=s>0?t/s*100:0;return{max:Number(s.toFixed(2)),got:Number(t.toFixed(2)),percent:Number(i.toFixed(2))}}),it=d(()=>!!V.value&&typeof V.value=="object"),dt=d(()=>{var s;return((s=V.value)==null?void 0:s.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),ut=d(()=>{var s;return((s=V.value)==null?void 0:s.year)??null}),ct=d(()=>{var s;return((s=J.value)==null?void 0:s.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),xt=d(()=>{var s;return((s=J.value)==null?void 0:s.year)??null}),T=h("target"),ve=[{key:"target",label:"Annual Target"},{key:"performance",label:"Annual Performance"}],je=d(()=>{var s;return((s=V.value)==null?void 0:s.months_total_form)??0}),mt=d(()=>{var s;return((s=J.value)==null?void 0:s.months_total_form)??je.value}),p=d(()=>T.value==="target"?dt.value:ct.value),_e=d(()=>T.value==="target"?ut.value:xt.value),Ae=d(()=>T.value==="target"?je.value:mt.value),be=d(()=>{var s;return((s=ve.find(t=>t.key===T.value))==null?void 0:s.label)||"Annual Target"}),pt={target:"target",performance:"regular_activities_of_the_department"},vt=d(()=>{const s=pt[T.value];return s&&U.value.find(t=>t.id===s)||null}),_t=d(()=>{var s;return((s=vt.value)==null?void 0:s.label)||be.value}),bt=s=>{ve.some(t=>t.key===s)&&(T.value=s)};et(T,()=>{K.value=!1});const te=d(()=>{const s=X.value||{},t=$.value||[],r=[],i=Fe.value||F.value?1/0:ot.value??null,x=u=>{if(!u)return[];const f=[];if(Array.isArray(u))f.push(...u);else if(typeof u=="string"&&u.trim())f.push(u.trim());else return[];const k=new Set;return f.reduce((m,E)=>{const M=typeof E=="string"?E.trim():"";return!M||k.has(M)||(k.add(M),m.push(M)),m},[])};return t.forEach(u=>{const f=u.key;if(!f||i!=null&&(u.rank??999)>i)return;const k=s[f]||[];if(!Array.isArray(k)||!k.length)return;const m=k[0],E=x(m.strengths),M=x(m.gaps),O=x(m.suggestions);!E.length&&!M.length&&!O.length||r.push({key:f,lane:f,label:u.label||(m==null?void 0:m.lane_label)||f,reviewer_id:m.reviewer_id,reviewer_name:m.reviewer_name,strengths:E,gaps:M,suggestions:O,submitted_at:m.submitted_at??null})}),r}),ft=s=>{const t=new Set;return te.value.forEach(r=>{(Array.isArray(r[s])?r[s]:[]).forEach(x=>{const u=typeof x=="string"?x.trim():"";u&&t.add(u)})}),Array.from(t)},Re=s=>{if(!Array.isArray(s))return[];const t=new Set;return s.forEach(r=>{const i=typeof r=="string"?r.trim():"";i&&t.add(i)}),Array.from(t)},se=d(()=>Re(N.strengths)),le=d(()=>Re(N.gaps)),ae=d(()=>ft("suggestions"));h([]),h([]),h([]);const fe=h(!1),g=h(null);function ht(s){g.value=s,fe.value=!0}function he(){fe.value=!1,g.value=null}const He={strengths:q,gaps:Q,suggestions:W};function yt(s,t){const r=(t||"").trim();return r?s!=null&&s.trim()?`${s.trim()}
${r}`:r:s}const gt=d(()=>{const s={};let t=1;const r=H.value;return r&&r.items.forEach(i=>{s[i.id]=t++}),s}),wt=d(()=>Number(ne.params.employeeId)),kt=s=>{var t,r;if(j.value=s.employee,V.value=(s==null?void 0:s.annual_target_avg_marks)||null,J.value=(s==null?void 0:s.annual_performance_avg_marks)||null,ke.value=s.lanes||[],X.value=s.reviews_by_lane||{},ie.value=!!(((t=s==null?void 0:s.meta)==null?void 0:t.is_hr)??(s==null?void 0:s.hr)??!1),A.value=((r=$.value.find(i=>i.can_current_user_review))==null?void 0:r.key)||null,de.value.forEach(i=>i.items.forEach(x=>{b.value[x.id]==null&&(b.value[x.id]=0)})),A.value){const i=xe(A.value);i!=null&&i.marks&&Object.assign(b.value,i.marks)}F.value&&U.value.forEach(i=>{i.items.forEach(x=>{let u=R.value?Me(R.value,x.id):"";(u===""||u==null)&&(u=Le(x.id)),u!==""&&u!=null&&(b.value[x.id]=Number(u))})})};et(wt,async(s,t)=>{if(!s||t&&s===t)return;await N.fetchActiveCycle(s);const r=await N.fetchLanes(N.cycle.id,s);kt(r)},{immediate:!0});async function Nt(){const s=Z.value;if(!s){alert("Unable to determine reviewer lane.");return}R.value,await N.submitReview({cycle_id:N.cycle.id,employee_id:Number(ne.params.employeeId),reviewer_lane:s,marks:b.value,strengths:q.value,gaps:Q.value,suggestions:W.value}),alert("Submitted")}function C(s){const t=Number(s??0);return isNaN(t)?"0.00":t.toFixed(2)}function D(s,t){const r=Number(s??0),i=Number(t??0);return i>0?Math.round(r/i*100):0}function oe(s,t){const r=He[s];if(!r)return!1;const i=(r.value||"").split(`
`).map(u=>u.trim()).filter(Boolean),x=(t||"").trim();return x?i.includes(x):!1}function ye(s,t){const r=He[s];if(!r)return;const i=typeof t=="string"?t.trim():"";i&&(oe(s,i)||(r.value=yt(r.value,i)))}return(s,t)=>{var r,i,x,u,f,k,m,E,M,O,ge,$e,Ge,Te,Ee,Pe,Ve,De,Ke,Ue,ze,Oe,Ie,Be,Ye,qe,Qe,We,Je,Xe,Ze;return n(),o(y,null,[e("div",Ht,[e("header",$t,[e("div",Gt,[e("div",Tt,[e("div",Et,[t[5]||(t[5]=e("span",{class:"text-xs font-semibold text-indigo-700"},"KPI Cycle",-1)),e("span",Pt,a((r=I(N).cycle)==null?void 0:r.title),1)]),e("div",Vt,[e("div",Dt,a(((i=j.value)==null?void 0:i.name)||"Employee"),1),e("div",Kt,[(u=(x=j.value)==null?void 0:x.designation)!=null&&u.title?(n(),o("span",Ut,[t[6]||(t[6]=P(" Designation: ")),e("span",zt,a(j.value.designation.title),1)])):_("",!0),(k=(f=j.value)==null?void 0:f.department)!=null&&k.name?(n(),o("span",Ot,[t[7]||(t[7]=P(" Department: ")),e("span",It,a(j.value.department.name),1)])):_("",!0),e("span",Bt,[t[9]||(t[9]=P(" Reviewing as: ")),Fe.value?(n(),o("span",Yt,t[8]||(t[8]=[e("span",{class:"font-semibold text-emerald-700"},"HR",-1),e("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," HR mode ",-1)]))):(n(),o("span",qt,a(Z.value||"No lane"),1))])])])]),e("div",Qt,[e("div",Wt,[t[10]||(t[10]=e("div",{class:"text-[11px] uppercase tracking-wide text-slate-500"}," Personal group total ",-1)),e("div",Jt,[P(a(z.value.got.toFixed(2))+" ",1),e("span",Xt,"/ "+a(z.value.max.toFixed(2)),1)]),e("div",Zt,a(z.value.percent.toFixed(2))+"% achieved ",1)]),ie.value?(n(),o("button",{key:0,onClick:t[0]||(t[0]=l=>I(N).submitFinalResult(I(N).cycle.id,I(ne).params.employeeId)),class:"inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-medium text-white shadow hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-300 focus:outline-none"},t[11]||(t[11]=[e("span",null,"Finalize & Lock",-1)]))):_("",!0)])])]),(m=j.value)!=null&&m.active_criteria?(n(),o("div",es,[e("section",ts,[t[12]||(t[12]=e("div",{class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2"},[e("div",{class:"text-sm font-semibold text-slate-800"},"কার্যসম্পাদন বিষয়")],-1)),((M=(E=j.value)==null?void 0:E.active_criteria)==null?void 0:M.length)===0?(n(),o("div",ss," -- ")):_("",!0),(n(!0),o(y,null,w(j.value.active_criteria,l=>(n(),o("div",{class:"p-4 text-sm text-slate-700",key:l.id},[e("div",{class:"print:block richtext print:break-inside-avoid",innerHTML:l==null?void 0:l.description},null,8,ls)]))),128))])])):_("",!0),I(N).cycle&&H.value?(n(),o("section",as,[t[18]||(t[18]=e("div",{class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Personal Evaluation"),e("div",{class:"text-xs text-slate-500"},"Fill only your lane; others appear as read-only.")],-1)),e("div",os,[e("table",ns,[e("thead",rs,[e("tr",is,[t[13]||(t[13]=e("th",{class:"px-3 py-2 w-[40px] text-center font-medium"},"#",-1)),t[14]||(t[14]=e("th",{class:"text-left px-3 py-2 w-[20%] font-medium"},"মূল্যায়নের বিষয় (Personal)",-1)),t[15]||(t[15]=e("th",{class:"px-3 py-2 text-center font-medium"},"Max",-1)),(n(!0),o(y,null,w($.value,l=>(n(),o("th",{key:l.key,class:"px-3 py-2 text-center font-medium"},[e("div",ds,a(l.label||l.key),1),e("div",us,[e("span",null,a(l.assigned_user_name||"-"),1),l.key===A.value&&l.can_current_user_review?(n(),o("span",cs," You can edit ")):_("",!0)])]))),128))])]),e("tbody",null,[e("tr",xs,[e("td",{colspan:3+$.value.length,class:"px-3 py-2 font-medium text-slate-800"},a(H.value.label||"Personal"),9,ms)]),(n(!0),o(y,null,w(H.value.items,l=>(n(),o("tr",{key:l.id,class:"border-t hover:bg-slate-50/60"},[e("td",ps,a(gt.value[l.id]),1),e("td",vs,[e("div",_s,a(l.label),1),e("div",bs,[e("button",{class:"border rounded px-1.5 py-0.5 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!G.value,onClick:c=>G.value&&ee(l.id,l.max,"half")}," ½ ",8,fs),e("button",{class:"border rounded px-1.5 py-0.5 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!G.value,onClick:c=>G.value&&ee(l.id,l.max,"threeQuarter")}," ¾ ",8,hs),e("button",{class:"border rounded px-1.5 py-0.5 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!G.value,onClick:c=>G.value&&ee(l.id,l.max,"full")}," Full ",8,ys)])]),e("td",gs,a(l.max),1),(n(!0),o(y,null,w($.value,c=>(n(),o("td",{key:c.key,class:"px-3 py-2 text-center"},[c.key===A.value&&c.can_current_user_review?(n(),o("div",ws,[B(e("input",{type:"number",step:"0.1",min:"0",max:l.max,"onUpdate:modelValue":v=>b.value[l.id]=v,onChange:v=>me(l.id,l.max),inputmode:"decimal",class:"w-24 text-right rounded-lg border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200"},null,40,ks),[[Y,b.value[l.id],void 0,{number:!0}]])])):c.can_view_marks?(n(),o("div",Ns,a(Me(c.key,l.id)),1)):(n(),o("div",Cs,"—"))]))),128))]))),128)),e("tr",Ss,[t[16]||(t[16]=e("td",null,null,-1)),t[17]||(t[17]=e("td",{class:"px-3 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),e("td",Fs,a(H.value.items.reduce((l,c)=>l+Number(c.max||0),0).toFixed(2)),1),e("td",{colspan:$.value.length,class:"px-3 py-2 text-center text-sm"},[e("span",Ls,a(H.value.items.reduce((l,c)=>{const v=Number(b.value[c.id]||0);return l+Math.min(Math.max(v,0),Number(c.max||0))},0).toFixed(2)),1),e("span",js," / "+a(H.value.items.reduce((l,c)=>l+Number(c.max||0),0).toFixed(2)),1)],8,Ms)])])])])])):_("",!0),e("section",As,[e("div",Rs,[U.value.length?(n(),o("div",Hs,[(n(!0),o(y,null,w(U.value,(l,c)=>(n(),o("div",{key:c,class:"overflow-hidden border rounded-2xl bg-white shadow-sm"},[e("div",$s,[e("div",Gs," Group "+a(c+1)+" — "+a(st(l,c)),1),e("div",Ts,[t[19]||(t[19]=e("span",null,"Quick fill:",-1)),e("button",{class:"rounded border px-1.5 py-0.5 hover:bg-slate-100 disabled:opacity-40",onClick:v=>pe(l,"half"),disabled:!F.value}," All ½ ",8,Es),e("button",{class:"rounded border px-1.5 py-0.5 hover:bg-slate-100 disabled:opacity-40",onClick:v=>pe(l,"threeQuarter"),disabled:!F.value}," All ¾ ",8,Ps),e("button",{class:"rounded border px-1.5 py-0.5 hover:bg-slate-100 disabled:opacity-40",onClick:v=>pe(l,"full"),disabled:!F.value}," All Full ",8,Vs)])]),e("div",Ds,[e("table",Ks,[t[22]||(t[22]=e("thead",{class:"sticky top-0 bg-white z-10"},[e("tr",{class:"bg-slate-100 text-slate-700"},[e("th",{class:"px-3 py-2 w-[40px] text-center font-medium"},"#"),e("th",{class:"text-left px-3 py-2 w-[30%] font-medium"},"Item"),e("th",{class:"px-3 py-2 text-center w-[40px] font-medium"},"Max"),e("th",{class:"px-3 py-2 text-center w-[80px] font-medium"},"HR Score")])],-1)),e("tbody",null,[(n(!0),o(y,null,w(l.items,(v,S)=>(n(),o("tr",{key:v.id,class:"border-t hover:bg-slate-50/60"},[e("td",Us,a(S+1),1),e("td",zs,[e("div",Os,a(v.label),1)]),e("td",Is,a(v.max),1),e("td",Bs,[F.value?B((n(),o("input",{key:0,type:"number",step:"0.1",min:"0",max:v.max,"onUpdate:modelValue":L=>b.value[v.id]=L,onChange:L=>me(v.id,v.max),inputmode:"decimal",class:"w-24 text-right rounded-lg border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200"},null,40,Ys)),[[Y,b.value[v.id],void 0,{number:!0}]]):(n(),o("p",qs,a(Le(v.id)||"—"),1))])]))),128)),e("tr",Qs,[t[20]||(t[20]=e("td",null,null,-1)),t[21]||(t[21]=e("td",{class:"px-3 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),e("td",Ws,a(l.items.reduce((v,S)=>v+Number(S.max||0),0).toFixed(2)),1),e("td",Js,a(l.items.reduce((v,S)=>{const L=Number(b.value[S.id]||0);return v+Math.min(Math.max(L,0),Number(S.max||0))},0).toFixed(2)),1)])])])])]))),128))])):_("",!0),e("aside",{class:tt(["space-y-4",[U.value.length===0?"lg:col-span-full":"lg:col-span-2"]])},[it.value&&F.value?(n(),o("section",Xs,[e("header",Zs,[t[23]||(t[23]=e("span",null,"Annual Summary",-1)),e("div",el,[e("span",tl,a(be.value),1),_e.value?(n(),o("span",sl," Year "+a(_e.value),1)):_("",!0),e("span",ll,a(Ae.value)+" month(s) ",1)])]),e("div",al,[e("div",ol,[(n(),o(y,null,w(ve,l=>e("button",{key:l.key,type:"button",onClick:c=>bt(l.key),class:tt(["px-3 py-1 rounded-full text-xs font-semibold transition",T.value===l.key?"bg-slate-900 text-white shadow":"border border-slate-200 text-slate-700 bg-white hover:border-slate-400"])},a(l.label),11,nl)),64))]),e("div",rl,[e("div",il,[e("div",dl,[e("div",ul,[t[24]||(t[24]=e("span",{class:"text-xs font-medium text-slate-600"},"Incharge",-1)),e("span",cl,a(D((O=p.value.per_scored_month)==null?void 0:O.incharge,(ge=p.value.per_scored_month)==null?void 0:ge.max))+"% ",1)]),e("div",xl,[P(a(C(($e=p.value.per_scored_month)==null?void 0:$e.incharge))+" ",1),e("span",ml,"/ "+a(C((Ge=p.value.per_scored_month)==null?void 0:Ge.max)),1)]),e("div",pl,[e("div",{class:"h-2 bg-blue-500",style:we({width:D((Te=p.value.per_scored_month)==null?void 0:Te.incharge,(Ee=p.value.per_scored_month)==null?void 0:Ee.max)+"%"})},null,4)])]),e("div",vl,[e("div",_l,[t[25]||(t[25]=e("span",{class:"text-xs font-medium text-slate-600"},"Coordinator",-1)),e("span",bl,a(D((Pe=p.value.per_scored_month)==null?void 0:Pe.coordinator,(Ve=p.value.per_scored_month)==null?void 0:Ve.max))+"% ",1)]),e("div",fl,[P(a(C((De=p.value.per_scored_month)==null?void 0:De.coordinator))+" ",1),e("span",hl,"/ "+a(C((Ke=p.value.per_scored_month)==null?void 0:Ke.max)),1)]),e("div",yl,[e("div",{class:"h-2 bg-violet-500",style:we({width:D((Ue=p.value.per_scored_month)==null?void 0:Ue.coordinator,(ze=p.value.per_scored_month)==null?void 0:ze.max)+"%"})},null,4)])]),e("div",gl,[e("div",wl,[t[26]||(t[26]=e("span",{class:"text-xs font-medium text-slate-600"},"Final",-1)),e("span",kl,a(D((Oe=p.value.per_form_yearly)==null?void 0:Oe.final,(Ie=p.value.per_scored_month)==null?void 0:Ie.max))+"% ",1)]),e("div",Nl,[P(a(C((Be=p.value.per_form_yearly)==null?void 0:Be.final))+" ",1),e("span",Cl,"/ "+a(C((Ye=p.value.per_scored_month)==null?void 0:Ye.max)),1)]),e("div",Sl,[e("div",{class:"h-2 bg-emerald-500",style:we({width:D((qe=p.value.per_form_yearly)==null?void 0:qe.final,(Qe=p.value.per_scored_month)==null?void 0:Qe.max)+"%"})},null,4)])])]),e("div",Fl,[e("button",{class:"text-xs px-3 py-1.5 rounded-md border hover:bg-slate-50",onClick:t[1]||(t[1]=l=>K.value=!K.value)},a(K.value?"Hide details":"Show "+be.value+" details"),1),K.value?(n(),o("div",Ml,[e("div",Ll,[t[27]||(t[27]=e("div",{class:"text-slate-500"},"Year",-1)),e("div",jl,a(_e.value||"-"),1),t[28]||(t[28]=e("div",{class:"text-slate-500"},"Months counted",-1)),e("div",Al,a(Ae.value),1),t[29]||(t[29]=e("div",{class:"text-slate-500"},"Group",-1)),e("div",Rl,a(_t.value),1),t[30]||(t[30]=e("div",{class:"text-slate-500"},"Max (denominator)",-1)),e("div",Hl,a(C((We=p.value.per_scored_month)==null?void 0:We.max)),1),t[31]||(t[31]=e("div",{class:"text-slate-500"},"Incharge avg",-1)),e("div",$l,a(C((Je=p.value.per_form_yearly)==null?void 0:Je.incharge)),1),t[32]||(t[32]=e("div",{class:"text-slate-500"},"Coordinator avg",-1)),e("div",Gl,a(C((Xe=p.value.per_form_yearly)==null?void 0:Xe.coordinator)),1),t[33]||(t[33]=e("div",{class:"text-slate-500"},"Final avg",-1)),e("div",Tl,a(C((Ze=p.value.per_form_yearly)==null?void 0:Ze.final)),1),t[34]||(t[34]=e("div",{class:"text-slate-500"},"Percent (simple)",-1)),e("div",El,a(C(p.value.percent_simple))+"% ",1),t[35]||(t[35]=e("div",{class:"text-slate-500"},"Percent (weighted)",-1)),e("div",Pl,a(C(p.value.percent_weighted))+"% ",1)])])):_("",!0)])])])])):_("",!0),te.value.length?(n(),o("section",Vl,[e("header",Dl,[t[36]||(t[36]=e("span",null,"Review Comments",-1)),e("span",Kl,a(te.value.length)+" lane(s) ",1)]),e("div",Ul,[e("div",zl,[e("table",Ol,[t[38]||(t[38]=e("thead",{class:"text-[11px] text-slate-600 uppercase tracking-wide bg-slate-50"},[e("tr",null,[e("th",{class:"px-2 py-2 w-[140px]"},"Lane"),e("th",{class:"px-2 py-2 text-right"},"Details")])],-1)),e("tbody",null,[(n(!0),o(y,null,w(te.value,l=>(n(),o("tr",{key:l.key,class:"border-t hover:bg-slate-50/60 align-top"},[e("td",Il,[e("div",Bl,a(l.label),1),l.submitted_at?(n(),o("div",Yl,a(new Date(l.submitted_at).toLocaleDateString()),1)):_("",!0)]),e("td",ql,[e("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:c=>ht(l)},t[37]||(t[37]=[e("span",null,"View comments",-1),e("span",{class:"text-[10px] text-slate-400"},"Strengths · Gaps · Suggestions",-1)]),8,Ql)])]))),128))])])])])])):_("",!0)],2)])]),G.value||F.value?(n(),o("section",Wl,[t[45]||(t[45]=Mt('<header class="flex items-center justify-between mb-1"><div><h2 class="text-sm font-semibold text-slate-800">Overall Review Notes</h2><p class="text-[11px] text-slate-500"> Use saved hints or write your own detailed comments. </p></div><div class="hidden md:flex items-center gap-2 text-[11px] text-slate-500"><span class="inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 border border-emerald-100"><span class="text-xs">●</span> Strengths </span><span class="inline-flex items-center gap-1 rounded-full bg-amber-50 px-2 py-0.5 border border-amber-100"><span class="text-xs">●</span> Gaps </span><span class="inline-flex items-center gap-1 rounded-full bg-sky-50 px-2 py-0.5 border border-sky-100"><span class="text-xs">●</span> Suggestions </span></div></header>',1)),e("div",Jl,[e("div",Xl,[e("header",Zl,[t[39]||(t[39]=e("div",{class:"flex items-center gap-1"},[e("span",{class:"text-emerald-500 text-base leading-none"},"★"),e("span",null,"Strengths")],-1)),se.value.length?(n(),o("span",ea,a(se.value.length)+" saved hint(s) ",1)):_("",!0)]),se.value.length?(n(),o("div",ta,[e("div",sa,[(n(!0),o(y,null,w(se.value,l=>(n(),o("button",{key:l,type:"button",onClick:c=>ye("strengths",l),disabled:oe("strengths",l),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-800 disabled:opacity-40 disabled:cursor-not-allowed"},a(l),9,la))),128))])])):(n(),o("p",aa," No historical strengths yet. Write your own notes below. ")),e("div",oa,[t[40]||(t[40]=e("label",{class:"text-[11px] font-medium text-slate-500"}," Key Strength(s) ",-1)),B(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=l=>q.value=l),placeholder:"e.g. Strong ownership, proactive problem solving…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[Y,q.value]])])]),e("div",na,[e("header",ra,[t[41]||(t[41]=e("div",{class:"flex items-center gap-1"},[e("span",{class:"text-amber-500 text-base leading-none"},"!"),e("span",null,"Gaps")],-1)),le.value.length?(n(),o("span",ia,a(le.value.length)+" saved hint(s) ",1)):_("",!0)]),le.value.length?(n(),o("div",da,[e("div",ua,[(n(!0),o(y,null,w(le.value,l=>(n(),o("button",{key:l,type:"button",onClick:c=>ye("gaps",l),disabled:oe("gaps",l),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-amber-300 hover:bg-amber-50 hover:text-amber-800 disabled:opacity-40 disabled:cursor-not-allowed"},a(l),9,ca))),128))])])):(n(),o("p",xa,"No historical gaps yet.")),e("div",ma,[t[42]||(t[42]=e("label",{class:"text-[11px] font-medium text-slate-500"},"GAP(s)",-1)),B(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=l=>Q.value=l),placeholder:"e.g. Needs improvement in documentation, communication…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-amber-200"},null,512),[[Y,Q.value]])])]),e("div",pa,[e("header",va,[t[43]||(t[43]=e("div",{class:"flex items-center gap-1"},[e("span",{class:"text-sky-500 text-base leading-none"},"✱"),e("span",null,"Suggestions / Training")],-1)),ae.value.length?(n(),o("span",_a,a(ae.value.length)+" common suggestion(s) ",1)):_("",!0)]),ae.value.length?(n(),o("div",ba,[e("div",fa,[(n(!0),o(y,null,w(ae.value,l=>(n(),o("button",{key:l,type:"button",onClick:c=>ye("suggestions",l),disabled:oe("suggestions",l),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-sky-300 hover:bg-sky-50 hover:text-sky-800 disabled:opacity-40 disabled:cursor-not-allowed"},a(l),9,ha))),128))])])):_("",!0),e("div",ya,[t[44]||(t[44]=e("label",{class:"text-[11px] font-medium text-slate-500"}," Suggestions / Development plan ",-1)),B(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=l=>W.value=l),placeholder:"Specific actions, training plans, timeline and expectations…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-sky-200"},null,512),[[Y,W.value]])])])])])):_("",!0),e("div",ga,[e("div",wa,[t[46]||(t[46]=P(" My (Personal) Total: ")),e("b",ka,a(z.value.got.toFixed(2)),1),e("span",Na,"/ "+a(z.value.max.toFixed(2)),1)]),e("button",{onClick:Nt,disabled:!(F.value||G.value),class:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-emerald-700 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-emerald-300"}," Submit ",8,Ca)])]),Ft(At,{name:"fade-scale"},{default:Lt(()=>{var l,c,v;return[fe.value&&g.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:jt(he,["escape","window"])},[e("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:he}),e("div",Sa,[e("div",Fa,[e("div",null,[e("p",Ma,a(g.value.label),1),e("p",La," Lane: "+a(g.value.lane)+" - Reviewed by "+a(g.value.reviewer_name||"––"),1),g.value.submitted_at?(n(),o("p",ja,a(new Date(g.value.submitted_at).toLocaleString()),1)):_("",!0)]),e("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:he}," Close ")]),e("div",Aa,[e("div",null,[t[47]||(t[47]=e("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[e("span",null,"Strengths")],-1)),e("div",Ra,[(l=g.value.strengths)!=null&&l.length?(n(),o("div",Ha,[(n(!0),o(y,null,w(g.value.strengths,(S,L)=>(n(),o("p",{key:"modal-strength-"+L}," - "+a(S),1))),128))])):(n(),o("p",$a,"No strengths entered."))])]),e("div",null,[t[48]||(t[48]=e("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[e("span",null,"Gaps")],-1)),e("div",Ga,[(c=g.value.gaps)!=null&&c.length?(n(),o("div",Ta,[(n(!0),o(y,null,w(g.value.gaps,(S,L)=>(n(),o("p",{key:"modal-gap-"+L}," - "+a(S),1))),128))])):(n(),o("p",Ea,"No gaps recorded."))])]),e("div",null,[t[49]||(t[49]=e("div",{class:"flex items-center justify-between text-xs font-semibold text-slate-500 uppercase"},[e("span",null,"Suggestions")],-1)),e("div",Pa,[(v=g.value.suggestions)!=null&&v.length?(n(),o("div",Va,[(n(!0),o(y,null,w(g.value.suggestions,(S,L)=>(n(),o("p",{key:"modal-sug-"+L}," - "+a(S),1))),128))])):(n(),o("p",Da,"No suggestions provided."))])])])])],32)):_("",!0)]}),_:1})],64)}}};export{Oa as default};
