import{x as z,c as r,o as n,_ as Ve,r as w,h as _e,q as Le,k as c,a as e,j as L,F as B,e as H,t as m,n as E,s as V,d as h,M as te,b as S,m as M,A as ge,w as D,E as ve,p as Fe,l as re,v as He,P as xe,Q as De,R as Je,y as ze,g as Ge,f as Xe,u as Ze}from"./index-CwNWcunH.js";import{_ as We}from"./TextEditor-DCQSOR3n.js";import{s as Ue,_ as et}from"./TaskAddForm-DO8kfPxi.js";import{u as Ye}from"./useCommentStore-D3jptbka.js";import{O as Z}from"./OverlyModal-DxbtJxqQ.js";import{L as $e}from"./LoaderView-BEo0GtN4.js";import{_ as tt}from"./ShareComponent-Dxvzg0F0.js";import{_ as Pe}from"./DepartmentChip-D44MKseH.js";import{_ as fe}from"./DescriptionView-BVD-vr1Y.js";import{i as Ke,f as he,a as st,_ as nt,b as rt}from"./TaskTableRow-BnXQOITj.js";import{b as ot,r as at,c as lt,f as we,d as it,s as dt}from"./requirement-B8XeSusl.js";import{_ as ut}from"./AttachmentPreview-S9JAZGSt.js";import{_ as pe}from"./UserChip-BnlCIz4T.js";import{b as ie,c as Qe}from"./datetime-y2WWmmYq.js";import{u as mt}from"./useTaskStore-DyWTQCYc.js";import{_ as ct}from"./TaskSelectionInput-vH_LnHI6.js";import{_ as pt}from"./TaskEditForm-BFMzQp9F.js";import{_ as vt}from"./TaskUserAssignForm-BYHpL-6W.js";import{T as ke}from"./TextWithHr-WGQ65iaF.js";import{c as ft}from"./dom-Bic1TNqD.js";import{_ as bt}from"./ApproveAndReject-KDnj50kh.js";import"./RequiredIcon-nWDf1IPI.js";import"./company-BaLerlOt.js";import"./CompanyDepartmentSelectInput-CNYuKU2Q.js";import"./SelectDropdown-25hgVMrU.js";import"./SectionLoading-B3HZSMpa.js";import"./TaskUrgencyInput-DTTnK4Ll.js";import"./TaskUrgentBadge-BpbYnRUa.js";import"./TaskTitle-ChWKWYpn.js";import"./TaskStatus-CcWvnUVe.js";import"./TaskIsClosedBadge-DZxeXD5W.js";import"./user-ZXw1wvgy.js";import"./tags-O6zjjA6w.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-BaOpbx7I.js";function xt(d){const v=new DOMParser().parseFromString(d,"text/html"),p=/#(\d+)/g;function u(t){t.childNodes.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){const f=i.textContent.replace(p,(g,C)=>`<a href="/requirement-tasks/${C}" class="text-pink-600 hover:underline font-bold">${g}</a>`);if(f!==i.textContent){const g=document.createElement("span");g.innerHTML=f,i.replaceWith(...g.childNodes)}}else u(i)})}return u(v.body),v.body.innerHTML}function gt(d){const v=new DOMParser().parseFromString(d,"text/html"),p=/(https?:\/\/[^\s]+)/g;function u(t){t.childNodes.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){const f=i.textContent.replace(p,g=>`<a href="${g}" target="_blank" class="text-blue-600 hover:underline">
            ${g}
            <i class="fas fa-external-link text-xs text-blue-600"></i>
          </a>`);if(f!==i.textContent){const g=document.createElement("span");g.innerHTML=f,i.replaceWith(...g.childNodes)}}else u(i)})}return u(v.body),v.body.innerHTML}const yt=["innerHTML"],ye={__name:"HTMLTextBody",props:{message:{type:String,required:!0}},setup(d){const $=d,v=z(()=>gt(xt($.message)));return(p,u)=>(n(),r("div",{class:"prose prose-sm max-w-none leading-loose text-sm",innerHTML:v.value},null,8,yt))}},_t={class:"space-y-4"},kt={key:0,class:"space-y-2"},ht={class:"text-xs opacity-80"},wt=["onClick"],$t={class:"space-y-4"},qt={key:0,class:"text-sm text-gray-500"},Ct={key:1,class:"text-sm text-gray-500"},Tt=["id"],jt={key:0,class:"shrink-0 mt-2"},At={class:"bg-inherit bubble-inner px-4 py-3 rounded-md"},Rt=["onClick"],St={class:"flex items-center gap-1 mb-1 font-bold text-gray-600"},Ot=["innerHTML"],It={class:"text-sm font-bold text-gray-800"},Mt={class:"text-xs text-gray-400"},Nt={key:1,class:"mt-3 pt-2 border-t border-dashed border-gray-200"},Et={class:"flex flex-wrap gap-2 items-center"},Lt=["title"],Dt={key:0,class:"fas fa-check-circle text-[10px]"},Ut={key:0,class:"mt-2 border rounded border-dashed p-2 text-center flex flex-col items-center gap-2 bg-yellow-50 animate-pulse"},Pt=["onClick"],Bt=["onClick"],Vt=["onClick"],Ft={key:2,class:"mt-2 space-y-1"},Ht={key:1,class:"shrink-0 mt-2"},zt={class:"flex items-center justify-between gap-2"},Gt={class:"flex items-center gap-2"},Wt={class:"text-sm font-semibold text-gray-700"},Yt={key:0,class:"flex items-center gap-2 px-3 py-1 bg-indigo-50 border border-indigo-100 rounded-full animate-pulse"},Kt={class:"text-[11px] text-indigo-700 font-medium"},Qt={class:"font-bold underline"},Jt={class:"flex items-center justify-end gap-2"},Xt=["disabled"],Zt={key:0,class:"text-xs text-red-600"},es={class:"bg-white rounded-2xl w-full p-5 space-y-4"},ts={class:"rounded-xl bg-slate-50 border border-slate-100 p-3 text-sm text-gray-700 max-h-40 overflow-auto"},ss=["innerHTML"],ns={__name:"CommentBox",props:{commentableType:{type:String,required:!0},commentableId:{type:[Number,String],required:!0},currentUser:{type:Object,required:!0},mentionableUsers:{type:Array,default:()=>[]},mentionableTasks:{type:Array,default:()=>[]},replyToId:{type:[Number,String],default:null}},setup(d){const $=d,v=w(!1),p=w(null),u=b=>{p.value=b,v.value=!0},t=()=>{v.value=!1,p.value=null},i=async()=>{if(!p.value)return;const b=p.value.id;t(),await ne(b)},f=w([]),g=w({}),C=b=>{b&&f.value.push({id:Date.now()+Math.random().toString(36).substr(2,9),message:b,time:new Date().toISOString()})},s=(b,x)=>{!b||!x||(g.value[b]||(g.value[b]=[]),g.value[b].push(x))},a=b=>{g.value[b]=[]},l=Ye(),y=z(()=>l.comments),k=z(()=>l.loading),q=z(()=>l.error),T=w(""),N=w(!1),j=w(null),A=w(null),U=w(null),G=w(!1),ee=b=>{var x;j.value=b,(x=A.value)==null||x.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{var P;(P=U.value)==null||P.focus()},100)},W=()=>{j.value=null},oe=b=>{b&&ge(()=>{const x=document.getElementById(`comment-${b}`);x&&(x.scrollIntoView({behavior:"smooth",block:"center"}),x.classList.add("ring-2","ring-indigo-400","ring-offset-2"),setTimeout(()=>{x.classList.remove("ring-2","ring-indigo-400","ring-offset-2")},2e3))})},R=async()=>{await l.fetchComments({commentable_type:$.commentableType,commentable_id:$.commentableId})},se=async()=>{if(!(!T.value||!Ue(String(T.value)).trim())){N.value=!0;try{const b=j.value;if(await l.createComment({commentable_type:$.commentableType,commentable_id:Number($.commentableId),user_id:$.currentUser.id,message:T.value,parent_id:(b==null?void 0:b.id)||null}),b&&J(b)&&!X(b))try{await l.acknowledgeComment(b.id)}catch(x){console.error("Auto-acknowledge error:",x)}T.value="",j.value=null}catch(b){C(b.message)}finally{N.value=!1}}},ne=async b=>{var x,P;a(b);try{await l.deleteComment(b)}catch(K){s(b,(P=(x=K.response)==null?void 0:x.data)==null?void 0:P.message)}};_e(R),Le(()=>[$.commentableType,$.commentableId,$.replyToId],()=>{G.value=!1,R()}),Le(()=>[y.value,$.replyToId],([b,x])=>{if(x&&!G.value&&b.length>0){const P=b.find(K=>K.id==x);P&&(ee(P),oe(x),G.value=!0)}},{immediate:!0});const Q=b=>b?new Date(b).toLocaleString():"",I=b=>(b==null?void 0:b.user_id)===$.currentUser.id,o=b=>(b==null?void 0:b.user_id)===$.currentUser.id,J=b=>{var x;return(x=b.mentions)==null?void 0:x.find(P=>P.user_id==$.currentUser.id)},X=b=>{const x=J(b);return x&&x.acknowledged_at};return(b,x)=>{var P,K;return n(),r("div",_t,[f.value.length?(n(),r("div",kt,[(n(!0),r(B,null,H(f.value,_=>(n(),r("div",{key:_.id,class:"rounded-xl border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-700 flex items-start justify-between gap-3"},[e("div",null,[x[1]||(x[1]=e("p",{class:"font-semibold"},"Error",-1)),e("p",ht,m(_.message),1)]),e("button",{class:"text-xs text-red-500 hover:underline",onClick:de=>f.value=f.value.filter(ae=>ae.id!==_.id)}," Dismiss ",8,wt)]))),128))])):c("",!0),e("div",$t,[k.value&&E(l).action=="fetching"?(n(),r("div",qt," Loading comments... ")):y.value.length?c("",!0):(n(),r("div",Ct,"No comments yet.")),(n(!0),r(B,null,H(y.value,_=>{var de,ae,me,ce;return n(),r("div",{key:_.id,id:`comment-${_.id}`,class:V(["flex gap-3 transition-all duration-500 rounded-lg",o(_)?"justify-end":"justify-start"])},[o(_)?c("",!0):(n(),r("div",jt,[h(te,{user:_.user},null,8,["user"])])),e("div",{class:V(["group relative min-w-[25%] max-w-[90%] rounded-md shadow border bubble-arrow",o(_)?"bubble-right bg-indigo-50 border-indigo-100":"bubble-left bg-white border-gray-100"])},[e("div",At,[_.parent?(n(),r("div",{key:0,class:"mb-3 p-2 bg-black/5 rounded border-l-4 border-indigo-300 text-xs opacity-70 cursor-pointer hover:bg-black/10 transition-colors",title:"Click to see original message",onClick:F=>oe(_.parent_id)},[e("div",St,[x[2]||(x[2]=e("i",{class:"fas fa-reply scale-x-[-1] mr-1"},null,-1)),S(" Replying to "+m(((de=_.parent.user)==null?void 0:de.name)||"Deleted User"),1)]),e("div",{class:"line-clamp-2 italic",innerHTML:_.parent.message},null,8,Ot)],8,Rt)):c("",!0),e("div",{class:V(["flex items-center gap-2 mb-2 pb-1 border-b border-dashed",o(_)?"justify-end":"justify-start"])},[e("p",It,m(o(_)?"You":((ae=_.user)==null?void 0:ae.name)||"Unknown"),1),x[3]||(x[3]=e("span",{class:"text-xs text-gray-400"},"•",-1)),e("p",Mt,m(Q(_.created_at)),1)],2),h(ye,{message:_.message},null,8,["message"]),(me=_.mentions)!=null&&me.length?(n(),r("div",Nt,[e("div",Et,[x[4]||(x[4]=e("span",{class:"text-[10px] text-gray-400 uppercase font-semibold"},"Mentions:",-1)),(n(!0),r(B,null,H(_.mentions,F=>{var le;return n(),r("div",{key:F.id,class:"flex items-center gap-1 group/mention"},[e("div",{class:V(["flex items-center gap-1.5 px-1 py-0.5 rounded-full text-xs box-border border transition cursor-default",F.acknowledged_at?"bg-green-50 border-green-200 text-green-700":"bg-gray-50 border-gray-200 text-gray-500"]),title:F.acknowledged_at?`Acknowledged at ${Q(F.acknowledged_at)}`:"Not acknowledged yet"},[h(te,{user:F.user,size:"2xsmall"},null,8,["user"]),e("span",null,m((le=F.user)==null?void 0:le.name),1),F.acknowledged_at?(n(),r("i",Dt)):c("",!0)],10,Lt)])}),128))]),J(_)&&!X(_)?(n(),r("div",Ut,[x[6]||(x[6]=e("div",{class:"flex items-center gap-2 text-sm text-gray-700 font-medium font-bengali"},[e("i",{class:"fas fa-info-circle text-orange-400"}),e("span",null,"You have been mentioned")],-1)),e("button",{onClick:F=>ee(_),class:"flex items-center gap-2 px-3 py-1.5 bg-sky-600 hover:bg-sky-700 text-white text-xs font-semibold rounded-lg transition shadow-sm"},x[5]||(x[5]=[e("i",{class:"fas fa-reply"},null,-1),e("span",null,"Reply",-1)]),8,Pt)])):c("",!0)])):c("",!0),e("div",{class:V(["mt-2 flex gap-3",o(_)?"justify-end":"justify-start"])},[!j.value||j.value.id!==_.id?(n(),r("button",{key:0,class:"text-[11px] text-gray-400 hover:text-indigo-600 transition opacity-0 group-hover:opacity-100",onClick:F=>ee(_)}," Reply ",8,Bt)):c("",!0),I(_)?(n(),r("button",{key:1,class:"text-[11px] text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100",onClick:F=>u(_)}," Delete ",8,Vt)):c("",!0)],2),(ce=g.value[_.id])!=null&&ce.length?(n(),r("div",Ft,[(n(!0),r(B,null,H(g.value[_.id],(F,le)=>(n(),r("p",{key:le,class:V(["text-xs text-red-600",o(_)?"text-right":"text-left"])},m(F),3))),128))])):c("",!0)])],2),o(_)?(n(),r("div",Ht,[h(te,{user:_.user||d.currentUser},null,8,["user"])])):c("",!0)],10,Tt)}),128))]),e("div",{ref_key:"commentBoxRef",ref:A,class:"bg-white rounded-xl shadow-sm border p-4 space-y-3"},[e("div",zt,[e("div",Gt,[h(te,{user:d.currentUser},null,8,["user"]),e("div",Wt,m(((P=d.currentUser)==null?void 0:P.name)||"You"),1)]),j.value?(n(),r("div",Yt,[e("span",Kt,[x[7]||(x[7]=S(" Replying to ")),e("span",Qt,m(((K=j.value.user)==null?void 0:K.name)||"Unknown"),1)]),e("button",{onClick:W,class:"text-indigo-400 hover:text-indigo-600 transition"},x[8]||(x[8]=[e("i",{class:"fas fa-times-circle text-xs"},null,-1)]))])):c("",!0)]),h(We,{ref_key:"textEditorRef",ref:U,modelValue:T.value,"onUpdate:modelValue":x[0]||(x[0]=_=>T.value=_),"mentionable-users":d.mentionableUsers,"mentionable-tasks":d.mentionableTasks,"current-user":d.currentUser},null,8,["modelValue","mentionable-users","mentionable-tasks","current-user"]),e("div",Jt,[e("button",{class:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm disabled:opacity-60",disabled:N.value||!E(Ue)(String(T.value)).trim(),onClick:se},m(N.value?"Posting...":j.value?"Post Reply":"Post Comment"),9,Xt)]),q.value?(n(),r("p",Zt,m(q.value),1)):c("",!0)],512),v.value?(n(),L(Z,{key:1},{default:M(()=>{var _;return[e("div",es,[x[9]||(x[9]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete comment?",-1)),x[10]||(x[10]=e("p",{class:"text-sm text-gray-600 leading-relaxed"}," আপনি কি নিশ্চিত যে এই কমেন্টটি মুছে ফেলতে চান? মুছে ফেলা কমেন্ট পুনরুদ্ধার করা যাবে না। ",-1)),e("div",ts,[e("div",{innerHTML:(_=p.value)==null?void 0:_.message},null,8,ss)]),e("div",{class:"flex items-center justify-end gap-2 pt-2"},[e("button",{class:"px-4 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-50",onClick:t}," Cancel "),e("button",{class:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700",onClick:i}," Yes, Delete ")])])]}),_:1})):c("",!0)])}}},rs=Ve(ns,[["__scopeId","data-v-6416fb07"]]),os={class:"flex items-center border-b w-full pb-2"},as={class:""},ls={class:"mt-4 border h-40 flex items-center flex-col justify-center rounded border-dashed bg-red-50 text-center"},is={key:1,class:"text-red-500 text-center mt-2"},ds={class:"flex items-center justify-between mt-4"},us={__name:"RequirementAttachmentForm",props:{requirementId:[String,Number],default:()=>null},emits:["uploaded","error","clickBack"],setup(d,{emit:$}){const v=d,p=w({attachments:[]}),u=w(""),t=w(""),i=$;function f(s){p.value.attachments=[...p.value.attachments,...Array.from(s.target.files)]}function g(s){p.value.attachments.splice(s,1)}async function C(){var a,l,y,k;u.value="submitting";const s=new FormData;for(const q in p.value)q==="attachments"?p.value.attachments.forEach(T=>s.append("attachments[]",T)):s.append(q,p.value[q]);try{const q=await ot(v.requirementId,s);p.value.attachments=[],i("uploaded",q),u.value="uploaded"}catch(q){i("error",(l=(a=q.response)==null?void 0:a.data)==null?void 0:l.message),t.value=(k=(y=q.response)==null?void 0:y.data)==null?void 0:k.message,u.value="error"}}return(s,a)=>{var l;return n(),r("form",{class:"p-4 flex flex-col relative",onSubmit:D(C,["prevent"])},[u.value=="submitting"?(n(),L($e,{key:0,class:"absolute inset-0 bg-opacity-80 flex items-center justify-center"})):c("",!0),e("div",os,[a[3]||(a[3]=e("h3",null,"Requirement Attachment",-1)),e("button",{class:"btn-icon ml-auto",onClick:a[0]||(a[0]=D(()=>{i("clickBack")},["prevent"]))},a[2]||(a[2]=[e("span",{class:"fas fa-times"},null,-1)]))]),e("div",as,[e("label",ls,[a[4]||(a[4]=e("div",{class:"block text-gray-600 font-medium text-sm md:text-xl mb-4"}," Click to Select files or Drop Here ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",class:"border rounded-r-md text-gray-600 bg-gray-50",onChange:f},null,32)])]),h(ut,{files:((l=p.value)==null?void 0:l.attachments)||[],onRemove:g,class:"border p-1 rounded overflow-y-auto flex-grow"},null,8,["files"]),a[6]||(a[6]=e("hr",{class:"mt-4"},null,-1)),t.value?(n(),r("div",is,m(t.value),1)):c("",!0),e("div",ds,[e("button",{class:"btn-3",onClick:a[1]||(a[1]=D(y=>i("clickBack"),["prevent"]))},"Cancel"),a[5]||(a[5]=e("button",{class:"btn-2"},"Save",-1))])],32)}}},ms={class:"card-bg p-4 pt-2"},cs={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 w-full"},ps=["onClick"],vs=["src"],fs=["href"],bs={key:2,class:"text-xs text-gray-500 text-center"},xs={__name:"RequirementAttachments",props:{requirement:{type:Array,default:()=>[]}},setup(d){const $=d,v=z(()=>{var t;return((t=$.requirement)==null?void 0:t.attachments)||[]}),p=ve({show:!1}),u=ve({show:!1,selectedFile:""});return(t,i)=>(n(),r("div",ms,[e("div",null,[i[6]||(i[6]=e("h4",{class:"text-gray-900 font-semibold mb-3 border-b font-e"},"Attachments",-1)),e("div",cs,[v.value&&v.value.length?(n(!0),r(B,{key:0},H(v.value,(f,g)=>(n(),r("div",{key:g,class:"border p-1 rounded aspect-square flex items-center justify-center bg-gray-50 relative",tabindex:"0",onClick:D(()=>{u.show=!0,u.selectedFile=f},["prevent"])},[E(Ke)(f)?(n(),r("img",{key:0,src:E(he)(f),alt:"attachment",class:"object-cover w-full h-full rounded"},null,8,vs)):E(st)(f)?(n(),r("a",{key:1,href:E(he)(f),target:"_blank",class:"text-xs text-blue-600 text-center break-words hover:underline"},i[4]||(i[4]=[e("i",{class:"fas fa-file-pdf fa-2x mb-1 text-amber-700"},null,-1),e("div",{class:"whitespace-nowrap text-xs mt-1"},"Open PDF",-1)]),8,fs)):(n(),r("span",bs,"Unknown"))],8,ps))),128)):c("",!0),e("button",{title:"Add Attachments",onClick:i[0]||(i[0]=D(f=>p.show=!p.show,["prevent"])),class:"border rounded aspect-square flex items-center justify-center bg-sky-50 hover:bg-sky-100 relative group/btn"},i[5]||(i[5]=[e("i",{class:"fas fa-plus-circle text-2xl text-blue-300 group-hover/btn:text-blue-500"},null,-1)]))])]),p.show?(n(),L(Z,{key:0},{default:M(()=>[h(us,{onClickBack:i[1]||(i[1]=f=>p.show=!1),onUploaded:i[2]||(i[2]=f=>p.show=!1),requirementId:d.requirement.id,class:"max-h-[70vh]"},null,8,["requirementId"])]),_:1})):c("",!0),u.show?(n(),L(Z,{key:1,class:"*:max-w-4xl *:min-h-[60vh]"},{default:M(()=>[h(nt,{attachments:v.value,selected:u.selectedFile,onClickClose:i[3]||(i[3]=f=>u.show=!1)},null,8,["attachments","selected"])]),_:1})):c("",!0)]))}},gs={class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},ys={class:"text-sm flex flex-col xl:flex-row items-center mt-2 xl:mt-0 gap-x-2 text-red-400 font-semibold whitespace-nowrap"},_s={class:"mt-[2px]"},ks={key:0,class:"text-gray-800 flex items-center gap-2"},hs={key:1,class:"text-gray-800 w-full my-2 text-center"},ws={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},$s=["innerHTML"],qs={key:1,class:"flex gap-4 items-center justify-center mt-2"},Cs={key:2,class:"mb-2"},Ts={class:"flex justify-end text-sky-500"},js={key:3,class:"text-center w-full"},As={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick","closeClick","showHistoryClick"],setup(d,{emit:$}){const v=$;return(p,u)=>{var t,i;return n(),r("div",gs,[d.requirement.closed_at?(n(),r(B,{key:0},[u[6]||(u[6]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",ys,[u[3]||(u[3]=e("span",{class:"flex items-center gap-2 text-gray-600"},[e("span",{class:"fad fa-lock"}),e("span",{class:"mt-[2px]"},"CLOSED AT")],-1)),e("span",_s,m(new Date(d.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),d.requirement.closed_by_user?(n(),r("div",ks,[u[4]||(u[4]=e("span",{class:"text-sm"},"Closed by",-1)),h(pe,{user:d.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):c("",!0),d.requirement.closing_note?(n(),r("div",hs,[u[5]||(u[5]=e("div",{class:"text-xs text-left"},"Note",-1)),e("div",ws,[e("p",{innerHTML:d.requirement.closing_note},null,8,$s)])])):c("",!0)],64)):c("",!0),d.requirement.closed_at?(n(),r("div",qs,[e("button",{class:"btn-2 h-8",onClick:u[0]||(u[0]=D(f=>v("reOpenClick"),["prevent"]))},"Re Open")])):c("",!0),d.requirement.closed_at?c("",!0):(n(),r("div",Cs,[e("div",Ts,[e("button",{class:"btn-1 border border-sky-800",onClick:u[1]||(u[1]=D(f=>v("closeClick"),["prevent"]))}," Close Requirement ")])])),((i=(t=d.requirement)==null?void 0:t.closing_history)==null?void 0:i.length)>1?(n(),r("div",js,[e("button",{onClick:u[2]||(u[2]=f=>v("showHistoryClick")),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):c("",!0)])}}},Rs={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},Ss={class:"my-6"},Os={class:"text-center font-semibold text-blue-800 mb-4"},Is={class:"text-center my-1"},Ms={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},Ns={class:"mt-4"},Es=["placeholder","required"],Ls={class:"flex"},Ds={class:"text-red-600 text-center mt-2 text-sm"},Us={class:"flex justify-between mt-3"},Ps=["disabled"],Bs={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(d,{emit:$}){const v=d,p=$,u=z({get:()=>v.loading,set:()=>p("update:loading")}),t=w(""),i=w(""),f=w(255),g=z(()=>f.value-t.value.length);async function C(){var s,a,l;u.value=!0;try{(s=v.requirement)!=null&&s.closed_at?await at(v.requirement.id,t.value):await lt(v.requirement.id,t.value),p("updateStatus")}catch(y){i.value=(l=(a=y.response)==null?void 0:a.data)==null?void 0:l.message,p("error")}finally{u.value=!1}}return(s,a)=>{var y,k,q,T,N;const l=Fe("LoaderView");return n(),r("form",{class:"p-4 rounded relative border",onSubmit:D(C,["prevent"])},[u.value?(n(),L(l,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:M(()=>a[3]||(a[3]=[S(" Submitting! ")])),_:1,__:[3]})):c("",!0),e("h3",Rs,m((y=d.requirement)!=null&&y.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",Ss,[e("div",Os,m((k=d.requirement)==null?void 0:k.title),1),a[6]||(a[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",Is,[a[4]||(a[4]=S(" Want to ")),e("span",Ms,m((q=d.requirement)!=null&&q.closed_at?"Re-Open":"Close"),1),a[5]||(a[5]=S(" the requirement? "))]),e("div",Ns,[re(e("textarea",{"onUpdate:modelValue":a[0]||(a[0]=j=>t.value=j),rows:"4",placeholder:`Write about why are you ${(T=d.requirement)!=null&&T.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:s.currentAction==="reject",onInput:a[1]||(a[1]=j=>t.value.length>f.value?t.value=t.value.slice(0,f.value):null)},null,40,Es),[[He,t.value]]),e("div",Ls,[e("div",{class:V(["ml-auto inline-block text-sm text-gray-500",t.value.length>=f.value?"text-red-500":""])}," left "+m(g.value)+"/"+m(f.value)+" words ",3)])])]),a[7]||(a[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",Ds,m(i.value),1),e("div",Us,[e("button",{class:"btn-3",onClick:a[2]||(a[2]=D(j=>p("clickCancel"),["prevent"]))},"Cancel"),e("button",{class:"btn-2 disabled:opacity-45",disabled:t.value.trim().length==0},m((N=d.requirement)!=null&&N.closed_at?"Re-Open Requirement":"Close Requirement"),9,Ps)])])],32)}}},Vs={class:"sticky top-0 pt-4 bg-white z-10"},Fs={class:"mb-4"},Hs={class:"mb-4"},zs={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Gs={key:0,class:"mb-4 text-red-500 font-medium"},Ws={key:1,class:"mb-4"},Ys={class:"flex items-center justify-between gap-4"},Ks=["disabled"],Qs={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(d,{emit:$}){const v=d,p=$,u=w(),t=w(null),i=w(""),f=w(),g=w({feedback:""});async function C(){var s,a;i.value="submitting";try{const l=await it(v.requirementId,g.value.feedback);p("update",l),i.value="create"}catch(l){i.value="error",f.value=((a=(s=l.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to update requirement requirement",p("error",f.value)}}return _e(async()=>{var s,a,l,y;i.value="loading";try{await we(v.requirementId),t.value=(s=(await we(v.requirementId)).data)==null?void 0:s.requirement,g.value={feedback:(a=t.value)==null?void 0:a.feedback}}catch(k){f.value=((y=(l=k.response)==null?void 0:l.data)==null?void 0:y.message)||"Failed to fetch requirement requirement"}finally{i.value=""}}),(s,a)=>{var l;return n(),r("div",{ref_key:"formContainerRef",ref:u,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Vs,[a[3]||(a[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),a[4]||(a[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:a[0]||(a[0]=D(y=>p("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:D(C,["prevent"]),class:"z-0"},[i.value!=="loading"?(n(),r(B,{key:0},[e("div",Fs,[a[5]||(a[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),h(fe,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:M(()=>{var y;return[S(m((y=t.value)==null?void 0:y.title),1)]}),_:1})]),e("div",Hs,[a[6]||(a[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),h(We,{modelValue:g.value.feedback,"onUpdate:modelValue":a[1]||(a[1]=y=>g.value.feedback=y)},null,8,["modelValue"])])],64)):c("",!0),e("div",zs,[f.value?(n(),r("div",Gs,m(f.value),1)):c("",!0),f.value?(n(),r("hr",Ws)):c("",!0),e("div",Ys,[e("button",{type:"button",onClick:a[2]||(a[2]=D(y=>p("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:i.value=="loading"||i.value=="submitting",type:"submit",class:"btn-2"},m(i.value=="submitting"?"Saving...":(l=t.value)!=null&&l.feedback?"Update Feedback":"Add Feedback"),9,Ks)])])],32),i.value==="loading"||i.value==="submitting"?(n(),L($e,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512)}}},Js={class:"bg-white p-6 rounded-lg w-full w-full"},Xs={class:"flex items-center justify-between mb-4 border-b pb-2"},Zs={class:"space-y-4"},en={class:"space-y-2"},tn={class:"flex items-center gap-2"},sn={key:0,class:"ml-6 space-y-2 p-2 bg-gray-50 rounded-md"},nn={class:"flex items-center gap-2"},rn={class:"flex items-center gap-2"},on={class:"flex items-center gap-2"},an={class:"flex items-center gap-2"},ln={class:"flex items-center gap-2"},dn={class:"mt-8 flex justify-end gap-3 border-t pt-4"},un={__name:"RequirementPrintOptions",props:{initialOptions:{type:Object,default:()=>({withTasks:!0,taskOption:"list",withMessages:!0,withApprovals:!0,withAttachments:!0})}},emits:["close","print"],setup(d,{emit:$}){const v=d,p=$,u=ve({...v.initialOptions});return(t,i)=>(n(),r("div",Js,[e("div",Xs,[i[10]||(i[10]=e("h3",{class:"text-xl font-bold"},"Print Options",-1)),e("button",{onClick:i[0]||(i[0]=f=>p("close")),class:"text-gray-500 hover:text-gray-700"},i[9]||(i[9]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",Zs,[e("div",en,[e("div",tn,[re(e("input",{type:"checkbox","onUpdate:modelValue":i[1]||(i[1]=f=>u.withTasks=f),id:"withTasks",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[xe,u.withTasks]]),i[11]||(i[11]=e("label",{for:"withTasks",class:"font-semibold text-gray-700"},"Print with Tasks",-1))]),u.withTasks?(n(),r("div",sn,[e("div",nn,[re(e("input",{type:"radio","onUpdate:modelValue":i[2]||(i[2]=f=>u.taskOption=f),value:"list",id:"taskOptionList",class:"w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[De,u.taskOption]]),i[12]||(i[12]=e("label",{for:"taskOptionList",class:"text-sm text-gray-600"},"Task list with count",-1))]),e("div",rn,[re(e("input",{type:"radio","onUpdate:modelValue":i[3]||(i[3]=f=>u.taskOption=f),value:"countOnly",id:"taskOptionCount",class:"w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[De,u.taskOption]]),i[13]||(i[13]=e("label",{for:"taskOptionCount",class:"text-sm text-gray-600"},"Only task count (completed/total)",-1))])])):c("",!0)]),e("div",on,[re(e("input",{type:"checkbox","onUpdate:modelValue":i[4]||(i[4]=f=>u.withMessages=f),id:"withMessages",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[xe,u.withMessages]]),i[14]||(i[14]=e("label",{for:"withMessages",class:"font-semibold text-gray-700"},"Print with message list",-1))]),e("div",an,[re(e("input",{type:"checkbox","onUpdate:modelValue":i[5]||(i[5]=f=>u.withApprovals=f),id:"withApprovals",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[xe,u.withApprovals]]),i[15]||(i[15]=e("label",{for:"withApprovals",class:"font-semibold text-gray-700"},"Print with Approval list",-1))]),e("div",ln,[re(e("input",{type:"checkbox","onUpdate:modelValue":i[6]||(i[6]=f=>u.withAttachments=f),id:"withAttachments",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[xe,u.withAttachments]]),i[16]||(i[16]=e("label",{for:"withAttachments",class:"font-semibold text-gray-700"},"Print Attachments (Images on separate page)",-1))])]),e("div",dn,[e("button",{onClick:i[7]||(i[7]=f=>p("close")),class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition"}," Cancel "),e("button",{onClick:i[8]||(i[8]=f=>p("print",u)),class:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition font-semibold"},i[17]||(i[17]=[e("i",{class:"fas fa-print mr-2"},null,-1),S(" Print ")]))])]))}},mn={class:"requirement-print-preview bg-white text-black p-8 font-serif leading-relaxed"},cn={class:"border-b-2 border-gray-800 pb-4 mb-6"},pn={class:"flex justify-between items-start"},vn={class:"text-sm text-gray-600 mt-1"},fn={class:"font-semibold"},bn={class:"text-right"},xn={class:"text-lg font-bold text-indigo-700"},gn={class:"grid grid-cols-2 gap-x-12 gap-y-4 mb-6 text-sm"},yn={class:"space-y-2"},_n={class:"flex justify-between border-b border-gray-100 pb-1"},kn={class:"font-medium text-right"},hn={class:"flex justify-between border-b border-gray-100 pb-1"},wn={class:"font-medium text-right"},$n={class:"flex justify-between border-b border-gray-100 pb-1"},qn={class:"font-medium text-right"},Cn={class:"space-y-2"},Tn={class:"flex justify-between border-b border-gray-100 pb-1"},jn={class:"flex justify-between border-b border-gray-100 pb-1"},An={class:"font-medium text-right"},Rn={class:"flex justify-between border-b border-gray-100 pb-1"},Sn={class:"font-medium text-right"},On={class:"mb-6 p-3 bg-gray-50 rounded border flex items-center gap-4"},In={key:0,class:"flex items-center gap-2"},Mn={class:"font-semibold"},Nn={key:0,class:"text-xs text-gray-500"},En={key:1,class:"text-gray-400"},Ln={class:"mb-6"},Dn={class:"text-xl mb-2"},Un={class:"font-bold"},Pn={key:0,class:"print-description prose prose-sm max-w-none text-gray-800 p-0"},Bn={key:0,class:"mb-6 break-inside-avoid"},Vn={class:"flex justify-between items-center mb-4 border-b pb-2"},Fn={class:"font-semibold text-sm bg-gray-800 text-white px-3 py-1 rounded-full"},Hn={key:0,class:"overflow-hidden border rounded"},zn={class:"w-full border-collapse text-sm"},Gn={class:"border p-2 text-center font-bold text-gray-400"},Wn={class:"border p-2"},Yn={class:"font-semibold"},Kn=["innerHTML"],Qn={class:"border p-2"},Jn={key:0,class:"text-gray-400 text-xs italic"},Xn={class:"border p-2 text-center"},Zn={key:0},er={key:1,class:"p-4 border rounded bg-gray-50 text-center italic text-gray-600"},tr={key:1,class:"mb-10"},sr={class:"space-y-4 break-before-page"},nr={class:"flex items-center gap-2 mb-1"},rr={class:"font-bold text-sm"},or={class:"text-xs text-gray-400"},ar={key:0,class:"text-[10px] text-gray-400 italic"},lr={key:0,class:"text-sm text-gray-700"},ir={class:"mb-10 p-4 bg-blue-50/50 rounded-lg flex items-center justify-between border-l-4 border-blue-400"},dr={class:"flex items-center gap-4"},ur={class:"flex items-center gap-2"},mr={class:"font-bold text-gray-800"},cr={class:"text-right"},pr={class:"text-sm font-semibold"},vr={key:2,class:"mb-6"},fr={class:"break-inside-avoid"},br={class:"mb-8"},xr={class:"text-xs font-bold text-gray-700 text-center uppercase tracking-widest border-b border-dashed pb-1 mb-4"},gr={class:"grid grid-cols-2 gap-8"},yr={key:0,class:"w-full"},_r={class:"text-[10px] text-gray-500 uppercase font-bold mb-3"},kr={key:0,class:"space-y-2"},hr={class:"flex flex-col items-center gap-2"},wr={class:"relative inline-block"},$r={class:"font-bold text-indigo-700"},qr={key:0,class:"text-xs text-red-600 font-semibold italic"},Cr={key:1,class:"text-xs text-gray-600 italic"},Tr={key:2,class:"mt-1 text-[10px] text-red-600 font-bold px-2 py-0.5 rounded inline-block"},jr={key:3,class:"mt-1 text-[10px] text-green-600 font-bold px-2 py-0.5 rounded inline-block"},Ar={key:4,class:"mt-1 text-[10px] text-yellow-600 font-bold px-2 py-0.5 rounded inline-block"},Rr={key:1,class:"h-12 flex items-center justify-center text-gray-300 italic text-xs"},Sr={key:0,class:"break-inside-avoid"},Or={class:"text-xs font-bold text-center text-gray-700 uppercase tracking-widest border-b border-dashed pb-1 mb-4"},Ir={class:"grid grid-cols-2 gap-8"},Mr={key:0,class:"w-full"},Nr={class:"text-[10px] text-gray-500 uppercase font-bold mb-3"},Er={key:0,class:"space-y-2"},Lr={class:"flex flex-col items-center gap-2"},Dr={class:"relative inline-block"},Ur={class:"font-bold text-indigo-700"},Pr={key:0,class:"text-xs text-red-600 font-semibold italic"},Br={key:1,class:"text-xs text-gray-600 italic"},Vr={key:2,class:"mt-1 text-[10px] text-red-600 font-bold px-2 py-0.5 rounded inline-block"},Fr={key:3,class:"mt-1 text-[10px] text-green-600 font-bold px-2 py-0.5 rounded inline-block"},Hr={key:4,class:"mt-1 text-[10px] text-yellow-600 font-bold px-2 py-0.5 rounded inline-block"},zr={key:1,class:"h-12 flex items-center justify-center text-gray-300 italic text-xs"},Gr={key:3,class:"break-before-page mt-12"},Wr={class:"grid grid-cols-1 gap-8"},Yr={class:"text-xs text-gray-500 mb-2 font-mono"},Kr=["src"],Qr={__name:"RequirementPrintPreview",props:{requirement:{type:Object,required:!0},options:{type:Object,required:!0},comments:{type:Array,default:()=>[]}},setup(d){const $=d,v=z(()=>{var u;return(((u=$.requirement)==null?void 0:u.attachments)||[]).filter(t=>Ke(t))}),p=u=>{var l,y,k,q,T,N;const t=$.requirement,i={from_in_charge:!!(t!=null&&t.status&&(t!=null&&t.submission_date)),from_coordinator:!!(t!=null&&t.from_coordinator),to_in_charge:!!(t!=null&&t.to_incharge),to_coordinator:!!(t!=null&&t.to_coordinator)},f={from_in_charge:(l=t==null?void 0:t.from_department)==null?void 0:l.in_charge,from_coordinator:(y=t==null?void 0:t.from_department)==null?void 0:y.coordinator,to_in_charge:(k=t==null?void 0:t.to_department)==null?void 0:k.in_charge,to_coordinator:(q=t==null?void 0:t.to_department)==null?void 0:q.coordinator};let g=null,C=null,s="",a="";return u==="from_in_charge"&&(g=t==null?void 0:t.from_department,C=(T=t==null?void 0:t.from_department)==null?void 0:T.in_charge,s="In Charge",a=t==null?void 0:t.from_incharge_note),u==="from_coordinator"&&(g=t==null?void 0:t.from_department,C=t==null?void 0:t.from_coordinator,s="Coordinator",a=t==null?void 0:t.from_coordinator_note),u==="to_in_charge"&&(g=t==null?void 0:t.to_department,C=t==null?void 0:t.to_incharge,s="In Charge",a=t==null?void 0:t.to_incharge_note),u==="to_coordinator"&&(g=t==null?void 0:t.to_department,C=t==null?void 0:t.to_coordinator,s="Coordinator",a=t==null?void 0:t.to_coordinator_note),{department:g,approved:i[u],approval_user:C,is_rejected:(t==null?void 0:t.rejected_by_user_id)&&(t==null?void 0:t.rejected_by_user_id)===((N=f[u])==null?void 0:N.id),userType:s,approval_note:a}};return(u,t)=>{var i,f,g,C,s,a;return n(),r("div",mn,[e("div",cn,[e("div",pn,[e("div",null,[t[1]||(t[1]=e("h1",{class:"text-xl font-bold uppercase tracking-wider"},"Requirement Report",-1)),e("p",vn,[t[0]||(t[0]=S(" Generated on ")),e("span",fn,m(E(ie)(new Date)),1)])]),e("div",bn,[e("div",xn,"#"+m(d.requirement.id),1),e("div",{class:V(["text-sm font-semibold uppercase px-2 py-0.5 rounded border inline-block mt-1",d.requirement.status==="approved"?"bg-green-100 border-green-400 text-green-800":d.requirement.status==="rejected"?"bg-red-100 border-red-400 text-red-800":"bg-yellow-100 border-yellow-400 text-yellow-800"])},[e("i",{class:V(["mr-1",d.requirement.status==="approved"?"fas fa-check-circle":d.requirement.status==="rejected"?"fas fa-times-circle":"fas fa-clock"])},null,2),S(" "+m(d.requirement.status||"PENDING"),1)],2)])])]),e("div",gn,[e("div",yn,[e("div",_n,[t[2]||(t[2]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Website:",-1)),e("span",kn,m((d.requirement.website_tags||[]).map(l=>l.name).join(", ")||"N/A"),1)]),e("div",hn,[t[3]||(t[3]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Submission Date:",-1)),e("span",wn,m(d.requirement.submission_date?E(ie)(d.requirement.submission_date):"N/A"),1)]),e("div",$n,[t[4]||(t[4]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Better To Complete:",-1)),e("span",qn,m(d.requirement.better_to_complete_on?E(Qe)(d.requirement.better_to_complete_on):"N/A"),1)])]),e("div",Cn,[e("div",Tn,[t[5]||(t[5]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Priority:",-1)),e("span",{class:V(["font-bold uppercase",d.requirement.priority==="URGENT"?"text-red-600":d.requirement.priority==="IMPORTANT"?"text-orange-600":""])},m(d.requirement.priority||"NORMAL"),3)]),e("div",jn,[t[6]||(t[6]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"From Dept:",-1)),e("span",An,m((i=d.requirement.from_department)==null?void 0:i.name),1)]),e("div",Rn,[t[7]||(t[7]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"To Dept:",-1)),e("span",Sn,m((f=d.requirement.to_department)==null?void 0:f.name),1)])])]),e("div",On,[t[8]||(t[8]=e("span",{class:"text-gray-500 font-bold uppercase text-xs"},"Supervisor:",-1)),d.requirement.supervisor?(n(),r("div",In,[h(te,{user:d.requirement.supervisor,size:"xsmall"},null,8,["user"]),e("span",Mn,m(d.requirement.supervisor.name),1),d.requirement.supervisor.designation?(n(),r("span",Nn,"("+m(d.requirement.supervisor.designation)+")",1)):c("",!0)])):(n(),r("span",En,"Not Assigned"))]),e("div",Ln,[e("h2",Dn,[e("span",Un,m(d.requirement.title),1)]),d.requirement.description?(n(),r("div",Pn,[h(ye,{message:d.requirement.description},null,8,["message"])])):c("",!0)]),d.options.withTasks?(n(),r("div",Bn,[e("div",Vn,[t[9]||(t[9]=e("h3",{class:"text-lg font-bold uppercase"},"Tasks",-1)),e("span",Fn,m(d.requirement.completed_tasks_count)+" / "+m(d.requirement.tasks_count)+" Completed ",1)]),d.options.taskOption==="list"?(n(),r("div",Hn,[e("table",zn,[t[12]||(t[12]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"border p-2 text-left w-12 text-gray-600"},"SL"),e("th",{class:"border p-2 text-left text-gray-600"},"Task Title"),e("th",{class:"border p-2 text-left text-gray-600 w-48"},"Assigned To"),e("th",{class:"border p-2 text-center text-gray-600 w-32"},"Status")])],-1)),e("tbody",null,[(n(!0),r(B,null,H(d.requirement.tasks,(l,y)=>{var k;return n(),r("tr",{key:l.id,class:"border-b hover:bg-gray-50"},[e("td",Gn,m(y+1),1),e("td",Wn,[e("div",Yn,m(l.title),1),l.description?(n(),r("div",{key:0,class:"text-xs text-gray-500 mt-1",innerHTML:l.description},null,8,Kn)):c("",!0)]),e("td",Qn,[(n(!0),r(B,null,H(l.users,q=>(n(),r("div",{key:q.id,class:"text-xs mb-1 last:mb-0 flex items-center gap-1"},[t[10]||(t[10]=e("span",{class:"w-1.5 h-1.5 bg-indigo-400 rounded-full"},null,-1)),S(" "+m(q.name),1)]))),128)),(k=l.users)!=null&&k.length?c("",!0):(n(),r("span",Jn,"Unassigned"))]),e("td",Xn,[e("span",{class:V(["px-2 py-0.5 rounded-full text-[10px] uppercase font-bold",l.status==="COMPLETED"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"])},m(l.status),3)])])}),128)),(g=d.requirement.tasks)!=null&&g.length?c("",!0):(n(),r("tr",Zn,t[11]||(t[11]=[e("td",{colspan:"4",class:"p-8 text-center text-gray-400 italic"}," No tasks found for this requirement. ",-1)])))])])])):(n(),r("div",er," Task list hidden based on print options. (Summary: "+m(d.requirement.completed_tasks_count)+" / "+m(d.requirement.tasks_count)+" tasks completed) ",1))])):c("",!0),d.options.withMessages&&d.comments.length?(n(),r("div",tr,[t[13]||(t[13]=e("h3",{class:"text-lg font-bold uppercase mb-4 border-b pb-2"},"Message History",-1)),e("div",sr,[(n(!0),r(B,null,H(d.comments,l=>{var y,k;return n(),r("div",{key:l.id,class:"border-l-4 border-gray-200 pl-4 py-1"},[e("div",nr,[h(te,{user:l.user,size:"xsmall"},null,8,["user"]),e("span",rr,m((y=l.user)==null?void 0:y.name),1),e("span",or,m(E(ie)(l.created_at)),1),l.parent?(n(),r("span",ar," (In reply to "+m((k=l.parent.user)==null?void 0:k.name)+") ",1)):c("",!0)]),l.message?(n(),r("div",lr,[h(ye,{message:l.message},null,8,["message"])])):c("",!0)])}),128))])])):c("",!0),e("div",ir,[e("div",dr,[t[14]||(t[14]=e("span",{class:"text-xs font-bold text-blue-700 uppercase tracking-widest"},"Submitted By:",-1)),e("div",ur,[h(te,{user:d.requirement.created_by,size:"xsmall"},null,8,["user"]),e("span",mr,m((C=d.requirement.created_by)==null?void 0:C.name),1)])]),e("div",cr,[t[15]||(t[15]=e("p",{class:"text-[10px] text-gray-500 font-bold uppercase"},"Submission Date",-1)),e("p",pr,m(E(ie)(d.requirement.created_at)),1)])]),d.options.withApprovals?(n(),r("div",vr,[e("div",fr,[t[20]||(t[20]=e("h3",{class:"text-lg font-bold uppercase mb-6 border-b pb-2"},"Approvals",-1)),e("div",br,[e("h4",xr,m((s=d.requirement.from_department)==null?void 0:s.name)+" Approvals ",1),e("div",gr,[(n(),r(B,null,H(["from_in_charge","from_coordinator"],l=>e("div",{key:l,class:"approval-box p-4 flex flex-col items-center text-center"},[p(l)?(n(),r("div",yr,[e("p",_r,m(p(l).userType),1),p(l).approval_user?(n(),r("div",kr,[e("div",hr,[h(te,{user:p(l).approval_user,size:"small"},null,8,["user"]),e("div",wr,[e("span",$r,m(p(l).approval_user.name),1),t[16]||(t[16]=e("hr",{class:"border-t-2 border-indigo-100 mt-0.5"},null,-1))])]),p(l).is_rejected&&d.requirement.rejection_reason?(n(),r("p",qr,m(d.requirement.rejection_reason),1)):p(l).approval_note?(n(),r("p",Cr,m(p(l).approval_note),1)):c("",!0),p(l).is_rejected?(n(),r("div",Tr,t[17]||(t[17]=[e("i",{class:"fas fa-times-circle mr-1"},null,-1),S(" REJECTED ")]))):p(l).approved?(n(),r("div",jr,[t[18]||(t[18]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),S(" "+m(l==="from_in_charge"?"SUBMITTED":"APPROVED"),1)])):(n(),r("div",Ar,t[19]||(t[19]=[e("i",{class:"fas fa-clock mr-1"},null,-1),S(" PENDING ")])))])):(n(),r("div",Rr," N/A "))])):c("",!0)])),64))])])]),d.requirement.from_department_id!==d.requirement.to_department_id?(n(),r("div",Sr,[e("h4",Or,m((a=d.requirement.to_department)==null?void 0:a.name)+" Approvals ",1),e("div",Ir,[(n(),r(B,null,H(["to_in_charge","to_coordinator"],l=>e("div",{key:l,class:"approval-box p-4 flex flex-col items-center text-center"},[p(l)?(n(),r("div",Mr,[e("p",Nr,m(p(l).userType),1),p(l).approval_user?(n(),r("div",Er,[e("div",Lr,[h(te,{user:p(l).approval_user,size:"small"},null,8,["user"]),e("div",Dr,[e("span",Ur,m(p(l).approval_user.name),1),t[21]||(t[21]=e("hr",{class:"border-t-2 border-indigo-100 mt-0.5"},null,-1))])]),p(l).is_rejected&&d.requirement.rejection_reason?(n(),r("p",Pr,m(d.requirement.rejection_reason),1)):p(l).approval_note?(n(),r("p",Br,m(p(l).approval_note),1)):c("",!0),p(l).is_rejected?(n(),r("div",Vr,t[22]||(t[22]=[e("i",{class:"fas fa-times-circle mr-1"},null,-1),S(" REJECTED ")]))):p(l).approved?(n(),r("div",Fr,t[23]||(t[23]=[e("i",{class:"fas fa-check-circle mr-1"},null,-1),S(" APPROVED ")]))):(n(),r("div",Hr,t[24]||(t[24]=[e("i",{class:"fas fa-clock mr-1"},null,-1),S(" PENDING ")])))])):(n(),r("div",zr," N/A "))])):c("",!0)])),64))])])):c("",!0)])):c("",!0),d.options.withAttachments&&v.value.length?(n(),r("div",Gr,[t[25]||(t[25]=e("h3",{class:"text-lg font-bold uppercase mb-6 border-b pb-2"},"Image Attachments",-1)),e("div",Wr,[(n(!0),r(B,null,H(v.value,(l,y)=>(n(),r("div",{key:y,class:"break-inside-avoid border p-4 rounded bg-gray-50 shadow-sm"},[e("p",Yr,"Attachment #"+m(y+1),1),e("img",{src:E(he)(l),class:"max-w-full h-auto rounded border shadow-inner mx-auto",alt:"Requirement Attachment"},null,8,Kr)]))),128))])])):c("",!0)])}}},Jr=Ve(Qr,[["__scopeId","data-v-4585ac0c"]]),Xr={class:"flex justify-center items-center"},Zr={class:"modal-card"},eo={key:0},to=["required"],so={class:"flex"},no={class:"flex justify-between gap-2 mt-4"},ro=["disabled"],oo=["disabled"],ao={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0},requirementNote:{type:Boolean,default:!0}},emits:["loading","success","error"],setup(d,{emit:$}){const v=d,p=$,u=w(255),t=z(()=>u.value-s.value.length),i=Je(),f=w(null),g=w(null),C=w(null),s=w(""),a=w(!1),l=z(()=>C.value!==null);function y(j){C.value=j,s.value="",N()}function k(){C.value=null,s.value=""}async function q(){var j,A;if(C.value==="reject"&&!s.value)return i.error("Rejection Reason is required!");if(typeof v.onSubmit=="function")return v.onSubmit({note:s.value,action:C.value});p("loading",!0),a.value=!0;try{await dt(v.requirementId,{note:s.value}),p("success"),k()}catch(U){return p("error",U),i.error(((A=(j=U==null?void 0:U.response)==null?void 0:j.data)==null?void 0:A.message)||"Submission failed!")}finally{p("loading",!1),a.value=!1}}function T(j){var A,U;l.value&&(j.key==="ArrowLeft"?(A=g.value)==null||A.focus():j.key==="ArrowRight"&&((U=f.value)==null||U.focus()))}function N(){ge(()=>{var j;(j=f.value)==null||j.focus()})}return _e(()=>{window.addEventListener("keydown",T)}),ze(()=>{window.removeEventListener("keydown",T)}),(j,A)=>(n(),r("div",null,[e("div",Xr,[e("button",{onClick:A[0]||(A[0]=U=>y("accept"))},A[3]||(A[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),l.value?(n(),r("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:D(k,["self"])},[e("div",Zr,[A[4]||(A[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),d.requirementNote?(n(),r("div",eo,[re(e("textarea",{"onUpdate:modelValue":A[1]||(A[1]=U=>s.value=U),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:C.value==="reject",onInput:A[2]||(A[2]=U=>s.value.length>u.value?s.value=s.value.slice(0,u.value):null)},null,40,to),[[He,s.value]]),e("div",so,[e("div",{class:V(["ml-auto inline-block text-sm text-gray-500",s.value.length>=u.value?"text-red-500":""])}," left "+m(t.value)+"/"+m(u.value)+" words ",3)])])):c("",!0),e("div",no,[e("button",{ref_key:"cancelBtnRef",ref:g,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:k,disabled:a.value}," Cancel ",8,ro),e("button",{ref_key:"confirmBtnRef",ref:f,class:V(["focus:ring-2 ring-offset-2 disabled:opacity-30",C.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:q,disabled:a.value}," Confirm Submission ",10,oo)])])])):c("",!0)]))}},lo={class:"flex items-center gap-6 justify-center my-16"},io={key:0,class:"border rounded-md"},uo={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(d,{emit:$}){const v=d,p=$,u=mt(),t=w(""),i=w(null),f=w(""),g=w(!1);async function C(){await u.setTaskRequirement(f.value,v.requirement.id),p("assignTask")}return(s,a)=>(n(),r("div",{class:V(["text-left p-4",[t.value&&!i.value?"min-h-[400px]":""]])},[e("div",lo,[e("button",{onClick:a[0]||(a[0]=D(l=>p("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),a[5]||(a[5]=e("span",null,"or",-1)),e("button",{class:V({"btn-3":t.value!=="direct-assign","btn-2":t.value=="direct-assign"}),onClick:a[1]||(a[1]=D(()=>t.value="direct-assign",["prevent"]))}," Assign Task ",2)]),t.value&&!i.value?(n(),r("div",io,[e("form",{onSubmit:D(C,["prevent"]),class:"p-4 flex items-end"},[h(ct,{class:"flex-grow mr-4 h-12",taskId:f.value,"onUpdate:taskId":a[2]||(a[2]=l=>f.value=l),show:g.value,"onUpdate:show":a[3]||(a[3]=l=>g.value=l),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":d.fromDepartmentId},filterTasks:l=>!l.requirement_id,onAddNewTaskClick:a[4]||(a[4]=l=>p("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),a[6]||(a[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):c("",!0)],2))}},mo={class:"flex flex-col items-center gax-x-1 justify-end"},co={key:0},po={key:1},vo={class:"text-sm text-gray-600 whitespace-normal w-64"},fo={class:"text-gray-900 font-semibold text-sm md:text-base"},bo={class:"ml-2"},xo={key:0,class:"text-red-700 text-sm"},go={key:1,class:"text-green-600 ml-2"},yo={key:2,class:"ml-2 text-yellow-700"},Be={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(d,{emit:$}){const v=d,p=$,u=Ge(),t=z(()=>{var s,a,l,y,k;return{from_in_charge:!!((s=v.requirement)!=null&&s.status&&((a=v.requirement)!=null&&a.submission_date)),from_coordinator:!!((l=v.requirement)!=null&&l.from_coordinator),to_in_charge:!!((y=v.requirement)!=null&&y.to_incharge),to_coordinator:!!((k=v.requirement)!=null&&k.to_coordinator)}}),i=z(()=>{var s,a,l,y,k,q,T,N;return{from_in_charge:(a=(s=v.requirement)==null?void 0:s.from_department)==null?void 0:a.in_charge,from_coordinator:(y=(l=v.requirement)==null?void 0:l.from_department)==null?void 0:y.coordinator,to_in_charge:(q=(k=v.requirement)==null?void 0:k.to_department)==null?void 0:q.in_charge,to_coordinator:(N=(T=v.requirement)==null?void 0:T.to_department)==null?void 0:N.coordinator}}),f=z(()=>{var y;const s=Object.keys(t.value),a=s.indexOf(v.approvalType);let l=!0;for(let k=a-1;k>=0;k--){const q=s[k];l=l&&(i.value[q]?(y=t.value)==null?void 0:y[q]:!0)}return l}),g=z(()=>{var q,T,N,j,A,U,G,ee,W,oe,R,se,ne,Q,I,o;let s=null,a=null,l="",y="";v.approvalType==="from_in_charge"&&(s=(q=v.requirement)==null?void 0:q.from_department,a=(N=(T=v.requirement)==null?void 0:T.from_department)==null?void 0:N.in_charge,l="In Charge",y=(j=v.requirement)==null?void 0:j.from_incharge_note),v.approvalType==="from_coordinator"&&(s=(A=v.requirement)==null?void 0:A.from_department,a=(U=v.requirement)==null?void 0:U.from_coordinator,l="Coordinator",y=(G=v.requirement)==null?void 0:G.from_coordinator_note),v.approvalType==="to_in_charge"&&(s=(ee=v.requirement)==null?void 0:ee.to_department,a=(W=v.requirement)==null?void 0:W.to_in_charge,l="In Charge",y=(oe=v.requirement)==null?void 0:oe.to_incharge_note),v.approvalType==="to_coordinator"&&(s=(R=v.requirement)==null?void 0:R.to_department,a=(se=v.requirement)==null?void 0:se.to_coordinator,l="Coordinator",y=(ne=v.requirement)==null?void 0:ne.to_coordinator_note);const k=(Q=i.value)==null?void 0:Q[v.approvalType];return{department:s,department_user:k,approved:(I=t.value)==null?void 0:I[v.approvalType],approval_user:a,is_rejected:((o=v.requirement)==null?void 0:o.rejected_by_user_id)==(k==null?void 0:k.id),userType:l,approval_note:y}});function C(){p("updateApproval")}return(s,a)=>{var l,y,k,q,T,N;return n(),r("div",mo,[g.value.department_user?(n(),r("div",co,[h(pe,{user:g.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),r("div",po,a[0]||(a[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",vo,[g.value.is_rejected?(n(),L(fe,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:M(()=>[S(m(d.requirement.rejection_reason),1)]),_:1})):(n(),L(fe,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:M(()=>[S(m(g.value.approval_note),1)]),_:1}))]),e("div",null,[!g.value.is_rejected&&!g.value.approved&&f.value&&((l=E(u).user)==null?void 0:l.id)==((k=(y=g.value)==null?void 0:y.department_user)==null?void 0:k.id)?(n(),L(bt,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(q=v.requirement)==null?void 0:q.id,onSuccess:C,variant:1},null,8,["applicationId"])):c("",!0)]),a[2]||(a[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",fo,[e("span",null,m(((T=g.value.department)==null?void 0:T.short_name)||((N=g.value.department)==null?void 0:N.name)),1),e("span",bo,m(g.value.userType),1),g.value.department_user?(n(),r(B,{key:0},[g.value.is_rejected?(n(),r("span",xo," (Rejected)")):g.value.approved?(n(),r("span",go,"(✔)")):(n(),r("span",yo,a[1]||(a[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):c("",!0)])])}}},_o={class:"container mx-auto print:p-0 w-full print:max-w-full"},ko={class:"border-b px-3 py-1 bg-gray-50 flex items-center justify-between rounded-t-md"},ho={key:0,class:"p-3 max-h-[50vh] overflow-auto"},wo={class:"border table-auto w-full"},$o={class:"border-y px-4 py-2 text-right"},qo={class:"border-y pr-4 py-2 whitespace-nowrap"},Co={class:"border-y px-4 py-2"},To={class:"line-clamp-2 text-sm text-amber-950"},jo={class:"border-y px-4 py-2 text-center"},Ao={class:"print:hidden relative min-h-[50vh] mx-4"},Ro={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},So={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},Oo={class:"text-center text-xl font-bold mb-2 flex items-center justify-between"},Io={class:"flex items-center"},Mo={class:"text-2xl ml-4"},No={class:"mb-8"},Eo={class:"text-lg font-semibold mb-2"},Lo={class:"flex gap-4 items-center text-gray-500"},Do={class:"text-sm"},Uo={key:0,class:"flex items-center gap-1"},Po={key:0,class:"mb-5"},Bo={class:"mb-8"},Vo={class:"font-semibold text-lg px-2"},Fo={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},Ho={class:"w-full border-collapse"},zo={key:0},Go={class:"mb-8"},Wo={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Yo={class:"flex flex-col items-end"},Ko={key:2,class:"mt-6 mb-8 break-before-avoid-page"},Qo={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},Jo={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},Xo={class:"bg-white shadow rounded-lg space-y-4 p-4 mb-4"},Zo={class:"border col-span-3 p-3 rounded-md"},ea={class:"flex items-center gap-2 mb-4"},ta={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},sa={class:"flex items-center gap-2 mb-4"},na={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},ra={class:"font-bold print:text-gray-900"},oa={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},aa={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},la={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},ia={class:"print:text-gray-900 text-sm text-right"},da={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},ua={class:"print:text-gray-900 text-sm text-right"},ma={class:"flex justify-between items-center mb-4"},ca={class:"mb-4"},pa={class:"flex justify-between items-center"},va={key:1,class:"text-red-600"},fa={key:0,class:"mb-2"},ba={class:"flex justify-between items-center"},xa={key:1,class:"mb-4 text-red-700 text-sm flex justify-between"},ga={key:2,class:"print:hidden flex flex-wrap gap-2 items-center justify-between w-full text-sm"},ya={class:"flex gap-2"},el={__name:"RequirementShow",setup(d){const $=Xe(),v=Ze(),p=w(""),u=Ge(),t=Ye(),i=z(()=>{if(!s.value)return[];const I=new Map;return s.value.tasks&&s.value.tasks.forEach(o=>I.set(o.id,o)),Array.from(I.values())}),f=z(()=>{var J,X;if(!s.value)return[];const I=new Map,o=(b,x)=>{b&&(!b.department&&x&&(b.department={id:x.id,name:x.name,short_name:x.short_name}),I.set(b.id,b))};return(J=s.value.from_department)!=null&&J.users&&s.value.from_department.users.forEach(b=>{o(b,s.value.from_department)}),(X=s.value.to_department)!=null&&X.users&&s.value.to_department.users.forEach(b=>{o(b,s.value.to_department)}),s.value.tasks&&s.value.tasks.forEach(b=>{b.users&&b.users.forEach(x=>o(x,x.department))}),Array.from(I.values())}),g=w(),C=w(!1),s=w(null),a=ve({detail:null,open:!1}),l=w(!1),y=w(!1),k=w({withTasks:!0,taskOption:"list",withMessages:!0,withApprovals:!0,withAttachments:!0}),q=()=>l.value=!0,T=()=>l.value=!1,N=()=>{y.value=!0},j=async I=>{k.value=I,y.value=!1,I.withMessages&&await t.fetchComments({commentable_type:"requirement",commentable_id:s.value.id}),l.value=!0,await ge(),window.print()},A=w(),U=w(""),G=w({isOpen:!1,taskId:null});_e(async()=>{await W(),window.addEventListener("beforeprint",q),window.addEventListener("afterprint",T),window.addEventListener("resize",ee),await ge(),ft(g.value,()=>{})});function ee(){}ze(()=>{window.removeEventListener("beforeprint",q),window.removeEventListener("afterprint",T),window.removeEventListener("resize",ee)});async function W(){p.value="loading";const I=(await we($.params.id)).data;s.value=I==null?void 0:I.requirement,U.value=I==null?void 0:I.user_department_position,p.value=""}function oe(){var I,o,J,X,b,x,P,K,_;if(u.user.role!=="super_admin"&&((I=u.user)==null?void 0:I.id)!==((J=(o=s.value)==null?void 0:o.to_department)==null?void 0:J.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(b=(X=s.value)==null?void 0:X.to_department)==null?void 0:b.name}'s In charge can create or assign.`);console.log({requirement:s}),R.modalShown=!0,R.from_department_id=s.value.from_department_id,R.to_department_id=s.value.to_department_id,R.taskDefaultValues={title:"",description:"",from_department_id:s.value.from_department_id,to_department_id:s.value.to_department_id,is_important:((x=s.value)==null?void 0:x.priority)=="IMPORTANT",is_urgent:((P=s.value)==null?void 0:P.priority)=="URGENT",supervisor_ids:(K=s.value)!=null&&K.supervisor_id?[(_=s.value)==null?void 0:_.supervisor_id]:[]},R.requirement=s.value}const R=ve({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function se(){A.value=null,R.modalShown=!1,await W()}async function ne(){R.modalShown=!1,R.requirement=null,R.creating=!1}const Q=w({open:!1});return(I,o)=>{var X,b,x,P,K,_,de,ae,me,ce,F,le,qe,Ce,Te,je,Ae,Re,Se,Oe,Ie,Me,Ne;const J=Fe("RouterLink");return n(),r("div",_o,[a.open?(n(),L(Z,{key:0},{default:M(()=>[h(Qs,{requirementId:s.value.id,onCloseClick:o[0]||(o[0]=O=>a.open=!1),onUpdate:o[1]||(o[1]=async()=>{a.open=!1,await W()})},null,8,["requirementId"])]),_:1})):c("",!0),R.modalShown?(n(),L(Z,{key:1,class:"*:relative"},{default:M(()=>{var O;return[e("button",{onClick:D(ne,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},o[19]||(o[19]=[e("i",{class:"fas fa-times-circle"},null,-1)])),R!=null&&R.creating?c("",!0):(n(),L(uo,{key:0,"from-department-id":(O=s.value)==null?void 0:O.from_department_id,requirement:R==null?void 0:R.requirement,onCancelClick:ne,onAddNewTaskClick:o[2]||(o[2]=()=>{R.modalShown=!0,R.creating=!0}),onAssignTask:se},null,8,["from-department-id","requirement"])),R!=null&&R.creating?(n(),L(et,{key:1,requirementId:s.value.id,onClose:ne,onTaskCreated:se,defaultValues:R.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementId","defaultValues"])):c("",!0)]}),_:1})):c("",!0),A.value?(n(),L(Z,{key:2},{default:M(()=>[h(pt,{taskId:A.value,onClose:o[3]||(o[3]=O=>A.value=null),onUpdated:se},null,8,["taskId"])]),_:1})):c("",!0),G.value.isOpen?(n(),L(Z,{key:3,class:"*:max-w-4xl"},{default:M(()=>[h(vt,{taskId:G.value.taskId,onCancelClick:o[4]||(o[4]=()=>{G.value.isOpen=!1,G.value.taskId=0}),onSuccess:o[5]||(o[5]=()=>{G.value.isOpen=!1,G.value.taskId=0,p.value="loading",W()})},null,8,["taskId"])]),_:1})):c("",!0),Q.value.open?(n(),L(Z,{key:4},{default:M(()=>[h(Bs,{requirement:s.value,onClickCancel:o[6]||(o[6]=O=>Q.value.open=!1),onUpdateStatus:o[7]||(o[7]=()=>{W(),Q.value.open=!1})},null,8,["requirement"])]),_:1})):c("",!0),y.value?(n(),L(Z,{key:5},{default:M(()=>[h(un,{initialOptions:k.value,onClose:o[8]||(o[8]=O=>y.value=!1),onPrint:j},null,8,["initialOptions"])]),_:1})):c("",!0),C.value?(n(),L(Z,{key:6},{default:M(()=>{var O,be,ue,Ee;return[e("div",ko,[o[21]||(o[21]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon size-8",onClick:o[9]||(o[9]=D(Y=>C.value=!1,["prevent"]))},o[20]||(o[20]=[e("i",{class:"fas fa-times"},null,-1)]))]),(O=s.value)!=null&&O.closing_history&&((ue=(be=s.value)==null?void 0:be.closing_history)!=null&&ue.length)?(n(),r("div",ho,[e("table",wo,[o[22]||(o[22]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-right"},"Close/Open"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status")])],-1)),e("tbody",null,[(n(!0),r(B,null,H(((Ee=s.value)==null?void 0:Ee.closing_history)||[],Y=>(n(),r("tr",{key:Y.at,class:"text-sm"},[e("td",$o,m(Y==null?void 0:Y.type),1),e("td",qo,m(Y.at?E(ie)(Y.at):""),1),e("td",Co,[e("div",To,m(Y==null?void 0:Y.closing_note),1)]),e("td",jo,m(Y==null?void 0:Y.status),1)]))),128))])])])):c("",!0)]}),_:1})):c("",!0),e("div",Ao,[s.value?(n(),r("div",Ro,[e("div",So,[e("div",Oo,[e("div",Io,[e("button",{class:"btn-3 h-8 px-4",onClick:o[10]||(o[10]=D(()=>E(v).back(),["prevent"]))},"Back"),e("div",Mo,m(((X=s.value)==null?void 0:X.title)||"Requirement Form"),1)]),e("button",{class:"btn-indigo-light text-xs font-bold btn-3 h-8 px-4",onClick:D(N,["prevent"])},o[23]||(o[23]=[e("i",{class:"fas fa-print mr-1"},null,-1),S(" PRINT ")]))]),o[35]||(o[35]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",No,[e("div",null,[e("div",Eo,[h(fe,{"line-clamp":"3",class:"mb-2"},{default:M(()=>[S(m(s.value.title),1)]),btnText:M(({lineClampClass:O})=>[S(m(O?"More":"Less"),1)]),_:1}),e("div",Lo,[e("div",Do,[o[24]||(o[24]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),S(" "+m(E(ie)(s.value.created_at)),1)]),s.value.created_by?(n(),r("div",Uo,[o[25]||(o[25]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),h(pe,{"show-details-on-avatar-hover":E(u).isAdminMood,"avatar-size":"xsmall",user:s.value.created_by,class:"border-sky-300"},null,8,["show-details-on-avatar-hover","user"])])):c("",!0)])]),s.value.description?(n(),r("div",Po,[o[26]||(o[26]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),h(fe,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:M(()=>[h(ye,{message:s.value.description},null,8,["message"])]),_:1})])):c("",!0)])]),e("div",Bo,[h(ke,{class:"mb-4"},{default:M(()=>[e("h2",Vo,[o[27]||(o[27]=e("span",null,"Task List ",-1)),s.value.status=="approved"?(n(),r("span",{key:0,class:V(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":s.value.tasks_count>0&&s.value.completed_tasks_count==s.value.tasks_count,"text-red-700 font-semibold":s.value.tasks_count==0||s.value.completed_tasks_count!=s.value.tasks_count}]])}," ("+m(s.value.completed_tasks_count)+"/"+m(s.value.tasks_count)+" task(s) done) ",3)):c("",!0)])]),_:1}),e("div",Fo,[e("table",Ho,[o[29]||(o[29]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[p.value!="loading"&&((x=(b=s.value)==null?void 0:b.tasks)==null?void 0:x.length)===0?(n(),r("tr",zo,o[28]||(o[28]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),r(B,{key:1},H(((P=s.value)==null?void 0:P.tasks)||[],(O,be)=>(n(),L(rt,{key:O.id,task:O,indexing:be+1,class:"*:py-3 *:border-b-0",onEditClick:o[11]||(o[11]=ue=>A.value=ue),onEmployeeAssignClick:o[12]||(o[12]=ue=>{G.value.isOpen=!0,G.value.taskId=ue})},null,8,["task","indexing"]))),128))])])])]),e("div",Go,[h(ke,{class:"mb-4"},{default:M(()=>o[30]||(o[30]=[e("h2",{class:"font-semibold text-lg px-2"},"Comments",-1)])),_:1,__:[30]}),h(rs,{"commentable-type":"requirement","commentable-id":s.value.id,"current-user":E(u).user,"mentionable-users":f.value,"mentionable-tasks":i.value,"reply-to-id":E($).query.comment_id},null,8,["commentable-id","current-user","mentionable-users","mentionable-tasks","reply-to-id"])]),c("",!0),p.value!="loading"&&!((K=s.value)!=null&&K.submission_date)?(n(),r("div",Wo,[e("div",Yo,[h(ao,{"requirement-id":(_=s.value)==null?void 0:_.id,onSuccess:W,"requirement-note":U.value=="in_charge"},{heading:M(()=>o[31]||(o[31]=[S(" Requirement Submission ")])),acceptButtonLabel:M(()=>o[32]||(o[32]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),S("Submit Requirement ")],-1)])),submitButtonLabel:M(()=>o[33]||(o[33]=[S(" Submit Requirement ")])),_:1},8,["requirement-id","requirement-note"])])])):c("",!0),(de=s.value)!=null&&de.submission_date?(n(),r("div",Ko,[h(ke,null,{default:M(()=>o[34]||(o[34]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[34]}),e("div",Qo,[(n(),r(B,null,H(["from_in_charge","from_coordinator"],O=>h(Be,{class:"pt-12",key:O,requirement:s.value,"approval-type":O,onUpdateApproval:o[14]||(o[14]=()=>W())},null,8,["requirement","approval-type"])),64))]),((ae=s.value)==null?void 0:ae.from_department_id)!==((me=s.value)==null?void 0:me.to_department_id)?(n(),r("div",Jo,[(n(),r(B,null,H(["to_in_charge","to_coordinator"],O=>h(Be,{class:"pt-12",key:O,requirement:s.value,"approval-type":O,onUpdateApproval:o[15]||(o[15]=()=>W())},null,8,["requirement","approval-type"])),64))])):c("",!0)])):c("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:g},[e("div",Xo,[e("div",Zo,[e("div",null,[e("div",ea,[o[36]||(o[36]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),h(Pe,{department:(ce=s.value)==null?void 0:ce.from_department,"short-name":!0},null,8,["department"])]),o[37]||(o[37]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",ta,[(F=s.value)!=null&&F.supervisor?(n(),L(pe,{key:0,"show-details-on-avatar-hover":E(u).isAdminMood,user:(le=s.value)==null?void 0:le.supervisor},null,8,["show-details-on-avatar-hover","user"])):c("",!0)])]),o[39]||(o[39]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",sa,[o[38]||(o[38]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),h(Pe,{department:(qe=s.value)==null?void 0:qe.to_department,"short-name":!0},null,8,["department"])])])]),e("div",na,[o[40]||(o[40]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",ra,m((Ce=s.value)==null?void 0:Ce.id),1)]),((je=(Te=s.value)==null?void 0:Te.website_tags)==null?void 0:je.length)>0?(n(),r("div",oa,[o[41]||(o[41]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",aa,[(n(!0),r(B,null,H(((Ae=s.value)==null?void 0:Ae.website_tags)||[],O=>(n(),r("div",{key:O.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},m(O.name),1))),128))])])):c("",!0),(Re=s.value)!=null&&Re.submission_date?(n(),r("div",la,[o[42]||(o[42]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",ia,m(E(ie)((Se=s.value)==null?void 0:Se.submission_date)),1)])):c("",!0),(Oe=s.value)!=null&&Oe.better_to_complete_on?(n(),r("div",da,[o[43]||(o[43]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",ua,m(E(Qe)((Ie=s.value)==null?void 0:Ie.better_to_complete_on,{weekDay:"long"})),1)])):c("",!0),e("div",null,[e("div",ma,[o[44]||(o[44]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:V(["font-semibold text-sm",{"text-yellow-600 ":s.value.priority=="IMPORTANT","text-red-700 ":s.value.priority=="URGENT"}])},m(s.value.priority||"NORMAL"),3)])]),e("div",ca,[e("div",pa,[o[45]||(o[45]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),s.value.status?(n(),r("span",{key:0,class:V(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":s.value.status!="approved","bg-green-300 text-green-700 border-green-400":s.value.status=="approved"}])},m(String(s.value.status).toUpperCase()),3)):(n(),r("span",va,"..."))])]),s.value.rejected_by?(n(),r("div",fa,[e("div",ba,[o[46]||(o[46]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),h(pe,{user:s.value.rejected_by},null,8,["user"])])])):c("",!0),s.value.rejection_reason?(n(),r("div",xa,[o[47]||(o[47]=e("p",{class:"text-gray-600 mb-1"},"Reason:",-1)),e("p",null,m(s.value.rejection_reason),1)])):c("",!0),o[50]||(o[50]=e("hr",{class:"mb-3"},null,-1)),(Me=s.value)!=null&&Me.closed_at?c("",!0):(n(),r("div",ga,[e("div",ya,[s.value.status=="approved"?(n(),r("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:D(oe,["prevent"])},o[48]||(o[48]=[e("i",{class:"fas fa-plus text-sm"},null,-1),S(" Add/Assign Task ")]))):c("",!0)]),h(J,{class:"btn-2 h-8",to:`/requirements/edit/${(Ne=s.value)==null?void 0:Ne.id}`},{default:M(()=>o[49]||(o[49]=[S(" Edit ")])),_:1,__:[49]},8,["to"])]))])]),h(As,{requirement:s.value,onReOpenClick:o[16]||(o[16]=O=>Q.value.open=!0),class:"mb-4 card-bg bg-white",onCloseClick:o[17]||(o[17]=O=>Q.value.open=!0),onShowHistoryClick:o[18]||(o[18]=O=>C.value=!C.value)},null,8,["requirement"]),h(xs,{requirement:s.value,class:"mb-4"},null,8,["requirement"]),h(tt,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3",ref:"shareComponent"},null,512)],512)])):c("",!0),p.value==="loading"?(n(),L($e,{key:1,class:"absolute inset-0 bg-opacity-90"})):c("",!0)]),s.value&&l.value?(n(),L(Jr,{key:7,class:"hidden print:block",requirement:s.value,options:k.value,comments:E(t).comments},null,8,["requirement","options","comments"])):c("",!0)])}}};export{el as default};
