import{d as G,r as v,q as x,e as H,c as r,o,a as t,t as h,w as A,f as u,l as E,p as w,F as J,x as K,m as P,g as b,D as S,y as Q,v as F}from"./index-Zc0U-t8d.js";import{_ as R}from"./MultiselectDropdown-BxI9lxJg.js";import{_ as z}from"./UserChip-kHexsVsb.js";import{a as B}from"./datetime-q3Sn87-f.js";import{u as W}from"./company-DMAwJaWk.js";import{u as X}from"./useTaskStore-Bm04waaw.js";import{u as Z}from"./user-CEYmNYAf.js";const ee={class:"px-4 max-h-[90vh] overflow-auto rounded"},te={class:"sticky top-0 bg-white z-20"},se={class:"mb-2 font-semibold text-gray-600 text-sm leading-none"},ae={key:0,class:"text-center text-gray-500 py-4"},le={class:"mb-4"},oe={class:"mb-2 flex flex-wrap gap-2"},re=["onClick"],ie={key:0,class:"my-6 text-center w-full relative"},ne={class:"flex gap-16 items-center mb-8"},ue={key:0,class:"flex gap-1 items-center"},de={key:1,class:"flex gap-1 items-center"},me={key:1,class:"mt-8"},pe={class:"grid grid-cols-2 gap-4 mb-4 mt-12"},ce={key:0,class:"mb-4"},ve={key:1,class:"mb-4"},ge={class:"flex justify-between items-center gap-4 sticky bottom-0 bg-white border-t px-4 -mx-4 py-3"},be={key:0,class:"mb-4 text-red-500 font-medium"},fe={key:1,class:"mb-4 text-blue-500 font-medium"},ye=["disabled"],Me={__name:"TaskUserAssignForm",props:{taskId:{type:[Number,String],required:!0}},emits:["success","cancelClick"],setup(D,{emit:I}){var T;const C=X(),N=W(),M=Z(),i=G(),d=v([]),O=x(()=>d.value.map(s=>s.id)),n=v(""),f=v(null),y=v([]),U=D,p=v(null),l=v({...((T=i.user)==null?void 0:T.role)=="employee"?{}:{is_important:!1,is_urgent:!1,is_target:!1,started_at:"",deadline:""}}),V=I;H(async()=>{var e,m,a,g,_,k;n.value="loading";const s=await C.fetchTask(U.taskId,{with_parent:"true"},{loadingBeforeFetch:!1,fetchOnly:!0});p.value=s.task,p.value.parent?y.value=((m=(e=p.value)==null?void 0:e.parent)==null?void 0:m.users)||[]:((a=i.user)==null?void 0:a.role)==="employee"?y.value=((k=(_=await N.fetchEmployees((g=i.user)==null?void 0:g.company_id))==null?void 0:_.data)==null?void 0:k.employees)||[]:(await M.fetchUsers(),y.value=M.users),q(p.value),d.value=p.value.users,n.value=""});const $=x(()=>y.value.filter(s=>!d.value.find(e=>e.id===s.id))),j=async()=>{var s,e;n.value="submitting",f.value=null;try{await C.updateTask(U.taskId,{...l.value,user_ids:O.value},{loadingBeforeFetch:!1}),V("success")}catch(m){f.value=((e=(s=m.response)==null?void 0:s.data)==null?void 0:e.message)||"Assign users failed"}finally{n.value=""}};function q(s){var e;l.value={...((e=i.user)==null?void 0:e.role)=="employee"?{}:{is_important:s.is_important,is_urgent:s.is_urgent,is_target:s.is_target,started_at:B(s.started_at),deadline:B(s.deadline)}}}const L=x(()=>Object.values(c.value).reduce((s,e)=>e||s,!1)),c=x(()=>{let s={is_important:!1,is_urgent:!1,is_target:!1,started_at:!1,deadline:!1};return i.user.role==="employee"||(s.is_important=i.isAdminMood,s.is_urgent=i.isAdminMood,s.is_target=i.isAdminMood,s.started_at=i.isAdminMood,s.deadline=i.isAdminMood),s});return(s,e)=>{var m;return o(),r("div",ee,[t("div",te,[e[7]||(e[7]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-1 mt-4"},"Manage Employee(s) for Task",-1)),t("h3",se,h((m=p.value)==null?void 0:m.title),1),e[8]||(e[8]=t("hr",{class:"mb-4 !mt-0"},null,-1))]),n.value==="loading"?(o(),r("div",ae,"Loading users...")):(o(),r("form",{key:1,onSubmit:A(j,["prevent"])},[t("div",le,[e[9]||(e[9]=t("label",{class:"block uppercase text-xs text-gray-600"},"Employees",-1)),E(R,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),options:$.value,multiple:!0,"track-by":"id",label:"label",placeholder:"Select users"},{selection:w(({...a})=>[t("div",oe,[(o(!0),r(J,null,K((a==null?void 0:a.values)||[],g=>(o(),P(z,{key:g.id,user:g},{after:w(({user:_})=>[t("button",{class:"size-6 border rounded-full hover:bg-red-400 hover:text-white",onClick:A(k=>d.value=d.value.filter(Y=>Y.id!==_.id),["prevent"])}," Ã— ",8,re)]),_:2},1032,["user"]))),128))])]),option:w(({option:a})=>[E(z,{user:a},null,8,["user"])]),_:1},8,["modelValue","options"])]),L.value?(o(),r("h3",ie,e[10]||(e[10]=[t("div",{class:"inline-block bg-white px-4"},[t("b",{class:"fas fa-cog text-gray-400"}),t("span",{class:"text-gray-700 ml-2"},"Task Settings for Employee")],-1),t("hr",{class:"bottom-0 border-gray-300 -mt-3"},null,-1)]))):u("",!0),t("div",ne,[c.value.is_important?(o(),r("label",ue,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.is_important=a),class:"size-4"},null,512),[[S,l.value.is_important]]),e[11]||(e[11]=t("span",{class:"block text-gray-600 text-base font-medium"},"Important",-1))])):u("",!0),c.value.is_urgent?(o(),r("label",de,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>l.value.is_urgent=a),class:"size-4"},null,512),[[S,l.value.is_urgent]]),e[12]||(e[12]=t("span",{class:"block text-gray-600 text-base font-medium"},"Urgent",-1))])):u("",!0)]),c.value.is_target?(o(),r("div",me,[t("label",{class:Q(["flex gap-1 items-center mt-4 border rounded py-2 justify-center cursor-pointer",{"bg-yellow-200":l.value.is_target}])},[b(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.is_target=a),class:"size-6"},null,512),[[S,l.value.is_target]]),e[13]||(e[13]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Is Target Task",-1))],2)])):u("",!0),t("div",pe,[c.value.started_at?(o(),r("div",ce,[e[14]||(e[14]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"}," Start Date ",-1)),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.started_at=a),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,l.value.started_at]])])):u("",!0),c.value.deadline?(o(),r("div",ve,[e[15]||(e[15]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"}," Deadline ",-1)),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.deadline=a),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,l.value.deadline]])])):u("",!0)]),t("div",ge,[f.value?(o(),r("div",be,h(f.value),1)):u("",!0),n.value=="submitting"?(o(),r("div",fe," Saving changes... ")):u("",!0),t("button",{disabled:n.value=="submitting"||n.value=="loading",type:"submit",class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-5 py-2 rounded transition"},h(n.value=="submitting"?"Saving...":"Save"),9,ye),t("button",{type:"button",onClick:e[6]||(e[6]=a=>V("cancelClick")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32))])}}};export{Me as _};
