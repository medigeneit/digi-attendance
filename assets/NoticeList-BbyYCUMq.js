import{_ as ie,u as ne,D as de,h as ue,r as p,x,ab as ce,p as pe,c as o,o as r,a as t,d as m,l as v,k as T,j as d,v as xe,H as Y,s as A,b as c,Q as me,F as b,e as w,t as i,m as fe,z as ve,T as be}from"./index-Bk_cpFMT.js";import{L as _e}from"./LoaderView-CrNiOl1S.js";import{_ as ye}from"./FlexibleDatePicker-BZCc2Vaj.js";import{u as he}from"./notice-3ndtCCaH.js";const ge={class:"space-y-4 px-4 pb-6"},we={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},ke={class:"flex flex-wrap items-center gap-3"},Ne={class:"flex gap-2"},Ce={class:"sticky top-14 z-10 rounded-2xl border border-slate-200 bg-white/90 backdrop-blur p-3 print:hidden"},Me={class:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between"},De={class:"flex-1"},Te={class:"flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2"},Ae={class:"flex flex-wrap items-center gap-2"},Le=["title"],Ee={class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm"},Se={class:"mt-3"},je={class:"mt-2 flex gap-2 overflow-x-auto pb-1"},Pe=["onClick"],Ve={class:"ml-1 rounded-full bg-white/20 px-2 py-0.5 text-[10px] font-bold"},Fe={key:0,class:"flex justify-center py-12"},Ue={key:0,class:"rounded-2xl border border-dashed border-slate-300 bg-white p-8 text-center text-sm text-slate-500"},Be={class:"space-y-3 md:hidden"},$e={class:"flex items-start justify-between gap-3"},Re={class:"min-w-0"},ze=["title"],Ye={class:"mt-1 text-[11px] text-slate-500"},Oe={key:0},He={class:"mt-2 flex flex-wrap gap-1"},Ke={key:0,class:"mt-3 text-sm text-slate-600 line-clamp-3"},qe={class:"mt-3 flex items-center justify-between"},Ge={class:"flex items-center gap-2"},We={key:0,class:"rounded-full bg-rose-50 px-2 py-0.5 text-[11px] font-semibold text-rose-700"},Ie={key:1,class:"rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-semibold text-emerald-700"},Je={class:"flex gap-2"},Qe=["onClick"],Xe={class:"hidden md:block rounded-2xl border border-slate-200 bg-white shadow-sm"},Ze={class:"min-w-full table-auto divide-y divide-slate-200 text-sm"},et={class:"divide-y divide-slate-100"},tt={class:"px-4 py-3 font-medium text-slate-600"},st={class:"px-4 py-3"},lt={class:"flex items-start gap-2"},at={class:"min-w-0"},ot=["title"],rt=["title"],it={class:"mt-0.5 text-[11px] text-slate-500"},nt={key:0,class:"mr-2 rounded-full bg-rose-50 px-2 py-0.5 font-semibold text-rose-700"},dt={key:1,class:"rounded-full bg-emerald-50 px-2 py-0.5 font-semibold text-emerald-700"},ut=["onClick"],ct={class:"px-4 py-3"},pt={class:"px-4 py-3"},xt={class:"flex flex-wrap gap-1 max-w-[22rem]"},mt={class:"px-4 py-3 text-slate-600"},ft={class:"px-4 py-3 text-slate-600"},vt={class:"px-4 py-3 text-center"},bt={class:"px-4 py-3 text-center"},_t={class:"flex items-center justify-center gap-2"},yt={key:0,class:"flex flex-wrap items-center justify-between gap-2 pt-2"},ht={class:"text-xs text-slate-500"},gt={class:"text-slate-800"},wt={class:"text-slate-800"},kt={class:"text-slate-800"},Nt={class:"flex items-center gap-2"},Ct=["disabled"],Mt=["disabled"],Dt={class:"relative w-full max-w-3xl overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-xl"},Tt={class:"border-b border-slate-200 p-5"},At={class:"flex items-start justify-between gap-4"},Lt={class:"min-w-0"},Et={class:"text-lg font-semibold text-slate-900 truncate"},St={class:"mt-1 text-xs text-slate-500"},jt={key:0},Pt={class:"mt-2 flex flex-wrap gap-2"},Vt={key:0,class:"rounded-full bg-rose-50 px-3 py-1 text-[11px] font-semibold text-rose-700"},Ft={key:1,class:"rounded-full bg-emerald-50 px-3 py-1 text-[11px] font-semibold text-emerald-700"},Ut={class:"mt-2 flex flex-wrap gap-1"},Bt={class:"max-h-[70vh] overflow-y-auto p-5"},$t={key:0,class:"prose prose-sm max-w-none text-slate-700"},Rt=["innerHTML"],zt={key:1,class:"text-sm text-slate-500"},Yt={key:2,class:"mt-5 rounded-xl border border-slate-200 bg-slate-50 p-4"},Ot=["href"],Ht={class:"border-t border-slate-200 p-4 flex items-center justify-end gap-2"},Kt={__name:"NoticeList",setup(qt){const J=ne(),U=he(),{notices:O}=de(U);ue(()=>{U.fetchNotices()});const Q=()=>J.go(-1),y=p(""),k=p("all"),N=p("all"),L=p(!0),C=p("published_at"),h=p("desc"),g=p(15),E=p(1),S=new Date,B=p({year:S.getFullYear(),month:S.getMonth()+1,day:S.getDate()}),H=x(()=>{var l;return((l=B.value)==null?void 0:l.year)??S.getFullYear()}),$=p(!1),n=p(null),K=l=>{n.value=l,$.value=!0},M=()=>{$.value=!1,n.value=null},j=l=>(l||"").toLowerCase().trim().replace(/\s+/g,"_"),D=l=>!l||l==="all"?"All employees":l.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ");function X(l){if(l==null)return["all"];if(Array.isArray(l)){const a=l.map(s=>j(String(s))).filter(Boolean);return a.length?a:["all"]}const e=String(l).trim();if(!e)return["all"];if(e.startsWith("[")&&e.endsWith("]"))try{const a=JSON.parse(e);if(Array.isArray(a)){const s=a.map(u=>j(String(u))).filter(Boolean);return s.length?s:["all"]}}catch{}return[j(e)].filter(Boolean).length?[j(e)]:["all"]}const P=l=>{if(!l)return"-";const e=new Date(l);return Number.isNaN(e.getTime())?"-":e.toLocaleString("en-US",{month:"short",year:"numeric",day:"numeric"})},q=l=>{if(!l)return"-";const e=new Date(l);return Number.isNaN(e.getTime())?"-":e.toLocaleString()},Z=l=>l?String(l).replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim():"",ee=l=>Number(l)===1?{label:"General",classes:"bg-sky-100 text-sky-700 border-sky-200"}:Number(l)===2?{label:"Policy",classes:"bg-amber-100 text-amber-700 border-amber-200"}:{label:"Other",classes:"bg-slate-100 text-slate-700 border-slate-200"},te=l=>{const e=l==null?void 0:l.expired_at;if(!e)return!1;const a=new Date(e);return Number.isNaN(a.getTime())?!1:a.getTime()<Date.now()},se=(l,e)=>{if(!l||!e)return!1;const a=new Date(l);return Number.isNaN(a.getTime())?!1:a.getFullYear()===Number(e)},R=x(()=>(Array.isArray(O.value)?O.value:[]).map(e=>{var f;const a=X(e==null?void 0:e.receiver_type),s=Array.isArray(e==null?void 0:e.companies_notice)?e.companies_notice:[],u=s.length>0?s.map(F=>F.name).join(", "):((f=e==null?void 0:e.company)==null?void 0:f.name)||"Multiple Companies";return{...e,_companyName:u,_typeMeta:ee(e==null?void 0:e.type),_receivers:a,_receiversLabel:a.map(D).join(", "),_plainDesc:Z(e==null?void 0:e.description),_expired:te(e)}})),le=x(()=>{const l=new Map;return l.set("all",0),R.value.forEach(a=>{a._receivers.forEach(s=>{l.set(s,(l.get(s)||0)+1)})}),l.set("all",R.value.length),Array.from(l.entries()).sort((a,s)=>a[0]==="all"?-1:s[0]==="all"?1:(s[1]||0)-(a[1]||0)).map(([a,s])=>({key:a,count:s}))}),ae=x(()=>{const l=y.value.trim().toLowerCase();return R.value.filter(e=>!(k.value!=="all"&&!e._receivers.includes(k.value)||N.value!=="all"&&String(e==null?void 0:e.type)!==String(N.value)||!L.value&&e._expired||e!=null&&e.expired_at&&!se(e==null?void 0:e.expired_at,H.value)||l&&![(e==null?void 0:e.title)||"",(e==null?void 0:e._companyName)||"",(e==null?void 0:e._receiversLabel)||"",(e==null?void 0:e._plainDesc)||""].join(" ").toLowerCase().includes(l)))}),G=x(()=>{const l=[...ae.value],e=h.value==="asc"?1:-1,a=s=>C.value==="title"?((s==null?void 0:s.title)||"").toLowerCase():C.value==="expired_at"?new Date((s==null?void 0:s.expired_at)||0).getTime():new Date((s==null?void 0:s.published_at)||0).getTime();return l.sort((s,u)=>{const f=a(s),F=a(u);return f<F?-1*e:f>F?1*e:0}),l}),z=x(()=>G.value.length),V=x(()=>Math.max(1,Math.ceil(z.value/Number(g.value||15)))),_=x(()=>Math.min(Math.max(1,E.value),V.value)),W=x(()=>{const l=Number(g.value||15),e=(_.value-1)*l;return G.value.slice(e,e+l)});function oe(){E.value=1}const re=x(()=>[y.value,k.value,N.value,L.value,C.value,h.value,g.value,H.value].join("|"));ce(()=>{re.value,oe()});const I=x(()=>z.value>0);return(l,e)=>{const a=pe("RouterLink");return r(),o("div",ge,[t("div",we,[e[12]||(e[12]=t("div",{class:"space-y-1"},[t("p",{class:"text-xs font-semibold uppercase tracking-wider text-slate-500"},"Notice management"),t("h1",{class:"text-2xl font-semibold text-slate-900"},"Notice List"),t("p",{class:"text-sm text-slate-500"}," Search, filter by receiver/type, preview notice, and manage quickly. ")],-1)),t("div",ke,[t("div",Ne,[t("button",{class:"btn-3",onClick:Q},e[10]||(e[10]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),m(a,{to:{name:"NoticeAdd"},class:"btn-2"},{default:v(()=>e[11]||(e[11]=[t("span",{class:"hidden md:flex"},"Add New",-1),t("i",{class:"far fa-plus"},null,-1)])),_:1,__:[11]})])])]),t("div",Ce,[t("div",Me,[t("div",De,[t("div",Te,[e[13]||(e[13]=t("i",{class:"far fa-search text-slate-400"},null,-1)),T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),type:"text",placeholder:"Search title, company, receivers, description...",class:"w-full bg-transparent text-sm outline-none"},null,512),[[xe,y.value]]),y.value?(r(),o("button",{key:0,type:"button",class:"text-xs font-semibold text-slate-500 hover:text-slate-900",onClick:e[1]||(e[1]=s=>y.value="")}," Clear ")):d("",!0)])]),t("div",Ae,[m(ye,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=s=>B.value=s),"show-year":!0,"show-month":!1,"show-date":!1,label:"Year"},null,8,["modelValue"]),T(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>N.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-400/40"},e[14]||(e[14]=[t("option",{value:"all"},"All types",-1),t("option",{value:"1"},"General",-1),t("option",{value:"2"},"Policy",-1)]),512),[[Y,N.value]]),T(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>C.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-400/40"},e[15]||(e[15]=[t("option",{value:"published_at"},"Sort: Published",-1),t("option",{value:"expired_at"},"Sort: Expiry",-1),t("option",{value:"title"},"Sort: Title",-1)]),512),[[Y,C.value]]),t("button",{type:"button",class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50",onClick:e[5]||(e[5]=s=>h.value=h.value==="asc"?"desc":"asc"),title:h.value==="asc"?"Ascending":"Descending"},[t("i",{class:A(["far",h.value==="asc"?"fa-sort-amount-up":"fa-sort-amount-down"])},null,2)],8,Le),t("label",Ee,[T(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>L.value=s),type:"checkbox",class:"h-4 w-4 accent-sky-600"},null,512),[[me,L.value]]),e[16]||(e[16]=c(" Show expired "))]),T(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>g.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-sky-400/40"},e[17]||(e[17]=[t("option",{value:10},"10",-1),t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1)]),512),[[Y,g.value,void 0,{number:!0}]])])]),t("div",Se,[e[18]||(e[18]=t("div",{class:"flex items-center gap-2"},[t("p",{class:"text-xs font-semibold uppercase tracking-wider text-slate-500"},"Receivers"),t("div",{class:"h-px flex-1 bg-slate-100"})],-1)),t("div",je,[(r(!0),o(b,null,w(le.value,s=>(r(),o("button",{key:s.key,type:"button",class:A(["shrink-0 rounded-full border px-3 py-1 text-xs font-semibold transition",s.key===k.value?"border-sky-600 bg-sky-600 text-white":"border-slate-200 bg-white text-slate-600 hover:border-slate-400"]),onClick:u=>k.value=s.key},[c(i(D(s.key))+" ",1),t("span",Ve,i(s.count),1)],10,Pe))),128))])])]),fe(U).isLoading?(r(),o("div",Fe,[m(_e)])):(r(),o(b,{key:1},[I.value?(r(),o(b,{key:1},[t("div",Be,[(r(!0),o(b,null,w(W.value,s=>(r(),o("div",{key:"m-"+s.id,class:"rounded-2xl border border-slate-200 bg-white p-4 shadow-sm"},[t("div",$e,[t("div",Re,[t("div",{class:"text-sm font-semibold text-slate-900 truncate",title:s.title},i(s.title||"Untitled"),9,ze),t("div",Ye,[c(i(s._companyName)+" • Published "+i(P(s.published_at))+" ",1),s.expired_at?(r(),o("span",Oe," • Expires "+i(P(s.expired_at)),1)):d("",!0)])]),t("span",{class:A(["shrink-0 rounded-full border px-2 py-0.5 text-[11px] font-semibold",s._typeMeta.classes])},i(s._typeMeta.label),3)]),t("div",He,[(r(!0),o(b,null,w(s._receivers,u=>(r(),o("span",{key:s.id+"-"+u,class:"rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-600"},i(D(u)),1))),128))]),s._plainDesc?(r(),o("p",Ke,i(s._plainDesc),1)):d("",!0),t("div",qe,[t("div",Ge,[s._expired?(r(),o("span",We," Expired ")):d("",!0),s.file?(r(),o("span",Ie," Attachment ")):d("",!0)]),t("div",Je,[t("button",{class:"btn-4 gap-2",type:"button",onClick:u=>K(s)},e[19]||(e[19]=[t("i",{class:"far fa-eye"},null,-1),c(" Preview ")]),8,Qe),m(a,{to:{name:"NoticeEdit",params:{id:s.id}},class:"btn-4 gap-2"},{default:v(()=>e[20]||(e[20]=[t("i",{class:"far fa-edit"},null,-1),c(" Edit ")])),_:2,__:[20]},1032,["to"])])])]))),128))]),t("div",Xe,[t("table",Ze,[e[25]||(e[25]=t("thead",null,[t("tr",{class:"text-left text-xs uppercase tracking-widest text-slate-500 sticky top-44 z-50 bg-slate-50"},[t("th",{class:"px-4 py-3 font-medium"},"#"),t("th",{class:"px-4 py-3 font-medium"},"Title"),t("th",{class:"px-4 py-3 font-medium"},"Type"),t("th",{class:"px-4 py-3 font-medium"},"Receivers"),t("th",{class:"px-4 py-3 font-medium"},"Published"),t("th",{class:"px-4 py-3 font-medium"},"Expires"),t("th",{class:"px-4 py-3 font-medium text-center"},"Feedback"),t("th",{class:"px-4 py-3 font-medium text-center"},"Actions")])],-1)),t("tbody",et,[(r(!0),o(b,null,w(W.value,(s,u)=>(r(),o("tr",{key:s.id,class:"hover:bg-slate-50"},[t("td",tt,i((_.value-1)*Number(g.value)+u+1),1),t("td",st,[t("div",lt,[t("div",at,[t("div",{class:"font-semibold text-slate-900 truncate max-w-[22rem]",title:s.title},i(s.title||"Untitled"),9,ot),t("div",{class:"truncate block max-w-[15rem] mt-1 text-xs",title:s._companyName},i(s._companyName),9,rt),t("div",it,[s._expired?(r(),o("span",nt,"Expired")):d("",!0),s.file?(r(),o("span",dt,"Attachment")):d("",!0)])]),t("button",{type:"button",class:"shrink-0 rounded-lg border border-slate-200 bg-white px-2 py-1 text-xs font-semibold text-slate-600 hover:bg-slate-50",onClick:f=>K(s),title:"Preview"},e[21]||(e[21]=[t("i",{class:"far fa-eye"},null,-1)]),8,ut)])]),t("td",ct,[t("span",{class:A(["inline-flex items-center rounded-full border px-3 py-1 text-[11px] font-semibold",s._typeMeta.classes])},i(s._typeMeta.label),3)]),t("td",pt,[t("div",xt,[(r(!0),o(b,null,w(s._receivers,f=>(r(),o("span",{key:s.id+"-"+f,class:"rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-600"},i(D(f)),1))),128))])]),t("td",mt,i(P(s.published_at)),1),t("td",ft,i(P(s.expired_at)),1),t("td",vt,[m(a,{to:{name:"NoticeFeedbackShow",params:{id:s.id}},class:"btn-4 gap-2"},{default:v(()=>[e[22]||(e[22]=t("i",{class:"far fa-comments"},null,-1)),t("span",null,i((s==null?void 0:s.user_feedback_count)||0),1)]),_:2,__:[22]},1032,["to"])]),t("td",bt,[t("div",_t,[m(a,{to:{name:"MyNoticeDetails",params:{id:s.id}},class:"btn-icon",title:"View details"},{default:v(()=>e[23]||(e[23]=[t("i",{class:"far fa-eye"},null,-1)])),_:2,__:[23]},1032,["to"]),m(a,{to:{name:"NoticeEdit",params:{id:s.id}},class:"btn-icon",title:"Edit"},{default:v(()=>e[24]||(e[24]=[t("i",{class:"far fa-edit"},null,-1)])),_:2,__:[24]},1032,["to"])])])]))),128))])])]),I.value?(r(),o("div",yt,[t("div",ht,[e[26]||(e[26]=c(" Page ")),t("b",gt,i(_.value),1),e[27]||(e[27]=c(" of ")),t("b",wt,i(V.value),1),e[28]||(e[28]=c(" • Total ")),t("b",kt,i(z.value),1)]),t("div",Nt,[t("button",{type:"button",class:"rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-50",disabled:_.value<=1,onClick:e[8]||(e[8]=s=>E.value=Math.max(1,_.value-1))}," Prev ",8,Ct),t("button",{type:"button",class:"rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50 disabled:opacity-50",disabled:_.value>=V.value,onClick:e[9]||(e[9]=s=>E.value=Math.min(V.value,_.value+1))}," Next ",8,Mt)])])):d("",!0)],64)):(r(),o("div",Ue," No notices found for current filters. "))],64)),m(be,{name:"fade-scale"},{default:v(()=>[$.value&&n.value?(r(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:ve(M,["escape","window"])},[t("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm",onClick:M}),t("div",Dt,[t("div",Tt,[t("div",At,[t("div",Lt,[t("h3",Et,i(n.value.title||"Untitled"),1),t("p",St,[c(i(n.value._companyName)+" • Published "+i(q(n.value.published_at))+" ",1),n.value.expired_at?(r(),o("span",jt," • Expires "+i(q(n.value.expired_at)),1)):d("",!0)]),t("div",Pt,[t("span",{class:A(["rounded-full border px-3 py-1 text-[11px] font-semibold",n.value._typeMeta.classes])},i(n.value._typeMeta.label),3),n.value._expired?(r(),o("span",Vt," Expired ")):d("",!0),n.value.file?(r(),o("span",Ft," Attachment available ")):d("",!0)]),t("div",Ut,[(r(!0),o(b,null,w(n.value._receivers,s=>(r(),o("span",{key:"pv-"+n.value.id+"-"+s,class:"rounded-full bg-slate-100 px-3 py-1 text-[11px] font-semibold text-slate-600"},i(D(s)),1))),128))])]),t("button",{type:"button",class:"rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50",onClick:M}," Close ")])]),t("div",Bt,[n.value.description?(r(),o("div",$t,[t("div",{innerHTML:n.value.description},null,8,Rt)])):(r(),o("div",zt,"No description.")),n.value.file?(r(),o("div",Yt,[e[30]||(e[30]=t("div",{class:"text-xs font-semibold text-slate-700"},"Attachment",-1)),t("a",{class:"mt-1 inline-flex items-center gap-2 text-sm font-semibold text-sky-700 hover:text-sky-900",href:n.value.file,target:"_blank",rel:"noopener"},e[29]||(e[29]=[t("i",{class:"far fa-paperclip"},null,-1),c(" Open file ")]),8,Ot)])):d("",!0)]),t("div",Ht,[m(a,{to:{name:"MyNoticeDetails",params:{id:n.value.id}},class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50",onClick:M},{default:v(()=>e[31]||(e[31]=[c(" Open details ")])),_:1,__:[31]},8,["to"]),m(a,{to:{name:"NoticeEdit",params:{id:n.value.id}},class:"btn-2",onClick:M},{default:v(()=>e[32]||(e[32]=[c(" Edit ")])),_:1,__:[32]},8,["to"])])])],32)):d("",!0)]),_:1})])}}},Qt=ie(Kt,[["__scopeId","data-v-a861f14a"]]);export{Qt as default};
