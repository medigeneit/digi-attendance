import{d as oe,r as _,q as I,a2 as X,A as ae,e as ee,c as n,o as a,a as e,m as W,w as re,f as g,g as h,v as E,D as ne,t as c,F as $,x as T,h as p,a3 as B,l as C,u as de,b as ue,s as ie,k as ve,C as ce,n as L,p as Z,a4 as ye}from"./index-DKbLlhzy.js";import{_ as me}from"./EmployeeFilter-CbF8KvTC.js";import{L as te}from"./LoaderView-DroWayTX.js";import{_ as pe}from"./MultiselectDropdown-9TEQQ76Q.js";import{u as _e}from"./holiday-eXotF6lY.js";import{u as se}from"./leave-application-BD5p2qm8.js";import{u as fe}from"./leave-type-BWUvYguF.js";import{u as le}from"./user-D-eJFS6G.js";import"./company-BapoINIB.js";import"./department-BiD9GU-S.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"space-y-4 p-2 md:p-4"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe={class:"inline-flex items-center space-x-2"},he={key:0},we={class:"text-blue-600 font-medium"},ke={key:1,class:"bg-gray-100 p-2 rounded-md"},De={class:"font-semibold"},Ae={class:"flex flex-wrap gap-2"},Se=["name","value","onUpdate:modelValue"],Le={class:"flex items-center space-x-1"},$e=["name","onUpdate:modelValue"],Ue={class:"flex items-center space-x-1"},Ce=["name","onUpdate:modelValue"],Te={key:2},Ve={key:3},qe={key:4,class:"text-red-500 text-sm"},Fe={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(Y,{emit:V}){const d=Y,w=V,b=se(),S=fe(),U=le();oe();const q=_e(),D=_(""),k=_(!0),o=_({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),v=_([]),x=_(!1),A=_(null),N=I(()=>{var r,s,t;return((s=(r=d==null?void 0:d.userInfo)==null?void 0:r.assign_weekend)==null?void 0:s.weekends)||((t=d==null?void 0:d.userInfo)==null?void 0:t.weekends)}),m=I(()=>{const r=o.value.last_working_date,s=o.value.resumption_date;if(!r||!s)return[];const t=new Date(r),u=new Date(s);if(u<=t)return[];const y=[];let i=new Date(t);for(i.setDate(i.getDate()+1);i<u;){const f=i.getFullYear(),M=(i.getMonth()+1).toString().padStart(2,"0"),R=i.getDate().toString().padStart(2,"0");y.push(`${f}-${M}-${R}`),i.setDate(i.getDate()+1)}return y}),H=I(()=>{if(!o.value.last_working_date||!o.value.resumption_date)return"";const r=new Date(o.value.last_working_date);return new Date(o.value.resumption_date)<=r?"Resumption date must be after Last Working Date.":m.value.length===0?"No leave days between the selected dates.":`Total leave days: ${m.value.length}`});X(()=>{m.value.length&&S.leaveTypes.length&&(v.value.length!==m.value.length&&(v.value=m.value.map(()=>S.leaveTypes[0].id)),m.value.forEach(async(r,s)=>{const t=new Date(r).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),u=t.charAt(0).toUpperCase()+t.slice(1);N.value.includes(u)&&(v.value[s]="weekend"),await F(r)&&(v.value[s]="holiday")}))}),ae(()=>D.value,r=>{o.value.handover_user_id=r==null?void 0:r.id});const j=async()=>{var r;x.value=!0,A.value=null;try{const s=m.value.map((i,f)=>({date:i,leave_type_id:v.value[f]!=="weekend"&&v.value[f]!=="holiday"?v.value[f]:null})).filter(i=>i.leave_type_id!==null),t=m.value.map((i,f)=>({date:i,leave_type_id:v.value[f]||""})).filter(i=>i.leave_type_id!==null),u={user_id:(r=d==null?void 0:d.userInfo)==null?void 0:r.id,last_working_date:o.value.last_working_date,resumption_date:o.value.resumption_date,reason:o.value.reason,works_in_hand:o.value.works_in_hand,handover_user_id:k.value?null:o.value.handover_user_id,leave_days:s,json_data:t,is_direct_approve:k.value};await b.storeAdminLeaveApplication(u)&&w("formSuccessClosed")}catch(s){A.value=s.message||"Failed to submit leave application"}finally{x.value=!1}};ee(()=>{X(()=>{var s;const r=(s=d==null?void 0:d.userInfo)==null?void 0:s.company_id;r&&S.fetchLeaveTypes(r)}),U.fetchTypeWiseEmployees({except:"auth"})});const F=async r=>{var s;try{return(((s=(await q.fetchHolidays({start_date:r}))[0])==null?void 0:s.start_date)||[]).includes(r)}catch(t){return console.error("Error fetching holidays:",t),!1}};return(r,s)=>(a(),n("div",ge,[s[16]||(s[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),x.value?(a(),W(te,{key:0})):(a(),n("form",{key:1,onSubmit:re(j,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",be,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),h(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=t=>o.value.last_working_date=t),class:"input-1 w-full",required:""},null,512),[[E,o.value.last_working_date]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),h(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=t=>o.value.resumption_date=t),class:"input-1 w-full",required:""},null,512),[[E,o.value.resumption_date]])])]),e("div",null,[e("label",xe,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=t=>k.value=t),class:"form-checkbox text-blue-600"},null,512),[[ne,k.value]]),s[8]||(s[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),o.value.last_working_date&&o.value.resumption_date?(a(),n("div",he,[e("p",we,c(H.value),1)])):g("",!0),m.value.length?(a(),n("div",ke,[s[11]||(s[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),e("div",null,[(a(!0),n($,null,T(m.value,(t,u)=>(a(),n("div",{key:u,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[e("div",De,c(t),1),e("div",Ae,[(a(!0),n($,null,T(p(S).leaveTypes,y=>(a(),n("label",{key:y.id,class:"flex items-center space-x-1"},[h(e("input",{type:"radio",name:"leaveType-"+u,value:y.id,"onUpdate:modelValue":i=>v.value[u]=i},null,8,Se),[[B,v.value[u]]]),e("span",null,c(y.name),1)]))),128)),e("label",Le,[h(e("input",{type:"radio",name:"leaveType-"+u,value:"weekend","onUpdate:modelValue":y=>v.value[u]=y},null,8,$e),[[B,v.value[u]]]),s[9]||(s[9]=e("span",null,"Weekend",-1))]),e("label",Ue,[h(e("input",{type:"radio",name:"leaveType-"+u,value:"holiday","onUpdate:modelValue":y=>v.value[u]=y},null,8,Ce),[[B,v.value[u]]]),s[10]||(s[10]=e("span",null,"Holiday",-1))])])]))),128))])])):g("",!0),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),h(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=t=>o.value.reason=t),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[E,o.value.reason]])]),k.value?g("",!0):(a(),n("div",Te,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),C(pe,{modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=t=>D.value=t),options:p(U).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),k.value?g("",!0):(a(),n("div",Ve,[s[14]||(s[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),h(e("textarea",{id:"works-in-hand","onUpdate:modelValue":s[5]||(s[5]=t=>o.value.works_in_hand=t),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[E,o.value.works_in_hand]])])),A.value?(a(),n("div",qe,c(A.value),1)):g("",!0),s[15]||(s[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Me={class:"space-y-2 px-4"},Re={class:"flex flex-wrap gap-2"},Ee=["value"],Ie={key:0,class:"text-center py-4"},Ne={key:1,class:"space-y-4"},He={class:"overflow-x-auto"},je={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},Be={key:0,class:"bg-sky-200/20 text-center"},We={class:"border border-gray-300 py-2 text-center",colspan:"3"},Ye={class:""},ze={class:"grid md:grid-cols-2"},Pe={class:"py-1"},Oe={class:"py-1"},Je={class:"py-1"},Ge={class:"py-1"},Ke={class:"py-1"},Qe={class:"py-1"},Xe={class:"border border-gray-300 py-2 text-center",colspan:"4"},Ze={class:""},et={class:"overflow-x-auto min-h-max"},tt={class:"min-w-full text-sm text-left text-gray-500"},st={class:"px-6 text-center font-medium text-gray-900"},lt={class:"px-6 text-center"},ot={class:"px-6 text-center"},at={class:"px-6 text-center"},rt={class:"border border-gray-300 px-2 py-2"},nt={class:"border border-gray-300 px-2 py-2"},dt={class:"border border-gray-300 px-2 py-2"},ut={class:"border border-gray-300 px-2 py-2"},it={class:"border border-gray-300 px-2 py-2"},vt=["innerHTML"],ct={class:"border border-gray-300 px-2 py-2"},yt={class:"border border-gray-300 px-2"},mt={class:"flex justify-center gap-2"},pt=["onClick"],_t={key:0},ft={key:0},gt={class:"text-center py-2",colspan:"6"},bt={key:0,class:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center"},xt={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},qt={__name:"AdminLeaveApplication",setup(Y){const V=de(),d=ue(),w=se();le();const{user:b,leave_balances:S,leaveApplications:U,loading:q}=ie(w),D=_(d.query.year||w.selectedYear),k=_(d.query.search||""),o=_({company_id:d.query.company_id||"",department_id:d.query.department_id||"all",type:d.query.type||"all",employee_id:d.query.employee_id||""}),v=_(!1),x=async()=>{const s={selectedYear:D.value,selectedStatus:w.selectedStatus,query:k.value};o.value.employee_id?(s.user_id=o.value.employee_id,q.value=!0,await w.fetchYearlyUserLeaveApplications(s),q.value=!1):U.value=[]};ee(async()=>{await x()});const A=I(()=>U.value||[]),N=()=>V.go(-1),m=async()=>{V.replace({query:{...d.query,company_id:o.value.company_id,department_id:o.value.department_id,type:o.value.type,employee_id:o.value.employee_id}}),await x()},H=async()=>{console.log("test close"),v.value=!1,await x()},j=new Date().getFullYear(),F=_([]);for(let s=2023;s<=j;s++)F.value.push(s);const r=async s=>{confirm("Are you sure to delete this application?")&&(await w.deleteLeaveApplication(s),await x())};return(s,t)=>{var y,i,f,M,R,z,P,O,J,G,K;const u=ve("RouterLink");return a(),n($,null,[e("div",Me,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:N},t[5]||(t[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[6]||(t[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),t[7]||(t[7]=e("div",null,null,-1))]),e("div",Re,[C(me,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value=l),"initial-value":p(d).query,onFilterChange:m},null,8,["modelValue","initial-value"]),e("div",null,[h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>D.value=l),onChange:x,class:"input-1"},[(a(!0),n($,null,T(F.value,l=>(a(),n("option",{key:l,value:l},c(l),9,Ee))),128))],544),[[ce,D.value]])])]),p(w).loading?(a(),n("div",Ie,[C(te)])):(a(),n("div",Ne,[e("div",He,[e("table",je,[e("thead",null,[(y=o.value)!=null&&y.employee_id?(a(),n("tr",Be,[e("th",We,[e("div",Ye,[t[14]||(t[14]=e("h2",{class:"text-lg font-semibold text-center py-2"},"User Info",-1)),t[15]||(t[15]=e("hr",null,null,-1)),e("div",ze,[e("p",Pe,[t[8]||(t[8]=e("strong",null,"Name:",-1)),L(" "+c((i=p(b))==null?void 0:i.name),1)]),e("p",Oe,[t[9]||(t[9]=e("strong",null,"Designation:",-1)),L(" "+c((M=(f=p(b))==null?void 0:f.designation)==null?void 0:M.title),1)]),e("p",Je,[t[10]||(t[10]=e("strong",null,"Department:",-1)),L(" "+c((z=(R=p(b))==null?void 0:R.department)==null?void 0:z.name),1)]),e("p",Ge,[t[11]||(t[11]=e("strong",null,"Company:",-1)),L(" "+c((O=(P=p(b))==null?void 0:P.company)==null?void 0:O.name),1)]),e("p",Ke,[t[12]||(t[12]=e("strong",null,"Phone:",-1)),L(" "+c((J=p(b))==null?void 0:J.phone),1)]),e("p",Qe,[t[13]||(t[13]=e("strong",null,"Email:",-1)),L(" "+c((G=p(b))==null?void 0:G.email),1)])])])]),e("th",Xe,[e("div",Ze,[e("div",et,[e("table",tt,[t[16]||(t[16]=e("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 text-center py-1"},"Type"),e("th",{scope:"col",class:"px-6 text-center py-1"},"Total Days"),e("th",{scope:"col",class:"px-6 text-center py-1"},"Used Days"),e("th",{scope:"col",class:"px-6 text-center py-1"},"Remaining Days")])],-1)),e("tbody",null,[(a(!0),n($,null,T(p(S),l=>(a(),n("tr",{key:l.id,class:"border-b hover:bg-gray-100"},[e("td",st,c(l.leave_type),1),e("td",lt,c(l.total_leave_days),1),e("td",ot,c(l.used_days),1),e("td",at,c(l.remaining_days),1)]))),128))])])])])])])):g("",!0),t[17]||(t[17]=e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")],-1))]),e("tbody",null,[(a(!0),n($,null,T(A.value,(l,Q)=>(a(),n("tr",{key:Q,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",rt,c(Q+1),1),e("td",nt,c(l==null?void 0:l.last_working_date),1),e("td",dt,c(l==null?void 0:l.resumption_date),1),e("td",ut,c(l==null?void 0:l.leave_period),1),e("td",it,[e("div",{innerHTML:(l==null?void 0:l.duration)||(l==null?void 0:l.total_leave_days)},null,8,vt)]),e("td",ct,c((l==null?void 0:l.status)||"N/A"),1),e("td",yt,[e("div",mt,[C(u,{to:{name:"LeaveApplicationShow",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:Z(()=>t[18]||(t[18]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[18]},1032,["to"]),(l==null?void 0:l.status)!=="Approved"?(a(),W(u,{key:0,to:{name:"LeaveApplicationEdit",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:Z(()=>t[19]||(t[19]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[19]},1032,["to"])):g("",!0),e("button",{onClick:ht=>r(l==null?void 0:l.id),class:"btn-icon text-red-500"},t[20]||(t[20]=[e("i",{class:"far fa-trash"},null,-1)]),8,pt)])])]))),128)),A.value.length?g("",!0):(a(),n("tr",_t,t[21]||(t[21]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(K=o.value)!=null&&K.employee_id?(a(),n("tr",ft,[e("th",gt,[e("button",{onClick:t[2]||(t[2]=l=>v.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):g("",!0)])])])]))]),(a(),W(ye,{to:"body"},[v.value?(a(),n("div",bt,[e("div",xt,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:t[3]||(t[3]=l=>v.value=!1)}," × "),C(Fe,{userInfo:p(b),onClose:t[4]||(t[4]=l=>v.value=!1),onFormSuccessClosed:H},null,8,["userInfo"])])])):g("",!0)]))],64)}}};export{qt as default};
