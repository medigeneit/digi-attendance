import{z as j,u as B,s as D,i as L,r,b as N,q as T,c as P,a as l,j as _,w as E,h as R,d as n,v as d,l as U,m as q,F as I,n as O,o as b,k as A,g as z}from"./index-debvsqJq.js";import{L as $}from"./LoaderView-BIoLdzPt.js";import{_ as G}from"./PhotoModal-Cm_HjiUx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"my-container space-y-2"},J={class:"card-bg md:p-8 p-4 mx-4"},K={class:"grid gap-4"},Q={class:"border p-4 rounded-md bg-gray-100"},W={class:"flex justify-center w-full"},X=["src"],Y={class:"grid md:grid-cols-2 gap-4"},Z={class:"flex justify-center gap-4"},ae={__name:"ProfileEdit",setup(ee){const o=j({name:"",phone:"",email:"",nid:"",date_of_birth:"",address:""}),u=B(),{user:a}=D(u),f=L(),k=z(),F=r(!1),v=r(!1),y=r(null),i=r(null),c=r(!1),g=r(!1);N(()=>{a.value&&x()}),T(a,t=>{t&&x()});const V=()=>{y.value=a.value.photo,v.value=!0},w=()=>{v.value=!1,i.value=null},M=t=>{i.value=t},x=()=>{var t,e,m,p,s,h;o.name=((t=a.value)==null?void 0:t.name)||"",o.phone=((e=a.value)==null?void 0:e.phone)||"",o.email=((m=a.value)==null?void 0:m.email)||"",o.address=((p=a.value)==null?void 0:p.address)||"",o.nid=((s=a.value)==null?void 0:s.nid)||"",o.date_of_birth=((h=a.value)==null?void 0:h.date_of_birth)||""},S=async()=>{try{await u.updateProfile(o),f.success("Profile updated successfully!"),k.push({name:"MyProfile"})}catch(t){console.error("Failed to update profile:",t),f.error(u.error||"Failed to save profile!");return}},C=async()=>{if(console.log(i.value),!i.value)return;const t=new FormData;t.append("photo",i.value),t.append("user_id",a.value.id),console.log({formData:t});try{c.value=!0,await u.uploadProfilePhoto(t),g.value=!0,setTimeout(()=>{w(),c.value=!1,g.value=!1},1500),f.success("Image updated successfully!")}catch(e){console.error("Failed to upload photo:",e),f.error(u.error||"Failed to save profile!")}finally{c.value=!1}};return(t,e)=>{var p;const m=O("RouterLink");return b(),P(I,null,[l("div",H,[l("div",J,[e[17]||(e[17]=l("h2",{class:"title-lg text-center"},"Edit Profile",-1)),F.value?(b(),_($,{key:0,class:"bg-gray-100 border shadow-none"})):(b(),P("form",{key:1,onSubmit:E(S,["prevent"]),class:"space-y-4"},[l("div",K,[l("div",Q,[l("div",W,[l("div",{onClick:V,class:"relative bg-gray-200 w-40 h-40 rounded-full overflow-hidden mx-auto flex items-center justify-center"},[l("img",{class:"object-cover w-full h-full",src:((p=R(a))==null?void 0:p.photo)||"/default-avatar.png",alt:"Profile Photo"},null,8,X),e[6]||(e[6]=l("div",{class:"absolute inset-0 flex items-end justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity"},[l("button",{type:"button",class:"btn-2 px-3 py-1 text-sm rounded-md mb-2"}," Change ")],-1))])]),e[13]||(e[13]=l("p",{class:"title-md"},"Personal Info",-1)),e[14]||(e[14]=l("hr",{class:"my-2"},null,-1)),l("div",Y,[l("div",null,[e[7]||(e[7]=l("label",null,"Name",-1)),n(l("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.name=s),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[d,o.name]])]),l("div",null,[e[8]||(e[8]=l("label",null,"Phone",-1)),n(l("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.phone=s),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[d,o.phone]])]),l("div",null,[e[9]||(e[9]=l("label",null,"Email",-1)),n(l("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.email=s),type:"email",class:"w-full p-2 border rounded"},null,512),[[d,o.email]])]),l("div",null,[e[10]||(e[10]=l("label",null,"Address",-1)),n(l("textarea",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.address=s),rows:"2",class:"w-full p-2 border rounded"},null,512),[[d,o.address]])]),l("div",null,[e[11]||(e[11]=l("label",null,"NID",-1)),n(l("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.nid=s),type:"text",class:"w-full p-2 border rounded"},null,512),[[d,o.nid]])]),l("div",null,[e[12]||(e[12]=l("label",null,"Date of Birth",-1)),n(l("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.date_of_birth=s),type:"date",class:"w-full p-2 border rounded"},null,512),[[d,o.date_of_birth]])])])])]),l("div",Z,[U(m,{to:{name:"MyProfile"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:q(()=>e[15]||(e[15]=[A(" Cancel ")])),_:1}),e[16]||(e[16]=l("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32))])]),U(G,{imageSrc:y.value,isOpen:v.value,onClose:w,onFileSelected:M,onUploadPhoto:C},null,8,["imageSrc","isOpen"])],64)}}};export{ae as default};
