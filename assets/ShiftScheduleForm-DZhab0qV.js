import{B as ze,r as c,C as se,_ as Be,u as We,f as Ke,D as ne,x as w,h as Ve,q as Y,c as u,o as i,a as l,k as Q,t as C,d as ye,m as Qe,l as he,F as K,e as H,H as Re,s as $,b as x,n as Ye,P as oe,Q as He}from"./index-0W4OwH8Z.js";import{_ as Ue}from"./EmployeeFilter-Bb7cAEup.js";import{u as qe}from"./company-C8nG-hHn.js";import{u as Pe}from"./department-1Allel5r.js";import{u as Ie}from"./shift-YsV-fhL-.js";import{d as U}from"./dayjs.min-BxYKcB_f.js";import{_ as Ge}from"./FlexibleDatePicker-B4EGLOC0.js";import"./EmployeeDropdownInput-Cx2swdRO.js";import"./SelectDropdown-BvC8BCQ3.js";import"./UserChip-4H_VF7Jm.js";import"./user-DpT7Nwn_.js";const Je=ze("shiftSchedule",()=>{const q=c([]),L=c(!1);return{schedules:q,defaultShift:L,fetchSchedules:async N=>{var E,M,G;const d=await se.get("/shift-schedules",N);return q.value=(E=d==null?void 0:d.data)==null?void 0:E.schedules,L.value=(M=d==null?void 0:d.data)==null?void 0:M.default_shift,(G=d.data)==null?void 0:G.schedules},saveSchedules:async N=>{await se.post("/shift-schedules",{schedules:N==null?void 0:N.payload})},fetchDefaultSchedules:async N=>{const d=await se.get("/default-shift-schedules",N);return q.value=d==null?void 0:d.data,d.data}}}),Xe={class:"p-4 max-w-[1600px] mx-auto"},Ze={class:"flex flex-wrap items-center justify-between gap-3 mb-4"},et={class:"flex items-center gap-3 text-xs md:text-sm text-gray-500"},tt={class:"font-semibold"},lt={class:"flex flex-wrap gap-2 p-3 rounded border border-white/20 bg-white/60 backdrop-blur-md shadow-sm supports-[backdrop-filter]:bg-white/50 sticky top-14 z-20"},at={class:"flex gap-4"},st=["value"],nt={class:"mb-3 flex flex-wrap items-center justify-between gap-2 rounded-xl border bg-white px-3 py-2"},ot={class:"flex flex-wrap items-center gap-2 text-xs md:text-sm"},rt={class:"text-xs"},ut={class:"text-xs"},it={class:"text-xs"},dt={class:"flex flex-wrap items-center justify-between gap-2 mb-3"},ct={key:0,class:"text-xs md:text-sm text-gray-500 flex items-center gap-2"},vt={key:0,class:"text-xs md:text-sm text-amber-700 bg-amber-50 border border-amber-100 rounded px-2 py-1 mb-3"},pt={class:"flex flex-wrap gap-2 md:gap-3 mb-4 p-2 md:p-3 bg-white/70 backdrop-blur rounded sticky top-16 border"},mt=["onClick"],ft={class:"mb-3 flex flex-wrap gap-2 md:gap-3 items-center"},bt=["disabled"],yt=["disabled"],ht=["disabled"],xt={class:"btn-3 ml-auto flex items-center gap-2 text-xs md:text-sm"},gt=["disabled","checked"],St=["disabled"],_t={class:"overflow-auto border rounded"},kt={class:"table-auto w-full text-xs md:text-sm"},wt={class:"sticky top-0 bg-white z-10"},Ct=["title"],Nt={class:"font-medium leading-none"},Et={class:"text-[9px] md:text-[10px] text-gray-500"},Dt={class:"border p-2 sticky-col-1 bg-inherit z-10"},Ft={class:"flex items-center gap-2"},At=["value"],$t={class:"min-w-0"},Mt={class:"font-medium leading-tight truncate max-w-[150px]"},jt={class:"border p-1 md:p-2 sticky-col-2 bg-inherit z-10 text-center"},Ot=["onClick","disabled"],Lt=["onClick","title"],Tt={key:0},zt={colspan:"999",class:"p-8"},Bt={class:"mx-auto max-w-xl text-center"},Wt={class:"mt-1 text-sm text-slate-600"},Kt={class:"mt-4 flex flex-wrap justify-center gap-2"},Vt={key:0,class:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700"},Qt={key:1,class:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700"},Rt={key:2,class:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700"},Yt={class:"flex justify-center mt-4 md:mt-5"},Ht=["disabled"],Ut={__name:"ShiftScheduleForm",setup(q){const L=Je(),re=qe(),P=Ie(),I=Pe(),N=We(),d=Ke(),{defaultShift:E}=ne(L),{employees:M}=ne(re),{shifts:G}=ne(P),D=c(U().format("YYYY-MM")),b=c(""),y=c(""),F=c(""),p=c(""),g=c("all"),xe=t=>String(t).padStart(2,"0"),j=c({year:Number(D.value.split("-")[0])||U().year(),month:Number(D.value.split("-")[1])||U().month()+1,day:1}),_=w(()=>!j.value.year||!j.value.month?"":`${j.value.year}-${xe(j.value.month)}`),r=c({}),k=c([]),ue=c(!1),J=c(!1),T=c([]),X=c(!1),z=c(null),R=c({WEEKEND:"#B91C1C",HOLIDAY:"#6B7280"}),ie=["#FF5733","#33C1FF","#33FF57","#FF33D4","#FFD633","#7D33FF","#FF8C33","#33FFF0","#B833FF","#3375FF","#FF3333","#33FFAA"],h=w(()=>!!(b.value&&y.value&&g.value&&g.value!=="all")),S=w(()=>({company:!b.value,department:!y.value,line_type:!g.value||g.value==="all"})),ge=w(()=>{const t=[];return S.value.company&&t.push("Company"),S.value.department&&t.push("Department"),S.value.line_type&&t.push("Line Type"),t.length?`Required: ${t.join(", ")}`:"All required filters selected."}),de=t=>e=>(e||[]).find(s=>Number(s==null?void 0:s.id)===Number(t)),Z=w(()=>{const t=G.value||{};return Array.isArray(t)?t:Object.values(t).flat()});function ce(){let t=0;Z.value.forEach(e=>{const s=String(e.id);R.value[s]||(R.value[s]=ie[t%ie.length],t++)})}const ee=w(()=>_.value?Array.from({length:U(_.value).daysInMonth()},(t,e)=>e+1):[]),ve=t=>{const e=`${_.value}-${String(t).padStart(2,"0")}`;return U(e).format("ddd")},m=w(()=>(k.value||[]).map(t=>Number(t)).filter(Number.isFinite)),pe=w(()=>new Set(m.value)),V=t=>pe.value.has(Number(t)),v=t=>String(t),Se=(t,e)=>{var n,o;const s=(o=(n=r.value)==null?void 0:n[v(t)])==null?void 0:o[e];return s?{backgroundColor:R.value[String(s)]||"#D1D5DB"}:{backgroundColor:"#E5E7EB"}},_e=(t,e)=>{var n,o;const s=(o=(n=r.value)==null?void 0:n[v(t)])==null?void 0:o[e];if(s==="WEEKEND"||s==="HOLIDAY")return s;const a=de(s)(Z.value);return(a==null?void 0:a.name)||""},ke=(t,e)=>{const s=`${_.value}-${String(e).padStart(2,"0")}`,a=_e(t,e);return a?`${s} — ${a}`:V(t)?`${s} — Click to set shift`:`${s} — Check this employee to edit`};function we(t,e){V(t)&&p.value&&(r.value[v(t)]||(r.value[v(t)]={}),r.value[v(t)][e]=p.value)}function me(t){V(t)&&p.value&&(r.value[v(t)]||(r.value[v(t)]={}),ee.value.forEach(e=>{r.value[v(t)][e]=p.value}))}function Ce(){!m.value.length||!p.value||m.value.forEach(me)}function Ne(){m.value.length&&m.value.forEach(t=>{var a;const e=de(t)(T.value),s=(((a=e==null?void 0:e.assign_weekend)==null?void 0:a.weekends)||[]).map(n=>String(n).slice(0,3));r.value[v(t)]||(r.value[v(t)]={}),ee.value.forEach(n=>{const o=ve(n);s.includes(o)&&(r.value[v(t)][n]="WEEKEND")})})}function Ee(){m.value.length&&m.value.forEach(t=>{r.value[v(t)]&&(r.value[v(t)]={})})}async function fe(){if(!h.value){alert("Please select Company, Department and Line Type first.");return}if(!m.value.length){alert("Select at least one employee.");return}const t=[];for(const[e,s]of Object.entries(r.value||{})){const a=Number(e);if(pe.value.has(a))for(const[n,o]of Object.entries(s||{})){const O=Number(n);if(!O||!o)continue;const A=`${_.value}-${String(O).padStart(2,"0")}`;let B=null,f=null;o==="WEEKEND"||o==="HOLIDAY"?f=o:B=Number(o),t.push({employee_id:a,date:A,shift_id:B,status:f})}}if(!t.length){alert("No schedule data to save for checked employees.");return}try{await L.saveSchedules({payload:t}),alert("Shift schedule saved successfully!")}catch(e){console.error("Failed to save schedule",e),alert("Something went wrong while saving.")}}function De({companyId:t,departmentId:e,lineType:s,month:a}){return[t||"",e||"",s||"all",a||""].join("-")}async function Fe({companyId:t,departmentId:e,lineType:s,month:a}){if(!t||!e||!a||s==="all"){r.value={};return}const n={companyId:Number(t)||null,departmentId:Number(e)||null,lineType:s&&s!=="all"?s:"all",month:a},o=De(n);if(z.value!==o){z.value=o,X.value=!0,E.value=!1,r.value={};try{const O={company_id:n.companyId,department_id:n.departmentId,month:n.month};n.lineType&&n.lineType!=="all"&&(O.line_type=n.lineType);let A=await L.fetchSchedules({params:O});if(A=Array.isArray(A)?A:A||[],!A.length){const f=await L.fetchDefaultSchedules({params:O}),W=Array.isArray(f)?f:f||[];W.length&&(E.value=!0,A=W,alert("No saved schedule found. Default schedule loaded."))}const B={};A.forEach(f=>{const W=Number(f==null?void 0:f.employee_id),Te=String((f==null?void 0:f.date)||"").split("-")[2],be=Number(Te);!W||!be||(B[v(W)]||(B[v(W)]={}),B[v(W)][be]=f.shift_id??f.status)}),z.value===o&&(r.value=B)}catch(O){console.error("Failed to load schedule data:",O),alert("Error loading schedule. Please try again or contact admin.")}finally{z.value===o&&(X.value=!1)}}}async function ae(t){if(!h.value||!t)return T.value=[],M.value=[],k.value=[],[];const e=await I.fetchDepartmentEmployee([Number(t)],g.value),s=Array.isArray(e)?e:Array.isArray(e==null?void 0:e.data)?e.data:[];return T.value=s,M.value=s,k.value=k.value.filter(a=>s.some(n=>Number(n==null?void 0:n.id)===Number(a))),s}function Ae(t=_.value||D.value){return!!(h.value&&t)}async function te(t){const e=t||_.value||D.value;if(!Ae(e)){r.value={},z.value=null,X.value=!1,E.value=!1;return}await Fe({companyId:b.value,departmentId:y.value,lineType:g.value,month:e})}const $e=w(()=>({company_id:b.value,department_id:y.value,line_type:g.value,employee_id:F.value,month:_.value})),Me=t=>Object.fromEntries(Object.entries(t||{}).filter(([,e])=>e!==""&&e!==null&&e!==void 0));function je(t={}){const e={...d.query,...t},s=Me(e);Object.keys(s).length===Object.keys(d.query).length&&Object.entries(s).every(([n,o])=>String(d.query[n]??"")===String(o??""))||N.replace({query:s}).catch(()=>{})}function Oe(t=d.query){J.value=!0,b.value=t.company_id||"",y.value=t.department_id||"",F.value=t.employee_id||"",g.value=t.line_type||"all";const e=t.month||D.value;if(D.value=e,e){const[s,a]=e.split("-");s&&(j.value.year=Number(s)),a&&(j.value.month=Number(a))}J.value=!1,ue.value=!0}Ve(async()=>{Oe(),b.value&&(await Promise.all([I.fetchDepartments({company_id:Number(b.value)}),P.fetchShifts({company_id:Number(b.value)})]),ce()),b.value&&y.value&&(await ae(y.value),await te())}),Y(b,async t=>{t&&(y.value="",k.value=[],F.value="",T.value=[],M.value=[],r.value={},g.value="all",z.value=null,E.value=!1,await Promise.all([I.fetchDepartments({company_id:Number(t)}),P.fetchShifts({company_id:Number(t)})]),ce())}),Y(y,async t=>{if(!t){T.value=[],M.value=[],k.value=[],r.value={},z.value=null,E.value=!1;return}J.value||(F.value=""),await ae(t),await te()}),Y(g,async()=>{!b.value||!y.value||(await ae(y.value),await te())}),Y(_,async t=>{t&&(D.value=t,await te(t))}),Y($e,t=>{!ue.value||J.value||je(t)},{deep:!0});const le=w(()=>{if(!h.value)return[];const t=T.value.length?T.value:M.value||[];if(!F.value)return t;const e=Number(F.value);return t.filter(s=>Number(s==null?void 0:s.id)===e)});function Le(t){h.value&&(t?k.value=le.value.map(e=>Number(e.id)):k.value=[])}return(t,e)=>{var s;return i(),u("div",Xe,[l("div",Ze,[e[11]||(e[11]=l("h2",{class:"text-xl md:text-2xl font-semibold"}," Monthly Shift Schedule Plan ",-1)),l("div",et,[e[10]||(e[10]=l("span",null,"Month:",-1)),l("span",tt,C(_.value||D.value),1)])]),l("div",lt,[ye(Ue,{company_id:b.value,"onUpdate:company_id":e[1]||(e[1]=a=>b.value=a),department_id:y.value,"onUpdate:department_id":e[2]||(e[2]=a=>y.value=a),line_type:g.value,"onUpdate:line_type":e[3]||(e[3]=a=>g.value=a),employee_id:F.value,"onUpdate:employee_id":e[4]||(e[4]=a=>F.value=a),"initial-value":{company_id:b.value,department_id:y.value,line_type:g.value,employee_id:F.value}},{default:Qe(()=>[l("div",at,[e[13]||(e[13]=l("label",{class:"top-label"},"Shift",-1)),he(l("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),class:"px-3 py-1 border rounded text-sm"},[e[12]||(e[12]=l("option",{value:""},"- Pick a Shift -",-1)),(i(!0),u(K,null,H(Z.value,a=>(i(),u("option",{key:a.id,value:a.id},C(a.name),9,st))),128))],512),[[Re,p.value]])])]),_:1},8,["company_id","department_id","line_type","employee_id","initial-value"]),ye(Ge,{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=a=>j.value=a),"show-year":!1,"show-month":!0,"show-date":!1,label:"Month"},null,8,["modelValue"])]),l("div",nt,[l("div",ot,[l("span",{class:$(["inline-flex items-center gap-2 rounded-full px-3 py-1 font-semibold border",h.value?"bg-emerald-50 text-emerald-800 border-emerald-200":"bg-amber-50 text-amber-800 border-amber-200"])},[l("span",{class:$(["h-2 w-2 rounded-full",h.value?"bg-emerald-500":"bg-amber-500"])},null,2),x(" "+C(ge.value),1)],2),l("span",{class:$(["inline-flex items-center gap-2 rounded-full border px-3 py-1 text-slate-700",S.value.company?"bg-white border-slate-200":"bg-emerald-50 border-emerald-200"])},[l("span",rt,C(S.value.company?"○":"✓"),1),e[14]||(e[14]=x(" Company "))],2),l("span",{class:$(["inline-flex items-center gap-2 rounded-full border px-3 py-1 text-slate-700",S.value.department?"bg-white border-slate-200":"bg-emerald-50 border-emerald-200"])},[l("span",ut,C(S.value.department?"○":"✓"),1),e[15]||(e[15]=x(" Department "))],2),l("span",{class:$(["inline-flex items-center gap-2 rounded-full border px-3 py-1 text-slate-700",S.value.line_type?"bg-white border-slate-200":"bg-emerald-50 border-emerald-200"])},[l("span",it,C(S.value.line_type?"○":"✓"),1),e[16]||(e[16]=x(" Line Type "))],2)]),e[17]||(e[17]=l("div",{class:"text-[11px] md:text-xs text-slate-500"}," Employees & schedule will load automatically after selecting all required filters. ",-1))]),l("div",dt,[e[19]||(e[19]=l("div",{class:"text-xs md:text-sm text-sky-800 bg-sky-50 border border-sky-200 rounded px-2 py-1"},[x(" ✔ Only "),l("b",null,"checked"),x(" employees are editable & will be saved. ")],-1)),X.value?(i(),u("div",ct,e[18]||(e[18]=[l("span",{class:"inline-block w-2 h-2 rounded-full border-2 border-gray-400 border-t-transparent animate-spin"},null,-1),l("span",null,"Loading schedule...",-1)]))):Q("",!0)]),Ye(E)?(i(),u("p",vt," ⚠ Showing default schedule from current shift. Select employees manually before saving. ")):Q("",!0),l("div",pt,[(i(!0),u(K,null,H(Z.value,a=>(i(),u("div",{key:a.id,class:$(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded border hover:bg-gray-50 text-xs md:text-sm",{"ring-2 ring-blue-500":String(p.value)===String(a.id)}]),onClick:n=>p.value=a.id},[l("div",{class:"w-4 h-4 rounded",style:oe({backgroundColor:R.value[String(a.id)]||"#ccc"})},null,4),l("span",null,C(a.name),1)],10,mt))),128)),l("div",{class:$(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded border hover:bg-gray-50 text-xs md:text-sm",{"ring-2 ring-blue-500":p.value==="HOLIDAY"}]),onClick:e[6]||(e[6]=a=>p.value="HOLIDAY")},e[20]||(e[20]=[l("div",{class:"w-4 h-4 rounded bg-gray-500"},null,-1),l("span",null,"Holiday",-1)]),2),l("div",{class:$(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded border hover:bg-gray-50 text-xs md:text-sm",{"ring-2 ring-blue-500":p.value==="WEEKEND"}]),onClick:e[7]||(e[7]=a=>p.value="WEEKEND")},[l("div",{class:"w-4 h-4 rounded",style:oe({backgroundColor:R.value.WEEKEND})},null,4),e[21]||(e[21]=l("span",null,"Weekend",-1))],2)]),l("div",ft,[l("button",{onClick:Ce,class:"btn-4 bg-indigo-600 hover:bg-indigo-700 text-white text-xs md:text-sm",disabled:!h.value||!m.value.length||!p.value,title:"Set selected shift to all days for checked employees"}," Set Shift → Checked (All Dates) ",8,bt),l("button",{onClick:Ne,class:"btn-4 bg-red-700 hover:bg-red-800 text-white text-xs md:text-sm",disabled:!h.value||!m.value.length,title:"Mark employee-specific weekends for checked employees"}," Set Weekends → Checked ",8,yt),l("button",{onClick:Ee,class:"btn-4 bg-gray-700 hover:bg-gray-800 text-white text-xs md:text-sm",disabled:!h.value||!m.value.length}," Clear (Checked) ",8,ht),l("label",xt,[l("input",{type:"checkbox",disabled:!h.value,checked:m.value.length&&m.value.length===le.value.length,onChange:e[8]||(e[8]=a=>Le(a.target.checked))},null,40,gt),e[22]||(e[22]=l("span",null,"Select all (visible)",-1))]),l("button",{onClick:fe,class:"btn-2 text-xs md:text-sm",disabled:!h.value||!m.value.length,title:"Saves only checked employees"}," Save (Checked only) ",8,St)]),l("div",_t,[l("table",kt,[l("thead",wt,[l("tr",null,[e[23]||(e[23]=l("th",{class:"border p-2 w-40 sticky-col-1 text-left bg-white z-50"}," Employee ",-1)),e[24]||(e[24]=l("th",{class:"border p-2 w-32 sticky-col-2 text-center bg-white z-50"}," Quick Action ",-1)),(i(!0),u(K,null,H(ee.value,a=>(i(),u("th",{key:a,class:"border text-center p-1 min-w-[32px] md:min-w-[40px]",title:`${D.value}-${String(a).padStart(2,"0")}`},[l("div",Nt,C(a),1),l("div",Et,C(ve(a)),1)],8,Ct))),128))])]),l("tbody",null,[(i(!0),u(K,null,H(le.value,a=>(i(),u("tr",{key:a.id,class:"odd:bg-white even:bg-gray-50"},[l("td",Dt,[l("label",Ft,[he(l("input",{type:"checkbox",class:"rounded",value:a.id,"onUpdate:modelValue":e[9]||(e[9]=n=>k.value=n)},null,8,At),[[He,k.value]]),l("div",$t,[l("div",Mt,C(a.name),1)])])]),l("td",jt,[l("button",{class:"btn-4 cursor-pointer text-[11px] md:text-xs px-2 py-1",onClick:n=>me(a.id),disabled:!p.value||!V(a.id)}," Apply to all ",8,Ot)]),(i(!0),u(K,null,H(ee.value,n=>(i(),u("td",{key:n,class:$(["border text-center",V(a.id)?"cursor-pointer hover:bg-gray-100":"cursor-default opacity-70"]),onClick:o=>V(a.id)&&we(a.id,n),title:ke(a.id,n)},[l("div",{style:oe(Se(a.id,n)),class:"w-full h-5 md:h-6 rounded transition"},null,4)],10,Lt))),128))]))),128)),(s=le.value)!=null&&s.length?Q("",!0):(i(),u("tr",Tt,[l("td",zt,[l("div",Bt,[e[35]||(e[35]=l("div",{class:"mx-auto mb-3 grid h-12 w-12 place-items-center rounded-2xl bg-slate-100 text-slate-500"},[l("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 6a2 2 0 104 0 2 2 0 00-4 0zM4 20a6 6 0 0112 0M16 11h6m-3-3v6"})])],-1)),l("p",Wt,[h.value?(i(),u(K,{key:1},[x(" No employees found for the selected filters. Try changing filters/search. ")],64)):(i(),u(K,{key:0},[e[25]||(e[25]=x(" Select ")),e[26]||(e[26]=l("b",null,"Company",-1)),e[27]||(e[27]=x(", ")),e[28]||(e[28]=l("b",null,"Department",-1)),e[29]||(e[29]=x(", and ")),e[30]||(e[30]=l("b",null,"Line Type",-1)),e[31]||(e[31]=x(" to load employees. "))],64))]),l("div",Kt,[S.value.company?(i(),u("span",Vt,e[32]||(e[32]=[l("span",{class:"h-2 w-2 rounded-full bg-amber-400"},null,-1),x(" Select company ")]))):Q("",!0),S.value.department?(i(),u("span",Qt,e[33]||(e[33]=[l("span",{class:"h-2 w-2 rounded-full bg-amber-400"},null,-1),x(" Select department ")]))):Q("",!0),S.value.line_type?(i(),u("span",Rt,e[34]||(e[34]=[l("span",{class:"h-2 w-2 rounded-full bg-amber-400"},null,-1),x(" Select line type ")]))):Q("",!0)])])])]))])])]),l("div",Yt,[l("button",{onClick:fe,class:"btn-2 text-xs md:text-sm",disabled:!h.value||!m.value.length,title:"Saves only checked employees"}," Save (Checked only) ",8,Ht)])])}}},sl=Be(Ut,[["__scopeId","data-v-ab490145"]]);export{sl as default};
