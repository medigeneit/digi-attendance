import{d as R,r as d,q as U,e as G,c as m,o as i,a as t,t as f,w as E,f as F,l as y,p as _,F as P,x as Y,m as H,g as c,D as k,y as J,n as h,v as I}from"./index-fO5p_Xlo.js";import{_ as K}from"./MultiselectDropdown-DYlq6RVm.js";import{_ as N}from"./UserChip-vqby0PRy.js";import{a as B}from"./datetime-q3Sn87-f.js";import{u as Q}from"./company-C7cUn7Ht.js";import{u as W}from"./useTaskStore-pMS7skwm.js";import{u as X}from"./user-gdQS8Szi.js";import{R as M}from"./RequiredIcon-ByaDgEHJ.js";const Z={class:"p-4"},ee={class:"mb-4"},te={class:"font-semibold text-gray-600 text-lg leading-none"},se={key:0,class:"text-center text-gray-500 py-4"},ae={class:"mb-4"},le={class:"mb-2 flex flex-wrap gap-2"},oe=["onClick"],re={class:"flex gap-16 items-center my-8"},ne={class:"flex gap-1 items-center"},ie={class:"flex gap-1 items-center"},ue={class:"mt-8"},de={class:"grid grid-cols-2 gap-4 mb-4 mt-12"},me={class:"mb-4"},pe={class:"block text-gray-600 text-sm mb-1 font-medium"},ce={class:"mb-4"},ve={class:"block text-gray-600 text-sm mb-1 font-medium"},ge={key:0,class:"mb-4 text-red-500 font-medium"},be={key:1,class:"mb-4 text-blue-500 font-medium"},fe={class:"flex justify-between items-center gap-4"},ye=["disabled"],Te={__name:"TaskUserAssignForm",props:{taskId:{type:[Number,String],required:!0}},emits:["success","cancelClick"],setup(z,{emit:D}){const S=W(),$=Q(),w=X(),V=R(),r=d([]),q=U(()=>r.value.map(a=>a.id)),o=d(""),v=d(null),g=d([]),C=z,u=d(null),l=d({status:"PENDING",progress:0,description:"",is_important:!1,is_urgent:!1,is_target:!1,started_at:"",deadline:""}),T=D;G(async()=>{var e,n,s,p,b,x;o.value="loading";const a=await S.fetchTask(C.taskId,{with_parent:"true"},{loadingBeforeFetch:!1,fetchOnly:!0});u.value=a.task,u.value.parent?g.value=((n=(e=u.value)==null?void 0:e.parent)==null?void 0:n.users)||[]:((s=V.user)==null?void 0:s.role)==="employee"?g.value=((x=(b=await $.fetchEmployees((p=V.user)==null?void 0:p.company_id))==null?void 0:b.data)==null?void 0:x.employees)||[]:(await w.fetchUsers(),g.value=w.users),j(u.value),r.value=u.value.users,o.value=""});const A=U(()=>g.value.filter(a=>!r.value.find(e=>e.id===a.id))),O=async()=>{var a,e;o.value="submitting",v.value=null;try{await S.updateTask(C.taskId,{...l.value,user_ids:q.value},{loadingBeforeFetch:!1}),T("success")}catch(n){v.value=((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"Assign users failed"}finally{o.value=""}};function j(a){l.value={status:a.status,progress:a.progress,is_important:a.is_important,is_urgent:a.is_urgent,is_target:a.is_target,started_at:B(a.started_at),deadline:B(a.deadline)}}return(a,e)=>{var n;return i(),m("div",Z,[e[14]||(e[14]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-1"},"Manage Employee(s) for Task",-1)),e[15]||(e[15]=t("hr",{class:"mb-4 !mt-0"},null,-1)),t("h3",ee,[e[7]||(e[7]=t("div",{class:"uppercase text-xs text-gray-600"},"Task",-1)),t("div",te,f((n=u.value)==null?void 0:n.title),1)]),o.value==="loading"?(i(),m("div",se,"Loading users...")):(i(),m("form",{key:1,onSubmit:E(O,["prevent"])},[t("div",ae,[e[8]||(e[8]=t("label",{class:"block uppercase text-xs text-gray-600"},"Employees",-1)),y(K,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),options:A.value,multiple:!0,"track-by":"id",label:"label",placeholder:"Select users"},{selection:_(({...s})=>[t("div",le,[(i(!0),m(P,null,Y((s==null?void 0:s.values)||[],p=>(i(),H(N,{key:p.id,user:p},{after:_(({user:b})=>[t("button",{class:"size-6 border rounded-full hover:bg-red-400 hover:text-white",onClick:E(x=>r.value=r.value.filter(L=>L.id!==b.id),["prevent"])}," Ã— ",8,oe)]),_:2},1032,["user"]))),128))])]),option:_(({option:s})=>[y(N,{user:s},null,8,["user"])]),_:1},8,["modelValue","options"])]),t("div",re,[t("label",ne,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>l.value.is_important=s),class:"size-4"},null,512),[[k,l.value.is_important]]),e[9]||(e[9]=t("span",{class:"block text-gray-600 text-base font-medium"},"Important",-1))]),t("label",ie,[c(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>l.value.is_urgent=s),class:"size-4"},null,512),[[k,l.value.is_urgent]]),e[10]||(e[10]=t("span",{class:"block text-gray-600 text-base font-medium"},"Urgent",-1))])]),t("div",ue,[t("label",{class:J(["flex gap-1 items-center mt-4 border rounded py-2 justify-center cursor-pointer",{"bg-yellow-200":l.value.is_target}])},[c(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.is_target=s),class:"size-6"},null,512),[[k,l.value.is_target]]),e[11]||(e[11]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Is Target Task",-1))],2)]),t("div",de,[t("div",me,[t("label",pe,[e[12]||(e[12]=h(" Start Date ")),y(M),h(" "+f(l.value.started_at),1)]),c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.started_at=s),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[I,l.value.started_at]])]),t("div",ce,[t("label",ve,[e[13]||(e[13]=h(" Deadline ")),y(M)]),c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.deadline=s),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[I,l.value.deadline]])])]),v.value?(i(),m("div",ge,f(v.value),1)):F("",!0),o.value=="submitting"?(i(),m("div",be," Saving changes... ")):F("",!0),t("div",fe,[t("button",{disabled:o.value=="submitting"||o.value=="loading",type:"submit",class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-5 py-2 rounded transition"},f(o.value=="submitting"?"Saving...":"Save"),9,ye),t("button",{type:"button",onClick:e[6]||(e[6]=s=>T("cancelClick")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32))])}}};export{Te as _};
