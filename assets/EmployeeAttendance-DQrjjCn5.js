import{u as G,b as I,r as v,A as z,e as X,I as Z,m as ee,n as te,c as f,o as p,a as t,p as S,g as b,f as J,h as K,i as P,v as se,j as u,t as d,k as a,D as ne}from"./index-C2c6jDtn.js";import{_ as oe}from"./AttendanceTable-CMg0sFAT.js";import{_ as le}from"./EmployeeFilter-D6bx9HJU.js";import{L as ae}from"./LoaderView-ENegDWbW.js";import{S as re}from"./SelectedEmployeeCard-C13N8ZSr.js";import{u as ie}from"./attendance-BmwXGfuw.js";import{u as de}from"./user-DiC7fZMp.js";import"./datetime-BEfC2TVK.js";import"./company-DRjvKD7b.js";import"./department-Da9clOqW.js";import"./EmployeeDropdownInput-ZKEiBGZ9.js";import"./SelectDropdown-nskAtchJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-CPJG-TKZ.js";const pe={class:"px-4 space-y-4"},ue={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl"},me={class:"grid md:grid-cols-2 gap-4 text-sm mt-2"},ce={key:1,class:"card-bg p-4 gap-1"},ye={class:"flex justify-between items-center"},fe={class:"px-1 pt-1 pb-0.5 overflow-hidden"},xe={class:"-mx-1 flex items-center gap-2 overflow-x-auto px-1"},_e={key:0,class:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-0.5 text-[11px] font-medium text-emerald-700 whitespace-nowrap"},ge={class:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2.5 py-0.5 text-[11px] font-medium text-amber-700 whitespace-nowrap"},ve={class:"inline-flex items-center gap-1 rounded-full border border-red-200 bg-red-50 px-2.5 py-0.5 text-[11px] font-medium text-red-700 whitespace-nowrap"},be={class:"inline-flex items-center gap-1 rounded-full border border-sky-200 bg-sky-50 px-2.5 py-0.5 text-[11px] font-medium text-sky-700 whitespace-nowrap"},we={class:"grid md:grid-cols-3 gap-2 mt-1"},ke={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},he={class:"text-sm text-zinc-900"},ze={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Se={class:"text-sm text-zinc-900"},$e={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Ae={class:"text-sm text-zinc-900"},Ue={key:0},Ce={key:2,class:"space-y-4"},Je={__name:"EmployeeAttendance",setup(Me){const $=G(),A=I(),o=ie(),U=de(),x=s=>{if(!s)return"";if(typeof s=="string"){if(/^\d{4}-\d{2}$/.test(s))return s;const e=s.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(s),l=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0");return`${l}-${c}`}catch{return""}},y=A.query,i=v(x(y.date)||x(o.selectedMonth)||x(new Date)),n=v({company_id:y.company_id||"",department_id:y.department_id||"all",line_type:y.line_type||"all",employee_id:y.employee_id||""}),m=v(null);let w=null;const _=(s={})=>{w&&clearTimeout(w),w=setTimeout(()=>{const e={...A.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:i.value||"",...s};Object.keys(e).forEach(l=>{(e[l]===""||e[l]===void 0||e[l]===null)&&delete e[l]}),$.replace({query:e}).catch(()=>{})},150)},C=async s=>{if(!s){m.value=null;return}try{await U.fetchUser(s),m.value=U.user||null}catch(e){console.error("fetchUser error:",e),m.value=null}},g=v(""),k=async()=>{const s=n.value.employee_id,e=i.value;if(!s||!e)return;const l=`${s}|${e}`;if(l!==g.value){g.value=l;try{await o.getMonthlyAttendanceByShift(s,e)}catch(c){console.error("fetchAttendance error:",c),g.value=""}}};z(()=>i.value,s=>{i.value=x(s),_({date:i.value})}),z(()=>({...n.value}),()=>{_()}),z(()=>n.value.employee_id,async(s,e)=>{s&&s!==e&&(await C(s),await k()),s||(m.value=null,g.value="")}),X(async()=>{n.value.employee_id&&await C(n.value.employee_id),n.value.employee_id&&i.value&&await k(),await Z(),_()});const Q=()=>$.go(-1),Y=()=>{_()},h=ee(()=>!!n.value.employee_id);return(s,e)=>{var c,M,q,T,j,B,D,L,E,F,H,N,W,O,R,V;const l=te("router-link");return p(),f("div",pe,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:Q},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Job Card",-1)),e[7]||(e[7]=t("div",null,null,-1))]),S(le,{company_id:n.value.company_id,"onUpdate:company_id":e[1]||(e[1]=r=>n.value.company_id=r),department_id:n.value.department_id,"onUpdate:department_id":e[2]||(e[2]=r=>n.value.department_id=r),employee_id:n.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=r=>n.value.employee_id=r),line_type:n.value.line_type,"onUpdate:line_type":e[4]||(e[4]=r=>n.value.line_type=r),"with-type":!0,"initial-value":s.$route.query,onFilterChange:Y,class:"w-full"},{default:P(()=>[K(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[0]||(e[0]=r=>i.value=r),onChange:k,class:"input-1 py-0.5","aria-label":"Select month"},null,544),[[se,i.value]])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",ue,[t("div",me,[h.value?(p(),J(re,{key:0,user:m.value},null,8,["user"])):b("",!0),h.value?(p(),f("div",ce,[t("div",ye,[e[9]||(e[9]=t("h2",{class:"text-sm md:text-base font-semibold text-zinc-900"},"Attendance Summary",-1)),S(l,{to:{name:"MonthWiseApplicationLog",query:{...s.$route.query}},class:"inline-flex items-center gap-1 rounded-md border border-zinc-200 bg-white px-2.5 py-1 text-[12px] font-medium text-zinc-700 hover:bg-zinc-50 active:scale-[.99]",target:"_blank",rel:"noopener noreferrer"},{default:P(()=>e[8]||(e[8]=[t("i",{class:"far fa-clock text-[12px]"},null,-1),t("span",{class:"hidden sm:inline"},"Application History",-1),t("span",{class:"sm:hidden"},"History",-1)])),_:1,__:[8]},8,["to"])]),e[21]||(e[21]=t("div",{class:"h-px w-full bg-gradient-to-r from-indigo-500/70 via-sky-400/70 to-cyan-400/70"},null,-1)),t("div",fe,[t("div",xe,[s.presentRate!==null?(p(),f("span",_e,[e[10]||(e[10]=t("i",{class:"far fa-check-circle text-[11px]"},null,-1)),e[11]||(e[11]=u(" Present ")),t("strong",null,d(((M=(c=a(o))==null?void 0:c.summary)==null?void 0:M.total_present_days)||0)+"d",1)])):b("",!0),t("span",ge,[e[12]||(e[12]=t("i",{class:"far fa-clock text-[11px]"},null,-1)),e[13]||(e[13]=u(" Late ")),t("strong",null,d((T=(q=a(o))==null?void 0:q.summary)==null?void 0:T.actual_late_day)+"d",1)]),t("span",ve,[e[14]||(e[14]=t("i",{class:"far fa-user-times text-[11px]"},null,-1)),e[15]||(e[15]=u(" Absent ")),t("strong",null,d(((B=(j=a(o))==null?void 0:j.summary)==null?void 0:B.total_absent_days)||0)+"d",1)]),t("span",be,[e[16]||(e[16]=t("i",{class:"far fa-bolt text-[11px]"},null,-1)),e[17]||(e[17]=u(" Total Weekends ")),t("strong",null,d((L=(D=a(o))==null?void 0:D.summary)==null?void 0:L.total_weekend_days)+"d",1)])])]),t("div",we,[t("div",ke,[e[18]||(e[18]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-briefcase text-[12px]"}),u(" Total Working Days ")],-1)),t("strong",he,d(((F=(E=a(o))==null?void 0:E.summary)==null?void 0:F.total_working_days)||0),1)]),t("div",ze,[e[19]||(e[19]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-hourglass-half text-[12px]"}),u(" Working Hours ")],-1)),t("strong",Se,d((((N=(H=a(o))==null?void 0:H.summary)==null?void 0:N.total_working_hours)??"").toString().trim()||"â€”"),1)]),t("div",$e,[e[20]||(e[20]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-bolt text-[12px]"}),u(" Overtime Hours ")],-1)),t("strong",Ae,d((O=(W=a(o))==null?void 0:W.summary)==null?void 0:O.approved_over_times)+" Of "+d(((V=(R=a(o))==null?void 0:R.summary)==null?void 0:V.total_overtime_hours)||0),1)])])])):b("",!0)])]),m.value?b("",!0):(p(),f("div",Ue,e[22]||(e[22]=[t("p",{class:"text-gray-400 text-center text-2xl italic"},"Select an employee, please.",-1)]))),a(o).isLoading?(p(),J(ae,{key:1})):K((p(),f("div",Ce,[S(oe,{logs:a(o).monthlyLogs},null,8,["logs"])],512)),[[ne,h.value]])])}}};export{Je as default};
