import{S as de,r as h,q as W,h as $t,x as w,y as re,i as xe,o as d,d as U,l as P,c as r,j as N,a as t,T as ae,t as o,F as X,e as tt,b as A,k as ot,H as be,v as bt,Z as he,A as Et,u as we,f as ke,g as Se,D as it,G as oe,p as Ce,m as M,w as at,s as b,C as Ae}from"./index-BWeFhFv1.js";import{_ as $e}from"./EmployeeFilter-DqH50au3.js";import{L as Ee}from"./LoaderView-Gd2iJ5St.js";import{d as le}from"./dayjs.min-D2tF7xgD.js";import{u as ce}from"./shift-B95D1_-b.js";import{S as qe}from"./WeekendAssignModal-CRV393Y7.js";import{C as Ue}from"./CriteriaAssignModal-lpH_xW1U.js";import{u as Ne}from"./company-DuDAlsR0.js";import{u as ze}from"./department-CSZXlazt.js";import{u as je}from"./user-CdVfytxZ.js";import{u as De}from"./userClearance-CTTWnuxL.js";import"./EmployeeDropdownInput-DOfeQZck.js";import"./SelectDropdown-ByIaWiXh.js";import"./UserChip-Cuvuom0U.js";import"./monthly-kpi-assignments-Ys8oM_73.js";const Le={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Ie={class:"relative w-full max-w-xl rounded-2xl bg-white shadow-xl ring-1 ring-black/5 p-5"},Ve={class:"flex items-start justify-between mb-4"},Me={class:"flex items-center gap-3"},We={class:"h-10 w-10 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center font-semibold"},Oe={class:"text-base font-semibold text-gray-900"},Te={class:"text-xs text-gray-500"},Pe={class:"flex flex-col gap-2"},Re={class:"md:col-span-5"},Ke={class:"rounded-lg border bg-white p-2"},Be={class:"flex items-center justify-between mb-2"},Fe={class:"text-xs text-gray-500"},He={key:0,class:"text-sm text-gray-500"},Ye={key:1},Qe=["checked"],Ge={class:"flex-1"},Je={class:"flex items-center gap-2"},Ze={class:"text-sm text-gray-900"},Xe={key:0,class:"inline-flex items-center text-xs font-medium rounded-full bg-green-100 text-green-700 px-2 py-0.5"},ts={key:1,class:"inline-flex items-center text-xs font-medium rounded-full bg-gray-100 text-gray-700 px-2 py-0.5"},es={class:"mt-0.5 text-xs text-gray-600"},ss={key:0,class:"ml-2 text-gray-400"},ns={class:"rounded-lg border bg-white p-4"},is={class:"grid gap-4 md:grid-cols-12"},as={class:"md:col-span-12"},os=["disabled"],ls=["value"],ds={key:0,class:"mt-1 text-xs text-gray-500"},rs={class:"md:col-span-6"},cs={class:"mt-4 flex justify-end gap-2"},ps=["disabled"],ms=["disabled"],fs={key:0},ys={key:1},_s={__name:"ShiftAssignmentModal",props:{modelValue:{type:Boolean,default:!1},isOpen:{type:Boolean,default:!1},employee:{type:Object,default:()=>({id:0,name:""})},shifts:{type:[Array,Object],default:()=>[]},hasShift:{type:Object,default:null},current_shift:{type:Object,default:null},shift_history:{type:[Object,Array,null],default:null}},emits:["update:modelValue","saved","close"],setup(lt,{emit:dt}){var ft;const p=lt,R=dt,et=de(),rt=ce(),v=h(!1);W(()=>p.modelValue,i=>{i!==v.value&&(v.value=i)}),W(()=>p.isOpen,i=>{i!==v.value&&(v.value=i)}),$t(()=>{v.value=!!(p.modelValue||p.isOpen)});function z(){v.value&&(v.value=!1,R("update:modelValue",!1),R("close",!1))}const u=h({shift_id:"",employee_id:((ft=p.employee)==null?void 0:ft.id)||0,start_date:"",end_date:""});W(()=>p.employee,i=>{u.value.employee_id=(i==null?void 0:i.id)||0},{immediate:!0,deep:!0});const $=w(()=>{var S,m,Q,G;const i=((S=p.employee)==null?void 0:S.name)||String(((m=p.employee)==null?void 0:m.id)||""),l=i.trim().split(/\s+/);return((((Q=l[0])==null?void 0:Q[0])||"")+(((G=l[1])==null?void 0:G[0])||"")||i[0]||"#").toUpperCase().slice(0,2)});function K(i){return i?typeof i=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(i)?i:le(i).isValid()?le(i).format("YYYY-MM-DD"):"":""}const ct=w(()=>{const i=p.shifts;return Array.isArray(i)?i:i&&typeof i=="object"?Object.values(i).flat().filter(Boolean):[]}),ht=w(()=>{const i=p.shift_history;return i&&typeof i=="object"&&Array.isArray(i.history)?i.history:Array.isArray(i)?i:i?[i]:[]}),D=w(()=>ht.value.map(i=>{var l,g;return{id:i.id??null,name:((l=i==null?void 0:i.shift)==null?void 0:l.name)||(i==null?void 0:i.name)||`#${(i==null?void 0:i.shift_id)||(i==null?void 0:i.id)||"—"}`,shift_id:((g=i==null?void 0:i.shift)==null?void 0:g.id)??(i==null?void 0:i.shift_id)??null,start_date:K(i.start_date),end_date:K(i.end_date),status:i.status||(i.end_date?"ended":"active"),days:i.days??null,active:!i.end_date||i.status==="active",created_at:i.created_at?new Date(i.created_at).getTime():0}}).sort((i,l)=>i.active!==l.active?i.active?-1:1:(l.start_date||"").localeCompare(i.start_date||""))),wt=w(()=>{const i=p.shift_history;return i&&typeof i=="object"&&typeof i.count=="number"?i.count:D.value.length}),O=w(()=>{var g,S;const i=D.value.find(m=>m.active);if(i)return i;const l=p.current_shift||p.hasShift;return l?{id:l.id??null,name:((g=l==null?void 0:l.shift)==null?void 0:g.name)||(l==null?void 0:l.name)||`#${(l==null?void 0:l.shift_id)||(l==null?void 0:l.id)||"—"}`,shift_id:((S=l==null?void 0:l.shift)==null?void 0:S.id)??(l==null?void 0:l.shift_id)??null,start_date:K(l.start_date),end_date:K(l.end_date),active:!l.end_date}:null});async function pt(){const i=O.value;i?(u.value.shift_id=String(i.shift_id||""),u.value.start_date=K(i.start_date)||"",u.value.end_date=K(i.end_date)||""):(u.value.shift_id="",u.value.start_date="",u.value.end_date="")}W(v,(i,l)=>{i&&!l&&Et(pt)}),W([O,()=>p.shift_history],()=>{v.value&&Et(pt)});const T=h(!1),a=w(()=>!!u.value.employee_id&&!!u.value.shift_id&&!!u.value.start_date&&!T.value);async function st(){var i,l;try{if(!a.value){et.error("All required fields must be filled");return}T.value=!0;const g={employee_id:Number(u.value.employee_id),shift_id:Number(u.value.shift_id),start_date:u.value.start_date,end_date:u.value.end_date||null},S=await rt.shiftAssign(g);et.success(O.value?"Shift updated":"Shift assigned"),R("saved",S),z()}catch(g){const S=((l=(i=g==null?void 0:g.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to assign shift";et.error(S)}finally{T.value=!1}}function mt(i){v.value&&(i.key==="Escape"&&z(),(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="enter"&&a.value&&st())}return $t(()=>window.addEventListener("keydown",mt)),re(()=>window.removeEventListener("keydown",mt)),(i,l)=>(d(),xe(he,{to:"body"},[U(ae,{name:"fade"},{default:P(()=>[v.value?(d(),r("div",Le,[t("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:z}),U(ae,{name:"pop"},{default:P(()=>{var g,S;return[t("div",Ie,[t("div",Ve,[t("div",Me,[t("div",We,o($.value),1),t("div",null,[t("h3",Oe,o(O.value?"Update Shift":"Assign Shift"),1),t("p",Te,o(((g=lt.employee)==null?void 0:g.name)||"#"+(((S=lt.employee)==null?void 0:S.id)||"")),1)])]),t("button",{class:"btn-icon",onClick:z,"aria-label":"Close"},"✕")]),t("div",Pe,[t("div",Re,[t("div",Ke,[t("div",Be,[l[2]||(l[2]=t("h4",{class:"text-sm font-semibold text-gray-800"},"Shift history",-1)),t("span",Fe,o(wt.value)+" item(s)",1)]),D.value.length?(d(),r("ul",Ye,[(d(!0),r(X,null,tt(D.value,(m,Q)=>(d(),r("li",{key:m.id??Q,class:"flex items-start gap-3"},[t("input",{type:"checkbox",class:"mt-1 rounded border-gray-300",checked:m.active,disabled:""},null,8,Qe),t("div",Ge,[t("div",Je,[t("span",Ze,o(m.name),1),m.active?(d(),r("span",Xe,"Active")):(d(),r("span",ts,"Closed"))]),t("div",es,[A(" Period: "+o(m.start_date||"—")+" → "+o(m.end_date||"present")+" ",1),m.days?(d(),r("span",ss,"("+o(m.days)+" days)",1)):N("",!0)])])]))),128))])):(d(),r("div",He," No history found "))])]),t("div",ns,[t("div",is,[t("div",as,[l[4]||(l[4]=t("label",{class:"block text-sm font-medium text-gray-700"},"Select Shift",-1)),ot(t("select",{"onUpdate:modelValue":l[0]||(l[0]=m=>u.value.shift_id=m),class:"mt-1 w-full rounded-md border px-3 py-2 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",disabled:!ct.value.length},[l[3]||(l[3]=t("option",{value:""},"Choose a shift…",-1)),(d(!0),r(X,null,tt(ct.value,m=>(d(),r("option",{key:m==null?void 0:m.id,value:m==null?void 0:m.id},o(m==null?void 0:m.name),9,ls))),128))],8,os),[[be,u.value.shift_id]]),ct.value.length?N("",!0):(d(),r("p",ds,"No shifts found"))]),t("div",rs,[l[5]||(l[5]=t("label",{class:"block text-sm font-medium text-gray-700"},"Start Date",-1)),ot(t("input",{"onUpdate:modelValue":l[1]||(l[1]=m=>u.value.start_date=m),type:"date",class:"mt-1 w-full rounded-md border px-3 py-2"},null,512),[[bt,u.value.start_date]])])]),t("div",cs,[t("button",{class:"btn-3",onClick:z,disabled:T.value},"Cancel",8,ps),t("button",{class:"btn-2",onClick:st,disabled:!a.value},[T.value?(d(),r("span",ys,"Processing…")):(d(),r("span",fs,o(O.value?"Update":"Assign"),1))],8,ms)])])])])]}),_:1})])):N("",!0)]),_:1})]))}},us={class:"space-y-3 p-5"},gs={class:"flex items-center justify-between gap-2"},vs={class:"flex gap-3"},xs={key:0,class:"rounded-md border border-indigo-200 bg-indigo-50 p-3 text-sm text-indigo-800"},bs={class:"sticky top-14 z-40 -mx-5 px-5 py-3 bg-white/90 supports-[backdrop-filter]:bg-white/70 backdrop-blur border-b border-zinc-200"},hs={class:"flex flex-col md:flex-row md:items-end gap-2"},ws={class:"flex items-center gap-1"},ks={class:"flex items-center gap-2 w-full md:w-auto"},Ss={class:"mt-2 flex flex-wrap gap-2 text-[12px]"},Cs={class:"px-2 py-1 rounded-full bg-zinc-100 text-zinc-700"},As={class:"px-2 py-1 rounded-full bg-emerald-100 text-emerald-700"},$s={class:"px-2 py-1 rounded-full bg-rose-100 text-rose-700"},Es={class:"px-2 py-1 rounded-full bg-amber-100 text-amber-800"},qs={class:"px-2 py-1 rounded-full bg-zinc-100 text-zinc-700"},Us={class:"px-2 py-1 rounded-full bg-emerald-100 text-emerald-800"},Ns={class:"px-2 py-1 rounded-full bg-zinc-100 text-zinc-700"},zs={key:1,class:"text-center py-6"},js={key:2,class:"space-y-4"},Ds={key:0,class:"text-center py-6 text-lg italic text-gray-500"},Ls={class:"flex items-center justify-between"},Is={class:"title-md"},Vs={class:"grid grid-cols-1 gap-2 md:hidden"},Ms={class:"flex items-start gap-3"},Ws={class:"h-10 w-10 shrink-0 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold"},Os={class:"min-w-0"},Ts={class:"font-medium leading-5 truncate"},Ps={class:"text-[12px] text-zinc-500"},Rs={class:"mt-1 text-[12px] text-zinc-600"},Ks={class:"text-[12px] text-zinc-600"},Bs={class:"mt-1"},Fs={class:"mt-1 text-[12px]"},Hs=["href"],Ys=["href"],Qs={class:"mt-2 flex gap-1"},Gs=["disabled","onClick"],Js=["disabled","onClick"],Zs=["disabled","onClick"],Xs=["onClick"],tn={class:"overflow-x-auto hidden md:block"},en={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},sn={class:"border border-gray-100 px-2 py-2"},nn={class:"border border-gray-100 px-3 py-2"},an={class:"flex items-start gap-2"},on={key:0,class:"h-8 w-8 shrink-0 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold"},ln=["src","alt"],dn={key:1,class:"h-8 w-8 shrink-0 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold"},rn={class:"min-w-0"},cn={class:"font-medium truncate max-w-[220px]"},pn={class:"text-[11px] text-zinc-500"},mn={class:"text-[11px] text-zinc-500"},fn={class:"text-[11px] text-zinc-500"},yn={class:"border border-gray-100 px-2 py-2"},_n={class:"flex items-center gap-2"},un=["href"],gn={class:"flex items-center gap-2"},vn=["href"],xn={class:"border border-gray-100 px-2 py-2 whitespace-nowrap"},bn={class:"border border-gray-100 px-2 py-2 whitespace-nowrap"},hn={class:"border border-gray-100 px-2 py-2 whitespace-nowrap"},wn={class:"border border-gray-100 px-3 py-2 whitespace-nowrap"},kn=["onClick","title","disabled"],Sn={class:"ml-1 hidden lg:inline"},Cn={class:"mt-1 text-[11px] text-gray-500"},An={class:"border border-gray-100 px-3 py-2 whitespace-nowrap"},$n=["onClick","title","disabled"],En={class:"ml-1 hidden lg:inline"},qn={class:"mt-1 text-[11px] text-gray-500"},Un={class:"border border-gray-100 px-2 py-2"},Nn={key:0,class:"mt-1 text-[11px] text-rose-600"},zn={class:"border border-gray-100 px-3 py-2 whitespace-nowrap"},jn=["onClick","title","disabled"],Dn={class:"ml-1 hidden lg:inline"},Ln={class:"border border-gray-100 px-2 py-2"},In={class:"flex gap-2"},Vn=["onClick"],Mn={key:3,class:"fixed inset-0 z-[9999] flex items-center justify-center"},Wn={class:"relative w-full max-w-lg rounded-lg bg-white shadow-xl"},On={class:"space-y-4 p-4"},Tn={class:"text-sm text-gray-600"},Pn={class:"font-semibold text-gray-900"},Rn={class:"space-y-1"},Kn={class:"space-y-1"},Bn={key:0,class:"rounded-md border border-red-200 bg-red-50 p-2 text-sm text-red-700"},Fn={key:1,class:"rounded-md border border-amber-200 bg-amber-50 p-2 text-sm text-amber-800"},Hn={class:"flex items-center justify-end gap-2 border-t bg-gray-50 px-4 py-3"},Yn=["disabled"],Qn={key:0},Gn={key:1},Jn=["disabled"],Zn={key:0},Xn={key:1},ti={id:"print-area",class:"print-area"},ei={class:"text-center"},si={class:"text-xl font-bold tracking-wide"},ni={class:"mt-4 grid grid-cols-2 gap-3 text-sm"},ii={class:"font-medium"},ai={class:"font-medium"},oi={class:"font-medium"},li={class:"font-medium"},di={class:"mt-4 rounded-md border border-gray-200 p-3 text-sm"},ri={class:"font-medium"},ci={class:"mt-1"},pi={class:"font-medium"},mi={class:"mt-4"},fi={key:0,class:"text-sm text-gray-600"},yi={key:1,class:"text-sm text-rose-600"},_i={key:2,class:"w-full border border-gray-300 text-sm",style:{"border-collapse":"collapse"}},ui={class:"border border-gray-300 px-2 py-1"},gi={class:"border border-gray-300 px-2 py-1"},vi={class:"border border-gray-300 px-2 py-1"},xi={key:0},bi={class:"mt-6 text-xs text-gray-500"},Ii={__name:"UserList",setup(lt){const dt=we(),p=ke(),R=de(),et=Se(),rt=Ne(),v=ze(),z=je(),u=ce(),$=De(),{companies:K}=it(rt),{departments:ct}=it(v),{shifts:ht}=it(u),{users:D,isLoading:wt}=it(z),{items:O,loading:pt,error:T}=it($),a=oe({company:String(p.query.company??"all"),department:String(p.query.department??"all"),line_type:String(p.query.line_type??"all"),status:String(p.query.status??"active"),employee_id:String(p.query.employee_id??""),q:String(p.query.q??"")});let st=null;const mt=w(()=>{const n={};return a.company&&a.company!=="all"&&(n.company=a.company),a.department&&a.department!=="all"&&(n.department=a.department),a.line_type&&a.line_type!=="all"&&(n.line_type=a.line_type),a.status&&a.status!=="all"&&(n.status=a.status),a.employee_id&&(n.employee_id=a.employee_id),a.q&&(n.q=a.q),p.query.action&&(n.action=p.query.action),n});function ft(){clearTimeout(st),st=setTimeout(()=>{dt.replace({query:{...mt.value}})},250)}W(a,ft,{deep:!0}),$t(async()=>{await rt.fetchCompanies(),a.company&&a.company!=="all"&&await v.fetchDepartments(a.company),i()}),W(()=>p.query,()=>i(),{deep:!0});async function i(){await z.fetchUsers({company_id:p.query.company,department_id:p.query.department,line_type:p.query.line_type,status:p.query.status,user_id:p.query.employee_id,q:p.query.q})}W(()=>a.company,async(n,e)=>{var c;n!==e&&(n&&n!=="all"?await v.fetchDepartments(n):(c=v.$reset)==null||c.call(v))});const l=()=>dt.go(-1),g=n=>{if(!n)return"";if(typeof n=="string")return n.slice(0,10);const e=new Date(n);return Number.isNaN(e.getTime())?"":e.toISOString().slice(0,10)},S=w(()=>p.query.action==="clearance"),m=w(()=>{var e;const n=String(((e=et.user)==null?void 0:e.role)||"").toLowerCase();return["admin","super_admin","developer"].includes(n)}),Q=()=>{const n=new Date;return new Date(n.getTime()-n.getTimezoneOffset()*6e4).toISOString().slice(0,10)},G=n=>{const e=g(n==null?void 0:n.last_working_date);return!!e&&e<=Q()},y=n=>n!=null&&n.is_inactive||G(n)?!0:Number((n==null?void 0:n.is_active)??0)===0,J=n=>{var e,c;return!!((c=(e=n==null?void 0:n.current_shift)==null?void 0:e.shift)!=null&&c.name)},qt=n=>{var e,c;return((c=(e=n==null?void 0:n.current_shift)==null?void 0:e.shift)==null?void 0:c.name)||"Not Assigned"},B=n=>{var e;return Array.isArray((e=n==null?void 0:n.assign_weekend)==null?void 0:e.weekends)&&n.assign_weekend.weekends.length>0},Ut=n=>B(n)?n.assign_weekend.weekends.join(", "):"Not Assigned",pe=(n,e)=>{var _,q,x;if(!e)return!0;const c=e.toLowerCase();return[n==null?void 0:n.name,n==null?void 0:n.phone,n==null?void 0:n.employee_id,(_=n==null?void 0:n.company)==null?void 0:_.name,(q=n==null?void 0:n.department)==null?void 0:q.name,(x=n==null?void 0:n.designation)==null?void 0:x.title].some(k=>String(k||"").toLowerCase().includes(c))},me=n=>{if(a.status==="all")return!0;const e=y(n);return a.status==="active"?!e:e},Nt=w(()=>(Array.isArray(D.value)?D.value:[]).filter(e=>{var c;return!(a.company!=="all"&&String((c=e==null?void 0:e.company)==null?void 0:c.id)!==String(a.company)||a.line_type!=="all"&&String(e==null?void 0:e.type)!==String(a.line_type)||a.employee_id&&String(e==null?void 0:e.id)!==String(a.employee_id)||!me(e)||!pe(e,a.q))})),F=w(()=>{const n=Nt.value,e=n.length,c=n.filter(x=>Number((x==null?void 0:x.is_active)??0)===1).length,_=n.filter(x=>J(x)).length,q=n.filter(x=>B(x)).length;return{total:e,active:c,inactive:e-c,withShift:_,withoutShift:e-_,withWeekend:q,withoutWeekend:e-q}}),zt=w(()=>{var e;const n={};for(const c of Nt.value){const _=((e=c==null?void 0:c.company)==null?void 0:e.name)||"Unknown Company";(n[_]??(n[_]=[])).push(c)}return n});h(null);const C=h(null),kt=h(null),jt=h(null),yt=h(!1),St=h(!1),_t=h(!1),nt=h(!1),E=h(null),j=oe({last_working_date:"",exit_reason:""}),ut=h(!1),L=h(""),gt=h(!1),H=h(""),Y=w(()=>E.value),fe=w(()=>{var n,e;return((e=(n=Y.value)==null?void 0:n.company)==null?void 0:e.name)||"Digi Attendance"}),Dt=w(()=>(Array.isArray(O.value)?O.value:[]).map(e=>{const c=e.latest||{};return{label:e.label||e.template_item_name||e.item_key||`#${e.template_item_id??e.id??""}`,status:c.status||e.status||(e.is_cleared?"COMPLETED":"PENDING"),remarks:c.remarks||e.remarks||""}}));async function Lt(n){if(C.value=n,n!=null&&n.company_id){const e=await z.fetchUserShifts(n.id);jt.value=e,await u.fetchShifts(n.company_id)}yt.value=!0}async function It(n){C.value=n,St.value=!0;try{const e=await z.fetchUserWeekends(n.id);kt.value=e}catch{kt.value={history:[],current:null}}}function Vt(n){C.value=n,_t.value=!0}function Mt(n){n!=null&&n.id&&(E.value=n,j.last_working_date=g(n==null?void 0:n.last_working_date),j.exit_reason=(n==null?void 0:n.exit_reason)||"",L.value="",H.value="",nt.value=!0)}function vt(){nt.value=!1,L.value="",H.value=""}function Ct(n){n.key==="Escape"&&vt()}async function ye(){var n,e,c,_,q,x,k;if(!(!((n=E.value)!=null&&n.id)||!((e=E.value)!=null&&e.last_working_date))){gt.value=!0,H.value="";try{(c=$.resetFilters)==null||c.call($),(_=$.setUser)==null||_.call($,E.value.id),await((q=$.fetch)==null?void 0:q.call($)),document.body.classList.add("printing-exit"),await Et(),window.print()}catch(I){H.value=((k=(x=I==null?void 0:I.response)==null?void 0:x.data)==null?void 0:k.message)||"Failed to load clearance for print.",R.error(H.value)}finally{gt.value=!1,setTimeout(()=>document.body.classList.remove("printing-exit"),0)}}}async function _e(){var n,e,c;if(!((n=E.value)!=null&&n.id)){L.value="Select a user first.";return}if(!j.last_working_date){L.value="Last working date is required.";return}ut.value=!0,L.value="";try{await Ae.put(`/users/${E.value.id}/exit`,{last_working_date:j.last_working_date,exit_reason:j.exit_reason||null});const _=k=>{k&&(k.last_working_date=j.last_working_date,k.exit_reason=j.exit_reason||"",k.is_inactive=G(k))};_(E.value);const x=(Array.isArray(D.value)?D.value:[]).find(k=>{var I;return k.id===((I=E.value)==null?void 0:I.id)});_(x),nt.value=!1,R.success("Exit information updated.")}catch(_){L.value=((c=(e=_==null?void 0:_.response)==null?void 0:e.data)==null?void 0:c.message)||"Failed to update exit info.",R.error(L.value)}finally{ut.value=!1}}async function ue(){await z.fetchUsersExcelExport({data:{company_id:a.company!=="all"?a.company:void 0,department_id:a.department!=="all"?a.department:void 0,line_type:a.line_type!=="all"?a.line_type:void 0,status:a.status!=="all"?a.status:void 0,employee_id:a.employee_id||void 0,q:a.q||void 0}})}function ge(){_t.value=!1}function ve(){a.company="all",a.department="all",a.line_type="all",a.status="active",a.employee_id="",a.q=""}return W(nt,n=>{n?window.addEventListener("keydown",Ct):(window.removeEventListener("keydown",Ct),E.value=null)}),re(()=>{window.removeEventListener("keydown",Ct)}),(n,e)=>{var _,q,x,k,I,Wt,Ot,Tt,Pt,Rt;const c=Ce("RouterLink");return d(),r("div",us,[t("div",gs,[t("button",{class:"btn-3",onClick:l},e[17]||(e[17]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[20]||(e[20]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),t("div",vs,[U(c,{to:{name:"UserAdd",query:{company:M(p).query.company}},class:"btn-2"},{default:P(()=>e[18]||(e[18]=[t("span",{class:"hidden md:flex"},"Add New",-1),t("i",{class:"far fa-plus"},null,-1)])),_:1,__:[18]},8,["to"]),t("button",{type:"button",onClick:ue,class:"btn-3"},e[19]||(e[19]=[t("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),A("Excel ")]))])]),S.value?(d(),r("div",xs," Select a user to view clearance & print. ")):N("",!0),t("div",bs,[t("div",hs,[U($e,{company_id:a.company,"onUpdate:company_id":e[3]||(e[3]=f=>a.company=f),department_id:a.department,"onUpdate:department_id":e[4]||(e[4]=f=>a.department=f),employee_id:a.employee_id,"onUpdate:employee_id":e[5]||(e[5]=f=>a.employee_id=f),line_type:a.line_type,"onUpdate:line_type":e[6]||(e[6]=f=>a.line_type=f),"with-type":!0,"initial-value":n.$route.query,class:"w-full"},{default:P(()=>[t("div",ws,[t("button",{class:b(["h-8 px-3 text-xs rounded-l-md border transition",a.status==="all"?"bg-zinc-800 text-white border-zinc-800":"bg-white border-zinc-300 hover:bg-zinc-50"]),onClick:e[0]||(e[0]=at(f=>a.status="all",["prevent"]))},"All",2),t("button",{class:b(["h-8 px-3 text-xs border-y transition",a.status==="active"?"bg-emerald-600 text-white border-emerald-600":"bg-white border-zinc-300 hover:bg-zinc-50"]),onClick:e[1]||(e[1]=at(f=>a.status="active",["prevent"]))},"Active",2),t("button",{class:b(["h-8 px-3 text-xs rounded-r-md border transition",a.status==="in_active"?"bg-rose-600 text-white border-rose-600":"bg-white border-zinc-300 hover:bg-zinc-50"]),onClick:e[2]||(e[2]=at(f=>a.status="in_active",["prevent"]))},"Inactive",2)])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",ks,[ot(t("input",{"onUpdate:modelValue":e[7]||(e[7]=f=>a.q=f),type:"text",placeholder:"Search name / phone / ID",class:"input-1 h-8 text-sm w-full md:w-64"},null,512),[[bt,a.q,void 0,{trim:!0}]]),t("button",{type:"button",onClick:ve,class:"inline-flex h-8 items-center rounded-md border border-zinc-300 bg-zinc-50 px-3 text-[12px] font-medium text-zinc-700 hover:bg-white active:scale-[.99]",title:"Reset filters"},e[21]||(e[21]=[t("i",{class:"far fa-undo mr-1"},null,-1),A(" Reset ")]))])]),t("div",Ss,[t("span",Cs,"Total: "+o(F.value.total),1),t("span",As,"Active: "+o(F.value.active),1),t("span",$s,"Inactive: "+o(F.value.inactive),1),t("span",Es,"With Shift: "+o(F.value.withShift),1),t("span",qs,"No Shift: "+o(F.value.withoutShift),1),t("span",Us,"With Weekend: "+o(F.value.withWeekend),1),t("span",Ns,"No Weekend: "+o(F.value.withoutWeekend),1)])]),M(wt)?(d(),r("div",zs,[U(Ee)])):(d(),r("div",js,[Object.keys(zt.value).length===0?(d(),r("div",Ds," No users found ")):N("",!0),(d(!0),r(X,null,tt(zt.value,(f,xt)=>{var Kt,Bt,Ft,Ht,Yt,Qt,Gt,Jt;return d(),r("div",{key:xt,class:"space-y-2"},[t("div",Ls,[t("h2",Is,o(xt)+" ("+o(f.length)+")",1)]),t("div",Vs,[(d(!0),r(X,null,tt(f,s=>{var V;return d(),r("div",{key:s.id,class:"rounded-lg border border-zinc-200 bg-white p-3 shadow-sm"},[t("div",Ms,[t("div",Ws,o(((s==null?void 0:s.name)||"?").charAt(0).toUpperCase()),1),t("div",Os,[t("div",Ts,o(s==null?void 0:s.name),1),t("div",Ps,"ID: "+o(s==null?void 0:s.employee_id)+" • "+o(((V=s==null?void 0:s.designation)==null?void 0:V.title)||"—"),1),t("div",Rs,"Shift: "+o(qt(s)),1),t("div",Ks,"Weekend: "+o(Ut(s)),1),t("div",Bs,[t("span",{class:b(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium",y(s)?"bg-rose-50 text-rose-700":"bg-emerald-50 text-emerald-700"])},o(y(s)?"Inactive":"Active"),3)]),t("div",Fs,[t("a",{class:"underline",href:"tel:"+(s==null?void 0:s.phone),onClick:e[8]||(e[8]=at(()=>{},["stop"]))},o((s==null?void 0:s.phone)||"—"),9,Hs),e[22]||(e[22]=t("span",{class:"mx-1"},"•",-1)),t("a",{class:"underline",href:"mailto:"+((s==null?void 0:s.email)||""),onClick:e[9]||(e[9]=at(()=>{},["stop"]))},o((s==null?void 0:s.email)||"নেই"),9,Ys)]),t("div",Qs,[t("button",{class:b(["btn-3 !px-2 !py-1",y(s)?"opacity-50 cursor-not-allowed pointer-events-none":""]),disabled:y(s),onClick:Z=>Lt(s)}," Shift ",10,Gs),t("button",{class:b(["btn-3 !px-2 !py-1",y(s)?"opacity-50 cursor-not-allowed pointer-events-none":""]),disabled:y(s),onClick:Z=>It(s)}," Weekend ",10,Js),t("button",{class:b(["btn-3 !px-2 !py-1",y(s)?"opacity-50 cursor-not-allowed pointer-events-none":""]),disabled:y(s),onClick:Z=>Vt(s)}," KPI ",10,Zs),m.value?(d(),r("button",{key:0,class:"btn-1 !px-2 !py-1",onClick:Z=>Mt(s),title:"Exit / Leave"}," Exit ",8,Xs)):N("",!0),U(c,{to:{name:"UserShow",params:{id:s.id},query:{company:M(p).query.company}},class:"btn-3 !px-2 !py-1"},{default:P(()=>e[23]||(e[23]=[A("View")])),_:2,__:[23]},1032,["to"])])])])])}),128))]),t("div",tn,[t("table",en,[e[27]||(e[27]=t("thead",null,[t("tr",{class:"bg-gray-100 text-sm font-medium text-gray-700"},[t("th",{class:"border border-gray-200 px-2 py-2 text-left"},"#"),t("th",{class:"border border-gray-200 px-3 py-2 text-left"},"Name"),t("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Phone & Email"),t("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Finger ID"),t("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Joining"),t("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Role"),t("th",{class:"border border-gray-200 px-3 py-2 text-left"},"Shift"),t("th",{class:"border border-gray-200 px-3 py-2 text-left"},"Weekend"),t("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Status"),t("th",{class:"border border-gray-200 px-3 py-2 text-left"},"KPI Criteria"),t("th",{class:"border border-gray-200 px-2 py-2 text-left"},"Action")])],-1)),t("tbody",null,[(d(!0),r(X,null,tt(f,(s,V)=>{var Z,Zt,Xt,te,ee,se,ne,ie;return d(),r("tr",{key:s.id,class:b(["border-b text-sm border-gray-100 hover:bg-indigo-50/50",y(s)?"opacity-70":""])},[t("td",sn,o(V+1),1),t("td",nn,[t("div",an,[s.photo?(d(),r("div",on,[t("img",{src:s.photo,alt:s==null?void 0:s.name,class:"h-8 w-8 rounded-full object-cover"},null,8,ln)])):(d(),r("div",dn,o(((s==null?void 0:s.name)||"?").charAt(0).toUpperCase()),1)),t("div",rn,[t("div",cn,o(s==null?void 0:s.name),1),t("div",pn,o(s==null?void 0:s.bn_name),1),t("div",mn,o(((Z=s==null?void 0:s.designation)==null?void 0:Z.title)||"—"),1),t("div",fn,"ID: "+o(s==null?void 0:s.employee_id),1)])])]),t("td",yn,[t("div",_n,[t("a",{class:"underline",href:"tel:"+(s==null?void 0:s.phone)},o((s==null?void 0:s.phone)||"—"),9,un)]),t("div",gn,[t("a",{class:"underline",href:"mailto:"+((s==null?void 0:s.email)||"")},o((s==null?void 0:s.email)||"নেই"),9,vn)])]),t("td",xn,o(s==null?void 0:s.device_user_id),1),t("td",bn,o(s==null?void 0:s.joining_date),1),t("td",hn,o(s==null?void 0:s.role),1),t("td",wn,[t("button",{onClick:At=>Lt(s),title:J(s)?"Manage Shift":"Assign Shift",class:b(["group inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium transition","focus:outline-none focus:ring-2 focus:ring-offset-1",y(s)?"opacity-50 cursor-not-allowed pointer-events-none":"",J(s)?"border-amber-200 bg-amber-50 text-amber-700 hover:bg-amber-100 focus:ring-amber-300":"border-slate-200 bg-slate-50 text-slate-600 hover:bg-white focus:ring-slate-300"]),disabled:y(s)},[t("span",Sn,o(J(s)?"Manage":"Assign"),1),t("span",{class:b(["ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full px-1 text-[10px] font-semibold",J(s)?"bg-amber-600 text-white":"bg-slate-200 text-slate-700"])},o((s==null?void 0:s.shifts_count)||(J(s)?1:0)),3)],10,kn),t("div",Cn,o(qt(s)),1)]),t("td",An,[t("button",{onClick:At=>It(s),title:B(s)?"Manage Weekend":"Assign Weekend",class:b(["group inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium transition","focus:outline-none focus:ring-2 focus:ring-offset-1",y(s)?"opacity-50 cursor-not-allowed pointer-events-none":"",B(s)?"border-emerald-200 bg-emerald-50 text-emerald-700 hover:bg-emerald-100 focus:ring-emerald-300":"border-slate-200 bg-slate-50 text-slate-600 hover:bg-white focus:ring-slate-300"]),disabled:y(s)},[t("span",En,o(B(s)?"Manage":"Assign"),1),t("span",{class:b(["ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full px-1 text-[10px] font-semibold",B(s)?"bg-emerald-600 text-white":"bg-slate-200 text-slate-700"])},o((s==null?void 0:s.assign_weekends_count)||B(s)&&((Xt=(Zt=s==null?void 0:s.assign_weekend)==null?void 0:Zt.weekends)==null?void 0:Xt.length)||0),3)],10,$n),t("div",qn,o(Ut(s)),1)]),t("td",Un,[t("span",{class:b(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",y(s)?"bg-rose-50 text-rose-700":"bg-emerald-50 text-emerald-700"])},o(y(s)?"Inactive":"Active"),3),G(s)?(d(),r("div",Nn," Exit: "+o(g(s==null?void 0:s.last_working_date)),1)):N("",!0)]),t("td",zn,[t("button",{onClick:At=>Vt(s),title:(((te=s==null?void 0:s.criteria_assignments)==null?void 0:te.length)||0)>0?"Manage KPI criteria":"Assign KPI criteria",class:b(["group inline-flex items-center rounded-full border px-2.5 py-1 text-xs font-medium transition","focus:outline-none focus:ring-2 focus:ring-offset-1",y(s)?"opacity-50 cursor-not-allowed pointer-events-none":"",(((ee=s==null?void 0:s.criteria_assignments)==null?void 0:ee.length)||0)>0?"border-indigo-200 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 focus:ring-indigo-300":"border-slate-200 bg-slate-50 text-slate-600 hover:bg-white focus:ring-slate-300"]),disabled:y(s)},[t("span",Dn,o((((se=s==null?void 0:s.criteria_assignments)==null?void 0:se.length)||0)>0?"Manage":"Assign"),1),t("span",{class:b(["ml-1 inline-flex h-5 min-w-[20px] items-center justify-center rounded-full px-1 text-[10px] font-semibold",(((ne=s==null?void 0:s.criteria_assignments)==null?void 0:ne.length)||0)>0?"bg-indigo-600 text-white":"bg-slate-200 text-slate-700"])},o(((ie=s==null?void 0:s.criteria_assignments)==null?void 0:ie.length)||0),3)],10,jn)]),t("td",Ln,[t("div",In,[U(c,{to:{name:"UserShow",params:{id:s.id},query:{company:M(p).query.company}},class:"btn-icon",title:"View"},{default:P(()=>e[24]||(e[24]=[t("i",{class:"far fa-eye"},null,-1)])),_:2,__:[24]},1032,["to"]),U(c,{to:{name:"UserEdit",params:{id:s.id},query:{company:M(p).query.company}},class:b(["btn-icon",y(s)?"pointer-events-none opacity-50":""]),tabindex:y(s)?-1:0,title:"Edit"},{default:P(()=>e[25]||(e[25]=[t("i",{class:"far fa-edit"},null,-1)])),_:2,__:[25]},1032,["to","class","tabindex"]),U(c,{to:{name:"KpiReview",params:{employeeId:s.id}},class:b(["btn-icon",y(s)?"pointer-events-none opacity-50":""]),tabindex:y(s)?-1:0,title:"KPI"},{default:P(()=>e[26]||(e[26]=[A(" KPI ")])),_:2,__:[26]},1032,["to","class","tabindex"]),m.value?(d(),r("button",{key:0,type:"button",class:"btn-1 !px-2 !py-1 !text-xs",onClick:At=>Mt(s),title:"Exit / Leave"}," Exit ",8,Vn)):N("",!0)])])],2)}),128))])])]),U(Ue,{modelValue:_t.value,"onUpdate:modelValue":e[10]||(e[10]=s=>_t.value=s),"user-id":(Kt=C.value)==null?void 0:Kt.id,"user-label":(Bt=C.value)==null?void 0:Bt.name,criteria_assignments:(Ft=C.value)==null?void 0:Ft.criteria_assignments,onAssigned:ge},null,8,["modelValue","user-id","user-label","criteria_assignments"]),U(qe,{modelValue:St.value,"onUpdate:modelValue":e[11]||(e[11]=s=>St.value=s),"user-id":(Ht=C.value)==null?void 0:Ht.id,"user-label":(Yt=C.value)==null?void 0:Yt.name,assign_weekends:kt.value,onSaved:e[12]||(e[12]=s=>{const V=s==null?void 0:s.current;V&&C.value&&(C.value.assign_weekend={weekends:V.weekends||[],start_month:V.start_month,end_month:V.end_month})})},null,8,["modelValue","user-id","user-label","assign_weekends"]),U(_s,{modelValue:yt.value,"onUpdate:modelValue":e[13]||(e[13]=s=>yt.value=s),shifts:M(ht),employee:{id:(Qt=C.value)==null?void 0:Qt.id,name:(Gt=C.value)==null?void 0:Gt.name},"has-shift":(Jt=C.value)==null?void 0:Jt.current_shift,shift_history:jt.value,onClose:e[14]||(e[14]=s=>yt.value=!1)},null,8,["modelValue","shifts","employee","has-shift","shift_history"])])}),128))])),nt.value?(d(),r("div",Mn,[t("div",{class:"absolute inset-0 bg-black/40",onClick:vt}),t("div",Wn,[t("div",{class:"flex items-center justify-between border-b px-4 py-3"},[e[29]||(e[29]=t("h3",{class:"text-lg font-semibold text-gray-900"},"User Exit Information",-1)),t("button",{type:"button",class:"text-gray-500 hover:text-gray-700","aria-label":"Close",onClick:vt},e[28]||(e[28]=[t("i",{class:"far fa-times"},null,-1)]))]),t("div",On,[t("div",Tn,[e[30]||(e[30]=A(" User: ")),t("span",Pn,o(((_=E.value)==null?void 0:_.name)||"N/A"),1)]),t("div",Rn,[e[31]||(e[31]=t("label",{class:"text-sm font-medium text-gray-700"},[A(" Last Working Date "),t("span",{class:"text-red-500"},"*")],-1)),ot(t("input",{"onUpdate:modelValue":e[15]||(e[15]=f=>j.last_working_date=f),type:"date",class:"input-1 w-full",required:""},null,512),[[bt,j.last_working_date]])]),t("div",Kn,[e[32]||(e[32]=t("label",{class:"text-sm font-medium text-gray-700"},"Exit Reason",-1)),ot(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=f=>j.exit_reason=f),class:"input-1 w-full min-h-[90px]",placeholder:"Optional"},null,512),[[bt,j.exit_reason,void 0,{trim:!0}]])]),L.value?(d(),r("div",Bn,o(L.value),1)):N("",!0),H.value?(d(),r("div",Fn,o(H.value),1)):N("",!0)]),t("div",Hn,[t("button",{type:"button",class:"btn-3",onClick:vt},"Cancel"),t("button",{type:"button",class:"btn-2",disabled:gt.value||!((q=E.value)!=null&&q.last_working_date),onClick:ye,title:"Print Exit + Clearance"},[gt.value?(d(),r("span",Qn,"Preparing...")):(d(),r("span",Gn,"Print Exit Sheet"))],8,Yn),t("button",{type:"button",class:"btn-1",disabled:ut.value,onClick:_e},[ut.value?(d(),r("span",Zn,"Saving...")):(d(),r("span",Xn,"Save Exit Info"))],8,Jn)])])])):N("",!0),t("div",ti,[t("div",ei,[t("h1",si,o(fe.value),1),e[33]||(e[33]=t("p",{class:"text-xs text-gray-500"},"User Exit & Clearance Summary",-1))]),t("div",ni,[t("div",null,[e[34]||(e[34]=t("span",{class:"text-gray-500"},"Name:",-1)),e[35]||(e[35]=A()),t("span",ii,o(((x=Y.value)==null?void 0:x.name)||"N/A"),1)]),t("div",null,[e[36]||(e[36]=t("span",{class:"text-gray-500"},"Employee ID:",-1)),e[37]||(e[37]=A()),t("span",ai,o(((k=Y.value)==null?void 0:k.employee_id)||"N/A"),1)]),t("div",null,[e[38]||(e[38]=t("span",{class:"text-gray-500"},"Department:",-1)),e[39]||(e[39]=A()),t("span",oi,o(((Wt=(I=Y.value)==null?void 0:I.department)==null?void 0:Wt.name)||"N/A"),1)]),t("div",null,[e[40]||(e[40]=t("span",{class:"text-gray-500"},"Designation:",-1)),e[41]||(e[41]=A()),t("span",li,o(((Tt=(Ot=Y.value)==null?void 0:Ot.designation)==null?void 0:Tt.title)||"N/A"),1)])]),t("div",di,[t("div",null,[e[42]||(e[42]=t("span",{class:"text-gray-500"},"Last Working Date:",-1)),e[43]||(e[43]=A()),t("span",ri,o(g((Pt=Y.value)==null?void 0:Pt.last_working_date)||"N/A"),1)]),t("div",ci,[e[44]||(e[44]=t("span",{class:"text-gray-500"},"Exit Reason:",-1)),e[45]||(e[45]=A()),t("span",pi,o(((Rt=Y.value)==null?void 0:Rt.exit_reason)||"N/A"),1)])]),t("div",mi,[e[48]||(e[48]=t("div",{class:"mb-2 text-sm font-semibold text-gray-700"},"Clearance Items Summary",-1)),M(pt)?(d(),r("div",fi,"Loading clearance...")):M(T)?(d(),r("div",yi,o(M(T)),1)):(d(),r("table",_i,[e[47]||(e[47]=t("thead",null,[t("tr",{class:"bg-gray-100 text-gray-700"},[t("th",{class:"border border-gray-300 px-2 py-1 text-left"},"Item"),t("th",{class:"border border-gray-300 px-2 py-1 text-left w-[120px]"},"Status"),t("th",{class:"border border-gray-300 px-2 py-1 text-left"},"Remarks")])],-1)),t("tbody",null,[(d(!0),r(X,null,tt(Dt.value,(f,xt)=>(d(),r("tr",{key:xt},[t("td",ui,o(f.label||"N/A"),1),t("td",gi,o(f.status||"N/A"),1),t("td",vi,o(f.remarks||"—"),1)]))),128)),Dt.value.length?N("",!0):(d(),r("tr",xi,e[46]||(e[46]=[t("td",{colspan:"3",class:"border border-gray-300 px-2 py-4 text-center text-gray-500"}," No clearance items found. ",-1)])))])]))]),t("div",bi," Printed: "+o(new Date().toLocaleString()),1)])])}}};export{Ii as default};
