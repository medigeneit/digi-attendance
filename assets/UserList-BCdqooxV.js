import{r as _,p as V,q as E,s as Y,o as i,c as r,a as e,t as f,k as I,h as U,d as A,z as B,F as M,x as $,v as L,e as R,b as T,l as g,m as O,n as G,y as K,g as P}from"./index-BPSQoUXf.js";import{L as H}from"./LoaderView-BAk0FkKJ.js";import{u as F}from"./shift-D5N92zPG.js";import{d as N}from"./dayjs.min-Cbbdfn5l.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q}from"./MultiselectDropdown-BLRvUGn6.js";import{u as W}from"./user-DjVq2fdh.js";import"./vue-multiselect.esm-DL8JHBh4.js";const X={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},Z={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},ee={class:"text-lg font-semibold mb-4"},te={class:"mb-4"},se=["value"],oe={class:"mb-4"},ae={class:"mb-4"},le={class:"flex justify-end gap-3 mt-4"},de={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(k,{emit:w}){const j=w,d=k,s=_({shift_id:"",employee_id:d.employee.id,start_date:"",end_date:""}),C=V(()=>{const c=Object.keys(d.shifts)[0];return d.shifts[c]||[]});E(()=>d.employee,c=>{s.value.employee_id=(c==null?void 0:c.id)||0},{immediate:!0,deep:!0}),E(()=>d.isOpen,c=>{var o;c&&(d.hasShift?(s.value.shift_id=d.hasShift.shift_id||"",s.value.start_date=d.hasShift.start_date?N(d.hasShift.start_date).format("YYYY-MM-DD"):"",s.value.end_date=d.hasShift.end_date?N(d.hasShift.end_date).format("YYYY-MM-DD"):"",s.value.employee_id=((o=d.employee)==null?void 0:o.id)||""):(s.value.shift_id="",s.value.start_date="",s.value.end_date=""))},{immediate:!0});const m=()=>{j("close",!1)},b=F(),{message:x}=Y(b),y=async()=>{if(!s.value.shift_id||!s.value.start_date||!s.value.employee_id){alert("All fields are required!");return}try{const c={...s.value},o=await b.shiftAssign(c);console.log("Shift assigned successfully:",o),alert(d.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),m()}catch(c){console.error("Failed to assign shift:",c),alert("Failed to assign shift.")}};return(c,o)=>k.isOpen?(i(),r("div",X,[e("div",Z,[e("h2",ee,f(d.hasShift?"Update Shift for":"Assign Shift to")+" "+f(k.employee.name),1),I(" "+f(U(x))+" ",1),e("div",te,[o[4]||(o[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),A(e("select",{"onUpdate:modelValue":o[0]||(o[0]=l=>s.value.shift_id=l),class:"w-full p-2 border rounded"},[o[3]||(o[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(i(!0),r(M,null,$(C.value,l=>(i(),r("option",{key:l==null?void 0:l.id,value:l==null?void 0:l.id},f(l==null?void 0:l.name),9,se))),128))],512),[[B,s.value.shift_id]])]),e("div",oe,[o[5]||(o[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),A(e("input",{type:"date","onUpdate:modelValue":o[1]||(o[1]=l=>s.value.start_date=l),class:"w-full border rounded p-2"},null,512),[[L,s.value.start_date]])]),e("div",ae,[o[6]||(o[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),A(e("input",{type:"date","onUpdate:modelValue":o[2]||(o[2]=l=>s.value.end_date=l),class:"w-full border rounded p-2"},null,512),[[L,s.value.end_date]])]),e("div",le,[e("button",{onClick:m,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:y,class:"px-4 py-2 bg-green-600 text-white rounded"},f(d.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:m,class:"absolute top-2 right-2 text-red-500 text-xl"},o[7]||(o[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):R("",!0)}},ne=J(de,[["__scopeId","data-v-c3e70801"]]),ie={class:"space-y-2 px-4"},re={class:"flex items-center justify-between gap-2"},ce={class:"flex items-center justify-start gap-2"},fe={key:0,class:"text-center py-4"},pe={key:1,class:"space-y-4"},ue={class:"title-md"},me={class:"overflow-x-auto"},be={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ye={class:"border border-gray-300 px-2"},he={class:"border border-gray-300 px-2"},_e={class:"border border-gray-300 px-2"},ve={class:"border border-gray-300 px-2"},ge={class:"border border-gray-300 px-2"},xe=["onClick"],Se={key:0},ke={class:"border border-gray-300 px-2"},we={class:"border border-gray-300 px-2"},Ce={class:"border border-gray-300 px-2"},Ue={key:0,class:"text-green-500"},Ae={key:1,class:"text-red-500"},Me={class:"border border-gray-300 px-2"},$e={class:"flex gap-2"},Be={__name:"UserList",setup(k){const w=F(),{shifts:j}=Y(w),d=P(),s=W(),C=_([]),m=_("all"),b=_(""),x=_(""),y=_(!1);T(()=>{s.fetchUsers()});const c=()=>{d.go(-1)},o=V(()=>{var p;const n={},a=new Set;s.users.forEach(u=>{var v;const t=((v=u.company)==null?void 0:v.name)||"Unknown Company";n[t]||(n[t]=[]),n[t].push(u),a.add(t)}),C.value=Array.from(a);let h=n;if(m.value!=="all"&&(h={[m.value]:n[m.value]||[]}),(p=b.value)!=null&&p.id){const u={};for(const[t,v]of Object.entries(h)){const S=v.filter(D=>D.id===b.value.id);S.length&&(u[t]=S)}return u}return h}),l=_("");function q(n){l.value=n.id,x.value=n,(n==null?void 0:n.company_id)!==void 0&&(w.fetchShifts(n==null?void 0:n.company_id),y.value=!y.value)}function z(){y.value=!1}return(n,a)=>{const h=G("RouterLink");return i(),r("div",ie,[e("div",re,[e("button",{class:"btn-3",onClick:c},a[2]||(a[2]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),a[4]||(a[4]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),g(h,{to:{name:"UserAdd"},class:"btn-2"},{default:O(()=>a[3]||(a[3]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1})]),e("div",ce,[A(e("select",{"onUpdate:modelValue":a[0]||(a[0]=p=>m.value=p),class:"input-1"},[a[5]||(a[5]=e("option",{value:"all",selected:""},"All Company",-1)),(i(!0),r(M,null,$(C.value,(p,u)=>(i(),r("option",{key:u},f(p),1))),128))],512),[[B,m.value]]),g(Q,{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=p=>b.value=p),options:U(s).users,multiple:!1,class:"w-full",placeholder:"Select Employee"},null,8,["modelValue","options"])]),U(s).isLoading?(i(),r("div",fe,[g(H)])):(i(),r("div",pe,[(i(!0),r(M,null,$(o.value,(p,u)=>(i(),r("div",{key:u},[e("h2",ue,f(u),1),e("div",me,[e("table",be,[a[8]||(a[8]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(i(!0),r(M,null,$(p,(t,v)=>{var S;return i(),r("tr",{key:t.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ye,f(v+1),1),e("td",he,f(t==null?void 0:t.name),1),e("td",_e,f((S=t.designation)==null?void 0:S.title),1),e("td",ve,f(t.role),1),e("td",ge,[e("button",{type:"button",onClick:D=>q(t),class:K(["btn-4 text-sm",t!=null&&t.assign_shift?"bg-yellow-500 hover:bg-yellow-600":"btn-4"])},f(t!=null&&t.assign_shift?"Change Shift":"Assign Shift"),11,xe),l.value===t.id&&y.value?(i(),r("div",Se,[g(ne,{isOpen:y.value,shifts:U(j),hasShift:t==null?void 0:t.assign_shift,employee:{id:x.value.id,name:x.value.name},onClose:z},null,8,["isOpen","shifts","hasShift","employee"])])):R("",!0)]),e("td",ke,f(t.phone),1),e("td",we,f(t.email||"নেই"),1),e("td",Ce,[t.is_active?(i(),r("span",Ue,"Active")):(i(),r("span",Ae,"Inactive"))]),e("td",Me,[e("div",$e,[g(h,{to:{name:"UserShow",params:{id:t.id}},class:"btn-icon"},{default:O(()=>a[6]||(a[6]=[e("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"]),g(h,{to:{name:"UserEdit",params:{id:t.id}},class:"btn-icon"},{default:O(()=>a[7]||(a[7]=[e("i",{class:"far fa-edit"},null,-1)])),_:2},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{Be as default};
