import{O as X}from"./OverlyModal-lUWEFzqj.js";import{c as k,o as u,O as et,a as t,k as S,t as R,w as U,r as x,x as A,q as H,h as F,U as mt,l as Q,j as O,v as Y,P as yt,F as ot,e as nt,Z as ft,A as Z,y as vt,d as L,g as lt,n as y,m as M,b as j}from"./index-BWEUO6Op.js";import{g as K,b as bt}from"./datetime-Du_mcDA9.js";import{u as it}from"./company-B0rErdos.js";import{u as rt}from"./useTodoProjectStore-UtrMKjhn.js";import{u as st}from"./useTodoStore-2yEnSeY_.js";import{_ as gt}from"./CompanyDepartmentSelectInput-CXnFZZt1.js";import{L as tt}from"./LoaderView-B6-YZptl.js";import{u as xt}from"./useTaskStore-CCSXYtVT.js";import{_ as wt}from"./TaskSelectionInput-Ci3NBq3O.js";import{u as ut,f as kt,d as Tt,a as _t}from"./useTodoDateStore-Dud_qgZf.js";import{_ as ht}from"./UserChip-CSUaL9yn.js";import{a as Ct}from"./TodoItemCard-BEanXmRM.js";const St={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md shadow-lg shadow-red-600"},Dt={key:0,class:"mb-4 text-red-500 font-medium"},$t={key:0,class:"mb-4 text-blue-500 font-medium"},jt={class:"flex justify-between items-center gap-4"},Vt=["disabled"],at={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(n,{emit:V}){const s=V;return(l,b)=>(u(),k("form",{onSubmit:b[1]||(b[1]=U(T=>s("submit"),["prevent"])),class:"overflow-hidden"},[et(l.$slots,"default"),t("div",St,[et(l.$slots,"error",{},()=>[n.error?(u(),k("div",Dt,R(n.error),1)):S("",!0)]),n.isSubmitting?(u(),k("div",$t,"Saving changes...")):S("",!0),et(l.$slots,"footer",{},()=>[t("div",jt,[t("button",{type:"button",onClick:b[0]||(b[0]=T=>s("clickCancel")),class:"btn-3"},"Cancel"),t("button",{disabled:n.isSubmitting||n.isLoading,type:"submit",class:"btn-2"},R(n.isSubmitting?"Saving...":"Save"),9,Vt)])])])],32))}},It={class:"relative"},Et=["placeholder"],Rt=["onClick"],pt={__name:"InputWithSuggestions",props:{modelValue:{type:[String,Number],default:null},options:{type:Array,default:()=>[]},label:{type:String,default:"title"},value:{type:String,default:"id"},placeholder:{type:String,default:"Select or type..."}},emits:["update:modelValue","update:inputValue"],setup(n,{emit:V}){const s=n,l=V,b=x(""),T=x(!1),d=x(null),f=x(null),m=x({top:"0px",left:"0px",width:"0px"}),C=A(()=>{if(!b.value)return s.options;const o=b.value.toLowerCase();return s.options.filter(w=>{const g=w[s.label];return g&&String(g).toLowerCase().includes(o)})});function p(){if(d.value){const o=d.value.getBoundingClientRect();m.value={top:`${o.bottom}px`,left:`${o.left}px`,width:`${o.width}px`}}}function D(o){b.value=o[s.label],l("update:modelValue",o[s.value]),l("update:inputValue",o[s.label]),T.value=!1}function v(){T.value=!0,p(),l("update:inputValue",b.value);const o=s.options.find(w=>{var g;return((g=w[s.label])==null?void 0:g.toLowerCase())===b.value.toLowerCase()});o?l("update:modelValue",o[s.value]):l("update:modelValue",null)}function I(){T.value=!0,p()}H(()=>s.modelValue,o=>{if(o){const w=s.options.find(g=>g[s.value]==o);w&&(b.value=w[s.label],l("update:inputValue",w[s.label]))}},{immediate:!0}),H(()=>s.options,()=>{if(s.modelValue){const o=s.options.find(w=>w[s.value]==s.modelValue);o&&(b.value=o[s.label],l("update:inputValue",o[s.label]))}}),H(T,o=>{o&&Z(()=>p())});function c(o){d.value&&d.value.contains(o.target)||f.value&&f.value.contains(o.target)||(T.value=!1)}function r(){T.value&&p()}function e(){T.value&&p()}return F(()=>{document.addEventListener("click",c),window.addEventListener("scroll",r,!0),window.addEventListener("resize",e)}),mt(()=>{document.removeEventListener("click",c),window.removeEventListener("scroll",r,!0),window.removeEventListener("resize",e)}),(o,w)=>(u(),k("div",It,[Q(t("input",{ref_key:"inputRef",ref:d,type:"text","onUpdate:modelValue":w[0]||(w[0]=g=>b.value=g),onInput:v,onFocus:I,class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none",placeholder:n.placeholder},null,40,Et),[[Y,b.value]]),(u(),O(ft,{to:"body"},[T.value&&C.value.length>0?(u(),k("ul",{key:0,ref_key:"dropdownRef",ref:f,class:"fixed z-[9999] bg-white border rounded-md shadow-lg max-h-60 overflow-y-auto mt-1",style:yt(m.value)},[(u(!0),k(ot,null,nt(C.value,g=>(u(),k("li",{key:g[n.value],onClick:E=>D(g),class:"px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 block text-left"},R(g[n.label]),9,Rt))),128))],4)):S("",!0)]))]))}},ct={__name:"TodoTypeInput",props:{todoType:{type:String,default:"task"},todoTypeId:{type:[String,Number],default:null},show:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["update:todoType","update:todoTypeId","update:show"],setup(n,{emit:V}){const s=n,l=V,b=A({get:()=>s.todoTypeId,set:p=>l("update:todoTypeId",p)}),T=A({get:()=>s.show,set:p=>l("update:show",p)}),d=x(null),f=x({});function m(){if(!(d!=null&&d.value))return;const p=d.value.getBoundingClientRect(),D=window.innerHeight,v=300,c=D-p.bottom<v;f.value={position:"fixed",top:c?p.top-v+"px":p.bottom+"px",left:p.left+"px",width:p.width+"px",zIndex:5e3}}F(async()=>{await Z(),window.addEventListener("resize",m),document.addEventListener("scroll",m)});const C=xt();return H(()=>T.value,async p=>{p&&await C.fetchAllMyTasks()}),vt(()=>{window.removeEventListener("resize",m),document.removeEventListener("scroll",m)}),(p,D)=>(u(),k("div",null,[L(wt,{show:T.value,"onUpdate:show":D[0]||(D[0]=v=>T.value=v),taskId:b.value,"onUpdate:taskId":D[1]||(D[1]=v=>b.value=v),readonly:n.readonly},null,8,["show","taskId","readonly"])]))}},Lt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Mt={class:"mb-4"},Ut={class:"mb-4"},Ot=["readonly"],Pt={class:"mb-4"},At={class:"mb-4"},Nt={__name:"TodoAddForm",props:{date:{type:String,default:K(new Date)},userRole:{type:String,default:"employee"},todoType:{type:String,default:"task"},todoTypeId:{type:String,default:null},readonlyValues:{type:Object,default:()=>({date:!1,todo_type_id:!1})}},emits:["update","cancelClick"],setup(n,{emit:V}){const s=n,l=x(),b=x(!1),T=x(),d=st(),f=rt(),m=lt(),C=it(),p=x(null),D=x(""),v=x(null),I=V,c=x({title:"",date:s.date||"",todo_type:"task",todo_type_id:""});async function r(){try{l.value="submitting";const e={...c.value};if(e.todo_type_id||(delete e.todo_type_id,delete e.todo_type),p.value)e.todo_project_id=p.value;else if(D.value){const o=await f.createProject({title:D.value,department_id:v.value});e.todo_project_id=o.id}await d.createTodo(e,{returnWith:s.userRole!=="employee"?"user,department,company":""}),I("update")}finally{l.value=""}}return H(()=>({date:s.date,todo_type:s.todoType,todo_type_id:s.todoTypeId}),e=>{c.value={...c.value,...e}},{immediate:!0}),F(async()=>{var e;await Z(),(e=T.value)==null||e.focus(),m.isAdminMood&&await C.fetchMyCompanies({with:"departments"}),await f.fetchProjects()}),(e,o)=>(u(),k("div",{onClick:o[9]||(o[9]=w=>b.value=!1)},[y(d).loading?(u(),O(tt,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>o[10]||(o[10]=[j(" Loading... ")])),_:1,__:[10]})):S("",!0),L(at,{onSubmit:r,onClickCancel:o[8]||(o[8]=w=>I("cancelClick")),isSubmitting:l.value=="submitting",error:y(d).error,class:"rounded-md relative"},{default:M(()=>{var w,g,E;return[o[16]||(o[16]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),t("div",Lt,[t("div",Mt,[o[11]||(o[11]=t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Title",-1)),Q(t("input",{ref_key:"titleRef",ref:T,"onUpdate:modelValue":o[0]||(o[0]=h=>c.value.title=h),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Y,c.value.title]])]),t("div",Ut,[o[12]||(o[12]=t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Date",-1)),Q(t("input",{readonly:(w=n.readonlyValues)==null?void 0:w.date,"onUpdate:modelValue":o[1]||(o[1]=h=>c.value.date=h),type:"date",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,8,Ot),[[Y,c.value.date]])]),y(m).isAdminMood?(u(),O(gt,{key:0,modelValue:v.value,"onUpdate:modelValue":o[2]||(o[2]=h=>v.value=h),companies:((g=y(C))==null?void 0:g.myCompanies)||[],class:"mb-4"},{label:M(()=>o[13]||(o[13]=[t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},[j(" Project Department "),t("span",{class:"text-gray-500"},"(Optional - for new project)")],-1)])),_:1},8,["modelValue","companies"])):S("",!0),t("div",Pt,[o[14]||(o[14]=t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},[j(" Issue/Website/Project "),t("span",{class:"text-gray-500"},"(Optional)")],-1)),L(pt,{modelValue:p.value,"onUpdate:modelValue":o[3]||(o[3]=h=>p.value=h),"onUpdate:inputValue":o[4]||(o[4]=h=>D.value=h),options:y(f).projects,label:"title",value:"id",placeholder:"Select or type project..."},null,8,["modelValue","options"])]),t("div",At,[o[15]||(o[15]=t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Task (optional)",-1)),L(ct,{show:b.value,"onUpdate:show":o[5]||(o[5]=h=>b.value=h),todoType:c.value.todo_type,"onUpdate:todoType":o[6]||(o[6]=h=>c.value.todo_type=h),todoTypeId:c.value.todo_type_id,"onUpdate:todoTypeId":o[7]||(o[7]=h=>c.value.todo_type_id=h),readonly:(E=n.readonlyValues)==null?void 0:E.todo_type_id},null,8,["show","todoType","todoTypeId","readonly"])])])]}),_:1,__:[16]},8,["isSubmitting","error"])]))}},Bt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},zt={class:"mb-4 text-md"},Ft={class:"font-semibold"},qt={class:"mb-2"},Gt={__name:"TodoDateAddForm",props:{date:{type:[String,Number],default:K(new Date)},todoId:{type:[String,Number],required:!0},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(n,{emit:V}){const s=n,l=x(),b=x(!1),T=x(),d=st(),f=ut(),m=V,C=x({date:s.date||"",todo_id:s.todoId});async function p(){try{l.value="submitting",await f.createTodoDate(C.value),m("update")}finally{l.value=""}}return F(async()=>{var D;await Z(),await d.fetchTodo(s.todoId),(D=T.value)==null||D.focus()}),(D,v)=>(u(),k("div",{onClick:v[2]||(v[2]=I=>b.value=!1)},[y(d).loading?(u(),O(tt,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>v[3]||(v[3]=[j(" Loading... ")])),_:1,__:[3]})):S("",!0),L(at,{onSubmit:p,onClickCancel:v[1]||(v[1]=I=>m("cancelClick")),isSubmitting:l.value=="submitting",error:y(f).error,class:"rounded-md relative"},{default:M(()=>{var I;return[v[6]||(v[6]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Carry Todo To Date")],-1)),t("div",Bt,[t("div",zt,[v[4]||(v[4]=j(" TODO: ")),t("span",Ft,R((I=y(d).todo)==null?void 0:I.title),1)]),t("div",qt,[v[5]||(v[5]=t("span",{class:"font-semibold"}," Date ",-1)),Q(t("input",{"onUpdate:modelValue":v[0]||(v[0]=c=>C.value.date=c),type:"date",multiple:"",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Y,C.value.date]])])])]}),_:1,__:[6]},8,["isSubmitting","error"])]))}},Wt={key:0,class:"mb-4 text-red-500 font-medium"},Ht={key:1,class:"mb-4 text-red-500 font-medium"},Kt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Qt={class:"mb-5"},Yt={class:"relative group"},Zt={class:"mb-5"},Jt={class:"mb-8"},Xt={__name:"TodoEditForm",props:{date:{type:String,default:K(new Date)},todo:{type:Object,default:()=>({})}},emits:["update","cancelClick"],setup(n,{emit:V}){var W;const s=n,l=x(),b=x(!1),T=x(),d=st(),f=rt(),m=lt(),C=it(),p=x(null),D=x(""),v=x(null),I=V,c=x({title:"",todo_type:"task",todo_type_id:"",status:"PENDING"}),r=x({id:null,repeat_type:"daily",start_date:((W=s.todo)==null?void 0:W.date)||s.date||K(new Date),end_date:null,weekly_day:null,monthly_mode:null,monthly_value:null,monthly_week:null,yearly_month:null,yearly_day:null}),e=x(!1),o=x({});async function w(){var _,a,i,$,dt;await d.fetchTodo((_=s.todo)==null?void 0:_.id),c.value.title=(a=d.todo)==null?void 0:a.title,c.value.todo_type_id=(i=d.todo)==null?void 0:i.todoable_id,c.value.status=(($=d.todo)==null?void 0:$.status)||"PENDING",p.value=((dt=d.todo)==null?void 0:dt.todo_project_id)||null}const g=x(null);async function E(){var _,a;try{const{data:i}=await kt(s.todo.id),$=i==null?void 0:i.setting;$?(e.value=!0,g.value=$.id,r.value={repeat_type:$.repeat_type??"daily",start_date:$.start_date??r.value.start_date,end_date:$.end_date??null,weekly_day:$.weekly_day??null,monthly_mode:$.monthly_mode??null,monthly_value:$.monthly_value??null,monthly_week:$.monthly_week??null,yearly_month:$.yearly_month??null,yearly_day:$.yearly_day??null}):r.value.id=null}catch(i){N.value=(a=(_=i==null?void 0:i.response)==null?void 0:_.data)==null?void 0:a.message,console.error("Load setting failed:",(i==null?void 0:i.message)||i)}}async function h(){const _={title:c.value.title,todo_type:c.value.todo_type,todo_type_id:c.value.todo_type_id,status:c.value.status};if(p.value)_.todo_project_id=p.value;else if(D.value){const a=await f.createProject({title:D.value,department_id:v.value});_.todo_project_id=a.id}await d.updateTodo(s.todo.id,_)}async function P(){var _,a;if(!e.value)g.value&&await Tt(s.todo.id,g.value);else{const i=(_=o.value)!=null&&_.buildPayload?o.value.buildPayload():{...r.value};i.start_date||(i.start_date=((a=s.todo)==null?void 0:a.date)||s.date||K(new Date)),await _t(s.todo.id,i)}}const B=_=>{var a,i;return((i=(a=_==null?void 0:_.response)==null?void 0:a.data)==null?void 0:i.message)||(_==null?void 0:_.message)||"Something went wrong"};async function q(){const[_,a]=await Promise.allSettled([h(),P()]),i=_.status==="fulfilled",$=a.status==="fulfilled";$||(N.value=B(a.reason)),i&&$&&I("update")}const z=x(!1),N=x(!1);async function J(){var _;m.isAdminMood&&await C.fetchMyCompanies({with:"departments"}),f.fetchProjects(),await w(),z.value=!0,await E(),z.value=!1,await Z(),(_=T.value)==null||_.focus()}const G=A(()=>d.loading||z.value);return F(()=>{J()}),(_,a)=>(u(),k("div",{class:"relative",onClick:a[7]||(a[7]=i=>b.value=!1)},[G.value?(u(),O(tt,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>a[8]||(a[8]=[j(" Loading... ")])),_:1,__:[8]})):S("",!0),L(at,{onSubmit:q,onClickCancel:a[6]||(a[6]=i=>I("cancelClick")),isSubmitting:l.value=="submitting",isLoading:G.value,id:"todoEditForm"},{error:M(()=>[t("div",null,[y(d).error?(u(),k("div",Wt,R(y(d).error),1)):S("",!0),N.value?(u(),k("div",Ht,R(N.value),1)):S("",!0)])]),default:M(()=>[a[14]||(a[14]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),t("div",Kt,[a[13]||(a[13]=t("div",{class:"text-xs text-red-800 mb-6"},[t("strong",null,"Tips:"),j(" If you change the todo, it will change to all the concurrent dates ")],-1)),t("div",Qt,[a[10]||(a[10]=t("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"}," Title ",-1)),t("div",Yt,[Q(t("input",{ref_key:"titleRef",ref:T,"onUpdate:modelValue":a[0]||(a[0]=i=>c.value.title=i),required:"",placeholder:"Enter todo title",class:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-sky-500/10 focus:border-sky-400 outline-none transition-all duration-200 font-medium text-slate-700"},null,512),[[Y,c.value.title]]),a[9]||(a[9]=t("div",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-sky-500 transition-colors"},[t("i",{class:"fas fa-edit text-sm"})],-1))])]),t("div",Zt,[a[11]||(a[11]=t("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"},[j(" Issue/Website/Project "),t("span",{class:"text-[10px] lowercase font-normal"},"(Optional)")],-1)),L(pt,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=i=>p.value=i),"onUpdate:inputValue":a[2]||(a[2]=i=>D.value=i),options:y(f).projects,value:"id",label:"title",placeholder:"Select or type project..."},null,8,["modelValue","options"])]),t("div",Jt,[a[12]||(a[12]=t("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"},[j(" Task ID "),t("span",{class:"text-[10px] lowercase font-normal"},"(Optional)")],-1)),L(ct,{show:b.value,"onUpdate:show":a[3]||(a[3]=i=>b.value=i),todoType:c.value.todo_type,"onUpdate:todoType":a[4]||(a[4]=i=>c.value.todo_type=i),todoTypeId:c.value.todo_type_id,"onUpdate:todoTypeId":a[5]||(a[5]=i=>c.value.todo_type_id=i)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[14]},8,["isSubmitting","isLoading"])]))}},te={class:"relative"},ee={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},oe={class:"mb-4 flex justify-between items-end"},le={class:"text-base font-semibold"},se={key:0,class:"text-xs text-slate-400 mt-1"},ae={class:"mb-4 flex justify-between items-center group"},de={class:"text-sm font-semibold text-slate-700"},ne={key:0,class:"mt-1 flex items-center gap-2 mb-4"},ie={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},re={class:"mt-6 p-4 rounded-xl border border-slate-200 border-dashed"},ue={class:"flex items-center justify-between mb-4"},pe={class:"flex items-center gap-2 px-3 py-1.5 bg-white rounded-full shadow-sm border border-slate-100"},ce={class:"text-xs font-bold text-slate-700 tracking-wide"},me={key:0},ye={class:"grid grid-cols-2 gap-3"},fe={key:1,class:"py-4 text-center text-emerald-600 bg-emerald-50 rounded-lg border border-emerald-100"},ve={class:"px-4 mb-4"},be={class:"mt-4"},ge={class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},xe={class:"text-sm text-slate-500"},we={key:0,class:"mt-2 max-h-40 overflow-y-auto border rounded p-2 bg-white"},ke={key:0,class:"text-xs text-slate-400 py-2"},Te=["onClick"],_e={class:"text-xs text-slate-400"},he={key:0,class:"text-xs text-emerald-600 font-bold"},Ce=["onClick"],Se={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},De={key:0,class:"ml-auto flex items-center gap-2"},$e={__name:"TodoShow",props:{todoDate:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update","clickAddTodoDate"],setup(n,{emit:V}){const s=n,l=ut(),b=lt(),T=V;async function d(){var e,o,w,g;console.log({todo_date:"dd"}),await l.fetchTodoDate((e=s.todoDate)==null?void 0:e.id);const r=((o=l.todo_date)==null?void 0:o.todo_id)||((g=(w=l.todo_date)==null?void 0:w.todo)==null?void 0:g.id);if(r)try{await l.fetchTodoDates({"todo-id":r})}catch{}}const f=x(!1),m=A(()=>{var e,o,w,g,E;const r=(e=l.todo_date)==null?void 0:e.todo;return((o=r==null?void 0:r.project)==null?void 0:o.name)||((w=r==null?void 0:r.project)==null?void 0:w.title)||((g=r==null?void 0:r.project)==null?void 0:g.display_name)||((E=r==null?void 0:r.project)==null?void 0:E.project_name)||""}),C=A(()=>{var o,w,g,E;const r=((o=l.todo_date)==null?void 0:o.todo_id)||((g=(w=l.todo_date)==null?void 0:w.todo)==null?void 0:g.id);return r?[...((E=l.todo_dates)==null?void 0:E.filter(h=>h.todo_id==r))||[]].sort((h,P)=>{const B=h!=null&&h.date?new Date(h.date).getTime():0;return(P!=null&&P.date?new Date(P.date).getTime():0)-B}):[]});async function p(r){r&&await l.fetchTodoDate(r)}const D=A(()=>{var r,e;return(r=l.todo_date)!=null&&r.date?new Date((e=l.todo_date)==null?void 0:e.date):null}),v=A(()=>{var r,e,o;return((e=(r=l.todo_date)==null?void 0:r.user)==null?void 0:e.id)===((o=b.user)==null?void 0:o.id)});async function I(r){var e;confirm(`Are your sure want to delete todo
'${(e=l.todo_date)==null?void 0:e.title}'`)&&(await l.deleteTodoDate(r.id),T("update"))}async function c(r,e){var o;confirm(`Are your sure want to compete todo
'${(o=l.todo_date)==null?void 0:o.title}'`)&&(await l.updateStatus(r.id,e),T("update"))}return F(async()=>{await d()}),(r,e)=>{var o,w,g,E,h,P,B,q,z,N,J,G,W,_;return u(),k("div",te,[y(l).loading?(u(),O(tt,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:M(()=>e[9]||(e[9]=[j(" Loading... ")])),_:1,__:[9]})):S("",!0),t("div",null,[e[22]||(e[22]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),t("div",ee,[t("div",oe,[t("div",null,[e[10]||(e[10]=t("div",{class:"text-xs text-gray-500"},"Todo",-1)),t("div",le,R((o=y(l).todo_date)==null?void 0:o.title),1),m.value?(u(),k("div",se,R(m.value),1)):S("",!0)]),t("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white bg-none",onClick:e[0]||(e[0]=U(a=>{var i;return T("clickEdit",(i=y(l).todo_date)==null?void 0:i.todo)},["prevent","stop"]))},e[11]||(e[11]=[t("i",{class:"fas fa-pen"},null,-1),j(" Edit Todo ")]))]),e[21]||(e[21]=t("hr",{class:"mb-4"},null,-1)),t("div",ae,[t("div",null,[e[12]||(e[12]=t("div",{class:"font-semibold text-[10px] text-slate-400 uppercase tracking-wider mb-0.5"}," Date ",-1)),t("div",de,R(y(bt)(D.value,{weekDay:"long"})),1)]),v.value&&!y(l).loading?(u(),k("button",{key:0,class:"btn-2 bg-emerald-500 text-white hover:bg-emerald-700 hover:text-white bg-none",onClick:e[1]||(e[1]=U(a=>{var i,$;return T("clickAddTodoDate",(i=y(l).todo_date)==null?void 0:i.todo_id,($=y(l).todo_date)==null?void 0:$.date)},["prevent","stop"]))},e[13]||(e[13]=[t("i",{class:"fas fa-calendar-plus mr-1"},null,-1),j(" Add to another date ")]))):S("",!0)]),(w=n.todoDate)!=null&&w.user?(u(),k("div",ne,[L(ht,{user:n.todoDate.user,"avatar-size":"xsmall"},null,8,["user"]),t("div",ie,R((E=(g=n.todoDate.user)==null?void 0:g.department)==null?void 0:E.name),1)])):S("",!0),t("div",re,[t("div",ue,[e[14]||(e[14]=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"}," Current Status ",-1)),t("div",pe,[(h=y(l))!=null&&h.todo_date?(u(),O(Ct,{key:0,todoDate:(P=y(l))==null?void 0:P.todo_date},null,8,["todoDate"])):S("",!0),t("span",ce,R((B=y(l).todo_date)==null?void 0:B.status),1)])]),v.value&&!y(l).loading&&((q=y(l).todo_date)==null?void 0:q.status)!=="COMPLETED"?(u(),k("div",me,[e[19]||(e[19]=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 text-center"}," Quick Transitions ",-1)),t("div",ye,[((z=y(l).todo_date)==null?void 0:z.status)!=="WORKING"?(u(),k("button",{key:0,class:"btn-2 py-2.5 from-amber-600 to-amber-400 text-white hover:scale-[1.02] active:scale-[0.98] shadow-md transition-all duration-200",onClick:e[2]||(e[2]=U(()=>c(y(l).todo_date,"WORKING"),["prevent","stop"]))},e[15]||(e[15]=[t("i",{class:"fas fa-sync-alt mr-1"},null,-1),j(" Working ")]))):S("",!0),((N=y(l).todo_date)==null?void 0:N.status)!=="COMPLETED"&&((J=y(l).todo_date)==null?void 0:J.status)!=="BACK_LOG"?(u(),k("button",{key:1,class:"btn-2 py-2.5 from-emerald-600 to-emerald-400 text-white hover:scale-[1.02] active:scale-[0.98] shadow-md transition-all duration-200",onClick:e[3]||(e[3]=U(()=>c(y(l).todo_date,"COMPLETED"),["prevent","stop"]))},e[16]||(e[16]=[t("i",{class:"fas fa-check-double mr-1"},null,-1),j(" Complete ")]))):S("",!0),((G=y(l).todo_date)==null?void 0:G.status)!=="DEPENDANT"?(u(),k("button",{key:2,class:"btn-4 py-2 bg-white border border-slate-200 text-slate-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 hover:scale-[1.02] active:scale-[0.98] shadow-sm transition-all duration-200",onClick:e[4]||(e[4]=U(()=>c(y(l).todo_date,"DEPENDANT"),["prevent","stop"]))},e[17]||(e[17]=[t("i",{class:"fas fa-pause-circle mr-1"},null,-1),j(" Dependant / Pause ")]))):S("",!0),((W=y(l).todo_date)==null?void 0:W.status)!=="BACK_LOG"?(u(),k("button",{key:3,class:"btn-4 py-2 bg-white border border-slate-200 text-slate-600 hover:bg-purple-50 hover:text-purple-600 hover:border-purple-200 hover:scale-[1.02] active:scale-[0.98] shadow-sm transition-all duration-200",onClick:e[5]||(e[5]=U(()=>c(y(l).todo_date,"BACK_LOG"),["prevent","stop"]))},e[18]||(e[18]=[t("i",{class:"fas fa-history mr-1"},null,-1),j(" Backlog ")]))):S("",!0)])])):((_=y(l).todo_date)==null?void 0:_.status)==="COMPLETED"?(u(),k("div",fe,e[20]||(e[20]=[t("i",{class:"fas fa-check-circle text-2xl mb-1"},null,-1),t("div",{class:"text-xs font-bold uppercase tracking-wider"},"This Todo is Completed",-1)]))):S("",!0)])]),e[23]||(e[23]=t("hr",{class:"mx-4"},null,-1)),t("div",ve,[t("div",be,[t("button",{class:"w-full text-left flex items-center justify-between px-2 py-2 bg-white border rounded-md",onClick:e[6]||(e[6]=U(a=>f.value=!f.value,["prevent"]))},[t("div",ge," Todo history ("+R(C.value.length)+") ",1),t("div",xe,R(f.value?"▾":"▸"),1)]),f.value?(u(),k("div",we,[C.value.length===0?(u(),k("div",ke," No history ")):S("",!0),(u(!0),k(ot,null,nt(C.value,a=>{var i;return u(),k("div",{key:a.id,class:"flex items-center justify-between py-2 px-2 hover:bg-slate-50 border-b last:border-b-0"},[t("div",null,[t("a",{href:"#",onClick:U($=>p(a.id),["prevent"]),class:"text-sm font-semibold text-sky-600"},R(a.date),9,Te),t("div",_e,R(a.status),1)]),t("div",null,[a.id===((i=y(l).todo_date)==null?void 0:i.id)?(u(),k("span",he,"Current")):(u(),k("button",{key:1,class:"btn-2 py-1 px-2 text-xs",onClick:U($=>p(a.id),["prevent"])}," Show ",8,Ce))])])}),128))])):S("",!0)])])]),t("div",Se,[t("button",{type:"button",onClick:e[7]||(e[7]=a=>T("cancelClick")),class:"btn-3"},"Cancel"),v.value&&!y(l).loading?(u(),k("div",De,[t("button",{class:"btn-2-red",onClick:e[8]||(e[8]=U(()=>I(y(l).todo_date),["prevent","stop"]))},e[24]||(e[24]=[t("i",{class:"fas fa-trash-alt"},null,-1),j(" Delete ")]))])):S("",!0)])])}}},ze={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","todoUpdate","todoDateUpdate","clickEdit","clickDelete","clickChangeStatus","clickAddTodoDate"],setup(n,{emit:V}){const s=V;function l(){s("todoUpdate")}function b(){s("todoDateUpdate")}return(T,d)=>(u(),k(ot,null,[n.todoModal.action=="add"?(u(),O(X,{key:0},{default:M(()=>{var f,m,C,p;return[L(Nt,{onCancelClick:d[0]||(d[0]=D=>s("cancelClick")),onUpdate:l,date:(f=n.todoModal)==null?void 0:f.date,todoType:(m=n.todoModal)==null?void 0:m.todoType,todoTypeId:(C=n.todoModal)==null?void 0:C.todoTypeId,readonlyValues:((p=n.todoModal)==null?void 0:p.formReadonlyValues)||{},userRole:n.userRole},null,8,["date","todoType","todoTypeId","readonlyValues","userRole"])]}),_:1})):S("",!0),n.todoModal.action=="addDate"?(u(),O(X,{key:1},{default:M(()=>{var f,m,C;return[L(Gt,{onCancelClick:d[1]||(d[1]=p=>s("cancelClick")),onUpdate:b,date:(f=n.todoModal)==null?void 0:f.date,todoId:(m=n.todoModal)==null?void 0:m.todo_id,userRole:n.userRole,readonlyValues:((C=n.todoModal)==null?void 0:C.formReadonlyValues)||{}},null,8,["date","todoId","userRole","readonlyValues"])]}),_:1})):S("",!0),n.todoModal.action=="edit"?(u(),O(X,{key:2},{default:M(()=>{var f,m;return[L(Xt,{onCancelClick:d[2]||(d[2]=C=>s("cancelClick")),onUpdate:l,todo:(f=n.todoModal)==null?void 0:f.todo,userRole:n.userRole,readonlyValues:((m=n.todoModal)==null?void 0:m.formReadonlyValues)||{}},null,8,["todo","userRole","readonlyValues"])]}),_:1})):S("",!0),n.todoModal.action=="show"?(u(),O(X,{key:3},{default:M(()=>{var f;return[L($e,{onCancelClick:d[3]||(d[3]=m=>s("cancelClick")),onUpdate:b,onClickEdit:d[4]||(d[4]=m=>s("clickEdit",m)),onClickAddTodoDate:d[5]||(d[5]=(...m)=>s("clickAddTodoDate",...m)),onClickDelete:d[6]||(d[6]=m=>s("clickDelete",m)),onClickChangeStatus:d[7]||(d[7]=(m,C)=>s("clickChangeStatus",m,C)),todoDate:(f=n.todoModal)==null?void 0:f.todo,userRole:n.userRole},null,8,["todoDate","userRole"])]}),_:1})):S("",!0)],64))}};export{ze as _};
