import{z as T,i as C,r as g,s as N,p as S,b as R,q as D,c as m,a as s,j as B,w as j,d as c,A as I,F as q,x as P,h as i,v as w,l as f,m as h,f as z,g as A,n as $,o as r,t as G,k as H}from"./index-DgyHG0oN.js";import{L as J}from"./LoaderView-C74jZuwf.js";import{_ as K,s as k}from"./vue-multiselect.esm-B0VWYStL.js";import{u as O}from"./company-FgftBJue.js";import{u as Q}from"./department-LQIPq9-3.js";import{u as W}from"./notice-BF5w3FRQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"my-container space-y-2"},Y={class:"card-bg md:p-8 p-4 mx-4"},Z={class:"grid gap-4"},ee={class:"border p-4 rounded-md bg-gray-100"},te={class:"grid md:grid-cols-3 gap-4"},se=["value"],le={class:"col-span-3 flex justify-between gap-8"},oe={class:"w-full"},ae={class:"w-full"},de={class:"col-span-full"},ie={class:"flex justify-center gap-4"},ve={__name:"NoticeEdit",setup(re){const l=T({title:"",description:"",published_at:"",expired_at:"",company_id:"",department_id:"",file:""}),x=W(),b=O(),n=Q(),v=C(),y=z(),_=A(),u=g(!1);N(b);const{employees:E}=N(n),d=g([]),L=S(()=>d.value.map(o=>o.id)),p=g([]),F=S(()=>p.value.map(o=>o.id));R(async()=>{u.value=!0,await b.fetchCompanies(),await U(),u.value=!1}),D(()=>l.company_id,async o=>{o&&(await n.fetchDepartments(o),u.value=!1)});const V=o=>{if(!o)return;const e=o.split(" ")[0];if(!e.includes("-")){formattedDate.value="Invalid Date Format";return}return e},U=async()=>{var o,e;try{const a=y.params.id,t=await x.fetchNotice(a);l.title=t.title,l.file=t.file,l.published_at=V(t.published_at),l.expired_at=V(t.expired_at),l.description=t.description,l.company_id=t.company_id,l.department_id=t.department_id,d.value=t.departments,p.value=t.employees}catch(a){const t=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to load notice data";v.error(t),_.push({name:"NoticeList"})}},M=async()=>{var o,e;try{const a={...l,department_ids:L.value,employee_ids:F.value};console.log({dataToSend:a}),await x.updateNotice(y.params.id,a),v.success("Notice updated successfully"),_.push({name:"NoticeShow",params:{id:y.params.id}})}catch(a){const t=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to update notice";v.error(t)}};return D(d,o=>{const e=o.map(a=>a.id);n.fetchDepartmentEmployee(e)}),(o,e)=>{const a=$("RouterLink");return r(),m("div",X,[s("div",Y,[e[20]||(e[20]=s("h2",{class:"title-lg text-center"},"Edit Notice",-1)),u.value?(r(),B(J,{key:0,class:"bg-gray-100 border shadow-none"})):(r(),m("form",{key:1,onSubmit:j(M,["prevent"]),class:"space-y-4"},[s("div",Z,[s("div",ee,[e[16]||(e[16]=s("p",{class:"title-md"},"Notice Info",-1)),e[17]||(e[17]=s("hr",{class:"my-2"},null,-1)),s("div",te,[s("div",null,[e[8]||(e[8]=s("label",null,"Company",-1)),c(s("select",{id:"company_id","onUpdate:modelValue":e[0]||(e[0]=t=>l.company_id=t),class:"w-full border rounded px-3 py-2",required:""},[e[7]||(e[7]=s("option",{value:"",disabled:""},"Select a company",-1)),(r(!0),m(q,null,P(i(b).companies,t=>(r(),m("option",{key:t==null?void 0:t.id,value:t==null?void 0:t.id},G(t==null?void 0:t.name),9,se))),128))],512),[[I,l.company_id]])]),s("div",null,[e[9]||(e[9]=s("label",null,"Publish Date",-1)),c(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.published_at=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[w,l.published_at]])]),s("div",null,[e[10]||(e[10]=s("label",null,"Expire Date",-1)),c(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.expired_at=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[w,l.expired_at]])]),s("div",le,[s("div",oe,[e[11]||(e[11]=s("label",null,"Departments",-1)),f(i(k),{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value=t),options:i(n).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",class:"w-full p-2 border rounded"},null,8,["modelValue","options"])]),s("div",ae,[e[12]||(e[12]=s("label",null,"Employees",-1)),f(i(k),{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t),options:i(E),multiple:!0,searchable:!0,placeholder:"Select Employee","track-by":"id",label:"name",class:"w-full p-2 border rounded"},null,8,["modelValue","options"])])]),s("div",null,[e[13]||(e[13]=s("label",null,"Title*",-1)),c(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.title=t),type:"text",class:"w-full p-2 border rounded"},null,512),[[w,l.title]])]),e[15]||(e[15]=s("div",null,[s("label",null,"File"),s("input",{type:"file",class:"w-full p-2 border rounded"})],-1)),s("div",de,[e[14]||(e[14]=s("label",null,"Description",-1)),f(K,{modelValue:l.description,"onUpdate:modelValue":e[6]||(e[6]=t=>l.description=t),cols:"30",rows:"10",class:"w-full px-4 py-2"},null,8,["modelValue"])])])])]),s("div",ie,[f(a,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:h(()=>e[18]||(e[18]=[H(" Cancel ")])),_:1}),e[19]||(e[19]=s("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32))])])}}};export{ve as default};
