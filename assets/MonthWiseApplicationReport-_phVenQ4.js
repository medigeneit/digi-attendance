import{b as oe,u as ne,r as x,A as E,m as N,e as ie,c as i,o,a as l,f as de,g as d,j as b,t as n,h,T as g,p as pe,v as G,x as _,F as m,y as re}from"./index-B3vTuhh_.js";import{u as ue}from"./leave-application-CZeD0hYG.js";import{_ as ce}from"./EmployeeFilter-DNJtliYl.js";import{L as _e}from"./LoaderView-CA7b1cxU.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-CcalASdn.js";import"./department-C3_2GqOK.js";import"./EmployeeDropdownInput-BE2hFF9T.js";import"./SelectDropdown-CIFE1XAK.js";import"./UserChip-kfrL0C90.js";const me={class:"px-3 space-y-4"},xe={class:"flex flex-wrap items-center gap-2"},he={class:"min-w-[200px]"},ye={class:"text-[11px] text-slate-500 -mt-0.5"},fe={class:"hidden md:flex items-center gap-2 rounded-lg border bg-white p-1"},be={class:"cols-chk"},ge={class:"cols-chk"},ke={class:"cols-chk"},we={class:"cols-chk"},Se={class:"cols-chk"},Le={class:"flex flex-wrap items-end gap-3 rounded-lg border bg-white p-2"},Ae={class:"flex items-center gap-2 ml-auto"},Me={class:"relative"},Te={class:"flex items-center gap-1 text-[11px] text-slate-600"},qe={class:"flex items-center gap-1 text-[11px] text-slate-600"},Oe={key:1,class:"p-2 rounded bg-red-50 text-red-700 text-[12px] border border-red-200"},Re={class:"w-full text-[12px] print:text-[11px] leading-tight"},Ce={key:0,span:"3",style:{width:"96px"}},Ue={key:1,span:"4",style:{width:"96px"}},Ve={key:2,span:"2",style:{width:"102px"}},Ee={key:3,span:"2",style:{width:"96px"}},Ne={key:4,span:"1",style:{width:"96px"}},$e={class:"sticky top-0 z-20 bg-white/95 backdrop-blur"},je={class:"*:px-2.5 *:py-1.5 *:text-center *:border-b *:border-slate-200 text-slate-700"},ze=["colspan"],Pe=["colspan"],Be=["colspan"],Ie=["colspan"],We=["colspan"],De={class:"*:px-2.5 *:py-1 *:text-center *:border-b *:border-slate-200"},Fe={key:4,class:"th-col th-manual",title:"Manual Adjustments"},He={class:"divide-y divide-slate-100"},Je={class:"px-2.5 text-left sticky left-0 z-20 bg-white"},Ze={class:"px-2.5 sticky left-[34px] z-20 bg-white"},Ke={class:"flex items-center gap-2"},Ye={class:"font-medium text-slate-800 truncate max-w-[180px]"},Ge={key:0,class:"text-[10px] text-slate-400"},Qe={key:0,class:"text-[10px] text-slate-500 -mt-0.5 truncate max-w-[200px]"},Xe={class:"text-center whitespace-nowrap"},et=["title"],tt={class:"text-center whitespace-nowrap"},lt=["title"],st={class:"text-center"},at={class:"text-center"},ot={class:"text-center"},nt={class:"text-center"},it={class:"text-center"},dt={class:"text-center font-medium"},pt={class:"text-center"},rt={class:"text-center"},ut={class:"text-center"},ct={class:"text-center"},_t={key:4,class:"text-center"},vt={class:"bg-gradient-to-r from-slate-100 to-slate-50 *:px-2.5 *:py-1.5 font-semibold border-t sticky bottom-0 z-10"},mt={class:"text-slate-700"},xt={class:"text-center"},ht={class:"text-center"},yt={class:"text-center"},ft={class:"text-center"},bt={class:"text-center"},gt={class:"text-center"},kt={class:"text-center"},wt={class:"text-center"},St={class:"text-center"},Lt={class:"text-center"},At={class:"text-center"},Mt={class:"text-center"},Tt={key:4,class:"text-center"},qt={key:3,class:"text-center text-slate-500 py-8"},Q="monthly_application_cols_v2",Ot={__name:"MonthWiseApplicationReport",setup(Rt){const y=oe(),$=ne(),X=ue(),S=x(!1),T=x(null),j=x([]),R=x(""),f=x(y.query.date||new Date().toISOString().slice(0,7)),p=x({company_id:y.query.company_id||"",department_id:y.query.department_id||"all",line_type:y.query.line_type||"all",employee_id:y.query.employee_id||"all",line_type:y.query.line_type||"all"}),C=x(""),q=x(!0),U=x(!1),a=x({ot:!0,leave:!0,ex:!1,sl:!0,manual:!0});try{const s=JSON.parse(localStorage.getItem(Q)||"{}");Object.assign(a.value,s)}catch{}E(a,s=>localStorage.setItem(Q,JSON.stringify(s)),{deep:!0});const r=s=>Number.isFinite(+s)?+s:0,z=s=>{const e=Number(s)||0,t=Math.floor(e),c=Math.round((e-t)*60);return`${t}h ${String(c).padStart(2,"0")}m`},O=s=>{const e=Number(s)||0,t=Math.floor(e),c=Math.round((e-t)*60);return`${t}:${String(c).padStart(2,"0")}`},ee=s=>!s||typeof s!="object"?{CL:0,ML:0,SL:0,WPL:0}:{CL:r(s.CL),ML:r(s.ML),SL:r(s.SL),WPL:r(s.WPL)},te=(s={})=>Object.values(s).some(e=>r(e)>0),le=N(()=>(j.value||[]).map(s=>{var t,c,M,k,u,w,P,B,I,W,D,F,H,J,Z,K,Y;const e=ee((t=s==null?void 0:s.leave)==null?void 0:t.by_code);return{...s,_leaveBy:e,_cl:r(e.CL),_ml:r(e.ML),_sl:r(e.SL),_wpl:r(e.WPL),_leaveTotal:r((c=s==null?void 0:s.leave)==null?void 0:c.total_days),_otReq:r((M=s==null?void 0:s.overtime)==null?void 0:M.requested_hours),_otAppr:r((k=s==null?void 0:s.overtime)==null?void 0:k.approved_hours),_otApps:r((u=s==null?void 0:s.overtime)==null?void 0:u.count),_exOff:r((P=(w=s==null?void 0:s.exchanges)==null?void 0:w.offday)==null?void 0:P.total),_exShift:r((I=(B=s==null?void 0:s.exchanges)==null?void 0:B.shift)==null?void 0:I.total),_slTotal:r((D=(W=s==null?void 0:s.short_leave)==null?void 0:W.totals)==null?void 0:D.count),_slMinutesApproved:r((H=(F=s==null?void 0:s.short_leave)==null?void 0:F.totals)==null?void 0:H.approved_minutes),_slMinutesPending:r((Z=(J=s==null?void 0:s.short_leave)==null?void 0:J.totals)==null?void 0:Z.pending_minutes),_slMinutes:r((Y=(K=s==null?void 0:s.short_leave)==null?void 0:K.totals)==null?void 0:Y.approved_minutes),_manual:r(s==null?void 0:s.manual_attendance)}})),L=N(()=>{const s=(C.value||"").toLowerCase().trim();let e=le.value;return s&&(e=e.filter(t=>String(t.user_name||"").toLowerCase().includes(s)||String(t.employee_id||"").toLowerCase().includes(s)||String(t.designation||"").toLowerCase().includes(s))),U.value&&(e=e.filter(t=>{const c={_cl:t._cl,_ml:t._ml,_sl:t._sl,_leaveTotal:t._leaveTotal,_otReq:t._otReq,_otAppr:t._otAppr,_otApps:t._otApps,_exOff:t._exOff,_exShift:t._exShift,_slTotal:t._slTotal,_slMinutes:t._slMinutes,_manual:t._manual};return!te(c)})),e}),v=N(()=>{const s={cl:0,ml:0,sl:0,wpl:0,leaveTotal:0,otReq:0,otAppr:0,otApps:0,exOff:0,exShift:0,slTotal:0,slMinutes:0,manual:0};for(const e of L.value)s.cl+=e._cl,s.ml+=e._ml,s.sl+=e._sl,s.wpl+=e._wpl,s.leaveTotal+=e._leaveTotal,s.otReq+=e._otReq,s.otAppr+=e._otAppr,s.otApps+=e._otApps,s.exOff+=e._exOff,s.exShift+=e._exShift,s.slTotal+=e._slTotal,s.slMinutes+=e._slMinutes,s.manual+=e._manual;return s}),A=s=>s==="ot"?a.value.ot?3:0:s==="leave"?a.value.leave?5:0:s==="ex"?a.value.ex?2:0:s==="sl"?a.value.sl?2:0:s==="manual"&&a.value.manual?1:0,V=async()=>{var s,e;S.value=!0,T.value=null;try{const t=await X.getMonthlyApplicationSummary({month:f.value,companyId:p.value.company_id||null,departmentId:!p.value.department_id||p.value.department_id==="all"?null:p.value.department_id,employee_id:p.value.employee_id,line_type:p.value.line_type,includeEmpty:!0}),c=Array.isArray(t==null?void 0:t.results)?t.results:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t)?t:[];j.value=c,R.value=(t==null?void 0:t.month)||f.value}catch(t){console.error(t),T.value=((e=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Failed to load monthly application summary."}finally{S.value=!1}};ie(V),E(f,s=>{$.replace({query:{...y.query,date:s}}),V()}),E(()=>[p.value.company_id,p.value.department_id,p.value.employee_id,p.value.line_type],()=>{$.replace({query:{...y.query,company_id:p.value.company_id||"",department_id:p.value.department_id||"all",line_type:p.value.line_type||"all",employee_id:p.value.employee_id||"all"}}),V()});const se=()=>{const s=["#","Employee",...a.value.ot?["OT Req(h)","OT Appr(h)","OT Apps"]:[],...a.value.leave?["CL","ML","SL","Leave Total"]:[],...a.value.ex?["Offday Exch","Shift Exch"]:[],...a.value.sl?["SL Total","SL Minutes (Approved)"]:[],...a.value.manual?["Manual"]:[]],e=L.value.map((u,w)=>[w+1,`${u.user_name}${u.employee_id?` (#${u.employee_id})`:""}`,...a.value.ot?[u._otReq,u._otAppr,u._otApps]:[],...a.value.leave?[u._cl,u._ml,u._sl,u._leaveTotal]:[],...a.value.ex?[u._exOff,u._exShift]:[],...a.value.sl?[u._slTotal,u._slMinutes]:[],...a.value.manual?[u._manual]:[]]),t=[s,...e].map(u=>u.map(w=>`"${String(w).replace(/"/g,'""')}"`).join(",")).join(`
`),c=new Blob([t],{type:"text/csv;charset=utf-8;"}),M=URL.createObjectURL(c),k=document.createElement("a");k.href=M,k.download=`monthly-application-${R.value||f.value}.csv`,k.click(),URL.revokeObjectURL(M)},ae=()=>window.print();return(s,e)=>(o(),i("div",me,[l("div",xe,[l("div",he,[e[14]||(e[14]=l("h1",{class:"text-base font-semibold text-slate-800 leading-tight"},"Monthly Application Summary",-1)),l("p",ye,[e[13]||(e[13]=b("Month: ")),l("b",null,n(R.value||f.value),1)])]),e[21]||(e[21]=l("div",{class:"flex-1"},null,-1)),l("div",fe,[e[20]||(e[20]=l("span",{class:"px-2 py-0.5 text-[11px] text-slate-500"},"Cols:",-1)),l("label",be,[h(l("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=t=>a.value.ot=t)},null,512),[[g,a.value.ot]]),e[15]||(e[15]=b(" OT"))]),l("label",ge,[h(l("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>a.value.leave=t)},null,512),[[g,a.value.leave]]),e[16]||(e[16]=b(" Leave"))]),l("label",ke,[h(l("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=t=>a.value.ex=t)},null,512),[[g,a.value.ex]]),e[17]||(e[17]=b(" Exch"))]),l("label",we,[h(l("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=t=>a.value.sl=t)},null,512),[[g,a.value.sl]]),e[18]||(e[18]=b(" Short"))]),l("label",Se,[h(l("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>a.value.manual=t)},null,512),[[g,a.value.manual]]),e[19]||(e[19]=b(" Manual"))])]),l("button",{class:"btn-secondary",onClick:se},"Export CSV"),l("button",{class:"btn-secondary",onClick:ae},"Print")]),l("div",Le,[pe(ce,{company_id:p.value.company_id,"onUpdate:company_id":e[5]||(e[5]=t=>p.value.company_id=t),department_id:p.value.department_id,"onUpdate:department_id":e[6]||(e[6]=t=>p.value.department_id=t),employee_id:p.value.employee_id,"onUpdate:employee_id":e[7]||(e[7]=t=>p.value.employee_id=t),line_type:p.value.line_type,"onUpdate:line_type":e[8]||(e[8]=t=>p.value.line_type=t),"with-type":!0,"initial-value":s.$route.query},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),l("div",null,[e[22]||(e[22]=l("label",{class:"block text-[11px] text-gray-500 mb-0.5"},"Month",-1)),h(l("input",{type:"month","onUpdate:modelValue":e[9]||(e[9]=t=>f.value=t),class:"input-1 py-1 h-8"},null,512),[[G,f.value]])]),l("div",Ae,[l("div",Me,[h(l("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>C.value=t),type:"search",placeholder:"Search employee / ID / designation",class:"input-1 w-64 pl-8 h-8"},null,512),[[G,C.value]]),e[23]||(e[23]=l("span",{class:"absolute left-2 top-1.5 text-slate-400 select-none"},"🔎",-1))]),l("label",Te,[h(l("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=t=>q.value=t)},null,512),[[g,q.value]]),e[24]||(e[24]=b(" Compact "))]),l("label",qe,[h(l("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=t=>U.value=t)},null,512),[[g,U.value]]),e[25]||(e[25]=b(" Zero-only "))])])]),S.value?(o(),de(_e,{key:0})):d("",!0),T.value?(o(),i("div",Oe,n(T.value),1)):d("",!0),S.value?d("",!0):(o(),i("div",{key:2,class:_(["table-wrap group bg-white border rounded-xl shadow-sm overflow-auto print:overflow-visible",q.value?"max-h-[74vh]":"max-h-[80vh]"])},[l("table",Re,[l("colgroup",null,[e[26]||(e[26]=l("col",{style:{width:"34px"}},null,-1)),e[27]||(e[27]=l("col",{style:{width:"220px"}},null,-1)),a.value.ot?(o(),i("col",Ce)):d("",!0),a.value.leave?(o(),i("col",Ue)):d("",!0),a.value.ex?(o(),i("col",Ve)):d("",!0),a.value.sl?(o(),i("col",Ee)):d("",!0),a.value.manual?(o(),i("col",Ne)):d("",!0)]),l("thead",$e,[l("tr",je,[e[28]||(e[28]=l("th",{rowspan:"2",class:"text-left sticky left-0 z-30 bg-white/95"},"#",-1)),e[29]||(e[29]=l("th",{rowspan:"2",class:"text-left sticky left-[34px] z-30 bg-white/95"},"Employee",-1)),a.value.ot?(o(),i("th",{key:0,colspan:A("ot"),class:"th-group th-ot"},"Overtime",8,ze)):d("",!0),a.value.leave?(o(),i("th",{key:1,colspan:A("leave"),class:"th-group th-leave"},"Leave Day",8,Pe)):d("",!0),a.value.ex?(o(),i("th",{key:2,colspan:A("ex"),class:"th-group th-ex"},"Shift Exchange",8,Be)):d("",!0),a.value.sl?(o(),i("th",{key:3,colspan:A("sl"),class:"th-group th-sl"},"Short Leave",8,Ie)):d("",!0),a.value.manual?(o(),i("th",{key:4,colspan:A("manual"),class:"th-group th-manual"},"Manual",8,We)):d("",!0)]),l("tr",De,[a.value.ot?(o(),i(m,{key:0},[e[30]||(e[30]=l("th",{class:"th-col th-ot",title:"Requested Hours"},"Req",-1)),e[31]||(e[31]=l("th",{class:"th-col th-ot",title:"Approved Hours"},"Appr",-1)),e[32]||(e[32]=l("th",{class:"th-col th-ot",title:"Applications Count"},"Apps",-1))],64)):d("",!0),a.value.leave?(o(),i(m,{key:1},[e[33]||(e[33]=l("th",{class:"th-col th-leave",title:"Casual Leave"},"CL",-1)),e[34]||(e[34]=l("th",{class:"th-col th-leave",title:"Medical Leave"},"ML",-1)),e[35]||(e[35]=l("th",{class:"th-col th-leave",title:"Sick Leave"},"SL",-1)),e[36]||(e[36]=l("th",{class:"th-col th-leave",title:"Sick Leave"},"WPL",-1)),e[37]||(e[37]=l("th",{class:"th-col th-leave",title:"Total Leave Days"},"Total",-1))],64)):d("",!0),a.value.ex?(o(),i(m,{key:2},[e[38]||(e[38]=l("th",{class:"th-col th-ex",title:"Offday Exchange"},"Offday",-1)),e[39]||(e[39]=l("th",{class:"th-col th-ex",title:"Shift Exchange"},"Shift",-1))],64)):d("",!0),a.value.sl?(o(),i(m,{key:3},[e[40]||(e[40]=l("th",{class:"th-col th-sl",title:"Short Leave Applications"},"Total",-1)),e[41]||(e[41]=l("th",{class:"th-col th-sl",title:"Short Leave Minutes"},"Minutes",-1))],64)):d("",!0),a.value.manual?(o(),i("th",Fe,"Count")):d("",!0)])]),l("tbody",He,[(o(!0),i(m,null,re(L.value,(t,c)=>(o(),i("tr",{key:t.user_id||c,class:_(["hover:bg-gray-200",q.value?"h-9":"h-11"])},[l("td",Je,n(c+1),1),l("td",Ze,[l("div",Ke,[l("span",Ye,n(t.user_name),1),t.employee_id?(o(),i("span",Ge,"#"+n(t.employee_id),1)):d("",!0)]),t.designation?(o(),i("div",Qe,n(t.designation),1)):d("",!0)]),a.value.ot?(o(),i(m,{key:0},[l("td",Xe,[l("span",{class:_(t._otReq>0?"badge":"muted"),title:z(t._otReq)},n(O(t._otReq)),11,et)]),l("td",tt,[l("span",{class:_(t._otAppr>0?"badge":"muted"),title:z(t._otAppr)},n(O(t._otAppr)),11,lt)]),l("td",st,[l("span",{class:_(t._otApps>0?"badge":"muted")},n(t._otApps),3)])],64)):d("",!0),a.value.leave?(o(),i(m,{key:1},[l("td",at,[l("span",{class:_(t._cl>0?"badge-soft-emerald":"muted")},n(t._cl),3)]),l("td",ot,[l("span",{class:_(t._ml>0?"badge-soft-emerald":"muted")},n(t._ml),3)]),l("td",nt,[l("span",{class:_(t._sl>0?"badge-soft-emerald":"muted")},n(t._sl),3)]),l("td",it,[l("span",{class:_(t._sl>0?"badge-soft-emerald":"muted")},n(t._wpl),3)]),l("td",dt,[l("span",{class:_(t._leaveTotal>0?"badge-strong":"muted")},n(t._leaveTotal),3)])],64)):d("",!0),a.value.ex?(o(),i(m,{key:2},[l("td",pt,[l("span",{class:_(t._exOff>0?"badge-soft-indigo":"muted")},n(t._exOff),3)]),l("td",rt,[l("span",{class:_(t._exShift>0?"badge-soft-indigo":"muted")},n(t._exShift),3)])],64)):d("",!0),a.value.sl?(o(),i(m,{key:3},[l("td",ut,[l("span",{class:_(t._slTotal>0?"badge-soft-amber":"muted")},n(t._slTotal),3)]),l("td",ct,[l("span",{class:_(t._slMinutes>0?"badge-soft-amber":"muted")},n(t._slMinutes),3)])],64)):d("",!0),a.value.manual?(o(),i("td",_t,[l("span",{class:_(t._manual>0?"badge-soft-slate":"muted")},n(t._manual),3)])):d("",!0)],2))),128)),l("tr",vt,[e[42]||(e[42]=l("td",null,null,-1)),l("td",mt,"Totals ("+n(L.value.length)+" emp)",1),a.value.ot?(o(),i(m,{key:0},[l("td",xt,n(O(v.value.otReq)),1),l("td",ht,n(O(v.value.otAppr)),1),l("td",yt,n(v.value.otApps),1)],64)):d("",!0),a.value.leave?(o(),i(m,{key:1},[l("td",ft,n(v.value.cl),1),l("td",bt,n(v.value.ml),1),l("td",gt,n(v.value.sl),1),l("td",kt,n(v.value.sl),1),l("td",wt,n(v.value.leaveTotal),1)],64)):d("",!0),a.value.ex?(o(),i(m,{key:2},[l("td",St,n(v.value.exOff),1),l("td",Lt,n(v.value.exShift),1)],64)):d("",!0),a.value.sl?(o(),i(m,{key:3},[l("td",At,n(v.value.slTotal),1),l("td",Mt,n(v.value.slMinutes),1)],64)):d("",!0),a.value.manual?(o(),i("td",Tt,n(v.value.manual),1)):d("",!0)])])]),e[43]||(e[43]=l("div",{class:"scroll-shadow-left"},null,-1)),e[44]||(e[44]=l("div",{class:"scroll-shadow-right"},null,-1))],2)),!S.value&&L.value.length===0?(o(),i("div",qt," No records for "+n(f.value)+". ",1)):d("",!0)]))}},It=ve(Ot,[["__scopeId","data-v-2000545c"]]);export{It as default};
