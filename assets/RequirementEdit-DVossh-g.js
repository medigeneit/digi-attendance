import{r as w,h as R,q as O,x as P,p as G,c as d,o as n,a as t,j as f,i as $,w as S,d as m,l as C,b as x,t as g,m as y,F as E,k as L,v as H,H as W,s as J,f as K,u as Q}from"./index-IT1V0Ofo.js";import{_ as j}from"./CompanyDepartmentSelectInput-Djcuw2Or.js";import{R as q}from"./RequiredIcon-CdvltAn0.js";import{d as X}from"./datetime-BEfC2TVK.js";import{f as Y,u as Z}from"./requirement-CH0PWZXx.js";import{u as h}from"./company-DcMkjy20.js";import{u as ee}from"./tags-ByTccbBa.js";import{L as te}from"./LoaderView-BAbIpeVv.js";import{_ as se}from"./DescriptionView-DCUBv7gY.js";import{S as ae}from"./SelectDropdown-D_5r_V3G.js";import{_ as oe}from"./TextEditor-joJUK86s.js";import{_ as z}from"./UserChip-BDuDrSbt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"sticky top-0 pt-4 bg-white z-10"},re={key:0,class:"text-lg font-semibold mb-4 text-center"},ie={class:"flex gap-4 items-center justify-center text-gray-500"},ne={class:"text-sm"},de={key:0,class:"flex items-center gap-1"},me={key:0,class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},ue={class:"text-sm flex items-center gap-2 text-red-400 font-semibold"},pe={class:"mt-[2px]"},be={key:0,class:"text-gray-800 flex items-center gap-2"},ve={class:"flex gap-4 items-center justify-center"},ge={class:"mb-4"},ye={class:"mb-4"},ce={class:"mb-4"},fe={class:"mb-4"},xe={key:0,class:"mb-4"},_e={class:"border rounded px-2 py-1 text-gray-600 bg-gray-50"},ke={class:"block text-gray-600 text-sm mb1 font-medium"},we={class:"block text-gray-600 text-sm mb-1 font-medium"},Ce={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Ve={class:"flex items-center justify-between gap-4"},De=["disabled"],Se={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(T,{emit:D}){const _=T,k=D,b=ee(),u=h(),l=w(""),r=w(),V=w(""),F=w(),a=w({from_department_id:"",to_department_id:"",website_tags:[],priority:""});R(async()=>{var s;l.value="loading",b.fetchTags("website"),await u.fetchCompanies({with:"departments",ignore_permission:!0}),await u.fetchMyCompanies({with:"departments"}),r.value=(s=(await Y(_.requirementId)).data)==null?void 0:s.requirement,l.value=""}),O(r,function(s){var e;s&&(a.value.title=s.title,a.value.priority=s.priority||"",a.value.description=s.description,a.value.from_department_id=s.from_department_id,a.value.to_department_id=s.to_department_id,Array.isArray(s==null?void 0:s.website_tags)&&((e=s.website_tags)==null?void 0:e.length)>0&&(a.value.website_tags=s.website_tags.map(p=>p.name)))});async function A(){var e,p,c,v;l.value="submitting";const s={...a.value};console.log({payload:s});try{const i=await Z(_.requirementId,s);k("update",i),l.value="created",V.value=(e=i==null?void 0:i.data)==null?void 0:e.message}catch(i){k("error",(p=i==null?void 0:i.response)==null?void 0:p.data),V.value=(v=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:v.message,l.value="error"}}const B=P(()=>{var s,e;for(let p in u.myCompanies)if((((e=(s=u==null?void 0:u.myCompanies)==null?void 0:s[p])==null?void 0:e.departments)||[]).some(v=>v.id==a.value.from_department_id))return!0;return!1});return(s,e)=>{var c,v,i,U,I,M,N;const p=G("RouterLink");return n(),d("div",{ref_key:"containerRef",ref:F,class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[t("div",le,[e[9]||(e[9]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[10]||(e[10]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=S(o=>k("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),r.value?(n(),d("div",re,[m(se,{"line-clamp":"3",class:"mb-2"},{default:C(()=>[x(g(r.value.title),1)]),btnText:C(({lineClampClass:o})=>[x(g(o?"More":"Less"),1)]),_:1}),t("div",ie,[t("div",ne,[e[11]||(e[11]=t("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),x(" "+g(y(X)(r.value.created_at)),1)]),r.value.created_by?(n(),d("div",de,[e[12]||(e[12]=t("span",{class:"text-gray-400 text-sm"},"By",-1)),m(z,{"avatar-size":"xsmall",user:r.value.created_by,class:"border-sky-300"},null,8,["user"])])):f("",!0)])])):f("",!0),t("form",{onSubmit:S(A,["prevent"]),class:"z-0"},[l.value!=="loading"&&l.value!=="submitting"?(n(),d(E,{key:0},[(c=r.value)!=null&&c.closed_at?(n(),d("div",me,[t("div",ue,[e[13]||(e[13]=t("span",{class:"fad fa-lock"},null,-1)),e[14]||(e[14]=t("span",{class:"mt-[2px]"},"CLOSED AT",-1)),t("span",pe,g(new Date(r.value.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),r.value.closed_by_user?(n(),d("div",be,[e[15]||(e[15]=t("span",{class:"text-sm"},"Closed by",-1)),m(z,{user:r.value.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):f("",!0),t("div",ve,[m(p,{to:{name:"RequirementShow",params:{id:(v=s.req)==null?void 0:v.id}},class:"btn-2 h-6",onClick:e[1]||(e[1]=o=>o.stopPropagation())},{default:C(()=>e[16]||(e[16]=[t("i",{class:"fad fa-eye"},null,-1),x(" Show ")])),_:1,__:[16]},8,["to"])])])):(n(),d(E,{key:1},[t("div",ge,[e[17]||(e[17]=t("label",{class:"text-gray-800"},"Title",-1)),L(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.title=o),required:"",placeholder:"Ender Requirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[H,a.value.title]])]),t("div",ye,[e[19]||(e[19]=t("label",{class:"text-gray-800"},"Priority",-1)),L(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.priority=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[18]||(e[18]=[t("option",{value:""},"Normal",-1),t("option",{value:"IMPORTANT"},"Important",-1),t("option",{value:"URGENT"},"Urgent",-1)]),512),[[W,a.value.priority]])]),t("div",ce,[e[20]||(e[20]=t("label",{class:"text-gray-800"},"Description",-1)),m(oe,{modelValue:a.value.description,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.description=o)},null,8,["modelValue"])]),t("div",fe,[e[21]||(e[21]=t("label",{class:"text-gray-800"},"Websites",-1)),m(ae,{options:y(b).tags,modelValue:a.value.website_tags,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.website_tags=o),taggable:"",label:"name",value:"name"},null,8,["options","modelValue"])]),B.value?(n(),$(j,{key:1,modelValue:a.value.from_department_id,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.from_department_id=o),companies:((I=y(u))==null?void 0:I.myCompanies)||[],disabled:!!r.value.status,class:"mb-4"},{label:C(()=>[t("label",ke,[e[23]||(e[23]=x(" From Department ")),m(q)])]),_:1},8,["modelValue","companies","disabled"])):(n(),d("div",xe,[e[22]||(e[22]=t("label",{class:"block text-gray-600 text-sm mb1 font-medium"}," From Department ",-1)),t("div",_e,g((U=(i=r.value)==null?void 0:i.from_department)==null?void 0:U.name),1)])),m(j,{modelValue:a.value.to_department_id,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.to_department_id=o),companies:((M=y(u))==null?void 0:M.companies)||[],disabled:!!((N=r.value)!=null&&N.status),class:"mb-4"},{label:C(()=>[t("label",we,[e[24]||(e[24]=x(" To Department ")),m(q)])]),_:1},8,["modelValue","companies","disabled"])],64))],64)):f("",!0),t("div",Ce,[V.value?(n(),d("div",{key:0,class:J(["mb-4 font-medium text-center",{"text-red-500":l.value=="error","text-green-500":l.value=="created"}])},g(V.value),3)):f("",!0),t("div",Ve,[t("button",{type:"button",onClick:e[8]||(e[8]=S(o=>k("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),t("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},g(l.value=="submitting"?"Saving...":"Save"),9,De)])])],32),l.value==="loading"||l.value==="submitting"?(n(),$(te,{key:1,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):f("",!0)],512)}}},Te={class:"container mx-auto p-6"},Re={__name:"RequirementEdit",setup(T){const D=K(),_=Q();return(k,b)=>(n(),d("div",Te,[m(Se,{requirementId:y(D).params.id,onUpdate:b[0]||(b[0]=()=>y(_).back()),onCancelClick:b[1]||(b[1]=()=>y(_).back())},null,8,["requirementId"])]))}};export{Re as default};
