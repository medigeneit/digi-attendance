import{b as G,u as H,z as W,A as F,e as X,c as b,o as v,a as s,p as ee,h as Q,B as te,k as D,J as le,P as re,r as k,m as J,Q as z,g as A,v as ie,x as L,j as Y,t as w,F as K,y as Z,M as R,f as de}from"./index-63lpdASF.js";import{_ as pe}from"./EmployeeFilter-DVglG6vG.js";import"./company-CyvaQj7q.js";import"./department-fsAjzNQ0.js";import"./EmployeeDropdownInput-C8wvuVbF.js";import"./SelectDropdown-BhYlE6wu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BZeoE5mq.js";const ce={class:"flex flex-wrap items-end gap-3"},ye={__name:"BoardFilters",props:{modelValue:{type:Object,required:!0},companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup($,{emit:d}){const T=$,B=d,g=G(),C=H(),h={type:null,user_type:"Probationary"},P=(o={})=>({type:o.type??h.type,company_id:o.companyId??null,department_id:o.departmentId??null,employee_id:o.employeeId??null,line_type:o.lineType??null,user_type:o.user_type??h.user_type}),y=(o={})=>({type:o.type??h.type,companyId:o.company_id??null,departmentId:o.department_id??null,employeeId:o.employee_id??null,lineType:o.line_type??null,user_type:o.user_type??h.user_type}),l=W(P(T.modelValue));let r=!1;function f(){r||B("update:modelValue",{...y(l)})}const I=["type","company_id","department_id","employee_id","line_type","user_type"],u=o=>o===""||o===null||o===void 0||o==="all";function j(){const o={};return!u(l.type)&&String(l.type)!==String(h.type)&&(o.type=String(l.type)),u(l.company_id)||(o.company_id=String(l.company_id)),u(l.department_id)||(o.department_id=String(l.department_id)),u(l.employee_id)||(o.employee_id=String(l.employee_id)),u(l.line_type)||(o.line_type=String(l.line_type)),!u(l.user_type)&&String(l.user_type)!==h.user_type&&(o.user_type=String(l.user_type)),o}function V(o={}){const p={...g.query};for(const S of I)delete p[S];const c={...p,...j(),...o};for(const S of Object.keys(c)){const _=c[S];(_===""||_===null||_===void 0)&&delete c[S]}return c}let N=null;function O({replace:o=!0,partial:p={},debounce:c=150}={}){N&&clearTimeout(N),N=setTimeout(()=>{const S=V(p);(o?C.replace({query:S}):C.push({query:S})).catch(()=>{})},c)}function U(){const o={...y(l)};B("submit",o),O({replace:!0,debounce:0})}return F(()=>T.modelValue,o=>{const p=P(o||{});let c=!1;for(const S of Object.keys(p))if(l[S]!==p[S]){c=!0;break}c&&(r=!0,Object.assign(l,p),le(()=>{r=!1}))},{deep:!0}),F(()=>[l.type,l.company_id,l.department_id,l.employee_id,l.line_type,l.user_type],()=>{f(),O({replace:!0,debounce:150})}),X(()=>{g.query.user_type&&(l.user_type=String(g.query.user_type))}),F(()=>g.query.user_type,o=>{o!=null&&(l.user_type=String(o))}),(o,p)=>(v(),b("div",ce,[s("div",null,[p[7]||(p[7]=s("label",{class:"block text-xs text-gray-500 mb-1"},"User Type",-1)),Q(s("select",{"onUpdate:modelValue":p[0]||(p[0]=c=>l.user_type=c),class:"border rounded px-2 py-1"},p[6]||(p[6]=[s("option",{value:"Probationary"},"Probationary",-1),s("option",{value:"Permanent"},"Permanent",-1)]),512),[[te,l.user_type]])]),ee(pe,{company_id:l.company_id,"onUpdate:company_id":p[1]||(p[1]=c=>l.company_id=c),department_id:l.department_id,"onUpdate:department_id":p[2]||(p[2]=c=>l.department_id=c),employee_id:l.employee_id,"onUpdate:employee_id":p[3]||(p[3]=c=>l.employee_id=c),line_type:l.line_type,"onUpdate:line_type":p[4]||(p[4]=c=>l.line_type=c),"with-type":!0,"initial-value":D(g).query,companies:$.companies,departments:$.departments,onFilterChange:p[5]||(p[5]=c=>{Object.assign(l,c)})},null,8,["company_id","department_id","employee_id","line_type","initial-value","companies","departments"]),s("button",{class:"btn-2 py-1",onClick:U}," Apply ")]))}},ne=re("checklistBoard",()=>{const $=k(!1),d=k(null),T=k("joining"),B=k("Probationary"),g=k(null),C=k(null),h=k(""),P=k([]),y=k([]),l=k(Object.create(null)),r=k(null),f=n=>typeof n=="string"?n.toLowerCase():"",I=n=>Array.isArray(n)?n:[],u=n=>{var i;return((i=n==null?void 0:n.data)==null?void 0:i.data)??(n==null?void 0:n.data)},j=n=>{var i,m;return((i=n==null?void 0:n.company)==null?void 0:i.name)||(n==null?void 0:n.company_name)||((m=n==null?void 0:n.organization)==null?void 0:m.name)||"—"},V=n=>{var i,m;return((i=n==null?void 0:n.department)==null?void 0:i.name)||((m=n==null?void 0:n.dept)==null?void 0:m.name)||(n==null?void 0:n.department_name)||"—"},N=n=>{var i;return((i=n==null?void 0:n.position)==null?void 0:i.title)||(n==null?void 0:n.designation)||"—"},O=(n={})=>{const i={user_type:B.value||void 0,type:T.value||void 0,company_id:g.value||void 0,department_id:C.value||void 0,search:(h.value||"").trim()||void 0,template_id:o.value||void 0};return Object.keys(i).forEach(m=>(i[m]==null||i[m]==="")&&delete i[m]),{...i,...n}},U=J(()=>{const n=f(T.value);return P.value.find(i=>f(i==null?void 0:i.type)===n)||null}),o=J(()=>{var n;return((n=U.value)==null?void 0:n.id)??null});async function p(n={}){try{const i=await z.get("/checklist-templates",{params:n});P.value=I(u(i))}catch(i){throw P.value=[],d.value=i,i}}async function c(n,i){const{data:m}=await z.patch(`/user/${n}/employment-type`,{employment_type:i}),M=y.value.findIndex(E=>E.id===n);return M!==-1&&(this.users[M]={...this.users[M],employment_type:T}),this.rows[n]&&(this.rows[n]={...this.rows[n]}),m}async function S(n={}){if(r.value)try{await r.value}catch{}$.value=!0,d.value=null;const i=O(n),m=(async()=>{try{const M=await z.get("/users-checklists",{params:i});y.value=I(u(M))}catch(M){throw y.value=[],d.value=M,M}finally{$.value=!1,r.value=null}})();return r.value=m,m}async function _({withUsers:n=!0,templateParams:i={},userParams:m={}}={}){$.value=!0,d.value=null;try{P.value.length||await p(i),n&&await S(m)}catch(M){throw d.value=M,M}finally{$.value=!1}}function t(n){y.value=I(n)}function a(n={}){"type"in n&&(T.value=n.type),"companyId"in n&&(g.value=n.companyId),"departmentId"in n&&(C.value=n.departmentId),"search"in n&&(h.value=n.search)}function e(){T.value="joining",g.value=null,C.value=null,h.value=""}function x(){l.value=Object.create(null)}return{loading:$,error:d,type:T,companyId:g,departmentId:C,search:h,templates:P,users:y,rows:l,templateByType:U,templateId:o,companyNameOf:j,departmentNameOf:V,positionTitleOf:N,loadBoard:_,loadTemplates:p,loadUsers:S,setUsers:t,setFilters:a,resetFilters:e,clearRowCache:x,updateEmploymentType:c}}),me={class:"space-y-4"},ue={class:"flex flex-wrap items-center gap-2"},_e={class:"relative"},fe={class:"rounded-lg border p-1 text-xs"},ve={class:"ml-auto"},ge={class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs text-blue-700"},he={class:"ml-1 font-medium"},be={class:"overflow-x-auto rounded-xl border shadow-sm"},xe={class:"min-w-full text-[13px]"},we={class:"p-2"},ke={class:"p-2"},Ie={class:"flex items-center gap-2"},Se={class:"relative h-8 w-8 shrink-0"},Te=["src"],Ce={key:1,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 text-[11px] font-semibold text-gray-700"},Me={class:"min-w-0"},Pe={class:"font-medium truncate"},Be={class:"text-[11px] text-gray-500 space-x-2 truncate"},je={key:0},$e={class:"hidden sm:inline"},De={class:"p-2 hidden md:table-cell"},Ue=["title"],Ne={class:"p-2"},Oe={class:"relative w-full rounded-full bg-gray-200 h-2 overflow-hidden"},Le=["title"],Ve=["title"],Ae={class:"mt-1 flex items-center justify-between text-[11px] text-gray-600"},Ee={key:0,class:"mt-1"},Fe=["title"],qe={class:"mt-1 flex items-center justify-between text-[11px] text-gray-600"},ze={key:0},Re={key:1,class:"text-red-600"},Qe={class:"p-2"},Je={class:"flex items-center gap-2"},Ye={class:"relative"},He=["disabled","value","onChange"],Ke=["value"],Ze={key:0,class:"absolute right-2 top-1/2 h-3 w-3 -translate-y-1/2 animate-spin text-gray-400",viewBox:"0 0 24 24"},Ge={class:"p-2"},We=["disabled","title","onClick"],Xe={key:0,class:"text-gray-600 text-sm"},et={key:1,class:"rounded-xl border border-dashed p-10 text-center text-sm text-gray-500"},tt={__name:"ChecklistBoardTable",setup($){const d=ne(),T=H(),B=k(""),g=k(!1),C=k("progress_desc"),h=W({}),P=t=>{var a;return((a=d.rows)==null?void 0:a[String(t==null?void 0:t.id)])||{}},y=(t,a,e)=>Math.min(Math.max(Number(t||0),a),e),l=t=>t<0?0:t>100?100:Math.round(t),r=t=>t?new Date(t):null,f=(t,a)=>{const e=new Date(t.getTime()),x=e.getMonth()+(a||0);return e.setMonth(x),e.getMonth()!==(x%12+12)%12&&e.setDate(0),e},I=(t,a)=>Math.round((t-a)/864e5),u=t=>{const e=P(t).percent??(t==null?void 0:t.percent)??0;return y(e,0,100)},j=t=>{var a;return y(((a=t==null?void 0:t.checklist)==null?void 0:a.required_completion_percent)??100,1,100)},V=t=>{const a=x=>String(x||"").toLowerCase(),e=a(B.value);return e?[t==null?void 0:t.name,t==null?void 0:t.employee_id,t==null?void 0:t.department,t==null?void 0:t.designation].filter(Boolean).some(x=>a(x).includes(e)):!0};function N(t){const a=d.templateId;a&&T.push({name:"checklist.create",params:{userId:t.id,templateId:a}})}const O=J(()=>{let t=(d.users||[]).filter(V);return g.value&&(t=t.filter(a=>u(a)<j(a))),C.value==="name_asc"?t=[...t].sort((a,e)=>(a.name||"").localeCompare(e.name||"")):C.value==="progress_asc"?t=[...t].sort((a,e)=>u(a)-u(e)):t=[...t].sort((a,e)=>u(e)-u(a)),t}),U=[{value:"probationary",label:"Probationary"},{value:"permanent",label:"Permanent"}],o=t=>String(t||"").toLowerCase(),p=t=>{var e;const a=o(t);return((e=U.find(x=>x.value===a))==null?void 0:e.label)||"—"},c=t=>{const a=o(t);return a==="probationary"?"bg-amber-50 text-amber-700 ring-amber-200":a==="permanent"?"bg-green-50 text-green-700 ring-green-200":"bg-gray-50 text-gray-700 ring-gray-200"};async function S(t,a){if(!(t!=null&&t.id))return;const e=o(a),x=o(t.employment_type);if(!U.some(m=>m.value===e)||x===e)return;const n=p(t.employment_type),i=p(e);h[t.id]=!0,t.employment_type=i;try{await d.updateEmploymentType(t.id,i)}catch(m){t.employment_type=n,console.error(m),alert("Failed to update employment type. Please try again.")}finally{h[t.id]=!1}}function _(t){if(!(o(t==null?void 0:t.employment_type)==="probationary"))return{enabled:!1};const e=r(t==null?void 0:t.joining_date)||r(t==null?void 0:t.created_at),x=Number(t==null?void 0:t.probation_months)||0,n=Number(t==null?void 0:t.probation_extension_months)||0;if(!e||Number.isNaN(x))return{enabled:!1};const i=Math.max(1,x+(n||0)),m=f(e,i),M=new Date,E=Math.max(1,I(m,e)),se=Math.max(0,Math.min(E,I(M,e))),q=I(m,M),ae=l(se/E*100),oe=q<0?"overdue":q<=14?"near_end":"active";return{enabled:!0,start:e,end:m,pct:ae,leftDays:q,status:oe}}return(t,a)=>(v(),b("div",me,[s("div",ue,[s("div",_e,[Q(s("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>B.value=e),type:"search",placeholder:"Search name / ID / dept / designation…",class:"w-64 md:w-80 max-w-full rounded-lg border bg-white/90 px-8 py-2 text-sm outline-none focus:border-gray-400"},null,512),[[ie,B.value]]),a[5]||(a[5]=s("svg",{class:"pointer-events-none absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M12.9 14.32a8 8 0 111.414-1.414l3.387 3.387a1 1 0 01-1.414 1.414L12.9 14.32zM14 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1)),B.value?(v(),b("button",{key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",onClick:a[1]||(a[1]=e=>B.value=""),"aria-label":"Clear search"},"✕")):A("",!0)]),s("div",fe,[s("button",{class:L(["rounded-md px-2 py-1",g.value?"":"bg-gray-900 text-white"]),onClick:a[2]||(a[2]=e=>g.value=!1)},"All",2),s("button",{class:L(["rounded-md px-2 py-1",g.value?"bg-gray-900 text-white":""]),onClick:a[3]||(a[3]=e=>g.value=!0),title:"Show only users below their checklist target"},"Only Missing",2)]),Q(s("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>C.value=e),class:"rounded-md border bg-white px-2 py-1 text-xs outline-none"},a[6]||(a[6]=[s("option",{value:"progress_desc"},"Sort: Progress ↓",-1),s("option",{value:"progress_asc"},"Sort: Progress ↑",-1),s("option",{value:"name_asc"},"Sort: Name A–Z",-1)]),512),[[te,C.value]]),s("div",ve,[s("span",ge,[a[7]||(a[7]=Y(" Template: ")),s("span",he,w(D(d).templateId||"Not selected"),1)])])]),s("div",be,[s("table",xe,[a[9]||(a[9]=s("thead",{class:"sticky top-0 bg-gray-50/90 backdrop-blur"},[s("tr",{class:"text-left border-b"},[s("th",{class:"p-2 w-10"},"#"),s("th",{class:"p-2 min-w-[220px]"},"User"),s("th",{class:"p-2 hidden md:table-cell min-w-[160px]"},"Role"),s("th",{class:"p-2 min-w-[260px]"},"Progress"),s("th",{class:"p-2 w-44"},"Status"),s("th",{class:"p-2 w-36"},"Actions")])],-1)),s("tbody",null,[(v(!0),b(K,null,Z(O.value,(e,x)=>(v(),b("tr",{key:e.id,class:"border-b hover:bg-gray-50/70"},[s("td",we,w(x+1),1),s("td",ke,[s("div",Ie,[s("div",Se,[e.avatar?(v(),b("img",{key:0,src:e.avatar,alt:"",class:"h-8 w-8 rounded-full object-cover"},null,8,Te)):(v(),b("div",Ce,w((e.name||e.full_name||e.email||"??").slice(0,2).toUpperCase()),1))]),s("div",Me,[s("div",Pe,w(e.name||e.full_name||e.email),1),s("div",Be,[e.joining_date?(v(),b("span",je,"ID: "+w(e.joining_date),1)):A("",!0),s("span",$e,"Dept: "+w(e.department||"—"),1)])])])]),s("td",De,[s("div",{class:"truncate",title:e.designation},w(e.designation||"—"),9,Ue)]),s("td",Ne,[s("div",Oe,[s("div",{class:"pointer-events-none absolute top-0 h-2 w-0.5 bg-gray-600/60",style:R({left:`calc(${j(e)}% - 1px)`}),title:`Checklist target ${j(e)}%`},null,12,Le),s("div",{class:L(["h-2 transition-all",u(e)>=j(e)?"bg-green-500":"bg-amber-500"]),style:R({width:u(e)+"%"}),title:`Checklist: ${u(e)}% (Target ${j(e)}%)`},null,14,Ve)]),s("div",Ae,[s("span",null,"Actual: "+w(u(e))+"%",1),s("span",null,"Target: "+w(j(e))+"%",1)]),_(e).enabled?(v(),b("div",Ee,[s("div",{class:L(["relative w-full rounded-full h-1.5 overflow-hidden",{"bg-amber-100":_(e).status!=="overdue","bg-red-100":_(e).status==="overdue"}]),title:`Probation ${_(e).pct}% | Ends ${_(e).end.toLocaleDateString()}`},[s("div",{class:L(["h-1.5 transition-all",{"bg-amber-500":_(e).status==="active","bg-orange-500":_(e).status==="near_end","bg-red-500":_(e).status==="overdue"}]),style:R({width:_(e).pct+"%"})},null,6)],10,Fe),s("div",qe,[s("span",null,"Probation: "+w(_(e).pct)+"%",1),_(e).leftDays>=0?(v(),b("span",ze,w(_(e).leftDays)+"d left ",1)):(v(),b("span",Re," Overdue "+w(Math.abs(_(e).leftDays))+"d ",1))])])):A("",!0)]),s("td",Qe,[s("div",Je,[s("span",{class:L(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] ring-1",c(e.employment_type)])},w(p(e.employment_type)),3),s("div",Ye,[s("select",{disabled:!!h[e.id],value:o(e.employment_type),class:"rounded-md border bg-white px-2 py-1 text-[11px] outline-none disabled:opacity-50",onChange:n=>S(e,n.target.value),"aria-label":"Change employment type"},[(v(),b(K,null,Z(U,n=>s("option",{key:n.value,value:n.value},w(n.label),9,Ke)),64))],40,He),h[e.id]?(v(),b("svg",Ze,a[8]||(a[8]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3",fill:"none"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3A5 5 0 007 12H4z"},null,-1)]))):A("",!0)])])]),s("td",Ge,[s("button",{class:"px-3 py-1.5 rounded-md text-[12px] font-medium bg-gray-900 text-white hover:bg-black disabled:opacity-40",disabled:!D(d).templateId,title:D(d).templateId?"":"Select a template first",onClick:n=>N(e)},w(e!=null&&e.checklist?"Open":"Create"),9,We)])]))),128))])])]),D(d).loading?(v(),b("div",Xe,"Loading…")):!D(d).loading&&O.value.length===0?(v(),b("div",et," No users found for the current filters. ")):A("",!0)]))}},nt={class:"p-6 space-y-6"},st={class:"flex items-center justify-between"},at={class:"text-2xl font-semibold"},ot={class:"text-gray-500"},lt={key:0,class:"text-gray-600"},rt={key:1,class:"text-red-600"},ft={__name:"JoiningExitBoard",setup($){const d=ne(),T=G(),B=H(),g=k([]),C=k([]),h=(r={})=>({type:r.type??d.type,companyId:r.company_id?Number(r.company_id):null,departmentId:r.department_id?Number(r.department_id):null,employeeId:r.employee_id?Number(r.employee_id):null,lineType:r.line_type??null,user_type:r.user_type??null,search:r.search??d.search}),P=(r={})=>{const f={type:r.type||void 0,company_id:r.companyId||void 0,department_id:r.departmentId||void 0,employee_id:r.employeeId||void 0,line_type:r.lineType||void 0,user_type:r.user_type||void 0,search:r.search||void 0};return Object.keys(f).forEach(I=>(f[I]==null||f[I]==="")&&delete f[I]),f},y=k({type:d.type,companyId:d.companyId,departmentId:d.departmentId,employeeId:null,lineType:null,user_type:null,search:d.search});F(y,r=>{d.type=r.type,d.user_type=r.user_type,d.companyId=r.companyId??null,d.departmentId=r.departmentId??null,d.search=r.search??"",B.replace({query:{...T.query,...P(r)}})},{deep:!0,immediate:!0});async function l(){await d.loadUsers({type:y.value.type,company_id:y.value.companyId,department_id:y.value.departmentId,employee_id:y.value.employeeId,line_type:y.value.lineType,user_type:y.value.user_type,search:y.value.search})}return X(async()=>{Object.assign(y.value,h(T.query)),await d.loadBoard({withUsers:!0,userParams:P(y.value)})}),(r,f)=>{var I,u;return v(),b("div",nt,[s("div",st,[s("h1",at,[s("b",null,w(((I=D(d).templateByType)==null?void 0:I.name)||"—"),1),f[1]||(f[1]=Y(" Board"))]),s("div",ot,[f[2]||(f[2]=Y(" Template: ")),s("b",null,w(((u=D(d).templateByType)==null?void 0:u.name)||"—"),1)])]),ee(ye,{modelValue:y.value,"onUpdate:modelValue":f[0]||(f[0]=j=>y.value=j),companies:g.value,departments:C.value,onSubmit:l},null,8,["modelValue","companies","departments"]),D(d).loading?(v(),b("div",lt,"Loading…")):D(d).error?(v(),b("div",rt,"Failed to load.")):(v(),de(tt,{key:2}))])}}};export{ft as default};
