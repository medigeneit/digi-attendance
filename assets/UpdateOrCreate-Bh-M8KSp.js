import{G as I,r as l,p as E,H as p,a4 as x,I as D,q as S,c as _,o as C,a as n,g as k,y as M,t as F,h as V,v as U,F as j}from"./index-DBYhXNkE.js";import{_ as N}from"./TimePickerAsFloatHour-JDtLcGMx.js";const B=I("paycut",()=>{const d=l([]),v=l(null),o=l(!1),s=l(null),f=l(new Date().toISOString().substring(0,7)),y=E(()=>new Date(f.value).toLocaleString("default",{month:"long",year:"numeric"})),$=async(t={})=>{var u,r,e;o.value=!0,s.value=null;try{const a=await p.get("/paycuts",{params:t});d.value=((u=a==null?void 0:a.data)==null?void 0:u.data)||(a==null?void 0:a.data)||[]}catch(a){s.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to fetch paycuts",console.error("Error fetching paycuts:",a)}finally{o.value=!1}},b=async(t,u)=>{var r,e;o.value=!0,s.value=null;try{const a=await p.get(`/paycuts/${t}/${u}`);v.value=a.data}catch(a){s.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to fetch paycuts",console.error("Error fetching paycuts:",a)}finally{o.value=!1}},h=async(t={})=>{var u,r;o.value=!0,s.value=null;try{const e=await p.post("/paycuts",t);return d.value.push(e.data),e.data}catch(e){throw s.value=((r=(u=e.response)==null?void 0:u.data)==null?void 0:r.message)||"Failed to create paycut",console.error("Error creating paycut:",e),new Error(s.value)}finally{o.value=!1}},c=async t=>{var u,r;o.value=!0,s.value=null;try{const e=await p.get(`/paycuts/${t}`);return v.value=e.data||{},await x().fetchApprovalPermissions("paycut_applications",v.value.id),v.value}catch(e){throw s.value=((r=(u=e.response)==null?void 0:u.data)==null?void 0:r.message)||`Failed to fetch paycut (ID: ${t})`,console.error(`Error fetching paycut with id ${t}:`,e),new Error(s.value)}finally{o.value=!1}};return{paycuts:d,paycut:v,loading:o,error:s,selectedMonth:f,selectedMonthDisplay:y,fetchPaycuts:$,fetchUserMonthlyPaycuts:b,fetchPaycutById:c,createPaycut:h,updatePaycut:async(t,u)=>{var r,e;o.value=!0,s.value=null;try{return(await p.put(`/paycuts/${t}`,u)).data}catch(a){throw s.value=((e=(r=a.response)==null?void 0:r.data)==null?void 0:e.message)||`Failed to update paycut (ID: ${t})`,console.error(`Error updating paycut with id ${t}:`,a),new Error(s.value)}finally{o.value=!1}},deletePaycut:async t=>{var u,r;o.value=!0,s.value=null;try{await p.delete(`/paycuts/${t}`),d.value=d.value.filter(e=>e.id!==t)}catch(e){throw s.value=((r=(u=e.response)==null?void 0:u.data)==null?void 0:r.message)||`Failed to delete paycut (ID: ${t})`,console.error(`Error deleting paycut with id ${t}:`,e),new Error(s.value)}finally{o.value=!1}},approvePaycut:async t=>{var u,r;try{await p.post(`/paycuts/${t}/approve`),await c(t)}catch(e){throw s.value=((r=(u=e.response)==null?void 0:u.data)==null?void 0:r.message)||`Failed to approve paycut (ID: ${t})`,console.error(e),new Error(s.value)}},rejectPaycut:async t=>{var u,r;try{await p.post(`/paycuts/${t}/reject`),await c(t)}catch(e){throw s.value=((r=(u=e.response)==null?void 0:u.data)==null?void 0:r.message)||`Failed to reject paycut (ID: ${t})`,console.error(e),new Error(s.value)}}}}),q={key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50"},H={class:"modal-card max-w-sm"},A={class:"title-lg"},O={class:"flex justify-between gap-2 mt-4"},G={__name:"UpdateOrCreate",props:{userId:{type:[String,Number],required:!0},month:{type:String,required:!0},show:Boolean},emits:["updated"],setup(d,{emit:v}){const o=D(),s=l(0),f=l(54),y=d,$=v,b=E(()=>i.value>=s.value&&i.value<=f.value),h=B(),c=l(!1),i=l(""),m=l("");l("");const w=l(null),g=E(()=>{var e;return!!((e=w.value)!=null&&e.id)}),t=async()=>{try{await h.fetchUserMonthlyPaycuts(y.userId,y.month);const e=h.paycut;w.value=e||null,i.value=Number((e==null?void 0:e.paycut_hours)||0)||0,m.value=(e==null?void 0:e.reason)||"",console.log({record:e})}catch(e){console.error("Failed to fetch paycut:",e),w.value=null,i.value="",m.value=""}};S(c,async e=>{e&&await t()}),S(()=>[y.userId,y.month],async()=>{c.value&&await t()});const u=async()=>{if(!b.value)return o.error(`Paycut hour must be between ${s.value} and ${f.value}`);if(window.confirm(g.value?"Are you sure you want to update this paycut? This can only be done once.":"Are you sure you want to create this paycut?"))try{g.value?await h.updatePaycut(w.value.id,{paycut_hours:i.value,reason:m.value}):await h.createPaycut({paycut_hours:i.value,reason:m.value,user_id:y.userId,month:y.month}),$("updated"),r()}catch(a){alert("Failed to submit paycut: "+a.message)}},r=()=>{c.value=!1};return(e,a)=>(C(),_(j,null,[n("i",{onClick:a[0]||(a[0]=P=>c.value=!0),class:"fa fa-edit cursor-pointer text-sky-600"}),c.value?(C(),_("div",q,[n("div",H,[n("h3",A,F(g.value?"Update Paycut":"Create Paycut"),1),a[3]||(a[3]=n("hr",{class:"my-2"},null,-1)),M(N,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=P=>i.value=P),"minute-interval":5,required:!0,"hour-min":0,"hour-max":54},null,8,["modelValue"]),n("div",null,[V(n("textarea",{class:"input-1","onUpdate:modelValue":a[2]||(a[2]=P=>m.value=P),placeholder:"Pay cut reason"},null,512),[[U,m.value]])]),a[4]||(a[4]=n("hr",{class:"my-2"},null,-1)),n("div",O,[n("button",{class:"btn-3",onClick:r},"Cancel"),n("button",{class:"btn-2-green",onClick:u},F(g.value?"Update":"Create"),1)])])])):k("",!0)],64))}};export{G as _,B as u};
