import{C as P,r as g,D as Y,s as K,x as z,z as $,b as ee,c as n,a,d as x,B as F,F as m,q as b,h as V,v as te,p as k,o as r,t as h,k as O,M as se}from"./index-BNdSmuPH.js";import{u as ae}from"./company-Bi5pRx_U.js";import{u as oe}from"./department-CEUEb5ax.js";import{u as le}from"./shift-DgW2s27v.js";import{d as T}from"./dayjs.min-Cbbdfn5l.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re=P("shiftSchedule",()=>{const C=g([]);return{schedules:C,fetchSchedules:async d=>{const y=await Y.get("/shift-schedules",d);return C.value=y.data,y.data},saveSchedules:async d=>{await Y.post("/shift-schedules",{schedules:d==null?void 0:d.payload})}}}),ue={class:"p-4 max-w-[1600px] mx-auto"},ie={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},de=["value"],ce=["value"],pe=["value"],ve={class:"flex flex-wrap gap-3 mb-4"},fe=["onClick"],he={class:"text-sm"},ge={class:"overflow-auto"},me={class:"table-auto w-full border text-sm"},be={class:"sticky top-0 bg-white z-10"},ye={class:"text-xs text-gray-400"},Se={class:"border p-2"},we=["value"],xe={class:"border p-2 whitespace-nowrap"},Ee={class:"border p-2"},_e=["onClick"],ke=["onClick"],Ce=["title"],De={__name:"ShiftScheduleForm",setup(C){const D=re(),S=ae(),d=le(),y=oe(),{companies:q,employees:M}=K(S),{departments:L}=K(y),{shifts:R}=K(d),p=g(T().format("YYYY-MM")),v=g(""),N=g(""),i=g(""),u=g({}),c=g([]),w=g({WEEKEND:"bg-red-700"}),U=["bg-green-700","bg-pink-600","bg-blue-800","bg-cyan-600","bg-red-300","bg-purple-700","bg-yellow-500","bg-indigo-500","bg-amber-600"],E=z(()=>Object.values(R.value||{}).flat());function j(){const s=E.value;let t=0;s.forEach(e=>{w.value[e.id]=U[t%U.length],t++}),w.value.WEEKEND="bg-red-700"}const _=z(()=>Array.from({length:T(p.value).daysInMonth()},(s,t)=>t+1)),B=s=>{const t=`${p.value}-${String(s).padStart(2,"0")}`;return T(t).format("ddd")},G=(s,t)=>{var o,l;const e=(l=(o=u.value)==null?void 0:o[s])==null?void 0:l[t];return e?["WEEKEND"].includes(e)?w.value[e]||"bg-gray-300":w.value[parseInt(e)]||"bg-gray-300":"bg-gray-300"},H=(s,t)=>{var l,f;const e=(f=(l=u.value)==null?void 0:l[s])==null?void 0:f[t],o=E.value.find(A=>A.id===e);return(o==null?void 0:o.name)||""},J=(s,t)=>{c.value.includes(parseInt(s))&&i.value&&(u.value[s]||(u.value[s]={}),u.value[s][t]=i.value)},I=s=>{c.value.includes(parseInt(s))&&i.value&&(u.value[s]||(u.value[s]={}),_.value.forEach(t=>{u.value[s][t]=i.value}))},Q=()=>{c.value.forEach(s=>{I(s)})},X=()=>{c.value.forEach(s=>{var o;const t=M.value.find(l=>l.id===parseInt(s)),e=((o=t==null?void 0:t.weekends)==null?void 0:o.map(l=>l.slice(0,3)))||[];u.value[s]||(u.value[s]={}),_.value.forEach(l=>{const f=B(l);e.includes(f)&&(u.value[s][l]="WEEKEND")})})},Z=async()=>{const s=Object.entries(u.value).flatMap(([t,e])=>c.value.includes(parseInt(t))?Object.entries(e).map(([o,l])=>({employee_id:parseInt(t),date:`${p.value}-${String(o).padStart(2,"0")}`,shift_id:l})):[]);try{await D.saveSchedules({payload:s}),alert("Shift schedule saved successfully!")}catch(t){console.error("Failed to save schedule",t),alert("Something went wrong while saving.")}};$(v,async s=>{s&&(await S.fetchEmployee(s),await y.fetchDepartments({companyId:s}),await d.fetchShifts({companyId:s}),j(),await W(s,p.value))}),$(N,async s=>{if(s){const t={companyId:v.value,departmentIds:s?[s]:[]},e=await y.fetchDepartmentEmployee(t);M.value=e,c.value=[],await W(v.value,p.value)}}),$(p,async s=>{s&&(await S.fetchEmployee(v.value),await d.fetchShifts({companyId:v.value}),j(),await W(v.value,s))}),ee(async()=>{await S.fetchCompanies()});const W=async(s,t)=>{try{const e=await D.fetchSchedules({params:{company_id:s,month:t}}),o={};e.forEach(l=>{c.value.push(l.employee_id),i.value=l==null?void 0:l.shift_id;const f=l.employee_id,A=parseInt(l.date.split("-")[2]);o[f]||(o[f]={}),o[f][A]=l.shift_id||"WEEKEND"}),u.value=o}catch(e){console.error("Failed to load schedule data:",e)}};return(s,t)=>(r(),n("div",ue,[a("div",ie,[x(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),class:"p-2 border rounded"},[t[6]||(t[6]=a("option",{value:""},"Select Company",-1)),(r(!0),n(m,null,b(V(q),e=>(r(),n("option",{key:e.id,value:e.id},h(e.name),9,de))),128))],512),[[F,v.value]]),x(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>N.value=e),class:"p-2 border rounded"},[t[7]||(t[7]=a("option",{value:""},"- Department -",-1)),(r(!0),n(m,null,b(V(L),e=>(r(),n("option",{key:e.id,value:e.id},h(e.name),9,ce))),128))],512),[[F,N.value]]),x(a("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.value=e),class:"p-2 border rounded"},[t[8]||(t[8]=a("option",{value:""},"- Shift -",-1)),(r(!0),n(m,null,b(E.value,e=>(r(),n("option",{key:e.id,value:e.id},h(e.name),9,pe))),128))],512),[[F,i.value]]),x(a("input",{type:"month","onUpdate:modelValue":t[3]||(t[3]=e=>p.value=e),class:"p-2 border rounded"},null,512),[[te,p.value]])]),a("div",ve,[(r(!0),n(m,null,b(E.value,e=>(r(),n("div",{key:e.id,class:k(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":i.value===e.id}]),onClick:o=>i.value=e.id},[a("div",{class:k(["w-5 h-5 rounded",w.value[e.id]||"bg-gray-300"])},null,2),a("span",he,h(e.name),1)],10,fe))),128)),a("div",{class:k(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":i.value==="WEEKEND"}]),onClick:t[4]||(t[4]=e=>i.value="WEEKEND")},t[9]||(t[9]=[a("div",{class:"w-5 h-5 rounded bg-red-700"},null,-1),a("span",{class:"text-sm"},"Weekend",-1)]),2)]),a("div",{class:"mb-4 flex gap-4"},[a("button",{onClick:Q,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),a("button",{onClick:X,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),a("div",ge,[a("table",me,[a("thead",be,[a("tr",null,[t[10]||(t[10]=a("th",{class:"border p-2"},"Emp ID",-1)),t[11]||(t[11]=a("th",{class:"border p-2"},"Name",-1)),t[12]||(t[12]=a("th",{class:"border p-2"},"Action",-1)),(r(!0),n(m,null,b(_.value,e=>(r(),n("th",{key:e,class:"border text-center p-1 w-10"},[O(h(e)+" ",1),a("div",ye,h(B(e)),1)]))),128))])]),a("tbody",null,[(r(!0),n(m,null,b(V(M),e=>(r(),n("tr",{key:e.id},[a("td",Se,[x(a("input",{type:"checkbox",class:"mr-2",value:e.id,"onUpdate:modelValue":t[5]||(t[5]=o=>c.value=o)},null,8,we),[[se,c.value]]),O(" "+h(e.code),1)]),a("td",xe,h(e.name),1),a("td",Ee,[a("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:o=>I(e.id)}," Apply to All Dates ",8,_e)]),(r(!0),n(m,null,b(_.value,o=>(r(),n("td",{key:o,class:"border text-center cursor-pointer",onClick:l=>J(e.id,o)},[a("div",{title:H(e.id,o),class:k([G(e.id,o),"w-full h-6"])},null,10,Ce)],8,ke))),128))]))),128))])])]),a("div",{class:"mb-4 mt-4"},[a("button",{onClick:Z,class:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow"}," ðŸ’¾ Save Schedule ")])]))}},Fe=ne(De,[["__scopeId","data-v-8e85260e"]]);export{Fe as default};
