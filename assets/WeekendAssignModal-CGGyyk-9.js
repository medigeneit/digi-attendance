import{Q as q,r as S,q as g,h as M,x as v,y as z,i as Q,o as d,d as I,l as L,c as i,j as O,a as s,T as W,t as u,F as B,e as U,k as C,P as Y,v as G,Y as H,A as E}from"./index-CKfTIQ62.js";import{d as J}from"./dayjs.min-B6dRzZpe.js";import{u as X}from"./user-CNq2jkYV.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},te={class:"relative w-full max-w-xl rounded-2xl bg-white shadow-xl ring-1 ring-black/5 p-5"},se={class:"flex items-start justify-between mb-4"},ne={class:"flex items-center gap-3"},ae={class:"h-10 w-10 rounded-full bg-indigo-100 text-indigo-700 flex items-center justify-center font-semibold"},oe={class:"text-xs text-gray-500"},le={class:"flex flex-col gap-2"},re={class:"rounded-lg border bg-white p-2"},de={class:"flex items-center justify-between"},ie={class:"text-xs text-gray-500"},ce={key:0,class:"text-sm text-gray-500"},ue={key:1,class:"divide-y"},me=["checked"],ve={class:"flex-1"},_e={class:"flex items-center gap-2"},ye={class:"text-sm text-gray-900"},fe={key:0,class:"inline-flex items-center text-xs font-medium rounded-full bg-green-100 text-green-700 px-2 py-0.5"},pe={key:1,class:"inline-flex items-center text-xs font-medium rounded-full bg-gray-100 text-gray-700 px-2 py-0.5"},ge={class:"mt-0.5 text-xs text-gray-600"},he={class:"rounded-lg border bg-white p-4"},ke={class:"grid gap-4 md:grid-cols-12"},xe={class:"md:col-span-12"},be={class:"mt-2 grid grid-cols-2 sm:grid-cols-4 gap-2"},we=["value"],Ae={class:"text-gray-700"},Se={class:"mt-2 flex items-center gap-3"},Ce={class:"text-xs text-gray-500"},je={class:"mt-2"},Te={key:0,class:"text-xs text-blue-600"},Ve={key:1,class:"text-xs text-amber-600"},De={class:"md:col-span-5"},Fe={class:"md:col-span-2 flex items-end"},Me={class:"inline-flex items-center gap-2 select-none mt-1"},Ie={class:"mt-4 flex justify-end gap-2"},Le=["disabled"],Oe=["disabled"],We={key:0},Be={key:1},Ue={__name:"WeekendAssignModal",props:{modelValue:{type:Boolean,default:!1},isOpen:{type:Boolean,default:!1},userId:{type:[Number,String],default:""},userLabel:{type:String,default:""},defaultFrom:{type:String,default:()=>new Date().toISOString().slice(0,7)},defaultTo:{type:String,default:""},assign_weekend:{type:Object,default:null},weekend_assignments:{type:[Object,Array,null],default:null},assign_weekends:{type:Object,default:null}},emits:["update:modelValue","saved","close","update"],setup(A,{emit:N}){const l=A,h=N,_=q(),$=X(),c=S(!1);g(()=>l.modelValue,e=>{e!==c.value&&(c.value=e)}),g(()=>l.isOpen,e=>{e!==c.value&&(c.value=e)}),M(()=>{c.value=!!(l.modelValue||l.isOpen)});const y=S(!1),n=S({weekends:[],start_month:l.defaultFrom,end_month:l.defaultTo,active:!0}),K=v(()=>{var a,m;const e=l.userLabel||String(l.userId||""),t=e.trim().split(/\s+/);return((((a=t[0])==null?void 0:a[0])||"")+(((m=t[1])==null?void 0:m[0])||"")||e[0]||"#").toUpperCase().slice(0,2)});function r(e){return e&&(typeof e=="string"&&/^\d{4}-\d{2}$/.test(e)?e:J(e).format("YYYY-MM"))||""}function j(e){const t=Array.isArray(e==null?void 0:e.weekends)?e.weekends.join(","):"",o=r(e==null?void 0:e.start_month),a=r(e==null?void 0:e.end_month);return`${t||"—"} — ${o||"—"} → ${a||"present"}`}const P=v(()=>{var t;if((t=l.assign_weekends)!=null&&t.history&&Array.isArray(l.assign_weekends.history))return l.assign_weekends.history;const e=l.weekend_assignments??(l.assign_weekend?[l.assign_weekend]:[]);return Array.isArray(e)?e:e?[e]:[]}),f=v(()=>P.value.map(t=>{const o=r(t.start_month),a=r(t.end_month),m=t.active;return{id:t.id??null,weekends:Array.isArray(t.weekends)?t.weekends:[],start_month:o,end_month:a,active:m,label:j(t),created_at:t.created_at?new Date(t.created_at).getTime():0}}).sort((t,o)=>t.active!==o.active?t.active?-1:1:(o.start_month||"").localeCompare(t.start_month||""))),k=v(()=>{var t;const e=((t=l.assign_weekends)==null?void 0:t.current)||null;return e?{id:e.id??null,weekends:Array.isArray(e.weekends)?e.weekends:[],start_month:r(e.start_month),end_month:r(e.end_month),active:!!e.active||!r(e.end_month),label:j(e),created_at:e.created_at?new Date(e.created_at).getTime():0}:f.value.find(o=>o.active)||f.value[0]||null}),x=v(()=>!!k.value&&k.value.active),b=v(()=>{if(!x.value)return!1;const e=k.value,t=(n.value.weekends||[]).slice().sort().join(","),o=(e.weekends||[]).slice().sort().join(",");return t===o&&r(n.value.start_month)===r(e.start_month)&&r(n.value.end_month)===r(e.end_month)}),T=v(()=>{const e=Array.isArray(n.value.weekends)&&n.value.weekends.length>0,t=!!r(n.value.start_month);return!!l.userId&&e&&t&&!y.value&&!b.value});function V(){const e=k.value;e&&(n.value.weekends=Array.isArray(e.weekends)?e.weekends.slice():[],n.value.start_month=r(e.start_month)||l.defaultFrom,n.value.end_month=r(e.end_month)||"")}g(c,(e,t)=>{e&&!t&&E(V)}),g(()=>l.assign_weekends,()=>{c.value&&E(V)},{deep:!0}),g(n,e=>{h("update",{...e})},{deep:!0});function p(){c.value&&(c.value=!1,h("update:modelValue",!1),h("close",!1))}async function D(){var e,t;try{if(!l.userId)return _.error("Employee নির্বাচন করুন");if(!Array.isArray(n.value.weekends)||n.value.weekends.length===0)return _.error("কমপক্ষে একদিন নির্বাচন করুন");if(!r(n.value.start_month))return _.error("Start month নির্বাচন করুন");if(b.value){_.info("এটা ইতিমধ্যেই Active কনফিগের মতোই আছে");return}y.value=!0;const o={weekends:n.value.weekends,start_month:r(n.value.start_month),end_month:r(n.value.end_month)||"",active:!!n.value.active},a=await $.updateOrCreateWeekend(l.userId,o);_.success(x.value?"Reassigned":"Assigned"),h("saved",a),p()}catch(o){const a=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message)||(o==null?void 0:o.message)||"Failed";_.error(a)}finally{y.value=!1}}function F(e){c.value&&(e.key==="Escape"&&p(),(e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==="enter"&&T.value&&D())}M(()=>window.addEventListener("keydown",F)),z(()=>window.removeEventListener("keydown",F));const w=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function R(){(n.value.weekends||[]).length===w.length?n.value.weekends=[]:n.value.weekends=w.slice()}return(e,t)=>(d(),Q(H,{to:"body"},[I(W,{name:"fade"},{default:L(()=>[c.value?(d(),i("div",ee,[s("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:p}),I(W,{name:"pop"},{default:L(()=>{var o;return[s("div",te,[s("div",se,[s("div",ne,[s("div",ae,u(K.value),1),s("div",null,[t[3]||(t[3]=s("h3",{class:"text-base font-semibold text-gray-900"},"Assign Weekends",-1)),s("p",oe,u(A.userLabel||"#"+A.userId),1)])]),s("button",{class:"btn-icon",onClick:p,"aria-label":"Close"},"✕")]),s("div",le,[s("div",re,[s("div",de,[t[4]||(t[4]=s("h4",{class:"text-sm font-semibold text-gray-800"},"Weekend history",-1)),s("span",ie,u(f.value.length)+" item(s)",1)]),f.value.length?(d(),i("ul",ue,[(d(!0),i(B,null,U(f.value,(a,m)=>(d(),i("li",{key:a.id??m,class:"py-2 flex items-start gap-3"},[s("input",{type:"checkbox",class:"mt-1 rounded border-gray-300",checked:a.active,disabled:""},null,8,me),s("div",ve,[s("div",_e,[s("span",ye,u(a.label),1),a.active?(d(),i("span",fe," Active ")):(d(),i("span",pe," Closed "))]),s("div",ge," Period: "+u(a.start_month||"—")+" → "+u(a.end_month||"present"),1)])]))),128))])):(d(),i("div",ce," No assignment history "))]),s("div",he,[s("div",ke,[s("div",xe,[t[5]||(t[5]=s("label",{class:"block text-sm font-medium text-gray-700"},"Weekend Days",-1)),s("div",be,[(d(),i(B,null,U(w,a=>s("label",{key:a,class:"flex items-center gap-2 text-sm"},[C(s("input",{class:"rounded border-gray-300",type:"checkbox",value:a,"onUpdate:modelValue":t[0]||(t[0]=m=>n.value.weekends=m)},null,8,we),[[Y,n.value.weekends]]),s("span",Ae,u(a.slice(0,3).toUpperCase()),1)])),64))]),s("div",Se,[s("button",{type:"button",class:"text-xs px-2 py-1 rounded border hover:bg-gray-50",onClick:R},u((n.value.weekends||[]).length===w.length?"Clear all":"Select all"),1),s("span",Ce," Selected: "+u((n.value.weekends||[]).join(", ")||"—"),1)]),s("div",je,[b.value?(d(),i("p",Te," এই কনফিগ ইতিমধ্যেই active আছে। ")):x.value&&(((o=n.value.weekends)==null?void 0:o.length)||0)>0?(d(),i("p",Ve," Reassign করলে আগের assignment close/update হয়ে নতুনটি save হবে। ")):O("",!0)])]),s("div",De,[t[6]||(t[6]=s("label",{class:"block text-sm font-medium text-gray-700"},"From",-1)),C(s("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>n.value.start_month=a),type:"month",class:"mt-1 w-full rounded-md border px-3 py-2"},null,512),[[G,n.value.start_month]])]),s("div",Fe,[s("label",Me,[C(s("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>n.value.active=a),class:"rounded border-gray-300"},null,512),[[Y,n.value.active]]),t[7]||(t[7]=s("span",{class:"text-sm text-gray-700"},"Active",-1))])])]),s("div",Ie,[s("button",{class:"btn-3",onClick:p,disabled:y.value},"Cancel",8,Le),s("button",{class:"btn-2",onClick:D,disabled:!T.value},[y.value?(d(),i("span",Be,"Processing…")):(d(),i("span",We,u(x.value?b.value?"Assigned":"Reassign":"Assign"),1))],8,Oe)])])])])]}),_:1})])):O("",!0)]),_:1})]))}},Ke=Z(Ue,[["__scopeId","data-v-13441967"]]);export{Ke as S};
