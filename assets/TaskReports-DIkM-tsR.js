import{b as B,e as L,q as N,n as V,c as a,o as n,a as t,t as d,f as P,g as u,k as c,i as A,j as E,F as C,x as D,w as F,y as S,p as M}from"./index-csXJgRRW.js";import{_ as O}from"./UserChip-dPcOf_zH.js";import{g as $}from"./datetime-q3Sn87-f.js";import{u as j}from"./useTaskReportStore-BE47mknp.js";import{u as q}from"./useTaskStore-Bm6Ql-6V.js";const z={class:"mt-4"},I={class:"bg-white"},U={class:"flex mb-2 items-end"},G={class:"overflow-auto w-full"},H={key:0,class:"min-w-full bg-white shadow rounded-lg overflow-hidden"},J={class:"bg-gray-100"},K={key:0,class:"px-4 py-2 text-left md:w-[100px] lg:w-[220px] xl:w-[320px]"},Q={key:0},W=["onClick"],X={class:"px-4 py-2"},Y={key:0,class:"px-4 py-2 font-medium border-r"},Z={key:0,style:{"font-family":"monospace"}},tt={class:"ml-1"},st={class:"ml-1"},et={class:"font-medium py-2 px-4"},ot={class:"border rounded-md bg-gray-50"},nt={class:"text-sm flex items-center px-3 py-3"},at={class:"text-gray-600 text-sm ml-auto whitespace-nowrap"},rt={key:1,class:"text-center border py-4 text-gray-500"},_t={__name:"TaskReports",setup(lt){const m=j(),l=q(),f=B().params.id;L(async()=>{await l.fetchTask(f),await m.fetchTaskReports({task_id:f})});function y(i,s=[]){const r=[];for(const o of i){const p=[...s,o.title];o.children_tasks.length===0?r.push(...o.reports.map(e=>({...e,task_id:o.id,task_title:o.title,task_parents:s,user:o.users.find(_=>_.id===e.user_id)}))):r.push(...y(o.children_tasks,p))}return r}function h(i,s){try{const r=new Date(i.report_date).getTime(),o=new Date(s.report_date).getTime();return o===r?s.id-i.id:o-r}catch{return-1}}const g=N(()=>l.task.children_task_count===0?[...m.task_reports].sort(h):[...y(l.tasks)].sort(h));return(i,s)=>{var o,p;const r=V("RouterLink");return n(),a("div",z,[s[6]||(s[6]=t("hr",{class:"mb-2"},null,-1)),s[7]||(s[7]=t("hr",{class:"mb-2"},null,-1)),t("div",I,[t("pre",null,d(i.usersTaskProgress),1),t("div",U,[s[2]||(s[2]=t("h3",{class:"text-sm font-semibold text-gray-600 uppercase mt-4"},"Task Reports",-1)),c(l).task.children_task_count===0?(n(),P(r,{key:0,to:{name:"TaskReportAdd",params:{id:(o=c(l).task)==null?void 0:o.id}},onClick:s[0]||(s[0]=e=>e.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:A(()=>s[1]||(s[1]=[E("Add Report")])),_:1,__:[1]},8,["to"])):u("",!0)]),t("div",G,[c(m).loading?(n(),a("div",rt,"Loading...")):(n(),a("table",H,[t("thead",J,[t("tr",null,[s[3]||(s[3]=t("th",{class:"px-4 py-2 text-left"},"#",-1)),c(l).task.children_task_count>0?(n(),a("th",K," Task ")):u("",!0),s[4]||(s[4]=t("th",{class:"px-4 py-2 text-left lg:w-[540px]"},"User Report",-1))])]),t("tbody",null,[((p=g.value)==null?void 0:p.length)===0?(n(),a("tr",Q,s[5]||(s[5]=[t("td",{class:"px-4 py-4 font-medium text-gray-500 text-center",colspan:"10"}," NO REPORTS ",-1)]))):u("",!0),(n(!0),a(C,null,D(g.value,(e,_)=>{var x,w,v,b,R;return n(),a("tr",{key:e.id,class:"border-t hover:bg-gray-50 cursor-pointer",onClick:F(T=>i.goToShow(e.id),["prevent"]),role:"button"},[t("td",X,d(_+1),1),c(l).task.children_task_count>0?(n(),a("td",Y,[t("div",null,[(n(!0),a(C,null,D(e.task_parents.reverse(),(T,k)=>(n(),a("div",{key:k,class:S(["text-gray-400 text-sm line-clamp-1",{"-ml-1":k==0}])},[k>0?(n(),a("span",Z,"↳")):u("",!0),t("span",tt,d(T),1)],2))),128)),t("div",null,[((x=e.task_parents)==null?void 0:x.length)>0?(n(),a("span",{key:0,style:{"font-family":"monospace"},class:S({"ml-2":((w=e.task_parents)==null?void 0:w.length)==1,"ml-4":((v=e.task_parents)==null?void 0:v.length)==2,"ml-6":((b=e.task_parents)==null?void 0:b.length)==3,"ml-8":((R=e.task_parents)==null?void 0:R.length)==4})},"↳",2)):u("",!0),t("span",st,d(e.task_title),1)])])])):u("",!0),t("td",et,[t("div",ot,[M(O,{user:e.user,class:"inline-block w-full !rounded-sm"},null,8,["user"]),t("div",nt,[t("div",null,d(e.title),1),t("div",at," on "+d(c($)(e.report_date)),1)])])])],8,W)}),128))])]))])])])}}};export{_t as default};
