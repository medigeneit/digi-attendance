import{u as Q,g as X,r as _,D as Z,x as b,h as ee,q as H,ad as te,p as se,c as m,o as u,a as t,i as ae,d as j,l as le,b as k,w as oe,j as w,k as g,v as D,t as p,F as E,e as F,s as L,m as z,ae as A}from"./index-4cVhF2CH.js";import{L as ne}from"./LoaderView-D_-WElnV.js";import{_ as re}from"./MultiselectDropdown-CHzYLsvH.js";import{u as de}from"./holiday-D17n1v_p.js";import{u as ie}from"./leave-application-DYcPJMfg.js";import{u as ue}from"./leave-type-w_UpwzLh.js";import{u as me}from"./user-DejXXCx-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-OVSySTPn.js";const pe={class:"my-container max-w-4xl space-y-6"},ve={class:"rounded-2xl border border-slate-200 bg-white/80 p-4 shadow-sm md:p-6"},ce={class:"flex flex-wrap items-center justify-between gap-3"},fe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},be={key:0,class:"rounded-lg bg-blue-50 p-3 text-sm text-blue-700"},ge={key:1,class:"grid gap-3 rounded-xl border border-slate-100 bg-slate-50 p-4 sm:grid-cols-2 lg:grid-cols-4"},xe={class:"rounded-lg bg-white p-3 shadow-sm"},we={class:"text-2xl font-semibold text-slate-800"},ye={class:"rounded-lg bg-white p-3 shadow-sm"},_e={class:"text-xl font-semibold text-slate-800"},he={class:"rounded-lg bg-white p-3 shadow-sm"},ke={class:"text-xl font-semibold text-slate-800"},De={class:"rounded-lg bg-white p-3 shadow-sm"},Le={class:"text-xl font-semibold text-amber-600"},Se={key:2,class:"flex items-start gap-3 rounded-lg border border-amber-200 bg-amber-50/80 p-4 text-amber-800 shadow-sm"},Ue={class:"text-sm"},Te={key:3,class:"space-y-4"},Ve={class:"max-h-[28rem] space-y-3 overflow-y-auto pr-1"},Ae={class:"flex flex-wrap items-center justify-between gap-3"},Be={class:"font-semibold text-slate-900"},Me={class:"text-sm text-slate-500"},Ne={class:"mt-3 flex flex-wrap gap-2"},Re=["name","value","onUpdate:modelValue","disabled"],We=["name","onUpdate:modelValue"],Ce=["name","onUpdate:modelValue"],He={class:"space-y-1"},je={class:"space-y-1"},Ee={class:"space-y-1"},Fe={key:4,class:"flex items-start gap-3 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700 shadow-sm"},ze={class:"flex-1 text-sm leading-5"},$e={class:"mt-0.5"},Ze={__name:"LeaveApplicationAdd",setup(qe){const B=Q(),$=ie(),i=X();ue();const f=me(),M=de(),S=_(""),{userLeaveBalance:y}=Z(f),d=_({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),n=_([]),U=_(!1),h=_(null),T=b(()=>{const s={};return n.value.forEach(e=>{typeof e=="number"&&(s[e]=(s[e]||0)+1)}),s}),V=s=>{const e=Number(s==null?void 0:s.remaining_days);return Number.isFinite(e)?e:1/0},N=b(()=>{var s;return(s=y.value)!=null&&s.length?y.value.map(e=>{const r=T.value[e.id]||0,o=V(e);return{id:e.id,name:e.name,used:r,remain:o}}).filter(e=>e.remain!==1/0&&e.used>e.remain):[]}),R=b(()=>N.value.length?`You have exceeded remaining days for: ${N.value.map(e=>e.name).join(", ")}`:""),x=b(()=>{const s=v.value.length;if(!s)return{total:0,weekends:0,holidays:0,assigned:0,pending:0};let e=0,r=0,o=0;n.value.forEach(l=>{l==="weekend"?e+=1:l==="holiday"?r+=1:l&&(o+=1)});const a=Math.max(s-(e+r+o),0);return{total:s,weekends:e,holidays:r,assigned:o,pending:a}}),q=s=>new Date(s).toLocaleString("en-us",{weekday:"long"}),I=s=>{const e=y.value.find(r=>r.id===s);return(e==null?void 0:e.name)||""},P=s=>{const e=V(s);if(e===1/0)return"∞";const r=T.value[s.id]||0;return Math.max(e-r,0)},W=(s,e)=>{const r=V(s);return r===1/0||e===s.id?!1:(T.value[s.id]||0)>=r};ee(async()=>{var s;try{(s=i==null?void 0:i.user)!=null&&s.id&&f.userLeaveBalance.length===0&&await f.fetchUserLeaveBalances(i.user.id),await f.fetchTypeWiseEmployees({except:"auth"})}catch(e){console.error("Error while initializing leave form:",e)}}),H(()=>{var s;return(s=i.user)==null?void 0:s.id},async s=>{s&&f.userLeaveBalance.length===0&&await f.fetchUserLeaveBalances(s)});const Y=b(()=>{var s,e,r;return((e=(s=i==null?void 0:i.user)==null?void 0:s.assign_weekend)==null?void 0:e.weekends)||((r=i==null?void 0:i.user)==null?void 0:r.weekends)}),v=b(()=>{const s=d.value.last_working_date,e=d.value.resumption_date;if(!s||!e)return[];const r=new Date(s),o=new Date(e);if(o<=r)return[];const a=[];let l=new Date(r);for(l.setDate(l.getDate()+1);l<o;){const c=l.getFullYear(),G=(l.getMonth()+1).toString().padStart(2,"0"),K=l.getDate().toString().padStart(2,"0");a.push(`${c}-${G}-${K}`),l.setDate(l.getDate()+1)}return a}),C=b(()=>{const s=d.value.last_working_date,e=d.value.resumption_date;if(!s||!e)return"";const r=new Date(s);return new Date(e)<=r?"Resumption date must be after Last Working Date.":v.value.length===0?"No leave days between the selected dates.":null});te(async()=>{var s;v.value.length&&y.value.length&&(await M.fetchHolidays({company_id:(s=i==null?void 0:i.user)==null?void 0:s.company_id,start_date:v.value[0],end_date:v.value[v.value.length-1]}),v.value.forEach(async(e,r)=>{const o=new Date(e).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),a=o.charAt(0).toUpperCase()+o.slice(1);Y.value.includes(a)&&(n.value[r]="weekend"),M.holidayDates.includes(e)&&(n.value[r]="holiday")}))}),H(()=>S.value,s=>{d.value.handover_user_id=s==null?void 0:s.id});const J=async()=>{var s;U.value=!0,h.value=null;try{const e=v.value.map((l,c)=>({date:l,leave_type_id:n.value[c]!=="weekend"&&n.value[c]!=="holiday"?n.value[c]:null})).filter(l=>l.leave_type_id!==null),r=v.value.map((l,c)=>({date:l,leave_type_id:n.value[c]||""})).filter(l=>l.leave_type_id!==null),o={user_id:(s=i==null?void 0:i.user)==null?void 0:s.id,last_working_date:d.value.last_working_date,resumption_date:d.value.resumption_date,reason:d.value.reason,works_in_hand:d.value.works_in_hand,handover_user_id:d.value.handover_user_id,leave_days:e,json_data:r},a=await $.storeLeaveApplication(o);a&&B.push({name:"LeaveApplicationShow",params:{id:a==null?void 0:a.id}})}catch(e){h.value=e.message||"Failed to submit leave application"}finally{U.value=!1}},O=()=>{B.go(-1)};return(s,e)=>{const r=se("RouterLink");return u(),m("div",pe,[t("section",ve,[t("div",ce,[t("button",{class:"btn-3",onClick:O},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=t("div",{class:"text-center"},[t("h1",{class:"title-md md:title-lg"},"Leave Application"),t("p",{class:"text-xs text-slate-500 md:text-sm"}," Pick your dates, assign leave types, and tell us who is covering while you’re away. ")],-1)),j(r,{to:"/applications",class:"btn-2"},{default:le(()=>e[6]||(e[6]=[k("Home")])),_:1,__:[6]})])]),U.value?(u(),ae(ne,{key:0})):(u(),m("form",{key:1,onSubmit:oe(J,["prevent"]),class:"relative space-y-6 rounded-2xl border border-slate-200 bg-white/80 p-4 pb-24 shadow-lg md:p-8 md:pb-28"},[t("div",fe,[t("div",null,[e[8]||(e[8]=t("label",{for:"last-working-date",class:"block text-sm font-medium text-slate-600"},"Last Working Date",-1)),g(t("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=o=>d.value.last_working_date=o),class:"input-1 mt-1 w-full",required:""},null,512),[[D,d.value.last_working_date]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"resumption-date",class:"block text-sm font-medium text-slate-600"},"Resumption Date",-1)),g(t("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=o=>d.value.resumption_date=o),class:"input-1 mt-1 w-full",required:""},null,512),[[D,d.value.resumption_date]])])]),d.value.last_working_date&&d.value.resumption_date&&C.value?(u(),m("div",be,p(C.value),1)):w("",!0),x.value.total?(u(),m("div",ge,[t("div",xe,[e[10]||(e[10]=t("p",{class:"text-xs uppercase text-slate-400"},"Total Days",-1)),t("p",we,p(x.value.total),1)]),t("div",ye,[e[11]||(e[11]=t("p",{class:"text-xs uppercase text-slate-400"},"Assigned",-1)),t("p",_e,p(x.value.assigned),1),e[12]||(e[12]=t("p",{class:"text-xs text-slate-500"},"Leave types selected",-1))]),t("div",he,[e[13]||(e[13]=t("p",{class:"text-xs uppercase text-slate-400"},"Weekend / Holiday",-1)),t("p",ke,p(x.value.weekends+x.value.holidays),1),e[14]||(e[14]=t("p",{class:"text-xs text-slate-500"},"Auto-excluded",-1))]),t("div",De,[e[15]||(e[15]=t("p",{class:"text-xs uppercase text-slate-400"},"Still Unassigned",-1)),t("p",Le,p(x.value.pending),1),e[16]||(e[16]=t("p",{class:"text-xs text-slate-500"},"Select a leave type below",-1))])])):w("",!0),R.value?(u(),m("div",Se,[e[17]||(e[17]=t("i",{class:"fas fa-info-circle mt-1 text-amber-500"},null,-1)),t("p",Ue,p(R.value),1)])):w("",!0),v.value.length?(u(),m("div",Te,[e[20]||(e[20]=t("div",{class:"flex flex-wrap items-center justify-between gap-2"},[t("h2",{class:"text-lg font-semibold text-slate-700"},"Leave Days"),t("p",{class:"text-xs text-slate-500"},"Tap a badge to classify each date")],-1)),t("div",Ve,[(u(!0),m(E,null,F(v.value,(o,a)=>(u(),m("div",{key:a,class:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm transition hover:border-blue-200 hover:shadow-md"},[t("div",Ae,[t("div",null,[t("p",Be,p(o),1),t("p",Me,p(q(o)),1)]),n.value[a]?(u(),m("span",{key:0,class:L(["inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold",{"bg-amber-50 text-amber-700":n.value[a]==="weekend","bg-emerald-50 text-emerald-700":n.value[a]==="holiday","bg-blue-50 text-blue-700":n.value[a]!=="weekend"&&n.value[a]!=="holiday"}])},p(n.value[a]==="weekend"?"Weekend":n.value[a]==="holiday"?"Holiday":I(n.value[a])),3)):w("",!0)]),t("div",Ne,[(u(!0),m(E,null,F(z(y),l=>(u(),m("label",{key:l.id,class:L(["cursor-pointer rounded-full border px-3 py-1 text-sm font-medium transition",[n.value[a]===l.id?"border-blue-500 bg-blue-50 text-blue-700":"border-slate-200 text-slate-600",W(l,n.value[a])?"cursor-not-allowed opacity-40":""]])},[g(t("input",{type:"radio",class:"sr-only",name:"leaveType-"+a,value:l.id,"onUpdate:modelValue":c=>n.value[a]=c,disabled:W(l,n.value[a])},null,8,Re),[[A,n.value[a]]]),t("span",null,p(l.name)+" ("+p(P(l))+")",1)],2))),128)),t("label",{class:L(["cursor-pointer rounded-full px-3 py-1 text-sm font-medium transition",n.value[a]==="weekend"?"border-amber-400 bg-amber-50 text-amber-700":"border-slate-200 text-slate-600 hover:border-amber-200 hover:text-amber-700"])},[g(t("input",{type:"radio",class:"sr-only",name:"leaveType-"+a,value:"weekend","onUpdate:modelValue":l=>n.value[a]=l},null,8,We),[[A,n.value[a]]]),e[18]||(e[18]=k(" Weekend "))],2),t("label",{class:L(["cursor-pointer rounded-full px-3 py-1 text-sm font-medium transition",n.value[a]==="holiday"?"border-emerald-400 bg-emerald-50 text-emerald-700":"border-slate-200 text-slate-600 hover:border-emerald-200 hover:text-emerald-700"])},[g(t("input",{type:"radio",class:"sr-only",name:"leaveType-"+a,value:"holiday","onUpdate:modelValue":l=>n.value[a]=l},null,8,Ce),[[A,n.value[a]]]),e[19]||(e[19]=k(" Holiday "))],2)])]))),128))])])):w("",!0),t("div",He,[e[21]||(e[21]=t("label",{for:"reason",class:"text-sm font-medium text-slate-600"},"Reason",-1)),g(t("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=o=>d.value.reason=o),class:"input-1 w-full",placeholder:"Let approvers know why you need the time off",rows:"3"},null,512),[[D,d.value.reason]])]),t("div",je,[e[22]||(e[22]=t("label",{for:"handover-user",class:"text-sm font-medium text-slate-600"},"Handover User",-1)),j(re,{modelValue:S.value,"onUpdate:modelValue":e[3]||(e[3]=o=>S.value=o),options:z(f).users,multiple:!1,label:"label",placeholder:"Search teammate",class:"z-50"},null,8,["modelValue","options"])]),t("div",Ee,[e[23]||(e[23]=t("label",{for:"works-in-hand",class:"text-sm font-medium text-slate-600"},"Works in Hand",-1)),g(t("textarea",{id:"works-in-hand","onUpdate:modelValue":e[4]||(e[4]=o=>d.value.works_in_hand=o),class:"input-1 w-full",placeholder:"Share current deliverables so the team has context",rows:"6"},null,512),[[D,d.value.works_in_hand]])]),h.value?(u(),m("div",Fe,[e[25]||(e[25]=t("div",{class:"flex-shrink-0"},[t("i",{class:"fas fa-exclamation-triangle text-red-500"})],-1)),t("div",ze,[e[24]||(e[24]=t("p",{class:"font-medium"},"Something went wrong!",-1)),t("p",$e,p(h.value),1)])])):w("",!0),e[26]||(e[26]=t("div",{class:"sticky inset-x-0 bottom-0 -mx-4 flex justify-end border-t border-slate-100 bg-white/95 px-4 py-4 backdrop-blur supports-[backdrop-filter]:bg-white/80 md:-mx-8 md:px-8"},[t("button",{type:"submit",class:"btn-2 inline-flex items-center gap-2 shadow-md"},[t("i",{class:"far fa-paper-plane"}),k(" Submit Application ")])],-1))],32))])}}};export{Ze as default};
