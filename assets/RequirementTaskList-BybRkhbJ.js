import{L as re}from"./LoaderView-DDXWKQLM.js";import{O as R}from"./OverlyModal-JboUTC0U.js";import{_ as j}from"./DepartmentChip-BDF3eRut.js";import{d as Y,b as U}from"./datetime-DcVwRp76.js";import{_ as ae,T as ie}from"./TaskTreeChildrenTable-AkLRZxMu.js";import{r as I,A as Z,c as i,o as s,a as e,x as P,g as l,t as c,j as O,k as f,p as g,i as N,L as oe,m as z,F as S,y as D,f as h,w as V,b as le,u as ne,z as X,e as de,I as ue}from"./index-CAZwLrDE.js";import{_ as ce}from"./TaskAddForm-D2JhCE9E.js";import{_ as me}from"./TaskEditForm-BsbL8S_-.js";import{_ as pe}from"./TaskHeader-DkEwvEfs.js";import{_ as ye}from"./TaskUserAssignForm-Dg4ARYXH.js";import{u as fe}from"./task-priority-EUo_esif.js";import{u as ge}from"./useRequirementStore-78Mjn-4h.js";import{u as xe}from"./useTaskStore-nQWaA1br.js";import{_ as ke,T as _e,b as ve,a as be}from"./TaskUrgentBadge-yNlWUaqg.js";import{_ as he}from"./TaskAssignedUsers-DvilpaNE.js";import{_ as we}from"./TaskStatus-DrrCnWdW.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./url-CePbr-gY.js";import"./RequiredIcon-Du_duXrH.js";import"./company-T9zFlrau.js";import"./CompanyDepartmentSelectInput-CnrtHMOM.js";import"./SelectDropdown-CHJVHsyI.js";import"./SectionLoading-DTgCsCog.js";import"./TextWithHr-BOdx_yTr.js";import"./TaskUrgencyInput-8wq7t-PP.js";import"./tags-BeztJfCB.js";import"./MultiselectDropdown-MPBX8Gga.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-h9Ar8MUW.js";import"./task-DVDFeGMt.js";import"./EmployeeDropdownInput-CKqfxKGJ.js";import"./UserChip-mIL4HTeU.js";import"./SearchInput-D08WOpXB.js";import"./user-F0URA9jX.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-Bt15c6_E.js";import"./TaskUserChip-BpAe_oqU.js";import"./requirement-COIkCxRL.js";const Te={class:"flex-grow rounded overflow-y-auto"},$e={class:"items-start group"},Ce={class:"flex items-start justify-between w-full gap-4"},Ie={class:"flex gap-2 flex-grow items-center"},qe={key:0,class:"text-xl font-semibold text-blue-500"},Le={class:"font-semibold text-blue-800 line-clamp-1"},Ae={class:"flex items-center justify-between gap-16 w-full"},Se={class:"flex-shrink-0 flex items-center gap-6"},Be={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Me={class:"text-xs text-gray-400 whitespace-nowrap"},De={class:"flex items-center gap-2"},ze={class:"ml-0 col-span-full"},Ee={__name:"RequirementDetailItemWithTaskList",props:{detail:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number,default:0}},emits:["commentButtonClick","editClick","taskAddClick","employeeAssignClick"],setup(o,{emit:b}){const k=b;function d(n){k("editClick",n)}function B(n){k("employeeAssignClick",n)}const u=I([]),_=localStorage.getItem("sub_task_opened_list");if(_)try{u.value=JSON.parse(_)}catch{u.value=[]}return Z(u,n=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(n))},{deep:!0}),(n,x)=>{var a,T,t,$;return s(),i("div",{class:P(["flex w-full text-gray-800 bg-white",{"border-blue-500":o.index%2===0,"border-purple-500":o.index%2===1}])},[e("div",Te,[e("div",$e,[e("div",{class:P(["task-details py-3 shadow-slate-100 flex flex-wrap z-30 pl-3",{"shadow-sm":o.treeLevel>0}])},[e("div",Ce,[e("div",Ie,[o.index!==void 0?(s(),i("div",qe,c(o.index+1)+". ",1)):l("",!0),e("div",Le,c(o.detail.title),1)])]),e("div",Ae,[e("div",Se,[e("div",Be,[e("div",Me,[x[0]||(x[0]=e("i",{class:"fas fa-clock"},null,-1)),O(" "+c(f(Y)((T=(a=o.detail)==null?void 0:a.requirement)==null?void 0:T.submission_date)),1)])]),e("div",De,[x[1]||(x[1]=e("span",{class:"text-sm text-gray-600"},"From",-1)),g(j,{department:(t=o.detail.requirement)==null?void 0:t.from_department},null,8,["department"]),x[2]||(x[2]=e("span",{class:"text-sm text-gray-600"},"To",-1)),g(j,{department:($=o.detail.requirement)==null?void 0:$.to_department},null,8,["department"])])])])],2),e("div",ze,[g(ae,{childrenTasks:o.detail.tasks,parentTask:{},isMyTask:o.isMyTask,"hide-buttons":o.hideButtons,"hide-assigned-users":o.hideAssignedUsers,"parent-tree-level":o.treeLevel,onEditClick:d,onEmployeeAssignClick:B,class:"*:mb-0",taskLinkTo:v=>({name:"RequirementTaskShow",params:{id:(v==null?void 0:v.id)||0}})},{"tree-item-end":N(({task:v,level:q})=>[oe(n.$slots,"item-end",{level:q,task:v})]),_:3},8,["childrenTasks","isMyTask","hide-buttons","hide-assigned-users","parent-tree-level","taskLinkTo"])])])])],2)}}},Oe={class:"w-full"},Ne={key:0,class:"w-full"},je={class:"border-y text-center py-2 px-1 border-gray-200"},Pe={key:0,class:"text-base font-semibold text-purple-600"},Fe={class:"border px-3 py-1 border-gray-200 relative"},Re={class:"flex items-center justify-between gap-2"},Ue={class:"flex items-center gap-3"},Ve={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},He={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},Je={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ke={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},We={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},Qe=["href","onClick"],Xe={class:"border px-3 py-1 border-gray-200"},Ye={class:"flex gap-2 justify-between items-center relative w-full"},Ze={class:"shrink-0"},Ge=["href","onClick"],et={class:"border px-3 py-1 border-gray-200 text-center"},tt={key:0,class:"text-gray-500 text-sm"},st={class:"font-semibold text-blue-800 whitespace-nowrap"},rt={class:"border px-3 py-1 border-gray-200 text-center"},at={key:0,class:"ml-4 text-gray-500 text-sm"},it={class:"text-blue-500 font-semibold whitespace-nowrap"},ot={class:"border px-3 py-1 border-gray-200 text-center"},lt={key:0,class:"text-gray-500 text-sm whitespace-nowrap"},nt={class:"font-semibold text-blue-800"},dt={class:"border-y px-3 border-gray-200 sticky right-0 border-l bg-sky-50"},ut={class:"flex justify-end flex-wrap gap-2 py-2"},ct={class:"flex gap-1 items-center text-sm mb-2"},mt={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick"],setup(o,{emit:b}){const k=o,d=I(!1),B=z(()=>d.value?k.tasks:k.tasks.slice(0,k.maxItem)),u=z(()=>d.value?[]:k.tasks.slice(k.maxItem));function _(){d.value=!d.value}const n=b;return(x,a)=>{var T;return s(),i("div",Oe,[((T=o.tasks)==null?void 0:T.length)>0?(s(),i("table",Ne,[a[5]||(a[5]=e("thead",null,[e("tr",null,[e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Date "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Started "),e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(s(!0),i(S,null,D(B.value,(t,$)=>{var v,q;return s(),i("tr",{key:t.id,class:P(["group/sub-task-row",{" bg-green-400/20":t.status=="COMPLETED"," bg-white hover:bg-slate-50":t.status!=="COMPLETED"}])},[e("td",je,[$!==void 0?(s(),i("div",Pe,c($+1)+". ",1)):l("",!0)]),e("td",Fe,[e("div",Re,[e("div",null,[e("div",Ue,[g(ke,{titleClass:"text-sm",task:t,"sub-tasks-open":!1,isMyTask:o.isMyTask,to:o.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",Ve,[e("div",He,[a[0]||(a[0]=e("i",{class:"fas fa-clock"},null,-1)),O(" "+c(f(Y)(t.created_at)),1)]),e("div",Je,[t!=null&&t.is_important?(s(),h(_e,{key:0})):l("",!0),t!=null&&t.is_urgent?(s(),h(ve,{key:1})):l("",!0)]),e("div",Ke,[a[1]||(a[1]=e("i",{class:"fas fa-tasks"},null,-1)),O(" "+c(t==null?void 0:t.todos_count),1)]),e("div",We,[a[2]||(a[2]=e("i",{class:"fas fa-book"},null,-1)),O(" "+c((v=t==null?void 0:t.requirement_detail)==null?void 0:v.id),1)])])]),!t.is_closed&&!o.hideButtons?(s(),i("a",{key:0,href:`/tasks/edit/${t.id}`,onClick:V(L=>n("editClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},a[3]||(a[3]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Qe)):l("",!0)])]),e("td",Xe,[e("div",Ye,[g(he,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:t.users||[],isTargetTask:t.is_target,maxItem:1,"route-to":L=>`/tasks?status=not-completed&view=userwise&user-ids=${L.id}`},null,8,["users","isTargetTask","route-to"]),e("div",Ze,[!t.is_closed&&!o.hideButtons?(s(),i("a",{key:0,href:`/tasks/${t.id}/assign-users`,onClick:V(L=>n("employeeAssignClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},a[4]||(a[4]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,Ge)):l("",!0)])])]),e("td",et,[t.assigned_at?(s(),i("span",tt,[e("span",st,c(f(U)(t.assigned_at)),1)])):l("",!0)]),e("td",rt,[t.deadline?(s(),i("span",at,[e("span",it,c(f(U)(t.deadline)),1)])):l("",!0)]),e("td",ot,[t.started_at?(s(),i("span",lt,[e("span",nt,c(f(U)(t.started_at)),1)])):l("",!0)]),e("td",dt,[e("div",ut,[t.closed_at?(s(),h(ie,{key:0})):l("",!0),g(we,{status:t==null?void 0:t.status,progressPercent:(t==null?void 0:t.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((q=t==null?void 0:t.children_tasks)==null?void 0:q.length)>0?(s(),h(be,{key:1,ref_for:!0,ref:"progress",task:t,class:"text-sm w-full"},null,8,["task"])):l("",!0)])])],2)}),128))])])):l("",!0),e("div",ct,[o.tasks.length>0?(s(),i(S,{key:0},[u.value.length>0||d.value?(s(),i("button",{key:0,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border ml-2 mt-2 sticky left-2",onClick:V(_,["prevent","stop"])}," +"+c(u.value.length)+" "+c(d.value?"Show Less":"Show All"),1)):l("",!0)],64)):l("",!0)])])}}},pt={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},yt={class:"mb-4"},ft={key:4,class:"text-center py-4 text-red-500"},gt={class:"relative min-h-[20vh]"},xt={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},kt={class:"font-semibold flex items-center gap-2"},_t={class:"text-white text-base"},vt={class:"rounded-b-md p-3"},bt={class:"space-y-3"},ht={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},wt={class:"font-semibold flex items-center gap-2"},Tt={class:"rounded-b-md overflow-y-auto"},$t={class:"space-y-3"},Ct={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},ds={__name:"RequirementTaskList",setup(o){const b=xe(),k=ge(),d=le(),B=ne(),u=I(""),_=I(null),n=I(!1),x=X({parentId:0,requirementId:0}),a=X({taskId:0,isOpen:!1}),T=z(()=>[]),t=z(()=>(b.tasks||[]).reduce((m,r)=>{const C=`${r.from_department_id}-${r.to_department_id}`,w=m.find(E=>E.key==C);return w?w.tasks=[...w.tasks,r]:m.push({key:C,from_department:r.from_department,to_department:r.to_department,tasks:[r]}),m},[])),$=I(null),v=I([]),{saveTaskPriority:q,listHasRearranged:L}=fe(()=>b.taskListTree,0);de(()=>{console.log("Task List Mounted"),u.value="loading",A()});async function A(){await b.fetchAllTasks({...d.query,page:1}),u.value="",v.value=[]}const F=m=>{n.value=!0,x.parentId=m},H=m=>{a.taskId=m,a.isOpen=!0};async function J(){_.value=null,n.value=!1,x.parentId=0,u.value="loading",await A()}async function G(){n.value=!1,x.parentId=0,await A()}async function ee(){u.value="loading",await q()&&await A()}function te(m){return k.requirementDetails.filter(r=>(r.tasks||[]).some(C=>(C.users||[]).some(w=>w.id===m)))}Z(()=>({...d.query}),async()=>{try{b.resetTaskList(),u.value="loading",await A()}catch(m){console.warn(m)}});const K=z({get(){return{...d.query}},set(m){localStorage.removeItem("sub_task_opened_list"),B.push({query:{...m}})}});return(m,r)=>{var C,w,E,W,Q;return s(),i("div",pt,[_.value?(s(),h(R,{key:0},{default:N(()=>[g(me,{taskId:_.value,onClose:r[0]||(r[0]=p=>_.value=null),onUpdated:J},null,8,["taskId"])]),_:1})):l("",!0),n.value?(s(),h(R,{key:1},{default:N(()=>[g(ce,{parentTaskId:x.parentId,requirementId:x.requirementId,onClose:G,onTaskCreated:J},null,8,["parentTaskId","requirementId"])]),_:1})):l("",!0),a.isOpen?(s(),h(R,{key:2,class:"*:max-w-4xl"},{default:N(()=>[g(ye,{taskId:a.taskId,onCancelClick:r[1]||(r[1]=()=>{a.isOpen=!1,a.taskId=0}),onSuccess:r[2]||(r[2]=()=>{a.isOpen=!1,a.taskId=0,u.value="loading",A()})},null,8,["taskId"])]),_:1})):l("",!0),g(pe,{modelValue:K.value,"onUpdate:modelValue":r[3]||(r[3]=p=>K.value=p),onClickAddTask:F,onClickPrioritySave:ee,onClickPriorityDiscard:r[4]||(r[4]=()=>f(L)?$.value.resetItems:null),"list-has-rearranged":f(L),isMyTask:f(d).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((w=(C=f(d))==null?void 0:C.query)==null?void 0:w["query-log"])=="true"?(s(!0),i(S,{key:3},D(v.value,(p,y)=>(s(),i("div",{key:y,class:"text-xs text-gray-500"},[e("div",yt,c(p.raw_query),1)]))),128)):l("",!0),f(k).error?(s(),i("div",ft,c(f(k).error),1)):l("",!0),e("div",gt,[((E=f(d).query)==null?void 0:E.view)==="userwise"?(s(!0),i(S,{key:0},D(T.value,p=>(s(),i("div",{key:p.id,class:"my-4 rounded-md border-2 border-sky-300"},[e("div",xt,[e("div",kt,[g(ue,{user:p},null,8,["user"]),e("div",_t,c(p.label),1)])]),e("div",vt,[e("div",bt,[(s(!0),i(S,null,D(te(p.id),(y,se)=>(s(),h(Ee,{key:y.id,index:se,detail:y,onEditClick:r[5]||(r[5]=M=>_.value=M),onAddClick:r[6]||(r[6]=M=>F(M)),onEmployeeAssignClick:r[7]||(r[7]=M=>H(M)),class:"border rounded-md"},null,8,["index","detail"]))),128))])])]))),128)):(s(!0),i(S,{key:1},D(t.value,p=>(s(),i("div",{key:p.key,class:"my-4 rounded-md border-2 border-sky-300"},[e("div",ht,[e("div",wt,[g(j,{department:p.from_department},null,8,["department"]),g(j,{department:p.to_department},null,8,["department"])])]),e("div",Tt,[e("div",$t,[g(mt,{tasks:p.tasks,onEditClick:r[8]||(r[8]=y=>_.value=y),onAddClick:r[9]||(r[9]=y=>F(y)),onEmployeeAssignClick:r[10]||(r[10]=y=>H(y)),taskLinkTo:y=>({name:"RequirementTaskShow",params:{id:(y==null?void 0:y.id)||0}})},null,8,["tasks","taskLinkTo"])])])]))),128)),u.value!=="loading"&&((W=f(b).tasks)==null?void 0:W.length)===0?(s(),i("div",Ct," No tasks ")):l("",!0),u.value==="loading"?(s(),h(re,{key:3,class:P(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((Q=f(b).tasks)==null?void 0:Q.length)===0?"justify-center":""]])},null,8,["class"])):l("",!0)])])}}};export{ds as default};
