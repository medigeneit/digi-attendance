import{r as g,e as z,A,m as B,c as y,o as u,a as t,f as S,g as k,w as C,F as j,p as f,h as I,v as E,k as b,t as V,i as F,j as T,x as L,b as R,u as O}from"./index-N5qm6zD4.js";import{_ as U}from"./CompanyDepartmentSelectInput-PLO2PGWt.js";import{R as q}from"./RequiredIcon-Ca6OFI22.js";import{f as W,u as G}from"./requirement-Xshz1jF2.js";import{u as H}from"./company-y43Ahk5c.js";import{u as J}from"./tags-BX3MaH7t.js";import{L as K}from"./LoaderView-lEtf3S4b.js";import{S as P}from"./SelectDropdown-DgVwy3fs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"sticky top-0 pt-4 bg-white z-10"},X={class:"mb-4"},Y={class:"mb-4"},Z={class:"mb-4"},h={key:0,class:"mb-4"},ee={class:"border rounded px-2 py-1 text-gray-600 bg-gray-50"},te={class:"block text-gray-600 text-sm mb1 font-medium"},ae={class:"block text-gray-600 text-sm mb-1 font-medium"},se={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},oe={class:"flex items-center justify-between gap-4"},re=["disabled"],ie={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(D,{emit:_}){const v=D,c=_,m=J(),l=H(),o=g(""),w=g(),x=g(""),M=g(),s=g({from_department_id:"",to_department_id:"",website_tags:[]});z(async()=>{var a;o.value="loading",m.fetchTags("website"),await l.fetchCompanies({with:"departments",ignore_permission:!0}),await l.fetchMyCompanies({with:"departments"}),w.value=(a=(await W(v.requirementId)).data)==null?void 0:a.requirement,o.value=""}),A(w,function(a){var e;a&&(s.value.title=a.title,s.value.description=a.description,s.value.from_department_id=a.from_department_id,s.value.to_department_id=a.to_department_id,Array.isArray(a==null?void 0:a.website_tags)&&((e=a.website_tags)==null?void 0:e.length)>0&&(s.value.website_tags=a.website_tags.map(n=>n.name)))});async function N(){var e,n,p,d;o.value="submitting";const a={...s.value};console.log({payload:a});try{const r=await G(v.requirementId,a);c("update",r),o.value="created",x.value=(e=r==null?void 0:r.data)==null?void 0:e.message}catch(r){c("error",(n=r==null?void 0:r.response)==null?void 0:n.data),x.value=(d=(p=r==null?void 0:r.response)==null?void 0:p.data)==null?void 0:d.message,o.value="error"}}const $=B(()=>{var a,e;for(let n in l.myCompanies)if((((e=(a=l==null?void 0:l.myCompanies)==null?void 0:a[n])==null?void 0:e.departments)||[]).some(d=>d.id==s.value.from_department_id))return!0;return!1});return(a,e)=>{var n,p,d,r;return u(),y("div",{ref_key:"containerRef",ref:M,class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[t("div",Q,[e[7]||(e[7]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[8]||(e[8]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=C(i=>c("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),t("form",{onSubmit:C(N,["prevent"]),class:"z-0"},[o.value!=="loading"&&o.value!=="submitting"?(u(),y(j,{key:0},[t("div",X,[e[9]||(e[9]=t("label",{class:"text-gray-800"},"Title",-1)),I(t("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>s.value.title=i),required:"",placeholder:"Ender Requirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[E,s.value.title]])]),t("div",Y,[e[10]||(e[10]=t("label",{class:"text-gray-800"},"Description",-1)),I(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=i=>s.value.description=i),placeholder:"Ender Requirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[E,s.value.description]])]),t("div",Z,[e[11]||(e[11]=t("label",{class:"text-gray-800"},"Websites",-1)),f(P,{options:b(m).tags,modelValue:s.value.website_tags,"onUpdate:modelValue":e[3]||(e[3]=i=>s.value.website_tags=i),taggable:"",label:"name",value:"name",class:"py-2"},null,8,["options","modelValue"])]),$.value?(u(),S(U,{key:1,modelValue:s.value.from_department_id,"onUpdate:modelValue":e[4]||(e[4]=i=>s.value.from_department_id=i),companies:((d=b(l))==null?void 0:d.myCompanies)||[],class:"mb-4"},{label:F(()=>[t("label",te,[e[13]||(e[13]=T(" From Department ")),f(q)])]),_:1},8,["modelValue","companies"])):(u(),y("div",h,[e[12]||(e[12]=t("label",{class:"block text-gray-600 text-sm mb1 font-medium"}," From Department ",-1)),t("div",ee,V((p=(n=w.value)==null?void 0:n.from_department)==null?void 0:p.name),1)])),f(U,{modelValue:s.value.to_department_id,"onUpdate:modelValue":e[5]||(e[5]=i=>s.value.to_department_id=i),companies:((r=b(l))==null?void 0:r.companies)||[],class:"mb-4"},{label:F(()=>[t("label",ae,[e[14]||(e[14]=T(" To Department ")),f(q)])]),_:1},8,["modelValue","companies"])],64)):k("",!0),t("div",se,[x.value?(u(),y("div",{key:0,class:L(["mb-4 font-medium text-center",{"text-red-500":o.value=="error","text-green-500":o.value=="created"}])},V(x.value),3)):k("",!0),t("div",oe,[t("button",{type:"button",onClick:e[6]||(e[6]=C(i=>c("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),t("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},V(o.value=="submitting"?"Saving...":"Save"),9,re)])])],32),o.value==="loading"||o.value==="submitting"?(u(),S(K,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):k("",!0)],512)}}},ne={class:"container mx-auto p-6"},ye={__name:"RequirementEdit",setup(D){const _=R(),v=O();return(c,m)=>(u(),y("div",ne,[f(ie,{requirementId:b(_).params.id,onUpdate:m[0]||(m[0]=()=>b(v).back()),onCancelClick:m[1]||(m[1]=()=>b(v).back())},null,8,["requirementId"])]))}};export{ye as default};
