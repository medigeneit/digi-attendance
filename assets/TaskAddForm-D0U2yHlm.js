import{s as z,r as C,q as A,A as h,e as O,c as a,o as l,a as t,m as G,f as g,w as B,h as p,n as u,t as c,g as i,l as f,v as S,F as _,C as E,x as I,D as V,y as P}from"./index-HETKnDfN.js";import{R as x}from"./RequiredIcon-BfuKXtAD.js";import{u as j}from"./company-Dr0zwlhQ.js";import{u as K}from"./useRequirementStore-DJ0zJYj-.js";import{u as $}from"./useTaskStore-C89fc1Zh.js";import{S as H}from"./SectionLoading-DpoDcF75.js";const J={class:"max-h-[90vh] overflow-auto max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Q={class:"sticky top-0 pt-4 bg-white"},W={key:0,class:"text-center mt-2 mb-6"},X={class:"text-sky-600"},Y={key:1,class:"text-center mt-2 mb-6"},Z={class:"text-sky-600"},ee={class:"mb-4"},te={class:"block text-gray-600 text-sm mb-1 font-medium"},se={class:"mb-4"},oe={class:"block text-gray-600 text-sm mb-1 font-medium"},le=["label"],ae=["value"],re={class:"mb-4"},ie={class:"block text-gray-600 text-sm mb-1 font-medium"},ne=["label"],de=["value"],ue={class:"flex gap-16 items-center justify-center my-8"},me={class:"flex gap-1 items-center"},pe={class:"flex gap-1 items-center"},be={class:"grid grid-cols-2 gap-4 mb-4"},ve={class:"block text-gray-600 text-sm mb-1 font-medium"},ge={class:"mt-8"},ce={class:"grid grid-cols-2 gap-4 mb-4 mt-4"},fe={class:"mb-4"},xe={class:"block text-gray-600 text-sm mb-1 font-medium"},ke={class:"mb-4"},ye={class:"block text-gray-600 text-sm mb-1 font-medium"},_e={class:"mb-4"},we={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Te={key:0,class:"mb-4 text-red-500 font-medium"},Ce={key:1,class:"mb-4"},Se={class:"flex items-center justify-between gap-4"},Ie=["disabled"],he={__name:"TaskAddForm",props:{parentTaskId:{type:Number,required:!0},requirementId:{type:Number}},emits:["taskCreated","close","error","ok"],setup(w,{emit:L}){const b=w,T=L,v=$(),D=j(),N=K(),{requirement:k}=z(N),d=C(),R=C([]),F=A(()=>R.value.map(n=>n.id)),r=C(""),o=C({title:"",from_department_id:"",to_department_id:"",user_ids:[],priority:0,status:"PENDING",description:"",is_important:!1,is_urgent:!1});h(F,n=>{o.value.user_ids=n}),O(async()=>{r.value="loading",await D.fetchCompanies({with:"departments",ignore_permission:!0}),r.value=""}),h(()=>({parentTaskId:b.parentTaskId,requirement:b.requirementId}),async()=>{var n;b.requirementId>0&&await N.fetchRequirement(b.requirementId),b.parentTaskId>0&&(d.value=(n=await v.fetchTask(b.parentTaskId,{},{loadingBeforeFetch:!1,fetchOnly:!0}))==null?void 0:n.task,console.log({t:d.value})),r.value="initialized"},{initial:!0,immediate:!0});async function M(){var e,y;r.value="submitting";const n={...o.value,parent_id:((e=d==null?void 0:d.value)==null?void 0:e.id)||0,requirement_id:((y=k==null?void 0:k.value)==null?void 0:y.id)||null};try{await v.createTask(n,{loadingBeforeCreate:!1}),T("taskCreated"),r.value="taskCreated"}catch{T("error",v.error),r.value="taskCreatingError"}}return(n,e)=>{var y,q,U;return l(),a("div",J,[t("div",Q,[e[12]||(e[12]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Task",-1)),e[13]||(e[13]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=B(s=>T("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),r.value==="loading"||r.value==="submitting"?(l(),G(H,{key:0})):g("",!0),t("form",{onSubmit:B(M,["prevent"])},[w.requirementId&&((y=p(k))!=null&&y.title)?(l(),a("p",W,[e[14]||(e[14]=u(" Task under requirement ")),t("span",X,c(p(k).title),1)])):g("",!0),w.parentTaskId&&((q=d.value)!=null&&q.title)?(l(),a("p",Y,[e[15]||(e[15]=u(" Sub task under ")),t("span",Z,c(d.value.title),1)])):g("",!0),t("div",ee,[t("label",te,[e[16]||(e[16]=u("Task Title ")),f(x)]),i(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.title=s),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,o.value.title]])]),r.value!=="loading"&&!(w.parentTaskId&&((U=d.value)!=null&&U.title))?(l(),a(_,{key:2},[t("div",se,[t("label",oe,[e[17]||(e[17]=u(" From Department ")),f(x)]),i(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.from_department_id=s),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[18]||(e[18]=t("option",{value:""},"--select department--",-1)),(l(!0),a(_,null,I(p(D).companies,s=>(l(),a("optgroup",{key:s.id,label:s.name},[(l(!0),a(_,null,I(s.departments,m=>(l(),a("option",{value:m.id,key:m.id},c(m.name),9,ae))),128))],8,le))),128))],512),[[E,o.value.from_department_id]])]),t("div",re,[t("label",ie,[e[19]||(e[19]=u(" To Department ")),f(x)]),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.to_department_id=s),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[20]||(e[20]=t("option",{value:""},"--select department--",-1)),(l(!0),a(_,null,I(p(D).companies,s=>(l(),a("optgroup",{key:s.id,label:s.name},[(l(!0),a(_,null,I(s.departments,m=>(l(),a("option",{value:m.id,key:m.id},c(m.name),9,de))),128))],8,ne))),128))],512),[[E,o.value.to_department_id]])])],64)):g("",!0),t("div",ue,[t("label",me,[i(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=s=>o.value.is_important=s),class:"size-4"},null,512),[[V,o.value.is_important]]),e[21]||(e[21]=t("span",{class:"block text-gray-600 text-base font-medium"},"Important",-1))]),t("label",pe,[i(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>o.value.is_urgent=s),class:"size-4"},null,512),[[V,o.value.is_urgent]]),e[22]||(e[22]=t("span",{class:"block text-gray-600 text-base font-medium"},"Urgent",-1))])]),t("div",be,[t("div",null,[t("label",ve,[e[23]||(e[23]=u("Status ")),f(x)]),i(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.value.status=s),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[24]||(e[24]=[t("option",{value:""},"--select---",-1),t("option",null,"PENDING",-1),t("option",null,"IN_PROGRESS",-1),t("option",null,"COMPLETED",-1),t("option",null,"BLOCKED",-1),t("option",null,"CANCELLED",-1),t("option",null,"BACK_LOG",-1)]),512),[[E,o.value.status]])])]),t("div",ge,[t("label",{class:P(["flex gap-1 items-center mt-4 border rounded py-2 justify-center cursor-pointer",{"bg-yellow-200":o.value.is_target}])},[i(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>o.value.is_target=s),class:"size-6"},null,512),[[V,o.value.is_target]]),e[25]||(e[25]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Is Target Task",-1))],2)]),t("div",ce,[t("div",fe,[t("label",xe,[e[26]||(e[26]=u(" Start Date ")),f(x)]),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>o.value.started_at=s),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,o.value.started_at]])]),t("div",ke,[t("label",ye,[e[27]||(e[27]=u(" Deadline ")),f(x)]),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>o.value.deadline=s),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,o.value.deadline]])])]),t("div",_e,[e[28]||(e[28]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),i(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=s=>o.value.description=s),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,o.value.description]])]),t("div",we,[p(v).error?(l(),a("div",Te,c(p(v).error),1)):g("",!0),p(v).error?(l(),a("hr",Ce)):g("",!0),t("div",Se,[t("button",{disabled:r.value=="loading"||r.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},c(r.value=="submitting"?"Saving...":"Save Task"),9,Ie),t("button",{type:"button",onClick:e[11]||(e[11]=s=>T("close")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])])],32)])}}};export{he as _};
