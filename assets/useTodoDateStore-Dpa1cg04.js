import{o as S}from"./url-Buz9GlSr.js";import{C as i,B as Q,r as p,x as h}from"./index-DKNJ0-JN.js";async function R(u,{params:o={}}={}){return i.get(`/todos/${u}/settings`,{params:o})}async function U(u,o){return i.post(`/todos/${u}/settings`,o)}async function V(u,o,{params:v={}}={}){const s=S(v);return i.delete(`/todos/${u}/settings/${o}${s?`?${s}`:""}`)}async function $({params:u={}}={}){return i.get("/todo-dates",{params:u})}async function k(u){return i.post("/todo-dates",u)}async function z(u,o){return i.get(`/todo-dates/${u}`,o)}async function W(u,{params:o={}}={}){return i.get(`/todos/${u}/histories`,{params:o})}async function G(u,o){return i.patch(`/my-todo-dates/${u}/status`,o)}async function J(u,{params:o={}}={}){const v=S(o);return i.delete(`/todo-dates/${u}${v?"?"+v:""}`)}const X=Q("todo-date",()=>{const u=p(null),o=p(!1),v=p(!1),s=p(null),d=p([]),m=p({}),C=()=>u.value=[],q=async t=>{var e,n,r;o.value=!0,s.value=null;try{const a=await $({params:t});d.value=((e=a.data)==null?void 0:e.todo_dates)||[],g()}catch(a){throw s.value=((r=(n=a.response)==null?void 0:n.data)==null?void 0:r.message)||"TodoDates load failed",a}finally{o.value=!1}},x=async(t=[],{companyId:e}={})=>{var n,r,a;if(!t||!t.length)return{};o.value=!0,s.value=null;try{const l={todo_ids:t,per_page:1e3};e&&(l["company-id"]=e);const y=((n=(await $({params:l})).data)==null?void 0:n.todo_dates)||[],f={};return y.forEach(c=>{var _;const D=((_=c==null?void 0:c.todo)==null?void 0:_.id)||(c==null?void 0:c.todo_id)||(c==null?void 0:c.id)||null;D&&(f[D]=(f[D]||0)+1)}),m.value=f,f}catch(l){throw s.value=((a=(r=l.response)==null?void 0:r.data)==null?void 0:a.message)||"TodoDates count load failed",l}finally{o.value=!1}},M=t=>{var e;return((e=m.value)==null?void 0:e[String(t)])??null};function g(){d.value=[...d.value.sort((t,e)=>(t==null?void 0:t.user_id)!==(e==null?void 0:e.user_id)?(t==null?void 0:t.user_id)-(e==null?void 0:e.user_id):t.priority!==e.priority?t.priority-e.priority:e.id-t.id)]}const b=async t=>{var e,n,r;o.value=!0,s.value=null;try{const a=await i.get("/my-todo-dates",{params:t});d.value=((e=a.data)==null?void 0:e.todo_dates)||[],g()}catch(a){throw s.value=((r=(n=a.response)==null?void 0:n.data)==null?void 0:r.message)||"TodoDates load failed",a}finally{o.value=!1}},j=t=>{var e;return(e=d.value)==null?void 0:e.filter(n=>n.date==t)},E=async t=>{var e,n;o.value=!0,s.value=null;try{const r=await z(t);u.value=r.data.todo_date}catch(r){throw s.value=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"Todo load failed",r}finally{o.value=!1}},F=async t=>{var e,n,r;o.value=!0,s.value=null;try{const a=await k(t);return d.value=[...d.value,(e=a.data)==null?void 0:e.todo_date],g(),a.data}catch(a){throw s.value=((r=(n=a.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo create failed",a}finally{o.value=!1}},H=t=>{d.value=[...d.value,t],g()},w=async(t,e)=>{var n,r;o.value=!0,s.value=null;try{const a=await w(t,e);return d.value=d.value.map(l=>{var T,y,f,c;return l.id==((y=(T=a.data)==null?void 0:T.todo)==null?void 0:y.id)?l.user?{...(f=a.data)==null?void 0:f.todo,user:{...l.user}}:{...(c=a.data)==null?void 0:c.todo}:{...l}}),a.data}catch(a){throw s.value=((r=(n=a.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo update failed",a}finally{o.value=!1}},L=async(t,e)=>{var n,r;o.value=!0,s.value=null;try{await G(t,{status:e}),d.value=d.value.map(a=>a.id===t?{...a,status:e}:{...a})}catch(a){throw s.value=((r=(n=a.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to update todo status",a}finally{o.value=!1}},N=async(t,{date:e}={})=>{var n,r;o.value=!0,v.value=!0,s.value=null;try{const a=await i.put("/my-todo-dates/rearrange",{ids:t,date:e});d.value=d.value.map(l=>{var f;const y=(((f=a.data)==null?void 0:f.changes)||[]).find(c=>c.id==l.id);return y?{...l,priority:y.priority}:l}),g()}catch(a){throw s.value=((r=(n=a.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo rearranging failed",a}finally{v.value=!0,o.value=!1}};async function P(t){var e,n;o.value=!0,s.value=null;try{await J(t),d.value=d.value.filter(r=>r.id!==t)}catch(r){throw s.value=((n=(e=r.response)==null?void 0:e.data)==null?void 0:n.message)||"Todo delete failed",r}finally{o.value=!1}}return{loading:h(()=>o.value),error:h(()=>s.value),todo_dates:h(()=>d.value),todo_date:h(()=>u.value),fetchTodoDates:q,fetchTodoDate:E,createTodoDate:F,updateTodoDate:w,rearrangeMyTodoDates:N,deleteTodoDate:P,fetchMyTodoDates:b,updateStatus:L,getTodoDatesByDate:j,setNewTodoDate:H,emptyTodoDates:C,fetchTodoDateCounts:x,getTodoDateCount:M}});export{U as a,V as d,R as f,W as g,X as u};
