import{r as R,h as B,c as g,o as u,a as t,j as q,k as f,w as S,F as O,d as l,m as v,b as w,n as y,l as C,v as T,G as j,t as N,u as I}from"./index-oQTcVtne.js";import{_ as U}from"./CompanyDepartmentSelectInput-BSGW0mzD.js";import{R as h}from"./RequiredIcon-Cln5KNlg.js";import{a as z}from"./requirement-B3efbdCX.js";import{u as L}from"./company-C9Mo4axW.js";import{u as P}from"./tags-B2ex7Hfv.js";import{u as W}from"./user-Bt27Xrfm.js";import{_ as G}from"./AttachmentPreview-dlDci6dV.js";import{L as H}from"./LoaderView-BLs5epmy.js";import{S as A}from"./SelectDropdown-Bh9viU0v.js";import{_ as J}from"./TextEditor-toiCXiD-.js";import{T as K}from"./TextWithHr-B-6PL6L0.js";import{_ as $}from"./UserChip-DI9G9sO0.js";function Q(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(k){const m=Math.random()*16|0;return(k==="x"?m:m&3|8).toString(16)})}const X={class:"w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Y={class:"sticky top-0 pt-4 bg-white z-10"},Z={class:"block text-gray-600 text-sm mb-1 font-medium"},ee={class:"block text-gray-600 text-sm mb-1 font-medium"},te={class:"mb-4 col-span-4"},se={class:"col-span-full"},oe={class:"mb-4 mt-5"},le={class:"w-full table-auto print:table-fixed mt-8"},ae={class:"border-2 border-gray-800 px-2 pb-2 pt-8 text-gray-800 print:text-black text-base whitespace-nowrap"},re={class:"mb-4"},ie={class:"block text-gray-600 text-sm mb-1 font-medium"},ne={class:""},me={class:"block text-gray-600 text-sm mb-1 font-medium"},de={class:"mt-4"},ue={class:"border-2 border-gray-800 text-gray-800 print:text-black text-base px-3 whitespace-nowrap print:whitespace-normal print:p-0"},pe={class:"mb-4"},be={class:"mb-4"},ce={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},xe={key:0,class:"mb-4 text-red-500 font-medium"},fe={key:1,class:"mb-4"},ve={class:"flex items-center justify-between gap-4"},ge=["disabled"],ye={__name:"RequirementAddForm",emits:["create","cancelClick","error"],setup(k,{emit:m}){const d=m,p=P(),i=W(),n=L(),a=R(""),_=R(""),o=R({title:"",description:"",from_department_id:"",to_department_id:"",website_tags:[],priority:"",better_to_complete_on:"",supervisor_id:"",attachments:[]});B(async()=>{a.value="loading",p.fetchTags("website"),await n.fetchCompanies({with:"departments",ignore_permission:!0}),await n.fetchMyCompanies({with:"departments"}),await i.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"}),a.value="",D()});function E(r){o.value.attachments=[...o.value.attachments,...Array.from(r.target.files)]}function F(r){o.value.attachments.splice(r,1)}async function M(){var e,b,c,x;a.value="submitting",console.log({form:o.value});const r=new FormData;for(const s in o.value)s==="attachments"?o.value.attachments.forEach(V=>r.append("attachments[]",V)):s=="website_tags"?Array.isArray(o.value[s])&&o.value[s].forEach(V=>r.append("website_tags[]",V)):r.append(s,o.value[s]);try{const s=await z(r);d("create",s),a.value="create"}catch(s){d("error",(b=(e=s.response)==null?void 0:e.data)==null?void 0:b.message),_.value=(x=(c=s.response)==null?void 0:c.data)==null?void 0:x.message,a.value="error"}}function D(){o.value.details=[...o.value.details,{uuid:Q(),title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:""}]}return(r,e)=>{var b,c,x;return u(),g("div",X,[t("div",Y,[e[10]||(e[10]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Add New Requirement",-1)),e[11]||(e[11]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=S(s=>d("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),t("form",{onSubmit:S(M,["prevent"]),class:"z-0 grid grid-cols-8 gap-4"},[a.value!=="loading"&&a.value!=="submitting"?(u(),g(O,{key:0},[l(U,{modelValue:o.value.from_department_id,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.from_department_id=s),companies:((b=y(n))==null?void 0:b.myCompanies)||[],class:"mb-4 col-span-2",className:{select:"h-10"}},{label:v(()=>[t("label",Z,[e[12]||(e[12]=w(" From ")),l(h)])]),_:1},8,["modelValue","companies"]),l(U,{modelValue:o.value.to_department_id,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.to_department_id=s),companies:((c=y(n))==null?void 0:c.companies)||[],class:"mb-4 col-span-2",className:{select:"h-10"}},{label:v(()=>[t("label",ee,[e[13]||(e[13]=w(" To ")),l(h)])]),_:1},8,["modelValue","companies"]),t("div",te,[e[14]||(e[14]=t("label",{class:"text-gray-800 text-sm"},"Websites",-1)),l(A,{options:y(p).tags,modelValue:o.value.website_tags,"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.website_tags=s),taggable:"",label:"name",value:"name"},null,8,["options","modelValue"])])],64)):f("",!0),t("div",se,[t("div",oe,[l(K,{class:"mb-5"},{default:v(()=>e[15]||(e[15]=[t("h3",{class:"font-semibold text-xl text-gray-800 mx-2"},"Requirement details",-1)])),_:1,__:[15]}),t("table",le,[e[24]||(e[24]=t("thead",null,[t("tr",null,[t("th",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap w-[65%]"}," Requirement "),t("th",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Options ")])],-1)),t("tbody",null,[t("tr",null,[t("td",ae,[t("div",re,[t("label",ie,[e[16]||(e[16]=w(" Title ")),l(h)]),C(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.title=s),required:"",placeholder:"Enter Requirement title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,o.value.title]])]),t("div",ne,[t("label",me,[e[17]||(e[17]=w("Description ")),l(h)]),l(J,{modelValue:o.value.description,"onUpdate:modelValue":e[5]||(e[5]=s=>o.value.description=s),class:"w-full"},null,8,["modelValue"])]),t("div",de,[e[18]||(e[18]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Attachments",-1)),t("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",onChange:E},null,32)]),l(G,{files:((x=o.value)==null?void 0:x.attachments)||[],onRemove:F},null,8,["files"]),e[19]||(e[19]=t("div",{class:"flex items-center justify-between h-full"},null,-1))]),t("td",ue,[t("div",pe,[e[20]||(e[20]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),C(t("input",{type:"date","onUpdate:modelValue":e[6]||(e[6]=s=>o.value.better_to_complete_on=s),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[T,o.value.better_to_complete_on]])]),t("div",be,[e[21]||(e[21]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor ",-1)),l(A,{modelValue:o.value.supervisor_id,"onUpdate:modelValue":e[7]||(e[7]=s=>o.value.supervisor_id=s),options:y(i).users,placeholder:"--NO SUPERVISOR--",class:"h-10 w-full",clearable:""},{option:v(({option:s})=>[l($,{user:s||{},class:"w-full overflow-hidden border relative"},null,8,["user"])]),"selected-option":v(({option:s})=>[s?(u(),q($,{key:0,user:s||{}},null,8,["user"])):f("",!0)]),_:1},8,["modelValue","options"])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),C(t("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 h-10","onUpdate:modelValue":e[8]||(e[8]=s=>o.value.priority=s)},e[22]||(e[22]=[t("option",{value:""},"NORMAL",-1),t("option",null,"IMPORTANT",-1),t("option",null,"URGENT",-1)]),512),[[j,o.value.priority]])])])])])])]),t("div",ce,[_.value?(u(),g("div",xe,N(_.value),1)):f("",!0),_.value?(u(),g("hr",fe)):f("",!0),t("div",ve,[t("button",{type:"button",onClick:e[9]||(e[9]=S(s=>d("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),t("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},N(a.value=="submitting"?"Saving...":"Save"),9,ge)])])])],32),a.value==="loading"||a.value==="submitting"?(u(),q(H,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):f("",!0)])}}},_e={class:"container mx-auto p-6"},Ee={__name:"RequirementAdd",setup(k){const m=I();function d(p){var n;const i=((n=p.data)==null?void 0:n.requirement)||null;i&&m.push({name:"RequirementShow",params:{id:i.id}})}return(p,i)=>(u(),g("div",_e,[l(ye,{onCreate:d,onCancelClick:i[0]||(i[0]=n=>y(m).back())})]))}};export{Ee as default};
