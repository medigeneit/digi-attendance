import{B as D,r as y,p as g,e as M,q as m,c as o,o as p,a as n,g as b,y as x,i as h,t as w,w as j}from"./index-BbvmKnbC.js";import{u as q}from"./company-CzIzRZ6y.js";import{u as I}from"./department-B2flBBGB.js";import{_ as L}from"./EmployeeDropdownInput-ChESBgZd.js";import{S as V}from"./SelectDropdown-Kca5SiiF.js";const P={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},R={class:"relative"},G=["title"],H={key:0},J={key:1,class:"text-gray-500 whitespace-nowrap"},K={class:"relative"},Q=["title"],W={key:0},X={key:1,class:"text-gray-800 whitespace-nowrap"},Y={key:0,class:"absolute inset-0 bg-white/50 cursor-not-allowed rounded","aria-hidden":"true"},Z={key:0,class:"relative"},ee={key:0,class:"relative w-full pr-6"},te={class:"flex items-center gap-2 text-sm text-gray-700"},le={class:"line-clamp-1"},ae={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},ie={class:"relative"},pe={__name:"EmployeeFilter",props:{company_id:{type:[String,Number],default:""},department_id:{type:[String,Number],default:""},employee_id:{type:[String,Number],default:""},line_type:{type:String,default:"all"},withType:{type:Boolean,default:!0},initialValue:{type:Object,default:()=>({})}},emits:["update:company_id","update:department_id","update:employee_id","update:line_type","filter-change"],setup(T,{emit:B}){const a=T,s=B,v=q(),k=I(),{companies:N}=D(v),{departments:E}=D(k),u=y(String(a.company_id||a.initialValue.company_id||"")),r=y(a.department_id!==""?String(a.department_id):a.initialValue.department_id&&a.initialValue.department_id!=="all"?String(a.initialValue.department_id):""),d=y(a.withType?String(a.line_type||a.initialValue.line_type||"all"):null),i=y(String(a.employee_id||a.initialValue.employee_id||"")),z=g(()=>(N.value||[]).map(l=>({id:String(l.id),label:l.name}))),A=g(()=>(E.value||[]).map(e=>({id:String(e.id),label:e.name}))),O=g(()=>a.withType?[{id:"all",label:"All Types"},{id:"executive",label:"Executive"},{id:"support_staff",label:"Support Staff"},{id:"doctor",label:"Doctor"},{id:"academy_body",label:"Academy Body"}]:[]),U=g(()=>v.employees||[]),c=y([]);M(async()=>{await v.fetchCompanies(),u.value&&await C(u.value),f(),i.value&&(c.value.find(e=>e.id===String(i.value))||(i.value="",s("update:employee_id",""))),$()}),m(()=>a.company_id,l=>{String(l||"")!==u.value&&(u.value=String(l||""))}),m(()=>a.department_id,l=>{const e=l===""||l==null?"":String(l);e!==r.value&&(r.value=e)}),m(()=>a.employee_id,l=>{String(l||"")!==i.value&&(i.value=String(l||""))}),m(()=>a.line_type,l=>{if(!a.withType)return;const e=String(l||"all");e!==d.value&&(d.value=e)}),m(u,async l=>{r.value="",i.value="",c.value=[],s("update:company_id",l||""),s("update:department_id",""),s("update:employee_id",""),l?await C(l):E.value=[],f(),_()}),m([r,d],()=>{s("update:department_id",r.value||""),a.withType&&s("update:line_type",d.value||"all"),f(),_()}),m(i,()=>{s("update:employee_id",i.value||""),_()});async function C(l){await Promise.all([k.fetchDepartments(l),v.fetchEmployee(l)])}function f(){let l=[...U.value];r.value&&(l=l.filter(e=>String(e.department_id)===String(r.value))),a.withType&&d.value&&d.value!=="all"&&(l=l.filter(e=>String(e.type)===String(d.value))),c.value=l.map(e=>({...e,id:String(e.id),label:e.name||e.label||`${e.first_name??""} ${e.last_name??""}`.trim()})),i.value&&(c.value.some(t=>t.id===String(i.value))||(i.value="",s("update:employee_id","")))}function $(){s("update:company_id",u.value||""),s("update:department_id",r.value||""),a.withType&&s("update:line_type",d.value||"all"),s("update:employee_id",i.value||""),_()}let S=null;function _(){S&&clearTimeout(S),S=setTimeout(()=>s("filter-change"),0)}function F(){a.withType&&(d.value="all",i.value="",f())}return(l,e)=>(p(),o("div",P,[n("div",R,[x(V,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),options:z.value,class:"border-2 border-gray-300 rounded h-[44px] w-full bg-white",clearable:""},{"selected-option":h(({option:t})=>[n("div",{class:"line-clamp-1 text-sm text-gray-900",title:t==null?void 0:t.label},[t!=null&&t.label?(p(),o("span",H,w(t==null?void 0:t.label),1)):(p(),o("span",J,"--Select Company--"))],8,G)]),_:1},8,["modelValue","options"]),e[5]||(e[5]=n("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),n("div",K,[x(V,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value=t),options:A.value,class:"border-2 border-gray-300 rounded h-[44px] w-full bg-white",clearable:""},{"selected-option":h(({option:t})=>[n("div",{class:"line-clamp-1 text-sm text-gray-900",title:t==null?void 0:t.label},[t!=null&&t.label?(p(),o("span",W,w(t==null?void 0:t.label),1)):(p(),o("span",X,"--All Departments--"))],8,Q)]),_:1},8,["modelValue","options"]),e[6]||(e[6]=n("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Department ",-1)),u.value?b("",!0):(p(),o("div",Y))]),T.withType?(p(),o("div",Z,[x(V,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=t=>d.value=t),options:O.value,placeholder:"Select Type",class:"border-2 border-gray-300 rounded h-[44px] w-full bg-white"},{"selected-option":h(({option:t})=>[t?(p(),o("div",ee,[n("div",te,[n("div",le,w(t==null?void 0:t.label),1)]),d.value&&d.value!=="all"?(p(),o("div",ae,[n("button",{onClick:e[2]||(e[2]=j(se=>F(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"}," Ã— ")])):b("",!0)])):b("",!0)]),_:1},8,["modelValue","options"]),e[7]||(e[7]=n("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Line Type ",-1))])):b("",!0),n("div",ie,[x(L,{employees:c.value,modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value=t),class:"border-2 border-gray-300 rounded h-[44px] w-full bg-white"},null,8,["employees","modelValue"]),e[8]||(e[8]=n("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))])]))}};export{pe as _};
