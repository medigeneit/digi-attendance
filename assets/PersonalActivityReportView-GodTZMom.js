import{_ as Te,g as Oe,D as Ce,f as Me,u as Ne,G as Ee,r as W,x as f,q as z,h as Se,c as d,o as a,a as t,k as x,j as Re,d as U,w,l as de,v as ue,t as l,n as D,m as Q,b as T,F as Y,e as H,N as pe,s as Pe}from"./index-B_xL3wTw.js";import{_ as Ue}from"./EmployeeFilter-DGWV2pur.js";import{L as je}from"./LoaderView-CsbGm7ZA.js";import{U as Ae}from"./UserChip-BfJkI70f.js";import{g as ce,m as Be,c as Le,b as J,a as X}from"./datetime-xFwVWbdc.js";import{j as $e}from"./url-Buz9GlSr.js";import{u as Ge}from"./useTodoDateStore-LkQz69W-.js";import{_ as Fe}from"./TodoCreateEditShow-Be5Fs6-3.js";import"./company-CdUUMSCi.js";import"./department-Bu9nG0Jr.js";import"./EmployeeDropdownInput-Dob_33KC.js";import"./SelectDropdown-BBZnpvzE.js";import"./user-DlGKWADD.js";import"./OverlyModal-C91Zma20.js";import"./useTodoProjectStore-DwAYymVb.js";import"./useTodoStore-Bd7wMpX5.js";import"./CompanyDepartmentSelectInput-B4Mw2VZb.js";import"./useTaskStore-Cf95cbP5.js";import"./requirement-DGphkPmy.js";import"./TaskSelectionInput-D66s-5cK.js";import"./TaskTitle-DQIKUpcE.js";import"./TodoStatusIcon-CcT4jOGP.js";const Ve={class:"container mx-auto print:w-full print:px-0 print:py-0"},qe={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},Ke={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},We={key:0,class:"relative h-[32px] flex gap-1 ml-auto justify-end print:hidden"},ze={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Qe={key:1,class:"text-gray-400"},Ye=["disabled"],He={key:0,class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0 shadow-sm"},Je={class:"flex flex-wrap items-center gap-3"},Xe={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Ze={class:"relative h-[32px] flex"},et={key:0,class:"text-xs text-blue-600 flex items-center gap-2 w-full md:w-auto md:ml-auto"},tt={key:1,class:"space-y-4"},st={key:0,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},nt={class:"text-sm text-gray-700"},ot={class:"font-semibold"},lt={class:"text-sm text-gray-700"},rt={class:"font-semibold"},at={class:"text-sm text-gray-700"},it={class:"font-semibold text-green-600"},dt={class:"text-sm text-gray-700"},ut={class:"font-semibold text-blue-600"},pt={class:"text-sm text-gray-700"},ct={class:"font-semibold text-amber-600"},mt={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},yt={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},ft={key:0,class:"flex items-center gap-3"},xt={class:"font-semibold text-gray-800"},vt=["href"],gt={class:"text-xs text-gray-500"},bt={class:"text-[11px] text-blue-800"},ht={key:0,class:"font-bold"},_t={key:1,class:"flex items-center gap-3"},kt={class:"font-semibold text-gray-800"},wt={class:"text-xs text-gray-500"},It={class:"text-[11px] text-blue-800"},Dt={key:0,class:"font-bold"},Tt={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},Ot={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},Ct={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},Mt={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},Nt={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},Et={class:"overflow-x-auto"},St={class:"min-w-full text-left text-sm border-separate border-spacing-0"},Rt={key:0},Pt={class:"bg-gray-100/50"},Ut={colspan:"4",class:"px-4 py-2 border font-bold text-blue-800 text-xs uppercase tracking-wider"},jt={class:"ml-2 font-normal text-gray-500"},At={class:"px-4 py-3 text-center border"},Bt={class:"px-4 py-3 border"},Lt=["onClick"],$t={class:"font-semibold text-gray-800 flex items-center gap-2"},Gt={key:0,class:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full"},Ft=["onClick"],Vt={class:"px-4 py-3 border text-xs text-gray-700"},qt={class:"px-4 py-3 border text-center"},Kt={key:2,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},Wt={__name:"PersonalActivityReportView",props:{selfOnly:{type:Boolean,default:!1}},setup(me){const c=me,O=Ge(),ye=Oe(),{user:C}=Ce(ye),j=Me(),fe=Ne(),o=Ee({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),u=W(""),Z=W(null),M=f(()=>{if(!u.value)return"";const[s,e]=u.value.split("-").map(Number);return!s||!e?"":ce(new Date(s,e-1,1))}),N=f(()=>{if(!u.value)return"";const[s,e]=u.value.split("-").map(Number);return!s||!e?"":ce(Be(new Date(s,e-1,1)))}),$=f(()=>u.value?Le(`${u.value}-01`):""),I=f(()=>M.value&&N.value?`${J(M.value)} ~ ${J(N.value)}`:""),G=f(()=>{var s;return c.selfOnly?((s=C.value)==null?void 0:s.company_id)||"":o.companyId}),F=f(()=>!M.value||!N.value?!1:c.selfOnly?!!h.value&&!!G.value:!!G.value),V=f(()=>O.todo_dates||[]),h=f(()=>{var s;return(s=C.value)!=null&&s.id?String(C.value.id):""});function xe(s){o.companyId=s.company_id||"",o.departmentId=s.department_id||"",o.employeeId=c.selfOnly?h.value:s.employee_id||"",o.lineType=s.line_type||"all"}function ve(s){return s==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":s==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":s==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"}function ee(s){var e,n;return s.todo_id||s.todoId||((e=s.todo)==null?void 0:e.id)||((n=s.todo)==null?void 0:n.todo_id)||s.id||`${s.title}-${s.date}`}function ge(s){var e;return((e=s==null?void 0:s.todo)==null?void 0:e.id)||(s==null?void 0:s.todo_id)||(s==null?void 0:s.todoId)||(s==null?void 0:s.id)||null}function te(s){const e=ge(s);return e?(V.value||[]).filter(n=>{var y;return(((y=n==null?void 0:n.todo)==null?void 0:y.id)||(n==null?void 0:n.todo_id)||(n==null?void 0:n.id))==e}).length:0}const se=f(()=>{var y;if(c.selfOnly&&C.value)return[C.value];const s=((y=Z.value)==null?void 0:y.employees)||[];if(s.length)return s;const e=[],n=new Set;return V.value.forEach(g=>{const b=g.user;if(!b||!b.id)return;const _=String(b.id);n.has(_)||(n.add(_),e.push(b))}),e}),be=f(()=>o.employeeId?se.value.filter(s=>String(s.id)===String(o.employeeId)):se.value),A=f(()=>be.value.map(s=>{const e=V.value.filter(r=>{var p;return String(((p=r.user)==null?void 0:p.id)??r.user_id)===String(s.id)}),n={};for(const r of e){const p=ee(r),m=n[p],v=new Date(r.date),i=m?new Date(m.date):null;(!m||i&&v>i)&&(n[p]=r)}const y={WORKING:1,PENDING:2,DEPENDANT:3,COMPLETED:4,BACK_LOG:5},g=Object.values(n).sort((r,p)=>{const m=new Date(r.date).getTime(),v=new Date(p.date).getTime();if(m!==v)return v-m;const i=y[r.status]||999,k=y[p.status]||999;return i!==k?i-k:(r.priority||0)-(p.priority||0)}),b=g.reduce((r,p)=>{var i,k,R,P;const m=((k=(i=p.todo)==null?void 0:i.todo_project)==null?void 0:k.id)||"others",v=((P=(R=p.todo)==null?void 0:R.todo_project)==null?void 0:P.title)||"Others";return r[m]||(r[m]={id:m,name:v,todos:[]}),r[m].todos.push(p),r},{}),_=Object.values(b).sort((r,p)=>r.id==="others"?1:p.id==="others"?-1:r.name.localeCompare(p.name)),L={total:g.length,completed:g.filter(r=>r.status==="COMPLETED").length,working:g.filter(r=>r.status==="WORKING").length,pending:g.filter(r=>r.status==="PENDING").length};return{user:s,projects:_,totals:L}}).sort((s,e)=>{var n,y;return(((n=s.user)==null?void 0:n.name)||"").localeCompare(((y=e.user)==null?void 0:y.name)||"")})),B=f(()=>A.value.reduce((s,e)=>({totalTodos:s.totalTodos+e.totals.total,completed:s.completed+e.totals.completed,working:s.working+e.totals.working,pending:s.pending+e.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));function ne(){console.log("syncQuery",o),fe.replace({query:{...j.query,month:u.value||void 0,...c.selfOnly?{}:{company_id:o.companyId||void 0,department_id:o.departmentId||void 0,employee_id:o.employeeId||void 0,line_type:o.lineType||void 0}}})}async function E(){F.value&&await O.fetchTodoDates({"company-id":G.value||void 0,"department-id":c.selfOnly?void 0:o.departmentId,"employee-id":c.selfOnly?h.value:o.employeeId,"line-type":c.selfOnly?void 0:o.lineType,"start-date":M.value,"end-date":N.value})}function q(){c.selfOnly&&h.value&&(o.employeeId=h.value)}function oe(){const s=j.query||{};u.value=typeof s.month=="string"&&s.month?s.month:u.value||X(new Date),o.companyId=c.selfOnly?"":s.company_id||"",o.departmentId=c.selfOnly?"":s.department_id||"",o.employeeId=c.selfOnly?h.value:s.employee_id||"",o.lineType=c.selfOnly?"all":s.line_type||"all",q()}z(()=>[o.companyId,o.departmentId,o.employeeId,o.lineType,M.value,N.value,u.value],()=>{q(),ne(),E()}),z(()=>j.query,()=>{oe()}),z(h,()=>{q(),ne(),E()}),Se(()=>{u.value=u.value||X(new Date),oe(),E()});function he(){window.print()}function le(s){const e=u.value?new Date(`${u.value}-01`):new Date;e.setMonth(e.getMonth()+s),u.value=X(e)}function re(){le(-1)}function ae(){le(1)}const S=W({action:null});function ie(s){S.value={action:"show",todo:s}}function K(){S.value={action:null,todo:null}}function _e(){E(),K()}function ke(){E(),K()}function we(s){S.value={action:"edit",todo:s}}function Ie(s,e){S.value={action:"addDate",todo_id:s,date:e}}return(s,e)=>(a(),d("div",Ve,[t("div",qe,[e[11]||(e[11]=t("div",null,[t("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),t("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),t("span",Ke,[c.selfOnly?(a(),d("div",We,[t("button",{class:"btn-3 h-[32px] px-3",onClick:w(re,["prevent"])},e[6]||(e[6]=[t("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),t("div",ze,[e[7]||(e[7]=t("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),de(t("input",{id:"month",type:"month","onUpdate:modelValue":e[0]||(e[0]=n=>u.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ue,u.value]])]),t("button",{class:"btn-3 h-[32px] px-3",onClick:w(ae,["prevent"])},e[8]||(e[8]=[t("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])):x("",!0),e[9]||(e[9]=t("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),t("span",null,l($.value),1),I.value?(a(),d("span",Qe,"("+l(I.value)+")",1)):x("",!0)]),t("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:w(he,["prevent"]),disabled:D(O).loading,title:"Print"},e[10]||(e[10]=[t("i",{class:"fas fa-print"},null,-1)]),8,Ye)]),c.selfOnly?x("",!0):(a(),d("div",He,[t("div",Je,[U(Ue,{ref_key:"employeeFilterRef",ref:Z,company_id:o.companyId,"onUpdate:company_id":e[2]||(e[2]=n=>o.companyId=n),department_id:o.departmentId,"onUpdate:department_id":e[3]||(e[3]=n=>o.departmentId=n),employee_id:o.employeeId,"onUpdate:employee_id":e[4]||(e[4]=n=>o.employeeId=n),line_type:o.lineType,"onUpdate:line_type":e[5]||(e[5]=n=>o.lineType=n),"initial-value":D(j).query,onFilterChange:xe,class:"flex-1 min-w-[240px]"},{default:Q(()=>[t("div",Xe,[t("button",{class:"btn-3 h-[32px] px-3",onClick:w(re,["prevent"])},e[12]||(e[12]=[t("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),t("div",Ze,[e[13]||(e[13]=t("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),de(t("input",{id:"month",type:"month","onUpdate:modelValue":e[1]||(e[1]=n=>u.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ue,u.value]])]),t("button",{class:"btn-3 h-[32px] px-3",onClick:w(ae,["prevent"])},e[14]||(e[14]=[t("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),c.selfOnly?(a(),d("div",et,[e[15]||(e[15]=t("i",{class:"fas fa-user-lock"},null,-1)),T(" Showing only my todos (Employee ID: "+l(h.value||"loading...")+") ",1)])):x("",!0)])])),F.value?(a(),d("div",tt,[c.selfOnly?x("",!0):(a(),d("div",st,[t("div",nt,[e[16]||(e[16]=t("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),t("div",ot,l(A.value.length),1)]),t("div",lt,[e[17]||(e[17]=t("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),t("div",rt,l(B.value.totalTodos),1)]),t("div",at,[e[18]||(e[18]=t("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),t("div",it,l(B.value.completed),1)]),t("div",dt,[e[19]||(e[19]=t("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),t("div",ut,l(B.value.working),1)]),t("div",pt,[e[20]||(e[20]=t("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),t("div",ct,l(B.value.pending),1)])])),A.value.length===0?(a(),d("div",mt," No data available for the selected month. ")):x("",!0),(a(!0),d(Y,null,H(A.value,(n,y)=>{var g,b,_,L,r,p,m;return a(),d("div",{key:((g=n.user)==null?void 0:g.id)||y,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[t("div",yt,[c.selfOnly?(a(),d("div",_t,[U(pe,{user:n.user,size:"medium"},null,8,["user"]),t("div",null,[t("div",kt,l(((r=n.user)==null?void 0:r.name)||"Unknown user"),1),t("div",wt,l(((m=(p=n.user)==null?void 0:p.department)==null?void 0:m.name)||"-"),1),t("div",It,[T(" Month: "+l($.value)+" ",1),I.value?(a(),d("span",Dt,"("+l(I.value)+")",1)):x("",!0)])])])):(a(),d("div",ft,[U(Ae,{user:n.user},{trigger:Q(()=>[U(pe,{user:n.user,size:"medium"},null,8,["user"])]),_:2},1032,["user"]),t("div",null,[t("div",xt,[t("a",{href:D($e)(n.user,u.value),target:"_blank",rel:"noopener",class:"inline-flex hover:underline"},[t("div",null,[T(l(((b=n.user)==null?void 0:b.name)||"Unknown user")+" ",1),e[21]||(e[21]=t("i",{class:"far fa-external-link-alt print:hidden"},null,-1))])],8,vt)]),t("div",gt,l(((L=(_=n.user)==null?void 0:_.department)==null?void 0:L.name)||"-"),1),t("div",bt,[T(" Month: "+l($.value)+" ",1),I.value?(a(),d("span",ht,"("+l(I.value)+")",1)):x("",!0)])])])),t("div",Tt,[t("span",Ot," Total "+l(n.totals.total),1),t("span",Ct," Done "+l(n.totals.completed),1),t("span",Mt," Working "+l(n.totals.working),1),t("span",Nt," Pending "+l(n.totals.pending),1)])]),t("div",Et,[t("table",St,[e[24]||(e[24]=t("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[t("tr",{class:"border-b"},[t("th",{class:"px-4 py-3 border text-center w-12"},"sl"),t("th",{class:"px-4 py-3 border text-left"},"Todo"),t("th",{class:"px-4 py-3 border text-left"},"Last Activity"),t("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),t("tbody",null,[n.projects.length===0?(a(),d("tr",Rt,e[22]||(e[22]=[t("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-400 border rounded-b"}," No activity recorded for this month. ",-1)]))):x("",!0)]),(a(!0),d(Y,null,H(n.projects,v=>(a(),d("tbody",{key:v.id},[t("tr",Pt,[t("td",Ut,[e[23]||(e[23]=t("i",{class:"fas fa-project-diagram mr-2"},null,-1)),T(" "+l(v.name)+" ",1),t("span",jt,"("+l(v.todos.length)+" todos)",1)])]),(a(!0),d(Y,null,H(v.todos,(i,k)=>{var R,P;return a(),d("tr",{key:ee(i),class:"border-b cursor-pointer hover:bg-slate-50"},[t("td",At,l(k+1),1),t("td",Bt,[t("a",{href:"#",class:"text-blue-600 hover:underline",onClick:w(De=>ie(i),["prevent"])},[t("div",$t,[t("span",null,l(i.title),1),te(i)>0?(a(),d("span",Gt," + "+l(te(i))+" dates ",1)):x("",!0)]),t("div",{class:"text-xs text-gray-500",onClick:w(De=>ie(i),["prevent"])},l(((P=(R=i.todo)==null?void 0:R.todoable)==null?void 0:P.title)||""),9,Ft)],8,Lt)]),t("td",Vt,l(D(J)(i.date)||i.date),1),t("td",qt,[t("div",{class:Pe(["inline-block text-xs font-semibold px-2.5 py-1 rounded-full whitespace-nowrap",ve(i.status)])},l(i.status==="WORKING"?"IN PROGRESS":i.status||"N/A"),3)])])}),128))]))),128))])])])}),128))])):x("",!0),!F.value&&!D(O).loading?(a(),d("div",Kt,e[25]||(e[25]=[t("i",{class:"fad fa-tasks text-4xl"},null,-1),t("div",{class:"empty-state glass-panel"},[t("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),t("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)]))):D(O).loading?(a(),Re(je,{key:3},{default:Q(()=>e[26]||(e[26]=[T("Loading report...")])),_:1,__:[26]})):x("",!0),U(Fe,{todoModal:S.value,userRole:"employee",onCancelClick:K,onTodoUpdate:_e,onTodoDateUpdate:ke,onClickEdit:we,onClickAddTodoDate:Ie},null,8,["todoModal"])]))}},fs=Te(Wt,[["__scopeId","data-v-501632d9"]]);export{fs as default};
