import{D as C,f as K,u as X,Q as Z,r as c,E as A,x as E,h as ee,q as te,p as oe,c as l,o as i,a as t,b as y,w as ne,l as d,k as m,v as u,t as p,G as f,F as b,e as _,n as g,i as le,d as T,aa as ie,m as se}from"./index-CFNZDlTZ.js";import{_ as ae}from"./WeekendAssignModal-m8w7mL0U.js";import{u as de}from"./company-CYTuAJJi.js";import{u as re}from"./department-DQD-sigJ.js";import{u as pe}from"./designation-XwsVN84f.js";import{u as ue}from"./leave-approval-KadCMJu1.js";import{u as me}from"./shift-CBQcnWzj.js";import{u as ve}from"./user-DwSGA215.js";import{d as B}from"./dayjs.min-De7pmLEF.js";const ye={class:"my-container"},fe={class:"card-bg md:p-8 p-4 mx-4"},be={class:"border p-4 rounded-md bg-gray-50"},_e={class:"grid md:grid-cols-2 gap-4"},ge=["aria-invalid"],xe={key:0,class:"text-red-600 text-sm mt-1"},he=["aria-invalid"],ce={key:0,class:"text-red-600 text-sm mt-1"},ke=["aria-invalid"],we={key:0,class:"text-red-600 text-sm mt-1"},Se=["value"],Ue={class:"border p-4 rounded-md bg-gray-50"},Ve={class:"grid md:grid-cols-2 gap-4"},De=["aria-invalid"],Pe=["value"],Me={key:0,class:"text-red-600 text-sm mt-1"},Ce=["disabled","aria-invalid"],Ee={value:"",disabled:""},qe=["value"],Ye={key:0,class:"text-red-600 text-sm mt-1"},Le=["disabled"],Ne={value:"",disabled:""},Oe=["value"],je=["value"],Ae={key:1},Te=["aria-invalid"],Be={key:0,class:"text-red-600 text-sm mt-1"},Ie={class:"md:col-span-2"},Re={class:"flex items-center gap-3 flex-wrap"},Ge={key:0,class:"flex flex-wrap gap-4 bg-white p-3 border rounded mt-2 text-sm"},Fe=["value"],$e=["value"],ze={key:2,class:"md:col-span-2"},We=["required"],He={class:"border p-4 rounded-md bg-gray-50"},Je={class:"grid md:grid-cols-4 gap-4"},Qe=["aria-invalid"],Ke={key:0,class:"text-red-600 text-sm mt-1"},Xe={class:"relative"},Ze=["type"],et=["aria-label"],tt={class:"sticky bottom-0 left-0 right-0 bg-white/80 backdrop-blur border-t p-3 mt-6 flex justify-center gap-3"},ot=["disabled"],nt={key:0},lt={key:1,class:"inline-flex items-center gap-2"},ft={__name:"UserEdit",setup(it){const V=de(),q=re(),Y=pe(),D=ue(),L=me(),P=ve(),{designations:I}=C(Y),{shifts:R}=C(L),{error:N}=C(P),w=K(),O=X(),k=Z(),j=c(!0),x=c(!1),S=c(!1),U=c(!1),M=c(!1),G=Object.freeze(["A+","A-","B+","B-","AB+","AB-","O+","O-"]),F=Object.freeze(["Probationary","Permanent","Part_Time","Remote","Contract","Freelance","Intern"]),n=A({name:"",bn_name:"",phone:"",email:"",password:"",role:"employee",type:"",address:"",note:"",device_user_id:null,is_active:!0,company_id:"",department_id:"",designation_id:"",shift_id:"",nid:"",date_of_birth:"",joining_date:"",employment_type:"Probationary",contract_month:0,provisional_month:0,extended_provisional_month:0,employee_id:"",weekends:[],leave_approval_id:"",other_approval_id:"",blood:""}),v=c({weekends:[],start_month:"",end_month:""}),$=a=>{v.value=a},h=E(()=>V.companies.find(a=>a.id===n.company_id)),z=E(()=>{if(!h.value)return[];const a=I.value||{};return a[h.value.id]||a[h.value.name]||[]});E(()=>{if(!h.value)return[];const a=R.value||{};return a[h.value.id]||a[h.value.name]||[]});const s=A({});function W(){for(const e of Object.keys(s))delete s[e];const a={name:"Name is required",phone:"Phone is required",company_id:"Company is required",department_id:"Department is required",role:"Role is required"};for(const[e,r]of Object.entries(a))String(n[e]??"").trim()||(s[e]=r);return n.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)&&(s.email="Provide a valid email address"),n.employment_type==="Contract"&&(!n.contract_month||n.contract_month<0)&&(s.contract_month="Contract month must be ≥ 0"),Object.keys(s).length===0}async function H(){const a=w.params.id,e=await P.fetchUser(a);if(!e)throw new Error("User not found");e.assign_weekend?v.value={weekends:e.assign_weekend.weekends||[],start_month:e.assign_weekend.start_month?B(e.assign_weekend.start_month).format("YYYY-MM"):"",end_month:e.assign_weekend.end_month?B(e.assign_weekend.end_month).format("YYYY-MM"):""}:v.value={weekends:[],start_month:"",end_month:""},n.name=e.name||"",n.bn_name=e.bn_name||"",n.phone=e.phone||"",n.email=e.email||"",n.address=e.address||"",n.nid=e.nid||"",n.date_of_birth=e.date_of_birth||"",n.blood=e.blood||"",n.joining_date=e.joining_date||"",n.employment_type=e.employment_type||"Probationary",n.employee_id=e.employee_id||"",n.provisional_month=e.provisional_month??0,n.extended_provisional_month=e.extended_provisional_month??0,n.contract_month=e.contract_month??0,n.weekends=e.weekends||[],n.is_active=!!e.is_active,n.company_id=e.company_id||"",n.department_id=e.department_id||"",n.designation_id=e.designation_id||"",n.shift_id=e.shift_id||"",n.role=e.role||"employee",n.type=e.type||"",n.device_user_id=e.device_user_id??"",n.leave_approval_id=e.leave_approval_id||"",n.other_approval_id=e.other_approval_id||""}ee(async()=>{var a,e;try{j.value=!0,await Promise.all([V.fetchCompanies(),D.fetchLeaveApprovals()]),await H()}catch(r){const o=((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Failed to load user data";k.error(o),O.push({name:"UserList"})}finally{j.value=!1}}),te(()=>n.company_id,async a=>{if(a)try{x.value=!0,await Promise.all([q.fetchDepartments(a),Y.fetchDesignations(a),L.fetchShifts(a)])}finally{x.value=!1}});async function J(){var a,e;if(!W()){k.error("Please fix the highlighted fields");return}try{S.value=!0;const r={...n,selected_weekend:{weekends:v.value.weekends,start_month:v.value.start_month||null,end_month:v.value.end_month||null}};await P.updateUser(w.params.id,r),N.value?k.error(N.value):(k.success("User updated successfully"),O.push({name:"UserShow",params:{id:w.params.id}}))}catch(r){const o=((e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message)||(r==null?void 0:r.message)||"Failed to update user";k.error(o)}finally{S.value=!1}}function Q(){v.value={weekends:[],start_month:"",end_month:""}}return(a,e)=>{const r=oe("RouterLink");return i(),l("div",ye,[t("div",fe,[e[69]||(e[69]=t("h2",{class:"title-lg text-center"},"Edit Employee",-1)),e[70]||(e[70]=t("p",{class:"text-sm text-gray-500 text-center mb-3"},[y(" Fields marked "),t("span",{class:"text-red-600"},"*"),y(" are required. ")],-1)),t("form",{class:"space-y-6",onSubmit:ne(J,["prevent"]),novalidate:""},[t("fieldset",be,[e[37]||(e[37]=t("legend",{class:"title-md px-2"},"Personal Info",-1)),t("div",_e,[t("div",null,[e[28]||(e[28]=t("label",{for:"name"},[y("Name"),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=o=>n.name=o),type:"text",class:"input-light","aria-invalid":!!s.name,autocomplete:"name",required:"",placeholder:"Enter full name"},null,8,ge),[[u,n.name,void 0,{trim:!0}]]),s.name?(i(),l("p",xe,p(s.name),1)):m("",!0)]),t("div",null,[e[29]||(e[29]=t("label",{for:"bnName"},"Bangla Name",-1)),d(t("input",{id:"bnName","onUpdate:modelValue":e[1]||(e[1]=o=>n.bn_name=o),type:"text",class:"input-light",autocomplete:"name",placeholder:"বাংলায় নাম লিখুন"},null,512),[[u,n.bn_name,void 0,{trim:!0}]])]),t("div",null,[e[30]||(e[30]=t("label",{for:"phone"},[y("Phone"),t("span",{class:"text-red-500"},"*")],-1)),d(t("input",{id:"phone","onUpdate:modelValue":e[2]||(e[2]=o=>n.phone=o),type:"tel",inputmode:"tel",class:"input-light","aria-invalid":!!s.phone,autocomplete:"tel",required:"",placeholder:"01xxxxxxxxx"},null,8,he),[[u,n.phone,void 0,{trim:!0}]]),s.phone?(i(),l("p",ce,p(s.phone),1)):m("",!0)]),t("div",null,[e[31]||(e[31]=t("label",{for:"email"},"Email",-1)),d(t("input",{id:"email","onUpdate:modelValue":e[3]||(e[3]=o=>n.email=o),type:"email",class:"input-light","aria-invalid":!!s.email,autocomplete:"email",placeholder:"name@example.com"},null,8,ke),[[u,n.email,void 0,{trim:!0,lazy:!0}]]),s.email?(i(),l("p",we,p(s.email),1)):m("",!0)]),t("div",null,[e[32]||(e[32]=t("label",{for:"address"},"Address",-1)),d(t("input",{id:"address","onUpdate:modelValue":e[4]||(e[4]=o=>n.address=o),type:"text",class:"input-light",autocomplete:"street-address",placeholder:"House / Street / Area"},null,512),[[u,n.address,void 0,{trim:!0}]])]),t("div",null,[e[33]||(e[33]=t("label",{for:"nid"},"NID",-1)),d(t("input",{id:"nid","onUpdate:modelValue":e[5]||(e[5]=o=>n.nid=o),type:"text",class:"input-light",placeholder:"National ID / Passport"},null,512),[[u,n.nid,void 0,{trim:!0}]])]),t("div",null,[e[34]||(e[34]=t("label",{for:"dob"},"Date of Birth",-1)),d(t("input",{id:"dob","onUpdate:modelValue":e[6]||(e[6]=o=>n.date_of_birth=o),type:"date",class:"input-light",placeholder:"YYYY-MM-DD"},null,512),[[u,n.date_of_birth]])]),t("div",null,[e[36]||(e[36]=t("label",{for:"bloodGroup",class:"text-gray-700 flex items-center gap-2"},"Blood Group",-1)),d(t("select",{id:"bloodGroup","onUpdate:modelValue":e[7]||(e[7]=o=>n.blood=o),class:"input-light"},[e[35]||(e[35]=t("option",{disabled:"",value:""},"Select blood group",-1)),(i(!0),l(b,null,_(g(G),o=>(i(),l("option",{key:o,value:o},p(o),9,Se))),128))],512),[[f,n.blood]])])])]),t("fieldset",Ue,[e[59]||(e[59]=t("legend",{class:"title-md px-2"},"Professional Info",-1)),t("div",Ve,[t("div",null,[e[39]||(e[39]=t("label",{for:"company"},[y("Company"),t("span",{class:"text-red-500"},"*")],-1)),d(t("select",{id:"company","onUpdate:modelValue":e[8]||(e[8]=o=>n.company_id=o),class:"input-light","aria-invalid":!!s.company_id,required:""},[e[38]||(e[38]=t("option",{value:"",disabled:""},"Select a company",-1)),(i(!0),l(b,null,_(g(V).companies,o=>(i(),l("option",{key:o==null?void 0:o.id,value:o==null?void 0:o.id},p(o==null?void 0:o.name),9,Pe))),128))],8,De),[[f,n.company_id]]),s.company_id?(i(),l("p",Me,p(s.company_id),1)):m("",!0)]),t("div",null,[e[40]||(e[40]=t("label",{for:"department"},[y("Department"),t("span",{class:"text-red-500"},"*")],-1)),d(t("select",{id:"department","onUpdate:modelValue":e[9]||(e[9]=o=>n.department_id=o),class:"input-light",disabled:x.value||!n.company_id,"aria-invalid":!!s.department_id,required:""},[t("option",Ee,p(x.value?"Loading departments…":"Select a department"),1),(i(!0),l(b,null,_(g(q).departments,o=>(i(),l("option",{key:o==null?void 0:o.id,value:o==null?void 0:o.id},p(o==null?void 0:o.name),9,qe))),128))],8,Ce),[[f,n.department_id]]),s.department_id?(i(),l("p",Ye,p(s.department_id),1)):m("",!0)]),t("div",null,[e[41]||(e[41]=t("label",{for:"designation"},"Designation",-1)),d(t("select",{id:"designation","onUpdate:modelValue":e[10]||(e[10]=o=>n.designation_id=o),class:"input-light",disabled:x.value||!n.company_id},[t("option",Ne,p(x.value?"Loading designations…":"Select a designation"),1),(i(!0),l(b,null,_(z.value,o=>(i(),l("option",{key:o==null?void 0:o.id,value:o==null?void 0:o.id},p(o==null?void 0:o.title),9,Oe))),128))],8,Le),[[f,n.designation_id]])]),t("div",null,[e[42]||(e[42]=t("label",{for:"joining"},"Joining Date",-1)),d(t("input",{id:"joining","onUpdate:modelValue":e[11]||(e[11]=o=>n.joining_date=o),type:"date",class:"input-light",placeholder:"YYYY-MM-DD"},null,512),[[u,n.joining_date]])]),t("div",null,[e[44]||(e[44]=t("label",{for:"lineType"},"Line Type",-1)),d(t("select",{id:"lineType","onUpdate:modelValue":e[12]||(e[12]=o=>n.type=o),class:"input-light",required:""},e[43]||(e[43]=[le('<option value="" disabled>Select Line Type</option><option value="executive">Executive</option><option value="support_staff">Support Staff</option><option value="doctor">Doctor</option><option value="academy_body">Academy Body</option>',5)]),512),[[f,n.type]])]),t("div",null,[e[45]||(e[45]=t("label",{for:"empType"},"Employment Type",-1)),d(t("select",{id:"empType","onUpdate:modelValue":e[13]||(e[13]=o=>n.employment_type=o),class:"input-light"},[(i(!0),l(b,null,_(g(F),o=>(i(),l("option",{key:o,value:o},p(o),9,je))),128))],512),[[f,n.employment_type]])]),n.employment_type==="Probationary"?(i(),l(b,{key:0},[t("div",null,[e[46]||(e[46]=t("label",{for:"probMonth"},"Probationary Period (month)",-1)),d(t("input",{id:"probMonth","onUpdate:modelValue":e[14]||(e[14]=o=>n.provisional_month=o),type:"number",min:"0",placeholder:"Number of months",class:"input-light"},null,512),[[u,n.provisional_month,void 0,{number:!0}]])]),t("div",null,[e[47]||(e[47]=t("label",{for:"probExt"},"Extended Probationary (month)",-1)),d(t("input",{id:"probExt","onUpdate:modelValue":e[15]||(e[15]=o=>n.extended_provisional_month=o),type:"number",min:"0",placeholder:"Additional months",class:"input-light"},null,512),[[u,n.extended_provisional_month,void 0,{number:!0}]])])],64)):m("",!0),n.employment_type==="Contract"?(i(),l("div",Ae,[e[48]||(e[48]=t("label",{for:"contractMonth"},"Contract (month)",-1)),d(t("input",{id:"contractMonth","onUpdate:modelValue":e[16]||(e[16]=o=>n.contract_month=o),type:"number",min:"0",max:"120",placeholder:"Duration in months",class:"input-light","aria-invalid":!!s.contract_month,required:""},null,8,Te),[[u,n.contract_month,void 0,{number:!0}]]),s.contract_month?(i(),l("p",Be,p(s.contract_month),1)):m("",!0)])):m("",!0),t("div",Ie,[t("div",Re,[t("button",{type:"button",class:"btn-2",onClick:e[17]||(e[17]=o=>M.value=!0)},"Select Weekends"),t("button",{type:"button",class:"btn-ghost border px-3 py-2 rounded",onClick:Q},"Clear")]),v.value?(i(),l("div",Ge,[t("p",null,[e[49]||(e[49]=t("strong",null,"Weekends:",-1)),y(" "+p(v.value.weekends.join(", ")||"—"),1)]),t("p",null,[e[50]||(e[50]=t("strong",null,"Start Month:",-1)),y(" "+p(v.value.start_month||"—"),1)]),t("p",null,[e[51]||(e[51]=t("strong",null,"End Month:",-1)),y(" "+p(v.value.end_month||"—"),1)])])):m("",!0),T(ae,{isOpen:M.value,assign_weekend:v.value,onClose:e[18]||(e[18]=o=>M.value=!1),onUpdate:$},null,8,["isOpen","assign_weekend"])]),t("div",null,[e[53]||(e[53]=t("label",null,"Leave Approval Group",-1)),d(t("select",{"onUpdate:modelValue":e[19]||(e[19]=o=>n.leave_approval_id=o),class:"input-light"},[e[52]||(e[52]=t("option",{value:"",disabled:""},"Select Leave Approval Group",-1)),(i(!0),l(b,null,_(g(D).leaveApprovals,o=>(i(),l(b,{key:o.id},[o.type==="leave"?(i(),l("option",{key:0,value:o.id},p(o.name),9,Fe)):m("",!0)],64))),128))],512),[[f,n.leave_approval_id]])]),t("div",null,[e[55]||(e[55]=t("label",null,"Other Approval Group",-1)),d(t("select",{"onUpdate:modelValue":e[20]||(e[20]=o=>n.other_approval_id=o),class:"input-light"},[e[54]||(e[54]=t("option",{value:"",disabled:""},"Select Other Approval Group",-1)),(i(!0),l(b,null,_(g(D).leaveApprovals,o=>(i(),l(b,{key:o.id},[o.type==="other"?(i(),l("option",{key:0,value:o.id},p(o.name),9,$e)):m("",!0)],64))),128))],512),[[f,n.other_approval_id]])]),t("div",null,[e[57]||(e[57]=t("label",{for:"active"},"Active Status",-1)),d(t("select",{id:"active","onUpdate:modelValue":e[21]||(e[21]=o=>n.is_active=o),class:"input-light"},e[56]||(e[56]=[t("option",{value:!0},"Active",-1),t("option",{value:!1},"Inactive",-1)]),512),[[f,n.is_active]])]),n.is_active?m("",!0):(i(),l("div",ze,[e[58]||(e[58]=t("label",{for:"inactiveNote"},"Inactive Note",-1)),d(t("input",{id:"inactiveNote","onUpdate:modelValue":e[22]||(e[22]=o=>n.note=o),type:"text",class:"input-light",placeholder:"Reason / context…",required:!n.is_active},null,8,We),[[u,n.note,void 0,{trim:!0}]])]))])]),t("fieldset",He,[e[66]||(e[66]=t("legend",{class:"title-md px-2"},"Technical Info",-1)),t("div",Je,[t("div",null,[e[61]||(e[61]=t("label",{for:"role"},[y("Role"),t("span",{class:"text-red-500"},"*")],-1)),d(t("select",{id:"role","onUpdate:modelValue":e[23]||(e[23]=o=>n.role=o),class:"input-light","aria-invalid":!!s.role,required:""},e[60]||(e[60]=[t("option",{value:"employee"},"Employee",-1),t("option",{value:"admin"},"Admin",-1),t("option",{value:"super_admin"},"Super Admin",-1),t("option",{value:"developer"},"Developer",-1)]),8,Qe),[[f,n.role]]),s.role?(i(),l("p",Ke,p(s.role),1)):m("",!0)]),t("div",null,[e[62]||(e[62]=t("label",{for:"deviceId"},"Device User ID",-1)),d(t("input",{id:"deviceId","onUpdate:modelValue":e[24]||(e[24]=o=>n.device_user_id=o),type:"number",inputmode:"numeric",placeholder:"3456",class:"input-light"},null,512),[[u,n.device_user_id,void 0,{number:!0}]])]),t("div",null,[e[63]||(e[63]=t("label",{for:"empId"},"Employee ID",-1)),d(t("input",{id:"empId","onUpdate:modelValue":e[25]||(e[25]=o=>n.employee_id=o),type:"text",class:"input-light",placeholder:"Employee ID : M123456",autocomplete:"off"},null,512),[[u,n.employee_id,void 0,{trim:!0}]])]),t("div",null,[e[65]||(e[65]=t("label",{for:"password"},"Password",-1)),t("div",Xe,[d(t("input",{id:"password","onUpdate:modelValue":e[26]||(e[26]=o=>n.password=o),type:U.value?"text":"password",class:"`${input-light} pr-10`",autocomplete:"new-password",placeholder:"Create a secure password"},null,8,Ze),[[ie,n.password]]),t("button",{type:"button",class:"absolute inset-y-0 right-2 px-1 text-gray-600",onClick:e[27]||(e[27]=o=>U.value=!U.value),"aria-label":U.value?"Hide password":"Show password"},e[64]||(e[64]=[t("i",{class:"showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"},null,-1)]),8,et)])])])]),t("div",tt,[T(r,{to:{name:"UserList",query:{company:g(w).query.company}},class:"px-4 py-2 rounded border hover:bg-gray-50"},{default:se(()=>e[67]||(e[67]=[y(" Cancel ")])),_:1,__:[67]},8,["to"]),t("button",{type:"submit",class:"bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 disabled:opacity-60",disabled:S.value},[S.value?(i(),l("span",lt,e[68]||(e[68]=[t("svg",{class:"animate-spin h-4 w-4",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1),y(" Saving… ")]))):(i(),l("span",nt,"Save"))],8,ot)])],32)])])}}};export{ft as default};
