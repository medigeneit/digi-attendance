import{_ as Y,u as Q,f as G,D as J,r as c,x as v,h as K,q as k,p as X,c as r,o as d,a as e,j as D,t as n,d as F,m as S,l as Z,F as A,e as $,H as ee,n as te,s as f,b as ae,k as T}from"./index-BVAUvyQc.js";import{L as se}from"./LoaderView-CmiNrmpL.js";import{_ as le}from"./EmployeeFilter-B9vRvaHT.js";import{_ as ne}from"./FlexibleDatePicker-BPHedLTi.js";import{u as oe}from"./attendance-J-sW0Uj7.js";import{u as de}from"./company-BNZcqZNV.js";import"./department-CnsS-5n4.js";import"./EmployeeDropdownInput-B1psgFMp.js";import"./SelectDropdown-Czgb2E2_.js";import"./UserChip-DG7uUT6R.js";import"./user-DqlguZgg.js";const ie={class:"px-4 space-y-6"},re={class:"report-hero glass-panel"},ue={class:"report-hero__left"},ce={class:"title-md md:title-lg"},pe={class:"glass-panel space-y-3 compact-panel relative z-50"},_e={class:"flex flex-wrap gap-2"},ye={class:"relative gap-4"},me=["value"],ve={key:1},fe={key:0,class:"empty-state glass-panel"},he={key:1,class:"empty-state glass-panel"},be={key:2,class:"space-y-3"},xe={class:"compact-stats"},we={class:"table-shell"},ke={class:"table-scroll"},De={class:"min-w-full table-auto border-collapse"},Se={class:"text-[11px] text-center"},Ae={class:"td"},$e={class:"td text-left"},ge={class:"font-semibold text-slate-800"},Ce={class:"text-[11px] text-slate-400"},Le={class:"td text-left"},Ee={class:"td"},Pe={class:"td"},qe=["title"],Fe=["title"],Te=["title"],Ve={class:"td"},Ne={class:"td"},Re={class:"td"},Be={class:"td"},He={__name:"TodayAttendanceReport",setup(Me){const g=Q(),p=G(),V=de(),y=oe(),{dailyLogs:C}=J(y),N=c(p.query.company_id||""),R=c(p.query.department_id||""),h=c(p.query.employee_id||""),u=c(p.query.date||y.selectedDate||""),i=c(p.query.status||"all"),B=c(p.query.line_type||"all"),H=[{label:"All Status",value:"all"},{label:"Present",value:"Present"},{label:"Absent",value:"Absent"},{label:"Weekend",value:"Weekend"},{label:"Holiday",value:"Holiday"},{label:"Leave",value:"Leave"}],L=s=>String(s).padStart(2,"0"),E=s=>{const a=s||u.value;if(!a){const w=new Date;return{year:w.getFullYear(),month:w.getMonth()+1,day:w.getDate()}}const[o,t,m]=a.split("-");return{year:Number(o)||new Date().getFullYear(),month:Number(t)||new Date().getMonth()+1,day:Number(m)||1}},M=E(),_=c({...M}),l=c({company_id:N.value,department_id:R.value,line_type:B.value,employee_id:h.value}),b=v(()=>Array.isArray(C.value)?C.value:[]),U=v(()=>`Today ${i.value&&i.value!=="all"?i.value:"Attendance"} Report`),I=v(()=>{const s=b.value,a=s.length,o=t=>s.filter(m=>m.status===t).length;return[{label:"Records",value:a,tone:"neutral"},{label:"Present",value:o("Present"),tone:"success"},{label:"Leave/Holiday",value:o("Leave")+o("Holiday"),tone:"info"},{label:"Absent",value:o("Absent"),tone:"danger"}]}),z=v(()=>!!l.value.company_id),P=async()=>{const{company_id:s,department_id:a,employee_id:o,line_type:t}=l.value;(s||i.value&&i.value!=="all")&&await y.getTodayAttendanceReport({companyId:l.value.company_id,departmentId:a,employee_id:o,line_type:t,month:u.value,status:i.value})},x=()=>{const s={company_id:l.value.company_id,department_id:l.value.department_id,line_type:l.value.line_type,employee_id:l.value.employee_id,date:u.value,status:i.value};Object.entries(s).some(([o,t])=>p.query[o]!==String(t))&&g.replace({query:s})},j=()=>{var s;return y.attendanceDownloadExcel(l.value.company_id,(s=h.value)==null?void 0:s.id,l.value.line_type,u.value,i.value)},O=()=>{var s;return y.attendanceDownloadPdf(l.value.company_id,(s=h.value)==null?void 0:s.id,l.value.line_type,u.value,i.value)},q=s=>{if(s.absent_reason)return s.absent_reason.includes("Approved")?{text:s.absent_reason,tone:"success"}:s.absent_reason.includes("Pending")?{text:s.absent_reason,tone:"warning"}:{text:s.absent_reason,tone:"neutral"};const a={Present:"success",Holiday:"info",Leave:"neutral",Weekend:"neutral",Absent:"danger"};return{text:s.status,tone:a[s.status]||"neutral"}},W=()=>g.go(-1);return K(async()=>{await V.fetchCompanies(),await P()}),k(_,s=>{if(!s)return;const a=`${s.year}-${L(s.month)}-${L(s.day)}`;u.value!==a&&(u.value=a)},{deep:!0}),k(u,s=>{if(!s)return;const a=E(s);(a.year!==_.value.year||a.month!==_.value.month||a.day!==_.value.day)&&(_.value=a),x()}),k(i,()=>{x()}),(s,a)=>{const o=X("router-link");return d(),r("div",ie,[e("div",re,[e("div",ue,[e("button",{class:"btn-3 !h-10 !w-10 rounded-full shadow-sm",onClick:W},a[6]||(a[6]=[e("i",{class:"far fa-arrow-left"},null,-1)])),e("div",null,[a[7]||(a[7]=e("p",{class:"hero-eyebrow"},"Today overview",-1)),e("h1",ce,n(U.value),1)])]),e("div",{class:"report-hero__actions"},[e("button",{type:"button",class:"btn-1 hero-action",onClick:j},a[8]||(a[8]=[e("i",{class:"far fa-file-excel text-green-500"},null,-1),e("span",null,"Excel",-1)])),e("button",{type:"button",class:"btn-1 hero-action",onClick:O},a[9]||(a[9]=[e("i",{class:"fal fa-file-pdf text-red-500"},null,-1),e("span",null,"PDF",-1)]))])]),e("div",pe,[e("div",_e,[F(le,{company_id:l.value.company_id,"onUpdate:company_id":a[1]||(a[1]=t=>l.value.company_id=t),department_id:l.value.department_id,"onUpdate:department_id":a[2]||(a[2]=t=>l.value.department_id=t),employee_id:l.value.employee_id,"onUpdate:employee_id":a[3]||(a[3]=t=>l.value.employee_id=t),line_type:l.value.line_type,"onUpdate:line_type":a[4]||(a[4]=t=>l.value.line_type=t),"with-type":!0,"initial-value":s.$route.query,onFilterChange:x},{default:S(()=>[e("div",ye,[Z(e("select",{id:"userSelect","onUpdate:modelValue":a[0]||(a[0]=t=>i.value=t),class:"input-1 py-0.5"},[(d(),r(A,null,$(H,t=>e("option",{key:t.value,value:t.value},n(t.label),9,me)),64))],512),[[ee,i.value]]),a[10]||(a[10]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Status",-1))])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),F(ne,{modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=t=>_.value=t),"show-year":!1,"show-month":!1,"show-date":!0,label:"Month"},null,8,["modelValue"]),e("button",{type:"button",onClick:P,class:"btn-2 rounded py-0.5 px-3"},"Search")])]),te(y).isLoading?(d(),D(se,{key:0})):(d(),r("div",ve,[z.value?b.value.length===0?(d(),r("div",he,a[12]||(a[12]=[e("p",{class:"text-base font-semibold text-slate-700"},"No records found",-1),e("p",{class:"text-sm text-gray-500"},"Adjust filters or pick a different date/status.",-1)]))):(d(),r("div",be,[e("div",xe,[(d(!0),r(A,null,$(I.value,t=>(d(),r("div",{key:t.label,class:f(["compact-stats__chip",`compact-stats__chip--${t.tone}`])},[e("span",null,n(t.label),1),e("strong",null,n(t.value),1)],2))),128))]),e("div",we,[e("div",ke,[e("table",De,[a[15]||(a[15]=e("thead",{class:"sticky top-0 z-10 bg-slate-50"},[e("tr",{class:"text-[11px] text-slate-600"},[e("th",{class:"th"},"#"),e("th",{class:"th text-left"},"Employee"),e("th",{class:"th text-left"},"Department"),e("th",{class:"th"},"Date"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Shift"),e("th",{class:"th"},"Entry"),e("th",{class:"th"},"Exit"),e("th",{class:"th"},"Hours"),e("th",{class:"th"},"Late"),e("th",{class:"th"},"Early"),e("th",{class:"th"},"Status")])],-1)),e("tbody",Se,[(d(!0),r(A,null,$(b.value,(t,m)=>(d(),r("tr",{key:`${t==null?void 0:t.date}-${m}`,class:"table-row"},[e("td",Ae,n(m+1),1),e("td",$e,[e("p",ge,n(t.user_name),1),e("p",Ce,"ID: "+n(t.user_id||"-"),1)]),e("td",Le,n(t.department),1),e("td",Ee,n(t.date),1),e("td",Pe,n(t.weekday),1),e("td",{class:"td",title:`${t.shift_start_time} to ${t.shift_end_time}`},n(t.shift_name),9,qe),e("td",{class:f(["td td--alert",{"td--danger":t.late_duration}]),title:`Device: ${t.entry_device}`},n(t.entry_time),11,Fe),e("td",{class:f(["td td--alert",{"td--danger":t.early_leave_duration}]),title:`Device: ${t.exit_device}`},n(t.exit_time),11,Te),e("td",Ve,n(t.working_hours),1),e("td",Ne,n(t.late_duration||"-"),1),e("td",Re,n(t.early_leave_duration||"-"),1),e("td",Be,[e("div",{class:f(["status-chip",`status-chip--${q(t).tone}`])},[ae(n(q(t).text)+" ",1),t.application_id?(d(),D(o,{key:0,to:{name:"LeaveApplicationShow",params:{id:t.application_id}},class:"status-link"},{default:S(()=>a[13]||(a[13]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[13]},1032,["to"])):T("",!0),t.exchange_application_id?(d(),D(o,{key:1,to:{name:"ExchangeOffdayShow",params:{id:t.exchange_application_id}},class:"status-link"},{default:S(()=>a[14]||(a[14]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[14]},1032,["to"])):T("",!0)],2)])]))),128))])])])])])):(d(),r("div",fe,a[11]||(a[11]=[e("p",{class:"text-base font-semibold text-rose-500"},"Select a company to see today's logs.",-1),e("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.",-1)])))]))])}}},Xe=Y(He,[["__scopeId","data-v-ee741322"]]);export{Xe as default};
