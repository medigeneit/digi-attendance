import{r as b,e as w,A as I,k as C,c as u,o as n,m as B,f as y,a as t,w as M,g as i,v as f,Q as E,t as p,C as T,n as _,l as N,h as x}from"./index-D2ntkdUR.js";import{u as h}from"./useTaskStore-CEpxYBsP.js";import{S as R}from"./SectionLoading-Bk1xpN7Z.js";const F={class:"p-4"},L={key:1,class:"text-center py-4 text-gray-500"},O={class:"mb-4"},P={class:"mb-4"},$={class:"flex gap-1 items-center"},G={class:"flex gap-1 items-center"},j={key:0,class:"mb-4"},z={class:"grid grid-cols-2 gap-4 mb-4"},A={class:"grid grid-cols-2 gap-4 mb-4 mt-12"},K={class:"mb-4"},Q={class:"block text-gray-600 text-sm mb-1 font-medium"},Y={class:"mb-4"},H={class:"block text-gray-600 text-sm mb-1 font-medium"},J={class:"mb-4"},W={key:1,class:"mb-4 text-red-500 font-medium"},X={class:"flex items-center gap-4"},Z=["disabled"],ee={key:3,class:"text-center py-4 text-red-500"},le={__name:"TaskEditForm",props:{taskId:{type:[String,Number],required:!0}},emits:["updated","cancel"],setup(q,{emit:U}){const k=q,S=U,m=h(),s=b(),r=b(!1),D=b([]),a=b({title:"",requirement_id:"",user_ids:"",status:"PENDING",progress:0,description:"",is_important:!1,is_urgent:!1,started_at:"",deadline:""}),c=l=>{if(!l)return"";try{const e=new Date(l);if(isNaN(e))return"";const d=e.getFullYear(),v=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0");return`${d}-${v}-${g}`}catch{return""}};w(async()=>{var l;r.value=!0,s.value=(l=await m.fetchTask(k.taskId,{},{fetchOnly:!0,loadingBeforeFetch:!1}))==null?void 0:l.task,console.log({task:s.value}),D.value=s.value.users,r.value=!1,a.value={title:s.value.title,requirement_id:s.value.requirement_id,user_ids:s.value.users.map(e=>e.id).join(","),status:s.value.status,progress:s.value.progress,description:s.value.description,is_important:s.value.is_important,is_urgent:s.value.is_urgent,started_at:c(s.value.started_at),deadline:c(s.value.deadline)}}),I(()=>s.value,l=>{a.value={title:l.title,requirement_id:l.requirement_id,user_ids:l.users.map(e=>e.id).join(","),status:l.status,progress:s.value.progress,description:l.description,is_important:s.value.is_important,is_urgent:s.value.is_urgent,started_at:c(s.value.started_at),deadline:c(s.value.deadline)}});const V=async()=>{var e;r.value=!0;const l={...a.value,user_ids:((e=D.value)==null?void 0:e.map(d=>Number(d.id)))||[]};await m.updateTask(k.taskId,l,{loadingBeforeFetch:!1}),r.value=!1,S("updated")};return(l,e)=>{var v,g;const d=C("RequiredIcon");return n(),u("div",F,[r.value?(n(),B(R,{key:0})):y("",!0),e[17]||(e[17]=t("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Edit Task",-1)),r.value?(n(),u("div",L,"Loading form...")):s.value?(n(),u("form",{key:2,onSubmit:M(V,["prevent"])},[t("div",O,[e[8]||(e[8]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task Title",-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.title=o),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[f,a.value.title]])]),t("div",P,[t("label",$,[i(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=o=>a.value.is_important=o),class:"size-4"},null,512),[[E,a.value.is_important]]),e[9]||(e[9]=t("span",{class:"block text-gray-600 text-base pt-1 mb-1 font-medium"},"Important",-1))]),t("label",G,[i(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=o=>a.value.is_urgent=o),class:"size-4"},null,512),[[E,a.value.is_urgent]]),e[10]||(e[10]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Urgent",-1))])]),s.value.requirement?(n(),u("div",j,[e[11]||(e[11]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Requirement",-1)),t("div",null,[t("p",null,p((g=(v=s.value)==null?void 0:v.requirement)==null?void 0:g.title),1)])])):y("",!0),t("div",z,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Status",-1)),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.status=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[12]||(e[12]=[t("option",null,"PENDING",-1),t("option",null,"IN_PROGRESS",-1),t("option",null,"COMPLETED",-1),t("option",null,"BLOCKED",-1)]),512),[[T,a.value.status]])])]),t("div",A,[t("div",K,[t("label",Q,[e[14]||(e[14]=_(" Start Date ")),N(d),_(" "+p(a.value.started_at),1)]),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.started_at=o),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[f,a.value.started_at]])]),t("div",Y,[t("label",H,[e[15]||(e[15]=_(" Deadline ")),N(d)]),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.deadline=o),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[f,a.value.deadline]])])]),t("div",J,[e[16]||(e[16]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Description",-1)),i(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.description=o),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[f,a.value.description]])]),x(m).error?(n(),u("div",W,p(x(m).error),1)):y("",!0),t("div",X,[t("button",{disabled:r.value,type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-semibold px-5 py-2 rounded transition"},p(r.value?"Updating...":"Update Task"),9,Z),t("button",{type:"button",onClick:e[7]||(e[7]=o=>S("close")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32)):(n(),u("div",ee,p(x(m).error||"Task not found."),1))])}}};export{le as _};
