import{B as W,r as v,z as K,p as L,q as A,e as J,c as m,g as O,o as i,a as e,t as d,w as P,h as D,A as G,F as T,x as R,k as h,y as x,v as j,a1 as Q,f as H,j as q}from"./index-C76aDwfE.js";import{u as X}from"./company-J18bz3xj.js";import{u as Y}from"./user-CZixE1UT.js";import{_ as M}from"./EmployeeDropdownInput-D6aXxDYP.js";import{_ as Z,a as ee}from"./HeaderWithButtons-BREb4F_b.js";import{L as te}from"./LoaderView-TjvX7hWP.js";import{u as oe}from"./department-Ca-HxMXR.js";import"./SelectDropdown-GjBTHKO5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BB7knLC2.js";const se={key:0,class:"modal-bg"},ae={class:"modal-card"},le={class:"text-lg font-semibold"},ne={class:"mb-4"},re=["value"],de={class:"mb-4"},ie={class:"mb-4"},ce={class:"mb-4"},ue={class:"mb-4"},me={class:"mb-4"},pe={class:"mb-4"},_e={class:"mb-4"},ye={class:"mb-4"},fe={class:"mb-4"},be={class:"flex justify-end"},ve={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},he={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup(F,{emit:p}){const r=F,y=p,_=X(),c=Y(),{companies:N,employees:E}=W(_),{users:g}=W(c),C=v(null),w=v(""),V=v(""),k=v(!1),U=v(!1),t=K({id:null,company_id:"",incharge_id:"",coordinator_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:"",name:"",short_name:"",description:"",status:"Active"}),l=L(()=>w.value?w.value.id:null),f=L(()=>V.value?V.value.id:null);A(l,s=>{t.incharge_id=s}),A(f,s=>{t.coordinator_id=s});const b=()=>{k.value=!1,t.id=null,t.company_id="",t.incharge_id="",t.coordinator_id="",t.name="",t.short_name="",t.description="",t.status="Active",t.operational_admin_user_id="",t.recommend_by_user_id="",t.approved_by_user_id=""};A(()=>r.department,s=>{var o,a,u,B,z;s&&typeof s=="object"&&Object.keys(s).length>0?(k.value=!0,t.id=s.id||null,t.company_id=s.company_id||"",t.incharge_id=((o=s.in_charge)==null?void 0:o.id)||"",t.coordinator_id=((a=s.coordinator)==null?void 0:a.id)||"",t.name=s.name||"",t.short_name=s.short_name||"",t.description=s.description||"",t.status=s.status||"Active",t.operational_admin_user_id=((u=s.operational_admin)==null?void 0:u.id)||"",t.recommend_by_user_id=((B=s.recommend_by)==null?void 0:B.id)||"",t.approved_by_user_id=((z=s.approved_by)==null?void 0:z.id)||""):b()},{immediate:!0,deep:!0}),A(()=>r.show,async s=>{s&&!U.value&&await $()}),A(()=>t.company_id,async s=>{s&&await S(s)});const I=()=>{console.log({departmentForm:t}),y("save",{...t}),b(),n()},n=()=>{b(),y("close")},$=async()=>{try{await _.fetchCompanies(),U.value=!0}catch(s){console.error("Failed to fetch companies:",s)}},S=async s=>{s&&(await _.fetchEmployee(s),w.value=_.employees.find(o=>{var a,u;return o.id===((u=(a=r.department)==null?void 0:a.in_charge)==null?void 0:u.id)}))};return J(async()=>{var s;console.log("DepartmentModal: onMounted"),await $(),r.department.company_id&&await S(r.department.company_id),await c.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"}),V.value=(s=c.users)==null?void 0:s.find(o=>{var a,u;return o.id===((u=(a=r.department)==null?void 0:a.coordinator)==null?void 0:u.id)})}),(s,o)=>F.show?(i(),m("div",se,[e("div",ae,[e("h2",le,d(k.value?"Edit Department":"Add Department"),1),e("form",{onSubmit:P(I,["prevent"])},[e("div",{class:"max-h-[70vh] overflow-y-auto border-y my-4",ref_key:"formInputs",ref:C},[e("div",ne,[o[11]||(o[11]=e("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),D(e("select",{id:"company_id","onUpdate:modelValue":o[0]||(o[0]=a=>t.company_id=a),class:"w-full border rounded px-3 py-2",required:""},[o[10]||(o[10]=e("option",{value:"",disabled:""},"Select a company",-1)),(i(!0),m(T,null,R(h(N),a=>(i(),m("option",{key:a.id,value:a.id},d(a.name),9,re))),128))],512),[[G,t.company_id]])]),e("div",de,[o[12]||(o[12]=e("label",{for:"incharge_id",class:"block text-sm font-medium mb-2"},"In-Charge",-1)),x(M,{options:h(E),modelValue:t.incharge_id,"onUpdate:modelValue":o[1]||(o[1]=a=>t.incharge_id=a),label:"label",placeholder:"--Select--",class:"h-10",containment:C.value},null,8,["options","modelValue","containment"])]),e("div",ie,[o[13]||(o[13]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Coordinator",-1)),x(M,{options:h(g),modelValue:t.coordinator_id,"onUpdate:modelValue":o[2]||(o[2]=a=>t.coordinator_id=a),label:"label",placeholder:"--Select--",class:"h-10",containment:C.value},null,8,["options","modelValue","containment"])]),e("div",ce,[o[14]||(o[14]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Operational Admin",-1)),x(M,{options:h(g),modelValue:t.operational_admin_user_id,"onUpdate:modelValue":o[3]||(o[3]=a=>t.operational_admin_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",ue,[o[15]||(o[15]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Recommend By",-1)),x(M,{options:h(g),modelValue:t.recommend_by_user_id,"onUpdate:modelValue":o[4]||(o[4]=a=>t.recommend_by_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",me,[o[16]||(o[16]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Approved By",-1)),x(M,{options:h(g),modelValue:t.approved_by_user_id,"onUpdate:modelValue":o[5]||(o[5]=a=>t.approved_by_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",pe,[o[17]||(o[17]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),D(e("input",{id:"name","onUpdate:modelValue":o[6]||(o[6]=a=>t.name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[j,t.name]])]),e("div",_e,[o[18]||(o[18]=e("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),D(e("input",{id:"short_name","onUpdate:modelValue":o[7]||(o[7]=a=>t.short_name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[j,t.short_name]])]),e("div",ye,[o[19]||(o[19]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),D(e("textarea",{id:"description","onUpdate:modelValue":o[8]||(o[8]=a=>t.description=a),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[j,t.description]])]),e("div",fe,[o[21]||(o[21]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),D(e("select",{id:"status","onUpdate:modelValue":o[9]||(o[9]=a=>t.status=a),class:"w-full border rounded px-3 py-2",required:""},o[20]||(o[20]=[e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)]),512),[[G,t.status]])])],512),e("div",be,[e("button",{type:"button",onClick:n,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",ve,d(k.value?"Update":"Create"),1)])],32)])])):O("",!0)}},xe={class:"my-container space-y-4"},ge={key:0,class:"text-center py-4"},we={key:1,class:"space-y-4"},ke={class:"title-md"},Ce={class:"overflow-x-auto"},Ve={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},$e={class:"text-gray-600 text-sm"},Se={class:"py-3 px-2 text-center"},Ae={class:"py-3 px-2 text-left"},De={class:"py-3 px-4 text-left"},Me={class:"whitespace-nowrap"},Ee={class:"whitespace-nowrap"},Ue={class:"whitespace-nowrap"},Ie={class:"py-3 px-2 text-center"},Be={class:"py-3 px-2 text-center"},Fe={class:"py-3 px-2 text-center"},Ne={class:"py-3 px-2 text-center"},je={class:"py-3 px-2 text-center"},qe={class:"flex item-center justify-center gap-4"},Le=["onClick"],Oe=["onClick"],Xe={__name:"DepartmentList",setup(F){const p=oe(),r=Q(),y=v(!1),_=v(!1),c=v(null),N=()=>{c.value=null,y.value=!0},E=()=>{y.value=!1},g=t=>{c.value=t,y.value=!0},C=t=>{c.value=t,_.value=!0},w=()=>{_.value=!1},V=async t=>{try{t.id?(await p.updateDepartment(t.id,t),r.success("Department updated successfully!"),await p.fetchDepartments()):(await p.createDepartment(t),r.success("Department added successfully!"))}catch(l){r.error("Failed to save department!"),console.error("Error handling save:",l)}finally{E()}},k=async()=>{var t;if(!((t=c.value)!=null&&t.id)){r.error("Invalid department selected for deletion!");return}try{await p.deleteDepartment(c.value.id),r.success("Department deleted successfully!")}catch(l){r.error("Failed to delete department!"),console.error("Error deleting department:",l)}finally{w()}},U=L(()=>{const t={};return p.departments.forEach(l=>{var b;const f=((b=l.company)==null?void 0:b.name)||"Unknown Company";t[f]||(t[f]=[]),t[f].push(l)}),t});return J(async()=>{try{await p.fetchDepartments()}catch(t){r.error("Failed to fetch departments!"),console.error("Error fetching departments:",t)}}),(t,l)=>{var f;return i(),m("div",xe,[x(Z,{title:"Department List",onAdd:N}),h(p).loading?(i(),m("div",ge,[x(te)])):(i(),m("div",we,[(i(!0),m(T,null,R(U.value,(b,I)=>(i(),m("div",{key:I},[e("h2",ke,d(I),1),e("div",Ce,[e("table",Ve,[l[5]||(l[5]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-center"},"#"),e("th",{class:"py-3 px-2 text-left"},"Department Name"),e("th",{class:"py-3 px-4 text-left whitespace-nowrap"}," Coordinator, In-Charge & Operational Admin "),e("th",{class:"py-3 px-2 text-center"},"Employee"),e("th",{class:"py-3 px-2 text-center"},"Recommend By"),e("th",{class:"py-3 px-2 text-center"},"Approved By"),e("th",{class:"py-3 px-2 text-center"},"Status"),e("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),e("tbody",$e,[(i(!0),m(T,null,R(b,(n,$)=>{var S,s,o,a,u;return i(),m("tr",{key:$,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",Se,d($+=1),1),e("td",Ae,[e("div",null,d(n.name),1),e("strong",null,d(n.short_name),1)]),e("td",De,[e("div",Me,[l[0]||(l[0]=e("span",{class:"text-gray-400"},"Coordinator: ",-1)),q(" "+d(((S=n.coordinator)==null?void 0:S.name)||"-"),1)]),e("div",Ee,[l[1]||(l[1]=e("span",{class:"text-gray-400"},"In-Charge: ",-1)),q(" "+d(((s=n.in_charge)==null?void 0:s.name)||"-"),1)]),e("div",Ue,[l[2]||(l[2]=e("span",{class:"text-gray-400"},"Operational Admin: ",-1)),q(" "+d(((o=n.operational_admin)==null?void 0:o.name)||"-"),1)])]),e("td",Ie,d(n==null?void 0:n.users_count),1),e("td",Be,d(((a=n==null?void 0:n.recommend_by)==null?void 0:a.name)||"-"),1),e("td",Fe,d(((u=n==null?void 0:n.approved_by)==null?void 0:u.name)||"-"),1),e("td",Ne,d(n.status),1),e("td",je,[e("div",qe,[e("button",{onClick:B=>g(n),class:"text-blue-600 hover:text-blue-800"},l[3]||(l[3]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Le),e("button",{onClick:B=>C(n),class:"text-red-600 hover:text-red-800"},l[4]||(l[4]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Oe)])])])}),128))])])])]))),128))])),y.value?(i(),H(he,{key:2,show:y.value,department:c.value,onClose:E,onSave:V},null,8,["show","department"])):O("",!0),_.value?(i(),H(ee,{key:3,show:_.value,title:"Delete Department",message:`Are you sure you want to delete ${(f=c.value)==null?void 0:f.name}?`,onClose:w,onConfirm:k},null,8,["show","message"])):O("",!0)])}}};export{Xe as default};
