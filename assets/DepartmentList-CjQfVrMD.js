import{s as H,r as y,z as Y,x as T,A as U,e as P,c as m,g as j,o as d,a as e,t as r,w as Z,f as z,h as I,B as J,F as R,y as W,k as v,n as h,v as O,L as ee,q as K,j as te}from"./index-YNh9CR68.js";import{u as oe}from"./company-BgjCppzF.js";import{u as se}from"./user-BRUqC-GZ.js";import{_ as B}from"./EmployeeDropdownInput-8jEFTRy5.js";import{L as Q}from"./LoaderView-CV8zyZt5.js";import{_ as ae}from"./DeleteModal-D9LUcq-D.js";import{_ as le}from"./HeaderWithButtons-CP7h39uE.js";import{u as ne}from"./department-D_o3WTfC.js";import"./SelectDropdown-BVSBbLo9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-DIaSvEdK.js";const ie={key:0,class:"modal-bg"},re={class:"modal-card relative"},de={class:"text-lg font-semibold"},ce={class:"mb-4"},ue=["value"],me={class:"mb-4"},pe={class:"mb-4"},_e={class:"mb-4"},ye={class:"mb-4"},fe={class:"mb-4"},be={class:"mb-4"},ve={class:"mb-4"},he={class:"mb-4"},xe={class:"mb-4"},ge={class:"flex justify-end"},we={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},ke={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup(N,{emit:p}){const i=N,f=p,_=oe(),c=se(),{companies:q,employees:L}=H(_),{users:x}=H(c),V=y(null),g=y(""),$=y(""),w=y(!1),F=y(!1),t=Y({id:null,company_id:"",incharge_id:"",coordinator_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:"",name:"",short_name:"",description:"",status:"Active"}),n=y(!1),b=T(()=>g.value?g.value.id:null),k=T(()=>$.value?$.value.id:null);U(b,s=>{t.incharge_id=s}),U(k,s=>{t.coordinator_id=s});const C=()=>{w.value=!1,t.id=null,t.company_id="",t.incharge_id="",t.coordinator_id="",t.name="",t.short_name="",t.description="",t.status="Active",t.operational_admin_user_id="",t.recommend_by_user_id="",t.approved_by_user_id=""};U(()=>i.department,s=>{var o,a,u,M,E;s&&typeof s=="object"&&Object.keys(s).length>0?(w.value=!0,t.id=s.id||null,t.company_id=s.company_id||"",t.incharge_id=((o=s.in_charge)==null?void 0:o.id)||"",t.coordinator_id=((a=s.coordinator)==null?void 0:a.id)||"",t.name=s.name||"",t.short_name=s.short_name||"",t.description=s.description||"",t.status=s.status||"Active",t.operational_admin_user_id=((u=s.operational_admin)==null?void 0:u.id)||"",t.recommend_by_user_id=((M=s.recommend_by)==null?void 0:M.id)||"",t.approved_by_user_id=((E=s.approved_by)==null?void 0:E.id)||""):C()},{immediate:!0,deep:!0}),U(()=>i.show,async s=>{s&&!F.value&&await A()}),U(()=>t.company_id,async s=>{s&&await D(s)});const l=()=>{console.log({departmentForm:t}),f("save",{...t}),C(),S()},S=()=>{C(),f("close")},A=async()=>{try{await _.fetchCompanies(),F.value=!0}catch(s){console.error("Failed to fetch companies:",s)}},D=async s=>{s&&(await _.fetchEmployee(s),g.value=_.employees.find(o=>{var a,u;return o.id===((u=(a=i.department)==null?void 0:a.in_charge)==null?void 0:u.id)}))};return P(async()=>{var s;n.value="loading",console.log("DepartmentModal: onMounted"),await A(),i.department.company_id&&await D(i.department.company_id),await c.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"}),$.value=(s=c.users)==null?void 0:s.find(o=>{var a,u;return o.id===((u=(a=i.department)==null?void 0:a.coordinator)==null?void 0:u.id)}),n.value=""}),(s,o)=>N.show?(d(),m("div",ie,[e("div",re,[e("h2",de,r(w.value?"Edit Department":"Add Department"),1),e("form",{onSubmit:Z(l,["prevent"])},[n.value=="loading"?(d(),z(Q,{key:0,class:"shadow-none absolute inset-0 z-10 h-full flex items-center justify-center bg-opacity-80"})):j("",!0),e("div",{class:"max-h-[70vh] overflow-y-auto border-y my-4",ref_key:"formInputs",ref:V},[e("div",ce,[o[11]||(o[11]=e("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),I(e("select",{id:"company_id","onUpdate:modelValue":o[0]||(o[0]=a=>t.company_id=a),class:"w-full border rounded px-3 py-2",required:""},[o[10]||(o[10]=e("option",{value:"",disabled:""},"Select a company",-1)),(d(!0),m(R,null,W(v(q),a=>(d(),m("option",{key:a.id,value:a.id},r(a.name),9,ue))),128))],512),[[J,t.company_id]])]),e("div",me,[o[12]||(o[12]=e("label",{for:"incharge_id",class:"block text-sm font-medium mb-2"},"In-Charge",-1)),h(B,{options:v(L),modelValue:t.incharge_id,"onUpdate:modelValue":o[1]||(o[1]=a=>t.incharge_id=a),label:"label",placeholder:"--Select--",class:"h-10",containment:V.value},null,8,["options","modelValue","containment"])]),e("div",pe,[o[13]||(o[13]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Coordinator",-1)),h(B,{options:v(x),modelValue:t.coordinator_id,"onUpdate:modelValue":o[2]||(o[2]=a=>t.coordinator_id=a),label:"label",placeholder:"--Select--",class:"h-10",containment:V.value},null,8,["options","modelValue","containment"])]),e("div",_e,[o[14]||(o[14]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Operational Admin",-1)),h(B,{options:v(x),modelValue:t.operational_admin_user_id,"onUpdate:modelValue":o[3]||(o[3]=a=>t.operational_admin_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",ye,[o[15]||(o[15]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Recommend By",-1)),h(B,{options:v(x),modelValue:t.recommend_by_user_id,"onUpdate:modelValue":o[4]||(o[4]=a=>t.recommend_by_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",fe,[o[16]||(o[16]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Approved By",-1)),h(B,{options:v(x),modelValue:t.approved_by_user_id,"onUpdate:modelValue":o[5]||(o[5]=a=>t.approved_by_user_id=a),label:"label",placeholder:"--Select--",class:"h-10"},null,8,["options","modelValue"])]),e("div",be,[o[17]||(o[17]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),I(e("input",{id:"name","onUpdate:modelValue":o[6]||(o[6]=a=>t.name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[O,t.name]])]),e("div",ve,[o[18]||(o[18]=e("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),I(e("input",{id:"short_name","onUpdate:modelValue":o[7]||(o[7]=a=>t.short_name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[O,t.short_name]])]),e("div",he,[o[19]||(o[19]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),I(e("textarea",{id:"description","onUpdate:modelValue":o[8]||(o[8]=a=>t.description=a),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[O,t.description]])]),e("div",xe,[o[21]||(o[21]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),I(e("select",{id:"status","onUpdate:modelValue":o[9]||(o[9]=a=>t.status=a),class:"w-full border rounded px-3 py-2",required:""},o[20]||(o[20]=[e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)]),512),[[J,t.status]])])],512),e("div",ge,[e("button",{type:"button",onClick:S,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",we,r(w.value?"Update":"Create"),1)])],32)])])):j("",!0)}},Ce={class:"my-container space-y-4"},Ve={key:0,class:"text-center py-4"},$e={key:1,class:"space-y-4"},Se={class:"title-md"},Ae={class:"overflow-x-auto"},De={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},Me={class:"text-gray-600 text-sm"},Ee={class:"py-3 px-2 text-center"},Ue={class:"py-3 px-2 text-left"},Ie={class:"py-3 px-4 text-left"},Be={class:"whitespace-nowrap mb-1"},Le={class:"text-gray-800"},Fe={class:"whitespace-nowrap mb-1"},je={class:"text-gray-800"},Ne={class:"py-3 px-2 text-left"},qe={class:"whitespace-nowrap mb-1"},Oe={class:"text-gray-800"},Te={class:"whitespace-nowrap mb-1"},ze={class:"text-gray-800"},Re={class:"whitespace-nowrap"},We={class:"text-gray-800"},Ge={class:"py-3 px-2 text-center text-gray-800 font-semibold"},He={class:"py-3 px-2 text-center"},Je={class:"py-3 px-6 text-center"},Ke={class:"flex item-center justify-center gap-4"},Pe=["onClick"],Qe=["onClick"],rt={__name:"DepartmentList",setup(N){const p=ne(),i=ee(),f=y(!1),_=y(!1),c=y(null),q=()=>{c.value=null,f.value=!0},L=()=>{f.value=!1},x=t=>{c.value=t,f.value=!0},V=t=>{c.value=t,_.value=!0},g=()=>{_.value=!1},$=async t=>{try{t.id?(await p.updateDepartment(t.id,t),i.success("Department updated successfully!"),await p.fetchDepartments()):(await p.createDepartment(t),i.success("Department added successfully!"))}catch(n){i.error("Failed to save department!"),console.error("Error handling save:",n)}finally{L()}},w=async()=>{var t;if(!((t=c.value)!=null&&t.id)){i.error("Invalid department selected for deletion!");return}try{await p.deleteDepartment(c.value.id),i.success("Department deleted successfully!")}catch(n){i.error("Failed to delete department!"),console.error("Error deleting department:",n)}finally{g()}},F=T(()=>{const t={};return p.departments.forEach(n=>{var k;const b=((k=n.company)==null?void 0:k.name)||"Unknown Company";t[b]||(t[b]=[]),t[b].push(n)}),t});return P(async()=>{try{await p.fetchDepartments()}catch(t){i.error("Failed to fetch departments!"),console.error("Error fetching departments:",t)}}),(t,n)=>{var b;return d(),m("div",Ce,[h(le,{title:"Department List",onAdd:q}),v(p).loading?(d(),m("div",Ve,[h(Q)])):(d(),m("div",$e,[(d(!0),m(R,null,W(F.value,(k,C)=>(d(),m("div",{key:C},[e("h2",Se,r(C),1),e("div",Ae,[e("table",De,[n[7]||(n[7]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-center"},"#"),e("th",{class:"py-3 px-2 text-left"},"Department Name"),e("th",{class:"py-3 px-4 text-left whitespace-nowrap"}," In-Charge, Coordinator & Operational Admin "),e("th",{class:"py-3 px-2 text-left"},"Administration"),e("th",{class:"py-3 px-2 text-center"},"Employee"),e("th",{class:"py-3 px-2 text-center"},"Status"),e("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),e("tbody",Me,[(d(!0),m(R,null,W(k,(l,S)=>{var A,D,s,o,a,u,M,E,G;return d(),m("tr",{key:S,class:"border-b border-gray-200 hover:bg-blue-100"},[e("td",Ee,r(S+=1),1),e("td",Ue,[e("div",null,r(l.name),1),e("strong",null,r(l.short_name),1)]),e("td",Ie,[e("div",Be,[n[0]||(n[0]=e("span",{class:"text-gray-400 font-semibold"},"In-Charge: ",-1)),e("span",Le,r(((A=l.in_charge)==null?void 0:A.name)||"-"),1)]),e("div",Fe,[n[1]||(n[1]=e("span",{class:"text-gray-400 font-semibold"},"Coordinator: ",-1)),e("span",je,r(((D=l.coordinator)==null?void 0:D.name)||"-"),1)])]),e("td",Ne,[e("div",qe,[n[2]||(n[2]=e("span",{class:"text-gray-400 font-semibold"},"Operational Admin: ",-1)),e("span",Oe,r(((s=l.operational_admin)==null?void 0:s.name)||"-"),1)]),e("div",Te,[n[3]||(n[3]=e("span",{class:"text-gray-400 font-semibold"},"Recommend By: ",-1)),e("span",ze,r(((o=l==null?void 0:l.recommend_by)==null?void 0:o.name)||"-"),1)]),e("div",Re,[n[4]||(n[4]=e("span",{class:"text-gray-400 font-semibold"},"Approved By: ",-1)),e("span",We,r(((a=l==null?void 0:l.approved_by)==null?void 0:a.name)||"-"),1)])]),e("td",Ge,r(l==null?void 0:l.users_count),1),e("td",He,[e("div",{class:K(["flex gap-1 items-center",{"text-green-500":((u=l==null?void 0:l.status)==null?void 0:u.toLowerCase())=="active","text-red-400":((M=l==null?void 0:l.status)==null?void 0:M.toLowerCase())=="inactive"}])},[e("i",{class:K(["fas",{"fa-check-circle":((E=l==null?void 0:l.status)==null?void 0:E.toLowerCase())=="active","fa-times-circle":((G=l==null?void 0:l.status)==null?void 0:G.toLowerCase())=="inactive"}])},null,2),te(" "+r(l.status),1)],2)]),e("td",Je,[e("div",Ke,[e("button",{onClick:X=>x(l),class:"text-blue-600 hover:text-blue-800"},n[5]||(n[5]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Pe),e("button",{onClick:X=>V(l),class:"text-red-600 hover:text-red-800"},n[6]||(n[6]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Qe)])])])}),128))])])])]))),128))])),f.value?(d(),z(ke,{key:2,show:f.value,department:c.value,onClose:L,onSave:$},null,8,["show","department"])):j("",!0),_.value?(d(),z(ae,{key:3,show:_.value,title:"Delete Department",message:`Are you sure you want to delete ${(b=c.value)==null?void 0:b.name}?`,onClose:g,onConfirm:w},null,8,["show","message"])):j("",!0)])}}};export{rt as default};
