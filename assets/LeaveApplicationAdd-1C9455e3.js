import{u as $,r as f,y as D,O as S,A as H,b as j,c as m,a as t,m as U,n as P,k as q,w as z,d as c,v as k,t as g,e as L,F as T,x as V,h as A,p as I,o as v,l as J,P as C,g as O}from"./index-CWgyQWdy.js";import{L as Y}from"./LoaderView-DxU-Mb2f.js";import{_ as G}from"./MultiselectDropdown-DxSBYtgF.js";import{u as K}from"./leave-application-BsDkA3XS.js";import{u as Q}from"./leave-type-Zp73B6uT.js";import{u as X}from"./user-DLxy1Tsn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-Djq3TBhJ.js";const Z={class:"my-container max-w-3xl space-y-4"},ee={class:"flex items-center justify-between gap-2"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae={key:0,class:""},se={class:"text-blue-600 font-medium"},le={key:1,class:"bg-gray-100 p-2 rounded-md"},ne={class:"font-semibold"},oe={class:"flex flex-wrap gap-2"},re=["name","value","onUpdate:modelValue"],ue={class:"flex items-center space-x-1"},de=["name","onUpdate:modelValue"],ie={key:2,class:"text-red-500 text-sm"},we={__name:"LeaveApplicationAdd",setup(pe){const x=O(),M=K(),_=Q(),h=X(),d=$(),w=f(""),l=f({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),r=f([]),b=f(!1),y=f(null),R=D(()=>{var s,e,u;return((e=(s=d==null?void 0:d.user)==null?void 0:s.assign_weekend)==null?void 0:e.weekends)||((u=d==null?void 0:d.user)==null?void 0:u.weekends)}),p=D(()=>{const s=l.value.last_working_date,e=l.value.resumption_date;if(!s||!e)return[];const u=new Date(s),n=new Date(e);if(n<=u)return[];const o=[];let a=new Date(u);for(a.setDate(a.getDate()+1);a<n;){const i=a.getFullYear(),N=(a.getMonth()+1).toString().padStart(2,"0"),F=a.getDate().toString().padStart(2,"0");o.push(`${i}-${N}-${F}`),a.setDate(a.getDate()+1)}return o}),W=D(()=>{const s=l.value.last_working_date,e=l.value.resumption_date;if(!s||!e)return"";const u=new Date(s);return new Date(e)<=u?"Resumption date must be after Last Working Date.":p.value.length===0?"No leave days between the selected dates.":`Total leave days: ${p.value.length}`});S(()=>{p.value.length&&_.leaveTypes.length&&(r.value.length!==p.value.length&&(r.value=p.value.map(()=>_.leaveTypes[0].id)),p.value.forEach((s,e)=>{const u=new Date(s).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),n=u.charAt(0).toUpperCase()+u.slice(1);R.value.includes(n)&&(r.value[e]="weekend")}))}),H(()=>w.value,s=>{l.value.handover_user_id=s==null?void 0:s.id});const B=async()=>{var s;b.value=!0,y.value=null;try{const e=p.value.map((a,i)=>({date:a,leave_type_id:r.value[i]!=="weekend"?r.value[i]:null})).filter(a=>a.leave_type_id!==null),u=p.value.map((a,i)=>({date:a,leave_type_id:(r.value[i]==1?"CL":r.value[i]===2?"ML":r.value[i]==3?"SL":r.value[i]==3?"WPL":r.value[i])||""})).filter(a=>a.leave_type_id!==null),n={user_id:(s=d==null?void 0:d.user)==null?void 0:s.id,last_working_date:l.value.last_working_date,resumption_date:l.value.resumption_date,reason:l.value.reason,works_in_hand:l.value.works_in_hand,handover_user_id:l.value.handover_user_id,leave_days:e,json_data:u},o=await M.storeLeaveApplication(n);o&&x.push({name:"LeaveApplicationShow",params:{id:o==null?void 0:o.id}})}catch(e){y.value=e.message||"Failed to submit leave application"}finally{b.value=!1}};j(()=>{S(()=>{var e;const s=(e=d==null?void 0:d.user)==null?void 0:e.company_id;s&&_.fetchLeaveTypes(s)}),h.fetchDepartmentWiseEmployees()});const E=()=>{x.go(-1)};return(s,e)=>{const u=I("RouterLink");return v(),m("div",Z,[t("div",ee,[t("button",{class:"btn-3",onClick:E},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),t("div",null,[U(u,{to:"/my-applications",class:"btn-2"},{default:P(()=>e[6]||(e[6]=[J("Home")])),_:1})])]),b.value?(v(),q(Y,{key:0})):(v(),m("form",{key:1,onSubmit:z(B,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[t("div",te,[t("div",null,[e[8]||(e[8]=t("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),c(t("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=n=>l.value.last_working_date=n),class:"input-1 w-full",required:""},null,512),[[k,l.value.last_working_date]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),c(t("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=n=>l.value.resumption_date=n),class:"input-1 w-full",required:""},null,512),[[k,l.value.resumption_date]])])]),l.value.last_working_date&&l.value.resumption_date?(v(),m("div",ae,[t("p",se,g(W.value),1)])):L("",!0),p.value.length?(v(),m("div",le,[e[11]||(e[11]=t("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),t("div",null,[(v(!0),m(T,null,V(p.value,(n,o)=>(v(),m("div",{key:o,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[t("div",ne,g(n),1),t("div",oe,[(v(!0),m(T,null,V(A(_).leaveTypes,a=>(v(),m("label",{key:a.id,class:"flex items-center space-x-1"},[c(t("input",{type:"radio",name:"leaveType-"+o,value:a.id,"onUpdate:modelValue":i=>r.value[o]=i},null,8,re),[[C,r.value[o]]]),t("span",null,g(a.name),1)]))),128)),t("label",ue,[c(t("input",{type:"radio",name:"leaveType-"+o,value:"weekend","onUpdate:modelValue":a=>r.value[o]=a},null,8,de),[[C,r.value[o]]]),e[10]||(e[10]=t("span",null,"Weekend / Holiday",-1))])])]))),128))])])):L("",!0),t("div",null,[e[12]||(e[12]=t("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),c(t("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=n=>l.value.reason=n),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[k,l.value.reason]])]),t("div",null,[e[13]||(e[13]=t("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),c(t("textarea",{id:"works-in-hand","onUpdate:modelValue":e[3]||(e[3]=n=>l.value.works_in_hand=n),class:"input-1 w-full",placeholder:"Enter details of works in hand"},null,512),[[k,l.value.works_in_hand]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),U(G,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=n=>w.value=n),options:A(h).users,multiple:!1,label:"name",placeholder:"Select user"},null,8,["modelValue","options"])]),y.value?(v(),m("div",ie,g(y.value),1)):L("",!0),e[15]||(e[15]=t("div",{class:"flex justify-end"},[t("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{we as default};
