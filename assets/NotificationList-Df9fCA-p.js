import{u as L,N as I,s as C,r as f,b as q,x as B,o as i,c as _,d as E,v as O,a as r,e as l,t as m,h as x,F as G,q as Z,p as K,k as Q,j as S,m as N,g as W,f as X,n as Y}from"./index-C8fsXV_K.js";import{u as P}from"./leave-application-Bj-L5yrs.js";import{u as M}from"./exchange-BnDtOrIP.js";import{u as ee}from"./manual-attendance-BJMwYBNC.js";import{u as ae}from"./short-leave-D99vWQm5.js";const te={key:0,class:"text-center space-y-2 print:hidden"},oe={key:0,class:"mt-2"},ne={class:"flex justify-end gap-2 pt-2"},re={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(j){const y=L(),p=I(),h=M(),{user:A}=C(y),w=j,t=f(null);q(()=>{t.value=JSON.parse(JSON.stringify(w.application))});const u=f(!1),c=f(""),k=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await h.handoverAccept(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===A.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await h.inChargeAccept(a),await e()),alert("In-Charge approved!")}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await h.recommendByAccept(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure to final approval?")&&(await h.approvedByAccept(a),await e())}}],o=B(()=>k.find(a=>{var n,d,g,b;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((g=t.value)!=null&&g[a.approved_field])&&((b=t.value)==null?void 0:b[a.approved_by_field])===A.value.id:!1})),s=()=>{u.value&&c.value?(v(),u.value=!1):u.value=!0};async function v(){try{await h.rejectExchange(t.value.id,c.value),alert("Exchange application rejected!"),c.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await p.markAsRead(w.notificationId)}return(a,n)=>o.value&&t.value?(i(),_("div",te,[u.value?(i(),_("div",oe,[E(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):l("",!0),r("div",ne,[r("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))}," Approve "),r("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:s}," Reject ")])])):l("",!0)}},se={key:0,class:"text-center space-y-2 print:hidden"},ie={key:0,class:"mt-2"},ce={class:"flex justify-end gap-2 pt-2"},le={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(j){const y=L(),p=P(),h=I(),{user:A}=C(y),w=j,t=f(null);q(()=>{t.value=JSON.parse(JSON.stringify(w.application))});const u=f(!1),c=f(""),k=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptHandover(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===A.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptInCharge(a),await e())}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptCoordinator(a),await e())}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptOperationalAdmin(a),await e())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptRecommendBy(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptApprovedBy(a),await e())}}],o=B(()=>k.find(a=>{var g,b,R,$;if(!t.value)return!1;if(a.key==="handover")return a.condition();const n=!!((g=t.value)!=null&&g[a.approved_field]),d=((b=t.value)==null?void 0:b[a.approved_by_field])===A.value.id;return((R=t.value)==null?void 0:R.status)!=="Rejected"&&(($=t.value)==null?void 0:$.status)!=="Approved"&&!n&&d})),s=()=>{u.value&&c.value?(v(),u.value=!1):u.value=!0};async function v(){try{await p.rejectLeaveApplication(t.value.id,{rejection_reason:c.value}),alert("Application rejected!"),c.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await h.markAsRead(w.notificationId)}return(a,n)=>o.value&&t.value?(i(),_("div",se,[u.value?(i(),_("div",ie,[E(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):l("",!0),r("div",ce,[r("button",{class:"btn-2",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))},"Approve"),r("button",{class:"btn-1",onClick:s},"Reject")])])):l("",!0)}},de={key:0,class:"text-center space-y-2 print:hidden"},pe={key:0,class:"mt-2"},ue={class:"flex justify-end gap-2 pt-2"},_e={__name:"ManualAttendanceApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(j){const y=L(),p=ee(),h=I(),{user:A}=C(y),w=j,t=f(null);q(()=>{t.value=JSON.parse(JSON.stringify(w.application))});const u=f(!1),c=f(""),k=[{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.inChargeAccept(a),await e())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.recommendByAccept(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.approvedByAccept(a),await e())}}],o=B(()=>k.find(a=>{var g,b,R,$;if(!t.value)return!1;if(a.key==="handover")return a.condition();const n=!!((g=t.value)!=null&&g[a.approved_field]),d=((b=t.value)==null?void 0:b[a.approved_by_field])===A.value.id;return((R=t.value)==null?void 0:R.status)!=="Rejected"&&(($=t.value)==null?void 0:$.status)!=="Approved"&&!n&&d})),s=()=>{u.value&&c.value?(v(),u.value=!1):u.value=!0};async function v(){try{await p.rejectLeaveApplication(t.value.id,{rejection_reason:c.value}),alert("Application rejected!"),c.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await h.markAsRead(w.notificationId)}return(a,n)=>o.value&&t.value?(i(),_("div",de,[u.value?(i(),_("div",pe,[E(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):l("",!0),r("div",ue,[r("button",{class:"btn-2",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))},"Approve"),r("button",{class:"btn-1",onClick:s},"Reject")])])):l("",!0)}},ve={key:0,class:"text-center space-y-2 print:hidden"},ye={key:0,class:"mt-2"},fe={class:"flex justify-end gap-2 pt-2"},he={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(j){const y=L(),p=ae(),h=I(),{user:A}=C(y),w=j,t=f(null);q(()=>{t.value=JSON.parse(JSON.stringify(w.application))});const u=f(!1),c=f(""),k=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.handoverAccept(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===A.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.inChargeAccept(a),await e())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.recommendByAccept(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.approvedByAccept(a),await e())}}],o=B(()=>k.find(a=>{var n,d,g,b;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((g=t.value)!=null&&g[a.approved_field])&&((b=t.value)==null?void 0:b[a.approved_by_field])===A.value.id:!1})),s=()=>{u.value&&c.value?(v(),u.value=!1):u.value=!0};async function v(){try{await p.rejectShortLeave(t.value.id,c.value),alert("Application rejected!"),c.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await h.markAsRead(w.notificationId)}return(a,n)=>o.value&&t.value?(i(),_("div",ve,[u.value?(i(),_("div",ye,[E(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):l("",!0),r("div",fe,[u.value?l("",!0):(i(),_("button",{key:0,class:"btn-2",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))}," Approve ")),r("button",{class:"btn-1",onClick:s},m(u.value?"Submit":"Reject"),1)])])):l("",!0)}},ge={class:"space-y-6 px-4 py-4"},be={class:"text-2xl font-semibold capitalize text-gray-700"},we={key:0,class:"space-y-4"},Ae={class:"flex items-start gap-4"},xe={class:"text-2xl text-blue-500"},ke={class:"flex-1"},Se={class:"flex gap-8"},me={class:"text-gray-800 font-medium"},je={key:0,class:"flex gap-2 text-sm"},Re={key:0,class:"text-gray-800 font-medium"},$e={class:"text-red-600 text-sm font-semibold"},Ne={key:1,class:"text-xs text-gray-400"},Ce={key:0,class:"grid gap-1"},Le={class:"flex items-center gap-4"},Ie=["href"],qe={class:"grow-0 w-full"},Be={key:0,class:"text-xs font-semibold"},Ee={class:"text-xs text-gray-400"},Oe={key:1,class:"text-center text-red-500 py-10"},He={__name:"NotificationList",setup(j){W();const y=X(),p=I(),{notifications:h}=C(p);P();const A=L();C(A),f(!1),f({}),f({}),q(()=>{p.fetchNotifications()});const w=(o,s)=>{if(!o)return"application not found";switch(s){case"leaveApplication":return`Last Office ( ${o.last_working_date} ) → Join Date ( ${o.resumption_date} )`;case"shortLeave":return`Short Leave on ${o.date} form ${k(o.start_time)??"N/A"} to ${o.end_time?k(o.end_time):"N/A"}`;case"shift":return o.exchange_type==="shift"?`Exchange (${o.exchange_type}) on ${o.current_date} (${(o==null?void 0:o.shift_name)??"No Shift"})`:`Exchange (${o.exchange_type})`;case"offday":return o.exchange_type==="offday"?`Exchange (Offday): ${o.exchange_date} → ${o.current_date}`:`Exchange (${o.exchange_type})`;case"manualAttendance":const v=o.check_in?c(o.check_in):"N/A",e=o.check_out?c(o.check_out):"N/A";return`Checked in (${v}) → Checked out (${e})`;default:return"Unknown Event"}},t=o=>{switch(o){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"manualAttendance":return"fas fa-clock";case"exchange":return"fas fa-random";case"offday":return"fas fa-random";default:return"fas fa-bell"}},u=o=>new Date(o).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});function c(o){const s={year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"2-digit",hour12:!0};return new Date(o).toLocaleString("en-US",s)}const k=o=>{const[s,v]=o.split(":").map(Number),e=new Date;return e.setHours(s,v),e.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(o,s)=>{const v=Y("RouterLink");return i(),_("div",ge,[r("h2",be,m(x(y).query.type.replace(/([A-Z])/g," $1")),1),x(h)[x(y).query.type]?(i(),_("div",we,[(i(!0),_(G,null,Z(x(h)[x(y).query.type],(e,a)=>{var n,d,g,b,R,$,T,J,U,D,V,H,z,F;return i(),_("div",{key:e.id,class:"bg-white p-4 rounded-xl shadow border"},[r("div",Ae,[r("div",xe,[r("i",{class:K(t(e.event_type))},null,2)]),r("div",ke,[r("div",Se,[r("p",me,m((n=e.event_model)==null?void 0:n.user_name),1),e!=null&&e.monthly_short_leave_count?(i(),_("p",je,[r("strong",null,"Pending: "+m((e==null?void 0:e.monthly_short_leave_count.Pending)||0),1),s[0]||(s[0]=Q("/ ")),r("strong",null,"Approved: "+m(e==null?void 0:e.monthly_short_leave_count.Approved),1)])):l("",!0)]),(d=e.event_model)!=null&&d.reason?(i(),_("p",Re," Reason: "+m((g=e.event_model)==null?void 0:g.reason),1)):l("",!0),r("p",$e,m(w(e.event_model,e.event_type)),1),(b=e==null?void 0:e.event_model)!=null&&b.total_leave_days_without_week?(i(),_("p",Ne," Total Leave: "+m(e==null?void 0:e.event_model.total_leave_days_without_week)+" days ",1)):l("",!0)]),e!=null&&e.event_model?(i(),_("div",Ce,[r("div",Le,[e!=null&&e.event_model.attachment?(i(),_("a",{key:0,href:(R=e==null?void 0:e.event_model)==null?void 0:R.attachment,target:"_blank",class:"btn-1"},s[1]||(s[1]=[r("i",{class:"fad fa-link"},null,-1)]),8,Ie)):l("",!0),x(y).query.type==="leaveApplication"?(i(),S(v,{key:1,to:{name:"LeaveApplicationShow",params:{id:($=e==null?void 0:e.event_model)==null?void 0:$.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[2]||(s[2]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),x(y).query.type==="shortLeave"?(i(),S(v,{key:2,to:{name:"ShortLeaveShow",params:{id:(T=e==null?void 0:e.event_model)==null?void 0:T.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[3]||(s[3]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),x(y).query.type==="exchange"?(i(),S(v,{key:3,to:{name:((J=e==null?void 0:e.event_model)==null?void 0:J.exchange_type)=="offday"?"ExchangeOffdayShow":"ExchangeShiftShow",params:{id:(U=e==null?void 0:e.event_model)==null?void 0:U.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[4]||(s[4]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),x(y).query.type==="offday"?(i(),S(v,{key:4,to:{name:"ExchangeOffdayShow",params:{id:(D=e==null?void 0:e.event_model)==null?void 0:D.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[5]||(s[5]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),x(y).query.type==="shift"?(i(),S(v,{key:5,to:{name:"ExchangeShiftShow",params:{id:(V=e==null?void 0:e.event_model)==null?void 0:V.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[6]||(s[6]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),x(y).query.type==="manualAttendance"?(i(),S(v,{key:6,to:{name:"ExchangeShiftShow",params:{id:(H=e==null?void 0:e.event_model)==null?void 0:H.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:N(()=>s[7]||(s[7]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0)]),r("div",qe,[(z=e==null?void 0:e.event_model)!=null&&z.type?(i(),_("p",Be," Type : "+m((F=e==null?void 0:e.event_model)==null?void 0:F.type),1)):l("",!0),r("p",Ee,m(u(e.created_at)),1)])])):l("",!0)]),e!=null&&e.event_model&&e.event_type==="leaveApplication"?(i(),S(le,{key:0,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):l("",!0),e!=null&&e.event_model&&e.event_type==="manualAttendance"?(i(),S(_e,{key:1,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):l("",!0),e!=null&&e.event_model&&e.event_type==="shortLeave"?(i(),S(he,{key:2,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):l("",!0),e!=null&&e.event_model&&(e.event_type==="offday"||e.event_type==="shift")?(i(),S(re,{key:3,application:e.event_model,notificationId:e.id},null,8,["application","notificationId"])):l("",!0)])}),128))])):(i(),_("div",Oe,"No notifications found."))])}}};export{He as default};
