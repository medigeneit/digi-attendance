import{u as K,b as P,r as g,A as b,e as Q,J as Y,x as G,m as X,c as w,o as y,a as t,f as V,h as J,j as r,n as S,v as Z,g as I,i as ee,t as d,k as i,E as te}from"./index-Bsza4PJG.js";import{_ as le}from"./AttendanceTable-CHSSYsJ5.js";import{_ as ne}from"./EmployeeFilter-BZXgAW9C.js";import{L as oe}from"./LoaderView-TNYhAaCH.js";import{S as se}from"./SelectedEmployeeCard-BoMBgt3x.js";import{u as ae}from"./attendance-Bj99bwcI.js";import{u as re}from"./user-ER3iY2ia.js";import"./datetime-DcVwRp76.js";import"./company-Djbe1dEM.js";import"./department-BIkAZzix.js";import"./EmployeeDropdownInput-BqexzDzT.js";import"./SelectDropdown-DQzcLAab.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BvxQOY54.js";const ie={class:"px-4 space-y-4"},ue={class:"rounded-xl border border-zinc-200 bg-white shadow-sm p-3"},de={class:"w-full flex flex-wrap gap-4 items-center md:w-auto"},me={key:0,class:"grid md:grid-cols-2 gap-4 text-sm"},pe={class:"card-bg p-4 gap-1"},ye={class:"flex justify-between items-center"},ce={class:"grid md:grid-cols-2"},fe={key:1},ve={key:3,class:"space-y-4"},De={__name:"EmployeeAttendance",setup(_e){const h=K(),$=P(),o=ae(),A=re(),f=l=>{if(!l)return"";if(typeof l=="string"){if(/^\d{4}-\d{2}$/.test(l))return l;const e=l.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(l),s=e.getFullYear(),p=String(e.getMonth()+1).padStart(2,"0");return`${s}-${p}`}catch{return""}},c=$.query,u=g(f(c.date)||f(o.selectedMonth)||f(new Date)),n=g({company_id:c.company_id||"",department_id:c.department_id||"all",line_type:c.line_type||"all",employee_id:c.employee_id||""}),m=g(null);let x=null;const v=(l={})=>{x&&clearTimeout(x),x=setTimeout(()=>{const e={...$.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:u.value||"",...l};Object.keys(e).forEach(s=>{(e[s]===""||e[s]===void 0||e[s]===null)&&delete e[s]}),h.replace({query:e}).catch(()=>{})},150)},T=async l=>{if(!l){m.value=null;return}try{await A.fetchUser(l),m.value=A.user||null}catch(e){console.error("fetchUser error:",e),m.value=null}},_=g(""),k=async()=>{const l=n.value.employee_id,e=u.value;if(!l||!e)return;const s=`${l}|${e}`;if(s!==_.value){_.value=s;try{await o.getMonthlyAttendanceByShift(l,e)}catch(p){console.error("fetchAttendance error:",p),_.value=""}}};b(()=>u.value,l=>{u.value=f(l),v({date:u.value})}),b(()=>({...n.value}),()=>{v()}),b(()=>n.value.employee_id,async(l,e)=>{l&&l!==e&&(await T(l),await k()),l||(m.value=null,_.value="")}),Q(async()=>{n.value.employee_id&&await T(n.value.employee_id),n.value.employee_id&&u.value&&await k(),await Y(),v()});const O=()=>h.go(-1),R=()=>{v()},U=G(()=>!!n.value.employee_id);return(l,e)=>{var p,C,M,q,D,B,L,j,E,F,N,W,z,H;const s=X("router-link");return y(),w("div",ie,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:O},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Job Card",-1)),e[7]||(e[7]=t("div",null,null,-1))]),t("div",ue,[e[8]||(e[8]=t("div",{class:"flex items-center justify-between border-b border-zinc-100 px-4 py-3"},[t("p",{class:"text-sm text-zinc-600"},[t("i",{class:"fas fa-filter mr-2"}),r(" Filters")]),t("div",{class:"h-1 w-32 bg-gradient-to-r from-indigo-500 via-sky-500 to-cyan-400 rounded-full"})],-1)),t("div",de,[S(ne,{company_id:n.value.company_id,"onUpdate:company_id":e[0]||(e[0]=a=>n.value.company_id=a),department_id:n.value.department_id,"onUpdate:department_id":e[1]||(e[1]=a=>n.value.department_id=a),employee_id:n.value.employee_id,"onUpdate:employee_id":e[2]||(e[2]=a=>n.value.employee_id=a),line_type:n.value.line_type,"onUpdate:line_type":e[3]||(e[3]=a=>n.value.line_type=a),"with-type":!0,"initial-value":l.$route.query,onFilterChange:R,class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",null,[J(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[4]||(e[4]=a=>u.value=a),onChange:k,class:"input-1","aria-label":"Select month"},null,544),[[Z,u.value]])])])]),m.value?(y(),w("div",me,[U.value?(y(),V(se,{key:0,user:m.value},null,8,["user"])):I("",!0),t("div",pe,[t("div",ye,[e[10]||(e[10]=t("h2",{class:"title-md"},"Attendance Summary",-1)),S(s,{to:{name:"MonthWiseApplicationLog",query:{...l.$route.query}},class:"btn-2",target:"_blank",rel:"noopener noreferrer"},{default:ee(()=>e[9]||(e[9]=[r(" Application History ")])),_:1,__:[9]},8,["to"])]),e[18]||(e[18]=t("hr",null,null,-1)),t("div",ce,[t("p",null,[e[11]||(e[11]=t("strong",null,"Total Working Days:",-1)),r(" "+d((C=(p=i(o))==null?void 0:p.summary)==null?void 0:C.total_working_days),1)]),t("p",null,[e[12]||(e[12]=t("strong",null,"Present Days:",-1)),r(" "+d((q=(M=i(o))==null?void 0:M.summary)==null?void 0:q.total_present_days),1)]),t("p",null,[e[13]||(e[13]=t("strong",null,"Absent Days:",-1)),r(" "+d((B=(D=i(o))==null?void 0:D.summary)==null?void 0:B.total_absent_days),1)]),t("p",null,[e[14]||(e[14]=t("strong",null,"Late Days:",-1)),r(" "+d((j=(L=i(o))==null?void 0:L.summary)==null?void 0:j.actual_late_day),1)]),t("p",null,[e[15]||(e[15]=t("strong",null,"Total Weekends:",-1)),r(" "+d((F=(E=i(o))==null?void 0:E.summary)==null?void 0:F.total_weekend_days),1)]),t("p",null,[e[16]||(e[16]=t("strong",null,"Total Working Hours:",-1)),r(" "+d((W=(N=i(o))==null?void 0:N.summary)==null?void 0:W.total_working_hours),1)]),t("p",null,[e[17]||(e[17]=t("strong",null,"Total Overtime Hours:",-1)),r(" "+d((H=(z=i(o))==null?void 0:z.summary)==null?void 0:H.total_overtime_hours),1)])])])])):(y(),w("div",fe,e[19]||(e[19]=[t("p",{class:"text-gray-400 text-center text-2xl italic"},"Select an employee, please.",-1)]))),i(o).isLoading?(y(),V(oe,{key:2})):J((y(),w("div",ve,[S(le,{logs:i(o).monthlyLogs},null,8,["logs"])],512)),[[te,U.value]])])}}};export{De as default};
