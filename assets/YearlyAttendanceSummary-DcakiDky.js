import{x as b,c as g,o as v,a as e,d as U,t as o,s as M,j as Q,b as I,F as de,e as re,C as G,f as ie,u as oe,Q as ue,D as z,r as B,q as pe,h as me,O as ce}from"./index-BUfZVfec.js";import{u as _e}from"./company-CFYdUTWs.js";import{u as ye}from"./department-Ooehx8bg.js";import{_ as be}from"./SearchInput-0uyB3jN_.js";import{S as T}from"./SelectDropdown-BNdS4v6R.js";import{L as ge}from"./LoaderView-Z2wXbnPD.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"rounded-2xl border border-slate-100 bg-white/80 p-4 shadow-sm"},fe={class:"grid gap-3 md:grid-cols-12 relative"},xe={class:"md:col-span-2"},he={class:"md:col-span-3 relative"},$e={key:0},Se={key:1,class:"flex h-[36px] items-center rounded-md border border-dashed border-slate-200 bg-slate-50 px-3 text-sm text-slate-700"},ke={class:"md:col-span-3 relative"},Ce={class:"md:col-span-1 flex items-end justify-end gap-2"},Ne=["disabled"],Ie=["disabled"],Ue={__name:"YearlyAttendanceSummaryFilters",props:{year:{type:[String,Number],default:""},years:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},companyOptions:{type:Array,default:()=>[]},showCompanySelect:{type:Boolean,default:!0},departmentId:{type:[String,Number],default:""},departmentIdIsNull:{type:Boolean,default:!1},departmentOptions:{type:Array,default:()=>[]},search:{type:String,default:""},isBusy:{type:Boolean,default:!1}},emits:["update:year","update:companyId","update:departmentId","update:departmentIdIsNull","update:search","apply","reset"],setup(r,{emit:_}){const p=r,f=_,S=b({get:()=>String(p.year||""),set:u=>f("update:year",u||"")}),x=b({get:()=>String(p.companyId||""),set:u=>f("update:companyId",u||"")}),h=b({get:()=>p.departmentIdIsNull?"__null__":String(p.departmentId||""),set:u=>{if(u==="__null__"){f("update:departmentId",""),f("update:departmentIdIsNull",!0);return}f("update:departmentId",u||""),f("update:departmentIdIsNull",!1)}}),V=b(()=>[{id:"__null__",label:"Unassigned/NULL"},...p.departmentOptions]),A=b(()=>{const u=p.companyOptions.find(i=>String(i.id)===String(p.companyId));return(u==null?void 0:u.label)||"Company not set"});return(u,i)=>(v(),g("div",ve,[e("div",fe,[e("div",xe,[i[6]||(i[6]=e("label",{class:"top-label mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-400"}," Year ",-1)),U(T,{modelValue:S.value,"onUpdate:modelValue":i[0]||(i[0]=t=>S.value=t),options:r.years,class:"border-2 border-gray-200 rounded h-[36px] w-full bg-white"},null,8,["modelValue","options"])]),e("div",he,[i[7]||(i[7]=e("label",{class:"top-label block text-xs font-semibold uppercase tracking-wide text-slate-400"}," Company ",-1)),r.showCompanySelect?(v(),g("div",$e,[U(T,{modelValue:x.value,"onUpdate:modelValue":i[1]||(i[1]=t=>x.value=t),options:r.companyOptions,class:"border-2 border-gray-200 rounded h-[36px] w-full bg-white",clearable:""},null,8,["modelValue","options"])])):(v(),g("div",Se,o(A.value),1))]),e("div",{class:M(["md:col-span-3 relative",{"opacity-60 pointer-events-none":!r.companyId}])},[i[8]||(i[8]=e("label",{class:"top-label block text-xs font-semibold uppercase tracking-wide text-slate-400"}," Department ",-1)),U(T,{modelValue:h.value,"onUpdate:modelValue":i[2]||(i[2]=t=>h.value=t),options:V.value,class:"border-2 border-gray-200 rounded h-[36px] w-full bg-white",clearable:""},null,8,["modelValue","options"])],2),e("div",ke,[i[9]||(i[9]=e("label",{class:"top-label mb-1 block text-xs font-semibold uppercase tracking-wide text-slate-400"}," User Search ",-1)),U(be,{"model-value":r.search,"debounce-time":300,placeholder:"User ID or name",label:"","onUpdate:modelValue":i[3]||(i[3]=t=>u.$emit("update:search",t||""))},null,8,["model-value"])]),e("div",Ce,[e("button",{type:"button",class:"h-9 rounded-md border border-slate-300 px-3 text-xs font-semibold text-slate-600 hover:bg-slate-50 disabled:opacity-50",disabled:r.isBusy,onClick:i[4]||(i[4]=t=>u.$emit("reset"))}," Reset ",8,Ne),e("button",{type:"button",class:"h-9 rounded-md bg-slate-900 px-3 text-xs font-semibold text-white hover:bg-slate-800 disabled:opacity-50",disabled:r.isBusy,onClick:i[5]||(i[5]=t=>u.$emit("apply"))}," Apply ",8,Ie)])])]))}},Ae={class:"rounded-2xl border border-slate-100 bg-white/90 shadow-lg"},De={key:0,class:"py-8"},Le={key:1,class:"empty-state"},Pe={key:2,class:"table-scroll"},Be={class:"min-w-full table-auto border-collapse"},Ve={class:"sticky top-0 bg-white shadow-sm"},qe={class:"bg-gray-50 text-sm text-left"},Fe={class:"ml-1 text-[11px]"},Oe={class:"ml-1 text-[11px]"},Ye={class:"ml-1 text-[11px]"},Re={class:"text-sm"},Te=["onClick"],Me={class:"td"},je={class:"td font-semibold text-slate-700"},Ee={class:"td text-slate-600"},ze={class:"td"},Qe={class:"td text-center"},Ge={class:"td text-center"},He={class:"td text-center"},Je={key:3,class:"flex items-center justify-between p-3 text-sm"},Ke={class:"text-slate-600"},We={class:"font-medium"},Xe={class:"font-medium"},Ze={class:"font-medium"},we={class:"flex items-center gap-3"},et=["value"],tt={class:"flex items-center gap-2"},at=["disabled"],st={class:"text-slate-600"},nt=["disabled"],lt={__name:"YearlyAttendanceSummaryTable",props:{rows:{type:Array,default:()=>[]},meta:{type:Object,default:()=>({})},isLoading:{type:Boolean,default:!1},sortBy:{type:String,default:"attendance_score_avg"},sortDir:{type:String,default:"desc"},page:{type:Number,default:1},perPage:{type:Number,default:25}},emits:["update:page","update:perPage","sort-change","row-click"],setup(r,{emit:_}){const p=r,f=_,S=b(()=>{var s;return Number(((s=p.meta)==null?void 0:s.total)||0)}),x=b(()=>{var s;return Number(((s=p.meta)==null?void 0:s.last_page)||1)}),h=b(()=>S.value===0?0:(p.page-1)*p.perPage+1),V=b(()=>S.value===0?0:(p.page-1)*p.perPage+p.rows.length),A=s=>{if(!s)return;const l=p.sortBy===s&&p.sortDir==="asc"?"desc":"asc";f("sort-change",{sort_by:s,sort_dir:l})},u=s=>p.sortBy!==s?"":p.sortDir==="asc"?"↑":"↓",i=s=>{const l=Number(s||0);return l>=95?"bg-emerald-50 text-emerald-700":l>=80?"bg-amber-50 text-amber-700":"bg-rose-50 text-rose-700"},t=s=>{const l=Number(s);return Number.isFinite(l)?`${l.toFixed(1)}%`:"—"},D=s=>{const l=(s==null?void 0:s.user_name)||(s==null?void 0:s.name)||(s==null?void 0:s.user)||(s==null?void 0:s.employee_name)||"";return l&&(s!=null&&s.user_id)?`${l} (${s.user_id})`:s!=null&&s.user_id?`#${s.user_id}`:l||"—"},q=s=>s!=null&&s.department_name?s.department_name:(s==null?void 0:s.department_id)==null?"Unassigned":String((s==null?void 0:s.department_id)||"Unassigned");return(s,l)=>(v(),g("div",Ae,[r.isLoading?(v(),g("div",De,[U(ge)])):r.rows.length===0?(v(),g("div",Le,l[6]||(l[6]=[e("p",{class:"text-base font-semibold text-slate-700"},"No attendance summary found",-1),e("p",{class:"text-sm text-slate-500"},"Try adjusting filters or year.",-1)]))):(v(),g("div",Pe,[e("table",Be,[e("thead",Ve,[e("tr",qe,[l[10]||(l[10]=e("th",{class:"th w-12"},"#",-1)),e("th",{class:"th cursor-pointer",onClick:l[0]||(l[0]=d=>A("user_id"))},[l[7]||(l[7]=I(" User ")),e("span",Fe,o(u("user_id")),1)]),l[11]||(l[11]=e("th",{class:"th"},"Department",-1)),l[12]||(l[12]=e("th",{class:"th"},"Year",-1)),e("th",{class:"th cursor-pointer text-center",onClick:l[1]||(l[1]=d=>A("yearly_present_pct"))},[l[8]||(l[8]=I(" Present % ")),e("span",Oe,o(u("yearly_present_pct")),1)]),e("th",{class:"th cursor-pointer text-center",onClick:l[2]||(l[2]=d=>A("total_months"))},[l[9]||(l[9]=I(" Total Months ")),e("span",Ye,o(u("total_months")),1)]),l[13]||(l[13]=e("th",{class:"th text-center"},"Grading",-1))])]),e("tbody",Re,[(v(!0),g(de,null,re(r.rows,(d,Y)=>(v(),g("tr",{key:`${d==null?void 0:d.user_id}-${d==null?void 0:d.year}-${Y}`,class:"border-b hover:bg-blue-50 cursor-pointer",onClick:y=>s.$emit("row-click",d)},[e("td",Me,o((r.page-1)*r.perPage+(Y+1)),1),e("td",je,o(D(d)),1),e("td",Ee,o(q(d)),1),e("td",ze,o((d==null?void 0:d.year)||"—"),1),e("td",Qe,[e("span",{class:M(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold",i(d==null?void 0:d.yearly_present_pct)])},o(t(d==null?void 0:d.yearly_present_pct)),3)]),e("td",Ge,o((d==null?void 0:d.total_months)??"—"),1),e("td",He,o(d==null?void 0:d.yearly_present_score_avg),1)],8,Te))),128))])])])),!r.isLoading&&r.rows.length?(v(),g("div",Je,[e("div",Ke,[l[14]||(l[14]=I(" Showing ")),e("span",We,o(h.value),1),l[15]||(l[15]=I(" to ")),e("span",Xe,o(V.value),1),l[16]||(l[16]=I(" of ")),e("span",Ze,o(S.value),1)]),e("div",we,[e("select",{class:"rounded-md border border-slate-200 px-2 py-1 text-xs text-slate-700",value:r.perPage,onChange:l[3]||(l[3]=d=>s.$emit("update:perPage",Number(d.target.value)))},l[17]||(l[17]=[e("option",{value:10},"10 / page",-1),e("option",{value:25},"25 / page",-1),e("option",{value:50},"50 / page",-1)]),40,et),e("div",tt,[e("button",{class:"btn-3",disabled:r.page<=1,onClick:l[4]||(l[4]=d=>s.$emit("update:page",Math.max(1,r.page-1)))}," Prev ",8,at),e("span",st,"Page "+o(r.page)+" / "+o(x.value),1),e("button",{class:"btn-3",disabled:r.page>=x.value,onClick:l[5]||(l[5]=d=>s.$emit("update:page",Math.min(x.value,r.page+1)))}," Next ",8,nt)])])])):Q("",!0)]))}},dt=H(lt,[["__scopeId","data-v-460a81b1"]]),rt=r=>G.get("/yearly-attendance-summary",{params:r}),it=r=>G.get("/yearly-attendance-summary/export",{params:r,responseType:"blob"}),ot={class:"space-y-6 px-4 pb-10"},ut={class:"report-hero glass-panel px-5 py-4"},pt={class:"flex flex-wrap items-center gap-2"},mt=["disabled"],ct={key:0,class:"drawer"},_t={class:"drawer__panel"},yt={class:"flex items-center justify-between border-b pb-3"},bt={class:"text-lg font-semibold text-slate-800"},gt={class:"mt-4 space-y-4"},vt={class:"rounded-xl border border-slate-100 bg-slate-50 p-3"},ft={class:"text-sm font-medium text-slate-800"},xt={class:"grid gap-3 sm:grid-cols-2"},ht={class:"rounded-xl border border-slate-100 bg-white p-3"},$t={class:"text-base font-semibold text-slate-800"},St={class:"rounded-xl border border-slate-100 bg-white p-3"},kt={class:"rounded-xl border border-slate-100 bg-white p-3"},Ct={class:"mt-2 space-y-1"},Nt={class:"h-2 w-full rounded-full bg-slate-100"},It={class:"text-xs text-slate-500"},Ut={class:"rounded-xl border border-slate-100 bg-white p-3"},At={class:"text-base font-semibold text-slate-800"},Dt={class:"rounded-xl border border-slate-100 bg-white p-3"},Lt={class:"text-base font-semibold text-slate-800"},Pt={__name:"YearlyAttendanceSummary",setup(r){const _=ie(),p=oe(),f=ue(),S=_e(),x=ye(),{companies:h}=z(S),{departments:V}=z(x),u=new Date().getFullYear(),i=b(()=>Array.from({length:6},(a,n)=>{const m=u-n;return{id:String(m),label:String(m)}})),t=B({year:_.query.year||String(u),company_id:_.query.company_id||"",department_id:_.query.department_id||"",department_id_is_null:_.query.department_id_is_null==="1",user_id:_.query.user_id||"",search:_.query.search||"",page:_.query.page?Number(_.query.page):1,per_page:_.query.per_page?Number(_.query.per_page):25,sort_by:_.query.sort_by||"attendance_score_avg",sort_dir:_.query.sort_dir||"desc"}),D=B([]),q=B({total:0,current_page:1,last_page:1,per_page:25}),s=B(!1),l=b(()=>(h.value||[]).length>1),d=b(()=>(h.value||[]).map(a=>({id:String(a.id),label:a.name}))),Y=b(()=>(V.value||[]).map(a=>({id:String(a.id),label:a.name}))),y=B(null),R=B(!1),j=()=>{R.value=!1,y.value=null},J=a=>{const n=Number(a);return Number.isFinite(n)?`${n.toFixed(1)}%`:"—"},E=a=>{const n=Number(a);if(!Number.isFinite(n))return{label:"—",pct:0};const m=Math.max(0,Math.min(5,n));return{label:`${m.toFixed(2)} / 5`,pct:m/5*100}},K=a=>{const n=Number(a||0);return n>=95?"bg-emerald-50 text-emerald-700":n>=80?"bg-amber-50 text-amber-700":"bg-rose-50 text-rose-700"},W=a=>{const n=(a==null?void 0:a.user_name)||(a==null?void 0:a.name)||(a==null?void 0:a.user)||(a==null?void 0:a.employee_name)||"";return n&&(a!=null&&a.user_id)?`${n} (${a.user_id})`:a!=null&&a.user_id?`#${a.user_id}`:n||"—"},X=a=>a!=null&&a.department_name?a.department_name:(a==null?void 0:a.department_id)==null?"Unassigned":String((a==null?void 0:a.department_id)||"Unassigned"),F=()=>{p.replace({query:{year:t.value.year||void 0,company_id:t.value.company_id||void 0,department_id:t.value.department_id||void 0,department_id_is_null:t.value.department_id_is_null?"1":void 0,user_id:t.value.user_id||void 0,search:t.value.search||void 0,page:t.value.page>1?String(t.value.page):void 0,per_page:t.value.per_page!==10?String(t.value.per_page):void 0,sort_by:t.value.sort_by&&t.value.sort_by!=="attendance_score_avg"?t.value.sort_by:void 0,sort_dir:t.value.sort_dir!=="desc"?t.value.sort_dir:void 0}}).catch(()=>{})},Z=a=>{var n;return a?Array.isArray(a)?{data:a,meta:{}}:Array.isArray(a.data)?{data:a.data,meta:a.meta||{}}:Array.isArray((n=a==null?void 0:a.data)==null?void 0:n.data)?{data:a.data.data,meta:a.data.meta||{}}:{data:[],meta:a.meta||{}}:{data:[],meta:{}}},L=async()=>{var n,m,C,N,k,$,O;if(!t.value.company_id){D.value=[],q.value={total:0,current_page:1,last_page:1,per_page:t.value.per_page};return}const a={company_id:t.value.company_id,year:t.value.year||void 0,department_id:t.value.department_id||void 0,department_id_is_null:t.value.department_id_is_null?1:void 0,user_id:t.value.user_id||void 0,search:t.value.search||void 0,page:t.value.page,per_page:t.value.per_page,sort_by:t.value.sort_by,sort_dir:t.value.sort_dir};t.value.department_id_is_null&&delete a.department_id,s.value=!0;try{const c=await rt(a),P=Z(c==null?void 0:c.data);D.value=P.data||[],q.value={total:((n=P.meta)==null?void 0:n.total)??((m=P.data)==null?void 0:m.length)??0,current_page:((C=P.meta)==null?void 0:C.current_page)??t.value.page,last_page:((N=P.meta)==null?void 0:N.last_page)??1,per_page:((k=P.meta)==null?void 0:k.per_page)??t.value.per_page}}catch(c){f.error(((O=($=c==null?void 0:c.response)==null?void 0:$.data)==null?void 0:O.message)||"Failed to load yearly attendance summary")}finally{s.value=!1}},w=async()=>{t.value.page=1,await L(),F()},ee=async()=>{const a=(h.value||[]).length===1?String(h.value[0].id):"";t.value={year:String(u),company_id:a,department_id:"",department_id_is_null:!1,user_id:"",search:"",page:1,per_page:25,sort_by:"attendance_score_avg",sort_dir:"desc"},a&&await x.fetchDepartments(a),await L(),F()},te=async({sort_by:a,sort_dir:n})=>{t.value.sort_by=a,t.value.sort_dir=n,t.value.page=1,await L(),F()},ae=async a=>{t.value.page=a,await L(),F()},se=async a=>{t.value.per_page=a,t.value.page=1,await L(),F()},ne=a=>{y.value=a,R.value=!0},le=async()=>{var a,n;if(t.value.company_id)try{const m={company_id:t.value.company_id,year:t.value.year||void 0,department_id:t.value.department_id||void 0,department_id_is_null:t.value.department_id_is_null?1:void 0,user_id:t.value.user_id||void 0,search:t.value.search||void 0,sort_by:t.value.sort_by,sort_dir:t.value.sort_dir};t.value.department_id_is_null&&delete m.department_id;const C=await it(m),N=new Blob([C.data],{type:"text/csv"}),k=window.URL.createObjectURL(N),$=document.createElement("a");$.href=k,$.setAttribute("download",`yearly_attendance_summary_${t.value.year}.csv`),document.body.appendChild($),$.click(),document.body.removeChild($),window.URL.revokeObjectURL(k)}catch(m){f.error(((n=(a=m==null?void 0:m.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to export summary")}};return pe(()=>t.value.company_id,async a=>{if(!a){D.value=[],t.value.department_id="",t.value.department_id_is_null=!1;return}t.value.department_id="",t.value.department_id_is_null=!1,await x.fetchDepartments(a)}),me(async()=>{await S.fetchCompanies({ignore_permission:!0}),!t.value.company_id&&(h.value||[]).length===1&&(t.value.company_id=String(h.value[0].id)),t.value.company_id&&await x.fetchDepartments(t.value.company_id),await L()}),(a,n)=>{var m,C,N,k,$,O;return v(),g("div",ot,[e("div",ut,[n[6]||(n[6]=e("div",{class:"space-y-2"},[e("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400"}," At a glance "),e("h1",{class:"title-md"},"Yearly Attendance Summary"),e("p",{class:"text-sm text-slate-500"}," Calculated from view yearly_attendance_summary ")],-1)),e("div",pt,[e("button",{type:"button",class:"btn-2 inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold shadow-sm",disabled:!t.value.company_id,onClick:le},n[5]||(n[5]=[e("i",{class:"far fa-file-csv text-base text-emerald-500"},null,-1),I(" Export CSV ")]),8,mt)])]),U(Ue,{year:t.value.year,"onUpdate:year":n[0]||(n[0]=c=>t.value.year=c),"company-id":t.value.company_id,"onUpdate:companyId":n[1]||(n[1]=c=>t.value.company_id=c),"department-id":t.value.department_id,"onUpdate:departmentId":n[2]||(n[2]=c=>t.value.department_id=c),"department-id-is-null":t.value.department_id_is_null,"onUpdate:departmentIdIsNull":n[3]||(n[3]=c=>t.value.department_id_is_null=c),search:t.value.search,"onUpdate:search":n[4]||(n[4]=c=>t.value.search=c),years:i.value,"company-options":d.value,"department-options":Y.value,"show-company-select":l.value,"is-busy":s.value,onApply:w,onReset:ee},null,8,["year","company-id","department-id","department-id-is-null","search","years","company-options","department-options","show-company-select","is-busy"]),U(dt,{rows:D.value,meta:q.value,"is-loading":s.value,"sort-by":t.value.sort_by,"sort-dir":t.value.sort_dir,page:t.value.page,"per-page":t.value.per_page,onSortChange:te,"onUpdate:page":ae,"onUpdate:perPage":se,onRowClick:ne},null,8,["rows","meta","is-loading","sort-by","sort-dir","page","per-page"]),R.value&&y.value?(v(),g("div",ct,[e("div",{class:"drawer__overlay",onClick:j}),e("aside",_t,[e("div",yt,[e("div",null,[n[7]||(n[7]=e("p",{class:"text-xs uppercase tracking-wide text-slate-400"},"User Detail",-1)),e("h2",bt,o(W(y.value)),1)]),e("button",{class:"btn-3",type:"button",onClick:j},"Close")]),e("div",gt,[e("div",vt,[n[8]||(n[8]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Department",-1)),e("p",ft,o(X(y.value)),1)]),e("div",xt,[e("div",ht,[n[9]||(n[9]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Year",-1)),e("p",$t,o(y.value.year),1)]),e("div",St,[n[10]||(n[10]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Present %",-1)),e("span",{class:M(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-semibold",K((m=y.value)==null?void 0:m.yearly_present_pct)])},o(J((C=y.value)==null?void 0:C.yearly_present_pct)),3)]),e("div",kt,[n[11]||(n[11]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Score Avg",-1)),e("div",Ct,[e("div",Nt,[e("div",{class:"h-2 rounded-full bg-emerald-500",style:ce({width:`${E((N=y.value)==null?void 0:N.attendance_score_avg).pct}%`})},null,4)]),e("p",It,o(E((k=y.value)==null?void 0:k.attendance_score_avg).label),1)])]),e("div",Ut,[n[12]||(n[12]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Score Months",-1)),e("p",At,o((($=y.value)==null?void 0:$.score_months)??"—"),1)]),e("div",Dt,[n[13]||(n[13]=e("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Total Months",-1)),e("p",Lt,o(((O=y.value)==null?void 0:O.total_months)??"—"),1)])]),n[14]||(n[14]=e("div",{class:"rounded-xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-500"}," Trend placeholder: monthly performance sparkline coming soon. ",-1))])])])):Q("",!0)])}}},Tt=H(Pt,[["__scopeId","data-v-ffa26610"]]);export{Tt as default};
