import{x as G,c as n,o as s,_ as Ge,r as $,Q as We,h as me,q as rt,k as b,a as e,j as E,F as V,e as z,t as p,n as P,s as F,d as k,M as ee,m as D,w as M,E as oe,p as Ye,b as N,l as te,v as Qe,C as Ke,g as Je,P as pe,R as Ve,y as Xe,A as xe,f as nt,u as ot}from"./index-BqKeeGNh.js";import{_ as Ze}from"./TextEditor-D3QWjF8M.js";import{s as Fe,_ as at}from"./TaskAddForm-Bk95ARAP.js";import{u as et}from"./useCommentStore-BYAdHfJd.js";import{O as J}from"./OverlyModal-DmCgVgo7.js";import{L as ve}from"./LoaderView-Ng1Y0GRQ.js";import{_ as it}from"./ShareComponent-C5ti9itH.js";import{_ as He}from"./DepartmentChip-C8rUJ9Yy.js";import{_ as ce}from"./DescriptionView-vEIipe0k.js";import{i as tt,f as ge,a as lt,_ as dt,b as ut}from"./TaskTableRow--HGalPN1.js";import{b as ct,r as mt,c as pt,f as ye,d as bt,s as vt}from"./requirement-D1WoZ6QM.js";import{_ as ft}from"./AttachmentPreview-BIt6ZK1a.js";import{_ as ue}from"./UserChip-DBTFX08D.js";import{o as xt}from"./url-Buz9GlSr.js";import{u as gt}from"./user-Dt26gMGp.js";import{_ as Ya,a as yt}from"./TaskUserAssignForm-DRtnY2Ub.js";import{b as ae,c as st}from"./datetime-y2WWmmYq.js";import{u as _t}from"./useTaskStore-BYjdbSsD.js";import{_ as kt}from"./TaskSelectionInput-D--5EG2I.js";import{_ as ht}from"./TaskEditForm-Gb40T9fj.js";import{T as fe}from"./TextWithHr-Dxv4mWw7.js";import{c as wt}from"./dom-Bic1TNqD.js";import{_ as $t}from"./ApproveAndReject-Bh3Tboyw.js";import"./RequiredIcon-C3r7n4Oi.js";import"./company-BW4XhIqe.js";import"./CompanyDepartmentSelectInput-Ibv2UyMl.js";import"./SelectDropdown-DTGxy85M.js";import"./SectionLoading-DNhtKstb.js";import"./TaskUrgencyInput-CE2_id8o.js";import"./TaskUrgentBadge-Bzmz5iFe.js";import"./TaskTitle-w_aOIez_.js";import"./TaskStatus-DeOikntl.js";import"./TaskIsClosedBadge-F_CgJV7J.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-jHVh15wO.js";import"./tags-CninmoFd.js";function qt(d){const c=new DOMParser().parseFromString(d,"text/html"),u=/#(\d+)/g;function m(t){t.childNodes.forEach(l=>{if(l.nodeType===Node.TEXT_NODE){const v=l.textContent.replace(u,(x,a)=>`<a href="/requirement-tasks/${a}" class="text-pink-600 hover:underline font-bold">${x}</a>`);if(v!==l.textContent){const x=document.createElement("span");x.innerHTML=v,l.replaceWith(...x.childNodes)}}else m(l)})}return m(c.body),c.body.innerHTML}function Ct(d){const c=new DOMParser().parseFromString(d,"text/html"),u=/(https?:\/\/[^\s]+)/g;function m(t){t.childNodes.forEach(l=>{if(l.nodeType===Node.TEXT_NODE){const v=l.textContent.replace(u,x=>`<a href="${x}" target="_blank" class="text-blue-600 hover:underline">
            ${x}
            <i class="fas fa-external-link text-xs text-blue-600"></i>
          </a>`);if(v!==l.textContent){const x=document.createElement("span");x.innerHTML=v,l.replaceWith(...x.childNodes)}}else m(l)})}return m(c.body),c.body.innerHTML}const Tt=["innerHTML"],be={__name:"HTMLTextBody",props:{message:{type:String,required:!0}},setup(d){const w=d,c=G(()=>Ct(qt(w.message)));return(u,m)=>(s(),n("div",{class:"prose prose-sm max-w-none leading-loose text-sm",innerHTML:c.value},null,8,Tt))}},jt={class:"space-y-4"},At={key:0,class:"space-y-2"},St={class:"text-xs opacity-80"},Rt=["onClick"],It={class:"space-y-4"},Dt={key:0,class:"text-sm text-gray-500"},Nt={key:1,class:"text-sm text-gray-500"},Ot={key:0,class:"shrink-0 mt-2"},Et={class:"bg-inherit bubble-inner px-4 py-3 rounded-md"},Mt={class:"text-sm font-bold text-gray-800"},Lt={class:"text-xs text-gray-400"},Pt={key:0,class:"mt-3 pt-2 border-t border-dashed border-gray-200"},Ut={class:"flex flex-wrap gap-2 items-center"},Bt=["title"],Vt={key:0,class:"fas fa-check-circle text-[10px]"},Ft={key:0,class:"mt-2 border rounded border-dashed p-2 text-center flex flex-col items-center gap-2 bg-yellow-50"},Ht=["onClick","disabled"],zt=["onClick"],Gt={key:2,class:"mt-2 space-y-1"},Wt={key:1,class:"shrink-0 mt-2"},Yt={class:"bg-white rounded-xl shadow-sm border p-4 space-y-3"},Qt={class:"flex items-center gap-2"},Kt={class:"text-sm font-semibold text-gray-700"},Jt={class:"flex items-center justify-end gap-2"},Xt=["disabled"],Zt={key:0,class:"text-xs text-red-600"},es={class:"bg-white rounded-2xl w-full p-5 space-y-4"},ts={class:"rounded-xl bg-slate-50 border border-slate-100 p-3 text-sm text-gray-700 max-h-40 overflow-auto"},ss=["innerHTML"],rs={__name:"CommentBox",props:{commentableType:{type:String,required:!0},commentableId:{type:[Number,String],required:!0},currentUser:{type:Object,required:!0},mentionableUsers:{type:Array,default:()=>[]}},setup(d){const w=d,c=$(!1),u=$(null),m=_=>{u.value=_,c.value=!0},t=()=>{c.value=!1,u.value=null},l=async()=>{if(!u.value)return;const _=u.value.id;t(),await se(_)},v=$([]),x=$({}),a=_=>{_&&v.value.push({id:crypto.randomUUID(),message:_,time:new Date().toISOString()})},f=(_,C)=>{!_||!C||(x.value[_]||(x.value[_]=[]),x.value[_].push(C))},r=_=>{x.value[_]=[]},o=et(),g=We(),h=G(()=>o.comments),q=G(()=>o.loading),R=G(()=>o.error),S=$(""),I=$(!1),O=async()=>{await o.fetchComments({commentable_type:w.commentableType,commentable_id:w.commentableId})},L=async()=>{if(!(!S.value||!Fe(String(S.value)).trim())){I.value=!0;try{await o.createComment({commentable_type:w.commentableType,commentable_id:Number(w.commentableId),user_id:w.currentUser.id,message:S.value}),S.value=""}catch(_){a(_.message)}finally{I.value=!1}}},se=async _=>{var C,H;r(_);try{await o.deleteComment(_)}catch(y){f(_,(H=(C=y.response)==null?void 0:C.data)==null?void 0:H.message)}};me(O),rt(()=>[w.commentableType,w.commentableId],()=>O());const W=_=>_?new Date(_).toLocaleString():"",re=_=>(_==null?void 0:_.user_id)===w.currentUser.id,U=_=>(_==null?void 0:_.user_id)===w.currentUser.id,ne=_=>{var C;return(C=_.mentions)==null?void 0:C.find(H=>H.user_id==w.currentUser.id)},le=_=>{const C=ne(_);return C&&C.acknowledged_at},X=$(null),A=async _=>{var C,H;X.value=_;try{await o.acknowledgeComment(_),g.success("Acknowledge successful")}catch(y){console.error("Acknowledge error:",y);const i=((H=(C=y.response)==null?void 0:C.data)==null?void 0:H.message)||"Failed to acknowledge";f(_,i),g.error(i)}finally{X.value=null}};return(_,C)=>{var H;return s(),n("div",jt,[v.value.length?(s(),n("div",At,[(s(!0),n(V,null,z(v.value,y=>(s(),n("div",{key:y.id,class:"rounded-xl border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-700 flex items-start justify-between gap-3"},[e("div",null,[C[1]||(C[1]=e("p",{class:"font-semibold"},"Error",-1)),e("p",St,p(y.message),1)]),e("button",{class:"text-xs text-red-500 hover:underline",onClick:i=>v.value=v.value.filter(Q=>Q.id!==y.id)}," Dismiss ",8,Rt)]))),128))])):b("",!0),e("div",It,[q.value&&P(o).action=="fetching"?(s(),n("div",Dt," Loading comments... ")):h.value.length?b("",!0):(s(),n("div",Nt,"No comments yet.")),(s(!0),n(V,null,z(h.value,y=>{var i,Q,K;return s(),n("div",{key:y.id,class:F(["flex gap-3",U(y)?"justify-end":"justify-start"])},[U(y)?b("",!0):(s(),n("div",Ot,[k(ee,{user:y.user},null,8,["user"])])),e("div",{class:F(["group relative min-w-[25%] max-w-[90%] rounded-md shadow border bubble-arrow",U(y)?"bubble-right bg-indigo-50 border-indigo-100":"bubble-left bg-white border-gray-100"])},[e("div",Et,[e("div",{class:F(["flex items-center gap-2 mb-2 pb-1 border-b border-dashed",U(y)?"justify-end":"justify-start"])},[e("p",Mt,p(U(y)?"You":((i=y.user)==null?void 0:i.name)||"Unknown"),1),C[2]||(C[2]=e("span",{class:"text-xs text-gray-400"},"•",-1)),e("p",Lt,p(W(y.created_at)),1)],2),k(be,{message:y.message},null,8,["message"]),(Q=y.mentions)!=null&&Q.length?(s(),n("div",Pt,[e("div",Ut,[C[3]||(C[3]=e("span",{class:"text-[10px] text-gray-400 uppercase font-semibold"},"Mentions:",-1)),(s(!0),n(V,null,z(y.mentions,T=>{var B;return s(),n("div",{key:T.id,class:"flex items-center gap-1 group/mention"},[e("div",{class:F(["flex items-center gap-1.5 px-1 py-0.5 rounded-full text-xs box-border border transition cursor-default",T.acknowledged_at?"bg-green-50 border-green-200 text-green-700":"bg-gray-50 border-gray-200 text-gray-500"]),title:T.acknowledged_at?`Acknowledged at ${W(T.acknowledged_at)}`:"Not acknowledged yet"},[k(ee,{user:T.user,size:"2xsmall"},null,8,["user"]),e("span",null,p((B=T.user)==null?void 0:B.name),1),T.acknowledged_at?(s(),n("i",Vt)):b("",!0)],10,Bt)])}),128))]),ne(y)&&!le(y)?(s(),n("div",Ft,[C[4]||(C[4]=e("span",{class:"text-sm text-gray-700 font-medium"}," You Have been mentioned ",-1)),e("button",{onClick:T=>A(y.id),disabled:X.value===y.id,class:"flex items-center gap-2 px-3 py-1.5 bg-sky-600 hover:bg-sky-700 disabled:opacity-70 text-white text-xs font-semibold rounded-lg transition shadow-sm"},[e("i",{class:F(["fas",X.value===y.id?"fa-spinner fa-spin":"fa-check"])},null,2),e("span",null,p(X.value===y.id?"Acknowledging...":"Acknowledge"),1)],8,Ht)])):b("",!0)])):b("",!0),re(y)?(s(),n("div",{key:1,class:F(["mt-2 flex",U(y)?"justify-end":"justify-start"])},[e("button",{class:"text-[11px] text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100",onClick:T=>m(y)}," Delete ",8,zt)],2)):b("",!0),(K=x.value[y.id])!=null&&K.length?(s(),n("div",Gt,[(s(!0),n(V,null,z(x.value[y.id],(T,B)=>(s(),n("p",{key:B,class:F(["text-xs text-red-600",U(y)?"text-right":"text-left"])},p(T),3))),128))])):b("",!0)])],2),U(y)?(s(),n("div",Wt,[k(ee,{user:y.user||d.currentUser},null,8,["user"])])):b("",!0)],2)}),128))]),e("div",Yt,[e("div",Qt,[k(ee,{user:d.currentUser},null,8,["user"]),e("div",Kt,p(((H=d.currentUser)==null?void 0:H.name)||"You"),1)]),k(Ze,{modelValue:S.value,"onUpdate:modelValue":C[0]||(C[0]=y=>S.value=y),"mentionable-users":d.mentionableUsers,"current-user":d.currentUser},null,8,["modelValue","mentionable-users","current-user"]),e("div",Jt,[e("button",{class:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm disabled:opacity-60",disabled:I.value||!P(Fe)(String(S.value)).trim(),onClick:L},p(I.value?"Posting...":"Post Comment"),9,Xt)]),R.value?(s(),n("p",Zt,p(R.value),1)):b("",!0)]),c.value?(s(),E(J,{key:1},{default:D(()=>{var y;return[e("div",es,[C[5]||(C[5]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete comment?",-1)),C[6]||(C[6]=e("p",{class:"text-sm text-gray-600 leading-relaxed"}," আপনি কি নিশ্চিত যে এই কমেন্টটি মুছে ফেলতে চান? মুছে ফেলা কমেন্ট পুনরুদ্ধার করা যাবে না। ",-1)),e("div",ts,[e("div",{innerHTML:(y=u.value)==null?void 0:y.message},null,8,ss)]),e("div",{class:"flex items-center justify-end gap-2 pt-2"},[e("button",{class:"px-4 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-50",onClick:t}," Cancel "),e("button",{class:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700",onClick:l}," Yes, Delete ")])])]}),_:1})):b("",!0)])}}},ns=Ge(rs,[["__scopeId","data-v-21ebccc0"]]),os={class:"flex items-center border-b w-full pb-2"},as={class:""},is={class:"mt-4 border h-40 flex items-center flex-col justify-center rounded border-dashed bg-red-50 text-center"},ls={key:1,class:"text-red-500 text-center mt-2"},ds={class:"flex items-center justify-between mt-4"},us={__name:"RequirementAttachmentForm",props:{requirementId:[String,Number],default:()=>null},emits:["uploaded","error","clickBack"],setup(d,{emit:w}){const c=d,u=$({attachments:[]}),m=$(""),t=$(""),l=w;function v(f){u.value.attachments=[...u.value.attachments,...Array.from(f.target.files)]}function x(f){u.value.attachments.splice(f,1)}async function a(){var r,o,g,h;m.value="submitting";const f=new FormData;for(const q in u.value)q==="attachments"?u.value.attachments.forEach(R=>f.append("attachments[]",R)):f.append(q,u.value[q]);try{const q=await ct(c.requirementId,f);u.value.attachments=[],l("uploaded",q),m.value="uploaded"}catch(q){l("error",(o=(r=q.response)==null?void 0:r.data)==null?void 0:o.message),t.value=(h=(g=q.response)==null?void 0:g.data)==null?void 0:h.message,m.value="error"}}return(f,r)=>{var o;return s(),n("form",{class:"p-4 flex flex-col relative",onSubmit:M(a,["prevent"])},[m.value=="submitting"?(s(),E(ve,{key:0,class:"absolute inset-0 bg-opacity-80 flex items-center justify-center"})):b("",!0),e("div",os,[r[3]||(r[3]=e("h3",null,"Requirement Attachment",-1)),e("button",{class:"btn-icon ml-auto",onClick:r[0]||(r[0]=M(()=>{l("clickBack")},["prevent"]))},r[2]||(r[2]=[e("span",{class:"fas fa-times"},null,-1)]))]),e("div",as,[e("label",is,[r[4]||(r[4]=e("div",{class:"block text-gray-600 font-medium text-sm md:text-xl mb-4"}," Click to Select files or Drop Here ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",class:"border rounded-r-md text-gray-600 bg-gray-50",onChange:v},null,32)])]),k(ft,{files:((o=u.value)==null?void 0:o.attachments)||[],onRemove:x,class:"border p-1 rounded overflow-y-auto flex-grow"},null,8,["files"]),r[6]||(r[6]=e("hr",{class:"mt-4"},null,-1)),t.value?(s(),n("div",ls,p(t.value),1)):b("",!0),e("div",ds,[e("button",{class:"btn-3",onClick:r[1]||(r[1]=M(g=>l("clickBack"),["prevent"]))},"Cancel"),r[5]||(r[5]=e("button",{class:"btn-2"},"Save",-1))])],32)}}},cs={class:"card-bg p-4 pt-2"},ms={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 w-full"},ps=["onClick"],bs=["src"],vs=["href"],fs={key:2,class:"text-xs text-gray-500 text-center"},xs={__name:"RequirementAttachments",props:{requirement:{type:Array,default:()=>[]}},setup(d){const w=d,c=G(()=>{var t;return((t=w.requirement)==null?void 0:t.attachments)||[]}),u=oe({show:!1}),m=oe({show:!1,selectedFile:""});return(t,l)=>(s(),n("div",cs,[e("div",null,[l[6]||(l[6]=e("h4",{class:"text-gray-900 font-semibold mb-3 border-b font-e"},"Attachments",-1)),e("div",ms,[c.value&&c.value.length?(s(!0),n(V,{key:0},z(c.value,(v,x)=>(s(),n("div",{key:x,class:"border p-1 rounded aspect-square flex items-center justify-center bg-gray-50 relative",tabindex:"0",onClick:M(()=>{m.show=!0,m.selectedFile=v},["prevent"])},[P(tt)(v)?(s(),n("img",{key:0,src:P(ge)(v),alt:"attachment",class:"object-cover w-full h-full rounded"},null,8,bs)):P(lt)(v)?(s(),n("a",{key:1,href:P(ge)(v),target:"_blank",class:"text-xs text-blue-600 text-center break-words hover:underline"},l[4]||(l[4]=[e("i",{class:"fas fa-file-pdf fa-2x mb-1 text-amber-700"},null,-1),e("div",{class:"whitespace-nowrap text-xs mt-1"},"Open PDF",-1)]),8,vs)):(s(),n("span",fs,"Unknown"))],8,ps))),128)):b("",!0),e("button",{title:"Add Attachments",onClick:l[0]||(l[0]=M(v=>u.show=!u.show,["prevent"])),class:"border rounded aspect-square flex items-center justify-center bg-sky-50 hover:bg-sky-100 relative group/btn"},l[5]||(l[5]=[e("i",{class:"fas fa-plus-circle text-2xl text-blue-300 group-hover/btn:text-blue-500"},null,-1)]))])]),u.show?(s(),E(J,{key:0},{default:D(()=>[k(us,{onClickBack:l[1]||(l[1]=v=>u.show=!1),onUploaded:l[2]||(l[2]=v=>u.show=!1),requirementId:d.requirement.id,class:"max-h-[70vh]"},null,8,["requirementId"])]),_:1})):b("",!0),m.show?(s(),E(J,{key:1,class:"*:max-w-4xl *:min-h-[60vh]"},{default:D(()=>[k(dt,{attachments:c.value,selected:m.selectedFile,onClickClose:l[3]||(l[3]=v=>m.show=!1)},null,8,["attachments","selected"])]),_:1})):b("",!0)]))}},gs={class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},ys={class:"text-sm flex flex-col xl:flex-row items-center mt-2 xl:mt-0 gap-x-2 text-red-400 font-semibold whitespace-nowrap"},_s={class:"mt-[2px]"},ks={key:0,class:"text-gray-800 flex items-center gap-2"},hs={key:1,class:"text-gray-800 w-full my-2 text-center"},ws={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},$s=["innerHTML"],qs={key:1,class:"flex gap-4 items-center justify-center mt-2"},Cs={key:2,class:"mb-2"},Ts={class:"flex justify-end text-sky-500"},js={key:3,class:"text-center w-full"},As={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick","closeClick","showHistoryClick"],setup(d,{emit:w}){const c=w;return(u,m)=>{var t,l;return s(),n("div",gs,[d.requirement.closed_at?(s(),n(V,{key:0},[m[6]||(m[6]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",ys,[m[3]||(m[3]=e("span",{class:"flex items-center gap-2 text-gray-600"},[e("span",{class:"fad fa-lock"}),e("span",{class:"mt-[2px]"},"CLOSED AT")],-1)),e("span",_s,p(new Date(d.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),d.requirement.closed_by_user?(s(),n("div",ks,[m[4]||(m[4]=e("span",{class:"text-sm"},"Closed by",-1)),k(ue,{user:d.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):b("",!0),d.requirement.closing_note?(s(),n("div",hs,[m[5]||(m[5]=e("div",{class:"text-xs text-left"},"Note",-1)),e("div",ws,[e("p",{innerHTML:d.requirement.closing_note},null,8,$s)])])):b("",!0)],64)):b("",!0),d.requirement.closed_at?(s(),n("div",qs,[e("button",{class:"btn-2 h-8",onClick:m[0]||(m[0]=M(v=>c("reOpenClick"),["prevent"]))},"Re Open")])):b("",!0),d.requirement.closed_at?b("",!0):(s(),n("div",Cs,[e("div",Ts,[e("button",{class:"btn-1 border border-sky-800",onClick:m[1]||(m[1]=M(v=>c("closeClick"),["prevent"]))}," Close Requirement ")])])),((l=(t=d.requirement)==null?void 0:t.closing_history)==null?void 0:l.length)>1?(s(),n("div",js,[e("button",{onClick:m[2]||(m[2]=v=>c("showHistoryClick")),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):b("",!0)])}}},Ss={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},Rs={class:"my-6"},Is={class:"text-center font-semibold text-blue-800 mb-4"},Ds={class:"text-center my-1"},Ns={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},Os={class:"mt-4"},Es=["placeholder","required"],Ms={class:"flex"},Ls={class:"text-red-600 text-center mt-2 text-sm"},Ps={class:"flex justify-between mt-3"},Us=["disabled"],Bs={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(d,{emit:w}){const c=d,u=w,m=G({get:()=>c.loading,set:()=>u("update:loading")}),t=$(""),l=$(""),v=$(255),x=G(()=>v.value-t.value.length);async function a(){var f,r,o;m.value=!0;try{(f=c.requirement)!=null&&f.closed_at?await mt(c.requirement.id,t.value):await pt(c.requirement.id,t.value),u("updateStatus")}catch(g){l.value=(o=(r=g.response)==null?void 0:r.data)==null?void 0:o.message,u("error")}finally{m.value=!1}}return(f,r)=>{var g,h,q,R,S;const o=Ye("LoaderView");return s(),n("form",{class:"p-4 rounded relative border",onSubmit:M(a,["prevent"])},[m.value?(s(),E(o,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:D(()=>r[3]||(r[3]=[N(" Submitting! ")])),_:1,__:[3]})):b("",!0),e("h3",Ss,p((g=d.requirement)!=null&&g.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",Rs,[e("div",Is,p((h=d.requirement)==null?void 0:h.title),1),r[6]||(r[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",Ds,[r[4]||(r[4]=N(" Want to ")),e("span",Ns,p((q=d.requirement)!=null&&q.closed_at?"Re-Open":"Close"),1),r[5]||(r[5]=N(" the requirement? "))]),e("div",Os,[te(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=I=>t.value=I),rows:"4",placeholder:`Write about why are you ${(R=d.requirement)!=null&&R.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:f.currentAction==="reject",onInput:r[1]||(r[1]=I=>t.value.length>v.value?t.value=t.value.slice(0,v.value):null)},null,40,Es),[[Qe,t.value]]),e("div",Ms,[e("div",{class:F(["ml-auto inline-block text-sm text-gray-500",t.value.length>=v.value?"text-red-500":""])}," left "+p(x.value)+"/"+p(v.value)+" words ",3)])])]),r[7]||(r[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",Ls,p(l.value),1),e("div",Ps,[e("button",{class:"btn-3",onClick:r[2]||(r[2]=M(I=>u("clickCancel"),["prevent"]))},"Cancel"),e("button",{class:"btn-2 disabled:opacity-45",disabled:t.value.trim().length==0},p((S=d.requirement)!=null&&S.closed_at?"Re-Open Requirement":"Close Requirement"),9,Us)])])],32)}}};async function Vs(d,w,{params:c={}}={}){return Ke.get(`/requirements/${d}/details/${w}`,{params:c})}async function Fs(d,w,{params:c={}}={}){const u=xt(c);return Ke.delete(`/requirements/${d}/details/${w}${u?"?"+u:""}`)}const Hs={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},zs={class:"mb-4"},Gs={class:"font-semibold"},Ws={class:"mb-4"},Ys={class:"line-clamp-2"},Qs={key:1,class:"min-h-40"},Ks={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Js={key:0,class:"mb-4 text-red-500 font-medium"},Xs={key:1,class:"mb-4"},Zs={class:"flex items-center justify-between gap-4"},er=["disabled"],tr={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(d,{emit:w}){const c=d,u=w,m=gt(),t=$(null),l=$(""),v=$(),x=$([]);async function a(){var f,r;l.value="submitting";try{const o=await Fs(c.requirementId,c.detailId);u("delete",o),l.value="create"}catch(o){l.value="error",v.value=((r=(f=o.response)==null?void 0:f.data)==null?void 0:r.message)||"Failed to update requirement detail: "+o,u("error",v.value)}}return me(async()=>{var f,r,o;l.value="loading";try{x.value=await m.fetchDepartmentWiseEmployees(),t.value=(f=(await Vs(c.requirementId,c.detailId)).data)==null?void 0:f.detail}catch(g){v.value=((o=(r=g.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to fetch requirement detail"}finally{l.value=""}}),(f,r)=>{var o,g;return s(),n("div",Hs,[r[4]||(r[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:M(a,["prevent"]),class:"z-0"},[l.value!=="loading"?(s(),n(V,{key:0},[e("div",zs,[r[1]||(r[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Gs,p((o=t.value)==null?void 0:o.title),1)]),e("div",Ws,[r[2]||(r[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",Ys,p((g=t.value)==null?void 0:g.description),1)]),r[3]||(r[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(s(),n("div",Qs)),e("div",Ks,[v.value?(s(),n("div",Js,p(v.value),1)):b("",!0),v.value?(s(),n("hr",Xs)):b("",!0),e("div",Zs,[e("button",{type:"button",onClick:r[0]||(r[0]=M(h=>u("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},p(l.value=="submitting"?"Deleting...":"Delete"),9,er)])])],32),l.value==="loading"||l.value==="submitting"?(s(),E(ve,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):b("",!0)])}}};const sr={class:"sticky top-0 pt-4 bg-white z-10"},rr={class:"mb-4"},nr={class:"mb-4"},or={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ar={key:0,class:"mb-4 text-red-500 font-medium"},ir={key:1,class:"mb-4"},lr={class:"flex items-center justify-between gap-4"},dr=["disabled"],ur={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(d,{emit:w}){const c=d,u=w,m=$(),t=$(null),l=$(""),v=$(),x=$({feedback:""});async function a(){var f,r;l.value="submitting";try{const o=await bt(c.requirementId,x.value.feedback);u("update",o),l.value="create"}catch(o){l.value="error",v.value=((r=(f=o.response)==null?void 0:f.data)==null?void 0:r.message)||"Failed to update requirement requirement",u("error",v.value)}}return me(async()=>{var f,r,o,g;l.value="loading";try{await ye(c.requirementId),t.value=(f=(await ye(c.requirementId)).data)==null?void 0:f.requirement,x.value={feedback:(r=t.value)==null?void 0:r.feedback}}catch(h){v.value=((g=(o=h.response)==null?void 0:o.data)==null?void 0:g.message)||"Failed to fetch requirement requirement"}finally{l.value=""}}),(f,r)=>{var o;return s(),n("div",{ref_key:"formContainerRef",ref:m,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",sr,[r[3]||(r[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),r[4]||(r[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=M(g=>u("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:M(a,["prevent"]),class:"z-0"},[l.value!=="loading"?(s(),n(V,{key:0},[e("div",rr,[r[5]||(r[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),k(ce,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:D(()=>{var g;return[N(p((g=t.value)==null?void 0:g.title),1)]}),_:1})]),e("div",nr,[r[6]||(r[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),k(Ze,{modelValue:x.value.feedback,"onUpdate:modelValue":r[1]||(r[1]=g=>x.value.feedback=g)},null,8,["modelValue"])])],64)):b("",!0),e("div",or,[v.value?(s(),n("div",ar,p(v.value),1)):b("",!0),v.value?(s(),n("hr",ir)):b("",!0),e("div",lr,[e("button",{type:"button",onClick:r[2]||(r[2]=M(g=>u("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"btn-2"},p(l.value=="submitting"?"Saving...":(o=t.value)!=null&&o.feedback?"Update Feedback":"Add Feedback"),9,dr)])])],32),l.value==="loading"||l.value==="submitting"?(s(),E(ve,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):b("",!0)],512)}}},cr={class:"bg-white p-6 rounded-lg w-full w-full"},mr={class:"flex items-center justify-between mb-4 border-b pb-2"},pr={class:"space-y-4"},br={class:"space-y-2"},vr={class:"flex items-center gap-2"},fr={key:0,class:"ml-6 space-y-2 p-2 bg-gray-50 rounded-md"},xr={class:"flex items-center gap-2"},gr={class:"flex items-center gap-2"},yr={class:"flex items-center gap-2"},_r={class:"flex items-center gap-2"},kr={class:"flex items-center gap-2"},hr={class:"mt-8 flex justify-end gap-3 border-t pt-4"},wr={__name:"RequirementPrintOptions",props:{initialOptions:{type:Object,default:()=>({withTasks:!0,taskOption:"list",withMessages:!0,withApprovals:!0,withAttachments:!0})}},emits:["close","print"],setup(d,{emit:w}){const c=d,u=w,m=oe({...c.initialOptions});return(t,l)=>(s(),n("div",cr,[e("div",mr,[l[10]||(l[10]=e("h3",{class:"text-xl font-bold"},"Print Options",-1)),e("button",{onClick:l[0]||(l[0]=v=>u("close")),class:"text-gray-500 hover:text-gray-700"},l[9]||(l[9]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",pr,[e("div",br,[e("div",vr,[te(e("input",{type:"checkbox","onUpdate:modelValue":l[1]||(l[1]=v=>m.withTasks=v),id:"withTasks",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[pe,m.withTasks]]),l[11]||(l[11]=e("label",{for:"withTasks",class:"font-semibold text-gray-700"},"Print with Tasks",-1))]),m.withTasks?(s(),n("div",fr,[e("div",xr,[te(e("input",{type:"radio","onUpdate:modelValue":l[2]||(l[2]=v=>m.taskOption=v),value:"list",id:"taskOptionList",class:"w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[Ve,m.taskOption]]),l[12]||(l[12]=e("label",{for:"taskOptionList",class:"text-sm text-gray-600"},"Task list with count",-1))]),e("div",gr,[te(e("input",{type:"radio","onUpdate:modelValue":l[3]||(l[3]=v=>m.taskOption=v),value:"countOnly",id:"taskOptionCount",class:"w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[Ve,m.taskOption]]),l[13]||(l[13]=e("label",{for:"taskOptionCount",class:"text-sm text-gray-600"},"Only task count (completed/total)",-1))])])):b("",!0)]),e("div",yr,[te(e("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=v=>m.withMessages=v),id:"withMessages",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[pe,m.withMessages]]),l[14]||(l[14]=e("label",{for:"withMessages",class:"font-semibold text-gray-700"},"Print with message list",-1))]),e("div",_r,[te(e("input",{type:"checkbox","onUpdate:modelValue":l[5]||(l[5]=v=>m.withApprovals=v),id:"withApprovals",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[pe,m.withApprovals]]),l[15]||(l[15]=e("label",{for:"withApprovals",class:"font-semibold text-gray-700"},"Print with Approval list",-1))]),e("div",kr,[te(e("input",{type:"checkbox","onUpdate:modelValue":l[6]||(l[6]=v=>m.withAttachments=v),id:"withAttachments",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[pe,m.withAttachments]]),l[16]||(l[16]=e("label",{for:"withAttachments",class:"font-semibold text-gray-700"},"Print Attachments (Images on separate page)",-1))])]),e("div",hr,[e("button",{onClick:l[7]||(l[7]=v=>u("close")),class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition"}," Cancel "),e("button",{onClick:l[8]||(l[8]=v=>u("print",m)),class:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition font-semibold"},l[17]||(l[17]=[e("i",{class:"fas fa-print mr-2"},null,-1),N(" Print ")]))])]))}},$r={class:"requirement-print-preview bg-white text-black p-8 font-serif leading-relaxed"},qr={class:"border-b-2 border-gray-800 pb-4 mb-6"},Cr={class:"flex justify-between items-start"},Tr={class:"text-sm text-gray-600 mt-1"},jr={class:"font-semibold"},Ar={class:"text-right"},Sr={class:"text-lg font-bold text-indigo-700"},Rr={class:"grid grid-cols-2 gap-x-12 gap-y-4 mb-6 text-sm"},Ir={class:"space-y-2"},Dr={class:"flex justify-between border-b border-gray-100 pb-1"},Nr={class:"font-medium text-right"},Or={class:"flex justify-between border-b border-gray-100 pb-1"},Er={class:"font-medium text-right"},Mr={class:"flex justify-between border-b border-gray-100 pb-1"},Lr={class:"font-medium text-right"},Pr={class:"space-y-2"},Ur={class:"flex justify-between border-b border-gray-100 pb-1"},Br={class:"flex justify-between border-b border-gray-100 pb-1"},Vr={class:"font-medium text-right"},Fr={class:"flex justify-between border-b border-gray-100 pb-1"},Hr={class:"font-medium text-right"},zr={class:"mb-6 p-3 bg-gray-50 rounded border flex items-center gap-4"},Gr={key:0,class:"flex items-center gap-2"},Wr={class:"font-semibold"},Yr={key:0,class:"text-xs text-gray-500"},Qr={key:1,class:"text-gray-400"},Kr={class:"mb-6"},Jr={class:"text-xl mb-2"},Xr={class:"font-bold"},Zr={key:0,class:"print-description prose prose-sm max-w-none text-gray-800 p-0"},en={key:0,class:"mb-6 break-inside-avoid"},tn={class:"flex justify-between items-center mb-4 border-b pb-2"},sn={class:"font-semibold text-sm bg-gray-800 text-white px-3 py-1 rounded-full"},rn={key:0,class:"overflow-hidden border rounded"},nn={class:"w-full border-collapse text-sm"},on={class:"border p-2 text-center font-bold text-gray-400"},an={class:"border p-2"},ln={class:"font-semibold"},dn=["innerHTML"],un={class:"border p-2"},cn={key:0,class:"text-gray-400 text-xs italic"},mn={class:"border p-2 text-center"},pn={key:0},bn={key:1,class:"p-4 border rounded bg-gray-50 text-center italic text-gray-600"},vn={key:1,class:"mb-10"},fn={class:"space-y-4 break-before-page"},xn={class:"flex items-center gap-2 mb-1"},gn={class:"font-bold text-sm"},yn={class:"text-xs text-gray-400"},_n={key:0,class:"text-sm text-gray-700"},kn={class:"mb-10 p-4 bg-blue-50/50 rounded-lg flex items-center justify-between border-l-4 border-blue-400"},hn={class:"flex items-center gap-4"},wn={class:"flex items-center gap-2"},$n={class:"font-bold text-gray-800"},qn={class:"text-right"},Cn={class:"text-sm font-semibold"},Tn={key:2,class:"mb-6"},jn={class:"break-inside-avoid"},An={class:"mb-8"},Sn={class:"text-xs font-bold text-gray-700 text-center uppercase tracking-widest border-b border-dashed pb-1 mb-4"},Rn={class:"grid grid-cols-2 gap-8"},In={key:0,class:"w-full"},Dn={class:"text-[10px] text-gray-500 uppercase font-bold mb-3"},Nn={key:0,class:"space-y-2"},On={class:"flex flex-col items-center gap-2"},En={class:"relative inline-block"},Mn={class:"font-bold text-indigo-700"},Ln={key:0,class:"text-xs text-red-600 font-semibold italic"},Pn={key:1,class:"text-xs text-gray-600 italic"},Un={key:2,class:"mt-1 text-[10px] text-red-600 font-bold px-2 py-0.5 rounded inline-block"},Bn={key:3,class:"mt-1 text-[10px] text-green-600 font-bold px-2 py-0.5 rounded inline-block"},Vn={key:4,class:"mt-1 text-[10px] text-yellow-600 font-bold px-2 py-0.5 rounded inline-block"},Fn={key:1,class:"h-12 flex items-center justify-center text-gray-300 italic text-xs"},Hn={key:0,class:"break-inside-avoid"},zn={class:"text-xs font-bold text-center text-gray-700 uppercase tracking-widest border-b border-dashed pb-1 mb-4"},Gn={class:"grid grid-cols-2 gap-8"},Wn={key:0,class:"w-full"},Yn={class:"text-[10px] text-gray-500 uppercase font-bold mb-3"},Qn={key:0,class:"space-y-2"},Kn={class:"flex flex-col items-center gap-2"},Jn={class:"relative inline-block"},Xn={class:"font-bold text-indigo-700"},Zn={key:0,class:"text-xs text-red-600 font-semibold italic"},eo={key:1,class:"text-xs text-gray-600 italic"},to={key:2,class:"mt-1 text-[10px] text-red-600 font-bold px-2 py-0.5 rounded inline-block"},so={key:3,class:"mt-1 text-[10px] text-green-600 font-bold px-2 py-0.5 rounded inline-block"},ro={key:4,class:"mt-1 text-[10px] text-yellow-600 font-bold px-2 py-0.5 rounded inline-block"},no={key:1,class:"h-12 flex items-center justify-center text-gray-300 italic text-xs"},oo={key:3,class:"break-before-page mt-12"},ao={class:"grid grid-cols-1 gap-8"},io={class:"text-xs text-gray-500 mb-2 font-mono"},lo=["src"],uo={__name:"RequirementPrintPreview",props:{requirement:{type:Object,required:!0},options:{type:Object,required:!0},comments:{type:Array,default:()=>[]}},setup(d){const w=d,c=G(()=>{var m;return(((m=w.requirement)==null?void 0:m.attachments)||[]).filter(t=>tt(t))}),u=m=>{var o,g,h,q,R,S;const t=w.requirement,l={from_in_charge:!!(t!=null&&t.status&&(t!=null&&t.submission_date)),from_coordinator:!!(t!=null&&t.from_coordinator),to_in_charge:!!(t!=null&&t.to_incharge),to_coordinator:!!(t!=null&&t.to_coordinator)},v={from_in_charge:(o=t==null?void 0:t.from_department)==null?void 0:o.in_charge,from_coordinator:(g=t==null?void 0:t.from_department)==null?void 0:g.coordinator,to_in_charge:(h=t==null?void 0:t.to_department)==null?void 0:h.in_charge,to_coordinator:(q=t==null?void 0:t.to_department)==null?void 0:q.coordinator};let x=null,a=null,f="",r="";return m==="from_in_charge"&&(x=t==null?void 0:t.from_department,a=(R=t==null?void 0:t.from_department)==null?void 0:R.in_charge,f="In Charge",r=t==null?void 0:t.from_incharge_note),m==="from_coordinator"&&(x=t==null?void 0:t.from_department,a=t==null?void 0:t.from_coordinator,f="Coordinator",r=t==null?void 0:t.from_coordinator_note),m==="to_in_charge"&&(x=t==null?void 0:t.to_department,a=t==null?void 0:t.to_incharge,f="In Charge",r=t==null?void 0:t.to_incharge_note),m==="to_coordinator"&&(x=t==null?void 0:t.to_department,a=t==null?void 0:t.to_coordinator,f="Coordinator",r=t==null?void 0:t.to_coordinator_note),{department:x,approved:l[m],approval_user:a,is_rejected:(t==null?void 0:t.rejected_by_user_id)&&(t==null?void 0:t.rejected_by_user_id)===((S=v[m])==null?void 0:S.id),userType:f,approval_note:r}};return(m,t)=>{var l,v,x,a,f,r;return s(),n("div",$r,[e("div",qr,[e("div",Cr,[e("div",null,[t[1]||(t[1]=e("h1",{class:"text-xl font-bold uppercase tracking-wider"},"Requirement Report",-1)),e("p",Tr,[t[0]||(t[0]=N(" Generated on ")),e("span",jr,p(P(ae)(new Date)),1)])]),e("div",Ar,[e("div",Sr,"#"+p(d.requirement.id),1),e("div",{class:F(["text-sm font-semibold uppercase px-2 py-0.5 rounded border inline-block mt-1",d.requirement.status==="approved"?"bg-green-100 border-green-400 text-green-800":d.requirement.status==="rejected"?"bg-red-100 border-red-400 text-red-800":"bg-yellow-100 border-yellow-400 text-yellow-800"])},[e("i",{class:F(["mr-1",d.requirement.status==="approved"?"fas fa-check-circle":d.requirement.status==="rejected"?"fas fa-times-circle":"fas fa-clock"])},null,2),N(" "+p(d.requirement.status||"PENDING"),1)],2)])])]),e("div",Rr,[e("div",Ir,[e("div",Dr,[t[2]||(t[2]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Website:",-1)),e("span",Nr,p((d.requirement.website_tags||[]).map(o=>o.name).join(", ")||"N/A"),1)]),e("div",Or,[t[3]||(t[3]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Submission Date:",-1)),e("span",Er,p(d.requirement.submission_date?P(ae)(d.requirement.submission_date):"N/A"),1)]),e("div",Mr,[t[4]||(t[4]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Better To Complete:",-1)),e("span",Lr,p(d.requirement.better_to_complete_on?P(st)(d.requirement.better_to_complete_on):"N/A"),1)])]),e("div",Pr,[e("div",Ur,[t[5]||(t[5]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Priority:",-1)),e("span",{class:F(["font-bold uppercase",d.requirement.priority==="URGENT"?"text-red-600":d.requirement.priority==="IMPORTANT"?"text-orange-600":""])},p(d.requirement.priority||"NORMAL"),3)]),e("div",Br,[t[6]||(t[6]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"From Dept:",-1)),e("span",Vr,p((l=d.requirement.from_department)==null?void 0:l.name),1)]),e("div",Fr,[t[7]||(t[7]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"To Dept:",-1)),e("span",Hr,p((v=d.requirement.to_department)==null?void 0:v.name),1)])])]),e("div",zr,[t[8]||(t[8]=e("span",{class:"text-gray-500 font-bold uppercase text-xs"},"Supervisor:",-1)),d.requirement.supervisor?(s(),n("div",Gr,[k(ee,{user:d.requirement.supervisor,size:"xsmall"},null,8,["user"]),e("span",Wr,p(d.requirement.supervisor.name),1),d.requirement.supervisor.designation?(s(),n("span",Yr,"("+p(d.requirement.supervisor.designation)+")",1)):b("",!0)])):(s(),n("span",Qr,"Not Assigned"))]),e("div",Kr,[e("h2",Jr,[e("span",Xr,p(d.requirement.title),1)]),d.requirement.description?(s(),n("div",Zr,[k(be,{message:d.requirement.description},null,8,["message"])])):b("",!0)]),d.options.withTasks?(s(),n("div",en,[e("div",tn,[t[9]||(t[9]=e("h3",{class:"text-lg font-bold uppercase"},"Tasks",-1)),e("span",sn,p(d.requirement.completed_tasks_count)+" / "+p(d.requirement.tasks_count)+" Completed ",1)]),d.options.taskOption==="list"?(s(),n("div",rn,[e("table",nn,[t[12]||(t[12]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"border p-2 text-left w-12 text-gray-600"},"SL"),e("th",{class:"border p-2 text-left text-gray-600"},"Task Title"),e("th",{class:"border p-2 text-left text-gray-600 w-48"},"Assigned To"),e("th",{class:"border p-2 text-center text-gray-600 w-32"},"Status")])],-1)),e("tbody",null,[(s(!0),n(V,null,z(d.requirement.tasks,(o,g)=>{var h;return s(),n("tr",{key:o.id,class:"border-b hover:bg-gray-50"},[e("td",on,p(g+1),1),e("td",an,[e("div",ln,p(o.title),1),o.description?(s(),n("div",{key:0,class:"text-xs text-gray-500 mt-1",innerHTML:o.description},null,8,dn)):b("",!0)]),e("td",un,[(s(!0),n(V,null,z(o.users,q=>(s(),n("div",{key:q.id,class:"text-xs mb-1 last:mb-0 flex items-center gap-1"},[t[10]||(t[10]=e("span",{class:"w-1.5 h-1.5 bg-indigo-400 rounded-full"},null,-1)),N(" "+p(q.name),1)]))),128)),(h=o.users)!=null&&h.length?b("",!0):(s(),n("span",cn,"Unassigned"))]),e("td",mn,[e("span",{class:F(["px-2 py-0.5 rounded-full text-[10px] uppercase font-bold",o.status==="COMPLETED"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"])},p(o.status),3)])])}),128)),(x=d.requirement.tasks)!=null&&x.length?b("",!0):(s(),n("tr",pn,t[11]||(t[11]=[e("td",{colspan:"4",class:"p-8 text-center text-gray-400 italic"}," No tasks found for this requirement. ",-1)])))])])])):(s(),n("div",bn," Task list hidden based on print options. (Summary: "+p(d.requirement.completed_tasks_count)+" / "+p(d.requirement.tasks_count)+" tasks completed) ",1))])):b("",!0),d.options.withMessages&&d.comments.length?(s(),n("div",vn,[t[13]||(t[13]=e("h3",{class:"text-lg font-bold uppercase mb-4 border-b pb-2"},"Message History",-1)),e("div",fn,[(s(!0),n(V,null,z(d.comments,o=>{var g;return s(),n("div",{key:o.id,class:"border-l-4 border-gray-200 pl-4 py-1"},[e("div",xn,[k(ee,{user:o.user,size:"xsmall"},null,8,["user"]),e("span",gn,p((g=o.user)==null?void 0:g.name),1),e("span",yn,p(P(ae)(o.created_at)),1)]),o.message?(s(),n("div",_n,[k(be,{message:o.message},null,8,["message"])])):b("",!0)])}),128))])])):b("",!0),e("div",kn,[e("div",hn,[t[14]||(t[14]=e("span",{class:"text-xs font-bold text-blue-700 uppercase tracking-widest"},"Submitted By:",-1)),e("div",wn,[k(ee,{user:d.requirement.created_by,size:"xsmall"},null,8,["user"]),e("span",$n,p((a=d.requirement.created_by)==null?void 0:a.name),1)])]),e("div",qn,[t[15]||(t[15]=e("p",{class:"text-[10px] text-gray-500 font-bold uppercase"},"Submission Date",-1)),e("p",Cn,p(P(ae)(d.requirement.created_at)),1)])]),d.options.withApprovals?(s(),n("div",Tn,[e("div",jn,[t[20]||(t[20]=e("h3",{class:"text-lg font-bold uppercase mb-6 border-b pb-2"},"Approvals",-1)),e("div",An,[e("h4",Sn,p((f=d.requirement.from_department)==null?void 0:f.name)+" Approvals ",1),e("div",Rn,[(s(),n(V,null,z(["from_in_charge","from_coordinator"],o=>e("div",{key:o,class:"approval-box p-4 flex flex-col items-center text-center"},[u(o)?(s(),n("div",In,[e("p",Dn,p(u(o).userType),1),u(o).approval_user?(s(),n("div",Nn,[e("div",On,[k(ee,{user:u(o).approval_user,size:"small"},null,8,["user"]),e("div",En,[e("span",Mn,p(u(o).approval_user.name),1),t[16]||(t[16]=e("hr",{class:"border-t-2 border-indigo-100 mt-0.5"},null,-1))])]),u(o).is_rejected&&d.requirement.rejection_reason?(s(),n("p",Ln,p(d.requirement.rejection_reason),1)):u(o).approval_note?(s(),n("p",Pn,p(u(o).approval_note),1)):b("",!0),u(o).is_rejected?(s(),n("div",Un,t[17]||(t[17]=[e("i",{class:"fas fa-times-circle mr-1"},null,-1),N(" REJECTED ")]))):u(o).approved?(s(),n("div",Bn,[t[18]||(t[18]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),N(" "+p(o==="from_in_charge"?"SUBMITTED":"APPROVED"),1)])):(s(),n("div",Vn,t[19]||(t[19]=[e("i",{class:"fas fa-clock mr-1"},null,-1),N(" PENDING ")])))])):(s(),n("div",Fn," N/A "))])):b("",!0)])),64))])])]),d.requirement.from_department_id!==d.requirement.to_department_id?(s(),n("div",Hn,[e("h4",zn,p((r=d.requirement.to_department)==null?void 0:r.name)+" Approvals ",1),e("div",Gn,[(s(),n(V,null,z(["to_in_charge","to_coordinator"],o=>e("div",{key:o,class:"approval-box p-4 flex flex-col items-center text-center"},[u(o)?(s(),n("div",Wn,[e("p",Yn,p(u(o).userType),1),u(o).approval_user?(s(),n("div",Qn,[e("div",Kn,[k(ee,{user:u(o).approval_user,size:"small"},null,8,["user"]),e("div",Jn,[e("span",Xn,p(u(o).approval_user.name),1),t[21]||(t[21]=e("hr",{class:"border-t-2 border-indigo-100 mt-0.5"},null,-1))])]),u(o).is_rejected&&d.requirement.rejection_reason?(s(),n("p",Zn,p(d.requirement.rejection_reason),1)):u(o).approval_note?(s(),n("p",eo,p(u(o).approval_note),1)):b("",!0),u(o).is_rejected?(s(),n("div",to,t[22]||(t[22]=[e("i",{class:"fas fa-times-circle mr-1"},null,-1),N(" REJECTED ")]))):u(o).approved?(s(),n("div",so,t[23]||(t[23]=[e("i",{class:"fas fa-check-circle mr-1"},null,-1),N(" APPROVED ")]))):(s(),n("div",ro,t[24]||(t[24]=[e("i",{class:"fas fa-clock mr-1"},null,-1),N(" PENDING ")])))])):(s(),n("div",no," N/A "))])):b("",!0)])),64))])])):b("",!0)])):b("",!0),d.options.withAttachments&&c.value.length?(s(),n("div",oo,[t[25]||(t[25]=e("h3",{class:"text-lg font-bold uppercase mb-6 border-b pb-2"},"Image Attachments",-1)),e("div",ao,[(s(!0),n(V,null,z(c.value,(o,g)=>(s(),n("div",{key:g,class:"break-inside-avoid border p-4 rounded bg-gray-50 shadow-sm"},[e("p",io,"Attachment #"+p(g+1),1),e("img",{src:P(ge)(o),class:"max-w-full h-auto rounded border shadow-inner mx-auto",alt:"Requirement Attachment"},null,8,lo)]))),128))])])):b("",!0)])}}},co=Ge(uo,[["__scopeId","data-v-f1f8b264"]]),mo={class:"flex justify-center items-center"},po={class:"modal-card"},bo={key:0},vo=["required"],fo={class:"flex"},xo={class:"flex justify-between gap-2 mt-4"},go=["disabled"],yo=["disabled"],_o={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0},requirementNote:{type:Boolean,default:!0}},emits:["loading","success","error"],setup(d,{emit:w}){const c=d,u=w,m=$(255),t=G(()=>m.value-f.value.length),l=We(),v=$(null),x=$(null),a=$(null),f=$(""),r=$(!1),o=G(()=>a.value!==null);function g(I){a.value=I,f.value="",S()}function h(){a.value=null,f.value=""}async function q(){var I,O;if(a.value==="reject"&&!f.value)return l.error("Rejection Reason is required!");if(typeof c.onSubmit=="function")return c.onSubmit({note:f.value,action:a.value});u("loading",!0),r.value=!0;try{await vt(c.requirementId,{note:f.value}),u("success"),h()}catch(L){return u("error",L),l.error(((O=(I=L==null?void 0:L.response)==null?void 0:I.data)==null?void 0:O.message)||"Submission failed!")}finally{u("loading",!1),r.value=!1}}function R(I){var O,L;o.value&&(I.key==="ArrowLeft"?(O=x.value)==null||O.focus():I.key==="ArrowRight"&&((L=v.value)==null||L.focus()))}function S(){xe(()=>{var I;(I=v.value)==null||I.focus()})}return me(()=>{window.addEventListener("keydown",R)}),Xe(()=>{window.removeEventListener("keydown",R)}),(I,O)=>(s(),n("div",null,[e("div",mo,[e("button",{onClick:O[0]||(O[0]=L=>g("accept"))},O[3]||(O[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),o.value?(s(),n("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:M(h,["self"])},[e("div",po,[O[4]||(O[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),d.requirementNote?(s(),n("div",bo,[te(e("textarea",{"onUpdate:modelValue":O[1]||(O[1]=L=>f.value=L),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:a.value==="reject",onInput:O[2]||(O[2]=L=>f.value.length>m.value?f.value=f.value.slice(0,m.value):null)},null,40,vo),[[Qe,f.value]]),e("div",fo,[e("div",{class:F(["ml-auto inline-block text-sm text-gray-500",f.value.length>=m.value?"text-red-500":""])}," left "+p(t.value)+"/"+p(m.value)+" words ",3)])])):b("",!0),e("div",xo,[e("button",{ref_key:"cancelBtnRef",ref:x,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:h,disabled:r.value}," Cancel ",8,go),e("button",{ref_key:"confirmBtnRef",ref:v,class:F(["focus:ring-2 ring-offset-2 disabled:opacity-30",a.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:q,disabled:r.value}," Confirm Submission ",10,yo)])])])):b("",!0)]))}},ko={class:"flex items-center gap-6 justify-center my-16"},ho={key:0,class:"border rounded-md"},wo={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(d,{emit:w}){const c=d,u=w,m=_t(),t=$(""),l=$(null),v=$(""),x=$(!1);async function a(){await m.setTaskRequirement(v.value,c.requirement.id),u("assignTask")}return(f,r)=>(s(),n("div",{class:F(["text-left p-4",[t.value&&!l.value?"min-h-[400px]":""]])},[e("div",ko,[e("button",{onClick:r[0]||(r[0]=M(o=>u("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),r[5]||(r[5]=e("span",null,"or",-1)),e("button",{class:F({"btn-3":t.value!=="direct-assign","btn-2":t.value=="direct-assign"}),onClick:r[1]||(r[1]=M(()=>t.value="direct-assign",["prevent"]))}," Assign Task ",2)]),t.value&&!l.value?(s(),n("div",ho,[e("form",{onSubmit:M(a,["prevent"]),class:"p-4 flex items-end"},[k(kt,{class:"flex-grow mr-4 h-12",taskId:v.value,"onUpdate:taskId":r[2]||(r[2]=o=>v.value=o),show:x.value,"onUpdate:show":r[3]||(r[3]=o=>x.value=o),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":d.fromDepartmentId},filterTasks:o=>!o.requirement_id,onAddNewTaskClick:r[4]||(r[4]=o=>u("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),r[6]||(r[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):b("",!0)],2))}},$o={class:"flex flex-col items-center gax-x-1 justify-end"},qo={key:0},Co={key:1},To={class:"text-sm text-gray-600 whitespace-normal w-64"},jo={class:"text-gray-900 font-semibold text-sm md:text-base"},Ao={class:"ml-2"},So={key:0,class:"text-red-700 text-sm"},Ro={key:1,class:"text-green-600 ml-2"},Io={key:2,class:"ml-2 text-yellow-700"},ze={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(d,{emit:w}){const c=d,u=w,m=Je(),t=G(()=>{var f,r,o,g,h;return{from_in_charge:!!((f=c.requirement)!=null&&f.status&&((r=c.requirement)!=null&&r.submission_date)),from_coordinator:!!((o=c.requirement)!=null&&o.from_coordinator),to_in_charge:!!((g=c.requirement)!=null&&g.to_incharge),to_coordinator:!!((h=c.requirement)!=null&&h.to_coordinator)}}),l=G(()=>{var f,r,o,g,h,q,R,S;return{from_in_charge:(r=(f=c.requirement)==null?void 0:f.from_department)==null?void 0:r.in_charge,from_coordinator:(g=(o=c.requirement)==null?void 0:o.from_department)==null?void 0:g.coordinator,to_in_charge:(q=(h=c.requirement)==null?void 0:h.to_department)==null?void 0:q.in_charge,to_coordinator:(S=(R=c.requirement)==null?void 0:R.to_department)==null?void 0:S.coordinator}}),v=G(()=>{var g;const f=Object.keys(t.value),r=f.indexOf(c.approvalType);let o=!0;for(let h=r-1;h>=0;h--){const q=f[h];o=o&&(l.value[q]?(g=t.value)==null?void 0:g[q]:!0)}return o}),x=G(()=>{var q,R,S,I,O,L,se,W,re,U,ne,le,X,A,_,C;let f=null,r=null,o="",g="";c.approvalType==="from_in_charge"&&(f=(q=c.requirement)==null?void 0:q.from_department,r=(S=(R=c.requirement)==null?void 0:R.from_department)==null?void 0:S.in_charge,o="In Charge",g=(I=c.requirement)==null?void 0:I.from_incharge_note),c.approvalType==="from_coordinator"&&(f=(O=c.requirement)==null?void 0:O.from_department,r=(L=c.requirement)==null?void 0:L.from_coordinator,o="Coordinator",g=(se=c.requirement)==null?void 0:se.from_coordinator_note),c.approvalType==="to_in_charge"&&(f=(W=c.requirement)==null?void 0:W.to_department,r=(re=c.requirement)==null?void 0:re.to_in_charge,o="In Charge",g=(U=c.requirement)==null?void 0:U.to_incharge_note),c.approvalType==="to_coordinator"&&(f=(ne=c.requirement)==null?void 0:ne.to_department,r=(le=c.requirement)==null?void 0:le.to_coordinator,o="Coordinator",g=(X=c.requirement)==null?void 0:X.to_coordinator_note);const h=(A=l.value)==null?void 0:A[c.approvalType];return{department:f,department_user:h,approved:(_=t.value)==null?void 0:_[c.approvalType],approval_user:r,is_rejected:((C=c.requirement)==null?void 0:C.rejected_by_user_id)==(h==null?void 0:h.id),userType:o,approval_note:g}});function a(){u("updateApproval")}return(f,r)=>{var o,g,h,q,R,S;return s(),n("div",$o,[x.value.department_user?(s(),n("div",qo,[k(ue,{user:x.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(s(),n("div",Co,r[0]||(r[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",To,[x.value.is_rejected?(s(),E(ce,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:D(()=>[N(p(d.requirement.rejection_reason),1)]),_:1})):(s(),E(ce,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:D(()=>[N(p(x.value.approval_note),1)]),_:1}))]),e("div",null,[!x.value.is_rejected&&!x.value.approved&&v.value&&((o=P(m).user)==null?void 0:o.id)==((h=(g=x.value)==null?void 0:g.department_user)==null?void 0:h.id)?(s(),E($t,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(q=c.requirement)==null?void 0:q.id,onSuccess:a,variant:1},null,8,["applicationId"])):b("",!0)]),r[2]||(r[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",jo,[e("span",null,p(((R=x.value.department)==null?void 0:R.short_name)||((S=x.value.department)==null?void 0:S.name)),1),e("span",Ao,p(x.value.userType),1),x.value.department_user?(s(),n(V,{key:0},[x.value.is_rejected?(s(),n("span",So," (Rejected)")):x.value.approved?(s(),n("span",Ro,"(✔)")):(s(),n("span",Io,r[1]||(r[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):b("",!0)])])}}},Do={class:"container mx-auto print:p-0 w-full print:max-w-full"},No={class:"border-b px-3 py-1 bg-gray-50 flex items-center justify-between rounded-t-md"},Oo={key:0,class:"p-3 max-h-[50vh] overflow-auto"},Eo={class:"border table-auto w-full"},Mo={class:"border-y px-4 py-2 text-right"},Lo={class:"border-y pr-4 py-2 whitespace-nowrap"},Po={class:"border-y px-4 py-2"},Uo={class:"line-clamp-2 text-sm text-amber-950"},Bo={class:"border-y px-4 py-2 text-center"},Vo={class:"print:hidden relative min-h-[50vh] mx-4"},Fo={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},Ho={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},zo={class:"text-center text-xl font-bold mb-2 flex items-center justify-between"},Go={class:"flex items-center"},Wo={class:"mb-8"},Yo={class:"text-lg font-semibold mb-2"},Qo={class:"flex gap-4 items-center text-gray-500"},Ko={class:"text-sm"},Jo={key:0,class:"flex items-center gap-1"},Xo={key:0,class:"mb-5"},Zo={class:"mb-8"},ea={class:"font-semibold text-lg px-2"},ta={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},sa={class:"w-full border-collapse"},ra={key:0},na={class:"mb-8"};const oa={key:2,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},aa={class:"flex flex-col items-end"},ia={key:3,class:"mt-6 mb-8 break-before-avoid-page"},la={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},da={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},ua={class:"bg-white shadow rounded-lg space-y-4 p-4 mb-4"},ca={class:"border col-span-3 p-3 rounded-md"},ma={class:"flex items-center gap-2 mb-4"},pa={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},ba={class:"flex items-center gap-2 mb-4"},va={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},fa={class:"font-bold print:text-gray-900"},xa={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},ga={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},ya={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},_a={class:"print:text-gray-900 text-sm text-right"},ka={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},ha={class:"print:text-gray-900 text-sm text-right"},wa={class:"flex justify-between items-center mb-4"},$a={class:"mb-4"},qa={class:"flex justify-between items-center"},Ca={key:1,class:"text-red-600"},Ta={key:0,class:"mb-2"},ja={class:"flex justify-between items-center"},Aa={key:1,class:"mb-4 text-red-700 text-sm flex justify-between"},Sa={key:2,class:"print:hidden flex flex-wrap gap-2 items-center justify-between w-full text-sm"},Ra={class:"flex gap-2"},bi={__name:"RequirementShow",setup(d){const w=nt(),c=ot(),u=$(""),m=Je(),t=et(),l=G(()=>{var Q,K;if(!a.value)return[];const y=new Map,i=(T,B)=>{T&&(!T.department&&B&&(T.department={id:B.id,name:B.name,short_name:B.short_name}),y.set(T.id,T))};return(Q=a.value.from_department)!=null&&Q.users&&a.value.from_department.users.forEach(T=>{i(T,a.value.from_department)}),(K=a.value.to_department)!=null&&K.users&&a.value.to_department.users.forEach(T=>{i(T,a.value.to_department)}),a.value.tasks&&a.value.tasks.forEach(T=>{T.users&&T.users.forEach(B=>i(B,B.department))}),a.value.details&&a.value.details.forEach(T=>{T.tasks&&T.tasks.forEach(B=>{B.users&&B.users.forEach(de=>i(de,de.department))})}),Array.from(y.values())}),v=$(),x=$(!1),a=$(null),f=oe({detail:null,open:!1}),r=oe({detail:null,open:!1}),o=oe({detail:null,open:!1}),g=$(!1),h=$(!1),q=$({withTasks:!0,taskOption:"list",withMessages:!0,withApprovals:!0,withAttachments:!0}),R=()=>g.value=!0,S=()=>g.value=!1,I=()=>{h.value=!0},O=async y=>{q.value=y,h.value=!1,y.withMessages&&await t.fetchComments({commentable_type:"requirement",commentable_id:a.value.id}),g.value=!0,await xe(),window.print()},L=$(),se=$(""),W=$({isOpen:!1,taskId:null});me(async()=>{await U(),window.addEventListener("beforeprint",R),window.addEventListener("afterprint",S),window.addEventListener("resize",re),await xe(),wt(v.value,()=>{})});function re(){}Xe(()=>{window.removeEventListener("beforeprint",R),window.removeEventListener("afterprint",S),window.removeEventListener("resize",re)});async function U(){u.value="loading";const y=(await ye(w.params.id)).data;a.value=y==null?void 0:y.requirement,se.value=y==null?void 0:y.user_department_position,u.value=""}function ne(){var y,i,Q,K,T,B,de,_e,ke;if(m.user.role!=="super_admin"&&((y=m.user)==null?void 0:y.id)!==((Q=(i=a.value)==null?void 0:i.to_department)==null?void 0:Q.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(T=(K=a.value)==null?void 0:K.to_department)==null?void 0:T.name}'s In charge can create or assign.`);console.log({requirement:a}),A.modalShown=!0,A.from_department_id=a.value.from_department_id,A.to_department_id=a.value.to_department_id,A.taskDefaultValues={title:"",description:"",from_department_id:a.value.from_department_id,to_department_id:a.value.to_department_id,is_important:((B=a.value)==null?void 0:B.priority)=="IMPORTANT",is_urgent:((de=a.value)==null?void 0:de.priority)=="URGENT",supervisor_ids:(_e=a.value)!=null&&_e.supervisor_id?[(ke=a.value)==null?void 0:ke.supervisor_id]:[]},A.requirement=a.value}function le(y){f.open=!0,f.detail=y}function X(y){o.open=!0,o.detail=y}const A=oe({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function _(){L.value=null,A.modalShown=!1,await U()}async function C(){A.modalShown=!1,A.requirement=null,A.creating=!1}const H=$({open:!1});return(y,i)=>{var K,T,B,he,we,$e,qe,Ce,Te,je,Ae,Se,Re,Ie,De,Ne,Oe,Ee,Me,Le,Pe,Ue;const Q=Ye("RouterLink");return s(),n("div",Do,[r.open?(s(),E(J,{key:0},{default:D(()=>{var j;return[k(ur,{requirementId:a.value.id,detailId:(j=r.requirement.value)==null?void 0:j.id,onCloseClick:i[0]||(i[0]=Z=>r.open=!1),onUpdate:i[1]||(i[1]=async()=>{r.open=!1,await U()})},null,8,["requirementId","detailId"])]}),_:1})):b("",!0),o.open?(s(),E(J,{key:1},{default:D(()=>{var j;return[k(tr,{requirementId:a.value.id,detailId:(j=o.requirement.value)==null?void 0:j.id,onCloseClick:i[2]||(i[2]=Z=>o.open=!1),onDelete:i[3]||(i[3]=async()=>{o.open=!1,await U()})},null,8,["requirementId","detailId"])]}),_:1})):b("",!0),A.modalShown?(s(),E(J,{key:2,class:"*:relative"},{default:D(()=>{var j,Z;return[e("button",{onClick:M(C,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},i[21]||(i[21]=[e("i",{class:"fas fa-times-circle"},null,-1)])),A!=null&&A.creating?b("",!0):(s(),E(wo,{key:0,"from-department-id":(j=a.value)==null?void 0:j.from_department_id,requirement:A==null?void 0:A.requirement,onCancelClick:C,onAddNewTaskClick:i[4]||(i[4]=()=>{A.modalShown=!0,A.creating=!0}),onAssignTask:_},null,8,["from-department-id","requirement"])),A!=null&&A.creating?(s(),E(at,{key:1,requirementDetailId:(Z=A==null?void 0:A.requirement.value)==null?void 0:Z.id,requirementId:a.value.id,onClose:C,onTaskCreated:_,defaultValues:A.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):b("",!0)]}),_:1})):b("",!0),L.value?(s(),E(J,{key:3},{default:D(()=>[k(ht,{taskId:L.value,onClose:i[5]||(i[5]=j=>L.value=null),onUpdated:_},null,8,["taskId"])]),_:1})):b("",!0),W.value.isOpen?(s(),E(J,{key:4,class:"*:max-w-4xl"},{default:D(()=>[k(yt,{taskId:W.value.taskId,onCancelClick:i[6]||(i[6]=()=>{W.value.isOpen=!1,W.value.taskId=0}),onSuccess:i[7]||(i[7]=()=>{W.value.isOpen=!1,W.value.taskId=0,u.value="loading",U()})},null,8,["taskId"])]),_:1})):b("",!0),H.value.open?(s(),E(J,{key:5},{default:D(()=>[k(Bs,{requirement:a.value,onClickCancel:i[8]||(i[8]=j=>H.value.open=!1),onUpdateStatus:i[9]||(i[9]=()=>{U(),H.value.open=!1})},null,8,["requirement"])]),_:1})):b("",!0),h.value?(s(),E(J,{key:6},{default:D(()=>[k(wr,{initialOptions:q.value,onClose:i[10]||(i[10]=j=>h.value=!1),onPrint:O},null,8,["initialOptions"])]),_:1})):b("",!0),x.value?(s(),E(J,{key:7},{default:D(()=>{var j,Z,ie,Be;return[e("div",No,[i[23]||(i[23]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon size-8",onClick:i[11]||(i[11]=M(Y=>x.value=!1,["prevent"]))},i[22]||(i[22]=[e("i",{class:"fas fa-times"},null,-1)]))]),(j=a.value)!=null&&j.closing_history&&((ie=(Z=a.value)==null?void 0:Z.closing_history)!=null&&ie.length)?(s(),n("div",Oo,[e("table",Eo,[i[24]||(i[24]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-right"},"Close/Open"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status")])],-1)),e("tbody",null,[(s(!0),n(V,null,z(((Be=a.value)==null?void 0:Be.closing_history)||[],Y=>(s(),n("tr",{key:Y.at,class:"text-sm"},[e("td",Mo,p(Y==null?void 0:Y.type),1),e("td",Lo,p(Y.at?P(ae)(Y.at):""),1),e("td",Po,[e("div",Uo,p(Y==null?void 0:Y.closing_note),1)]),e("td",Bo,p(Y==null?void 0:Y.status),1)]))),128))])])])):b("",!0)]}),_:1})):b("",!0),e("div",Vo,[a.value?(s(),n("div",Fo,[e("div",Ho,[e("div",zo,[e("div",Go,[e("button",{class:"btn-3 h-8 px-4",onClick:i[12]||(i[12]=M(()=>P(c).back(),["prevent"]))},"Back"),i[25]||(i[25]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),e("button",{class:"btn-indigo-light text-xs font-bold btn-3 h-8 px-4",onClick:M(I,["prevent"])},i[26]||(i[26]=[e("i",{class:"fas fa-print mr-1"},null,-1),N(" PRINT ")]))]),i[41]||(i[41]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",Wo,[e("div",null,[e("div",Yo,[k(ce,{"line-clamp":"3",class:"mb-2"},{default:D(()=>[N(p(a.value.title),1)]),btnText:D(({lineClampClass:j})=>[N(p(j?"More":"Less"),1)]),_:1}),e("div",Qo,[e("div",Ko,[i[27]||(i[27]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),N(" "+p(P(ae)(a.value.created_at)),1)]),a.value.created_by?(s(),n("div",Jo,[i[28]||(i[28]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),k(ue,{"show-details-on-avatar-hover":P(m).isAdminMood,"avatar-size":"xsmall",user:a.value.created_by,class:"border-sky-300"},null,8,["show-details-on-avatar-hover","user"])])):b("",!0)])]),a.value.description?(s(),n("div",Xo,[i[29]||(i[29]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),k(ce,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:D(()=>[k(be,{message:a.value.description},null,8,["message"])]),_:1})])):b("",!0)])]),e("div",Zo,[k(fe,{class:"mb-4"},{default:D(()=>[e("h2",ea,[i[30]||(i[30]=e("span",null,"Task List ",-1)),a.value.status=="approved"?(s(),n("span",{key:0,class:F(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":a.value.tasks_count>0&&a.value.completed_tasks_count==a.value.tasks_count,"text-red-700 font-semibold":a.value.tasks_count==0||a.value.completed_tasks_count!=a.value.tasks_count}]])}," ("+p(a.value.completed_tasks_count)+"/"+p(a.value.tasks_count)+" task(s) done) ",3)):b("",!0)])]),_:1}),e("div",ta,[e("table",sa,[i[32]||(i[32]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[u.value!="loading"&&((T=(K=a.value)==null?void 0:K.tasks)==null?void 0:T.length)===0?(s(),n("tr",ra,i[31]||(i[31]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(s(!0),n(V,{key:1},z(((B=a.value)==null?void 0:B.tasks)||[],(j,Z)=>(s(),E(ut,{key:j.id,task:j,indexing:Z+1,class:"*:py-3 *:border-b-0",onEditClick:i[13]||(i[13]=ie=>L.value=ie),onEmployeeAssignClick:i[14]||(i[14]=ie=>{W.value.isOpen=!0,W.value.taskId=ie})},null,8,["task","indexing"]))),128))])])])]),e("div",na,[k(fe,{class:"mb-4"},{default:D(()=>i[33]||(i[33]=[e("h2",{class:"font-semibold text-lg px-2"},"Comments",-1)])),_:1,__:[33]}),k(ns,{"commentable-type":"requirement","commentable-id":a.value.id,"current-user":P(m).user,"mentionable-users":l.value},null,8,["commentable-id","current-user","mentionable-users"])]),b("",!0),(a.value,b("",!0)),u.value!="loading"&&!((he=a.value)!=null&&he.submission_date)?(s(),n("div",oa,[e("div",aa,[k(_o,{"requirement-id":(we=a.value)==null?void 0:we.id,onSuccess:U,"requirement-note":se.value=="in_charge"},{heading:D(()=>i[37]||(i[37]=[N(" Requirement Submission ")])),acceptButtonLabel:D(()=>i[38]||(i[38]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),N("Submit Requirement ")],-1)])),submitButtonLabel:D(()=>i[39]||(i[39]=[N(" Submit Requirement ")])),_:1},8,["requirement-id","requirement-note"])])])):b("",!0),($e=a.value)!=null&&$e.submission_date?(s(),n("div",ia,[k(fe,null,{default:D(()=>i[40]||(i[40]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[40]}),e("div",la,[(s(),n(V,null,z(["from_in_charge","from_coordinator"],j=>k(ze,{class:"pt-12",key:j,requirement:a.value,"approval-type":j,onUpdateApproval:i[16]||(i[16]=()=>U())},null,8,["requirement","approval-type"])),64))]),((qe=a.value)==null?void 0:qe.from_department_id)!==((Ce=a.value)==null?void 0:Ce.to_department_id)?(s(),n("div",da,[(s(),n(V,null,z(["to_in_charge","to_coordinator"],j=>k(ze,{class:"pt-12",key:j,requirement:a.value,"approval-type":j,onUpdateApproval:i[17]||(i[17]=()=>U())},null,8,["requirement","approval-type"])),64))])):b("",!0)])):b("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:v},[e("div",ua,[e("div",ca,[e("div",null,[e("div",ma,[i[42]||(i[42]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),k(He,{department:(Te=a.value)==null?void 0:Te.from_department,"short-name":!0},null,8,["department"])]),i[43]||(i[43]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",pa,[(je=a.value)!=null&&je.supervisor?(s(),E(ue,{key:0,"show-details-on-avatar-hover":P(m).isAdminMood,user:(Ae=a.value)==null?void 0:Ae.supervisor},null,8,["show-details-on-avatar-hover","user"])):b("",!0)])]),i[45]||(i[45]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",ba,[i[44]||(i[44]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),k(He,{department:(Se=a.value)==null?void 0:Se.to_department,"short-name":!0},null,8,["department"])])])]),e("div",va,[i[46]||(i[46]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",fa,p((Re=a.value)==null?void 0:Re.id),1)]),((De=(Ie=a.value)==null?void 0:Ie.website_tags)==null?void 0:De.length)>0?(s(),n("div",xa,[i[47]||(i[47]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",ga,[(s(!0),n(V,null,z(((Ne=a.value)==null?void 0:Ne.website_tags)||[],j=>(s(),n("div",{key:j.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},p(j.name),1))),128))])])):b("",!0),(Oe=a.value)!=null&&Oe.submission_date?(s(),n("div",ya,[i[48]||(i[48]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",_a,p(P(ae)((Ee=a.value)==null?void 0:Ee.submission_date)),1)])):b("",!0),(Me=a.value)!=null&&Me.better_to_complete_on?(s(),n("div",ka,[i[49]||(i[49]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",ha,p(P(st)((Le=a.value)==null?void 0:Le.better_to_complete_on,{weekDay:"long"})),1)])):b("",!0),e("div",null,[e("div",wa,[i[50]||(i[50]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:F(["font-semibold text-sm",{"text-yellow-600 ":a.value.priority=="IMPORTANT","text-red-700 ":a.value.priority=="URGENT"}])},p(a.value.priority||"NORMAL"),3)])]),e("div",$a,[e("div",qa,[i[51]||(i[51]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),a.value.status?(s(),n("span",{key:0,class:F(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":a.value.status!="approved","bg-green-300 text-green-700 border-green-400":a.value.status=="approved"}])},p(String(a.value.status).toUpperCase()),3)):(s(),n("span",Ca,"..."))])]),a.value.rejected_by?(s(),n("div",Ta,[e("div",ja,[i[52]||(i[52]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),k(ue,{user:a.value.rejected_by},null,8,["user"])])])):b("",!0),a.value.rejection_reason?(s(),n("div",Aa,[i[53]||(i[53]=e("p",{class:"text-gray-600 mb-1"},"Reason:",-1)),e("p",null,p(a.value.rejection_reason),1)])):b("",!0),i[56]||(i[56]=e("hr",{class:"mb-3"},null,-1)),(Pe=a.value)!=null&&Pe.closed_at?b("",!0):(s(),n("div",Sa,[e("div",Ra,[a.value.status=="approved"?(s(),n("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:M(ne,["prevent"])},i[54]||(i[54]=[e("i",{class:"fas fa-plus text-sm"},null,-1),N(" Add/Assign Task ")]))):b("",!0)]),k(Q,{class:"btn-2 h-8",to:`/requirements/edit/${(Ue=a.value)==null?void 0:Ue.id}`},{default:D(()=>i[55]||(i[55]=[N(" Edit ")])),_:1,__:[55]},8,["to"])]))])]),k(As,{requirement:a.value,onReOpenClick:i[18]||(i[18]=j=>H.value.open=!0),class:"mb-4 card-bg bg-white",onCloseClick:i[19]||(i[19]=j=>H.value.open=!0),onShowHistoryClick:i[20]||(i[20]=j=>x.value=!x.value)},null,8,["requirement"]),k(xs,{requirement:a.value,class:"mb-4"},null,8,["requirement"]),k(it,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3",ref:"shareComponent"},null,512)],512)])):b("",!0),u.value==="loading"?(s(),E(ve,{key:1,class:"absolute inset-0 bg-opacity-90"})):b("",!0)]),a.value&&g.value?(s(),E(co,{key:8,class:"hidden print:block",requirement:a.value,options:q.value,comments:P(t).comments},null,8,["requirement","options","comments"])):b("",!0)])}}};export{bi as default};
