import{E,r as v,x as c,G as n}from"./index-BX8z_Bvl.js";const G=E("todo",()=>{const i=v(null),r=v(!1),s=v(null),u=v([]),T=async()=>{var t,a,o;r.value=!0,s.value=null;try{const e=await n.get("/todos");u.value=((t=e.data)==null?void 0:t.todos)||[]}catch(e){throw s.value=((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.message)||"Todos load failed",e}finally{r.value=!1}};function w(){u.value=u.value.sort((t,a)=>t.priority!==a.priority?t.priority-a.priority:a.id-t.id)}const m=async()=>{var t,a,o;r.value=!0,s.value=null;try{const e=await n.get("/my-todos");u.value=((t=e.data)==null?void 0:t.todos)||[]}catch(e){throw s.value=((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.message)||"Todos load failed",e}finally{r.value=!1}},g=t=>{var a;return(a=u.value)==null?void 0:a.filter(o=>o.date==t)},$=async t=>{var a,o;r.value=!0,s.value=null;try{const e=await n.get(`/todos/${t}`);i.value=e.data,i.value=u.value.find(l=>l.id==t)}catch(e){throw s.value=((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.message)||"Todo load failed",e}finally{r.value=!1}},S=async(t,{returnWith:a}={})=>{var o,e,l;r.value=!0,s.value=null;try{const d=await n.post("/todos",t,{params:{return_with:a}});return u.value=[...u.value,(o=d.data)==null?void 0:o.todo],w(),d.data}catch(d){throw s.value=((l=(e=d.response)==null?void 0:e.data)==null?void 0:l.message)||"Todo create failed",d}finally{r.value=!1}},x=async(t,a)=>{var o,e;r.value=!0,s.value=null;try{const l=await n.put(`/todos/${t}`,a);return u.value=u.value.map(d=>{var f,p,y,h;return d.id==((p=(f=l.data)==null?void 0:f.todo)==null?void 0:p.id)?d.user?{...(y=l.data)==null?void 0:y.todo,user:{...d.user}}:{...(h=l.data)==null?void 0:h.todo}:{...d}}),l.data}catch(l){throw s.value=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Todo update failed",l}finally{r.value=!1}},C=async(t,a)=>{var o,e;r.value=!0,s.value=null;try{await n.put(`/todos/status/${t}`,{status:a}),u.value=u.value.map(l=>l.id===t?{...l,status:a}:{...l})}catch(l){throw s.value=((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to update todo status",l}finally{r.value=!1}},D=async t=>{var a,o;r.value=!0,s.value=null;try{await n.delete(`/todos/${t}`),u.value=u.value.filter(e=>e.id!==t)}catch(e){throw s.value=((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.message)||"Todo delete failed",e}finally{r.value=!1}};return{todos:c(()=>u.value),todo:c(()=>i.value),loading:c(()=>r.value),error:c(()=>s.value),fetchTodos:T,fetchTodo:$,createTodo:S,updateTodo:x,deleteTodo:D,fetchMyTodos:m,updateTodoStatus:C,getTodosByDate:g}});export{G as u};
