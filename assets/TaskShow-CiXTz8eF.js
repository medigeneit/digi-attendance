import{r as w,c as u,o as r,a as e,f as v,E as F,h as n,w as I,t as _,l as y,p as x,D as V,m as $,b as G,u as H,y as q,e as z,A as K,k as O,F as M,x as J,n as T,q as h}from"./index-B5miUE8g.js";import{u as Q,_ as W,O as j}from"./task-priority-ZJ8RviYi.js";import{_ as X}from"./TaskAddForm-CsWcz5VU.js";import{_ as Y}from"./TaskEditForm-Cd0Jx2YM.js";import{_ as Z}from"./TaskTreeView-DIO4swXO.js";import{u as tt}from"./useTaskStore-CrK0F7fr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-CWMezjcB.js";import"./SectionLoading-B67Asscu.js";const st={class:"mb-3"},et={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},at={key:1,class:"text-center py-4 text-gray-500"},nt={key:2,class:"text-center py-4 text-red-500"},ot={key:3,class:"space-y-4"},rt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0}},emits:["commentButtonClick","editClick","addClick"],setup(m,{emit:s}){const d=m,g=s,p=w(null),{handleItemsPriorityUpdate:i,saveTaskPriority:l,listHasRearranged:f}=Q(()=>d.tasks,d.parentId);return(c,o)=>(r(),u("div",null,[e("div",st,[F(c.$slots,"task:header")]),n(f)?(r(),u("div",et,[o[4]||(o[4]=e("span",{class:"text-red-500"},"Priority Changed",-1)),e("button",{class:"btn-3",onClick:o[0]||(o[0]=I((...t)=>n(l)&&n(l)(...t),["prevent"]))},"Save"),e("button",{class:"btn-3",onClick:o[1]||(o[1]=I((...t)=>p.value.resetItems&&p.value.resetItems(...t),["prevent"]))},"Discard")])):v("",!0),m.loading?(r(),u("div",at,"Loading tasks...")):m.error?(r(),u("div",nt,_(m.error),1)):(r(),u("div",ot,[y(W,{items:m.tasks,handle:"handle",onItemsUpdate:n(i),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:p},{item:x(({item:t})=>[y(Z,{task:t,class:"!border-0",onCommentButtonClick:a=>g("commentButtonClick",t.id),onEditClick:o[2]||(o[2]=a=>g("editClick",a)),onAddClick:o[3]||(o[3]=a=>g("addClick",a)),showDraggableHandle:!0},null,8,["task","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},it={class:"flex justify-between mt-5"},lt={class:"flex flex-wrap items-center gap-2 mt-3"},dt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0}},emits:["created","error"],setup(m,{emit:s}){const d=m,g=s,p=w(),i=V({show:!1,parentId:d.parentId,requirementId:null}),l=t=>{i.show=!0,i.parentId=t,console.log({addForm:i})};function f(){i.show=!1,i.parentId=d.parentId,g("created")}function c(){p.value=!1,g("updated")}function o(){i.show=!1,i.parentId=d.parentId}return(t,a)=>(r(),u("div",null,[p.value?(r(),$(j,{key:0},{default:x(()=>[y(Y,{taskId:p.value,onClose:a[0]||(a[0]=b=>p.value=null),onUpdated:c},null,8,["taskId"])]),_:1})):v("",!0),i.show?(r(),$(j,{key:1},{default:x(()=>[y(X,{parentTaskId:i.parentId,requirementId:i.requirementId,onTaskCreated:f,onError:t.handleTaskError,onClose:o},null,8,["parentTaskId","requirementId","onError"])]),_:1})):v("",!0),y(rt,{tasks:m.subTasks,parentId:m.parentId,onAddClick:a[2]||(a[2]=b=>l(b)),onEditClick:a[3]||(a[3]=b=>p.value=b)},{"task:header":x(()=>[e("div",it,[a[4]||(a[4]=e("div",{class:"flex justify-between items-center"},[e("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),e("div",lt,[e("button",{class:"btn-1 ml-auto",onClick:a[1]||(a[1]=I(()=>l(m.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId"])]))}},ut=()=>{const m=w(),s=w(0);function d(l,f){m.value=l,s.value=f}function g(){const l=[],f=(c,o=0,t="")=>{c.forEach(a=>{l.push({...a,depth:o,idPath:t+a.id}),a.children_tasks&&a.children_tasks.length&&f(a.children_tasks,o+1,t+a.id+"-")})};return f(i()),l}function p(l,f=0){return Array.isArray(l)===!1||l.length===0?[]:l.filter(c=>c.parent_id===f).map(c=>({...c,children_tasks:p(l,c.id)}))}function i(){return p(m.value,s.value)}return{getTaskListTree:i,getFlattenedTasks:g,setTaskList:d}},pt={class:"container mx-auto p-6"},kt={class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6"},mt={class:"grid grid-cols-4"},ct={class:"py-2 font-medium col-span-full text-xl"},ft={class:"py-2 font-medium mb-4 col-span-full md:col-span-2"},gt={class:"flex gap-2 flex-wrap"},yt={class:"py-2 col-span-full md:col-span-1"},xt={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},bt={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},vt={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},Tt={class:"py-4 text-right col-span-full md:col-span-1"},_t={class:"py-2 flex justify-center items-center gap-2 col-span-full"},Ct={class:"ml-auto flex gap-4"},wt={key:0},It={key:1},ht={key:1,class:"text-center py-4 text-gray-500"},$t={key:2,class:"text-center py-4 text-red-500"},Dt={__name:"TaskShow",setup(m){const s=tt(),d=G(),g=H(),p=ut(),i=q(()=>p.getTaskListTree());z(async()=>{});const l=o=>{g.push({name:"TaskEdit",params:{id:o}})},f=q(()=>{var o,t;return s.task.parent_id==0?{name:"TaskList",params:{id:(o=s.task)==null?void 0:o.id}}:{name:"TaskShow",params:{id:(t=s.task)==null?void 0:t.parent_id}}});async function c(o){const t=await s.fetchTask(o);p.setTaskList(t.sub_tasks,s.task.id)}return K(()=>d.params.id,c,{initial:!0,immediate:!0}),(o,t)=>{var L,E,S,A,P,R,B,N,U,D;const a=O("RouterLink"),b=O("router-view");return r(),u("div",pt,[e("div",kt,[n(s).task?(r(),u(M,{key:0},[e("section",mt,[e("div",ct,_(n(s).task.title),1),e("div",ft,[t[9]||(t[9]=e("div",{class:"text-xs mb-0.5 text-gray-600 uppercase"},"Assigns",-1)),e("div",gt,[(r(!0),u(M,null,J(n(s).task.users,k=>(r(),u("span",{onClick:t[0]||(t[0]=C=>C.stopPropagation()),key:k.id,class:"btn-1 !inline-flex flex-shrink-0"},[t[8]||(t[8]=e("i",{class:"fad fa-user"},null,-1)),T(" "+_(k==null?void 0:k.name),1)]))),128))])]),e("div",yt,[e("div",xt,[(L=n(s).task)!=null&&L.is_important?(r(),u("span",bt,"IMPORTANT")):v("",!0),(E=n(s).task)!=null&&E.is_urgent?(r(),u("span",vt,"URGENT")):v("",!0)])]),e("div",Tt,[e("span",{class:h([{"bg-gray-200":((S=n(s).task)==null?void 0:S.status)==="PENDING","bg-blue-200":((A=n(s).task)==null?void 0:A.status)==="IN_PROGRESS","bg-green-200":((P=n(s).task)==null?void 0:P.status)==="COMPLETED","bg-red-200":((R=n(s).task)==null?void 0:R.status)==="BLOCKED"},"px-3 py-0.5 rounded-full"])},_((B=n(s).task)==null?void 0:B.status),3)]),t[14]||(t[14]=e("hr",{class:"my-3 col-span-full"},null,-1)),e("div",_t,[e("button",{onClick:t[1]||(t[1]=I(k=>{var C;return l((C=n(s).task)==null?void 0:C.id)},["stop"])),class:"btn-2"},"Edit"),y(a,{to:{name:"TaskUserAssign",params:{id:(N=n(s).task)==null?void 0:N.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[2]||(t[2]=k=>k.stopPropagation())},{default:x(()=>t[10]||(t[10]=[e("i",{class:"fas fa-user-plus"},null,-1),T(" Assign Users ")])),_:1},8,["to"]),y(a,{to:f.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[3]||(t[3]=k=>k.stopPropagation())},{default:x(()=>t[11]||(t[11]=[e("i",{class:"fas fa-arrow-left"},null,-1),T(" Back ")])),_:1},8,["to"]),e("div",Ct,[i.value.length>0?(r(),$(a,{key:0,to:{name:"TaskShow",params:{id:(U=n(s).task)==null?void 0:U.id}},onClick:t[4]||(t[4]=k=>k.stopPropagation()),class:h(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":n(d).name=="TaskShow"}])},{default:x(()=>t[12]||(t[12]=[e("i",{class:"fal fa-list-ul"},null,-1),T(" Sub Tasks ")])),_:1},8,["to","class"])):v("",!0),y(a,{to:{name:"TaskReports",params:{id:(D=n(s).task)==null?void 0:D.id}},onClick:t[5]||(t[5]=k=>k.stopPropagation()),class:h(["py-1 btn-3",{"bg-blue-500 text-white":n(d).name=="TaskReports"}])},{default:x(()=>t[13]||(t[13]=[e("i",{class:"fal fa-file-alt"},null,-1),T(" Reports ")])),_:1},8,["to","class"])])])]),n(d).name=="TaskShow"?(r(),u("section",wt,[y(dt,{subTasks:i.value,"parent-id":n(d).params.id,onCreated:t[6]||(t[6]=k=>c(n(d).params.id)),onUpdated:t[7]||(t[7]=k=>c(n(d).params.id))},null,8,["subTasks","parent-id"])])):(r(),u("section",It,[y(b)]))],64)):n(s).loading?(r(),u("div",ht," Loading task details... ")):(r(),u("div",$t,_(n(s).error),1))])])}}};export{Dt as default};
