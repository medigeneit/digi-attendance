import{L as W}from"./LoaderView-nCIrbw7G.js";import{_ as F}from"./DepartmentChip-cy4QRi79.js";import{d as H,n as X,c as o,o as s,a as e,F as K,y as Y,t as y,p as _,i as R,g as S,f as A,x as I,k as f,j as M,b as J,m as V,r as Z,e as Q,A as z,h as G,v as q,u as tt}from"./index-DDK5bJel.js";import{_ as N}from"./UserChip-DDE4Lsre.js";import{g as et}from"./task-X3CVYkAn.js";import{u as st}from"./company-CVhYDMIL.js";import{_ as O}from"./CompanyDepartmentSelectInput-DL3J91nB.js";import{_ as at}from"./EmployeeDropdownInput-DcuDQYp9.js";import{S as ot}from"./SelectDropdown-CVtco3E_.js";import{u as lt}from"./useRequirementStore-Blu9BHwr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./url-CePbr-gY.js";import"./requirement-DlQXmoiC.js";const nt={class:"min-w-full bg-white border overflow-hidden table table-fixed"},it={key:0},dt={class:"px-4 py-4 font-semibold text-xl text-gray-700 border border-gray-200 text-center"},rt={class:"px-4 py-4 min-w-[300px] md:min-w-[400px] border border-gray-200"},mt={class:"space-y-4"},ut={key:0,class:"text-blue-800"},pt=["title"],ct={key:1,class:"text-gray-400 text-sm italic"},xt={key:0},yt={key:1,class:""},_t={class:"flex gap-6 items-center mt-6"},ft={key:0,class:"text-gray-600 text-xs flex items-center gap-2 whitespace-nowrap"},bt={class:"flex items-center gap-2 whitespace-nowrap"},gt={class:"px-4 py-4 whitespace-nowrap border border-gray-200"},vt=["title"],ht={class:"flex items-center gap-2 mt-4"},wt={key:1},kt={class:"flex items-center gap-2 mt-1"},Vt={key:1},At={key:0,class:"text-xs text-red-300"},Rt={key:1,class:"italic text-xs text-gray-400"},$t={class:"px-4 py-4 whitespace-nowrap border border-gray-200"},Dt=["title"],Tt={class:"flex items-center gap-2 mt-4"},Lt={key:1},Ct={key:0,class:"text-xs text-red-300"},Nt={key:1,class:"italic text-xs text-gray-400"},St={class:"flex items-center gap-2 mt-2"},Mt={key:1},zt={key:0,class:"text-xs text-red-300"},Et={key:1,class:"italic text-xs text-gray-400"},Pt={class:"px-4 py-4 text-center whitespace-nowrap border border-gray-200"},Bt={key:0,class:"text-gray-600"},Ut={key:1},jt={class:"px-4 py-4 text-center border border-gray-200"},Ft={class:"flex gap-4 items-center justify-center"},It={__name:"RequirementTable",props:{requirements:{type:Array,default:()=>[]}},setup(T){const u=H();return(b,a)=>{var x;const c=X("RouterLink");return s(),o("table",nt,[a[12]||(a[12]=e("thead",{class:"bg-gray-100 text-gray-400 text-xs"},[e("tr",null,[e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap border w-[4%]"},"#"),e("th",{class:"px-4 py-0.5 text-left whitespace-nowrap border w-[60%]"},"Requirement"),e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"From Department"),e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"To Department"),e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"Submitted At"),e("th",{class:"px-4 py-0.5 text-center whitespace-nowrap w-[12%] border"},"Actions")])],-1)),e("tbody",null,[((x=T.requirements)==null?void 0:x.length)===0?(s(),o("tr",it,a[2]||(a[2]=[e("td",{colspan:"10",class:"p-4"},[e("div",{class:"text-gray-500 italic w-full h-64 flex items-center justify-center"}," No Requirement Found ")],-1)]))):(s(!0),o(K,{key:1},Y(T.requirements,(t,d)=>{var n,r,g,m,L,v,$,C,p,l,h,w,k,i,E,P,B,U;return s(),o("tr",{key:t.id,class:"border-t hover:bg-blue-50 odd:bg-gray-50 group/item"},[e("td",dt,y(d+1),1),e("td",rt,[e("div",mt,[((n=t==null?void 0:t.details)==null?void 0:n.length)>0&&Array.isArray(t==null?void 0:t.details)?(s(),o("div",ut,[e("div",{class:"line-clamp-1 font-semibold",title:t==null?void 0:t.details[0].title},y(t==null?void 0:t.details[0].title),9,pt)])):(s(),o("div",ct,"No Requirement added")),_(c,{to:{name:"RequirementShow",params:{id:t==null?void 0:t.id}},class:"text-blue-600 text-sm hover:underline hover:text-blue-800"},{default:R(()=>{var D,j;return[((D=t==null?void 0:t.details)==null?void 0:D.length)-1>0?(s(),o("span",xt,y(((j=t==null?void 0:t.details)==null?void 0:j.length)-1)+" More Requirement ",1)):(s(),o("span",yt,"Show Form"))]}),_:2},1032,["to"])]),e("div",_t,[t.created_at?(s(),o("div",ft,[a[3]||(a[3]=e("i",{class:"fas fa-clock text-sky-800/50"},null,-1)),e("div",null,y(new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)])):S("",!0),e("div",bt,[a[4]||(a[4]=e("span",{class:"text-xs text-gray-500"},"By:",-1)),t.created_by?(s(),A(N,{key:0,user:t.created_by,"avatar-size":"xsmall"},null,8,["user"])):S("",!0)])])]),e("td",gt,[e("span",{title:(r=t==null?void 0:t.from_department)==null?void 0:r.name,class:I([{"bg-green-500 text-white group-hover/item:text-white":((g=t==null?void 0:t.from_department)==null?void 0:g.id)==((L=(m=f(u))==null?void 0:m.user)==null?void 0:L.department_id)},"text-blue-500 font-semibold flex-shrink-0 border border-blue-500 bg-blue-50 rounded-full px-2 text-xs"])},y(((v=t==null?void 0:t.from_department)==null?void 0:v.short_name)||(($=t==null?void 0:t.from_department)==null?void 0:$.name)),11,vt),e("div",ht,[a[6]||(a[6]=e("div",{class:"text-xs text-gray-500"},"In Charge:",-1)),(C=t==null?void 0:t.from_department)!=null&&C.in_charge?(s(),A(N,{key:0,user:(p=t==null?void 0:t.from_department)==null?void 0:p.in_charge,"avatar-size":"xsmall"},null,8,["user"])):(s(),o("div",wt,a[5]||(a[5]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)])))]),e("div",kt,[a[7]||(a[7]=e("div",{class:"text-xs text-gray-500"},"Coordinator:",-1)),t.from_coordinator?(s(),A(N,{key:0,user:t.from_coordinator,"avatar-size":"xsmall"},null,8,["user"])):(s(),o("div",Vt,[(l=t==null?void 0:t.from_department)!=null&&l.coordinator_id?(s(),o("div",At," Approval Pending ")):(s(),o("div",Rt,"N/A"))]))])]),e("td",$t,[e("span",{title:(h=t==null?void 0:t.to_department)==null?void 0:h.name,class:I([{"bg-sky-500 !text-white  ":((w=t==null?void 0:t.to_department)==null?void 0:w.id)==((i=(k=f(u))==null?void 0:k.user)==null?void 0:i.department_id)},"text-sky-500 font-semibold flex-shrink-0 border border-sky-500 bg-blue-50 rounded-full px-2 text-xs"])},y(((E=t==null?void 0:t.to_department)==null?void 0:E.short_name)||((P=t==null?void 0:t.to_department)==null?void 0:P.name)),11,Dt),e("div",Tt,[a[8]||(a[8]=e("div",{class:"text-xs text-gray-500"},"In Charge:",-1)),t.to_incharge?(s(),A(N,{key:0,user:t.to_incharge,"avatar-size":"xsmall"},null,8,["user"])):(s(),o("div",Lt,[(B=t==null?void 0:t.to_department)!=null&&B.incharge_id?(s(),o("div",Ct," Approval Pending ")):(s(),o("div",Nt,"N/A"))]))]),e("div",St,[a[9]||(a[9]=e("div",{class:"text-xs text-gray-500"},"Coordinator:",-1)),t.to_coordinator?(s(),A(N,{key:0,user:t.to_coordinator,"avatar-size":"xsmall"},null,8,["user"])):(s(),o("div",Mt,[(U=t==null?void 0:t.to_department)!=null&&U.coordinator_id?(s(),o("div",zt," Approval Pending ")):(s(),o("div",Et,"N/A"))]))])]),e("td",Pt,[t.submission_date?(s(),o("div",Bt,[e("div",null,y(new Date(t.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1),e("div",null,y(new Date(t.submission_date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})),1)])):(s(),o("div",Ut,"-"))]),e("td",jt,[e("div",Ft,[_(c,{to:{name:"RequirementShow",params:{id:t==null?void 0:t.id}},class:"btn-2",onClick:a[0]||(a[0]=D=>D.stopPropagation())},{default:R(()=>a[10]||(a[10]=[e("i",{class:"fad fa-eye"},null,-1),M(" Show ")])),_:2,__:[10]},1032,["to"]),_(c,{to:{name:"RequirementEdit",params:{id:t==null?void 0:t.id}},class:"btn-4 border border-blue-500 hover:bg-blue-500 hover:text-white",onClick:a[1]||(a[1]=D=>D.stopPropagation())},{default:R(()=>a[11]||(a[11]=[e("i",{class:"fad fa-edit"},null,-1),M(" Edit ")])),_:2,__:[11]},1032,["to"])])])])}),128))])])}}},Ot={class:"mb-3 task-header"},Ht={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Kt={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Yt={class:"relative"},Jt=["title"],Qt={key:0},Wt={key:1,class:"text-gray-500 whitespace-nowrap"},Xt={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Zt={class:"text-gray-600 w-full md:w-32 relative"},Gt={__name:"RequirementHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(T,{emit:u}){const b=T,a=H(),c=J(),x=V(v("company-id")),t=V(v("from-department-id")),d=V(v("to-department-id")),n=V(v("created-by")),r=V(v("month")),g=u,m=st(),L=Z([]);function v(p){return{get:()=>b.modelValue[p]||"",set:l=>{g("update:modelValue",{...b.modelValue,[p]:l||void 0})}}}async function $(){var p,l,h;if(!b.isMyTask){const w=(p=b.modelValue)==null?void 0:p["company-id"],k=d.value,i={...w?{company_id:w}:{},...k?{department_ids:[k]}:{}};L.value=((h=(l=await et({params:i}))==null?void 0:l.data)==null?void 0:h.employees)||[]}}Q(async()=>{await m.fetchCompanies({with:"departments",ignore_permission:!0}),await m.fetchMyCompanies({with:"departments"}),await $()}),z(()=>d.value,$),z(()=>x.value,()=>{t.value="",d.value="",n.value="",$()});const C=V(()=>x.value?m==null?void 0:m.companies.filter(p=>p.id==x.value):m==null?void 0:m.companies);return(p,l)=>{var h,w,k;return s(),o("div",null,[e("div",Ot,[e("div",Ht,[e("div",Kt,[e("div",Yt,[_(ot,{modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=i=>x.value=i),options:((h=f(m))==null?void 0:h.companies)||[],label:"name",id:"id",class:"border-2 border-gray-300 rounded h-[40px] w-full md:w-48 bg-white text-sm",clearable:""},{"selected-option":R(({option:i})=>[e("div",{class:"line-clamp-1 text-sm text-gray-900",title:i==null?void 0:i.name},[i!=null&&i.name?(s(),o("span",Qt,y(i==null?void 0:i.name),1)):(s(),o("span",Wt,"--ALL COMPANY--"))],8,Jt)]),_:1},8,["modelValue","options"]),l[5]||(l[5]=e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),_(O,{modelValue:t.value,"onUpdate:modelValue":l[1]||(l[1]=i=>t.value=i),companies:C.value||[],class:"relative w-full md:w-48 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300"},defaultOption:"--ALL DEPARTMENT--"},{label:R(()=>l[6]||(l[6]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),f(c).name!=="MyTaskList"?(s(),A(O,{key:0,modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=i=>d.value=i),companies:C.value||[],class:"relative w-full md:w-48 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300  "},defaultOption:"--ALL DEPARTMENT--"},{label:R(()=>l[7]||(l[7]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):S("",!0),f(a).isAdminMood&&((k=(w=f(a))==null?void 0:w.user)==null?void 0:k.role)!=="employee"?(s(),o("div",Xt,[_(at,{employees:L.value,modelValue:n.value,"onUpdate:modelValue":l[3]||(l[3]=i=>n.value=i),class:"border-2 border-gray-300 rounded h-[40px] w-full bg-white !text-sm"},null,8,["employees","modelValue"]),l[8]||(l[8]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Created By ",-1))])):S("",!0),e("div",Zt,[l[9]||(l[9]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),G(e("input",{id:"month-filter","onUpdate:modelValue":l[4]||(l[4]=i=>r.value=i),type:"month",class:"h-10 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[q,r.value]])])])])])])}}},qt={class:"container mx-auto p-6"},te={class:"bg-white shadow-md rounded-lg p-4"},ee={key:1,class:"text-center py-4 text-red-500"},se={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},ae={class:"font-semibold flex items-center gap-2"},oe={class:"rounded-b-md overflow-x-auto border-x xl:border-x-0"},be={__name:"RequirementList",setup(T){const u=lt(),b=tt(),a=J(),c=V({get(){return{...a.query}},set(d){b.push({query:{...d}})}});Q(()=>{console.log("Requirement List Mounted"),u.fetchRequirements(c.value)}),z(()=>({...c.value}),async function(d){u.fetchRequirements(d)});const x=()=>{b.push({name:"RequirementAdd"})},t=V(()=>(u.requirements||[]).reduce((d,n)=>{const r=`${n.from_department_id}-${n.to_department_id}`,g=d.find(m=>m.key==r);return g?g.requirements=[...g.requirements,n]:d.push({key:r,from_department:n.from_department,to_department:n.to_department,requirements:[n]}),d},[]));return(d,n)=>(s(),o("div",qt,[e("div",{class:"flex justify-between items-center mb-6"},[n[1]||(n[1]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Requirements",-1)),e("button",{onClick:x,class:"btn-1"},"Add Requirement")]),e("div",te,[_(Gt,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=r=>c.value=r),class:"mt-2 mb-6"},null,8,["modelValue"]),f(u).loading?(s(),A(W,{key:0,class:"sm:min-h-64 lg:min-h-96 shadow-none flex items-center justify-center"},{default:R(()=>n[2]||(n[2]=[M(" Loading requirements... ")])),_:1,__:[2]})):f(u).error?(s(),o("div",ee,y(f(u).error),1)):(s(!0),o(K,{key:2},Y(t.value,r=>(s(),o("div",{key:r.key,class:"mt-8 rounded-md border-2 border-sky-300"},[e("div",se,[e("div",ae,[n[3]||(n[3]=e("span",{class:"text-white text-sm"},"From",-1)),_(F,{department:r.from_department},null,8,["department"]),n[4]||(n[4]=e("span",{class:"text-white text-sm"},"To",-1)),_(F,{department:r.to_department},null,8,["department"])])]),e("div",oe,[_(It,{requirements:r.requirements},null,8,["requirements"])])]))),128))])]))}};export{be as default};
