import{_ as Ie,g as Ce,D as Oe,f as Me,u as Ne,E as Ee,r as W,x as g,q as z,h as Se,c as u,o as i,a as s,k as v,j as Pe,d as U,w as T,l as ue,v as pe,t as r,n as C,m as Q,b as O,F as Y,e as H,M as ce,s as Re}from"./index-BL-OQlTg.js";import{_ as Ae}from"./EmployeeFilter-D8edn8Bo.js";import{L as Ue}from"./LoaderView-BOq1QSeR.js";import{U as je}from"./UserChip-CukIGZ7b.js";import{g as me,l as Be,m as Le,c as J,a as X}from"./datetime-y2WWmmYq.js";import{j as $e}from"./url-Buz9GlSr.js";import{u as Ge}from"./useTodoDateStore-CMBiaTTR.js";import{_ as Fe}from"./TodoCreateEditShow-CJfRxWNf.js";import"./company-D8d5Xm0K.js";import"./department-CutgdQNW.js";import"./EmployeeDropdownInput-9s5tjfuW.js";import"./SelectDropdown-CFDO-xH4.js";import"./user-Cu9TC-TM.js";import"./OverlyModal-XsJBpz7-.js";import"./useTodoProjectStore-Bcmc4AHV.js";import"./useTodoStore-BkzidqQL.js";import"./useTaskStore-Dpwnz1Bx.js";import"./requirement-Dwpb2hmy.js";import"./TaskSelectionInput-tPWbj3U8.js";import"./TaskTitle-DfI3NPz9.js";import"./TodoStatusIcon-BkH6kMIn.js";const Ve={class:"container mx-auto print:w-full print:px-0 print:py-0"},qe={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},Ke={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},We={key:0,class:"relative h-[32px] flex gap-1 ml-auto justify-end print:hidden"},ze={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Qe={key:1,class:"text-gray-400"},Ye=["disabled"],He={key:0,class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0 shadow-sm"},Je={class:"flex flex-wrap items-center gap-3"},Xe={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Ze={class:"relative h-[32px] flex"},et={key:0,class:"text-xs text-blue-600 flex items-center gap-2 w-full md:w-auto md:ml-auto"},tt={key:1,class:"space-y-4"},st={key:0,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},nt={class:"text-sm text-gray-700"},ot={class:"font-semibold"},lt={class:"text-sm text-gray-700"},rt={class:"font-semibold"},at={class:"text-sm text-gray-700"},it={class:"font-semibold text-green-600"},dt={class:"text-sm text-gray-700"},ut={class:"font-semibold text-blue-600"},pt={class:"text-sm text-gray-700"},ct={class:"font-semibold text-amber-600"},mt={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},ft={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},yt={key:0,class:"flex items-center gap-3"},xt={class:"font-semibold text-gray-800"},gt=["href"],vt={class:"text-xs text-gray-500"},bt={class:"text-[11px] text-blue-800"},_t={key:0,class:"font-bold"},ht={key:1,class:"flex items-center gap-3"},kt={class:"font-semibold text-gray-800"},wt={class:"text-xs text-gray-500"},Dt={class:"text-[11px] text-blue-800"},Tt={key:0,class:"font-bold"},It={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},Ct={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},Ot={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},Mt={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},Nt={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},Et={class:"overflow-x-auto"},St={class:"min-w-full text-left text-sm border-separate border-spacing-0"},Pt={key:0},Rt={class:"bg-gray-100/50"},At={colspan:"4",class:"px-4 py-2 border font-bold text-blue-800 text-xs uppercase tracking-wider"},Ut={class:"ml-2 font-normal text-gray-500"},jt={class:"px-4 py-3 text-center border"},Bt={class:"px-4 py-3 border"},Lt=["onClick"],$t={class:"font-semibold text-gray-800 flex items-center gap-2"},Gt={key:0,class:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full"},Ft=["onClick"],Vt={class:"px-4 py-3 border text-xs text-gray-700"},qt={class:"px-4 py-3 border text-center"},Kt={key:2,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},Wt={__name:"PersonalActivityReportView",props:{selfOnly:{type:Boolean,default:!1}},setup(fe){const c=fe,k=Ge(),ye=Ce(),{user:M}=Oe(ye),j=Me(),xe=Ne(),l=Ee({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),p=W(""),Z=W(null),N=g(()=>{if(!p.value)return"";const[e,t]=p.value.split("-").map(Number);return!e||!t?"":me(new Date(e,t-1,1))}),E=g(()=>{if(!p.value)return"";const[e,t]=p.value.split("-").map(Number);return!e||!t?"":me(Be(new Date(e,t-1,1)))}),F=g(()=>p.value?Le(`${p.value}-01`):""),I=g(()=>N.value&&E.value?`${J(N.value)} ~ ${J(E.value)}`:""),B=g(()=>{var e;return c.selfOnly?((e=M.value)==null?void 0:e.company_id)||"":l.companyId}),V=g(()=>!N.value||!E.value?!1:c.selfOnly?!!h.value&&!!B.value:!!B.value),L=g(()=>k.todo_dates||[]),h=g(()=>{var e;return(e=M.value)!=null&&e.id?String(M.value.id):""});function ge(e){l.companyId=e.company_id||"",l.departmentId=e.department_id||"",l.employeeId=c.selfOnly?h.value:e.employee_id||"",l.lineType=e.line_type||"all"}function ve(e){return e==="COMPLETED"?"bg-green-500 text-green-100 border border-green-200":e==="WORKING"?"bg-amber-100 text-amber-700 border border-amber-200":e==="BACK_LOG"?"bg-slate-100 text-slate-500 border border-slate-400":e==="DEPENDANT"?"bg-neutral-50 text-neutral-700 border border-neutral-400":e==="PENDING"?"bg-yellow-50 text-yellow-700 border border-yellow-400":"bg-gray-100 text-gray-700 border border-gray-200"}function ee(e){var t,n;return e.todo_id||e.todoId||((t=e.todo)==null?void 0:t.id)||((n=e.todo)==null?void 0:n.todo_id)||e.id||`${e.title}-${e.date}`}function te(e){var t;return((t=e==null?void 0:e.todo)==null?void 0:t.id)||(e==null?void 0:e.todo_id)||(e==null?void 0:e.todoId)||(e==null?void 0:e.id)||null}function se(e){var y,x,_,w;const t=te(e);if(!t)return 0;const n=k.getTodoDateCount(t);if(typeof n=="number")return n;const f=((y=e==null?void 0:e.todo)==null?void 0:y.todo_dates_count)??(e==null?void 0:e.todo_dates_count)??((_=(x=e==null?void 0:e.todo)==null?void 0:x.todo_dates)==null?void 0:_.length)??((w=e==null?void 0:e.todo)==null?void 0:w.dates_count)??null;return typeof f=="number"?f:(L.value||[]).filter(o=>{var a;return(((a=o==null?void 0:o.todo)==null?void 0:a.id)||(o==null?void 0:o.todo_id)||(o==null?void 0:o.id))==t}).length}const ne=g(()=>{var f;if(c.selfOnly&&M.value)return[M.value];const e=((f=Z.value)==null?void 0:f.employees)||[];if(e.length)return e;const t=[],n=new Set;return L.value.forEach(y=>{const x=y.user;if(!x||!x.id)return;const _=String(x.id);n.has(_)||(n.add(_),t.push(x))}),t}),be=g(()=>l.employeeId?ne.value.filter(e=>String(e.id)===String(l.employeeId)):ne.value),$=g(()=>be.value.map(e=>{const t=L.value.filter(o=>{var a;return String(((a=o.user)==null?void 0:a.id)??o.user_id)===String(e.id)}),n={};for(const o of t){const a=ee(o),m=n[a],b=new Date(o.date),d=m?new Date(m.date):null;(!m||d&&b>d)&&(n[a]=o)}const f={WORKING:1,PENDING:2,DEPENDANT:3,COMPLETED:4,BACK_LOG:5},y=Object.values(n).sort((o,a)=>{const m=new Date(o.date).getTime(),b=new Date(a.date).getTime();if(m!==b)return b-m;const d=f[o.status]||999,D=f[a.status]||999;return d!==D?d-D:(o.priority||0)-(a.priority||0)}),x=y.reduce((o,a)=>{var d,D,R,A;const m=((D=(d=a.todo)==null?void 0:d.todo_project)==null?void 0:D.id)||"others",b=((A=(R=a.todo)==null?void 0:R.todo_project)==null?void 0:A.title)||"Others";return o[m]||(o[m]={id:m,name:b,todos:[]}),o[m].todos.push(a),o},{}),_=Object.values(x).sort((o,a)=>o.id==="others"?1:a.id==="others"?-1:o.name.localeCompare(a.name)),w={total:y.length,completed:y.filter(o=>o.status==="COMPLETED").length,working:y.filter(o=>o.status==="WORKING").length,pending:y.filter(o=>o.status==="PENDING").length};return{user:e,projects:_,totals:w}}).sort((e,t)=>{var n,f;return(((n=e.user)==null?void 0:n.name)||"").localeCompare(((f=t.user)==null?void 0:f.name)||"")})),G=g(()=>$.value.reduce((e,t)=>({totalTodos:e.totalTodos+t.totals.total,completed:e.completed+t.totals.completed,working:e.working+t.totals.working,pending:e.pending+t.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));function oe(){console.log("syncQuery",l),xe.replace({query:{...j.query,month:p.value||void 0,...c.selfOnly?{}:{company_id:l.companyId||void 0,department_id:l.departmentId||void 0,employee_id:l.employeeId||void 0,line_type:l.lineType||void 0}}})}async function S(){if(V.value){await k.fetchTodoDates({"company-id":B.value||void 0,"department-id":c.selfOnly?void 0:l.departmentId,"employee-id":c.selfOnly?h.value:l.employeeId,"line-type":c.selfOnly?void 0:l.lineType,"start-date":N.value,"end-date":E.value});try{const e=Array.from(new Set((L.value||[]).map(t=>te(t)).filter(t=>t)));e.length&&await k.fetchTodoDateCounts(e,{companyId:B.value||""})}catch(e){console.error("fetchTodoDateCounts failed",e)}}}function q(){c.selfOnly&&h.value&&(l.employeeId=h.value)}function le(){const e=j.query||{};p.value=typeof e.month=="string"&&e.month?e.month:p.value||X(new Date),l.companyId=c.selfOnly?"":e.company_id||"",l.departmentId=c.selfOnly?"":e.department_id||"",l.employeeId=c.selfOnly?h.value:e.employee_id||"",l.lineType=c.selfOnly?"all":e.line_type||"all",q()}z(()=>[l.companyId,l.departmentId,l.employeeId,l.lineType,N.value,E.value,p.value],()=>{q(),oe(),S()}),z(()=>j.query,()=>{le()}),z(h,()=>{q(),oe(),S()}),Se(()=>{p.value=p.value||X(new Date),le(),S()});function _e(){window.print()}function re(e){const t=p.value?new Date(`${p.value}-01`):new Date;t.setMonth(t.getMonth()+e),p.value=X(t)}function ae(){re(-1)}function ie(){re(1)}const P=W({action:null});function de(e){P.value={action:"show",todo:e}}function K(){P.value={action:null,todo:null}}function he(){S(),K()}function ke(){S(),K()}function we(e){P.value={action:"edit",todo:e}}function De(e,t){P.value={action:"addDate",todo_id:e,date:t}}return(e,t)=>(i(),u("div",Ve,[s("div",qe,[t[11]||(t[11]=s("div",null,[s("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),s("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),s("span",Ke,[c.selfOnly?(i(),u("div",We,[s("button",{class:"btn-3 h-[32px] px-3",onClick:T(ae,["prevent"])},t[6]||(t[6]=[s("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),s("div",ze,[t[7]||(t[7]=s("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),ue(s("input",{id:"month",type:"month","onUpdate:modelValue":t[0]||(t[0]=n=>p.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[pe,p.value]])]),s("button",{class:"btn-3 h-[32px] px-3",onClick:T(ie,["prevent"])},t[8]||(t[8]=[s("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])):v("",!0),t[9]||(t[9]=s("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),s("span",null,r(F.value),1),I.value?(i(),u("span",Qe,"("+r(I.value)+")",1)):v("",!0)]),s("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:T(_e,["prevent"]),disabled:C(k).loading,title:"Print"},t[10]||(t[10]=[s("i",{class:"fas fa-print"},null,-1)]),8,Ye)]),c.selfOnly?v("",!0):(i(),u("div",He,[s("div",Je,[U(Ae,{ref_key:"employeeFilterRef",ref:Z,company_id:l.companyId,"onUpdate:company_id":t[2]||(t[2]=n=>l.companyId=n),department_id:l.departmentId,"onUpdate:department_id":t[3]||(t[3]=n=>l.departmentId=n),employee_id:l.employeeId,"onUpdate:employee_id":t[4]||(t[4]=n=>l.employeeId=n),line_type:l.lineType,"onUpdate:line_type":t[5]||(t[5]=n=>l.lineType=n),"initial-value":C(j).query,onFilterChange:ge,class:"flex-1 min-w-[240px]"},{default:Q(()=>[s("div",Xe,[s("button",{class:"btn-3 h-[32px] px-3",onClick:T(ae,["prevent"])},t[12]||(t[12]=[s("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),s("div",Ze,[t[13]||(t[13]=s("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),ue(s("input",{id:"month",type:"month","onUpdate:modelValue":t[1]||(t[1]=n=>p.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[pe,p.value]])]),s("button",{class:"btn-3 h-[32px] px-3",onClick:T(ie,["prevent"])},t[14]||(t[14]=[s("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),c.selfOnly?(i(),u("div",et,[t[15]||(t[15]=s("i",{class:"fas fa-user-lock"},null,-1)),O(" Showing only my todos (Employee ID: "+r(h.value||"loading...")+") ",1)])):v("",!0)])])),V.value?(i(),u("div",tt,[c.selfOnly?v("",!0):(i(),u("div",st,[s("div",nt,[t[16]||(t[16]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),s("div",ot,r($.value.length),1)]),s("div",lt,[t[17]||(t[17]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),s("div",rt,r(G.value.totalTodos),1)]),s("div",at,[t[18]||(t[18]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),s("div",it,r(G.value.completed),1)]),s("div",dt,[t[19]||(t[19]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),s("div",ut,r(G.value.working),1)]),s("div",pt,[t[20]||(t[20]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),s("div",ct,r(G.value.pending),1)])])),$.value.length===0?(i(),u("div",mt," No data available for the selected month. ")):v("",!0),(i(!0),u(Y,null,H($.value,(n,f)=>{var y,x,_,w,o,a,m;return i(),u("div",{key:((y=n.user)==null?void 0:y.id)||f,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[s("div",ft,[c.selfOnly?(i(),u("div",ht,[U(ce,{user:n.user,size:"medium"},null,8,["user"]),s("div",null,[s("div",kt,r(((o=n.user)==null?void 0:o.name)||"Unknown user"),1),s("div",wt,r(((m=(a=n.user)==null?void 0:a.department)==null?void 0:m.name)||"-"),1),s("div",Dt,[O(" Month: "+r(F.value)+" ",1),I.value?(i(),u("span",Tt,"("+r(I.value)+")",1)):v("",!0)])])])):(i(),u("div",yt,[U(je,{user:n.user},{trigger:Q(()=>[U(ce,{user:n.user,size:"medium"},null,8,["user"])]),_:2},1032,["user"]),s("div",null,[s("div",xt,[s("a",{href:C($e)(n.user,p.value),target:"_blank",rel:"noopener",class:"inline-flex hover:underline"},[s("div",null,[O(r(((x=n.user)==null?void 0:x.name)||"Unknown user")+" ",1),t[21]||(t[21]=s("i",{class:"far fa-external-link-alt print:hidden"},null,-1))])],8,gt)]),s("div",vt,r(((w=(_=n.user)==null?void 0:_.department)==null?void 0:w.name)||"-"),1),s("div",bt,[O(" Month: "+r(F.value)+" ",1),I.value?(i(),u("span",_t,"("+r(I.value)+")",1)):v("",!0)])])])),s("div",It,[s("span",Ct," Total "+r(n.totals.total),1),s("span",Ot," Done "+r(n.totals.completed),1),s("span",Mt," Working "+r(n.totals.working),1),s("span",Nt," Pending "+r(n.totals.pending),1)])]),s("div",Et,[s("table",St,[t[24]||(t[24]=s("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[s("tr",{class:"border-b"},[s("th",{class:"px-4 py-3 border text-center w-12"},"sl"),s("th",{class:"px-4 py-3 border text-left"},"Todo"),s("th",{class:"px-4 py-3 border text-left"},"Last Activity"),s("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),s("tbody",null,[n.projects.length===0?(i(),u("tr",Pt,t[22]||(t[22]=[s("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-400 border rounded-b"}," No activity recorded for this month. ",-1)]))):v("",!0)]),(i(!0),u(Y,null,H(n.projects,b=>(i(),u("tbody",{key:b.id},[s("tr",Rt,[s("td",At,[t[23]||(t[23]=s("i",{class:"fas fa-project-diagram mr-2"},null,-1)),O(" "+r(b.name)+" ",1),s("span",Ut,"("+r(b.todos.length)+" todos)",1)])]),(i(!0),u(Y,null,H(b.todos,(d,D)=>{var R,A;return i(),u("tr",{key:ee(d),class:"border-b cursor-pointer hover:bg-slate-50"},[s("td",jt,r(D+1),1),s("td",Bt,[s("a",{href:"#",class:"text-blue-600 hover:underline",onClick:T(Te=>de(d),["prevent"])},[s("div",$t,[s("span",null,r(d.title),1),se(d)>1?(i(),u("span",Gt," + "+r(se(d))+" dates ",1)):v("",!0)]),s("div",{class:"text-xs text-gray-500",onClick:T(Te=>de(d),["prevent"])},r(((A=(R=d.todo)==null?void 0:R.todoable)==null?void 0:A.title)||""),9,Ft)],8,Lt)]),s("td",Vt,r(C(J)(d.date)||d.date),1),s("td",qt,[s("div",{class:Re(["inline-block text-xs font-semibold px-2.5 py-1 rounded-full whitespace-nowrap",ve(d.status)])},r(d.status==="WORKING"?"IN PROGRESS":d.status||"N/A"),3)])])}),128))]))),128))])])])}),128))])):v("",!0),!V.value&&!C(k).loading?(i(),u("div",Kt,t[25]||(t[25]=[s("i",{class:"fad fa-tasks text-4xl"},null,-1),s("div",{class:"empty-state glass-panel"},[s("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),s("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)]))):C(k).loading?(i(),Pe(Ue,{key:3},{default:Q(()=>t[26]||(t[26]=[O("Loading report...")])),_:1,__:[26]})):v("",!0),U(Fe,{todoModal:P.value,userRole:"employee",onCancelClick:K,onTodoUpdate:he,onTodoDateUpdate:ke,onClickEdit:we,onClickAddTodoDate:De},null,8,["todoModal"])]))}},fs=Ie(Wt,[["__scopeId","data-v-8687fa4c"]]);export{fs as default};
