import{O as lt}from"./OverlyModal-Cil63YbI.js";import{c as g,o as r,N as at,a as e,k as T,t as E,w as N,r as y,x as q,q as Y,h as G,R as bt,l as X,j as z,v as Z,O as gt,F as dt,e as ct,a5 as xt,A as tt,y as wt,d as R,g as nt,n as p,m as O,b as j}from"./index-vB-QvZ4T.js";import{g as J,c as kt}from"./datetime-y2WWmmYq.js";import{u as pt}from"./company-BpeZiUbJ.js";import{u as mt}from"./useTodoProjectStore-BtLzKQWx.js";import{u as it}from"./useTodoStore-DS96SyRF.js";import{L as st}from"./LoaderView-DFgqNtYf.js";import{u as Tt}from"./useTaskStore-CXBS3Vux.js";import{_ as _t}from"./TaskSelectionInput-CA7ybNiP.js";import{u as ft,f as ht,d as St,a as Ct,g as Dt}from"./useTodoDateStore-Ch5F1Pjz.js";import{_ as $t}from"./UserChip-CY9WS0F4.js";import{_ as It}from"./TodoStatusIcon-CzfvrMku.js";const jt={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md shadow-lg shadow-red-600"},Vt={key:0,class:"mb-4 text-red-500 font-medium"},Et={key:0,class:"mb-4 text-blue-500 font-medium"},Rt={class:"flex justify-between items-center gap-4"},Lt=["disabled"],rt={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(i,{emit:V}){const l=V;return(o,v)=>(r(),g("form",{onSubmit:v[1]||(v[1]=N(w=>l("submit"),["prevent"])),class:"overflow-hidden"},[at(o.$slots,"default"),e("div",jt,[at(o.$slots,"error",{},()=>[i.error?(r(),g("div",Vt,E(i.error),1)):T("",!0)]),i.isSubmitting?(r(),g("div",Et,"Saving changes...")):T("",!0),at(o.$slots,"footer",{},()=>[e("div",Rt,[e("button",{type:"button",onClick:v[0]||(v[0]=w=>l("clickCancel")),class:"btn-3"},"Cancel"),e("button",{disabled:i.isSubmitting||i.isLoading,type:"submit",class:"btn-2"},E(i.isSubmitting?"Saving...":"Save"),9,Lt)])])])],32))}},Ot={class:"relative"},Mt=["placeholder"],Ut=["onClick"],yt={__name:"InputWithSuggestions",props:{modelValue:{type:[String,Number],default:null},options:{type:Array,default:()=>[]},label:{type:String,default:"title"},value:{type:String,default:"id"},placeholder:{type:String,default:"Select or type..."}},emits:["update:modelValue","update:inputValue"],setup(i,{emit:V}){const l=i,o=V,v=y(""),w=y(!1),n=y(null),b=y(null),m=y({top:"0px",left:"0px",width:"0px"}),S=q(()=>{if(!v.value)return l.options;const s=v.value.toLowerCase();return l.options.filter(h=>{const a=h[l.label];return a&&String(a).toLowerCase().includes(s)})});function u(){if(n.value){const s=n.value.getBoundingClientRect();m.value={top:`${s.bottom}px`,left:`${s.left}px`,width:`${s.width}px`}}}function _(s){v.value=s[l.label],o("update:modelValue",s[l.value]),o("update:inputValue",s[l.label]),w.value=!1}function x(){w.value=!0,u(),o("update:inputValue",v.value);const s=l.options.find(h=>{var a;return((a=h[l.label])==null?void 0:a.toLowerCase())===v.value.toLowerCase()});s?o("update:modelValue",s[l.value]):o("update:modelValue",null)}function I(){w.value=!0,u()}Y(()=>l.modelValue,s=>{if(s){const h=l.options.find(a=>a[l.value]==s);h&&(v.value=h[l.label],o("update:inputValue",h[l.label]))}},{immediate:!0}),Y(()=>l.options,()=>{if(l.modelValue){const s=l.options.find(h=>h[l.value]==l.modelValue);s&&(v.value=s[l.label],o("update:inputValue",s[l.label]))}}),Y(w,s=>{s&&tt(()=>u())});function f(s){n.value&&n.value.contains(s.target)||b.value&&b.value.contains(s.target)||(w.value=!1)}function M(){w.value&&u()}function C(){w.value&&u()}return G(()=>{document.addEventListener("click",f),window.addEventListener("scroll",M,!0),window.addEventListener("resize",C)}),bt(()=>{document.removeEventListener("click",f),window.removeEventListener("scroll",M,!0),window.removeEventListener("resize",C)}),(s,h)=>(r(),g("div",Ot,[X(e("input",{ref_key:"inputRef",ref:n,type:"text","onUpdate:modelValue":h[0]||(h[0]=a=>v.value=a),onInput:x,onFocus:I,class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none",placeholder:i.placeholder},null,40,Mt),[[Z,v.value]]),(r(),z(xt,{to:"body"},[w.value&&S.value.length>0?(r(),g("ul",{key:0,ref_key:"dropdownRef",ref:b,class:"fixed z-[9999] bg-white border rounded-md shadow-lg max-h-60 overflow-y-auto mt-1",style:gt(m.value)},[(r(!0),g(dt,null,ct(S.value,a=>(r(),g("li",{key:a[i.value],onClick:t=>_(a),class:"px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 block text-left"},E(a[i.label]),9,Ut))),128))],4)):T("",!0)]))]))}},vt={__name:"TodoTypeInput",props:{todoType:{type:String,default:"task"},todoTypeId:{type:[String,Number],default:null},show:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["update:todoType","update:todoTypeId","update:show"],setup(i,{emit:V}){const l=i,o=V,v=q({get:()=>l.todoTypeId,set:u=>o("update:todoTypeId",u)}),w=q({get:()=>l.show,set:u=>o("update:show",u)}),n=y(null),b=y({});function m(){if(!(n!=null&&n.value))return;const u=n.value.getBoundingClientRect(),_=window.innerHeight,x=300,f=_-u.bottom<x;b.value={position:"fixed",top:f?u.top-x+"px":u.bottom+"px",left:u.left+"px",width:u.width+"px",zIndex:5e3}}G(async()=>{await tt(),window.addEventListener("resize",m),document.addEventListener("scroll",m)});const S=Tt();return Y(()=>w.value,async u=>{u&&await S.fetchAllMyTasks()}),wt(()=>{window.removeEventListener("resize",m),document.removeEventListener("scroll",m)}),(u,_)=>(r(),g("div",null,[R(_t,{show:w.value,"onUpdate:show":_[0]||(_[0]=x=>w.value=x),taskId:v.value,"onUpdate:taskId":_[1]||(_[1]=x=>v.value=x),readonly:i.readonly},null,8,["show","taskId","readonly"])]))}},Pt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},At={class:"mb-4"},Nt={class:"mb-4"},Bt=["readonly"],Ft={class:"mb-4"},zt={class:"mb-4"},qt={__name:"TodoAddForm",props:{date:{type:String,default:J(new Date)},userRole:{type:String,default:"employee"},todoType:{type:String,default:"task"},todoTypeId:{type:String,default:null},readonlyValues:{type:Object,default:()=>({date:!1,todo_type_id:!1})}},emits:["update","cancelClick"],setup(i,{emit:V}){const l=i,o=y(),v=y(!1),w=y(),n=it(),b=mt(),m=nt(),S=pt(),u=y(null),_=y(""),x=y(null),I=V,f=y({title:"",date:l.date||"",todo_type:"task",todo_type_id:""});async function M(){try{o.value="submitting";const C={...f.value};if(C.todo_type_id||(delete C.todo_type_id,delete C.todo_type),u.value)C.todo_project_id=u.value;else if(_.value){const s=await b.createProject({title:_.value,department_id:x.value});C.todo_project_id=s.id}await n.createTodo(C,{returnWith:l.userRole!=="employee"?"user,department,company":""}),I("update")}finally{o.value=""}}return Y(()=>({date:l.date,todo_type:l.todoType,todo_type_id:l.todoTypeId}),C=>{f.value={...f.value,...C}},{immediate:!0}),G(async()=>{var C;await tt(),(C=w.value)==null||C.focus(),m.isAdminMood&&await S.fetchMyCompanies({with:"departments"}),await b.fetchProjects()}),(C,s)=>(r(),g("div",{onClick:s[8]||(s[8]=h=>v.value=!1)},[p(n).loading?(r(),z(st,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:O(()=>s[9]||(s[9]=[j(" Loading... ")])),_:1,__:[9]})):T("",!0),R(rt,{onSubmit:M,onClickCancel:s[7]||(s[7]=h=>I("cancelClick")),isSubmitting:o.value=="submitting",error:p(n).error,class:"rounded-md relative"},{default:O(()=>{var h,a;return[s[14]||(s[14]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),e("div",Pt,[e("div",At,[s[10]||(s[10]=e("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Title",-1)),X(e("input",{ref_key:"titleRef",ref:w,"onUpdate:modelValue":s[0]||(s[0]=t=>f.value.title=t),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Z,f.value.title]])]),e("div",Nt,[s[11]||(s[11]=e("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Date",-1)),X(e("input",{readonly:(h=i.readonlyValues)==null?void 0:h.date,"onUpdate:modelValue":s[1]||(s[1]=t=>f.value.date=t),type:"date",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,8,Bt),[[Z,f.value.date]])]),e("div",Ft,[s[12]||(s[12]=e("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},[j(" Issue/Website/Project "),e("span",{class:"text-gray-500"},"(Optional)")],-1)),R(yt,{modelValue:u.value,"onUpdate:modelValue":s[2]||(s[2]=t=>u.value=t),"onUpdate:inputValue":s[3]||(s[3]=t=>_.value=t),options:p(b).projects,label:"title",value:"id",placeholder:"Select or type project..."},null,8,["modelValue","options"])]),e("div",zt,[s[13]||(s[13]=e("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Task (optional)",-1)),R(vt,{show:v.value,"onUpdate:show":s[4]||(s[4]=t=>v.value=t),todoType:f.value.todo_type,"onUpdate:todoType":s[5]||(s[5]=t=>f.value.todo_type=t),todoTypeId:f.value.todo_type_id,"onUpdate:todoTypeId":s[6]||(s[6]=t=>f.value.todo_type_id=t),readonly:(a=i.readonlyValues)==null?void 0:a.todo_type_id},null,8,["show","todoType","todoTypeId","readonly"])])])]}),_:1,__:[14]},8,["isSubmitting","error"])]))}},Ht={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Gt={class:"mb-4 text-md"},Wt={class:"font-semibold"},Kt={class:"mb-2"},Qt={__name:"TodoDateAddForm",props:{date:{type:[String,Number],default:J(new Date)},todoId:{type:[String,Number],required:!0},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(i,{emit:V}){const l=i,o=y(),v=y(!1),w=y(),n=it(),b=ft(),m=V,S=y({date:l.date||"",todo_id:l.todoId});async function u(){try{o.value="submitting",await b.createTodoDate(S.value),m("update")}finally{o.value=""}}return G(async()=>{var _;await tt(),await n.fetchTodo(l.todoId),(_=w.value)==null||_.focus()}),(_,x)=>(r(),g("div",{onClick:x[2]||(x[2]=I=>v.value=!1)},[p(n).loading?(r(),z(st,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:O(()=>x[3]||(x[3]=[j(" Loading... ")])),_:1,__:[3]})):T("",!0),R(rt,{onSubmit:u,onClickCancel:x[1]||(x[1]=I=>m("cancelClick")),isSubmitting:o.value=="submitting",error:p(b).error,class:"rounded-md relative"},{default:O(()=>{var I;return[x[6]||(x[6]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Carry Todo To Date")],-1)),e("div",Ht,[e("div",Gt,[x[4]||(x[4]=j(" TODO: ")),e("span",Wt,E((I=p(n).todo)==null?void 0:I.title),1)]),e("div",Kt,[x[5]||(x[5]=e("span",{class:"font-semibold"}," Date ",-1)),X(e("input",{"onUpdate:modelValue":x[0]||(x[0]=f=>S.value.date=f),type:"date",multiple:"",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Z,S.value.date]])])])]}),_:1,__:[6]},8,["isSubmitting","error"])]))}},Yt={key:0,class:"mb-4 text-red-500 font-medium"},Jt={key:1,class:"mb-4 text-red-500 font-medium"},Xt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Zt={class:"mb-5"},te={class:"relative group"},ee={class:"mb-5"},oe={class:"mb-8"},le={__name:"TodoEditForm",props:{date:{type:String,default:J(new Date)},todo:{type:Object,default:()=>({})}},emits:["update","cancelClick"],setup(i,{emit:V}){var K;const l=i,o=y(),v=y(!1),w=y(),n=it(),b=mt(),m=nt(),S=pt(),u=y(null),_=y(""),x=y(null),I=V,f=y({title:"",todo_type:"task",todo_type_id:"",status:"PENDING"}),M=y({id:null,repeat_type:"daily",start_date:((K=l.todo)==null?void 0:K.date)||l.date||J(new Date),end_date:null,weekly_day:null,monthly_mode:null,monthly_value:null,monthly_week:null,yearly_month:null,yearly_day:null}),C=y(!1),s=y({});async function h(){var k,d,c,$,Q;await n.fetchTodo((k=l.todo)==null?void 0:k.id),f.value.title=(d=n.todo)==null?void 0:d.title,f.value.todo_type_id=(c=n.todo)==null?void 0:c.todoable_id,f.value.status=(($=n.todo)==null?void 0:$.status)||"PENDING",u.value=((Q=n.todo)==null?void 0:Q.todo_project_id)||null}const a=y(null);async function t(){var k,d;try{const{data:c}=await ht(l.todo.id),$=c==null?void 0:c.setting;$?(C.value=!0,a.value=$.id,M.value={repeat_type:$.repeat_type??"daily",start_date:$.start_date??M.value.start_date,end_date:$.end_date??null,weekly_day:$.weekly_day??null,monthly_mode:$.monthly_mode??null,monthly_value:$.monthly_value??null,monthly_week:$.monthly_week??null,yearly_month:$.yearly_month??null,yearly_day:$.yearly_day??null}):M.value.id=null}catch(c){A.value=(d=(k=c==null?void 0:c.response)==null?void 0:k.data)==null?void 0:d.message,console.error("Load setting failed:",(c==null?void 0:c.message)||c)}}async function D(){const k={title:f.value.title,todo_type:f.value.todo_type,todo_type_id:f.value.todo_type_id,status:f.value.status};if(u.value)k.todo_project_id=u.value;else if(_.value){const d=await b.createProject({title:_.value,department_id:x.value});k.todo_project_id=d.id}await n.updateTodo(l.todo.id,k)}async function L(){var k,d;if(!C.value)a.value&&await St(l.todo.id,a.value);else{const c=(k=s.value)!=null&&k.buildPayload?s.value.buildPayload():{...M.value};c.start_date||(c.start_date=((d=l.todo)==null?void 0:d.date)||l.date||J(new Date)),await Ct(l.todo.id,c)}}const U=k=>{var d,c;return((c=(d=k==null?void 0:k.response)==null?void 0:d.data)==null?void 0:c.message)||(k==null?void 0:k.message)||"Something went wrong"};async function B(){const[k,d]=await Promise.allSettled([D(),L()]),c=k.status==="fulfilled",$=d.status==="fulfilled";$||(A.value=U(d.reason)),c&&$&&I("update")}const P=y(!1),A=y(!1);async function et(){var k;m.isAdminMood&&await S.fetchMyCompanies({with:"departments"}),b.fetchProjects(),await h(),P.value=!0,await t(),P.value=!1,await tt(),(k=w.value)==null||k.focus()}const W=q(()=>n.loading||P.value);return G(()=>{et()}),(k,d)=>(r(),g("div",{class:"relative",onClick:d[7]||(d[7]=c=>v.value=!1)},[W.value?(r(),z(st,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:O(()=>d[8]||(d[8]=[j(" Loading... ")])),_:1,__:[8]})):T("",!0),R(rt,{onSubmit:B,onClickCancel:d[6]||(d[6]=c=>I("cancelClick")),isSubmitting:o.value=="submitting",isLoading:W.value,id:"todoEditForm"},{error:O(()=>[e("div",null,[p(n).error?(r(),g("div",Yt,E(p(n).error),1)):T("",!0),A.value?(r(),g("div",Jt,E(A.value),1)):T("",!0)])]),default:O(()=>[d[14]||(d[14]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),e("div",Xt,[d[13]||(d[13]=e("div",{class:"text-xs text-red-800 mb-6"},[e("strong",null,"Tips:"),j(" If you change the todo, it will change to all the concurrent dates ")],-1)),e("div",Zt,[d[10]||(d[10]=e("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"}," Title ",-1)),e("div",te,[X(e("input",{ref_key:"titleRef",ref:w,"onUpdate:modelValue":d[0]||(d[0]=c=>f.value.title=c),required:"",placeholder:"Enter todo title",class:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-sky-500/10 focus:border-sky-400 outline-none transition-all duration-200 font-medium text-slate-700"},null,512),[[Z,f.value.title]]),d[9]||(d[9]=e("div",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-sky-500 transition-colors"},[e("i",{class:"fas fa-edit text-sm"})],-1))])]),e("div",ee,[d[11]||(d[11]=e("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"},[j(" Issue/Website/Project "),e("span",{class:"text-[10px] lowercase font-normal"},"(Optional)")],-1)),R(yt,{modelValue:u.value,"onUpdate:modelValue":d[1]||(d[1]=c=>u.value=c),"onUpdate:inputValue":d[2]||(d[2]=c=>_.value=c),options:p(b).projects,value:"id",label:"title",placeholder:"Select or type project..."},null,8,["modelValue","options"])]),e("div",oe,[d[12]||(d[12]=e("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"},[j(" Task ID "),e("span",{class:"text-[10px] lowercase font-normal"},"(Optional)")],-1)),R(vt,{show:v.value,"onUpdate:show":d[3]||(d[3]=c=>v.value=c),todoType:f.value.todo_type,"onUpdate:todoType":d[4]||(d[4]=c=>f.value.todo_type=c),todoTypeId:f.value.todo_type_id,"onUpdate:todoTypeId":d[5]||(d[5]=c=>f.value.todo_type_id=c)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[14]},8,["isSubmitting","isLoading"])]))}},se={class:"relative"},ae={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},de={class:"mb-4 flex justify-between items-end"},ne={class:"text-base font-semibold"},ie={key:0,class:"text-xs text-slate-400 mt-1"},re={class:"mb-4 flex justify-between items-center group"},ue={class:"text-sm font-semibold text-slate-700"},ce={key:0,class:"mt-1 flex items-center gap-2 mb-4"},pe={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},me={class:"flex items-center justify-between mb-4"},fe={class:"flex items-center gap-2 px-3 py-1.5 bg-white rounded-full shadow-sm border border-slate-100"},ye={class:"text-xs font-bold text-slate-700 tracking-wide"},ve={class:"mt-6 p-4 rounded-xl border border-slate-200 border-dashed"},be={key:0},ge={class:"grid grid-cols-2 gap-3"},xe={key:1,class:"py-4 text-center text-emerald-600 bg-emerald-50 rounded-lg border border-emerald-100"},we={class:"px-4 mb-4"},ke={class:"mt-4"},Te={class:"text-sm font-bold text-slate-600 uppercase tracking-widest"},_e={class:"text-lg text-slate-500"},he={key:0,class:"mt-0.5 max-h-40 overflow-y-auto border rounded p-2 bg-white"},Se={key:0,class:"text-xs text-slate-400 py-2"},Ce=["onClick"],De={class:"text-xs text-slate-400"},$e={key:0,class:"text-xs text-emerald-600 font-bold"},Ie=["onClick"],je={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},Ve={key:0,class:"ml-auto flex items-center gap-2"},Ee={__name:"TodoShow",props:{todoDate:{type:[Object,Number],default:null}},emits:["cancelClick","clickEdit","update","clickAddTodoDate"],setup(i,{emit:V}){const l=i,o=ft(),v=nt(),w=V,n=y(null),b=y(!1),m=q(()=>{var a;return l.todoDate?typeof l.todoDate=="number"?l.todoDate:((a=l.todoDate)==null?void 0:a.id)||null:null});async function S(a){var D,L,U,B;const t=a||m.value;if(t){if(b.value&&n.value===t){console.log("fetchTodo: already fetching",t);return}b.value=!0,n.value=t,console.log("fetchTodo:start",t,new Date().toISOString());try{await o.fetchTodoDate(t);const P=((D=o.todo_date)==null?void 0:D.todo_id)||((U=(L=o.todo_date)==null?void 0:L.todo)==null?void 0:U.id);if(P)try{const A=await Dt(P);x.value=((B=A.data)==null?void 0:B.todo_dates)||[]}catch(A){console.error("getTodoHistories failed",A)}}catch(P){console.error("fetchTodo failed",P)}finally{b.value=!1,console.log("fetchTodo:end",t,new Date().toISOString())}}}const u=y(!1),_=q(()=>{var t,D,L,U,B;const a=(t=o.todo_date)==null?void 0:t.todo;return((D=a==null?void 0:a.project)==null?void 0:D.name)||((L=a==null?void 0:a.project)==null?void 0:L.title)||((U=a==null?void 0:a.project)==null?void 0:U.display_name)||((B=a==null?void 0:a.project)==null?void 0:B.project_name)||""}),x=y([]),I=q(()=>[...x.value||[]].sort((t,D)=>{const L=t!=null&&t.date?new Date(t.date).getTime():0;return(D!=null&&D.date?new Date(D.date).getTime():0)-L}));async function f(a){a&&await o.fetchTodoDate(a)}const M=q(()=>{var a,t;return(a=o.todo_date)!=null&&a.date?new Date((t=o.todo_date)==null?void 0:t.date):null}),C=q(()=>{var a,t,D;return((t=(a=o.todo_date)==null?void 0:a.user)==null?void 0:t.id)===((D=v.user)==null?void 0:D.id)});async function s(a){var t;confirm(`Are your sure want to delete todo
'${(t=o.todo_date)==null?void 0:t.title}'`)&&(await o.deleteTodoDate(a.id),w("update"))}async function h(a,t){var D;confirm(`Are your sure want to compete todo
'${(D=o.todo_date)==null?void 0:D.title}'`)&&(await o.updateStatus(a.id,t),w("update"))}return G(async()=>{const a=m.value;a&&await S(a)}),(a,t)=>{var D,L,U,B,P,A,et,W,K,k,d,c,$,Q,ut;return r(),g("div",se,[p(o).loading?(r(),z(st,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:O(()=>t[9]||(t[9]=[j(" Loading... ")])),_:1,__:[9]})):T("",!0),e("div",null,[t[22]||(t[22]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),e("div",ae,[e("div",de,[e("div",null,[t[10]||(t[10]=e("div",{class:"text-xs text-gray-500"},"Todo",-1)),e("div",ne,E((D=p(o).todo_date)==null?void 0:D.title),1),_.value?(r(),g("div",ie,E(_.value),1)):T("",!0)]),e("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white bg-none",onClick:t[0]||(t[0]=N(F=>{var H;return w("clickEdit",(H=p(o).todo_date)==null?void 0:H.todo)},["prevent","stop"]))},t[11]||(t[11]=[e("i",{class:"fas fa-pen"},null,-1),j(" Edit Todo ")]))]),t[21]||(t[21]=e("hr",{class:"mb-4"},null,-1)),e("div",re,[e("div",null,[t[12]||(t[12]=e("div",{class:"font-semibold text-[10px] text-slate-400 uppercase tracking-wider mb-0.5"}," Date ",-1)),e("div",ue,E(p(kt)(M.value,{weekDay:"long"})),1)]),C.value&&!p(o).loading?(r(),g("button",{key:0,class:"btn-2 bg-emerald-500 text-white hover:bg-emerald-700 hover:text-white bg-none",onClick:t[1]||(t[1]=N(F=>{var H,ot;return w("clickAddTodoDate",(H=p(o).todo_date)==null?void 0:H.todo_id,(ot=p(o).todo_date)==null?void 0:ot.date)},["prevent","stop"]))},t[13]||(t[13]=[e("i",{class:"fas fa-calendar-plus mr-1"},null,-1),j(" Add to another date ")]))):T("",!0)]),(L=p(o).todo_date)!=null&&L.user?(r(),g("div",ce,[R($t,{user:p(o).todo_date.user,"avatar-size":"xsmall"},null,8,["user"]),e("div",pe,E((P=(B=(U=p(o).todo_date)==null?void 0:U.user)==null?void 0:B.department)==null?void 0:P.name),1)])):T("",!0),e("div",me,[t[14]||(t[14]=e("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"}," Current Status ",-1)),e("div",fe,[(A=p(o))!=null&&A.todo_date?(r(),z(It,{key:0,todoDate:(et=p(o))==null?void 0:et.todo_date},null,8,["todoDate"])):T("",!0),e("span",ye,E((W=p(o).todo_date)==null?void 0:W.status),1)])]),e("div",ve,[C.value&&!p(o).loading&&((K=p(o).todo_date)==null?void 0:K.status)!=="COMPLETED"?(r(),g("div",be,[t[19]||(t[19]=e("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 text-center"}," Quick Transitions ",-1)),e("div",ge,[((k=p(o).todo_date)==null?void 0:k.status)!=="WORKING"?(r(),g("button",{key:0,class:"btn-2 py-2.5 from-amber-600 to-amber-400 text-white hover:scale-[1.02] active:scale-[0.98] shadow-md transition-all duration-200",onClick:t[2]||(t[2]=N(()=>h(p(o).todo_date,"WORKING"),["prevent","stop"]))},t[15]||(t[15]=[e("i",{class:"fas fa-sync-alt mr-1"},null,-1),j(" Working ")]))):T("",!0),((d=p(o).todo_date)==null?void 0:d.status)!=="COMPLETED"&&((c=p(o).todo_date)==null?void 0:c.status)!=="BACK_LOG"?(r(),g("button",{key:1,class:"btn-2 py-2.5 from-emerald-600 to-emerald-400 text-white hover:scale-[1.02] active:scale-[0.98] shadow-md transition-all duration-200",onClick:t[3]||(t[3]=N(()=>h(p(o).todo_date,"COMPLETED"),["prevent","stop"]))},t[16]||(t[16]=[e("i",{class:"fas fa-check-double mr-1"},null,-1),j(" Complete ")]))):T("",!0),(($=p(o).todo_date)==null?void 0:$.status)!=="DEPENDANT"?(r(),g("button",{key:2,class:"btn-4 py-2 bg-white border border-slate-200 text-slate-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 hover:scale-[1.02] active:scale-[0.98] shadow-sm transition-all duration-200",onClick:t[4]||(t[4]=N(()=>h(p(o).todo_date,"DEPENDANT"),["prevent","stop"]))},t[17]||(t[17]=[e("i",{class:"fas fa-pause-circle mr-1"},null,-1),j(" Dependant / Pause ")]))):T("",!0),((Q=p(o).todo_date)==null?void 0:Q.status)!=="BACK_LOG"?(r(),g("button",{key:3,class:"btn-4 py-2 bg-white border border-slate-200 text-slate-600 hover:bg-purple-50 hover:text-purple-600 hover:border-purple-200 hover:scale-[1.02] active:scale-[0.98] shadow-sm transition-all duration-200",onClick:t[5]||(t[5]=N(()=>h(p(o).todo_date,"BACK_LOG"),["prevent","stop"]))},t[18]||(t[18]=[e("i",{class:"fas fa-history mr-1"},null,-1),j(" Backlog ")]))):T("",!0)])])):((ut=p(o).todo_date)==null?void 0:ut.status)==="COMPLETED"?(r(),g("div",xe,t[20]||(t[20]=[e("i",{class:"fas fa-check-circle text-2xl mb-1"},null,-1),e("div",{class:"text-xs font-bold uppercase tracking-wider"},"This Todo is Completed",-1)]))):T("",!0)])]),t[23]||(t[23]=e("hr",{class:"mx-4"},null,-1)),e("div",we,[e("div",ke,[e("h2",{class:"w-full text-left flex items-center justify-between cursor-pointer py-2 bg-white rounded-md",onClick:t[6]||(t[6]=N(F=>u.value=!u.value,["prevent"]))},[e("div",Te," Todo history ("+E(I.value.length)+") ",1),e("div",_e,E(u.value?"▾":"▸"),1)]),u.value?(r(),g("div",he,[I.value.length===0?(r(),g("div",Se," No history ")):T("",!0),(r(!0),g(dt,null,ct(I.value,F=>{var H;return r(),g("div",{key:F.id,class:"flex items-center justify-between py-2 px-2 hover:bg-slate-50 border-b last:border-b-0"},[e("div",null,[e("a",{href:"#",onClick:N(ot=>f(F.id),["prevent"]),class:"text-sm font-semibold text-sky-600"},E(F.date),9,Ce),e("div",De,E(F.status),1)]),e("div",null,[F.id===((H=p(o).todo_date)==null?void 0:H.id)?(r(),g("span",$e,"Current")):(r(),g("button",{key:1,class:"btn-2 py-1 px-2 text-xs",onClick:N(ot=>f(F.id),["prevent"])}," Show ",8,Ie))])])}),128))])):T("",!0)])])]),e("div",je,[e("button",{type:"button",onClick:t[7]||(t[7]=F=>w("cancelClick")),class:"btn-3"},"Cancel"),C.value&&!p(o).loading?(r(),g("div",Ve,[e("button",{class:"btn-2-red",onClick:t[8]||(t[8]=N(()=>s(p(o).todo_date),["prevent","stop"]))},t[24]||(t[24]=[e("i",{class:"fas fa-trash-alt"},null,-1),j(" Delete ")]))])):T("",!0)])])}}},He={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","todoUpdate","todoDateUpdate","clickEdit","clickDelete","clickChangeStatus","clickAddTodoDate"],setup(i,{emit:V}){const l=V;function o(){l("todoUpdate")}function v(){l("todoDateUpdate")}return(w,n)=>(r(),g(dt,null,[i.todoModal.action=="add"?(r(),z(lt,{key:0},{default:O(()=>{var b,m,S,u;return[R(qt,{onCancelClick:n[0]||(n[0]=_=>l("cancelClick")),onUpdate:o,date:(b=i.todoModal)==null?void 0:b.date,todoType:(m=i.todoModal)==null?void 0:m.todoType,todoTypeId:(S=i.todoModal)==null?void 0:S.todoTypeId,readonlyValues:((u=i.todoModal)==null?void 0:u.formReadonlyValues)||{},userRole:i.userRole},null,8,["date","todoType","todoTypeId","readonlyValues","userRole"])]}),_:1})):T("",!0),i.todoModal.action=="addDate"?(r(),z(lt,{key:1},{default:O(()=>{var b,m,S;return[R(Qt,{onCancelClick:n[1]||(n[1]=u=>l("cancelClick")),onUpdate:v,date:(b=i.todoModal)==null?void 0:b.date,todoId:(m=i.todoModal)==null?void 0:m.todo_id,userRole:i.userRole,readonlyValues:((S=i.todoModal)==null?void 0:S.formReadonlyValues)||{}},null,8,["date","todoId","userRole","readonlyValues"])]}),_:1})):T("",!0),i.todoModal.action=="edit"?(r(),z(lt,{key:2},{default:O(()=>{var b,m;return[R(le,{onCancelClick:n[2]||(n[2]=S=>l("cancelClick")),onUpdate:o,todo:(b=i.todoModal)==null?void 0:b.todo,userRole:i.userRole,readonlyValues:((m=i.todoModal)==null?void 0:m.formReadonlyValues)||{}},null,8,["todo","userRole","readonlyValues"])]}),_:1})):T("",!0),i.todoModal.action=="show"?(r(),z(lt,{key:3},{default:O(()=>{var b;return[R(Ee,{onCancelClick:n[3]||(n[3]=m=>l("cancelClick")),onUpdate:v,onClickEdit:n[4]||(n[4]=m=>l("clickEdit",m)),onClickAddTodoDate:n[5]||(n[5]=(...m)=>l("clickAddTodoDate",...m)),onClickDelete:n[6]||(n[6]=m=>l("clickDelete",m)),onClickChangeStatus:n[7]||(n[7]=(m,S)=>l("clickChangeStatus",m,S)),todoDate:(b=i.todoModal)==null?void 0:b.todo,userRole:i.userRole},null,8,["todoDate","userRole"])]}),_:1})):T("",!0)],64))}};export{He as _};
