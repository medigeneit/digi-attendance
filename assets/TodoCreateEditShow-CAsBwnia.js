import{O as lt}from"./OverlyModal-DyRUsZTi.js";import{c as w,o as r,O as at,a as t,k as _,t as E,w as N,r as v,x as q,q as Y,h as G,U as bt,l as X,j as B,v as Z,P as gt,F as dt,e as ct,a5 as xt,A as tt,y as wt,d as R,g as nt,n as p,m as L,b as j}from"./index-gX_N_SR5.js";import{g as J,b as kt}from"./datetime-Du_mcDA9.js";import{u as pt}from"./company-qYmWMrQg.js";import{u as mt}from"./useTodoProjectStore-CP552evr.js";import{u as it}from"./useTodoStore-B55NJEfJ.js";import{_ as Tt}from"./CompanyDepartmentSelectInput-dxzkYGd9.js";import{L as st}from"./LoaderView-ByWIPa_A.js";import{u as _t}from"./useTaskStore-YPoGiHpx.js";import{_ as ht}from"./TaskSelectionInput-DqxsGnor.js";import{u as ft,f as St,d as Ct,a as Dt,g as $t}from"./useTodoDateStore-B6m0WGod.js";import{_ as It}from"./UserChip-ExWKJX7X.js";import{_ as jt}from"./TodoStatusIcon-D55RTgyi.js";const Vt={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md shadow-lg shadow-red-600"},Et={key:0,class:"mb-4 text-red-500 font-medium"},Rt={key:0,class:"mb-4 text-blue-500 font-medium"},Lt={class:"flex justify-between items-center gap-4"},Ot=["disabled"],rt={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(i,{emit:V}){const s=V;return(o,b)=>(r(),w("form",{onSubmit:b[1]||(b[1]=N(k=>s("submit"),["prevent"])),class:"overflow-hidden"},[at(o.$slots,"default"),t("div",Vt,[at(o.$slots,"error",{},()=>[i.error?(r(),w("div",Et,E(i.error),1)):_("",!0)]),i.isSubmitting?(r(),w("div",Rt,"Saving changes...")):_("",!0),at(o.$slots,"footer",{},()=>[t("div",Lt,[t("button",{type:"button",onClick:b[0]||(b[0]=k=>s("clickCancel")),class:"btn-3"},"Cancel"),t("button",{disabled:i.isSubmitting||i.isLoading,type:"submit",class:"btn-2"},E(i.isSubmitting?"Saving...":"Save"),9,Ot)])])])],32))}},Mt={class:"relative"},Ut=["placeholder"],Pt=["onClick"],yt={__name:"InputWithSuggestions",props:{modelValue:{type:[String,Number],default:null},options:{type:Array,default:()=>[]},label:{type:String,default:"title"},value:{type:String,default:"id"},placeholder:{type:String,default:"Select or type..."}},emits:["update:modelValue","update:inputValue"],setup(i,{emit:V}){const s=i,o=V,b=v(""),k=v(!1),n=v(null),g=v(null),f=v({top:"0px",left:"0px",width:"0px"}),h=q(()=>{if(!b.value)return s.options;const l=b.value.toLowerCase();return s.options.filter(C=>{const a=C[s.label];return a&&String(a).toLowerCase().includes(l)})});function u(){if(n.value){const l=n.value.getBoundingClientRect();f.value={top:`${l.bottom}px`,left:`${l.left}px`,width:`${l.width}px`}}}function S(l){b.value=l[s.label],o("update:modelValue",l[s.value]),o("update:inputValue",l[s.label]),k.value=!1}function x(){k.value=!0,u(),o("update:inputValue",b.value);const l=s.options.find(C=>{var a;return((a=C[s.label])==null?void 0:a.toLowerCase())===b.value.toLowerCase()});l?o("update:modelValue",l[s.value]):o("update:modelValue",null)}function I(){k.value=!0,u()}Y(()=>s.modelValue,l=>{if(l){const C=s.options.find(a=>a[s.value]==l);C&&(b.value=C[s.label],o("update:inputValue",C[s.label]))}},{immediate:!0}),Y(()=>s.options,()=>{if(s.modelValue){const l=s.options.find(C=>C[s.value]==s.modelValue);l&&(b.value=l[s.label],o("update:inputValue",l[s.label]))}}),Y(k,l=>{l&&tt(()=>u())});function y(l){n.value&&n.value.contains(l.target)||g.value&&g.value.contains(l.target)||(k.value=!1)}function M(){k.value&&u()}function D(){k.value&&u()}return G(()=>{document.addEventListener("click",y),window.addEventListener("scroll",M,!0),window.addEventListener("resize",D)}),bt(()=>{document.removeEventListener("click",y),window.removeEventListener("scroll",M,!0),window.removeEventListener("resize",D)}),(l,C)=>(r(),w("div",Mt,[X(t("input",{ref_key:"inputRef",ref:n,type:"text","onUpdate:modelValue":C[0]||(C[0]=a=>b.value=a),onInput:x,onFocus:I,class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none",placeholder:i.placeholder},null,40,Ut),[[Z,b.value]]),(r(),B(xt,{to:"body"},[k.value&&h.value.length>0?(r(),w("ul",{key:0,ref_key:"dropdownRef",ref:g,class:"fixed z-[9999] bg-white border rounded-md shadow-lg max-h-60 overflow-y-auto mt-1",style:gt(f.value)},[(r(!0),w(dt,null,ct(h.value,a=>(r(),w("li",{key:a[i.value],onClick:e=>S(a),class:"px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 block text-left"},E(a[i.label]),9,Pt))),128))],4)):_("",!0)]))]))}},vt={__name:"TodoTypeInput",props:{todoType:{type:String,default:"task"},todoTypeId:{type:[String,Number],default:null},show:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["update:todoType","update:todoTypeId","update:show"],setup(i,{emit:V}){const s=i,o=V,b=q({get:()=>s.todoTypeId,set:u=>o("update:todoTypeId",u)}),k=q({get:()=>s.show,set:u=>o("update:show",u)}),n=v(null),g=v({});function f(){if(!(n!=null&&n.value))return;const u=n.value.getBoundingClientRect(),S=window.innerHeight,x=300,y=S-u.bottom<x;g.value={position:"fixed",top:y?u.top-x+"px":u.bottom+"px",left:u.left+"px",width:u.width+"px",zIndex:5e3}}G(async()=>{await tt(),window.addEventListener("resize",f),document.addEventListener("scroll",f)});const h=_t();return Y(()=>k.value,async u=>{u&&await h.fetchAllMyTasks()}),wt(()=>{window.removeEventListener("resize",f),document.removeEventListener("scroll",f)}),(u,S)=>(r(),w("div",null,[R(ht,{show:k.value,"onUpdate:show":S[0]||(S[0]=x=>k.value=x),taskId:b.value,"onUpdate:taskId":S[1]||(S[1]=x=>b.value=x),readonly:i.readonly},null,8,["show","taskId","readonly"])]))}},At={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Nt={class:"mb-4"},Bt={class:"mb-4"},Ft=["readonly"],zt={class:"mb-4"},qt={class:"mb-4"},Ht={__name:"TodoAddForm",props:{date:{type:String,default:J(new Date)},userRole:{type:String,default:"employee"},todoType:{type:String,default:"task"},todoTypeId:{type:String,default:null},readonlyValues:{type:Object,default:()=>({date:!1,todo_type_id:!1})}},emits:["update","cancelClick"],setup(i,{emit:V}){const s=i,o=v(),b=v(!1),k=v(),n=it(),g=mt(),f=nt(),h=pt(),u=v(null),S=v(""),x=v(null),I=V,y=v({title:"",date:s.date||"",todo_type:"task",todo_type_id:""});async function M(){try{o.value="submitting";const D={...y.value};if(D.todo_type_id||(delete D.todo_type_id,delete D.todo_type),u.value)D.todo_project_id=u.value;else if(S.value){const l=await g.createProject({title:S.value,department_id:x.value});D.todo_project_id=l.id}await n.createTodo(D,{returnWith:s.userRole!=="employee"?"user,department,company":""}),I("update")}finally{o.value=""}}return Y(()=>({date:s.date,todo_type:s.todoType,todo_type_id:s.todoTypeId}),D=>{y.value={...y.value,...D}},{immediate:!0}),G(async()=>{var D;await tt(),(D=k.value)==null||D.focus(),f.isAdminMood&&await h.fetchMyCompanies({with:"departments"}),await g.fetchProjects()}),(D,l)=>(r(),w("div",{onClick:l[9]||(l[9]=C=>b.value=!1)},[p(n).loading?(r(),B(st,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:L(()=>l[10]||(l[10]=[j(" Loading... ")])),_:1,__:[10]})):_("",!0),R(rt,{onSubmit:M,onClickCancel:l[8]||(l[8]=C=>I("cancelClick")),isSubmitting:o.value=="submitting",error:p(n).error,class:"rounded-md relative"},{default:L(()=>{var C,a,e;return[l[16]||(l[16]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),t("div",At,[t("div",Nt,[l[11]||(l[11]=t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Title",-1)),X(t("input",{ref_key:"titleRef",ref:k,"onUpdate:modelValue":l[0]||(l[0]=m=>y.value.title=m),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Z,y.value.title]])]),t("div",Bt,[l[12]||(l[12]=t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Date",-1)),X(t("input",{readonly:(C=i.readonlyValues)==null?void 0:C.date,"onUpdate:modelValue":l[1]||(l[1]=m=>y.value.date=m),type:"date",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,8,Ft),[[Z,y.value.date]])]),p(f).isAdminMood?(r(),B(Tt,{key:0,modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=m=>x.value=m),companies:((a=p(h))==null?void 0:a.myCompanies)||[],class:"mb-4"},{label:L(()=>l[13]||(l[13]=[t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},[j(" Project Department "),t("span",{class:"text-gray-500"},"(Optional - for new project)")],-1)])),_:1},8,["modelValue","companies"])):_("",!0),t("div",zt,[l[14]||(l[14]=t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},[j(" Issue/Website/Project "),t("span",{class:"text-gray-500"},"(Optional)")],-1)),R(yt,{modelValue:u.value,"onUpdate:modelValue":l[3]||(l[3]=m=>u.value=m),"onUpdate:inputValue":l[4]||(l[4]=m=>S.value=m),options:p(g).projects,label:"title",value:"id",placeholder:"Select or type project..."},null,8,["modelValue","options"])]),t("div",qt,[l[15]||(l[15]=t("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Task (optional)",-1)),R(vt,{show:b.value,"onUpdate:show":l[5]||(l[5]=m=>b.value=m),todoType:y.value.todo_type,"onUpdate:todoType":l[6]||(l[6]=m=>y.value.todo_type=m),todoTypeId:y.value.todo_type_id,"onUpdate:todoTypeId":l[7]||(l[7]=m=>y.value.todo_type_id=m),readonly:(e=i.readonlyValues)==null?void 0:e.todo_type_id},null,8,["show","todoType","todoTypeId","readonly"])])])]}),_:1,__:[16]},8,["isSubmitting","error"])]))}},Gt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Wt={class:"mb-4 text-md"},Kt={class:"font-semibold"},Qt={class:"mb-2"},Yt={__name:"TodoDateAddForm",props:{date:{type:[String,Number],default:J(new Date)},todoId:{type:[String,Number],required:!0},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(i,{emit:V}){const s=i,o=v(),b=v(!1),k=v(),n=it(),g=ft(),f=V,h=v({date:s.date||"",todo_id:s.todoId});async function u(){try{o.value="submitting",await g.createTodoDate(h.value),f("update")}finally{o.value=""}}return G(async()=>{var S;await tt(),await n.fetchTodo(s.todoId),(S=k.value)==null||S.focus()}),(S,x)=>(r(),w("div",{onClick:x[2]||(x[2]=I=>b.value=!1)},[p(n).loading?(r(),B(st,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:L(()=>x[3]||(x[3]=[j(" Loading... ")])),_:1,__:[3]})):_("",!0),R(rt,{onSubmit:u,onClickCancel:x[1]||(x[1]=I=>f("cancelClick")),isSubmitting:o.value=="submitting",error:p(g).error,class:"rounded-md relative"},{default:L(()=>{var I;return[x[6]||(x[6]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Carry Todo To Date")],-1)),t("div",Gt,[t("div",Wt,[x[4]||(x[4]=j(" TODO: ")),t("span",Kt,E((I=p(n).todo)==null?void 0:I.title),1)]),t("div",Qt,[x[5]||(x[5]=t("span",{class:"font-semibold"}," Date ",-1)),X(t("input",{"onUpdate:modelValue":x[0]||(x[0]=y=>h.value.date=y),type:"date",multiple:"",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[Z,h.value.date]])])])]}),_:1,__:[6]},8,["isSubmitting","error"])]))}},Jt={key:0,class:"mb-4 text-red-500 font-medium"},Xt={key:1,class:"mb-4 text-red-500 font-medium"},Zt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},te={class:"mb-5"},ee={class:"relative group"},oe={class:"mb-5"},le={class:"mb-8"},se={__name:"TodoEditForm",props:{date:{type:String,default:J(new Date)},todo:{type:Object,default:()=>({})}},emits:["update","cancelClick"],setup(i,{emit:V}){var K;const s=i,o=v(),b=v(!1),k=v(),n=it(),g=mt(),f=nt(),h=pt(),u=v(null),S=v(""),x=v(null),I=V,y=v({title:"",todo_type:"task",todo_type_id:"",status:"PENDING"}),M=v({id:null,repeat_type:"daily",start_date:((K=s.todo)==null?void 0:K.date)||s.date||J(new Date),end_date:null,weekly_day:null,monthly_mode:null,monthly_value:null,monthly_week:null,yearly_month:null,yearly_day:null}),D=v(!1),l=v({});async function C(){var T,d,c,$,Q;await n.fetchTodo((T=s.todo)==null?void 0:T.id),y.value.title=(d=n.todo)==null?void 0:d.title,y.value.todo_type_id=(c=n.todo)==null?void 0:c.todoable_id,y.value.status=(($=n.todo)==null?void 0:$.status)||"PENDING",u.value=((Q=n.todo)==null?void 0:Q.todo_project_id)||null}const a=v(null);async function e(){var T,d;try{const{data:c}=await St(s.todo.id),$=c==null?void 0:c.setting;$?(D.value=!0,a.value=$.id,M.value={repeat_type:$.repeat_type??"daily",start_date:$.start_date??M.value.start_date,end_date:$.end_date??null,weekly_day:$.weekly_day??null,monthly_mode:$.monthly_mode??null,monthly_value:$.monthly_value??null,monthly_week:$.monthly_week??null,yearly_month:$.yearly_month??null,yearly_day:$.yearly_day??null}):M.value.id=null}catch(c){A.value=(d=(T=c==null?void 0:c.response)==null?void 0:T.data)==null?void 0:d.message,console.error("Load setting failed:",(c==null?void 0:c.message)||c)}}async function m(){const T={title:y.value.title,todo_type:y.value.todo_type,todo_type_id:y.value.todo_type_id,status:y.value.status};if(u.value)T.todo_project_id=u.value;else if(S.value){const d=await g.createProject({title:S.value,department_id:x.value});T.todo_project_id=d.id}await n.updateTodo(s.todo.id,T)}async function O(){var T,d;if(!D.value)a.value&&await Ct(s.todo.id,a.value);else{const c=(T=l.value)!=null&&T.buildPayload?l.value.buildPayload():{...M.value};c.start_date||(c.start_date=((d=s.todo)==null?void 0:d.date)||s.date||J(new Date)),await Dt(s.todo.id,c)}}const U=T=>{var d,c;return((c=(d=T==null?void 0:T.response)==null?void 0:d.data)==null?void 0:c.message)||(T==null?void 0:T.message)||"Something went wrong"};async function F(){const[T,d]=await Promise.allSettled([m(),O()]),c=T.status==="fulfilled",$=d.status==="fulfilled";$||(A.value=U(d.reason)),c&&$&&I("update")}const P=v(!1),A=v(!1);async function et(){var T;f.isAdminMood&&await h.fetchMyCompanies({with:"departments"}),g.fetchProjects(),await C(),P.value=!0,await e(),P.value=!1,await tt(),(T=k.value)==null||T.focus()}const W=q(()=>n.loading||P.value);return G(()=>{et()}),(T,d)=>(r(),w("div",{class:"relative",onClick:d[7]||(d[7]=c=>b.value=!1)},[W.value?(r(),B(st,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:L(()=>d[8]||(d[8]=[j(" Loading... ")])),_:1,__:[8]})):_("",!0),R(rt,{onSubmit:F,onClickCancel:d[6]||(d[6]=c=>I("cancelClick")),isSubmitting:o.value=="submitting",isLoading:W.value,id:"todoEditForm"},{error:L(()=>[t("div",null,[p(n).error?(r(),w("div",Jt,E(p(n).error),1)):_("",!0),A.value?(r(),w("div",Xt,E(A.value),1)):_("",!0)])]),default:L(()=>[d[14]||(d[14]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),t("div",Zt,[d[13]||(d[13]=t("div",{class:"text-xs text-red-800 mb-6"},[t("strong",null,"Tips:"),j(" If you change the todo, it will change to all the concurrent dates ")],-1)),t("div",te,[d[10]||(d[10]=t("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"}," Title ",-1)),t("div",ee,[X(t("input",{ref_key:"titleRef",ref:k,"onUpdate:modelValue":d[0]||(d[0]=c=>y.value.title=c),required:"",placeholder:"Enter todo title",class:"w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-4 focus:ring-sky-500/10 focus:border-sky-400 outline-none transition-all duration-200 font-medium text-slate-700"},null,512),[[Z,y.value.title]]),d[9]||(d[9]=t("div",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-sky-500 transition-colors"},[t("i",{class:"fas fa-edit text-sm"})],-1))])]),t("div",oe,[d[11]||(d[11]=t("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"},[j(" Issue/Website/Project "),t("span",{class:"text-[10px] lowercase font-normal"},"(Optional)")],-1)),R(yt,{modelValue:u.value,"onUpdate:modelValue":d[1]||(d[1]=c=>u.value=c),"onUpdate:inputValue":d[2]||(d[2]=c=>S.value=c),options:p(g).projects,value:"id",label:"title",placeholder:"Select or type project..."},null,8,["modelValue","options"])]),t("div",le,[d[12]||(d[12]=t("label",{class:"block text-slate-500 font-bold text-[11px] uppercase tracking-wider mb-1.5 ml-1"},[j(" Task ID "),t("span",{class:"text-[10px] lowercase font-normal"},"(Optional)")],-1)),R(vt,{show:b.value,"onUpdate:show":d[3]||(d[3]=c=>b.value=c),todoType:y.value.todo_type,"onUpdate:todoType":d[4]||(d[4]=c=>y.value.todo_type=c),todoTypeId:y.value.todo_type_id,"onUpdate:todoTypeId":d[5]||(d[5]=c=>y.value.todo_type_id=c)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[14]},8,["isSubmitting","isLoading"])]))}},ae={class:"relative"},de={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},ne={class:"mb-4 flex justify-between items-end"},ie={class:"text-base font-semibold"},re={key:0,class:"text-xs text-slate-400 mt-1"},ue={class:"mb-4 flex justify-between items-center group"},ce={class:"text-sm font-semibold text-slate-700"},pe={key:0,class:"mt-1 flex items-center gap-2 mb-4"},me={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},fe={class:"flex items-center justify-between mb-4"},ye={class:"flex items-center gap-2 px-3 py-1.5 bg-white rounded-full shadow-sm border border-slate-100"},ve={class:"text-xs font-bold text-slate-700 tracking-wide"},be={class:"mt-6 p-4 rounded-xl border border-slate-200 border-dashed"},ge={key:0},xe={class:"grid grid-cols-2 gap-3"},we={key:1,class:"py-4 text-center text-emerald-600 bg-emerald-50 rounded-lg border border-emerald-100"},ke={class:"px-4 mb-4"},Te={class:"mt-4"},_e={class:"text-sm font-bold text-slate-600 uppercase tracking-widest"},he={class:"text-lg text-slate-500"},Se={key:0,class:"mt-0.5 max-h-40 overflow-y-auto border rounded p-2 bg-white"},Ce={key:0,class:"text-xs text-slate-400 py-2"},De=["onClick"],$e={class:"text-xs text-slate-400"},Ie={key:0,class:"text-xs text-emerald-600 font-bold"},je=["onClick"],Ve={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},Ee={key:0,class:"ml-auto flex items-center gap-2"},Re={__name:"TodoShow",props:{todoDate:{type:[Object,Number],default:null}},emits:["cancelClick","clickEdit","update","clickAddTodoDate"],setup(i,{emit:V}){const s=i,o=ft(),b=nt(),k=V,n=v(null),g=v(!1),f=q(()=>{var a;return s.todoDate?typeof s.todoDate=="number"?s.todoDate:((a=s.todoDate)==null?void 0:a.id)||null:null});async function h(a){var m,O,U,F;const e=a||f.value;if(e){if(g.value&&n.value===e){console.log("fetchTodo: already fetching",e);return}g.value=!0,n.value=e,console.log("fetchTodo:start",e,new Date().toISOString());try{await o.fetchTodoDate(e);const P=((m=o.todo_date)==null?void 0:m.todo_id)||((U=(O=o.todo_date)==null?void 0:O.todo)==null?void 0:U.id);if(P)try{const A=await $t(P);x.value=((F=A.data)==null?void 0:F.todo_dates)||[]}catch(A){console.error("getTodoHistories failed",A)}}catch(P){console.error("fetchTodo failed",P)}finally{g.value=!1,console.log("fetchTodo:end",e,new Date().toISOString())}}}const u=v(!1),S=q(()=>{var e,m,O,U,F;const a=(e=o.todo_date)==null?void 0:e.todo;return((m=a==null?void 0:a.project)==null?void 0:m.name)||((O=a==null?void 0:a.project)==null?void 0:O.title)||((U=a==null?void 0:a.project)==null?void 0:U.display_name)||((F=a==null?void 0:a.project)==null?void 0:F.project_name)||""}),x=v([]),I=q(()=>[...x.value||[]].sort((e,m)=>{const O=e!=null&&e.date?new Date(e.date).getTime():0;return(m!=null&&m.date?new Date(m.date).getTime():0)-O}));async function y(a){a&&await o.fetchTodoDate(a)}const M=q(()=>{var a,e;return(a=o.todo_date)!=null&&a.date?new Date((e=o.todo_date)==null?void 0:e.date):null}),D=q(()=>{var a,e,m;return((e=(a=o.todo_date)==null?void 0:a.user)==null?void 0:e.id)===((m=b.user)==null?void 0:m.id)});async function l(a){var e;confirm(`Are your sure want to delete todo
'${(e=o.todo_date)==null?void 0:e.title}'`)&&(await o.deleteTodoDate(a.id),k("update"))}async function C(a,e){var m;confirm(`Are your sure want to compete todo
'${(m=o.todo_date)==null?void 0:m.title}'`)&&(await o.updateStatus(a.id,e),k("update"))}return G(async()=>{const a=f.value;a&&await h(a)}),(a,e)=>{var m,O,U,F,P,A,et,W,K,T,d,c,$,Q,ut;return r(),w("div",ae,[p(o).loading?(r(),B(st,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:L(()=>e[9]||(e[9]=[j(" Loading... ")])),_:1,__:[9]})):_("",!0),t("div",null,[e[22]||(e[22]=t("div",{class:"border-b py-2 px-4"},[t("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),t("div",de,[t("div",ne,[t("div",null,[e[10]||(e[10]=t("div",{class:"text-xs text-gray-500"},"Todo",-1)),t("div",ie,E((m=p(o).todo_date)==null?void 0:m.title),1),S.value?(r(),w("div",re,E(S.value),1)):_("",!0)]),t("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white bg-none",onClick:e[0]||(e[0]=N(z=>{var H;return k("clickEdit",(H=p(o).todo_date)==null?void 0:H.todo)},["prevent","stop"]))},e[11]||(e[11]=[t("i",{class:"fas fa-pen"},null,-1),j(" Edit Todo ")]))]),e[21]||(e[21]=t("hr",{class:"mb-4"},null,-1)),t("div",ue,[t("div",null,[e[12]||(e[12]=t("div",{class:"font-semibold text-[10px] text-slate-400 uppercase tracking-wider mb-0.5"}," Date ",-1)),t("div",ce,E(p(kt)(M.value,{weekDay:"long"})),1)]),D.value&&!p(o).loading?(r(),w("button",{key:0,class:"btn-2 bg-emerald-500 text-white hover:bg-emerald-700 hover:text-white bg-none",onClick:e[1]||(e[1]=N(z=>{var H,ot;return k("clickAddTodoDate",(H=p(o).todo_date)==null?void 0:H.todo_id,(ot=p(o).todo_date)==null?void 0:ot.date)},["prevent","stop"]))},e[13]||(e[13]=[t("i",{class:"fas fa-calendar-plus mr-1"},null,-1),j(" Add to another date ")]))):_("",!0)]),(O=p(o).todo_date)!=null&&O.user?(r(),w("div",pe,[R(It,{user:p(o).todo_date.user,"avatar-size":"xsmall"},null,8,["user"]),t("div",me,E((P=(F=(U=p(o).todo_date)==null?void 0:U.user)==null?void 0:F.department)==null?void 0:P.name),1)])):_("",!0),t("div",fe,[e[14]||(e[14]=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"}," Current Status ",-1)),t("div",ye,[(A=p(o))!=null&&A.todo_date?(r(),B(jt,{key:0,todoDate:(et=p(o))==null?void 0:et.todo_date},null,8,["todoDate"])):_("",!0),t("span",ve,E((W=p(o).todo_date)==null?void 0:W.status),1)])]),t("div",be,[D.value&&!p(o).loading&&((K=p(o).todo_date)==null?void 0:K.status)!=="COMPLETED"?(r(),w("div",ge,[e[19]||(e[19]=t("div",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 text-center"}," Quick Transitions ",-1)),t("div",xe,[((T=p(o).todo_date)==null?void 0:T.status)!=="WORKING"?(r(),w("button",{key:0,class:"btn-2 py-2.5 from-amber-600 to-amber-400 text-white hover:scale-[1.02] active:scale-[0.98] shadow-md transition-all duration-200",onClick:e[2]||(e[2]=N(()=>C(p(o).todo_date,"WORKING"),["prevent","stop"]))},e[15]||(e[15]=[t("i",{class:"fas fa-sync-alt mr-1"},null,-1),j(" Working ")]))):_("",!0),((d=p(o).todo_date)==null?void 0:d.status)!=="COMPLETED"&&((c=p(o).todo_date)==null?void 0:c.status)!=="BACK_LOG"?(r(),w("button",{key:1,class:"btn-2 py-2.5 from-emerald-600 to-emerald-400 text-white hover:scale-[1.02] active:scale-[0.98] shadow-md transition-all duration-200",onClick:e[3]||(e[3]=N(()=>C(p(o).todo_date,"COMPLETED"),["prevent","stop"]))},e[16]||(e[16]=[t("i",{class:"fas fa-check-double mr-1"},null,-1),j(" Complete ")]))):_("",!0),(($=p(o).todo_date)==null?void 0:$.status)!=="DEPENDANT"?(r(),w("button",{key:2,class:"btn-4 py-2 bg-white border border-slate-200 text-slate-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 hover:scale-[1.02] active:scale-[0.98] shadow-sm transition-all duration-200",onClick:e[4]||(e[4]=N(()=>C(p(o).todo_date,"DEPENDANT"),["prevent","stop"]))},e[17]||(e[17]=[t("i",{class:"fas fa-pause-circle mr-1"},null,-1),j(" Dependant / Pause ")]))):_("",!0),((Q=p(o).todo_date)==null?void 0:Q.status)!=="BACK_LOG"?(r(),w("button",{key:3,class:"btn-4 py-2 bg-white border border-slate-200 text-slate-600 hover:bg-purple-50 hover:text-purple-600 hover:border-purple-200 hover:scale-[1.02] active:scale-[0.98] shadow-sm transition-all duration-200",onClick:e[5]||(e[5]=N(()=>C(p(o).todo_date,"BACK_LOG"),["prevent","stop"]))},e[18]||(e[18]=[t("i",{class:"fas fa-history mr-1"},null,-1),j(" Backlog ")]))):_("",!0)])])):((ut=p(o).todo_date)==null?void 0:ut.status)==="COMPLETED"?(r(),w("div",we,e[20]||(e[20]=[t("i",{class:"fas fa-check-circle text-2xl mb-1"},null,-1),t("div",{class:"text-xs font-bold uppercase tracking-wider"},"This Todo is Completed",-1)]))):_("",!0)])]),e[23]||(e[23]=t("hr",{class:"mx-4"},null,-1)),t("div",ke,[t("div",Te,[t("h2",{class:"w-full text-left flex items-center justify-between cursor-pointer py-2 bg-white rounded-md",onClick:e[6]||(e[6]=N(z=>u.value=!u.value,["prevent"]))},[t("div",_e," Todo history ("+E(I.value.length)+") ",1),t("div",he,E(u.value?"▾":"▸"),1)]),u.value?(r(),w("div",Se,[I.value.length===0?(r(),w("div",Ce," No history ")):_("",!0),(r(!0),w(dt,null,ct(I.value,z=>{var H;return r(),w("div",{key:z.id,class:"flex items-center justify-between py-2 px-2 hover:bg-slate-50 border-b last:border-b-0"},[t("div",null,[t("a",{href:"#",onClick:N(ot=>y(z.id),["prevent"]),class:"text-sm font-semibold text-sky-600"},E(z.date),9,De),t("div",$e,E(z.status),1)]),t("div",null,[z.id===((H=p(o).todo_date)==null?void 0:H.id)?(r(),w("span",Ie,"Current")):(r(),w("button",{key:1,class:"btn-2 py-1 px-2 text-xs",onClick:N(ot=>y(z.id),["prevent"])}," Show ",8,je))])])}),128))])):_("",!0)])])]),t("div",Ve,[t("button",{type:"button",onClick:e[7]||(e[7]=z=>k("cancelClick")),class:"btn-3"},"Cancel"),D.value&&!p(o).loading?(r(),w("div",Ee,[t("button",{class:"btn-2-red",onClick:e[8]||(e[8]=N(()=>l(p(o).todo_date),["prevent","stop"]))},e[24]||(e[24]=[t("i",{class:"fas fa-trash-alt"},null,-1),j(" Delete ")]))])):_("",!0)])])}}},We={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","todoUpdate","todoDateUpdate","clickEdit","clickDelete","clickChangeStatus","clickAddTodoDate"],setup(i,{emit:V}){const s=V;function o(){s("todoUpdate")}function b(){s("todoDateUpdate")}return(k,n)=>(r(),w(dt,null,[i.todoModal.action=="add"?(r(),B(lt,{key:0},{default:L(()=>{var g,f,h,u;return[R(Ht,{onCancelClick:n[0]||(n[0]=S=>s("cancelClick")),onUpdate:o,date:(g=i.todoModal)==null?void 0:g.date,todoType:(f=i.todoModal)==null?void 0:f.todoType,todoTypeId:(h=i.todoModal)==null?void 0:h.todoTypeId,readonlyValues:((u=i.todoModal)==null?void 0:u.formReadonlyValues)||{},userRole:i.userRole},null,8,["date","todoType","todoTypeId","readonlyValues","userRole"])]}),_:1})):_("",!0),i.todoModal.action=="addDate"?(r(),B(lt,{key:1},{default:L(()=>{var g,f,h;return[R(Yt,{onCancelClick:n[1]||(n[1]=u=>s("cancelClick")),onUpdate:b,date:(g=i.todoModal)==null?void 0:g.date,todoId:(f=i.todoModal)==null?void 0:f.todo_id,userRole:i.userRole,readonlyValues:((h=i.todoModal)==null?void 0:h.formReadonlyValues)||{}},null,8,["date","todoId","userRole","readonlyValues"])]}),_:1})):_("",!0),i.todoModal.action=="edit"?(r(),B(lt,{key:2},{default:L(()=>{var g,f;return[R(se,{onCancelClick:n[2]||(n[2]=h=>s("cancelClick")),onUpdate:o,todo:(g=i.todoModal)==null?void 0:g.todo,userRole:i.userRole,readonlyValues:((f=i.todoModal)==null?void 0:f.formReadonlyValues)||{}},null,8,["todo","userRole","readonlyValues"])]}),_:1})):_("",!0),i.todoModal.action=="show"?(r(),B(lt,{key:3},{default:L(()=>{var g;return[R(Re,{onCancelClick:n[3]||(n[3]=f=>s("cancelClick")),onUpdate:b,onClickEdit:n[4]||(n[4]=f=>s("clickEdit",f)),onClickAddTodoDate:n[5]||(n[5]=(...f)=>s("clickAddTodoDate",...f)),onClickDelete:n[6]||(n[6]=f=>s("clickDelete",f)),onClickChangeStatus:n[7]||(n[7]=(f,h)=>s("clickChangeStatus",f,h)),todoDate:(g=i.todoModal)==null?void 0:g.todo,userRole:i.userRole},null,8,["todoDate","userRole"])]}),_:1})):_("",!0)],64))}};export{We as _};
