import{N as X,r as B,x as V,O as P,c as f,o as m,a as t,g as E,F as z,t as p,j as W,M as Y,y as O,q as J,h as L,B as H,v as Q,k as I,n as Z,b as ee,e as te,A as se,f as ae,l as ne}from"./index-apDR9zf5.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G=X("checklist",()=>{const g=B(!1),b=B(null),o=B(null),C=e=>typeof e=="boolean"?e:typeof e=="number"?e===1:typeof e=="string"?e==="1"||e.toLowerCase()==="true":!!e,w=e=>{var r,s;return(e==null?void 0:e.label)??((r=e==null?void 0:e.template_item)==null?void 0:r.label)??((s=e==null?void 0:e.templateItem)==null?void 0:s.label)??""},h=e=>{var r,s;return C((e==null?void 0:e.required)??((r=e==null?void 0:e.template_item)==null?void 0:r.required)??((s=e==null?void 0:e.templateItem)==null?void 0:s.required))},_=e=>{var r,s;return Number((e==null?void 0:e.order_no)??((r=e==null?void 0:e.template_item)==null?void 0:r.order_no)??((s=e==null?void 0:e.templateItem)==null?void 0:s.order_no)??0)};function x(e){return{...e,_label:w(e),_required:h(e),_order:_(e)}}function $(e){if(!e)return null;const r=Array.isArray(e.items)?e.items.map(x):[];return r.sort((s,n)=>s._order-n._order),{...e,items:r}}const M=V(()=>{var e;return((e=o.value)==null?void 0:e.items)??[]}),F=V(()=>M.value.filter(e=>e._required)),S=V(()=>{const e=F.value.length;if(!e)return 100;const r=F.value.filter(s=>s.status==="done").length;return Math.round(r/e*100)}),j=e=>(e==null?void 0:e._label)??w(e),l=e=>(e==null?void 0:e._required)??h(e);async function i(e,r){g.value=!0,b.value=null;try{const{data:s}=await P.post(`/users/${Number(e)}/checklists`,{template_id:Number(r)});o.value=$(s.data)}catch(s){b.value=s,console.error("ensureChecklist failed:",s)}finally{g.value=!1}}async function a(e,r){g.value=!0,b.value=null;try{const{data:s}=await P.get(`/users/${Number(e)}/checklists/${Number(r)}`);o.value=$(s.data)}catch(s){b.value=s,console.error("fetchChecklist failed:",s)}finally{g.value=!1}}async function y(e,r){var v;const s=((v=o.value)==null?void 0:v.items)||[],n=s.findIndex(k=>k.id===e.id),d=n>=0?s[n]:e,c={...d};Object.assign(d,r);try{const{data:k}=await P.patch(`/checklist-items/${d.id}`,r),q=x({...d,...(k==null?void 0:k.data)||{}});s[n]=q}catch(k){throw n>=0&&(s[n]=x(c)),k}}async function U(e,{deleteDocument:r=!0,force:s=!1}={}){var q,D,R;console.log("detachAttachment",e,{deleteDocument:r,force:s});const n=((q=o.value)==null?void 0:q.items)||[],d=typeof e=="object"?e==null?void 0:e.id:e;if(!d)return{ok:!0,data:null};const c=n.findIndex(N=>N.id===Number(d)),v=c>=0?n[c]:{id:Number(d)};if(!(v!=null&&v.attachment_id)&&!(v!=null&&v.attachment))return{ok:!0,data:v};const k=c>=0?{...n[c]}:null;c>=0&&(n[c]={...n[c],attachment_id:null,attachment:null});try{const{data:N}=await P.patch(`/checklist-items/${d}/detach-attachment`,{delete_document:!!r,force:!!s}),T={...(N==null?void 0:N.data)||{}};return c>=0&&(n[c]={...n[c],...T}),(D=window==null?void 0:window.notify)!=null&&D.success&&window.notify.success("Attachment removed"),{ok:!0,data:T}}catch(N){throw c>=0&&k&&(n[c]=k),(R=window==null?void 0:window.notify)!=null&&R.error&&window.notify.error("Failed to remove attachment"),N}}async function A(e){const r=new FormData;r.append("file",e);const{data:s}=await P.post("/documents",r,{headers:{"Content-Type":"multipart/form-data"}});return s.data}async function u(){g.value=!1,b.value=null,o.value=null}return{loading:g,error:b,checklist:o,items:M,requiredItems:F,completion:S,labelOf:j,requiredOf:l,ensureChecklist:i,fetchChecklist:a,saveItem:y,uploadDocument:A,reset:u,detachAttachment:U}}),le={class:"min-w-0"},re={class:"flex items-center gap-2 min-w-0"},de=["href","title"],ie={class:"inline-flex h-4 w-4 items-center justify-center"},ce=["src"],ue={key:1,class:"h-4 w-4 text-gray-500",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},pe={class:"truncate"},me=["disabled"],_e=["disabled"],fe=["disabled"],he=["disabled"],ve={key:2,class:"h-4 w-4 animate-spin text-gray-500",viewBox:"0 0 24 24",fill:"none","aria-label":"Uploading"},ye={key:0,class:"mt-1 h-[3px] w-full overflow-hidden rounded bg-gray-200"},be={key:1,class:"mt-1 truncate text-[11px] text-rose-600",role:"alert"},K=10*1024*1024,we=".jpg,.jpeg,.png,.pdf,.doc,.docx",ge={__name:"AttachmentUploader",props:{itemId:{type:[Number,String],required:!0},modelValue:{type:[Number,null],default:null},current:{type:Object,default:null},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","update:current","uploaded","detached"],setup(g,{emit:b}){const o=g,C=b,w=G(),h=B(null),_=B(!1),x=B(""),$=B(0),M=B(!1),F=["image/jpeg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],S=V(()=>{var s,n;return!!((s=o.current)!=null&&s.url||(n=o.current)!=null&&n.path)}),j=V(()=>{var s,n;return((s=o.current)==null?void 0:s.url)||((n=o.current)==null?void 0:n.path)||null}),l=V(()=>{var s,n;return((s=o.current)==null?void 0:s.name)||((n=o.current)==null?void 0:n.original_name)||a(j.value)||"Document"}),i=V(()=>{var s;return(((s=o.current)==null?void 0:s.mime)||"").startsWith("image/")});function a(s){if(!s)return"";try{return decodeURIComponent(s.split("/").pop().split("?")[0])}catch{return""}}function y(s){const n=["B","KB","MB","GB"];let d=0,c=s;for(;c>=1024&&d<n.length-1;)c/=1024,d++;return`${c.toFixed(d?1:0)} ${n[d]}`}function U(s){return s?s.size>K?`Max ${y(K)}`:F.includes(s.type)?"":"Unsupported type":"No file selected"}async function A(s){var d,c;const n=U(s);if(n){x.value=n;return}if(!o.disabled){_.value=!0,x.value="",$.value=0,M.value=!1;try{const v=await w.uploadDocument(s,{onProgress:k=>{M.value=!0,$.value=k}});C("update:modelValue",v.id),C("uploaded",v),(d=window==null?void 0:window.notify)!=null&&d.success&&window.notify.success("File uploaded")}catch(v){console.error(v),x.value="Upload failed",(c=window==null?void 0:window.notify)!=null&&c.error&&window.notify.error("Upload failed")}finally{_.value=!1,$.value=0,M.value=!1,h.value&&(h.value.value="")}}}function u(s){var d;const n=(d=s.target.files)==null?void 0:d[0];n&&A(n)}function e(){var s;_.value||o.disabled||(s=h.value)==null||s.click()}const r=async()=>{var s,n;if(!(_.value||o.disabled)){_.value=!0,x.value="";try{const d=await w.detachAttachment(o.itemId,{deleteDocument:!0});C("update:modelValue",null),C("update:current",null),C("detached",(d==null?void 0:d.data)||null),(s=window==null?void 0:window.notify)!=null&&s.success&&window.notify.success("Attachment removed")}catch(d){console.error(d),x.value="Failed to remove",(n=window==null?void 0:window.notify)!=null&&n.error&&window.notify.error("Failed to remove")}finally{_.value=!1}}};return(s,n)=>(m(),f("div",le,[t("div",re,[S.value?(m(),f(z,{key:0},[t("a",{href:j.value,target:"_blank",class:"group inline-flex max-w-[12rem] items-center gap-1 truncate rounded-full border px-2 py-0.5 text-xs hover:bg-gray-50",title:l.value},[t("span",ie,[i.value?(m(),f("img",{key:0,src:j.value,alt:"",class:"h-4 w-4 rounded object-cover"},null,8,ce)):(m(),f("svg",ue,n[0]||(n[0]=[t("path",{d:"M14 2H6a2 2 0 00-2 2v16c0 1.1.9 2 2 2h12a2 2 0 002-2V8l-6-6z",stroke:"currentColor","stroke-width":"1.5"},null,-1),t("path",{d:"M14 2v6h6",stroke:"currentColor","stroke-width":"1.5"},null,-1)])))]),t("span",pe,p(l.value),1)],8,de),t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded border text-gray-700 hover:bg-gray-50 disabled:opacity-60",disabled:_.value||g.disabled,title:"Replace",onClick:e},n[1]||(n[1]=[t("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[t("path",{d:"M4 12a8 8 0 118 8",stroke:"currentColor","stroke-width":"1.5"}),t("path",{d:"M12 8v8m0-8l-3 3m3-3l3 3",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})],-1)]),8,me),t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded border border-rose-200 text-rose-700 hover:bg-rose-50 disabled:opacity-60",disabled:_.value||g.disabled,title:"Remove",onClick:r},n[2]||(n[2]=[t("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[t("path",{d:"M6 6l12 12M18 6L6 18",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})],-1)]),8,_e)],64)):(m(),f("button",{key:1,type:"button",class:"inline-flex items-center gap-1 rounded-md bg-gray-900 px-2.5 py-1 text-xs text-white hover:bg-gray-800 disabled:opacity-60",disabled:_.value||g.disabled,onClick:e,title:"Upload file"},n[3]||(n[3]=[t("svg",{class:"h-3.5 w-3.5",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true"},[t("path",{d:"M12 16V4m0 12l-3-3m3 3l3-3M6 20h12",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round"})],-1),W(" Upload ")]),8,fe)),t("input",{ref_key:"inputRef",ref:h,type:"file",class:"hidden",accept:we,onChange:u,disabled:_.value||g.disabled},null,40,he),_.value?(m(),f("svg",ve,n[4]||(n[4]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3"},null,-1),t("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8",stroke:"currentColor","stroke-width":"3"},null,-1)]))):E("",!0)]),_.value?(m(),f("div",ye,[t("div",{class:"h-[3px] bg-blue-500 transition-[width]",style:Y({width:(M.value?$.value:60)+"%"})},null,4)])):E("",!0),x.value?(m(),f("p",be,p(x.value),1)):E("",!0)]))}},xe={class:"w-full overflow-x-auto bg-white"},ke={class:"min-w-full text-sm"},Ce={class:"p-3"},$e={class:"p-3 font-medium"},Ne={class:"p-3"},Ie={class:"p-3"},Me=["onUpdate:modelValue","onChange","disabled"],Ue=["value"],Ve={class:"p-3"},Be=["onUpdate:modelValue","onInput","disabled"],Fe={class:"p-3"},je={class:"p-3"},Ae={class:"p-3"},Se={__name:"ChecklistTable",props:{items:{type:Array,required:!0}},setup(g){const b=g,o=G(),C=[{value:"pending",label:"Pending"},{value:"done",label:"Done ✓"},{value:"waived",label:"Waived"},{value:"rejected",label:"Rejected"}],w=B(Object.create(null));function h(l,i){w.value[l]=!!i,w.value={...w.value}}function _(l,i=600){let a;return(...y)=>{clearTimeout(a),a=setTimeout(()=>l(...y),i)}}function x(l){return o.labelOf(l)}function $(l){return o.requiredOf(l)}const M=_(async l=>{var i,a;try{h(l.id,!0),await o.saveItem(l,{comment:l.comment||null}),(i=window==null?void 0:window.notify)!=null&&i.success&&window.notify.success("Note saved")}catch{(a=window==null?void 0:window.notify)!=null&&a.error&&window.notify.error("Failed to save note")}finally{h(l.id,!1)}},600);async function F(l){var i,a;try{h(l.id,!0),await o.saveItem(l,{status:l.status}),(i=window==null?void 0:window.notify)!=null&&i.success&&window.notify.success("Status updated")}catch{(a=window==null?void 0:window.notify)!=null&&a.error&&window.notify.error("Failed to update status")}finally{h(l.id,!1)}}async function S(l,i){var a,y;try{h(l.id,!0),console.log("linking attachment",l,i),await o.saveItem(l,{attachment_id:i.id}),l.attachment={...i},(a=window==null?void 0:window.notify)!=null&&a.success&&window.notify.success("Attachment linked")}catch{(y=window==null?void 0:window.notify)!=null&&y.error&&window.notify.error("Failed to link file")}finally{h(l.id,!1)}}function j(l){if(!l)return"-";try{return new Date(l).toLocaleString()}catch{return String(l)}}return(l,i)=>(m(),f("div",xe,[t("table",ke,[i[0]||(i[0]=t("thead",{class:"sticky top-0 bg-gray-100 backdrop-blur"},[t("tr",{class:"text-left border-b"},[t("th",{class:"p-3 w-10"},"#"),t("th",{class:"p-3"},"Item"),t("th",{class:"p-3 w-20"},"Req."),t("th",{class:"p-3 w-40"},"Status"),t("th",{class:"p-3"},"Comment"),t("th",{class:"p-3 w-64"},"Attachment"),t("th",{class:"p-3 w-44"},"Checked By"),t("th",{class:"p-3 w-48"},"Checked At")])],-1)),t("tbody",null,[(m(!0),f(z,null,O(b.items,(a,y)=>{var U,A;return m(),f("tr",{key:a.id,class:"border-b hover:bg-gray-50"},[t("td",Ce,p(y+1),1),t("td",$e,p(x(a)),1),t("td",Ne,[t("span",{class:J(["px-2 py-0.5 rounded text-xs",$(a)?"bg-rose-100 text-rose-700":"bg-gray-100 text-gray-600"])},p($(a)?"Yes":"No"),3)]),t("td",Ie,[L(t("select",{"onUpdate:modelValue":u=>a.status=u,onChange:u=>F(a),class:"border rounded px-2 py-1 w-full focus:outline-none focus:ring disabled:opacity-60",disabled:w.value[a.id]},[(m(),f(z,null,O(C,u=>t("option",{key:u.value,value:u.value},p(u.label),9,Ue)),64))],40,Me),[[H,a.status]])]),t("td",Ve,[L(t("textarea",{"onUpdate:modelValue":u=>a.comment=u,onInput:u=>I(M)(a),placeholder:"Notes…",class:"border rounded p-2 w-60 h-10 resize-y focus:outline-none focus:ring disabled:opacity-60",disabled:w.value[a.id]},null,40,Be),[[Q,a.comment]])]),t("td",Fe,[Z(ge,{"item-id":a.id,modelValue:a.attachment_id,"onUpdate:modelValue":u=>a.attachment_id=u,current:a.attachment,disabled:w.value[a.id],onUploaded:u=>S(a,u),"onUpdate:current":u=>a.attachment=u,onDetached:()=>{a.attachment=null}},null,8,["item-id","modelValue","onUpdate:modelValue","current","disabled","onUploaded","onUpdate:current","onDetached"])]),t("td",je,p(((U=a.checked_by)==null?void 0:U.name)||((A=a.checker)==null?void 0:A.name)||"-"),1),t("td",Ae,p(j(a.checked_at)),1)])}),128))])])]))}},qe={class:"p-6 space-y-6"},De={class:"flex items-start justify-between gap-4 print:hidden"},Re={class:"text-2xl font-semibold"},Te={class:"text-sm text-gray-500"},Pe={class:"flex items-center gap-3"},Ee={class:"w-48 bg-gray-200 rounded-full h-2 overflow-hidden","aria-label":"Completion progress"},ze={class:"text-sm font-medium"},Oe={class:"flex items-center justify-between print:hidden"},Le={class:"text-sm text-gray-600"},Ge={class:"font-medium"},Ke={class:"flex items-center gap-2"},We={key:0,class:"text-gray-500 print:hidden"},Ye={key:1,class:"text-red-600 print:hidden"},He={key:3,class:"text-gray-500 print:hidden"},Xe={key:4,class:"hidden print:block print-a4 bg-white text-gray-900"},Je={class:"text-center"},Qe={class:"text-xl font-bold tracking-wide"},Ze={class:"text-sm"},et={class:"mt-2 text-base font-semibold underline"},tt={class:"text-right text-sm mt-1"},st={class:"mt-3 grid grid-cols-12 gap-2 text-[12px] leading-5"},at={class:"col-span-4"},nt={class:"inline-block min-w-[150px] border-b border-gray-700 ml-2"},ot={class:"col-span-3"},lt={class:"inline-block min-w-[120px] border-b border-gray-700 ml-2"},rt={class:"col-span-4"},dt={class:"inline-block min-w-[110px] border-b border-gray-700 ml-2"},it={class:"mt-3 w-full border border-gray-800 text-[12px] leading-5 print-table"},ct={class:"border border-gray-800 px-2 py-1 text-center"},ut={class:"border border-gray-800 px-2 py-1"},pt={class:"border border-gray-800 px-2 py-1 text-center"},mt={class:"inline-flex items-center justify-center align-middle border border-gray-900 w-4 h-4"},_t={key:0,class:"leading-none text-[12px] font-bold"},ft={__name:"ChecklistPage",setup(g){const b=ee(),o=G(),C=V(()=>Number(b.params.userId)),w=V(()=>b.params.checklistId?Number(b.params.checklistId):null),h=V(()=>b.params.templateId?Number(b.params.templateId):null),_=B(!1);function x(i,a=0,y=100){const U=Number(i||0);return Math.min(Math.max(U,a),y)}const $=V(()=>x(o.completion));async function M(){if(C.value){_.value=!0;try{w.value?await o.fetchChecklist(C.value,w.value):h.value?await o.ensureChecklist(C.value,h.value):await o.reset()}finally{_.value=!1}}}te(M),se([C,w,h],M);const F=B("blank");function S(){window.print()}const j=V(()=>(o.items||[]).slice().sort((i,a)=>(i.order_no??0)-(a.order_no??0))),l={name:"GENESIS PG ORIENTATION CENTRE",address:"230, New Elephant Road, Katabon Mor, Dhaka-1205",copy:"Office Copy"};return(i,a)=>{var y,U,A,u,e,r,s,n,d,c,v,k,q,D,R;return m(),f("div",qe,[t("div",De,[t("div",null,[t("h1",Re,p(((U=(y=I(o).checklist)==null?void 0:y.template)==null?void 0:U.name)||"Checklist"),1),t("p",Te," Type: "+p(((u=(A=I(o).checklist)==null?void 0:A.template)==null?void 0:u.type)||"-"),1)]),t("div",Pe,[a[1]||(a[1]=t("span",{class:"text-sm text-gray-600"},"Completion",-1)),t("div",Ee,[t("div",{class:"bg-green-500 h-2",style:Y({width:$.value+"%"})},null,4)]),t("span",ze,p($.value)+"%",1)])]),t("div",Oe,[t("div",Le,[a[2]||(a[2]=W(" User: ")),t("span",Ge,p(((r=(e=I(o).checklist)==null?void 0:e.employee)==null?void 0:r.name)||"-"),1)]),t("div",Ke,[L(t("select",{"onUpdate:modelValue":a[0]||(a[0]=N=>F.value=N),class:"rounded border px-2 py-1 text-sm"},a[3]||(a[3]=[t("option",{value:"blank"},"Print: Blank",-1),t("option",{value:"filled"},"Print: Use current status",-1)]),512),[[H,F.value]]),t("button",{onClick:S,class:"rounded bg-gray-900 px-3 py-2 text-sm text-white hover:bg-gray-800"}," Print ")])]),_.value||I(o).loading?(m(),f("div",We,"Loading…")):I(o).error?(m(),f("div",Ye,"Failed to load.")):I(o).checklist?(m(),ae(Se,{key:2,class:"print:hidden",items:I(o).items},null,8,["items"])):(m(),f("div",He,"No checklist found.")),I(o).checklist?(m(),f("section",Xe,[t("div",Je,[t("div",Qe,p(l.name),1),t("div",Ze,p(l.address),1),t("div",et,p(((n=(s=I(o).checklist)==null?void 0:s.template)==null?void 0:n.name)||"Checklist"),1)]),t("div",tt,"( "+p(l.copy)+" )",1),t("div",st,[t("div",at,[a[4]||(a[4]=t("span",{class:"font-medium"},"নাম:",-1)),t("span",nt,"  "+p(((c=(d=I(o).checklist)==null?void 0:d.employee)==null?void 0:c.name)||" "),1)]),t("div",ot,[a[5]||(a[5]=t("span",{class:"font-medium"},"বিভাগ:",-1)),t("span",lt,"  "+p(((q=(k=(v=I(o).checklist)==null?void 0:v.employee)==null?void 0:k.department)==null?void 0:q.name)||" "),1)]),t("div",rt,[a[6]||(a[6]=t("span",{class:"font-medium"},"যোগদানের তারিখ:",-1)),t("span",dt,"  "+p(((R=(D=I(o).checklist)==null?void 0:D.employee)==null?void 0:R.joining_date)||" "),1)])]),t("table",it,[a[8]||(a[8]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"w-12 border border-gray-800 px-2 py-1 text-center"},"ক্রম."),t("th",{class:"border border-gray-800 px-2 py-1 text-left"},"বিষয়"),t("th",{class:"w-40 border border-gray-800 px-2 py-1 text-center"},"সম্পন্ন হলে টিক চিহ্ন দিন"),t("th",{class:"w-52 border border-gray-800 px-2 py-1 text-left"},"মন্তব্য")])],-1)),t("tbody",null,[(m(!0),f(z,null,O(j.value,(N,T)=>(m(),f("tr",{key:N.id??T,class:"align-top print-row"},[t("td",ct,p(T+1),1),t("td",ut,p(N._label),1),t("td",pt,[t("span",mt,[N.status=="done"?(m(),f("span",_t,"✓")):E("",!0)])]),a[7]||(a[7]=t("td",{class:"border border-gray-800 px-2 py-1"}," ",-1))]))),128))])]),a[9]||(a[9]=ne('<div class="mt-8 grid grid-cols-2 gap-4 text-[12px]" data-v-c95a03f2><div data-v-c95a03f2><div data-v-c95a03f2>কর্মীর স্বাক্ষর: ______________________________</div><div class="mt-2" data-v-c95a03f2>তারিখ: _____________</div></div><div class="text-right" data-v-c95a03f2><div data-v-c95a03f2>পরীক্ষণকারী: ______________________________</div><div class="mt-2" data-v-c95a03f2>পদবি: __________________</div></div></div><div class="mt-12 text-right text-[12px]" data-v-c95a03f2> হেড অব এইচআর </div>',2))])):E("",!0)])}}},yt=oe(ft,[["__scopeId","data-v-c95a03f2"]]);export{yt as default};
