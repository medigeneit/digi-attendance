import{c as i,o as l,F as V,y as j,m as C,p as T,H as F,E as Y,q as b,a as t,x as S,z as K,n as v,t as f,k as H,r as I,A as Q,f as x,w as N,l as $}from"./index-hWwcwlT5.js";import{_ as W}from"./UserChip-C_WoakeD.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"mt-3"},Z={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(e,{emit:d}){const a=d;return(u,o)=>(l(),i("div",X,[(l(!0),i(V,null,j(e.childrenTasks,(g,k)=>(l(),C(Me,{key:g.id,index:k,task:g,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:o[0]||(o[0]=n=>a("editClick",n)),onAddClick:o[1]||(o[1]=n=>a("addClick",n))},{"item-end":T(({task:n,level:c})=>[F(u.$slots,"treeItemEnd",{task:n,level:c})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ee=Y({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:d}){const a=e,u=b(function(){if(a.task.children_tasks.length===0)return a.task.status==="COMPLETED"?1:0;const k=n=>{let c=0;for(let m=0;m<n.length;m++){const y=n[m];if(y.children_tasks.length===0)y.status==="COMPLETED"&&(c+=1);else{const _=y.children_tasks.length;k(y.children_tasks)===_&&(c+=1)}}return c};return k(a.task.children_tasks)}),o=b(()=>a.task.children_tasks.length===0?a.task.status==="COMPLETED"?100:0:u.value/a.task.children_tasks.length*100),g=b(()=>{const k=o.value;let n,c,m;return k===100?(n="bg-green-50",c="bg-green-200",m="text-green-600 "):k<100&&(n="bg-red-50",c="bg-red-200",m="text-red-600 "),{container:n,bar:c,text:m}});return d({completedPercentage:o.value,completedSubTaskCount:u.value}),(k,n)=>(l(),i("div",null,[t("div",{class:S(["rounded-full border py-0.5 relative overflow-hidden h-6",g.value.container]),style:{width:"180px"}},[t("div",{class:S(["z-10 absolute top-0 bottom-0",g.value.bar]),style:K(`width: ${o.value}%`)},null,6),t("span",{class:S(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",g.value.text])},[t("span",null,[t("span",null,f(u.value),1),n[0]||(n[0]=v(" / ")),t("span",null,f(k.task.children_tasks.length||1),1)])],2)],2)]))}}),J=e=>{if(!e)return"";try{const d=new Date(e);if(isNaN(d))return"";const a=String(d.getDate()).padStart(2,"0"),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()],g=d.getFullYear();return`${a}-${o}-${g}`}catch{return""}},te={},se={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function ae(e,d){return l(),i("span",se,"IMPORTANT")}const ne=U(te,[["render",ae]]),le={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(d,a)=>{const u=H("RouterLink");return l(),C(u,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:T(()=>[t("div",null,f(e.task.title),1)]),_:1},8,["to"])}}},re={},oe={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function ie(e,d){return l(),i("span",oe,"URGENT")}const de=U(re,[["render",ie]]),ue={class:"flex w-full"},ce={key:0,class:"border-l border-gray-200 last:border-l-0"},ke={class:"items-start grid grid-cols-3 group"},ge={class:"flex gap-4 items-center"},fe={key:0,class:"text-xl font-semibold text-sky-500"},me={class:"text-gray-500 text-sm"},he={class:"flex items-center gap-2"},xe={key:0,class:"text-sm text-gray-500 mt-2"},pe={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},ve={class:"flex items-center flex-wrap gap-3"},be={key:0,class:"text-gray-500 text-xs"},ye={class:"flex justify-end items-center gap-2"},_e={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200"},Ce={class:"mt-4"},Te={class:"flex items-center"},we={key:0,class:"fas fa-caret-down text-gray-400 group-hover:text-sky-400"},$e={key:1,class:"fas fa-caret-right text-gray-400 group-hover:text-sky-400"},Se=["href"],Le={class:"ml-auto text-right text-sm"},Ne={class:"text-gray-500"},Be={class:"font-semibold text-green-800"},De={class:"ml-4 text-gray-500"},Ee={class:"text-red-500 font-semibold"},Ae={key:0,class:"flex gap-2 ml-4 items-center text-xs"},Oe=["href"],Re={class:"ml-0"},Me={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick"],setup(e,{emit:d}){const a=e,u=I(null),o=d;function g(r){o("addClick",r)}function k(r){o("editClick",r)}const n=I([]),c=localStorage.getItem("sub_task_opened_list");if(c)try{n.value=JSON.parse(c)}catch{n.value=[]}const m=b(()=>J(a.task.started_at)),y=b(()=>J(a.task.deadline)),_=b({get:()=>n.value.includes(a.task.id),set:r=>{const s=n.value.includes(a.task.id);r&&!s?n.value.push(a.task.id):!r&&s&&(n.value=n.value.filter(p=>p!==a.task.id))}});Q(n,r=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(r))},{deep:!0});const B=b(()=>{var r,s,p,w;return{"hover:underline hover:text-sky-400 cursor-pointer":((s=(r=a.task)==null?void 0:r.children_tasks)==null?void 0:s.length)>0,"cursor-default pointer-none":((w=(p=a.task)==null?void 0:p.children_tasks)==null?void 0:w.length)===0}});function G(){a.task.children_tasks.length>0&&(_.value=!_.value)}return(r,s)=>{var w,D,E,A,O,R,M,P,q,z;const p=H("RouterLink");return l(),i("div",ue,[e.treeLevel>0?(l(),i("div",ce,s[3]||(s[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):x("",!0),t("div",{class:S(["flex-grow border rounded py-3 px-3",{"bg-green-50  ":((w=u.value)==null?void 0:w.completedPercentage)===100,"bg-gray-50 hover:bg-teal-50":((D=u.value)==null?void 0:D.completedPercentage)<100,"shadow-sm":e.treeLevel>0}])},[t("div",ke,[t("div",null,[t("div",null,[t("div",ge,[e.index!==void 0?(l(),i("div",fe,f(e.index+1),1)):x("",!0),e.showDraggableHandle?(l(),i("button",{key:1,onMousedown:s[0]||(s[0]=N((...h)=>r.handleDragging&&r.handleDragging(...h),["stop"])),class:"handle"},s[4]||(s[4]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):x("",!0),t("span",me," #"+f(e.task.id),1)]),t("div",he,[$(le,{task:e.task},null,8,["task"])])]),(E=e.task)!=null&&E.requirement?(l(),i("p",xe," Requirement: "+f((O=(A=e.task)==null?void 0:A.requirement)==null?void 0:O.title),1)):x("",!0),t("div",pe,[(R=e.task)!=null&&R.is_important?(l(),C(ne,{key:0})):x("",!0),(M=e.task)!=null&&M.is_urgent?(l(),C(de,{key:1})):x("",!0)])]),t("div",ve,[(l(!0),i(V,null,j(e.task.users,(h,L)=>(l(),C(p,{key:L,to:{name:"TaskList",query:{view:"userwise","company-id":h.company_id,"user-id":h.id}}},{default:T(()=>[$(W,{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",user:h},null,8,["user"])]),_:2},1032,["to"]))),128)),e.task.users.length===0?(l(),i("div",be," Not Assigned To Anyone ")):x("",!0),$(p,{to:{name:"TaskUserAssign",params:{id:(P=e.task)==null?void 0:P.id}},title:"Assign user",class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},{default:T(()=>s[5]||(s[5]=[t("i",{class:"fas fa-user-plus"},null,-1)])),_:1},8,["to"])]),t("div",ye,[t("span",_e,f(e.task.status),1),$(ee,{task:e.task,ref_key:"progress",ref:u,class:"text-sm"},null,8,["task"])])]),t("div",Ce,[t("div",Te,[t("div",{class:"flex gap-3 group items-center",onClick:G},[_.value?(l(),i("i",we)):(l(),i("i",$e)),t("span",{class:S([B.value,"text-xs text-gray-500"])},[v(" Sub Tasks ("+f((q=e.task.children_tasks)==null?void 0:q.length)+") ",1),t("a",{href:`/tasks/add?parent_id=${a.task.id}`,class:"hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border border-transparent ml-2",onClick:s[1]||(s[1]=N(h=>o("addClick",a.task.id),["stop","prevent"]))},s[6]||(s[6]=[t("i",{class:"fas fa-plus"},null,-1),v(" Add Sub Task ")]),8,Se)],2)]),t("div",Le,[t("span",Ne,[s[7]||(s[7]=v(" Started: ")),t("span",Be,f(m.value),1)]),t("span",De,[s[8]||(s[8]=v(" Deadline: ")),t("span",Ee,f(y.value),1)])]),e.hideButtons?x("",!0):(l(),i("div",Ae,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:s[2]||(s[2]=N(h=>o("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},s[9]||(s[9]=[t("i",{class:"fas fa-edit"},null,-1),v(" Edit ")]),8,Oe),$(p,{to:{name:"TaskReports",params:{id:(z=e.task)==null?void 0:z.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:T(()=>s[10]||(s[10]=[t("i",{class:"far fa-file-alt"},null,-1),v(" Reports ")])),_:1},8,["to"])]))]),t("div",Re,[_.value?(l(),C(Z,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:k,onAddClick:g},{"tree-item-end":T(({task:h,level:L})=>[F(r.$slots,"item-end",{level:L,task:h})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):x("",!0)])])],2)])}}};export{Me as _,ee as a,J as g};
