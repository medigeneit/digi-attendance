import{u as P,b as F,d as W,z as $,r as c,e as j,x as p,m as E,A as O,c as m,o as v,a as t,t as u,q as g,h as b,y as D,v as H,k as x,g as U,F as I,n as Q,f as z,i as R}from"./index-BKRuc3xX.js";import{_ as G}from"./EmployeeFilter-D70eznsw.js";import{L as J}from"./LoaderView-D7rXjkqI.js";import{u as K}from"./leave-application-DUcH7XWO.js";import{u as X}from"./user-Djoifq-t.js";import"./company-CEGCq4X8.js";import"./department-FpVJL1bh.js";import"./SelectDropdown-B8GCp2F8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-U1AAOwFq.js";const Y={class:"space-y-2 px-4"},Z={class:"flex items-center justify-between gap-2"},ee={class:"title-md md:title-lg flex-wrap text-center"},te={class:"flex flex-wrap gap-2 items-center"},re={key:0,class:"text-center py-4"},se={key:1,class:"space-y-4"},oe={class:"overflow-x-auto"},de={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},ae={class:"border border-gray-300 px-2"},le={class:"border border-gray-300 px-2"},ne={class:"border border-gray-300 px-2"},ue={class:"border border-gray-300 px-2"},ie={class:"border border-gray-300 px-2"},ye={class:"border border-gray-300 px-2"},ve=["innerHTML"],me={class:"border border-gray-300 px-2"},_e={class:"border border-gray-300 px-2"},ce={class:"border border-gray-300 px-2"},fe={class:"flex justify-center gap-2"},pe=["onClick"],ge={key:0},qe={__name:"PrevAfterLeaveApplicationList",setup(be){const h=P(),i=F(),a=K(),k=X();W();const{leaveApplications:T,loading:A}=$(a),q=c(null),l=c(i.query.type==="after"?"after":"prev"),n=c(i.query.date||a.selectedMonth||new Date().toISOString().slice(0,7));c("");const s=c({company_id:i.query.company_id||"",department_id:i.query.department_id||"",type:i.query.category||"all",employee_id:i.query.employee_id||"",category:""});function C(o){return/^\d{4}-\d{2}$/.test(o||"")?`${o}-15`:o||new Date().toISOString().slice(0,10)}const _=async()=>{const o=l.value==="after"?"next_week":"prev_week",r=C(n.value),d={company_id:s.value.company_id,department_id:s.value.department_id,selectedDate:n.value,selectedStatus:a.selectedStatus,query:o,anchor_date:r};s.value.employee_id&&(d.user_id=s.value.employee_id),s.value.type&&s.value.type!=="all"&&(d.category=s.value.type),A.value=!0;try{await a.fetchLeaveApplications(d)}finally{A.value=!1}};j(async()=>{s.value.employee_id&&(await k.fetchUser(s.value.employee_id),q.value=k.user||null),await _()});function B(){const o={type:l.value,date:n.value};return s.value.company_id&&(o.company_id=String(s.value.company_id)),s.value.department_id&&(o.department_id=String(s.value.department_id)),s.value.employee_id&&(o.employee_id=String(s.value.employee_id)),s.value.type&&s.value.type!=="all"&&(o.category=String(s.value.type)),o}let f=null;function w(){f&&clearTimeout(f),f=setTimeout(()=>{h.replace({query:B()}).catch(()=>{})},120)}p(()=>i.query,o=>{const r=o.type==="after"?"after":"prev",d=o.date||"",e={company_id:o.company_id||"",department_id:o.department_id||"",type:o.category||"all",employee_id:o.employee_id||"",category:""};let y=!1;r!==l.value&&(l.value=r,y=!0),d&&d!==n.value&&(n.value=d,y=!0),(e.company_id!==s.value.company_id||e.department_id!==s.value.department_id||e.type!==s.value.type||e.employee_id!==s.value.employee_id)&&(s.value=e,y=!0),y&&_()}),p(()=>[l.value,n.value,s.value.company_id,s.value.department_id,s.value.employee_id],()=>{w(),_()}),p(()=>a.selectedStatus,()=>_());const S=E(()=>T.value||[]),V=async o=>{confirm("Are you sure to delete this application?")&&(await a.deleteLeaveApplication(o),await _())},M=()=>h.go(-1),N=()=>{w()};return(o,r)=>{const d=O("RouterLink");return v(),m("div",Y,[t("div",Z,[t("button",{class:"btn-3",onClick:M},r[7]||(r[7]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),t("h1",ee,u(l.value==="after"?"After 1 Week Leave Applications":"Previous 1 Week Leave Applications"),1),r[8]||(r[8]=t("div",null,null,-1))]),t("div",te,[g(G,{company_id:s.value.company_id,"onUpdate:company_id":r[0]||(r[0]=e=>s.value.company_id=e),department_id:s.value.department_id,"onUpdate:department_id":r[1]||(r[1]=e=>s.value.department_id=e),employee_id:s.value.employee_id,"onUpdate:employee_id":r[2]||(r[2]=e=>s.value.employee_id=e),category:s.value.type,"onUpdate:category":r[3]||(r[3]=e=>s.value.type=e),"with-type":!0,"initial-value":o.$route.query,onFilterChange:N},null,8,["company_id","department_id","employee_id","category","initial-value"]),t("div",null,[b(t("select",{"onUpdate:modelValue":r[4]||(r[4]=e=>l.value=e),class:"input-1"},r[9]||(r[9]=[t("option",{value:"prev"},"Previous 1 Week",-1),t("option",{value:"after"},"After 1 Week",-1)]),512),[[D,l.value]])]),t("div",null,[b(t("input",{id:"monthOrDate",type:"date","onUpdate:modelValue":r[5]||(r[5]=e=>n.value=e),class:"input-1"},null,512),[[H,n.value]])]),t("div",null,[b(t("select",{"onUpdate:modelValue":r[6]||(r[6]=e=>x(a).selectedStatus=e),class:"input-1"},r[10]||(r[10]=[t("option",{value:""},"All",-1),t("option",{value:"Pending"},"Pending",-1),t("option",{value:"Approved"},"Approved",-1),t("option",{value:"Rejected"},"Rejected",-1)]),512),[[D,x(a).selectedStatus]])])]),x(a).loading?(v(),m("div",re,[g(J)])):(v(),m("div",se,[t("div",oe,[t("table",de,[r[15]||(r[15]=t("thead",null,[t("tr",{class:"bg-gray-200"},[t("th",{class:"border border-gray-300 px-2 text-left"},"#"),t("th",{class:"border border-gray-300 px-2 text-left"},"Employee Name"),t("th",{class:"border border-gray-300 px-2 text-left"},"Last Working Day"),t("th",{class:"border border-gray-300 px-2 text-left"},"Resumption Date"),t("th",{class:"border border-gray-300 px-2 text-left"},"Leave Period"),t("th",{class:"border border-gray-300 px-2 text-left"},"Total Days"),t("th",{class:"border border-gray-300 px-2 text-left"},"Type"),t("th",{class:"border border-gray-300 px-2 text-left"},"Status"),t("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),t("tbody",null,[(v(!0),m(I,null,Q(S.value,(e,y)=>{var L;return v(),m("tr",{key:y,class:"border-b border-gray-200 hover:bg-blue-200"},[t("td",ae,u(y+1),1),t("td",le,u(((L=e==null?void 0:e.user)==null?void 0:L.name)||"Unknown"),1),t("td",ne,u(e==null?void 0:e.last_working_date),1),t("td",ue,u(e==null?void 0:e.resumption_date),1),t("td",ie,u(e==null?void 0:e.leave_period),1),t("td",ye,[t("div",{innerHTML:e.duration||(e==null?void 0:e.total_leave_days)},null,8,ve)]),t("td",me,u(e==null?void 0:e.application_types),1),t("td",_e,u((e==null?void 0:e.status)||"N/A"),1),t("td",ce,[t("div",fe,[g(d,{to:{name:"LeaveApplicationShow",params:{id:e==null?void 0:e.id}},class:"btn-icon"},{default:R(()=>r[11]||(r[11]=[t("i",{class:"far fa-eye"},null,-1)])),_:2,__:[11]},1032,["to"]),(e==null?void 0:e.status)!=="Approved"?(v(),z(d,{key:0,to:{name:"LeaveApplicationEdit",params:{id:e==null?void 0:e.id}},class:"btn-icon"},{default:R(()=>r[12]||(r[12]=[t("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[12]},1032,["to"])):U("",!0),t("button",{onClick:xe=>V(e==null?void 0:e.id),class:"btn-icon text-red-500"},r[13]||(r[13]=[t("i",{class:"far fa-trash"},null,-1)]),8,pe)])])])}),128)),S.value.length?U("",!0):(v(),m("tr",ge,r[14]||(r[14]=[t("td",{colspan:"9",class:"p-1 text-center text-red-500"},"No application found",-1)])))])])])]))])}}};export{qe as default};
