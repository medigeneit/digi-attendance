import{G as T,r as x,H as C,p as I,c as b,o as g,a as t,g as S,j as _,t as k,F as z,h as F,v as A,W as ne,x as N,n as le,z as ae,q as O,A as V,I as oe,a1 as j,e as re,y as R,k as ie}from"./index-mGcqMfxK.js";import{u as ue}from"./zk-device-CRqnlwZR.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as de}from"./HeaderWithButtons-B_pvkXwB.js";const K=T("zkUser",()=>{const u=x([]),y=x(!1),p=x(null),i=(v,w)=>{var f,h;p.value=((h=(f=v==null?void 0:v.response)==null?void 0:f.data)==null?void 0:h.message)||(v==null?void 0:v.message)||w};async function r(){y.value=!0,p.value=null;try{const{data:v}=await C.get("/zk-users");return u.value=v,v}catch(v){return i(v,"ইউজার লোড ব্যর্থ"),[]}finally{y.value=!1}}async function d(v,w=25){var f;try{const{data:h}=await C.get("/zk-users/search",{params:{query:v,limit:w}});return h}catch(h){throw i(h,"সার্চ ব্যর্থ"),((f=h==null?void 0:h.response)==null?void 0:f.data)||h}}async function l(v){var w;try{const{data:f}=await C.post("/zk-users",v);return await r(),f}catch(f){throw i(f,"ইউজার তৈরিতে ব্যর্থ"),((w=f==null?void 0:f.response)==null?void 0:w.data)||f}}async function U(v,w){var f;try{const{data:h}=await C.put(`/zk-users/${encodeURIComponent(v)}`,w);return await r(),h}catch(h){throw i(h,"ইউজার আপডেট ব্যর্থ"),((f=h==null?void 0:h.response)==null?void 0:f.data)||h}}async function a(v){var w;try{const{data:f}=await C.delete(`/zk-users/${encodeURIComponent(v)}`);return await r(),f}catch(f){throw i(f,"ইউজার ডিলিট ব্যর্থ"),((w=f==null?void 0:f.response)==null?void 0:w.data)||f}}async function e(v){const{data:w}=await C.post(`/devices/${encodeURIComponent(v)}/pull-users`);return await r(),w}async function o(v){const{data:w}=await C.post(`/devices/${encodeURIComponent(v)}/push-users`);return w}async function s(v,w){const{data:f}=await C.post(`/devices/${encodeURIComponent(v)}/users/${encodeURIComponent(w)}/push`);return f}async function n(v){const{data:w}=await C.get(`/devices/${encodeURIComponent(v)}/user-count`);return w}async function c(v,w){const{data:f}=await C.delete(`/devices/${encodeURIComponent(v)}/users/${encodeURIComponent(w)}/remove`);return f}return{users:u,loading:y,error:p,fetchUsers:r,searchUsers:d,createUser:l,updateUser:U,deleteUser:a,pullUsersFromDevice:e,pushAllUsersToDevice:o,pushSingleUserToDevice:s,userCountOnDevice:n,removeUserFromDevice:c}}),ce=T("zkFinger",()=>{const u=x(!1),y=x(null),p=(e,o)=>{var s,n;y.value=((n=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:n.message)||(e==null?void 0:e.message)||o};async function i(e,{includeTemplate:o=!1}={}){var s;u.value=!0,y.value=null;try{const{data:n}=await C.get(`/zk-users/${encodeURIComponent(e)}/fingerprints`,{params:{include_template:o?1:0}});return n}catch(n){throw p(n,"ফিঙ্গারপ্রিন্ট লোড ব্যর্থ"),((s=n==null?void 0:n.response)==null?void 0:s.data)||n}finally{u.value=!1}}async function r(e,o){var s;u.value=!0,y.value=null;try{const{data:n}=await C.post(`/zk-users/${encodeURIComponent(e)}/fingerprints/upsert`,o);return n}catch(n){throw p(n,"ফিঙ্গারপ্রিন্ট আপসার্ট ব্যর্থ"),((s=n==null?void 0:n.response)==null?void 0:s.data)||n}finally{u.value=!1}}async function d(e){var o;u.value=!0,y.value=null;try{const{data:s}=await C.post(`/devices/${encodeURIComponent(e)}/pull-fingerprints`);return s}catch(s){throw p(s,"ডিভাইস থেকে ফিঙ্গার টানা ব্যর্থ"),((o=s==null?void 0:s.response)==null?void 0:o.data)||s}finally{u.value=!1}}async function l(e,o=[],{force:s=!1}={}){var n;u.value=!0,y.value=null;try{const c={user_ids:o,force:s},{data:v}=await C.post(`/devices/${encodeURIComponent(e)}/push-fingerprints`,c);return v}catch(c){throw p(c,"বাল্ক ফিঙ্গার পুশ ব্যর্থ"),((n=c==null?void 0:c.response)==null?void 0:n.data)||c}finally{u.value=!1}}async function U(e,o){var s;u.value=!0,y.value=null;try{const{data:n}=await C.post(`/devices/${encodeURIComponent(e)}/users/${encodeURIComponent(o)}/push-fingerprints`);return n}catch(n){throw p(n,"সিঙ্গেল ফিঙ্গার পুশ ব্যর্থ"),((s=n==null?void 0:n.response)==null?void 0:s.data)||n}finally{u.value=!1}}async function a(e,o,s){var n;u.value=!0,y.value=null;try{const{data:c}=await C.post(`/devices/${encodeURIComponent(e)}/fingerprints/remove`,{userid:o,indexes:s});return c}catch(c){throw p(c,"ফিঙ্গারপ্রিন্ট রিমুভ ব্যর্থ"),((n=c==null?void 0:c.response)==null?void 0:n.data)||c}finally{u.value=!1}}return{loading:u,error:y,listFingerprints:i,upsertFingerprint:r,pullFingerprintsFromDevice:d,pushFingerprintsBulk:l,pushFingerprintsOne:U,removeFingerprints:a}}),ve={class:"bg-white border rounded-xl overflow-hidden"},pe={class:"p-3 border-b flex items-center gap-3"},fe={class:"text-sm text-slate-600"},me={class:"ml-auto flex items-center gap-2"},ye=["disabled"],be={key:0,class:"text-xs text-slate-500"},ge={class:"overflow-auto"},we={class:"w-full text-sm"},xe={class:"px-3 py-2 font-mono text-xs"},he={class:"px-3 py-2"},$e={class:"px-3 py-2"},ke={class:"px-3 py-2"},Ue={class:"px-3 py-2"},Ce={class:"flex flex-wrap gap-2"},_e=["onClick"],De=["onClick"],Fe=["onClick"],Se=["onClick"],Ie={key:0},Re={__name:"UserTable",props:{items:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["edit","delete","push-one","remove-one"],setup(u,{emit:y}){const p=u,i=x("");function r(a){return Number(a)===14?"Admin":"User"}const d=I(()=>p.items.length),l=I(()=>{const a=i.value.trim().toLowerCase();return a?p.items.filter(e=>{const o=String((e==null?void 0:e.name)??"").toLowerCase(),s=String((e==null?void 0:e.userid)??"").toLowerCase(),n=String((e==null?void 0:e.cardno)??"").toLowerCase();return o.includes(a)||s.includes(a)||n.includes(a)}):p.items});function U(){i.value=""}return(a,e)=>(g(),b("div",ve,[t("div",pe,[t("div",fe,[e[4]||(e[4]=_(" Total: ")),t("b",null,k(d.value),1),i.value?(g(),b(z,{key:0},[e[2]||(e[2]=t("span",{class:"text-slate-400"}," • ",-1)),e[3]||(e[3]=_(" Showing: ")),t("b",null,k(l.value.length),1)],64)):S("",!0)]),t("div",me,[F(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>i.value=o),onKeyup:e[1]||(e[1]=ne(()=>{},["enter"])),type:"text",placeholder:"Search name / enroll / card",class:"border rounded px-3 py-1.5 text-sm w-64"},null,544),[[A,i.value]]),t("button",{class:"btn-outline",onClick:U,disabled:!i.value},e[5]||(e[5]=[t("i",{class:"fas fa-times mr-1"},null,-1),_(" Clear ")]),8,ye)]),u.loading?(g(),b("div",be,e[6]||(e[6]=[t("i",{class:"fas fa-circle-notch fa-spin"},null,-1),_(" Loading… ")]))):S("",!0)]),t("div",ge,[t("table",we,[e[12]||(e[12]=t("thead",{class:"text-left bg-slate-50"},[t("tr",null,[t("th",{class:"px-3 py-2 border-b"},"Enroll"),t("th",{class:"px-3 py-2 border-b"},"Name"),t("th",{class:"px-3 py-2 border-b"},"Role"),t("th",{class:"px-3 py-2 border-b"},"FPs"),t("th",{class:"px-3 py-2 border-b w-64"},"Actions")])],-1)),t("tbody",null,[(g(!0),b(z,null,N(l.value,o=>(g(),b("tr",{key:o.id,class:"border-b"},[t("td",xe,k(o.userid),1),t("td",he,k(o.name),1),t("td",$e,[t("span",{class:le([Number(o.role)===14?"bg-amber-100 text-amber-800":"bg-emerald-100 text-emerald-800","px-2 py-0.5 rounded text-xs"])},k(r(o.role)),3)]),t("td",ke,k(o.finger_count??0),1),t("td",Ue,[t("div",Ce,[t("button",{class:"btn",onClick:s=>a.$emit("edit",o)},e[7]||(e[7]=[t("i",{class:"fas fa-edit mr-1"},null,-1),_(" Edit ")]),8,_e),t("button",{class:"btn",onClick:s=>a.$emit("delete",o)},e[8]||(e[8]=[t("i",{class:"fas fa-trash mr-1"},null,-1),_(" Delete ")]),8,De),t("button",{class:"btn",onClick:s=>a.$emit("push-one",o)},e[9]||(e[9]=[t("i",{class:"fas fa-upload mr-1"},null,-1),_(" Push to Device ")]),8,Fe),t("button",{class:"btn",onClick:s=>a.$emit("remove-one",o)},e[10]||(e[10]=[t("i",{class:"fas fa-user-slash mr-1"},null,-1),_(" Remove from Device ")]),8,Se)])])]))),128)),l.value.length?S("",!0):(g(),b("tr",Ie,e[11]||(e[11]=[t("td",{colspan:"6",class:"px-3 py-4 text-center text-slate-500"},"No users found",-1)])))])])])]))}},Ae=P(Re,[["__scopeId","data-v-0665eea9"]]),Pe={key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/30"},ze={class:"bg-white rounded-xl shadow-lg w-[560px] max-w-[95vw]"},Be={class:"px-4 py-3 border-b flex items-center justify-between"},Ee={class:"font-semibold"},Te={class:"p-4 space-y-3"},Ne={class:"grid grid-cols-2 gap-3"},Ve=["readonly"],Me={class:"flex items-center gap-2"},Oe={class:"px-4 py-3 border-t flex items-center justify-end gap-2"},je={__name:"UserFormModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close","save"],setup(u,{emit:y}){const p=u,i=y,r=ae({userid:"",name:"",role:0,cardno:"",password:"",is_active:!0});O(()=>p.user,a=>{a?(r.userid=a.userid??"",r.name=a.name??"",r.role=Number(a.role??0),r.cardno=a.cardno??"",r.password="",r.is_active=a.is_active??!0):(r.userid="",r.name="",r.role=0,r.cardno="",r.password="",r.is_active=!0)},{immediate:!0});const d=I(()=>!!p.user);function l(){i("close")}function U(){const a={userid:r.userid,name:r.name,role:Number(r.role),cardno:r.cardno||null,password:r.password||null,is_active:!!r.is_active};i("save",a)}return(a,e)=>u.show?(g(),b("div",Pe,[t("div",ze,[t("div",Be,[t("div",Ee,k(d.value?"Edit User":"New User"),1),t("button",{class:"text-slate-500 hover:text-slate-800",onClick:l},e[6]||(e[6]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Te,[t("div",Ne,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs text-slate-600 mb-1"},"Enroll (userid)",-1)),F(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.userid=o),readonly:d.value,type:"text",maxlength:"9",class:"border rounded px-3 py-1.5 w-full",placeholder:"e.g. 1001"},null,8,Ve),[[A,r.userid]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-xs text-slate-600 mb-1"},"Name",-1)),F(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.name=o),type:"text",maxlength:"24",class:"border rounded px-3 py-1.5 w-full"},null,512),[[A,r.name]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-xs text-slate-600 mb-1"},"Role",-1)),F(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.role=o),class:"border rounded px-3 py-1.5 w-full"},e[9]||(e[9]=[t("option",{value:0},"User",-1),t("option",{value:14},"Admin",-1)]),512),[[V,r.role,void 0,{number:!0}]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-xs text-slate-600 mb-1"},"Card No",-1)),F(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.cardno=o),type:"text",class:"border rounded px-3 py-1.5 w-full"},null,512),[[A,r.cardno]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-xs text-slate-600 mb-1"},"Password",-1)),F(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.password=o),type:"text",maxlength:"8",class:"border rounded px-3 py-1.5 w-full",placeholder:"(optional)"},null,512),[[A,r.password]])]),t("div",Me,[F(t("input",{id:"active","onUpdate:modelValue":e[5]||(e[5]=o=>r.is_active=o),type:"checkbox",class:"h-4 w-4"},null,512),[[oe,r.is_active]]),e[13]||(e[13]=t("label",{for:"active",class:"text-sm"},"Active",-1))])])]),t("div",Oe,[t("button",{class:"btn",onClick:l},"Cancel"),t("button",{class:"btn-primary",onClick:U},k(d.value?"Update":"Create"),1)])])])):S("",!0)}},Ke=P(je,[["__scopeId","data-v-3ae7ad12"]]),Le={key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/30"},Ze={class:"bg-white rounded-xl shadow-lg w-[480px] max-w-[95vw]"},qe={class:"px-4 py-3 border-b flex items-center justify-between"},We={class:"font-semibold"},Ge={class:"p-4 text-sm text-slate-700"},He={class:"px-4 py-3 border-t flex items-center justify-end gap-2"},Je={__name:"ConfirmModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,default:"Are you sure?"}},emits:["close","confirm"],setup(u,{emit:y}){return(p,i)=>u.show?(g(),b("div",Le,[t("div",Ze,[t("div",qe,[t("div",We,k(u.title),1),t("button",{class:"text-slate-500 hover:text-slate-800",onClick:i[0]||(i[0]=r=>p.$emit("close"))},i[3]||(i[3]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",Ge,k(u.message),1),t("div",He,[t("button",{class:"btn",onClick:i[1]||(i[1]=r=>p.$emit("close"))},"Cancel"),t("button",{class:"btn-danger",onClick:i[2]||(i[2]=r=>p.$emit("confirm"))},"Confirm")])])])):S("",!0)}},Qe=P(Je,[["__scopeId","data-v-56cdf847"]]),Xe={key:0,class:"fixed inset-0 z-[60] grid place-items-center bg-black/30"},Ye={class:"bg-white rounded-xl shadow-xl w-[520px] max-w-[95vw]"},es={class:"px-4 py-3 border-b flex items-center justify-between"},ss={class:"font-semibold"},ts={class:"p-4 space-y-3 text-sm"},ns={class:"text-slate-600"},ls={key:0},as={key:1},os=["value"],rs={class:"px-4 py-3 border-t flex items-center justify-end gap-2"},is=["disabled"],us={key:0,class:"fas fa-user-slash"},ds={key:1,class:"fas fa-circle-notch fa-spin"},cs=["disabled"],vs={key:0,class:"fas fa-user-plus"},ps={key:1,class:"fas fa-circle-notch fa-spin"},fs=["disabled"],ms={key:0,class:"fas fa-fingerprint"},ys={key:1,class:"fas fa-circle-notch fa-spin"},bs={__name:"DeviceActionModal",props:{show:{type:Boolean,default:!1},mode:{type:String,default:"push"},user:{type:Object,default:null},devices:{type:Array,default:()=>[]},loadingUser:{type:Boolean,default:!1},loadingFp:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["close","confirm","confirm-user","confirm-fp"],setup(u,{emit:y}){const p=u,i=x(null);O(()=>p.show,d=>{d&&(i.value=null)});const r=I(()=>p.mode==="remove"?"Remove From Device":"Push To Device");return(d,l)=>{var U,a;return u.show?(g(),b("div",Xe,[t("div",Ye,[t("div",es,[t("div",ss,k(r.value),1),t("button",{class:"text-slate-500 hover:text-slate-800",onClick:l[0]||(l[0]=e=>d.$emit("close"))},l[6]||(l[6]=[t("i",{class:"fas fa-times"},null,-1)]))]),t("div",ts,[t("div",ns,[t("div",null,[l[7]||(l[7]=t("b",null,"User:",-1)),_(" "+k((U=u.user)==null?void 0:U.userid)+" — "+k((a=u.user)==null?void 0:a.name),1)]),u.mode==="push"?(g(),b("div",ls,"Select a device and choose what to push.")):(g(),b("div",as,l[8]||(l[8]=[_("Select a device to "),t("b",null,"remove",-1),_(" this user from.")])))]),t("div",null,[l[10]||(l[10]=t("label",{class:"block text-xs text-slate-600 mb-1"},"Device",-1)),F(t("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>i.value=e),class:"border rounded px-3 py-2 w-full"},[l[9]||(l[9]=t("option",{value:null,disabled:""},"Select device",-1)),(g(!0),b(z,null,N(u.devices,e=>(g(),b("option",{key:e.id,value:e.id}," #"+k(e.id)+" — "+k(e.name)+" ("+k(e.ip_address)+":"+k(e.port)+") ",9,os))),128))],512),[[V,i.value]])]),l[11]||(l[11]=t("div",{class:"text-[12px] text-slate-500"}," Tip: Make sure the device is online and reachable. ",-1))]),t("div",rs,[t("button",{class:"btn",onClick:l[2]||(l[2]=e=>d.$emit("close"))},"Cancel"),u.mode==="remove"?(g(),b("button",{key:0,class:"btn-primary",disabled:!i.value||u.loading,onClick:l[3]||(l[3]=e=>d.$emit("confirm",i.value))},[u.loading?(g(),b("i",ds)):(g(),b("i",us)),l[12]||(l[12]=t("span",{class:"ml-1"},"Confirm Remove",-1))],8,is)):(g(),b(z,{key:1},[t("button",{class:"btn-primary",disabled:!i.value||u.loadingUser,onClick:l[4]||(l[4]=e=>d.$emit("confirm-user",i.value))},[u.loadingUser?(g(),b("i",ps)):(g(),b("i",vs)),l[13]||(l[13]=t("span",{class:"ml-1"},"Push User",-1))],8,cs),t("button",{class:"btn-primary",disabled:!i.value||u.loadingFp,onClick:l[5]||(l[5]=e=>d.$emit("confirm-fp",i.value))},[u.loadingFp?(g(),b("i",ys)):(g(),b("i",ms)),l[14]||(l[14]=t("span",{class:"ml-1"},"Push Fingerprints",-1))],8,fs)],64))])])])):S("",!0)}}},gs=P(bs,[["__scopeId","data-v-cf62d470"]]),ws=T("zkteco",()=>{const u=x(!1),y=x(null),p=x(null),i=x(null),r=(a,e)=>{var o,s,n,c;y.value=((s=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:s.error)||((c=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:c.message)||(a==null?void 0:a.message)||e};async function d({deviceId:a,what:e="both"}={}){var o;u.value=!0,y.value=null;try{const s={device_id:a,what:e},{data:n}=await C.post("/zkteco/pull",s);return p.value=n,n}catch(s){throw r(s,"পুল ব্যর্থ"),((o=s==null?void 0:s.response)==null?void 0:o.data)||s}finally{u.value=!1}}async function l({deviceId:a,what:e="both",scope:o="all",userIds:s=[],disableDuringSync:n=!0}={}){var c;u.value=!0,y.value=null;try{const v={device_id:a,what:e,scope:o,...o==="only"?{user_ids:s}:{},disable_during_sync:!!n},{data:w}=await C.post("/zkteco/push",v);return i.value=w,w}catch(v){throw r(v,"পুশ ব্যর্থ"),((c=v==null?void 0:v.response)==null?void 0:c.data)||v}finally{u.value=!1}}async function U({deviceId:a,userId:e,what:o="both",disableDuringSync:s=!0}={}){return l({deviceId:a,what:o,scope:"only",userIds:[e],disableDuringSync:s})}return{loading:u,error:y,lastPull:p,lastPush:i,pull:d,push:l,pushUser:U}}),xs={class:"flex flex-wrap items-center gap-2 bg-slate-50 border rounded-lg p-3"},hs=["value"],$s=["disabled"],ks=["disabled"],Us=["disabled"],Cs={key:2,class:"ml-auto text-xs text-slate-500"},_s={__name:"DeviceActionsBar",props:{devices:{type:Array,default:()=>[]}},setup(u){const y=u,p=j(),i=K(),r=ws(),d=x(""),l=x(!1),U=I(()=>Array.isArray(y.devices)&&y.devices.length>0);async function a(){if(!d.value)return p.error("Enter a Device ID first");try{l.value=!0;const s=await r.pull({deviceId:d.value,what:"both"}),n=(s==null?void 0:s.users_added)??(s==null?void 0:s.pulled_users)??(s==null?void 0:s.users)??0,c=(s==null?void 0:s.fingers_added)??(s==null?void 0:s.pulled_templates)??(s==null?void 0:s.templates)??0;p.success(`Pulled from device #${d.value}: users ${n}, templates ${c}`),await i.fetchUsers()}catch(s){p.error((s==null?void 0:s.error)||(s==null?void 0:s.message)||"Pull failed")}finally{l.value=!1}}async function e(){if(!d.value)return p.error("Enter a Device ID first");try{l.value=!0;const s=await r.push({deviceId:d.value,what:"both",scope:"all",disableDuringSync:!0}),n=(s==null?void 0:s.users_pushed)??(s==null?void 0:s.users)??0,c=(s==null?void 0:s.fingers_pushed)??(s==null?void 0:s.templates)??0;p.success(`Pushed to device #${d.value}: users ${n}, templates ${c}`)}catch(s){p.error((s==null?void 0:s.error)||(s==null?void 0:s.message)||"Push failed")}finally{l.value=!1}}async function o(){if(!d.value)return p.error("Enter a Device ID first");try{l.value=!0;const s=await i.userCountOnDevice(d.value),n=Number((s==null?void 0:s.user_count)??0);p.info(`Device #${d.value}: users = ${n}${(s==null?void 0:s.online)===!1?" (offline)":""}`)}catch(s){p.error((s==null?void 0:s.message)||"Count failed")}finally{l.value=!1}}return(s,n)=>(g(),b("div",xs,[n[7]||(n[7]=t("div",{class:"text-sm text-slate-600"},"Device actions:",-1)),U.value?F((g(),b("select",{key:0,"onUpdate:modelValue":n[0]||(n[0]=c=>d.value=c),class:"border rounded px-2 py-1 text-sm min-w-48"},[n[2]||(n[2]=t("option",{value:"",disabled:""},"Select a device…",-1)),(g(!0),b(z,null,N(u.devices,c=>(g(),b("option",{key:c.id,value:String(c.id)}," #"+k(c.id)+" — "+k(c.name||c.ip_address),9,hs))),128))],512)),[[V,d.value]]):F((g(),b("input",{key:1,"onUpdate:modelValue":n[1]||(n[1]=c=>d.value=c),type:"number",min:"1",placeholder:"Device ID",class:"border rounded px-2 py-1 text-sm w-28"},null,512)),[[A,d.value]]),t("button",{class:"btn",onClick:a,disabled:l.value},n[3]||(n[3]=[t("i",{class:"fas fa-download mr-1"},null,-1),_(" Pull Users ")]),8,$s),t("button",{class:"btn",onClick:e,disabled:l.value},n[4]||(n[4]=[t("i",{class:"fas fa-upload mr-1"},null,-1),_(" Push All ")]),8,ks),t("button",{class:"btn",onClick:o,disabled:l.value},n[5]||(n[5]=[t("i",{class:"fas fa-list-ol mr-1"},null,-1),_(" Count ")]),8,Us),l.value?(g(),b("span",Cs,n[6]||(n[6]=[t("i",{class:"fas fa-circle-notch fa-spin"},null,-1),_(" Working… ")]))):S("",!0)]))}},Ds=P(_s,[["__scopeId","data-v-01957198"]]),Fs={class:"my-container space-y-4"},Ss={__name:"ZKUsers",setup(u){const y=ue(),p=I(()=>y.devices),i=K(),r=ce(),d=j(),l=x(!1),U=x("push"),a=x(null),e=x(!1),o=x(!1),s=x(!1),n=x(!1),c=x(null),v=x(!1),w=x(""),f=x("");let h=null,B=null;const L=I(()=>i.users);async function M(){await i.fetchUsers()}re(async()=>{await Promise.all([i.fetchUsers(),y.fetchDevices()])});function Z(){c.value=null,n.value=!0}function q(m){c.value=m,n.value=!0}function W(){n.value=!1}async function G(m){var $;try{($=c.value)!=null&&$.id?(await i.updateUser(c.value.id,m),d.success("User updated")):(await i.createUser(m),d.success("User created")),await M(),n.value=!1}catch(D){d.error((D==null?void 0:D.message)||"Save failed")}}function H(m){w.value="Delete User",f.value=`Are you sure you want to delete "${m.name}" (Enroll ${m.userid})?`,h=async()=>{await i.deleteUser(m.id),d.warning("User deleted"),await M()},B=null,v.value=!0}function E(){v.value=!1,h=null,B=null}async function J(){if(!h)return E();try{await h(B)}catch(m){d.error((m==null?void 0:m.message)||"Operation failed")}finally{E()}}function Q(m){a.value=m,U.value="push",l.value=!0}function X(m){a.value=m,U.value="remove",l.value=!0}async function Y(m){if(!(!m||!a.value))try{e.value=!0;const $=await i.removeUserFromDevice(m,a.value.userid);d.warning(`Removed ${a.value.userid} from device#${m}${$!=null&&$.removed?"":" (check device)"}`)}catch($){d.error(($==null?void 0:$.message)||"Operation failed")}finally{e.value=!1,l.value=!1,a.value=null}}async function ee(m){if(!(!m||!a.value))try{o.value=!0;const $=await i.pushSingleUserToDevice(m,a.value.userid);d.success(`Pushed USER ${a.value.userid} → device#${m}`)}catch($){d.error(($==null?void 0:$.message)||"User push failed")}finally{o.value=!1,l.value=!1,a.value=null}}async function se(m){var $;if(!(!m||!a.value))try{s.value=!0;const D=await r.pushFingerprintsOne(m,a.value.userid),te=Number((($=D==null?void 0:D.data)==null?void 0:$.pushed_templates)??(D==null?void 0:D.pushed_templates)??0);d.success(`Pushed FPs ${a.value.userid} → device#${m}: ${te}`)}catch(D){d.error((D==null?void 0:D.message)||"Fingerprint push failed")}finally{s.value=!1,l.value=!1,a.value=null}}return(m,$)=>(g(),b("div",Fs,[R(de,{title:"ZK Users",onAdd:Z}),R(Ds,{devices:p.value},null,8,["devices"]),R(Ae,{items:L.value,loading:ie(i).loading,onEdit:q,onDelete:H,onPushOne:Q,onRemoveOne:X},null,8,["items","loading"]),R(Ke,{show:n.value,user:c.value,onClose:W,onSave:G},null,8,["show","user"]),R(Qe,{show:v.value,title:w.value,message:f.value,onClose:E,onConfirm:J},null,8,["show","title","message"]),R(gs,{show:l.value,mode:U.value,user:a.value,devices:p.value,loading:e.value,"loading-user":o.value,"loading-fp":s.value,onClose:$[0]||($[0]=()=>{l.value=!1,a.value=null}),onConfirm:Y,onConfirmUser:ee,onConfirmFp:se},null,8,["show","mode","user","devices","loading","loading-user","loading-fp"])]))}},zs=P(Ss,[["__scopeId","data-v-041894a2"]]);export{zs as default};
