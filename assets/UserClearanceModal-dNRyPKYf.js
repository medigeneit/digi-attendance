import{B as J,r as h,C as Q,x as C,D as X,q as O,y as Z,c,o as p,j as f,s as B,a as s,t as o,n as ee,b as M,m as G,F,e as te,A as se}from"./index-mmL0JzY3.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re=J("userClearance",()=>{const g=h(null),N=h(null),d=h([]),w=h(!1),b=h(""),u=h({total:0,by_status:{},by_handover_to:{}}),i=h({by:"created_at",dir:"desc"}),y=h({search:"",status:"",department_id:"",template_item_id:"",handover_to:""});function D(v){g.value=v}async function l(){var v,L;if(g.value){w.value=!0,b.value="";try{const{data:n}=await Q.get(`/users/${g.value}/clearance-items`,{params:{include:"department,templateItem,clearedBy",sort:i.value.by,order:i.value.dir,search:y.value.search||void 0,status:y.value.status||void 0,department_id:y.value.department_id||void 0,template_item_id:y.value.template_item_id||void 0,handover_to:y.value.handover_to||void 0}}),S=Array.isArray(n==null?void 0:n.data)?n.data:Array.isArray(n)?n:[];d.value=S;const k=(n==null?void 0:n.meta)||{},P=(n==null?void 0:n.extra)||{},E=k.summary||P.summary||{};u.value={total:Number(E.total??S.length)||0,by_status:E.by_status||{},by_handover_to:E.by_handover_to||{}},k.user&&(N.value=k.user)}catch(n){console.error(n),b.value=((L=(v=n==null?void 0:n.response)==null?void 0:v.data)==null?void 0:L.message)||"Failed to load",d.value=[],u.value={total:0,by_status:{},by_handover_to:{}},N.value=null}finally{w.value=!1}}}function R(v){i.value.by===v?i.value.dir=i.value.dir==="asc"?"desc":"asc":(i.value.by=v,i.value.dir="desc")}function I(){y.value={search:"",status:"",department_id:"",template_item_id:"",handover_to:""}}return{currentUserId:g,currentUserInfo:N,items:d,loading:w,error:b,summary:u,sort:i,filters:y,setUser:D,fetch:l,setSort:R,resetFilters:I}}),ne={key:1,class:"fixed inset-0 z-50 print:static print:z-auto"},oe={class:"absolute inset-0 flex items-start justify-center overflow-y-auto print:block print:overflow-visible"},le={class:"modal-print mt-6 mb-10 w-[1150px] max-w-[96vw] rounded-2xl bg-white shadow-2xl print:w-[210mm] print:max-w-[210mm] print:rounded-none print:shadow-none print:m-0 print:mt-0"},de={class:"px-6 pt-6 pb-4 border-b print:px-[12mm] print:pt-[10mm] print:pb-[4mm]"},ie={class:"mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm print:text-[12px]"},ce={class:"flex gap-2"},pe={class:"font-medium"},ue={key:0,class:"value-extra"},me={class:"flex gap-2"},_e={class:"value"},be={class:"value-text"},ye={class:"flex gap-2"},ve={class:"value"},ge={class:"value-text"},xe={class:"px-6 pb-6 print:px-[12mm] print:pb-[12mm] overflow-x-auto print:overflow-visible"},he={class:"w-full border border-gray-800 text-[13px] print:text-[12px]",style:{"border-collapse":"collapse"}},fe={key:0},ke={key:1},Ce={colspan:"6",class:"border border-gray-800 text-center py-6 text-red-600"},Se={key:2},Ne={class:"border border-gray-800 px-2 py-1 align-top tabular-nums"},we=["rowspan"],Ee={class:"text-xs"},Te={class:"border border-gray-800 px-2 py-1"},De={class:"font-medium"},Ie={class:"text-[11px] text-gray-700 mt-0.5"},Le={key:0,class:"text-gray-500 print:hidden"},Pe={key:1,class:"ml-2 text-amber-700"},Re={class:"border border-gray-800 px-2 py-1"},Ae={class:"inline-block min-w-[22mm] text-center font-semibold"},Be={class:"border border-gray-800 px-2 py-1"},Me={class:"whitespace-pre-line"},Ge={class:"border border-gray-800 px-2 py-1"},Ue={key:0,class:"text-[11px] text-gray-600 mt-0.5"},Ve={class:"border border-gray-800 px-2 py-1 print:hidden"},Oe=["title","aria-label"],Fe={__name:"UserClearanceModal",props:{user:{type:Object,required:!0},open:{type:Boolean,default:!1},buttonClass:{type:String,default:"px-3 py-1.5 rounded-md bg-indigo-600 text-white hover:bg-indigo-700"},hideTrigger:{type:Boolean,default:!1}},emits:["update:open"],setup(g,{emit:N}){const d=g,w=N,b=C({get:()=>d.open,set:e=>w("update:open",e)}),u=re(),{items:i,loading:y,error:D,currentUserInfo:l}=X(u),R=C(()=>{var e,t,r;return((e=l==null?void 0:l.value)==null?void 0:e.name)||((t=d.user)==null?void 0:t.name)||`#${(r=d.user)==null?void 0:r.id}`}),I=C(()=>{var e,t;return((e=l==null?void 0:l.value)==null?void 0:e.employee_id)||((t=d.user)==null?void 0:t.employee_id)||""}),v=C(()=>{var e,t,r,m;return((t=(e=l==null?void 0:l.value)==null?void 0:e.department)==null?void 0:t.name)||((m=(r=d.user)==null?void 0:r.department)==null?void 0:m.name)||""}),L=C(()=>{var e,t,r,m;return((t=(e=l==null?void 0:l.value)==null?void 0:e.designation)==null?void 0:t.title)||((m=(r=d.user)==null?void 0:r.designation)==null?void 0:m.title)||""});function n(){b.value=!0}function S(){b.value=!1}function k(e){e.key==="Escape"&&S()}const P=async()=>{var e,t,r;(e=d.user)!=null&&e.id&&((t=u.setUser)==null||t.call(u,d.user.id),await((r=u.fetch)==null?void 0:r.call(u)))};O(b,e=>{e?(P(),window.addEventListener("keydown",k)):window.removeEventListener("keydown",k)},{immediate:!0}),O(()=>{var e;return(e=d.user)==null?void 0:e.id},(e,t)=>{e&&e!==t&&b.value&&P()}),Z(()=>window.removeEventListener("keydown",k));function E(e={}){const t=e.latest||null,r=(t==null?void 0:t.cleared_by)||null;return{id:e.template_item_id??e.id,template_item_id:e.template_item_id??e.id,label:e.label||e.template_item_name||e.item_key||`#${e.template_item_id??e.id}`,order_no:e.order_no??e.template_order_no??0,handover_to:e.handover_to||"departmental_incharge",handover_by:e.handover_user||"departmental_incharge",show_receiver:!!e.show_receiver,is_cleared:!!e.is_cleared,missing:!!e.missing,status:(t==null?void 0:t.status)??null,handover_status:(t==null?void 0:t.handover_status)??null,present_condition:(t==null?void 0:t.present_condition)??"",receiver_name:e.show_receiver?(t==null?void 0:t.receiver_name)??"":"",remarks:(t==null?void 0:t.remarks)??"",cleared_by_user:r?{id:r.id,name:r.name}:null,cleared_at:(t==null?void 0:t.cleared_at)||null}}const H={departmental_incharge:"Departmental In-charge",technical_support_team:"Technical Support Team",it_incharge:"IT In-charge",hr_department:"HR Department",inventory_incharge:"Inventory In-charge"},U=["Departmental In-charge","Technical Support Team","IT In-charge","HR Department","Inventory In-charge"];function j(e){const t=String((e==null?void 0:e.handover_to)||"").toLowerCase();return H[t]||"Departmental In-charge"}const K=C(()=>(Array.isArray(i==null?void 0:i.value)?i.value:[]).map(E)),V=C(()=>{var m;const e=new Map(U.map(a=>[a,[]]));for(const a of K.value)(m=e.get(j(a)))==null||m.push(a);for(const[,a]of e.entries())a.sort((_,x)=>(_.order_no??_.template_item_id??_.id??0)-(x.order_no??x.template_item_id??x.id??0));const t=[];let r=1;for(const a of U){const _=e.get(a)||[];_.length&&_.forEach((x,W)=>t.push({sl:r++,group:a,isGroupFirst:W===0,groupSpan:_.length,row:x}))}return t});function z(e){const t=String(e??"").trim().toLowerCase();return["y","yes","true","1","done","cleared","complete","completed","yes.","yes,"].includes(t)?"Yes":["n","no","false","0","pending","not done","incomplete","no.","no,","rejected"].includes(t)?"No":"—"}async function Y(){document.body.classList.add("print-modal"),await se(),window.print(),setTimeout(()=>document.body.classList.remove("print-modal"),0)}const T={PENDING:{label:"Pending",pill:"bg-amber-50 text-amber-800 border-amber-200",dot:"bg-amber-500"},WORKING:{label:"Working",pill:"bg-sky-50 text-sky-800 border-sky-200",dot:"bg-sky-500"},COMPLETED:{label:"Completed",pill:"bg-emerald-50 text-emerald-800 border-emerald-200",dot:"bg-emerald-500"}};function A(e){var r;if(e!=null&&e.missing)return"Pending";const t=String((e==null?void 0:e.status)||"").toUpperCase();return((r=T[t])==null?void 0:r.label)||(e==null?void 0:e.status)||"—"}function $(e){var r;if(e!=null&&e.missing)return T.PENDING.pill;const t=String((e==null?void 0:e.status)||"").toUpperCase();return((r=T[t])==null?void 0:r.pill)||"bg-slate-50 text-slate-700 border-slate-200"}function q(e){var r;if(e!=null&&e.missing)return T.PENDING.dot;const t=String((e==null?void 0:e.status)||"").toUpperCase();return((r=T[t])==null?void 0:r.dot)||"bg-slate-400"}return(e,t)=>{var r,m;return p(),c(F,null,[g.hideTrigger?f("",!0):(p(),c("button",{key:0,class:B(g.buttonClass),onClick:n},"View Clearance",2)),b.value?(p(),c("div",ne,[s("div",{class:"absolute inset-0 bg-black/50 print:hidden",onClick:S}),s("div",oe,[s("div",le,[s("div",de,[t[3]||(t[3]=s("div",{class:"text-center"},[s("h1",{class:"text-2xl font-extrabold tracking-wide print:text-[20px]"},"GENESIS PG ORIENTATION CENTRE"),s("p",{class:"text-sm text-gray-600 print:text-[12px]"},"230, New Elephant Road, Katabon Mor, Dhaka-1205")],-1)),s("div",ie,[s("div",ce,[t[0]||(t[0]=s("span",{class:"label"},"Name:",-1)),s("span",null,[s("span",pe,o(R.value),1),I.value?(p(),c("span",ue,"(ID: "+o(I.value)+")",1)):f("",!0)])]),s("div",me,[t[1]||(t[1]=s("span",{class:"label"},"Department:",-1)),s("span",_e,[s("span",be,o(v.value||"—"),1)])]),s("div",ye,[t[2]||(t[2]=s("span",{class:"label"},"Post:",-1)),s("span",ve,[s("span",ge,o(L.value||"—"),1)])])]),t[4]||(t[4]=s("div",{class:"mt-4 text-center"},[s("h2",{class:"inline-block text-base font-semibold px-4 py-1 border rounded print:text-[13px]"}," Employment Resignation Checklist ")],-1))]),s("div",{class:"px-6 py-3 flex justify-end gap-2 print:hidden"},[s("button",{class:"rounded border px-3 py-1.5 hover:bg-gray-50",onClick:Y},"Print"),s("button",{class:"rounded bg-gray-900 px-3 py-1.5 text-white hover:bg-gray-800",onClick:S},"Close")]),s("div",xe,[s("table",he,[t[8]||(t[8]=s("thead",null,[s("tr",{class:"bg-gray-100"},[s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[14mm]"},"S. L."),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[30mm]"},"Handover To"),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[70mm]"},[M(" Particulars "),s("span",{class:"block text-[11px] text-gray-600"},"Cleared by")]),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[30mm]"},"Handed over (Yes/No)"),s("th",{class:"border border-gray-800 text-left px-2 py-1"},"Present Conditions (note please)"),s("th",{class:"border border-gray-800 text-left px-2 py-1 w-[42mm]"},"Receiver’s Name"),s("th",{class:"border border-gray-800 text-left px-2 py-1 print:hidden"},"Status")])],-1)),s("tbody",null,[(r=G(y))!=null&&r.value?(p(),c("tr",fe,t[5]||(t[5]=[s("td",{colspan:"6",class:"border border-gray-800 text-center py-6 text-gray-600"},"Loading…",-1)]))):(m=G(D))!=null&&m.value?(p(),c("tr",ke,[s("td",Ce,o(G(D).value),1)])):V.value.length?f("",!0):(p(),c("tr",Se,t[6]||(t[6]=[s("td",{colspan:"6",class:"border border-gray-800 text-center py-6 text-gray-600"},"No items found",-1)]))),(p(!0),c(F,null,te(V.value,a=>{var _,x;return p(),c("tr",{key:a.row.template_item_id,class:"align-top"},[s("td",Ne,o(a.sl)+".",1),a.isGroupFirst?(p(),c("td",{key:0,rowspan:a.groupSpan,class:"border border-gray-800 px-2 py-1 align-top font-medium"},[s("span",Ee,o(a.group),1)],8,we)):f("",!0),s("td",Te,[s("div",De,o(a.row.label),1),s("div",Ie,[t[7]||(t[7]=M(" Cleared by: ")),s("strong",null,o(((_=a.row.cleared_by_user)==null?void 0:_.name)||((x=a.row.cleared_by_user)!=null&&x.id?"#"+a.row.cleared_by_user.id:"—")),1),a.row.cleared_at?(p(),c("span",Le," ("+o(new Date(a.row.cleared_at).toLocaleString())+") ",1)):f("",!0),a.row.missing?(p(),c("span",Pe,"(pending)")):f("",!0)])]),s("td",Re,[s("span",Ae,o(z(a.row.handover_status)),1)]),s("td",Be,[s("div",Me,o(a.row.present_condition||"—"),1)]),s("td",Ge,[s("div",null,o(a.row.show_receiver&&a.row.receiver_name||"—"),1),a.row.remarks?(p(),c("div",Ue,o(a.row.remarks),1)):f("",!0)]),s("td",Ve,[s("span",{class:B(["inline-flex items-center gap-1.5 rounded-full border px-2 py-0.5 text-xs font-medium print:bg-white print:text-black print:border-black",$(a.row)]),title:a.row.missing?"Not cleared yet":"Status: "+A(a.row),"aria-label":A(a.row)},[s("span",{class:B(["h-1.5 w-1.5 rounded-full",q(a.row)])},null,2),M(" "+o(A(a.row)),1)],10,Oe)])])}),128))])]),t[9]||(t[9]=ee('<div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm print:text-[12px]" data-v-56201222><div class="border-gray-800 pt-6 text-center" data-v-56201222><div class="font-medium" data-v-56201222>User Signature</div></div><div class="border-gray-800 pt-6 text-center" data-v-56201222><div class="font-medium" data-v-56201222>Received by Head of HR</div></div><div class="border-gray-800 pt-6 text-center" data-v-56201222><div class="font-medium" data-v-56201222>Verified by ACC/CC</div></div></div>',1))])])])])):f("",!0)],64)}}},Ke=ae(Fe,[["__scopeId","data-v-56201222"]]);export{Ke as U};
