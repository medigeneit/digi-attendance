import{r as k,s as q,K as U,A as N,b as D,o as r,c as n,a as t,t as i,w as I,d as z,v as K,m as x,h as w,F as j,x as F,e as b,y as G,j as H,g as J}from"./index-sXQkeW_e.js";import{_ as O}from"./MultiselectDropdown-DsLXK739.js";import{u as P}from"./department-Bt9FNvHL.js";import{u as Q}from"./user-CGAAXV1k.js";import{a as W,_ as X}from"./HeaderWithButtons-z-zxHzlk.js";import{L as Y}from"./LoaderView-DXrqmNPg.js";import{u as Z}from"./leave-approval-D2pyp4mm.js";import"./vue-multiselect.esm-EKbgZV3y.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const A={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},ee={class:"bg-white rounded-lg shadow-lg w-full max-w-lg"},te={class:"px-6 py-4 border-b"},se={class:"text-lg font-bold capitalize"},oe={key:0},ae=["for"],re={class:"flex justify-end space-x-4"},ne={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"},le={__name:"LeaveApprovalModal",props:{show:{type:Boolean,required:!0},leaveApproval:{type:Object,default:null},approvalType:{type:String,default:"leave"}},emits:["close","save"],setup(v,{emit:$}){const d=v,c=$,_=k(null),p=Q(),h=P(),{departments:m}=q(h),f=k(!1),l=U({id:null,name:"",department_id:"",in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),u=U({in_charge_user_id:null,coordinator_user_id:null,operational_admin_user_id:null,recommend_by_user_id:null,approved_by_user_id:null}),C=()=>{Object.keys(u).forEach(e=>{u[e]=p.users.find(a=>a.id===l[e])||null})};Object.keys(u).forEach(e=>{N(()=>u[e],a=>{console.log(a),l[e]=a?a.id:null})});const g=()=>{Object.assign(l,{id:null,name:"",department_id:"",in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),f.value=!1},M=()=>{Object.assign(u,{in_charge_user_id:"",coordinator_user_id:"",operational_admin_user_id:"",recommend_by_user_id:"",approved_by_user_id:""}),f.value=!1};N(()=>d.leaveApproval,e=>{e?(f.value=!0,Object.assign(l,e),C()):(g(),M())},{immediate:!0,deep:!0}),N(()=>_.value,e=>{l.department_id=(e==null?void 0:e.id)||null});const S=()=>{if(!l.name||!l.approved_by_user_id){alert("Name and Approved By are required!");return}c("save",{...l}),o()},o=()=>{g(),c("close")};return D(()=>{p.fetchUsers(),h.fetchDepartments()}),(e,a)=>v.show?(r(),n("div",A,[t("div",ee,[t("div",te,[t("h3",se,i(f.value?"Edit":"Add")+" "+i(v.approvalType)+" Approval ",1)]),t("form",{onSubmit:I(S,["prevent"]),class:"p-6 space-y-4"},[t("div",null,[a[2]||(a[2]=t("label",{for:"name",class:"block text-sm font-medium"},"Approval Name",-1)),z(t("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=s=>l.name=s),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter approval name",required:""},null,512),[[K,l.name]])]),x(O,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=s=>_.value=s),multiple:!1,label:"name",options:w(m),placeholder:"Choose department"},null,8,["modelValue","options"]),(r(),n(j,null,F({in_charge_user_id:"In-Charge",coordinator_user_id:"Coordinator",operational_admin_user_id:"Operational Admin",recommend_by_user_id:"Recommend By",approved_by_user_id:"Approved By"},(s,y)=>(r(),n(j,{key:y},[v.approvalType==="leave"||!["coordinator_user_id","operational_admin_user_id"].includes(y)?(r(),n("div",oe,[t("label",{for:y,class:"block text-sm font-medium"},i(s),9,ae),x(O,{modelValue:u[y],"onUpdate:modelValue":L=>u[y]=L,multiple:!1,label:"name",options:w(p).users},null,8,["modelValue","onUpdate:modelValue","options"])])):b("",!0)],64))),64)),t("div",re,[t("button",{type:"button",onClick:o,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400"}," Cancel "),t("button",ne,i(f.value?"Update":"Create"),1)])],32)])])):b("",!0)}},de={class:"my-container space-y-2"},ie={class:"overflow-x-auto"},ue={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ce={class:"bg-gray-200 text-gray-700 text-sm leading-normal"},_e={key:0,class:"py-3 px-2 text-left"},me={key:1,class:"py-3 px-2 text-left"},pe={class:"text-gray-600 text-sm"},ye={key:0},fe={colspan:"8"},he={class:"py-3 px-2 text-left"},xe={class:"py-3 px-2 text-left"},be={class:"py-3 px-2 text-left"},ve={key:0,class:"py-3 px-2 text-left"},ge={key:1,class:"py-3 px-2 text-left"},ke={class:"py-3 px-2 text-left"},we={class:"py-3 px-2 text-left"},Le={class:"py-3 px-2 text-center"},$e={class:"flex justify-center gap-4"},Ce=["onClick"],Me=["onClick"],Se={key:2},Fe={__name:"LeaveApprovalList",setup(v){const $=J(),d=G(()=>$.currentRoute.value.name==="LeaveApprovalList"?"leave":"other"),c=Z(),_=H(),p=k(!1),h=k(!1),m=k(null),f=()=>{m.value=null,p.value=!0},l=o=>{m.value={...o},p.value=!0},u=()=>{p.value=!1},C=o=>{m.value=o,h.value=!0},g=()=>{h.value=!1},M=async()=>{var o;if(!((o=m.value)!=null&&o.id)){_.error("Invalid leave approval selected for deletion!");return}try{await c.deleteLeaveApproval(m.value.id),_.success("Leave approval deleted successfully!")}catch(e){_.error("Failed to delete leave approval!"),console.error("Error deleting leave approval:",e)}finally{g()}},S=async o=>{o.id||(o={...o,type:d.value});const e=o.id?"updateLeaveApproval":"createLeaveApproval",a=o.id?"Leave approval updated successfully!":"Leave approval added successfully!";try{await c[e](o.id||o,o),_.success(a)}catch(s){_.error("Failed to save leave approval!"),console.error("Error saving leave approval:",s)}finally{u()}};return D(()=>{c.fetchLeaveApprovals({type:d.value})}),(o,e)=>{var a;return r(),n("div",de,[x(W,{title:`${d.value} Approvals`,onAdd:f},null,8,["title"]),t("div",ie,[t("table",ue,[t("thead",null,[t("tr",ce,[e[0]||(e[0]=t("th",{class:"py-3 px-2 text-left"},"Name",-1)),e[1]||(e[1]=t("th",{class:"py-3 px-2 text-left"},"Department",-1)),e[2]||(e[2]=t("th",{class:"py-3 px-2 text-left"},"In-Charge",-1)),d.value==="leave"?(r(),n("th",_e,"Coordinator")):b("",!0),d.value==="leave"?(r(),n("th",me,"Operational Admin")):b("",!0),e[3]||(e[3]=t("th",{class:"py-3 px-2 text-left"},"Recommend By",-1)),e[4]||(e[4]=t("th",{class:"py-3 px-2 text-left"},"Approved By",-1)),e[5]||(e[5]=t("th",{class:"py-3 px-2 text-center"},"Actions",-1))])]),t("tbody",pe,[w(c).loading?(r(),n("tr",ye,[t("td",fe,[x(Y,{class:"shadow-none"})])])):w(c).leaveApprovals.length?(r(!0),n(j,{key:1},F(w(c).leaveApprovals,s=>{var y,L,V,B,E,T;return r(),n("tr",{key:s.id,class:"border-b border-gray-200 hover:bg-blue-200"},[t("td",he,i(s==null?void 0:s.name),1),t("td",xe,i((y=s==null?void 0:s.department)==null?void 0:y.name),1),t("td",be,i(((L=s==null?void 0:s.in_charge_user)==null?void 0:L.name)||"N/A"),1),d.value==="leave"?(r(),n("td",ve,i(((V=s==null?void 0:s.coordinator_user)==null?void 0:V.name)||"N/A"),1)):b("",!0),d.value==="leave"?(r(),n("td",ge,i(((B=s==null?void 0:s.operational_admin_user)==null?void 0:B.name)||"N/A"),1)):b("",!0),t("td",ke,i(((E=s==null?void 0:s.recommend_by_user)==null?void 0:E.name)||"N/A"),1),t("td",we,i(((T=s==null?void 0:s.approved_by_user)==null?void 0:T.name)||"N/A"),1),t("td",Le,[t("div",$e,[t("button",{onClick:R=>l(s),class:"text-blue-600 hover:text-blue-800"},e[6]||(e[6]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ce),t("button",{onClick:R=>C(s),class:"text-red-600 hover:text-red-800"},e[7]||(e[7]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Me)])])])}),128)):(r(),n("tr",Se,e[8]||(e[8]=[t("td",{colspan:"8",class:"text-center text-red-500 py-4"},"No leave approvals found",-1)])))])])]),x(le,{show:p.value,leaveApproval:m.value,approvalType:d.value,onClose:u,onSave:S},null,8,["show","leaveApproval","approvalType"]),x(X,{show:h.value,title:`Delete ${d.value} Approval`,message:`Are you sure you want to delete ${(a=m.value)==null?void 0:a.name}?`,onClose:g,onConfirm:M},null,8,["show","title","message"])])}}};export{Fe as default};
