import{_ as Q}from"./CommentModal-D8Ddgp1d.js";import{_ as W}from"./DraggableList.vue_vue_type_script_setup_true_lang-CX4w7YNd.js";import{L as X}from"./LoaderView-B4ey7ILm.js";import{O as x}from"./OverlyModal-B6DJ-jKF.js";import{_ as Y}from"./TaskAddForm-BJy5gzPp.js";import{_ as Z}from"./TaskEditForm-DHB7op_K.js";import{_ as ee,a as se}from"./UserWiseList-Ca_bdQ2_.js";import{_ as te}from"./TaskTreeViewWithSubTable-DtvzHkFi.js";import{_ as ae}from"./TaskUserAssignForm-dG1V4BQH.js";import{u as oe}from"./task-priority-BR5oEV-p.js";import{m as re}from"./task-tree-BSa8lNqK.js";import{d as ne,b as ie,u as le,r as m,x as A,z as N,e as de,A as ue,O as me,c,o as r,f,g as v,n as g,a as M,i as C,k as o,F as ke,y as pe,t as H}from"./index-CqAksBNS.js";import{u as ye}from"./useTaskStore-7Z5pTEJ6.js";import"./useCommentStore-Nk5X9-f1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-Cgpn10hq.js";import"./company-CsM8a50S.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-BWcSg45C.js";import"./SelectDropdown-J3YuZeAq.js";import"./SectionLoading-D7tK76E9.js";import"./TextWithHr-Bn1Q_eho.js";import"./TaskUrgencyInput-A0hL916L.js";import"./datetime-DcVwRp76.js";import"./tags-BS1nwVQ_.js";import"./MultiselectDropdown-BxLdtlDl.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-CC0J4iwA.js";import"./task-YuBvlLw0.js";import"./EmployeeDropdownInput-B1vjU1y6.js";import"./UserChip-BRd62vH2.js";import"./TaskSupervisorAndEmployee-CF8M_EAL.js";import"./TaskStatus-CD0_98GY.js";import"./user-CuICE8D6.js";import"./TaskUserChip-DctSmnnU.js";const ce={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},fe={class:"mb-4"},ve={class:"relative min-h-[26vh]"},ge={key:0,class:"text-center py-4 text-red-500"},Te={key:1},Ie={class:"flex items-stretched"},Ce={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},_e=1,os={__name:"TaskList",setup(we){const n=ye(),i=ne(),t=ie(),L=le(),l=m(""),_=m(!1),w=m(null),R=A(()=>{var s;return((s=i==null?void 0:i.user)==null?void 0:s.role)==="employee"||!(i!=null&&i.isAdminMood)?!0:!!t.query["user-ids"]}),k=m(null),I=m(!1),T=N({parentId:0,requirementId:0}),d=N({taskId:0,isOpen:!1}),h=m(null),U=m([]),{handleItemsPriorityUpdate:z,saveTaskPriority:j,listHasRearranged:S}=oe(()=>n.taskListTree,0);de(async()=>{console.log("Task List Mounted"),l.value="loading",t.query.status||L.push({query:{...t.query,status:"not-completed"}}),await y()});let p;async function y(){let s;p=new AbortController,console.log({taskAbortController:p}),t.name==="MyTaskList"?s=await n.fetchMyTasks({...t.query,page:1},{signal:p.signal}):s=await n.fetchTasks({...t.query,page:1},{signal:p.signal}),l.value="",U.value=s.query_log||[]}const b=s=>{I.value=!0,T.parentId=s},$=s=>{d.taskId=s,d.isOpen=!0},F=s=>{w.value=s,_.value=!0},G=()=>{_.value=!1,w.value=null};async function O(){k.value=null,I.value=!1,T.parentId=0,l.value="loading",await y()}async function J(){I.value=!1,T.parentId=0,await y()}async function K(){l.value="loading",await j()&&await y()}ue(()=>({...t.query}),async()=>{try{n.resetTaskList(),l.value="loading",await y()}catch{console.warn("...")}});const V=A({get(){return{...t.query}},set(s){localStorage.removeItem("sub_task_opened_list"),L.push({query:{...s}})}}),B=A(()=>{var e;const s={...t.query};return t.name=="MyTaskList"&&(s["user-ids"]=(e=i==null?void 0:i.user)==null?void 0:e.id),Array.isArray(n.tasks)?re(n.tasks,s):[]});return me(()=>{n.tasks.value=null,p&&p.abort()}),(s,e)=>{var D,E,P;return r(),c("div",ce,[k.value?(r(),f(x,{key:0},{default:C(()=>[g(Z,{taskId:k.value,onClose:e[0]||(e[0]=a=>k.value=null),onUpdated:O},null,8,["taskId"])]),_:1})):v("",!0),I.value?(r(),f(x,{key:1},{default:C(()=>[g(Y,{parentTaskId:T.parentId,requirementId:T.requirementId,onClose:J,onTaskCreated:O},null,8,["parentTaskId","requirementId"])]),_:1})):v("",!0),d.isOpen?(r(),f(x,{key:2,class:"*:max-w-4xl"},{default:C(()=>[g(ae,{taskId:d.taskId,onCancelClick:e[1]||(e[1]=()=>{d.isOpen=!1,d.taskId=0}),onSuccess:e[2]||(e[2]=()=>{d.isOpen=!1,d.taskId=0,l.value="loading",y()})},null,8,["taskId"])]),_:1})):v("",!0),g(ee,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=a=>V.value=a),onClickAddTask:b,onClickPrioritySave:K,onClickPriorityDiscard:e[4]||(e[4]=()=>o(S)?h.value.resetItems:null),"list-has-rearranged":o(S),isMyTask:o(t).name==="MyTaskList"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((E=(D=o(t))==null?void 0:D.query)==null?void 0:E["query-log"])=="true"?(r(!0),c(ke,{key:3},pe(U.value,(a,q)=>(r(),c("div",{key:q,class:"text-xs text-gray-500"},[M("div",fe,H(a.raw_query),1)]))),128)):v("",!0),M("div",ve,[o(n).error?(r(),c("div",ge,H(o(n).error),1)):o(n).tasks.length>0?(r(),c("div",Te,[((P=o(t).query)==null?void 0:P.view)=="userwise"?(r(),f(se,{key:0,tasks:B.value,selectedUserId:o(t).query["user-ids"],isMyTask:o(t).name==="MyTaskList",onCommentButtonClick:e[5]||(e[5]=a=>F(a,s.task.id)),onEditClick:e[6]||(e[6]=a=>k.value=a),onAddClick:e[7]||(e[7]=a=>b(a)),onEmployeeAssignClick:e[8]||(e[8]=a=>$(a))},null,8,["tasks","selectedUserId","isMyTask"])):(r(),f(W,{key:1,items:B.value,handle:"handle",onItemsUpdate:o(z),class:"space-y-6",ref_key:"draggableTaskList",ref:h},{item:C(({item:a,index:q})=>[M("div",Ie,[g(te,{isMyTask:o(t).name==="MyTaskList",task:a,index:q,showDraggableHandle:!R.value,onCommentButtonClick:e[9]||(e[9]=u=>F(u,s.task.id)),onEditClick:e[10]||(e[10]=u=>k.value=u),onAddClick:e[11]||(e[11]=u=>b(u)),onEmployeeAssignClick:e[12]||(e[12]=u=>$(u)),class:"!border-0 shadow hover:shadow-md"},null,8,["isMyTask","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):l.value!=="loading"?(r(),c("div",Ce," No tasks found. ")):v("",!0),l.value==="loading"?(r(),f(X,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):v("",!0)]),g(Q,{show:_.value,"commentable-id":w.value,"commentable-type":"task","user-id":_e,"on-close":G,onSubmitted:o(n).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{os as default};
