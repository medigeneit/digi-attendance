import{q as S,c,o as l,a as t,F as $,y as U,f as b,l as _,_ as K,t as x,s as X,b as Y,u as Z,r as v,D as ee,e as se,A as M,m as q,p as A,g as te,C as ae,h as u,w as R}from"./index-CJiD8-Yn.js";import{_ as ne}from"./CommentModal-D3IHQ5nl.js";import{g as le,u as oe,O as H,_ as re}from"./task-priority-B5Pl1T5q.js";import{_ as ie}from"./MultiselectDropdown-D8izVydp.js";import{_ as de}from"./TaskAddForm-CuWbwjHE.js";import{_ as ue}from"./TaskEditForm-CYMcrau4.js";import{_ as N}from"./TaskTreeView-jWRH_f3A.js";import{u as ce}from"./company-kNriZLhP.js";import{u as me}from"./useTaskStore-Ckrq_MDk.js";import"./useCommentStore-Bab-Nsd-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-Cqd04vg6.js";import"./useRequirementStore-D5fukcRD.js";import"./SectionLoading-Bji4oAOJ.js";const pe={class:"w-full bg-white rounded"},fe=["rowspan"],ye={class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm"},ve={class:"text-xs text-gray-700 mr-2 hidden md:inline"},_e={class:"border p-4"},ke={class:""},he={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},setup(V){const i=V,k=S(()=>i.tasks.reduce((s,f)=>(s.push(...f.users.filter(a=>!s.find(r=>r.id==a.id&&a.id))),s),[]).filter(s=>i.selectedUserId?s.id==i.selectedUserId:!0)),L=s=>{const f=i.tasks,a=new Map(f.map(o=>[o.id,o])),r=new Set,m=[],T=f.filter(o=>o.users.some(p=>p.id===s));for(const o of T){r.has(o.id)||(r.add(o.id),m.push(o));let p=o.parent_id;for(;p&&a.has(p)&&!r.has(p);){const y=a.get(p);r.add(y.id),m.push(y),p=y.parent_id}}return m},I=S(()=>k.value.map(s=>{const f=le(L(s.id),0);return{...s,tasks:f}}));return(s,f)=>(l(),c("div",null,[t("table",pe,[t("tbody",null,[(l(!0),c($,null,U(I.value,a=>(l(),c($,{key:a.id},[(l(!0),c($,null,U(a.tasks,(r,m)=>(l(),c("tr",{key:r.id},[m==0?(l(),c("td",{key:0,class:"border p-4 align-top",rowspan:Math.max(a.tasks.length,1)},[t("div",ye,[_(K,{user:a,class:"w-6 h-6 !text-xs"},null,8,["user"]),t("span",ve,x(a.id)+" - "+x(a==null?void 0:a.name),1)])],8,fe)):b("",!0),t("td",_e,x(m+1),1),t("td",ke,[_(N,{task:r,class:"!border-0"},null,8,["task"])])]))),128))],64))),128))])])]))}},ge={class:"container mx-auto p-6 relative"},we={class:"mb-3"},be={class:"flex flex-wrap items-center gap-2 mt-3"},xe={class:"flex gap-4"},Ie={class:"flex-shrink-0 w-full md:w-64 text-gray-600"},Te=["value"],Ce={class:"ml-auto flex gap-6 items-center"},qe={key:0,class:"flex gap-2 items-center"},$e={key:2,class:"text-center py-4 text-red-500"},Se={class:"space-y-4"},Le=1,Ge={__name:"TaskList",setup(V){const i=me(),k=ce(),{companies:L,employees:I}=X(k),s=Y(),f=Z(),a=v(!1),r=v(null),m=S(P("company-id")),T=S(P("user-id")),o=v(),p=v(!1),y=v(null),C=v(!1),h=ee({parentId:0,requirementId:0}),D=v(null);se(async()=>{await k.fetchCompanies(),await g()});const B=n=>{C.value=!0,h.parentId=n};function P(n){return{set:e=>{f.push({query:{...s.query,[n]:e||void 0}})},get:()=>s.query[n]||""}}const O=n=>{r.value=n,a.value=!0},j=()=>{a.value=!1,r.value=null};M(()=>m.value,async n=>{n&&(await k.fetchEmployee(n),o.value=I.value.find(e=>e.id==T.value)||null)},{initial:!0,immediate:!0}),M(()=>({"user-id":s.query["user-id"],"company-id":s.query["company-id"]}),async()=>{g()});async function g(){p.value=!!s.query["user-id"],await i.fetchTasks({user_ids:s.query["user-id"]||void 0,company_id:s.query["company-id"]||void 0},{loadingBeforeFetch:!0})}async function E(){y.value=null,C.value=!1,h.parentId=0,await g()}async function G(){C.value=!1,h.parentId=0,await g()}M(o,n=>{T.value=n==null?void 0:n.id});const{handleItemsPriorityUpdate:Q,saveTaskPriority:W,listHasRearranged:z}=oe(()=>i.taskListTree,0);async function J(){W()&&await g()}return(n,e)=>{var F;return l(),c("div",ge,[y.value?(l(),q(H,{key:0},{default:A(()=>[_(ue,{taskId:y.value,class:"rounded-full",onClose:e[0]||(e[0]=d=>y.value=null),onUpdated:E},null,8,["taskId"])]),_:1})):b("",!0),C.value?(l(),q(H,{key:1},{default:A(()=>[_(de,{parentTaskId:h.parentId,requirementId:h.requirementId,class:"rounded-full",onClose:G,onTaskCreated:E},null,8,["parentTaskId","requirementId"])]),_:1})):b("",!0),t("div",we,[e[9]||(e[9]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),t("div",be,[t("div",xe,[t("div",Ie,[te(t("select",{id:"company-filter","onUpdate:modelValue":e[1]||(e[1]=d=>m.value=d),class:"input-1 h-full"},[e[7]||(e[7]=t("option",{value:""},"Select Company",-1)),(l(!0),c($,null,U(u(L),d=>(l(),c("option",{key:d.id,value:d.id},x(d.name),9,Te))),128))],512),[[ae,m.value]])]),_(ie,{modelValue:o.value,"onUpdate:modelValue":e[2]||(e[2]=d=>o.value=d),options:u(I),multiple:!1,label:"name","label-prefix":"id",placeholder:"Please select employee...",class:"w-full md:w-64 text-gray-600"},null,8,["modelValue","options"])]),t("div",Ce,[u(z)?(l(),c("div",qe,[e[8]||(e[8]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:R(J,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:e[3]||(e[3]=R((...d)=>D.value.resetItems&&D.value.resetItems(...d),["prevent"]))},"Discard")])):b("",!0),t("button",{onClick:B,class:"btn-1"},"Add Task")])])]),u(i).error?(l(),c("div",$e,x(u(i).error),1)):b("",!0),t("div",Se,[((F=u(s).query)==null?void 0:F.view)=="userwise"?(l(),q(he,{key:0,tasks:u(i).tasks,selectedUserId:u(s).query["user-id"]},null,8,["tasks","selectedUserId"])):(l(),q(re,{key:1,items:u(i).taskListTree,handle:"handle",onItemsUpdate:u(Q),class:"space-y-4",ref_key:"draggableTaskList",ref:D},{item:A(({item:d})=>[_(N,{task:d,class:"!border-0",onCommentButtonClick:e[4]||(e[4]=w=>O(w,n.task.id)),onEditClick:e[5]||(e[5]=w=>y.value=w),onAddClick:e[6]||(e[6]=w=>B(w)),showDraggableHandle:!p.value},null,8,["task","showDraggableHandle"])]),_:1},8,["items","onItemsUpdate"]))]),_(ne,{show:a.value,"commentable-id":r.value,"commentable-type":"task","user-id":Le,"on-close":j,onSubmitted:u(i).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Ge as default};
