import{G as M,r as h,H as U,p as S,c as m,o as y,a as e,g as F,j as _,t as k,F as P,h as z,v as A,W as ne,x as N,n as le,z as ae,q as O,A as T,I as oe,a1 as j,e as ie,y as R,k as re}from"./index-CqqGhw3V.js";import{u as ue}from"./zk-device-CeGt9jAf.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as de}from"./HeaderWithButtons-mICCue_k.js";const K=M("zkUser",()=>{const u=h([]),x=h(!1),c=h(null),o=(v,b)=>{var p,w;c.value=((w=(p=v==null?void 0:v.response)==null?void 0:p.data)==null?void 0:w.message)||(v==null?void 0:v.message)||b};async function n(){x.value=!0,c.value=null;try{const{data:v}=await U.get("/zk-users");return u.value=v,v}catch(v){return o(v,"ইউজার লোড ব্যর্থ"),[]}finally{x.value=!1}}async function d(v,b=25){var p;try{const{data:w}=await U.get("/zk-users/search",{params:{query:v,limit:b}});return w}catch(w){throw o(w,"সার্চ ব্যর্থ"),((p=w==null?void 0:w.response)==null?void 0:p.data)||w}}async function i(v){var b;try{const{data:p}=await U.post("/zk-users",v);return await n(),p}catch(p){throw o(p,"ইউজার তৈরিতে ব্যর্থ"),((b=p==null?void 0:p.response)==null?void 0:b.data)||p}}async function C(v,b){var p;try{const{data:w}=await U.put(`/zk-users/${encodeURIComponent(v)}`,b);return await n(),w}catch(w){throw o(w,"ইউজার আপডেট ব্যর্থ"),((p=w==null?void 0:w.response)==null?void 0:p.data)||w}}async function r(v){var b;try{const{data:p}=await U.delete(`/zk-users/${encodeURIComponent(v)}`);return await n(),p}catch(p){throw o(p,"ইউজার ডিলিট ব্যর্থ"),((b=p==null?void 0:p.response)==null?void 0:b.data)||p}}async function s(v){const{data:b}=await U.post(`/devices/${encodeURIComponent(v)}/pull-users`);return await n(),b}async function t(v){const{data:b}=await U.post(`/devices/${encodeURIComponent(v)}/push-users`);return b}async function l(v,b){const{data:p}=await U.post(`/devices/${encodeURIComponent(v)}/users/${encodeURIComponent(b)}/push`);return p}async function a(v){const{data:b}=await U.get(`/devices/${encodeURIComponent(v)}/user-count`);return b}async function g(v,b){const{data:p}=await U.delete(`/devices/${encodeURIComponent(v)}/users/${encodeURIComponent(b)}/remove`);return p}return{users:u,loading:x,error:c,fetchUsers:n,searchUsers:d,createUser:i,updateUser:C,deleteUser:r,pullUsersFromDevice:s,pushAllUsersToDevice:t,pushSingleUserToDevice:l,userCountOnDevice:a,removeUserFromDevice:g}}),ce=M("zkFinger",()=>{const u=h(!1),x=h(null),c=(s,t)=>{var l,a;x.value=((a=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:a.message)||(s==null?void 0:s.message)||t};async function o(s,{includeTemplate:t=!1}={}){var l;u.value=!0,x.value=null;try{const{data:a}=await U.get(`/zk-users/${encodeURIComponent(s)}/fingerprints`,{params:{include_template:t?1:0}});return a}catch(a){throw c(a,"ফিঙ্গারপ্রিন্ট লোড ব্যর্থ"),((l=a==null?void 0:a.response)==null?void 0:l.data)||a}finally{u.value=!1}}async function n(s,t){var l;u.value=!0,x.value=null;try{const{data:a}=await U.post(`/zk-users/${encodeURIComponent(s)}/fingerprints/upsert`,t);return a}catch(a){throw c(a,"ফিঙ্গারপ্রিন্ট আপসার্ট ব্যর্থ"),((l=a==null?void 0:a.response)==null?void 0:l.data)||a}finally{u.value=!1}}async function d(s){var t;u.value=!0,x.value=null;try{const{data:l}=await U.post(`/devices/${encodeURIComponent(s)}/pull-fingerprints`);return l}catch(l){throw c(l,"ডিভাইস থেকে ফিঙ্গার টানা ব্যর্থ"),((t=l==null?void 0:l.response)==null?void 0:t.data)||l}finally{u.value=!1}}async function i(s,t=[],{force:l=!1}={}){var a;u.value=!0,x.value=null;try{const g={user_ids:t,force:l},{data:v}=await U.post(`/devices/${encodeURIComponent(s)}/push-fingerprints`,g);return v}catch(g){throw c(g,"বাল্ক ফিঙ্গার পুশ ব্যর্থ"),((a=g==null?void 0:g.response)==null?void 0:a.data)||g}finally{u.value=!1}}async function C(s,t){var l;u.value=!0,x.value=null;try{const{data:a}=await U.post(`/devices/${encodeURIComponent(s)}/users/${encodeURIComponent(t)}/push-fingerprints`);return a}catch(a){throw c(a,"সিঙ্গেল ফিঙ্গার পুশ ব্যর্থ"),((l=a==null?void 0:a.response)==null?void 0:l.data)||a}finally{u.value=!1}}async function r(s,t,l){var a;u.value=!0,x.value=null;try{const{data:g}=await U.post(`/devices/${encodeURIComponent(s)}/fingerprints/remove`,{zk_userid:t,indexes:l});return g}catch(g){throw c(g,"ফিঙ্গারপ্রিন্ট রিমুভ ব্যর্থ"),((a=g==null?void 0:g.response)==null?void 0:a.data)||g}finally{u.value=!1}}return{loading:u,error:x,listFingerprints:o,upsertFingerprint:n,pullFingerprintsFromDevice:d,pushFingerprintsBulk:i,pushFingerprintsOne:C,removeFingerprints:r}}),ve={class:"bg-white border rounded-xl overflow-hidden"},pe={class:"p-3 border-b flex items-center gap-3"},fe={class:"text-sm text-slate-600"},me={class:"ml-auto flex items-center gap-2"},ye=["disabled"],be={key:0,class:"text-xs text-slate-500"},xe={class:"overflow-auto"},ge={class:"w-full text-sm"},we={class:"px-3 py-2 font-mono text-xs"},$e={class:"px-3 py-2"},he={class:"px-3 py-2"},ke={class:"px-3 py-2"},Ce={class:"px-3 py-2"},Ue={class:"px-3 py-2"},_e={class:"flex flex-wrap gap-2"},De=["onClick"],ze=["onClick"],Fe=["onClick"],Se=["onClick"],Re={key:0},Ae={__name:"UserTable",props:{items:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["edit","delete","push-one","remove-one"],setup(u,{emit:x}){const c=u,o=h("");function n(r){return Number(r)===14?"Admin":"User"}const d=S(()=>c.items.length),i=S(()=>{const r=o.value.trim().toLowerCase();return r?c.items.filter(s=>{const t=String((s==null?void 0:s.name)??"").toLowerCase(),l=String((s==null?void 0:s.zk_userid)??"").toLowerCase(),a=String((s==null?void 0:s.cardno)??"").toLowerCase();return t.includes(r)||l.includes(r)||a.includes(r)}):c.items});function C(){o.value=""}return(r,s)=>(y(),m("div",ve,[e("div",pe,[e("div",fe,[s[4]||(s[4]=_(" Total: ")),e("b",null,k(d.value),1),o.value?(y(),m(P,{key:0},[s[2]||(s[2]=e("span",{class:"text-slate-400"}," • ",-1)),s[3]||(s[3]=_(" Showing: ")),e("b",null,k(i.value.length),1)],64)):F("",!0)]),e("div",me,[z(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>o.value=t),onKeyup:s[1]||(s[1]=ne(()=>{},["enter"])),type:"text",placeholder:"Search name / enroll / card",class:"border rounded px-3 py-1.5 text-sm w-64"},null,544),[[A,o.value]]),e("button",{class:"btn-outline",onClick:C,disabled:!o.value},s[5]||(s[5]=[e("i",{class:"fas fa-times mr-1"},null,-1),_(" Clear ")]),8,ye)]),u.loading?(y(),m("div",be,s[6]||(s[6]=[e("i",{class:"fas fa-circle-notch fa-spin"},null,-1),_(" Loading… ")]))):F("",!0)]),e("div",xe,[e("table",ge,[s[12]||(s[12]=e("thead",{class:"text-left bg-slate-50"},[e("tr",null,[e("th",{class:"px-3 py-2 border-b"},"Enroll"),e("th",{class:"px-3 py-2 border-b"},"Name"),e("th",{class:"px-3 py-2 border-b"},"Role"),e("th",{class:"px-3 py-2 border-b"},"Card"),e("th",{class:"px-3 py-2 border-b"},"FPs"),e("th",{class:"px-3 py-2 border-b w-64"},"Actions")])],-1)),e("tbody",null,[(y(!0),m(P,null,N(i.value,t=>(y(),m("tr",{key:t.id,class:"border-b"},[e("td",we,k(t.zk_userid),1),e("td",$e,k(t.name),1),e("td",he,[e("span",{class:le([Number(t.role)===14?"bg-amber-100 text-amber-800":"bg-emerald-100 text-emerald-800","px-2 py-0.5 rounded text-xs"])},k(n(t.role)),3)]),e("td",ke,k(t.cardno??""),1),e("td",Ce,k(t.fingerprints_count??0),1),e("td",Ue,[e("div",_e,[e("button",{class:"btn",onClick:l=>r.$emit("edit",t)},s[7]||(s[7]=[e("i",{class:"fas fa-edit mr-1"},null,-1),_(" Edit ")]),8,De),e("button",{class:"btn",onClick:l=>r.$emit("delete",t)},s[8]||(s[8]=[e("i",{class:"fas fa-trash mr-1"},null,-1),_(" Delete ")]),8,ze),e("button",{class:"btn",onClick:l=>r.$emit("push-one",t)},s[9]||(s[9]=[e("i",{class:"fas fa-upload mr-1"},null,-1),_(" Push to Device ")]),8,Fe),e("button",{class:"btn",onClick:l=>r.$emit("remove-one",t)},s[10]||(s[10]=[e("i",{class:"fas fa-user-slash mr-1"},null,-1),_(" Remove from Device ")]),8,Se)])])]))),128)),i.value.length?F("",!0):(y(),m("tr",Re,s[11]||(s[11]=[e("td",{colspan:"6",class:"px-3 py-4 text-center text-slate-500"},"No users found",-1)])))])])])]))}},Ie=I(Ae,[["__scopeId","data-v-efccaac8"]]),Pe={key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/30"},Be={class:"bg-white rounded-xl shadow-lg w-[560px] max-w-[95vw]"},Ee={class:"px-4 py-3 border-b flex items-center justify-between"},Ne={class:"font-semibold"},Te={class:"p-4 space-y-3"},Ve={class:"grid grid-cols-2 gap-3"},Me=["readonly"],Oe={class:"flex items-center gap-2"},je={class:"px-4 py-3 border-t flex items-center justify-end gap-2"},Ke={__name:"UserFormModal",props:{show:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["close","save"],setup(u,{emit:x}){const c=u,o=x,n=ae({zk_userid:"",name:"",role:0,cardno:"",password:"",is_active:!0});O(()=>c.user,r=>{r?(n.zk_userid=r.zk_userid??"",n.name=r.name??"",n.role=Number(r.role??0),n.cardno=r.cardno??"",n.password="",n.is_active=r.is_active??!0):(n.zk_userid="",n.name="",n.role=0,n.cardno="",n.password="",n.is_active=!0)},{immediate:!0});const d=S(()=>!!c.user);function i(){o("close")}function C(){const r={zk_userid:n.zk_userid,name:n.name,role:Number(n.role),cardno:n.cardno||null,password:n.password||null,is_active:!!n.is_active};o("save",r)}return(r,s)=>u.show?(y(),m("div",Pe,[e("div",Be,[e("div",Ee,[e("div",Ne,k(d.value?"Edit User":"New User"),1),e("button",{class:"text-slate-500 hover:text-slate-800",onClick:i},s[6]||(s[6]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",Te,[e("div",Ve,[e("div",null,[s[7]||(s[7]=e("label",{class:"block text-xs text-slate-600 mb-1"},"Enroll (zk_userid)",-1)),z(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>n.zk_userid=t),readonly:d.value,type:"text",maxlength:"9",class:"border rounded px-3 py-1.5 w-full",placeholder:"e.g. 1001"},null,8,Me),[[A,n.zk_userid]])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block text-xs text-slate-600 mb-1"},"Name",-1)),z(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.name=t),type:"text",maxlength:"24",class:"border rounded px-3 py-1.5 w-full"},null,512),[[A,n.name]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-xs text-slate-600 mb-1"},"Role",-1)),z(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.role=t),class:"border rounded px-3 py-1.5 w-full"},s[9]||(s[9]=[e("option",{value:0},"User",-1),e("option",{value:14},"Admin",-1)]),512),[[T,n.role,void 0,{number:!0}]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-xs text-slate-600 mb-1"},"Card No",-1)),z(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>n.cardno=t),type:"text",class:"border rounded px-3 py-1.5 w-full"},null,512),[[A,n.cardno]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-xs text-slate-600 mb-1"},"Password",-1)),z(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>n.password=t),type:"text",maxlength:"8",class:"border rounded px-3 py-1.5 w-full",placeholder:"(optional)"},null,512),[[A,n.password]])]),e("div",Oe,[z(e("input",{id:"active","onUpdate:modelValue":s[5]||(s[5]=t=>n.is_active=t),type:"checkbox",class:"h-4 w-4"},null,512),[[oe,n.is_active]]),s[13]||(s[13]=e("label",{for:"active",class:"text-sm"},"Active",-1))])])]),e("div",je,[e("button",{class:"btn",onClick:i},"Cancel"),e("button",{class:"btn-primary",onClick:C},k(d.value?"Update":"Create"),1)])])])):F("",!0)}},Le=I(Ke,[["__scopeId","data-v-ffa7d03c"]]),Ze={key:0,class:"fixed inset-0 z-50 grid place-items-center bg-black/30"},qe={class:"bg-white rounded-xl shadow-lg w-[480px] max-w-[95vw]"},We={class:"px-4 py-3 border-b flex items-center justify-between"},Ge={class:"font-semibold"},He={class:"p-4 text-sm text-slate-700"},Je={class:"px-4 py-3 border-t flex items-center justify-end gap-2"},Qe={__name:"ConfirmModal",props:{show:{type:Boolean,default:!1},title:{type:String,default:"Confirm"},message:{type:String,default:"Are you sure?"}},emits:["close","confirm"],setup(u,{emit:x}){return(c,o)=>u.show?(y(),m("div",Ze,[e("div",qe,[e("div",We,[e("div",Ge,k(u.title),1),e("button",{class:"text-slate-500 hover:text-slate-800",onClick:o[0]||(o[0]=n=>c.$emit("close"))},o[3]||(o[3]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",He,k(u.message),1),e("div",Je,[e("button",{class:"btn",onClick:o[1]||(o[1]=n=>c.$emit("close"))},"Cancel"),e("button",{class:"btn-danger",onClick:o[2]||(o[2]=n=>c.$emit("confirm"))},"Confirm")])])])):F("",!0)}},Xe=I(Qe,[["__scopeId","data-v-56cdf847"]]),Ye={key:0,class:"fixed inset-0 z-[60] grid place-items-center bg-black/30"},es={class:"bg-white rounded-xl shadow-xl w-[520px] max-w-[95vw]"},ss={class:"px-4 py-3 border-b flex items-center justify-between"},ts={class:"font-semibold"},ns={class:"p-4 space-y-3 text-sm"},ls={class:"text-slate-600"},as={key:0},os={key:1},is=["value"],rs={class:"px-4 py-3 border-t flex items-center justify-end gap-2"},us=["disabled"],ds={key:0,class:"fas fa-user-slash"},cs={key:1,class:"fas fa-circle-notch fa-spin"},vs=["disabled"],ps={key:0,class:"fas fa-user-plus"},fs={key:1,class:"fas fa-circle-notch fa-spin"},ms=["disabled"],ys={key:0,class:"fas fa-fingerprint"},bs={key:1,class:"fas fa-circle-notch fa-spin"},xs={__name:"DeviceActionModal",props:{show:{type:Boolean,default:!1},mode:{type:String,default:"push"},user:{type:Object,default:null},devices:{type:Array,default:()=>[]},loadingUser:{type:Boolean,default:!1},loadingFp:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["close","confirm","confirm-user","confirm-fp"],setup(u,{emit:x}){const c=u,o=h(null);O(()=>c.show,d=>{d&&(o.value=null)});const n=S(()=>c.mode==="remove"?"Remove From Device":"Push To Device");return(d,i)=>{var C,r;return u.show?(y(),m("div",Ye,[e("div",es,[e("div",ss,[e("div",ts,k(n.value),1),e("button",{class:"text-slate-500 hover:text-slate-800",onClick:i[0]||(i[0]=s=>d.$emit("close"))},i[6]||(i[6]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",ns,[e("div",ls,[e("div",null,[i[7]||(i[7]=e("b",null,"User:",-1)),_(" "+k((C=u.user)==null?void 0:C.zk_userid)+" — "+k((r=u.user)==null?void 0:r.name),1)]),u.mode==="push"?(y(),m("div",as,"Select a device and choose what to push.")):(y(),m("div",os,i[8]||(i[8]=[_("Select a device to "),e("b",null,"remove",-1),_(" this user from.")])))]),e("div",null,[i[10]||(i[10]=e("label",{class:"block text-xs text-slate-600 mb-1"},"Device",-1)),z(e("select",{"onUpdate:modelValue":i[1]||(i[1]=s=>o.value=s),class:"border rounded px-3 py-2 w-full"},[i[9]||(i[9]=e("option",{value:null,disabled:""},"Select device",-1)),(y(!0),m(P,null,N(u.devices,s=>(y(),m("option",{key:s.id,value:s.id}," #"+k(s.id)+" — "+k(s.name)+" ("+k(s.ip_address)+":"+k(s.port)+") ",9,is))),128))],512),[[T,o.value]])]),i[11]||(i[11]=e("div",{class:"text-[12px] text-slate-500"}," Tip: Make sure the device is online and reachable. ",-1))]),e("div",rs,[e("button",{class:"btn",onClick:i[2]||(i[2]=s=>d.$emit("close"))},"Cancel"),u.mode==="remove"?(y(),m("button",{key:0,class:"btn-primary",disabled:!o.value||u.loading,onClick:i[3]||(i[3]=s=>d.$emit("confirm",o.value))},[u.loading?(y(),m("i",cs)):(y(),m("i",ds)),i[12]||(i[12]=e("span",{class:"ml-1"},"Confirm Remove",-1))],8,us)):(y(),m(P,{key:1},[e("button",{class:"btn-primary",disabled:!o.value||u.loadingUser,onClick:i[4]||(i[4]=s=>d.$emit("confirm-user",o.value))},[u.loadingUser?(y(),m("i",fs)):(y(),m("i",ps)),i[13]||(i[13]=e("span",{class:"ml-1"},"Push User",-1))],8,vs),e("button",{class:"btn-primary",disabled:!o.value||u.loadingFp,onClick:i[5]||(i[5]=s=>d.$emit("confirm-fp",o.value))},[u.loadingFp?(y(),m("i",bs)):(y(),m("i",ys)),i[14]||(i[14]=e("span",{class:"ml-1"},"Push Fingerprints",-1))],8,ms)],64))])])])):F("",!0)}}},gs=I(xs,[["__scopeId","data-v-b4f4ec85"]]),ws={class:"flex flex-wrap items-center gap-2 bg-slate-50 border rounded-lg p-3"},$s=["value"],hs=["disabled"],ks=["disabled"],Cs=["disabled"],Us={key:2,class:"ml-auto text-xs text-slate-500"},_s={__name:"DeviceActionsBar",props:{devices:{type:Array,default:()=>[]}},setup(u){const x=u,c=j(),o=K(),n=h(""),d=h(!1),i=S(()=>Array.isArray(x.devices)&&x.devices.length>0);async function C(){if(!n.value)return c.error("Enter a Device ID first");try{d.value=!0;const t=await o.pullUsersFromDevice(n.value);c.success(`Pulled from device#${n.value}: users ${(t==null?void 0:t.pulled_users)??0}, templates ${(t==null?void 0:t.pulled_templates)??0}`),await o.fetchUsers()}catch(t){c.error((t==null?void 0:t.message)||"Pull failed")}finally{d.value=!1}}async function r(){if(!n.value)return c.error("Enter a Device ID first");try{d.value=!0;const t=await o.pushAllUsersToDevice(n.value);c.success(`Pushed to device#${n.value}: users ${(t==null?void 0:t.pushed_users)??0}, templates ${(t==null?void 0:t.pushed_templates)??0}`)}catch(t){c.error((t==null?void 0:t.message)||"Push failed")}finally{d.value=!1}}async function s(){if(!n.value)return c.error("Enter a Device ID first");try{d.value=!0;const t=await o.userCountOnDevice(n.value),l=Number((t==null?void 0:t.user_count)??0);c.info(`Device#${n.value}: users = ${l}${(t==null?void 0:t.online)===!1?" (offline)":""}`)}catch(t){c.error((t==null?void 0:t.message)||"Count failed")}finally{d.value=!1}}return(t,l)=>(y(),m("div",ws,[l[7]||(l[7]=e("div",{class:"text-sm text-slate-600"},"Device actions:",-1)),i.value?z((y(),m("select",{key:0,"onUpdate:modelValue":l[0]||(l[0]=a=>n.value=a),class:"border rounded px-2 py-1 text-sm min-w-48"},[l[2]||(l[2]=e("option",{value:"",disabled:""},"Select a device…",-1)),(y(!0),m(P,null,N(u.devices,a=>(y(),m("option",{key:a.id,value:String(a.id)}," #"+k(a.id)+" — "+k(a.name||a.ip_address),9,$s))),128))],512)),[[T,n.value]]):z((y(),m("input",{key:1,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value=a),type:"number",min:"1",placeholder:"Device ID",class:"border rounded px-2 py-1 text-sm w-28"},null,512)),[[A,n.value]]),e("button",{class:"btn",onClick:C,disabled:d.value},l[3]||(l[3]=[e("i",{class:"fas fa-download mr-1"},null,-1),_(" Pull Users ")]),8,hs),e("button",{class:"btn",onClick:r,disabled:d.value},l[4]||(l[4]=[e("i",{class:"fas fa-upload mr-1"},null,-1),_(" Push All ")]),8,ks),e("button",{class:"btn",onClick:s,disabled:d.value},l[5]||(l[5]=[e("i",{class:"fas fa-list-ol mr-1"},null,-1),_(" Count ")]),8,Cs),d.value?(y(),m("span",Us,l[6]||(l[6]=[e("i",{class:"fas fa-circle-notch fa-spin"},null,-1),_(" Working… ")]))):F("",!0)]))}},Ds=I(_s,[["__scopeId","data-v-f33e0266"]]),zs={class:"my-container space-y-4"},Fs={__name:"ZKUsers",setup(u){const x=ue(),c=S(()=>x.devices),o=K(),n=ce(),d=j(),i=h(!1),C=h("push"),r=h(null),s=h(!1),t=h(!1),l=h(!1),a=h(!1),g=h(null),v=h(!1),b=h(""),p=h("");let w=null,B=null;const L=S(()=>o.users);async function V(){await o.fetchUsers()}ie(async()=>{await Promise.all([o.fetchUsers(),x.fetchDevices()])});function Z(){g.value=null,a.value=!0}function q(f){g.value=f,a.value=!0}function W(){a.value=!1}async function G(f){var $;try{($=g.value)!=null&&$.id?(await o.updateUser(g.value.id,f),d.success("User updated")):(await o.createUser(f),d.success("User created")),await V(),a.value=!1}catch(D){d.error((D==null?void 0:D.message)||"Save failed")}}function H(f){b.value="Delete User",p.value=`Are you sure you want to delete "${f.name}" (Enroll ${f.zk_userid})?`,w=async()=>{await o.deleteUser(f.id),d.warning("User deleted"),await V()},B=null,v.value=!0}function E(){v.value=!1,w=null,B=null}async function J(){if(!w)return E();try{await w(B)}catch(f){d.error((f==null?void 0:f.message)||"Operation failed")}finally{E()}}function Q(f){r.value=f,C.value="push",i.value=!0}function X(f){r.value=f,C.value="remove",i.value=!0}async function Y(f){if(!(!f||!r.value))try{s.value=!0;const $=await o.removeUserFromDevice(f,r.value.zk_userid);d.warning(`Removed ${r.value.zk_userid} from device#${f}${$!=null&&$.removed?"":" (check device)"}`)}catch($){d.error(($==null?void 0:$.message)||"Operation failed")}finally{s.value=!1,i.value=!1,r.value=null}}async function ee(f){if(!(!f||!r.value))try{t.value=!0;const $=await o.pushSingleUserToDevice(f,r.value.zk_userid);d.success(`Pushed USER ${r.value.zk_userid} → device#${f}`)}catch($){d.error(($==null?void 0:$.message)||"User push failed")}finally{t.value=!1,i.value=!1,r.value=null}}async function se(f){var $;if(!(!f||!r.value))try{l.value=!0;const D=await n.pushFingerprintsOne(f,r.value.zk_userid),te=Number((($=D==null?void 0:D.data)==null?void 0:$.pushed_templates)??(D==null?void 0:D.pushed_templates)??0);d.success(`Pushed FPs ${r.value.zk_userid} → device#${f}: ${te}`)}catch(D){d.error((D==null?void 0:D.message)||"Fingerprint push failed")}finally{l.value=!1,i.value=!1,r.value=null}}return(f,$)=>(y(),m("div",zs,[R(de,{title:"ZK Users",onAdd:Z}),R(Ds,{devices:c.value},null,8,["devices"]),R(Ie,{items:L.value,loading:re(o).loading,onEdit:q,onDelete:H,onPushOne:Q,onRemoveOne:X},null,8,["items","loading"]),R(Le,{show:a.value,user:g.value,onClose:W,onSave:G},null,8,["show","user"]),R(Xe,{show:v.value,title:b.value,message:p.value,onClose:E,onConfirm:J},null,8,["show","title","message"]),R(gs,{show:i.value,mode:C.value,user:r.value,devices:c.value,loading:s.value,"loading-user":t.value,"loading-fp":l.value,onClose:$[0]||($[0]=()=>{i.value=!1,r.value=null}),onConfirm:Y,onConfirmUser:ee,onConfirmFp:se},null,8,["show","mode","user","devices","loading","loading-user","loading-fp"])]))}},Ps=I(Fs,[["__scopeId","data-v-3f6f0106"]]);export{Ps as default};
