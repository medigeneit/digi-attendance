import{r as c,c as o,o as i,a as e,g as b,p as j,t as v,s as se,x as te,w as le,h as g,v as x,C as A,a1 as ne,e as ae,q as P,f as ie,k as C,F as E,n as L,K as oe}from"./index-CIo6-YZh.js";import{u as q,a as re,b as ue}from"./zk-finger-C46reSqt.js";import{_ as de,a as T}from"./HeaderWithButtons-9xjYo_9v.js";import{L as ce}from"./LoaderView-B13L9bx9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"flex justify-center items-center gap-2"},ve={__name:"CheckDeviceConnection",props:{device:Object},setup(D){const p=q(),_=D,y=c(!1),u=c(""),n=c(!1),k=async()=>{n.value=!0;const f=await p.checkDeviceConnection(_.device.id);y.value=f,u.value=f?"success":"Failed",n.value=!1,setTimeout(()=>{u.value=!1},1e3*60)};return(f,h)=>(i(),o("div",pe,[e("button",{onClick:k,class:"text-blue-600 hover:text-blue-800"},[e("i",{class:j(["fas fa-sync-alt",{"animate-spin":n.value}])},null,2)]),u.value?(i(),o("span",{key:0,class:j(y.value?"text-green-600":"text-red-600")},v(u.value),3)):b("",!0)]))}},fe={key:0,class:"modal-bg"},me={class:"modal-card"},be={class:"text-lg font-semibold mb-4"},ge={class:"mb-4"},ye={class:"mb-4"},he={class:"mb-4"},_e={class:"mb-4"},xe={class:"mb-4"},ke={class:"mb-4"},we={class:"flex justify-end"},Ce={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},De={__name:"DeviceModal",props:{show:{type:Boolean,required:!0},device:{type:Object,default:null}},emits:["close","save"],setup(D,{emit:p}){const _=D,y=p,u=c(!1),n=se({id:null,name:"",ip_address:"",port:"",serial_number:"",firmware:"",status:"active"}),k=()=>{u.value=!1,n.id=null,n.name="",n.ip_address="",n.port="",n.serial_number="",n.firmware="",n.status="active"};te(()=>_.device,a=>{a&&typeof a=="object"&&Object.keys(a).length>0?(u.value=!0,n.id=a.id||null,n.name=a.name||"",n.ip_address=a.ip_address||"",n.port=a.port||"",n.serial_number=a.serial_number||"",n.firmware=a.firmware||"",n.status=a.status||"active"):k()},{immediate:!0,deep:!0});const f=()=>{y("save",{...n}),h()},h=()=>{y("close")};return(a,r)=>D.show?(i(),o("div",fe,[e("div",me,[e("h2",be,v(u.value?"Edit Device":"Add Device"),1),e("form",{onSubmit:le(f,["prevent"])},[e("div",ge,[r[6]||(r[6]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),g(e("input",{id:"name","onUpdate:modelValue":r[0]||(r[0]=d=>n.name=d),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter device name",required:""},null,512),[[x,n.name]])]),e("div",ye,[r[7]||(r[7]=e("label",{for:"ip_address",class:"block text-sm font-medium mb-2"},"IP Address",-1)),g(e("input",{id:"ip_address","onUpdate:modelValue":r[1]||(r[1]=d=>n.ip_address=d),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter IP address",required:""},null,512),[[x,n.ip_address]])]),e("div",he,[r[8]||(r[8]=e("label",{for:"port",class:"block text-sm font-medium mb-2"},"Port",-1)),g(e("input",{id:"port","onUpdate:modelValue":r[2]||(r[2]=d=>n.port=d),type:"number",class:"w-full border rounded px-3 py-2",placeholder:"Enter port",required:""},null,512),[[x,n.port]])]),e("div",_e,[r[9]||(r[9]=e("label",{for:"serial_number",class:"block text-sm font-medium mb-2"},"Serial Number",-1)),g(e("input",{id:"serial_number","onUpdate:modelValue":r[3]||(r[3]=d=>n.serial_number=d),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter serial number (optional)"},null,512),[[x,n.serial_number]])]),e("div",xe,[r[10]||(r[10]=e("label",{for:"firmware",class:"block text-sm font-medium mb-2"},"Firmware",-1)),g(e("input",{id:"firmware","onUpdate:modelValue":r[4]||(r[4]=d=>n.firmware=d),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter firmware version (optional)"},null,512),[[x,n.firmware]])]),e("div",ke,[r[12]||(r[12]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),g(e("select",{id:"status","onUpdate:modelValue":r[5]||(r[5]=d=>n.status=d),class:"w-full border rounded px-3 py-2",required:""},r[11]||(r[11]=[e("option",{value:"active"},"Active",-1),e("option",{value:"inactive"},"Inactive",-1),e("option",{value:"error"},"Error",-1)]),512),[[A,n.status]])]),e("div",we,[e("button",{type:"button",onClick:h,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",Ce,v(u.value?"Update":"Create"),1)])],32)])])):b("",!0)}},$e={class:"my-container space-y-2"},Pe={key:1},Ue={key:0,class:"grid gap-4 md:grid-cols-3"},Se={key:0,class:"absolute inset-0 bg-white/60 grid place-items-center rounded-xl z-10"},Fe={class:"flex items-start justify-between"},Ie={class:"text-base font-semibold"},Me={class:"text-xs text-gray-500"},Ve={class:"mt-2"},Ee={class:"mt-3 flex flex-wrap items-center gap-3"},Le=["disabled","onClick"],je={key:0,class:"fas fa-users"},Ae={key:1,class:"fas fa-circle-notch fa-spin"},Ne=["disabled","onClick"],Oe={key:0,class:"fas fa-fingerprint"},Te={key:1,class:"fas fa-circle-notch fa-spin"},qe=["disabled","onClick"],ze={key:0,class:"fas fa-cloud-upload-alt"},Be={key:1,class:"fas fa-circle-notch fa-spin"},Ke=["disabled","onClick"],We={key:0,class:"fas fa-sync-alt"},Ze={key:1,class:"fas fa-circle-notch fa-spin"},Ge=["disabled","onClick"],He={key:0,class:"fas fa-list-ol"},Je={key:1,class:"fas fa-circle-notch fa-spin"},Qe=["onClick"],Re={class:"mt-2 text-[11px] text-gray-500"},Xe={key:0},Ye={key:1,class:"ml-2 inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-0.5 text-gray-700",title:"Last checked at"},es={key:0,class:"text-red-600"},ss={key:1,class:"text-center text-red-500 py-8"},ts={key:2,class:"fixed inset-0 bg-black/40 grid place-items-center z-50"},ls={class:"bg-white rounded-lg w-full max-w-md p-5 shadow relative"},ns={key:0,class:"absolute inset-0 bg-white/60 grid place-items-center rounded-lg"},as={class:"space-y-3"},is=["value"],os={class:"grid grid-cols-2 gap-3"},rs={class:"mt-4 flex justify-end gap-2"},us=["disabled"],ds=["disabled"],cs={key:0,class:"fas fa-circle-notch fa-spin mr-1"},ps={key:3,class:"fixed inset-0 bg-black/40 grid place-items-center z-50"},vs={class:"bg-white rounded-lg w-full max-w-md p-5 shadow relative"},fs={key:0,class:"absolute inset-0 bg-white/60 grid place-items-center rounded-lg"},ms={class:"space-y-3"},bs=["value"],gs={class:"inline-flex items-center gap-2 text-sm"},ys={class:"mt-4 flex justify-end gap-2"},hs=["disabled"],_s=["disabled"],xs={key:0,class:"fas fa-circle-notch fa-spin mr-1"},Ps={__name:"DeviceList",setup(D){const p=q(),_=re(),y=ue(),u=ne(),n=c(!1),k=c(!1),f=c(null),h=c({}),a=c({running:!1,deviceId:null,label:""}),r=c(!1),d=c(null),U=c(null),S=c(null),F=c(!1),w=c(null),I=c(!0),M=c(!1),V=c(null),z=()=>{f.value=null,n.value=!0},B=l=>{f.value=l,n.value=!0},K=()=>{n.value=!1},W=async l=>{try{l.id?(await p.updateDevice(l.id,l),u.success("Device updated successfully!")):(await p.createDevice(l),u.success("Device added successfully!")),await p.fetchDevices()}catch(s){u.error("Failed to save device!"),console.error("Error handling save:",s)}},N=()=>{k.value=!1},Z=async()=>{if(!f.value||!f.value.id){u.error("Invalid device selected for deletion!");return}try{await p.deleteDevice(f.value.id),u.warning("Device deleted successfully!"),await p.fetchDevices()}catch(l){u.error("Failed to delete device!"),console.error("Error deleting device:",l)}finally{N()}};ae(async()=>{await p.fetchDevices()});async function G(l){try{a.value={running:!0,deviceId:l.id,label:"pull-users"};const s=await _.pullUsersFromDevice(l.id);u.success(`Pulled ${s.users_pulled} / Updated ${s.users_updated} (Device: ${l.name})`)}catch(s){u.error((s==null?void 0:s.message)||"Pull users failed")}finally{a.value={running:!1,deviceId:null,label:""}}}function H(l){d.value=l.id,U.value=null,S.value=null,r.value=!0}function J(l){w.value=l.id,I.value=!0,F.value=!0}async function Q(){if(d.value)try{a.value={running:!0,deviceId:d.value,label:"pull-fp"};const l=await y.pullFingerprintsFromDevice(d.value,{limit:U.value??null,offset:S.value??null});u.success(`Fingerprints pulled: ${l.fingerprints_pulled}`)}catch(l){u.error((l==null?void 0:l.message)||"Pull fingerprints failed")}finally{a.value={running:!1,deviceId:null,label:""},r.value=!1}}async function R(){if(!w.value){u.warning("Device এবং ZK User ID দিন");return}try{a.value={running:!0,deviceId:w.value,label:"push-fp-to-device"};const l=await y.pushFingerprintsToDevice(w.value,{diff:I.value});u.success("User fingerprints pushed to device successfully")}catch(l){u.error((l==null?void 0:l.message)||"Push to device failed")}finally{a.value={running:!1,deviceId:null,label:""},F.value=!1}}function X(l){V.value=l.id,M.value=!0}async function Y(){if(V.value)try{a.value={running:!0,deviceId:V.value,label:"catchup"};const l=await _.syncCatchupUsers(V.value,{diff:!0});u.success(`Synced: ${l.usersSynced}, Skipped: ${l.skipped}, Failed: ${l.failed}`)}catch(l){u.error((l==null?void 0:l.message)||"Catch-up failed")}finally{a.value={running:!1,deviceId:null,label:""},M.value=!1}}const m=(l,s=null)=>a.value.running&&a.value.deviceId===l.id&&(s?a.value.label===s:!0);async function ee(l){try{a.value={running:!0,deviceId:l.id,label:"user-count"};const s=await _.getDeviceUserCount(l.id);s.online||u.warning(`Device ${l.name} is offline`),h.value[l.id]={count:Number(s.user_count??0),online:!!s.online,at:new Date().toISOString()}}catch(s){u.error((s==null?void 0:s.message)||"User count failed")}finally{a.value={running:!1,deviceId:null,label:""}}}return(l,s)=>{var O;return i(),o("div",$e,[P(de,{title:"Device List",onAdd:z}),C(p).loading?(i(),ie(ce,{key:0})):(i(),o("div",Pe,[C(p).devices&&C(p).devices.length?(i(),o("div",Ue,[(i(!0),o(E,null,L(C(p).devices,t=>(i(),o("div",{key:t.id,class:"relative rounded-xl border p-4 shadow bg-white hover:shadow-md transition"},[m(t)?(i(),o("div",Se,s[8]||(s[8]=[e("i",{class:"fas fa-circle-notch fa-spin text-2xl"},null,-1)]))):b("",!0),e("div",Fe,[e("div",null,[e("div",Ie,v(t.name),1),e("div",Me,v(t.ip_address)+" : "+v(t.port),1)]),e("span",{class:j(["text-xs px-2 py-0.5 rounded",t.status==="active"?"bg-green-100 text-green-700":t.status==="inactive"?"bg-gray-100 text-gray-600":"bg-red-100 text-red-700"])},v(t.status),3)]),e("div",Ve,[P(ve,{device:t},null,8,["device"])]),e("div",Ee,[e("button",{class:"text-indigo-600 hover:text-indigo-800",disabled:m(t),onClick:$=>G(t),title:"Pull Users"},[m(t,"pull-users")?(i(),o("i",Ae)):(i(),o("i",je))],8,Le),e("button",{class:"text-teal-600 hover:text-teal-800",disabled:m(t),onClick:$=>H(t),title:"Pull Fingerprints"},[m(t,"pull-fp")?(i(),o("i",Te)):(i(),o("i",Oe))],8,Ne),e("button",{class:"text-purple-600 hover:text-purple-800",disabled:m(t),onClick:$=>J(t),title:"Push ALL fingerprints → this device"},[m(t,"push-fp-to-device")?(i(),o("i",Be)):(i(),o("i",ze))],8,qe),e("button",{class:"text-amber-600 hover:text-amber-800",disabled:m(t),onClick:$=>X(t),title:"Sync Catch-up (diff)"},[m(t,"catchup")?(i(),o("i",Ze)):(i(),o("i",We))],8,Ke),e("button",{class:"text-slate-700 hover:text-slate-900",disabled:m(t),onClick:$=>ee(t),title:"User Count"},[m(t,"user-count")?(i(),o("i",Je)):(i(),o("i",He))],8,Ge),e("button",{class:"text-blue-600 hover:text-blue-800 ml-auto",onClick:$=>B(t),title:"Edit"},s[9]||(s[9]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Qe)]),e("div",Re,[m(t)?(i(),o("span",Xe,"Working: "+v(a.value.label),1)):b("",!0),h.value[t.id]?(i(),o("span",Ye,[s[10]||(s[10]=e("i",{class:"fas fa-user"},null,-1)),e("span",null,"Users: "+v(h.value[t.id].count),1),h.value[t.id].online?b("",!0):(i(),o("span",es,"(offline)"))])):b("",!0)])]))),128))])):(i(),o("div",ss,"No devices found"))])),P(De,{show:n.value,device:f.value,onClose:K,onSave:W},null,8,["show","device"]),P(T,{show:k.value,title:"Delete Device",message:`Are you sure you want to delete ${(O=f.value)==null?void 0:O.name}?`,onClose:N,onConfirm:Z},null,8,["show","message"]),r.value?(i(),o("div",ts,[e("div",ls,[a.value.running?(i(),o("div",ns,s[11]||(s[11]=[e("i",{class:"fas fa-circle-notch fa-spin text-2xl"},null,-1)]))):b("",!0),s[16]||(s[16]=e("h3",{class:"text-lg font-semibold mb-3"},"Pull Fingerprints (Options)",-1)),e("div",as,[e("div",null,[s[13]||(s[13]=e("label",{class:"block text-sm mb-1"},"Device",-1)),g(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>d.value=t),class:"w-full border rounded p-2"},[s[12]||(s[12]=e("option",{disabled:"",value:""},"-- Select device --",-1)),(i(!0),o(E,null,L(C(p).devices,t=>(i(),o("option",{key:t.id,value:t.id},v(t.name)+" ("+v(t.ip_address)+") ",9,is))),128))],512),[[A,d.value]])]),e("div",os,[e("div",null,[s[14]||(s[14]=e("label",{class:"block text-sm mb-1"},"Limit (optional)",-1)),g(e("input",{type:"number","onUpdate:modelValue":s[1]||(s[1]=t=>U.value=t),min:"1",class:"w-full border rounded p-2",placeholder:"e.g. 100"},null,512),[[x,U.value,void 0,{number:!0}]])]),e("div",null,[s[15]||(s[15]=e("label",{class:"block text-sm mb-1"},"Offset (optional)",-1)),g(e("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=t=>S.value=t),min:"0",class:"w-full border rounded p-2",placeholder:"e.g. 0"},null,512),[[x,S.value,void 0,{number:!0}]])])])]),e("div",rs,[e("button",{onClick:s[3]||(s[3]=t=>r.value=!1),class:"px-3 py-2 border rounded",disabled:a.value.running}," Cancel ",8,us),e("button",{onClick:Q,class:"px-3 py-2 bg-teal-600 text-white rounded",disabled:a.value.running},[a.value.running?(i(),o("i",cs)):b("",!0),e("span",null,v(a.value.running?"Working...":"Pull"),1)],8,ds)])])])):b("",!0),F.value?(i(),o("div",ps,[e("div",vs,[a.value.running?(i(),o("div",fs,s[17]||(s[17]=[e("i",{class:"fas fa-circle-notch fa-spin text-2xl"},null,-1)]))):b("",!0),s[21]||(s[21]=e("h3",{class:"text-lg font-semibold mb-3"},"Push ALL fingerprints → this device",-1)),e("div",ms,[e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm mb-1"},"Device",-1)),g(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>w.value=t),class:"w-full border rounded p-2"},[s[18]||(s[18]=e("option",{disabled:"",value:""},"-- Select device --",-1)),(i(!0),o(E,null,L(C(p).devices,t=>(i(),o("option",{key:t.id,value:t.id},v(t.name)+" ("+v(t.ip_address)+") ",9,bs))),128))],512),[[A,w.value]])]),e("label",gs,[g(e("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=t=>I.value=t)},null,512),[[oe,I.value]]),s[20]||(s[20]=e("span",null,"Send missing only (diff)",-1))])]),e("div",ys,[e("button",{onClick:s[6]||(s[6]=t=>F.value=!1),class:"px-3 py-2 border rounded",disabled:a.value.running}," Cancel ",8,hs),e("button",{onClick:R,class:"px-3 py-2 bg-purple-600 text-white rounded",disabled:a.value.running},[a.value.running?(i(),o("i",xs)):b("",!0),e("span",null,v(a.value.running?"Working...":"Push"),1)],8,_s)])])])):b("",!0),P(T,{show:M.value,title:"Sync Catch-up",message:"এই ডিভাইসে যেগুলো নেই, শুধু সেগুলো পুশ করা হবে (user-only, diff). Proceed?",onClose:s[7]||(s[7]=t=>M.value=!1),onConfirm:Y},null,8,["show"])])}}};export{Ps as default};
