import{r as n,q as D,c as y,g as F,o as c,a as l,t as L,z as T,d as E,B as G,a1 as q,u as z,e as H,C as J,f as A,y as $,w as K,k as I,h as m,v as g,A as Q,F as O,x as W,i as X,j as Y}from"./index-Do4lXNJe.js";import{L as Z}from"./LoaderView-DLdsgkCU.js";import{_ as ee}from"./ChangePasswordModal-CuHfRvGU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={key:0,class:"modal-bg z-50"},oe={class:"modal-card relative"},te={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-200 bg-opacity-75 z-10"},se=["src"],ae={class:"flex justify-center mt-4"},ne=["disabled"],re={__name:"PhotoModal",props:{imageSrc:{type:String,default:""},isOpen:{type:Boolean,default:!1}},emits:["close","fileSelected","uploadPhoto"],setup(B,{emit:o}){const h=o,u=n(null),s=n(!1),r=n(!1),P=n(!1),b=B,i=n(b.isOpen),p=n(b.imageSrc),k=()=>{i.value=!1,h("close"),C()},v=f=>{const d=f.target.files[0];if(d){const _=new FileReader;_.onload=U=>{p.value=U.target.result,s.value=!0},_.readAsDataURL(d),h("fileSelected",d)}},x=()=>{u.value.click()},S=()=>{s.value?(r.value=!0,h("uploadPhoto",u.value.files[0]),setTimeout(()=>{r.value=!1,P.value=!0},2e3)):x()},C=()=>{s.value=!1,r.value=!1,P.value=!1};return D(()=>b.isOpen,f=>{i.value=f,f&&(p.value=b.imageSrc,C())}),(f,d)=>i.value?(c(),y("div",le,[l("div",oe,[r.value?(c(),y("div",te,d[0]||(d[0]=[l("div",{class:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"},null,-1)]))):F("",!0),p.value?(c(),y("img",{key:1,src:p.value,alt:"Modal Image",class:"aspect-[3/4] object-cover rounded-md"},null,8,se)):F("",!0),l("div",ae,[l("button",{class:"btn-2",onClick:S,disabled:r.value},L(s.value?"Upload Photo":"Change Photo"),9,ne)]),l("input",{type:"file",ref_key:"fileInput",ref:u,class:"hidden",onChange:v},null,544),l("button",{onClick:k,class:"absolute top-2 right-2 text-red-500 text-xl"},d[1]||(d[1]=[l("i",{class:"far fa-times-circle"},null,-1)]))])])):F("",!0)}},de={class:"my-container space-y-2"},ue={class:"card-bg md:p-8 p-4 mx-4"},ie={class:"grid gap-4"},pe={class:"border p-4 rounded-md bg-gray-100"},fe={class:"flex justify-center w-full"},ce=["src"],ve={class:"grid md:grid-cols-2 gap-4"},me={class:"space-y-2"},be=["value"],ge={class:"flex justify-center gap-4"},Pe={__name:"ProfileEdit",setup(B){const o=T({name:"",phone:"",email:"",nid:"",date_of_birth:"",address:"",blood:""}),h=["A+","A-","B+","B-","AB+","AB-","O+","O-"],u=E(),{user:s}=G(u),r=q(),P=z(),b=n(!1),i=n(!1),p=n(!1),k=n(null),v=n(null),x=n(!1),S=n(!1);H(()=>{s.value&&U()}),D(s,a=>{a&&U()});const C=()=>{k.value=s.value.photo,p.value=!0},f=()=>{p.value=!1,v.value=null},d=()=>{i.value=!1},_=a=>{v.value=a},U=()=>{var a,e,M,w,t,V,j;o.name=((a=s.value)==null?void 0:a.name)||"",o.phone=((e=s.value)==null?void 0:e.phone)||"",o.email=((M=s.value)==null?void 0:M.email)||"",o.address=((w=s.value)==null?void 0:w.address)||"",o.nid=((t=s.value)==null?void 0:t.nid)||"",o.blood=((V=s.value)==null?void 0:V.blood)||"",o.date_of_birth=((j=s.value)==null?void 0:j.date_of_birth)||""},N=async()=>{try{await u.updateProfile(o),r.success("Profile updated successfully!"),P.push({name:"MyProfile"})}catch(a){console.error("Failed to update profile:",a),r.error(u.error||"Failed to save profile!");return}},R=async()=>{if(console.log(v.value),!v.value)return;const a=new FormData;a.append("photo",v.value),a.append("user_id",s.value.id),console.log({formData:a});try{x.value=!0,await u.uploadProfilePhoto(a),S.value=!0,setTimeout(()=>{f(),x.value=!1,S.value=!1},1500),r.success("Image updated successfully!")}catch(e){console.error("Failed to upload photo:",e),r.error(u.error||"Failed to save profile!")}finally{x.value=!1}};return(a,e)=>{var w;const M=J("RouterLink");return c(),y(O,null,[l("div",de,[l("div",ue,[e[21]||(e[21]=l("h2",{class:"title-lg text-center"},"Edit Profile",-1)),b.value?(c(),A(Z,{key:0,class:"bg-gray-100 border shadow-none"})):(c(),y("form",{key:1,onSubmit:K(N,["prevent"]),class:"space-y-4"},[l("div",ie,[l("div",pe,[l("div",fe,[l("div",{onClick:C,class:"relative bg-gray-200 w-40 h-40 rounded-full overflow-hidden mx-auto flex items-center justify-center"},[l("img",{class:"object-cover w-full h-full",src:((w=I(s))==null?void 0:w.photo)||"/default-avatar.png",alt:"Profile Photo"},null,8,ce),e[8]||(e[8]=l("div",{class:"absolute inset-0 flex items-end justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity"},[l("button",{type:"button",class:"btn-2 px-3 py-1 text-sm rounded-md mb-2"}," Change ")],-1))])]),e[17]||(e[17]=l("p",{class:"title-md"},"Personal Info",-1)),e[18]||(e[18]=l("hr",{class:"my-2"},null,-1)),l("div",ve,[l("div",null,[e[9]||(e[9]=l("label",null,"Name",-1)),m(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.name=t),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[g,o.name]])]),l("div",null,[e[10]||(e[10]=l("label",null,"Phone",-1)),m(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.phone=t),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[g,o.phone]])]),l("div",null,[e[11]||(e[11]=l("label",null,"Email",-1)),m(l("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.email=t),type:"email",class:"w-full p-2 border rounded"},null,512),[[g,o.email]])]),l("div",me,[e[13]||(e[13]=l("label",{for:"bloodGroup",class:"text-gray-700 flex items-center gap-2"}," Blood Group ",-1)),m(l("select",{id:"bloodGroup","onUpdate:modelValue":e[3]||(e[3]=t=>o.blood=t),class:"py-2 px-4 border rounded w-full"},[e[12]||(e[12]=l("option",{disabled:"",value:""},"Select blood group",-1)),(c(),y(O,null,W(h,t=>l("option",{key:t,value:t},L(t),9,be)),64))],512),[[Q,o.blood]])]),l("div",null,[e[14]||(e[14]=l("label",null,"NID",-1)),m(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.nid=t),type:"text",class:"w-full p-2 border rounded"},null,512),[[g,o.nid]])]),l("div",null,[e[15]||(e[15]=l("label",null,"Date of Birth",-1)),m(l("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.date_of_birth=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[g,o.date_of_birth]])]),l("div",null,[e[16]||(e[16]=l("label",null,"Address",-1)),m(l("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.address=t),rows:"2",class:"w-full p-2 border rounded"},null,512),[[g,o.address]])])])])]),l("div",ge,[$(M,{to:{name:"MyProfile"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:X(()=>e[19]||(e[19]=[Y(" Cancel ")])),_:1,__:[19]}),e[20]||(e[20]=l("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1)),l("button",{type:"button",onClick:e[7]||(e[7]=t=>i.value=!i.value),class:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"}," Change Password ")])],32))])]),i.value?(c(),A(ee,{key:0,onClose:d,user:I(s)},null,8,["user"])):F("",!0),$(re,{imageSrc:k.value,isOpen:p.value,onClose:f,onFileSelected:_,onUploadPhoto:R},null,8,["imageSrc","isOpen"])],64)}}};export{Pe as default};
