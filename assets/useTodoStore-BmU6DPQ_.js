import{Q as v,P as L,r as T,m as h}from"./index-DLQLieTe.js";import{o as N}from"./url-CePbr-gY.js";async function H(l,{params:r={}}={}){return v.get(`/todos/${l}/settings`,{params:r})}async function I(l,r){return v.post(`/todos/${l}/settings`,r)}async function J(l,r,{params:y={}}={}){const n=N(y);return v.delete(`/todos/${l}/settings/${r}${n?`?${n}`:""}`)}async function Q({params:l={}}={}){return v.get("/todo-dates",{params:l})}async function j(l){return v.post("/todo-dates",l)}async function x(l,r){return v.get(`/todo-dates/${l}`,r)}async function C(l,r){return v.patch(`/my-todo-dates/${l}/status`,r)}async function k(l,{params:r={}}={}){const y=N(r);return v.delete(`/todo-dates/${l}${y?"?"+y:""}`)}const z=L("todo-date",()=>{const l=T(null),r=T(!1),y=T(!1),n=T(null),s=T([]),D=()=>l.value=[],_=async e=>{var a,o,t;r.value=!0,n.value=null;try{const u=await Q({params:e});s.value=((a=u.data)==null?void 0:a.todo_dates)||[],p()}catch(u){throw n.value=((t=(o=u.response)==null?void 0:o.data)==null?void 0:t.message)||"TodoDates load failed",u}finally{r.value=!1}};function p(){s.value=[...s.value.sort((e,a)=>(e==null?void 0:e.user_id)!==(a==null?void 0:a.user_id)?(e==null?void 0:e.user_id)-(a==null?void 0:a.user_id):e.priority!==a.priority?e.priority-a.priority:a.id-e.id)]}const $=async e=>{var a,o,t;r.value=!0,n.value=null;try{const u=await v.get("/my-todo-dates",{params:e});s.value=((a=u.data)==null?void 0:a.todo_dates)||[],p()}catch(u){throw n.value=((t=(o=u.response)==null?void 0:o.data)==null?void 0:t.message)||"TodoDates load failed",u}finally{r.value=!1}},S=e=>{var a;return(a=s.value)==null?void 0:a.filter(o=>o.date==e)},M=async e=>{var a,o;r.value=!0,n.value=null;try{const t=await x(e);l.value=t.data.todo_date}catch(t){throw n.value=((o=(a=t.response)==null?void 0:a.data)==null?void 0:o.message)||"Todo load failed",t}finally{r.value=!1}},P=async e=>{var a,o,t;r.value=!0,n.value=null;try{const u=await j(e);return s.value=[...s.value,(a=u.data)==null?void 0:a.todo_date],p(),u.data}catch(u){throw n.value=((t=(o=u.response)==null?void 0:o.data)==null?void 0:t.message)||"Todo create failed",u}finally{r.value=!1}},b=e=>{s.value=[...s.value,e],p()},m=async(e,a)=>{var o,t;r.value=!0,n.value=null;try{const u=await m(e,a);return s.value=s.value.map(i=>{var c,f,g,w;return i.id==((f=(c=u.data)==null?void 0:c.todo)==null?void 0:f.id)?i.user?{...(g=u.data)==null?void 0:g.todo,user:{...i.user}}:{...(w=u.data)==null?void 0:w.todo}:{...i}}),u.data}catch(u){throw n.value=((t=(o=u.response)==null?void 0:o.data)==null?void 0:t.message)||"Todo update failed",u}finally{r.value=!1}},q=async(e,a)=>{var o,t;r.value=!0,n.value=null;try{await C(e,{status:a}),s.value=s.value.map(u=>u.id===e?{...u,status:a}:{...u})}catch(u){throw n.value=((t=(o=u.response)==null?void 0:o.data)==null?void 0:t.message)||"Failed to update todo status",u}finally{r.value=!1}},F=async(e,{date:a}={})=>{var o,t;r.value=!0,y.value=!0,n.value=null;try{const u=await v.put("/my-todo-dates/rearrange",{ids:e,date:a});s.value=s.value.map(i=>{var g;const f=(((g=u.data)==null?void 0:g.changes)||[]).find(w=>w.id==i.id);return f?{...i,priority:f.priority}:i}),p()}catch(u){throw n.value=((t=(o=u.response)==null?void 0:o.data)==null?void 0:t.message)||"Todo rearranging failed",u}finally{y.value=!0,r.value=!1}};async function d(e){var a,o;r.value=!0,n.value=null;try{await k(e),s.value=s.value.filter(t=>t.id!==e)}catch(t){throw n.value=((o=(a=t.response)==null?void 0:a.data)==null?void 0:o.message)||"Todo delete failed",t}finally{r.value=!1}}return{loading:h(()=>r.value),error:h(()=>n.value),todo_dates:h(()=>s.value),todo_date:h(()=>l.value),fetchTodoDates:_,fetchTodoDate:M,createTodoDate:P,updateTodoDate:m,rearrangeMyTodoDates:F,deleteTodoDate:d,fetchMyTodoDates:$,updateStatus:q,getTodoDatesByDate:S,setNewTodoDate:b,emptyTodoDates:D}}),K=L("todo",()=>{const l=T(null),r=T(!1),y=T(!1),n=T(null),s=T([]),D=z(),_=async d=>{var e,a,o;s.value=[],r.value=!0,n.value=null;try{const t=await v.get("/todos",{params:d});s.value=((e=t.data)==null?void 0:e.todos)||[],p()}catch(t){throw n.value=((o=(a=t.response)==null?void 0:a.data)==null?void 0:o.message)||"Todos load failed",t}finally{r.value=!1}};function p(){s.value=[...s.value.sort((d,e)=>(d==null?void 0:d.user_id)!==(e==null?void 0:e.user_id)?(d==null?void 0:d.user_id)-(e==null?void 0:e.user_id):d.priority!==e.priority?d.priority-e.priority:e.id-d.id)]}const $=async d=>{var e,a,o;r.value=!0,n.value=null;try{const t=await v.get("/my-todos",{params:d});s.value=((e=t.data)==null?void 0:e.todos)||[],p()}catch(t){throw n.value=((o=(a=t.response)==null?void 0:a.data)==null?void 0:o.message)||"Todos load failed",t}finally{r.value=!1}},S=d=>{var e;return(e=s.value)==null?void 0:e.filter(a=>a.date==d)},M=async d=>{var e,a;r.value=!0,n.value=null;try{const o=await v.get(`/todos/${d}`);l.value=o.data}catch(o){throw n.value=((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Todo load failed",o}finally{r.value=!1}},P=async(d,{returnWith:e}={})=>{var a,o,t,u,i;r.value=!0,n.value=null;try{const c=await v.post("/todos",d,{params:{return_with:e}});return s.value=[...s.value,(a=c.data)==null?void 0:a.todo],(o=c==null?void 0:c.data)!=null&&o.todo_date&&D.setNewTodoDate((t=c==null?void 0:c.data)==null?void 0:t.todo_date),p(),c.data}catch(c){throw n.value=((i=(u=c.response)==null?void 0:u.data)==null?void 0:i.message)||"Todo create failed",c}finally{r.value=!1}},b=async(d,e)=>{var a,o;r.value=!0,n.value=null;try{const t=await v.put(`/todos/${d}`,e);return s.value=s.value.map(u=>{var i,c,f,g;return u.id==((c=(i=t.data)==null?void 0:i.todo)==null?void 0:c.id)?u.user?{...(f=t.data)==null?void 0:f.todo,user:{...u.user}}:{...(g=t.data)==null?void 0:g.todo}:{...u}}),t.data}catch(t){throw n.value=((o=(a=t.response)==null?void 0:a.data)==null?void 0:o.message)||"Todo update failed",t}finally{r.value=!1}},m=async(d,e)=>{var a,o;r.value=!0,n.value=null;try{await v.put(`/todos/status/${d}`,{status:e}),s.value=s.value.map(t=>t.id===d?{...t,status:e}:{...t})}catch(t){throw n.value=((o=(a=t.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to update todo status",t}finally{r.value=!1}},q=async(d,{date:e}={})=>{var a,o;r.value=!0,y.value=!0,n.value=null;try{const t=await v.put("/my-todos/rearrange",{ids:d,date:e});s.value=s.value.map(u=>{var f;const c=(((f=t.data)==null?void 0:f.changes)||[]).find(g=>g.id==u.id);return c?{...u,priority:c.priority}:u}),p()}catch(t){throw n.value=((o=(a=t.response)==null?void 0:a.data)==null?void 0:o.message)||"Todo rearranging failed",t}finally{y.value=!0,r.value=!1}},F=async d=>{var e,a;r.value=!0,n.value=null;try{await v.delete(`/todos/${d}`),s.value=s.value.filter(o=>o.id!==d)}catch(o){throw n.value=((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Todo delete failed",o}finally{r.value=!1}};return{todos:h(()=>s.value),todo:h(()=>l.value),loading:h(()=>r.value),error:h(()=>n.value),fetchTodos:_,fetchTodo:M,createTodo:P,updateTodo:b,rearrangeMyTodos:q,deleteTodo:F,fetchMyTodos:$,updateTodoStatus:m,getTodosByDate:S}});export{z as a,I as b,J as d,H as f,K as u};
