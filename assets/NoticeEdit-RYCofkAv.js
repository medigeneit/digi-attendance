import{A as q,i as z,r as b,s as F,p as V,b as G,q as A,c as d,a as o,j as $,w as H,d as n,D as k,k as v,l as u,h as r,z as J,v as S,e as g,t as K,m as O,f as Q,g as W,n as X,o as i}from"./index-CuK2VTzH.js";import{L as Y}from"./LoaderView-BDRFG2Vv.js";import{_ as Z}from"./TextEditor-DOswDTc_.js";import{u as ee}from"./company-BOGg8d3e.js";import{u as te}from"./department-Dd2qcLtN.js";import{u as le}from"./notice-Dul2p-RB.js";import{s as D}from"./vue-multiselect.esm-DqNwNLFO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"my-container space-y-2"},se={class:"card-bg md:p-8 p-4 mx-4"},ae={class:"grid gap-4"},ne={class:"border p-4 rounded-md bg-gray-100"},ie={class:"grid md:grid-cols-2 gap-4"},de={class:"w-full"},re={key:0},pe={key:1},ue={class:"col-span-3 flex justify-between gap-8"},me={class:"w-full"},ce={class:"w-full"},ye={key:0,class:"mb-2"},fe=["href"],be={key:1,class:"text-sm text-gray-600 mt-1"},ve={class:"col-span-full"},ge={class:"flex justify-center gap-4"},Ue={__name:"NoticeEdit",setup(we){const l=q({title:"",type:"",description:"",published_at:"",expired_at:"",company_id:"all",department_id:"",file:"",all_companies:!1,all_departments:!1,all_employees:!1}),w=le(),N=ee(),m=te(),_=z(),x=Q(),C=W(),c=b(!1),{companies:L}=F(N),{employees:M}=F(m),p=b([]),U=V(()=>p.value.map(s=>s.id)),y=b([]),h=V(()=>y.value.map(s=>s.id)),f=b([]),T=V(()=>f.value.map(s=>s.id)),R=()=>{l.value.all_departments&&(U.value=[])},B=()=>{l.value.all_employees&&(h.value=[])};G(async()=>{c.value=!0,await N.fetchCompanies(),await I(),c.value=!1}),A(()=>l.company_id,async s=>{s&&(await m.fetchDepartments(s),c.value=!1)});const j=async s=>{const e=s.target.files[0];if(e){const a=new FormData;a.append("file",e);const t=await w.fetchFileUpload(a);console.log({response:t==null?void 0:t.url}),l.file=t==null?void 0:t.url}},E=s=>{if(!s)return;const e=s.split(" ")[0];if(!e.includes("-")){formattedDate.value="Invalid Date Format";return}return e},I=async()=>{var s,e;try{const a=x.params.id,t=await w.fetchNotice(a);l.title=t.title,l.type=t.type,l.file=t.file,l.published_at=E(t.published_at),l.expired_at=E(t.expired_at),l.description=t.description,l.company_id=t.company_id??"all",l.department_id=t.department_id,f.value=t.companies_notice,p.value=t.departments,y.value=t.employees,t.companies_notice.length==0&&(l.all_companies=!0),t.departments.length==0&&(l.all_departments=!0),t.employees.length==0&&(l.all_employees=!0)}catch(a){const t=((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to load notice data";_.error(t),C.push({name:"NoticeList"})}},P=async()=>{var s,e;try{const a={...l,company_ids:T.value,department_ids:U.value,employee_ids:h.value};await w.updateNotice(x.params.id,a),_.success("Notice updated successfully"),C.push({name:"NoticeShow",params:{id:x.params.id}})}catch(a){const t=((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to update notice";_.error(t)}};return A(p,s=>{const e=s.map(a=>a.id);e.length>0&&m.fetchDepartmentEmployee(e)}),(s,e)=>{const a=X("RouterLink");return i(),d("div",oe,[o("div",se,[e[26]||(e[26]=o("h2",{class:"title-lg text-center"},"Edit Notice",-1)),c.value?(i(),$(Y,{key:0,class:"bg-gray-100 border shadow-none"})):(i(),d("form",{key:1,onSubmit:H(P,["prevent"]),class:"space-y-4"},[o("div",ae,[o("div",ne,[e[22]||(e[22]=o("p",{class:"title-md"},"Notice Info",-1)),e[23]||(e[23]=o("hr",{class:"my-2"},null,-1)),o("div",ie,[o("div",de,[o("label",null,[n(o("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=t=>l.all_companies=t),onChange:e[1]||(e[1]=(...t)=>s.toggleAllCompany&&s.toggleAllCompany(...t))},null,544),[[k,l.all_companies]]),e[12]||(e[12]=v(" Select All Companies "))]),u(r(D),{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),options:r(L),multiple:!0,searchable:!0,placeholder:"Select companies","track-by":"id",label:"name",disabled:l.all_companies},null,8,["modelValue","options","disabled"])]),o("div",null,[e[14]||(e[14]=o("label",null,"Type*",-1)),n(o("select",{id:"type","onUpdate:modelValue":e[3]||(e[3]=t=>l.type=t),class:"w-full border rounded px-3 py-2",required:""},e[13]||(e[13]=[o("option",{value:"1"},"General",-1),o("option",{value:"2"},"Policy",-1)]),512),[[J,l.type]])]),l.type!=="2"?(i(),d("div",re,[e[15]||(e[15]=o("label",null,"Publish Date",-1)),n(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.published_at=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[S,l.published_at]])])):g("",!0),l.type!=="2"?(i(),d("div",pe,[e[16]||(e[16]=o("label",null,"Expire Date",-1)),n(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.expired_at=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[S,l.expired_at]])])):g("",!0),o("div",ue,[o("div",me,[o("label",null,[n(o("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=t=>l.all_departments=t),onChange:R},null,544),[[k,l.all_departments]]),e[17]||(e[17]=v(" Select All Departments "))]),u(r(D),{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=t=>p.value=t),options:r(m).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",class:"w-full p-2 border rounded",disabled:l.all_departments},null,8,["modelValue","options","disabled"])]),o("div",ce,[o("label",null,[n(o("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=t=>l.all_employees=t),onChange:B},null,544),[[k,l.all_employees]]),e[18]||(e[18]=v(" Select All Employees "))]),u(r(D),{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=t=>y.value=t),options:r(M),multiple:!0,searchable:!0,placeholder:"Select Employee","track-by":"id",label:"name",class:"w-full p-2 border rounded",disabled:l.all_employees},null,8,["modelValue","options","disabled"])])]),o("div",null,[e[19]||(e[19]=o("label",null,"Title*",-1)),n(o("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>l.title=t),type:"text",class:"w-full p-2 border rounded"},null,512),[[S,l.title]])]),o("div",null,[e[20]||(e[20]=o("label",null,"File",-1)),l.file&&typeof l.file=="string"?(i(),d("div",ye,[o("a",{href:l.file,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,fe)])):g("",!0),o("input",{type:"file",onChange:j,class:"w-full p-2 border rounded"},null,32),s.fileName?(i(),d("p",be," Selected File: "+K(s.fileName),1)):g("",!0)]),o("div",ve,[e[21]||(e[21]=o("label",null,"Description",-1)),u(Z,{modelValue:l.description,"onUpdate:modelValue":e[11]||(e[11]=t=>l.description=t),cols:"30",rows:"10",class:"w-full px-4 py-2"},null,8,["modelValue"])])])])]),o("div",ge,[u(a,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:O(()=>e[24]||(e[24]=[v(" Cancel ")])),_:1}),e[25]||(e[25]=o("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32))])])}}};export{Ue as default};
