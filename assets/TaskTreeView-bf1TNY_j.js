import{o,c as u,F as q,x as O,k as A,r as M,y as N,A as P,p as R,a as t,e as y,m as v,n as p,l as f,t as d,q as x,z as V}from"./index-CF2vbTeX.js";const U={class:"mt-3"},H={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick"],setup(s,{emit:C}){const a=C;return(_,c)=>(o(),u("div",U,[(o(!0),u(q,null,O(s.childrenTasks,g=>(o(),A(de,{key:g.id,task:g,class:"mb-3","hide-buttons":s.hideButtons,"tree-level":s.parentTreeLevel+1,onEditClick:h=>a("editClick",g.id)},null,8,["task","hide-buttons","tree-level","onEditClick"]))),128))]))}},F={class:"flex w-full"},J={key:0,class:"border-l border-gray-200 last:border-l-0"},G={class:"items-start grid grid-cols-3"},K={class:""},Q={key:0,class:"text-sm text-gray-500 mt-2"},W={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-50"},X={class:"px-2 py-0.5 text-xs rounded bg-blue-100 text-blue-800 border border-blue-200"},Y={class:"flex items-start flex-wrap gap-3"},Z={class:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-medium text-gray-600"},ee={class:"text-xs text-gray-700 mr-2"},te={class:"flex justify-end items-center"},se={class:"text-sm"},re={class:"mt-4"},ne={class:"flex items-center"},ae={key:0,class:"fas fa-caret-down text-gray-400 group-hover:text-sky-400"},le={key:1,class:"fas fa-caret-right text-gray-400 group-hover:text-sky-400"},ie={key:0,class:"flex gap-2 ml-auto items-center text-xs"},oe={class:"ml-0"},de={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0}},emits:["commentButtonClick","editClick"],setup(s,{emit:C}){const a=s,_=C,c=M([]),g=localStorage.getItem("sub_task_opened_list");if(g)try{c.value=JSON.parse(g)}catch{c.value=[]}const h=N({get:()=>c.value.includes(a.task.id),set:r=>{const e=c.value.includes(a.task.id);r&&!e?c.value.push(a.task.id):!r&&e&&(c.value=c.value.filter(n=>n!==a.task.id))}});P(c,r=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(r))},{deep:!0});const $=N(()=>{var r,e,n,l;return{"hover:underline hover:text-sky-400 cursor-pointer":((e=(r=a.task)==null?void 0:r.children_tasks)==null?void 0:e.length)>0,"cursor-default pointer-none":((l=(n=a.task)==null?void 0:n.children_tasks)==null?void 0:l.length)===0}}),j=r=>r.split(" ").map(e=>e[0]).join("").toUpperCase(),z=r=>{switch(r){case"HIGH":return"border-red-500 text-red-500";case"MEDIUM":return"border-yellow-500 text-yellow-500";default:return"border-gray-300 text-gray-500"}},w=()=>{const r=m();let e,n,l;return r===100?(e="bg-green-50",n="bg-green-200",l="text-green-600 "):r<100&&(e="bg-red-50",n="bg-red-200",l="text-red-600 "),{container:e,bar:n,text:l}};function D(){a.task.children_tasks.length>0&&(h.value=!h.value)}function L(){if(a.task.children_tasks.length===0)return a.task.status==="COMPLETED"?1:0;const r=e=>{let n=0;for(let l=0;l<e.length;l++){const k=e[l];if(k.children_tasks.length===0)k.status==="COMPLETED"&&(n+=1);else{const b=k.children_tasks.length;r(k.children_tasks)===b&&(n+=1)}}return n};return r(a.task.children_tasks)}function m(){return a.task.children_tasks.length===0?a.task.status==="COMPLETED"?100:0:L()/a.task.children_tasks.length*100}return(r,e)=>{var l,k,b,T,B,E,S;const n=R("RouterLink");return o(),u("div",F,[s.treeLevel>0?(o(),u("div",J,e[3]||(e[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):y("",!0),t("div",{class:x(["flex-grow border rounded py-3 group px-3",{"bg-green-50 ":m()===100,"bg-gray-50":m()<100,"shadow-sm":s.treeLevel>0}])},[t("div",G,[t("div",K,[v(n,{to:{name:"TaskShow",params:{id:s.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:p(()=>[f(d(s.task.title),1)]),_:1},8,["to"]),(l=s.task)!=null&&l.requirement?(o(),u("p",Q," Requirement: "+d((b=(k=s.task)==null?void 0:k.requirement)==null?void 0:b.title),1)):y("",!0),t("div",W,[t("span",X,d(s.task.status),1),t("span",{class:x(["text-xs px-2 py-0.5 rounded border",z(s.task.priority)])},d(s.task.priority),3)])]),t("div",Y,[(o(!0),u(q,null,O(s.task.users,(i,I)=>(o(),u("div",{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",key:I},[t("div",Z,d(j(i==null?void 0:i.name)),1),t("span",ee,d(i.id)+" - "+d(i==null?void 0:i.name),1)]))),128))]),t("div",te,[t("div",se,[t("div",{class:x(["rounded-full border py-0.5 text-xs relative overflow-hidden h-6",w().container]),style:{width:"180px"}},[t("div",{class:x(["z-10 absolute top-0 bottom-0",w().bar]),style:V(`width: ${m()}%`)},null,6),t("span",{class:x(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",w().text])},[t("span",null,[t("span",null,d(L()),1),e[4]||(e[4]=f(" / ")),t("span",null,d(s.task.children_tasks.length||1),1)])],2)],2)])])]),t("div",re,[t("div",ne,[t("div",{class:"flex gap-3 group items-center",onClick:D},[h.value?(o(),u("i",ae)):(o(),u("i",le)),t("span",{class:x([$.value,"text-xs text-gray-500"])}," Sub Tasks ("+d((T=s.task.children_tasks)==null?void 0:T.length)+") ",3)]),s.hideButtons?y("",!0):(o(),u("div",ie,[t("button",{onClick:e[0]||(e[0]=i=>r.$emit("editClick",s.task.id)),class:"btn-2 py-0.5 text-xs"},e[5]||(e[5]=[t("i",{class:"fas fa-edit"},null,-1),f(" Edit ")])),v(n,{to:{name:"TaskReports",params:{id:(B=s.task)==null?void 0:B.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:p(()=>e[6]||(e[6]=[t("i",{class:"far fa-file-alt"},null,-1),f(" Reports ")])),_:1},8,["to"]),v(n,{to:{name:"TaskUserAssign",params:{id:(E=s.task)==null?void 0:E.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:p(()=>e[7]||(e[7]=[t("i",{class:"fas fa-user-plus"},null,-1),f(" Assign Users ")])),_:1},8,["to"]),v(n,{to:{name:"TaskAdd",query:{parent_id:(S=s.task)==null?void 0:S.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2",onClick:e[1]||(e[1]=i=>i.stopPropagation())},{default:p(()=>e[8]||(e[8]=[t("i",{class:"fas fa-plus"},null,-1),f(" Add Sub Task ")])),_:1},8,["to"])]))]),t("div",oe,[h.value?(o(),A(H,{key:0,childrenTasks:s.task.children_tasks,"hide-buttons":s.hideButtons,"parent-tree-level":s.treeLevel,onEditClick:e[2]||(e[2]=i=>_("editClick",i))},null,8,["childrenTasks","hide-buttons","parent-tree-level"])):y("",!0)])])],2)])}}};export{de as _};
