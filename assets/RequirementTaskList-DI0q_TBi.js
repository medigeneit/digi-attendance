import{L as oe}from"./LoaderView-okso0odE.js";import{O as F}from"./OverlyModal-CpvVG5lb.js";import{_ as X}from"./DepartmentChip-Bpfu9wJ1.js";import{_ as ne}from"./TaskAddForm-C0g46KNQ.js";import{_ as le}from"./TaskEditForm-CyihAvT_.js";import{_ as de}from"./TaskHeader-Cr1FKrhl.js";import{_ as ue}from"./TaskUserAssignForm-BEWtQCnD.js";import{b as te,m as U,c as l,o as i,g as d,a as e,F as B,y as S,x as V,t as b,k as c,j,p as _,f as $,w as Y,u as me,r as D,d as ce,z as Z,e as pe,A as G,i as N,I as ye}from"./index-fLGF1t2u.js";import{u as fe}from"./task-priority-C6mv7L5x.js";import{u as _e}from"./useRequirementStore-BQ_i61by.js";import{u as ge}from"./useTaskStore-CciR0UEx.js";import{_ as ke,T as xe,a as ve,b as be}from"./TaskUrgentBadge-sPOYaLvd.js";import{_ as he,a as Te}from"./TaskAssignedUsers-C1gCHxVq.js";import{T as we}from"./TaskIsClosedBadge-C40l2q3a.js";import{d as qe,b as Ce}from"./datetime-Efw590t9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-yYl6sLG8.js";import"./company-yYkmxq8i.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-BXA44_Vv.js";import"./SelectDropdown-Cij3S6Pn.js";import"./SectionLoading-lI0jpesn.js";import"./TextWithHr-D8soZAVZ.js";import"./TaskUrgencyInput-aZY8N9D0.js";import"./tags-BMftUTfr.js";import"./MultiselectDropdown-Dsq_EF-F.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang--5KOx3x3.js";import"./task-BLD4xcZ0.js";import"./EmployeeDropdownInput-DZ35nPSC.js";import"./UserChip-DFs-JNse.js";import"./SearchInput-DsGO4QYX.js";import"./user-Cr8z1mMd.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-CwBI-rUV.js";import"./TaskUserChip-9I_lSC3s.js";import"./requirement-CSILgD9M.js";import"./TaskTitle-DqV9DF5e.js";const $e={class:"w-full p-1"},Le={key:0,class:"w-full"},Ie={key:0,class:"group/dept"},Ae={class:"line-clamp-1"},Me={class:"ml-auto"},Re=["onClick"],Be={class:"border text-center py-2 px-1 border-gray-200"},De={key:0,class:"text-base font-semibold text-purple-600"},Se={class:"border px-3 py-1 border-gray-200 relative"},ze={class:"flex items-center justify-between gap-2"},Ee={class:"flex items-center gap-3 mb-0.5"},Oe={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Pe={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},Ue={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ve={class:"text-xs flex items-center gap-1 text-sky-400 ml-4"},Fe={class:"text-xs flex items-center gap-1 text-sky-400 ml-3"},je=["href","onClick"],Ne={class:"border px-3 py-1 border-gray-200"},He={class:"flex gap-2 justify-between items-center relative w-full"},Ke={class:"shrink-0"},Je=["href","onClick"],Qe={class:"border px-3 py-1 border-gray-200 text-center"},We={key:0,class:"ml-4 text-gray-500 text-sm"},Xe={class:"text-blue-500 font-semibold whitespace-nowrap"},Ye={class:"border px-3 border-gray-200 sticky right-0 border-l bg-sky-50"},Ze={class:"flex justify-end flex-wrap gap-2 py-2"},ee={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick","clickAddClick"],setup(R,{emit:g}){const z=R,m=te(),L=U(()=>z.tasks.reduce((k,r)=>{var A;const I=((A=r.requirement_detail)==null?void 0:A.id)||"-",a=[...k],p=a.find(h=>(h==null?void 0:h.key)==I);return p?p.tasks=[...p.tasks,r]:a.push({key:I,position:r!=null&&r.requirement_detail?0:1,...(r==null?void 0:r.requirement_detail)||{title:"(Other tasks)",id:0},tasks:[r]}),a},[]).sort((k,r)=>k.position-r.position)),f=g;return(k,r)=>{var I;return i(),l("div",$e,[((I=R.tasks)==null?void 0:I.length)>0?(i(),l("table",Le,[r[6]||(r[6]=e("thead",null,[e("tr",null,[e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(i(!0),l(B,null,S(L.value,(a,p)=>{var A,h;return i(),l(B,{key:a.id},[L.value.length===1&&((A=L.value[0])==null?void 0:A.id)==0?d("",!0):(i(),l("tr",Ie,[e("th",{colspan:"10",class:V(["font-semibold border hover:bg-orange-50",[(p>0,"")]])},[e("div",{class:V(["text-left pt-8 pb-1 px-2 flex",[a.id===0?"text-gray-500":"text-sky-800"]])},[e("div",null,[e("p",Ae,b(a==null?void 0:a.title),1)]),e("div",Me,[((h=c(m))==null?void 0:h.name)=="RequirementTaskList"?(i(),l("button",{key:0,onClick:t=>{var T,M,w;return f("clickAddTask",{requirement_id:(T=a.requirement)==null?void 0:T.id,requirement_detail_id:a.id,from_department_id:(M=a.requirement)==null?void 0:M.from_department_id,to_department_id:(w=a.requirement)==null?void 0:w.to_department_id},{requirement_id:!0,from_department_id:!0,to_department_id:!0})},class:"btn-2 whitespace-nowrap h-8 px-3 opacity-20 group-hover/dept:opacity-100"},r[0]||(r[0]=[e("i",{class:"fas fa-plus-circle"},null,-1),j(" Add Task ")]),8,Re)):d("",!0)])],2)],2)])),(i(!0),l(B,null,S(a.tasks,(t,T)=>{var M,w;return i(),l("tr",{key:t.id,class:V(["group/sub-task-row",{" bg-green-400/20":t.status=="COMPLETED"," bg-white hover:bg-slate-50":t.status!=="COMPLETED"}])},[e("td",Be,[T!==void 0?(i(),l("div",De,b(T+1)+". ",1)):d("",!0)]),e("td",Se,[e("div",ze,[e("div",null,[e("div",Ee,[_(ke,{titleClass:"text-sm",task:t,"sub-tasks-open":!1,isMyTask:c(m).name=="RequirementList",to:R.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",Oe,[e("div",Pe,[r[1]||(r[1]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,b(c(qe)(t.created_at)),1)]),e("div",Ue,[t!=null&&t.is_important?(i(),$(xe,{key:0})):d("",!0),t!=null&&t.is_urgent?(i(),$(ve,{key:1})):d("",!0)]),e("div",Ve,[r[2]||(r[2]=e("i",{class:"fas fa-tasks"},null,-1)),j(" "+b(t==null?void 0:t.todos_count),1)]),e("div",Fe,[r[3]||(r[3]=e("i",{class:"fas fa-book"},null,-1)),j(" "+b((M=t==null?void 0:t.requirement_detail)==null?void 0:M.id),1)])])]),!t.is_closed&&!R.hideButtons?(i(),l("a",{key:0,href:`/tasks/edit/${t.id}`,onClick:Y(x=>f("editClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},r[4]||(r[4]=[e("i",{class:"fas fa-edit"},null,-1)]),8,je)):d("",!0)])]),e("td",Ne,[e("div",He,[_(he,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:t.users||[],isTargetTask:t.is_target,maxItem:1,"route-to":x=>`/requirement-tasks?status=not-completed&view=userwise&user-ids=${x.id}`},null,8,["users","isTargetTask","route-to"]),e("div",Ke,[!t.is_closed&&!R.hideButtons?(i(),l("a",{key:0,href:`/tasks/${t.id}/assign-users`,onClick:Y(x=>f("employeeAssignClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},r[5]||(r[5]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,Je)):d("",!0)])])]),e("td",Qe,[t.deadline?(i(),l("span",We,[e("span",Xe,b(c(Ce)(t.deadline)),1)])):d("",!0)]),e("td",Ye,[e("div",Ze,[t.closed_at?(i(),$(we,{key:0})):d("",!0),_(Te,{status:t==null?void 0:t.status,progressPercent:(t==null?void 0:t.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((w=t==null?void 0:t.children_tasks)==null?void 0:w.length)>0?(i(),$(be,{key:1,ref_for:!0,ref:"progress",task:t,class:"text-sm w-full"},null,8,["task"])):d("",!0)])])],2)}),128))],64)}),128))])])):d("",!0)])}}},Ge={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},et={class:"mb-4"},tt={key:4,class:"text-center py-4 text-red-500"},st={class:"relative min-h-[20vh]"},rt={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},it={class:"font-semibold flex items-center gap-2"},at={class:"text-white text-base"},ot={class:"rounded-b-md overflow-y-auto"},nt={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},lt={class:"font-semibold flex items-center gap-2"},dt={class:"ml-auto"},ut=["onClick"],mt={class:"rounded-b-md overflow-y-auto"},ct={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},Wt={__name:"RequirementTaskList",setup(R){const g=ge(),z=_e(),m=te(),L=me(),f=D(""),k=D(null),r=D(!1),I=ce(),a=Z({parentId:0,requirementId:0,params:{}}),p=Z({taskId:0,isOpen:!1}),A=U(()=>{const o=m.query["user-ids"]||null,s=(g.tasks||[]).flatMap(y=>{var v;return o?(v=y.users)==null?void 0:v.filter(O=>o.includes(O.id)):y.users});return[...new Map(s.map(y=>[y.id,y])).values()].sort((y,v)=>y.id-v.id)}),h=U(()=>(g.tasks||[]).reduce((o,s)=>{const q=`${s.from_department_id}-${s.to_department_id}`,y=o.find(v=>v.key==q);return y?y.tasks=[...y.tasks,s]:o.push({key:q,from_department:s.from_department,to_department:s.to_department,tasks:[s]}),o},[])),t=D(null),T=D([]),{saveTaskPriority:M,listHasRearranged:w}=fe(()=>g.taskListTree,0);pe(()=>{console.log("Task List Mounted"),f.value="loading",x()});async function x(){console.log({name:m.name}),m.name=="RequirementTaskList"&&await g.fetchAllTasks({...m.query,page:1}),m.name=="MyRequirementTaskList"&&await g.fetchAllMyTasks({...m.query,page:1}),f.value="",T.value=[]}const E=(o,s)=>{r.value=!0,a.params=o,a.readonlyValues=s},H=o=>{p.taskId=o,p.isOpen=!0};async function K(){k.value=null,r.value=!1,f.value="loading",a.params={},await x()}async function se(){r.value=!1,a.params={},await x()}async function re(){f.value="loading",await M()&&await x()}function ie(o){return g.tasks.filter(s=>(s.users||[]).some(q=>q.id===o))}G(()=>({...m.query}),async()=>{try{g.resetTaskList(),f.value="loading",await x()}catch(o){console.warn(o)}}),G(()=>I.isAdminMood,o=>{o?L.push({name:"RequirementTaskList"}):L.push({name:"MyRequirementTaskList"})},{immediate:!0});const J=U({get(){return{...m.query}},set(o){localStorage.removeItem("sub_task_opened_list"),L.push({query:{...o}})}});function ae(o){return{name:"RequirementTaskShow",params:{id:(o==null?void 0:o.id)||0}}}return(o,s)=>{var q,y,v,O,Q;return i(),l("div",Ge,[k.value?(i(),$(F,{key:0},{default:N(()=>[_(le,{taskId:k.value,onClose:s[0]||(s[0]=n=>k.value=null),onUpdated:K},null,8,["taskId"])]),_:1})):d("",!0),r.value?(i(),$(F,{key:1},{default:N(()=>{var n,u;return[_(ne,{parentTaskId:a.parentId,requirementId:(n=a.params)==null?void 0:n.requirement_id,requirementDetailId:(u=a.params)==null?void 0:u.requirement_detail_id,"default-values":a.params,"readonly-fields":a.readonlyValues,onClose:se,onTaskCreated:K},null,8,["parentTaskId","requirementId","requirementDetailId","default-values","readonly-fields"])]}),_:1})):d("",!0),p.isOpen?(i(),$(F,{key:2,class:"*:max-w-4xl"},{default:N(()=>[_(ue,{taskId:p.taskId,onCancelClick:s[1]||(s[1]=()=>{p.isOpen=!1,p.taskId=0}),onSuccess:s[2]||(s[2]=()=>{p.isOpen=!1,p.taskId=0,f.value="loading",x()})},null,8,["taskId"])]),_:1})):d("",!0),_(de,{modelValue:J.value,"onUpdate:modelValue":s[3]||(s[3]=n=>J.value=n),onClickAddTask:E,onClickPrioritySave:re,onClickPriorityDiscard:s[4]||(s[4]=()=>c(w)?t.value.resetItems:null),"list-has-rearranged":c(w),isMyTask:c(m).name==="MyRequirementTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((y=(q=c(m))==null?void 0:q.query)==null?void 0:y["query-log"])=="true"?(i(!0),l(B,{key:3},S(T.value,(n,u)=>(i(),l("div",{key:u,class:"text-xs text-gray-500"},[e("div",et,b(n.raw_query),1)]))),128)):d("",!0),c(z).error?(i(),l("div",tt,b(c(z).error),1)):d("",!0),e("div",st,[((v=c(m).query)==null?void 0:v.view)==="userwise"?(i(!0),l(B,{key:0},S(A.value,n=>(i(),l("div",{key:n.id,class:"mt-8 rounded-md border-2 border-sky-300"},[e("div",rt,[e("div",it,[_(ye,{user:n},null,8,["user"]),e("div",at,b(n.label),1)])]),e("div",ot,[_(ee,{tasks:ie(n.id),onEditClick:s[5]||(s[5]=u=>k.value=u),onAddClick:s[6]||(s[6]=u=>E(u)),onEmployeeAssignClick:s[7]||(s[7]=u=>H(u)),taskLinkTo:u=>({name:"RequirementTaskShow",params:{id:(u==null?void 0:u.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128)):(i(!0),l(B,{key:1},S(h.value,n=>{var u,W;return i(),l("div",{key:n.key,class:"mt-8 rounded-md border-2 border-sky-300"},[e("div",nt,[e("div",lt,[s[11]||(s[11]=e("span",{class:"text-white text-sm"},"From",-1)),_(X,{department:n.from_department},null,8,["department"]),s[12]||(s[12]=e("span",{class:"text-white text-sm"},"To",-1)),_(X,{department:n.to_department},null,8,["department"])]),e("div",dt,[((u=c(m))==null?void 0:u.name)=="RequirementTaskList"?(i(),l("button",{key:0,onClick:()=>{var C,P;return E({from_department_id:(C=n==null?void 0:n.from_department)==null?void 0:C.id,to_department_id:(P=n==null?void 0:n.to_department)==null?void 0:P.id},{from_department_id:!0,to_department_id:!0})},class:"btn-3 h-6 whitespace-nowrap bg-white border-white px-2"}," Add Task ",8,ut)):d("",!0)])]),e("div",mt,[_(ee,{tasks:n.tasks,groupBy:"requirement_details",onEditClick:s[8]||(s[8]=C=>k.value=C),onClickAddTask:s[9]||(s[9]=(C,P)=>E(C,P)),onEmployeeAssignClick:s[10]||(s[10]=C=>H(C)),hideButtons:((W=c(m))==null?void 0:W.name)!=="RequirementTaskList",taskLinkTo:ae},null,8,["tasks","hideButtons"])])])}),128)),f.value!=="loading"&&((O=c(g).tasks)==null?void 0:O.length)===0?(i(),l("div",ct," No tasks ")):d("",!0),f.value==="loading"?(i(),$(oe,{key:3,class:V(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((Q=c(g).tasks)==null?void 0:Q.length)===0?"justify-center":""]])},null,8,["class"])):d("",!0)])])}}};export{Wt as default};
