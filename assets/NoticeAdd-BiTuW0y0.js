import{N as ie,u as re,s as de,z as K,r as j,x as u,e as ue,A as f,m as pe,c as i,o as r,a as e,j as h,n as _,i as B,q as m,t as a,g as x,F,y as M,h as T,v as U,w as me}from"./index-BRcUpGA5.js";import{_ as L}from"./MultiselectDropdown-Dd7mynQq.js";import{_ as ce}from"./TextEditor-C02J80Yo.js";import{u as be}from"./company-Aq0ticOI.js";import{u as ve}from"./department-DfBzBXZR.js";import{u as xe}from"./notice-tC7EGRua.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-CK4aDEbC.js";const ge={class:"mx-auto max-w-6xl px-3 md:px-6 py-4"},ye={class:"flex items-center justify-between mb-5"},fe={class:"hidden md:flex gap-2"},he=["disabled"],_e={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},we={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},ke={class:"flex items-center justify-between"},Ce={class:"flex items-center gap-3"},De={class:"font-semibold"},je={key:0,class:"text-[11px] text-gray-500 hidden md:block"},Ve={key:0},Se={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},Ae={class:"flex items-center justify-between"},Ne={class:"flex items-center gap-3"},Ee={class:"font-semibold"},ze={key:0,class:"text-[11px] text-gray-500 hidden md:block"},Pe={key:0},$e={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},Be={class:"flex items-center justify-between"},Fe={class:"flex items-center gap-3"},Me={class:"font-semibold"},Te={key:0,class:"text-[11px] text-gray-500 hidden md:block"},Ue={key:0},Le={class:"rounded-2xl border bg-white/70 p-5 shadow-sm"},Re={class:"flex items-center justify-between"},qe={class:"inline-flex rounded-xl border overflow-hidden"},Oe={class:"rounded-2xl border bg-white/70 p-5 shadow-sm space-y-6"},Ge={class:"grid md:grid-cols-3 gap-6"},He={class:"md:col-span-3 flex justify-between gap-4"},Je={class:"w-full"},Xe={key:0,class:"text-red-500 text-xs mt-1"},Ie={class:"w-full"},Ke={key:0,class:"text-red-500 text-xs mt-1"},Qe={class:"space-y-2 md:col-span-3"},We={class:"space-y-2"},Ye={class:"flex items-center justify-between"},Ze={class:"inline-flex rounded-lg border overflow-hidden"},et={class:"space-y-22"},tt={class:"flex items-center justify-between"},st={class:"inline-flex rounded-lg border overflow-hidden"},lt={class:"space-y-2 md:col-span-3"},ot={class:"flex items-center justify-between"},at={class:"inline-flex items-center gap-3"},nt={class:"text-xs text-gray-500"},it={class:"inline-flex rounded-lg border overflow-hidden"},rt={class:"rounded-2xl border bg-white/70 p-5 shadow-sm space-y-6"},dt={key:0,class:"text-red-500 text-xs mt-1"},ut={class:"grid md:grid-cols-2 gap-4 items-start"},pt={class:"space-y-2"},mt={class:"flex items-center justify-between gap-3"},ct={class:"inline-flex items-center"},bt={key:0,class:"mt-3 flex items-center justify-between bg-white rounded-lg border p-2.5"},vt={class:"text-sm truncate"},xt={class:"font-medium"},gt={class:"sticky bottom-0 z-10 bg-white/90 backdrop-blur flex justify-end gap-2 p-3 rounded-2xl border shadow-sm md:hidden"},yt=["disabled"],ft={class:"hidden md:flex items-center justify-end gap-2"},ht=["disabled"],At={__name:"NoticeAdd",setup(_t){const D=ie(),Q=re(),R=xe(),q=be(),w=ve(),{companies:W}=de(q),s=K({title:"",type:1,description:"",published_at:"",expired_at:"",all_companies:!1,all_departments:!1,all_employees:!1,file:null}),b=j([]),v=j([]),c=j([]),V=u(()=>W.value||[]),S=u(()=>w.departments||[]),A=u(()=>w.employees||[]),O=u(()=>b.value.map(l=>l.id)),G=u(()=>v.value.map(l=>l.id)),Y=u(()=>c.value.map(l=>l.id)),k=j(!1),p=K({}),N=u({get:()=>s.all_companies?"all":"custom",set:l=>{s.all_companies=l==="all",b.value=s.all_companies?[...V.value]:[]}}),E=u({get:()=>s.all_departments?"all":"custom",set:l=>{s.all_departments=l==="all",v.value=s.all_departments?[...S.value]:[]}}),z=u({get:()=>s.all_employees?"all":"custom",set:l=>{s.all_employees=l==="all",c.value=s.all_employees?[...A.value]:[]}});ue(async()=>{await q.fetchCompanies()}),f(()=>s.all_companies,async l=>{l&&await w.fetchDepartments()}),f(O,async l=>{s.all_companies||await w.fetchDepartments(l)}),f(()=>s.all_departments,async l=>{l&&await w.fetchDepartmentEmployee("all")}),f(G,async l=>{s.all_departments||await w.fetchDepartmentEmployee(l)}),f(b,l=>{s.all_companies=l.length===V.value.length&&l.length>0}),f(v,l=>{s.all_departments=l.length===S.value.length&&l.length>0}),f([c,A],([l,t])=>{const n=Array.isArray(t)?t.length:0;s.all_employees=n>0&&l.length===n});const P=j(!1),Z=l=>{var n,d;const t=(d=(n=l==null?void 0:l.target)==null?void 0:n.files)==null?void 0:d[0];H(t)},ee=l=>{var n,d;l.preventDefault(),P.value=!1;const t=(d=(n=l.dataTransfer)==null?void 0:n.files)==null?void 0:d[0];H(t)},te=l=>{l.preventDefault(),P.value=!0},se=()=>{P.value=!1},H=l=>{if(!l){s.file=null;return}if(!["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type)){D.error("Unsupported file type. Allowed: jpg, jpeg, png, pdf, doc, docx."),s.file=null;return}if(l.size>2*1024*1024){D.error("File size must be ≤ 2MB."),s.file=null;return}s.file=l},le=()=>{s.file=null},g=(l,t="name",n=3)=>{const d=Array.isArray(l)?l:[],o=d.slice(0,n).map($=>($==null?void 0:$[t])??"—"),y=Math.max(0,d.length-n);return{head:o,more:y}},J=u(()=>{if(s.type===2||!s.published_at||!s.expired_at)return!0;try{return new Date(s.expired_at)>=new Date(s.published_at)}catch{return!0}}),oe=()=>{var l;return Object.keys(p).forEach(t=>delete p[t]),(l=s.title)!=null&&l.trim()||(p.title="Title is required"),s.type!==2&&!s.published_at&&(p.published_at="Publish date is required"),J.value||(p.expired_at="Expired date must be on/after publish date"),Object.keys(p).length===0},C=u(()=>{var l;return!k.value&&!!((l=s.title)!=null&&l.trim())&&(s.type===2||!!s.published_at)&&J.value}),X=async()=>{var t,n;if(!oe()){D.error("Please fix the errors and try again.");return}const l={title:s.title,type:s.type,description:s.description,published_at:s.type===2?null:s.published_at,expired_at:s.type===2?null:s.expired_at||null,all_companies:s.all_companies,all_departments:s.all_departments,all_employees:s.all_employees,company_ids:O.value,department_ids:G.value,employee_ids:Y.value,file:s.file};try{k.value=!0,await R.createNotice(l),D.success("Notice created successfully"),await R.fetchNotices(),Q.replace("/hrd/notice")}catch(d){const o=((n=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to save notice";D.error(o),console.error(d)}finally{k.value=!1}},ae=u(()=>V.value.length),ne=u(()=>S.value.length),I=u(()=>A.value.length);return(l,t)=>{var d;const n=pe("RouterLink");return r(),i("div",ge,[e("div",ye,[t[16]||(t[16]=e("div",null,[e("h1",{class:"text-2xl md:text-3xl font-semibold tracking-tight"},"Add Notice"),e("p",{class:"text-sm text-gray-500"},[h("Fields marked "),e("span",{class:"text-red-500"},"*"),h(" are required.")])],-1)),e("div",fe,[_(n,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:B(()=>t[15]||(t[15]=[h(" Cancel ")])),_:1,__:[15]}),e("button",{disabled:!C.value,onClick:X,class:m(["px-4 py-2 rounded-xl text-white text-sm",C.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(k.value?"Saving…":"Save"),11,he)])]),e("div",_e,[e("div",we,[e("div",ke,[e("div",Ce,[t[18]||(t[18]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-blue-100 to-blue-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-blue-600"},[e("path",{fill:"currentColor",d:"M3 10v10h18V10H3zm9-7l9 7H3l9-7z"})])],-1)),e("div",null,[t[17]||(t[17]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Companies",-1)),e("div",De,a(s.all_companies?"All":b.value.length)+" / "+a(ae.value),1)])]),!s.all_companies&&b.value.length?(r(),i("div",je,[(r(!0),i(F,null,M(g(b.value,"name",3).head,(o,y)=>(r(),i("span",{key:"c"+y,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),g(b.value,"name",3).more?(r(),i("span",Ve,"+"+a(g(b.value,"name",3).more),1)):x("",!0)])):x("",!0)])]),e("div",Se,[e("div",Ae,[e("div",Ne,[t[20]||(t[20]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-purple-100 to-purple-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-purple-600"},[e("path",{fill:"currentColor",d:"M3 5h18v2H3V5zm3 4h12v10H6V9z"})])],-1)),e("div",null,[t[19]||(t[19]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Departments",-1)),e("div",Ee,a(s.all_departments?"All":v.value.length)+" / "+a(ne.value),1)])]),!s.all_departments&&v.value.length?(r(),i("div",ze,[(r(!0),i(F,null,M(g(v.value,"name",3).head,(o,y)=>(r(),i("span",{key:"d"+y,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),g(v.value,"name",3).more?(r(),i("span",Pe,"+"+a(g(v.value,"name",3).more),1)):x("",!0)])):x("",!0)])]),e("div",$e,[e("div",Be,[e("div",Fe,[t[22]||(t[22]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-emerald-100 to-emerald-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-emerald-600"},[e("path",{fill:"currentColor",d:"M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"})])],-1)),e("div",null,[t[21]||(t[21]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",Me,a(s.all_employees?"All":c.value.length)+" / "+a(I.value),1)])]),!s.all_employees&&c.value.length?(r(),i("div",Te,[(r(!0),i(F,null,M(g(c.value,"name",3).head,(o,y)=>(r(),i("span",{key:"e"+y,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),g(c.value,"name",3).more?(r(),i("span",Ue,"+"+a(g(c.value,"name",3).more),1)):x("",!0)])):x("",!0)])])]),e("form",{onSubmit:me(X,["prevent"]),class:"space-y-8"},[e("section",Le,[e("div",Re,[t[23]||(t[23]=e("h3",{class:"text-base font-semibold"},"Notice Type",-1)),e("div",qe,[e("button",{type:"button",class:m(["px-4 py-2 text-sm",s.type===1?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[0]||(t[0]=o=>s.type=1)}," General ",2),e("button",{type:"button",class:m(["px-4 py-2 text-sm border-l",s.type===2?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[1]||(t[1]=o=>s.type=2)}," Policy ",2)])]),t[24]||(t[24]=e("p",{class:"text-xs text-gray-500 mt-2"}," Policies usually don’t require publish/expire dates and remain visible until replaced. ",-1))]),e("section",Oe,[t[30]||(t[30]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-base font-semibold"},"Audience & Scope"),e("span",{class:"text-xs text-gray-500"},"Define who should see this notice")],-1)),e("div",Ge,[e("div",He,[e("div",Je,[t[25]||(t[25]=e("label",{class:"font-medium"},[h("Publish Date "),e("span",{class:"text-red-500"},"*")],-1)),T(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.published_at=o),type:"date",class:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[U,s.published_at]]),p.published_at?(r(),i("p",Xe,a(p.published_at),1)):x("",!0)]),e("div",Ie,[t[26]||(t[26]=e("label",{class:"font-medium"},"Expire Date",-1)),T(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.expired_at=o),type:"date",class:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[U,s.expired_at]]),p.expired_at?(r(),i("p",Ke,a(p.expired_at),1)):x("",!0)])]),e("div",Qe,[e("div",We,[e("div",Ye,[t[27]||(t[27]=e("label",{class:"font-medium"},"Companies",-1)),e("div",Ze,[e("button",{type:"button",class:m(["px-3 py-1.5 text-xs",N.value==="all"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[4]||(t[4]=o=>N.value="all")},"All",2),e("button",{type:"button",class:m(["px-3 py-1.5 text-xs border-l",N.value==="custom"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[5]||(t[5]=o=>N.value="custom")},"Custom",2)])]),_(L,{modelValue:b.value,"onUpdate:modelValue":t[6]||(t[6]=o=>b.value=o),options:V.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select companies"},null,8,["modelValue","options"])]),e("div",et,[e("div",tt,[t[28]||(t[28]=e("label",{class:"font-medium"},"Departments",-1)),e("div",st,[e("button",{type:"button",class:m(["px-3 py-1.5 text-xs",E.value==="all"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[7]||(t[7]=o=>E.value="all")},"All",2),e("button",{type:"button",class:m(["px-3 py-1.5 text-xs border-l",E.value==="custom"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[8]||(t[8]=o=>E.value="custom")},"Custom",2)])]),_(L,{modelValue:v.value,"onUpdate:modelValue":t[9]||(t[9]=o=>v.value=o),options:S.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select departments"},null,8,["modelValue","options"])])]),e("div",lt,[e("div",ot,[t[29]||(t[29]=e("label",{class:"font-medium"},"Employees",-1)),e("div",at,[e("span",nt,"Selected "+a(c.value.length)+" / "+a(I.value),1),e("div",it,[e("button",{type:"button",class:m(["px-3 py-1.5 text-xs",z.value==="all"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[10]||(t[10]=o=>z.value="all")},"All",2),e("button",{type:"button",class:m(["px-3 py-1.5 text-xs border-l",z.value==="custom"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[11]||(t[11]=o=>z.value="custom")},"Custom",2)])])]),_(L,{modelValue:c.value,"onUpdate:modelValue":t[12]||(t[12]=o=>c.value=o),options:A.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select employees"},null,8,["modelValue","options"])])])]),e("section",rt,[t[37]||(t[37]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-base font-semibold"},"Notice Content"),e("span",{class:"text-xs text-gray-500"},"Craft the headline & attach relevant docs")],-1)),e("div",null,[t[31]||(t[31]=e("label",{class:"block font-medium mb-1"},[h("Title "),e("span",{class:"text-red-500"},"*")],-1)),T(e("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>s.title=o),type:"text",class:"w-full p-2.5 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[U,s.title]]),p.title?(r(),i("p",dt,a(p.title),1)):x("",!0)]),e("div",ut,[e("div",pt,[t[35]||(t[35]=e("label",{class:"block font-medium"},"Attachment",-1)),e("div",{class:m(["rounded-xl border border-dashed p-5 transition relative",P.value?"bg-blue-50 border-blue-300":"hover:bg-gray-50"]),onDragover:te,onDragleave:se,onDrop:ee},[e("div",mt,[t[33]||(t[33]=e("div",{class:"text-sm text-gray-600"},[e("div",{class:"font-medium"},"Drag & drop or click to upload"),e("div",null,"JPG, JPEG, PNG, PDF, DOC, DOCX (≤ 2MB)")],-1)),e("label",ct,[e("input",{type:"file",accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",onChange:Z,class:"hidden"},null,32),t[32]||(t[32]=e("span",{class:"px-4 py-2 rounded-lg border bg-white hover:bg-gray-50 cursor-pointer text-sm"}," Browse… ",-1))])]),s.file?(r(),i("div",bt,[e("span",vt,[t[34]||(t[34]=e("span",{class:"text-gray-500 mr-1"},"Selected:",-1)),e("span",xt,a((d=s.file)==null?void 0:d.name),1)]),e("button",{type:"button",class:"px-3 py-1.5 rounded-lg border hover:bg-gray-50 text-sm",onClick:le}," Remove ")])):x("",!0)],34)])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block font-medium mb-1"},"Description",-1)),_(ce,{modelValue:s.description,"onUpdate:modelValue":t[14]||(t[14]=o=>s.description=o),class:"w-full"},null,8,["modelValue"])])]),e("div",gt,[_(n,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:B(()=>t[38]||(t[38]=[h(" Cancel ")])),_:1,__:[38]}),e("button",{disabled:!C.value,type:"submit",class:m(["px-4 py-2 rounded-xl text-white text-sm",C.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(k.value?"Saving…":"Save"),11,yt)]),e("div",ft,[_(n,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:B(()=>t[39]||(t[39]=[h(" Cancel ")])),_:1,__:[39]}),e("button",{disabled:!C.value,type:"submit",class:m(["px-4 py-2 rounded-xl text-white text-sm",C.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(k.value?"Saving…":"Save"),11,ht)])],32)])}}};export{At as default};
