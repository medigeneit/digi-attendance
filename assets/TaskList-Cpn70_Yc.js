import{s as R,b as j,u as G,r as c,y as B,D as P,e as Q,A as x,c as n,o,m as V,f as h,a,l as p,p as $,g as z,C as H,F as A,x as E,t as F,h as r}from"./index-C06RZP8W.js";import{_ as J}from"./CommentModal-BGlQEqMY.js";import{O as D}from"./OverlyModal-C5wxI9uV.js";import{_ as K}from"./MultiselectDropdown-B8tHSCNs.js";import{_ as W}from"./TaskAddForm-CFDQqZrJ.js";import{_ as X}from"./TaskEditForm-DVzSLU7E.js";import{_ as Y}from"./TaskTreeView-DSgsSPJ0.js";import{u as Z}from"./company-CYWlBZFU.js";import{u as ee}from"./useTaskStore-DYnjlizl.js";import"./useCommentStore-Dodu1H24.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-H4W6riin.js";import"./useRequirementStore-BqcIB6nc.js";import"./SectionLoading-ekAVq7Wf.js";const te={class:"container mx-auto p-6 relative"},se={class:"mb-3"},ae={class:"flex flex-wrap items-center gap-2 mt-3"},oe={class:"flex gap-4"},le={class:"flex-shrink-0 w-full md:w-64 text-gray-600"},ne=["value"],re={key:2,class:"text-center py-4 text-red-500"},de={class:"space-y-4"},ue=1,Te={__name:"TaskList",setup(ie){const d=ee(),k=Z(),{companies:L,employees:I}=R(k),l=j(),M=G(),_=c(!1),C=c(null),w=B(g("company-id")),b=B(g("user-id")),f=c(),u=c(null),v=c(!1),i=P({parentId:0,requirementId:0});Q(async()=>{await k.fetchCompanies(),await y()});const T=t=>{v.value=!0,i.parentId=t};function g(t){return{set:e=>{M.push({query:{...l.query,[t]:e||void 0}})},get:()=>l.query[t]||""}}const U=t=>{C.value=t,_.value=!0},N=()=>{_.value=!1,C.value=null};x(()=>w.value,async t=>{t&&(await k.fetchEmployee(t),f.value=I.value.find(e=>e.id==b.value)||null)},{initial:!0,immediate:!0}),x(()=>({"user-id":l.query["user-id"],"company-id":l.query["company-id"]}),async()=>{y()});async function y(){await d.fetchTasks({user_ids:l.query["user-id"]||void 0,company_id:l.query["company-id"]||void 0},{loadingBeforeFetch:!0})}async function q(){u.value=null,v.value=!1,i.parentId=0,await y()}async function O(){v.value=!1,i.parentId=0,await y()}return x(f,t=>{b.value=t==null?void 0:t.id}),(t,e)=>{var S;return o(),n("div",te,[u.value?(o(),V(D,{key:0},{default:$(()=>[p(X,{taskId:u.value,class:"rounded-full",onClose:e[0]||(e[0]=s=>u.value=null),onUpdated:q},null,8,["taskId"])]),_:1})):h("",!0),v.value?(o(),V(D,{key:1},{default:$(()=>[p(W,{parentTaskId:i.parentId,requirementId:i.requirementId,class:"rounded-full",onClose:O,onTaskCreated:q},null,8,["parentTaskId","requirementId"])]),_:1})):h("",!0),a("div",se,[e[6]||(e[6]=a("div",{class:"flex justify-between items-center"},[a("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),a("div",ae,[a("div",oe,[a("div",le,[z(a("select",{id:"company-filter","onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),class:"input-1 h-full"},[e[5]||(e[5]=a("option",{value:""},"Select Company",-1)),(o(!0),n(A,null,E(r(L),s=>(o(),n("option",{key:s.id,value:s.id},F(s.name),9,ne))),128))],512),[[H,w.value]])]),p(K,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=s=>f.value=s),options:r(I),multiple:!1,label:"name","label-prefix":"id",placeholder:"Please select employee...",class:"w-full md:w-64 text-gray-600"},null,8,["modelValue","options"])]),a("button",{onClick:T,class:"btn-1 ml-auto"},"Add Task")])]),r(d).error?(o(),n("div",re,F(r(d).error),1)):h("",!0),a("div",de,[(o(!0),n(A,null,E(((S=r(d))==null?void 0:S.taskListTree)||[],s=>(o(),n("div",{key:s.id,class:"rounded-lg border bg-white overflow-hidden"},[p(Y,{task:s,class:"!border-0",onCommentButtonClick:m=>U(m,s.id),onEditClick:e[3]||(e[3]=m=>u.value=m),onAddClick:e[4]||(e[4]=m=>T(m))},null,8,["task","onCommentButtonClick"])]))),128))]),p(J,{show:_.value,"commentable-id":C.value,"commentable-type":"task","user-id":ue,"on-close":N,onSubmitted:r(d).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Te as default};
