import{r as S,c as i,o,a as s,f as y,E as K,h as a,w as h,t as b,l as k,p as g,D as J,m as P,b as Q,u as W,q as I,e as X,A as Y,k as V,F as G,x as $,y as Z,_ as tt,n as C}from"./index-CJiD8-Yn.js";import{u as st,_ as et,O as H,a as at}from"./task-priority-B5Pl1T5q.js";import{_ as nt}from"./TaskAddForm-CuWbwjHE.js";import{_ as ot}from"./TaskEditForm-CYMcrau4.js";import{_ as rt,a as it}from"./TaskTreeView-jWRH_f3A.js";import{u as lt}from"./useTaskStore-Ckrq_MDk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-D5fukcRD.js";import"./SectionLoading-Bji4oAOJ.js";const dt={class:"mb-3"},ut={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},pt={key:1,class:"text-center py-4 text-gray-500"},kt={key:2,class:"text-center py-4 text-red-500"},mt={key:3,class:"space-y-4"},ct={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(m,{emit:e}){const d=m,c=e,p=S(null),{handleItemsPriorityUpdate:l,saveTaskPriority:x,listHasRearranged:v}=st(()=>d.tasks,d.parentId),T=async()=>{await x(),c("updatePriority")};return(f,u)=>(o(),i("div",null,[s("div",dt,[K(f.$slots,"task:header")]),a(v)?(o(),i("div",ut,[u[3]||(u[3]=s("span",{class:"text-red-500"},"Priority Changed",-1)),s("button",{class:"btn-3",onClick:h(T,["prevent"])},"Save"),s("button",{class:"btn-3",onClick:u[0]||(u[0]=h((...n)=>p.value.resetItems&&p.value.resetItems(...n),["prevent"]))},"Discard")])):y("",!0),m.loading?(o(),i("div",pt,"Loading tasks...")):m.error?(o(),i("div",kt,b(m.error),1)):(o(),i("div",mt,[k(et,{items:m.tasks,handle:"handle",onItemsUpdate:a(l),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:p},{item:g(({item:n})=>[k(rt,{task:n,class:"!border-0",onCommentButtonClick:t=>c("commentButtonClick",n.id),onEditClick:u[1]||(u[1]=t=>c("editClick",t)),onAddClick:u[2]||(u[2]=t=>c("addClick",t)),showDraggableHandle:!0},null,8,["task","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},ft={class:"flex justify-between mt-5"},gt={class:"flex flex-wrap items-center gap-2 mt-3"},yt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(m,{emit:e}){const d=m,c=e,p=S(),l=J({show:!1,parentId:d.parentId,requirementId:null}),x=u=>{l.show=!0,l.parentId=u,console.log({addForm:l})};function v(){l.show=!1,l.parentId=d.parentId,c("created")}function T(){p.value=!1,c("updated")}function f(){l.show=!1,l.parentId=d.parentId}return(u,n)=>(o(),i("div",null,[p.value?(o(),P(H,{key:0},{default:g(()=>[k(ot,{taskId:p.value,onClose:n[0]||(n[0]=t=>p.value=null),onUpdated:T},null,8,["taskId"])]),_:1})):y("",!0),l.show?(o(),P(H,{key:1},{default:g(()=>[k(nt,{parentTaskId:l.parentId,requirementId:l.requirementId,onTaskCreated:v,onError:u.handleTaskError,onClose:f},null,8,["parentTaskId","requirementId","onError"])]),_:1})):y("",!0),k(ct,{tasks:m.subTasks,parentId:m.parentId,onAddClick:n[2]||(n[2]=t=>x(t)),onEditClick:n[3]||(n[3]=t=>p.value=t),onUpdatePriority:n[4]||(n[4]=t=>c("updatePriority"))},{"task:header":g(()=>[s("div",ft,[n[5]||(n[5]=s("div",{class:"flex justify-between items-center"},[s("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),s("div",gt,[s("button",{class:"btn-1 ml-auto",onClick:n[1]||(n[1]=h(()=>x(m.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId"])]))}},xt={class:"container mx-auto p-6"},bt={class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6"},vt={class:"grid grid-cols-4"},Tt={class:"mb-2 font-medium col-span-full text-xl flex"},_t={class:"text-right col-span-full md:col-span-1 ml-auto flex justify-center gap-4 !text-lg"},wt={class:"py-2 font-medium mb-4 col-span-full md:col-span-2"},Ct={class:"flex items-center flex-wrap gap-3"},ht={class:"text-xs text-gray-700 mr-2"},It={key:0,class:"text-gray-500 text-xs"},$t={class:"py-2 col-span-full md:col-span-1"},Pt={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},St={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},Et={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},Lt={class:"py-2 flex justify-center items-center gap-2 col-span-full"},At={class:"ml-auto flex gap-4"},Rt={key:0},Nt={key:1},Ut={key:1,class:"text-center py-4 text-gray-500"},Bt={key:2,class:"text-center py-4 text-red-500"},zt={__name:"TaskShow",setup(m){const e=lt(),d=Q(),c=W(),p=at(),l=I(()=>p.getTaskListTree()),x=S({});X(async()=>{});const v=n=>{c.push({name:"TaskEdit",params:{id:n}})},T=I(()=>{var n,t;return e.task.parent_id==0?{name:"TaskList",params:{id:(n=e.task)==null?void 0:n.id}}:{name:"TaskShow",params:{id:(t=e.task)==null?void 0:t.parent_id}}});async function f(n){const t=await e.fetchTask(n);p.setTaskList(t.sub_tasks,e.task.id)}Y(()=>d.params.id,f,{initial:!0,immediate:!0});const u=I(()=>({...e.task,children_tasks:l.value}));return(n,t)=>{var E,L,A,R,N,U,B,D,q,O,j,M,F;const _=V("RouterLink"),z=V("router-view");return o(),i("div",xt,[s("div",bt,[a(e).task?(o(),i(G,{key:0},[s("section",vt,[s("div",Tt,[s("h2",null,b(a(e).task.title),1),s("div",_t,[s("span",{class:$([{"bg-gray-200":((E=a(e).task)==null?void 0:E.status)==="PENDING","bg-blue-200":((L=a(e).task)==null?void 0:L.status)==="IN_PROGRESS","bg-green-200":((A=a(e).task)==null?void 0:A.status)==="COMPLETED","bg-red-200":((R=a(e).task)==null?void 0:R.status)==="BLOCKED"},"px-3 py-0.5 rounded-full text-sm h-6"])},b((N=a(e).task)==null?void 0:N.status),3),k(it,{task:u.value,ref_key:"progress",ref:x,class:"!text-lg"},null,8,["task"])])]),s("div",wt,[t[8]||(t[8]=s("div",{class:"text-xs mb-0.5 text-gray-600 uppercase"},"Assigns",-1)),s("div",Ct,[(o(!0),i(G,null,Z(((U=a(e).task)==null?void 0:U.users)||[],(r,w)=>(o(),i("div",{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",key:w},[k(tt,{user:r,class:"w-6 h-6 !text-xs"},null,8,["user"]),s("span",ht,b(r.id)+" - "+b(r==null?void 0:r.name),1)]))),128)),((D=(B=a(e).task)==null?void 0:B.users)==null?void 0:D.length)===0?(o(),i("div",It," Not Assigned To Anyone ")):y("",!0)])]),s("div",$t,[s("div",Pt,[(q=a(e).task)!=null&&q.is_important?(o(),i("span",St,"IMPORTANT")):y("",!0),(O=a(e).task)!=null&&O.is_urgent?(o(),i("span",Et,"URGENT")):y("",!0)])]),t[13]||(t[13]=s("hr",{class:"my-3 col-span-full"},null,-1)),s("div",Lt,[s("button",{onClick:t[0]||(t[0]=h(r=>{var w;return v((w=a(e).task)==null?void 0:w.id)},["stop"])),class:"btn-2"},"Edit"),k(_,{to:{name:"TaskUserAssign",params:{id:(j=a(e).task)==null?void 0:j.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[1]||(t[1]=r=>r.stopPropagation())},{default:g(()=>t[9]||(t[9]=[s("i",{class:"fas fa-user-plus"},null,-1),C(" Assign Users ")])),_:1},8,["to"]),k(_,{to:T.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[2]||(t[2]=r=>r.stopPropagation())},{default:g(()=>t[10]||(t[10]=[s("i",{class:"fas fa-arrow-left"},null,-1),C(" Back ")])),_:1},8,["to"]),s("div",At,[l.value.length>0?(o(),P(_,{key:0,to:{name:"TaskShow",params:{id:(M=a(e).task)==null?void 0:M.id}},onClick:t[3]||(t[3]=r=>r.stopPropagation()),class:$(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":a(d).name=="TaskShow"}])},{default:g(()=>t[11]||(t[11]=[s("i",{class:"fal fa-list-ul"},null,-1),C(" Sub Tasks ")])),_:1},8,["to","class"])):y("",!0),k(_,{to:{name:"TaskReports",params:{id:(F=a(e).task)==null?void 0:F.id}},onClick:t[4]||(t[4]=r=>r.stopPropagation()),class:$(["py-1 btn-3",{"bg-blue-500 text-white":a(d).name=="TaskReports"}])},{default:g(()=>t[12]||(t[12]=[s("i",{class:"fal fa-file-alt"},null,-1),C(" Reports ")])),_:1},8,["to","class"])])])]),a(d).name=="TaskShow"?(o(),i("section",Rt,[k(yt,{subTasks:l.value,"parent-id":a(d).params.id,onCreated:t[5]||(t[5]=r=>f(a(d).params.id)),onUpdated:t[6]||(t[6]=r=>f(a(d).params.id)),onUpdatePriority:t[7]||(t[7]=r=>f(a(d).params.id))},null,8,["subTasks","parent-id"])])):(o(),i("section",Nt,[k(z)]))],64)):a(e).loading?(o(),i("div",Ut," Loading task details... ")):(o(),i("div",Bt,b(a(e).error),1))])])}}};export{zt as default};
