import{E,r as v,x as c,G as n}from"./index-YNh9CR68.js";const G=E("todo",()=>{const f=v(null),u=v(!1),s=v(null),l=v([]),w=async()=>{var o,e,t;u.value=!0,s.value=null;try{const a=await n.get("/todos");l.value=((o=a.data)==null?void 0:o.todos)||[],i()}catch(a){throw s.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"Todos load failed",a}finally{u.value=!1}};function i(){l.value=l.value.sort((o,e)=>{var t,a,r,d;return((t=o==null?void 0:o.user)==null?void 0:t.id)!==((a=e==null?void 0:e.user)==null?void 0:a.id)?((r=o==null?void 0:o.user)==null?void 0:r.id)-((d=e==null?void 0:e.user)==null?void 0:d.id):o.priority!==e.priority?o.priority-e.priority:e.id-o.id})}const m=async()=>{var o,e,t;u.value=!0,s.value=null;try{const a=await n.get("/my-todos");l.value=((o=a.data)==null?void 0:o.todos)||[],i()}catch(a){throw s.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"Todos load failed",a}finally{u.value=!1}},g=o=>{var e;return(e=l.value)==null?void 0:e.filter(t=>t.date==o)},$=async o=>{var e,t;u.value=!0,s.value=null;try{const a=await n.get(`/todos/${o}`);f.value=a.data,f.value=l.value.find(r=>r.id==o)}catch(a){throw s.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"Todo load failed",a}finally{u.value=!1}},S=async(o,{returnWith:e}={})=>{var t,a,r;u.value=!0,s.value=null;try{const d=await n.post("/todos",o,{params:{return_with:e}});return l.value=[...l.value,(t=d.data)==null?void 0:t.todo],i(),d.data}catch(d){throw s.value=((r=(a=d.response)==null?void 0:a.data)==null?void 0:r.message)||"Todo create failed",d}finally{u.value=!1}},x=async(o,e)=>{var t,a;u.value=!0,s.value=null;try{const r=await n.put(`/todos/${o}`,e);return l.value=l.value.map(d=>{var p,y,h,T;return d.id==((y=(p=r.data)==null?void 0:p.todo)==null?void 0:y.id)?d.user?{...(h=r.data)==null?void 0:h.todo,user:{...d.user}}:{...(T=r.data)==null?void 0:T.todo}:{...d}}),r.data}catch(r){throw s.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Todo update failed",r}finally{u.value=!1}},C=async(o,e)=>{var t,a;u.value=!0,s.value=null;try{await n.put(`/todos/status/${o}`,{status:e}),l.value=l.value.map(r=>r.id===o?{...r,status:e}:{...r})}catch(r){throw s.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update todo status",r}finally{u.value=!1}},D=async o=>{var e,t;u.value=!0,s.value=null;try{await n.delete(`/todos/${o}`),l.value=l.value.filter(a=>a.id!==o)}catch(a){throw s.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"Todo delete failed",a}finally{u.value=!1}};return{todos:c(()=>l.value),todo:c(()=>f.value),loading:c(()=>u.value),error:c(()=>s.value),fetchTodos:w,fetchTodo:$,createTodo:S,updateTodo:x,deleteTodo:D,fetchMyTodos:m,updateTodoStatus:C,getTodosByDate:g}});export{G as u};
