import{r as $,e as M,c as p,o as n,a as e,f as D,g as c,w as h,F as E,h as F,j as T,y as q,v as A,i as I,A as me,t as _,d as ge,p as pe,C as ce,x as H,n as V,q as ke,k as be,b as _e,u as we,z as O}from"./index-By1kRIa3.js";import{L as P}from"./LoaderView-DdcfrBjk.js";import{O as j}from"./OverlyModal-CSpprcc7.js";import{_ as W}from"./DescriptionView-RfbjaEhh.js";import{R as ve}from"./RequiredIcon-D7S97-RG.js";import{f as J}from"./requirement-C8owQOio.js";import{a as he,f as K,d as $e,u as qe,b as Ce,_ as Ie}from"./TaskAddForm-M5HXcXob.js";import{u as fe}from"./department-B2ZGpR4E.js";import{S as xe}from"./SelectDropdown-DNTWn9g7.js";import{_ as Y}from"./UserChip-CQrfkgnw.js";import{u as ye}from"./user-D2PdP3kZ.js";import{_ as Re}from"./TaskUserChip-CnChBoYm.js";import{u as De}from"./useTaskStore-wTcgCu1r.js";import{_ as ue}from"./TaskStatus-BylWPwcr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-C9RHNSc7.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-D_mBDXn2.js";import"./SectionLoading-DIIqp5kq.js";import"./TextWithHr-DKFhqEJ7.js";import"./TaskUrgencyInput-CpGGJkKq.js";const Se={class:"sticky top-0 pt-4 bg-white z-10"},Te={class:"mb-4"},Ee={class:"block text-gray-600 text-sm mb-1 font-medium"},Fe={class:"mb-4"},Ne={class:"mb-4"},Ae={class:"mb-4"},Ue={class:"mb-4"},Ve={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Le={key:0,class:"mb-4 text-red-500 font-medium"},Oe={key:1,class:"mb-4"},je={class:"flex items-center justify-between gap-4"},Me=["disabled"],Pe={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["create","closeClick","error"],setup(w,{emit:S}){const y=w,f=S,u=fe(),v=$(),o=$(""),m=$(),l=$({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),g=$([]);async function a(){var t,d;o.value="submitting";const r={...l.value};console.log({payload:r});try{const C=await he(y.requirementId,r);f("create",C),o.value="create"}catch(C){o.value="error",m.value=((d=(t=C.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to create requirement detail",f("error",m.value)}}return M(async()=>{var t;const r=((t=(await J(y.requirementId)).data)==null?void 0:t.requirement)||{};g.value=await u.fetchDepartmentEmployee([r.from_department_id])}),(r,t)=>(n(),p("div",{class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative",ref_key:"formContainerRef",ref:v},[e("div",Se,[t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement",-1)),t[8]||(t[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=h(d=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(a,["prevent"]),class:"z-0"},[o.value!=="loading"?(n(),p(E,{key:0},[e("div",Te,[e("label",Ee,[t[9]||(t[9]=T("Title ")),q(ve)]),F(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>l.value.title=d),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[A,l.value.title]])]),e("div",Fe,[t[10]||(t[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Details",-1)),F(e("textarea",{rows:"10","onUpdate:modelValue":t[2]||(t[2]=d=>l.value.description=d),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[A,l.value.description]])]),e("div",Ne,[t[12]||(t[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),q(xe,{modelValue:l.value.supervisor_id,"onUpdate:modelValue":t[3]||(t[3]=d=>l.value.supervisor_id=d),options:g.value,placeholder:"--NO SUPERVISOR--",containment:v.value,clearable:"",class:"h-10"},{"list-header":I(()=>t[11]||(t[11]=[e("div",{class:"px-3 pt-2 pb-1 shadow-md text-xs uppercase bg-gray-50 text-gray-500"}," Employees ",-1)])),option:I(({option:d})=>[q(Y,{user:d||{},class:"pr-5 -mx-1"},null,8,["user"])]),"selected-option":I(({option:d})=>[d?(n(),D(Y,{key:0,user:d||{},class:"pr-4"},null,8,["user"])):c("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",Ae,[t[14]||(t[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),F(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[4]||(t[4]=d=>l.value.priority=d)},t[13]||(t[13]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[me,l.value.priority]])]),e("div",Ue,[t[15]||(t[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),F(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=d=>l.value.better_to_complete_on=d),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[A,l.value.better_to_complete_on]])])],64)):c("",!0),e("div",Ve,[m.value?(n(),p("div",Le,_(m.value),1)):c("",!0),m.value?(n(),p("hr",Oe)):c("",!0),e("div",je,[e("button",{type:"button",onClick:t[6]||(t[6]=h(d=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},_(o.value=="submitting"?"Saving...":"Add Requirement"),9,Me)])])],32),o.value==="loading"||o.value==="submitting"?(n(),D(P,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512))}},ze={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Be={class:"mb-4"},Ge={class:"font-semibold"},He={class:"mb-4"},We={class:"line-clamp-2"},Ye={key:1,class:"min-h-40"},Je={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Ke={key:0,class:"mb-4 text-red-500 font-medium"},Qe={key:1,class:"mb-4"},Xe={class:"flex items-center justify-between gap-4"},Ze=["disabled"],et={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(w,{emit:S}){const y=w,f=S,u=ye(),v=$(null),o=$(""),m=$(),l=$([]);async function g(){var a,r;o.value="submitting";try{const t=await $e(y.requirementId,y.detailId);f("delete",t),o.value="create"}catch(t){o.value="error",m.value=((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to update requirement detail: "+t,f("error",m.value)}}return M(async()=>{var a,r,t;o.value="loading";try{l.value=await u.fetchDepartmentWiseEmployees(),v.value=(a=(await K(y.requirementId,y.detailId)).data)==null?void 0:a.detail}catch(d){m.value=((t=(r=d.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to fetch requirement detail"}finally{o.value=""}}),(a,r)=>{var t,d;return n(),p("div",ze,[r[4]||(r[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:h(g,["prevent"]),class:"z-0"},[o.value!=="loading"?(n(),p(E,{key:0},[e("div",Be,[r[1]||(r[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Ge,_((t=v.value)==null?void 0:t.title),1)]),e("div",He,[r[2]||(r[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",We,_((d=v.value)==null?void 0:d.description),1)]),r[3]||(r[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),p("div",Ye)),e("div",Je,[m.value?(n(),p("div",Ke,_(m.value),1)):c("",!0),m.value?(n(),p("hr",Qe)):c("",!0),e("div",Xe,[e("button",{type:"button",onClick:r[0]||(r[0]=h(C=>f("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},_(o.value=="submitting"?"Deleting...":"Delete"),9,Ze)])])],32),o.value==="loading"||o.value==="submitting"?(n(),D(P,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)])}}},tt={class:"sticky top-0 pt-4 bg-white z-10"},st={class:"mb-4"},rt={class:"block text-gray-600 text-sm mb-1 font-medium"},lt={class:"mb-4"},it={class:"mb-4"},nt={key:0,class:"relative w-full"},ot={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},at={class:"mb-4"},dt={class:"mb-4"},ut={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},mt={key:0,class:"mb-4 text-red-500 font-medium"},pt={key:1,class:"mb-4"},ct={class:"flex items-center justify-between gap-4"},bt=["disabled"],vt={__name:"RequirementDetailEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(w,{emit:S}){const y=w,f=S,u=$(),v=ye(),o=fe(),m=$(null),l=$(""),g=$(),a=$({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),r=$([]),t=$([]);async function d(){var s,R;l.value="submitting";const C={...a.value};try{const x=await qe(y.requirementId,y.detailId,C);f("update",x),l.value="create"}catch(x){l.value="error",g.value=((R=(s=x.response)==null?void 0:s.data)==null?void 0:R.message)||"Failed to update requirement detail",f("error",g.value)}}return M(async()=>{var C,s,R,x,b,i,z,L;l.value="loading";try{r.value=await v.fetchDepartmentWiseEmployees();const U=((C=(await J(y.requirementId)).data)==null?void 0:C.requirement)||{};t.value=await o.fetchDepartmentEmployee([U.from_department_id]),m.value=(s=(await K(y.requirementId,y.detailId)).data)==null?void 0:s.detail,a.value={title:(R=m.value)==null?void 0:R.title,description:(x=m.value)==null?void 0:x.description,priority:(b=m.value)==null?void 0:b.priority,supervisor_id:(i=m.value)==null?void 0:i.supervisor_id};const B=new Date(m.value.better_to_complete_on);a.value.better_to_complete_on=B.toISOString().split("T")[0]}catch(U){g.value=((L=(z=U.response)==null?void 0:z.data)==null?void 0:L.message)||"Failed to fetch requirement detail"}finally{l.value=""}}),(C,s)=>{var R;return n(),p("div",{ref_key:"formContainerRef",ref:u,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",tt,[s[8]||(s[8]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),s[9]||(s[9]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:s[0]||(s[0]=h(x=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(d,["prevent"]),class:"z-0"},[l.value!=="loading"?(n(),p(E,{key:0},[e("div",st,[e("label",rt,[s[10]||(s[10]=T("Title ")),q(ve)]),F(e("input",{"onUpdate:modelValue":s[1]||(s[1]=x=>a.value.title=x),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[A,a.value.title]])]),e("div",lt,[s[11]||(s[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),F(e("textarea",{rows:"10","onUpdate:modelValue":s[2]||(s[2]=x=>a.value.description=x),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[A,a.value.description]])]),e("div",it,[s[12]||(s[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),q(xe,{modelValue:a.value.supervisor_id,"onUpdate:modelValue":s[4]||(s[4]=x=>a.value.supervisor_id=x),options:[...t.value,...t.value.find(x=>{var b,i;return x.id==((i=(b=m.value)==null?void 0:b.supervisor)==null?void 0:i.id)})?[]:[(R=m.value)==null?void 0:R.supervisor]],containment:u.value,placeholder:"--NO SUPERVISOR--",class:"h-10"},{option:I(({option:x})=>[q(Y,{user:x||{}},null,8,["user"])]),"selected-option":I(({option:x})=>[x?(n(),p("div",nt,[q(Y,{user:x||{}},null,8,["user"]),a.value.supervisor_id?(n(),p("div",ot,[e("button",{onClick:s[3]||(s[3]=h(b=>a.value.supervisor_id=null,["prevent"])),class:"text-gray-6 font-semibold 00 hover:text-red-700"}," Ã— ")])):c("",!0)])):c("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",at,[s[14]||(s[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),F(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":s[5]||(s[5]=x=>a.value.priority=x)},s[13]||(s[13]=[e("option",{value:null},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[me,a.value.priority]])]),e("div",dt,[s[15]||(s[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),F(e("input",{type:"date","onUpdate:modelValue":s[6]||(s[6]=x=>a.value.better_to_complete_on=x),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[A,a.value.better_to_complete_on]])])],64)):c("",!0),e("div",ut,[g.value?(n(),p("div",mt,_(g.value),1)):c("",!0),g.value?(n(),p("hr",pt)):c("",!0),e("div",ct,[e("button",{type:"button",onClick:s[7]||(s[7]=h(x=>f("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"btn-2"},_(l.value=="submitting"?"Saving...":"Edit"),9,bt)])])],32),l.value==="loading"||l.value==="submitting"?(n(),D(P,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512)}}},ft=["rowspan"],xt={class:"text-2xl font-medium"},yt=["rowspan"],gt={class:"text-lg font-semibold mb-2 flex items-start gap-3"},kt={key:0},_t={key:0,class:"mb-5"},wt=["innerHTML"],ht={class:"flex items-end"},$t={key:0,class:"mt-4 flex justify-between items-end print:pb-0"},qt={class:""},Ct={class:"ml-auto flex gap-6 items-center"},It=["rowspan"],Rt={class:"text-center print:text-xs"},Dt={class:"border-2 border-gray-700 p-3 text-center"},St=["title"],Tt={class:"border-2 border-gray-700 p-3"},Et={class:"whitespace-nowrap text-center print:whitespace-break-spaces"},Ft={key:0,class:"print:text-xs"},Nt={key:1,class:"text-gray-500"},At={key:2,colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Ut={__name:"RequirementDetailTableRow",props:{detail:{type:Object},requirement:{type:Object},serial:{type:Number}},emits:["editClick","deleteClick","taskCreateClick"],setup(w,{emit:S}){const y=w,f=S,u=ge(),v=pe(()=>{var m,l,g;return((l=(m=y.detail)==null?void 0:m.tasks)==null?void 0:l.length)>0?(g=y.detail)==null?void 0:g.tasks:[{id:0}]});function o(){var m,l,g,a;if(((m=u.user)==null?void 0:m.department_id)!==((l=y.requirement)==null?void 0:l.to_department_id))return alert(`You can't create or assign task for this requirement. 
Only ${(a=(g=y.requirement)==null?void 0:g.to_department)==null?void 0:a.name}'s user can create or assign.`);f("taskCreateClick",y.detail)}return(m,l)=>{const g=ce("RouterLink");return n(!0),p(E,null,H(v.value,(a,r)=>{var t,d,C,s,R,x;return n(),p("tr",{key:a.id,class:"group/item border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},[r===0?(n(),p(E,{key:0},[e("td",{class:"border-2 border-gray-700 p-3 align-top",rowspan:((d=(t=w.detail)==null?void 0:t.tasks)==null?void 0:d.length)||1},[e("span",xt,_(w.serial),1)],8,ft),e("td",{class:"border-2 border-gray-700 p-3",rowspan:((s=(C=w.detail)==null?void 0:C.tasks)==null?void 0:s.length)||1},[e("div",null,[e("div",gt,[q(W,{"line-clamp":"3",class:"grow"},{default:I(()=>[T(_(w.detail.title),1)]),btnText:I(({lineClampClass:b})=>[T(_(b?"More":"Less"),1)]),_:1}),w.detail.priority?(n(),p("div",kt,[e("span",{class:V(["font-semibold text-sm",{"text-yellow-600 ":w.detail.priority=="IMPORTANT","text-red-700 ":w.detail.priority=="URGENT"}])},_(w.detail.priority),3)])):c("",!0)]),l[3]||(l[3]=e("hr",{class:"mb-4 -mx-4"},null,-1)),w.detail.description?(n(),p("div",_t,[l[2]||(l[2]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),q(W,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"}},{default:I(()=>[e("p",{innerHTML:w.detail.description,class:"text-justify"},null,8,wt)]),_:1})])):c("",!0)]),e("div",ht,[w.detail.supervisor?(n(),p("div",$t,[e("div",qt,[l[4]||(l[4]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Supervisor:",-1)),q(Re,{user:w.detail.supervisor},null,8,["user"])])])):c("",!0),e("div",Ct,[e("button",{class:"btn-2",onClick:l[0]||(l[0]=h(b=>f("editClick",w.detail),["prevent"]))},l[5]||(l[5]=[e("i",{class:"fas fa-edit"},null,-1),T("Edit ")])),e("button",{class:"btn-2-red",onClick:l[1]||(l[1]=h(b=>f("deleteClick",w.detail),["prevent"]))},l[6]||(l[6]=[e("i",{class:"fas fa-trash-alt"},null,-1),T("Delete ")]))])])],8,yt),e("td",{class:"border-2 border-gray-700 p-3 whitespace-nowrap print:whitespace-break-spaces print:px-0",rowspan:((x=(R=w.detail)==null?void 0:R.tasks)==null?void 0:x.length)||1},[e("div",Rt,_(new Date(w.detail.better_to_complete_on).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)],8,It)],64)):c("",!0),a.id?(n(),p(E,{key:1},[e("td",Dt,[q(g,{to:{name:"TaskShow",params:{id:a.id}},class:"hover:underline text-gray-900 hover:text-blue-600 whitespace-nowrap block",target:"_blank"},{default:I(()=>[T(_(a.id)+" ",1),e("i",{title:a.status,class:V(["ml-1",{"fad fa-exclamation-circle text-red-600":a.status=="PENDING","fad fa-exclamation-square text-yellow-600":a.status=="IN_PROGRESS","fad fa-check-circle text-green-600":a.status=="COMPLETED"}])},null,10,St)]),_:2},1032,["to"])]),e("td",Tt,[e("div",Et,[a.deadline?(n(),p("div",Ft,_(new Date(a.deadline).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)):(n(),p("div",Nt,"-"))])])],64)):(n(),p("td",At,[e("button",{onClick:h(o,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"}," Create / Assign Task ")]))])}),128)}}},Vt={class:"sticky top-0 pt-4 bg-white z-10"},Lt={class:"mb-4"},Ot={class:"mb-4"},jt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Mt={key:0,class:"mb-4 text-red-500 font-medium"},Pt={key:1,class:"mb-4"},zt={class:"flex items-center justify-between gap-4"},Bt=["disabled"],Gt={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(w,{emit:S}){const y=w,f=S,u=$(),v=$(null),o=$(""),m=$(),l=$({feedback:""});async function g(){var a,r;o.value="submitting";try{const t=await Ce(y.requirementId,y.detailId,l.value.feedback);f("update",t),o.value="create"}catch(t){o.value="error",m.value=((r=(a=t.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to update requirement detail",f("error",m.value)}}return M(async()=>{var a,r,t,d;o.value="loading";try{await J(y.requirementId),v.value=(a=(await K(y.requirementId,y.detailId)).data)==null?void 0:a.detail,l.value={feedback:(r=v.value)==null?void 0:r.feedback}}catch(C){m.value=((d=(t=C.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to fetch requirement detail"}finally{o.value=""}}),(a,r)=>{var t;return n(),p("div",{ref_key:"formContainerRef",ref:u,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Vt,[r[3]||(r[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),r[4]||(r[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=h(d=>f("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(g,["prevent"]),class:"z-0"},[o.value!=="loading"?(n(),p(E,{key:0},[e("div",Lt,[r[5]||(r[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),q(W,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:I(()=>{var d;return[T(_((d=v.value)==null?void 0:d.title),1)]}),_:1})]),e("div",Ot,[r[6]||(r[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),F(e("textarea",{rows:"5","onUpdate:modelValue":r[1]||(r[1]=d=>l.value.feedback=d),placeholder:"Enter requirement feedback",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[A,l.value.feedback]])])],64)):c("",!0),e("div",jt,[m.value?(n(),p("div",Mt,_(m.value),1)):c("",!0),m.value?(n(),p("hr",Pt)):c("",!0),e("div",zt,[e("button",{type:"button",onClick:r[2]||(r[2]=h(d=>f("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"btn-2"},_(o.value=="submitting"?"Saving...":(t=v.value)!=null&&t.feedback?"Update Feedback":"Add Feedback"),9,Bt)])])],32),o.value==="loading"||o.value==="submitting"?(n(),D(P,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):c("",!0)],512)}}},Ht={class:"text-left p-4"},Wt={class:"flex items-center gap-6 justify-center my-16"},Yt={key:0},Jt={class:"bg-blue-50 px-6 py-4 rounded text-blue-500"},Kt={class:"text-left text-base w-full font-semibold group flex items-center gap-2 mb-5 border-b border-blue-100 py-4"},Qt={class:"flex items-center w-full"},Xt={class:"grow"},Zt={class:"text-center text-red-500 text-sm font-semibold mb-4"},es={class:"flex items-center justify-between"},ts={key:1,class:"border rounded-md"},ss={class:"flex flex-col justify-start items-start min-h-28 max-h-[70vh] overflow-y-auto"},rs=["onClick"],ls={class:"flex items-center w-full"},is={class:"grow"},ns={class:"line-clamp-1"},os={key:0,class:"text-red-400 text-xs font-normal mt-1"},as={__name:"TaskParentIdSelector",props:{fromDepartmentId:{type:Number},requirementDetail:{type:Object}},emits:["parentIdSelect","cancelClick","assignTask"],setup(w,{emit:S}){const y=w,f=S,u=De(),v=$(""),o=$(null);ke(()=>v.value,(a,r)=>{r||u.fetchTasks({"from-department-id":y.fromDepartmentId})},{immediate:!0});function m(a){if(v.value=="sub-task")f("parentIdSelect",a.id);else{if(a.requirement_detail_id)return alert("This task already assigned to another requirement. Can't be assigned.");o.value=a}}async function l(){await u.setTaskRequirement(o.value.id,y.requirementDetail.id),f("assignTask")}const g=pe(()=>(u==null?void 0:u.tasks)||[]);return(a,r)=>{var t;return n(),p("div",Ht,[e("div",Wt,[e("button",{onClick:r[0]||(r[0]=h(d=>f("parentIdSelect",0,v.value),["prevent"])),class:"btn-3"}," Add as Main Task "),e("button",{class:V({"btn-3":v.value!=="sub-task","btn-2":v.value=="sub-task"}),onClick:r[1]||(r[1]=h(()=>{v.value="sub-task",o.value=null},["prevent"]))}," Add as Sub Task ",2),e("button",{class:V({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:r[2]||(r[2]=h(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value=="direct-assign"&&o.value?(n(),p("div",Yt,[e("div",Jt,[e("div",Kt,[e("i",{class:V(["fad text-xl group:hover-text-white",((t=o.value)==null?void 0:t.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",Qt,[e("div",Xt,_(o.value.title),1),q(ue,{status:o.value.status,class:"ml-auto"},null,8,["status"])])]),e("div",Zt,_(be(u).error),1),e("div",es,[e("button",{onClick:h(l,["prevent"]),class:"btn-2"},"Assign"),e("button",{onClick:r[3]||(r[3]=h(d=>f("cancelClick"),["prevent"])),class:"btn-3"},"Cancel")])])])):c("",!0),v.value&&!o.value?(n(),p("div",ts,[r[4]||(r[4]=e("div",{class:"py-2 px-4 font-bold text-center border-b shadow"},"Click to select task",-1)),e("div",ss,[(n(!0),p(E,null,H(g.value,d=>(n(),p("div",{key:d.id,class:"w-full mb-2"},[e("button",{type:"button",class:"text-left text-base w-full bg-blue-50 px-2 hover:bg-blue-500 hover:text-white py-2 text-blue-500 font-semibold group flex items-center gap-2",onClick:h(()=>m(d),["prevent"])},[e("i",{class:V(["fad text-xl group:hover-text-white",(d==null?void 0:d.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",ls,[e("div",is,[e("div",ns,_(d.title),1),d.requirement_detail_id&&v.value=="direct-assign"?(n(),p("div",os," Already assigned to a requirement ")):c("",!0)]),q(ue,{status:d.status,class:"ml-auto"},null,8,["status"])])],8,rs)]))),128))])])):c("",!0)])}}},ds={class:"container mx-auto p-6 print:p-0 w-full print:max-w-full"},us={class:"bg-white rounded shadow print:shadow-none p-4 print:p-0 relative"},ms={class:"flex items-start"},ps={class:"mb-4 text-lg print:black print:font-bold"},cs={class:"ml-auto print:hidden flex gap-2 items-center"},bs={class:"mb-4 flex items-center gap-1 print:mb-1"},vs={class:"font-bold print:text-gray-900"},fs={class:"mb-3 flex items-center gap-3 print:mb-1"},xs={class:"print:text-gray-900"},ys={key:0,class:"mb-3 flex items-center gap-3 print:mb-1"},gs={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},ks={class:"mb-3 flex items-center gap-3 print:mb-1"},_s={class:"print:text-gray-900"},ws={key:0,class:"overflow-x-auto print:overflow-visible"},hs={class:"w-full table-auto print:table-fixed"},$s={colspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap px-3 py-1 print:whitespace-normal w-[25%]"},qs={class:""},Cs={class:"whitespace-nowrap print:whitespace-break-spaces print:px-0 p-3 text-center border-2 border-gray-800"},Is={class:"text-gray-900 text-base"},Rs={class:"p-3 border-2 border-gray-800",colspan:"4"},Ds={key:0,class:"font-semibold text-sm mb-2"},Ss=["innerHTML"],Ts=["onClick"],Es={class:"mt-8 border rounded-md p-8 flex items-center justify-center bg-gray-50"},er={__name:"RequirementShow",setup(w){const S=_e(),y=we(),f=$(""),u=$(null),v=O({open:!1}),o=O({detail:null,open:!1}),m=O({detail:null,open:!1}),l=O({detail:null,open:!1});M(async()=>{await g()});async function g(){var b;f.value="loading",u.value=(b=(await J(S.params.id)).data)==null?void 0:b.requirement,f.value=""}function a(b){console.log({detail:b}),s.modalShown=!0,s.from_department_id=u.value.from_department_id,s.to_department_id=u.value.to_department_id,s.taskDefaultValues={title:b.title,description:b.description,from_department_id:u.value.from_department_id,to_department_id:u.value.to_department_id,is_important:(b==null?void 0:b.priority)=="IMPORTANT",is_urgent:(b==null?void 0:b.priority)=="URGENT",supervisor_ids:b!=null&&b.supervisor_id?[b==null?void 0:b.supervisor_id]:[]},s.requirementDetail=b}function r(){v.open=!0}function t(b){o.open=!0,o.detail=b}function d(b){l.open=!0,l.detail=b}function C(){window.print()}const s=O({parentId:null,modalShown:!1,requirementId:0,taskDefaultValues:{},requirementDetail:null});async function R(){s.parentId=0,s.parentId=null,s.modalShown=!1,s.requirementDetail=null,f.value="loading",await g()}async function x(){s.parentId=null,s.modalShown=!1,s.requirementDetail=null}return(b,i)=>{var L,U,B,Q,X,Z,ee,te,se,re,le,ie,ne,oe,ae;const z=ce("RouterLink");return n(),p("div",ds,[v.open?(n(),D(j,{key:0,class:"*:max-w-4xl"},{default:I(()=>[q(Pe,{requirementId:u.value.id,onCloseClick:i[0]||(i[0]=k=>v.open=!1),onCreate:i[1]||(i[1]=async()=>{v.open=!1,await g()})},null,8,["requirementId"])]),_:1})):c("",!0),o.open?(n(),D(j,{key:1},{default:I(()=>{var k;return[q(vt,{requirementId:u.value.id,detailId:(k=o.detail)==null?void 0:k.id,onCloseClick:i[2]||(i[2]=N=>o.open=!1),onUpdate:i[3]||(i[3]=async()=>{o.open=!1,await g()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),m.open?(n(),D(j,{key:2},{default:I(()=>{var k;return[q(Gt,{requirementId:u.value.id,detailId:(k=m.detail)==null?void 0:k.id,onCloseClick:i[4]||(i[4]=N=>m.open=!1),onUpdate:i[5]||(i[5]=async()=>{m.open=!1,await g()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),l.open?(n(),D(j,{key:3},{default:I(()=>{var k;return[q(et,{requirementId:u.value.id,detailId:(k=l.detail)==null?void 0:k.id,onCloseClick:i[6]||(i[6]=N=>l.open=!1),onDelete:i[7]||(i[7]=async()=>{l.open=!1,await g()})},null,8,["requirementId","detailId"])]}),_:1})):c("",!0),s.modalShown?(n(),D(j,{key:4,class:"*:relative"},{default:I(()=>{var k,N;return[e("button",{onClick:h(x,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},i[10]||(i[10]=[e("i",{class:"fas fa-times-circle"},null,-1)])),s.parentId===null?(n(),D(as,{key:0,"from-department-id":(k=u.value)==null?void 0:k.from_department_id,requirementDetail:s==null?void 0:s.requirementDetail,onParentIdSelect:i[8]||(i[8]=G=>s.parentId=G),onCancelClick:x,onAssignTask:R},null,8,["from-department-id","requirementDetail"])):(n(),D(Ie,{key:1,parentTaskId:s.parentId,requirementDetailId:(N=s==null?void 0:s.requirementDetail)==null?void 0:N.id,requirementId:u.value.id,onClose:x,onTaskCreated:R,defaultValues:s.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["parentTaskId","requirementDetailId","requirementId","defaultValues"]))]}),_:1})):c("",!0),e("div",us,[e("div",ms,[e("div",ps,[i[11]||(i[11]=e("div",{class:"text-gray-800 leading-none"},"To",-1)),e("div",null,_((U=(L=u.value)==null?void 0:L.to_department)==null?void 0:U.name),1)]),e("div",cs,[(((B=u.value)==null?void 0:B.details)||[]).length>0?(n(),p("button",{key:0,class:"btn-3 font-semibold !pl-2 !pr-4",onClick:h(C,["prevent"])},i[12]||(i[12]=[e("i",{class:"fad fa-print text-xl"},null,-1),T("Print ")]))):c("",!0),e("button",{class:"btn-3",onClick:i[9]||(i[9]=h(()=>be(y).back(),["prevent"]))},"Back"),q(z,{class:"btn-2",to:`/requirements/edit/${(Q=u.value)==null?void 0:Q.id}`},{default:I(()=>i[13]||(i[13]=[T("Edit")])),_:1,__:[13]},8,["to"])])]),i[25]||(i[25]=e("div",{class:"text-center text-xl font-bold mb-2 underline"},"Requirement Form",-1)),e("div",bs,[i[14]||(i[14]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",vs,_((X=u.value)==null?void 0:X.id),1)]),e("div",fs,[i[15]||(i[15]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),e("div",xs,_((ee=(Z=u.value)==null?void 0:Z.from_department)==null?void 0:ee.name),1)]),((se=(te=u.value)==null?void 0:te.website_tags)==null?void 0:se.length)>0?(n(),p("div",ys,[i[16]||(i[16]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",gs,[(n(!0),p(E,null,H(((re=u.value)==null?void 0:re.website_tags)||[],k=>(n(),p("div",{key:k.id,class:"border px-2 rounded-md bg-gray-50 shadow-sm whitespace-nowrap"},_(k.name),1))),128))])])):c("",!0),e("div",ks,[i[17]||(i[17]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",_s,_(new Date((le=u.value)==null?void 0:le.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)]),i[26]||(i[26]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[i[24]||(i[24]=e("div",{class:"flex items-end mb-3"},[e("h2",{class:"text-xl font-semibold"},"Requirements"),e("div",{class:"ml-auto print:hidden flex gap-2 text-sm"})],-1)),(((ie=u.value)==null?void 0:ie.details)||[]).length>0?(n(),p("div",ws,[e("table",hs,[e("thead",null,[e("tr",null,[i[18]||(i[18]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-left px-4 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[15%]"}," SL ",-1)),i[19]||(i[19]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap w-[65%]"}," Requirement Details ",-1)),i[20]||(i[20]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Better To Complete ",-1)),e("th",$s," For '"+_(((ne=u.value.to_department)==null?void 0:ne.short_name)||((oe=u.value.to_department)==null?void 0:oe.name))+"' Use ",1)]),i[21]||(i[21]=e("tr",null,[e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal"}," Issue No "),e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal print:p-0"}," Expected Date ")],-1))]),e("tbody",null,[(n(!0),p(E,null,H(((ae=u.value)==null?void 0:ae.details)||[],(k,N)=>{var G,de;return n(),p(E,{key:k.id},[q(Ut,{requirement:u.value,detail:k,serial:N+1,onEditClick:t,onDeleteClick:d,onTaskCreateClick:a},null,8,["requirement","detail","serial"]),e("tr",qs,[e("td",Cs,[e("div",Is," For '"+_(((G=u.value.to_department)==null?void 0:G.short_name)||((de=u.value.to_department)==null?void 0:de.name))+"' Use ",1),i[22]||(i[22]=e("div",{class:"text-gray-800 text-xs"},"(Feedback)",-1))]),e("td",Rs,[e("div",null,[k!=null&&k.feedback?(n(),p("div",Ds,"Feedback")):c("",!0),k!=null&&k.feedback?(n(),D(W,{key:1,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:I(()=>[e("p",{class:"text-sky-500 text-sm",innerHTML:k==null?void 0:k.feedback},null,8,Ss)]),_:2},1024)):c("",!0),e("div",null,[e("button",{class:"btn-3 print:hidden",onClick:h(()=>{m.open=!0,m.detail=k},["prevent"])},_(k.feedback?"Update Feedback":"Add feedback"),9,Ts)])])])])],64)}),128))])])])):c("",!0),e("div",Es,[e("button",{class:"btn-2 pl-2 text-base",onClick:h(r,["prevent"])},i[23]||(i[23]=[e("i",{class:"fad fa-plus-circle text-2xl mr-2"},null,-1),T("Add Requirement ")]))])]),f.value==="loading"?(n(),D(P,{key:1,class:"absolute inset-0 bg-opacity-90"})):c("",!0)])])}}};export{er as default};
