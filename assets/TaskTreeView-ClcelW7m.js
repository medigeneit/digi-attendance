import{c as o,o as r,F as q,x as j,m as z,r as I,y as R,A as U,k as F,f as h,a as t,l as _,p as L,n as g,t as c,q as m,z as J,w as $}from"./index-DkDuW8so.js";const G={class:"mt-3"},H={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(s,{emit:C}){const n=C;return(x,f)=>(r(),o("div",G,[(r(!0),o(q,null,j(s.childrenTasks,b=>(r(),z(xe,{key:b.id,task:b,class:"mb-3","hide-buttons":s.hideButtons,"tree-level":s.parentTreeLevel+1,onEditClick:f[0]||(f[0]=d=>n("editClick",d)),onAddClick:f[1]||(f[1]=d=>n("addClick",d))},null,8,["task","hide-buttons","tree-level"]))),128))]))}},K={class:"flex w-full"},Q={key:0,class:"border-l border-gray-200 last:border-l-0"},W={class:"items-start grid grid-cols-3"},X={class:""},Y={key:0,class:"text-sm text-gray-500 mt-2"},Z={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},ee={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},te={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},se={class:"flex items-start flex-wrap gap-3"},le={class:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-medium text-gray-600"},ne={class:"text-xs text-gray-700 mr-2"},ae={class:"flex justify-end items-center gap-2"},re={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200"},ie={class:"text-sm"},de={class:"mt-4"},oe={class:"flex items-center"},ue={key:0,class:"fas fa-caret-down text-gray-400 group-hover:text-sky-400"},ce={key:1,class:"fas fa-caret-right text-gray-400 group-hover:text-sky-400"},ke={key:0,class:"flex gap-2 ml-auto items-center text-xs"},fe=["href"],he=["href"],ge={class:"ml-0"},xe={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0}},emits:["commentButtonClick","editClick","addClick"],setup(s,{emit:C}){const n=s,x=C;function f(l){x("addClick",l)}function b(l){x("editClick",l)}const d=I([]),B=localStorage.getItem("sub_task_opened_list");if(B)try{d.value=JSON.parse(B)}catch{d.value=[]}const p=R({get:()=>d.value.includes(n.task.id),set:l=>{const e=d.value.includes(n.task.id);l&&!e?d.value.push(n.task.id):!l&&e&&(d.value=d.value.filter(a=>a!==n.task.id))}});U(d,l=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(l))},{deep:!0});const M=R(()=>{var l,e,a,i;return{"hover:underline hover:text-sky-400 cursor-pointer":((e=(l=n.task)==null?void 0:l.children_tasks)==null?void 0:e.length)>0,"cursor-default pointer-none":((i=(a=n.task)==null?void 0:a.children_tasks)==null?void 0:i.length)===0}}),P=l=>l.split(" ").map(e=>e[0]).join("").toUpperCase(),T=()=>{const l=v();let e,a,i;return l===100?(e="bg-green-50",a="bg-green-200",i="text-green-600 "):l<100&&(e="bg-red-50",a="bg-red-200",i="text-red-600 "),{container:e,bar:a,text:i}};function V(){n.task.children_tasks.length>0&&(p.value=!p.value)}function E(){if(n.task.children_tasks.length===0)return n.task.status==="COMPLETED"?1:0;const l=e=>{let a=0;for(let i=0;i<e.length;i++){const k=e[i];if(k.children_tasks.length===0)k.status==="COMPLETED"&&(a+=1);else{const y=k.children_tasks.length;l(k.children_tasks)===y&&(a+=1)}}return a};return l(n.task.children_tasks)}function v(){return n.task.children_tasks.length===0?n.task.status==="COMPLETED"?100:0:E()/n.task.children_tasks.length*100}return(l,e)=>{var i,k,y,w,S,N,A,O;const a=F("RouterLink");return r(),o("div",K,[s.treeLevel>0?(r(),o("div",Q,e[2]||(e[2]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):h("",!0),t("div",{class:m(["flex-grow border rounded py-3 group px-3",{"bg-green-50 ":v()===100,"bg-gray-50":v()<100,"shadow-sm":s.treeLevel>0}])},[t("div",W,[t("div",X,[_(a,{to:{name:"TaskShow",params:{id:s.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:L(()=>[g(c(s.task.title),1)]),_:1},8,["to"]),(i=s.task)!=null&&i.requirement?(r(),o("p",Y," Requirement: "+c((y=(k=s.task)==null?void 0:k.requirement)==null?void 0:y.title),1)):h("",!0),t("div",Z,[(w=s.task)!=null&&w.is_important?(r(),o("span",ee,"IMPORTANT")):h("",!0),(S=s.task)!=null&&S.is_urgent?(r(),o("span",te,"URGENT")):h("",!0)])]),t("div",se,[(r(!0),o(q,null,j(s.task.users,(u,D)=>(r(),o("div",{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",key:D},[t("div",le,c(P(u==null?void 0:u.name)),1),t("span",ne,c(u.id)+" - "+c(u==null?void 0:u.name),1)]))),128))]),t("div",ae,[t("span",re,c(s.task.status),1),t("div",ie,[t("div",{class:m(["rounded-full border py-0.5 text-xs relative overflow-hidden h-6",T().container]),style:{width:"180px"}},[t("div",{class:m(["z-10 absolute top-0 bottom-0",T().bar]),style:J(`width: ${v()}%`)},null,6),t("span",{class:m(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",T().text])},[t("span",null,[t("span",null,c(E()),1),e[3]||(e[3]=g(" / ")),t("span",null,c(s.task.children_tasks.length||1),1)])],2)],2)])])]),t("div",de,[t("div",oe,[t("div",{class:"flex gap-3 group items-center",onClick:V},[p.value?(r(),o("i",ue)):(r(),o("i",ce)),t("span",{class:m([M.value,"text-xs text-gray-500"])}," Sub Tasks ("+c((N=s.task.children_tasks)==null?void 0:N.length)+") ",3)]),s.hideButtons?h("",!0):(r(),o("div",ke,[t("a",{href:`/tasks/edit/${s.task.id}`,onClick:e[0]||(e[0]=$(u=>x("editClick",s.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},e[4]||(e[4]=[t("i",{class:"fas fa-edit"},null,-1),g(" Edit ")]),8,fe),_(a,{to:{name:"TaskReports",params:{id:(A=s.task)==null?void 0:A.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:L(()=>e[5]||(e[5]=[t("i",{class:"far fa-file-alt"},null,-1),g(" Reports ")])),_:1},8,["to"]),_(a,{to:{name:"TaskUserAssign",params:{id:(O=s.task)==null?void 0:O.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:L(()=>e[6]||(e[6]=[t("i",{class:"fas fa-user-plus"},null,-1),g(" Assign Users ")])),_:1},8,["to"]),t("a",{href:`/tasks/add?parent_id=${n.task.id}`,class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2",onClick:e[1]||(e[1]=$(u=>x("addClick",n.task.id),["stop","prevent"]))},e[7]||(e[7]=[t("i",{class:"fas fa-plus"},null,-1),g(" Add Sub Task ")]),8,he)]))]),t("div",ge,[p.value?(r(),z(H,{key:0,childrenTasks:s.task.children_tasks,"hide-buttons":s.hideButtons,"parent-tree-level":s.treeLevel,onEditClick:b,onAddClick:f},null,8,["childrenTasks","hide-buttons","parent-tree-level"])):h("",!0)])])],2)])}}};export{xe as _};
