import{D as Ae,f as De,u as Te,x as v,G as Fe,r as j,q as ze,h as Ge,c as a,o as r,a as e,d as U,b as y,t as n,l as Z,k as ee,m as $,F as h,e as w,H as me,v as Pe,j as p,s as I,z as ye,T as be}from"./index-d_b_t5IA.js";import{L as $e}from"./LoaderView-CJm3gQL4.js";import{_ as Ye}from"./EmployeeFilter-BJyybT1D.js";import{u as Ee}from"./kpi-report-C3r8Orp5.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-DD0TX3m0.js";import"./department-QIGHLi56.js";import"./EmployeeDropdownInput-DrE4JnqW.js";import"./SelectDropdown-DjoG42bo.js";import"./UserChip-B-CoqOQ9.js";const Ve={class:"space-y-4 px-4 print:px-0"},qe={class:"hidden print:block mx-auto text-center mb-3"},Ke={class:"text-sm text-gray-600"},Ue={class:"font-medium"},Ie={class:"font-medium"},Oe={class:"flex flex-wrap items-end gap-3 sticky top-0 z-10 bg-white/80 backdrop-blur print:hidden p-2 -mx-2 rounded-xl border border-gray-100"},Be={class:"w-full flex items-start gap-3"},Je={class:"flex items-center gap-2"},He=["disabled"],We=["value"],Qe={class:"flex flex-wrap items-center gap-2 w-full"},Xe=["value"],Ze=["disabled"],et={key:0,class:"py-10 text-center"},tt={key:1,class:"rounded-xl border border-red-200 bg-red-50 p-3 text-red-700",role:"alert"},st={class:"rounded-2xl border border-gray-200 bg-white shadow-sm p-4 print:hidden"},lt={class:"flex flex-wrap items-start justify-between gap-3"},nt={class:"text-xs font-semibold uppercase tracking-[0.18em] text-indigo-500"},ot={class:"mt-1 text-lg font-semibold text-slate-900"},at={class:"mt-1 flex flex-wrap gap-2 text-xs text-slate-600"},rt={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},it={class:"text-slate-900"},dt={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},ut={class:"text-slate-900"},pt={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},ct={class:"text-slate-900"},_t={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},mt={class:"text-slate-900"},yt={key:0,class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},bt={class:"text-slate-900"},xt={class:"text-xs text-slate-500"},gt={class:"space-y-3 md:hidden"},ft={class:"flex items-start justify-between gap-3"},vt={class:"min-w-0"},ht=["title"],wt={class:"mt-0.5 text-[11px] text-slate-500"},kt={key:0},Nt={key:1},St={key:2},jt={key:3},Ct={class:"shrink-0"},Rt={key:0,class:"mt-2 grid grid-cols-4 gap-2"},Lt=["title"],At={class:"mt-1 flex flex-col items-center gap-1"},Dt={class:"mt-3 flex items-center justify-between gap-3"},Tt=["onClick"],Ft={key:0,class:"px-3 py-8 text-center text-gray-600"},zt={class:"hidden md:block overflow-x-auto rounded-2xl border bg-white shadow-sm"},Gt={class:"w-full text-sm"},Pt={class:"sticky top-0 z-[5] bg-gray-100/95 backdrop-blur"},$t={class:"text-xs font-semibold text-slate-700"},Yt={class:"sticky left-0 z-[4] border-r bg-inherit px-3 py-2 text-center"},Et={class:"sticky z-[4] border-r bg-inherit px-3 py-2",style:{left:"3rem"}},Mt={class:"max-w-[17rem]"},Vt=["title"],qt={class:"text-[11px] text-slate-500 truncate"},Kt={key:0},Ut={key:1},It={key:2},Ot={key:3},Bt={class:"border-r px-3 py-2 text-center"},Jt={class:"flex flex-col items-center gap-1"},Ht={class:"border-r px-3 py-2 text-center"},Wt={class:"inline-flex items-center rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[12px] font-semibold text-slate-700"},Qt={class:"px-3 py-2"},Xt={class:"space-y-1 text-[11px] text-slate-600"},Zt={class:"mt-2 flex items-center justify-between gap-3"},es=["onClick"],ts={key:0},ss={class:"relative max-w-2xl w-full rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",role:"dialog","aria-modal":"true","aria-label":"Latest review details"},ls={class:"flex items-start justify-between gap-4"},ns={class:"text-lg font-semibold text-slate-900"},os={class:"text-xs text-slate-500"},as={key:0},rs={key:1},is={class:"text-xs text-slate-500"},ds={class:"mt-4 space-y-4 text-slate-700"},us={class:"rounded-xl border border-slate-200 bg-slate-50 p-4"},ps={class:"mt-3 space-y-2 text-xs text-slate-700"},cs={key:0},_s={class:"mt-1 text-slate-600"},ms={key:1},ys={class:"mt-1 text-slate-600"},bs={key:2},xs={class:"mt-1 text-slate-600"},gs={key:3,class:"text-slate-500"},fs={class:"relative max-w-3xl w-full rounded-2xl border border-slate-200 bg-white shadow-xl overflow-hidden",role:"dialog","aria-modal":"true","aria-label":"All reviewer comments"},vs={class:"p-5 border-b border-slate-200 bg-white"},hs={class:"flex items-start justify-between gap-4"},ws={class:"min-w-0"},ks={class:"text-lg font-semibold text-slate-900 truncate"},Ns={class:"mt-0.5 text-xs text-slate-500"},Ss={key:0},js={key:1},Cs={class:"mt-2 flex flex-wrap gap-2 text-[11px] text-slate-600"},Rs={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},Ls={class:"text-slate-900"},As={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},Ds={class:"text-slate-900"},Ts={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5"},Fs={class:"text-slate-900"},zs={class:"max-h-[75vh] overflow-y-auto p-5 space-y-4"},Gs={key:0,class:"rounded-xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600"},Ps={class:"px-4 py-3 bg-slate-50 border-b border-slate-200 flex flex-wrap items-center justify-between gap-2"},$s={class:"flex items-center gap-2 min-w-0"},Ys=["title"],Es={class:"text-[11px] text-slate-500 truncate"},Ms={class:"flex flex-wrap gap-2 text-[11px] text-slate-600"},Vs={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},qs={class:"text-slate-900"},Ks={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},Us={class:"text-slate-900"},Is={class:"rounded-full border border-slate-200 bg-white px-2 py-0.5"},Os={class:"text-slate-900"},Bs={class:"p-4 space-y-3"},Js={class:"flex flex-wrap items-start justify-between gap-2"},Hs={class:"min-w-0"},Ws={class:"text-sm font-semibold text-slate-900 truncate"},Qs={class:"mt-0.5 text-[11px] text-slate-500"},Xs={key:0},Zs={class:"flex flex-wrap gap-2"},el={class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] font-semibold text-slate-700"},tl={key:0,class:"rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-[11px] font-semibold text-slate-700"},sl={class:"mt-3 space-y-2 text-xs text-slate-700"},ll={key:0},nl={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},ol={key:1},al={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},rl={key:2},il={class:"mt-1 list-disc pl-5 text-slate-600 space-y-1"},dl={key:3,class:"text-slate-500"},ul={key:0,class:"text-sm text-slate-500"},pl={__name:"YearlyKpiReport",setup(cl){const O=Ee(),{reports:xe,isLoading:B,error:te}=Ae(O),L=De(),ge=Te(),A=v(()=>({company_id:L.query.company_id??"",department_id:L.query.department_id??"",employee_id:L.query.employee_id??"",line_type:L.query.line_type??"executive"})),c=Fe({company_id:A.value.company_id,department_id:A.value.department_id,employee_id:A.value.employee_id,line_type:A.value.line_type}),se=j(!1),le=new Date().getFullYear(),k=j(Number(L.query.year??le)),ne=j([]);function fe(s=2020,t=le+1){const i=[];for(let o=t;o>=s;o--)i.push(o);ne.value=i}const C=v(()=>xe.value||{}),J=v(()=>{var s;return((s=C.value)==null?void 0:s.cycle)||{}}),oe=v(()=>{var s;return((s=C.value)==null?void 0:s.filters)||{}}),N=v(()=>{var t;return[...Array.isArray((t=C.value)==null?void 0:t.lane_definitions)?C.value.lane_definitions:[]].sort((i,o)=>Number(i.rank||0)-Number(o.rank||0))}),Y=v(()=>{var s;return((s=C.value)==null?void 0:s.summary)||{}}),ve=v(()=>{var s;return Array.isArray((s=C.value)==null?void 0:s.data)?C.value.data:[]}),E=v(()=>{var t;if(N.value.length)return N.value.length;const s=Number(((t=J.value)==null?void 0:t.lane_count)??0);return Number.isFinite(s)&&s>0?s:0});function D(s){const t=Number(s);return Number.isFinite(t)?`${Math.round(t)}%`:"0%"}function T(s,t="-"){const i=(s??"").toString().trim();return i||t}function ae(s){if(!s)return null;const t=new Date(s);return Number.isNaN(t.getTime())?null:t.toLocaleDateString()}function he(){return new Date().toLocaleString()}function F(s){return!Array.isArray(s)||s.length===0?null:s.join("; ")}function H(s){return Array.isArray(s)?s.map(t=>typeof t=="string"?t.trim():"").filter(t=>t!==""):typeof s=="string"?s.split(/[\r\n;]+/).map(t=>t.trim()).filter(t=>t!==""):[]}function re(s){var o;const t=Number(((o=s==null?void 0:s.progress)==null?void 0:o.lanes_reviewed)??0),i=Number(E.value??0);return i?t>=i?"bg-emerald-50 text-emerald-700 border-emerald-200":t>0?"bg-amber-50 text-amber-700 border-amber-200":"bg-rose-50 text-rose-700 border-rose-200":"bg-slate-50 text-slate-600 border-slate-200"}function W(s){var o;const t=Number(((o=s==null?void 0:s.progress)==null?void 0:o.lanes_reviewed)??0),i=Number(E.value??0);return i?`${t}/${i}`:`${t}`}function we(s){if(!s)return"No reviews submitted yet";const t=s.reviewer_name||"Latest reviewer",i=s.reviewer_lane?` (${s.reviewer_lane})`:"",o=s.obtained_total??null,_=s.max_total??null,b=Number.isFinite(Number(o))&&Number.isFinite(Number(_))?`${Number(o)}/${Number(_)}`:o!==null?`${o}`:null,f=ae(s.submitted_at),x=[`${t}${i}`];return b&&x.push(b),f&&x.push(f),x.join(" • ")}function M(s,t){var f;const o=(Array.isArray(s==null?void 0:s.lanes)?s.lanes:[]).find(x=>(x==null?void 0:x.key)===t)||null;if(!o)return{text:"-",cls:"bg-slate-50 text-slate-500 border border-slate-200",percentText:"--"};const _=o.submitted_at||o.submittedAt||((f=o.review)==null?void 0:f.submitted_at),g=!!(o.completed??o.is_completed??o.review_submitted??_),b=o.average_marks??0;return g?{text:b,cls:"bg-emerald-50 text-emerald-700 border-emerald-200"}:{text:b,cls:"bg-amber-50 text-amber-700 border-amber-200"}}const ie=v(()=>ve.value.map(s=>{var _,g,b;const t=s.employee||{},i=s.latest_review||null,o=s.comments||{};return{...s,_name:T(t.name),_company:T(t.company,""),_dept:T(t.department,""),_joining:ae(t.joining_date),_type:T(t.type,""),latestReviewSummary:we(i),latestReviewStrengths:F(i==null?void 0:i.strengths)||null,latestReviewGaps:F(i==null?void 0:i.gaps)||null,latestReviewSuggestions:F(i==null?void 0:i.suggestions)||null,aggregatedStrengthsList:H(o==null?void 0:o.strengths),aggregatedGapsList:H(o==null?void 0:o.gaps),aggregatedSuggestionsList:H(o==null?void 0:o.suggestions),aggregatedStrengths:F(o==null?void 0:o.strengths),aggregatedGaps:F(o==null?void 0:o.gaps),aggregatedSuggestions:F(o==null?void 0:o.suggestions),finalPercent:((_=s==null?void 0:s.kpi_result)==null?void 0:_.final_percent)??((g=s==null?void 0:s.kpi_result)==null?void 0:g.final_percentage)??((b=s==null?void 0:s.kpi_result)==null?void 0:b.final)??null}})),Q=j(""),X=j("all"),ke=[{value:"all",label:"Any comment"},{value:"strengths",label:"Strengths"},{value:"gaps",label:"Gaps"},{value:"suggestions",label:"Suggestions"}],Ne=v(()=>Q.value.trim().toLowerCase()),Se=v(()=>{const s=Ne.value;return s?ie.value.filter(t=>{const i=X.value,o=[];return(i==="all"||i==="strengths")&&o.push(t.aggregatedStrengthsList||[]),(i==="all"||i==="gaps")&&o.push(t.aggregatedGapsList||[]),(i==="all"||i==="suggestions")&&o.push(t.aggregatedSuggestionsList||[]),o.some(_=>_.some(g=>g.toLowerCase().includes(s)))}):ie.value}),V=v(()=>Se.value),u=j(null),q=j(!1);function de(s){u.value=s,q.value=!0}function R(){q.value=!1,u.value=null}const K=j(!1);function je(){return{year:Number(k.value),company_id:c.company_id||void 0,department_id:c.department_id||void 0,employee_id:c.employee_id||void 0,line_type:c.line_type||void 0,flag:"excel"}}async function Ce(){K.value=!0;try{await O.exportYearly(je())}catch(s){console.error("exportYearly failed:",s)}finally{K.value=!1}}function ue(s={}){const t={...L.query,...s};Object.keys(t).forEach(i=>{const o=t[i];(o==null||o==="")&&delete t[i]}),ge.replace({query:t})}async function pe(){try{c.company_id&&await O.fetchYearlyExecutive({year:Number(k.value),company_id:c.company_id||void 0,department_id:c.department_id||void 0,employee_id:c.employee_id||void 0,line_type:c.line_type||void 0})}catch(s){console.error("fetchYearlyExecutive failed:",s)}}function Re(s={}){c.company_id=s.company_id??"",c.department_id=s.department_id??"",c.employee_id=s.employee_id??"",c.line_type=s.line_type??A.value.line_type??"executive",se.value=!0,ue({company_id:c.company_id||void 0,department_id:c.department_id||void 0,employee_id:c.employee_id||void 0,line_type:c.line_type||void 0,year:Number(k.value)}),pe()}ze(k,()=>{const s=Number(k.value);!Number.isInteger(s)||s<2e3||s>2100||se.value&&(ue({year:s}),pe())}),Ge(()=>{fe()});function ce(s){if(!s)return null;const t=new Date(s);return Number.isNaN(t.getTime())?null:t.toLocaleString()}const _e=v(()=>{const s=u.value,t=Array.isArray(s==null?void 0:s.lanes)?s.lanes:[],i=new Map(N.value.map(_=>[_.key,Number(_.rank??0)]));return[...t].sort((_,g)=>{const b=i.get(_.key)??9999,f=i.get(g.key)??9999;return b-f}).map(_=>{var f;const b=[...Array.isArray(_.reviewers)?_.reviewers:[]].sort((x,z)=>{const l=new Date(x.submitted_at||x.updated_at||0).getTime();return new Date(z.submitted_at||z.updated_at||0).getTime()-l});return{..._,label:((f=N.value.find(x=>x.key===_.key))==null?void 0:f.label)||_.key,reviewers:b}})});return(s,t)=>{var i,o,_,g,b,f,x,z;return r(),a("div",Ve,[e("div",qe,[t[10]||(t[10]=e("h1",{class:"text-xl font-semibold text-gray-900"},"Yearly KPI Report",-1)),e("div",Ke,[t[7]||(t[7]=y(" Cycle: ")),e("span",Ue,n(((i=J.value)==null?void 0:i.slug)||"-"),1),t[8]||(t[8]=y(" • Year: ")),e("span",Ie,n(k.value),1),t[9]||(t[9]=y(" • Generated: ")),e("span",null,n(he()),1)])]),e("div",Oe,[e("div",Be,[U(Ye,{company_id:c.company_id,"onUpdate:company_id":t[1]||(t[1]=l=>c.company_id=l),department_id:c.department_id,"onUpdate:department_id":t[2]||(t[2]=l=>c.department_id=l),employee_id:c.employee_id,"onUpdate:employee_id":t[3]||(t[3]=l=>c.employee_id=l),line_type:c.line_type,"onUpdate:line_type":t[4]||(t[4]=l=>c.line_type=l),"initial-value":A.value,class:"w-full",onFilterChange:Re},{default:Z(()=>[e("div",Je,[ee(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>k.value=l),class:"w-32 rounded-lg border border-gray-300 bg-white px-2 py-1.5 text-sm focus:outline-none focus:ring-2 focus:ring-sky-400/50 disabled:opacity-60",disabled:$(B),"aria-label":"Select year"},[(r(!0),a(h,null,w(ne.value,l=>(r(),a("option",{key:l,value:l},n(l),9,We))),128))],8,He),[[me,k.value,void 0,{number:!0}]])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])]),e("div",Qe,[ee(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>Q.value=l),type:"search",placeholder:"Search gaps/strengths/suggestions",class:"flex-1 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"},null,512),[[Pe,Q.value]]),ee(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>X.value=l),class:"rounded-lg border border-gray-300 bg-white px-2 py-1 text-sm focus:border-sky-400 focus:ring-2 focus:ring-sky-400/50"},[(r(),a(h,null,w(ke,l=>e("option",{key:l.value,value:l.value},n(l.label),9,Xe)),64))],512),[[me,X.value]]),e("button",{class:"btn-1",onClick:Ce,disabled:K.value||$(B)},[t[11]||(t[11]=e("i",{class:"far fa-file-excel mr-1"},null,-1)),y(" "+n(K.value?"Preparing...":"Download Excel"),1)],8,Ze)])]),$(B)?(r(),a("div",et,[U($e)])):$(te)?(r(),a("div",tt,n($(te)),1)):(r(),a(h,{key:2},[e("div",st,[e("div",lt,[e("div",null,[e("div",nt," KPI Cycle • "+n(T((o=J.value)==null?void 0:o.slug)),1),e("h2",ot," Year "+n(k.value)+" • "+n(T(c.line_type)),1),e("div",at,[e("span",rt,[t[12]||(t[12]=y(" Employees: ")),e("b",it,n(((_=Y.value)==null?void 0:_.total_employees)??0),1)]),e("span",dt,[t[13]||(t[13]=y(" With results: ")),e("b",ut,n(((g=Y.value)==null?void 0:g.with_results)??0),1)]),e("span",pt,[t[14]||(t[14]=y(" Avg final: ")),e("b",ct,n(D(((b=Y.value)==null?void 0:b.avg_final_percent)??0)),1)]),e("span",_t,[t[15]||(t[15]=y(" Completion: ")),e("b",mt,n(D(((f=Y.value)==null?void 0:f.review_completion_percent)??0)),1)]),E.value?(r(),a("span",yt,[t[16]||(t[16]=y(" Lanes: ")),e("b",bt,n(E.value),1)])):p("",!0)])]),e("div",xt,[t[17]||(t[17]=e("div",null,[e("b",{class:"text-slate-700"},"API Filters")],-1)),e("div",null,"line_type: "+n(((x=oe.value)==null?void 0:x.line_type)??"-"),1),e("div",null,"submitted_only: "+n((z=oe.value)!=null&&z.submitted_only?"true":"false"),1)])])]),e("div",gt,[(r(!0),a(h,null,w(V.value,(l,m)=>{var S;return r(),a("div",{key:"m-"+(((S=l.employee)==null?void 0:S.id)??m),class:"rounded-2xl border border-gray-200 bg-white shadow-sm p-3"},[e("div",ft,[e("div",vt,[e("div",{class:"text-sm font-semibold text-slate-900 truncate",title:l._name},n(m+1)+". "+n(l._name),9,ht),e("div",wt,[l._dept?(r(),a("span",kt,n(l._dept),1)):p("",!0),l._dept&&l._company?(r(),a("span",Nt," • ")):p("",!0),l._company?(r(),a("span",St,n(l._company),1)):p("",!0),l._joining?(r(),a("span",jt," • Joined "+n(l._joining),1)):p("",!0)])]),e("div",Ct,[e("span",{class:I(["inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] font-semibold",re(l)])},n(W(l)),3)])]),N.value.length?(r(),a("div",Rt,[(r(!0),a(h,null,w(N.value,d=>(r(),a("div",{key:"m-lane-"+d.key,class:"rounded-xl border p-2 text-center"},[e("div",{class:"text-[10px] font-medium text-slate-600 truncate",title:d.label},n(d.label),9,Lt),e("div",At,[e("span",{class:I(["inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-[11px] font-semibold",M(l,d.key).cls])},n(M(l,d.key).text),3)])]))),128))])):p("",!0),e("div",Dt,[e("button",{type:"button",class:"text-xs font-semibold text-sky-600 hover:text-sky-800",onClick:d=>de(l)}," Open review modal ",8,Tt)])])}),128)),V.value.length===0?(r(),a("div",Ft,"No data")):p("",!0)]),e("div",zt,[e("table",Gt,[e("thead",Pt,[e("tr",null,[t[18]||(t[18]=e("th",{class:"sticky left-0 z-[6] border-b border-r bg-gray-100/95 px-3 py-2 text-center",style:{"min-width":"3rem",width:"3rem"}}," SL ",-1)),t[19]||(t[19]=e("th",{class:"sticky z-[6] border-b border-r bg-gray-100/95 px-3 py-2 text-left",style:{left:"3rem",minWidth:"18rem",width:"18rem"}}," Employee ",-1)),t[20]||(t[20]=e("th",{class:"border-b border-r px-3 py-2 text-center",style:{"min-width":"7rem"}}," Progress ",-1)),(r(!0),a(h,null,w(N.value,l=>(r(),a("th",{key:"lane-head-"+l.key,class:"border-b border-r px-2 py-2 text-center",style:{"min-width":"6.5rem"}},[e("span",$t,n(l.label),1)]))),128)),t[21]||(t[21]=e("th",{class:"border-b border-r px-3 py-2 text-center",style:{"min-width":"8rem"}}," Final ",-1)),t[22]||(t[22]=e("th",{class:"border-b px-3 py-2 text-left"}," All comments ",-1))])]),e("tbody",null,[(r(!0),a(h,null,w(V.value,(l,m)=>{var S;return r(),a("tr",{key:"d-"+(((S=l.employee)==null?void 0:S.id)??m),class:"border-t hover:bg-slate-50/80 transition-colors"},[e("td",Yt,n(m+1),1),e("td",Et,[e("div",Mt,[e("div",{class:"font-semibold text-slate-900 truncate",title:l._name},n(l._name),9,Vt),e("div",qt,[l._dept?(r(),a("span",Kt,n(l._dept),1)):p("",!0),l._dept&&l._company?(r(),a("span",Ut," • ")):p("",!0),l._company?(r(),a("span",It,n(l._company),1)):p("",!0),l._joining?(r(),a("span",Ot," • Joined "+n(l._joining),1)):p("",!0)])])]),e("td",Bt,[e("span",{class:I(["inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-[12px] font-semibold",re(l)])},n(W(l)),3)]),(r(!0),a(h,null,w(N.value,d=>(r(),a("td",{key:"lane-"+d.key+"-"+m,class:"border-r px-2 py-2 text-center"},[e("div",Jt,[e("span",{class:I(["inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-[11px] font-semibold",M(l,d.key).cls])},n(M(l,d.key).text),3)])]))),128)),e("td",Ht,[e("span",Wt,n(l.finalPercent==null?"—":D(l.finalPercent)),1)]),e("td",Qt,[e("div",Xt,[e("div",Zt,[e("button",{type:"button",class:"text-[11px] font-semibold text-sky-600 hover:text-sky-800",onClick:d=>de(l)}," Open review modal ",8,es)])])])])}),128)),V.value.length===0?(r(),a("tr",ts,t[23]||(t[23]=[e("td",{colspan:"100",class:"px-3 py-8 text-center text-gray-600"},"No data",-1)]))):p("",!0)])])]),U(be,{name:"fade-scale"},{default:Z(()=>[q.value&&u.value?(r(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:ye(R,["escape","window"])},[e("div",{class:"absolute inset-0 bg-slate-900/60 backdrop-blur-sm","aria-hidden":"true",onClick:R}),e("div",ss,[e("div",ls,[e("div",null,[e("p",ns,n(u.value._name),1),e("p",os,[y(n(u.value._dept||"Department unknown")+" ",1),u.value._company?(r(),a("span",as," • "+n(u.value._company),1)):p("",!0),u.value._joining?(r(),a("span",rs," • Joined "+n(u.value._joining),1)):p("",!0)]),e("p",is,"Line type: "+n(u.value._type),1)]),e("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")]),e("div",ds,[e("article",us,[e("div",ps,[u.value.latestReviewStrengths?(r(),a("div",cs,[t[24]||(t[24]=e("span",{class:"font-semibold text-slate-800"},"Strengths:",-1)),e("div",_s,n(u.value.latestReviewStrengths),1)])):p("",!0),u.value.latestReviewGaps?(r(),a("div",ms,[t[25]||(t[25]=e("span",{class:"font-semibold text-slate-800"},"Gaps:",-1)),e("div",ys,n(u.value.latestReviewGaps),1)])):p("",!0),u.value.latestReviewSuggestions?(r(),a("div",bs,[t[26]||(t[26]=e("span",{class:"font-semibold text-slate-800"},"Suggestions:",-1)),e("div",xs,n(u.value.latestReviewSuggestions),1)])):p("",!0),!u.value.latestReviewStrengths&&!u.value.latestReviewGaps&&!u.value.latestReviewSuggestions?(r(),a("div",gs," No latest review comments ")):p("",!0)])])])])],32)):p("",!0)]),_:1})],64)),U(be,{name:"fade-scale"},{default:Z(()=>{var l;return[q.value&&u.value?(r(),a("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6",onKeydown:ye(R,["escape","window"])},[e("div",{class:"absolute inset-0","aria-hidden":"true",onClick:R}),e("div",fs,[e("div",vs,[e("div",hs,[e("div",ws,[e("p",ks,n(u.value._name),1),e("p",Ns,[y(n(u.value._dept||"Department unknown")+" ",1),u.value._company?(r(),a("span",Ss," • "+n(u.value._company),1)):p("",!0),u.value._joining?(r(),a("span",js," • Joined "+n(u.value._joining),1)):p("",!0)]),e("div",Cs,[e("span",Rs,[t[27]||(t[27]=y(" Progress: ")),e("b",Ls,n(W(u.value)),1)]),e("span",As,[t[28]||(t[28]=y(" Final: ")),e("b",Ds,n(u.value.finalPercent==null?"—":D(u.value.finalPercent)),1)]),e("span",Ts,[t[29]||(t[29]=y(" Reviews: ")),e("b",Fs,n(((l=u.value.progress)==null?void 0:l.review_count)??0),1)])])]),e("button",{type:"button",class:"shrink-0 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")])]),e("div",zs,[_e.value.length?p("",!0):(r(),a("div",Gs," No reviews found for this employee. ")),(r(!0),a(h,null,w(_e.value,m=>{var S;return r(),a("div",{key:"lane-group-"+m.key,class:"rounded-2xl border border-slate-200 bg-white overflow-hidden"},[e("div",Ps,[e("div",$s,[e("span",{class:"text-sm font-semibold text-slate-900 truncate",title:m.label},n(m.label),9,Ys),e("span",Es," (key: "+n(m.key)+") ",1)]),e("div",Ms,[e("span",Vs,[t[30]||(t[30]=y(" Count: ")),e("b",qs,n(m.count??((S=m.reviewers)==null?void 0:S.length)??0),1)]),e("span",Ks,[t[31]||(t[31]=y(" Avg: ")),e("b",Us,n(m.average_marks==null?"—":D(m.average_marks)),1)]),e("span",Is,[t[32]||(t[32]=y(" Latest: ")),e("b",Os,n(ce(m.latest_review_at)||"—"),1)])])]),e("div",Bs,[(r(!0),a(h,null,w(m.reviewers||[],(d,Le)=>(r(),a("div",{key:"rv-"+m.key+"-"+Le+"-"+(d.id??"x"),class:"rounded-xl border border-slate-200 bg-white p-3"},[e("div",Js,[e("div",Hs,[e("div",Ws,n(d.name||"Reviewer"),1),e("div",Qs,[y(" Lane: "+n(d.lane||m.key)+" ",1),d.submitted_at||d.updated_at?(r(),a("span",Xs," • "+n(ce(d.submitted_at||d.updated_at)),1)):p("",!0)])]),e("div",Zs,[e("span",el,n(d.percent==null?"—":D(d.percent)),1),d.obtained_total!=null&&d.max_total!=null?(r(),a("span",tl,n(d.obtained_total),1)):p("",!0)])]),e("div",sl,[d.strengths&&d.strengths.length?(r(),a("div",ll,[t[33]||(t[33]=e("div",{class:"font-semibold text-slate-900"},"Strengths",-1)),e("ul",nl,[(r(!0),a(h,null,w(d.strengths,(G,P)=>(r(),a("li",{key:"s-"+P},n(G),1))),128))])])):p("",!0),d.gaps&&d.gaps.length?(r(),a("div",ol,[t[34]||(t[34]=e("div",{class:"font-semibold text-slate-900"},"Gaps",-1)),e("ul",al,[(r(!0),a(h,null,w(d.gaps,(G,P)=>(r(),a("li",{key:"g-"+P},n(G),1))),128))])])):p("",!0),d.suggestions&&d.suggestions.length?(r(),a("div",rl,[t[35]||(t[35]=e("div",{class:"font-semibold text-slate-900"},"Suggestions",-1)),e("ul",il,[(r(!0),a(h,null,w(d.suggestions,(G,P)=>(r(),a("li",{key:"u-"+P},n(G),1))),128))])])):p("",!0),(!d.strengths||!d.strengths.length)&&(!d.gaps||!d.gaps.length)&&(!d.suggestions||!d.suggestions.length)?(r(),a("div",dl," No comments in this review. ")):p("",!0)])]))),128)),!m.reviewers||m.reviewers.length===0?(r(),a("div",ul," No reviewers found in this lane. ")):p("",!0)])])}),128))]),e("div",{class:"p-4 border-t border-slate-200 bg-white flex items-center justify-end gap-2"},[e("button",{type:"button",class:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-600 hover:bg-slate-50",onClick:R}," Close ")])])],32)):p("",!0)]}),_:1})])}}},kl=Me(pl,[["__scopeId","data-v-4cbfd98d"]]);export{kl as default};
