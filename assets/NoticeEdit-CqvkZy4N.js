import{a0 as z,u as G,b as I,r as b,s as M,D as K,m as h,z as r,e as H,n as J,c as m,o as u,a as s,f as O,w as Q,p as c,h as i,j as v,K as V,k,g as N,B as W,v as S,i as X}from"./index-W_PqaTeh.js";import{L as Y}from"./LoaderView-P05kDm88.js";import{_ as D}from"./MultiselectDropdown-C1hM4XQv.js";import{_ as Z}from"./TextEditor-DtZ_loj2.js";import{u as ee}from"./company-DcDQxJ-7.js";import{u as te}from"./department-Ca8ax3mn.js";import{u as le}from"./notice-qivq025F.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"my-container space-y-2"},ae={class:"card-bg md:p-8 p-4 mx-4"},oe={class:"grid gap-4"},ne={class:"space-y-6"},ie={class:"border p-4 rounded-md bg-white space-y-6"},de={class:"space-y-3"},pe={class:"flex justify-between md:flex-row flex-col items-center gap-4"},re={class:"w-full"},ue={key:0,class:"w-full"},me={key:1,class:"w-full"},ce={class:"col-span-3 flex justify-between gap-8"},ye={class:"w-full space-y-3"},fe={class:"w-full space-y-3"},be={class:"border p-4 rounded-md bg-white space-y-6"},ve={key:0,class:"mb-2"},_e=["href"],ge={class:"col-span-full"},we={class:"flex justify-center gap-4"},Ee={__name:"NoticeEdit",setup(xe){const _=z(),C=G(),g=I(),w=b(!1),x=le(),y=ee(),n=te(),{companies:T}=M(y),{employees:A}=M(n),t=K({title:"",type:"",description:"",published_at:"",expired_at:"",company_id:"all",department_id:"",file:"",all_companies:!1,all_departments:!1,all_employees:!1}),d=b([]),p=b([]),f=b([]),U=h(()=>d.value.map(a=>a.id)),E=h(()=>p.value.map(a=>a.id)),F=h(()=>f.value.map(a=>a.id)),B=()=>{d.value=t.all_companies?[...y.companies]:[]},R=()=>{p.value=t.all_departments?[...n.departments]:[]},j=()=>{t.all_employees&&(F.value=[])};r(d,a=>{t.all_companies=a.length===y.companies.length}),r(p,a=>{t.all_departments=a.length===n.departments.length}),r(()=>t.all_companies,async a=>{a&&await n.fetchDepartments()}),r(()=>t.all_departments,async a=>{a&&await n.fetchDepartmentEmployee("all")}),r(U,async a=>{a.length&&await n.fetchDepartments(a)}),r(E,async a=>{a.length&&await n.fetchDepartmentEmployee(a)});const P=async a=>{const e=a.target.files[0];if(e){const o=new FormData;o.append("file",e);const l=await x.fetchFileUpload(o);t.file=l==null?void 0:l.url}},L=a=>{if(!a)return;const e=a.split(" ")[0];return e.includes("-")?e:"Invalid Date Format"},$=async()=>{var a,e;try{const o=g.params.id,l=await x.fetchNotice(o);t.title=l.title,t.type=l.type,t.file=l.file,t.published_at=L(l.published_at),t.expired_at=L(l.expired_at),t.description=l.description,t.company_id=l.company_id??"all",t.department_id=l.department_id,d.value=l.companies_notice,p.value=l.departments,f.value=l.employees,t.all_companies=l.companies_notice.length===0,t.all_departments=l.departments.length===0,t.all_employees=l.employees.length===0}catch(o){const l=((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to load notice data";_.error(l),C.push({name:"NoticeList"})}},q=async()=>{var a,e;try{const o={...t,company_ids:U.value,department_ids:E.value,employee_ids:F.value};await x.updateNotice(g.params.id,o),_.success("Notice updated successfully"),C.push({name:"NoticeShow",params:{id:g.params.id}})}catch(o){const l=((e=(a=o.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to update notice";_.error(l)}};return H(async()=>{w.value=!0,await y.fetchCompanies(),await $(),w.value=!1}),(a,e)=>{const o=J("RouterLink");return u(),m("div",se,[s("div",ae,[e[25]||(e[25]=s("h2",{class:"title-lg text-center"},"Edit Notice",-1)),w.value?(u(),O(Y,{key:0,class:"bg-gray-100 border shadow-none"})):(u(),m("form",{key:1,onSubmit:Q(q,["prevent"]),class:"space-y-4"},[s("div",oe,[s("div",ne,[s("div",ie,[e[18]||(e[18]=s("h2",{class:"text-lg"},"Notice Information",-1)),s("div",de,[s("label",null,[i(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=l=>t.all_companies=l),onChange:B},null,544),[[V,t.all_companies]]),e[11]||(e[11]=v(" Select All Companies "))]),c(D,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=l=>d.value=l),options:k(T),multiple:!0,searchable:!0,placeholder:"Select companies","track-by":"id",label:"name",disabled:t.all_companies},null,8,["modelValue","options","disabled"])]),s("div",pe,[s("div",re,[e[13]||(e[13]=s("label",null,"Type*",-1)),i(s("select",{id:"type","onUpdate:modelValue":e[2]||(e[2]=l=>t.type=l),class:"w-full border rounded px-3 py-2",required:""},e[12]||(e[12]=[s("option",{value:"1"},"General",-1),s("option",{value:"2"},"Policy",-1)]),512),[[W,t.type]])]),t.type!=="2"?(u(),m("div",ue,[e[14]||(e[14]=s("label",null,"Publish Date",-1)),i(s("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>t.published_at=l),type:"date",class:"w-full p-2 border rounded"},null,512),[[S,t.published_at]])])):N("",!0),t.type!=="2"?(u(),m("div",me,[e[15]||(e[15]=s("label",null,"Expire Date",-1)),i(s("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.expired_at=l),type:"date",class:"w-full p-2 border rounded"},null,512),[[S,t.expired_at]])])):N("",!0)]),s("div",ce,[s("div",ye,[s("label",null,[i(s("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>t.all_departments=l),onChange:R},null,544),[[V,t.all_departments]]),e[16]||(e[16]=v(" Select All Departments "))]),c(D,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=l=>p.value=l),options:k(n).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",disabled:t.all_departments},null,8,["modelValue","options","disabled"])]),s("div",fe,[s("label",null,[i(s("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>t.all_employees=l),onChange:j},null,544),[[V,t.all_employees]]),e[17]||(e[17]=v(" Select All Employees "))]),c(D,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l),options:k(A),multiple:!0,searchable:!0,placeholder:"Select Employee","track-by":"id",label:"name",disabled:t.all_employees},null,8,["modelValue","options","disabled"])])])]),s("div",be,[e[22]||(e[22]=s("h2",{class:"text-lg"},"Notice Content",-1)),s("div",null,[e[19]||(e[19]=s("label",null,"Title*",-1)),i(s("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>t.title=l),type:"text",class:"w-full p-2 border rounded"},null,512),[[S,t.title]])]),s("div",null,[e[20]||(e[20]=s("label",null,"File",-1)),t.file&&typeof t.file=="string"?(u(),m("div",ve,[s("a",{href:t.file,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,_e)])):N("",!0),s("input",{type:"file",onChange:P,class:"w-full p-2 border rounded"},null,32)]),s("div",ge,[e[21]||(e[21]=s("label",null,"Description",-1)),c(Z,{modelValue:t.description,"onUpdate:modelValue":e[10]||(e[10]=l=>t.description=l),cols:"30",rows:"10",class:"w-full px-4 py-2"},null,8,["modelValue"])])])])]),s("div",we,[c(o,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:X(()=>e[23]||(e[23]=[v(" Cancel ")])),_:1,__:[23]}),e[24]||(e[24]=s("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32))])])}}};export{Ee as default};
