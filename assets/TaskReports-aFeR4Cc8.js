import{b as M,e as O,m as $,A as j,c as a,o,a as s,t as c,f as B,g as u,k as i,i as L,j as N,F as P,n as V,w as q,p as E,q as z}from"./index-DM-YVLMB.js";import{_ as I}from"./UserChip-BD1g-TbH.js";import{a as U}from"./datetime-DLUp6MRA.js";import{u as G}from"./useTaskReportStore-Bca4MGuq.js";import{u as H}from"./useTaskStore-B8q_pqhO.js";const J={class:"mt-4"},K={class:"bg-white"},Q={class:"flex mb-2 items-end"},W={class:"overflow-auto w-full"},X={key:0,class:"min-w-full bg-white shadow rounded-lg overflow-hidden"},Y={class:"bg-gray-100"},Z={key:0,class:"px-4 py-2 text-left md:w-[100px] lg:w-[220px] xl:w-[320px] border"},tt={key:0},st={class:"px-4 py-4 font-medium text-gray-500 text-center border h-28",colspan:"10"},et=["onClick"],ot={class:"px-4 py-2 border-b"},nt={key:0,class:"px-4 py-2 font-medium border-r border-b"},at={key:0,style:{"font-family":"monospace"}},rt={class:"ml-1"},lt={class:"ml-1"},it={class:"font-medium py-2 px-4 border"},dt={class:"border rounded-md bg-gray-50"},ut={class:"text-sm flex items-center px-3 py-3"},ct={class:"text-gray-600 text-sm ml-auto whitespace-nowrap"},pt={key:1,class:"text-center border py-4 text-gray-500"},xt={__name:"TaskReports",setup(mt){const k=G(),r=H(),y=M().params.id;O(async()=>{await r.fetchTask(y),await k.fetchTaskReports({task_id:y})});function h(d,t=[]){const l=[];for(const n of d){const m=[...t,n.title];n.children_tasks.length===0?l.push(...n.reports.map(p=>({...p,task_id:n.id,task_title:n.title,task_parents:t,user:n.users.find(_=>_.id===p.user_id)}))):l.push(...h(n.children_tasks,m))}return l}function g(d,t){try{const l=new Date(d.report_date).getTime(),n=new Date(t.report_date).getTime();return n===l?t.id-d.id:n-l}catch{return-1}}const x=$(()=>r.task.children_task_count===0?[...k.task_reports].sort(g):[...h(r.tasks)].sort(g));return(d,t)=>{var n,m,p,_,b,w,v;const l=j("RouterLink");return o(),a("div",J,[t[8]||(t[8]=s("hr",{class:"mb-2"},null,-1)),s("div",K,[s("pre",null,c(d.usersTaskProgress),1),s("div",Q,[t[3]||(t[3]=s("h3",{class:"text-sm font-semibold text-gray-600 uppercase mt-4"},"Task Reports",-1)),((n=i(r).task)==null?void 0:n.children_task_count)===0&&!((m=i(r).task)!=null&&m.closed_at)?(o(),B(l,{key:0,to:{name:"TaskReportAdd",params:{id:(p=i(r).task)==null?void 0:p.id}},onClick:t[0]||(t[0]=e=>e.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:L(()=>t[2]||(t[2]=[N("Add Report")])),_:1,__:[2]},8,["to"])):u("",!0)]),s("div",W,[i(k).loading?(o(),a("div",pt,"Loading...")):(o(),a("table",X,[s("thead",Y,[s("tr",null,[t[4]||(t[4]=s("th",{class:"px-4 py-2 text-left w-2 border"},"#",-1)),i(r).task.children_task_count>0?(o(),a("th",Z," Task ")):u("",!0),t[5]||(t[5]=s("th",{class:"px-4 py-2 text-left lg:w-[540px] border"},"User Report",-1))])]),s("tbody",null,[((_=x.value)==null?void 0:_.length)===0?(o(),a("tr",tt,[s("td",st,[t[7]||(t[7]=s("div",null,"NO REPORTS",-1)),s("div",null,[((b=i(r).task)==null?void 0:b.children_task_count)===0&&!((w=i(r).task)!=null&&w.closed_at)?(o(),B(l,{key:0,to:{name:"TaskReportAdd",params:{id:(v=i(r).task)==null?void 0:v.id}},onClick:t[1]||(t[1]=e=>e.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:L(()=>t[6]||(t[6]=[N("Add Report")])),_:1,__:[6]},8,["to"])):u("",!0)])])])):u("",!0),(o(!0),a(P,null,V(x.value,(e,F)=>{var R,T,C,D,S;return o(),a("tr",{key:e.id,class:"border-t hover:bg-gray-50 cursor-pointer",onClick:q(A=>d.goToShow(e.id),["prevent"]),role:"button"},[s("td",ot,c(F+1),1),i(r).task.children_task_count>0?(o(),a("td",nt,[s("div",null,[(o(!0),a(P,null,V(e.task_parents.reverse(),(A,f)=>(o(),a("div",{class:E(["text-gray-400 text-sm line-clamp-1",{"-ml-1":f==0}]),key:f},[f>0?(o(),a("span",at,"↳")):u("",!0),s("span",rt,c(A),1)],2))),128)),s("div",null,[((R=e.task_parents)==null?void 0:R.length)>0?(o(),a("span",{key:0,style:{"font-family":"monospace"},class:E({"ml-2":((T=e.task_parents)==null?void 0:T.length)==1,"ml-4":((C=e.task_parents)==null?void 0:C.length)==2,"ml-6":((D=e.task_parents)==null?void 0:D.length)==3,"ml-8":((S=e.task_parents)==null?void 0:S.length)==4})},"↳",2)):u("",!0),s("span",lt,c(e.task_title),1)])])])):u("",!0),s("td",it,[s("div",dt,[z(I,{user:e.user,class:"inline-block w-full !rounded-sm"},null,8,["user"]),s("div",ut,[s("div",null,c(e.title),1),s("div",ct," on "+c(i(U)(e.report_date)),1)])])])],8,et)}),128))])]))])])])}}};export{xt as default};
