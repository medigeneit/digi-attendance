import{z as L,r as h,y as G,m as N,n as D,e as W,c as p,g as j,o as i,a as e,t as u,w as H,h as $,D as T,F as q,q as B,k as V,x as E,v as I,a1 as J,f as O,j as z}from"./index-D30rKX8P.js";import{_ as R}from"./MultiselectDropdown-C8pqW7hK.js";import{u as K}from"./company-CZ2qQLkk.js";import{u as P}from"./user-BMmUkKUz.js";import{_ as Q,a as X}from"./HeaderWithButtons-53YABH5f.js";import{L as Y}from"./LoaderView-DvQTTllB.js";import{u as Z}from"./department-C_R0gj2l.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={key:0,class:"modal-bg"},te={class:"modal-card"},se={class:"text-lg font-semibold mb-4"},oe={class:"mb-4"},ae=["value"],le={class:"mb-4"},ne={class:"mb-4"},re={class:"mb-4"},de={class:"mb-4"},ie={class:"mb-4"},ce={class:"mb-4"},ue={class:"flex justify-end"},me={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},pe={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup(A,{emit:y}){const r=A,v=y,f=K(),c=P(),{companies:U,employees:M}=L(f),{users:F}=L(c),b=h(""),_=h(""),x=h(!1),S=h(!1),s=G({id:null,company_id:"",incharge_id:"",coordinator_id:"",name:"",short_name:"",description:"",status:"Active"}),l=N(()=>b.value?b.value.id:null),n=N(()=>_.value?_.value.id:null);D(l,o=>{s.incharge_id=o}),D(n,o=>{s.coordinator_id=o});const m=()=>{x.value=!1,s.id=null,s.company_id="",s.incharge_id="",s.coordinator_id="",s.name="",s.short_name="",s.description="",s.status="Active"};D(()=>r.department,o=>{var t,a;o&&typeof o=="object"&&Object.keys(o).length>0?(x.value=!0,s.id=o.id||null,s.company_id=o.company_id||"",s.incharge_id=((t=o.in_charge)==null?void 0:t.id)||"",s.coordinator_id=((a=o.coordinator)==null?void 0:a.id)||"",s.name=o.name||"",s.short_name=o.short_name||"",s.description=o.description||"",s.status=o.status||"Active"):m()},{immediate:!0,deep:!0}),D(()=>r.show,async o=>{o&&!S.value&&await d()}),D(()=>s.company_id,async o=>{o&&await k(o)});const g=()=>{v("save",{...s}),m(),w()},w=()=>{m(),v("close")},d=async()=>{try{await f.fetchCompanies(),S.value=!0}catch(o){console.error("Failed to fetch companies:",o)}},k=async o=>{o&&(await f.fetchEmployee(o),b.value=f.employees.find(t=>{var a,C;return t.id===((C=(a=r.department)==null?void 0:a.in_charge)==null?void 0:C.id)}))};return W(async()=>{var o;console.log("DepartmentModal: onMounted"),await d(),r.department.company_id&&await k(r.department.company_id),await c.fetchTypeWiseEmployees({type:"academy_body,doctor"}),_.value=(o=c.users)==null?void 0:o.find(t=>{var a,C;return t.id===((C=(a=r.department)==null?void 0:a.coordinator)==null?void 0:C.id)})}),(o,t)=>A.show?(i(),p("div",ee,[e("div",te,[e("h2",se,u(x.value?"Edit Department":"Add Department"),1),e("form",{onSubmit:H(g,["prevent"])},[e("div",oe,[t[8]||(t[8]=e("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),$(e("select",{id:"company_id","onUpdate:modelValue":t[0]||(t[0]=a=>s.company_id=a),class:"w-full border rounded px-3 py-2",required:""},[t[7]||(t[7]=e("option",{value:"",disabled:""},"Select a company",-1)),(i(!0),p(q,null,B(V(U),a=>(i(),p("option",{key:a.id,value:a.id},u(a.name),9,ae))),128))],512),[[T,s.company_id]])]),e("div",le,[t[9]||(t[9]=e("label",{for:"incharge_id",class:"block text-sm font-medium mb-2"},"In-Charge",-1)),E(R,{options:V(M),modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=a=>b.value=a),label:"label",multiple:!1},null,8,["options","modelValue"])]),e("div",ne,[t[10]||(t[10]=e("label",{for:"coordinator_id",class:"block text-sm font-medium mb-2"},"Coordinator",-1)),E(R,{options:V(F),modelValue:_.value,"onUpdate:modelValue":t[2]||(t[2]=a=>_.value=a),label:"label",multiple:!1},null,8,["options","modelValue"])]),e("div",re,[t[11]||(t[11]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),$(e("input",{id:"name","onUpdate:modelValue":t[3]||(t[3]=a=>s.name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[I,s.name]])]),e("div",de,[t[12]||(t[12]=e("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),$(e("input",{id:"short_name","onUpdate:modelValue":t[4]||(t[4]=a=>s.short_name=a),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[I,s.short_name]])]),e("div",ie,[t[13]||(t[13]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),$(e("textarea",{id:"description","onUpdate:modelValue":t[5]||(t[5]=a=>s.description=a),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[I,s.description]])]),e("div",ce,[t[15]||(t[15]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),$(e("select",{id:"status","onUpdate:modelValue":t[6]||(t[6]=a=>s.status=a),class:"w-full border rounded px-3 py-2",required:""},t[14]||(t[14]=[e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)]),512),[[T,s.status]])]),e("div",ue,[e("button",{type:"button",onClick:w,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",me,u(x.value?"Update":"Create"),1)])],32)])])):j("",!0)}},ye={class:"my-container space-y-4"},fe={key:0,class:"text-center py-4"},ve={key:1,class:"space-y-4"},_e={class:"title-md"},be={class:"overflow-x-auto"},he={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},xe={class:"text-gray-600 text-sm"},ge={class:"py-3 px-2 text-center"},we={class:"py-3 px-2 text-left"},ke={class:"py-3 px-2 text-left"},Ce={class:"py-3 px-2 text-center"},De={class:"py-3 px-2 text-center"},$e={class:"py-3 px-2 text-center"},Me={class:"flex item-center justify-center gap-4"},Se=["onClick"],Ve=["onClick"],Be={__name:"DepartmentList",setup(A){const y=Z(),r=J(),v=h(!1),f=h(!1),c=h(null),U=()=>{c.value=null,v.value=!0},M=()=>{v.value=!1},F=l=>{c.value=l,v.value=!0},b=l=>{c.value=l,f.value=!0},_=()=>{f.value=!1},x=async l=>{try{l.id?(await y.updateDepartment(l.id,l),r.success("Department updated successfully!"),await y.fetchDepartments()):(await y.createDepartment(l),r.success("Department added successfully!"))}catch(n){r.error("Failed to save department!"),console.error("Error handling save:",n)}finally{M()}},S=async()=>{var l;if(!((l=c.value)!=null&&l.id)){r.error("Invalid department selected for deletion!");return}try{await y.deleteDepartment(c.value.id),r.success("Department deleted successfully!")}catch(n){r.error("Failed to delete department!"),console.error("Error deleting department:",n)}finally{_()}},s=N(()=>{const l={};return y.departments.forEach(n=>{var g;const m=((g=n.company)==null?void 0:g.name)||"Unknown Company";l[m]||(l[m]=[]),l[m].push(n)}),l});return W(async()=>{try{await y.fetchDepartments()}catch(l){r.error("Failed to fetch departments!"),console.error("Error fetching departments:",l)}}),(l,n)=>{var m;return i(),p("div",ye,[E(Q,{title:"Department List",onAdd:U}),V(y).loading?(i(),p("div",fe,[E(Y)])):(i(),p("div",ve,[(i(!0),p(q,null,B(s.value,(g,w)=>(i(),p("div",{key:w},[e("h2",_e,u(w),1),e("div",be,[e("table",he,[n[4]||(n[4]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-center"},"#"),e("th",{class:"py-3 px-2 text-left"},"Department Name"),e("th",{class:"py-3 px-2 text-left"},"Coordinator & In-Charge"),e("th",{class:"py-3 px-2 text-center"},"Employee"),e("th",{class:"py-3 px-2 text-center"},"Status"),e("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),e("tbody",xe,[(i(!0),p(q,null,B(g,(d,k)=>{var o,t;return i(),p("tr",{key:k,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ge,u(k+=1),1),e("td",we,[e("div",null,u(d.name),1),e("strong",null,u(d.short_name),1)]),e("td",ke,[e("div",null,[n[0]||(n[0]=e("span",{class:"text-gray-400"},"Coordinator: ",-1)),z(" "+u(((o=d.coordinator)==null?void 0:o.name)||"-"),1)]),e("div",null,[n[1]||(n[1]=e("span",{class:"text-gray-400"},"In-Charge: ",-1)),z(" "+u(((t=d.in_charge)==null?void 0:t.name)||"-"),1)])]),e("td",Ce,u(d==null?void 0:d.users_count),1),e("td",De,u(d.status),1),e("td",$e,[e("div",Me,[e("button",{onClick:a=>F(d),class:"text-blue-600 hover:text-blue-800"},n[2]||(n[2]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Se),e("button",{onClick:a=>b(d),class:"text-red-600 hover:text-red-800"},n[3]||(n[3]=[e("i",{class:"fas fa-trash"},null,-1)]),8,Ve)])])])}),128))])])])]))),128))])),v.value?(i(),O(pe,{key:2,show:v.value,department:c.value,onClose:M,onSave:x},null,8,["show","department"])):j("",!0),f.value?(i(),O(X,{key:3,show:f.value,title:"Delete Department",message:`Are you sure you want to delete ${(m=c.value)==null?void 0:m.name}?`,onClose:_,onConfirm:S},null,8,["show","message"])):j("",!0)])}}};export{Be as default};
