import{_ as ye}from"./CommentModal-CumiWcGc.js";import{_ as ke,a as fe}from"./TaskUserAssignForm-CcUjScrB.js";import{L as ce}from"./LoaderView-BpBHnlio.js";import{O as K}from"./OverlyModal-DiWJXxIH.js";import{_ as ae,a as ve}from"./TaskAddForm-DTWalde5.js";import{_ as be}from"./TaskEditForm-qPorb7W-.js";import{D as xe,d as ie,b as ue,q as k,r as P,e as de,A as Z,k as ge,c as n,o as a,a as t,f as v,w as J,F as E,m as O,l as b,g as $,C as oe,x as W,t as ee,h as o,p as M,E as Q,v as X,n as ne,y as te,u as we,G as re}from"./index-A_EThQzY.js";import{_ as Te}from"./MultiselectDropdown-D5wbGeWA.js";import{u as Ce}from"./company-DKCGBbPx.js";import{_ as me}from"./UserChip-BX1MwLKa.js";import{_ as pe}from"./TaskTreeView-DZce3QY8.js";import{u as Ie}from"./task-priority-BWGjxNHS.js";import{u as Ae}from"./useTaskStore-DsMSCabU.js";import"./useCommentStore-Cr3l6SJ2.js";import"./datetime-q3Sn87-f.js";import"./TaskUrgencyInput-KbJxdZYb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-DHRIFJYl.js";import"./useRequirementStore-CyZnPhqU.js";import"./SectionLoading-DR-Uszsq.js";async function Ve({params:g={}}={}){return xe.get("/tasks/employees",{params:g})}const qe={class:"mb-3 task-header"},Me={class:"flex justify-between items-start mb-4"},Le={key:0,class:"ml-auto flex gap-6 items-center"},Se={key:0,class:"flex gap-2 items-center"},Ue={class:"flex flex-wrap items-center gap-2 mt-3"},$e={class:"flex flex-wrap gap-4"},Ee={class:"relative w-full md:w-64"},De=["value"],Pe={key:1,class:"relative w-full md:w-72"},_e={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},he={class:"text-gray-600 w-40 relative"},Oe={class:"flex gap-4 items-center flex-shrink-0"},Be={class:"flex gap-2"},Ne={class:"flex gap-2"},Re={class:"flex gap-2"},Fe={class:"text-gray-600 w-full md:w-40 relative"},He={key:0,class:"text-gray-600 w-full md:w-64 lg:w-96 md:ml-auto relative"},je={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-5 gap-2"},ze={key:0,class:"text-gray-600 w-full md:w-64 lg:w-96 md:ml-auto relative"},Ge={key:1,class:"w-full flex justify-end gap-5 mt-4"},We={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(g,{emit:c}){const m=g,u=ie(),w=ue(),A=k(x("company-id")),L=k(x("from-department-id")),i=k(x("to-department-id")),r=k(x("user-ids")),y=k(x("month")),f=k(x("status")),p=k(x("is-important")),T=k(x("is-urgent")),B=k(x("is-target")),_=k(H()),D=c,q=Ce(),I=P([]);function x(s){return{get:()=>m.modelValue[s]||"",set:e=>{D("update:modelValue",{...m.modelValue,[s]:e||void 0})}}}function H(){let s=0;const e=C=>{D("update:modelValue",{...m.modelValue,search:C||void 0})};return{get:()=>m.modelValue.search||"",set:C=>{clearTimeout(s),s=setTimeout(e,500,C)}}}const N=k(()=>j(r.value));async function R(){var s,e,C;if(m.isMyTask){const S=(s=m.modelValue)==null?void 0:s["company-id"],U=i.value,d={...S?{company_id:S}:{},...U?{department_ids:[U]}:{}};I.value=((C=(e=await Ve({params:d}))==null?void 0:e.data)==null?void 0:C.employees)||[]}}de(async()=>{await R(),await q.fetchCompanies({with:"departments",ignore_permission:!0})});function j(s){return Array.isArray(I.value)&&I.value.find(e=>e.id==s)||null}function Y(s){r.value=(s==null?void 0:s.id)||""}function z(){r.value=""}const G=k(()=>q==null?void 0:q.companies.filter(s=>s.id==A.value));return Z(()=>i.value,R),Z(()=>A.value,()=>{i.value!==""?i.value="":R()}),(s,e)=>{var S,U,d,h,V,se,le;const C=ge("RouterLink");return a(),n(E,null,[t("div",qe,[t("div",Me,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),g.isMyTask?v("",!0):(a(),n("div",Le,[g.listHasRearranged?(a(),n("div",Se,[e[13]||(e[13]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=J(l=>D("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=J(l=>D("clickPriorityDiscard"),["prevent"]))},"Discard")])):v("",!0),t("button",{onClick:e[2]||(e[2]=l=>D("clickAddTask")),class:"btn-1"},"Add Task")]))]),t("div",Ue,[t("div",$e,[g.isMyTask?v("",!0):(a(),n(E,{key:0},[t("div",Ee,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),$(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>A.value=l),class:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[15]||(e[15]=t("option",{value:""},"--ALL COMPANY--",-1)),(a(!0),n(E,null,W((S=o(q))==null?void 0:S.companies,l=>(a(),n("option",{key:l.id,value:l.id},ee(l.name),9,De))),128))],512),[[oe,A.value]])]),o(w).name!=="MyTaskList"?(a(),O(ae,{key:0,modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value=l),companies:G.value||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:M(()=>e[17]||(e[17]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):v("",!0),o(u).isAdminMood&&((d=(U=o(u))==null?void 0:U.user)==null?void 0:d.role)!=="employee"?(a(),n("div",Pe,[b(Te,{modelValue:N.value,onSelect:Y,onRemove:z,options:I.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full"},{option:M(({option:l})=>[b(me,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),N.value?(a(),n("div",_e,[t("button",{onClick:J(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):v("",!0),e[18]||(e[18]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):v("",!0),b(ae,{modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=l=>L.value=l),companies:((h=o(q))==null?void 0:h.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:M(()=>e[19]||(e[19]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"])],64)),t("div",he,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),$(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>f.value=l),class:"input-1"},e[20]||(e[20]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[oe,f.value]])]),t("div",Oe,[t("label",Be,[$(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>p.value=l)},null,512),[[Q,p.value]]),e[22]||(e[22]=t("span",null,"Important",-1))]),t("label",Ne,[$(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>T.value=l)},null,512),[[Q,T.value]]),e[23]||(e[23]=t("span",null,"Urgent",-1))]),t("label",Re,[$(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=l=>B.value=l)},null,512),[[Q,B.value]]),e[24]||(e[24]=t("span",null,"Is Target",-1))])]),t("div",Fe,[e[25]||(e[25]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),$(t("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),type:"month",class:"input-1",placeholder:"All month"},null,512),[[X,y.value]])])]),g.isMyTask?(a(),n("div",He,[e[26]||(e[26]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),$(t("input",{id:"search","onUpdate:modelValue":e[11]||(e[11]=l=>_.value=l),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[X,_.value]]),e[27]||(e[27]=t("i",{class:"fas fa-search absolute right-2 top-[50%] translate-y-[-50%]"},null,-1))])):v("",!0)])]),t("div",je,[g.isMyTask?v("",!0):(a(),n("div",ze,[e[28]||(e[28]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),$(t("input",{id:"search","onUpdate:modelValue":e[12]||(e[12]=l=>_.value=l),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[X,_.value]]),e[29]||(e[29]=t("i",{class:"fas fa-search absolute right-2 top-[50%] translate-y-[-50%]"},null,-1))])),g.isMyTask?v("",!0):(a(),n("div",Ge,[b(C,{class:te(["text-xs sm:text-sm btn-3 py-0.5",((V=o(w).query)==null?void 0:V.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...o(w).query,view:"userwise"}}},{default:M(()=>e[30]||(e[30]=[ne(" User Wise List ")])),_:1,__:[30]},8,["class","to"]),b(C,{class:te(["text-xs sm:text-sm btn-3 py-0.5",((se=o(w).query)==null?void 0:se.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((le=o(w))==null?void 0:le.query)||{}).filter(l=>{var F;return((F=o(w))==null?void 0:F.query[l])!=="userwise"}).reduce((l,F)=>({...l,[F]:o(w).query[F]}),{})}}},{default:M(()=>e[31]||(e[31]=[ne(" TaskWise List ")])),_:1,__:[31]},8,["class","to"])]))])],64)}}},Ye={class:"w-full bg-white rounded"},Ke=["rowspan"],Je={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(g,{emit:c}){const m=g,u=c,w=k(()=>m.tasks.reduce((i,r)=>(i.push(...r.users.filter(y=>!i.find(f=>f.id==y.id&&y.id))),i),[]).filter(i=>m.selectedUserId?i.id==m.selectedUserId:!0)),A=i=>m.tasks.filter(f=>f.users.some(p=>p.id===i)),L=k(()=>w.value.map(i=>{const r=A(i.id);return{...i,tasks:r}}));return(i,r)=>(a(),n("div",null,[t("table",Ye,[t("tbody",null,[(a(!0),n(E,null,W(L.value,y=>(a(),n(E,{key:y.id},[(a(!0),n(E,null,W(y.tasks,(f,p)=>(a(),n("tr",{key:f.id},[p==0?(a(),n("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(y.tasks.length,1)},[b(me,{user:y,class:"sticky top-[80px]"},null,8,["user"])],8,Ke)):v("",!0),t("td",{class:te(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":p==0,"border-b":y.tasks.length-1===p}])},[b(pe,{task:f,class:"!border-0 my-0",index:p,onCommentButtonClick:r[0]||(r[0]=T=>u("commentButtonClick",i.item.id)),onEditClick:r[1]||(r[1]=T=>u("editClick",T)),onAddClick:r[2]||(r[2]=T=>u("addClick",T)),onEmployeeAssignClick:r[3]||(r[3]=T=>u("employeeAssignClick",T))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Qe={class:"container mx-auto p-6 mt-2 relative bg-white rounded-md shadow-md"},Xe={class:"mb-4"},Ze={key:4},et={key:0,class:"text-center py-4 text-red-500"},tt={key:1},st={class:"flex items-stretched"},lt={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},at=1,At={__name:"TaskList",setup(g){const c=Ae(),m=ie(),u=ue(),w=we(),A=P(!1),L=P(null),i=k(()=>{var s;return((s=m==null?void 0:m.user)==null?void 0:s.role)==="employee"||!(m!=null&&m.isAdminMood)?!0:!!u.query["user-ids"]}),r=P(null),y=P(!1),f=re({parentId:0,requirementId:0}),p=re({taskId:0,isOpen:!1}),T=P(null),B=P([]),{handleItemsPriorityUpdate:_,saveTaskPriority:D,listHasRearranged:q}=Ie(()=>c.taskListTree,0);de(async()=>{u.query.status||w.push({query:{...u.query,status:"not-completed"}}),await I()});async function I(){let s;u.name==="MyTaskList"?s=await c.fetchMyTasks({...u.query}):s=await c.fetchTasks({...u.query}),B.value=s.query_log||[]}const x=s=>{y.value=!0,f.parentId=s},H=s=>{p.taskId=s,p.isOpen=!0},N=s=>{L.value=s,A.value=!0},R=()=>{A.value=!1,L.value=null};async function j(){r.value=null,y.value=!1,f.parentId=0,await I()}async function Y(){y.value=!1,f.parentId=0,await I()}async function z(){D()&&await I()}Z(()=>({...u.query}),async()=>{await I()});const G=k({get(){return{...u.query}},set(s){localStorage.removeItem("sub_task_opened_list"),w.push({query:{...s}})}});return(s,e)=>{var C,S,U;return a(),n("div",Qe,[r.value?(a(),O(K,{key:0},{default:M(()=>[b(be,{taskId:r.value,onClose:e[0]||(e[0]=d=>r.value=null),onUpdated:j},null,8,["taskId"])]),_:1})):v("",!0),y.value?(a(),O(K,{key:1},{default:M(()=>[b(ve,{parentTaskId:f.parentId,requirementId:f.requirementId,onClose:Y,onTaskCreated:j},null,8,["parentTaskId","requirementId"])]),_:1})):v("",!0),p.isOpen?(a(),O(K,{key:2,class:"*:max-w-4xl"},{default:M(()=>[b(ke,{taskId:p.taskId,onCancelClick:e[1]||(e[1]=()=>{p.isOpen=!1,p.taskId=0}),onSuccess:e[2]||(e[2]=()=>{p.isOpen=!1,p.taskId=0,I()})},null,8,["taskId"])]),_:1})):v("",!0),b(We,{modelValue:G.value,"onUpdate:modelValue":e[3]||(e[3]=d=>G.value=d),onClickAddTask:x,onClickPrioritySave:z,onClickPriorityDiscard:e[4]||(e[4]=()=>o(q)?T.value.resetItems:null),"list-has-rearranged":o(q),isMyTask:o(u).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((S=(C=o(u))==null?void 0:C.query)==null?void 0:S["query-log"])=="true"?(a(!0),n(E,{key:3},W(B.value,(d,h)=>(a(),n("div",{key:h,class:"text-xs text-gray-500"},[t("div",Xe,ee(d.raw_query),1)]))),128)):v("",!0),o(c).loading?(a(),n("div",Ze,[b(ce)])):(a(),n(E,{key:5},[o(c).error?(a(),n("div",et,ee(o(c).error),1)):o(c).tasks.length>0?(a(),n("div",tt,[((U=o(u).query)==null?void 0:U.view)=="userwise"?(a(),O(Je,{key:0,tasks:o(c).tasks,selectedUserId:o(u).query["user-ids"],onCommentButtonClick:e[5]||(e[5]=d=>N(d,s.task.id)),onEditClick:e[6]||(e[6]=d=>r.value=d),onAddClick:e[7]||(e[7]=d=>x(d)),onEmployeeAssignClick:e[8]||(e[8]=d=>H(d))},null,8,["tasks","selectedUserId"])):(a(),O(fe,{key:1,items:o(c).tasks,handle:"handle",onItemsUpdate:o(_),class:"space-y-4",ref_key:"draggableTaskList",ref:T},{item:M(({item:d,index:h})=>[t("div",st,[b(pe,{task:d,index:h,showDraggableHandle:!i.value,onCommentButtonClick:e[9]||(e[9]=V=>N(V,s.task.id)),onEditClick:e[10]||(e[10]=V=>r.value=V),onAddClick:e[11]||(e[11]=V=>x(V)),onEmployeeAssignClick:e[12]||(e[12]=V=>H(V)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(a(),n("div",lt," No tasks found. "))],64)),b(ye,{show:A.value,"commentable-id":L.value,"commentable-type":"task","user-id":at,"on-close":R,onSubmitted:o(c).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{At as default};
