import{x as F,c as o,o as s,_ as ze,r as h,h as de,q as tt,k as v,a as e,j as A,F as U,e as V,t as b,n as O,s as B,d as y,M as Z,m as R,w as N,E as te,p as Ge,b as S,l as X,v as We,C as Ye,g as Qe,P as me,Q as Be,R as st,y as Ke,A as ve,f as rt,u as nt}from"./index-BFXrp91U.js";import{_ as Je}from"./TextEditor-C9x_tLPG.js";import{s as Ve,_ as ot}from"./TaskAddForm-DINzHBvA.js";import{u as Xe}from"./useCommentStore-C0MjidlV.js";import{O as Y}from"./OverlyModal-DPh4mQys.js";import{L as pe}from"./LoaderView-DdmIZnyR.js";import{_ as at}from"./ShareComponent-3IT4dU7n.js";import{_ as Fe}from"./DepartmentChip-CHUcxxZb.js";import{_ as le}from"./DescriptionView-GechlGZU.js";import{i as Ze,f as xe,a as it,_ as lt,b as dt}from"./TaskTableRow-6DvENiLV.js";import{b as ut,r as mt,c as ct,f as fe,d as pt,s as bt}from"./requirement-CXwI-gt9.js";import{_ as vt}from"./AttachmentPreview-TtjfNPUO.js";import{_ as ie}from"./UserChip-Bj6jC9y1.js";import{o as xt}from"./url-Buz9GlSr.js";import{u as ft}from"./user-CdzNHlTX.js";import{_ as Ba,a as gt}from"./TaskUserAssignForm-Div26lU8.js";import{b as se,c as et}from"./datetime-y2WWmmYq.js";import{u as yt}from"./useTaskStore-CXPpcAGE.js";import{_ as _t}from"./TaskSelectionInput-d0x5StL8.js";import{_ as kt}from"./TaskEditForm-CQg1Y7DE.js";import{T as be}from"./TextWithHr-BOrXfsb0.js";import{c as ht}from"./dom-Bic1TNqD.js";import{_ as wt}from"./ApproveAndReject-D0RXyF2Z.js";import"./RequiredIcon-BVeLCbtv.js";import"./company-DAjC-VJ4.js";import"./CompanyDepartmentSelectInput-CpAzZNzC.js";import"./SelectDropdown-BixApdfD.js";import"./SectionLoading-X8ss1Csw.js";import"./TaskUrgencyInput-Dexj3aUR.js";import"./TaskUrgentBadge-DJoNVzRz.js";import"./TaskTitle-H742tMGb.js";import"./TaskStatus-B37ybdEM.js";import"./TaskIsClosedBadge-DUUspIjS.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-DMP3YYbL.js";import"./tags-Dgts9v3e.js";function $t(d){const m=new DOMParser().parseFromString(d,"text/html"),u=/#(\d+)/g;function c(t){t.childNodes.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){const p=i.textContent.replace(u,(r,q)=>`<a href="/requirement-tasks/${q}" class="text-pink-600 hover:underline font-bold">${r}</a>`);if(p!==i.textContent){const r=document.createElement("span");r.innerHTML=p,i.replaceWith(...r.childNodes)}}else c(i)})}return c(m.body),m.body.innerHTML}function qt(d){const m=new DOMParser().parseFromString(d,"text/html"),u=/(https?:\/\/[^\s]+)/g;function c(t){t.childNodes.forEach(i=>{if(i.nodeType===Node.TEXT_NODE){const p=i.textContent.replace(u,r=>`<a href="${r}" target="_blank" class="text-blue-600 hover:underline">
            ${r}
            <i class="fas fa-external-link text-xs text-blue-600"></i>
          </a>`);if(p!==i.textContent){const r=document.createElement("span");r.innerHTML=p,i.replaceWith(...r.childNodes)}}else c(i)})}return c(m.body),m.body.innerHTML}const Ct=["innerHTML"],ce={__name:"HTMLTextBody",props:{message:{type:String,required:!0}},setup(d){const _=d,m=F(()=>qt($t(_.message)));return(u,c)=>(s(),o("div",{class:"prose prose-sm max-w-none leading-loose text-sm",innerHTML:m.value},null,8,Ct))}},Tt={class:"space-y-4"},jt={key:0,class:"space-y-2"},St={class:"text-xs opacity-80"},Rt=["onClick"],At={class:"space-y-4"},It={key:0,class:"text-sm text-gray-500"},Dt={key:1,class:"text-sm text-gray-500"},Nt={key:0,class:"shrink-0 mt-2"},Ot={class:"bg-inherit bubble-inner px-4 py-3 rounded-md"},Et={class:"text-sm font-bold text-gray-800"},Mt={class:"text-xs text-gray-400"},Lt=["onClick"],Pt={key:1,class:"mt-2 space-y-1"},Ut={key:1,class:"shrink-0 mt-2"},Bt={class:"bg-white rounded-xl shadow-sm border p-4 space-y-3"},Vt={class:"flex items-center gap-2"},Ft={class:"text-sm font-semibold text-gray-700"},Ht={class:"flex items-center justify-end gap-2"},zt=["disabled"],Gt={key:0,class:"text-xs text-red-600"},Wt={class:"bg-white rounded-2xl w-full p-5 space-y-4"},Yt={class:"rounded-xl bg-slate-50 border border-slate-100 p-3 text-sm text-gray-700 max-h-40 overflow-auto"},Qt=["innerHTML"],Kt={__name:"CommentBox",props:{commentableType:{type:String,required:!0},commentableId:{type:[Number,String],required:!0},currentUser:{type:Object,required:!0}},setup(d){const _=d,m=h(!1),u=h(null),c=$=>{u.value=$,m.value=!0},t=()=>{m.value=!1,u.value=null},i=async()=>{if(!u.value)return;const $=u.value.id;t(),await L($)},p=h([]),r=h({}),q=$=>{$&&p.value.push({id:crypto.randomUUID(),message:$,time:new Date().toISOString()})},x=($,M)=>{!$||!M||(r.value[$]||(r.value[$]=[]),r.value[$].push(M))},n=$=>{r.value[$]=[]},a=Xe(),f=F(()=>a.comments),k=F(()=>a.loading),w=F(()=>a.error),T=h(""),I=h(!1),D=async()=>{await a.fetchComments({commentable_type:_.commentableType,commentable_id:_.commentableId})},j=async()=>{if(!(!T.value||!Ve(String(T.value)).trim())){I.value=!0;try{await a.createComment({commentable_type:_.commentableType,commentable_id:Number(_.commentableId),user_id:_.currentUser.id,message:T.value}),T.value=""}catch($){q($.message)}finally{I.value=!1}}},L=async $=>{var M,K;n($);try{await a.deleteComment($)}catch(g){x($,(K=(M=g.response)==null?void 0:M.data)==null?void 0:K.message)}};de(D),tt(()=>[_.commentableType,_.commentableId],()=>D());const H=$=>$?new Date($).toLocaleString():"",ee=$=>($==null?void 0:$.user_id)===_.currentUser.id,E=$=>($==null?void 0:$.user_id)===_.currentUser.id;return($,M)=>{var K;return s(),o("div",Tt,[p.value.length?(s(),o("div",jt,[(s(!0),o(U,null,V(p.value,g=>(s(),o("div",{key:g.id,class:"rounded-xl border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-700 flex items-start justify-between gap-3"},[e("div",null,[M[1]||(M[1]=e("p",{class:"font-semibold"},"Error",-1)),e("p",St,b(g.message),1)]),e("button",{class:"text-xs text-red-500 hover:underline",onClick:Q=>p.value=p.value.filter(G=>G.id!==g.id)}," Dismiss ",8,Rt)]))),128))])):v("",!0),e("div",At,[k.value&&O(a).action=="fetching"?(s(),o("div",It," Loading comments... ")):f.value.length?v("",!0):(s(),o("div",Dt,"No comments yet.")),(s(!0),o(U,null,V(f.value,g=>{var Q,G;return s(),o("div",{key:g.id,class:B(["flex gap-3",E(g)?"justify-end":"justify-start"])},[E(g)?v("",!0):(s(),o("div",Nt,[y(Z,{user:g.user},null,8,["user"])])),e("div",{class:B(["group relative min-w-[25%] max-w-[90%] rounded-md shadow border bubble-arrow",E(g)?"bubble-right bg-indigo-50 border-indigo-100":"bubble-left bg-white border-gray-100"])},[e("div",Ot,[e("div",{class:B(["flex items-center gap-2 mb-2 pb-1 border-b border-dashed",E(g)?"justify-end":"justify-start"])},[e("p",Et,b(E(g)?"You":((Q=g.user)==null?void 0:Q.name)||"Unknown"),1),M[2]||(M[2]=e("span",{class:"text-xs text-gray-400"},"•",-1)),e("p",Mt,b(H(g.created_at)),1)],2),y(ce,{message:g.message},null,8,["message"]),ee(g)?(s(),o("div",{key:0,class:B(["mt-2 flex",E(g)?"justify-end":"justify-start"])},[e("button",{class:"text-[11px] text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100",onClick:W=>c(g)}," Delete ",8,Lt)],2)):v("",!0),(G=r.value[g.id])!=null&&G.length?(s(),o("div",Pt,[(s(!0),o(U,null,V(r.value[g.id],(W,P)=>(s(),o("p",{key:P,class:B(["text-xs text-red-600",E(g)?"text-right":"text-left"])},b(W),3))),128))])):v("",!0)])],2),E(g)?(s(),o("div",Ut,[y(Z,{user:g.user||d.currentUser},null,8,["user"])])):v("",!0)],2)}),128))]),e("div",Bt,[e("div",Vt,[y(Z,{user:d.currentUser},null,8,["user"]),e("div",Ft,b(((K=d.currentUser)==null?void 0:K.name)||"You"),1)]),y(Je,{modelValue:T.value,"onUpdate:modelValue":M[0]||(M[0]=g=>T.value=g)},null,8,["modelValue"]),e("div",Ht,[e("button",{class:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm disabled:opacity-60",disabled:I.value||!O(Ve)(String(T.value)).trim(),onClick:j},b(I.value?"Posting...":"Post Comment"),9,zt)]),w.value?(s(),o("p",Gt,b(w.value),1)):v("",!0)]),m.value?(s(),A(Y,{key:1},{default:R(()=>{var g;return[e("div",Wt,[M[3]||(M[3]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete comment?",-1)),M[4]||(M[4]=e("p",{class:"text-sm text-gray-600 leading-relaxed"}," আপনি কি নিশ্চিত যে এই কমেন্টটি মুছে ফেলতে চান? মুছে ফেলা কমেন্ট পুনরুদ্ধার করা যাবে না। ",-1)),e("div",Yt,[e("div",{innerHTML:(g=u.value)==null?void 0:g.message},null,8,Qt)]),e("div",{class:"flex items-center justify-end gap-2 pt-2"},[e("button",{class:"px-4 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-50",onClick:t}," Cancel "),e("button",{class:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700",onClick:i}," Yes, Delete ")])])]}),_:1})):v("",!0)])}}},Jt=ze(Kt,[["__scopeId","data-v-44914bc3"]]),Xt={class:"flex items-center border-b w-full pb-2"},Zt={class:""},es={class:"mt-4 border h-40 flex items-center flex-col justify-center rounded border-dashed bg-red-50 text-center"},ts={key:1,class:"text-red-500 text-center mt-2"},ss={class:"flex items-center justify-between mt-4"},rs={__name:"RequirementAttachmentForm",props:{requirementId:[String,Number],default:()=>null},emits:["uploaded","error","clickBack"],setup(d,{emit:_}){const m=d,u=h({attachments:[]}),c=h(""),t=h(""),i=_;function p(x){u.value.attachments=[...u.value.attachments,...Array.from(x.target.files)]}function r(x){u.value.attachments.splice(x,1)}async function q(){var n,a,f,k;c.value="submitting";const x=new FormData;for(const w in u.value)w==="attachments"?u.value.attachments.forEach(T=>x.append("attachments[]",T)):x.append(w,u.value[w]);try{const w=await ut(m.requirementId,x);u.value.attachments=[],i("uploaded",w),c.value="uploaded"}catch(w){i("error",(a=(n=w.response)==null?void 0:n.data)==null?void 0:a.message),t.value=(k=(f=w.response)==null?void 0:f.data)==null?void 0:k.message,c.value="error"}}return(x,n)=>{var a;return s(),o("form",{class:"p-4 flex flex-col relative",onSubmit:N(q,["prevent"])},[c.value=="submitting"?(s(),A(pe,{key:0,class:"absolute inset-0 bg-opacity-80 flex items-center justify-center"})):v("",!0),e("div",Xt,[n[3]||(n[3]=e("h3",null,"Requirement Attachment",-1)),e("button",{class:"btn-icon ml-auto",onClick:n[0]||(n[0]=N(()=>{i("clickBack")},["prevent"]))},n[2]||(n[2]=[e("span",{class:"fas fa-times"},null,-1)]))]),e("div",Zt,[e("label",es,[n[4]||(n[4]=e("div",{class:"block text-gray-600 font-medium text-sm md:text-xl mb-4"}," Click to Select files or Drop Here ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",class:"border rounded-r-md text-gray-600 bg-gray-50",onChange:p},null,32)])]),y(vt,{files:((a=u.value)==null?void 0:a.attachments)||[],onRemove:r,class:"border p-1 rounded overflow-y-auto flex-grow"},null,8,["files"]),n[6]||(n[6]=e("hr",{class:"mt-4"},null,-1)),t.value?(s(),o("div",ts,b(t.value),1)):v("",!0),e("div",ss,[e("button",{class:"btn-3",onClick:n[1]||(n[1]=N(f=>i("clickBack"),["prevent"]))},"Cancel"),n[5]||(n[5]=e("button",{class:"btn-2"},"Save",-1))])],32)}}},ns={class:"card-bg p-4 pt-2"},os={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 w-full"},as=["onClick"],is=["src"],ls=["href"],ds={key:2,class:"text-xs text-gray-500 text-center"},us={__name:"RequirementAttachments",props:{requirement:{type:Array,default:()=>[]}},setup(d){const _=d,m=F(()=>{var t;return((t=_.requirement)==null?void 0:t.attachments)||[]}),u=te({show:!1}),c=te({show:!1,selectedFile:""});return(t,i)=>(s(),o("div",ns,[e("div",null,[i[6]||(i[6]=e("h4",{class:"text-gray-900 font-semibold mb-3 border-b font-e"},"Attachments",-1)),e("div",os,[m.value&&m.value.length?(s(!0),o(U,{key:0},V(m.value,(p,r)=>(s(),o("div",{key:r,class:"border p-1 rounded aspect-square flex items-center justify-center bg-gray-50 relative",tabindex:"0",onClick:N(()=>{c.show=!0,c.selectedFile=p},["prevent"])},[O(Ze)(p)?(s(),o("img",{key:0,src:O(xe)(p),alt:"attachment",class:"object-cover w-full h-full rounded"},null,8,is)):O(it)(p)?(s(),o("a",{key:1,href:O(xe)(p),target:"_blank",class:"text-xs text-blue-600 text-center break-words hover:underline"},i[4]||(i[4]=[e("i",{class:"fas fa-file-pdf fa-2x mb-1 text-amber-700"},null,-1),e("div",{class:"whitespace-nowrap text-xs mt-1"},"Open PDF",-1)]),8,ls)):(s(),o("span",ds,"Unknown"))],8,as))),128)):v("",!0),e("button",{title:"Add Attachments",onClick:i[0]||(i[0]=N(p=>u.show=!u.show,["prevent"])),class:"border rounded aspect-square flex items-center justify-center bg-sky-50 hover:bg-sky-100 relative group/btn"},i[5]||(i[5]=[e("i",{class:"fas fa-plus-circle text-2xl text-blue-300 group-hover/btn:text-blue-500"},null,-1)]))])]),u.show?(s(),A(Y,{key:0},{default:R(()=>[y(rs,{onClickBack:i[1]||(i[1]=p=>u.show=!1),onUploaded:i[2]||(i[2]=p=>u.show=!1),requirementId:d.requirement.id,class:"max-h-[70vh]"},null,8,["requirementId"])]),_:1})):v("",!0),c.show?(s(),A(Y,{key:1,class:"*:max-w-4xl *:min-h-[60vh]"},{default:R(()=>[y(lt,{attachments:m.value,selected:c.selectedFile,onClickClose:i[3]||(i[3]=p=>c.show=!1)},null,8,["attachments","selected"])]),_:1})):v("",!0)]))}},ms={class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},cs={class:"text-sm flex flex-col xl:flex-row items-center mt-2 xl:mt-0 gap-x-2 text-red-400 font-semibold whitespace-nowrap"},ps={class:"mt-[2px]"},bs={key:0,class:"text-gray-800 flex items-center gap-2"},vs={key:1,class:"text-gray-800 w-full my-2 text-center"},xs={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},fs=["innerHTML"],gs={key:1,class:"flex gap-4 items-center justify-center mt-2"},ys={key:2,class:"mb-2"},_s={class:"flex justify-end text-sky-500"},ks={key:3,class:"text-center w-full"},hs={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick","closeClick","showHistoryClick"],setup(d,{emit:_}){const m=_;return(u,c)=>{var t,i;return s(),o("div",ms,[d.requirement.closed_at?(s(),o(U,{key:0},[c[6]||(c[6]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",cs,[c[3]||(c[3]=e("span",{class:"flex items-center gap-2 text-gray-600"},[e("span",{class:"fad fa-lock"}),e("span",{class:"mt-[2px]"},"CLOSED AT")],-1)),e("span",ps,b(new Date(d.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),d.requirement.closed_by_user?(s(),o("div",bs,[c[4]||(c[4]=e("span",{class:"text-sm"},"Closed by",-1)),y(ie,{user:d.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):v("",!0),d.requirement.closing_note?(s(),o("div",vs,[c[5]||(c[5]=e("div",{class:"text-xs text-left"},"Note",-1)),e("div",xs,[e("p",{innerHTML:d.requirement.closing_note},null,8,fs)])])):v("",!0)],64)):v("",!0),d.requirement.closed_at?(s(),o("div",gs,[e("button",{class:"btn-2 h-8",onClick:c[0]||(c[0]=N(p=>m("reOpenClick"),["prevent"]))},"Re Open")])):v("",!0),d.requirement.closed_at?v("",!0):(s(),o("div",ys,[e("div",_s,[e("button",{class:"btn-1 border border-sky-800",onClick:c[1]||(c[1]=N(p=>m("closeClick"),["prevent"]))}," Close Requirement ")])])),((i=(t=d.requirement)==null?void 0:t.closing_history)==null?void 0:i.length)>1?(s(),o("div",ks,[e("button",{onClick:c[2]||(c[2]=p=>m("showHistoryClick")),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):v("",!0)])}}},ws={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},$s={class:"my-6"},qs={class:"text-center font-semibold text-blue-800 mb-4"},Cs={class:"text-center my-1"},Ts={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},js={class:"mt-4"},Ss=["placeholder","required"],Rs={class:"flex"},As={class:"text-red-600 text-center mt-2 text-sm"},Is={class:"flex justify-between mt-3"},Ds=["disabled"],Ns={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(d,{emit:_}){const m=d,u=_,c=F({get:()=>m.loading,set:()=>u("update:loading")}),t=h(""),i=h(""),p=h(255),r=F(()=>p.value-t.value.length);async function q(){var x,n,a;c.value=!0;try{(x=m.requirement)!=null&&x.closed_at?await mt(m.requirement.id,t.value):await ct(m.requirement.id,t.value),u("updateStatus")}catch(f){i.value=(a=(n=f.response)==null?void 0:n.data)==null?void 0:a.message,u("error")}finally{c.value=!1}}return(x,n)=>{var f,k,w,T,I;const a=Ge("LoaderView");return s(),o("form",{class:"p-4 rounded relative border",onSubmit:N(q,["prevent"])},[c.value?(s(),A(a,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:R(()=>n[3]||(n[3]=[S(" Submitting! ")])),_:1,__:[3]})):v("",!0),e("h3",ws,b((f=d.requirement)!=null&&f.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",$s,[e("div",qs,b((k=d.requirement)==null?void 0:k.title),1),n[6]||(n[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",Cs,[n[4]||(n[4]=S(" Want to ")),e("span",Ts,b((w=d.requirement)!=null&&w.closed_at?"Re-Open":"Close"),1),n[5]||(n[5]=S(" the requirement? "))]),e("div",js,[X(e("textarea",{"onUpdate:modelValue":n[0]||(n[0]=D=>t.value=D),rows:"4",placeholder:`Write about why are you ${(T=d.requirement)!=null&&T.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:x.currentAction==="reject",onInput:n[1]||(n[1]=D=>t.value.length>p.value?t.value=t.value.slice(0,p.value):null)},null,40,Ss),[[We,t.value]]),e("div",Rs,[e("div",{class:B(["ml-auto inline-block text-sm text-gray-500",t.value.length>=p.value?"text-red-500":""])}," left "+b(r.value)+"/"+b(p.value)+" words ",3)])])]),n[7]||(n[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",As,b(i.value),1),e("div",Is,[e("button",{class:"btn-3",onClick:n[2]||(n[2]=N(D=>u("clickCancel"),["prevent"]))},"Cancel"),e("button",{class:"btn-2 disabled:opacity-45",disabled:t.value.trim().length==0},b((I=d.requirement)!=null&&I.closed_at?"Re-Open Requirement":"Close Requirement"),9,Ds)])])],32)}}};async function Os(d,_,{params:m={}}={}){return Ye.get(`/requirements/${d}/details/${_}`,{params:m})}async function Es(d,_,{params:m={}}={}){const u=xt(m);return Ye.delete(`/requirements/${d}/details/${_}${u?"?"+u:""}`)}const Ms={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Ls={class:"mb-4"},Ps={class:"font-semibold"},Us={class:"mb-4"},Bs={class:"line-clamp-2"},Vs={key:1,class:"min-h-40"},Fs={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Hs={key:0,class:"mb-4 text-red-500 font-medium"},zs={key:1,class:"mb-4"},Gs={class:"flex items-center justify-between gap-4"},Ws=["disabled"],Ys={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(d,{emit:_}){const m=d,u=_,c=ft(),t=h(null),i=h(""),p=h(),r=h([]);async function q(){var x,n;i.value="submitting";try{const a=await Es(m.requirementId,m.detailId);u("delete",a),i.value="create"}catch(a){i.value="error",p.value=((n=(x=a.response)==null?void 0:x.data)==null?void 0:n.message)||"Failed to update requirement detail: "+a,u("error",p.value)}}return de(async()=>{var x,n,a;i.value="loading";try{r.value=await c.fetchDepartmentWiseEmployees(),t.value=(x=(await Os(m.requirementId,m.detailId)).data)==null?void 0:x.detail}catch(f){p.value=((a=(n=f.response)==null?void 0:n.data)==null?void 0:a.message)||"Failed to fetch requirement detail"}finally{i.value=""}}),(x,n)=>{var a,f;return s(),o("div",Ms,[n[4]||(n[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:N(q,["prevent"]),class:"z-0"},[i.value!=="loading"?(s(),o(U,{key:0},[e("div",Ls,[n[1]||(n[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Ps,b((a=t.value)==null?void 0:a.title),1)]),e("div",Us,[n[2]||(n[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",Bs,b((f=t.value)==null?void 0:f.description),1)]),n[3]||(n[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(s(),o("div",Vs)),e("div",Fs,[p.value?(s(),o("div",Hs,b(p.value),1)):v("",!0),p.value?(s(),o("hr",zs)):v("",!0),e("div",Gs,[e("button",{type:"button",onClick:n[0]||(n[0]=N(k=>u("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:i.value=="loading"||i.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},b(i.value=="submitting"?"Deleting...":"Delete"),9,Ws)])])],32),i.value==="loading"||i.value==="submitting"?(s(),A(pe,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):v("",!0)])}}};const Qs={class:"sticky top-0 pt-4 bg-white z-10"},Ks={class:"mb-4"},Js={class:"mb-4"},Xs={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Zs={key:0,class:"mb-4 text-red-500 font-medium"},er={key:1,class:"mb-4"},tr={class:"flex items-center justify-between gap-4"},sr=["disabled"],rr={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(d,{emit:_}){const m=d,u=_,c=h(),t=h(null),i=h(""),p=h(),r=h({feedback:""});async function q(){var x,n;i.value="submitting";try{const a=await pt(m.requirementId,r.value.feedback);u("update",a),i.value="create"}catch(a){i.value="error",p.value=((n=(x=a.response)==null?void 0:x.data)==null?void 0:n.message)||"Failed to update requirement requirement",u("error",p.value)}}return de(async()=>{var x,n,a,f;i.value="loading";try{await fe(m.requirementId),t.value=(x=(await fe(m.requirementId)).data)==null?void 0:x.requirement,r.value={feedback:(n=t.value)==null?void 0:n.feedback}}catch(k){p.value=((f=(a=k.response)==null?void 0:a.data)==null?void 0:f.message)||"Failed to fetch requirement requirement"}finally{i.value=""}}),(x,n)=>{var a;return s(),o("div",{ref_key:"formContainerRef",ref:c,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Qs,[n[3]||(n[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),n[4]||(n[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:n[0]||(n[0]=N(f=>u("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:N(q,["prevent"]),class:"z-0"},[i.value!=="loading"?(s(),o(U,{key:0},[e("div",Ks,[n[5]||(n[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),y(le,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:R(()=>{var f;return[S(b((f=t.value)==null?void 0:f.title),1)]}),_:1})]),e("div",Js,[n[6]||(n[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),y(Je,{modelValue:r.value.feedback,"onUpdate:modelValue":n[1]||(n[1]=f=>r.value.feedback=f)},null,8,["modelValue"])])],64)):v("",!0),e("div",Xs,[p.value?(s(),o("div",Zs,b(p.value),1)):v("",!0),p.value?(s(),o("hr",er)):v("",!0),e("div",tr,[e("button",{type:"button",onClick:n[2]||(n[2]=N(f=>u("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:i.value=="loading"||i.value=="submitting",type:"submit",class:"btn-2"},b(i.value=="submitting"?"Saving...":(a=t.value)!=null&&a.feedback?"Update Feedback":"Add Feedback"),9,sr)])])],32),i.value==="loading"||i.value==="submitting"?(s(),A(pe,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):v("",!0)],512)}}},nr={class:"bg-white p-6 rounded-lg w-full w-full"},or={class:"flex items-center justify-between mb-4 border-b pb-2"},ar={class:"space-y-4"},ir={class:"space-y-2"},lr={class:"flex items-center gap-2"},dr={key:0,class:"ml-6 space-y-2 p-2 bg-gray-50 rounded-md"},ur={class:"flex items-center gap-2"},mr={class:"flex items-center gap-2"},cr={class:"flex items-center gap-2"},pr={class:"flex items-center gap-2"},br={class:"flex items-center gap-2"},vr={class:"mt-8 flex justify-end gap-3 border-t pt-4"},xr={__name:"RequirementPrintOptions",props:{initialOptions:{type:Object,default:()=>({withTasks:!0,taskOption:"list",withMessages:!0,withApprovals:!0,withAttachments:!0})}},emits:["close","print"],setup(d,{emit:_}){const m=d,u=_,c=te({...m.initialOptions});return(t,i)=>(s(),o("div",nr,[e("div",or,[i[10]||(i[10]=e("h3",{class:"text-xl font-bold"},"Print Options",-1)),e("button",{onClick:i[0]||(i[0]=p=>u("close")),class:"text-gray-500 hover:text-gray-700"},i[9]||(i[9]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("div",ar,[e("div",ir,[e("div",lr,[X(e("input",{type:"checkbox","onUpdate:modelValue":i[1]||(i[1]=p=>c.withTasks=p),id:"withTasks",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[me,c.withTasks]]),i[11]||(i[11]=e("label",{for:"withTasks",class:"font-semibold text-gray-700"},"Print with Tasks",-1))]),c.withTasks?(s(),o("div",dr,[e("div",ur,[X(e("input",{type:"radio","onUpdate:modelValue":i[2]||(i[2]=p=>c.taskOption=p),value:"list",id:"taskOptionList",class:"w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[Be,c.taskOption]]),i[12]||(i[12]=e("label",{for:"taskOptionList",class:"text-sm text-gray-600"},"Task list with count",-1))]),e("div",mr,[X(e("input",{type:"radio","onUpdate:modelValue":i[3]||(i[3]=p=>c.taskOption=p),value:"countOnly",id:"taskOptionCount",class:"w-4 h-4 text-indigo-600 border-gray-300 focus:ring-indigo-500"},null,512),[[Be,c.taskOption]]),i[13]||(i[13]=e("label",{for:"taskOptionCount",class:"text-sm text-gray-600"},"Only task count (completed/total)",-1))])])):v("",!0)]),e("div",cr,[X(e("input",{type:"checkbox","onUpdate:modelValue":i[4]||(i[4]=p=>c.withMessages=p),id:"withMessages",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[me,c.withMessages]]),i[14]||(i[14]=e("label",{for:"withMessages",class:"font-semibold text-gray-700"},"Print with message list",-1))]),e("div",pr,[X(e("input",{type:"checkbox","onUpdate:modelValue":i[5]||(i[5]=p=>c.withApprovals=p),id:"withApprovals",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[me,c.withApprovals]]),i[15]||(i[15]=e("label",{for:"withApprovals",class:"font-semibold text-gray-700"},"Print with Approval list",-1))]),e("div",br,[X(e("input",{type:"checkbox","onUpdate:modelValue":i[6]||(i[6]=p=>c.withAttachments=p),id:"withAttachments",class:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"},null,512),[[me,c.withAttachments]]),i[16]||(i[16]=e("label",{for:"withAttachments",class:"font-semibold text-gray-700"},"Print Attachments (Images on separate page)",-1))])]),e("div",vr,[e("button",{onClick:i[7]||(i[7]=p=>u("close")),class:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition"}," Cancel "),e("button",{onClick:i[8]||(i[8]=p=>u("print",c)),class:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition font-semibold"},i[17]||(i[17]=[e("i",{class:"fas fa-print mr-2"},null,-1),S(" Print ")]))])]))}},fr={class:"requirement-print-preview bg-white text-black p-8 font-serif leading-relaxed"},gr={class:"border-b-2 border-gray-800 pb-4 mb-6"},yr={class:"flex justify-between items-start"},_r={class:"text-sm text-gray-600 mt-1"},kr={class:"font-semibold"},hr={class:"text-right"},wr={class:"text-lg font-bold text-indigo-700"},$r={class:"grid grid-cols-2 gap-x-12 gap-y-4 mb-6 text-sm"},qr={class:"space-y-2"},Cr={class:"flex justify-between border-b border-gray-100 pb-1"},Tr={class:"font-medium text-right"},jr={class:"flex justify-between border-b border-gray-100 pb-1"},Sr={class:"font-medium text-right"},Rr={class:"flex justify-between border-b border-gray-100 pb-1"},Ar={class:"font-medium text-right"},Ir={class:"space-y-2"},Dr={class:"flex justify-between border-b border-gray-100 pb-1"},Nr={class:"flex justify-between border-b border-gray-100 pb-1"},Or={class:"font-medium text-right"},Er={class:"flex justify-between border-b border-gray-100 pb-1"},Mr={class:"font-medium text-right"},Lr={class:"mb-6 p-3 bg-gray-50 rounded border flex items-center gap-4"},Pr={key:0,class:"flex items-center gap-2"},Ur={class:"font-semibold"},Br={key:0,class:"text-xs text-gray-500"},Vr={key:1,class:"text-gray-400"},Fr={class:"mb-6"},Hr={class:"text-xl mb-2"},zr={class:"font-bold"},Gr={key:0,class:"print-description prose prose-sm max-w-none text-gray-800 p-0"},Wr={key:0,class:"mb-6 break-inside-avoid"},Yr={class:"flex justify-between items-center mb-4 border-b pb-2"},Qr={class:"font-semibold text-sm bg-gray-800 text-white px-3 py-1 rounded-full"},Kr={key:0,class:"overflow-hidden border rounded"},Jr={class:"w-full border-collapse text-sm"},Xr={class:"border p-2 text-center font-bold text-gray-400"},Zr={class:"border p-2"},en={class:"font-semibold"},tn=["innerHTML"],sn={class:"border p-2"},rn={key:0,class:"text-gray-400 text-xs italic"},nn={class:"border p-2 text-center"},on={key:0},an={key:1,class:"p-4 border rounded bg-gray-50 text-center italic text-gray-600"},ln={key:1,class:"mb-6"},dn={class:"space-y-4 break-before-page"},un={class:"flex items-center gap-2 mb-1"},mn={class:"font-bold text-sm"},cn={class:"text-xs text-gray-400"},pn={key:0,class:"text-sm text-gray-700"},bn={class:"mb-8 p-4 bg-blue-50/50 rounded-lg flex items-center justify-between border-l-4 border-blue-400"},vn={class:"flex items-center gap-4"},xn={class:"flex items-center gap-2"},fn={class:"font-bold text-gray-800"},gn={class:"text-right"},yn={class:"text-sm font-semibold"},_n={key:2,class:"mb-6"},kn={class:"mb-8 break-inside-avoid"},hn={class:"text-xs font-bold text-gray-700 text-center uppercase tracking-widest border-b border-dashed pb-1 mb-4"},wn={class:"grid grid-cols-2 gap-8"},$n={key:0,class:"w-full"},qn={class:"text-[10px] text-gray-500 uppercase font-bold mb-3"},Cn={key:0},Tn={key:0,class:"space-y-2"},jn={class:"flex flex-col items-center gap-2"},Sn={class:"relative inline-block"},Rn={class:"font-bold text-indigo-700"},An={key:0,class:"text-xs text-red-600 font-semibold italic"},In={key:1,class:"text-xs text-gray-600 italic"},Dn={key:2,class:"mt-1 text-[10px] text-red-600 font-bold px-2 py-0.5 rounded inline-block"},Nn={key:3,class:"mt-1 text-[10px] text-green-600 font-bold px-2 py-0.5 rounded inline-block"},On={key:4,class:"mt-1 text-[10px] text-yellow-600 font-bold px-2 py-0.5 rounded inline-block"},En={key:1,class:"h-12 flex items-center justify-center text-gray-300 italic text-xs"},Mn={key:0,class:"break-inside-avoid"},Ln={class:"text-xs font-bold text-center text-gray-700 uppercase tracking-widest border-b border-dashed pb-1 mb-4"},Pn={class:"grid grid-cols-2 gap-8"},Un={key:0,class:"w-full"},Bn={class:"text-[10px] text-gray-500 uppercase font-bold mb-3"},Vn={key:0,class:"space-y-2"},Fn={class:"flex flex-col items-center gap-2"},Hn={class:"relative inline-block"},zn={class:"font-bold text-indigo-700"},Gn={key:0,class:"text-xs text-red-600 font-semibold italic"},Wn={key:1,class:"text-xs text-gray-600 italic"},Yn={key:2,class:"mt-1 text-[10px] text-red-600 font-bold px-2 py-0.5 rounded inline-block"},Qn={key:3,class:"mt-1 text-[10px] text-green-600 font-bold px-2 py-0.5 rounded inline-block"},Kn={key:4,class:"mt-1 text-[10px] text-yellow-600 font-bold px-2 py-0.5 rounded inline-block"},Jn={key:1,class:"h-12 flex items-center justify-center text-gray-300 italic text-xs"},Xn={key:3,class:"break-before-page mt-12"},Zn={class:"grid grid-cols-1 gap-8"},eo={class:"text-xs text-gray-500 mb-2 font-mono"},to=["src"],so={__name:"RequirementPrintPreview",props:{requirement:{type:Object,required:!0},options:{type:Object,required:!0},comments:{type:Array,default:()=>[]}},setup(d){const _=d,m=F(()=>{var c;return(((c=_.requirement)==null?void 0:c.attachments)||[]).filter(t=>Ze(t))}),u=c=>{var a,f,k,w,T,I;const t=_.requirement,i={from_in_charge:!!(t!=null&&t.status&&(t!=null&&t.submission_date)),from_coordinator:!!(t!=null&&t.from_coordinator),to_in_charge:!!(t!=null&&t.to_incharge),to_coordinator:!!(t!=null&&t.to_coordinator)},p={from_in_charge:(a=t==null?void 0:t.from_department)==null?void 0:a.in_charge,from_coordinator:(f=t==null?void 0:t.from_department)==null?void 0:f.coordinator,to_in_charge:(k=t==null?void 0:t.to_department)==null?void 0:k.in_charge,to_coordinator:(w=t==null?void 0:t.to_department)==null?void 0:w.coordinator};let r=null,q=null,x="",n="";return c==="from_in_charge"&&(r=t==null?void 0:t.from_department,q=(T=t==null?void 0:t.from_department)==null?void 0:T.in_charge,x="In Charge",n=t==null?void 0:t.from_incharge_note),c==="from_coordinator"&&(r=t==null?void 0:t.from_department,q=t==null?void 0:t.from_coordinator,x="Coordinator",n=t==null?void 0:t.from_coordinator_note),c==="to_in_charge"&&(r=t==null?void 0:t.to_department,q=t==null?void 0:t.to_incharge,x="In Charge",n=t==null?void 0:t.to_incharge_note),c==="to_coordinator"&&(r=t==null?void 0:t.to_department,q=t==null?void 0:t.to_coordinator,x="Coordinator",n=t==null?void 0:t.to_coordinator_note),{department:r,approved:i[c],approval_user:q,is_rejected:(t==null?void 0:t.rejected_by_user_id)&&(t==null?void 0:t.rejected_by_user_id)===((I=p[c])==null?void 0:I.id),userType:x,approval_note:n}};return(c,t)=>{var i,p,r,q,x,n;return s(),o("div",fr,[e("div",gr,[e("div",yr,[e("div",null,[t[1]||(t[1]=e("h1",{class:"text-xl font-bold uppercase tracking-wider"},"Requirement Report",-1)),e("p",_r,[t[0]||(t[0]=S(" Generated on ")),e("span",kr,b(O(se)(new Date)),1)])]),e("div",hr,[e("div",wr,"#"+b(d.requirement.id),1),e("div",{class:B(["text-sm font-semibold uppercase px-2 py-0.5 rounded border inline-block mt-1",d.requirement.status==="approved"?"bg-green-100 border-green-400 text-green-800":d.requirement.status==="rejected"?"bg-red-100 border-red-400 text-red-800":"bg-yellow-100 border-yellow-400 text-yellow-800"])},[e("i",{class:B(["mr-1",d.requirement.status==="approved"?"fas fa-check-circle":d.requirement.status==="rejected"?"fas fa-times-circle":"fas fa-clock"])},null,2),S(" "+b(d.requirement.status||"PENDING"),1)],2)])])]),e("div",$r,[e("div",qr,[e("div",Cr,[t[2]||(t[2]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Website:",-1)),e("span",Tr,b((d.requirement.website_tags||[]).map(a=>a.name).join(", ")||"N/A"),1)]),e("div",jr,[t[3]||(t[3]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Submission Date:",-1)),e("span",Sr,b(d.requirement.submission_date?O(se)(d.requirement.submission_date):"N/A"),1)]),e("div",Rr,[t[4]||(t[4]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Better To Complete:",-1)),e("span",Ar,b(d.requirement.better_to_complete_on?O(et)(d.requirement.better_to_complete_on):"N/A"),1)])]),e("div",Ir,[e("div",Dr,[t[5]||(t[5]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"Priority:",-1)),e("span",{class:B(["font-bold uppercase",d.requirement.priority==="URGENT"?"text-red-600":d.requirement.priority==="IMPORTANT"?"text-orange-600":""])},b(d.requirement.priority||"NORMAL"),3)]),e("div",Nr,[t[6]||(t[6]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"From Dept:",-1)),e("span",Or,b((i=d.requirement.from_department)==null?void 0:i.name),1)]),e("div",Er,[t[7]||(t[7]=e("span",{class:"text-gray-500 font-semibold whitespace-nowrap ml-1"},"To Dept:",-1)),e("span",Mr,b((p=d.requirement.to_department)==null?void 0:p.name),1)])])]),e("div",Lr,[t[8]||(t[8]=e("span",{class:"text-gray-500 font-bold uppercase text-xs"},"Supervisor:",-1)),d.requirement.supervisor?(s(),o("div",Pr,[y(Z,{user:d.requirement.supervisor,size:"xsmall"},null,8,["user"]),e("span",Ur,b(d.requirement.supervisor.name),1),d.requirement.supervisor.designation?(s(),o("span",Br,"("+b(d.requirement.supervisor.designation)+")",1)):v("",!0)])):(s(),o("span",Vr,"Not Assigned"))]),e("div",Fr,[e("h2",Hr,[e("span",zr,b(d.requirement.title),1)]),d.requirement.description?(s(),o("div",Gr,[y(ce,{message:d.requirement.description},null,8,["message"])])):v("",!0)]),d.options.withTasks?(s(),o("div",Wr,[e("div",Yr,[t[9]||(t[9]=e("h3",{class:"text-lg font-bold uppercase"},"Tasks",-1)),e("span",Qr,b(d.requirement.completed_tasks_count)+" / "+b(d.requirement.tasks_count)+" Completed ",1)]),d.options.taskOption==="list"?(s(),o("div",Kr,[e("table",Jr,[t[12]||(t[12]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"border p-2 text-left w-12 text-gray-600"},"SL"),e("th",{class:"border p-2 text-left text-gray-600"},"Task Title"),e("th",{class:"border p-2 text-left text-gray-600 w-48"},"Assigned To"),e("th",{class:"border p-2 text-center text-gray-600 w-32"},"Status")])],-1)),e("tbody",null,[(s(!0),o(U,null,V(d.requirement.tasks,(a,f)=>{var k;return s(),o("tr",{key:a.id,class:"border-b hover:bg-gray-50"},[e("td",Xr,b(f+1),1),e("td",Zr,[e("div",en,b(a.title),1),a.description?(s(),o("div",{key:0,class:"text-xs text-gray-500 mt-1",innerHTML:a.description},null,8,tn)):v("",!0)]),e("td",sn,[(s(!0),o(U,null,V(a.users,w=>(s(),o("div",{key:w.id,class:"text-xs mb-1 last:mb-0 flex items-center gap-1"},[t[10]||(t[10]=e("span",{class:"w-1.5 h-1.5 bg-indigo-400 rounded-full"},null,-1)),S(" "+b(w.name),1)]))),128)),(k=a.users)!=null&&k.length?v("",!0):(s(),o("span",rn,"Unassigned"))]),e("td",nn,[e("span",{class:B(["px-2 py-0.5 rounded-full text-[10px] uppercase font-bold",a.status==="COMPLETED"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"])},b(a.status),3)])])}),128)),(r=d.requirement.tasks)!=null&&r.length?v("",!0):(s(),o("tr",on,t[11]||(t[11]=[e("td",{colspan:"4",class:"p-8 text-center text-gray-400 italic"}," No tasks found for this requirement. ",-1)])))])])])):(s(),o("div",an," Task list hidden based on print options. (Summary: "+b(d.requirement.completed_tasks_count)+" / "+b(d.requirement.tasks_count)+" tasks completed) ",1))])):v("",!0),d.options.withMessages&&d.comments.length?(s(),o("div",ln,[t[13]||(t[13]=e("h3",{class:"text-lg font-bold uppercase mb-4 border-b pb-2"},"Message History",-1)),e("div",dn,[(s(!0),o(U,null,V(d.comments,a=>{var f;return s(),o("div",{key:a.id,class:"border-l-4 border-gray-200 pl-4 py-1"},[e("div",un,[y(Z,{user:a.user,size:"xsmall"},null,8,["user"]),e("span",mn,b((f=a.user)==null?void 0:f.name),1),e("span",cn,b(O(se)(a.created_at)),1)]),a.message?(s(),o("div",pn,[y(ce,{message:a.message},null,8,["message"])])):v("",!0)])}),128))])])):v("",!0),e("div",bn,[e("div",vn,[t[14]||(t[14]=e("span",{class:"text-xs font-bold text-blue-700 uppercase tracking-widest"},"Submitted By:",-1)),e("div",xn,[y(Z,{user:d.requirement.created_by,size:"xsmall"},null,8,["user"]),e("span",fn,b((q=d.requirement.created_by)==null?void 0:q.name),1)])]),e("div",gn,[t[15]||(t[15]=e("p",{class:"text-[10px] text-gray-500 font-bold uppercase"},"Submission Date",-1)),e("p",yn,b(O(se)(d.requirement.created_at)),1)])]),d.options.withApprovals?(s(),o("div",_n,[t[24]||(t[24]=e("h3",{class:"text-lg font-bold uppercase mb-6 border-b pb-2"},"Approvals",-1)),e("div",kn,[e("h4",hn,b((x=d.requirement.from_department)==null?void 0:x.name)+" Approvals ",1),e("div",wn,[(s(),o(U,null,V(["from_in_charge","from_coordinator"],a=>e("div",{key:a,class:"approval-box p-4 flex flex-col items-center text-center"},[u(a)?(s(),o("div",$n,[e("p",qn,[S(b(u(a).userType)+" ",1),a==="from_in_charge"?(s(),o("span",Cn,"(Dept. Submitter)")):v("",!0)]),u(a).approval_user?(s(),o("div",Tn,[e("div",jn,[y(Z,{user:u(a).approval_user,size:"small"},null,8,["user"]),e("div",Sn,[e("span",Rn,b(u(a).approval_user.name),1),t[16]||(t[16]=e("hr",{class:"border-t-2 border-indigo-100 mt-0.5"},null,-1))])]),u(a).is_rejected&&d.requirement.rejection_reason?(s(),o("p",An,b(d.requirement.rejection_reason),1)):u(a).approval_note?(s(),o("p",In,b(u(a).approval_note),1)):v("",!0),u(a).is_rejected?(s(),o("div",Dn,t[17]||(t[17]=[e("i",{class:"fas fa-times-circle mr-1"},null,-1),S(" REJECTED ")]))):u(a).approved?(s(),o("div",Nn,[t[18]||(t[18]=e("i",{class:"fas fa-check-circle mr-1"},null,-1)),S(" "+b(a==="from_in_charge"?"SUBMITTED":"APPROVED"),1)])):(s(),o("div",On,t[19]||(t[19]=[e("i",{class:"fas fa-clock mr-1"},null,-1),S(" PENDING ")])))])):(s(),o("div",En," N/A "))])):v("",!0)])),64))])]),d.requirement.from_department_id!==d.requirement.to_department_id?(s(),o("div",Mn,[e("h4",Ln,b((n=d.requirement.to_department)==null?void 0:n.name)+" Approvals ",1),e("div",Pn,[(s(),o(U,null,V(["to_in_charge","to_coordinator"],a=>e("div",{key:a,class:"approval-box p-4 flex flex-col items-center text-center"},[u(a)?(s(),o("div",Un,[e("p",Bn,b(u(a).userType),1),u(a).approval_user?(s(),o("div",Vn,[e("div",Fn,[y(Z,{user:u(a).approval_user,size:"small"},null,8,["user"]),e("div",Hn,[e("span",zn,b(u(a).approval_user.name),1),t[20]||(t[20]=e("hr",{class:"border-t-2 border-indigo-100 mt-0.5"},null,-1))])]),u(a).is_rejected&&d.requirement.rejection_reason?(s(),o("p",Gn,b(d.requirement.rejection_reason),1)):u(a).approval_note?(s(),o("p",Wn,b(u(a).approval_note),1)):v("",!0),u(a).is_rejected?(s(),o("div",Yn,t[21]||(t[21]=[e("i",{class:"fas fa-times-circle mr-1"},null,-1),S(" REJECTED ")]))):u(a).approved?(s(),o("div",Qn,t[22]||(t[22]=[e("i",{class:"fas fa-check-circle mr-1"},null,-1),S(" APPROVED ")]))):(s(),o("div",Kn,t[23]||(t[23]=[e("i",{class:"fas fa-clock mr-1"},null,-1),S(" PENDING ")])))])):(s(),o("div",Jn," N/A "))])):v("",!0)])),64))])])):v("",!0)])):v("",!0),d.options.withAttachments&&m.value.length?(s(),o("div",Xn,[t[25]||(t[25]=e("h3",{class:"text-lg font-bold uppercase mb-6 border-b pb-2"},"Image Attachments",-1)),e("div",Zn,[(s(!0),o(U,null,V(m.value,(a,f)=>(s(),o("div",{key:f,class:"break-inside-avoid border p-4 rounded bg-gray-50 shadow-sm"},[e("p",eo,"Attachment #"+b(f+1),1),e("img",{src:O(xe)(a),class:"max-w-full h-auto rounded border shadow-inner mx-auto",alt:"Requirement Attachment"},null,8,to)]))),128))])])):v("",!0)])}}},ro=ze(so,[["__scopeId","data-v-7c239bbe"]]),no={class:"flex justify-center items-center"},oo={class:"modal-card"},ao={key:0},io=["required"],lo={class:"flex"},uo={class:"flex justify-between gap-2 mt-4"},mo=["disabled"],co=["disabled"],po={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0},requirementNote:{type:Boolean,default:!0}},emits:["loading","success","error"],setup(d,{emit:_}){const m=d,u=_,c=h(255),t=F(()=>c.value-x.value.length),i=st(),p=h(null),r=h(null),q=h(null),x=h(""),n=h(!1),a=F(()=>q.value!==null);function f(D){q.value=D,x.value="",I()}function k(){q.value=null,x.value=""}async function w(){var D,j;if(q.value==="reject"&&!x.value)return i.error("Rejection Reason is required!");if(typeof m.onSubmit=="function")return m.onSubmit({note:x.value,action:q.value});u("loading",!0),n.value=!0;try{await bt(m.requirementId,{note:x.value}),u("success"),k()}catch(L){return u("error",L),i.error(((j=(D=L==null?void 0:L.response)==null?void 0:D.data)==null?void 0:j.message)||"Submission failed!")}finally{u("loading",!1),n.value=!1}}function T(D){var j,L;a.value&&(D.key==="ArrowLeft"?(j=r.value)==null||j.focus():D.key==="ArrowRight"&&((L=p.value)==null||L.focus()))}function I(){ve(()=>{var D;(D=p.value)==null||D.focus()})}return de(()=>{window.addEventListener("keydown",T)}),Ke(()=>{window.removeEventListener("keydown",T)}),(D,j)=>(s(),o("div",null,[e("div",no,[e("button",{onClick:j[0]||(j[0]=L=>f("accept"))},j[3]||(j[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),a.value?(s(),o("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:N(k,["self"])},[e("div",oo,[j[4]||(j[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),d.requirementNote?(s(),o("div",ao,[X(e("textarea",{"onUpdate:modelValue":j[1]||(j[1]=L=>x.value=L),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:q.value==="reject",onInput:j[2]||(j[2]=L=>x.value.length>c.value?x.value=x.value.slice(0,c.value):null)},null,40,io),[[We,x.value]]),e("div",lo,[e("div",{class:B(["ml-auto inline-block text-sm text-gray-500",x.value.length>=c.value?"text-red-500":""])}," left "+b(t.value)+"/"+b(c.value)+" words ",3)])])):v("",!0),e("div",uo,[e("button",{ref_key:"cancelBtnRef",ref:r,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:k,disabled:n.value}," Cancel ",8,mo),e("button",{ref_key:"confirmBtnRef",ref:p,class:B(["focus:ring-2 ring-offset-2 disabled:opacity-30",q.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:w,disabled:n.value}," Confirm Submission ",10,co)])])])):v("",!0)]))}},bo={class:"flex items-center gap-6 justify-center my-16"},vo={key:0,class:"border rounded-md"},xo={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(d,{emit:_}){const m=d,u=_,c=yt(),t=h(""),i=h(null),p=h(""),r=h(!1);async function q(){await c.setTaskRequirement(p.value,m.requirement.id),u("assignTask")}return(x,n)=>(s(),o("div",{class:B(["text-left p-4",[t.value&&!i.value?"min-h-[400px]":""]])},[e("div",bo,[e("button",{onClick:n[0]||(n[0]=N(a=>u("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),n[5]||(n[5]=e("span",null,"or",-1)),e("button",{class:B({"btn-3":t.value!=="direct-assign","btn-2":t.value=="direct-assign"}),onClick:n[1]||(n[1]=N(()=>t.value="direct-assign",["prevent"]))}," Assign Task ",2)]),t.value&&!i.value?(s(),o("div",vo,[e("form",{onSubmit:N(q,["prevent"]),class:"p-4 flex items-end"},[y(_t,{class:"flex-grow mr-4 h-12",taskId:p.value,"onUpdate:taskId":n[2]||(n[2]=a=>p.value=a),show:r.value,"onUpdate:show":n[3]||(n[3]=a=>r.value=a),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":d.fromDepartmentId},filterTasks:a=>!a.requirement_id,onAddNewTaskClick:n[4]||(n[4]=a=>u("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),n[6]||(n[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):v("",!0)],2))}},fo={class:"flex flex-col items-center gax-x-1 justify-end"},go={key:0},yo={key:1},_o={class:"text-sm text-gray-600 whitespace-normal w-64"},ko={class:"text-gray-900 font-semibold text-sm md:text-base"},ho={class:"ml-2"},wo={key:0,class:"text-red-700 text-sm"},$o={key:1,class:"text-green-600 ml-2"},qo={key:2,class:"ml-2 text-yellow-700"},He={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(d,{emit:_}){const m=d,u=_,c=Qe(),t=F(()=>{var x,n,a,f,k;return{from_in_charge:!!((x=m.requirement)!=null&&x.status&&((n=m.requirement)!=null&&n.submission_date)),from_coordinator:!!((a=m.requirement)!=null&&a.from_coordinator),to_in_charge:!!((f=m.requirement)!=null&&f.to_incharge),to_coordinator:!!((k=m.requirement)!=null&&k.to_coordinator)}}),i=F(()=>{var x,n,a,f,k,w,T,I;return{from_in_charge:(n=(x=m.requirement)==null?void 0:x.from_department)==null?void 0:n.in_charge,from_coordinator:(f=(a=m.requirement)==null?void 0:a.from_department)==null?void 0:f.coordinator,to_in_charge:(w=(k=m.requirement)==null?void 0:k.to_department)==null?void 0:w.in_charge,to_coordinator:(I=(T=m.requirement)==null?void 0:T.to_department)==null?void 0:I.coordinator}}),p=F(()=>{var f;const x=Object.keys(t.value),n=x.indexOf(m.approvalType);let a=!0;for(let k=n-1;k>=0;k--){const w=x[k];a=a&&(i.value[w]?(f=t.value)==null?void 0:f[w]:!0)}return a}),r=F(()=>{var w,T,I,D,j,L,H,ee,E,$,M,K,g,Q,G,W;let x=null,n=null,a="",f="";m.approvalType==="from_in_charge"&&(x=(w=m.requirement)==null?void 0:w.from_department,n=(I=(T=m.requirement)==null?void 0:T.from_department)==null?void 0:I.in_charge,a="In Charge",f=(D=m.requirement)==null?void 0:D.from_incharge_note),m.approvalType==="from_coordinator"&&(x=(j=m.requirement)==null?void 0:j.from_department,n=(L=m.requirement)==null?void 0:L.from_coordinator,a="Coordinator",f=(H=m.requirement)==null?void 0:H.from_coordinator_note),m.approvalType==="to_in_charge"&&(x=(ee=m.requirement)==null?void 0:ee.to_department,n=(E=m.requirement)==null?void 0:E.to_in_charge,a="In Charge",f=($=m.requirement)==null?void 0:$.to_incharge_note),m.approvalType==="to_coordinator"&&(x=(M=m.requirement)==null?void 0:M.to_department,n=(K=m.requirement)==null?void 0:K.to_coordinator,a="Coordinator",f=(g=m.requirement)==null?void 0:g.to_coordinator_note);const k=(Q=i.value)==null?void 0:Q[m.approvalType];return{department:x,department_user:k,approved:(G=t.value)==null?void 0:G[m.approvalType],approval_user:n,is_rejected:((W=m.requirement)==null?void 0:W.rejected_by_user_id)==(k==null?void 0:k.id),userType:a,approval_note:f}});function q(){u("updateApproval")}return(x,n)=>{var a,f,k,w,T,I;return s(),o("div",fo,[r.value.department_user?(s(),o("div",go,[y(ie,{user:r.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(s(),o("div",yo,n[0]||(n[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",_o,[r.value.is_rejected?(s(),A(le,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:R(()=>[S(b(d.requirement.rejection_reason),1)]),_:1})):(s(),A(le,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:R(()=>[S(b(r.value.approval_note),1)]),_:1}))]),e("div",null,[!r.value.is_rejected&&!r.value.approved&&p.value&&((a=O(c).user)==null?void 0:a.id)==((k=(f=r.value)==null?void 0:f.department_user)==null?void 0:k.id)?(s(),A(wt,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(w=m.requirement)==null?void 0:w.id,onSuccess:q,variant:1},null,8,["applicationId"])):v("",!0)]),n[2]||(n[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",ko,[e("span",null,b(((T=r.value.department)==null?void 0:T.short_name)||((I=r.value.department)==null?void 0:I.name)),1),e("span",ho,b(r.value.userType),1),r.value.department_user?(s(),o(U,{key:0},[r.value.is_rejected?(s(),o("span",wo," (Rejected)")):r.value.approved?(s(),o("span",$o,"(✔)")):(s(),o("span",qo,n[1]||(n[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):v("",!0)])])}}},Co={class:"container mx-auto print:p-0 w-full print:max-w-full"},To={class:"border-b px-3 py-1 bg-gray-50 flex items-center justify-between rounded-t-md"},jo={key:0,class:"p-3 max-h-[50vh] overflow-auto"},So={class:"border table-auto w-full"},Ro={class:"border-y px-4 py-2 text-right"},Ao={class:"border-y pr-4 py-2 whitespace-nowrap"},Io={class:"border-y px-4 py-2"},Do={class:"line-clamp-2 text-sm text-amber-950"},No={class:"border-y px-4 py-2 text-center"},Oo={class:"print:hidden relative min-h-[50vh] mx-4"},Eo={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},Mo={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},Lo={class:"text-center text-xl font-bold mb-2 flex items-center justify-between"},Po={class:"flex items-center"},Uo={class:"mb-8"},Bo={class:"text-lg font-semibold mb-2"},Vo={class:"flex gap-4 items-center text-gray-500"},Fo={class:"text-sm"},Ho={key:0,class:"flex items-center gap-1"},zo={key:0,class:"mb-5"},Go={class:"mb-8"},Wo={class:"font-semibold text-lg px-2"},Yo={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},Qo={class:"w-full border-collapse"},Ko={key:0},Jo={class:"mb-8"};const Xo={key:2,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Zo={class:"flex flex-col items-end"},ea={key:3,class:"mt-6 mb-8 break-before-avoid-page"},ta={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},sa={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},ra={class:"bg-white shadow rounded-lg space-y-4 p-4 mb-4"},na={class:"border col-span-3 p-3 rounded-md"},oa={class:"flex items-center gap-2 mb-4"},aa={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},ia={class:"flex items-center gap-2 mb-4"},la={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},da={class:"font-bold print:text-gray-900"},ua={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},ma={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},ca={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},pa={class:"print:text-gray-900 text-sm text-right"},ba={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},va={class:"print:text-gray-900 text-sm text-right"},xa={class:"flex justify-between items-center mb-4"},fa={class:"mb-4"},ga={class:"flex justify-between items-center"},ya={key:1,class:"text-red-600"},_a={key:0,class:"mb-2"},ka={class:"flex justify-between items-center"},ha={key:1,class:"mb-4 text-red-700 text-sm flex justify-between"},wa={key:2,class:"print:hidden flex flex-wrap gap-2 items-center justify-between w-full text-sm"},$a={class:"flex gap-2"},ii={__name:"RequirementShow",setup(d){const _=rt(),m=nt(),u=h(""),c=Qe(),t=Xe(),i=h(),p=h(!1),r=h(null),q=te({detail:null,open:!1}),x=te({detail:null,open:!1}),n=te({detail:null,open:!1}),a=h(!1),f=h(!1),k=h({withTasks:!0,taskOption:"list",withMessages:!0,withApprovals:!0,withAttachments:!0}),w=()=>a.value=!0,T=()=>a.value=!1,I=()=>{f.value=!0},D=async P=>{k.value=P,f.value=!1,P.withMessages&&await t.fetchComments({commentable_type:"requirement",commentable_id:r.value.id}),a.value=!0,await ve(),window.print()},j=h(),L=h(""),H=h({isOpen:!1,taskId:null});de(async()=>{await E(),window.addEventListener("beforeprint",w),window.addEventListener("afterprint",T),window.addEventListener("resize",ee),await ve(),ht(i.value,()=>{})});function ee(){}Ke(()=>{window.removeEventListener("beforeprint",w),window.removeEventListener("afterprint",T),window.removeEventListener("resize",ee)});async function E(){u.value="loading";const P=(await fe(_.params.id)).data;r.value=P==null?void 0:P.requirement,L.value=P==null?void 0:P.user_department_position,u.value=""}function $(){var P,l,ue,ne,oe,ae,ge,ye,_e;if(c.user.role!=="super_admin"&&((P=c.user)==null?void 0:P.id)!==((ue=(l=r.value)==null?void 0:l.to_department)==null?void 0:ue.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(oe=(ne=r.value)==null?void 0:ne.to_department)==null?void 0:oe.name}'s In charge can create or assign.`);console.log({requirement:r}),g.modalShown=!0,g.from_department_id=r.value.from_department_id,g.to_department_id=r.value.to_department_id,g.taskDefaultValues={title:"",description:"",from_department_id:r.value.from_department_id,to_department_id:r.value.to_department_id,is_important:((ae=r.value)==null?void 0:ae.priority)=="IMPORTANT",is_urgent:((ge=r.value)==null?void 0:ge.priority)=="URGENT",supervisor_ids:(ye=r.value)!=null&&ye.supervisor_id?[(_e=r.value)==null?void 0:_e.supervisor_id]:[]},g.requirement=r.value}function M(P){q.open=!0,q.detail=P}function K(P){n.open=!0,n.detail=P}const g=te({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function Q(){j.value=null,g.modalShown=!1,await E()}async function G(){g.modalShown=!1,g.requirement=null,g.creating=!1}const W=h({open:!1});return(P,l)=>{var ne,oe,ae,ke,he,we,$e,qe,Ce,Te,je,Se,Re,Ae,Ie,De,Ne,Oe,Ee,Me,Le,Pe;const ue=Ge("RouterLink");return s(),o("div",Co,[x.open?(s(),A(Y,{key:0},{default:R(()=>{var C;return[y(rr,{requirementId:r.value.id,detailId:(C=x.requirement.value)==null?void 0:C.id,onCloseClick:l[0]||(l[0]=J=>x.open=!1),onUpdate:l[1]||(l[1]=async()=>{x.open=!1,await E()})},null,8,["requirementId","detailId"])]}),_:1})):v("",!0),n.open?(s(),A(Y,{key:1},{default:R(()=>{var C;return[y(Ys,{requirementId:r.value.id,detailId:(C=n.requirement.value)==null?void 0:C.id,onCloseClick:l[2]||(l[2]=J=>n.open=!1),onDelete:l[3]||(l[3]=async()=>{n.open=!1,await E()})},null,8,["requirementId","detailId"])]}),_:1})):v("",!0),g.modalShown?(s(),A(Y,{key:2,class:"*:relative"},{default:R(()=>{var C,J;return[e("button",{onClick:N(G,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},l[21]||(l[21]=[e("i",{class:"fas fa-times-circle"},null,-1)])),g!=null&&g.creating?v("",!0):(s(),A(xo,{key:0,"from-department-id":(C=r.value)==null?void 0:C.from_department_id,requirement:g==null?void 0:g.requirement,onCancelClick:G,onAddNewTaskClick:l[4]||(l[4]=()=>{g.modalShown=!0,g.creating=!0}),onAssignTask:Q},null,8,["from-department-id","requirement"])),g!=null&&g.creating?(s(),A(ot,{key:1,requirementDetailId:(J=g==null?void 0:g.requirement.value)==null?void 0:J.id,requirementId:r.value.id,onClose:G,onTaskCreated:Q,defaultValues:g.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):v("",!0)]}),_:1})):v("",!0),j.value?(s(),A(Y,{key:3},{default:R(()=>[y(kt,{taskId:j.value,onClose:l[5]||(l[5]=C=>j.value=null),onUpdated:Q},null,8,["taskId"])]),_:1})):v("",!0),H.value.isOpen?(s(),A(Y,{key:4,class:"*:max-w-4xl"},{default:R(()=>[y(gt,{taskId:H.value.taskId,onCancelClick:l[6]||(l[6]=()=>{H.value.isOpen=!1,H.value.taskId=0}),onSuccess:l[7]||(l[7]=()=>{H.value.isOpen=!1,H.value.taskId=0,u.value="loading",E()})},null,8,["taskId"])]),_:1})):v("",!0),W.value.open?(s(),A(Y,{key:5},{default:R(()=>[y(Ns,{requirement:r.value,onClickCancel:l[8]||(l[8]=C=>W.value.open=!1),onUpdateStatus:l[9]||(l[9]=()=>{E(),W.value.open=!1})},null,8,["requirement"])]),_:1})):v("",!0),f.value?(s(),A(Y,{key:6},{default:R(()=>[y(xr,{initialOptions:k.value,onClose:l[10]||(l[10]=C=>f.value=!1),onPrint:D},null,8,["initialOptions"])]),_:1})):v("",!0),p.value?(s(),A(Y,{key:7},{default:R(()=>{var C,J,re,Ue;return[e("div",To,[l[23]||(l[23]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon size-8",onClick:l[11]||(l[11]=N(z=>p.value=!1,["prevent"]))},l[22]||(l[22]=[e("i",{class:"fas fa-times"},null,-1)]))]),(C=r.value)!=null&&C.closing_history&&((re=(J=r.value)==null?void 0:J.closing_history)!=null&&re.length)?(s(),o("div",jo,[e("table",So,[l[24]||(l[24]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-right"},"Close/Open"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status")])],-1)),e("tbody",null,[(s(!0),o(U,null,V(((Ue=r.value)==null?void 0:Ue.closing_history)||[],z=>(s(),o("tr",{key:z.at,class:"text-sm"},[e("td",Ro,b(z==null?void 0:z.type),1),e("td",Ao,b(z.at?O(se)(z.at):""),1),e("td",Io,[e("div",Do,b(z==null?void 0:z.closing_note),1)]),e("td",No,b(z==null?void 0:z.status),1)]))),128))])])])):v("",!0)]}),_:1})):v("",!0),e("div",Oo,[r.value?(s(),o("div",Eo,[e("div",Mo,[e("div",Lo,[e("div",Po,[e("button",{class:"btn-3 h-8 px-4",onClick:l[12]||(l[12]=N(()=>O(m).back(),["prevent"]))},"Back"),l[25]||(l[25]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),e("button",{class:"btn-indigo-light text-xs font-bold btn-3 h-8 px-4",onClick:N(I,["prevent"])},l[26]||(l[26]=[e("i",{class:"fas fa-print mr-1"},null,-1),S(" PRINT ")]))]),l[41]||(l[41]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",Uo,[e("div",null,[e("div",Bo,[y(le,{"line-clamp":"3",class:"mb-2"},{default:R(()=>[S(b(r.value.title),1)]),btnText:R(({lineClampClass:C})=>[S(b(C?"More":"Less"),1)]),_:1}),e("div",Vo,[e("div",Fo,[l[27]||(l[27]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),S(" "+b(O(se)(r.value.created_at)),1)]),r.value.created_by?(s(),o("div",Ho,[l[28]||(l[28]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),y(ie,{"show-details-on-avatar-hover":O(c).isAdminMood,"avatar-size":"xsmall",user:r.value.created_by,class:"border-sky-300"},null,8,["show-details-on-avatar-hover","user"])])):v("",!0)])]),r.value.description?(s(),o("div",zo,[l[29]||(l[29]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),y(le,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:R(()=>[y(ce,{message:r.value.description},null,8,["message"])]),_:1})])):v("",!0)])]),e("div",Go,[y(be,{class:"mb-4"},{default:R(()=>[e("h2",Wo,[l[30]||(l[30]=e("span",null,"Task List ",-1)),r.value.status=="approved"?(s(),o("span",{key:0,class:B(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":r.value.tasks_count>0&&r.value.completed_tasks_count==r.value.tasks_count,"text-red-700 font-semibold":r.value.tasks_count==0||r.value.completed_tasks_count!=r.value.tasks_count}]])}," ("+b(r.value.completed_tasks_count)+"/"+b(r.value.tasks_count)+" task(s) done) ",3)):v("",!0)])]),_:1}),e("div",Yo,[e("table",Qo,[l[32]||(l[32]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[u.value!="loading"&&((oe=(ne=r.value)==null?void 0:ne.tasks)==null?void 0:oe.length)===0?(s(),o("tr",Ko,l[31]||(l[31]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(s(!0),o(U,{key:1},V(((ae=r.value)==null?void 0:ae.tasks)||[],(C,J)=>(s(),A(dt,{key:C.id,task:C,indexing:J+1,class:"*:py-3 *:border-b-0",onEditClick:l[13]||(l[13]=re=>j.value=re),onEmployeeAssignClick:l[14]||(l[14]=re=>{H.value.isOpen=!0,H.value.taskId=re})},null,8,["task","indexing"]))),128))])])])]),e("div",Jo,[y(be,{class:"mb-4"},{default:R(()=>l[33]||(l[33]=[e("h2",{class:"font-semibold text-lg px-2"},"Comments",-1)])),_:1,__:[33]}),y(Jt,{"commentable-type":"requirement","commentable-id":r.value.id,"current-user":O(c).user},null,8,["commentable-id","current-user"])]),v("",!0),(r.value,v("",!0)),u.value!="loading"&&!((ke=r.value)!=null&&ke.submission_date)?(s(),o("div",Xo,[e("div",Zo,[y(po,{"requirement-id":(he=r.value)==null?void 0:he.id,onSuccess:E,"requirement-note":L.value=="in_charge"},{heading:R(()=>l[37]||(l[37]=[S(" Requirement Submission ")])),acceptButtonLabel:R(()=>l[38]||(l[38]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),S("Submit Requirement ")],-1)])),submitButtonLabel:R(()=>l[39]||(l[39]=[S(" Submit Requirement ")])),_:1},8,["requirement-id","requirement-note"])])])):v("",!0),(we=r.value)!=null&&we.submission_date?(s(),o("div",ea,[y(be,null,{default:R(()=>l[40]||(l[40]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[40]}),e("div",ta,[(s(),o(U,null,V(["from_in_charge","from_coordinator"],C=>y(He,{class:"pt-12",key:C,requirement:r.value,"approval-type":C,onUpdateApproval:l[16]||(l[16]=()=>E())},null,8,["requirement","approval-type"])),64))]),(($e=r.value)==null?void 0:$e.from_department_id)!==((qe=r.value)==null?void 0:qe.to_department_id)?(s(),o("div",sa,[(s(),o(U,null,V(["to_in_charge","to_coordinator"],C=>y(He,{class:"pt-12",key:C,requirement:r.value,"approval-type":C,onUpdateApproval:l[17]||(l[17]=()=>E())},null,8,["requirement","approval-type"])),64))])):v("",!0)])):v("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:i},[e("div",ra,[e("div",na,[e("div",null,[e("div",oa,[l[42]||(l[42]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),y(Fe,{department:(Ce=r.value)==null?void 0:Ce.from_department,"short-name":!0},null,8,["department"])]),l[43]||(l[43]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",aa,[(Te=r.value)!=null&&Te.supervisor?(s(),A(ie,{key:0,"show-details-on-avatar-hover":O(c).isAdminMood,user:(je=r.value)==null?void 0:je.supervisor},null,8,["show-details-on-avatar-hover","user"])):v("",!0)])]),l[45]||(l[45]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",ia,[l[44]||(l[44]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),y(Fe,{department:(Se=r.value)==null?void 0:Se.to_department,"short-name":!0},null,8,["department"])])])]),e("div",la,[l[46]||(l[46]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",da,b((Re=r.value)==null?void 0:Re.id),1)]),((Ie=(Ae=r.value)==null?void 0:Ae.website_tags)==null?void 0:Ie.length)>0?(s(),o("div",ua,[l[47]||(l[47]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",ma,[(s(!0),o(U,null,V(((De=r.value)==null?void 0:De.website_tags)||[],C=>(s(),o("div",{key:C.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},b(C.name),1))),128))])])):v("",!0),(Ne=r.value)!=null&&Ne.submission_date?(s(),o("div",ca,[l[48]||(l[48]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",pa,b(O(se)((Oe=r.value)==null?void 0:Oe.submission_date)),1)])):v("",!0),(Ee=r.value)!=null&&Ee.better_to_complete_on?(s(),o("div",ba,[l[49]||(l[49]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",va,b(O(et)((Me=r.value)==null?void 0:Me.better_to_complete_on,{weekDay:"long"})),1)])):v("",!0),e("div",null,[e("div",xa,[l[50]||(l[50]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:B(["font-semibold text-sm",{"text-yellow-600 ":r.value.priority=="IMPORTANT","text-red-700 ":r.value.priority=="URGENT"}])},b(r.value.priority||"NORMAL"),3)])]),e("div",fa,[e("div",ga,[l[51]||(l[51]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),r.value.status?(s(),o("span",{key:0,class:B(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":r.value.status!="approved","bg-green-300 text-green-700 border-green-400":r.value.status=="approved"}])},b(String(r.value.status).toUpperCase()),3)):(s(),o("span",ya,"..."))])]),r.value.rejected_by?(s(),o("div",_a,[e("div",ka,[l[52]||(l[52]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),y(ie,{user:r.value.rejected_by},null,8,["user"])])])):v("",!0),r.value.rejection_reason?(s(),o("div",ha,[l[53]||(l[53]=e("p",{class:"text-gray-600 mb-1"},"Reason:",-1)),e("p",null,b(r.value.rejection_reason),1)])):v("",!0),l[56]||(l[56]=e("hr",{class:"mb-3"},null,-1)),(Le=r.value)!=null&&Le.closed_at?v("",!0):(s(),o("div",wa,[e("div",$a,[r.value.status=="approved"?(s(),o("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:N($,["prevent"])},l[54]||(l[54]=[e("i",{class:"fas fa-plus text-sm"},null,-1),S(" Add/Assign Task ")]))):v("",!0)]),y(ue,{class:"btn-2 h-8",to:`/requirements/edit/${(Pe=r.value)==null?void 0:Pe.id}`},{default:R(()=>l[55]||(l[55]=[S(" Edit ")])),_:1,__:[55]},8,["to"])]))])]),y(hs,{requirement:r.value,onReOpenClick:l[18]||(l[18]=C=>W.value.open=!0),class:"mb-4 card-bg bg-white",onCloseClick:l[19]||(l[19]=C=>W.value.open=!0),onShowHistoryClick:l[20]||(l[20]=C=>p.value=!p.value)},null,8,["requirement"]),y(us,{requirement:r.value,class:"mb-4"},null,8,["requirement"]),y(at,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3",ref:"shareComponent"},null,512)],512)])):v("",!0),u.value==="loading"?(s(),A(pe,{key:1,class:"absolute inset-0 bg-opacity-90"})):v("",!0)]),r.value&&a.value?(s(),A(ro,{key:8,class:"hidden print:block",requirement:r.value,options:k.value,comments:O(t).comments},null,8,["requirement","options","comments"])):v("",!0)])}}};export{ii as default};
