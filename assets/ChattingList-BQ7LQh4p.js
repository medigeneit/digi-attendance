import{C as oe,r as h,x as k,D as B,d as P,c as i,g as S,k as y,o,a as t,F as U,y as H,q as A,j as z,t as j,A as R,e as G,n as C,h as K,v as W,_ as Y,u as X,w as Z,f as V,l as re,E as le,G as F,m as ie,i as ee,b as de}from"./index-CJO_Ci9q.js";import{u as ue}from"./company-DxhE61Tb.js";import{u as ce}from"./department-7x2ye5i5.js";import{u as ve}from"./user-B5yQdw1d.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D=oe("chat",()=>{const r=h(!1),e=h(null),l=h(!1),n=h(!1),a=h(!1),d=h([]),p=h({}),v=h(null),m=h([]),b=h(""),g=k(()=>{var _,u;return((_=d.value)==null?void 0:_.length)===0?{}:(u=d.value)==null?void 0:u.find(c=>parseInt(c.id)===parseInt(v.value))}),x=k(()=>{const _=d.value||[];if(_.length===0)return[];const u=(b.value||"").toLowerCase().trim(),c=u?_.filter(s=>((s==null?void 0:s.title)||"").toLowerCase().includes(u)):_.slice();return c.sort((s,w)=>{const T=Number.isFinite(+(s==null?void 0:s.sort_by))?+s.sort_by:Number.NEGATIVE_INFINITY,N=Number.isFinite(+(w==null?void 0:w.sort_by))?+w.sort_by:Number.NEGATIVE_INFINITY;return T===N?((s==null?void 0:s.title)||"").localeCompare((w==null?void 0:w.title)||""):N-T}),c});return{loading:r,error:e,openAddModal:l,openAddMemberModal:n,showMobileConversationList:a,searchText:b,conversations:d,filteredConversations:x,conversation:p,activeConversationId:v,activeConversation:g,messages:m,fetchUserConversations:async(_={})=>{var u,c;r.value=!0,e.value=null;try{const s=await B.get("/chat/conversations",{params:_});d.value=s.data}catch(s){e.value=((c=(u=s.response)==null?void 0:u.data)==null?void 0:c.message)||"ডাটা লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching conversations:",s)}finally{r.value=!1}},addConversationMembers:async(_,u={})=>{var c,s,w,T,N,O;if(_){r.value=!0,e.value=null;try{const $=await B.post(`/chat/conversations/${_}/add-members`,u);return(c=$==null?void 0:$.data)!=null&&c.message&&((w=m.value)==null||w.push((s=$.data)==null?void 0:s.message)),(T=$==null?void 0:$.data)!=null&&T.conversation&&(d.value=d.value.map(M=>parseInt(M.id)===parseInt(_)?$.data.conversation:M)),$.data}catch($){e.value=((O=(N=$.response)==null?void 0:N.data)==null?void 0:O.message)||"ডাটা Create করতে ব্যর্থ হয়েছে।",console.error("Error creating conversation:",$)}finally{r.value=!1}}},createConversation:async(_={})=>{var u,c;r.value=!0,e.value=null;try{const s=await B.post("/chat/conversations",_);return v.value=s.data.id,s.data.id}catch(s){e.value=((c=(u=s.response)==null?void 0:u.data)==null?void 0:c.message)||"ডাটা Create করতে ব্যর্থ হয়েছে।",console.error("Error creating conversation:",s)}finally{r.value=!1}},fetchConversationById:async _=>{var u,c;r.value=!0,e.value=null,p.value={};try{const s=await B.get(`/chat/conversations/${_}`);p.value=s.data}catch(s){e.value=((c=(u=s.response)==null?void 0:u.data)==null?void 0:c.message)||"ডাটা লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching conversation:",s)}finally{r.value=!1}},fetchConversationMessages:async(_,u={})=>{var c,s;r.value=!0,e.value=null,m.value=[];try{const w=await B.get(`/chat/conversations/${_}/messages`,{params:u});m.value=w.data}catch(w){e.value=((s=(c=w.response)==null?void 0:c.data)==null?void 0:s.message)||"ডাটা লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching messages:",w)}finally{r.value=!1}},createConversationMessage:async(_,u={})=>{var c,s,w,T,N,O,$;if(_){r.value=!0,e.value=null;try{const M=await B.post(`/chat/conversations/${_}/messages`,u);return(c=M==null?void 0:M.data)!=null&&c.message&&((w=m.value)==null||w.push((s=M.data)==null?void 0:s.message)),(T=M==null?void 0:M.data)!=null&&T.conversation&&(d.value=d.value.map(Q=>parseInt(Q.id)===parseInt(_)?M.data.conversation:Q)),(N=M.data)==null?void 0:N.message}catch(M){e.value=(($=(O=M.response)==null?void 0:O.data)==null?void 0:$.message)||"ডাটা Create করতে ব্যর্থ হয়েছে।",console.error("Error creating conversation:",M)}finally{r.value=!1}}}}}),te={__name:"AddNewButton",setup(r){const e=D(),l=P(),n=()=>{e.openAddModal=!0};return(a,d)=>{var p;return["admin","super_admin","developer"].includes((p=y(l).user)==null?void 0:p.role)?(o(),i("div",{key:0,onClick:n,title:"Add New Conversation",class:"size-10 shrink-0 grow-0 flex justify-center items-center"},d[0]||(d[0]=[t("i",{class:"fas fa-comment-alt-plus text-3xl cursor-pointer text-[#24A1DE]"},null,-1)]))):S("",!0)}}},pe={class:"flex justify-center items-center gap-3"},fe=["onClick"],ye={__name:"ConversationTypeSelector",props:{modelValue:{type:String,default:""},onSelect:{tyep:Function,default:()=>{}}},emits:["update:modelValue"],setup(r,{emit:e}){const l=r,n=e,a=k(()=>[{label:"Direct",value:"direct",iconClass:"fas fa-handshake"},{label:"Group",value:"group",iconClass:"fas fa-users"}]);function d(p){n("update:modelValue",p.value),l.onSelect()}return(p,v)=>(o(),i("div",pe,[(o(!0),i(U,null,H(a.value,m=>(o(),i("button",{key:m.value,class:A(["cursor-pointer px-6 py-1 border rounded-lg transition font-bold",r.modelValue===m.value?"bg-sky-600 text-white border-sky-600":"hover:bg-gray-50"]),onClick:b=>d(m)},[t("i",{class:A(m.iconClass)},null,2),z(" "+j(m.label),1)],10,fe))),128))]))}},ge={class:"flex flex-col md:flex-row justify-center md:items-center gap-2"},xe=["value"],he={__name:"GroupTitleInput",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(r,{emit:e}){return(l,n)=>(o(),i("div",ge,[n[1]||(n[1]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"}," Group Title ",-1)),t("input",{id:"title",value:r.modelValue,onInput:n[0]||(n[0]=a=>l.$emit("update:modelValue",a.target.value)),type:"text",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},null,40,xe)]))}},be={class:"grid sm:grid-cols-2 gap-4"},_e={class:"flex flex-row justify-center items-center gap-2"},we=["value"],Ce=["value"],ke={class:"flex flex-row justify-center items-center gap-2"},Ie=["value","disabled"],$e=["value"],Me={__name:"CompanyDepartmentFilter",props:{companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""}},emits:["update:companyId","update:departmentId"],setup(r,{emit:e}){return(l,n)=>(o(),i("div",be,[t("div",_e,[n[3]||(n[3]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Company",-1)),t("select",{value:r.companyId,onChange:n[0]||(n[0]=a=>l.$emit("update:companyId",a.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},[n[2]||(n[2]=t("option",{value:""},"-- Company --",-1)),(o(!0),i(U,null,H(r.companies,a=>(o(),i("option",{key:a.id,value:a.id},j(a.name),9,Ce))),128))],40,we)]),t("div",ke,[n[5]||(n[5]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Department",-1)),t("select",{value:r.departmentId,disabled:!r.companyId,onChange:n[1]||(n[1]=a=>l.$emit("update:departmentId",a.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60"},[n[4]||(n[4]=t("option",{value:""},"-- Department --",-1)),(o(!0),i(U,null,H(r.departments,a=>(o(),i("option",{key:a.id,value:a.id},j(a.name),9,$e))),128))],40,Ie)])]))}},Ue={class:"grid gap-2"},Ae={key:0,class:"flex flex-wrap gap-2"},Se={class:"font-medium"},je=["onClick"],Ee={class:"flex items-center gap-2"},Le=["disabled"],Te={class:"max-h-72 overflow-y-auto rounded-lg rounded-t-none border"},De={key:0,class:"p-4 text-gray-500 text-center"},Ne={key:0,class:"p-4 text-center text-gray-600"},Ve={key:1,class:"divide-y"},He=["for"],ze={class:"w-full grow flex items-center gap-3"},Be=["title"],Ge={class:"leading-tight"},Oe={class:"font-medium text-sm md:text-base"},Re={class:"text-xs text-gray-500"},Fe={class:"w-14 md:w-auto md:shrink-0 inline-flex justify-center items-center text-right"},Pe={key:0,class:"text-gray-500 text-xs text-center"},qe=["id","type","name","checked","onChange"],se={__name:"UserPicker",props:{mode:{type:String,required:!0},users:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},selectedUserIds:{type:Array,default:()=>[]},alreadyAddedUserIds:{type:Array,default:()=>[]}},emits:["update:companyId","update:departmentId","update:selectedUserIds"],setup(r,{emit:e}){const l=r,n=e,a=ue(),d=ce(),p=ve(),v=k({get:()=>l.companyId,set:u=>n("update:companyId",u)}),m=k({get:()=>l.departmentId,set:u=>n("update:departmentId",u)}),b=k({get:()=>l.selectedUserIds,set:u=>n("update:selectedUserIds",u)}),g=k(()=>a.companies||[]),x=k(()=>d.departments||[]),I=k(()=>p.users||[]),E=k(()=>{var u;return(u=l.users)!=null&&u.length?l.users:I.value}),f=h(""),L=k(()=>{if(!f.value.trim())return E.value;const u=f.value.trim().toLowerCase();return E.value.filter(c=>{const s=(c.name||"").toLowerCase(),w=String(c.employee_id||"").toLowerCase(),T=String(c.phone||"").toLowerCase(),N=String(c.email||"").toLowerCase();return s.includes(u)||w.includes(u)||T.includes(u)||N.includes(u)})}),q=k(()=>!v.value);function J(u){let c=[...b.value];const s=c.indexOf(u.id);l.mode==="direct"?c=s>=0?[]:[u.id]:s>=0?c.splice(s,1):c.push(u.id),b.value=c}function _(u){var s;const c=(s=E.value)==null?void 0:s.find(w=>parseInt(w.id)==parseInt(u));return c?c.name||c.employee_id||c.id:""}return R(()=>v.value,async(u,c)=>{u!==c&&(m.value="",b.value=[],u&&await d.fetchDepartments(u),await p.fetchUsers({company_id:u||null,department_id:null}))}),R(()=>m.value,async(u,c)=>{u!==c&&(b.value=[],v.value&&await p.fetchUsers({company_id:v.value,department_id:u||null}))}),G(async()=>{!g.value.length&&a.fetchCompanies&&await a.fetchCompanies(),v.value&&(await d.fetchDepartments(v.value),await p.fetchUsers({company_id:v.value,department_id:m.value||null}))}),(u,c)=>(o(),i(U,null,[C(Me,{"company-id":v.value,"onUpdate:companyId":c[0]||(c[0]=s=>v.value=s),"department-id":m.value,"onUpdate:departmentId":c[1]||(c[1]=s=>m.value=s),companies:g.value,departments:x.value},null,8,["company-id","department-id","companies","departments"]),t("div",Ue,[r.mode==="group"&&r.selectedUserIds.length?(o(),i("div",Ae,[(o(!0),i(U,null,H(r.selectedUserIds,s=>(o(),i("span",{key:s,class:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm"},[t("span",Se,j(_(s)),1),t("button",{type:"button",class:"text-red-600",onClick:w=>b.value=r.selectedUserIds.filter(T=>T!==s)}," ✕ ",8,je)]))),128))])):S("",!0),t("div",null,[t("div",Ee,[K(t("input",{"onUpdate:modelValue":c[2]||(c[2]=s=>f.value=s),type:"search",disabled:q.value,class:"flex-1 px-3 py-2 border rounded-lg rounded-b-none focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60",placeholder:"Search by Name / Employee ID / Phone"},null,8,Le),[[W,f.value]])]),t("div",Te,[q.value?(o(),i("div",De,"Company নির্বাচন করুন।")):(o(),i(U,{key:1},[L.value.length?(o(),i("div",Ve,[(o(!0),i(U,null,H(L.value,s=>(o(),i("label",{key:s.id,for:`userId${s.id}`,class:"flex items-center justify-between gap-3 p-3 hover:bg-gray-50"},[t("div",ze,[t("div",{class:"border rounded-full",title:s.name},[C(Y,{user:s,size:"medium"},null,8,["user"])],8,Be),t("div",Ge,[t("div",Oe,j(s.name||"User #"+(s.employee_id??s.id)),1),t("div",Re,j(s.employee_id||s.phone||s.email||""),1)])]),t("div",Fe,[r.alreadyAddedUserIds.includes(s.id)?(o(),i("span",Pe," Already Added ")):(o(),i("input",{key:1,id:`userId${s.id}`,type:r.mode==="direct"?"radio":"checkbox",name:r.mode==="direct"?"direct-user":"group-users",checked:r.selectedUserIds.includes(s.id),onChange:w=>J(s),class:"size-5"},null,40,qe))])],8,He))),128))])):(o(),i("div",Ne," কোন ইউজার পাওয়া যায়নি। "))],64))])])])],64))}},Ye={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},Ke={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[100vh] md:max-h-[90%] overflow-y-auto"},We={class:"flex flex-col gap-y-2 md:flex-row justify-between items-center"},Je={key:0,class:"mt-4"},Qe={key:1,class:"text-red-600 text-sm"},Xe={class:"flex justify-between"},Ze=["disabled"],et={__name:"AddNewConversationModal",setup(r){const e={DIRECT:"direct",GROUP:"group"},l=D(),n=X(),a=h(""),d=h(""),p=h(""),v=h(""),m=h([]),b=h(""),g=()=>{l.openAddModal=!1,x()};function x(){a.value="",d.value="",p.value="",v.value="",m.value=[],b.value=""}async function I(){var f;if(b.value="",!a.value){b.value="দয়া করে Conversation টাইপ নির্বাচন করুন।";return}if(((f=m.value)==null?void 0:f.length)==0){b.value="User নির্বাচন করুন।";return}const E=await l.createConversation({type:a.value,title:a.value=="group"?v.value:"",user_ids:m.value});l.openAddModal=!1,n.push({name:"Conversation Message",params:{conversationId:E}}),l.showMobileConversationList=!1,l.fetchUserConversations()}return(E,f)=>y(l).openAddModal?(o(),i("div",Ye,[t("div",Ke,[t("div",We,[f[5]||(f[5]=t("h2",{class:"text-xl text-center font-semibold"},"Add New Conversation",-1)),C(ye,{modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=L=>a.value=L),onSelect:()=>m.value=[]},null,8,["modelValue","onSelect"])]),f[9]||(f[9]=t("hr",{class:"mt-4"},null,-1)),a.value?(o(),i("form",{key:1,class:"space-y-3 mt-3",onSubmit:Z(I,["prevent"])},[a.value===e.GROUP?(o(),V(he,{key:0,modelValue:v.value,"onUpdate:modelValue":f[1]||(f[1]=L=>v.value=L)},null,8,["modelValue"])):S("",!0),C(se,{mode:a.value,"company-id":d.value,"onUpdate:companyId":f[2]||(f[2]=L=>d.value=L),"department-id":p.value,"onUpdate:departmentId":f[3]||(f[3]=L=>p.value=L),selectedUserIds:m.value,"onUpdate:selectedUserIds":f[4]||(f[4]=L=>m.value=L)},null,8,["mode","company-id","department-id","selectedUserIds"]),b.value?(o(),i("p",Qe,j(b.value),1)):S("",!0),f[8]||(f[8]=t("hr",null,null,-1)),t("div",Xe,[t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:g}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:a.value===e.DIRECT?m.value.length!==1:!v.value.trim()||m.value.length<2}," Create ",8,Ze)])],32)):(o(),i("div",Je,[t("div",{class:"rounded-md border border-dashed p-4 text-center text-gray-600"},[f[6]||(f[6]=t("div",{class:"py-4 text-xl leading-loose"},[z(" Conversation টাইপ (Direct / Group) সিলেক্ট করুন, "),t("br"),z(" তারপর নিচে ফিল্টার দেখাবে। ")],-1)),f[7]||(f[7]=t("p",{class:"pb-1"},"অথবা,",-1)),t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:g}," Cancel ")])]))])])):S("",!0)}},tt={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},st={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90%] overflow-y-auto"},nt={key:0,class:"text-red-600 text-sm"},at={class:"flex justify-between"},ot=["disabled"],rt={__name:"AddNewMemberModal",setup(r){const e=D(),l=P();X();const n=h(""),a=h(""),d=h([]),p=h(""),v=()=>{e.openAddMemberModal=!1,m()};function m(){n.value="",a.value="",d.value=[],p.value=""}async function b(){var g;if(p.value="",((g=d.value)==null?void 0:g.length)==0){p.value="User নির্বাচন করুন।";return}e.activeConversationId&&await e.addConversationMembers(e.activeConversationId,{user_ids:d.value}),e.openAddMemberModal=!1}return G(async()=>{e.activeConversationId&&await e.fetchConversationById(e.activeConversationId)}),(g,x)=>{var I,E;return y(e).openAddMemberModal&&y(e).activeConversationId&&y(e).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((I=y(l).user)==null?void 0:I.role)?(o(),i("div",tt,[t("div",st,[x[4]||(x[4]=re('<div class="flex justify-between items-center"><h2 class="text-xl text-center">Add New Members</h2><button class="bg-sky-600 text-white border-sky-600 cursor-pointer px-6 py-1 border rounded-lg transition font-bold"><i class="fas fa-users"></i> Group </button></div><hr class="mt-4">',2)),t("form",{class:"space-y-3 mt-3",onSubmit:Z(b,["prevent"])},[C(se,{mode:"group","company-id":n.value,"onUpdate:companyId":x[0]||(x[0]=f=>n.value=f),"department-id":a.value,"onUpdate:departmentId":x[1]||(x[1]=f=>a.value=f),selectedUserIds:d.value,"onUpdate:selectedUserIds":x[2]||(x[2]=f=>d.value=f),alreadyAddedUserIds:((E=y(e).conversation)==null?void 0:E.user_ids)||[]},null,8,["company-id","department-id","selectedUserIds","alreadyAddedUserIds"]),p.value?(o(),i("p",nt,j(p.value),1)):S("",!0),x[3]||(x[3]=t("hr",null,null,-1)),t("div",at,[t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:v}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:d.value.length<1}," Create ",8,ot)])],32)])])):S("",!0)}}},lt={key:0,class:"flex flex-wrap gap-x-0.5 md:gap-x-1 items-center justify-center"},it={class:"text-xs md:text-sm"},dt=["innerHTML"],ut={key:1},ct={class:"border rounded-lg max-w-lg w-full min-w-40 md:min-w-80"},vt={class:"grow w-full flex items-center gap-1"},mt={class:"font-semibold sm:inline-block text-sm line-clamp-1"},pt={class:"shrink md:shrink-0 text-[10px] md:text-xs mt-1 text-right"},ft=["innerHTML"],yt={__name:"ChatMessageCard",props:{message:{type:Object,required:!0}},setup(r){P();const e=r,l=k(()=>e.message.is_own_message),n=k(()=>e.message.type==="system");return(a,d)=>{var p,v;return o(),i("div",{class:A(["flex px-2 md:px-4",{"justify-end pl-6 md:pl-12":!n.value&&l.value,"justify-start pr-6 md:pr-12":!n.value&&!l.value,"justify-center":n.value}])},[n.value?(o(),i("div",lt,[d[0]||(d[0]=t("i",{class:"far fa-cog text-gray-700 text-xs md:text-base"},null,-1)),t("strong",it,j(l.value?"You":(p=r.message.sender)==null?void 0:p.name),1),t("div",{innerHTML:r.message.body,class:"block text-xs md:text-sm italic whitespace-pre-wrap break-words leading-relaxed"},null,8,dt)])):(o(),i("div",ut,[t("div",ct,[t("div",{class:A(["flex justify-between items-center p-1 rounded-t-lg gap-1 md:gap-4",{"bg-[#24A1DE] text-white":l.value,"bg-gray-200 text-black":!l.value}])},[t("div",vt,[C(Y,{user:r.message.sender,size:"small"},null,8,["user"]),t("div",mt,j((v=r.message.sender)==null?void 0:v.name),1)]),t("div",pt,j(r.message.send_at),1)],2),t("div",{class:"block py-1 px-2 rounded-b-lg bg-white text-xs md:text-sm whitespace-pre-wrap break-words leading-relaxed",innerHTML:r.message.body},null,8,ft)]),t("div",{class:A(["flex",{"justify-end":l.value,"justify-start":!l.value}])},[t("div",{class:A(["flex flex-wrap gap-1 max-w-[280px] pt-1",{"justify-end":l.value,"justify-start":!l.value}])},[(o(!0),i(U,null,H(r.message.last_reader_photos,m=>(o(),i(U,{key:m},[m?(o(),V(Y,{key:0,user:{photo:m},size:"xsmall"},null,8,["user"])):S("",!0)],64))),128))],2)],2)]))],2)}}},gt={},xt={class:"flex justify-center items-center py-4"};function ht(r,e){return o(),i("div",xt,e[0]||(e[0]=[t("i",{class:"fas fa-spinner fa-spin text-2xl text-[#24A1DE]"},null,-1)]))}const ne=me(gt,[["render",ht]]),bt={key:1,class:"text-red-500 text-center my-4"},_t={key:2,class:"text-center text-gray-500 my-4"},wt={key:0,class:"text-xs text-gray-400 text-center py-2"},Ct={__name:"ChatMessageContainer",setup(r){const e=D(),l=h(!1),n=h(null),a=h(!0),d=h(!1),p=(g,x=80)=>g.scrollHeight-g.scrollTop-g.clientHeight<x,v=async(g="auto")=>{await F();const x=n.value;x&&(x.scrollTo({top:x.scrollHeight,behavior:g}),a.value=!0)},m=async()=>{const g=n.value;if(g&&(a.value=p(g),g.scrollTop<=0&&e.hasMore&&!d.value)){d.value=!0;const x=g.scrollHeight,I=g.scrollTop;try{await e.fetchOlderMessages(e.activeConversationId),await F();const E=g.scrollHeight;g.scrollTop=E-(x-I)}catch{}finally{d.value=!1}}},b=async()=>{l.value=!0;try{e.activeConversationId&&(await e.fetchConversationMessages(e.activeConversationId),await v("auto"))}catch{}finally{l.value=!1}};return G(()=>{b()}),R(()=>e.activeConversationId,async(g,x)=>{g&&g!==x&&await b()}),R(()=>e.messages.length,async(g,x)=>{const I=n.value;I&&g>x&&p(I,120)&&await v("smooth")}),k(()=>!a.value&&!!e.activeConversationId),(g,x)=>(o(),i("div",{ref_key:"scrollEl",ref:n,onScroll:m,class:A(["w-full overflow-y-auto h-[calc(100vh-150px)] scrollbar relative flex flex-col",{"items-center justify-center":!y(e).activeConversationId||y(e).error||l.value}])},[l.value?(o(),V(ne,{key:0})):S("",!0),y(e).error?(o(),i("div",bt,j(y(e).error),1)):y(e).activeConversationId?(o(),i(U,{key:3},[d.value?(o(),i("div",wt,"Loading older…")):S("",!0),(o(!0),i(U,null,H(y(e).messages,I=>(o(),V(yt,{key:I.id,message:I,class:"w-full my-4"},null,8,["message"]))),128))],64)):(o(),i("div",_t," Please select a conversation to view messages. ")),le(g.$slots,"default")],34))}},kt={key:0},It={__name:"AddNewMemberButton",setup(r){const e=D(),l=P();return(n,a)=>{var d;return y(e).activeConversationId&&y(e).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((d=y(l).user)==null?void 0:d.role)?(o(),i("div",kt,[t("div",{class:"size-8 rounded-full text-sm border flex justify-center items-center cursor-pointer",title:"Add New Members",onClick:a[0]||(a[0]=p=>y(e).openAddMemberModal=!0)},a[1]||(a[1]=[t("i",{class:"fas fa-user-plus"},null,-1)]))])):S("",!0)}}},$t={class:"min-w-max size-8 md:size-12 flex justify-center items-center text-[#24A1DE] bg-white rounded-full overflow-hidden border"},Mt=["src"],Ut={key:0,class:"fas fa-users md:text-3xl"},At={key:1,class:"fas fa-user md:text-3xl"},ae={__name:"ConversationAvatar",props:{conversation:{type:Object,required:!0}},setup(r){const e=h(!0);return(l,n)=>{var a,d;return o(),i("div",null,[t("div",$t,[(a=r.conversation)!=null&&a.avatar&&e.value?(o(),i("img",{key:0,onError:n[0]||(n[0]=p=>e.value=!1),src:(d=r.conversation)==null?void 0:d.avatar,alt:"Photo",class:"object-cover w-full h-full"},null,40,Mt)):(o(),i(U,{key:1},[r.conversation.type==="group"?(o(),i("i",Ut)):(o(),i("i",At))],64))])])}}},St={class:"bg-[#24A1DE] border-b border-[#24A1DE] text-white h-[48px] md:h-[56px] flex items-center"},jt={key:0,class:"w-full flex items-center justify-start gap-2 px-1 py-[3px]"},Et={class:"md:text-lg font-semibold line-clamp-1"},Lt={key:0,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Tt={key:1,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Dt={__name:"ConversationHeader",setup(r){const e=D();return(l,n)=>{var a,d,p;return o(),i("div",St,[(d=(a=y(e))==null?void 0:a.activeConversation)!=null&&d.id?(o(),i("div",jt,[C(ae,{conversation:y(e).activeConversation},null,8,["conversation"]),t("div",null,[t("h3",Et,j((p=y(e).activeConversation)==null?void 0:p.title),1),y(e).activeConversation.type==="group"?(o(),i("div",Lt,n[0]||(n[0]=[t("i",{class:"fas fa-users"},null,-1),t("i",{class:"line-clamp-1"},"Group chatting",-1)]))):(o(),i("div",Tt,n[1]||(n[1]=[t("i",{class:"fas fa-handshake"},null,-1),t("i",{class:"line-clamp-1"},"One to One chatting",-1)])))]),C(It,{class:"ml-auto md:mr-3"})])):S("",!0)])}}},Nt={class:"flex items-center gap-2"},Vt={class:"md:text-lg font-semibold"},Ht=["innerHTML"],zt={__name:"ConversationListItem",props:{conversation:{type:Object,required:!0}},setup(r){const e=D(),l=r,n=k(()=>parseInt(l.conversation.id)===parseInt(e.activeConversationId));return(a,d)=>{var v;const p=ie("RouterLink");return(v=r.conversation)!=null&&v.id?(o(),V(p,{key:0,to:`/chatting/${r.conversation.id}`,class:A(["block p-1.5 md:p-3 border-b cursor-pointer hover:bg-[#24A1DE] hover:text-white group hover:opacity-90",{"bg-[#24A1DE] text-white":n.value}]),onClick:d[0]||(d[0]=m=>y(e).showMobileConversationList=!1)},{default:ee(()=>[t("div",Nt,[C(ae,{conversation:r.conversation},null,8,["conversation"]),t("div",{class:A([{hidden:!y(e).showMobileConversationList},"md:block"])},[t("h3",Vt,j(r.conversation.title),1),t("div",{class:A(["text-xs md:text-sm group-hover:text-gray-50 line-clamp-1",{"text-gray-50":n.value,"text-gray-600":!n.value}]),innerHTML:r.conversation.subtitle},null,10,Ht)],2)])]),_:1},8,["to","class"])):S("",!0)}}},Bt={class:"flex flex-col items-center justify-center p-4 text-center text-gray-600"},Gt={__name:"ConversationNotFoundMessage",setup(r){return(e,l)=>(o(),i("div",Bt,[l[0]||(l[0]=t("i",{class:"fas fa-info-circle text-xl"},null,-1)),l[1]||(l[1]=t("p",{class:"mt-2 mb-4"},[z(" No conversations found. "),t("br"),z(" Start a new conversation! ")],-1)),C(te)]))}},Ot={class:"overflow-y-auto h-[calc(100vh-150px)] scrollbar text-blue-900 bg-white border-0"},Rt={__name:"ConversationList",setup(r){const e=D(),l=h(!1);return G(async()=>{l.value=!0,await e.fetchUserConversations(),l.value=!1}),(n,a)=>(o(),i("div",null,[t("div",Ot,[l.value?(o(),V(ne,{key:0})):y(e).conversations.length===0?(o(),V(Gt,{key:1})):(o(!0),i(U,{key:2},H(y(e).filteredConversations,d=>(o(),V(zt,{key:d.id,conversation:d},null,8,["conversation"]))),128))])]))}},Ft={for:"search",class:"grow shrink relative block"},Pt={__name:"SearchConversation",setup(r){const e=D();return(l,n)=>(o(),i("label",Ft,[n[1]||(n[1]=t("i",{class:"fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-[#24A1DE]"},null,-1)),K(t("input",{id:"search",placeholder:"Search Conversations...",type:"search",class:"input-1 pl-10 pr-2 rounded-b-none border-none outline-[#24a0deb0] py-[11px] md:py-[15px] rounded-none rounded-tl-lg","onUpdate:modelValue":n[0]||(n[0]=a=>y(e).searchText=a)},null,512),[[W,y(e).searchText]])]))}},qt={class:"flex items-start gap-2"},Yt={class:"w-full border-2 border-blue-100 rounded-xl bg-gray-100 px-1.5 pt-1.5 pb-0"},Kt={__name:"SendMessageBox",setup(r){const e=D(),l=h(""),n=h(null);function a(){const v=n.value;v&&(v.style.height="auto",v.style.height=v.scrollHeight+"px")}async function d(){var b;const v=l.value.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim();if(!e.activeConversationId||!v)return;const m=await e.createConversationMessage(e.activeConversationId,{type:"text",body:v,format:"plain"});l.value="",await F(),a(),(b=e==null?void 0:e.bumpConversationToTop)==null||b.call(e,e.activeConversationId,m)}function p(v){v.isComposing||v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),d())}return G(()=>F(a)),(v,m)=>(o(),i("div",qt,[m[2]||(m[2]=t("label",{class:"hidden bg-gray-100 text-gray-600 rounded-full px-3 py-2 hover:bg-gray-500 hover:text-white cursor-pointer"},[t("input",{type:"file",class:"hidden",accept:"image/jpg,image/jpeg,image/png,image/gif,application/pdf"}),t("i",{class:"far fa-paperclip text-xl"})],-1)),t("div",Yt,[K(t("textarea",{ref_key:"taRef",ref:n,"onUpdate:modelValue":m[0]||(m[0]=b=>l.value=b),onInput:a,onKeydown:p,name:"body",rows:"1",placeholder:"Write a message…",class:"w-full resize-none overflow-hidden bg-transparent outline-none leading-6 max-h-32 mb-0"},null,544),[[W,l.value]])]),t("button",{type:"button",onClick:d,class:"bg-blue-100 text-blue-600 rounded-full px-3 py-2 hover:bg-blue-600 hover:text-white"},m[1]||(m[1]=[t("i",{class:"far fa-paper-plane text-xl"},null,-1)]))]))}},Wt={class:"my-container"},Jt={class:"flex overflow-hidden border-[#24A1DE] border rounded-lg"},Qt={class:"h-[48px] md:h-[56px] flex justify-center items-center border-b border-[#24A1DE] bg-white rounded-tl-lg"},Xt={key:0,class:"my-8 text-center px-4 grid justify-center items-center gap-2"},as={__name:"ChattingList",setup(r){const e=D(),l=de();return R(()=>l.params.conversationId,n=>{e.activeConversationId=n},{immediate:!0}),G(()=>{e.showMobileConversationList=!l.params.conversationId}),(n,a)=>(o(),i(U,null,[t("div",Wt,[t("div",Jt,[t("div",{class:A(["min-w-11 md:block grow-0 shrink-0 md:w-[360px] rounded-l-lg",{"w-full":y(e).showMobileConversationList}])},[t("div",Qt,[t("div",{onClick:a[0]||(a[0]=d=>y(e).showMobileConversationList=!0),class:A(["md:hidden flex justify-center items-center text-2xl text-[#24A1DE]",{hidden:y(e).showMobileConversationList}])},a[1]||(a[1]=[t("i",{class:"fas fa-bars"},null,-1)]),2),t("div",{class:A([y(e).showMobileConversationList?"flex":"hidden","w-full md:flex items-center justify-between"])},[C(Pt),C(te)],2)]),C(Rt)],2),t("div",{class:A(["md:block relative grow shrink border-l rounded-r-lg overflow-hidden bg-gray-100 border-[#24A1DE]",{hidden:y(e).showMobileConversationList}])},[y(e).activeConversationId?(o(),i(U,{key:1},[C(Dt),C(Ct,null,{default:ee(()=>[C(Kt,{class:"bg-white border-t border-[#24A1DE] sticky bottom-0 mt-auto z-10 w-full p-2"})]),_:1})],64)):(o(),i("div",Xt,a[2]||(a[2]=[t("i",{class:"fad text-blue-600 fa-info-circle text-4xl md:text-7xl"},null,-1),t("p",{class:"text-gray-500 md:text-4xl"},[z(" Select a conversation "),t("br"),z(" to start chatting ")],-1)])))],2)])]),C(et),y(e).openAddMemberModal?(o(),V(rt,{key:0})):S("",!0)],64))}};export{as as default};
