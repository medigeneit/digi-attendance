import{p as D,c as h,o as _,t as a,u as B,b as E,d as N,B as V,r as C,q as I,e as U,C as W,a as e,f as L,y as k,h as j,v as z,k as H,F as O,x as J,D as q,g as G,i as K,j as X}from"./index-DiCGcSUO.js";import{_ as Y}from"./EmployeeFilter-CupS4FR3.js";import{L as Z}from"./LoaderView-Cjvrcorx.js";import{_ as Q}from"./UpdateOrCreate-B11-xWaf.js";import{u as g}from"./attendance-6WWr7U3S.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-CDHV7I0u.js";import"./department-DMiUQN6H.js";import"./EmployeeDropdownInput-BdiDEzZe.js";import"./SelectDropdown-9USXFNsi.js";import"./UserChip-OI6N4_Ls.js";import"./TimePickerAsFloatHour-O6YbD5rt.js";const et={__name:"DisplayFormattedWorkingHours",props:["workingHours"],setup(M){const p=M,r=D(()=>{if(!p.workingHours)return"-";const y=Math.floor(p.workingHours),c=Math.round((p.workingHours-y)*60);return c?`${y}h ${c}m`:`${y}h`});return(y,c)=>(_(),h("span",null,a(r.value),1))}},st={class:"px-4 space-y-4"},at={class:"flex items-center justify-between gap-2"},nt={class:"flex gap-2"},dt=["disabled"],rt=["disabled"],ct={class:"flex flex-wrap items-end gap-4"},lt={class:"flex items-end gap-3"},ot={class:"flex flex-col"},it={key:1,class:"text-center text-red-500 text-lg italic mt-10"},_t={key:2,class:"card-bg p-8 border rounded-lg text-center text-gray-600"},ut={key:3,class:"overflow-x-auto card-bg border rounded-lg"},ht={class:"min-w-full table-auto border-collapse"},pt={class:"text-center text-sm"},yt={class:"td"},mt={class:"td text-left"},vt={class:"td text-left"},ft={class:"td"},xt={class:"td"},bt={class:"td"},wt={class:"td"},kt={class:"td"},Ht={class:"td"},Dt={class:"td"},Mt={class:"td"},St={class:"td"},At={class:"td"},Ct={class:"td"},Lt={class:"td"},qt={class:"td"},$t={class:"td"},Ft={class:"font-semibold text-green-600"},Pt={class:"text-gray-500 text-xs"},Rt={class:"td"},Tt={class:"td"},Bt={class:"td"},Et={class:"td"},Nt={class:"td"},Vt={class:"flex flex-col items-center gap-1"},It={class:"text-xs text-gray-600"},Ut={class:"w-10 h-2 bg-gray-200 rounded"},Wt={class:"td"},jt={class:"flex flex-col items-center gap-1"},zt={class:"text-xs text-gray-600"},Ot={class:"w-10 h-2 bg-gray-200 rounded"},Jt={class:"td"},Gt={class:"td"},Kt={class:"td"},Xt={class:"td"},Yt={class:"flex gap-2 items-center justify-center"},Zt={class:"td"},Qt={class:"td"},gt={class:"bg-gray-100 font-semibold text-center"},te={class:"td"},ee={class:"td"},se={class:"td"},ae={class:"td"},ne={class:"td"},de={class:"td"},re={class:"td"},ce={class:"td"},le={class:"td"},oe={__name:"MonthlyAttendanceSummaryReport",setup(M){const p=B(),r=E(),y=N(),c=g(),{monthly_company_summary:S}=V(c),m=d=>{const s=Number(d);return Number.isFinite(s)?s:0},l=(d,s)=>d.reduce((u,t)=>{try{const f=s.split(".").reduce((v,x)=>v?v[x]:void 0,t);return u+m(f)}catch{return u}},0),o=C(r.query.date&&String(r.query.date)||c.selectedMonth||""),n=C({company_id:r.query.company_id||"",department_id:r.query.department_id||"all",line_type:r.query.line_type||"all",employee_id:r.query.employee_id||""}),b=D(()=>Array.isArray(S.value)?S.value:[]),i=D(()=>{const d=b.value;return{cl:l(d,"total_cl_leave"),ml:l(d,"total_ml_leave"),sl:l(d,"total_sl_leave"),wplDays:l(d,"total_wpl_leave"),otHour:l(d,"total_overtime_hours"),absentDays:l(d,"total_absent"),wplHour:l(d,"total_wpl_hour"),paycutHour:l(d,"paycut.paycut_hours"),payableHour:l(d,"payable_hour")}}),w=async()=>{const d=n.value.company_id,s=n.value.employee_id||"",u=n.value.line_type!=="all"?n.value.line_type:"";if(!d){alert("⚠️ Please select a company first.");return}try{await c.getMonthlyAttendanceSummaryReport(d,u,s,o.value)}catch(t){console.error("❌ Failed to load attendance:",t),alert("❌ Failed to load attendance data.")}},A=d=>{const s=r.query;Object.keys(d).some(t=>String(s[t]??"")!==String(d[t]??""))&&p.replace({query:d})},$=()=>{A({...r.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:o.value||""})};I(o,d=>{A({...r.query,date:d||""})}),U(()=>{n.value.company_id&&w()});const F=async()=>{if(!n.value.company_id)return;const d=n.value.line_type!=="all"?n.value.line_type:"";await c.downloadExcel(n.value.company_id,d,o.value)},P=async()=>{if(!n.value.company_id)return;const d=n.value.line_type!=="all"?n.value.line_type:"";await c.downloadPDF(n.value.company_id,d,o.value)},R=()=>p.go(-1),T=async()=>{await w()};return(d,s)=>{const u=W("router-link");return _(),h("div",st,[e("div",at,[e("button",{class:"btn-3",onClick:R},s[6]||(s[6]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),s[9]||(s[9]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"}," Monthly Attendance Summary Report ",-1)),e("div",nt,[e("button",{type:"button",onClick:F,class:"btn-1",disabled:!n.value.company_id},s[7]||(s[7]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1)]),8,dt),e("button",{type:"button",onClick:P,class:"btn-1",disabled:!n.value.company_id},s[8]||(s[8]=[e("i",{class:"fal fa-file-pdf text-2xl text-red-500"},null,-1)]),8,rt)])]),e("div",ct,[k(Y,{company_id:n.value.company_id,"onUpdate:company_id":s[0]||(s[0]=t=>n.value.company_id=t),department_id:n.value.department_id,"onUpdate:department_id":s[1]||(s[1]=t=>n.value.department_id=t),employee_id:n.value.employee_id,"onUpdate:employee_id":s[2]||(s[2]=t=>n.value.employee_id=t),line_type:n.value.line_type,"onUpdate:line_type":s[3]||(s[3]=t=>n.value.line_type=t),"with-type":!0,"initial-value":d.$route.query,onFilterChange:$},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),e("div",lt,[e("div",ot,[s[10]||(s[10]=e("label",{class:"text-xs text-gray-600 mb-1"},"Month",-1)),j(e("input",{type:"month","onUpdate:modelValue":s[4]||(s[4]=t=>o.value=t),class:"input-1"},null,512),[[z,o.value]])]),e("button",{type:"button",onClick:s[5]||(s[5]=t=>w()),class:"btn-2"},"Search")])]),H(c).isLoading?(_(),L(Z,{key:0})):n.value.company_id?b.value.length===0?(_(),h("div",_t," No attendance found for the selected month & filters. ")):(_(),h("div",ut,[e("table",ht,[s[16]||(s[16]=e("thead",{class:"sticky top-0 z-10 bg-white shadow-sm"},[e("tr",{class:"bg-gray-50 text-sm"},[e("th",{rowspan:"2",class:"th"},"#"),e("th",{rowspan:"2",class:"th text-left"},"Employee Name"),e("th",{rowspan:"2",class:"th text-left"},"Designation"),e("th",{colspan:"5",class:"th"},"Attendance Summary"),e("th",{colspan:"2",class:"th"},"Actual Late"),e("th",{colspan:"2",class:"th"},"Remaining Late"),e("th",{colspan:"2",class:"th"},"Actual Early"),e("th",{colspan:"2",class:"th"},"Remaining Early"),e("th",{rowspan:"2",class:"th"},"Working Hour"),e("th",{colspan:"4",class:"th"},"Leave Day"),e("th",{colspan:"2",class:"th"},"Short Leave"),e("th",{rowspan:"2",class:"th"},"OT Hour"),e("th",{colspan:"4",class:"th"},"Deduction"),e("th",{rowspan:"2",class:"th"},"Action")]),e("tr",{class:"bg-gray-50 text-xs"},[e("th",{class:"th"},"TD"),e("th",{class:"th"},"TP"),e("th",{class:"th"},"TW"),e("th",{class:"th"},"TL"),e("th",{class:"th"},"TA"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"CL"),e("th",{class:"th"},"ML"),e("th",{class:"th"},"SL"),e("th",{class:"th"},"WPL"),e("th",{class:"th"},"Delay"),e("th",{class:"th"},"Early"),e("th",{class:"th"},"Absent Hour"),e("th",{class:"th"},"WPL(Hour)"),e("th",{class:"th"},"Pay Cut"),e("th",{class:"th"},"Payable Hour")])],-1)),e("tbody",pt,[(_(!0),h(O,null,J(b.value,(t,f)=>{var v,x;return _(),h("tr",{key:`${(t==null?void 0:t.user_id)||"u"}-${f}`,class:"border-b hover:bg-blue-50"},[e("td",yt,a(f+1),1),e("td",mt,a(t==null?void 0:t.user),1),e("td",vt,a(t==null?void 0:t.designation),1),e("td",ft,a(t==null?void 0:t.total_monthly_days),1),e("td",xt,a(t==null?void 0:t.total_present),1),e("td",bt,a(t==null?void 0:t.total_weekend),1),e("td",wt,a(t==null?void 0:t.total_leave),1),e("td",kt,a(t==null?void 0:t.total_absent),1),e("td",Ht,a(t==null?void 0:t.actual_late_day),1),e("td",Dt,a(t==null?void 0:t.actual_late_hour),1),e("td",Mt,a(t==null?void 0:t.total_remain_late_day),1),e("td",St,a(t==null?void 0:t.total_remain_late_hour),1),e("td",At,a(t==null?void 0:t.actual_early_day),1),e("td",Ct,a(t==null?void 0:t.actual_early_hour),1),e("td",Lt,a(t==null?void 0:t.total_remain_early_day),1),e("td",qt,a(t==null?void 0:t.total_remain_early_hour),1),e("td",$t,[e("div",Ft,a((t==null?void 0:t.total_working_hours)||0),1),e("div",Pt," of "+a((t==null?void 0:t.total_shift_hour)||0),1)]),e("td",Rt,a(t==null?void 0:t.total_cl_leave),1),e("td",Tt,a(t==null?void 0:t.total_ml_leave),1),e("td",Bt,a(t==null?void 0:t.total_sl_leave),1),e("td",Et,a(t==null?void 0:t.total_wpl_leave),1),e("td",Nt,[e("div",Vt,[e("span",It,a((t==null?void 0:t.total_first_short_leave)||0)+" of "+a((t==null?void 0:t.actual_late_day)||0),1),e("div",Ut,[e("div",{class:"h-2 bg-amber-500 rounded",style:q({width:m(t==null?void 0:t.total_first_short_leave)/Math.max(1,m(t==null?void 0:t.actual_late_day))*100+"%"})},null,4)])])]),e("td",Wt,[e("div",jt,[e("span",zt,a((t==null?void 0:t.total_last_short_leave)||0)+" of "+a((t==null?void 0:t.actual_early_day)||0),1),e("div",Ot,[e("div",{class:"h-2 bg-blue-500 rounded",style:q({width:m(t==null?void 0:t.total_last_short_leave)/Math.max(1,m(t==null?void 0:t.actual_early_day))*100+"%"})},null,4)])])]),e("td",Jt,a(t!=null&&t.total_overtime_hours?`${t==null?void 0:t.total_overtime_hours} H`:""),1),e("td",Gt,a(m(t==null?void 0:t.total_absent)*9)+"H",1),e("td",Kt,a(t==null?void 0:t.total_wpl_hour)+"H",1),e("td",Xt,[e("div",Yt,[k(et,{workingHours:(v=t==null?void 0:t.paycut)==null?void 0:v.paycut_hours},null,8,["workingHours"]),((x=H(y).user)==null?void 0:x.id)===8?(_(),L(Q,{key:0,class:"mr-2",userId:t==null?void 0:t.user_id,month:o.value,onUpdated:T},null,8,["userId","month"])):G("",!0)])]),e("td",Zt,a(t==null?void 0:t.payable_hour)+"H",1),e("td",Qt,[k(u,{to:{name:"EmployeeAttendance",query:{...H(r).query,employee_id:t==null?void 0:t.user_id,date:o.value}},target:"_blank",class:"inline-flex items-center gap-1 rounded-md px-2 py-1 text-sm font-medium bg-blue-50 text-blue-700 hover:bg-blue-100"},{default:K(()=>s[11]||(s[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M15 3h6v6"}),e("path",{d:"M10 14 21 3"}),e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"})],-1),X(" Job Card ")])),_:2,__:[11]},1032,["to"])])])}),128))]),e("tfoot",null,[e("tr",gt,[s[12]||(s[12]=e("td",{colspan:"17",class:"td"},"Total",-1)),e("td",te,a(i.value.cl),1),e("td",ee,a(i.value.ml),1),e("td",se,a(i.value.sl),1),e("td",ae,a(i.value.wplDays),1),s[13]||(s[13]=e("td",{class:"td"},null,-1)),s[14]||(s[14]=e("td",{class:"td"},null,-1)),e("td",ne,a(i.value.otHour),1),e("td",de,a(i.value.absentDays)+" day",1),e("td",re,a(i.value.wplHour),1),e("td",ce,a(i.value.paycutHour),1),e("td",le,a(i.value.payableHour),1),s[15]||(s[15]=e("td",{class:"td"},null,-1))])])])])):(_(),h("div",it," Please select company "))])}}},ke=tt(oe,[["__scopeId","data-v-d9158d1b"]]);export{ke as default};
