import{G as A,r as f,p as v,H as o}from"./index-a28d4SfU.js";const L=A("task",()=>{const i=f([]),d=f(null),c=f(!1),n=f(null),p=f(1),w=f(!0),T=async(e,l,{updateStoreData:a=!0})=>{var t,r;a==!0&&(c.value=!0,n.value=null);try{await o.post(`/tasks/${e}/assign-users`,{user_ids:l}),await y(e)}catch(s){throw a==!0&&(n.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Assign users failed"),s}finally{a==!0&&(c.value=!1)}};function m(){p.value=1,i.value=[]}async function $(e,l={}){var a,t,r;n.value=null;try{const s={...e,per_page:5e3};c.value=!0;const u=await o.get("/tasks",{params:s,...l});return i.value=((a=u.data)==null?void 0:a.tasks)||[],c.value=!1,u.data}catch(s){throw n.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",s}}const _=async(e,l)=>{var a,t,r;n.value=null;try{const s=await o.get("/my-tasks",{params:e,...l});return i.value=((a=s.data)==null?void 0:a.tasks)||[],s.data}catch(s){throw n.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",s),s}};function k(e,l=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>a.parent_id===l).map(a=>({...a,children_tasks:k(e,a.id)}))}function h(){return k(i.value,0)}function E(){const e=[],l=(a,t=0,r="")=>{a.forEach(s=>{e.push({...s,depth:t,idPath:r+s.id}),s.children_tasks&&s.children_tasks.length&&l(s.children_tasks,t+1,r+s.id+"-")})};return l(h()),e}const y=async(e,l={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,r,s;a.fetchOnly||(c.value=!0),n.value=null;try{const u=await o.get(`/tasks/${e}`,{params:l});return a.fetchOnly||(d.value=((t=u.data)==null?void 0:t.task)||{},i.value=u.data.sub_tasks||[]),u.data}catch(u){const g=((s=(r=u.response)==null?void 0:r.data)==null?void 0:s.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(n.value=g),g}finally{a.fetchOnly||(c.value=!1)}},O=async(e,l={loadingBeforeCreate:!1})=>{var a,t,r,s;l.loadingBeforeCreate&&(c.value=!0),n.value=null;try{const u=await o.post("/tasks",e);return(a=u.data)!=null&&a.data&&i.value.push((t=u.data)==null?void 0:t.data),u.data.data}catch(u){throw n.value=((s=(r=u.response)==null?void 0:r.data)==null?void 0:s.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",u),u}finally{l.loadingBeforeCreate&&(c.value=!1)}},C=async(e,l,{loadingBeforeFetch:a=!0})=>{a&&(c.value=!0),n.value=null;try{const t=await o.put(`/tasks/${e}`,l),r=i.value.findIndex(s=>s.id===e);return r!==-1&&(i.value[r]=t.data.data),t.data.data}catch(t){throw t}finally{a&&(c.value=!1)}},P=async(e,l)=>(await o.put(`/tasks/${e}/update-priorities`,{task_ids:l})).data,q=async e=>{var l,a;c.value=!0,n.value=null;try{await o.delete(`/tasks/${e}`),i.value=i.value.filter(t=>t.id!==e)}catch(t){throw n.value=((a=(l=t.response)==null?void 0:l.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,t),t}finally{c.value=!1}},x=async(e,l)=>{var a,t;c.value=!0,n.value=null;try{await o.patch(`/tasks/${e}/update-requirement-detail/${l}`),i.value=i.value.filter(r=>r.id!==e)}catch(r){throw n.value=((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||`টাস্ক (ID: ${e}) রেকয়্যারমেন্ট সেট করতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,r),r}finally{c.value=!1}};return{tasks:v(()=>i.value),task:v(()=>d.value),loading:v(()=>c.value),error:v(()=>n.value),taskListTree:v(h),flattenedTasks:v(E),fetchTasks:$,hasMoreTask:w,fetchMyTasks:_,resetTaskList:m,fetchTask:y,createTask:O,updateTask:C,deleteTask:q,assignUsers:T,updateTaskPriorities:P,setTaskRequirement:x}});export{L as u};
