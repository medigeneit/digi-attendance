import{N as ce,u as ve,b as be,r as u,s as ee,m as i,z as fe,A as k,e as ge,n as ye,c as _,o as f,a as t,g as M,f as xe,w as he,t as d,x as v,h as O,v as q,p as D,j as P,M as _e,i as we}from"./index-C1bkql9t.js";import{L as Ce}from"./LoaderView-Zi2oAX2g.js";import{_ as I}from"./MultiselectDropdown-aOvTGvyn.js";import{_ as ke}from"./TextEditor-TF-g8490.js";import{u as De}from"./company-BdLT_OVZ.js";import{u as Ve}from"./department-Cl1VtWwF.js";import{u as Ne}from"./notice-cwd4Yor3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-C49UNmET.js";const je={class:"my-container space-y-4"},Se={class:"card-bg md:p-8 p-4 mx-4"},Ee={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},ze={class:"rounded-xl border bg-white p-4 flex items-center justify-between"},Ue={class:"flex items-center gap-3"},Ae={class:"font-semibold"},Be={class:"rounded-xl border bg-white p-4 flex items-center justify-between"},Me={class:"flex items-center gap-3"},Pe={class:"font-semibold"},$e={class:"rounded-xl border bg-white p-4"},Fe={class:"flex items-center justify-between"},Le={class:"flex items-center gap-3"},Re={class:"font-semibold"},Te={class:"border p-4 rounded-xl bg-white space-y-6 shadow-sm"},He={class:"grid md:grid-cols-3 gap-4"},Ge={class:"w-full"},Je={class:"inline-flex rounded-lg border overflow-hidden"},Oe={class:"w-full"},qe={class:"w-full"},Ie={key:0,class:"text-xs text-red-600 mt-1"},Xe={class:"space-y-3"},Ke={class:"flex items-center justify-between"},Qe={class:"inline-flex rounded-lg border overflow-hidden"},We={class:"grid md:grid-cols-2 gap-6"},Ye={class:"space-y-3"},Ze={class:"flex items-center justify-between"},et={class:"inline-flex rounded-lg border overflow-hidden"},tt={class:"space-y-3"},lt={class:"flex items-center justify-between"},st={class:"inline-flex items-center gap-3"},at={class:"text-xs text-gray-500"},ot={class:"inline-flex rounded-lg border overflow-hidden"},nt={class:"border p-4 rounded-xl bg-white space-y-6 shadow-sm"},it={class:"space-y-2"},dt={key:0,class:"mb-2"},rt=["href"],ut={class:"w-full rounded-lg border border-dashed p-4 hover:bg-gray-50 transition"},pt={class:"flex items-center justify-between gap-3"},mt={class:"inline-flex items-center"},ct=["disabled"],vt={key:0,class:"mt-3"},bt={class:"h-2 bg-gray-200 rounded overflow-hidden"},ft={class:"flex items-center justify-between mt-1 text-xs text-gray-600"},gt={class:"sticky bottom-0 bg-white/90 backdrop-blur flex justify-center gap-4 p-3 rounded-xl border"},yt=["disabled"],xt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4"},ht={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 space-y-4"},_t={class:"text-sm text-gray-600 break-words"},wt={class:"flex justify-end gap-3"},At={__name:"NoticeEdit",setup(Ct){const p=ce(),X=ve(),$=be(),F=u(!1),V=u(!1),g=u(!0),L=Ne(),R=De(),r=Ve(),{companies:te}=ee(R),{employees:T}=ee(r),N=i(()=>r.departments||[]),j=i(()=>Array.isArray(T.value)?T.value:[]),w=i(()=>te.value||[]),l=fe({title:"",type:1,description:"",published_at:"",expired_at:"",all_companies:!1,all_departments:!1,all_employees:!1,file_url:null}),y=u([]),x=u([]),m=u([]),c=u(null),S=u(0),h=u(!1),E=u(!1);let C=null;const le=i(()=>{var s;return((s=c.value)==null?void 0:s.name)||""}),se=i(()=>c.value?(c.value.size/(1024*1024)).toFixed(2):"0.00"),H=i(()=>y.value.map(s=>s.id)),G=i(()=>x.value.map(s=>s.id)),ae=i(()=>m.value.map(s=>s.id)),K=s=>{if(!s)return"";const e=String(s).split(" ")[0];return e.includes("-")?e:""},J=i(()=>{if(l.type===2||!l.published_at||!l.expired_at)return!0;try{const s=new Date(l.published_at);return new Date(l.expired_at)>=s}catch{return!0}}),oe=i(()=>!!l.title&&!h.value&&J.value),z=i({get:()=>l.all_companies?"all":"custom",set:s=>{l.all_companies=s==="all",y.value=l.all_companies?[...w.value]:[]}}),U=i({get:()=>l.all_departments?"all":"custom",set:s=>{l.all_departments=s==="all",x.value=l.all_departments?[...N.value]:[]}}),A=i({get:()=>l.all_employees?"all":"custom",set:s=>{l.all_employees=s==="all",m.value=l.all_employees?[...j.value]:[]}});k(()=>l.all_companies,async s=>{g.value||s&&await r.fetchDepartments()}),k(H,async s=>{g.value||l.all_companies||await r.fetchDepartments(s)}),k(()=>l.all_departments,async s=>{g.value||s&&await r.fetchDepartmentEmployee("all")}),k(G,async s=>{g.value||l.all_departments||await r.fetchDepartmentEmployee(s)}),k([m,T],([s,e])=>{if(g.value)return;const o=Array.isArray(e)?e.length:0;l.all_employees=o>0&&s.length===o});const ne=async()=>{var e,o,a,b,W;const s=$.params.id;try{const n=await L.fetchNotice(s);l.title=n.title??"",l.type=Number(n.type??1),l.published_at=K(n.published_at),l.expired_at=K(n.expired_at),l.description=n.description??"",l.file_url=n.file_url||n.file||null;const B=(((e=n.companies_notice)==null?void 0:e.length)??0)>0;l.all_companies=!B,w.value.length===0&&await R.fetchCompanies(),y.value=B?n.companies_notice:[...w.value],l.all_companies?await r.fetchDepartments():await r.fetchDepartments(H.value);const Y=(((o=n.departments)==null?void 0:o.length)??0)>0;l.all_departments=!Y,x.value=Y?n.departments:[...N.value],l.all_departments?await r.fetchDepartmentEmployee("all"):await r.fetchDepartmentEmployee(G.value);const Z=(((a=n.employees)==null?void 0:a.length)??0)>0;l.all_employees=!Z,m.value=Z?n.employees:[...j.value]}catch(n){const B=((W=(b=n==null?void 0:n.response)==null?void 0:b.data)==null?void 0:W.message)||"Failed to load notice data";p.error(B),X.push({name:"NoticeList"})}},ie=s=>{var a,b;const e=(b=(a=s==null?void 0:s.target)==null?void 0:a.files)==null?void 0:b[0];if(!e)return;if(!["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)){p.error("Unsupported file type. Allowed: jpg, jpeg, png, pdf, doc, docx.");return}if(e.size>2*1024*1024){p.error("File size must be ≤ 2MB.");return}c.value=e,E.value=!0},de=async()=>{var s,e;try{const o=$.params.id;if(!(c.value instanceof Blob))return;S.value=0,h.value=!0,C=new AbortController;const a=await L.updateNoticeFile(o,c.value,{onProgress:b=>S.value=b,signal:C.signal});l.file_url=(a==null?void 0:a.file_url)||(a==null?void 0:a.file)||l.file_url,p.success("File uploaded successfully.")}catch(o){if((o==null?void 0:o.name)==="CanceledError"||(o==null?void 0:o.message)==="canceled")p.info("Upload canceled.");else{const a=((e=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Upload failed.";p.error(a)}}finally{h.value=!1,E.value=!1,c.value=null,C=null}},re=()=>{C&&C.abort()},ue=async()=>{var s,e;if(!J.value){p.error("Expire date must be the same or after Publish date.");return}try{V.value=!0;const o=$.params.id,a={title:l.title,type:l.type,description:l.description,published_at:l.type===2?null:l.published_at||null,expired_at:l.type===2?null:l.expired_at||null,all_companies:!!l.all_companies,all_departments:!!l.all_departments,all_employees:!!l.all_employees,company_ids:H.value,department_ids:G.value,employee_ids:ae.value};await L.updateNotice(o,a),p.success("Notice updated successfully"),X.push({name:"NoticeShow",params:{id:o}})}catch(o){const a=((e=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Failed to update notice";p.error(a)}finally{V.value=!1}};ge(async()=>{F.value=!0,await R.fetchCompanies(),await ne(),F.value=!1,g.value=!1});const pe=i(()=>w.value.length),me=i(()=>N.value.length),Q=i(()=>j.value.length);return(s,e)=>{const o=ye("RouterLink");return f(),_("div",je,[t("div",Se,[e[37]||(e[37]=t("h2",{class:"title-lg text-center"},"Edit Notice",-1)),F.value?(f(),xe(Ce,{key:0,class:"bg-gray-100 border shadow-none"})):(f(),_("form",{key:1,onSubmit:he(ue,["prevent"]),class:"space-y-5"},[t("div",Ee,[t("div",ze,[t("div",Ue,[e[17]||(e[17]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-blue-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-blue-600"},[t("path",{fill:"currentColor",d:"M3 10v10h18V10H3zm9-7l9 7H3l9-7z"})])],-1)),t("div",null,[e[16]||(e[16]=t("div",{class:"text-sm text-gray-500"},"Companies",-1)),t("div",Ae,d(l.all_companies?"All":y.value.length)+" / "+d(pe.value),1)])])]),t("div",Be,[t("div",Me,[e[19]||(e[19]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-purple-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-purple-600"},[t("path",{fill:"currentColor",d:"M3 5h18v2H3V5zm3 4h12v10H6V9z"})])],-1)),t("div",null,[e[18]||(e[18]=t("div",{class:"text-sm text-gray-500"},"Departments",-1)),t("div",Pe,d(l.all_departments?"All":x.value.length)+" / "+d(me.value),1)])])]),t("div",$e,[t("div",Fe,[t("div",Le,[e[21]||(e[21]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-emerald-600"},[t("path",{fill:"currentColor",d:"M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"})])],-1)),t("div",null,[e[20]||(e[20]=t("div",{class:"text-sm text-gray-500"},"Employees",-1)),t("div",Re,d(l.all_employees?"All":m.value.length)+" / "+d(Q.value),1)])])])])]),t("div",Te,[e[28]||(e[28]=t("h2",{class:"text-lg font-semibold"},"Notice Information",-1)),t("div",He,[t("div",Ge,[e[22]||(e[22]=t("label",{for:"type",class:"font-medium block mb-1"},"Type*",-1)),t("div",Je,[t("button",{type:"button",class:v(["px-4 py-2 text-sm",l.type===1?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[0]||(e[0]=a=>l.type=1)}," General ",2),t("button",{type:"button",class:v(["px-4 py-2 text-sm border-l",l.type===2?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[1]||(e[1]=a=>l.type=2)}," Policy ",2)])]),t("div",Oe,[e[23]||(e[23]=t("label",{class:"font-medium block mb-1"},"Publish Date",-1)),O(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>l.published_at=a),type:"date",class:"w-full p-2 border rounded"},null,512),[[q,l.published_at]])]),t("div",qe,[e[24]||(e[24]=t("label",{class:"font-medium block mb-1"},"Expire Date",-1)),O(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.expired_at=a),type:"date",class:"w-full p-2 border rounded"},null,512),[[q,l.expired_at]]),J.value?M("",!0):(f(),_("p",Ie," Expire date must be the same or after Publish date. "))])]),t("div",Xe,[t("div",Ke,[e[25]||(e[25]=t("label",{class:"font-medium"},"Companies",-1)),t("div",Qe,[t("button",{type:"button",class:v(["px-3 py-1.5 text-xs",z.value==="all"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[4]||(e[4]=a=>z.value="all")},"All",2),t("button",{type:"button",class:v(["px-3 py-1.5 text-xs border-l",z.value==="custom"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[5]||(e[5]=a=>z.value="custom")},"Custom",2)])]),t("div",null,[D(I,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=a=>y.value=a),options:w.value,multiple:!0,searchable:!0,placeholder:"Select companies","track-by":"id",label:"name"},null,8,["modelValue","options"])])]),t("div",We,[t("div",Ye,[t("div",Ze,[e[26]||(e[26]=t("label",{class:"font-medium"},"Departments",-1)),t("div",et,[t("button",{type:"button",class:v(["px-3 py-1.5 text-xs",U.value==="all"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[7]||(e[7]=a=>U.value="all")},"All",2),t("button",{type:"button",class:v(["px-3 py-1.5 text-xs border-l",U.value==="custom"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[8]||(e[8]=a=>U.value="custom")},"Custom",2)])]),D(I,{modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=a=>x.value=a),options:N.value,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name"},null,8,["modelValue","options"])]),t("div",tt,[t("div",lt,[e[27]||(e[27]=t("label",{class:"font-medium"},"Employees",-1)),t("div",st,[t("span",at," Selected "+d(m.value.length)+" / "+d(Q.value),1),t("div",ot,[t("button",{type:"button",class:v(["px-3 py-1.5 text-xs",A.value==="all"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[10]||(e[10]=a=>A.value="all")},"All",2),t("button",{type:"button",class:v(["px-3 py-1.5 text-xs border-l",A.value==="custom"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[11]||(e[11]=a=>A.value="custom")},"Custom",2)])])]),D(I,{modelValue:m.value,"onUpdate:modelValue":e[12]||(e[12]=a=>m.value=a),options:j.value,multiple:!0,searchable:!0,placeholder:"Select employee","track-by":"id",label:"name"},null,8,["modelValue","options"])])])]),t("div",nt,[e[35]||(e[35]=t("h2",{class:"text-lg font-semibold"},"Notice Content",-1)),t("div",null,[e[29]||(e[29]=t("label",{class:"font-medium block mb-1"},"Title*",-1)),O(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>l.title=a),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[q,l.title]])]),t("div",it,[e[33]||(e[33]=t("label",{class:"font-medium block mb-1"},"Attachment",-1)),l.file_url?(f(),_("div",dt,[t("a",{href:l.file_url,target:"_blank",class:"inline-flex items-center gap-2 text-blue-600 underline"},e[30]||(e[30]=[t("svg",{viewBox:"0 0 24 24",class:"h-4 w-4"},[t("path",{fill:"currentColor",d:"M14 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),t("path",{fill:"currentColor",d:"M14 3v6h6"})],-1),P(" View Current File ")]),8,rt)])):M("",!0),t("div",ut,[t("div",pt,[e[32]||(e[32]=t("div",{class:"text-sm text-gray-600"},[t("div",{class:"font-medium"},"Upload new file"),t("div",null,"JPG, JPEG, PNG, PDF, DOC, DOCX (≤ 2MB)")],-1)),t("label",mt,[t("input",{type:"file",accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",onChange:ie,class:"hidden",disabled:h.value},null,40,ct),e[31]||(e[31]=t("span",{class:"px-4 py-2 rounded border bg-white hover:bg-gray-50 cursor-pointer"}," Browse… ",-1))])]),h.value?(f(),_("div",vt,[t("div",bt,[t("div",{class:"h-2 bg-blue-600 transition-all",style:_e({width:S.value+"%"})},null,4)]),t("div",ft,[t("span",null,d(S.value)+"%",1),t("button",{type:"button",class:"px-3 py-1 rounded border hover:bg-gray-50",onClick:re}," Cancel ")])])):M("",!0)])]),t("div",null,[e[34]||(e[34]=t("label",{class:"font-medium block mb-1"},"Description",-1)),D(ke,{modelValue:l.description,"onUpdate:modelValue":e[14]||(e[14]=a=>l.description=a),class:"w-full px-4 py-2"},null,8,["modelValue"])])]),t("div",gt,[D(o,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:we(()=>e[36]||(e[36]=[P(" Cancel ")])),_:1,__:[36]}),t("button",{disabled:V.value||h.value||!oe.value,type:"submit",class:"bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 disabled:opacity-60"},d(V.value?"Saving…":"Save"),9,yt)])],32))]),E.value?(f(),_("div",xt,[t("div",ht,[e[41]||(e[41]=t("h3",{class:"text-lg font-semibold"},"Upload this file?",-1)),t("p",_t,[e[38]||(e[38]=t("span",{class:"font-medium"},"Name:",-1)),P(" "+d(le.value),1),e[39]||(e[39]=t("br",null,null,-1)),e[40]||(e[40]=t("span",{class:"font-medium"},"Size:",-1)),P(" "+d(se.value)+" MB ",1)]),t("div",wt,[t("button",{class:"px-4 py-2 rounded border hover:bg-gray-50",onClick:e[15]||(e[15]=a=>{E.value=!1,c.value=null})}," Cancel "),t("button",{class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",onClick:de}," Upload ")])])])):M("",!0)])}}};export{At as default};
