import{H as A,d as R,c as o,g as $,k as p,o as a,a as t,m as k,F as S,y as L,x as U,j as N,t as M,r as C,A as E,e as H,p as I,h as O,v as G,I as B,u as F,w as K,f as j,l as te,J as z,K as se,L as ne,n as ae,i as Y,b as oe}from"./index-CKoKWZwY.js";import{u as re}from"./company-Cb442DqS.js";import{u as le}from"./department-I9L-2isN.js";import{u as ie}from"./user-BK1xCW8_.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={__name:"AddNewButton",setup(l){const e=A(),r=R(),s=()=>{e.openAddModal=!0};return(n,d)=>{var m;return["admin","super_admin","developer"].includes((m=p(r).user)==null?void 0:m.role)?(a(),o("div",{key:0,onClick:s,title:"Add New Conversation",class:"size-10 shrink-0 grow-0 flex justify-center items-center"},d[0]||(d[0]=[t("i",{class:"fas fa-comment-alt-plus text-3xl cursor-pointer text-[#24A1DE]"},null,-1)]))):$("",!0)}}},ue={class:"flex justify-center items-center gap-3"},ce=["onClick"],me={__name:"ConversationTypeSelector",props:{modelValue:{type:String,default:""},onSelect:{tyep:Function,default:()=>{}}},emits:["update:modelValue"],setup(l,{emit:e}){const r=l,s=e,n=k(()=>[{label:"Direct",value:"direct",iconClass:"fas fa-handshake"},{label:"Group",value:"group",iconClass:"fas fa-users"}]);function d(m){s("update:modelValue",m.value),r.onSelect()}return(m,v)=>(a(),o("div",ue,[(a(!0),o(S,null,L(n.value,u=>(a(),o("button",{key:u.value,class:U(["cursor-pointer px-6 py-1 border rounded-lg transition font-bold",l.modelValue===u.value?"bg-sky-600 text-white border-sky-600":"hover:bg-gray-50"]),onClick:y=>d(u)},[t("i",{class:U(u.iconClass)},null,2),N(" "+M(u.label),1)],10,ce))),128))]))}},ve={class:"flex flex-col md:flex-row justify-center md:items-center gap-2"},pe=["value"],fe={__name:"GroupTitleInput",props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(l,{emit:e}){return(r,s)=>(a(),o("div",ve,[s[1]||(s[1]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"}," Group Title ",-1)),t("input",{id:"title",value:l.modelValue,onInput:s[0]||(s[0]=n=>r.$emit("update:modelValue",n.target.value)),type:"text",class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},null,40,pe)]))}},ye={class:"grid sm:grid-cols-2 gap-4"},ge={class:"flex flex-row justify-center items-center gap-2"},xe=["value"],he=["value"],be={class:"flex flex-row justify-center items-center gap-2"},_e=["value","disabled"],we=["value"],Ce={__name:"CompanyDepartmentFilter",props:{companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""}},emits:["update:companyId","update:departmentId"],setup(l,{emit:e}){return(r,s)=>(a(),o("div",ye,[t("div",ge,[s[3]||(s[3]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Company",-1)),t("select",{value:l.companyId,onChange:s[0]||(s[0]=n=>r.$emit("update:companyId",n.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500"},[s[2]||(s[2]=t("option",{value:""},"-- Company --",-1)),(a(!0),o(S,null,L(l.companies,n=>(a(),o("option",{key:n.id,value:n.id},M(n.name),9,he))),128))],40,xe)]),t("div",be,[s[5]||(s[5]=t("label",{for:"title",class:"text-sm text-gray-700 shrink-0 w-20 text-right"},"Department",-1)),t("select",{value:l.departmentId,disabled:!l.companyId,onChange:s[1]||(s[1]=n=>r.$emit("update:departmentId",n.target.value)),class:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60"},[s[4]||(s[4]=t("option",{value:""},"-- Department --",-1)),(a(!0),o(S,null,L(l.departments,n=>(a(),o("option",{key:n.id,value:n.id},M(n.name),9,we))),128))],40,_e)])]))}},ke={class:"grid gap-2"},Ie={key:0,class:"flex flex-wrap gap-2"},$e={class:"font-medium"},Me=["onClick"],Se={class:"flex items-center gap-2"},Ue=["disabled"],Ae={class:"max-h-72 overflow-y-auto rounded-lg rounded-t-none border"},je={key:0,class:"p-4 text-gray-500 text-center"},Le={key:0,class:"p-4 text-center text-gray-600"},De={key:1,class:"divide-y"},Te=["for"],Ee={class:"w-full grow flex items-center gap-3"},Ne=["title"],Ve={class:"leading-tight"},Re={class:"font-medium text-sm md:text-base"},He={class:"text-xs text-gray-500"},ze={class:"w-14 md:w-auto md:shrink-0 inline-flex justify-center items-center text-right"},Be={key:0,class:"text-gray-500 text-xs text-center"},Oe=["id","type","name","checked","onChange"],W={__name:"UserPicker",props:{mode:{type:String,required:!0},users:{type:Array,default:()=>[]},companyId:{type:[String,Number],default:""},departmentId:{type:[String,Number],default:""},selectedUserIds:{type:Array,default:()=>[]},alreadyAddedUserIds:{type:Array,default:()=>[]}},emits:["update:companyId","update:departmentId","update:selectedUserIds"],setup(l,{emit:e}){const r=l,s=e,n=re(),d=le(),m=ie(),v=R(),u=k({get:()=>r.companyId,set:x=>s("update:companyId",x)}),y=k({get:()=>r.departmentId,set:x=>s("update:departmentId",x)}),_=k({get:()=>r.selectedUserIds,set:x=>s("update:selectedUserIds",x)}),w=k(()=>n.companies||[]),h=k(()=>d.departments||[]),c=k(()=>m.users||[]),i=k(()=>{var x;return(x=r.users)!=null&&x.length?r.users:c.value}),g=C(""),D=k(()=>{if(!g.value.trim())return i.value;const x=g.value.trim().toLowerCase();return i.value.filter(b=>{const f=(b.name||"").toLowerCase(),T=String(b.employee_id||"").toLowerCase(),V=String(b.phone||"").toLowerCase(),q=String(b.email||"").toLowerCase();return f.includes(x)||T.includes(x)||V.includes(x)||q.includes(x)})}),P=k(()=>!u.value);function Z(x){let b=[..._.value];const f=b.indexOf(x.id);r.mode==="direct"?b=f>=0?[]:[x.id]:f>=0?b.splice(f,1):b.push(x.id),_.value=b}function ee(x){var f;const b=(f=i.value)==null?void 0:f.find(T=>parseInt(T.id)==parseInt(x));return b?b.name||b.employee_id||b.id:""}return E(()=>u.value,async(x,b)=>{x!==b&&(y.value="",_.value=[],x&&await d.fetchDepartments(x),await m.fetchUsers({company_id:x||null,department_id:null}))}),E(()=>y.value,async(x,b)=>{x!==b&&(_.value=[],u.value&&await m.fetchUsers({company_id:u.value,department_id:x||null}))}),H(async()=>{!w.value.length&&n.fetchCompanies&&await n.fetchCompanies(),u.value&&(await d.fetchDepartments(u.value),await m.fetchUsers({company_id:u.value,department_id:y.value||null}))}),(x,b)=>(a(),o(S,null,[I(Ce,{"company-id":u.value,"onUpdate:companyId":b[0]||(b[0]=f=>u.value=f),"department-id":y.value,"onUpdate:departmentId":b[1]||(b[1]=f=>y.value=f),companies:w.value,departments:h.value},null,8,["company-id","department-id","companies","departments"]),t("div",ke,[l.mode==="group"&&l.selectedUserIds.length?(a(),o("div",Ie,[(a(!0),o(S,null,L(l.selectedUserIds,f=>(a(),o("span",{key:f,class:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-sm"},[t("span",$e,M(ee(f)),1),t("button",{type:"button",class:"text-red-600",onClick:T=>_.value=l.selectedUserIds.filter(V=>V!==f)}," ✕ ",8,Me)]))),128))])):$("",!0),t("div",null,[t("div",Se,[O(t("input",{"onUpdate:modelValue":b[2]||(b[2]=f=>g.value=f),type:"search",disabled:P.value,class:"flex-1 px-3 py-2 border rounded-lg rounded-b-none focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:opacity-60",placeholder:"Search by Name / Employee ID / Phone"},null,8,Ue),[[G,g.value]])]),t("div",Ae,[P.value?(a(),o("div",je,"Company নির্বাচন করুন।")):(a(),o(S,{key:1},[D.value.length?(a(),o("div",De,[(a(!0),o(S,null,L(D.value,f=>{var T,V;return a(),o(S,{key:f.id},[((V=(T=p(v))==null?void 0:T.user)==null?void 0:V.id)!==f.id?(a(),o("label",{key:0,for:`userId${f.id}`,class:"flex items-center justify-between gap-3 p-3 hover:bg-gray-50"},[t("div",Ee,[t("div",{class:"border rounded-full",title:f.name},[I(B,{user:f,size:"medium"},null,8,["user"])],8,Ne),t("div",Ve,[t("div",Re,M(f.name||"User #"+(f.employee_id??f.id)),1),t("div",He,M(f.employee_id||f.phone||f.email||""),1)])]),t("div",ze,[l.alreadyAddedUserIds.includes(f.id)?(a(),o("span",Be," Already Added ")):(a(),o("input",{key:1,id:`userId${f.id}`,type:l.mode==="direct"?"radio":"checkbox",name:l.mode==="direct"?"direct-user":"group-users",checked:l.selectedUserIds.includes(f.id),onChange:q=>Z(f),class:"size-5"},null,40,Oe))])],8,Te)):$("",!0)],64)}),128))])):(a(),o("div",Le," কোন ইউজার পাওয়া যায়নি। "))],64))])])])],64))}},Ge={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},Pe={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[100vh] md:max-h-[90%] overflow-y-auto"},qe={class:"flex flex-col gap-y-2 md:flex-row justify-between items-center"},Fe={key:0,class:"mt-4"},Ke={key:1,class:"text-red-600 text-sm"},Ye={class:"flex justify-between"},Je=["disabled"],We={__name:"AddNewConversationModal",setup(l){const e={DIRECT:"direct",GROUP:"group"},r=A(),s=F(),n=C(""),d=C(""),m=C(""),v=C(""),u=C([]),y=C(""),_=()=>{r.openAddModal=!1,w()};function w(){n.value="",d.value="",m.value="",v.value="",u.value=[],y.value=""}async function h(){var i;if(y.value="",!n.value){y.value="দয়া করে Conversation টাইপ নির্বাচন করুন।";return}if(((i=u.value)==null?void 0:i.length)==0){y.value="User নির্বাচন করুন।";return}const c=await r.createConversation({type:n.value,title:n.value=="group"?v.value:"",user_ids:u.value});r.openAddModal=!1,s.push({name:"Conversation Message",params:{conversationId:c}}),r.showMobileConversationList=!1,r.fetchUserConversations()}return(c,i)=>p(r).openAddModal?(a(),o("div",Ge,[t("div",Pe,[t("div",qe,[i[5]||(i[5]=t("h2",{class:"text-xl text-center font-semibold"},"Add New Conversation",-1)),I(me,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=g=>n.value=g),onSelect:()=>u.value=[]},null,8,["modelValue","onSelect"])]),i[9]||(i[9]=t("hr",{class:"mt-4"},null,-1)),n.value?(a(),o("form",{key:1,class:"space-y-3 mt-3",onSubmit:K(h,["prevent"])},[n.value===e.GROUP?(a(),j(fe,{key:0,modelValue:v.value,"onUpdate:modelValue":i[1]||(i[1]=g=>v.value=g)},null,8,["modelValue"])):$("",!0),I(W,{mode:n.value,"company-id":d.value,"onUpdate:companyId":i[2]||(i[2]=g=>d.value=g),"department-id":m.value,"onUpdate:departmentId":i[3]||(i[3]=g=>m.value=g),selectedUserIds:u.value,"onUpdate:selectedUserIds":i[4]||(i[4]=g=>u.value=g)},null,8,["mode","company-id","department-id","selectedUserIds"]),y.value?(a(),o("p",Ke,M(y.value),1)):$("",!0),i[8]||(i[8]=t("hr",null,null,-1)),t("div",Ye,[t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:_}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:n.value===e.DIRECT?u.value.length!==1:!v.value.trim()||u.value.length<2}," Create ",8,Je)])],32)):(a(),o("div",Fe,[t("div",{class:"rounded-md border border-dashed p-4 text-center text-gray-600"},[i[6]||(i[6]=t("div",{class:"py-4 text-xl leading-loose"},[N(" Conversation টাইপ (Direct / Group) সিলেক্ট করুন, "),t("br"),N(" তারপর নিচে ফিল্টার দেখাবে। ")],-1)),i[7]||(i[7]=t("p",{class:"pb-1"},"অথবা,",-1)),t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:_}," Cancel ")])]))])])):$("",!0)}},Qe={key:0,class:"fixed inset-0 w-screen h-screen bg-black/50 flex justify-center items-center z-[9999999]"},Xe={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90%] overflow-y-auto"},Ze={key:0,class:"text-red-600 text-sm"},et={class:"flex justify-between"},tt=["disabled"],st={__name:"AddNewMemberModal",setup(l){const e=A(),r=R();F();const s=C(""),n=C(""),d=C([]),m=C(""),v=()=>{e.openAddMemberModal=!1,u()};function u(){s.value="",n.value="",d.value=[],m.value=""}async function y(){var _;if(m.value="",((_=d.value)==null?void 0:_.length)==0){m.value="User নির্বাচন করুন।";return}e.activeConversationId&&await e.addConversationMembers(e.activeConversationId,{user_ids:d.value}),e.openAddMemberModal=!1}return H(async()=>{e.activeConversationId&&await e.fetchConversationById(e.activeConversationId)}),(_,w)=>{var h,c;return p(e).openAddMemberModal&&p(e).activeConversationId&&p(e).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((h=p(r).user)==null?void 0:h.role)?(a(),o("div",Qe,[t("div",Xe,[w[4]||(w[4]=te('<div class="flex justify-between items-center"><h2 class="text-xl text-center">Add New Members</h2><button class="bg-sky-600 text-white border-sky-600 cursor-pointer px-6 py-1 border rounded-lg transition font-bold"><i class="fas fa-users"></i> Group </button></div><hr class="mt-4">',2)),t("form",{class:"space-y-3 mt-3",onSubmit:K(y,["prevent"])},[I(W,{mode:"group","company-id":s.value,"onUpdate:companyId":w[0]||(w[0]=i=>s.value=i),"department-id":n.value,"onUpdate:departmentId":w[1]||(w[1]=i=>n.value=i),selectedUserIds:d.value,"onUpdate:selectedUserIds":w[2]||(w[2]=i=>d.value=i),alreadyAddedUserIds:((c=p(e).conversation)==null?void 0:c.user_ids)||[]},null,8,["company-id","department-id","selectedUserIds","alreadyAddedUserIds"]),m.value?(a(),o("p",Ze,M(m.value),1)):$("",!0),w[3]||(w[3]=t("hr",null,null,-1)),t("div",et,[t("button",{type:"button",class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",onClick:v}," Cancel "),t("button",{type:"submit",class:"px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700 disabled:opacity-60",disabled:d.value.length<1}," Create ",8,tt)])],32)])])):$("",!0)}}},nt={class:"py-px text-xs md:text-sm bg-gray-300 text-black italic font-thin rounded-lg px-4 z-10"},at={__name:"ChatMessageUnreadMarker",setup(l){const e=A(),r=C(!1),s=new Set,n=C(null);let d=null;async function m(){console.log("read calling..."),r.value=!0;try{e.activeConversationId&&await e.readAllForActiveConversation(e.activeConversationId)}catch{}finally{r.value=!1}}const v=k(()=>{var h;return((h=e.activeConversation)==null?void 0:h.id)??null}),u=k(()=>{var h,c;return(((c=(h=e.activeConversation)==null?void 0:h.unread)==null?void 0:c.count)??0)>0}),y=k(()=>{var h,c;return(((c=(h=e.activeConversation)==null?void 0:h.unread)==null?void 0:c.last_read_message_id)??0)===0});function _(){if(!n.value||d)return;const h=document.querySelector("#chatScroll")||null;d=new IntersectionObserver(c=>{const i=c[0];if(i.isIntersecting&&i.intersectionRatio>.6){const g=v.value;g&&!s.has(g)&&(s.add(g),m()),w()}},{root:h,threshold:[0,.6,1]}),d.observe(n.value)}function w(){d&&(d.disconnect(),d=null)}return E([u,v],async([h,c])=>{w(),!(!h||!c||s.has(c))&&(await z(),_())},{immediate:!0}),se(w),(h,c)=>{var i,g;return u.value?(a(),o("div",{key:0,ref_key:"bannerRef",ref:n,class:U(["relative flex justify-center items-center",y.value?"order-1":"order-3"])},[t("p",nt,M((g=(i=p(e).activeConversation)==null?void 0:i.unread)==null?void 0:g.count)+" unread message ",1),c[0]||(c[0]=t("span",{class:"absolute h-2 bg-gray-300 left-0 right-0 top-1/2 -translate-y-1/2 w-full rounded-lg"},null,-1))],2)):$("",!0)}}},ot={class:"px-2 md:px-4 grid gap-4"},rt={key:0,class:"flex flex-wrap gap-x-0.5 md:gap-x-1 items-center justify-center"},lt={class:"text-xs md:text-sm"},it=["innerHTML"],dt={key:1},ut={class:"border rounded-lg max-w-lg w-full min-w-40 md:min-w-80"},ct={class:"grow w-full flex items-center gap-1"},mt={class:"font-semibold sm:inline-block text-sm line-clamp-1"},vt={class:"shrink md:shrink-0 text-[10px] md:text-xs mt-1 text-right"},pt=["innerHTML"],ft={__name:"ChatMessageCard",props:{message:{type:Object,required:!0},index:Number},setup(l){R();const e=A(),r=l,s=k(()=>r.message.is_own_message),n=k(()=>r.message.type==="system"),d=k(()=>{var u;const m=(u=e.activeConversation)==null?void 0:u.unread;if(!(m!=null&&m.count))return!1;const v=m.last_read_message_id??0;return v===0?r.index===0:r.message.id===v});return(m,v)=>{var u,y;return a(),o("div",ot,[t("div",{class:U(["flex order-2",{"justify-end pl-6 md:pl-12":!n.value&&s.value,"justify-start pr-6 md:pr-12":!n.value&&!s.value,"justify-center":n.value}])},[n.value?(a(),o("div",rt,[v[0]||(v[0]=t("i",{class:"far fa-cog text-gray-700 text-xs md:text-base"},null,-1)),t("strong",lt,M(s.value?"You":(u=l.message.sender)==null?void 0:u.name),1),t("div",{innerHTML:l.message.body,class:"block text-xs md:text-sm italic whitespace-pre-wrap break-words leading-relaxed"},null,8,it)])):(a(),o("div",dt,[t("div",ut,[t("div",{class:U(["flex justify-between items-center p-1 rounded-t-lg gap-1 md:gap-4",{"bg-[#24A1DE] text-white":s.value,"bg-gray-200 text-black":!s.value}])},[t("div",ct,[I(B,{user:l.message.sender,size:"small"},null,8,["user"]),t("div",mt,M((y=l.message.sender)==null?void 0:y.name),1)]),t("div",vt,M(l.message.send_at),1)],2),t("div",{class:"block py-1 px-2 rounded-b-lg bg-white text-xs md:text-sm whitespace-pre-wrap break-words leading-relaxed",innerHTML:l.message.body},null,8,pt)]),t("div",{class:U(["flex",{"justify-end":s.value,"justify-start":!s.value}])},[t("div",{class:U(["flex flex-wrap gap-1 max-w-[280px] pt-1",{"justify-end":s.value,"justify-start":!s.value}])},[(a(!0),o(S,null,L(l.message.last_readers,_=>(a(),j(B,{key:_.id,title:_.name,user:_,size:"xsmall"},null,8,["title","user"]))),128))],2)],2)]))],2),d.value?(a(),j(at,{key:0})):$("",!0)])}}},yt={},gt={class:"flex justify-center items-center py-4"};function xt(l,e){return a(),o("div",gt,e[0]||(e[0]=[t("i",{class:"fas fa-spinner fa-spin text-2xl text-[#24A1DE]"},null,-1)]))}const Q=de(yt,[["render",xt]]),ht={key:1,class:"text-red-500 text-center my-4"},bt={key:2,class:"text-center text-gray-500 my-4"},_t={key:0,class:"text-xs text-gray-400 text-center py-2"},wt={__name:"ChatMessageContainer",setup(l){const e=A(),r=R(),s=C(!1),n=C(null),d=C(!0),m=C(!1);let v=null;function u(){const c=e.activeConversationId;c&&(v&&v.stopListening(".message.created"),v=window.Echo.private(`chat.${c}`).subscribed(()=>console.log(`[SUBSCRIBED] chat.${c}`)).error(i=>console.error("[CHANNEL ERROR]",i)).listen(".message.created",i=>{console.log("[EVENT]",i),e.messages.push(i.message)}))}H(async()=>{await h(),r.user||await r.fetchUser(),E(()=>e.activeConversationId,u,{immediate:!0})});const y=(c,i=80)=>c.scrollHeight-c.scrollTop-c.clientHeight<i,_=async(c="auto")=>{await z();const i=n.value;i&&(i.scrollTo({top:i.scrollHeight,behavior:c}),d.value=!0)},w=async()=>{const c=n.value;if(c&&(d.value=y(c),c.scrollTop<=0&&e.hasMore&&!m.value)){m.value=!0;const i=c.scrollHeight,g=c.scrollTop;try{await e.fetchOlderMessages(e.activeConversationId),await z();const D=c.scrollHeight;c.scrollTop=D-(i-g)}catch{}finally{m.value=!1}}},h=async()=>{s.value=!0;try{e.activeConversationId&&(await e.fetchConversationMessages(e.activeConversationId),await _("auto"))}catch{}finally{s.value=!1}};return E(()=>e.activeConversationId,async(c,i)=>{c&&c!==i&&await h()}),E(()=>e.messages.length,async(c,i)=>{const g=n.value;g&&c>i&&y(g,120)&&await _("smooth")}),k(()=>!d.value&&!!e.activeConversationId),(c,i)=>(a(),o("div",{ref_key:"scrollEl",ref:n,onScroll:w,class:U(["w-full overflow-y-auto h-[calc(100dvh-150px)] scrollbar-hide relative flex flex-col",{"items-center justify-center":!p(e).activeConversationId||p(e).error||s.value}])},[s.value?(a(),j(Q,{key:0})):$("",!0),p(e).error?(a(),o("div",ht,M(p(e).error),1)):p(e).activeConversationId?(a(),o(S,{key:3},[m.value?(a(),o("div",_t,"Loading older…")):$("",!0),(a(!0),o(S,null,L(p(e).messages,(g,D)=>(a(),j(ft,{key:g.id,message:g,class:"w-full my-4",index:D},null,8,["message","index"]))),128))],64)):(a(),o("div",bt," Please select a conversation to view messages. ")),ne(c.$slots,"default")],34))}},Ct={key:0},kt={__name:"AddNewMemberButton",setup(l){const e=A(),r=R();return(s,n)=>{var d;return p(e).activeConversationId&&p(e).activeConversation.type==="group"&&["admin","super_admin","developer"].includes((d=p(r).user)==null?void 0:d.role)?(a(),o("div",Ct,[t("div",{class:"size-8 rounded-full text-sm border flex justify-center items-center cursor-pointer",title:"Add New Members",onClick:n[0]||(n[0]=m=>p(e).openAddMemberModal=!0)},n[1]||(n[1]=[t("i",{class:"fas fa-user-plus"},null,-1)]))])):$("",!0)}}},It={class:"min-w-max size-8 md:size-12 flex justify-center items-center text-[#24A1DE] bg-white rounded-full overflow-hidden border"},$t=["src"],Mt={key:0,class:"fas fa-users md:text-3xl"},St={key:1,class:"fas fa-user md:text-3xl"},X={__name:"ConversationAvatar",props:{conversation:{type:Object,required:!0}},setup(l){const e=C(!0);return(r,s)=>{var n,d;return a(),o("div",null,[t("div",It,[(n=l.conversation)!=null&&n.avatar&&e.value?(a(),o("img",{key:0,onError:s[0]||(s[0]=m=>e.value=!1),src:(d=l.conversation)==null?void 0:d.avatar,alt:"Photo",class:"object-cover w-full h-full aspect-square"},null,40,$t)):(a(),o(S,{key:1},[l.conversation.type==="group"?(a(),o("i",Mt)):(a(),o("i",St))],64))])])}}},Ut={class:"bg-[#24A1DE] border-b border-[#24A1DE] text-white h-[48px] md:h-[56px] flex items-center"},At={key:0,class:"w-full flex items-center justify-start gap-2 px-1 py-[3px]"},jt={class:"md:text-lg font-semibold line-clamp-1"},Lt={key:0,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Dt={key:1,class:"text-xs md:text-sm text-gray-50 flex items-center gap-1 font-thin"},Tt={__name:"ConversationHeader",setup(l){const e=A();return(r,s)=>{var n,d,m;return a(),o("div",Ut,[(d=(n=p(e))==null?void 0:n.activeConversation)!=null&&d.id?(a(),o("div",At,[I(X,{conversation:p(e).activeConversation},null,8,["conversation"]),t("div",null,[t("h3",jt,M((m=p(e).activeConversation)==null?void 0:m.title),1),p(e).activeConversation.type==="group"?(a(),o("div",Lt,s[0]||(s[0]=[t("i",{class:"fas fa-users"},null,-1),t("i",{class:"line-clamp-1"},"Group chatting",-1)]))):(a(),o("div",Dt,s[1]||(s[1]=[t("i",{class:"fas fa-handshake"},null,-1),t("i",{class:"line-clamp-1"},"One to One chatting",-1)])))]),I(kt,{class:"ml-auto md:mr-3"})])):$("",!0)])}}},Et={class:"flex items-center gap-2 relative"},Nt=["title"],Vt=["innerHTML"],Rt={key:0,class:"absolute right-0 top-1/2 -translate-y-1/2"},Ht={class:"flex justify-center items-center size-5 text-[9px] text-white rounded-full bg-red-600"},zt={__name:"ConversationListItem",props:{conversation:{type:Object,required:!0}},setup(l){const e=A(),r=l,s=k(()=>parseInt(r.conversation.id)===parseInt(e.activeConversationId));return(n,d)=>{var v;const m=ae("RouterLink");return(v=l.conversation)!=null&&v.id?(a(),j(m,{key:0,to:`/chatting/${l.conversation.id}`,class:U(["block p-1.5 md:p-3 border-b cursor-pointer hover:bg-[#24A1DE] hover:text-white group hover:opacity-90",{"bg-[#24A1DE] text-white":s.value}]),onClick:d[0]||(d[0]=u=>p(e).showMobileConversationList=!1)},{default:Y(()=>{var u,y,_,w,h,c;return[t("div",Et,[I(X,{conversation:l.conversation},null,8,["conversation"]),t("div",{class:U([{hidden:!p(e).showMobileConversationList},"md:block"])},[t("h3",{title:l.conversation.title,class:"md:text-lg font-semibold line-clamp-1"},M(l.conversation.title),9,Nt),t("div",{class:U(["text-xs md:text-sm group-hover:text-gray-50 line-clamp-1",{"text-gray-50":s.value,"text-gray-600":!s.value,"font-bold":(y=(u=l.conversation)==null?void 0:u.unread)==null?void 0:y.count}]),innerHTML:l.conversation.subtitle},null,10,Vt)],2),(w=(_=l.conversation)==null?void 0:_.unread)!=null&&w.count?(a(),o("div",Rt,[t("span",Ht,M((c=(h=l.conversation)==null?void 0:h.unread)==null?void 0:c.count),1)])):$("",!0)])]}),_:1},8,["to","class"])):$("",!0)}}},Bt={class:"flex flex-col items-center justify-center p-4 text-center text-gray-600"},Ot={__name:"ConversationNotFoundMessage",setup(l){return(e,r)=>(a(),o("div",Bt,[r[0]||(r[0]=t("i",{class:"fas fa-info-circle text-xl"},null,-1)),r[1]||(r[1]=t("p",{class:"mt-2 mb-4"},[N(" No conversations found. "),t("br"),N(" Start a new conversation! ")],-1)),I(J)]))}},Gt={class:"overflow-y-auto h-[calc(100dvh-150px)] scrollbar-hide text-blue-900 bg-white border-0"},Pt={__name:"ConversationList",setup(l){const e=A(),r=C(!1);return H(async()=>{r.value=!0,await e.fetchUserConversations(),r.value=!1}),(s,n)=>(a(),o("div",null,[t("div",Gt,[r.value?(a(),j(Q,{key:0})):p(e).conversations.length===0?(a(),j(Ot,{key:1})):(a(!0),o(S,{key:2},L(p(e).filteredConversations,d=>(a(),j(zt,{key:d.id,conversation:d},null,8,["conversation"]))),128))])]))}},qt={for:"search",class:"grow shrink relative block"},Ft={__name:"SearchConversation",setup(l){const e=A();return(r,s)=>(a(),o("label",qt,[s[1]||(s[1]=t("i",{class:"fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-[#24A1DE]"},null,-1)),O(t("input",{id:"search",placeholder:"Search Conversations...",type:"search",class:"input-1 pl-10 pr-2 rounded-b-none border-none outline-[#24a0deb0] py-[11px] md:py-[15px] rounded-none rounded-tl-lg","onUpdate:modelValue":s[0]||(s[0]=n=>p(e).searchText=n)},null,512),[[G,p(e).searchText]])]))}},Kt={class:"flex items-start gap-2"},Yt={class:"w-full border-2 border-blue-100 rounded-xl bg-gray-100 px-1.5 pt-1.5 pb-0"},Jt={__name:"SendMessageBox",setup(l){const e=A(),r=C(""),s=C(null);function n(){const v=s.value;v&&(v.style.height="auto",v.style.height=v.scrollHeight+"px")}async function d(){var y;const v=r.value.replace(/\u00a0/g," ").replace(/\r\n?/g,`
`).trim();if(!e.activeConversationId||!v)return;const u=await e.createConversationMessage(e.activeConversationId,{type:"text",body:v,format:"plain"});r.value="",await z(),n(),(y=e==null?void 0:e.bumpConversationToTop)==null||y.call(e,e.activeConversationId,u)}function m(v){v.isComposing||v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),d())}return H(()=>z(n)),(v,u)=>(a(),o("div",Kt,[u[2]||(u[2]=t("label",{class:"hidden bg-gray-100 text-gray-600 rounded-full px-3 py-2 hover:bg-gray-500 hover:text-white cursor-pointer"},[t("input",{type:"file",class:"hidden",accept:"image/jpg,image/jpeg,image/png,image/gif,application/pdf"}),t("i",{class:"far fa-paperclip text-xl"})],-1)),t("div",Yt,[O(t("textarea",{ref_key:"taRef",ref:s,"onUpdate:modelValue":u[0]||(u[0]=y=>r.value=y),onInput:n,onKeydown:m,name:"body",rows:"1",placeholder:"Write a message…",class:"w-full resize-none overflow-hidden bg-transparent outline-none leading-6 max-h-32 mb-0"},null,544),[[G,r.value]])]),t("button",{type:"button",onClick:d,class:"bg-blue-100 text-blue-600 rounded-full px-3 py-2 hover:bg-blue-600 hover:text-white"},u[1]||(u[1]=[t("i",{class:"far fa-paper-plane text-xl"},null,-1)]))]))}},Wt={class:"my-container"},Qt={class:"flex overflow-hidden border-[#24A1DE] border rounded-lg"},Xt={class:"h-[48px] md:h-[56px] flex justify-center items-center border-b border-[#24A1DE] bg-white rounded-tl-lg"},Zt={key:0,class:"my-8 text-center px-4 grid justify-center items-center gap-2"},os={__name:"ChattingList",setup(l){const e=A(),r=oe();return E(()=>r.params.conversationId,s=>{e.activeConversationId=s},{immediate:!0}),H(()=>{e.showMobileConversationList=!r.params.conversationId}),(s,n)=>(a(),o(S,null,[t("div",Wt,[t("div",Qt,[t("div",{class:U(["min-w-11 md:block grow-0 shrink-0 md:w-[280px] lg:w-[360px] xl:w-[400px] rounded-l-lg",{"w-full":p(e).showMobileConversationList}])},[t("div",Xt,[t("div",{onClick:n[0]||(n[0]=d=>p(e).showMobileConversationList=!0),class:U(["md:hidden flex justify-center items-center text-2xl text-[#24A1DE]",{hidden:p(e).showMobileConversationList}])},n[1]||(n[1]=[t("i",{class:"fas fa-bars"},null,-1)]),2),t("div",{class:U([p(e).showMobileConversationList?"flex":"hidden","w-full md:flex items-center justify-between"])},[I(Ft),I(J)],2)]),I(Pt)],2),t("div",{class:U(["md:block relative grow shrink border-l rounded-r-lg overflow-hidden bg-gray-100 border-[#24A1DE]",{hidden:p(e).showMobileConversationList}])},[p(e).activeConversationId?(a(),o(S,{key:1},[I(Tt),I(wt,null,{default:Y(()=>[I(Jt,{class:"bg-white border-t border-[#24A1DE] sticky bottom-0 mt-auto z-10 w-full p-2"})]),_:1})],64)):(a(),o("div",Zt,n[2]||(n[2]=[t("i",{class:"fad text-blue-600 fa-info-circle text-4xl md:text-7xl"},null,-1),t("p",{class:"text-gray-500 md:text-4xl"},[N(" Select a conversation "),t("br"),N(" to start chatting ")],-1)])))],2)])]),I(We),p(e).openAddMemberModal?(a(),j(st,{key:0})):$("",!0)],64))}};export{os as default};
