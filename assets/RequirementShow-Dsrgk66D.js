import{M as Ie,r as x,e as se,c as l,o as n,a as e,f as S,g as m,F,t as y,w as D,d as Se,m as K,n as Ae,y as Z,p as h,i as C,j as L,x as P,k as X,N as De,J as je,h as Le,v as Be,I as Ne,b as Ee,u as Oe,z as ee}from"./index-DrWxYErw.js";import{L as ie}from"./LoaderView-BWkP_QlD.js";import{O as J}from"./OverlyModal-CMTGMVpI.js";import{_ as Me}from"./ShareComponent-Bdwued9V.js";import{_ as Te}from"./DepartmentChip-CGAjrimg.js";import{_ as Q}from"./DescriptionView-DkvuM3oV.js";import{o as Ue}from"./url-CePbr-gY.js";import{u as Ve}from"./user-_RGH1DZN.js";import{_ as Vs,a as Pe}from"./TaskUserAssignForm-DhAp8Aqk.js";import{f as ae,b as Fe,s as ze}from"./requirement-Cx34gXA1.js";import{_ as He}from"./TextEditor-Cnm3VZ2H.js";import{u as Ge}from"./useTaskStore-DA-BPlHx.js";import{_ as Ke}from"./TaskSelectionInput-msRH51z1.js";import{_ as Qe}from"./TaskAddForm-DEiLe-Uk.js";import{_ as We}from"./TaskEditForm-5sl2I7eI.js";import{_ as Ye}from"./TaskTableRow-4tfeNqQ-.js";import{T as re}from"./TextWithHr-CE7GP-xJ.js";import{_ as te}from"./UserChip-CG74Codv.js";import{d as ne}from"./datetime-BEfC2TVK.js";import{_ as Je}from"./ApproveAndReject-DNlXu4-k.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-BZ-ndxYY.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-B5sc_9x1.js";import"./SelectDropdown-9hoStzJf.js";import"./TaskTitle-Dcx-XCja.js";import"./RequiredIcon-D2NXbYrf.js";import"./company-Cw0bdaEw.js";import"./CompanyDepartmentSelectInput-BIm4sX2n.js";import"./SectionLoading-pRaEWLrE.js";import"./tags-C9-OPAec.js";import"./MultiselectDropdown-ByfrXa0g.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DQRj9VnX.js";import"./TaskUrgentBadge-DZ-erinm.js";import"./TaskAssignedUsers-Dqky417m.js";import"./TaskIsClosedBadge-Bpjk5l-C.js";async function Xe(T,j,{params:i={}}={}){return Ie.get(`/requirements/${T}/details/${j}`,{params:i})}async function Ze(T,j,{params:i={}}={}){const c=Ue(i);return Ie.delete(`/requirements/${T}/details/${j}${c?"?"+c:""}`)}const et={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},tt={class:"mb-4"},st={class:"font-semibold"},rt={class:"mb-4"},nt={class:"line-clamp-2"},at={key:1,class:"min-h-40"},it={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ot={key:0,class:"mb-4 text-red-500 font-medium"},lt={key:1,class:"mb-4"},dt={class:"flex items-center justify-between gap-4"},ut=["disabled"],mt={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(T,{emit:j}){const i=T,c=j,R=Ve(),g=x(null),u=x(""),s=x(),v=x([]);async function _(){var o,r;u.value="submitting";try{const a=await Ze(i.requirementId,i.detailId);c("delete",a),u.value="create"}catch(a){u.value="error",s.value=((r=(o=a.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to update requirement detail: "+a,c("error",s.value)}}return se(async()=>{var o,r,a;u.value="loading";try{v.value=await R.fetchDepartmentWiseEmployees(),g.value=(o=(await Xe(i.requirementId,i.detailId)).data)==null?void 0:o.detail}catch(d){s.value=((a=(r=d.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch requirement detail"}finally{u.value=""}}),(o,r)=>{var a,d;return n(),l("div",et,[r[4]||(r[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:D(_,["prevent"]),class:"z-0"},[u.value!=="loading"?(n(),l(F,{key:0},[e("div",tt,[r[1]||(r[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",st,y((a=g.value)==null?void 0:a.title),1)]),e("div",rt,[r[2]||(r[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",nt,y((d=g.value)==null?void 0:d.description),1)]),r[3]||(r[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),l("div",at)),e("div",it,[s.value?(n(),l("div",ot,y(s.value),1)):m("",!0),s.value?(n(),l("hr",lt)):m("",!0),e("div",dt,[e("button",{type:"button",onClick:r[0]||(r[0]=D(p=>c("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:u.value=="loading"||u.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},y(u.value=="submitting"?"Deleting...":"Delete"),9,ut)])])],32),u.value==="loading"||u.value==="submitting"?(n(),S(ie,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):m("",!0)])}}};const ct={class:"sticky top-0 pt-4 bg-white z-10"},pt={class:"mb-4"},vt={class:"mb-4"},ft={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},bt={key:0,class:"mb-4 text-red-500 font-medium"},xt={key:1,class:"mb-4"},yt={class:"flex items-center justify-between gap-4"},gt=["disabled"],_t={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(T,{emit:j}){const i=T,c=j,R=x(),g=x(null),u=x(""),s=x(),v=x({feedback:""});async function _(){var o,r;u.value="submitting";try{const a=await Fe(i.requirementId,v.value.feedback);c("update",a),u.value="create"}catch(a){u.value="error",s.value=((r=(o=a.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to update requirement requirement",c("error",s.value)}}return se(async()=>{var o,r,a,d;u.value="loading";try{await ae(i.requirementId),g.value=(o=(await ae(i.requirementId)).data)==null?void 0:o.requirement,v.value={feedback:(r=g.value)==null?void 0:r.feedback}}catch(p){s.value=((d=(a=p.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to fetch requirement requirement"}finally{u.value=""}}),(o,r)=>{var a;return n(),l("div",{ref_key:"formContainerRef",ref:R,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",ct,[r[3]||(r[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),r[4]||(r[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=D(d=>c("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:D(_,["prevent"]),class:"z-0"},[u.value!=="loading"?(n(),l(F,{key:0},[e("div",pt,[r[5]||(r[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),h(Q,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:C(()=>{var d;return[L(y((d=g.value)==null?void 0:d.title),1)]}),_:1})]),e("div",vt,[r[6]||(r[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),h(He,{modelValue:v.value.feedback,"onUpdate:modelValue":r[1]||(r[1]=d=>v.value.feedback=d)},null,8,["modelValue"])])],64)):m("",!0),e("div",ft,[s.value?(n(),l("div",bt,y(s.value),1)):m("",!0),s.value?(n(),l("hr",xt)):m("",!0),e("div",yt,[e("button",{type:"button",onClick:r[2]||(r[2]=D(d=>c("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:u.value=="loading"||u.value=="submitting",type:"submit",class:"btn-2"},y(u.value=="submitting"?"Saving...":(a=g.value)!=null&&a.feedback?"Update Feedback":"Add Feedback"),9,gt)])])],32),u.value==="loading"||u.value==="submitting"?(n(),S(ie,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):m("",!0)],512)}}},kt={class:"flex justify-center items-center"},ht={class:"modal-card"},wt=["required"],qt={class:"flex"},$t={class:"flex justify-between gap-2 mt-4"},Ct=["disabled"],Tt=["disabled"],Rt={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(T,{emit:j}){const i=T,c=j,R=x(255),g=K(()=>R.value-o.value.length),u=De(),s=x(null),v=x(null),_=x(null),o=x(""),r=x(!1),a=K(()=>_.value!==null);function d(I){_.value=I,o.value="",$()}function p(){_.value=null,o.value=""}async function k(){var I,q;if(_.value==="reject"&&!o.value)return u.error("Rejection Reason is required!");if(typeof i.onSubmit=="function")return i.onSubmit({note:o.value,action:_.value});c("loading",!0),r.value=!0;try{await ze(i.requirementId,{note:o.value}),c("success"),p()}catch(A){return c("error",A),u.error(((q=(I=A==null?void 0:A.response)==null?void 0:I.data)==null?void 0:q.message)||"Submission failed!")}finally{c("loading",!1),r.value=!1}}function N(I){var q,A;a.value&&(I.key==="ArrowLeft"?(q=v.value)==null||q.focus():I.key==="ArrowRight"&&((A=s.value)==null||A.focus()))}function $(){Ne(()=>{var I;(I=s.value)==null||I.focus()})}return se(()=>{window.addEventListener("keydown",N)}),je(()=>{window.removeEventListener("keydown",N)}),(I,q)=>(n(),l("div",null,[e("div",kt,[e("button",{onClick:q[0]||(q[0]=A=>d("accept"))},q[3]||(q[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),a.value?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:D(p,["self"])},[e("div",ht,[q[4]||(q[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Le(e("textarea",{"onUpdate:modelValue":q[1]||(q[1]=A=>o.value=A),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:_.value==="reject",onInput:q[2]||(q[2]=A=>o.value.length>R.value?o.value=o.value.slice(0,R.value):null)},null,40,wt),[[Be,o.value]]),e("div",qt,[e("div",{class:P(["ml-auto inline-block text-sm text-gray-500",o.value.length>=R.value?"text-red-500":""])}," left "+y(g.value)+"/"+y(R.value)+" words ",3)])]),e("div",$t,[e("button",{ref_key:"cancelBtnRef",ref:v,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:p,disabled:r.value}," Cancel ",8,Ct),e("button",{ref_key:"confirmBtnRef",ref:s,class:P(["focus:ring-2 ring-offset-2 disabled:opacity-30",_.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:k,disabled:r.value}," Confirm Submission ",10,Tt)])])])):m("",!0)]))}},It={class:"flex items-center gap-6 justify-center my-16"},St={key:0,class:"border rounded-md"},jt={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(T,{emit:j}){const i=T,c=j,R=Ge(),g=x(""),u=x(null),s=x(""),v=x(!1);async function _(){await R.setTaskRequirement(s.value,i.requirement.id),c("assignTask")}return(o,r)=>(n(),l("div",{class:P(["text-left p-4",[g.value&&!u.value?"min-h-[400px]":""]])},[e("div",It,[e("button",{onClick:r[0]||(r[0]=D(a=>c("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),r[5]||(r[5]=e("span",null,"or",-1)),e("button",{class:P({"btn-3":g.value!=="direct-assign","btn-2":g.value=="direct-assign"}),onClick:r[1]||(r[1]=D(()=>g.value="direct-assign",["prevent"]))}," Assign Task ",2)]),g.value&&!u.value?(n(),l("div",St,[e("form",{onSubmit:D(_,["prevent"]),class:"p-4 flex items-end"},[h(Ke,{class:"flex-grow mr-4 h-12",taskId:s.value,"onUpdate:taskId":r[2]||(r[2]=a=>s.value=a),show:v.value,"onUpdate:show":r[3]||(r[3]=a=>v.value=a),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":T.fromDepartmentId},filterTasks:a=>!a.requirement_id,onAddNewTaskClick:r[4]||(r[4]=a=>c("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),r[6]||(r[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):m("",!0)],2))}},Nt={class:"flex flex-col items-center gax-x-1 justify-end"},At={key:0},Dt={key:1},Lt={class:"text-sm text-gray-600 whitespace-normal w-64"},Bt={class:"text-base text-gray-900 font-semibold"},Et={class:"ml-2"},Ot={key:0,class:"text-red-700 text-sm"},Mt={key:1,class:"text-green-600 ml-2"},Ut={key:2,class:"ml-2 text-yellow-700"},Re={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(T,{emit:j}){const i=T,c=j,R=Se(),g=K(()=>{var o,r,a,d,p;return{from_in_charge:!!((o=i.requirement)!=null&&o.status&&((r=i.requirement)!=null&&r.submission_date)),from_coordinator:!!((a=i.requirement)!=null&&a.from_coordinator),to_in_charge:!!((d=i.requirement)!=null&&d.to_incharge),to_coordinator:!!((p=i.requirement)!=null&&p.to_coordinator)}}),u=K(()=>{var o,r,a,d,p,k,N,$;return{from_in_charge:(r=(o=i.requirement)==null?void 0:o.from_department)==null?void 0:r.in_charge,from_coordinator:(d=(a=i.requirement)==null?void 0:a.from_department)==null?void 0:d.coordinator,to_in_charge:(k=(p=i.requirement)==null?void 0:p.to_department)==null?void 0:k.in_charge,to_coordinator:($=(N=i.requirement)==null?void 0:N.to_department)==null?void 0:$.coordinator}}),s=K(()=>{var d;const o=Object.keys(g.value),r=o.indexOf(i.approvalType);let a=!0;for(let p=r-1;p>=0;p--){const k=o[p];a=a&&(u.value[k]?(d=g.value)==null?void 0:d[k]:!0)}return a}),v=K(()=>{var k,N,$,I,q,A,b,z,H,w,t,B,O,M,U,V;let o=null,r=null,a="",d="";i.approvalType==="from_in_charge"&&(o=(k=i.requirement)==null?void 0:k.from_department,r=($=(N=i.requirement)==null?void 0:N.from_department)==null?void 0:$.in_charge,a="In Charge",d=(I=i.requirement)==null?void 0:I.from_incharge_note),i.approvalType==="from_coordinator"&&(o=(q=i.requirement)==null?void 0:q.from_department,r=(A=i.requirement)==null?void 0:A.from_coordinator,a="Coordinator",d=(b=i.requirement)==null?void 0:b.from_coordinator_note),i.approvalType==="to_in_charge"&&(o=(z=i.requirement)==null?void 0:z.to_department,r=(H=i.requirement)==null?void 0:H.to_in_charge,a="In Charge",d=(w=i.requirement)==null?void 0:w.to_incharge_note),i.approvalType==="to_coordinator"&&(o=(t=i.requirement)==null?void 0:t.to_department,r=(B=i.requirement)==null?void 0:B.to_coordinator,a="Coordinator",d=(O=i.requirement)==null?void 0:O.to_coordinator_note);const p=(M=u.value)==null?void 0:M[i.approvalType];return{department:o,department_user:p,approved:(U=g.value)==null?void 0:U[i.approvalType],approval_user:r,is_rejected:((V=i.requirement)==null?void 0:V.rejected_by_user_id)==(p==null?void 0:p.id),userType:a,approval_note:d}});function _(){c("updateApproval")}return(o,r)=>{var a,d,p,k,N,$;return n(),l("div",Nt,[v.value.department_user?(n(),l("div",At,[h(te,{user:v.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),l("div",Dt,r[0]||(r[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",Lt,[v.value.is_rejected?(n(),S(Q,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:C(()=>[L(y(T.requirement.rejection_reason),1)]),_:1})):(n(),S(Q,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:C(()=>[L(y(v.value.approval_note),1)]),_:1}))]),e("div",null,[!v.value.is_rejected&&!v.value.approved&&s.value&&((a=X(R).user)==null?void 0:a.id)==((p=(d=v.value)==null?void 0:d.department_user)==null?void 0:p.id)?(n(),S(Je,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(k=i.requirement)==null?void 0:k.id,onSuccess:_,variant:1},null,8,["applicationId"])):m("",!0)]),r[2]||(r[2]=e("hr",{class:"my-2 border-gray-600 w-64"},null,-1)),e("div",Bt,[e("span",null,y(((N=v.value.department)==null?void 0:N.short_name)||(($=v.value.department)==null?void 0:$.name)),1),e("span",Et,y(v.value.userType),1),v.value.department_user?(n(),l(F,{key:0},[v.value.is_rejected?(n(),l("span",Ot," (Rejected)")):v.value.approved?(n(),l("span",Mt,"(âœ”)")):(n(),l("span",Ut,r[1]||(r[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):m("",!0)])])}}},Vt={class:"container mx-auto print:p-0 w-full print:max-w-full"},Pt={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},Ft={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},zt={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},Ht={class:"text-center text-xl font-bold mb-2 flex items-center"},Gt={class:"mb-8"},Kt={class:"text-lg font-semibold mb-2"},Qt={class:"flex gap-4 items-center text-gray-500"},Wt={class:"text-sm"},Yt={key:0,class:"flex items-center gap-1"},Jt={key:0,class:"mb-5"},Xt=["innerHTML"],Zt={class:"mb-8"},es={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},ts={class:"w-full border-collapse"},ss={key:0},rs={class:"mb-8"},ns={class:"font-semibold text-lg px-2"},as={key:0},is=["innerHTML"];const os={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},ls={class:"flex flex-col items-end"},ds={key:2,class:"mt-6 mb-8 break-before-avoid-page"},us={class:"whitespace-nowrap border-gray-200 grid grid-cols-2 items-stretch"},ms={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-2 gap-2 items-stretch"},cs={class:"border col-span-3 p-3 rounded-md"},ps={class:"flex items-center gap-2 mb-4"},vs={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},fs={class:"flex items-center gap-2 mb-4"},bs={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},xs={class:"font-bold print:text-gray-900"},ys={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},gs={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},_s={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},ks={class:"print:text-gray-900 text-sm text-right"},hs={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},ws={class:"print:text-gray-900 text-sm text-right"},qs={class:"flex justify-between items-center mb-4"},$s={class:"mb-6"},Cs={class:"flex justify-between items-center"},Ts={key:1,class:"text-red-600"},Rs={key:0,class:"mb-6"},Is={class:"flex justify-between items-center"},Ss={key:1,class:"text-center mb-4 text-red-700 mt-8 text-sm"},js={class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},vr={__name:"RequirementShow",setup(T){const j=Ee(),i=Oe(),c=x(""),R=Se(),g=x(),u=x(),s=x(null),v=ee({detail:null,open:!1}),_=ee({detail:null,open:!1}),o=ee({detail:null,open:!1}),r=x(!1),a=()=>r.value=!0,d=()=>r.value=!1,p=x(),k=x({isOpen:!1,taskId:null});se(async()=>{await $(),window.addEventListener("beforeprint",a),window.addEventListener("afterprint",d),window.addEventListener("resize",N),await Ne(),N()});function N(){var B;const w=g.value,t=(B=u.value)==null?void 0:B.$el;w&&t&&(w!=null&&w.offsetHeight)&&(t.style.top=`${(w==null?void 0:w.offsetHeight)+90}px`)}je(()=>{window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",d),window.removeEventListener("resize",N)});async function $(){var w;c.value="loading",s.value=(w=(await ae(j.params.id)).data)==null?void 0:w.requirement,c.value=""}function I(){var w,t,B,O,M,U,V,W,Y;if(R.user.role!=="super_admin"&&((w=R.user)==null?void 0:w.id)!==((B=(t=s.value)==null?void 0:t.to_department)==null?void 0:B.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(M=(O=s.value)==null?void 0:O.to_department)==null?void 0:M.name}'s In charge can create or assign.`);console.log({requirement:s}),b.modalShown=!0,b.from_department_id=s.value.from_department_id,b.to_department_id=s.value.to_department_id,b.taskDefaultValues={title:"",description:"",from_department_id:s.value.from_department_id,to_department_id:s.value.to_department_id,is_important:((U=s.value)==null?void 0:U.priority)=="IMPORTANT",is_urgent:((V=s.value)==null?void 0:V.priority)=="URGENT",supervisor_ids:(W=s.value)!=null&&W.supervisor_id?[(Y=s.value)==null?void 0:Y.supervisor_id]:[]},b.requirement=s.value}function q(w){v.open=!0,v.detail=w}function A(w){o.open=!0,o.detail=w}const b=ee({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function z(){p.value=null,await $()}async function H(){b.modalShown=!1,b.requirement=null,b.creating=!1}return(w,t)=>{var O,M,U,V,W,Y,oe,le,de,ue,me,ce,pe,ve,fe,be,xe,ye,ge,_e,ke,he,we,qe,$e;const B=Ae("RouterLink");return n(),l("div",Vt,[_.open?(n(),S(J,{key:0},{default:C(()=>{var f;return[h(_t,{requirementId:s.value.id,detailId:(f=_.requirement.value)==null?void 0:f.id,onCloseClick:t[0]||(t[0]=E=>_.open=!1),onUpdate:t[1]||(t[1]=async()=>{_.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):m("",!0),o.open?(n(),S(J,{key:1},{default:C(()=>{var f;return[h(mt,{requirementId:s.value.id,detailId:(f=o.requirement.value)==null?void 0:f.id,onCloseClick:t[2]||(t[2]=E=>o.open=!1),onDelete:t[3]||(t[3]=async()=>{o.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):m("",!0),b.modalShown?(n(),S(J,{key:2,class:"*:relative"},{default:C(()=>{var f,E;return[e("button",{onClick:D(H,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},t[14]||(t[14]=[e("i",{class:"fas fa-times-circle"},null,-1)])),b!=null&&b.creating?m("",!0):(n(),S(jt,{key:0,"from-department-id":(f=s.value)==null?void 0:f.from_department_id,requirement:b==null?void 0:b.requirement,onCancelClick:H,onAddNewTaskClick:t[4]||(t[4]=()=>{b.modalShown=!0,b.creating=!0}),onAssignTask:z},null,8,["from-department-id","requirement"])),b!=null&&b.creating?(n(),S(Qe,{key:1,requirementDetailId:(E=b==null?void 0:b.requirement.value)==null?void 0:E.id,requirementId:s.value.id,onClose:H,onTaskCreated:z,defaultValues:b.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):m("",!0)]}),_:1})):m("",!0),p.value?(n(),S(J,{key:3},{default:C(()=>[h(We,{taskId:p.value,onClose:t[5]||(t[5]=f=>p.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):m("",!0),k.value.isOpen?(n(),S(J,{key:4,class:"*:max-w-4xl"},{default:C(()=>[h(Pe,{taskId:k.value.taskId,onCancelClick:t[6]||(t[6]=()=>{k.value.isOpen=!1,k.value.taskId=0}),onSuccess:t[7]||(t[7]=()=>{k.value.isOpen=!1,k.value.taskId=0,c.value="loading",$()})},null,8,["taskId"])]),_:1})):m("",!0),e("div",Pt,[s.value?(n(),l("div",Ft,[e("div",zt,[e("div",Ht,[e("button",{class:"btn-3 h-8 px-4",onClick:t[8]||(t[8]=D(()=>X(i).back(),["prevent"]))},"Back"),t[15]||(t[15]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),t[29]||(t[29]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",Gt,[e("div",null,[e("div",Kt,[h(Q,{"line-clamp":"3",class:"mb-2"},{default:C(()=>[L(y(s.value.title),1)]),btnText:C(({lineClampClass:f})=>[L(y(f?"More":"Less"),1)]),_:1}),e("div",Qt,[e("div",Wt,[t[16]||(t[16]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),L(" "+y(X(ne)(s.value.created_at)),1)]),s.value.created_by?(n(),l("div",Yt,[t[17]||(t[17]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),h(te,{"avatar-size":"xsmall",user:s.value.created_by,class:"border-sky-300"},null,8,["user"])])):m("",!0)])]),s.value.description?(n(),l("div",Jt,[t[18]||(t[18]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),h(Q,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:C(()=>[e("p",{innerHTML:s.value.description,class:"text-justify"},null,8,Xt)]),_:1})])):m("",!0)])]),e("div",Zt,[h(re,{class:"mb-4"},{default:C(()=>t[19]||(t[19]=[e("h2",{class:"font-semibold text-lg px-2"},"Task List",-1)])),_:1,__:[19]}),e("div",es,[e("table",ts,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[c.value!="loading"&&((M=(O=s.value)==null?void 0:O.tasks)==null?void 0:M.length)===0?(n(),l("tr",ss,t[20]||(t[20]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),l(F,{key:1},Z(((U=s.value)==null?void 0:U.tasks)||[],(f,E)=>(n(),S(Ye,{key:f.id,task:f,indexing:E+1,class:"*:py-3 *:border-b-0",onEditClick:t[9]||(t[9]=G=>p.value=G),onEmployeeAssignClick:t[10]||(t[10]=G=>{k.value.isOpen=!0,k.value.taskId=G})},null,8,["task","indexing"]))),128))])])])]),e("div",rs,[h(re,{class:"mb-4"},{default:C(()=>{var f,E,G,Ce;return[e("h2",ns," '"+y(((E=(f=s.value)==null?void 0:f.to_department)==null?void 0:E.short_name)||((Ce=(G=s.value)==null?void 0:G.to_department)==null?void 0:Ce.name))+"' Feedback ",1)]}),_:1}),e("div",{class:P(["px-3 border border-dashed rounded-lg border-sky-600",[(V=s.value)!=null&&V.feedback?"py-3":"py-8"]]),colspan:"5"},[c.value!="loading"&&((W=s.value)!=null&&W.status)?(n(),l("div",as,[String((Y=s.value)==null?void 0:Y.feedback).trim().length>0?(n(),S(Q,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:C(()=>{var f;return[e("p",{class:"text-sm text-justify",innerHTML:(f=s.value)==null?void 0:f.feedback},null,8,is)]}),_:1})):m("",!0),e("div",{class:P([((oe=s.value)!=null&&oe.feedback,"w-full flex justify-center")])},[e("button",{class:"btn-3 print:hidden",onClick:t[11]||(t[11]=D(()=>{_.open=!0,_.requirement=s.value},["prevent"]))},y(s.value.feedback?"Update Feedback":"Add feedback"),1)],2)])):m("",!0)],2)]),(s.value,m("",!0)),c.value!="loading"&&!((le=s.value)!=null&&le.status)?(n(),l("div",os,[e("div",ls,[h(Rt,{"requirement-id":(de=s.value)==null?void 0:de.id,onSuccess:$},{heading:C(()=>t[25]||(t[25]=[L(" Requirement Submission ")])),acceptButtonLabel:C(()=>t[26]||(t[26]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),L("Submit Requirement ")],-1)])),submitButtonLabel:C(()=>t[27]||(t[27]=[L(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):m("",!0),(ue=s.value)!=null&&ue.status?(n(),l("div",ds,[h(re,null,{default:C(()=>t[28]||(t[28]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[28]}),e("div",us,[(n(),l(F,null,Z(["from_in_charge","from_coordinator"],f=>h(Re,{class:"pt-12",key:f,requirement:s.value,"approval-type":f,onUpdateApproval:t[12]||(t[12]=()=>$())},null,8,["requirement","approval-type"])),64))]),((me=s.value)==null?void 0:me.from_department_id)!==((ce=s.value)==null?void 0:ce.to_department_id)?(n(),l("div",ms,[(n(),l(F,null,Z(["to_in_charge","to_coordinator"],f=>h(Re,{class:"pt-12",key:f,requirement:s.value,"approval-type":f,onUpdateApproval:t[13]||(t[13]=()=>$())},null,8,["requirement","approval-type"])),64))])):m("",!0)])):m("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 space-y-4 sticky top-[74px] bg-white shadow rounded-lg p-4 break-before-avoid-page",ref_key:"sidebarTop",ref:g},[e("div",cs,[e("div",null,[e("div",ps,[t[30]||(t[30]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),h(Te,{department:(pe=s.value)==null?void 0:pe.from_department,"short-name":!0},null,8,["department"])]),t[31]||(t[31]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",vs,[(ve=s.value)!=null&&ve.supervisor?(n(),S(te,{key:0,user:(fe=s.value)==null?void 0:fe.supervisor},null,8,["user"])):m("",!0)])]),t[33]||(t[33]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",fs,[t[32]||(t[32]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),h(Te,{department:(be=s.value)==null?void 0:be.to_department,"short-name":!0},null,8,["department"])])])]),e("div",bs,[t[34]||(t[34]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",xs,y((xe=s.value)==null?void 0:xe.id),1)]),((ge=(ye=s.value)==null?void 0:ye.website_tags)==null?void 0:ge.length)>0?(n(),l("div",ys,[t[35]||(t[35]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",gs,[(n(!0),l(F,null,Z(((_e=s.value)==null?void 0:_e.website_tags)||[],f=>(n(),l("div",{key:f.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},y(f.name),1))),128))])])):m("",!0),(ke=s.value)!=null&&ke.submission_date?(n(),l("div",_s,[t[36]||(t[36]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",ks,y(X(ne)((he=s.value)==null?void 0:he.submission_date)),1)])):m("",!0),(we=s.value)!=null&&we.better_to_complete_on?(n(),l("div",hs,[t[37]||(t[37]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",ws,y(X(ne)((qe=s.value)==null?void 0:qe.better_to_complete_on)),1)])):m("",!0),e("div",null,[e("div",qs,[t[38]||(t[38]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:P(["font-semibold text-sm",{"text-yellow-600 ":s.value.priority=="IMPORTANT","text-red-700 ":s.value.priority=="URGENT"}])},y(s.value.priority||"NORMAL"),3)])]),e("div",$s,[e("div",Cs,[t[39]||(t[39]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),s.value.status?(n(),l("span",{key:0,class:P(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":s.value.status!="approved","bg-green-300 text-green-700 border-green-400":s.value.status=="approved"}])},y(String(s.value.status).toUpperCase()),3)):(n(),l("span",Ts,"..."))])]),s.value.rejected_by?(n(),l("div",Rs,[e("div",Is,[t[40]||(t[40]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),h(te,{user:s.value.rejected_by},null,8,["user"])])])):m("",!0),s.value.rejection_reason?(n(),l("div",Ss,[t[41]||(t[41]=e("p",{class:"text-gray-600 mb-1 italic"},"Reason",-1)),e("p",null,y(s.value.rejection_reason),1)])):m("",!0),t[44]||(t[44]=e("hr",{class:"mb-3"},null,-1)),e("div",js,[s.value.status=="approved"?(n(),l("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:D(I,["prevent"])},t[42]||(t[42]=[e("i",{class:"fas fa-plus text-sm"},null,-1),L(" Add/Assign Task ")]))):m("",!0),h(B,{class:"btn-2 h-8",to:`/requirements/edit/${($e=s.value)==null?void 0:$e.id}`},{default:C(()=>t[43]||(t[43]=[L(" Edit ")])),_:1,__:[43]},8,["to"])])])],512),h(Me,{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 md:sticky",ref_key:"shareComponent",ref:u},null,512)])):m("",!0),c.value==="loading"?(n(),S(ie,{key:1,class:"absolute inset-0 bg-opacity-90"})):m("",!0)])])}}};export{vr as default};
