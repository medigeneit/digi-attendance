import{r as p,e as N,A as U,c as n,o as r,m as w,f as c,a as t,w as B,g as d,v as k,P as _,t as v,C,h as b}from"./index-CxwVGmAd.js";import{u as D}from"./useTaskStore-DCkGBUIa.js";import{S as I}from"./SectionLoading-WnH0tZFJ.js";const T={class:"p-4"},V={key:1,class:"text-center py-4 text-gray-500"},M={class:"mb-4"},P={class:"mb-4"},L={class:"flex gap-1 items-center"},O={class:"flex gap-1 items-center"},h={key:0,class:"mb-4"},F={class:"grid grid-cols-2 gap-4 mb-4"},G={class:"mb-4"},R={key:1,class:"mb-4 text-red-500 font-medium"},j={class:"flex items-center gap-4"},z=["disabled"],A={key:3,class:"text-center py-4 text-red-500"},J={__name:"TaskEditForm",props:{taskId:{type:[String,Number],required:!0}},emits:["updated","cancel"],setup(E,{emit:q}){const g=E,f=q,u=D(),s=p(),i=p(!1),y=p([]),l=p({title:"",requirement_id:"",user_ids:"",status:"PENDING",description:"",is_important:!1,is_urgent:!1});N(async()=>{var o;i.value=!0,s.value=(o=await u.fetchTask(g.taskId,{},{fetchOnly:!0,loadingBeforeFetch:!1}))==null?void 0:o.task,console.log({task:s.value}),y.value=s.value.users,i.value=!1,l.value={title:s.value.title,requirement_id:s.value.requirement_id,user_ids:s.value.users.map(e=>e.id).join(","),status:s.value.status,description:s.value.description,is_important:s.value.is_important,is_urgent:s.value.is_urgent}}),U(()=>s.value,o=>{l.value={title:o.title,requirement_id:o.requirement_id,user_ids:o.users.map(e=>e.id).join(","),status:o.status,description:o.description,is_important:s.value.is_important,is_urgent:s.value.is_urgent}});const S=async()=>{var e;i.value=!0;const o={...l.value,user_ids:((e=y.value)==null?void 0:e.map(m=>Number(m.id)))||[]};await u.updateTask(g.taskId,o,{loadingBeforeFetch:!1}),i.value=!1,f("updated")};return(o,e)=>{var m,x;return r(),n("div",T,[i.value?(r(),w(I,{key:0})):c("",!0),e[13]||(e[13]=t("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Edit Task",-1)),i.value?(r(),n("div",V,"Loading form...")):s.value?(r(),n("form",{key:2,onSubmit:B(S,["prevent"])},[t("div",M,[e[6]||(e[6]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task Title",-1)),d(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.title=a),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[k,l.value.title]])]),t("div",P,[t("label",L,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.is_important=a),class:"size-4"},null,512),[[_,l.value.is_important]]),e[7]||(e[7]=t("span",{class:"block text-gray-600 text-base pt-1 mb-1 font-medium"},"Important",-1))]),t("label",O,[d(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>l.value.is_urgent=a),class:"size-4"},null,512),[[_,l.value.is_urgent]]),e[8]||(e[8]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Urgent",-1))])]),s.value.requirement?(r(),n("div",h,[e[9]||(e[9]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Requirement",-1)),t("div",null,[t("p",null,v((x=(m=s.value)==null?void 0:m.requirement)==null?void 0:x.title),1)])])):c("",!0),t("div",F,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Status",-1)),d(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.status=a),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[10]||(e[10]=[t("option",null,"PENDING",-1),t("option",null,"IN_PROGRESS",-1),t("option",null,"COMPLETED",-1),t("option",null,"BLOCKED",-1)]),512),[[C,l.value.status]])])]),t("div",G,[e[12]||(e[12]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Description",-1)),d(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.description=a),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[k,l.value.description]])]),b(u).error?(r(),n("div",R,v(b(u).error),1)):c("",!0),t("div",j,[t("button",{disabled:i.value,type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-semibold px-5 py-2 rounded transition"},v(i.value?"Updating...":"Update Task"),9,z),t("button",{type:"button",onClick:e[5]||(e[5]=a=>f("close")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32)):(r(),n("div",A,v(b(u).error||"Task not found."),1))])}}};export{J as _};
