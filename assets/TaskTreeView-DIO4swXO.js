import{c as d,o as r,F as $,x as q,m as M,r as I,y as R,A as U,k as H,f as g,a as t,w as _,l as B,t as c,p as L,q as x,z as F,n as b}from"./index-B5miUE8g.js";const J={class:"mt-3"},G={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(s,{emit:C}){const a=C;return(h,f)=>(r(),d("div",J,[(r(!0),d($,null,q(s.childrenTasks,m=>(r(),M(ve,{key:m.id,task:m,class:"mb-3","hide-buttons":s.hideButtons,"tree-level":s.parentTreeLevel+1,onEditClick:f[0]||(f[0]=o=>a("editClick",o)),onAddClick:f[1]||(f[1]=o=>a("addClick",o))},null,8,["task","hide-buttons","tree-level"]))),128))]))}},K={class:"flex w-full"},Q={key:0,class:"border-l border-gray-200 last:border-l-0"},W={class:"items-start grid grid-cols-3"},X={class:""},Y={class:"flex gap-4"},Z={class:"flex items-center gap-2"},ee={class:"text-sky-800"},te={key:0,class:"text-sm text-gray-500 mt-2"},se={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},le={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},ae={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},ne={class:"flex items-start flex-wrap gap-3"},re={class:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-medium text-gray-600"},ie={class:"text-xs text-gray-700 mr-2"},de={class:"flex justify-end items-center gap-2"},oe={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200"},ue={class:"text-sm"},ce={class:"mt-4"},ke={class:"flex items-center"},ge={key:0,class:"fas fa-caret-down text-gray-400 group-hover:text-sky-400"},fe={key:1,class:"fas fa-caret-right text-gray-400 group-hover:text-sky-400"},he={key:0,class:"flex gap-2 ml-auto items-center text-xs"},xe=["href"],be=["href"],me={class:"ml-0"},ve={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick"],setup(s,{emit:C}){const a=s,h=C;function f(l){h("addClick",l)}function m(l){h("editClick",l)}const o=I([]),E=localStorage.getItem("sub_task_opened_list");if(E)try{o.value=JSON.parse(E)}catch{o.value=[]}const v=R({get:()=>o.value.includes(a.task.id),set:l=>{const e=o.value.includes(a.task.id);l&&!e?o.value.push(a.task.id):!l&&e&&(o.value=o.value.filter(n=>n!==a.task.id))}});U(o,l=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(l))},{deep:!0});const j=R(()=>{var l,e,n,i;return{"hover:underline hover:text-sky-400 cursor-pointer":((e=(l=a.task)==null?void 0:l.children_tasks)==null?void 0:e.length)>0,"cursor-default pointer-none":((i=(n=a.task)==null?void 0:n.children_tasks)==null?void 0:i.length)===0}}),z=l=>l.split(" ").map(e=>e[0]).join("").toUpperCase(),w=()=>{const l=p();let e,n,i;return l===100?(e="bg-green-50",n="bg-green-200",i="text-green-600 "):l<100&&(e="bg-red-50",n="bg-red-200",i="text-red-600 "),{container:e,bar:n,text:i}};function P(){a.task.children_tasks.length>0&&(v.value=!v.value)}function S(){if(a.task.children_tasks.length===0)return a.task.status==="COMPLETED"?1:0;const l=e=>{let n=0;for(let i=0;i<e.length;i++){const k=e[i];if(k.children_tasks.length===0)k.status==="COMPLETED"&&(n+=1);else{const y=k.children_tasks.length;l(k.children_tasks)===y&&(n+=1)}}return n};return l(a.task.children_tasks)}function p(){return a.task.children_tasks.length===0?a.task.status==="COMPLETED"?100:0:S()/a.task.children_tasks.length*100}return(l,e)=>{var i,k,y,T,N,A,D,O;const n=H("RouterLink");return r(),d("div",K,[s.treeLevel>0?(r(),d("div",Q,e[3]||(e[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):g("",!0),t("div",{class:x(["flex-grow border rounded py-3 group px-3",{"bg-green-50 ":p()===100,"bg-gray-50":p()<100,"shadow-sm":s.treeLevel>0}])},[t("div",W,[t("div",X,[t("div",null,[t("div",Y,[s.showDraggableHandle?(r(),d("button",{key:0,onMousedown:e[0]||(e[0]=_((...u)=>l.handleDragging&&l.handleDragging(...u),["stop"])),class:"handle"},e[4]||(e[4]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):g("",!0)]),t("div",Z,[t("span",ee," #"+c(s.task.id),1),B(n,{to:{name:"TaskShow",params:{id:s.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:L(()=>[t("div",null,c(s.task.title),1)]),_:1},8,["to"])])]),(i=s.task)!=null&&i.requirement?(r(),d("p",te," Requirement: "+c((y=(k=s.task)==null?void 0:k.requirement)==null?void 0:y.title),1)):g("",!0),t("div",se,[(T=s.task)!=null&&T.is_important?(r(),d("span",le,"IMPORTANT")):g("",!0),(N=s.task)!=null&&N.is_urgent?(r(),d("span",ae,"URGENT")):g("",!0)])]),t("div",ne,[(r(!0),d($,null,q(s.task.users,(u,V)=>(r(),d("div",{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",key:V},[t("div",re,c(z(u==null?void 0:u.name)),1),t("span",ie,c(u.id)+" - "+c(u==null?void 0:u.name),1)]))),128))]),t("div",de,[t("span",oe,c(s.task.status),1),t("div",ue,[t("div",{class:x(["rounded-full border py-0.5 text-xs relative overflow-hidden h-6",w().container]),style:{width:"180px"}},[t("div",{class:x(["z-10 absolute top-0 bottom-0",w().bar]),style:F(`width: ${p()}%`)},null,6),t("span",{class:x(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",w().text])},[t("span",null,[t("span",null,c(S()),1),e[5]||(e[5]=b(" / ")),t("span",null,c(s.task.children_tasks.length||1),1)])],2)],2)])])]),t("div",ce,[t("div",ke,[t("div",{class:"flex gap-3 group items-center",onClick:P},[v.value?(r(),d("i",ge)):(r(),d("i",fe)),t("span",{class:x([j.value,"text-xs text-gray-500"])}," Sub Tasks ("+c((A=s.task.children_tasks)==null?void 0:A.length)+") ",3)]),s.hideButtons?g("",!0):(r(),d("div",he,[t("a",{href:`/tasks/edit/${s.task.id}`,onClick:e[1]||(e[1]=_(u=>h("editClick",s.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},e[6]||(e[6]=[t("i",{class:"fas fa-edit"},null,-1),b(" Edit ")]),8,xe),B(n,{to:{name:"TaskReports",params:{id:(D=s.task)==null?void 0:D.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:L(()=>e[7]||(e[7]=[t("i",{class:"far fa-file-alt"},null,-1),b(" Reports ")])),_:1},8,["to"]),B(n,{to:{name:"TaskUserAssign",params:{id:(O=s.task)==null?void 0:O.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:L(()=>e[8]||(e[8]=[t("i",{class:"fas fa-user-plus"},null,-1),b(" Assign Users ")])),_:1},8,["to"]),t("a",{href:`/tasks/add?parent_id=${a.task.id}`,class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2",onClick:e[2]||(e[2]=_(u=>h("addClick",a.task.id),["stop","prevent"]))},e[9]||(e[9]=[t("i",{class:"fas fa-plus"},null,-1),b(" Add Sub Task ")]),8,be)]))]),t("div",me,[v.value?(r(),M(G,{key:0,childrenTasks:s.task.children_tasks,"hide-buttons":s.hideButtons,"parent-tree-level":s.treeLevel,onEditClick:m,onAddClick:f},null,8,["childrenTasks","hide-buttons","parent-tree-level"])):g("",!0)])])],2)])}}};export{ve as _};
