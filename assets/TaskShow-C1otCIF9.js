import{E as z,r as D,e as K,G as Y,A as J,c as i,o as r,f as _,a as t,t as k,H as E,n as T,h as n,w as P,l as f,p as v,D as Z,m as S,F as Q,y as tt,b as et,u as st,q as $,k as V,x as L}from"./index-Y58fDv_x.js";import{u as at,_ as ot,O as H,a as nt}from"./task-priority-DfGCcbtD.js";import{_ as rt}from"./TaskAddForm-D-YSOppl.js";import{_ as lt}from"./TaskEditForm-B5Leswrf.js";import{_ as it,g as W,a as dt}from"./TaskTreeView-ooogdRrN.js";import{_ as ut}from"./UserChip-DUtsm6ak.js";import{u as pt}from"./useTaskStore-okWGWubA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-CNyNXUoW.js";import"./SectionLoading-BVJEnVOX.js";const ct={key:0},mt={key:0},kt={key:1},ft=z({__name:"CountdownTimer",props:{targetDateTime:{}},setup(d){const e=d,a=D(u());let o;function u(){const c=new Date(e.targetDateTime).getTime()-new Date().getTime(),y=Math.floor(c/1e3%60),h=Math.floor(c/1e3/60%60),x=Math.floor(c/(1e3*60*60)%24),m=Math.floor(c/(1e3*60*60*24));return{total:c,days:m,hours:x,minutes:h,seconds:y}}function l(){a.value=u()}return K(()=>{o=setInterval(()=>{l(),a.value.total<=0&&clearInterval(o)},1e3)}),Y(()=>clearInterval(o)),J(()=>e.targetDateTime,()=>{l(),clearInterval(o)}),(c,y)=>a.value.total>0?(r(),i("div",ct,[a.value.days?(r(),i("span",mt,k(a.value.days)+"d ",1)):_("",!0),t("span",null,k(a.value.hours.toString().padStart(2,"0"))+"h :",1),t("span",null,k(a.value.minutes.toString().padStart(2,"0"))+"m :",1),t("span",null,k(a.value.seconds.toString().padStart(2,"0"))+"s",1)])):(r(),i("div",kt,[E(c.$slots,"expired",{},()=>[y[0]||(y[0]=T("Timeâ€™s up!"))])]))}}),gt={class:"mb-3"},yt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},xt={key:1,class:"text-center py-4 text-gray-500"},bt={key:2,class:"text-center py-4 text-red-500"},_t={key:3,class:"space-y-4"},vt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(d,{emit:e}){const a=d,o=e,u=D(null),{handleItemsPriorityUpdate:l,saveTaskPriority:c,listHasRearranged:y}=at(()=>a.tasks,a.parentId),h=async()=>{await c(),o("updatePriority")};return(x,m)=>(r(),i("div",null,[t("div",gt,[E(x.$slots,"task:header")]),n(y)?(r(),i("div",yt,[m[3]||(m[3]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:P(h,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:m[0]||(m[0]=P((...p)=>u.value.resetItems&&u.value.resetItems(...p),["prevent"]))},"Discard")])):_("",!0),d.loading?(r(),i("div",xt,"Loading tasks...")):d.error?(r(),i("div",bt,k(d.error),1)):(r(),i("div",_t,[f(ot,{items:d.tasks,handle:"handle",onItemsUpdate:n(l),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:u},{item:v(({item:p,index:b})=>[f(it,{index:b,task:p,class:"!border-0",onCommentButtonClick:w=>o("commentButtonClick",p.id),onEditClick:m[1]||(m[1]=w=>o("editClick",w)),onAddClick:m[2]||(m[2]=w=>o("addClick",w)),showDraggableHandle:!0},null,8,["index","task","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Tt={class:"flex justify-between mt-5"},ht={class:"flex flex-wrap items-center gap-2 mt-3"},wt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(d,{emit:e}){const a=d,o=e,u=D(),l=Z({show:!1,parentId:a.parentId,requirementId:null}),c=m=>{l.show=!0,l.parentId=m,console.log({addForm:l})};function y(){l.show=!1,l.parentId=a.parentId,o("created")}function h(){u.value=!1,o("updated")}function x(){l.show=!1,l.parentId=a.parentId}return(m,p)=>(r(),i("div",null,[u.value?(r(),S(H,{key:0},{default:v(()=>[f(lt,{taskId:u.value,onClose:p[0]||(p[0]=b=>u.value=null),onUpdated:h},null,8,["taskId"])]),_:1})):_("",!0),l.show?(r(),S(H,{key:1},{default:v(()=>[f(rt,{parentTaskId:l.parentId,requirementId:l.requirementId,onTaskCreated:y,onError:m.handleTaskError,onClose:x},null,8,["parentTaskId","requirementId","onError"])]),_:1})):_("",!0),f(vt,{tasks:d.subTasks,parentId:d.parentId,onAddClick:p[2]||(p[2]=b=>c(b)),onEditClick:p[3]||(p[3]=b=>u.value=b),onUpdatePriority:p[4]||(p[4]=b=>o("updatePriority"))},{"task:header":v(()=>[t("div",Tt,[p[5]||(p[5]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),t("div",ht,[t("button",{class:"btn-1 ml-auto",onClick:p[1]||(p[1]=P(()=>c(d.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId"])]))}},Ct={class:"min-w-full bg-white rounded overflow-hidden"},$t={class:"py-0.5 text-bg font-semibold"},It={class:"px-2 py-1 border-y"},Pt={class:"px-2 py-1 border-y"},St={class:"px-2 py-1 border-y text-center"},Dt={class:"px-2 py-1 border-y text-center"},Lt={class:"px-2 py-1 border-y text-center"},Et={class:"px-2 py-1 border-y text-center"},Rt=z({__name:"TaskProgressTable",props:{progressUsers:{}},setup(d){return(e,a)=>(r(),i("table",Ct,[t("caption",$t,[E(e.$slots,"caption",{},()=>[a[0]||(a[0]=T("Progress"))])]),a[1]||(a[1]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," User Progress "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," Task Progress ")])],-1)),t("tbody",null,[(r(!0),i(Q,null,tt(e.progressUsers,(o,u)=>(r(),i("tr",{key:o.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",It,k(u+1),1),t("td",Pt,[f(ut,{user:o},null,8,["user"])]),t("td",St,k(o.started_at),1),t("td",Dt,k(o.finished_at),1),t("td",Lt,k(o.user_progress)+"%",1),t("td",Et,k(o.task_progress)+"%",1)]))),128))])]))}}),At=d=>d==null?void 0:d.reduce((e,a)=>e+a.task_weight,0),Bt=(d,e)=>{const a=At(d);return d.map(o=>{const u=e.filter(l=>l.user_id===o.id).reduce((l,c)=>l+c.progress,0);return{...o,task_progress:Math.floor(u*(o.task_weight/a)),user_progress:u}})},Nt={class:"container mx-auto p-6"},Ut={class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6"},Mt={class:"grid grid-cols-4"},qt={class:"mb-4 flex col-span-full"},Ot={class:"font-medium text-xl"},jt={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},Ft={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},Gt={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},Vt={class:"text-right col-span-full md:col-span-1 ml-auto flex justify-center gap-4 !text-lg"},Ht={class:"mt-4 col-span-full mb-6"},Wt={class:"ml-auto text-right text-sm col-span-full"},zt={key:1,class:"text-gray-500"},Kt={class:"font-semibold text-green-800"},Jt={key:2,class:"ml-4 text-gray-500"},Qt={class:"text-red-500 font-semibold"},Xt={class:"py-2 flex justify-center items-center gap-2 col-span-full"},Yt={class:"ml-auto flex gap-4"},Zt={key:0},te={key:1},ee={key:1,class:"text-center py-4 text-gray-500"},se={key:2,class:"text-center py-4 text-red-500"},me={__name:"TaskShow",setup(d){const e=pt(),a=et(),o=st(),u=nt(),l=$(()=>u.getTaskListTree()),c=D({});K(async()=>{});const y=C=>{o.push({name:"TaskEdit",params:{id:C}})},h=$(()=>{var C,s;return e.task.parent_id==0?{name:"TaskList",params:{id:(C=e.task)==null?void 0:C.id}}:{name:"TaskShow",params:{id:(s=e.task)==null?void 0:s.parent_id}}});async function x(C){const s=await e.fetchTask(C);u.setTaskList(s.sub_tasks,e.task.id)}const m=$(()=>({...e.task,children_tasks:l.value})),p=$(()=>Bt(e.task.users,e.task.task_reports)),b=$(()=>W(e.task.started_at)),w=$(()=>W(e.task.deadline));return J(()=>a.params.id,x,{initial:!0,immediate:!0}),(C,s)=>{var R,A,B,N,U,M,q,O,j,F;const I=V("RouterLink"),X=V("router-view");return r(),i("div",Nt,[t("div",Ut,[n(e).task?(r(),i(Q,{key:0},[t("section",Mt,[t("div",qt,[t("div",null,[t("h2",Ot,k(n(e).task.title),1),t("div",jt,[(R=n(e).task)!=null&&R.is_important?(r(),i("span",Ft,"IMPORTANT")):_("",!0),(A=n(e).task)!=null&&A.is_urgent?(r(),i("span",Gt,"URGENT")):_("",!0)])]),t("div",Vt,[t("span",{class:L([{"bg-gray-200":((B=n(e).task)==null?void 0:B.status)==="PENDING","bg-blue-200":((N=n(e).task)==null?void 0:N.status)==="IN_PROGRESS","bg-green-200":((U=n(e).task)==null?void 0:U.status)==="COMPLETED","bg-red-200":((M=n(e).task)==null?void 0:M.status)==="BLOCKED"},"px-3 py-0.5 rounded-full text-sm h-6"])},k((q=n(e).task)==null?void 0:q.status),3),f(dt,{task:m.value,ref_key:"progress",ref:c,class:"!text-lg"},null,8,["task"])])]),t("section",Ht,[f(Rt,{"progress-users":p.value},{caption:v(()=>s[8]||(s[8]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["progress-users"])]),t("div",Wt,[n(e).task.deadline?(r(),S(ft,{key:0,targetDateTime:n(e).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):_("",!0),b.value?(r(),i("span",zt,[s[9]||(s[9]=T(" Started: ")),t("span",Kt,k(b.value),1)])):_("",!0),w.value?(r(),i("span",Jt,[s[10]||(s[10]=T(" Deadline: ")),t("span",Qt,k(w.value),1)])):_("",!0)]),s[15]||(s[15]=t("hr",{class:"my-3 col-span-full"},null,-1)),t("div",Xt,[t("button",{onClick:s[0]||(s[0]=P(g=>{var G;return y((G=n(e).task)==null?void 0:G.id)},["stop"])),class:"btn-2 py-0.5"},"Edit"),f(I,{to:{name:"TaskUserAssign",params:{id:(O=n(e).task)==null?void 0:O.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[1]||(s[1]=g=>g.stopPropagation())},{default:v(()=>s[11]||(s[11]=[t("i",{class:"fas fa-user-plus"},null,-1),T(" Assign Users ")])),_:1},8,["to"]),f(I,{to:h.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:s[2]||(s[2]=g=>g.stopPropagation())},{default:v(()=>s[12]||(s[12]=[t("i",{class:"fas fa-arrow-left"},null,-1),T(" Back ")])),_:1},8,["to"]),t("div",Yt,[l.value.length>0?(r(),S(I,{key:0,to:{name:"TaskShow",params:{id:(j=n(e).task)==null?void 0:j.id}},onClick:s[3]||(s[3]=g=>g.stopPropagation()),class:L(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":n(a).name=="TaskShow"}])},{default:v(()=>s[13]||(s[13]=[t("i",{class:"fal fa-list-ul"},null,-1),T(" Sub Tasks ")])),_:1},8,["to","class"])):_("",!0),f(I,{to:{name:"TaskReports",params:{id:(F=n(e).task)==null?void 0:F.id}},onClick:s[4]||(s[4]=g=>g.stopPropagation()),class:L(["py-1 btn-3",{"bg-blue-500 text-white":n(a).name=="TaskReports"}])},{default:v(()=>s[14]||(s[14]=[t("i",{class:"fal fa-file-alt"},null,-1),T(" Reports ")])),_:1},8,["to","class"])])])]),n(a).name=="TaskShow"?(r(),i("section",Zt,[f(wt,{subTasks:l.value,"parent-id":n(a).params.id,onCreated:s[5]||(s[5]=g=>x(n(a).params.id)),onUpdated:s[6]||(s[6]=g=>x(n(a).params.id)),onUpdatePriority:s[7]||(s[7]=g=>x(n(a).params.id))},null,8,["subTasks","parent-id"])])):(r(),i("section",te,[f(X)]))],64)):n(e).loading?(r(),i("div",ee," Loading task details... ")):(r(),i("div",se,k(n(e).error),1))])])}}};export{me as default};
