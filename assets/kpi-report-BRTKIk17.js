import{B as y,C as p}from"./index-DnagmssL.js";const d=y("kpi-report",{state:()=>({meta:null,rows:[],reports:null,isLoading:!1,error:null,marking:{isLoading:!1,error:null,lanes:[],reviewsByLane:{},personalItems:[],personalMaxTotal:0,employee:null,annualTargetAvg:null,annualPerformanceAvg:null,lastKey:null,marking:{isLoading:!1,error:null,lanes:[],reviewsByLane:{},personalItems:[],personalMaxTotal:0,employee:null,lastKey:null}}}),actions:{async fetchBiMonthly(o){var r,s;this.isLoading=!0,this.error=null;try{const{data:e}=await p.get("/kpi/reports/bi-monthly",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:Array.isArray(e==null?void 0:e.data)?e.data:[],{meta:this.meta,rows:this.rows}}catch(e){throw this.error=((s=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to load report",e}finally{this.isLoading=!1}},async exportBiMonthly(o){try{const r=await p.get("/kpi/reports/bi-monthly-export",{params:o,responseType:"blob"}),s=r.headers["content-disposition"]||"";let e="kpi_bi_monthly.xlsx";const a=/filename="?([^"]+)"?/i.exec(s);a&&a[1]&&(e=decodeURIComponent(a[1]));const m=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=URL.createObjectURL(m),n=document.createElement("a");n.href=i,n.download=e,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(i)}catch(r){throw console.error(r),r}},async setReportCompletion(o){var r,s;try{const{form_id:e,department_id:a,completed:m}=o||{};if(!e)throw new Error("form_id is required");if(a==null)throw new Error("department_id is required");const{data:i}=await p.patch(`/kpi/forms/${e}/report-completion`,{department_id:a,completed:!!m});return i}catch(e){const a=((s=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:s.message)||(e==null?void 0:e.message)||"Failed to update report completion";throw console.error("setReportCompletion error:",e),new Error(a)}},async setTargetCompletion({form_id:o,department_id:r,completed:s}){const{data:e}=await p.post(`/kpi/bi-monthly/forms/${o}/target-completion`,{department_id:r,completed:s});return e},async fetchYearly(o){var r,s;this.isLoading=!0,this.error=null;try{const{data:e}=await p.get("/kpi/reports/yearly",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:[],this.reports=e??null,{meta:this.meta,rows:this.rows}}catch(e){throw this.error=((s=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to load yearly report",e}finally{this.isLoading=!1}},async exportYearly(o){try{const r=await p.get("/yearly-kpi-summary-reports",{params:o,responseType:"blob"}),s=r.headers["content-disposition"]||"";let e="yearly_kpi_report.xlsx";const a=/filename="?([^"]+)"?/i.exec(s);a&&a[1]&&(e=decodeURIComponent(a[1]));const m=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=URL.createObjectURL(m),n=document.createElement("a");n.href=i,n.download=e,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(i)}catch(r){throw console.error(r),r}},async fetchYearlyExecutive(o){var r,s;this.isLoading=!0,this.error=null;try{const{data:e}=await p.get("/yearly-kpi-summary-reports",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:[],this.reports=e??null,{meta:this.meta,rows:this.rows,reports:this.reports}}catch(e){throw this.error=((s=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:s.message)||"Failed to load yearly report",e}finally{this.isLoading=!1}},async fetchMarkingForm({cycle_id:o,employee_id:r,lane_keys:s="supv_director,da",include_personal_items:e=1,force:a=!1}){var i,n,c;const m=`${o}|${r}|${s}|${e}`;if(!a&&this.marking.lastKey===m&&((i=this.marking.lanes)!=null&&i.length))return this.marking;this.marking.isLoading=!0,this.marking.error=null;try{const{data:t}=await p.get(`/kpi/lanes/${o}/${r}`,{params:{lane_keys:s,include_personal_items:e}});return this.marking.lanes=(t==null?void 0:t.lanes)||[],this.marking.reviewsByLane=(t==null?void 0:t.reviews_by_lane)||{},this.marking.personalItems=(t==null?void 0:t.personal_items)||[],this.marking.personalMaxTotal=Number((t==null?void 0:t.personal_max_total)||0),this.marking.employee=(t==null?void 0:t.employee)??null,this.marking.lastKey=m,this.marking}catch(t){const l=((c=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:c.message)||(t==null?void 0:t.message)||"Failed to load marking form";throw this.marking.error=l,new Error(l)}finally{this.marking.isLoading=!1}},async submitOverallMark({cycle_id:o,employee_id:r,reviewer_lane:s,overall_mark:e,group_key:a="personal",strengths:m=null,gaps:i=null,suggestions:n=null}){var c,t;try{const l={cycle_id:o,employee_id:r,reviewer_lane:s,group_key:a,overall_mark:Number(e),strengths:m,gaps:i,suggestions:n},{data:h}=await p.post("/kpi/review/overall-submit",l);return h}catch(l){const h=((t=(c=l==null?void 0:l.response)==null?void 0:c.data)==null?void 0:t.message)||(l==null?void 0:l.message)||"Failed to submit overall mark";throw new Error(h)}}}});export{d as u};
