import{N as Ft,i as Rt,u as Bt,r as b,x as Dt,b as $t,c as r,a as t,k as a,j as It,t as o,h as g,e as i,p as Vt,l as xt,m as Tt,d as Mt,v as Ut,F as Wt,f as Et,o as n,g as Ht}from"./index-qYpg0mVE.js";import{L as Pt}from"./LoaderView-BmvcK0j0.js";import{_ as qt}from"./ScreenshotCapture-10GcwIZ-.js";import{_ as zt}from"./ShareComponent-6JtcJapn.js";import{u as Ot}from"./short-leave-Ct9v_qPB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Gt={class:"my-container max-w-3xl space-y-6"},Jt={key:1,class:"bg-white rounded space-y-2 p-4 md:p-8",id:"leave-application"},Kt={class:"flex justify-end"},Qt={class:"font-medium"},Xt={class:"gap-y-1"},Yt={class:"gap-y-1"},Zt={class:""},es={class:"grid md:grid-cols-2"},ts={class:"grid md:grid-cols-2 gap-4 pt-10 items-center"},ss={key:0,class:"print:hidden"},ls={class:"text-xs"},as={class:"flex gap-2"},os={class:"font-semibold text-sm"},ns={key:0,class:"text-green-600 print:text-black"},rs={key:1,class:"pl-2 text-yellow-700"},is={class:"text-center"},us={class:"title-md"},ds={key:0},vs={class:"grid grid-cols-2 text-sm md:text-base md:grid-cols-3 md:gap-4"},ps={class:"pt-10"},ms={key:0},cs={key:1},_s={key:2,class:"print:hidden"},fs={class:"text-xs text-blue-600"},ys={class:"flex gap-4"},bs={class:"font-semibold text-sm"},gs={key:0,class:"text-green-600"},hs={key:1,class:"pl-2 text-yellow-700"},xs={class:"pt-10"},ks={key:0},ws={key:1,class:"print:hidden"},Ss={class:"text-xs text-blue-600"},js={class:"flex gap-4"},As={class:"font-semibold text-sm"},Cs={key:0,class:"text-green-600"},Ls={key:1,class:"pl-2 text-yellow-700"},Ns={class:"pt-10"},Fs={key:0},Rs={key:1},Bs={key:2,class:"print:hidden"},Ds={class:"text-xs text-blue-600"},$s={class:"flex gap-4"},Is={class:"font-semibold text-sm"},Vs={key:0,class:"text-green-600"},Ts={key:1,class:"pl-2 text-yellow-700"},Ms={key:0,class:"mb-2"},Us=["href"],Ws={key:1,class:"text-sm text-gray-600 mt-1"},Es={key:0,class:"modal-bg"},Hs={class:"modal-card"},Ps={class:"flex justify-end gap-2 mt-4"},Xs={__name:"ShortLeaveShow",setup(qs){const kt=Ft(),x=Rt(),wt=Ht(),p=Et(),d=Ot(),c=Bt(),k=b(null),w=b(!0),_=b(!1),f=b(""),s=Dt(()=>d.shortLeave);$t(async()=>{const{id:l}=p.params;try{await d.fetchShortLeaveById(l)}catch(e){console.error("Failed to fetch short leave details:",e)}finally{w.value=!1}});const St=async()=>{try{await d.rejectShortLeave(p.params.id,f.value),alert("Short leave rejected successfully!"),_.value=!1,f.value="",await d.fetchShortLeaveById(p.params.id),j()}catch(l){console.error("Failed to reject short leave:",l),alert("Failed to reject short leave.")}},jt=async()=>{try{const l={attachment:k.value};await d.uploadShortLeaveAttachment(p.params.id,l)}catch(l){console.error("Failed to reject short leave:",l),alert("Failed to reject short leave.")}},h=()=>{_.value=!0},y=async l=>{try{const{id:e}=p.params;l==="handover"&&await d.handoverAccept(e),l==="inCharge"&&await d.inChargeAccept(e),l==="recommend"&&await d.recommendByAccept(e),l==="approve"&&await d.approvedByAccept(e),alert(`${l} accepted successfully!`),await d.fetchShortLeaveById(e),j()}catch(e){console.error(`Failed to accept ${l}:`,e),alert(`Failed to accept ${l}.`)}},At=()=>wt.go(-1);function Ct(){window.print()}const Lt=async l=>{const e=l.target.files[0];if(e){const v=new FormData;v.append("file",e);const u=await d.fetchFileUpload(v);k.value=u==null?void 0:u.url,u!=null&&u.url?(jt(),x.success("File uploaded successfully!")):x.error("Failed to upload file!")}},Nt=l=>new Date(l).toISOString().slice(0,10),S=l=>{if(!l)return"N/A";const[e,v]=l.split(":").map(Number),u=new Date;return u.setHours(e,v),u.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};async function j(){await kt.markAsRead(p.query.notifyId)}return(l,e)=>{var v,u,A,C,L,N,F,R,B,D,$,I,V,T,M,U,W,E,H,P,q,z,O,G,J,K,Q,X,Y,Z,ee,te,se,le,ae,oe,ne,re,ie,ue,de,ve,pe,me,ce,_e,fe,ye,be,ge,he,xe,ke,we,Se,je,Ae,Ce,Le,Ne,Fe,Re,Be,De,$e,Ie,Ve,Te,Me,Ue,We,Ee,He,Pe,qe,ze,Oe,Ge,Je,Ke,Qe,Xe,Ye,Ze,et,tt,st,lt,at,ot,nt,rt,it,ut,dt,vt,pt,mt,ct,_t,ft,yt,bt,gt,ht;return n(),r(Wt,null,[t("div",Gt,[t("div",{class:"flex items-center justify-between gap-2 print:hidden"},[t("button",{class:"btn-3",onClick:At},e[6]||(e[6]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[8]||(e[8]=t("h1",{class:"title-lg flex-wrap text-center"},"Short Leave Details",-1)),t("div",null,[t("button",{class:"btn-2",onClick:Ct},e[7]||(e[7]=[t("i",{class:"far fa-print"},null,-1),a(" Print ")]))])]),w.value?(n(),It(Pt,{key:0})):(n(),r("div",Jt,[e[41]||(e[41]=t("div",null,[t("h1",{class:"title-lg text-center"},"Short Leave Application")],-1)),t("div",Kt,[t("div",null,"Date: "+o(Nt((v=s.value)==null?void 0:v.created_at)),1)]),t("div",null,[t("p",Qt,[e[9]||(e[9]=a(" Name: ")),t("b",null,o((A=(u=s.value)==null?void 0:u.user)==null?void 0:A.name),1)]),t("div",Xt,[t("p",null,[e[10]||(e[10]=a(" Designation: ")),t("b",null,o((N=(L=(C=s.value)==null?void 0:C.user)==null?void 0:L.designation)==null?void 0:N.title),1)])]),t("div",Yt,[t("p",null,[e[11]||(e[11]=a(" Department: ")),t("b",null,o((B=(R=(F=s.value)==null?void 0:F.user)==null?void 0:R.company)==null?void 0:B.name),1)])])]),t("div",Zt,[t("div",es,[t("div",null,[e[12]||(e[12]=t("b",null,"From:",-1)),a(" "+o((D=s.value)!=null&&D.start_time?S(($=s.value)==null?void 0:$.start_time):""),1)]),t("div",null,[e[13]||(e[13]=t("b",null,"To:",-1)),a(" "+o((I=s.value)!=null&&I.end_time?S((V=s.value)==null?void 0:V.end_time):""),1)]),t("div",null,[e[14]||(e[14]=t("b",null,"Short Leave Date:",-1)),a(" "+o((T=s.value)==null?void 0:T.date),1)]),t("div",null,[e[15]||(e[15]=t("b",null,"Total Minutes:",-1)),a(" "+o((M=s.value)==null?void 0:M.total_minutes),1)])]),t("div",ts,[t("div",null,[e[16]||(e[16]=t("b",null,"Reason:",-1)),a(" "+o(((U=s.value)==null?void 0:U.reason)||"N/A"),1)]),t("div",null,[t("p",null,o(((E=(W=s.value)==null?void 0:W.handover_user)==null?void 0:E.name)||"Not assigned"),1),!((H=s.value)!=null&&H.status)&&((P=s.value)==null?void 0:P.handover_user_id)===((z=(q=g(c))==null?void 0:q.user)==null?void 0:z.id)?(n(),r("div",ss,[t("p",ls,[a(o((G=(O=s.value)==null?void 0:O.user)==null?void 0:G.name)+" has assigned you for his handover. ",1),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=a(" Do you agree? "))]),t("div",as,[t("button",{class:"font-bold text-lg text-green-600 px-2",onClick:e[0]||(e[0]=m=>y("handover"))}," ✔ "),e[19]||(e[19]=t("button",{class:"px-2"},"❌",-1))])])):i("",!0),e[22]||(e[22]=t("hr",{class:"w-44 border-black mt-1"},null,-1)),t("h4",os,[e[21]||(e[21]=a(" Handover ")),(J=s.value)!=null&&J.handover_user_id&&((K=s.value)!=null&&K.status)?(n(),r("span",ns," (✔) ")):i("",!0),(Q=s.value)!=null&&Q.handover_user_id&&!((X=s.value)!=null&&X.status)?(n(),r("span",rs,e[20]||(e[20]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])])])]),e[42]||(e[42]=t("hr",null,null,-1)),t("div",is,[t("h3",us,[e[23]||(e[23]=a(" Approvals ")),t("span",{class:Vt({"text-yellow-500":((Y=s.value)==null?void 0:Y.status)==="Pending","text-green-500":((Z=s.value)==null?void 0:Z.status)==="Approved","text-red-500":((ee=s.value)==null?void 0:ee.status)==="Rejected"})}," ("+o(((te=s.value)==null?void 0:te.status)||"N/A")+") ",3)]),((se=s.value)==null?void 0:se.status)==="Rejected"?(n(),r("div",ds,[t("div",null,[e[24]||(e[24]=t("b",null,"Rejected By:",-1)),a(" "+o(((ae=(le=s.value)==null?void 0:le.rejected_by_user)==null?void 0:ae.name)||"N/A"),1)]),t("div",null,[e[25]||(e[25]=t("b",null,"Rejection Reason:",-1)),a(" "+o(((oe=s.value)==null?void 0:oe.rejection_reason)||"N/A"),1)])])):i("",!0)]),t("div",vs,[t("div",ps,[(ne=s.value)!=null&&ne.in_charge_user?(n(),r("p",ms,o(((ie=(re=s.value)==null?void 0:re.in_charge_user)==null?void 0:ie.name)||""),1)):(n(),r("p",cs,o(((pe=(ve=(de=(ue=s.value)==null?void 0:ue.user)==null?void 0:de.other_approval)==null?void 0:ve.in_charge_user)==null?void 0:pe.name)||"N/A"),1)),((me=s.value)==null?void 0:me.status)!=="Rejected"&&((ce=s.value)==null?void 0:ce.status)!=="Approved"&&!((_e=s.value)!=null&&_e.in_charge_user_id)&&((be=(ye=(fe=s.value)==null?void 0:fe.user)==null?void 0:ye.other_approval)==null?void 0:be.in_charge_user_id)===((he=(ge=g(c))==null?void 0:ge.user)==null?void 0:he.id)?(n(),r("div",_s,[t("p",fs,[a(o((ke=(xe=s.value)==null?void 0:xe.user)==null?void 0:ke.name)+" has submitted an application. ",1),e[26]||(e[26]=t("br",null,null,-1)),e[27]||(e[27]=a(" Will you forward it? "))]),t("div",ys,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[1]||(e[1]=m=>y("inCharge"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):i("",!0),e[30]||(e[30]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",bs,[e[29]||(e[29]=a(" In-Charge ")),(we=s.value)!=null&&we.in_charge_user_id?(n(),r("span",gs,"(✔)")):i("",!0),!((Se=s.value)!=null&&Se.in_charge_user_id)&&((Ce=(Ae=(je=s.value)==null?void 0:je.user)==null?void 0:Ae.other_approval)!=null&&Ce.in_charge_user)?(n(),r("span",hs,e[28]||(e[28]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])]),t("div",xs,[(Le=s.value)!=null&&Le.recommend_by_user?(n(),r("p",ks,o(((Fe=(Ne=s.value)==null?void 0:Ne.recommend_by_user)==null?void 0:Fe.name)||""),1)):i("",!0),t("p",null,o((($e=(De=(Be=(Re=s.value)==null?void 0:Re.user)==null?void 0:Be.other_approval)==null?void 0:De.recommend_by_user)==null?void 0:$e.name)||"N/A"),1),((Ie=s.value)==null?void 0:Ie.status)!=="Rejected"&&((Ve=s.value)==null?void 0:Ve.status)!=="Approved"&&!((Te=s.value)!=null&&Te.recommend_by_user_id)&&((We=(Ue=(Me=s.value)==null?void 0:Me.user)==null?void 0:Ue.other_approval)==null?void 0:We.recommend_by_user_id)===((He=(Ee=g(c))==null?void 0:Ee.user)==null?void 0:He.id)?(n(),r("div",ws,[t("p",Ss,[a(o((qe=(Pe=s.value)==null?void 0:Pe.user)==null?void 0:qe.name)+" has submitted an application.",1),e[31]||(e[31]=t("br",null,null,-1)),e[32]||(e[32]=a(" Will you recommend it? "))]),t("div",js,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[2]||(e[2]=m=>y("recommend"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):i("",!0),e[35]||(e[35]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",As,[e[34]||(e[34]=a(" Recommend By ")),(ze=s.value)!=null&&ze.recommend_by_user_id?(n(),r("span",Cs,"(✔)")):i("",!0),!((Oe=s.value)!=null&&Oe.recommend_by_user_id)&&((Ke=(Je=(Ge=s.value)==null?void 0:Ge.user)==null?void 0:Je.other_approval)!=null&&Ke.recommend_by_user)?(n(),r("span",Ls,e[33]||(e[33]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])]),t("div",Ns,[(Qe=s.value)!=null&&Qe.approved_by_user?(n(),r("p",Fs,o(((Ye=(Xe=s.value)==null?void 0:Xe.approved_by_user)==null?void 0:Ye.name)||""),1)):(n(),r("p",Rs,o(((st=(tt=(et=(Ze=s.value)==null?void 0:Ze.user)==null?void 0:et.other_approval)==null?void 0:tt.approved_by_user)==null?void 0:st.name)||"N/A"),1)),((lt=s.value)==null?void 0:lt.status)!=="Rejected"&&((at=s.value)==null?void 0:at.status)!=="Approved"&&!((ot=s.value)!=null&&ot.approved_by_user_id)&&((it=(rt=(nt=s.value)==null?void 0:nt.user)==null?void 0:rt.other_approval)==null?void 0:it.approved_by_user_id)===((dt=(ut=g(c))==null?void 0:ut.user)==null?void 0:dt.id)?(n(),r("div",Bs,[t("p",Ds,[a(o((pt=(vt=s.value)==null?void 0:vt.user)==null?void 0:pt.name)+" has submitted an application.",1),e[36]||(e[36]=t("br",null,null,-1)),e[37]||(e[37]=a(" Will you accept it? "))]),t("div",$s,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[3]||(e[3]=m=>y("approve"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):i("",!0),e[40]||(e[40]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",Is,[e[39]||(e[39]=a(" Approved By ")),(mt=s.value)!=null&&mt.approved_by_user_id?(n(),r("span",Vs,"(✔)")):i("",!0),!((ct=s.value)!=null&&ct.approved_by_user_id)&&((yt=(ft=(_t=s.value)==null?void 0:_t.user)==null?void 0:ft.other_approval)!=null&&yt.approved_by_user)?(n(),r("span",Ts,e[38]||(e[38]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])])])])),t("div",null,[t("div",null,[e[43]||(e[43]=t("label",null,"Attachment",-1)),(bt=s.value)!=null&&bt.attachment&&typeof((gt=s.value)==null?void 0:gt.attachment)=="string"?(n(),r("div",Ms,[t("a",{href:(ht=s.value)==null?void 0:ht.attachment,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,Us)])):i("",!0),t("input",{type:"file",onChange:Lt,class:"w-full p-2 border rounded"},null,32),l.fileName?(n(),r("p",Ws,"Selected File: "+o(l.fileName),1)):i("",!0)])]),xt(zt,null,{default:Tt(()=>[xt(qt,{targetId:"leave-application",platform:"whatsapp"})]),_:1})]),_.value?(n(),r("div",Es,[t("div",Hs,[e[44]||(e[44]=t("h3",{class:"title-lg"},"Reject Short Leave",-1)),Mt(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=m=>f.value=m),rows:"4",placeholder:"Enter rejection reason...",class:"w-full border rounded-lg p-2 text-gray-700"},null,512),[[Ut,f.value]]),t("div",Ps,[t("button",{class:"btn-3",onClick:e[5]||(e[5]=m=>_.value=!1)},"Cancel"),t("button",{class:"btn-2 bg-red-500 text-white",onClick:St},"Confirm")])])])):i("",!0)],64)}}};export{Xs as default};
