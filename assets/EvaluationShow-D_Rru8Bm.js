import{N as Ne,u as Se,b as Te,s as Ce,r as M,m as p,A as Ae,e as Me,c as y,o as w,a as e,p as ce,k as n,t as d,j as D,g as Ve,h as k,v as N}from"./index-BOxZs2SM.js";import{L as ze}from"./LoaderView-BOFHaCun.js";import{C as Fe}from"./CriteriaAssignModal-gHd6hheL.js";import{u as Ie}from"./user-monthly-kpi-B06Wz8x3.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./monthly-kpi-assignments-B7MGTJOV.js";const $e={class:"space-y-4 px-4 print:px-0 max-w-7xl mx-auto"},je={class:"flex items-center justify-between gap-2 sticky top-0 z-10 bg-white/80 backdrop-blur p-2 rounded-b-lg border-b print:hidden"},De={class:"flex gap-2"},Ee=["disabled"],Le={key:0,class:"py-8 text-center"},Ue={key:1,class:"rounded-md border border-red-200 bg-red-50 p-3 text-red-700"},Be={key:2,class:"rounded-2xl bg-white p-5 shadow-sm space-y-4"},Pe={class:"text-center"},He={class:"text-sm text-gray-600"},Ke={class:"grid grid-cols-12 gap-2 text-sm"},Re={class:"col-span-6 border p-2 rounded"},Ge={class:"font-medium"},Je={class:"col-span-3 border p-2 rounded"},Ye={class:"font-medium"},qe={class:"col-span-3 border p-2 rounded"},Qe={class:"col-span-6 border p-2 rounded"},We={class:"col-span-3 border p-2 rounded"},Xe={class:"font-medium"},Ze={class:"grid grid-cols-1 print:grid-cols-3 md:grid-cols-3 gap-2 text-sm"},et={class:"rounded-lg border p-2 text-center"},tt={class:"font-semibold"},st={class:"rounded-lg border p-2 text-center"},ot={class:"font-semibold"},rt={class:"rounded-lg border p-2 text-center"},nt={class:"font-semibold"},it={class:"overflow-x-auto"},at={class:"min-w-full border text-sm"},dt={class:"border px-2 py-2 align-top"},lt={key:0,class:"mt-0.5"},ct=["id"],ut=["innerHTML"],pt=["innerHTML"],vt={class:"mt-2 space-x-3 print:hidden"},mt=["for"],gt=["for"],bt={class:"mt-2"},_t={key:0,viewBox:"0 0 24 24",class:"h-4 w-4 opacity-90"},ft={key:1,viewBox:"0 0 24 24",class:"h-4 w-4 opacity-80"},ht={class:"ml-1 hidden lg:inline"},xt={class:"border px-2 py-2 align-top text-right"},yt={class:"border px-2 py-2 align-top"},wt={class:"flex items-center justify-end gap-2"},kt=["max","readonly"],Nt=["disabled"],St={class:"border px-2 py-2 align-top"},Tt={class:"flex items-center justify-end gap-2"},Ct=["max","readonly"],At=["disabled"],Mt={class:"border px-2 py-2"},Vt=["readonly"],zt={class:"mt-2 flex justify-end gap-2 print:hidden"},Ft=["disabled"],It={class:"border px-2 py-2 align-top text-right"},Ot={class:"border px-2 py-2 align-top"},$t={class:"flex items-center justify-end gap-2"},jt=["max","readonly"],Dt=["disabled"],Et={class:"border px-2 py-2 align-top"},Lt={class:"flex items-center justify-end gap-2"},Ut=["max","readonly"],Bt=["disabled"],Pt={class:"bg-gray-50 font-medium"},Ht={class:"border px-2 py-2 text-right"},Kt={class:"border px-2 py-2 text-right"},Rt={class:"border px-2 py-2 text-right"},Gt={class:"mt-4"},Jt={class:"grid grid-cols-12 gap-2 text-sm"},Yt={class:"col-span-10 border p-2 rounded"},qt=["readonly"],Qt={class:"mt-2 flex justify-end print:hidden"},Wt=["disabled"],Xt={class:"col-span-10 border p-2 rounded"},Zt=["readonly"],es={class:"mt-2 flex justify-end print:hidden"},ts=["disabled"],ss={key:3,class:"rounded-md border bg-white p-4 text-gray-600"},os={__name:"EvaluationShow",setup(rs){const b=Ne(),ue=Se(),pe=Te(),_=Number(pe.params.id),v=Ie(),{current:i,isLoading:ve,isSaving:x,error:L}=Ce(v),m=M({max_score:0,incharge_score:0,incharge_comment:"",coordinator_score:0,coordinator_comment:"",final_score:0}),g=M({max_score:0,incharge_score:0,incharge_comment:"",coordinator_score:0,coordinator_comment:"",final_score:0}),V=M(""),z=M(""),l=p(()=>{var s;return!!((s=i.value)!=null&&s.finalized_at)}),F=p(()=>{var s;return((s=i.value)==null?void 0:s.form)??{}}),f=p(()=>{var s;return Number(g.value.max_score||((s=F.value)==null?void 0:s.performance_mark)||0)}),h=p(()=>{var s;return Number(m.value.max_score||((s=F.value)==null?void 0:s.target_marks)||0)}),I=p(()=>f.value+h.value),U=p(()=>S(g.value.incharge_score,0,f.value)+S(m.value.incharge_score,0,h.value)),B=p(()=>S(g.value.coordinator_score,0,f.value)+S(m.value.coordinator_score,0,h.value)),me=p(()=>Number(g.value.final_score||0)+Number(m.value.final_score||0));function S(s,t,o){let r=Number(s??0);return Number.isFinite(r)||(r=0),r<t?t:r>o?o:r}function E(s){var r,u;const t=(s==null?void 0:s.target)??{};m.value={max_score:Number(t.max_score||((r=F.value)==null?void 0:r.target_marks)||0),incharge_score:Number(t.incharge_score||0),incharge_comment:String(t.incharge_comment||""),coordinator_score:Number(t.coordinator_score||0),coordinator_comment:String(t.coordinator_comment||""),final_score:Number(t.final_score||0)};const o=(s==null?void 0:s.performance)??{};g.value={max_score:Number(o.max_score||((u=F.value)==null?void 0:u.performance_mark)||0),incharge_score:Number(o.incharge_score||0),incharge_comment:String(o.incharge_comment||""),coordinator_score:Number(o.coordinator_score||0),coordinator_comment:String(o.coordinator_comment||""),final_score:Number(o.final_score||0)}}const c=p(()=>{var s;return((s=i.value)==null?void 0:s.user)??null}),ge=p(()=>{var s;return((s=c.value)==null?void 0:s.criteria_assignments)??null}),be=p(()=>{const s=ge.value;return Array.isArray(s)?s.length:Array.isArray(s==null?void 0:s.items)?s.items.length:typeof(s==null?void 0:s.count)=="number"?s.count:typeof(s==null?void 0:s.length)=="number"?s.length:0}),O=M(!1);function _e(){c.value&&(O.value=!0)}async function fe(s){var t;O.value=!1;try{await v.show(_),E(i.value),b.success("Criteria updated")}catch{s&&((t=i.value)!=null&&t.user)&&(i.value.user.criteria_assignments=s.criteria_assignments||s)}}async function he(){var t,o,r;await v.show(_),E(i.value);const s=((t=i.value)==null?void 0:t.observations)??[];V.value=((o=s.find(u=>u.role==="incharge"))==null?void 0:o.observation)||"",z.value=((r=s.find(u=>u.role==="coordinator"))==null?void 0:r.observation)||""}Ae(i,E);async function xe(){var s,t,o;try{await v.updateTarget(_,((s=i.value)==null?void 0:s.monthly_target)||""),b.success("Target text saved"),await v.show(_)}catch(r){b.error(((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to save target")}}async function $(s,t){var C,A;const o=s==="target"?m.value:g.value,r=s==="target"?h.value:f.value,u=S(t==="incharge"?o.incharge_score:o.coordinator_score,0,r),j=t==="incharge"?o.incharge_comment:o.coordinator_comment;try{await v.rateScore(_,s,t,u,j||""),b.success(`${s} score saved`),await v.show(_)}catch(T){b.error(((A=(C=T==null?void 0:T.response)==null?void 0:C.data)==null?void 0:A.message)||"Failed to save score")}}async function P(s){var t,o;try{const r=s==="incharge"?V.value:z.value;await v.saveObservation(_,s,r),b.success("Observation saved")}catch(r){b.error(((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to save")}}async function ye(){var s,t;if(confirm("Finalize this evaluation?"))try{await v.finalize(_),b.success("Finalized"),await v.show(_)}catch(o){b.error(((t=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to finalize")}}function we(){ue.back(-1)}Me(he);function ke(){typeof window<"u"&&typeof window.print=="function"&&window.print()}return(s,t)=>{var o,r,u,j,C,A,T,H,K,R,G,J,Y,q,Q,W,X,Z,ee,te,se,oe,re,ne,ie,ae,de,le;return w(),y("div",$e,[e("div",je,[e("div",{class:"flex items-center gap-2"},[e("button",{class:"btn-3",onClick:we},t[14]||(t[14]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[15]||(t[15]=e("h1",{class:"title-md md:title-lg"},"KPI Sheet",-1))]),e("div",De,[e("button",{class:"btn-2",disabled:n(x)||l.value||!n(i),onClick:ye},d(l.value?"Finalized":"Finalize"),9,Ee),e("button",{class:"btn-3",onClick:ke},t[16]||(t[16]=[e("i",{class:"far fa-print mr-1"},null,-1),D("Print")]))])]),n(ve)?(w(),y("div",Le,[ce(ze)])):n(L)?(w(),y("div",Ue,d(n(L)),1)):n(i)?(w(),y("div",Be,[e("div",Pe,[t[17]||(t[17]=e("h2",{class:"text-xl font-semibold"},"Key Performance Indicator (KPI)",-1)),e("p",He," Bi-monthly: "+d((o=n(i).form)==null?void 0:o.start_month)+d((r=n(i).form)!=null&&r.end_month?` – ${n(i).form.end_month}`:""),1)]),e("div",Ke,[e("div",Re,[t[18]||(t[18]=D(" NAME: ")),e("span",Ge,d((j=(u=n(i))==null?void 0:u.user)==null?void 0:j.name),1)]),e("div",Je,[t[19]||(t[19]=D(" DESIGNATION: ")),e("span",Ye,d((A=(C=n(i))==null?void 0:C.user)==null?void 0:A.designation),1)]),e("div",qe," DATE OF JOINING: "+d((H=(T=n(i))==null?void 0:T.user)==null?void 0:H.joining_date),1),e("div",Qe,"DEPARTMENT: "+d((R=(K=n(i))==null?void 0:K.user)==null?void 0:R.department),1),e("div",We,[t[20]||(t[20]=D(" COMPANY:")),e("span",Xe,d((J=(G=n(i))==null?void 0:G.user)==null?void 0:J.company),1)])]),e("div",Ze,[e("div",et,[t[21]||(t[21]=e("div",{class:"text-gray-500"},"In-charge total",-1)),e("div",tt,d(U.value)+" / "+d(I.value),1)]),e("div",st,[t[22]||(t[22]=e("div",{class:"text-gray-500"},"Coordinator total",-1)),e("div",ot,d(B.value)+" / "+d(I.value),1)]),e("div",rt,[t[23]||(t[23]=e("div",{class:"text-gray-500"},"Final (server)",-1)),e("div",nt,d(me.value)+" / "+d(I.value),1)])]),e("div",it,[e("table",at,[t[30]||(t[30]=e("thead",null,[e("tr",{class:"bg-gray-100 text-gray-800"},[e("th",{class:"border px-2 py-2 w-10"},"ক্রম"),e("th",{class:"border px-2 py-2"},"কার্যসম্পাদন বিষয়"),e("th",{class:"border px-2 py-2 w-32 text-right"},"সর্বোচ্চ"),e("th",{class:"border px-2 py-2 w-32 text-right"},"In-charge"),e("th",{class:"border px-2 py-2 w-36 text-right"},"Coordinator/AD/DD")])],-1)),e("tbody",null,[e("tr",null,[t[26]||(t[26]=e("td",{class:"border px-2 py-2 align-top text-center"},"১",-1)),e("td",dt,[(q=(Y=c.value)==null?void 0:Y.criteria_assignments)!=null&&q.description?(w(),y("div",lt,[e("input",{id:`kpi-desc-toggle-${((Q=c.value)==null?void 0:Q.id)??s.index}`,type:"checkbox",class:"peer sr-only"},null,8,ct),e("div",{class:"richtext overflow-hidden [display:-webkit-box] [-webkit-box-orient:vertical] [-webkit-line-clamp:3] peer-checked:overflow-visible peer-checked:[display:block] peer-checked:[-webkit-line-clamp:unset] peer-checked:[-webkit-box-orient:unset] print:hidden",innerHTML:(X=(W=c.value)==null?void 0:W.criteria_assignments)==null?void 0:X.description},null,8,ut),e("div",{class:"hidden print:block richtext print:break-inside-avoid",innerHTML:(ee=(Z=c.value)==null?void 0:Z.criteria_assignments)==null?void 0:ee.description},null,8,pt),e("div",vt,[e("label",{for:`kpi-desc-toggle-${((te=c.value)==null?void 0:te.id)??s.index}`,class:"underline text-blue-500 inline-flex items-center gap-1 cursor-pointer select-none peer-checked:hidden"}," See more ",8,mt),e("label",{for:`kpi-desc-toggle-${((se=c.value)==null?void 0:se.id)??s.index}`,class:"underline text-blue-500 hidden peer-checked:inline-flex items-center gap-1 cursor-pointer select-none"}," See less ",8,gt)])])):Ve("",!0),e("div",bt,[e("button",{onClick:_e,title:"Assign KPI criteria",class:"btn-4"},[be.value>0||(re=(oe=c.value)==null?void 0:oe.criteria_assignments)!=null&&re.description?(w(),y("svg",_t,t[24]||(t[24]=[e("path",{fill:"currentColor",d:"M9 16.2l-3.5-3.5L4 14.2l5 5 11-11-1.5-1.5z"},null,-1)]))):(w(),y("svg",ft,t[25]||(t[25]=[e("path",{fill:"currentColor",d:"M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2z"},null,-1)]))),e("span",ht,d((ie=(ne=c.value)==null?void 0:ne.criteria_assignments)!=null&&ie.description?"Edit":"Assign"),1)])])]),e("td",xt,d(f.value),1),e("td",yt,[e("div",wt,[k(e("input",{type:"number",min:"0",max:f.value,readonly:l.value,"onUpdate:modelValue":t[0]||(t[0]=a=>g.value.incharge_score=a),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,kt),[[N,g.value.incharge_score,void 0,{number:!0}]]),e("button",{class:"btn-4 print:hidden",disabled:n(x)||l.value||!f.value,onClick:t[1]||(t[1]=a=>$("performance","incharge"))}," Save ",8,Nt)])]),e("td",St,[e("div",Tt,[k(e("input",{type:"number",min:"0",max:f.value,readonly:l.value,"onUpdate:modelValue":t[2]||(t[2]=a=>g.value.coordinator_score=a),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Ct),[[N,g.value.coordinator_score,void 0,{number:!0}]]),e("button",{class:"btn-4 print:hidden",disabled:n(x)||l.value||!f.value,onClick:t[3]||(t[3]=a=>$("performance","coordinator"))}," Save ",8,At)])])]),e("tr",null,[t[28]||(t[28]=e("td",{class:"border px-2 py-2 align-top text-center"},"২",-1)),e("td",Mt,[t[27]||(t[27]=e("label",{class:"block text-xs text-gray-600 mb-1"},"Target (মাসিক লক্ষ্য)",-1)),k(e("textarea",{rows:"3","onUpdate:modelValue":t[4]||(t[4]=a=>n(i).monthly_target=a),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200",placeholder:"এই মাসের স্পষ্ট টার্গেট লিখুন…"},null,8,Vt),[[N,n(i).monthly_target]]),e("div",zt,[e("button",{class:"btn-4",disabled:n(x)||l.value,onClick:xe}," Save Target ",8,Ft)])]),e("td",It,d(h.value),1),e("td",Ot,[e("div",$t,[k(e("input",{type:"number",min:"0",max:h.value,readonly:l.value,"onUpdate:modelValue":t[5]||(t[5]=a=>m.value.incharge_score=a),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,jt),[[N,m.value.incharge_score,void 0,{number:!0}]]),e("button",{class:"btn-4 print:hidden",disabled:n(x)||l.value||!h.value,onClick:t[6]||(t[6]=a=>$("target","incharge"))}," Save ",8,Dt)])]),e("td",Et,[e("div",Lt,[k(e("input",{type:"number",min:"0",max:h.value,readonly:l.value,"onUpdate:modelValue":t[7]||(t[7]=a=>m.value.coordinator_score=a),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Ut),[[N,m.value.coordinator_score,void 0,{number:!0}]]),e("button",{class:"btn-4 print:hidden",disabled:n(x)||l.value||!h.value,onClick:t[8]||(t[8]=a=>$("target","coordinator"))}," Save ",8,Bt)])])]),e("tr",Pt,[t[29]||(t[29]=e("td",{class:"border px-2 py-2 text-right",colspan:"2"},"সর্বমোট",-1)),e("td",Ht,d(I.value),1),e("td",Kt,d(U.value),1),e("td",Rt,d(B.value),1)])])])]),e("div",Gt,[t[33]||(t[33]=e("div",{class:"text-sm font-semibold mb-2"},"Observation:",-1)),e("div",Jt,[t[31]||(t[31]=e("div",{class:"col-span-2 border p-2 bg-gray-50 rounded"},"ইনচার্জ",-1)),e("div",Yt,[k(e("textarea",{rows:"3","onUpdate:modelValue":t[9]||(t[9]=a=>V.value=a),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,qt),[[N,V.value]]),e("div",Qt,[e("button",{class:"btn-4",disabled:n(x)||l.value,onClick:t[10]||(t[10]=a=>P("incharge"))}," Save ",8,Wt)])]),t[32]||(t[32]=e("div",{class:"col-span-2 border p-2 bg-gray-50 rounded"},"বিভাগীয় কো-অর্ডিনেটর",-1)),e("div",Xt,[k(e("textarea",{rows:"3","onUpdate:modelValue":t[11]||(t[11]=a=>z.value=a),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Zt),[[N,z.value]]),e("div",es,[e("button",{class:"btn-4",disabled:n(x)||l.value,onClick:t[12]||(t[12]=a=>P("coordinator"))}," Save ",8,ts)])])])]),t[34]||(t[34]=e("div",{class:"grid grid-cols-12 gap-2 pt-4 text-sm"},[e("div",{class:"col-span-6 border p-3 rounded"},"মূল্যায়নকারীর নাম:"),e("div",{class:"col-span-6 border p-3 rounded"},"স্বাক্ষর:")],-1))])):(w(),y("div",ss,"Data not available.")),ce(Fe,{modelValue:O.value,"onUpdate:modelValue":t[13]||(t[13]=a=>O.value=a),"user-id":(ae=c.value)==null?void 0:ae.id,"user-label":(de=c.value)==null?void 0:de.name,criteria_assignments:(le=c.value)==null?void 0:le.criteria_assignments,onAssigned:fe},null,8,["modelValue","user-id","user-label","criteria_assignments"])])}}},us=Oe(os,[["__scopeId","data-v-601e7e82"]]);export{us as default};
