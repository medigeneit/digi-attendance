import{P as xe,u as he,b as ye,s as we,r as V,x as u,A as ke,e as Ne,c as y,o as w,a as t,n as ne,k as n,t as d,j as E,g as Ce,h as k,v as N}from"./index-DWf0FhHw.js";import{L as Se}from"./LoaderView-BDGXk3uk.js";import{C as Te}from"./CriteriaAssignModal-fThVc9G8.js";import{u as Ae}from"./user-monthly-kpi-DQgcxIuc.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./monthly-kpi-assignments-DPJtey6k.js";const Me={class:"space-y-4 px-4 print:px-0 max-w-7xl mx-auto"},ze={class:"flex items-center justify-between gap-2 sticky top-0 z-10 bg-white/80 backdrop-blur p-2 rounded-b-lg border-b print:hidden"},Fe={class:"flex gap-2"},Ie=["disabled"],Oe={key:0,class:"py-8 text-center"},je={key:1,class:"rounded-md border border-red-200 bg-red-50 p-3 text-red-700"},De={key:2,class:"rounded-2xl bg-white p-5 shadow-sm space-y-4"},Ee={class:"text-center"},Pe={class:"text-sm text-gray-600"},Ue={class:"grid grid-cols-12 gap-2 text-sm"},Be={class:"col-span-6 border p-2 rounded"},$e={class:"font-medium"},Le={class:"col-span-3 border p-2 rounded"},Ke={class:"font-medium"},Re={class:"col-span-3 border p-2 rounded"},He={class:"col-span-6 border p-2 rounded"},Ge={class:"col-span-3 border p-2 rounded"},Je={class:"font-medium"},Ye={class:"grid grid-cols-1 print:grid-cols-3 md:grid-cols-3 gap-2 text-sm"},qe={class:"rounded-lg border p-2 text-center"},Qe={class:"font-semibold"},We={class:"rounded-lg border p-2 text-center"},Xe={class:"font-semibold"},Ze={class:"rounded-lg border p-2 text-center"},et={class:"font-semibold"},tt={class:"overflow-x-auto"},st={class:"min-w-full border text-sm"},ot={class:"border px-2 py-2 align-top"},rt=["innerHTML"],nt={class:"mt-2"},at={key:0,viewBox:"0 0 24 24",class:"h-4 w-4 opacity-90"},it={key:1,viewBox:"0 0 24 24",class:"h-4 w-4 opacity-80"},dt={class:"ml-1 hidden lg:inline"},lt={class:"border px-2 py-2 align-top text-right"},ct={class:"border px-2 py-2 align-top"},ut={class:"flex items-center justify-end gap-2"},mt=["max","readonly"],vt=["disabled"],pt={class:"border px-2 py-2 align-top"},gt={class:"flex items-center justify-end gap-2"},_t=["max","readonly"],bt=["disabled"],ft={class:"border px-2 py-2"},xt=["readonly"],ht={class:"mt-2 flex justify-end gap-2 print:hidden"},yt=["disabled"],wt={class:"border px-2 py-2 align-top text-right"},kt={class:"border px-2 py-2 align-top"},Nt={class:"flex items-center justify-end gap-2"},Ct=["max","readonly"],St=["disabled"],Tt={class:"border px-2 py-2 align-top"},At={class:"flex items-center justify-end gap-2"},Vt=["max","readonly"],Mt=["disabled"],zt={class:"bg-gray-50 font-medium"},Ft={class:"border px-2 py-2 text-right"},It={class:"border px-2 py-2 text-right"},Ot={class:"border px-2 py-2 text-right"},jt={class:"mt-4"},Dt={class:"grid grid-cols-12 gap-2 text-sm"},Et={class:"col-span-10 border p-2 rounded"},Pt=["readonly"],Ut={class:"mt-2 flex justify-end print:hidden"},Bt=["disabled"],$t={class:"col-span-10 border p-2 rounded"},Lt=["readonly"],Kt={class:"mt-2 flex justify-end print:hidden"},Rt=["disabled"],Ht={key:3,class:"rounded-md border bg-white p-4 text-gray-600"},Gt={__name:"EvaluationShow",setup(Jt){const g=xe(),ae=he(),ie=ye(),_=Number(ie.params.id),m=Ae(),{current:a,isLoading:de,isSaving:h,error:U}=we(m),v=V({max_score:0,incharge_score:0,incharge_comment:"",coordinator_score:0,coordinator_comment:"",final_score:0}),p=V({max_score:0,incharge_score:0,incharge_comment:"",coordinator_score:0,coordinator_comment:"",final_score:0}),M=V(""),z=V(""),l=u(()=>{var s;return!!((s=a.value)!=null&&s.finalized_at)}),F=u(()=>{var s;return((s=a.value)==null?void 0:s.form)??{}}),b=u(()=>{var s;return Number(p.value.max_score||((s=F.value)==null?void 0:s.performance_mark)||0)}),f=u(()=>{var s;return Number(v.value.max_score||((s=F.value)==null?void 0:s.target_marks)||0)}),I=u(()=>b.value+f.value),B=u(()=>C(p.value.incharge_score,0,b.value)+C(v.value.incharge_score,0,f.value)),$=u(()=>C(p.value.coordinator_score,0,b.value)+C(v.value.coordinator_score,0,f.value)),le=u(()=>Number(p.value.final_score||0)+Number(v.value.final_score||0));function C(s,e,o){let r=Number(s??0);return Number.isFinite(r)||(r=0),r<e?e:r>o?o:r}function P(s){var r,c;const e=(s==null?void 0:s.target)??{};v.value={max_score:Number(e.max_score||((r=F.value)==null?void 0:r.target_marks)||0),incharge_score:Number(e.incharge_score||0),incharge_comment:String(e.incharge_comment||""),coordinator_score:Number(e.coordinator_score||0),coordinator_comment:String(e.coordinator_comment||""),final_score:Number(e.final_score||0)};const o=(s==null?void 0:s.performance)??{};p.value={max_score:Number(o.max_score||((c=F.value)==null?void 0:c.performance_mark)||0),incharge_score:Number(o.incharge_score||0),incharge_comment:String(o.incharge_comment||""),coordinator_score:Number(o.coordinator_score||0),coordinator_comment:String(o.coordinator_comment||""),final_score:Number(o.final_score||0)}}const x=u(()=>{var s;return((s=a.value)==null?void 0:s.user)??null}),ce=u(()=>{var s;return((s=x.value)==null?void 0:s.criteria_assignments)??null}),ue=u(()=>{const s=ce.value;return Array.isArray(s)?s.length:Array.isArray(s==null?void 0:s.items)?s.items.length:typeof(s==null?void 0:s.count)=="number"?s.count:typeof(s==null?void 0:s.length)=="number"?s.length:0}),O=V(!1);function me(){x.value&&(O.value=!0)}async function ve(s){var e;O.value=!1;try{await m.show(_),P(a.value),g.success("Criteria updated")}catch{s&&((e=a.value)!=null&&e.user)&&(a.value.user.criteria_assignments=s.criteria_assignments||s)}}async function pe(){var e,o,r;await m.show(_),P(a.value);const s=((e=a.value)==null?void 0:e.observations)??[];M.value=((o=s.find(c=>c.role==="incharge"))==null?void 0:o.observation)||"",z.value=((r=s.find(c=>c.role==="coordinator"))==null?void 0:r.observation)||""}ke(a,P);async function ge(){var s,e,o;try{await m.updateTarget(_,((s=a.value)==null?void 0:s.monthly_target)||""),g.success("Target text saved"),await m.show(_)}catch(r){g.error(((o=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to save target")}}async function j(s,e){var T,A;const o=s==="target"?v.value:p.value,r=s==="target"?f.value:b.value,c=C(e==="incharge"?o.incharge_score:o.coordinator_score,0,r),D=e==="incharge"?o.incharge_comment:o.coordinator_comment;try{await m.rateScore(_,s,e,c,D||""),g.success(`${s} score saved`),await m.show(_)}catch(S){g.error(((A=(T=S==null?void 0:S.response)==null?void 0:T.data)==null?void 0:A.message)||"Failed to save score")}}async function L(s){var e,o;try{const r=s==="incharge"?M.value:z.value;await m.saveObservation(_,s,r),g.success("Observation saved")}catch(r){g.error(((o=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to save")}}async function _e(){var s,e;if(confirm("Finalize this evaluation?"))try{await m.finalize(_),g.success("Finalized"),await m.show(_)}catch(o){g.error(((e=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to finalize")}}function be(){ae.back(-1)}Ne(pe);function fe(){typeof window<"u"&&typeof window.print=="function"&&window.print()}return(s,e)=>{var o,r,c,D,T,A,S,K,R,H,G,J,Y,q,Q,W,X,Z,ee,te,se,oe,re;return w(),y("div",Me,[t("div",ze,[t("div",{class:"flex items-center gap-2"},[t("button",{class:"btn-3",onClick:be},e[14]||(e[14]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[15]||(e[15]=t("h1",{class:"title-md md:title-lg"},"KPI Sheet",-1))]),t("div",Fe,[t("button",{class:"btn-2",disabled:n(h)||l.value||!n(a),onClick:_e},d(l.value?"Finalized":"Finalize"),9,Ie),t("button",{class:"btn-3",onClick:fe},e[16]||(e[16]=[t("i",{class:"far fa-print mr-1"},null,-1),E("Print")]))])]),n(de)?(w(),y("div",Oe,[ne(Se)])):n(U)?(w(),y("div",je,d(n(U)),1)):n(a)?(w(),y("div",De,[t("div",Ee,[e[17]||(e[17]=t("h2",{class:"text-xl font-semibold"},"Key Performance Indicator (KPI)",-1)),t("p",Pe," Bi-monthly: "+d((o=n(a).form)==null?void 0:o.start_month)+d((r=n(a).form)!=null&&r.end_month?` – ${n(a).form.end_month}`:""),1)]),t("div",Ue,[t("div",Be,[e[18]||(e[18]=E("NAME: ")),t("span",$e,d((D=(c=n(a))==null?void 0:c.user)==null?void 0:D.name),1)]),t("div",Le,[e[19]||(e[19]=E("DESIGNATION: ")),t("span",Ke,d((A=(T=n(a))==null?void 0:T.user)==null?void 0:A.designation),1)]),t("div",Re,"DATE OF JOINING: "+d((K=(S=n(a))==null?void 0:S.user)==null?void 0:K.joining_date),1),t("div",He,"DEPARTMENT: "+d((H=(R=n(a))==null?void 0:R.user)==null?void 0:H.department),1),t("div",Ge,[e[20]||(e[20]=E("COMPANY:")),t("span",Je,d((J=(G=n(a))==null?void 0:G.user)==null?void 0:J.company),1)])]),t("div",Ye,[t("div",qe,[e[21]||(e[21]=t("div",{class:"text-gray-500"},"In-charge total",-1)),t("div",Qe,d(B.value)+" / "+d(I.value),1)]),t("div",We,[e[22]||(e[22]=t("div",{class:"text-gray-500"},"Coordinator total",-1)),t("div",Xe,d($.value)+" / "+d(I.value),1)]),t("div",Ze,[e[23]||(e[23]=t("div",{class:"text-gray-500"},"Final (server)",-1)),t("div",et,d(le.value)+" / "+d(I.value),1)])]),t("div",tt,[t("table",st,[e[30]||(e[30]=t("thead",null,[t("tr",{class:"bg-gray-100 text-gray-800"},[t("th",{class:"border px-2 py-2 w-10"},"ক্রম"),t("th",{class:"border px-2 py-2"},"কার্যসম্পাদন বিষয়"),t("th",{class:"border px-2 py-2 w-32 text-right"},"সর্বোচ্চ"),t("th",{class:"border px-2 py-2 w-32 text-right"},"In-charge"),t("th",{class:"border px-2 py-2 w-36 text-right"},"Coordinator/AD/DD")])],-1)),t("tbody",null,[t("tr",null,[e[26]||(e[26]=t("td",{class:"border px-2 py-2 align-top text-center"},"১",-1)),t("td",ot,[(q=(Y=x.value)==null?void 0:Y.criteria_assignments)!=null&&q.description?(w(),y("div",{key:0,class:"prose prose-sm max-w-none text-slate-700 line-clamp-3",innerHTML:(W=(Q=x.value)==null?void 0:Q.criteria_assignments)==null?void 0:W.description},null,8,rt)):Ce("",!0),t("div",nt,[t("button",{onClick:me,title:"Assign KPI criteria",class:"btn-4"},[ue.value>0||(Z=(X=x.value)==null?void 0:X.criteria_assignments)!=null&&Z.description?(w(),y("svg",at,e[24]||(e[24]=[t("path",{fill:"currentColor",d:"M9 16.2l-3.5-3.5L4 14.2l5 5 11-11-1.5-1.5z"},null,-1)]))):(w(),y("svg",it,e[25]||(e[25]=[t("path",{fill:"currentColor",d:"M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2z"},null,-1)]))),t("span",dt,d((te=(ee=x.value)==null?void 0:ee.criteria_assignments)!=null&&te.description?"Edit":"Assign"),1)])])]),t("td",lt,d(b.value),1),t("td",ct,[t("div",ut,[k(t("input",{type:"number",min:"0",max:b.value,readonly:l.value,"onUpdate:modelValue":e[0]||(e[0]=i=>p.value.incharge_score=i),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,mt),[[N,p.value.incharge_score,void 0,{number:!0}]]),t("button",{class:"btn-4 print:hidden",disabled:n(h)||l.value||!b.value,onClick:e[1]||(e[1]=i=>j("performance","incharge"))},"Save",8,vt)])]),t("td",pt,[t("div",gt,[k(t("input",{type:"number",min:"0",max:b.value,readonly:l.value,"onUpdate:modelValue":e[2]||(e[2]=i=>p.value.coordinator_score=i),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,_t),[[N,p.value.coordinator_score,void 0,{number:!0}]]),t("button",{class:"btn-4 print:hidden",disabled:n(h)||l.value||!b.value,onClick:e[3]||(e[3]=i=>j("performance","coordinator"))},"Save",8,bt)])])]),t("tr",null,[e[28]||(e[28]=t("td",{class:"border px-2 py-2 align-top text-center"},"২",-1)),t("td",ft,[e[27]||(e[27]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Target (মাসিক লক্ষ্য)",-1)),k(t("textarea",{rows:"3","onUpdate:modelValue":e[4]||(e[4]=i=>n(a).monthly_target=i),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200",placeholder:"এই মাসের স্পষ্ট টার্গেট লিখুন…"},null,8,xt),[[N,n(a).monthly_target]]),t("div",ht,[t("button",{class:"btn-4",disabled:n(h)||l.value,onClick:ge},"Save Target",8,yt)])]),t("td",wt,d(f.value),1),t("td",kt,[t("div",Nt,[k(t("input",{type:"number",min:"0",max:f.value,readonly:l.value,"onUpdate:modelValue":e[5]||(e[5]=i=>v.value.incharge_score=i),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Ct),[[N,v.value.incharge_score,void 0,{number:!0}]]),t("button",{class:"btn-4 print:hidden",disabled:n(h)||l.value||!f.value,onClick:e[6]||(e[6]=i=>j("target","incharge"))},"Save",8,St)])]),t("td",Tt,[t("div",At,[k(t("input",{type:"number",min:"0",max:f.value,readonly:l.value,"onUpdate:modelValue":e[7]||(e[7]=i=>v.value.coordinator_score=i),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Vt),[[N,v.value.coordinator_score,void 0,{number:!0}]]),t("button",{class:"btn-4 print:hidden",disabled:n(h)||l.value||!f.value,onClick:e[8]||(e[8]=i=>j("target","coordinator"))},"Save",8,Mt)])])]),t("tr",zt,[e[29]||(e[29]=t("td",{class:"border px-2 py-2 text-right",colspan:"2"},"সর্বমোট",-1)),t("td",Ft,d(I.value),1),t("td",It,d(B.value),1),t("td",Ot,d($.value),1)])])])]),t("div",jt,[e[33]||(e[33]=t("div",{class:"text-sm font-semibold mb-2"},"Observation:",-1)),t("div",Dt,[e[31]||(e[31]=t("div",{class:"col-span-2 border p-2 bg-gray-50 rounded"},"ইনচার্জ",-1)),t("div",Et,[k(t("textarea",{rows:"3","onUpdate:modelValue":e[9]||(e[9]=i=>M.value=i),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Pt),[[N,M.value]]),t("div",Ut,[t("button",{class:"btn-4",disabled:n(h)||l.value,onClick:e[10]||(e[10]=i=>L("incharge"))},"Save",8,Bt)])]),e[32]||(e[32]=t("div",{class:"col-span-2 border p-2 bg-gray-50 rounded"},"বিভাগীয় কো-অর্ডিনেটর",-1)),t("div",$t,[k(t("textarea",{rows:"3","onUpdate:modelValue":e[11]||(e[11]=i=>z.value=i),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Lt),[[N,z.value]]),t("div",Kt,[t("button",{class:"btn-4",disabled:n(h)||l.value,onClick:e[12]||(e[12]=i=>L("coordinator"))},"Save",8,Rt)])])])]),e[34]||(e[34]=t("div",{class:"grid grid-cols-12 gap-2 pt-4 text-sm"},[t("div",{class:"col-span-6 border p-3 rounded"},"মূল্যায়নকারীর নাম:"),t("div",{class:"col-span-6 border p-3 rounded"},"স্বাক্ষর:")],-1))])):(w(),y("div",Ht,"Data not available.")),ne(Te,{modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=i=>O.value=i),"user-id":(se=x.value)==null?void 0:se.id,"user-label":(oe=x.value)==null?void 0:oe.name,criteria_assignments:(re=x.value)==null?void 0:re.criteria_assignments,onAssigned:ve},null,8,["modelValue","user-id","user-label","criteria_assignments"])])}}},es=Ve(Gt,[["__scopeId","data-v-bea42686"]]);export{es as default};
