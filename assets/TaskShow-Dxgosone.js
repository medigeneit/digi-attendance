import{r as _,c as u,o,a,f as b,E as K,h as n,w as I,t as T,l as y,p as v,D as J,m as L,b as Q,u as W,y as $,e as X,A as Y,k as V,F as G,q as P,x as Z,_ as tt,n as C}from"./index-D53UnUau.js";import{u as st,_ as et,O as H}from"./task-priority-B9038a0Y.js";import{_ as at}from"./TaskAddForm-BssChA_E.js";import{_ as nt}from"./TaskEditForm-C89AJZOf.js";import{_ as ot,a as rt}from"./TaskTreeView-C1Y31tzT.js";import{u as it}from"./useTaskStore-1BbCY0OO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-B-t9hhKy.js";import"./SectionLoading-DvJFxYYn.js";const lt={class:"mb-3"},dt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},ut={key:1,class:"text-center py-4 text-gray-500"},pt={key:2,class:"text-center py-4 text-red-500"},kt={key:3,class:"space-y-4"},mt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(m,{emit:e}){const i=m,c=e,k=_(null),{handleItemsPriorityUpdate:r,saveTaskPriority:p,listHasRearranged:f}=st(()=>i.tasks,i.parentId),g=async()=>{await p(),c("updatePriority")};return(x,l)=>(o(),u("div",null,[a("div",lt,[K(x.$slots,"task:header")]),n(f)?(o(),u("div",dt,[l[3]||(l[3]=a("span",{class:"text-red-500"},"Priority Changed",-1)),a("button",{class:"btn-3",onClick:I(g,["prevent"])},"Save"),a("button",{class:"btn-3",onClick:l[0]||(l[0]=I((...s)=>k.value.resetItems&&k.value.resetItems(...s),["prevent"]))},"Discard")])):b("",!0),m.loading?(o(),u("div",ut,"Loading tasks...")):m.error?(o(),u("div",pt,T(m.error),1)):(o(),u("div",kt,[y(et,{items:m.tasks,handle:"handle",onItemsUpdate:n(r),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:k},{item:v(({item:s})=>[y(ot,{task:s,class:"!border-0",onCommentButtonClick:t=>c("commentButtonClick",s.id),onEditClick:l[1]||(l[1]=t=>c("editClick",t)),onAddClick:l[2]||(l[2]=t=>c("addClick",t)),showDraggableHandle:!0},null,8,["task","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},ct={class:"flex justify-between mt-5"},ft={class:"flex flex-wrap items-center gap-2 mt-3"},gt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(m,{emit:e}){const i=m,c=e,k=_(),r=J({show:!1,parentId:i.parentId,requirementId:null}),p=l=>{r.show=!0,r.parentId=l,console.log({addForm:r})};function f(){r.show=!1,r.parentId=i.parentId,c("created")}function g(){k.value=!1,c("updated")}function x(){r.show=!1,r.parentId=i.parentId}return(l,s)=>(o(),u("div",null,[k.value?(o(),L(H,{key:0},{default:v(()=>[y(nt,{taskId:k.value,onClose:s[0]||(s[0]=t=>k.value=null),onUpdated:g},null,8,["taskId"])]),_:1})):b("",!0),r.show?(o(),L(H,{key:1},{default:v(()=>[y(at,{parentTaskId:r.parentId,requirementId:r.requirementId,onTaskCreated:f,onError:l.handleTaskError,onClose:x},null,8,["parentTaskId","requirementId","onError"])]),_:1})):b("",!0),y(mt,{tasks:m.subTasks,parentId:m.parentId,onAddClick:s[2]||(s[2]=t=>p(t)),onEditClick:s[3]||(s[3]=t=>k.value=t),onUpdatePriority:s[4]||(s[4]=t=>c("updatePriority"))},{"task:header":v(()=>[a("div",ct,[s[5]||(s[5]=a("div",{class:"flex justify-between items-center"},[a("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),a("div",ft,[a("button",{class:"btn-1 ml-auto",onClick:s[1]||(s[1]=I(()=>p(m.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId"])]))}},yt=()=>{const m=_(),e=_(0);function i(p,f){m.value=p,e.value=f}function c(){const p=[],f=(g,x=0,l="")=>{g.forEach(s=>{p.push({...s,depth:x,idPath:l+s.id}),s.children_tasks&&s.children_tasks.length&&f(s.children_tasks,x+1,l+s.id+"-")})};return f(r()),p}function k(p,f=0){return Array.isArray(p)===!1||p.length===0?[]:p.filter(g=>g.parent_id===f).map(g=>({...g,children_tasks:k(p,g.id)}))}function r(){return k(m.value,e.value)}return{getTaskListTree:r,getFlattenedTasks:c,setTaskList:i}},xt={class:"container mx-auto p-6"},vt={class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6"},bt={class:"grid grid-cols-4"},Tt={class:"mb-2 font-medium col-span-full text-xl flex"},_t={class:"text-right col-span-full md:col-span-1 ml-auto flex justify-center gap-4 !text-lg"},ht={class:"py-2 font-medium mb-4 col-span-full md:col-span-2"},wt={class:"flex items-center flex-wrap gap-3"},Ct={class:"text-xs text-gray-700 mr-2"},It={key:0,class:"text-gray-500 text-xs"},$t={class:"py-2 col-span-full md:col-span-1"},Pt={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},Lt={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},Et={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},St={class:"py-2 flex justify-center items-center gap-2 col-span-full"},At={class:"ml-auto flex gap-4"},Rt={key:0},Nt={key:1},Ut={key:1,class:"text-center py-4 text-gray-500"},Bt={key:2,class:"text-center py-4 text-red-500"},zt={__name:"TaskShow",setup(m){const e=it(),i=Q(),c=W(),k=yt(),r=$(()=>k.getTaskListTree()),p=_({});X(async()=>{});const f=s=>{c.push({name:"TaskEdit",params:{id:s}})},g=$(()=>{var s,t;return e.task.parent_id==0?{name:"TaskList",params:{id:(s=e.task)==null?void 0:s.id}}:{name:"TaskShow",params:{id:(t=e.task)==null?void 0:t.parent_id}}});async function x(s){const t=await e.fetchTask(s);k.setTaskList(t.sub_tasks,e.task.id)}Y(()=>i.params.id,x,{initial:!0,immediate:!0});const l=$(()=>({...e.task,children_tasks:r.value}));return(s,t)=>{var E,S,A,R,N,U,B,D,q,O,j,F,M;const h=V("RouterLink"),z=V("router-view");return o(),u("div",xt,[a("div",vt,[n(e).task?(o(),u(G,{key:0},[a("section",bt,[a("div",Tt,[a("h2",null,T(n(e).task.title),1),a("div",_t,[a("span",{class:P([{"bg-gray-200":((E=n(e).task)==null?void 0:E.status)==="PENDING","bg-blue-200":((S=n(e).task)==null?void 0:S.status)==="IN_PROGRESS","bg-green-200":((A=n(e).task)==null?void 0:A.status)==="COMPLETED","bg-red-200":((R=n(e).task)==null?void 0:R.status)==="BLOCKED"},"px-3 py-0.5 rounded-full text-sm h-6"])},T((N=n(e).task)==null?void 0:N.status),3),y(rt,{task:l.value,ref_key:"progress",ref:p,class:"!text-lg"},null,8,["task"])])]),a("div",ht,[t[8]||(t[8]=a("div",{class:"text-xs mb-0.5 text-gray-600 uppercase"},"Assigns",-1)),a("div",wt,[(o(!0),u(G,null,Z(((U=n(e).task)==null?void 0:U.users)||[],(d,w)=>(o(),u("div",{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",key:w},[y(tt,{user:d,class:"w-6 h-6 !text-xs"},null,8,["user"]),a("span",Ct,T(d.id)+" - "+T(d==null?void 0:d.name),1)]))),128)),((D=(B=n(e).task)==null?void 0:B.users)==null?void 0:D.length)===0?(o(),u("div",It," Not Assigned To Anyone ")):b("",!0)])]),a("div",$t,[a("div",Pt,[(q=n(e).task)!=null&&q.is_important?(o(),u("span",Lt,"IMPORTANT")):b("",!0),(O=n(e).task)!=null&&O.is_urgent?(o(),u("span",Et,"URGENT")):b("",!0)])]),t[13]||(t[13]=a("hr",{class:"my-3 col-span-full"},null,-1)),a("div",St,[a("button",{onClick:t[0]||(t[0]=I(d=>{var w;return f((w=n(e).task)==null?void 0:w.id)},["stop"])),class:"btn-2"},"Edit"),y(h,{to:{name:"TaskUserAssign",params:{id:(j=n(e).task)==null?void 0:j.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[1]||(t[1]=d=>d.stopPropagation())},{default:v(()=>t[9]||(t[9]=[a("i",{class:"fas fa-user-plus"},null,-1),C(" Assign Users ")])),_:1},8,["to"]),y(h,{to:g.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[2]||(t[2]=d=>d.stopPropagation())},{default:v(()=>t[10]||(t[10]=[a("i",{class:"fas fa-arrow-left"},null,-1),C(" Back ")])),_:1},8,["to"]),a("div",At,[r.value.length>0?(o(),L(h,{key:0,to:{name:"TaskShow",params:{id:(F=n(e).task)==null?void 0:F.id}},onClick:t[3]||(t[3]=d=>d.stopPropagation()),class:P(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":n(i).name=="TaskShow"}])},{default:v(()=>t[11]||(t[11]=[a("i",{class:"fal fa-list-ul"},null,-1),C(" Sub Tasks ")])),_:1},8,["to","class"])):b("",!0),y(h,{to:{name:"TaskReports",params:{id:(M=n(e).task)==null?void 0:M.id}},onClick:t[4]||(t[4]=d=>d.stopPropagation()),class:P(["py-1 btn-3",{"bg-blue-500 text-white":n(i).name=="TaskReports"}])},{default:v(()=>t[12]||(t[12]=[a("i",{class:"fal fa-file-alt"},null,-1),C(" Reports ")])),_:1},8,["to","class"])])])]),n(i).name=="TaskShow"?(o(),u("section",Rt,[y(gt,{subTasks:r.value,"parent-id":n(i).params.id,onCreated:t[5]||(t[5]=d=>x(n(i).params.id)),onUpdated:t[6]||(t[6]=d=>x(n(i).params.id)),onUpdatePriority:t[7]||(t[7]=d=>x(n(i).params.id))},null,8,["subTasks","parent-id"])])):(o(),u("section",Nt,[y(z)]))],64)):n(e).loading?(o(),u("div",Ut," Loading task details... ")):(o(),u("div",Bt,T(n(e).error),1))])])}}};export{zt as default};
