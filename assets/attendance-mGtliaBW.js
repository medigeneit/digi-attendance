import{B as x,r as g,C as m}from"./index-DgFncvHc.js";const G=x("attendance",()=>{const p=g([]),w=g([]),h=g([]),v=g([]),f=g([]),b=g(null),S=g(null),D=g(new Date().toISOString().substring(0,7)),L=g(new Date().toISOString().substring(0,10)),a=g(null),u=g(!1),R=async(t,l)=>{const e=$(l);return p.value.find(n=>n.date===e)},$=t=>{const l=new Date(t),e=String(l.getDate()).padStart(2,"0"),n=l.toLocaleString("en-US",{month:"short"}),o=l.getFullYear();return`${e} ${n} ${o}`};return{monthlyLogs:p,dailyLateLogs:v,monthlyLateLogs:f,summary:b,monthly_company_summary:S,selectedMonth:D,selectedDate:L,error:a,isLoading:u,dailyLogs:h,attendanceLogs:w,getUserDailyLogsByDate:R,getMonthlyAttendanceByShift:async(t,l)=>{var e,n;if(!t||!l){a.value="Invalid user ID or month";return}u.value=!0;try{const o=await m.get(`/user/${t}/attendance/monthly/${l}`);p.value=o.data.monthly_logs,b.value=o.data.summary,a.value=null}catch(o){a.value=((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},getTodayAttendanceReport:async(t={})=>{var l,e;u.value=!0;try{const n=await m.get("/attendance/today",{params:t});h.value=n.data,a.value=null}catch(n){a.value=((e=(l=n.response)==null?void 0:l.data)==null?void 0:e.message)||"Something went wrong",console.error("[Attendance Error]",a.value)}finally{u.value=!1}},getAttendanceLateReport:async(t,l=null,e=null,n=null,o,r)=>{var s,c;u.value=!0;try{const d={company_id:t,department_id:l,category:e,employee_id:n,type:r,...r==="daily"?{date:o}:{month:o}},i=await m.get("/monthly/attendance/late-reports",{params:d});r==="daily"?v.value=i.data:r==="monthly"&&(f.value=i.data),a.value=null}catch(d){a.value=((c=(s=d.response)==null?void 0:s.data)==null?void 0:c.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},getMonthlyAttendanceSummaryReport:async(t,l,e,n,o)=>{var r,s,c;if(!t||!o){a.value="Company & month are required";return}u.value=!0;try{const d={company_id:t,department_id:l,month:o,line_type:e||"",employee_id:n||""},i=await m.get("/attendance/monthly-summary-reports",{params:d});S.value=((r=i.data)==null?void 0:r.data)??i.data,a.value=null}catch(d){a.value=((c=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:c.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},downloadExcel:async(t,l,e)=>{var n,o;if(!t||!e){a.value="Invalid company ID or month";return}u.value=!0;try{const r={company_id:t,line_type:l,month:e},s=await m.get("/attendance/monthly-summary-reports?flag=excel",{params:r,responseType:"blob"}),c=window.URL.createObjectURL(new Blob([s.data])),d=document.createElement("a");d.href=c,d.setAttribute("download",`${e} attendance_summary.xlsx`),document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(r){a.value=((o=(n=r.response)==null?void 0:n.data)==null?void 0:o.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},downloadPDF:async(t,l,e,n=0)=>{var o,r;if(!t||!e){a.value="Invalid user ID or month";return}u.value=!0;try{const s={company_id:t,category:l,month:e},c=await m.get("/attendance/monthly-summary-reports?flag=pdf",{params:s,responseType:"blob"}),d=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=d,i.setAttribute("download",`${e} attendance_summary.pdf`),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(s){a.value=((r=(o=s.response)==null?void 0:o.data)==null?void 0:r.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},attendanceDownloadExcel:async(t,l,e,n,o)=>{var r,s;u.value=!0;try{const c={companyId:t,employee_id:l,line_type:e,month:n,status:o},d=await m.get("/attendance/today?flag=excel",{params:c,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([d.data])),y=document.createElement("a");y.href=i,y.setAttribute("download",`${n} attendance_summary.xlsx`),document.body.appendChild(y),y.click(),document.body.removeChild(y)}catch(c){a.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},attendanceDownloadPdf:async(t,l,e,n,o)=>{var r,s;u.value=!0;try{const c={companyId:t,employee_id:l,category:e,month:n,status:o},d=await m.get("/attendance/today?flag=pdf",{params:c,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([d.data])),y=document.createElement("a");y.href=i,y.setAttribute("download",`${n} attendance_summary.pdf`),document.body.appendChild(y),y.click(),document.body.removeChild(y)}catch(c){a.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},lateReportDownloadExcel:async(t,l,e,n)=>{var o,r;if(!t){a.value="Invalid company ID or date/month";return}u.value=!0;try{const s={company_id:t,...l?{employee_id:l}:{},type:n,...n==="daily"?{date:e}:{month:e}},c=await m.get("/monthly/attendance/late-reports?flag=excel",{params:s,responseType:"blob"}),d=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=d;const y=`${e}-late-attendance.xlsx`;i.setAttribute("download",y),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(s){a.value=((r=(o=s.response)==null?void 0:o.data)==null?void 0:r.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},getMonthlyAttendanceLog:async(t,l)=>{var e,n;if(!t||!l){a.value="Invalid user ID or month";return}u.value=!0;try{const o=await m.get(`/user/${t}/attendance/monthly/${l}/log`);w.value=o.data.attendance_logs}catch(o){a.value=((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},getDateRangeAttendanceSummary:async(t,l,e,n,o)=>{var r,s;if(!e||!t||!l){a.value="Company, Start Date, and End Date are required";return}u.value=!0;try{return(await m.get("/attendance/date-range-summary",{params:{company_id:e,line_type:n||"all",start_date:t,end_date:l,employee_id:o||void 0}})).data}catch(c){return a.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(a.value),null}finally{u.value=!1}},downloadDateRangeExcel:async(t,l,e,n="all",o=null)=>{var d;if(!e||!t||!l){a.value="Company, Start Date, and End Date are required";return}const r=(d=m.defaults.baseURL)==null?void 0:d.replace(/\/$/,"");let s=`flag=excel&company_id=${e}&start_date=${t}&end_date=${l}`;o&&(s+=`&employee_id=${o}`),n&&(s+=`&line_type=${n}`);const c=`${r}/attendance/date-range-summary?${s}`;console.log("ðŸ“ Opening Excel Download URL:",c),window.open(c,"_blank")},downloadDateRangePdf:(t,l,e,n,o=null,r="")=>{if(!e||!t||!l){a.value="Company, Start Date, and End Date are required";return}const s=new URLSearchParams({flag:"pdf",company_id:e,line_type:n,start_date:t,end_date:l});o&&s.append("employee_id",o),r&&s.append("category",r);const c=`/attendance/date-range-summary?${s.toString()}`;window.open(c,"_blank")},getDailyLateReport:async(t,l=null,e=null,n=null,o,r)=>{var s,c;u.value=!0;try{const d={company_id:t,department_id:l,line_type:e,employee_id:n,type:r,...r==="daily"?{date:o}:{month:o}},i=await m.get("/attendance/late-reports",{params:d});r==="daily"?v.value=i.data:r==="monthly"&&(f.value=i.data),a.value=null}catch(d){a.value=((c=(s=d.response)==null?void 0:s.data)==null?void 0:c.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},recalculateMonthlySnapshot:async(t,l,e,n,o)=>{var r,s;if(!t||!o){a.value="Company & month are required";return}u.value=!0;try{const c={month:o,company_id:t,department_id:l,line_type:e,employee_id:n},d=await m.post("/attendance/monthly-snapshot/recalculate",c);a.value=null}catch(c){a.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}},finalizeMonthlySnapshot:async(t,l,e,n,o="finalize")=>{var r,s;if(!t||!n){a.value="Company & month are required";return}u.value=!0;try{const c={company_id:t,line_type:l,employee_id:e,month:n,action:o},d=await m.post("/attendance/monthly-snapshot/finalize",c);a.value=null}catch(c){a.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(a.value)}finally{u.value=!1}}}});export{G as u};
