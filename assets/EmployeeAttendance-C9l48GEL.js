import{u as K,b as P,r as x,x as h,e as Q,M as Y,m as G,A as J,c as v,o as p,a as t,f as X,h as H,q as _,v as Z,i as I,j as r,t as d,k as a,W as ee}from"./index-D6IyOSuI.js";import{_ as te}from"./AttendanceTable-3wCH9ViG.js";import{_ as se}from"./EmployeeFilter-Bpn5aPL1.js";import{L as le}from"./LoaderView-CbihmVPO.js";import{S as oe}from"./SelectedEmployeeCard-CGsr6FiJ.js";import{u as ne}from"./attendance-CQv1Z_mq.js";import{u as ae}from"./user-CqPNJv3N.js";import"./datetime-DLUp6MRA.js";import"./company-B6Y6Xppm.js";import"./department-D8otYRXI.js";import"./SelectDropdown-gBLt9qrB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-Qp-JYzPq.js";const ie={class:"px-4 space-y-4"},re={class:"w-full flex flex-wrap gap-4 items-center md:w-auto"},de={key:0,class:"grid md:grid-cols-2 gap-4 text-sm"},ue={class:"rounded-xl border border-zinc-200 bg-white shadow-sm p-3"},ce={class:"flex items-center justify-between mb-4"},me={class:"grid gap-2 sm:grid-cols-2"},pe={class:"flex items-center gap-3 rounded-lg bg-zinc-50 px-2 py-1"},ye={class:"text-sm text-zinc-600"},fe={class:"flex items-center gap-3 rounded-lg bg-green-50 px-2 py-1"},ge={class:"text-sm text-zinc-600"},xe={class:"flex items-center gap-3 rounded-lg bg-rose-50 px-2 py-1"},ve={class:"text-sm text-zinc-600"},_e={class:"flex items-center gap-3 rounded-lg bg-yellow-50 px-2 py-1"},be={class:"text-sm text-zinc-600"},ke={class:"flex items-center gap-3 rounded-lg bg-blue-50 px-2 py-1"},he={class:"text-sm text-zinc-600"},we={class:"flex items-center gap-3 rounded-lg bg-purple-50 px-2 py-1"},ze={class:"text-sm text-zinc-600"},Se={class:"flex items-center gap-3 rounded-lg bg-emerald-50 px-3 sm:col-span-2"},Ae={class:"text-sm text-zinc-600"},$e={key:1},Me={key:3,class:"space-y-4"},Oe={__name:"EmployeeAttendance",setup(Te){const w=K(),z=P(),o=ne(),S=ae(),y=s=>{if(!s)return"";if(typeof s=="string"){if(/^\d{4}-\d{2}$/.test(s))return s;const e=s.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(s),n=e.getFullYear(),c=String(e.getMonth()+1).padStart(2,"0");return`${n}-${c}`}catch{return""}},m=z.query,i=x(y(m.date)||y(o.selectedMonth)||y(new Date)),l=x({company_id:m.company_id||"",department_id:m.department_id||"all",type:m.type||"all",employee_id:m.employee_id||"",category:""}),u=x(null);let b=null;const f=(s={})=>{b&&clearTimeout(b),b=setTimeout(()=>{const e={...z.query,company_id:l.value.company_id||"",department_id:l.value.department_id||"all",type:l.value.type||"all",employee_id:l.value.employee_id||"",date:i.value||"",...s};Object.keys(e).forEach(n=>{(e[n]===""||e[n]===void 0||e[n]===null)&&delete e[n]}),w.replace({query:e}).catch(()=>{})},150)},A=async s=>{if(!s){u.value=null;return}try{await S.fetchUser(s),u.value=S.user||null}catch(e){console.error("fetchUser error:",e),u.value=null}},g=x(""),$=async()=>{const s=l.value.employee_id,e=i.value;if(!s||!e)return;const n=`${s}|${e}`;if(n!==g.value){g.value=n;try{await o.getMonthlyAttendanceByShift(s,e)}catch(c){console.error("fetchAttendance error:",c),g.value=""}}};h(()=>i.value,s=>{i.value=y(s),f({date:i.value})}),h(()=>({...l.value}),()=>{f()}),h(()=>l.value.employee_id,async(s,e)=>{s&&s!==e&&(await A(s),await $()),s||(u.value=null,g.value="")}),Q(async()=>{l.value.employee_id&&await A(l.value.employee_id),l.value.employee_id&&i.value&&await $(),await Y(),f()});const N=()=>w.go(-1),O=()=>{f()},R=G(()=>!!l.value.employee_id);return(s,e)=>{var c,M,T,q,D,B,U,C,L,V,W,j,E,F;const n=J("router-link");return p(),v("div",ie,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:N},e[2]||(e[2]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[3]||(e[3]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Attendance",-1)),e[4]||(e[4]=t("div",null,null,-1))]),t("div",re,[_(se,{modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=k=>l.value=k),"initial-value":s.$route.query,onFilterChange:O},null,8,["modelValue","initial-value"]),t("div",null,[H(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[1]||(e[1]=k=>i.value=k),class:"input-1","aria-label":"Select month"},null,512),[[Z,i.value]])])]),u.value?(p(),v("div",de,[_(oe,{user:u.value},null,8,["user"]),t("div",ue,[t("div",ce,[e[6]||(e[6]=t("h2",{class:"text-lg font-semibold text-zinc-800"},"Attendance Summary",-1)),_(n,{to:{name:"MonthWiseApplicationLog",query:{...s.$route.query}},class:"inline-flex items-center gap-2 rounded-md border border-indigo-200 bg-indigo-50 px-3 py-1.5 text-sm font-medium text-indigo-700 hover:bg-indigo-100 transition",target:"_blank",rel:"noopener noreferrer"},{default:I(()=>e[5]||(e[5]=[t("i",{class:"fas fa-history text-xs"},null,-1),r(" Application History ")])),_:1,__:[5]},8,["to"])]),t("div",me,[t("div",pe,[e[8]||(e[8]=t("i",{class:"fas fa-calendar-check text-indigo-500"},null,-1)),t("p",ye,[e[7]||(e[7]=t("strong",{class:"block text-zinc-800"},"Total Working Days",-1)),r(" "+d(((M=(c=a(o))==null?void 0:c.summary)==null?void 0:M.total_working_days)||0),1)])]),t("div",fe,[e[10]||(e[10]=t("i",{class:"fas fa-user-check text-green-600"},null,-1)),t("p",ge,[e[9]||(e[9]=t("strong",{class:"block text-zinc-800"},"Present Days",-1)),r(" "+d(((q=(T=a(o))==null?void 0:T.summary)==null?void 0:q.total_present_days)||0),1)])]),t("div",xe,[e[12]||(e[12]=t("i",{class:"fas fa-user-times text-rose-600"},null,-1)),t("p",ve,[e[11]||(e[11]=t("strong",{class:"block text-zinc-800"},"Absent Days",-1)),r(" "+d(((B=(D=a(o))==null?void 0:D.summary)==null?void 0:B.total_absent_days)||0),1)])]),t("div",_e,[e[14]||(e[14]=t("i",{class:"fas fa-clock text-yellow-600"},null,-1)),t("p",be,[e[13]||(e[13]=t("strong",{class:"block text-zinc-800"},"Late Days",-1)),r(" "+d(((C=(U=a(o))==null?void 0:U.summary)==null?void 0:C.actual_late_day)||0),1)])]),t("div",ke,[e[16]||(e[16]=t("i",{class:"fas fa-calendar-week text-blue-600"},null,-1)),t("p",he,[e[15]||(e[15]=t("strong",{class:"block text-zinc-800"},"Total Weekends",-1)),r(" "+d(((V=(L=a(o))==null?void 0:L.summary)==null?void 0:V.total_weekend_days)||0),1)])]),t("div",we,[e[18]||(e[18]=t("i",{class:"fas fa-hourglass-half text-purple-600"},null,-1)),t("p",ze,[e[17]||(e[17]=t("strong",{class:"block text-zinc-800"},"Total Working Hours",-1)),r(" "+d(((j=(W=a(o))==null?void 0:W.summary)==null?void 0:j.total_working_hours)||0),1)])]),t("div",Se,[e[20]||(e[20]=t("i",{class:"fas fa-business-time text-emerald-600"},null,-1)),t("p",Ae,[e[19]||(e[19]=t("strong",{class:"block text-zinc-800"},"Total Overtime Hours",-1)),r(" "+d(((F=(E=a(o))==null?void 0:E.summary)==null?void 0:F.total_overtime_hours)||0),1)])])])])])):(p(),v("div",$e,e[21]||(e[21]=[t("p",{class:"text-gray-400 text-center text-2xl italic"}," Select an employee, please. ",-1)]))),a(o).isLoading?(p(),X(le,{key:2})):H((p(),v("div",Me,[_(te,{logs:a(o).monthlyLogs},null,8,["logs"])],512)),[[ee,R.value]])])}}};export{Oe as default};
