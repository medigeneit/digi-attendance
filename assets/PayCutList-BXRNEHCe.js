import{_ as R}from"./EmployeeFilter-DUZEEsle.js";import{_ as E}from"./FlexibleDatePicker-DmmArVI2.js";import{L as I}from"./LoaderView-ClTZfY9Q.js";import{u as O,U as Q}from"./UpdateOrCreate-C5DKt8ZG.js";import{g as z,u as G,f as H,r as m,x as b,q as w,h as J,c as u,o as d,a as e,i as N,d as j,l as K,t as l,j as D,F as Y,e as W,s as X,m as k}from"./index-BvQkN2MQ.js";import"./company-DI96fVYT.js";import"./department-COD6jg5B.js";import"./EmployeeDropdownInput-D66NUYcd.js";import"./SelectDropdown-C8mvIR8a.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-4anII6Cq.js";import"./TimePickerAsFloatHour-BKD6LZsK.js";const Z={class:"px-4 space-y-5"},ee={class:"rounded-2xl border border-slate-200 bg-white px-5 py-4 shadow-sm flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},te={class:"flex flex-wrap items-center gap-3"},se={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},ae={class:"rounded-2xl border border-slate-100 bg-slate-50 px-4 py-3"},oe={class:"text-2xl font-semibold text-slate-900"},le={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},re={class:"text-xl font-semibold text-amber-700"},ne={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},ie={class:"text-xl font-semibold text-emerald-700"},de={class:"rounded-2xl border border-slate-100 bg-white px-4 py-3"},pe={class:"text-xl font-semibold text-rose-700"},ue={key:1,class:"rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden"},ce={class:"overflow-x-auto"},ye={class:"min-w-full text-sm"},me={class:"px-4 py-3"},_e={class:"px-4 py-3"},xe={class:"px-4 py-3"},fe={class:"px-4 py-3"},ve={class:"px-4 py-3"},he={class:"px-4 py-3"},ge={class:"px-4 py-3"},be={class:"px-4 py-3 text-right"},we={class:"flex items-center justify-end gap-2"},ke=["onClick"],Se={key:0,class:"px-4 py-10 text-center text-slate-500"},Ce={key:0},Pe={key:1},Ee={__name:"PayCutList",setup(Ne){const U=z(),q=G(),c=H(),p=O(),y=m(c.query.month||new Date().toISOString().slice(0,7)),L=s=>s.toString().padStart(2,"0"),r=m({year:Number(y.value.split("-")[0]||new Date().getFullYear()),month:Number(y.value.split("-")[1]||new Date().getMonth()+1),day:1}),i=b(()=>!r.value.year||!r.value.month?"":`${r.value.year}-${L(r.value.month)}`),a=m({company_id:c.query.company_id||"",department_id:c.query.department_id||"",line_type:c.query.line_type||"all",employee_id:c.query.employee_id||""}),f=m(!1);b(()=>p.paycuts.length);const _=b(()=>{const s={total:0,pending:0,approved:0,rejected:0},t=p.paycuts||[];return s.total=t.length,t.forEach(o=>{const n=(o.status||"").toLowerCase();n==="pending"?s.pending++:n==="approved"?s.approved++:n==="rejected"&&s.rejected++}),s}),A=s=>{const t=(s||"").toLowerCase();return t==="approved"?"text-emerald-700 bg-emerald-50 border border-emerald-100":t==="rejected"?"text-rose-700 bg-rose-50 border border-rose-100":t==="pending"?"text-amber-700 bg-amber-50 border border-amber-100":"text-slate-700 bg-slate-100 border border-slate-200"};async function v(){if(!i.value||!a.value.company_id){p.paycuts=[];return}const s={month:i.value,company_id:String(a.value.company_id)};a.value.employee_id&&(s.user_id=String(a.value.employee_id)),f.value=!0;try{await p.fetchPaycuts(s)}finally{f.value=!1}}function F(){const s={};return i.value&&(s.month=String(i.value)),a.value.company_id&&(s.company_id=String(a.value.company_id)),a.value.department_id&&(s.department_id=String(a.value.department_id)),a.value.employee_id&&(s.employee_id=String(a.value.employee_id)),a.value.line_type&&a.value.line_type!=="all"&&(s.line_type=String(a.value.line_type)),s}let h=null;function T(){h&&clearTimeout(h),h=setTimeout(()=>{const s=F();q.replace({query:s}).catch(()=>{})},120)}let g=null;const S=m("");async function V(){T();const s=JSON.stringify({m:i.value||"",c:a.value.company_id||"",d:a.value.department_id||"",t:a.value.line_type||"all",e:a.value.employee_id||""});s!==S.value&&(await v(),S.value=s)}function x(){g&&clearTimeout(g),g=setTimeout(V,200)}w(()=>({...a.value,month:i.value}),()=>x(),{deep:!0}),w(i,()=>{i.value&&(y.value=i.value,x())}),w(()=>c.query,s=>{const t=s.month||"";t!==y.value&&(y.value=t,r.value.year=Number(t.split("-")[0]||r.value.year),r.value.month=Number(t.split("-")[1]||r.value.month));const o={company_id:s.company_id||"",department_id:s.department_id||"",line_type:s.line_type||"all",employee_id:s.employee_id||""},n=a.value;(o.company_id!==n.company_id||o.department_id!==n.department_id||o.line_type!==n.line_type||o.employee_id!==n.employee_id)&&(a.value=o)}),J(async()=>{x()});function M(){x()}async function $(s){confirm("Are you sure you want to delete this paycut?")&&(await p.deletePaycut(s),await v())}const B=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return(s,t)=>(d(),u("div",Z,[e("div",ee,[t[5]||(t[5]=e("div",null,[e("p",{class:"text-xs uppercase tracking-widest text-slate-500"},"Monthly Paycut"),e("h1",{class:"text-2xl font-semibold text-slate-900"},"Paycut log"),e("p",{class:"text-sm text-slate-500"},"Use filters to narrow down the report.")],-1)),e("div",te,[j(R,{company_id:a.value.company_id,"onUpdate:company_id":t[1]||(t[1]=o=>a.value.company_id=o),department_id:a.value.department_id,"onUpdate:department_id":t[2]||(t[2]=o=>a.value.department_id=o),employee_id:a.value.employee_id,"onUpdate:employee_id":t[3]||(t[3]=o=>a.value.employee_id=o),line_type:a.value.line_type,"onUpdate:line_type":t[4]||(t[4]=o=>a.value.line_type=o),"with-type":!0,"initial-value":s.$route.query,onFilterChange:M,class:"min-w-[220px]"},{default:K(()=>[j(E,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=o=>r.value=o),"show-year":!1,"show-month":!0,"show-date":!1},null,8,["modelValue"])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])])]),e("div",se,[e("div",ae,[t[6]||(t[6]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Total",-1)),e("p",oe,l(_.value.total),1)]),e("div",le,[t[7]||(t[7]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Pending",-1)),e("p",re,l(_.value.pending),1)]),e("div",ne,[t[8]||(t[8]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Approved",-1)),e("p",ie,l(_.value.approved),1)]),e("div",de,[t[9]||(t[9]=e("p",{class:"text-[11px] uppercase tracking-wider text-slate-500"},"Rejected",-1)),e("p",pe,l(_.value.rejected),1)])]),f.value?(d(),N(I,{key:0})):(d(),u("div",ue,[e("div",ce,[e("table",ye,[t[11]||(t[11]=e("thead",{class:"bg-slate-50 text-xs uppercase tracking-wider text-slate-500"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left"},"#"),e("th",{class:"px-4 py-3 text-left"},"Employee"),e("th",{class:"px-4 py-3 text-left"},"Created"),e("th",{class:"px-4 py-3 text-left"},"Paycut Hours"),e("th",{class:"px-4 py-3 text-left"},"Reason"),e("th",{class:"px-4 py-3 text-left"},"Note"),e("th",{class:"px-4 py-3 text-left"},"Status"),e("th",{class:"px-4 py-3 text-right"},"Actions")])],-1)),e("tbody",null,[(d(!0),u(Y,null,W(k(p).paycuts,(o,n)=>{var C,P;return d(),u("tr",{key:o.id,class:"border-t hover:bg-slate-50 transition-colors"},[e("td",me,l(n+1),1),e("td",_e,l(((C=o.user)==null?void 0:C.name)||"N/A"),1),e("td",xe,l(B(o.created_at)),1),e("td",fe,l(o.paycut_hours),1),e("td",ve,l(o.reason||"—"),1),e("td",he,l(o.note||"—"),1),e("td",ge,[e("span",{class:X(["inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold tracking-wide border",A(o.status)])},l(o.status||"Pending"),3)]),e("td",be,[e("div",we,[((P=k(U).user)==null?void 0:P.id)===8?(d(),N(Q,{key:0,userId:o.user_id,month:y.value,onUpdated:v},null,8,["userId","month"])):D("",!0),e("button",{type:"button",class:"text-red-500",onClick:je=>$(o.id)},t[10]||(t[10]=[e("i",{class:"fa fa-trash"},null,-1)]),8,ke)])])])}),128))])])]),k(p).paycuts.length?D("",!0):(d(),u("div",Se,[a.value.company_id?(d(),u("p",Pe,"No paycuts found for the selected filters.")):(d(),u("p",Ce,"Please select a company to load paycut data."))]))]))]))}};export{Ee as default};
