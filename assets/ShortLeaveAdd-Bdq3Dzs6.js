import{b as A,u as B,d as I,r as m,p as b,e as R,C as $,c as n,o as r,a as t,y as w,i as H,j as N,w as O,g as k,h as i,v as u,A as j,k as F,t as P}from"./index-Dxu3OBBt.js";import{L as W}from"./LoaderView-BAi-j2VG.js";import{_ as z}from"./MultiselectDropdown-Dv5HMbU1.js";import{u as G}from"./short-leave-Cq7Tbuky.js";import{u as J}from"./user-6I1Cqdy3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DdTDWeiC.js";const K={class:"max-w-3xl mx-auto p-4 space-y-4"},Q={class:"flex items-center justify-between gap-2"},X={key:0,class:"text-center"},Y={class:"col-span-2 grid grid-cols-2 gap-4"},Z={key:0},ee={key:1},te={key:2,class:"text-red-500 text-sm"},de={__name:"ShortLeaveAdd",setup(se){const D=A(),x=B(),L=G(),S=J(),p=I(),v=m(null);new Date().toISOString().split("T")[0];const{type:f,start_time:_,end_time:T}=D.query,y=new Date().toISOString().split("T")[0],s=m({date:y,date:"",start_time:"",end_time:"",reason:"",works_in_hand:"",handover_user_id:"",type:""});s.value.handover_user_id=b(()=>{var a;return(a=v.value)==null?void 0:a.id});const c=m(!1),d=m(null),M=b(()=>{if(s.value.start_time&&s.value.end_time){const a=new Date(`1970-01-01T${s.value.start_time}:00`),o=new Date(`1970-01-01T${s.value.end_time}:00`)-a;return Math.round(o/(1e3*60))}return 0}),g=b(()=>M.value>30),q=async()=>{var a;c.value=!0,d.value=null;try{const e={user_id:(a=p==null?void 0:p.user)==null?void 0:a.id,...s.value},o=await L.createShortLeave(e);x.push({name:"ShortLeaveShow",params:{id:o.id}})}catch(e){d.value=e.message||"Failed to submit short leave application"}finally{c.value=!1}},C=a=>a?a.split(" ")[0]:y,V=a=>{if(!a)return null;const e=a.match(/(\d+):(\d+)\s*(AM|PM)/i);if(!e)return null;let[o,l,h,U]=e;return l=parseInt(l,10),U.toUpperCase()==="PM"&&l<12&&(l+=12),U.toUpperCase()==="AM"&&l===12&&(l=0),`${l.toString().padStart(2,"0")}:${h}`};R(()=>{S.fetchTypeWiseEmployees({except:"auth"}),s.value.date=C(f==="Delay"?_:f==="Early"?T:y),s.value.type=f||"",s.value.start_time=V(_)||"",s.value.end_time=V(T)||""});const E=()=>{x.go(-1)};return(a,e)=>{const o=$("RouterLink");return r(),n("div",K,[t("div",Q,[t("button",{class:"btn-3",onClick:E},e[7]||(e[7]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[9]||(e[9]=t("h1",{class:"title-lg flex-wrap text-center"},"Short Leave Application Form",-1)),t("div",null,[w(o,{to:"/applications",class:"btn-2"},{default:H(()=>e[8]||(e[8]=[N("Home")])),_:1,__:[8]})])]),c.value?(r(),n("div",X,[w(W)])):(r(),n("form",{key:1,onSubmit:O(q,["prevent"]),class:"space-y-4 card-bg md:p-8 p-4"},[t("div",null,[e[10]||(e[10]=t("label",{for:"date",class:"block text-sm font-medium"},"Date",-1)),i(t("input",{type:"date",id:"date","onUpdate:modelValue":e[0]||(e[0]=l=>s.value.date=l),class:"input-1 w-full",required:""},null,512),[[u,s.value.date]])]),t("div",null,[e[12]||(e[12]=t("label",{for:"type",class:"block text-sm font-medium"},"Type",-1)),i(t("select",{id:"type","onUpdate:modelValue":e[1]||(e[1]=l=>s.value.type=l),class:"input-1 w-full",required:""},e[11]||(e[11]=[t("option",{value:""},"Select Type",-1),t("option",{value:"Delay"},"Delay",-1),t("option",{value:"OfficeTime"},"Office Time",-1),t("option",{value:"Early"},"Early",-1)]),512),[[j,s.value.type]])]),t("div",Y,[t("div",null,[e[13]||(e[13]=t("label",{for:"start-time",class:"block text-sm font-medium"},"From",-1)),i(t("input",{type:"time",id:"start-time","onUpdate:modelValue":e[2]||(e[2]=l=>s.value.start_time=l),class:"input-1 w-full",required:""},null,512),[[u,s.value.start_time]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"end-time",class:"block text-sm font-medium"},"To",-1)),i(t("input",{type:"time",id:"end-time","onUpdate:modelValue":e[3]||(e[3]=l=>s.value.end_time=l),class:"input-1 w-full",required:""},null,512),[[u,s.value.end_time]])])]),t("div",null,[e[15]||(e[15]=t("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),i(t("textarea",{id:"reason","onUpdate:modelValue":e[4]||(e[4]=l=>s.value.reason=l),class:"input-1 w-full",placeholder:"Enter your reason for leave",required:""},null,512),[[u,s.value.reason]])]),g.value?(r(),n("div",Z,[e[16]||(e[16]=t("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),i(t("textarea",{id:"works-in-hand","onUpdate:modelValue":e[5]||(e[5]=l=>s.value.works_in_hand=l),class:"input-1 w-full",placeholder:"Enter details of works in hand"},null,512),[[u,s.value.works_in_hand]])])):k("",!0),g.value?(r(),n("div",ee,[e[17]||(e[17]=t("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),w(z,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value=l),options:F(S).users,multiple:!1,required:!1,label:"label",placeholder:"Select user"},null,8,["modelValue","options"])])):k("",!0),d.value?(r(),n("div",te,P(d.value),1)):k("",!0),e[18]||(e[18]=t("div",{class:"flex justify-center"},[t("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{de as default};
