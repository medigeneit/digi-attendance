import{E,d as O,s as T,m as G,u as R,r,e as I,A as $,n as q,c as g,o as f,a as o,f as U,g as z,p as V,w as H,k as M,h as n,v as d,C as J,F as S,x as K,t as Q,i as W,j as X}from"./index-CUf-WQ1R.js";import{L as Y}from"./LoaderView-g8LQejqt.js";import{_ as Z}from"./PhotoModal-B3HFddOj.js";import{_ as ee}from"./ChangePasswordModal-By8a6m7n.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"my-container space-y-2"},le={class:"card-bg md:p-8 p-4 mx-4"},te={class:"grid gap-4"},se={class:"border p-4 rounded-md bg-gray-100"},ae={class:"flex justify-center w-full"},re=["src"],ne={class:"grid md:grid-cols-2 gap-4"},de={class:"space-y-2"},ue=["value"],ie={class:"flex justify-center gap-4"},ye={__name:"ProfileEdit",setup(pe){const l=E({name:"",phone:"",email:"",nid:"",date_of_birth:"",address:"",blood:""}),B=["A+","A-","B+","B-","AB+","AB-","O+","O-"],u=O(),{user:a}=T(u),m=G(),F=R(),A=r(!1),v=r(!1),c=r(!1),x=r(null),i=r(null),y=r(!1),w=r(!1);I(()=>{a.value&&h()}),$(a,s=>{s&&h()});const j=()=>{x.value=a.value.photo,c.value=!0},P=()=>{c.value=!1,i.value=null},D=()=>{v.value=!1},L=s=>{i.value=s},h=()=>{var s,e,b,p,t,k,C;l.name=((s=a.value)==null?void 0:s.name)||"",l.phone=((e=a.value)==null?void 0:e.phone)||"",l.email=((b=a.value)==null?void 0:b.email)||"",l.address=((p=a.value)==null?void 0:p.address)||"",l.nid=((t=a.value)==null?void 0:t.nid)||"",l.blood=((k=a.value)==null?void 0:k.blood)||"",l.date_of_birth=((C=a.value)==null?void 0:C.date_of_birth)||""},N=async()=>{try{await u.updateProfile(l),m.success("Profile updated successfully!"),F.push({name:"MyProfile"})}catch(s){console.error("Failed to update profile:",s),m.error(u.error||"Failed to save profile!");return}},_=async()=>{if(console.log(i.value),!i.value)return;const s=new FormData;s.append("photo",i.value),s.append("user_id",a.value.id),console.log({formData:s});try{y.value=!0,await u.uploadProfilePhoto(s),w.value=!0,setTimeout(()=>{P(),y.value=!1,w.value=!1},1500),m.success("Image updated successfully!")}catch(e){console.error("Failed to upload photo:",e),m.error(u.error||"Failed to save profile!")}finally{y.value=!1}};return(s,e)=>{var p;const b=q("RouterLink");return f(),g(S,null,[o("div",oe,[o("div",le,[e[21]||(e[21]=o("h2",{class:"title-lg text-center"},"Edit Profile",-1)),A.value?(f(),U(Y,{key:0,class:"bg-gray-100 border shadow-none"})):(f(),g("form",{key:1,onSubmit:H(N,["prevent"]),class:"space-y-4"},[o("div",te,[o("div",se,[o("div",ae,[o("div",{onClick:j,class:"relative bg-gray-200 w-40 h-40 rounded-full overflow-hidden mx-auto flex items-center justify-center"},[o("img",{class:"object-cover w-full h-full",src:((p=M(a))==null?void 0:p.photo)||"/default-avatar.png",alt:"Profile Photo"},null,8,re),e[8]||(e[8]=o("div",{class:"absolute inset-0 flex items-end justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity"},[o("button",{type:"button",class:"btn-2 px-3 py-1 text-sm rounded-md mb-2"}," Change ")],-1))])]),e[17]||(e[17]=o("p",{class:"title-md"},"Personal Info",-1)),e[18]||(e[18]=o("hr",{class:"my-2"},null,-1)),o("div",ne,[o("div",null,[e[9]||(e[9]=o("label",null,"Name",-1)),n(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>l.name=t),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[d,l.name]])]),o("div",null,[e[10]||(e[10]=o("label",null,"Phone",-1)),n(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.phone=t),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[d,l.phone]])]),o("div",null,[e[11]||(e[11]=o("label",null,"Email",-1)),n(o("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.email=t),type:"email",class:"w-full p-2 border rounded"},null,512),[[d,l.email]])]),o("div",de,[e[13]||(e[13]=o("label",{for:"bloodGroup",class:"text-gray-700 flex items-center gap-2"}," Blood Group ",-1)),n(o("select",{id:"bloodGroup","onUpdate:modelValue":e[3]||(e[3]=t=>l.blood=t),class:"py-2 px-4 border rounded w-full"},[e[12]||(e[12]=o("option",{disabled:"",value:""},"Select blood group",-1)),(f(),g(S,null,K(B,t=>o("option",{key:t,value:t},Q(t),9,ue)),64))],512),[[J,l.blood]])]),o("div",null,[e[14]||(e[14]=o("label",null,"NID",-1)),n(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>l.nid=t),type:"text",class:"w-full p-2 border rounded"},null,512),[[d,l.nid]])]),o("div",null,[e[15]||(e[15]=o("label",null,"Date of Birth",-1)),n(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>l.date_of_birth=t),type:"date",class:"w-full p-2 border rounded"},null,512),[[d,l.date_of_birth]])]),o("div",null,[e[16]||(e[16]=o("label",null,"Address",-1)),n(o("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>l.address=t),rows:"2",class:"w-full p-2 border rounded"},null,512),[[d,l.address]])])])])]),o("div",ie,[V(b,{to:{name:"MyProfile"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:W(()=>e[19]||(e[19]=[X(" Cancel ")])),_:1,__:[19]}),e[20]||(e[20]=o("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1)),o("button",{type:"button",onClick:e[7]||(e[7]=t=>v.value=!v.value),class:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"}," Change Password ")])],32))])]),v.value?(f(),U(ee,{key:0,onClose:D,user:M(a)},null,8,["user"])):z("",!0),V(Z,{imageSrc:x.value,isOpen:c.value,onClose:P,onFileSelected:L,onUploadPhoto:_},null,8,["imageSrc","isOpen"])],64)}}};export{ye as default};
