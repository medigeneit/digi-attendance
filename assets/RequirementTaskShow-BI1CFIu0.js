import{d as gt,z as J,m as R,c as i,o,a as e,g as f,j as P,F as A,y as W,x as z,t as h,w as q,b as $t,u as St,r as ct,e as Et,A as pt,n as mt,f as E,p as k,i as M,k as l,I as Mt}from"./index-fLGF1t2u.js";import{L as ft}from"./LoaderView-okso0odE.js";import{O as I}from"./OverlyModal-CpvVG5lb.js";import{_ as kt}from"./DepartmentChip-Bpfu9wJ1.js";import{_ as _t}from"./DescriptionView-Bq73pG5s.js";import{_ as yt,a as At}from"./TaskAssignedUsers-C1gCHxVq.js";import{_ as Rt,a as Nt,b as jt}from"./TaskStatusManager-2Sjpv527.js";import{_ as Pt}from"./TodoItemCard-CKA7WAAQ.js";import{b as V,d as Ut}from"./datetime-Efw590t9.js";import{s as vt}from"./dom-BKn8Ftnz.js";import{u as Lt}from"./useTaskStore-CciR0UEx.js";import{u as Ot}from"./useTodoDateStore-CMd9xm_L.js";import{_ as Bt}from"./TodoCreateEditShow-CsLzJzKk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-DFs-JNse.js";import"./task-BLD4xcZ0.js";import"./url-CePbr-gY.js";import"./requirement-CSILgD9M.js";import"./useTodoStore-DuZy-zos.js";import"./TaskSelectionInput-F2D2tJP3.js";import"./TaskTitle-DqV9DF5e.js";const Gt={class:"border-gray-300"},Vt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},zt={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},qt={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},Ft={key:0,class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-2 justify-between"},Ht={key:0},Wt=["disabled"],Kt=["disabled"],It={class:"text-base font-semibold text-gray-700"},Jt={__name:"TaskTimeline",props:{task:{type:Object}},emits:["updateStatus","error"],setup(Q,{emit:s}){const d=Q,F=gt(),m=J({user:null,type:""});function N(_){m.user=F.user,m.type=_}const v={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},w=R(()=>(v==null?void 0:v[g.value])||0),K=R(()=>{var _;return{"bg-yellow-50":g.value==="IN_PROGRESS","bg-green-50":g.value==="COMPLETED","bg-red-50":g.value==="PENDING","bg-blue-50":(_=d.task)==null?void 0:_.closed_at}}),g=R(()=>{var _;return(_=d.task)==null?void 0:_.status}),b=R(()=>{var _,x,D,c,$,r,T,H;return[{date:V((_=d.task)==null?void 0:_.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((x=d.task)!=null&&x.assigned_at)},{date:V((D=d.task)==null?void 0:D.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((c=d.task)!=null&&c.started_at)||w.value>=v.IN_PROGRESS},{date:V(($=d.task)==null?void 0:$.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((r=d.task)!=null&&r.completed_at)||w.value>=v.COMPLETED},{date:V((T=d.task)==null?void 0:T.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((H=d.task)!=null&&H.deadline)}].sort((j,S)=>j.date===null||S.date===null||new Date(j.date)==new Date(S.date)?j.serial-S.serial:new Date(j.date)-new Date(S.date))});return(_,x)=>{var D;return o(),i("div",{class:z(["border py-8 px-4 rounded",K.value])},[e("div",Gt,[(D=d.task)!=null&&D.is_target?(o(),i("div",Vt,x[2]||(x[2]=[e("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),P(" TARGET TASK ")]))):f("",!0),e("ol",zt,[(o(!0),i(A,null,W(b.value,(c,$)=>{var r,T;return o(),i("li",{class:"ml-5",key:$},[e("div",qt,[c.active?(o(),i("i",{key:0,class:z([c.icon,"text-xs"])},null,2)):f("",!0)]),e("div",{class:z({"opacity-30":!c.active})},[c.active?(o(),i("div",Ft,[c.date?(o(),i("span",Ht,h(c.date),1)):f("",!0),((r=d.task)==null?void 0:r.children_task_count)===0&&c.status==="started"&&c.active?(o(),i("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:x[0]||(x[0]=q(()=>N("start-date"),["prevent"])),disabled:!!d.task.closed_at},h(c.date?"Edit":"Set Date"),9,Wt)):f("",!0),((T=d.task)==null?void 0:T.children_task_count)===0&&c.active&&c.status==="completed"?(o(),i("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:x[1]||(x[1]=q(()=>N("finish-date"),["prevent"])),disabled:!!d.task.closed_at},h(c.date?"Edit":"Set Date"),9,Kt)):f("",!0)])):f("",!0),e("h3",It,h(c.title),1)],2)])}),128))])])],2)}}},Qt={class:"container mx-auto px-4"},Xt={key:3,class:"w-full xl:max-w-8xl min-h-64 mx-auto relative"},Yt={key:0,class:"text-sm mb-4 border-b","aria-label":"Breadcrumb"},Zt={class:"flex items-center gap-2"},te={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},ee=["title"],se=["to"],ae={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},oe={class:"grid grid-cols-12 gap-x-4 gap-y-3"},ne={class:"col-span-full md:col-span-7 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},le={class:"font-medium text-md flex items-start gap-2"},ie={class:"mt-2 col-span-full flex items-center"},re={class:"text-gray-400 text-xs"},de={class:"flex items-center gap-0.5"},ue={class:"text-sky-400 text-sm font-semibold"},ce=["innerHTML"],pe={class:"flex justify-between items-end mt-6 mb-2"},me={key:0,class:"border flex items-center justify-center h-96 rounded bg-gray-50 text-sm italic"},fe={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},ke={class:"font-semibold flex items-center gap-2"},_e={class:"text-white text-base"},ye={class:"col-span-full md:col-span-5 xl:col-span-4 2xl:col-span-3 space-y-4 sticky top-[74px] bg-white shadow rounded-lg p-4 pb-0"},ve={class:"border col-span-3 p-3 rounded-md"},ge={class:"flex items-center gap-2 mb-4"},xe={class:"flex items-center gap-2 mb-4"},he={key:0,class:"flex items-center gap-4 flex-wrap justify-between col-span-3 sticky bottom-0 bg-white"},be=["disabled"],we={class:"flex items-start justify-center !text-lg mb-4"},Ce={key:2,class:"py-4"},Te={key:3,class:"h-1"},De={key:2},$e={key:1,class:"text-center py-4 text-red-500"},Je={__name:"RequirementTaskShow",setup(Q){const s=Lt(),d=gt(),F=Ot(),m=$t(),N=St(),v=ct(""),w=J({open:!1,task:null});function K(){w.open=!0,w.task=s.task}Et(async()=>{v.value="loading",await b(m.params.id),v.value="",m.hash=="#sub-tasks"&&setTimeout(()=>vt(m.hash,66),0)});const g=J({user:null,type:""});async function b(a){await s.fetchTask(a,{with_todos:"true"})}async function _(){await b(m.params.id),g.user=null,g.type=""}const x=a=>{N.push({name:"TaskEdit",params:{id:a}})};function D(){w.open=!1,N.back()}const c=R(()=>{var a,t;return(t=(a=s==null?void 0:s.task)==null?void 0:a.users)==null?void 0:t.find(u=>{var y;return((y=d.user)==null?void 0:y.id)==u.id})}),$=R(()=>{var t,u,y,C,U,L,O,B;const a=[];return(u=(t=s.task)==null?void 0:t.requirement_detail)!=null&&u.id&&a.push({id:(C=(y=s.task)==null?void 0:y.requirement_detail)==null?void 0:C.id,title:(L=(U=s.task)==null?void 0:U.requirement_detail)==null?void 0:L.title,is_current_page:!1}),a.push({id:(O=s.task)==null?void 0:O.id,title:(B=s.task)==null?void 0:B.title,is_current_page:!0}),a});pt(()=>m.params.id,async a=>{v.value="changing",await b(a),v.value=""}),pt(()=>m.hash,async function(){setTimeout(()=>vt(m.hash,66),0)});const r=ct({action:null}),T=R(()=>{const t=((s==null?void 0:s.task_todo_dates)||[]).reduce((u,y)=>{const C=y.date;return u[C]||(u[C]=[]),u[C].push(y),u},{});return Object.keys(t).sort((u,y)=>new Date(y)-new Date(u)).map(u=>({date:u,todo_dates:t[u]}))});function H(){r.value={...r.value,action:""},b(m.params.id)}function j(){r.value={...r.value,action:""},b(m.params.id)}function S(a){console.log({todo:a}),r.value={...r.value,action:"edit",todo:a}}function xt(a,t){console.log({yearMonthDay:t,todoId:a}),r.value={...r.value,action:"addDate",date:t,todo_id:a,formReadonlyValues:{date:!0}}}function ht(){r.value={action:null,todo:null}}function bt(a){console.log({todo:a}),r.value={...r.value,action:"show",todo:a}}function wt(){var a;r.value={...r.value,action:"add",todoTypeId:(a=m.params)==null?void 0:a.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}async function Ct(a,t){var u;confirm(`Are your sure?
want to change status to ${t} 
todo: '${a==null?void 0:a.title}'`)&&(await F.updateStatus(a.id,t),b((u=m.params)==null?void 0:u.id))}async function Tt(a){var t;confirm(`Are your sure want to delete todo
'${a==null?void 0:a.title}'`)&&(await F.deleteTodoDate(a.id),b((t=m.params)==null?void 0:t.id))}return(a,t)=>{var C,U,L,O,B,X,Y,Z,tt,et,st,at,ot,nt,lt,it,rt,dt,ut;const u=mt("RouterLink"),y=mt("router-view");return o(),i("div",Qt,[g.user?(o(),E(I,{key:0},{default:M(()=>[k(Rt,{task:l(s).task,user:g.user,type:g.type,onCloseClick:t[0]||(t[0]=n=>g.user=null),onUpdateDate:_},null,8,["task","user","type"])]),_:1})):f("",!0),w.open?(o(),E(I,{key:1},{default:M(()=>[k(Nt,{onCloseClick:t[1]||(t[1]=n=>w.open=!1),task:w.task,onDelete:D},null,8,["task"])]),_:1})):f("",!0),v.value==="loading"?(o(),E(ft,{key:2,class:"h-[80vh] items-center justify-center"})):(o(),i("div",Xt,[l(s).task?(o(),i(A,{key:0},[$.value.length>1?(o(),i("nav",Yt,[e("ol",Zt,[(o(!0),i(A,null,W($.value,(n,p)=>(o(),i(A,{key:n.id},[p>0?(o(),i("li",te,"/")):f("",!0),e("li",{title:n==null?void 0:n.title,class:"text-gray-600 line-clamp-1"},[n.is_current_page?(o(),i("span",ae,h(n==null?void 0:n.title),1)):(o(),i("div",{key:0,to:`${a.isMyTask?"/my-tasks":"/tasks"}/${n.id}`,class:z(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":p>0,"whitespace-nowrap":p===0}])},h(n==null?void 0:n.title),11,se))],8,ee)],64))),128))])])):f("",!0),e("div",oe,[e("div",ne,[e("div",null,[e("h2",le,[e("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:t[2]||(t[2]=n=>l(N).back())},t[7]||(t[7]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),k(_t,null,{default:M(()=>[P(h(l(s).task.title),1)]),_:1})]),e("div",ie,[e("div",re,[t[8]||(t[8]=e("i",{class:"fas fa-clock"},null,-1)),P(" "+h(l(Ut)(l(s).task.created_at)),1)]),(C=l(s).task)!=null&&C.created_by_user?(o(),i(A,{key:0},[t[9]||(t[9]=e("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),e("div",de,[k(Mt,{user:(U=l(s).task)==null?void 0:U.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),e("div",ue,h((O=(L=l(s).task)==null?void 0:L.created_by_user)==null?void 0:O.label),1)])],64)):f("",!0)])]),k(_t,null,{default:M(()=>{var n;return[e("p",{innerHTML:(n=l(s).task)==null?void 0:n.description,class:"text-justify"},null,8,ce)]}),_:1}),e("div",null,[e("div",pe,[t[11]||(t[11]=e("h3",{class:"font-semibold text-xl"},"Todos",-1)),c.value?(o(),i("button",{key:0,class:"btn btn-3 h-8",onClick:t[3]||(t[3]=q(()=>wt(),["prevent"]))},t[10]||(t[10]=[e("i",{class:"fas fa-plus"},null,-1),P(" Add Todo ")]))):f("",!0)]),e("div",null,[T.value.length===0?(o(),i("div",me," No Todos ")):f("",!0),(o(!0),i(A,null,W(T.value,n=>(o(),i("div",{key:n.date,class:"border rounded-md overflow-hidden mb-4"},[e("div",fe,[e("div",ke,[e("div",_e,h(l(V)(n.date)),1)])]),e("div",null,[(o(!0),i(A,null,W((n==null?void 0:n.todo_dates)||[],p=>(o(),E(Pt,{key:p.id,todoDate:p,onClickTodo:G=>bt(G),onClickEdit:()=>S(p==null?void 0:p.todo),onClickChangeStatus:(G,Dt)=>Ct(G,Dt),onClickDelete:G=>Tt(G),"hide-sorting-btn":"",class:"border-b border-sky-200"},null,8,["todoDate","onClickTodo","onClickEdit","onClickChangeStatus","onClickDelete"]))),128))])]))),128))])])]),e("div",ye,[e("div",ve,[e("div",null,[e("div",ge,[t[12]||(t[12]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),k(kt,{department:(X=(B=l(s))==null?void 0:B.task)==null?void 0:X.from_department,"short-name":!0},null,8,["department"])]),t[13]||(t[13]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisors",-1)),k(yt,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((Z=(Y=l(s))==null?void 0:Y.task)==null?void 0:Z.supervisors)||[],listType:"supervisors",maxItem:3},null,8,["users"])]),t[16]||(t[16]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",xe,[t[14]||(t[14]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),k(kt,{department:(et=(tt=l(s))==null?void 0:tt.task)==null?void 0:et.to_department,"short-name":!0},null,8,["department"])]),t[15]||(t[15]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Assigned Users",-1)),k(yt,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((at=(st=l(s))==null?void 0:st.task)==null?void 0:at.users)||[],isTargetTask:(nt=(ot=l(s))==null?void 0:ot.task)==null?void 0:nt.is_target,maxItem:5},null,8,["users","isTargetTask"])])]),l(d).isAdminMood?(o(),i("div",he,[k(u,{to:{name:"TaskUserAssign",params:{id:(lt=l(s).task)==null?void 0:lt.id}},class:z(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",l(s).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:t[4]||(t[4]=n=>n.stopPropagation())},{default:M(()=>t[17]||(t[17]=[e("i",{class:"fas fa-users-cog"},null,-1),P(" Employees ")])),_:1,__:[17]},8,["to","class"]),e("button",{onClick:t[5]||(t[5]=q(n=>{var p;return x((p=l(s).task)==null?void 0:p.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!l(s).task.closed_at},t[18]||(t[18]=[e("i",{class:"fas fa-edit"},null,-1),P(" Edit ")]),8,be)])):f("",!0),k(Jt,{task:(it=l(s))==null?void 0:it.task},null,8,["task"]),(rt=l(s))!=null&&rt.task?(o(),E(jt,{key:1,task:((dt=l(s))==null?void 0:dt.task)||{},class:"col-span-full",onUpdateStatus:t[6]||(t[6]=()=>{var n,p;return b((p=(n=l(s))==null?void 0:n.task)==null?void 0:p.id)}),"hide-timeline":""},{top:M(()=>{var n,p;return[e("div",we,[k(At,{status:(n=l(s).task)==null?void 0:n.status,progressPercent:(p=l(s).task)==null?void 0:p.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"])])]}),_:1},8,["task"])):f("",!0),((ut=l(s).task)==null?void 0:ut.status)==="PENDING"&&l(d).isAdminMood?(o(),i("div",Ce,[e("button",{class:"btn-2-red h-8",onClick:q(K,["prevent"])},"Delete")])):(o(),i("div",Te))])]),l(m).name==="TaskReportAdd"?(o(),E(I,{key:1,class:"*:bg-transparent"},{default:M(()=>[k(y)]),_:1})):(o(),i("section",De,[k(y)]))],64)):(o(),i("div",$e,h(l(s).error),1)),v.value==="changing"?(o(),E(ft,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):f("",!0)])),k(Bt,{userRole:"employee",todoModal:r.value,onCancelClick:ht,onTodoUpdate:H,onTodoDateUpdate:j,onClickEdit:S,onClickAddTodoDate:xt},null,8,["todoModal"])])}}};export{Je as default};
