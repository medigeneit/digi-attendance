import{s as G,b as Q,u as z,r as n,y as L,D as J,e as K,A as I,c as f,o as r,m as V,f as k,a as s,l as d,p as T,g as W,C as X,F as Y,x as Z,t as $,h as o,w as B}from"./index-D53UnUau.js";import{_ as ee}from"./CommentModal-B4EJy_wG.js";import{u as te,O as P,_ as se}from"./task-priority-B9038a0Y.js";import{_ as ae}from"./MultiselectDropdown-zEGO_-mO.js";import{_ as oe}from"./TaskAddForm-BssChA_E.js";import{_ as le}from"./TaskEditForm-C89AJZOf.js";import{_ as ne}from"./TaskTreeView-C1Y31tzT.js";import{u as re}from"./company-D9YXRgrg.js";import{u as ie}from"./useTaskStore-1BbCY0OO.js";import"./useCommentStore-B2BOX3ph.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-H-mKnGll.js";import"./useRequirementStore-B-t9hhKy.js";import"./SectionLoading-DvJFxYYn.js";const de={class:"container mx-auto p-6 relative"},ue={class:"mb-3"},me={class:"flex flex-wrap items-center gap-2 mt-3"},ce={class:"flex gap-4"},pe={class:"flex-shrink-0 w-full md:w-64 text-gray-600"},fe=["value"],ve={class:"ml-auto flex gap-6 items-center"},ye={key:0,class:"flex gap-2 items-center"},ke={key:2,class:"text-center py-4 text-red-500"},_e={class:"space-y-4"},ge=1,Pe={__name:"TaskList",setup(be){const i=ie(),_=re(),{companies:A,employees:h}=G(_),l=Q(),E=z(),g=n(!1),b=n(null),w=L(D("company-id")),x=L(D("user-id")),v=n(),q=n(!1),u=n(null),y=n(!1),m=J({parentId:0,requirementId:0}),C=n(null);K(async()=>{await _.fetchCompanies(),await c()});const S=t=>{y.value=!0,m.parentId=t};function D(t){return{set:e=>{E.push({query:{...l.query,[t]:e||void 0}})},get:()=>l.query[t]||""}}const F=t=>{b.value=t,g.value=!0},M=()=>{g.value=!1,b.value=null};I(()=>w.value,async t=>{t&&(await _.fetchEmployee(t),v.value=h.value.find(e=>e.id==x.value)||null)},{initial:!0,immediate:!0}),I(()=>({"user-id":l.query["user-id"],"company-id":l.query["company-id"]}),async()=>{c()});async function c(){q.value=!!l.query["user-id"],await i.fetchTasks({user_ids:l.query["user-id"]||void 0,company_id:l.query["company-id"]||void 0},{loadingBeforeFetch:!0})}async function U(){u.value=null,y.value=!1,m.parentId=0,await c()}async function R(){y.value=!1,m.parentId=0,await c()}I(v,t=>{x.value=t==null?void 0:t.id});const{handleItemsPriorityUpdate:H,saveTaskPriority:N,listHasRearranged:O}=te(()=>i.taskListTree,0);async function j(){N()&&await c()}return(t,e)=>(r(),f("div",de,[u.value?(r(),V(P,{key:0},{default:T(()=>[d(le,{taskId:u.value,class:"rounded-full",onClose:e[0]||(e[0]=a=>u.value=null),onUpdated:U},null,8,["taskId"])]),_:1})):k("",!0),y.value?(r(),V(P,{key:1},{default:T(()=>[d(oe,{parentTaskId:m.parentId,requirementId:m.requirementId,class:"rounded-full",onClose:R,onTaskCreated:U},null,8,["parentTaskId","requirementId"])]),_:1})):k("",!0),s("div",ue,[e[9]||(e[9]=s("div",{class:"flex justify-between items-center"},[s("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),s("div",me,[s("div",ce,[s("div",pe,[W(s("select",{id:"company-filter","onUpdate:modelValue":e[1]||(e[1]=a=>w.value=a),class:"input-1 h-full"},[e[7]||(e[7]=s("option",{value:""},"Select Company",-1)),(r(!0),f(Y,null,Z(o(A),a=>(r(),f("option",{key:a.id,value:a.id},$(a.name),9,fe))),128))],512),[[X,w.value]])]),d(ae,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),options:o(h),multiple:!1,label:"name","label-prefix":"id",placeholder:"Please select employee...",class:"w-full md:w-64 text-gray-600"},null,8,["modelValue","options"])]),s("div",ve,[o(O)?(r(),f("div",ye,[e[8]||(e[8]=s("span",{class:"text-red-500"},"Priority Changed",-1)),s("button",{class:"btn-3",onClick:B(j,["prevent"])},"Save"),s("button",{class:"btn-3",onClick:e[3]||(e[3]=B((...a)=>C.value.resetItems&&C.value.resetItems(...a),["prevent"]))},"Discard")])):k("",!0),s("button",{onClick:S,class:"btn-1"},"Add Task")])])]),o(i).error?(r(),f("div",ke,$(o(i).error),1)):k("",!0),s("div",_e,[d(se,{items:o(i).taskListTree,handle:"handle",onItemsUpdate:o(H),class:"space-y-4",ref_key:"draggableTaskList",ref:C},{item:T(({item:a})=>[d(ne,{task:a,class:"!border-0",onCommentButtonClick:e[4]||(e[4]=p=>F(p,t.task.id)),onEditClick:e[5]||(e[5]=p=>u.value=p),onAddClick:e[6]||(e[6]=p=>S(p)),showDraggableHandle:!q.value},null,8,["task","showDraggableHandle"])]),_:1},8,["items","onItemsUpdate"])]),d(ee,{show:g.value,"commentable-id":b.value,"commentable-type":"task","user-id":ge,"on-close":M,onSubmitted:o(i).fetchTasks},null,8,["show","commentable-id","onSubmitted"])]))}};export{Pe as default};
