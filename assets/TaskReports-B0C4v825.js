import{b as N,e as B,q as V,k as P,c as n,o as a,a as t,t as i,l as C,p as A,n as E,h as u,f as c,F as D,x as S,w as F,y as L}from"./index-CLk09n4U.js";import{_ as M}from"./UserChip-DBergSFe.js";import{g as O}from"./datetime-BISRKKpq.js";import{u as $}from"./useTaskReportStore-YtJ1gg2D.js";import{u as q}from"./useTaskStore-DTlrBRqb.js";const z={class:"mt-4"},I={class:"bg-white"},U={class:"flex mb-2 items-end"},j={class:"overflow-auto w-full"},G={key:0,class:"min-w-full bg-white shadow rounded-lg overflow-hidden"},H={class:"bg-gray-100"},J={key:0,class:"px-4 py-2 text-left md:w-[100px] lg:w-[220px] xl:w-[320px]"},K={key:0},Q=["onClick"],W={class:"px-4 py-2"},X={key:0,class:"px-4 py-2 font-medium border-r"},Y={key:0,style:{"font-family":"monospace"}},Z={class:"ml-1"},tt={class:"ml-1"},st={class:"font-medium py-2 px-4"},et={class:"border rounded-md bg-gray-50"},ot={class:"text-sm flex items-center px-3 py-3"},nt={class:"text-gray-600 text-sm ml-auto whitespace-nowrap"},at={key:1,class:"text-center border py-4 text-gray-500"},mt={__name:"TaskReports",setup(rt){const p=$(),d=q(),f=N().params.id;B(async()=>{await d.fetchTask(f),await p.fetchTaskReports({task_id:f})});function h(l,s=[]){const r=[];for(const o of l){const m=[...s,o.title];o.children_tasks.length===0?r.push(...o.reports.map(e=>({...e,task_id:o.id,task_title:o.title,task_parents:s,user:o.users.find(_=>_.id===e.user_id)}))):r.push(...h(o.children_tasks,m))}return r}function y(l,s){try{const r=new Date(l.report_date).getTime(),o=new Date(s.report_date).getTime();return o===r?s.id-l.id:o-r}catch{return-1}}const g=V(()=>d.task.children_task_count===0?[...p.task_reports].sort(y):[...h(d.tasks)].sort(y));return(l,s)=>{var o,m;const r=P("RouterLink");return a(),n("div",z,[s[6]||(s[6]=t("hr",{class:"mb-2"},null,-1)),s[7]||(s[7]=t("hr",{class:"mb-2"},null,-1)),t("div",I,[t("pre",null,i(l.usersTaskProgress),1),t("div",U,[s[2]||(s[2]=t("h3",{class:"text-sm uppercase mt-4"},"Task Reports",-1)),C(r,{to:{name:"TaskReportAdd",params:{id:(o=u(p).task)==null?void 0:o.id}},onClick:s[0]||(s[0]=e=>e.stopPropagation()),class:"btn-3 ml-auto inline-flex !my-1"},{default:A(()=>s[1]||(s[1]=[E("Add Report")])),_:1,__:[1]},8,["to"])]),t("div",j,[u(p).loading?(a(),n("div",at,"Loading...")):(a(),n("table",G,[t("thead",H,[t("tr",null,[s[3]||(s[3]=t("th",{class:"px-4 py-2 text-left"},"#",-1)),u(d).task.children_task_count>0?(a(),n("th",J," Task ")):c("",!0),s[4]||(s[4]=t("th",{class:"px-4 py-2 text-left lg:w-[540px]"},"User Report",-1))])]),t("tbody",null,[((m=g.value)==null?void 0:m.length)===0?(a(),n("tr",K,s[5]||(s[5]=[t("td",{class:"px-4 py-4 font-medium text-gray-500 text-center",colspan:"10"}," NO REPORTS ",-1)]))):c("",!0),(a(!0),n(D,null,S(g.value,(e,_)=>{var x,w,v,b,R;return a(),n("tr",{key:e.id,class:"border-t hover:bg-gray-50 cursor-pointer",onClick:F(T=>l.goToShow(e.id),["prevent"]),role:"button"},[t("td",W,i(_+1),1),u(d).task.children_task_count>0?(a(),n("td",X,[t("div",null,[(a(!0),n(D,null,S(e.task_parents.reverse(),(T,k)=>(a(),n("div",{key:k,class:L(["text-gray-400 text-sm line-clamp-1",{"-ml-1":k==0}])},[k>0?(a(),n("span",Y,"↳")):c("",!0),t("span",Z,i(T),1)],2))),128)),t("div",null,[((x=e.task_parents)==null?void 0:x.length)>0?(a(),n("span",{key:0,style:{"font-family":"monospace"},class:L({"ml-2":((w=e.task_parents)==null?void 0:w.length)==1,"ml-4":((v=e.task_parents)==null?void 0:v.length)==2,"ml-6":((b=e.task_parents)==null?void 0:b.length)==3,"ml-8":((R=e.task_parents)==null?void 0:R.length)==4})},"↳",2)):c("",!0),t("span",tt,i(e.task_title),1)])])])):c("",!0),t("td",st,[t("div",et,[C(M,{user:e.user,class:"inline-block w-full !rounded-sm"},null,8,["user"]),t("div",ot,[t("div",null,i(e.title),1),t("div",nt," on "+i(u(O)(e.report_date)),1)])])])],8,Q)}),128))])]))])])])}}};export{mt as default};
