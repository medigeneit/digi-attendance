import{G as J,r as C,e as K,H as st,A as Q,c as u,o as r,f as g,a as t,t as x,I as E,n as $,h as n,w as S,l as v,p as _,E as X,m as w,F as Y,x as at,J as rt,K as z,g as nt,v as ot,b as lt,u as it,q as D,k as H,y as G}from"./index-CqlLEQy9.js";import{L as W}from"./LoaderView-DslX_Yba.js";import{u as dt,_ as ut,O as L}from"./task-priority-B5JO-w0w.js";import{a as pt}from"./TaskAddForm-Dh2PMOie.js";import{_ as ct}from"./TaskEditForm-wOXJJqJP.js";import{_ as mt,a as kt,b as ft}from"./TaskTreeView-GKnbfgdv.js";import{g as U}from"./datetime-BISRKKpq.js";import{_ as Z}from"./UserChip-laYjUhxp.js";import{u as yt}from"./useTaskStore-D0yrziDX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-DYUqxXP8.js";import"./company-kfpOZ7ps.js";import"./useRequirementStore-6iIWtcy9.js";import"./SectionLoading-Ck6RGskW.js";const gt={key:0},vt={key:0},xt={key:1},bt=J({__name:"CountdownTimer",props:{targetDateTime:{}},setup(i){const e=i,s=C(l());let o;function l(){const m=new Date(e.targetDateTime).getTime()-new Date().getTime(),f=Math.floor(m/1e3%60),y=Math.floor(m/1e3/60%60),p=Math.floor(m/(1e3*60*60)%24),c=Math.floor(m/(1e3*60*60*24));return{total:m,days:c,hours:p,minutes:y,seconds:f}}function d(){s.value=l()}return K(()=>{o=setInterval(()=>{d(),s.value.total<=0&&clearInterval(o)},1e3)}),st(()=>clearInterval(o)),Q(()=>e.targetDateTime,()=>{d(),clearInterval(o)}),(m,f)=>s.value.total>0?(r(),u("div",gt,[s.value.days?(r(),u("span",vt,x(s.value.days)+"d ",1)):g("",!0),t("span",null,x(s.value.hours.toString().padStart(2,"0"))+"h :",1),t("span",null,x(s.value.minutes.toString().padStart(2,"0"))+"m :",1),t("span",null,x(s.value.seconds.toString().padStart(2,"0"))+"s",1)])):(r(),u("div",xt,[E(m.$slots,"expired",{},()=>[f[0]||(f[0]=$("Timeâ€™s up!"))])]))}}),_t={class:"mb-3"},ht={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Tt={key:1,class:"text-center py-4 text-gray-500"},$t={key:2,class:"text-center py-4 text-red-500"},wt={key:3,class:"space-y-4"},Ct={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(i,{emit:e}){const s=i,o=e,l=C(null),{handleItemsPriorityUpdate:d,saveTaskPriority:m,listHasRearranged:f}=dt(()=>s.tasks,s.parentId),y=async()=>{await m(),o("updatePriority")};return(p,c)=>(r(),u("div",null,[t("div",_t,[E(p.$slots,"task:header")]),n(f)?(r(),u("div",ht,[c[3]||(c[3]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:S(y,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:c[0]||(c[0]=S((...k)=>l.value.resetItems&&l.value.resetItems(...k),["prevent"]))},"Discard")])):g("",!0),i.loading?(r(),u("div",Tt,"Loading tasks...")):i.error?(r(),u("div",$t,x(i.error),1)):(r(),u("div",wt,[v(ut,{items:i.tasks,handle:"handle",onItemsUpdate:n(d),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:l},{item:_(({item:k,index:h})=>[v(mt,{index:h,task:k,showDraggableHandle:!0,"tree-level":i.treeLevel,class:"!border-0",onCommentButtonClick:I=>o("commentButtonClick",k.id),onEditClick:c[1]||(c[1]=I=>o("editClick",I)),onAddClick:c[2]||(c[2]=I=>o("addClick",I))},null,8,["index","task","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},It={class:"flex justify-between mt-5"},St={class:"flex flex-wrap items-center gap-2 mt-3"},Dt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(i,{emit:e}){const s=i,o=e,l=C(),d=X({show:!1,parentId:s.parentId,requirementId:null}),m=c=>{d.show=!0,d.parentId=c,console.log({addForm:d})};function f(){d.show=!1,d.parentId=s.parentId,o("created")}function y(){l.value=!1,o("updated")}function p(){d.show=!1,d.parentId=s.parentId}return(c,k)=>(r(),u("div",null,[l.value?(r(),w(L,{key:0},{default:_(()=>[v(ct,{taskId:l.value,onClose:k[0]||(k[0]=h=>l.value=null),onUpdated:y},null,8,["taskId"])]),_:1})):g("",!0),d.show?(r(),w(L,{key:1},{default:_(()=>[v(pt,{parentTaskId:d.parentId,requirementId:d.requirementId,onTaskCreated:f,onError:c.handleTaskError,onClose:p},null,8,["parentTaskId","requirementId","onError"])]),_:1})):g("",!0),v(Ct,{tasks:i.subTasks,parentId:i.parentId,treeLevel:i.treeLevel,onAddClick:k[2]||(k[2]=h=>m(h)),onEditClick:k[3]||(k[3]=h=>l.value=h),onUpdatePriority:k[4]||(k[4]=h=>o("updatePriority"))},{"task:header":_(()=>[t("div",It,[k[5]||(k[5]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),t("div",St,[t("button",{class:"btn-1 ml-auto",onClick:k[1]||(k[1]=S(()=>m(i.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId","treeLevel"])]))}},Ut={class:"min-w-full bg-white rounded overflow-hidden"},Pt={class:"py-0.5 text-bg font-semibold"},Lt={class:"px-2 py-1 border-y"},Et={class:"px-2 py-1 border-y"},At={class:"px-2 py-1 border-y text-center"},Mt={class:"px-2 py-1 border-y text-center"},Bt={class:"px-2 py-1 border-y text-center"},Nt=J({__name:"TaskProgressTable",props:{progressUsers:{},taskUsers:{},task:{},tasks:{}},setup(i){return(e,s)=>(r(),u("table",Ut,[t("caption",Pt,[E(e.$slots,"caption",{},()=>[s[0]||(s[0]=$("Progress"))])]),s[1]||(s[1]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Progress")])],-1)),t("tbody",null,[(r(!0),u(Y,null,at(e.progressUsers,(o,l)=>(r(),u("tr",{key:o.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Lt,x(l+1),1),t("td",Et,[v(Z,{user:o},null,8,["user"])]),t("td",At,x(n(U)(o.started_at)),1),t("td",Mt,x(n(U)(o.finished_at)),1),t("td",Bt,x(n(U)(o.finished_at)),1)]))),128))])]))}}),Rt=rt("task-user",()=>({updateUserStartDate:async(s,o,l)=>await z.patch(`/task-user/task/${s}/user/${o}/update-start-date/${l}`),updateUserFinishDate:async(s,o,l)=>await z.patch(`/task-user/task/${s}/user/${o}/update-finish-date/${l}`)})),jt={class:"border-b text-center"},Ft={key:0},qt={key:1},Vt={class:"mb-2 mt-6"},Ot={class:"flex justify-center"},zt={class:"py-6"},Ht={class:"mt-2"},Gt={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Wt={class:"flex justify-between items-center"},Jt={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(i,{emit:e}){const s=i,o=e,l=Rt(),d=C(""),m=C("");async function f(){var y,p;console.log({date:d.value});try{s.type=="start-date"?await l.updateUserStartDate(s.task.id,s.user.id,d.value||"0"):s.type=="finish-date"&&await l.updateUserFinishDate(s.task.id,s.user.id,d.value||"0"),o("updateDate")}catch(c){m.value=((p=(y=c.response)==null?void 0:y.data)==null?void 0:p.message)||`Failed to update ${s.type}`}}return(y,p)=>(r(),u("form",{class:"p-4",onSubmit:S(f,["prevent"])},[t("div",jt,[i.type=="start-date"?(r(),u("h2",Ft,"Edit Start Date")):i.type=="finish-date"?(r(),u("h2",qt,"Edit Finish Date")):g("",!0)]),t("div",Vt,[p[2]||(p[2]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,x(i.task.title),1)]),t("div",null,[p[3]||(p[3]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"User:",-1)),v(Z,{user:i.user},null,8,["user"])]),t("div",Ot,[t("div",zt,[p[4]||(p[4]=t("label",{class:"block text-xs font-semibold"},"Date",-1)),nt(t("input",{type:"date","onUpdate:modelValue":p[0]||(p[0]=c=>d.value=c),class:"border py-2 px-4 rounded-md",size:"8"},null,512),[[ot,d.value]])])]),t("div",Ht,[m.value?(r(),u("div",Gt,x(m.value),1)):g("",!0)]),t("div",Wt,[p[5]||(p[5]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1)),t("button",{class:"btn-3",onClick:p[1]||(p[1]=S(c=>o("closeClick"),["prevent"]))},"Close")])],32))}},Kt=i=>i==null?void 0:i.reduce((e,s)=>e+s.task_weight,0),Qt=(i,e)=>{const s=Kt(i);return i.map(o=>{const l=e.filter(d=>d.user_id===o.id).reduce((d,m)=>d+m.progress,0);return{...o,task_progress:Math.floor(l*(o.task_weight/s)),user_progress:l}})},Xt={class:"container mx-auto p-6"},Yt={key:2,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},Zt={class:"grid grid-cols-4"},te={class:"mb-4 flex col-span-full"},ee={class:"font-medium text-xl"},se={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},ae={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},re={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},ne={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},oe={class:"mt-4 col-span-full mb-6"},le={class:"ml-auto text-right text-sm col-span-full"},ie={key:1,class:"text-gray-500"},de={class:"font-semibold text-green-800"},ue={key:2,class:"ml-4 text-gray-500"},pe={class:"text-red-500 font-semibold"},ce={class:"py-2 flex justify-center items-center gap-2 col-span-full"},me={class:"ml-auto flex gap-4"},ke={key:0},fe={key:1},ye={key:1,class:"text-center py-4 text-red-500"},Pe={__name:"TaskShow",setup(i){const e=yt(),s=lt(),o=it(),l=C(""),d=D(()=>e.tasks),m=C({});K(async()=>{l.value="loading",await y(s.params.id),l.value=""});const f=X({user:null,type:""});async function y(T){await e.fetchTask(T)}const p=D(()=>Qt(e.task.users,e.task.task_reports||[])),c=D(()=>U(e.task.started_at)),k=D(()=>U(e.task.deadline));async function h(){await y(s.params.id),f.user=null,f.type=""}const I=T=>{o.push({name:"TaskEdit",params:{id:T}})},tt=D(()=>{var T,a;return e.task?((T=e.task)==null?void 0:T.parent_id)==0?{name:"TaskList"}:{name:"TaskShow",params:{id:(a=e.task)==null?void 0:a.parent_id}}:null});return Q(()=>s.params.id,async T=>{l.value="changing",await y(T),l.value=""}),(T,a)=>{var A,M,B,N,R,j,F,q,V;const P=H("RouterLink"),et=H("router-view");return r(),u("div",Xt,[f.user?(r(),w(L,{key:0},{default:_(()=>[v(Jt,{task:n(e).task,user:f.user,type:f.type,onCloseClick:a[0]||(a[0]=b=>f.user=null),onUpdateDate:h},null,8,["task","user","type"])]),_:1})):g("",!0),l.value==="loading"?(r(),w(W,{key:1})):(r(),u("div",Yt,[n(e).task?(r(),u(Y,{key:0},[t("section",Zt,[t("div",te,[t("div",null,[t("h2",ee,x(n(e).task.title),1),t("div",se,[(A=n(e).task)!=null&&A.is_important?(r(),u("span",ae,"IMPORTANT")):g("",!0),(M=n(e).task)!=null&&M.is_urgent?(r(),u("span",re,"URGENT")):g("",!0)])]),t("div",ne,[v(kt,{status:(B=n(e).task)==null?void 0:B.status,progressPercent:(N=n(e).task)==null?void 0:N.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),n(e).task?(r(),w(ft,{key:0,task:n(e).task,ref_key:"progress",ref:m,class:"!text-lg"},null,8,["task"])):g("",!0)])]),t("section",oe,[v(Nt,{"task-users":((R=n(e).task)==null?void 0:R.users)||[],task:n(e).task,"sub-tasks":n(e).tasks,"progress-users":p.value},{caption:_(()=>a[9]||(a[9]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])]),t("div",le,[n(e).task.deadline?(r(),w(bt,{key:0,targetDateTime:n(e).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):g("",!0),c.value?(r(),u("span",ie,[a[10]||(a[10]=$(" Started: ")),t("span",de,x(c.value),1)])):g("",!0),k.value?(r(),u("span",ue,[a[11]||(a[11]=$(" Deadline: ")),t("span",pe,x(k.value),1)])):g("",!0)]),a[16]||(a[16]=t("hr",{class:"my-3 col-span-full"},null,-1)),t("div",ce,[t("button",{onClick:a[1]||(a[1]=S(b=>{var O;return I((O=n(e).task)==null?void 0:O.id)},["stop"])),class:"btn-2 py-0.5"},"Edit"),v(P,{to:{name:"TaskUserAssign",params:{id:(j=n(e).task)==null?void 0:j.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:a[2]||(a[2]=b=>b.stopPropagation())},{default:_(()=>a[12]||(a[12]=[t("i",{class:"fas fa-user-plus"},null,-1),$(" Assign Users ")])),_:1,__:[12]},8,["to"]),v(P,{to:tt.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:a[3]||(a[3]=b=>b.stopPropagation())},{default:_(()=>a[13]||(a[13]=[t("i",{class:"fas fa-arrow-left"},null,-1),$(" Back ")])),_:1,__:[13]},8,["to"]),t("div",me,[d.value.length>0?(r(),w(P,{key:0,to:{name:"TaskShow",params:{id:(F=n(e).task)==null?void 0:F.id}},onClick:a[4]||(a[4]=b=>b.stopPropagation()),class:G(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":n(s).name=="TaskShow"}])},{default:_(()=>a[14]||(a[14]=[t("i",{class:"fal fa-list-ul"},null,-1),$(" Sub Tasks ")])),_:1,__:[14]},8,["to","class"])):g("",!0),v(P,{to:{name:"TaskReports",params:{id:(q=n(e).task)==null?void 0:q.id}},onClick:a[5]||(a[5]=b=>b.stopPropagation()),class:G(["py-1 btn-3",{"bg-blue-500 text-white":n(s).name=="TaskReports"}])},{default:_(()=>a[15]||(a[15]=[t("i",{class:"fal fa-file-alt"},null,-1),$(" Reports ")])),_:1,__:[15]},8,["to","class"])])])]),n(s).name=="TaskShow"&&((V=n(e).task)==null?void 0:V.level)<=2?(r(),u("section",ke,[v(Dt,{subTasks:d.value,"parent-id":n(s).params.id,"tree-level":n(e).task.level+1,onCreated:a[6]||(a[6]=b=>y(n(s).params.id)),onUpdated:a[7]||(a[7]=b=>y(n(s).params.id)),onUpdatePriority:a[8]||(a[8]=b=>y(n(s).params.id))},null,8,["subTasks","parent-id","tree-level"])])):(r(),u("section",fe,[v(et)]))],64)):(r(),u("div",ye,x(n(e).error),1)),l.value==="changing"?(r(),w(W,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):g("",!0)]))])}}};export{Pe as default};
