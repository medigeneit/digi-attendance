import{N as re,u as de,s as ue,z as K,r as S,x as p,e as pe,A as f,m as me,c as i,o as r,a as e,j as _,n as w,i as F,q as c,t as a,g as x,F as M,y as T,h as U,v as L,w as ce}from"./index-BLGSP-RU.js";import{_ as R}from"./MultiselectDropdown-CQI1me-y.js";import{_ as be}from"./TextEditor-DfR29KdR.js";import{u as ve}from"./company-BVHBhKC-.js";import{u as xe}from"./department-DhCcff8z.js";import{u as ge}from"./notice-BeLf_Tzg.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-D6kbcJl9.js";const ye={class:"mx-auto max-w-6xl px-3 md:px-6 py-4"},fe={class:"flex items-center justify-between mb-5"},he={class:"hidden md:flex gap-2"},_e=["disabled"],we={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},ke={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},Ce={class:"flex items-center justify-between"},De={class:"flex items-center gap-3"},je={class:"font-semibold"},Ve={key:0,class:"text-[11px] text-gray-500 hidden md:block"},Se={key:0},Ae={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},Ne={class:"flex items-center justify-between"},ze={class:"flex items-center gap-3"},Ee={class:"font-semibold"},Pe={key:0,class:"text-[11px] text-gray-500 hidden md:block"},$e={key:0},Be={class:"rounded-2xl border bg-white/80 backdrop-blur p-4 shadow-sm hover:shadow transition"},Fe={class:"flex items-center justify-between"},Me={class:"flex items-center gap-3"},Te={class:"font-semibold"},Ue={key:0,class:"text-[11px] text-gray-500 hidden md:block"},Le={key:0},Re={class:"rounded-2xl border bg-white/70 p-5 shadow-sm"},qe={class:"flex items-center justify-between"},Oe={class:"inline-flex rounded-xl border overflow-hidden"},Ge={class:"rounded-2xl border bg-white/70 p-5 shadow-sm space-y-6"},He={class:"grid md:grid-cols-3 gap-6"},Je={class:"md:col-span-3 flex justify-between gap-4"},Ie={class:"w-full"},Xe={key:0,class:"text-red-500 text-xs mt-1"},Ke={class:"w-full"},Qe={key:0,class:"text-red-500 text-xs mt-1"},We={class:"space-y-2 md:col-span-3"},Ye={class:"space-y-2"},Ze={class:"flex items-center justify-between"},et={class:"inline-flex rounded-lg border overflow-hidden"},tt={class:"space-y-2"},st={class:"flex items-center justify-between"},lt={class:"inline-flex rounded-lg border overflow-hidden"},ot={class:"space-y-2 md:col-span-3"},at={class:"flex items-center justify-between"},nt={class:"inline-flex items-center gap-3"},it={class:"text-xs text-gray-500"},rt={class:"inline-flex rounded-lg border overflow-hidden"},dt={class:"rounded-2xl border bg-white/70 p-5 shadow-sm space-y-6"},ut={key:0,class:"text-red-500 text-xs mt-1"},pt={class:"grid md:grid-cols-2 gap-4 items-start"},mt={class:"space-y-2"},ct={class:"flex items-center justify-between gap-3"},bt={class:"inline-flex items-center"},vt={key:0,class:"mt-3 flex items-center justify-between bg-white rounded-lg border p-2.5"},xt={class:"text-sm truncate"},gt={class:"font-medium"},yt={class:"sticky bottom-0 z-10 bg-white/90 backdrop-blur flex justify-end gap-2 p-3 rounded-2xl border shadow-sm md:hidden"},ft=["disabled"],ht={class:"hidden md:flex items-center justify-end gap-2"},_t=["disabled"],Nt={__name:"NoticeAdd",setup(wt){const j=re(),Q=de(),q=ge(),O=ve(),g=xe(),{companies:W}=ue(O),s=K({title:"",type:1,description:"",published_at:"",expired_at:"",all_companies:!1,all_departments:!1,all_employees:!1,file:null}),v=S([]),b=S([]),u=S([]),A=p(()=>W.value||[]),k=p(()=>g.departments||[]),V=p(()=>g.employees||[]),$=p(()=>v.value.map(l=>l.id)),G=p(()=>b.value.map(l=>l.id)),Y=p(()=>u.value.map(l=>l.id)),C=S(!1),m=K({}),N=p({get:()=>s.all_companies?"all":"custom",set:l=>{s.all_companies=l==="all",v.value=s.all_companies?[...A.value]:[]}}),z=p({get:()=>s.all_departments?"all":"custom",set:l=>{s.all_departments=l==="all",b.value=s.all_departments?[...k.value]:[]}}),E=p({get:()=>s.all_employees?"all":"custom",set:l=>{s.all_employees=l==="all",u.value=s.all_employees?[...V.value]:[]}});pe(async()=>{await O.fetchCompanies()}),f(()=>s.all_companies,async l=>{l?await g.fetchDepartments():await g.fetchDepartments($.value),g.employees=[],u.value=[]}),f($,async l=>{s.all_companies||(await g.fetchDepartments(l),g.employees=[],u.value=[])});const Z=p(()=>s.all_departments?(k.value||[]).map(l=>l.id):G.value);f(Z,async l=>{Array.isArray(l)&&l.length>0?await g.fetchDepartmentEmployee(l):(g.employees=[],u.value=[])},{immediate:!0}),f(k,l=>{s.all_departments&&(b.value=[...l])}),f(V,l=>{s.all_employees&&(u.value=[...l])}),f(v,l=>{s.all_companies=l.length===A.value.length&&l.length>0}),f(b,l=>{s.all_departments=l.length===k.value.length&&l.length>0}),f([u,V],([l,t])=>{const n=Array.isArray(t)?t.length:0;s.all_employees=n>0&&l.length===n});const P=S(!1),ee=l=>{var n,d;const t=(d=(n=l==null?void 0:l.target)==null?void 0:n.files)==null?void 0:d[0];H(t)},te=l=>{var n,d;l.preventDefault(),P.value=!1;const t=(d=(n=l.dataTransfer)==null?void 0:n.files)==null?void 0:d[0];H(t)},se=l=>{l.preventDefault(),P.value=!0},le=()=>{P.value=!1},H=l=>{if(!l){s.file=null;return}if(!["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(l.type)){j.error("Unsupported file type. Allowed: jpg, jpeg, png, pdf, doc, docx."),s.file=null;return}if(l.size>2*1024*1024){j.error("File size must be ≤ 2MB."),s.file=null;return}s.file=l},oe=()=>{s.file=null},y=(l,t="name",n=3)=>{const d=Array.isArray(l)?l:[],o=d.slice(0,n).map(B=>(B==null?void 0:B[t])??"—"),h=Math.max(0,d.length-n);return{head:o,more:h}},J=p(()=>{if(s.type===2||!s.published_at||!s.expired_at)return!0;try{return new Date(s.expired_at)>=new Date(s.published_at)}catch{return!0}}),ae=()=>{var l;return Object.keys(m).forEach(t=>delete m[t]),(l=s.title)!=null&&l.trim()||(m.title="Title is required"),s.type!==2&&!s.published_at&&(m.published_at="Publish date is required"),J.value||(m.expired_at="Expired date must be on/after publish date"),Object.keys(m).length===0},D=p(()=>{var l;return!C.value&&!!((l=s.title)!=null&&l.trim())&&(s.type===2||!!s.published_at)&&J.value}),I=async()=>{var t,n;if(!ae()){j.error("Please fix the errors and try again.");return}const l={title:s.title,type:s.type,description:s.description,published_at:s.type===2?null:s.published_at,expired_at:s.type===2?null:s.expired_at||null,all_companies:s.all_companies,all_departments:s.all_departments,all_employees:s.all_employees,company_ids:$.value,department_ids:G.value,employee_ids:Y.value,file:s.file};try{C.value=!0,await q.createNotice(l),j.success("Notice created successfully"),await q.fetchNotices(),Q.replace("/hrd/notice")}catch(d){const o=((n=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to save notice";j.error(o),console.error(d)}finally{C.value=!1}},ne=p(()=>A.value.length),ie=p(()=>k.value.length),X=p(()=>V.value.length);return(l,t)=>{var d;const n=me("RouterLink");return r(),i("div",ye,[e("div",fe,[t[16]||(t[16]=e("div",null,[e("h1",{class:"text-2xl md:text-3xl font-semibold tracking-tight"},"Add Notice"),e("p",{class:"text-sm text-gray-500"},[_("Fields marked "),e("span",{class:"text-red-500"},"*"),_(" are required.")])],-1)),e("div",he,[w(n,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:F(()=>t[15]||(t[15]=[_(" Cancel ")])),_:1,__:[15]}),e("button",{disabled:!D.value,onClick:I,class:c(["px-4 py-2 rounded-xl text-white text-sm",D.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(C.value?"Saving…":"Save"),11,_e)])]),e("div",we,[e("div",ke,[e("div",Ce,[e("div",De,[t[18]||(t[18]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-blue-100 to-blue-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-blue-600"},[e("path",{fill:"currentColor",d:"M3 10v10h18V10H3zm9-7l9 7H3l9-7z"})])],-1)),e("div",null,[t[17]||(t[17]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Companies",-1)),e("div",je,a(s.all_companies?"All":v.value.length)+" / "+a(ne.value),1)])]),!s.all_companies&&v.value.length?(r(),i("div",Ve,[(r(!0),i(M,null,T(y(v.value,"name",3).head,(o,h)=>(r(),i("span",{key:"c"+h,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),y(v.value,"name",3).more?(r(),i("span",Se,"+"+a(y(v.value,"name",3).more),1)):x("",!0)])):x("",!0)])]),e("div",Ae,[e("div",Ne,[e("div",ze,[t[20]||(t[20]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-purple-100 to-purple-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-purple-600"},[e("path",{fill:"currentColor",d:"M3 5h18v2H3V5zm3 4h12v10H6V9z"})])],-1)),e("div",null,[t[19]||(t[19]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Departments",-1)),e("div",Ee,a(s.all_departments?"All":b.value.length)+" / "+a(ie.value),1)])]),!s.all_departments&&b.value.length?(r(),i("div",Pe,[(r(!0),i(M,null,T(y(b.value,"name",3).head,(o,h)=>(r(),i("span",{key:"d"+h,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),y(b.value,"name",3).more?(r(),i("span",$e,"+"+a(y(b.value,"name",3).more),1)):x("",!0)])):x("",!0)])]),e("div",Be,[e("div",Fe,[e("div",Me,[t[22]||(t[22]=e("span",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-emerald-100 to-emerald-50"},[e("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-emerald-600"},[e("path",{fill:"currentColor",d:"M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"})])],-1)),e("div",null,[t[21]||(t[21]=e("div",{class:"text-[11px] uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",Te,a(s.all_employees?"All":u.value.length)+" / "+a(X.value),1)])]),!s.all_employees&&u.value.length?(r(),i("div",Ue,[(r(!0),i(M,null,T(y(u.value,"name",3).head,(o,h)=>(r(),i("span",{key:"e"+h,class:"px-2 py-0.5 rounded-full bg-gray-100 mr-1"},a(o),1))),128)),y(u.value,"name",3).more?(r(),i("span",Le,"+"+a(y(u.value,"name",3).more),1)):x("",!0)])):x("",!0)])])]),e("form",{onSubmit:ce(I,["prevent"]),class:"space-y-8"},[e("section",Re,[e("div",qe,[t[23]||(t[23]=e("h3",{class:"text-base font-semibold"},"Notice Type",-1)),e("div",Oe,[e("button",{type:"button",class:c(["px-4 py-2 text-sm",s.type===1?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[0]||(t[0]=o=>s.type=1)}," General ",2),e("button",{type:"button",class:c(["px-4 py-2 text-sm border-l",s.type===2?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[1]||(t[1]=o=>s.type=2)}," Policy ",2)])]),t[24]||(t[24]=e("p",{class:"text-xs text-gray-500 mt-2"}," Policies usually don’t require publish/expire dates and remain visible until replaced. ",-1))]),e("section",Ge,[t[30]||(t[30]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-base font-semibold"},"Audience & Scope"),e("span",{class:"text-xs text-gray-500"},"Define who should see this notice")],-1)),e("div",He,[e("div",Je,[e("div",Ie,[t[25]||(t[25]=e("label",{class:"font-medium"},[_("Publish Date "),e("span",{class:"text-red-500"},"*")],-1)),U(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.published_at=o),type:"date",class:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.published_at]]),m.published_at?(r(),i("p",Xe,a(m.published_at),1)):x("",!0)]),e("div",Ke,[t[26]||(t[26]=e("label",{class:"font-medium"},"Expire Date",-1)),U(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.expired_at=o),type:"date",class:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.expired_at]]),m.expired_at?(r(),i("p",Qe,a(m.expired_at),1)):x("",!0)])]),e("div",We,[e("div",Ye,[e("div",Ze,[t[27]||(t[27]=e("label",{class:"font-medium"},"Companies",-1)),e("div",et,[e("button",{type:"button",class:c(["px-3 py-1.5 text-xs",N.value==="all"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[4]||(t[4]=o=>N.value="all")},"All",2),e("button",{type:"button",class:c(["px-3 py-1.5 text-xs border-l",N.value==="custom"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[5]||(t[5]=o=>N.value="custom")},"Custom",2)])]),w(R,{modelValue:v.value,"onUpdate:modelValue":t[6]||(t[6]=o=>v.value=o),options:A.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select companies"},null,8,["modelValue","options"])]),e("div",tt,[e("div",st,[t[28]||(t[28]=e("label",{class:"font-medium"},"Departments",-1)),e("div",lt,[e("button",{type:"button",class:c(["px-3 py-1.5 text-xs",z.value==="all"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[7]||(t[7]=o=>z.value="all")},"All",2),e("button",{type:"button",class:c(["px-3 py-1.5 text-xs border-l",z.value==="custom"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[8]||(t[8]=o=>z.value="custom")},"Custom",2)])]),w(R,{modelValue:b.value,"onUpdate:modelValue":t[9]||(t[9]=o=>b.value=o),options:k.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select departments"},null,8,["modelValue","options"])])]),e("div",ot,[e("div",at,[t[29]||(t[29]=e("label",{class:"font-medium"},"Employees",-1)),e("div",nt,[e("span",it,"Selected "+a(u.value.length)+" / "+a(X.value),1),e("div",rt,[e("button",{type:"button",class:c(["px-3 py-1.5 text-xs",E.value==="all"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[10]||(t[10]=o=>E.value="all")},"All",2),e("button",{type:"button",class:c(["px-3 py-1.5 text-xs border-l",E.value==="custom"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:t[11]||(t[11]=o=>E.value="custom")},"Custom",2)])])]),w(R,{modelValue:u.value,"onUpdate:modelValue":t[12]||(t[12]=o=>u.value=o),options:V.value,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select employees"},null,8,["modelValue","options"])])])]),e("section",dt,[t[37]||(t[37]=e("div",{class:"flex items-center justify-between"},[e("h3",{class:"text-base font-semibold"},"Notice Content"),e("span",{class:"text-xs text-gray-500"},"Craft the headline & attach relevant docs")],-1)),e("div",null,[t[31]||(t[31]=e("label",{class:"block font-medium mb-1"},[_("Title "),e("span",{class:"text-red-500"},"*")],-1)),U(e("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>s.title=o),type:"text",class:"w-full p-2.5 border rounded focus:ring-2 focus:ring-blue-500"},null,512),[[L,s.title]]),m.title?(r(),i("p",ut,a(m.title),1)):x("",!0)]),e("div",pt,[e("div",mt,[t[35]||(t[35]=e("label",{class:"block font-medium"},"Attachment",-1)),e("div",{class:c(["rounded-xl border border-dashed p-5 transition relative",P.value?"bg-blue-50 border-blue-300":"hover:bg-gray-50"]),onDragover:se,onDragleave:le,onDrop:te},[e("div",ct,[t[33]||(t[33]=e("div",{class:"text-sm text-gray-600"},[e("div",{class:"font-medium"},"Drag & drop or click to upload"),e("div",null,"JPG, JPEG, PNG, PDF, DOC, DOCX (≤ 2MB)")],-1)),e("label",bt,[e("input",{type:"file",accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",onChange:ee,class:"hidden"},null,32),t[32]||(t[32]=e("span",{class:"px-4 py-2 rounded-lg border bg-white hover:bg-gray-50 cursor-pointer text-sm"}," Browse… ",-1))])]),s.file?(r(),i("div",vt,[e("span",xt,[t[34]||(t[34]=e("span",{class:"text-gray-500 mr-1"},"Selected:",-1)),e("span",gt,a((d=s.file)==null?void 0:d.name),1)]),e("button",{type:"button",class:"px-3 py-1.5 rounded-lg border hover:bg-gray-50 text-sm",onClick:oe}," Remove ")])):x("",!0)],34)])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block font-medium mb-1"},"Description",-1)),w(be,{modelValue:s.description,"onUpdate:modelValue":t[14]||(t[14]=o=>s.description=o),class:"w-full"},null,8,["modelValue"])])]),e("div",yt,[w(n,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:F(()=>t[38]||(t[38]=[_(" Cancel ")])),_:1,__:[38]}),e("button",{disabled:!D.value,type:"submit",class:c(["px-4 py-2 rounded-xl text-white text-sm",D.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(C.value?"Saving…":"Save"),11,ft)]),e("div",ht,[w(n,{to:"/hrd/notice",class:"px-3.5 py-2 rounded-xl border hover:bg-gray-50 text-sm"},{default:F(()=>t[39]||(t[39]=[_(" Cancel ")])),_:1,__:[39]}),e("button",{disabled:!D.value,type:"submit",class:c(["px-4 py-2 rounded-xl text-white text-sm",D.value?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"])},a(C.value?"Saving…":"Save"),11,_t)])],32)])}}};export{Nt as default};
