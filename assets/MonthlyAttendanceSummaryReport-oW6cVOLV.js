import{_ as ke}from"./EmployeeFilter-CjHETKA_.js";import{_ as $e}from"./FlexibleDatePicker-BzBQAez4.js";import{L as Se}from"./LoaderView-DvSlCswE.js";import{U as me}from"./UpdateOrCreate-DYCH8OLO.js";import{x as H,c as _,o as p,t as l,B as Ce,r as h,C as Q,_ as he,Q as He,q as re,a as t,d as U,m as de,k as z,w as Le,z as De,s as b,F as W,l as Fe,v as Pe,T as Te,A as fe,u as Me,f as Ne,g as Ae,D as ze,h as ye,y as Ie,p as Ue,j as pe,b as A,n as Z,e as g,O as Re}from"./index-C79iWQp1.js";import{_ as qe}from"./TimePickerAsFloatHour-DUnPT0t8.js";import{u as Ee}from"./attendance-DwXAi2uY.js";import"./company-Cu7l7NIa.js";import"./department-y4_WLltf.js";import"./EmployeeDropdownInput-BRoAGj-B.js";import"./SelectDropdown-CsyZe_dC.js";import"./UserChip-dlOpnv8Y.js";import"./user-DM9yEDl_.js";const _e={__name:"DisplayFormattedWorkingHours",props:["workingHours"],setup(R){const S=R,i=H(()=>{if(!S.workingHours)return"-";const m=Math.floor(S.workingHours),C=Math.round((S.workingHours-m)*60);return C?`${m}h ${C}m`:`${m}h`});return(m,C)=>(p(),_("span",null,l(i.value),1))}},Be=Ce("payroll",()=>{const R=h([]),S=h(null),i=h(!1),m=h(null),C=h(new Date().toISOString().substring(0,7)),F=(d,u)=>{var w,Y,v,I;const s=((Y=(w=d==null?void 0:d.response)==null?void 0:w.data)==null?void 0:Y.message)||(d==null?void 0:d.message)||u,r=new Error(s);return r.status=(v=d==null?void 0:d.response)==null?void 0:v.status,r.data=(I=d==null?void 0:d.response)==null?void 0:I.data,r};return{periods:R,period:S,loading:i,error:m,selectedMonth:C,fetchPeriods:async(d={})=>{var u;i.value=!0,m.value=null;try{const s=await Q.get("/payroll",{params:d});return R.value=((u=s==null?void 0:s.data)==null?void 0:u.data)||(s==null?void 0:s.data)||[],s.data}catch(s){const r=F(s,"Failed to fetch payroll periods");throw m.value=r.message,r}finally{i.value=!1}},fetchUserPeriod:async(d,u)=>{var s;i.value=!0,m.value=null;try{const r=await Q.get(`/payroll/${d}/${u}`);return S.value=r.data||null,S.value}catch(r){if(((s=r==null?void 0:r.response)==null?void 0:s.status)===404)return S.value=null,null;const w=F(r,"Failed to fetch user period");throw m.value=w.message,w}finally{i.value=!1}},upsertPeriod:async d=>{var u;i.value=!0,m.value=null;try{const s=await Q.post("/payroll",d);return S.value=((u=s==null?void 0:s.data)==null?void 0:u.period)||(s==null?void 0:s.data)||null,s.data}catch(s){const r=F(s,"Failed to save payroll period");throw m.value=r.message,r}finally{i.value=!1}},updatePeriod:async(d,u)=>{var s;i.value=!0,m.value=null;try{const r=await Q.put(`/payroll/${d}`,u);return S.value=((s=r==null?void 0:r.data)==null?void 0:s.period)||(r==null?void 0:r.data)||null,r.data}catch(r){const w=F(r,"Failed to update payroll period");throw m.value=w.message,w}finally{i.value=!1}},lockPeriod:async d=>{var u;i.value=!0,m.value=null;try{const s=await Q.put(`/payroll/${d}/lock`);return S.value=((u=s==null?void 0:s.data)==null?void 0:u.period)||(s==null?void 0:s.data)||null,s.data}catch(s){const r=F(s,"Failed to lock payroll period");throw m.value=r.message,r}finally{i.value=!1}},unlockPeriod:async d=>{var u;i.value=!0,m.value=null;try{const s=await Q.put(`/payroll/${d}/unlock`);return S.value=((u=s==null?void 0:s.data)==null?void 0:u.period)||(s==null?void 0:s.data)||null,s.data}catch(s){const r=F(s,"Failed to unlock payroll period");throw m.value=r.message,r}finally{i.value=!1}},deletePeriod:async d=>{var u;i.value=!0,m.value=null;try{return await Q.delete(`/payroll/${d}`),R.value=R.value.filter(s=>s.id!==d),((u=S.value)==null?void 0:u.id)===d&&(S.value=null),!0}catch(s){const r=F(s,"Failed to delete payroll period");throw m.value=r.message,r}finally{i.value=!1}}}}),Ve={class:"modal-card max-w-lg"},Oe={class:"modal-card__head"},je=["disabled","title","aria-busy"],We={key:0,class:"inline-alert inline-alert--error"},Ye={class:"min-w-0"},Je={class:"text-xs opacity-80 truncate"},Ke={class:"modal-card__meta"},Ge={class:"meta-value"},Qe={class:"meta-value truncate"},Xe={class:"meta-value"},Ze={key:0},ge={class:"meta-value"},et={class:"modal-card__body"},tt={key:0,class:"skeleton"},at={class:"field-control flex flex-col gap-2"},st={class:"flex items-center justify-between"},lt={class:"text-[11px] text-slate-400"},nt={key:0,class:"text-xs text-rose-600"},ot={key:1,class:"text-xs text-amber-600"},rt={class:"flex flex-col gap-2"},dt={class:"flex items-center justify-between"},it={class:"text-[11px] text-slate-400"},ut=["disabled"],ct={class:"modal-card__footer"},pt={class:"footer-status"},_t={class:"modal-card__actions"},vt=["disabled"],mt=["disabled","aria-busy"],yt={key:0,class:"loading-dots"},ht={key:1},ft={__name:"AddonModal",props:{userId:{type:[String,Number],required:!0},month:{type:String,required:!0},employeeName:{type:String,default:""}},emits:["updated"],setup(R,{emit:S}){const i=He(),m=Be(),C=h(0),F=h(279),P=R,x=S,E=h(!1),L=h(!1),B=h(!1),V=h(!1),y=h(""),d=h(""),u=h(""),s=h(null),r=h({payable_hour:0,note:""}),w=H(()=>{if(!P.month)return"";const[c,o]=P.month.split("-");return new Date(Number(c),Number(o)-1).toLocaleString("en",{month:"long",year:"numeric"})}),Y=H(()=>{var c;return String(((c=s.value)==null?void 0:c.status)||"draft")}),v=H(()=>{var c,o;return Y.value==="locked"||!!((c=s.value)!=null&&c.locked_at)||!!((o=s.value)!=null&&o.is_locked)}),I=H(()=>v.value?"Locked":"Draft"),J=H(()=>{var c;if(!((c=s.value)!=null&&c.locked_at))return"";try{return new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(s.value.locked_at))}catch{return String(s.value.locked_at)}}),ee=H(()=>Number(d.value)),X=H(()=>{const c=ee.value;return Number.isFinite(c)&&c>=C.value&&c<=F.value}),se=H(()=>`Allowed: ${C.value}h – ${F.value}h per cycle`),O=H(()=>d.value===""||X.value?"":`Payable hours must be between ${C.value} and ${F.value}.`),D=H(()=>{var k,M;const c=Number(((k=r.value)==null?void 0:k.payable_hour)??0),o=String(((M=r.value)==null?void 0:M.note)??"");return Number(ee.value)!==c||String(u.value||"")!==o}),ie=H(()=>D.value&&X.value&&!v.value&&!L.value),T=()=>{r.value={payable_hour:Number(d.value||0),note:String(u.value||"")}},q=()=>{var c,o;d.value=Number(((c=r.value)==null?void 0:c.payable_hour)??0),u.value=String(((o=r.value)==null?void 0:o.note)??"")},te=async()=>{var c,o;V.value=!0,y.value="";try{const k=await m.fetchUserPeriod(P.userId,P.month);s.value=k||null,d.value=Number(((c=s.value)==null?void 0:c.payable_hour)??0),u.value=((o=s.value)==null?void 0:o.note)||"",T()}catch(k){console.error(k),y.value=(k==null?void 0:k.message)||"Failed to load payroll period",i.error(y.value),s.value=null,d.value=0,u.value="",T()}finally{V.value=!1}},K=async()=>{E.value=!0,await fe(),await te()},j=()=>{E.value=!1};re(()=>[P.userId,P.month],async()=>{E.value&&await te()});const ue=async()=>{var c;if(!((c=s.value)!=null&&c.id)){i.info("Save once to create the period, then you can lock/unlock.");return}if(D.value&&!v.value){if(!window.confirm("You have unsaved changes. Continue without saving?"))return;q()}try{B.value=!0;const o=v.value?await m.unlockPeriod(s.value.id):await m.lockPeriod(s.value.id),k=(o==null?void 0:o.period)||(o==null?void 0:o.data)||o;s.value=k||s.value,x("updated",{period:s.value,userId:P.userId}),i.success(v.value?"Unlocked.":"Locked.")}catch(o){i.error((o==null?void 0:o.message)||"Failed to change status")}finally{B.value=!1}},ce=async()=>{if(!X.value)return i.error(O.value||"Invalid payable hours.");if(v.value)return i.error("This payroll period is locked.");try{L.value=!0;const c={user_id:P.userId,month:P.month,payable_hour:Number(d.value),note:String(u.value||"").trim()||null},o=await m.upsertPeriod(c),k=(o==null?void 0:o.period)||(o==null?void 0:o.data)||o;s.value=k||s.value,T(),x("updated",{period:s.value,userId:P.userId}),i.success("Saved."),j()}catch(c){i.error((c==null?void 0:c.message)||"Failed to save payroll period")}finally{L.value=!1}};return(c,o)=>(p(),_(W,null,[t("button",{type:"button",class:"paycut-trigger",onClick:K,title:"Adjust payable hours"},o[2]||(o[2]=[t("i",{class:"far fa-edit"},null,-1)])),U(Te,{name:"fade-scale"},{default:de(()=>[E.value?(p(),_("div",{key:0,class:"modal-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"addon-modal-title",onKeydown:De(j,["esc"]),onClick:Le(j,["self"])},[t("div",Ve,[t("header",Oe,[o[4]||(o[4]=t("div",{class:"icon-circle"},[t("i",{class:"fal fa-clock"})],-1)),o[5]||(o[5]=t("div",{class:"min-w-0"},[t("p",{id:"addon-modal-title",class:"modal-card__title"},"Payroll Period"),t("p",{class:"modal-card__subtitle"}," Set payable hours & notes. Lock to prevent edits. ")],-1)),t("div",{class:b(["status-chip",v.value?"status-chip--locked":"status-chip--draft"])},[t("i",{class:b(v.value?"far fa-lock":"far fa-pen")},null,2),t("span",null,l(I.value),1)],2),t("button",{class:"icon-button icon-button--lock",type:"button",disabled:B.value||V.value,title:v.value?"Unlock period":"Lock period","aria-busy":B.value,onClick:ue},[t("i",{class:b(B.value?"far fa-spinner-third fa-spin":v.value?"far fa-lock-open":"far fa-lock")},null,2)],8,je),t("button",{class:"icon-button",type:"button","aria-label":"Close",onClick:j},o[3]||(o[3]=[t("i",{class:"far fa-times"},null,-1)]))]),y.value?(p(),_("div",We,[o[7]||(o[7]=t("i",{class:"far fa-triangle-exclamation"},null,-1)),t("div",Ye,[o[6]||(o[6]=t("p",{class:"font-semibold"},"Couldn’t load period",-1)),t("p",Je,l(y.value),1)]),t("button",{class:"inline-alert__action",type:"button",onClick:te},"Retry")])):z("",!0),t("section",Ke,[t("div",null,[o[8]||(o[8]=t("p",{class:"meta-label"},"Month",-1)),t("p",Ge,l(w.value),1)]),t("div",null,[o[9]||(o[9]=t("p",{class:"meta-label"},"Employee",-1)),t("p",Qe,l(P.employeeName||"-"),1)]),t("div",null,[o[10]||(o[10]=t("p",{class:"meta-label"},"User",-1)),t("p",Xe,"#"+l(P.userId),1)]),v.value?(p(),_("div",Ze,[o[11]||(o[11]=t("p",{class:"meta-label"},"Locked at",-1)),t("p",ge,l(J.value||"-"),1)])):z("",!0)]),t("section",et,[V.value?(p(),_("div",tt,o[12]||(o[12]=[t("div",{class:"skeleton-line w-2/3"},null,-1),t("div",{class:"skeleton-box"},null,-1),t("div",{class:"skeleton-line w-1/2"},null,-1),t("div",{class:"skeleton-box h-20"},null,-1)]))):(p(),_(W,{key:1},[t("div",at,[t("div",st,[o[13]||(o[13]=t("label",{class:"field-label"},"Payable hours",-1)),t("span",lt,l(se.value),1)]),U(qe,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=k=>d.value=k),"minute-interval":5,required:!0,"hour-min":C.value,"hour-max":F.value,disabled:v.value},null,8,["modelValue","hour-min","hour-max","disabled"]),O.value?(p(),_("p",nt,l(O.value),1)):v.value?(p(),_("p",ot," This period is locked — unlock to edit. ")):z("",!0)]),t("div",rt,[t("div",dt,[o[14]||(o[14]=t("label",{class:"field-label"},"Note",-1)),t("span",it,l((u.value||"").length)+"/1000",1)]),Fe(t("textarea",{class:"input-1",rows:"3","onUpdate:modelValue":o[1]||(o[1]=k=>u.value=k),disabled:v.value,placeholder:"Optional: explain changes…"},null,8,ut),[[Pe,u.value]])])],64))]),t("footer",ct,[t("div",pt,[o[15]||(o[15]=t("i",{class:"fal fa-info-circle"},null,-1)),t("span",null,l(v.value?"Locked: no edits allowed.":D.value?"You have unsaved changes.":"No changes yet."),1)]),t("div",_t,[t("button",{class:"btn-3",type:"button",onClick:j},"Close"),v.value?z("",!0):(p(),_("button",{key:0,class:"btn-3",type:"button",disabled:!D.value||L.value,onClick:q,title:"Reset changes"}," Reset ",8,vt)),t("button",{class:"btn-2-green",type:"button",disabled:!ie.value,"aria-busy":L.value,onClick:ce},[L.value?(p(),_("span",yt,"Saving...")):(p(),_("span",ht,l(D.value?"Save changes":"Saved"),1))],8,mt)])])])],32)):z("",!0)]),_:1})],64))}},bt=he(ft,[["__scopeId","data-v-78a03b05"]]),xt={class:"px-4 space-y-4"},wt={class:"glass-panel px-4 py-3 bg-white/90 backdrop-blur border border-slate-100"},kt={class:"flex items-start justify-between gap-3"},$t={class:"flex items-start gap-3 min-w-0"},St={class:"min-w-0"},Ct={class:"flex flex-wrap items-center gap-2"},Ht={key:0,class:"ml-1 text-[10px] font-normal"},Lt={class:"mt-1 text-xs text-slate-500"},Dt={class:"font-semibold"},Ft={class:"mt-1 text-sm text-red-500 font-bold"},Pt={class:"font-semibold text-slate-500"},Tt={class:"flex flex-wrap items-center justify-end gap-2"},Mt={class:"hidden lg:flex items-center gap-2"},Nt={class:"segmented-control"},At=["onClick"],zt={class:"hidden lg:flex items-center gap-2"},It={class:"segmented-control segmented-control--ghost"},Ut=["onClick"],Rt=["disabled"],qt={class:"hidden sm:inline"},Et={class:"sm:hidden"},Bt=["disabled","title"],Vt={class:"hidden sm:inline"},Ot=["disabled"],jt=["disabled"],Wt={class:"mt-3 flex flex-wrap items-center gap-2 lg:hidden"},Yt={class:"segmented-control"},Jt=["onClick"],Kt={class:"segmented-control segmented-control--ghost"},Gt=["onClick"],Qt={class:"glass-panel p-3 bg-white/90 backdrop-blur"},Xt={class:"flex items-center justify-start gap-4"},Zt={class:"flex gap-2"},gt={key:3},ea={key:0,class:"empty-state"},ta={key:1,class:"empty-state glass-panel"},aa={key:2,class:"space-y-4"},sa={key:0,class:"grid gap-3 md:grid-cols-2 xl:grid-cols-3"},la={class:"report-card__header"},na={class:"report-card__title"},oa={class:"report-card__subtitle"},ra={class:"report-card__body"},da={class:"report-card__row"},ia={class:"text-gray-500 text-xs"},ua={class:"report-card__grid"},ca={class:"report-card__metric"},pa={class:"report-card__metric"},_a={class:"report-card__metric"},va={class:"report-card__metric"},ma={class:"report-card__metric"},ya={class:"report-card__metric"},ha={class:"report-card__metric"},fa={class:"report-card__metric"},ba={class:"report-card__footer"},xa={class:"flex items-center gap-3 text-xs text-gray-500"},wa={class:"min-w-full table-auto border-collapse"},ka={class:"text-center text-xs"},$a={class:"td"},Sa={class:"td text-left"},Ca={class:"td text-left"},Ha={class:"td"},La={class:"td"},Da={class:"td"},Fa={class:"td"},Pa={class:"td"},Ta={class:"td"},Ma={class:"td"},Na={class:"td"},Aa={class:"td"},za={class:"td"},Ia={class:"td"},Ua={class:"td"},Ra={class:"td"},qa={class:"td"},Ea={class:"td text-xs"},Ba={class:"text-[11px] text-gray-500"},Va={class:"td"},Oa={class:"td"},ja={class:"td"},Wa={class:"td"},Ya={class:"td"},Ja={class:"w-10 text-xs text-gray-600"},Ka={class:"td"},Ga={class:"w-10 text-xs text-gray-600"},Qa={class:"td"},Xa={class:"td"},Za={class:"flex gap-2 justify-center items-center"},ga={class:"td"},es={class:"td"},ts={class:"td"},as={class:"flex items-center justify-center gap-2"},ss={class:"td"},ls={class:"td"},ns={class:"bg-gray-100 text-center text-sm font-semibold"},os={class:"td"},rs={class:"td"},ds={class:"td"},is={class:"td"},us={class:"td"},cs={class:"td"},ps={class:"td"},_s={class:"td"},vs={class:"td"},ms={class:"td"},ys={__name:"MonthlyAttendanceSummaryReport",setup(R){const S=Me(),i=Ne(),m=Ae(),C=Ee(),{monthly_company_summary:F,reportMeta:P}=ze(C),x=n=>{const a=Number(n);return Number.isFinite(a)?a:0},E=h({}),L=(n,a)=>n.reduce((f,$)=>{try{const e=a.split(".").reduce((N,G)=>N?N[G]:void 0,$);return f+x(e)}catch{return f}},0),B=n=>String(n||"").padStart(2,"0"),V=n=>{const a=Number(n);return Number.isFinite(a)?a.toFixed(1):"0.0"},y=h(i.query.date&&String(i.query.date)||C.selectedMonth||""),d=n=>{const a={year:new Date().getFullYear(),month:new Date().getMonth()+1};if(!n)return a;const[f="",$=""]=String(n).split("-");return!f||!$?a:{year:Number(f)||a.year,month:Number($)||a.month}},u=h(d(y.value)),s=h({company_id:i.query.company_id||"",department_id:i.query.department_id||"all",line_type:i.query.line_type||"all",employee_id:i.query.employee_id||""}),r=H(()=>Array.isArray(F.value)?F.value:[]),w=H(()=>!!(r.value[0]&&r.value[0].is_final)),Y=H(()=>{const n=r.value[0];if(!n||!n.finalized_at)return"";try{const a=new Date(n.finalized_at);return new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(a)}catch{return String(n.finalized_at)}}),v=H(()=>{const n=r.value;return{cl:L(n,"total_cl_leave"),ml:L(n,"total_ml_leave"),sl:L(n,"total_sl_leave"),wplDays:L(n,"total_wpl_leave"),otHour:L(n,"total_overtime_hours"),addOnHour:n.reduce((a,f)=>a+f.payroll,0),absentDays:L(n,"total_absent"),wplHour:L(n,"total_wpl_hour"),paycutHour:L(n,"approved_paycut"),payableHour:L(n,"payable_hour")}}),I=h("table"),J=h("compact"),ee=[{label:"Table",value:"table",icon:"fal fa-table"},{label:"Cards",value:"cards",icon:"fal fa-th-large"}],X=[{label:"Cozy",value:"cozy"},{label:"Compact",value:"compact"}],se=H(()=>{const n=y.value;if(!n)return"Month not selected";const[a,f]=n.split("-").map($=>Number($));return!a||!f?n:new Intl.DateTimeFormat("en",{month:"long",year:"numeric"}).format(new Date(a,f-1))}),O=(n,a="0:00")=>n&&String(n).trim()!==""?n:a,D=h({toast:null,banner:null}),ie=H(()=>{var a;const n=(a=D.value.toast)==null?void 0:a.type;return n==="success"?"border-emerald-200 bg-emerald-50 text-emerald-800":n==="error"?"border-rose-200 bg-rose-50 text-rose-800":"border-slate-200 bg-slate-50 text-slate-800"});function T(n,a){D.value.toast={type:n,text:a},window.clearTimeout(T._t),T._t=window.setTimeout(()=>D.value.toast=null,2500)}function q(n,a,f=4e3){D.value.banner={type:n,text:a},window.clearTimeout(q._b),q._b=window.setTimeout(()=>D.value.banner=null,f)}const te=({period:n,userId:a})=>{!a||!n||(E.value={...E.value,[a]:n})},K=async()=>{const n=s.value.company_id,a=s.value.department_id,f=s.value.employee_id||"",$=s.value.line_type!=="all"?s.value.line_type:"";if(!n){T("info","Select a company first.");return}try{await C.getMonthlyAttendanceSummaryReport(n,a,$,f,y.value)}catch(e){console.error("Failed:",e),T("error","Failed to load attendance data.")}},j=n=>{const a=i.query;Object.keys(n).some($=>String(a[$]??"")!==String(n[$]??""))&&S.replace({query:n})},ue=()=>{j({...i.query,company_id:s.value.company_id||"",department_id:s.value.department_id||"all",line_type:s.value.line_type||"all",employee_id:s.value.employee_id||"",date:y.value||""})};re(y,n=>j({...i.query,date:n||""})),re(u,n=>{if(!n)return;const a=`${n.year}-${B(n.month)}`;y.value!==a&&(y.value=a)},{deep:!0}),re(y,n=>{const a=d(n);(!u.value||a.year!==u.value.year||a.month!==u.value.month)&&(u.value=a)}),ye(()=>{s.value.company_id&&K()});const ce=async()=>{if(!s.value.company_id)return;const n=s.value.line_type!=="all"?s.value.line_type:"";await C.downloadExcel(s.value.company_id,n,y.value)},c=async()=>{if(!s.value.company_id)return;const n=s.value.line_type!=="all"?s.value.line_type:"";await C.downloadPDF(s.value.company_id,n,y.value)},o=()=>S.go(-1),k=async()=>K(),M=h(!1),be=async()=>{if(!s.value.company_id||!y.value){T("info","Select company & month first.");return}const n=s.value.line_type!=="all"?s.value.line_type:"",a=s.value.employee_id||"",f=s.value.department_id||"";try{M.value=!0,q("info",`Recalculating snapshot for ${se.value}…`,6e3),await C.recalculateMonthlySnapshot(s.value.company_id,f,n,a,y.value),await K(),q("success","✅ Snapshot refreshed — numbers updated on this page.")}catch($){console.error("Failed recalc:",$),T("error","Failed to recalculate snapshot.")}finally{M.value=!1}},xe=async()=>{if(!s.value.company_id||!y.value){T("info","Select company & month first.");return}const n=w.value?"unfinalize":"finalize",a=n==="finalize"?"Finalize":"Unfinalize",f=s.value.line_type!=="all"?s.value.line_type:"",$=s.value.employee_id||"";try{M.value=!0,q("info",`${a} in progress…`,6e3),await C.finalizeMonthlySnapshot(s.value.company_id,f,$,y.value,n),await K(),q("success",`✅ Month ${a.toLowerCase()}d successfully.`)}catch(e){console.error("Finalize failed:",e),T("error","Failed to change final status.")}finally{M.value=!1}},le=h(null),ne=h(null),ve=h(260);let ae=null;const oe=async()=>{var $,e;await fe();const n=(($=le.value)==null?void 0:$.offsetHeight)||0,a=((e=ne.value)==null?void 0:e.offsetHeight)||0,f=24;ve.value=n+a+f},we=H(()=>`max(320px, calc(100vh - ${ve.value}px))`);return ye(async()=>{await oe(),typeof ResizeObserver<"u"?(ae=new ResizeObserver(oe),le.value&&ae.observe(le.value),ne.value&&ae.observe(ne.value)):window.addEventListener("resize",oe)}),Ie(()=>{ae&&ae.disconnect(),window.removeEventListener("resize",oe)}),(n,a)=>{var $;const f=Ue("router-link");return p(),_("div",xt,[D.value.toast?(p(),_("div",{key:0,class:b(["fixed right-4 top-4 z-[90] rounded-xl border px-4 py-2 text-sm shadow-sm",ie.value])},l(D.value.toast.text),3)):z("",!0),D.value.banner?(p(),_("div",{key:1,class:b(["sticky top-2 z-[80] rounded-2xl border px-4 py-2 text-sm shadow-sm",D.value.banner.type==="success"?"border-emerald-200 bg-emerald-50 text-emerald-800":"border-slate-200 bg-slate-50 text-slate-800"])},l(D.value.banner.text),3)):z("",!0),t("div",{ref_key:"topBarRef",ref:le,class:"sticky top-0 z-50"},[t("div",wt,[t("div",kt,[t("div",$t,[t("button",{class:"btn-3 !h-10 !w-10 rounded-full shadow-sm",onClick:o},a[6]||(a[6]=[t("i",{class:"far fa-arrow-left text-sm"},null,-1)])),t("div",St,[a[15]||(a[15]=t("div",{class:"flex flex-wrap items-center gap-2"},[t("p",{class:"text-[11px] font-semibold uppercase tracking-[0.2em] text-slate-400"}," Monthly overview ")],-1)),t("div",Ct,[a[7]||(a[7]=t("h1",{class:"truncate text-base font-semibold text-slate-900"}," Monthly Attendance Summary ",-1)),r.value.length?(p(),_("span",{key:0,class:b(["inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-semibold",w.value?"bg-emerald-50 text-emerald-700":"bg-amber-50 text-amber-700"])},[t("span",{class:b(["inline-block h-2 w-2 rounded-full",w.value?"bg-emerald-500":"bg-amber-500"])},null,2),A(" "+l(w.value?"Finalized":"Draft")+" ",1),w.value&&Y.value?(p(),_("span",Ht," ("+l(Y.value)+") ",1)):z("",!0)],2)):z("",!0)]),t("p",Lt,[a[8]||(a[8]=A(" This page shows a ")),a[9]||(a[9]=t("span",{class:"font-semibold text-slate-700"},"snapshot",-1)),a[10]||(a[10]=A(" for ")),t("span",Dt,l(se.value),1),a[11]||(a[11]=A(". ")),a[12]||(a[12]=t("span",{class:"ml-1 inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[11px] font-semibold text-amber-700"}," Click Recalculate to refresh all numbers on this report. ",-1))]),t("p",Ft,[a[13]||(a[13]=A(" Last calculate: ")),t("span",Pt,l(($=Z(P))==null?void 0:$.last_update_human),1),a[14]||(a[14]=t("span",{class:"mx-2"},"•",-1)),A(" "+l(r.value.length)+" employees ",1)])])]),t("div",Tt,[t("div",Mt,[a[16]||(a[16]=t("span",{class:"toolbar-label"},"View",-1)),t("div",Nt,[(p(),_(W,null,g(ee,e=>t("button",{key:e.value,type:"button",class:b(["segmented-control__btn",{"is-active":I.value===e.value}]),onClick:N=>I.value=e.value},[t("i",{class:b(e.icon)},null,2),t("span",null,l(e.label),1)],10,At)),64))])]),t("div",zt,[a[17]||(a[17]=t("span",{class:"toolbar-label"},"Density",-1)),t("div",It,[(p(),_(W,null,g(X,e=>t("button",{key:e.value,type:"button",class:b(["segmented-control__btn",{"is-active":J.value===e.value}]),onClick:N=>J.value=e.value},l(e.label),11,Ut)),64))])]),t("button",{type:"button",class:"btn-2 inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",disabled:!s.value.company_id||!y.value||M.value||w.value,onClick:be,title:"Rebuild snapshot for this month (updates all numbers on this page)"},[t("i",{class:b(["fal fa-rotate text-base",M.value?"animate-spin":""])},null,2),t("span",qt,l(M.value?"Recalculating…":"Recalculate"),1),t("span",Et,l(M.value?"…":"Recalc"),1)],8,Rt),t("button",{type:"button",class:b(["inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",w.value?"bg-slate-200 text-slate-800":"bg-emerald-500 text-white"]),disabled:!s.value.company_id||!y.value||M.value||r.value.length===0,onClick:xe,title:w.value?"Unlock month for edits":"Lock month as final"},[t("i",{class:b(w.value?"fal fa-lock-open":"fal fa-lock")},null,2),t("span",Vt,l(w.value?"Unfinalize":"Finalize"),1)],10,Bt),t("button",{type:"button",onClick:ce,class:"btn-1 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold shadow-sm disabled:opacity-50",disabled:!s.value.company_id},a[18]||(a[18]=[t("i",{class:"far fa-file-excel text-base text-green-500"},null,-1),t("span",{class:"hidden sm:inline"},"Excel",-1)]),8,Ot),t("button",{type:"button",onClick:c,class:"btn-1 inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-semibold shadow-sm disabled:opacity-50",disabled:!s.value.company_id},a[19]||(a[19]=[t("i",{class:"fal fa-file-pdf text-base text-red-500"},null,-1),t("span",{class:"hidden sm:inline"},"PDF",-1)]),8,jt)])]),t("div",Wt,[a[20]||(a[20]=t("span",{class:"toolbar-label"},"View",-1)),t("div",Yt,[(p(),_(W,null,g(ee,e=>t("button",{key:e.value,type:"button",class:b(["segmented-control__btn",{"is-active":I.value===e.value}]),onClick:N=>I.value=e.value},[t("i",{class:b(e.icon)},null,2),t("span",null,l(e.label),1)],10,Jt)),64))]),a[21]||(a[21]=t("span",{class:"toolbar-label ml-2"},"Density",-1)),t("div",Kt,[(p(),_(W,null,g(X,e=>t("button",{key:e.value,type:"button",class:b(["segmented-control__btn",{"is-active":J.value===e.value}]),onClick:N=>J.value=e.value},l(e.label),11,Gt)),64))])])])],512),t("div",{ref_key:"filterBarRef",ref:ne,class:"sticky top-[92px] z-40"},[t("div",Qt,[t("div",Xt,[U(ke,{company_id:s.value.company_id,"onUpdate:company_id":a[2]||(a[2]=e=>s.value.company_id=e),department_id:s.value.department_id,"onUpdate:department_id":a[3]||(a[3]=e=>s.value.department_id=e),employee_id:s.value.employee_id,"onUpdate:employee_id":a[4]||(a[4]=e=>s.value.employee_id=e),line_type:s.value.line_type,"onUpdate:line_type":a[5]||(a[5]=e=>s.value.line_type=e),"with-type":!0,"initial-value":n.$route.query,onFilterChange:ue,class:"w-full"},{default:de(()=>[t("div",Zt,[U($e,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),"show-year":!1,"show-month":!0,"show-date":!1,label:"Month"},null,8,["modelValue"]),t("button",{type:"button",onClick:a[1]||(a[1]=e=>K()),class:"btn-2 rounded"}," Search ")])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])])])],512),Z(C).isLoading?(p(),pe(Se,{key:2})):(p(),_("div",gt,[s.value.company_id?r.value.length===0?(p(),_("div",ta,a[23]||(a[23]=[t("p",{class:"text-base font-semibold text-gray-700"},"No attendance found",-1),t("p",{class:"text-sm text-gray-500"},"Try a different set of filters or a different month.",-1)]))):(p(),_("div",aa,[I.value==="cards"?(p(),_("div",sa,[(p(!0),_(W,null,g(r.value,(e,N)=>{var G;return p(),_("article",{key:`${(e==null?void 0:e.user_id)||"card"}-${N}`,class:b(["report-card",{"report-card--alert":e==null?void 0:e.under_target}])},[t("header",la,[t("div",null,[t("p",na,l(e==null?void 0:e.user),1),t("p",oa,l(e==null?void 0:e.designation),1)]),t("span",{class:b(["report-card__tag",e!=null&&e.under_target?"report-card__tag--alert":"report-card__tag--ok"])},l(e!=null&&e.under_target?"Under target":"On track"),3)]),t("div",ra,[t("div",da,[a[24]||(a[24]=t("p",{class:"report-card__body-label"},"Working Hour",-1)),t("p",{class:b(["report-card__primary",e!=null&&e.under_target?"text-red-600":"text-emerald-600"])},[A(l(O(e==null?void 0:e.total_working_hours))+" ",1),t("span",ia,"/ "+l(O(e==null?void 0:e.total_shift_hours)),1)],2)]),t("div",ua,[t("div",null,[a[25]||(a[25]=t("p",{class:"report-card__body-label"},"Attendance",-1)),t("p",ca," P "+l(x(e==null?void 0:e.total_present))+" | L "+l(x(e==null?void 0:e.total_leave))+" | A "+l(x(e==null?void 0:e.total_absent)),1)]),t("div",null,[a[26]||(a[26]=t("p",{class:"report-card__body-label"},"Weekend",-1)),t("p",pa,l(x(e==null?void 0:e.total_weekend))+" days",1)]),t("div",null,[a[27]||(a[27]=t("p",{class:"report-card__body-label"},"Actual Late",-1)),t("p",_a,l(x(e==null?void 0:e.actual_late_day))+"d / "+l(O(e==null?void 0:e.actual_late_hour)),1)]),t("div",null,[a[28]||(a[28]=t("p",{class:"report-card__body-label"},"Actual Early",-1)),t("p",va,l(x(e==null?void 0:e.actual_early_day))+"d / "+l(O(e==null?void 0:e.actual_early_hour)),1)]),t("div",null,[a[29]||(a[29]=t("p",{class:"report-card__body-label"},"Short Leave",-1)),t("p",ma," First "+l(x(e==null?void 0:e.total_first_short_leave))+" | Last "+l(x(e==null?void 0:e.total_last_short_leave)),1)]),t("div",null,[a[30]||(a[30]=t("p",{class:"report-card__body-label"},"Leave Types",-1)),t("p",ya," CL "+l(x(e==null?void 0:e.total_cl_leave))+" | ML "+l(x(e==null?void 0:e.total_ml_leave))+" | SL "+l(x(e==null?void 0:e.total_sl_leave))+" | WPL "+l(x(e==null?void 0:e.total_wpl_leave)),1)]),t("div",null,[a[31]||(a[31]=t("p",{class:"report-card__body-label"},"Hours Impact",-1)),t("p",ha," OT "+l(x(e==null?void 0:e.total_overtime_hours))+"h | Payable "+l(x(e==null?void 0:e.payable_hour))+"h ",1)]),t("div",null,[a[32]||(a[32]=t("p",{class:"report-card__body-label"},"Deduction",-1)),t("p",fa,l(x(e==null?void 0:e.total_absent)*9)+"h + "+l(x(e==null?void 0:e.total_wpl_hour))+"h ",1)])])]),t("footer",ba,[t("div",xa,[U(_e,{workingHours:e==null?void 0:e.approved_paycut},null,8,["workingHours"]),((G=Z(m).user)==null?void 0:G.id)===8?(p(),pe(me,{key:0,class:"rounded-full bg-slate-100 px-2 py-1 text-[11px] font-semibold text-slate-600",userId:e==null?void 0:e.user_id,month:y.value,onUpdated:k},null,8,["userId","month"])):z("",!0)]),U(f,{to:{name:"EmployeeAttendance",query:{...Z(i).query,employee_id:e==null?void 0:e.user_id,date:y.value}},target:"_blank",class:"report-card__cta"},{default:de(()=>a[33]||(a[33]=[A(" Job Card "),t("i",{class:"far fa-arrow-up-right-from-square text-xs"},null,-1)])),_:2,__:[33]},1032,["to"])])],2)}),128))])):(p(),_("div",{key:1,class:b(["table-shell",[J.value==="compact"?"table-density-compact":"table-density-cozy"]])},[t("div",{class:"table-scroll",style:Re({maxHeight:we.value})},[t("table",wa,[a[39]||(a[39]=t("thead",{class:"sticky top-0 bg-white shadow-sm z-10"},[t("tr",{class:"bg-gray-50 text-sm"},[t("th",{rowspan:"2",class:"th"},"#"),t("th",{rowspan:"2",class:"th text-left"},"Employee Name"),t("th",{rowspan:"2",class:"th text-left"},"Designation"),t("th",{colspan:"6",class:"th"},"Attendance Summary"),t("th",{colspan:"2",class:"th"},"Actual Late"),t("th",{colspan:"2",class:"th"},"Remaining Late"),t("th",{colspan:"2",class:"th"},"Actual Early"),t("th",{colspan:"2",class:"th"},"Remaining Early"),t("th",{rowspan:"2",class:"th"},"Working Hour"),t("th",{colspan:"4",class:"th"},"Leave Day"),t("th",{colspan:"2",class:"th"},"Short Leave"),t("th",{colspan:"2",class:"th"},"Addition"),t("th",{colspan:"3",class:"th"},"Deduction Hour"),t("th",{rowspan:"2",class:"th"},"Payable"),t("th",{rowspan:"2",class:"th"},"Action")]),t("tr",{class:"bg-gray-50 text-xs"},[t("th",{class:"th"},"TD"),t("th",{class:"th"},"TP"),t("th",{class:"th"},"TW"),t("th",{class:"th"},"TL"),t("th",{class:"th"},"TA"),t("th",{class:"th"},"THD"),t("th",{class:"th"},"Day"),t("th",{class:"th"},"Hour"),t("th",{class:"th"},"Day"),t("th",{class:"th"},"Hour"),t("th",{class:"th"},"Day"),t("th",{class:"th"},"Hour"),t("th",{class:"th"},"Day"),t("th",{class:"th"},"Hour"),t("th",{class:"th"},"CL"),t("th",{class:"th"},"ML"),t("th",{class:"th"},"SL"),t("th",{class:"th"},"WPL"),t("th",{class:"th"},"Delay"),t("th",{class:"th"},"Early"),t("th",{class:"th",title:"Over Time"},"OTH"),t("th",{class:"th"},"Add-on"),t("th",{class:"th"},"Absent"),t("th",{class:"th"},"WPL"),t("th",{class:"th"},"Pay-cut")])],-1)),t("tbody",ka,[(p(!0),_(W,null,g(r.value,(e,N)=>{var G;return p(),_("tr",{key:`${(e==null?void 0:e.user_id)||"u"}-${N}`,class:b(["border-b hover:bg-blue-50",{"table-row--alert":e==null?void 0:e.under_target}])},[t("td",$a,l(N+1),1),t("td",Sa,l(e==null?void 0:e.user),1),t("td",Ca,l(e==null?void 0:e.designation),1),t("td",Ha,l(e==null?void 0:e.total_monthly_days),1),t("td",La,l(e==null?void 0:e.total_present),1),t("td",Da,l(e==null?void 0:e.total_weekend),1),t("td",Fa,l(e==null?void 0:e.total_leave),1),t("td",Pa,l(e==null?void 0:e.total_absent),1),t("td",Ta,l(e==null?void 0:e.total_holiday),1),t("td",Ma,l(e==null?void 0:e.actual_late_day),1),t("td",Na,l(e==null?void 0:e.actual_late_hour),1),t("td",Aa,l(e==null?void 0:e.total_remain_late_day),1),t("td",za,l(e==null?void 0:e.total_remain_late_hour),1),t("td",Ia,l(e==null?void 0:e.actual_early_day),1),t("td",Ua,l(e==null?void 0:e.actual_early_hour),1),t("td",Ra,l(e==null?void 0:e.total_remain_early_day),1),t("td",qa,l(e==null?void 0:e.total_remain_early_hour),1),t("td",Ea,[t("p",{class:b(["font-semibold",e!=null&&e.under_target?"text-red-600":"text-emerald-600"])},l(e==null?void 0:e.total_working_hours),3),t("p",Ba,"of "+l(e==null?void 0:e.total_shift_hours),1)]),t("td",Va,l(e==null?void 0:e.total_cl_leave),1),t("td",Oa,l(e==null?void 0:e.total_ml_leave),1),t("td",ja,l(e==null?void 0:e.total_sl_leave),1),t("td",Wa,l(e==null?void 0:e.total_wpl_leave),1),t("td",Ya,[t("p",Ja,[A(l((e==null?void 0:e.total_first_short_leave)||0)+" of ",1),t("span",{class:b({"text-red-600 font-bold":(e==null?void 0:e.actual_late_day)>=4})},l((e==null?void 0:e.actual_late_day)||0),3)])]),t("td",Ka,[t("p",Ga,[A(l((e==null?void 0:e.total_last_short_leave)||0)+" of ",1),t("span",{class:b({"text-red-600 font-bold":(e==null?void 0:e.actual_early_day)>=4})},l((e==null?void 0:e.actual_early_day)||0),3)])]),t("td",Qa,l(e!=null&&e.total_overtime_hours?`${e==null?void 0:e.total_overtime_hours} H`:""),1),t("td",Xa,[t("div",Za,[U(_e,{workingHours:e==null?void 0:e.payroll},null,8,["workingHours"]),U(bt,{userId:e.user_id,employeeName:e.user,month:y.value,onUpdated:te},null,8,["userId","employeeName","month"])])]),t("td",ga,l(x(e==null?void 0:e.total_absent)*9)+"h",1),t("td",es,l(e==null?void 0:e.total_wpl_hour)+"h",1),t("td",ts,[t("div",as,[U(_e,{workingHours:e==null?void 0:e.approved_paycut},null,8,["workingHours"]),((G=Z(m).user)==null?void 0:G.id)===8?(p(),pe(me,{key:0,class:"mr-2",userId:e==null?void 0:e.user_id,month:y.value,onUpdated:k},null,8,["userId","month"])):z("",!0)])]),t("td",ss,l(e==null?void 0:e.payable_hour)+"h",1),t("td",ls,[U(f,{to:{name:"EmployeeAttendance",query:{...Z(i).query,employee_id:e==null?void 0:e.user_id,date:y.value}},target:"_blank",class:"inline-flex w-20 items-center gap-1 rounded-md bg-blue-50 px-1 py-1 font-medium text-blue-700 hover:bg-blue-100"},{default:de(()=>a[34]||(a[34]=[A(" Job Card "),t("i",{class:"far fa-arrow-up-right-from-square text-xs"},null,-1)])),_:2,__:[34]},1032,["to"])])],2)}),128))]),t("tfoot",null,[t("tr",ns,[a[35]||(a[35]=t("td",{colspan:"18",class:"td"},"Total",-1)),t("td",os,l(v.value.cl),1),t("td",rs,l(v.value.ml),1),t("td",ds,l(v.value.sl),1),t("td",is,l(v.value.wplDays),1),a[36]||(a[36]=t("td",{class:"td"},null,-1)),a[37]||(a[37]=t("td",{class:"td"},null,-1)),t("td",us,l(v.value.otHour),1),t("td",cs,l(V(v.value.addOnHour)),1),t("td",ps,l(v.value.absentDays)+" day",1),t("td",_s,l(v.value.wplHour),1),t("td",vs,l(v.value.paycutHour),1),t("td",ms,l(V(v.value.payableHour)),1),a[38]||(a[38]=t("td",{class:"td"},null,-1))])])])],4)],2))])):(p(),_("div",ea,a[22]||(a[22]=[t("p",{class:"text-base font-semibold text-red-500"},"Select a company to start the report.",-1),t("p",{class:"text-sm text-gray-500"},"Choose a company & filters above to preview this month.",-1)])))]))])}}},Ps=he(ys,[["__scopeId","data-v-f75a685a"]]);export{Ps as default};
