import{_ as oe}from"./CommentModal-BnDjqXqT.js";import{u as ne,O as X,_ as re}from"./task-priority-DFkbjPJL.js";import{L as ie}from"./LoaderView-B_zNQGYL.js";import{_ as Y,a as de}from"./TaskAddForm-BtE7x60b.js";import{_ as ue}from"./TaskEditForm-BykRJr6r.js";import{q as g,s as me,e as te,A as se,c as m,o as r,a as t,f as U,w as F,l as v,p as q,h as o,g as L,C as pe,D as H,v as ce,F as E,x as j,y as z,b as fe,u as ye,r as $,E as ve,k as ke,m as R,t as Z,n as ee}from"./index-fS0eoUJu.js";import{_ as be}from"./MultiselectDropdown-DEM773_f.js";import{u as ge}from"./company-BH_UWZG-.js";import{_ as le}from"./UserChip-DtFUAOKC.js";import{_ as ae}from"./TaskTreeView-BsrdVub2.js";import{u as xe}from"./useTaskStore-CbeDD5M2.js";import"./useCommentStore-CXXnxwca.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-Q7AYmaFf.js";import"./useRequirementStore-DzehaDPc.js";import"./SectionLoading-CY7A30Dw.js";import"./vue-multiselect.esm-BcBaw8PC.js";import"./datetime-BISRKKpq.js";const we={class:"mb-3 task-header"},Ce={class:"flex justify-between items-center"},_e={class:"ml-auto flex gap-6 items-center"},Te={key:0,class:"flex gap-2 items-center"},Ve={class:"flex flex-wrap items-center gap-2 mt-3"},qe={class:"flex flex-wrap gap-4 w-full"},Ie={class:"relative w-full md:w-72"},$e={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Ue={class:"text-gray-600 w-40 relative"},Se={class:"flex gap-4 items-center flex-shrink-0"},he={class:"flex gap-2"},Ae={class:"flex gap-2"},De={class:"flex gap-2"},Le={class:"text-gray-600 w-full md:w-40 md:ml-auto relative"},Ee={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(S,{emit:k}){const s=S,C=g(w("form-department-id")),x=g(w("to-department-id")),_=g(w("user-ids")),I=g(w("month")),a=g(w("status")),i=g(w("is-important")),u=g(w("is-urgent")),b=g(w("is-target")),f=k,y=ge(),{employees:h}=me(y);function w(d){return{get:()=>s.modelValue[d]||"",set:e=>{f("update:modelValue",{...s.modelValue,[d]:e||void 0})}}}const V=g(()=>N(_.value));async function A(d){d&&await y.fetchEmployee(d)}async function B(){if(x.value){const d=y.companies.find(e=>e.departments.some(c=>c.id==x.value));await y.fetchEmployee(d.id)}}te(async()=>{var d,e;await y.fetchCompanies({with:"departments",ignore_permission:!0}),(d=s.modelValue)!=null&&d["company-id"]&&await A((e=s.modelValue)==null?void 0:e["company-id"])});function N(d){return Array.isArray(h.value)&&h.value.find(e=>e.id==d)||null}function P(d){_.value=(d==null?void 0:d.id)||""}function M(){_.value=""}return se(()=>x.value,B),(d,e)=>{var c,l;return r(),m("div",we,[t("div",Ce,[e[11]||(e[11]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Task List",-1)),t("div",_e,[S.listHasRearranged?(r(),m("div",Te,[e[10]||(e[10]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=F(n=>f("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=F(n=>f("clickPriorityDiscard"),["prevent"]))},"Discard")])):U("",!0),t("button",{onClick:e[2]||(e[2]=n=>f("clickAddTask")),class:"btn-1"},"Add Task")])]),t("div",Ve,[t("div",qe,[v(Y,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=n=>C.value=n),companies:((c=o(y))==null?void 0:c.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"}},{label:q(()=>e[12]||(e[12]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," From Department ",-1)])),_:1},8,["modelValue","companies"]),v(Y,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=n=>x.value=n),companies:((l=o(y))==null?void 0:l.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"}},{label:q(()=>e[13]||(e[13]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," To Department ",-1)])),_:1},8,["modelValue","companies"]),t("div",Ie,[v(be,{modelValue:V.value,onSelect:P,onRemove:M,options:o(h),multiple:!1,label:"name","label-prefix":"id",placeholder:"All Employees",class:"text-gray-600 w-full"},{option:q(({option:n})=>[v(le,{user:n,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),V.value?(r(),m("div",$e,[t("button",{onClick:F(M,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):U("",!0),e[14]||(e[14]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))]),t("div",Ue,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),L(t("select",{"onUpdate:modelValue":e[5]||(e[5]=n=>a.value=n),class:"input-1"},e[15]||(e[15]=[t("option",{value:""},"All Tasks",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[pe,a.value]])]),t("div",Se,[t("label",he,[L(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=n=>i.value=n)},null,512),[[H,i.value]]),e[17]||(e[17]=t("span",null,"Important",-1))]),t("label",Ae,[L(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=n=>u.value=n)},null,512),[[H,u.value]]),e[18]||(e[18]=t("span",null,"Urgent",-1))]),t("label",De,[L(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=n=>b.value=n)},null,512),[[H,b.value]]),e[19]||(e[19]=t("span",null,"Is Target",-1))])]),t("div",Le,[e[20]||(e[20]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),L(t("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=n=>I.value=n),type:"month",class:"input-1",placeholder:"All month"},null,512),[[ce,I.value]])])])])])}}},Be={class:"w-full bg-white rounded"},Pe=["rowspan"],Me={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(S,{emit:k}){const s=S,C=k,x=g(()=>s.tasks.reduce((a,i)=>(a.push(...i.users.filter(u=>!a.find(b=>b.id==u.id&&u.id))),a),[]).filter(a=>s.selectedUserId?a.id==s.selectedUserId:!0)),_=a=>s.tasks.filter(b=>b.users.some(f=>f.id===a)),I=g(()=>x.value.map(a=>{const i=_(a.id);return{...a,tasks:i}}));return(a,i)=>(r(),m("div",null,[t("table",Be,[t("tbody",null,[(r(!0),m(E,null,j(I.value,u=>(r(),m(E,{key:u.id},[(r(!0),m(E,null,j(u.tasks,(b,f)=>(r(),m("tr",{key:b.id},[f==0?(r(),m("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(u.tasks.length,1)},[v(le,{user:u,class:"sticky top-[80px]"},null,8,["user"])],8,Pe)):U("",!0),t("td",{class:z(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":f==0,"border-b":u.tasks.length-1===f}])},[v(ae,{task:b,class:"!border-0 my-0",index:f,onCommentButtonClick:i[0]||(i[0]=y=>C("commentButtonClick",a.item.id)),onEditClick:i[1]||(i[1]=y=>C("editClick",y)),onAddClick:i[2]||(i[2]=y=>C("addClick",y))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Re={class:"container mx-auto p-6 relative"},Ne={class:"mb-4"},Fe={class:"w-full flex justify-end gap-5 mb-1"},He={key:3},je={key:0,class:"text-center py-4 text-red-500"},ze={key:1},Oe={class:"flex items-stretched"},We={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},Ge=1,pt={__name:"TaskList",setup(S){const k=xe(),s=fe(),C=ye(),x=$(!1),_=$(null),I=$(!1),a=$(null),i=$(!1),u=ve({parentId:0,requirementId:0}),b=$(null),f=$([]),{handleItemsPriorityUpdate:y,saveTaskPriority:h,listHasRearranged:w}=ne(()=>k.taskListTree,0);te(async()=>{s.query.status||C.push({query:{...s.query,status:"not-completed"}}),await V()});async function V(){I.value=!!s.query["user-ids"];const c=await k.fetchTasks({...s.query},{newList:!0,loadingBeforeFetch:!0});f.value=c.query_log||[]}const A=c=>{i.value=!0,u.parentId=c},B=c=>{_.value=c,x.value=!0},N=()=>{x.value=!1,_.value=null};async function P(){a.value=null,i.value=!1,u.parentId=0,await V()}async function M(){i.value=!1,u.parentId=0,await V()}async function d(){h()&&await V()}se(()=>({...s.query}),async()=>{await V()});const e=g({get(){return{...s.query}},set(c){localStorage.removeItem("sub_task_opened_list"),C.push({query:{...c}})}});return(c,l)=>{var O,W,G,J,K,Q;const n=ke("RouterLink");return r(),m("div",Re,[a.value?(r(),R(X,{key:0},{default:q(()=>[v(ue,{taskId:a.value,onClose:l[0]||(l[0]=p=>a.value=null),onUpdated:P},null,8,["taskId"])]),_:1})):U("",!0),i.value?(r(),R(X,{key:1},{default:q(()=>[v(de,{parentTaskId:u.parentId,requirementId:u.requirementId,onClose:M,onTaskCreated:P},null,8,["parentTaskId","requirementId"])]),_:1})):U("",!0),v(Ee,{modelValue:e.value,"onUpdate:modelValue":l[1]||(l[1]=p=>e.value=p),onClickAddTask:A,onClickPrioritySave:d,onClickPriorityDiscard:l[2]||(l[2]=()=>o(w)?b.value.resetItems:null),"list-has-rearranged":o(w),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((W=(O=o(s))==null?void 0:O.query)==null?void 0:W["query-log"])=="true"?(r(!0),m(E,{key:2},j(f.value,(p,T)=>(r(),m("div",{key:T,class:"text-xs text-gray-500"},[t("div",Ne,Z(p.raw_query),1)]))),128)):U("",!0),t("div",Fe,[v(n,{class:z(["text-sm btn-3 py-0.5",((G=o(s).query)==null?void 0:G.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...o(s).query,view:"userwise"}}},{default:q(()=>l[9]||(l[9]=[ee(" User Wise List ")])),_:1,__:[9]},8,["class","to"]),v(n,{class:z(["text-sm btn-3 py-0.5",((J=o(s).query)==null?void 0:J.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((K=o(s))==null?void 0:K.query)||{}).filter(p=>{var T;return((T=o(s))==null?void 0:T.query[p])!=="userwise"}).reduce((p,T)=>({...p,[T]:o(s).query[T]}),{})}}},{default:q(()=>l[10]||(l[10]=[ee(" TaskWise List ")])),_:1,__:[10]},8,["class","to"])]),o(k).loading?(r(),m("div",He,[v(ie)])):(r(),m(E,{key:4},[o(k).error?(r(),m("div",je,Z(o(k).error),1)):o(k).tasks.length>0?(r(),m("div",ze,[((Q=o(s).query)==null?void 0:Q.view)=="userwise"?(r(),R(Me,{key:0,tasks:o(k).tasks,selectedUserId:o(s).query["user-ids"],onCommentButtonClick:l[3]||(l[3]=p=>B(p,c.task.id)),onEditClick:l[4]||(l[4]=p=>a.value=p),onAddClick:l[5]||(l[5]=p=>A(p))},null,8,["tasks","selectedUserId"])):(r(),R(re,{key:1,items:o(k).tasks,handle:"handle",onItemsUpdate:o(y),class:"space-y-4",ref_key:"draggableTaskList",ref:b},{item:q(({item:p,index:T})=>[t("div",Oe,[v(ae,{task:p,index:T,showDraggableHandle:!I.value,onCommentButtonClick:l[6]||(l[6]=D=>B(D,c.task.id)),onEditClick:l[7]||(l[7]=D=>a.value=D),onAddClick:l[8]||(l[8]=D=>A(D)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(r(),m("div",We," No tasks found. "))],64)),v(oe,{show:x.value,"commentable-id":_.value,"commentable-type":"task","user-id":Ge,"on-close":N,onSubmitted:o(k).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{pt as default};
