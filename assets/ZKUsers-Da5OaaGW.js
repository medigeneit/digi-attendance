import{s as V,m as N,r as c,x as A,c as k,g as B,o as v,a as e,t as f,w as I,h as b,v as g,a2 as K,p as E,C as Z,e as q,q as C,f as F,k as D,F as M,n as L,K as j}from"./index-D9IEX7DE.js";import{a as $,u as P}from"./zk-user-D6NWVx56.js";import{L as R}from"./LoaderView-BmbnyFUa.js";import{_ as O,a as T}from"./HeaderWithButtons-BlHeMAOQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G={key:0,class:"modal-bg"},H={class:"modal-card"},J={class:"text-xl font-bold mb-4 text-center"},Q={class:"relative"},W=["type"],X={class:"flex justify-end gap-4 mt-4"},Y={__name:"ZKUserModal",props:{editUser:Object,show:Boolean},emits:["close","saved"],setup(w,{emit:i}){const y=i,d=w,u=$(),o=V({zk_userid:"",name:"",password:"",role:0,cardno:""}),p=N(()=>!!d.editUser),r=c(!1);A(()=>d.editUser,n=>{n?(o.zk_userid=n.zk_userid||"",o.name=n.name||"",o.password=n.password||"",o.role=n.role||0,o.cardno=n.cardno||""):(o.zk_userid="",o.name="",o.password="",o.role=0,o.cardno="")},{immediate:!0});const x=async()=>{const n={...o};p.value?await u.updateUser(d.editUser.id,n):await u.createUser(n),y("saved"),y("close")};return(n,s)=>w.show?(v(),k("div",G,[e("div",H,[e("h2",J,f(p.value?"Edit User":"Add User"),1),e("form",{onSubmit:I(x,["prevent"]),class:"space-y-4"},[e("div",null,[s[7]||(s[7]=e("label",{class:"block"},"User ID",-1)),b(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>o.zk_userid=a),type:"text",class:"input-1",required:""},null,512),[[g,o.zk_userid]])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block"},"Name",-1)),b(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.name=a),type:"text",class:"input-1",required:""},null,512),[[g,o.name]])]),e("div",null,[s[9]||(s[9]=e("label",{class:"block"},"Password",-1)),e("div",Q,[b(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>o.password=a),type:r.value?"text":"password",class:"input-1"},null,8,W),[[K,o.password]]),e("span",{class:"absolute inset-y-0 right-3 flex items-center cursor-pointer",onClick:s[3]||(s[3]=a=>r.value=!r.value)},[e("i",{class:E(r.value?"fas fa-eye-slash":"fas fa-eye")},null,2)])])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block"},"Role",-1)),b(e("select",{"onUpdate:modelValue":s[4]||(s[4]=a=>o.role=a),class:"input-1"},s[10]||(s[10]=[e("option",{value:0},"User",-1),e("option",{value:14},"Admin",-1)]),512),[[Z,o.role]])]),e("div",null,[s[12]||(s[12]=e("label",{class:"block"},"Card No",-1)),b(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>o.cardno=a),type:"text",class:"input-1"},null,512),[[g,o.cardno]])]),e("div",X,[e("button",{type:"button",onClick:s[6]||(s[6]=a=>y("close")),class:"px-4 py-2 bg-gray-500 text-white rounded"}," Cancel "),s[13]||(s[13]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded"},"Save",-1))])],32)])])):B("",!0)}},ee={class:"my-container space-y-4"},se={key:1,class:"overflow-x-auto card-bg"},te={class:"min-w-full text-sm text-left text-gray-700"},oe={class:"bg-gray-200 uppercase text-xs text-gray-600 tracking-wider"},le={class:"p-3"},ae={class:"p-3"},ne=["value"],ie={class:"p-3"},de={class:"p-3"},re={class:"p-3 font-medium"},ue={class:"p-3 font-medium"},pe={class:"p-3"},me={class:"p-3 space-x-6"},ce=["onClick"],ve=["onClick"],xe={__name:"ZKUsers",setup(w){const i=$(),y=P(),d=c([]),u=c(!1),o=c(null),p=c(!1),r=c(null);q(()=>{i.fetchUsers(),y.fetchDevices()});function x(){o.value=null,u.value=!0}function n(m){o.value={...m},u.value=!0}function s(){u.value=!1}function a(){i.fetchUsers(),s()}function h(m){r.value=m,p.value=!0}async function S(){await i.deleteUser(r.value),r.value=null,p.value=!1,i.fetchUsers()}function z(m){m.target.checked?d.value=i.users.map(t=>t.id):d.value=[]}return(m,t)=>(v(),k(M,null,[e("div",ee,[C(O,{title:"ZK User Management",onAdd:x}),D(i).loading?(v(),F(R,{key:0})):(v(),k("div",se,[e("table",te,[e("thead",oe,[e("tr",null,[e("th",le,[e("input",{type:"checkbox",onChange:t[0]||(t[0]=l=>z(l))},null,32)]),t[3]||(t[3]=e("th",{class:"p-3"},"ID",-1)),t[4]||(t[4]=e("th",{class:"p-3"},"Device User ID",-1)),t[5]||(t[5]=e("th",{class:"p-3"},"Name (Software)",-1)),t[6]||(t[6]=e("th",{class:"p-3"},"Name (Device)",-1)),t[7]||(t[7]=e("th",{class:"p-3"},"Fingers",-1)),t[8]||(t[8]=e("th",{class:"p-3"},"Role",-1)),t[9]||(t[9]=e("th",{class:"p-3"},"Actions",-1))])]),e("tbody",null,[(v(!0),k(M,null,L(D(i).users,l=>{var _;return v(),k("tr",{key:l.id,class:"border-b hover:bg-gray-50 transition-colors duration-150"},[e("td",ae,[b(e("input",{type:"checkbox",value:l.id,"onUpdate:modelValue":t[1]||(t[1]=U=>d.value=U)},null,8,ne),[[j,d.value]])]),e("td",ie,f(l.zk_uid),1),e("td",de,f(l.zk_userid),1),e("td",re,f((_=l==null?void 0:l.user)==null?void 0:_.name),1),e("td",ue,f(l.name),1),e("td",pe,f(l.fingerprints_count),1),e("td",me,[e("button",{onClick:U=>n(l),class:"text-blue-600 hover:text-blue-800 font-semibold"},t[10]||(t[10]=[e("i",{class:"fas fa-edit"},null,-1)]),8,ce),e("button",{onClick:U=>h(l.id),class:"text-red-600 hover:text-red-800 font-semibold"},t[11]||(t[11]=[e("i",{class:"fas fa-trash"},null,-1)]),8,ve)])])}),128))])])]))]),C(Y,{show:u.value,editUser:o.value,onClose:s,onSaved:a},null,8,["show","editUser"]),C(T,{show:p.value,title:"Confirm Deletion",message:"Are you sure you want to delete this user?",onClose:t[2]||(t[2]=l=>p.value=!1),onConfirm:S},null,8,["show"])],64))}};export{xe as default};
