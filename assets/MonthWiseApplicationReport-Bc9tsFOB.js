import{_ as de,f as re,u as pe,r as h,q as E,x as C,c as i,o,a as s,j as ue,k as d,b as x,t as n,l as f,P as b,d as X,m as ce,v as _e,s as _,F as m,e as ve}from"./index-BY9ufWaD.js";import{u as me}from"./leave-application-Dh29JD5Q.js";import{_ as he}from"./EmployeeFilter-CGof1VAF.js";import{_ as ye}from"./FlexibleDatePicker-ChpImylI.js";import{L as xe}from"./LoaderView-CnJ5uceW.js";import"./company-BmaPp-gt.js";import"./department-BmrDR0L3.js";import"./EmployeeDropdownInput-DIL20DOP.js";import"./SelectDropdown-DxeIuPd1.js";import"./UserChip-dwONVQeD.js";import"./user-Be1fePfw.js";const fe={class:"px-3 space-y-4"},ge={class:"flex flex-wrap items-center gap-2"},be={class:"min-w-[200px]"},ke={class:"text-[11px] text-slate-500 -mt-0.5"},we={class:"hidden md:flex items-center gap-2 rounded-lg border bg-white p-1"},Se={class:"cols-chk"},Le={class:"cols-chk"},Me={class:"cols-chk"},Ae={class:"cols-chk"},Te={class:"cols-chk"},qe={class:"flex flex-wrap items-end gap-3 rounded-lg border bg-white p-3"},Oe={class:"flex items-center gap-2 ml-auto"},Re={class:"relative"},Ce={class:"flex items-center gap-1 text-[11px] text-slate-600"},Ve={class:"flex items-center gap-1 text-[11px] text-slate-600"},Ue={key:1,class:"p-2 rounded bg-red-50 text-red-700 text-[12px] border border-red-200"},$e={class:"w-full text-[12px] print:text-[11px] leading-tight"},Ee={key:0,span:"3",style:{width:"96px"}},Ne={key:1,span:"4",style:{width:"96px"}},Pe={key:2,span:"2",style:{width:"102px"}},je={key:3,span:"2",style:{width:"96px"}},ze={key:4,span:"1",style:{width:"96px"}},Be={class:"sticky top-0 z-20 bg-white/95 backdrop-blur"},De={class:"*:px-2.5 *:py-1.5 *:text-center *:border-b *:border-slate-200 text-slate-700"},Fe=["colspan"],Ie=["colspan"],We=["colspan"],He=["colspan"],Ye=["colspan"],Je={class:"*:px-2.5 *:py-1 *:text-center *:border-b *:border-slate-200"},Ze={key:4,class:"th-col th-manual",title:"Manual Adjustments"},Ke={class:"divide-y divide-slate-100"},Ge={class:"px-2.5 text-left sticky left-0 z-20 bg-white"},Qe={class:"px-2.5 sticky left-[34px] z-20 bg-white"},Xe={class:"flex items-center gap-2"},et={class:"font-medium text-slate-800 truncate max-w-[180px]"},tt={key:0,class:"text-[10px] text-slate-400"},lt={key:0,class:"text-[10px] text-slate-500 -mt-0.5 truncate max-w-[200px]"},st={class:"text-center whitespace-nowrap"},at=["title"],ot={class:"text-center whitespace-nowrap"},nt=["title"],it={class:"text-center"},dt={class:"text-center"},rt={class:"text-center"},pt={class:"text-center"},ut={class:"text-center"},ct={class:"text-center font-medium"},_t={class:"text-center"},vt={class:"text-center"},mt={class:"text-center"},ht={class:"text-center"},yt={key:4,class:"text-center"},xt={class:"bg-gradient-to-r from-slate-100 to-slate-50 *:px-2.5 *:py-1.5 font-semibold border-t sticky bottom-0 z-10"},ft={class:"text-slate-700"},gt={class:"text-center"},bt={class:"text-center"},kt={class:"text-center"},wt={class:"text-center"},St={class:"text-center"},Lt={class:"text-center"},Mt={class:"text-center"},At={class:"text-center"},Tt={class:"text-center"},qt={class:"text-center"},Ot={class:"text-center"},Rt={class:"text-center"},Ct={key:4,class:"text-center"},Vt={key:3,class:"text-center text-slate-500 py-8"},ee="monthly_application_cols_v2",Ut={__name:"MonthWiseApplicationReport",setup($t){const y=re(),N=pe(),te=me(),L=h(!1),q=h(null),P=h([]),V=h(""),g=h(y.query.date||new Date().toISOString().slice(0,7)),r=h({company_id:y.query.company_id||"",department_id:y.query.department_id||"all",line_type:y.query.line_type||"all",employee_id:y.query.employee_id||"all",line_type:y.query.line_type||"all"}),U=h(""),O=h(!0),$=h(!1),a=h({ot:!0,leave:!0,ex:!1,sl:!0,manual:!0});try{const l=JSON.parse(localStorage.getItem(ee)||"{}");Object.assign(a.value,l)}catch{}E(a,l=>localStorage.setItem(ee,JSON.stringify(l)),{deep:!0});const p=l=>Number.isFinite(+l)?+l:0,j=l=>{const e=Number(l)||0,t=Math.floor(e),c=Math.round((e-t)*60);return`${t}h ${String(c).padStart(2,"0")}m`},R=l=>{const e=Number(l)||0,t=Math.floor(e),c=Math.round((e-t)*60);return`${t}:${String(c).padStart(2,"0")}`},le=l=>!l||typeof l!="object"?{CL:0,ML:0,SL:0,WPL:0}:{CL:p(l.CL),ML:p(l.ML),SL:p(l.SL),WPL:p(l.WPL)},se=(l={})=>Object.values(l).some(e=>p(e)>0),ae=C(()=>(P.value||[]).map(l=>{var t,c,T,w,u,S,D,F,I,W,H,Y,J,Z,K,G,Q;const e=le((t=l==null?void 0:l.leave)==null?void 0:t.by_code);return{...l,_leaveBy:e,_cl:p(e.CL),_ml:p(e.ML),_sl:p(e.SL),_wpl:p(e.WPL),_leaveTotal:p((c=l==null?void 0:l.leave)==null?void 0:c.total_days),_otReq:p((T=l==null?void 0:l.overtime)==null?void 0:T.requested_hours),_otAppr:p((w=l==null?void 0:l.overtime)==null?void 0:w.approved_hours),_otApps:p((u=l==null?void 0:l.overtime)==null?void 0:u.count),_exOff:p((D=(S=l==null?void 0:l.exchanges)==null?void 0:S.offday)==null?void 0:D.total),_exShift:p((I=(F=l==null?void 0:l.exchanges)==null?void 0:F.shift)==null?void 0:I.total),_slTotal:p((H=(W=l==null?void 0:l.short_leave)==null?void 0:W.totals)==null?void 0:H.count),_slMinutesApproved:p((J=(Y=l==null?void 0:l.short_leave)==null?void 0:Y.totals)==null?void 0:J.approved_minutes),_slMinutesPending:p((K=(Z=l==null?void 0:l.short_leave)==null?void 0:Z.totals)==null?void 0:K.pending_minutes),_slMinutes:p((Q=(G=l==null?void 0:l.short_leave)==null?void 0:G.totals)==null?void 0:Q.approved_minutes),_manual:p(l==null?void 0:l.manual_attendance)}})),M=C(()=>{const l=(U.value||"").toLowerCase().trim();let e=ae.value;return l&&(e=e.filter(t=>String(t.user_name||"").toLowerCase().includes(l)||String(t.employee_id||"").toLowerCase().includes(l)||String(t.designation||"").toLowerCase().includes(l))),$.value&&(e=e.filter(t=>{const c={_cl:t._cl,_ml:t._ml,_sl:t._sl,_leaveTotal:t._leaveTotal,_otReq:t._otReq,_otAppr:t._otAppr,_otApps:t._otApps,_exOff:t._exOff,_exShift:t._exShift,_slTotal:t._slTotal,_slMinutes:t._slMinutes,_manual:t._manual};return!se(c)})),e}),v=C(()=>{const l={cl:0,ml:0,sl:0,wpl:0,leaveTotal:0,otReq:0,otAppr:0,otApps:0,exOff:0,exShift:0,slTotal:0,slMinutes:0,manual:0};for(const e of M.value)l.cl+=e._cl,l.ml+=e._ml,l.sl+=e._sl,l.wpl+=e._wpl,l.leaveTotal+=e._leaveTotal,l.otReq+=e._otReq,l.otAppr+=e._otAppr,l.otApps+=e._otApps,l.exOff+=e._exOff,l.exShift+=e._exShift,l.slTotal+=e._slTotal,l.slMinutes+=e._slMinutes,l.manual+=e._manual;return l}),A=l=>l==="ot"?a.value.ot?3:0:l==="leave"?a.value.leave?5:0:l==="ex"?a.value.ex?2:0:l==="sl"?a.value.sl?2:0:l==="manual"&&a.value.manual?1:0,oe=l=>String(l??"").padStart(2,"0"),k=h((l=>{const e=new Date;if(!l)return{year:e.getFullYear(),month:e.getMonth()+1};const[t,c]=String(l).split("-");return!t||!c?{year:e.getFullYear(),month:e.getMonth()+1}:{year:Number(t)||e.getFullYear(),month:Number(c)||e.getMonth()+1}})(g.value)),z=C(()=>{var l,e;return!((l=k.value)!=null&&l.year)||!((e=k.value)!=null&&e.month)?"":`${k.value.year}-${oe(k.value.month)}`}),B=async()=>{var l,e;L.value=!0,q.value=null;try{const t=await te.getMonthlyApplicationSummary({month:g.value,companyId:r.value.company_id||null,departmentId:!r.value.department_id||r.value.department_id==="all"?null:r.value.department_id,employee_id:r.value.employee_id,line_type:r.value.line_type,includeEmpty:!0}),c=Array.isArray(t==null?void 0:t.results)?t.results:Array.isArray(t==null?void 0:t.data)?t.data:Array.isArray(t)?t:[];P.value=c,V.value=(t==null?void 0:t.month)||g.value}catch(t){console.error(t),q.value=((e=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:e.message)||(t==null?void 0:t.message)||"Failed to load monthly application summary."}finally{L.value=!1}};E(z,l=>{l&&(g.value=l,N.replace({query:{...y.query,date:l}}),B())},{immediate:!0}),E(()=>[r.value.company_id,r.value.department_id,r.value.employee_id,r.value.line_type],()=>{N.replace({query:{...y.query,company_id:r.value.company_id||"",department_id:r.value.department_id||"all",line_type:r.value.line_type||"all",employee_id:r.value.employee_id||"all",date:z.value||""}}),B()});const ne=()=>{const l=["#","Employee",...a.value.ot?["OT Req(h)","OT Appr(h)","OT Apps"]:[],...a.value.leave?["CL","ML","SL","Leave Total"]:[],...a.value.ex?["Offday Exch","Shift Exch"]:[],...a.value.sl?["SL Total","SL Minutes (Approved)"]:[],...a.value.manual?["Manual"]:[]],e=M.value.map((u,S)=>[S+1,`${u.user_name}${u.employee_id?` (#${u.employee_id})`:""}`,...a.value.ot?[u._otReq,u._otAppr,u._otApps]:[],...a.value.leave?[u._cl,u._ml,u._sl,u._leaveTotal]:[],...a.value.ex?[u._exOff,u._exShift]:[],...a.value.sl?[u._slTotal,u._slMinutes]:[],...a.value.manual?[u._manual]:[]]),t=[l,...e].map(u=>u.map(S=>`"${String(S).replace(/"/g,'""')}"`).join(",")).join(`
`),c=new Blob([t],{type:"text/csv;charset=utf-8;"}),T=URL.createObjectURL(c),w=document.createElement("a");w.href=T,w.download=`monthly-application-${V.value||g.value}.csv`,w.click(),URL.revokeObjectURL(T)},ie=()=>window.print();return(l,e)=>(o(),i("div",fe,[s("div",ge,[s("div",be,[e[14]||(e[14]=s("h1",{class:"text-base font-semibold text-slate-800 leading-tight"},"Monthly Application Summary",-1)),s("p",ke,[e[13]||(e[13]=x("Month: ")),s("b",null,n(V.value||g.value),1)])]),e[21]||(e[21]=s("div",{class:"flex-1"},null,-1)),s("div",we,[e[20]||(e[20]=s("span",{class:"px-2 py-0.5 text-[11px] text-slate-500"},"Cols:",-1)),s("label",Se,[f(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=t=>a.value.ot=t)},null,512),[[b,a.value.ot]]),e[15]||(e[15]=x(" OT"))]),s("label",Le,[f(s("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>a.value.leave=t)},null,512),[[b,a.value.leave]]),e[16]||(e[16]=x(" Leave"))]),s("label",Me,[f(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=t=>a.value.ex=t)},null,512),[[b,a.value.ex]]),e[17]||(e[17]=x(" Exch"))]),s("label",Ae,[f(s("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=t=>a.value.sl=t)},null,512),[[b,a.value.sl]]),e[18]||(e[18]=x(" Short"))]),s("label",Te,[f(s("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>a.value.manual=t)},null,512),[[b,a.value.manual]]),e[19]||(e[19]=x(" Manual"))])]),s("button",{class:"btn-secondary",onClick:ne},"Export CSV"),s("button",{class:"btn-secondary",onClick:ie},"Print")]),s("div",qe,[X(he,{company_id:r.value.company_id,"onUpdate:company_id":e[6]||(e[6]=t=>r.value.company_id=t),department_id:r.value.department_id,"onUpdate:department_id":e[7]||(e[7]=t=>r.value.department_id=t),employee_id:r.value.employee_id,"onUpdate:employee_id":e[8]||(e[8]=t=>r.value.employee_id=t),line_type:r.value.line_type,"onUpdate:line_type":e[9]||(e[9]=t=>r.value.line_type=t),"with-type":!0,"initial-value":l.$route.query},{default:ce(()=>[X(ye,{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=t=>k.value=t),"show-year":!1,"show-month":!0,"show-date":!1,class:"h-8",label:"Month"},null,8,["modelValue"])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),s("div",Oe,[s("div",Re,[f(s("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>U.value=t),type:"search",placeholder:"Search employee / ID / designation",class:"input-1 w-64 pl-8 h-8"},null,512),[[_e,U.value]]),e[22]||(e[22]=s("span",{class:"absolute left-2 top-1.5 text-slate-400 select-none"},"ðŸ”Ž",-1))]),s("label",Ce,[f(s("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=t=>O.value=t)},null,512),[[b,O.value]]),e[23]||(e[23]=x(" Compact "))]),s("label",Ve,[f(s("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=t=>$.value=t)},null,512),[[b,$.value]]),e[24]||(e[24]=x(" Zero-only "))])])]),L.value?(o(),ue(xe,{key:0})):d("",!0),q.value?(o(),i("div",Ue,n(q.value),1)):d("",!0),L.value?d("",!0):(o(),i("div",{key:2,class:_(["table-wrap group bg-white border rounded-xl shadow-sm overflow-auto print:overflow-visible",O.value?"max-h-[74vh]":"max-h-[80vh]"])},[s("table",$e,[s("colgroup",null,[e[25]||(e[25]=s("col",{style:{width:"34px"}},null,-1)),e[26]||(e[26]=s("col",{style:{width:"220px"}},null,-1)),a.value.ot?(o(),i("col",Ee)):d("",!0),a.value.leave?(o(),i("col",Ne)):d("",!0),a.value.ex?(o(),i("col",Pe)):d("",!0),a.value.sl?(o(),i("col",je)):d("",!0),a.value.manual?(o(),i("col",ze)):d("",!0)]),s("thead",Be,[s("tr",De,[e[27]||(e[27]=s("th",{rowspan:"2",class:"text-left sticky left-0 z-30 bg-white/95"},"#",-1)),e[28]||(e[28]=s("th",{rowspan:"2",class:"text-left sticky left-[34px] z-30 bg-white/95"},"Employee",-1)),a.value.ot?(o(),i("th",{key:0,colspan:A("ot"),class:"th-group th-ot"},"Overtime",8,Fe)):d("",!0),a.value.leave?(o(),i("th",{key:1,colspan:A("leave"),class:"th-group th-leave"},"Leave Day",8,Ie)):d("",!0),a.value.ex?(o(),i("th",{key:2,colspan:A("ex"),class:"th-group th-ex"},"Shift Exchange",8,We)):d("",!0),a.value.sl?(o(),i("th",{key:3,colspan:A("sl"),class:"th-group th-sl"},"Short Leave",8,He)):d("",!0),a.value.manual?(o(),i("th",{key:4,colspan:A("manual"),class:"th-group th-manual"},"Manual",8,Ye)):d("",!0)]),s("tr",Je,[a.value.ot?(o(),i(m,{key:0},[e[29]||(e[29]=s("th",{class:"th-col th-ot",title:"Requested Hours"},"Req",-1)),e[30]||(e[30]=s("th",{class:"th-col th-ot",title:"Approved Hours"},"Appr",-1)),e[31]||(e[31]=s("th",{class:"th-col th-ot",title:"Applications Count"},"Apps",-1))],64)):d("",!0),a.value.leave?(o(),i(m,{key:1},[e[32]||(e[32]=s("th",{class:"th-col th-leave",title:"Casual Leave"},"CL",-1)),e[33]||(e[33]=s("th",{class:"th-col th-leave",title:"Medical Leave"},"ML",-1)),e[34]||(e[34]=s("th",{class:"th-col th-leave",title:"Sick Leave"},"SL",-1)),e[35]||(e[35]=s("th",{class:"th-col th-leave",title:"Sick Leave"},"WPL",-1)),e[36]||(e[36]=s("th",{class:"th-col th-leave",title:"Total Leave Days"},"Total",-1))],64)):d("",!0),a.value.ex?(o(),i(m,{key:2},[e[37]||(e[37]=s("th",{class:"th-col th-ex",title:"Offday Exchange"},"Offday",-1)),e[38]||(e[38]=s("th",{class:"th-col th-ex",title:"Shift Exchange"},"Shift",-1))],64)):d("",!0),a.value.sl?(o(),i(m,{key:3},[e[39]||(e[39]=s("th",{class:"th-col th-sl",title:"Short Leave Applications"},"Total",-1)),e[40]||(e[40]=s("th",{class:"th-col th-sl",title:"Short Leave Minutes"},"Minutes",-1))],64)):d("",!0),a.value.manual?(o(),i("th",Ze,"Count")):d("",!0)])]),s("tbody",Ke,[(o(!0),i(m,null,ve(M.value,(t,c)=>(o(),i("tr",{key:t.user_id||c,class:_(["hover:bg-gray-200",O.value?"h-9":"h-11"])},[s("td",Ge,n(c+1),1),s("td",Qe,[s("div",Xe,[s("span",et,n(t.user_name),1),t.employee_id?(o(),i("span",tt,"#"+n(t.employee_id),1)):d("",!0)]),t.designation?(o(),i("div",lt,n(t.designation),1)):d("",!0)]),a.value.ot?(o(),i(m,{key:0},[s("td",st,[s("span",{class:_(t._otReq>0?"badge":"muted"),title:j(t._otReq)},n(R(t._otReq)),11,at)]),s("td",ot,[s("span",{class:_(t._otAppr>0?"badge":"muted"),title:j(t._otAppr)},n(R(t._otAppr)),11,nt)]),s("td",it,[s("span",{class:_(t._otApps>0?"badge":"muted")},n(t._otApps),3)])],64)):d("",!0),a.value.leave?(o(),i(m,{key:1},[s("td",dt,[s("span",{class:_(t._cl>0?"badge-soft-emerald":"muted")},n(t._cl),3)]),s("td",rt,[s("span",{class:_(t._ml>0?"badge-soft-emerald":"muted")},n(t._ml),3)]),s("td",pt,[s("span",{class:_(t._sl>0?"badge-soft-emerald":"muted")},n(t._sl),3)]),s("td",ut,[s("span",{class:_(t._sl>0?"badge-soft-emerald":"muted")},n(t._wpl),3)]),s("td",ct,[s("span",{class:_(t._leaveTotal>0?"badge-strong":"muted")},n(t._leaveTotal),3)])],64)):d("",!0),a.value.ex?(o(),i(m,{key:2},[s("td",_t,[s("span",{class:_(t._exOff>0?"badge-soft-indigo":"muted")},n(t._exOff),3)]),s("td",vt,[s("span",{class:_(t._exShift>0?"badge-soft-indigo":"muted")},n(t._exShift),3)])],64)):d("",!0),a.value.sl?(o(),i(m,{key:3},[s("td",mt,[s("span",{class:_(t._slTotal>0?"badge-soft-amber":"muted")},n(t._slTotal),3)]),s("td",ht,[s("span",{class:_(t._slMinutes>0?"badge-soft-amber":"muted")},n(t._slMinutes),3)])],64)):d("",!0),a.value.manual?(o(),i("td",yt,[s("span",{class:_(t._manual>0?"badge-soft-slate":"muted")},n(t._manual),3)])):d("",!0)],2))),128)),s("tr",xt,[e[41]||(e[41]=s("td",null,null,-1)),s("td",ft,"Totals ("+n(M.value.length)+" emp)",1),a.value.ot?(o(),i(m,{key:0},[s("td",gt,n(R(v.value.otReq)),1),s("td",bt,n(R(v.value.otAppr)),1),s("td",kt,n(v.value.otApps),1)],64)):d("",!0),a.value.leave?(o(),i(m,{key:1},[s("td",wt,n(v.value.cl),1),s("td",St,n(v.value.ml),1),s("td",Lt,n(v.value.sl),1),s("td",Mt,n(v.value.sl),1),s("td",At,n(v.value.leaveTotal),1)],64)):d("",!0),a.value.ex?(o(),i(m,{key:2},[s("td",Tt,n(v.value.exOff),1),s("td",qt,n(v.value.exShift),1)],64)):d("",!0),a.value.sl?(o(),i(m,{key:3},[s("td",Ot,n(v.value.slTotal),1),s("td",Rt,n(v.value.slMinutes),1)],64)):d("",!0),a.value.manual?(o(),i("td",Ct,n(v.value.manual),1)):d("",!0)])])]),e[42]||(e[42]=s("div",{class:"scroll-shadow-left"},null,-1)),e[43]||(e[43]=s("div",{class:"scroll-shadow-right"},null,-1))],2)),!L.value&&M.value.length===0?(o(),i("div",Vt," No records for "+n(g.value)+". ",1)):d("",!0)]))}},Jt=de(Ut,[["__scopeId","data-v-3ad9abe6"]]);export{Jt as default};
