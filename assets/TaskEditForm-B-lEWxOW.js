import{d as j,r as b,e as O,A as Y,n as $,c as l,o as r,a as t,f as z,g as u,h as y,v as C,t as p,F as f,j as U,p as B,C as M,x,k as _,w as N}from"./index-CUf-WQ1R.js";import{a as E}from"./datetime-q3Sn87-f.js";import{u as G}from"./company-CJWvx3ii.js";import{u as H}from"./useTaskStore-DdP1zF4D.js";import{S as J}from"./SectionLoading-BVB_9WPt.js";const K={class:"px-4 max-h-[90vh] overflow-auto"},P={class:"sticky top-0 pt-4 -mx-4 px-4 border-b bg-white rounded-t-md"},Q={key:0,class:"text-center py-4 text-gray-500"},W={class:"mb-4"},X={key:0,class:"mb-4"},Z={class:"mb-4"},D={class:"block text-gray-600 text-sm mb-1 font-medium"},ee=["label"],te=["value"],se={class:"mb-4"},oe={class:"block text-gray-600 text-sm mb-1 font-medium"},re=["label"],le=["value"],ne={class:"mb-4"},ae={class:"sticky bottom-0 bg-white py-4 border-t"},ie={key:0,class:"mb-4 text-red-500 font-medium"},de={key:1,class:"mb-4"},ue={class:"flex items-center gap-4 justify-between"},me=["disabled"],pe={key:0,class:"text-red-500 text-sm"},ge={__name:"TaskEditForm",props:{taskId:{type:[String,Number],required:!0}},emits:["updated","cancel"],setup(I,{emit:A}){const T=I,S=A,c=H(),L=j(),k=G(),i=b(),a=b(!1),h=b([]),w=b(""),n=b({});O(async()=>{var s;a.value=!0,i.value=(s=await c.fetchTask(T.taskId,{},{fetchOnly:!0,loadingBeforeFetch:!1}))==null?void 0:s.task,await k.fetchCompanies({with:"departments",ignore_permission:!0}),q(i.value),h.value=i.value.users,a.value=!1}),Y(()=>i.value,s=>{q(s),h.value=s.users});function q(s){var e;n.value={title:s.title,description:s.description,requirement_id:s.requirement_id,from_department_id:s.from_department_id,to_department_id:s.to_department_id,...((e=L.user)==null?void 0:e.role)!=="employee"?{is_important:s.is_important,is_urgent:s.is_urgent,is_target:s.is_target,started_at:E(s.started_at),deadline:E(s.deadline)}:{}}}const R=async()=>{var s,e,v;a.value=!0;try{const m={...n.value,user_ids:((s=h.value)==null?void 0:s.map(g=>Number(g.id)))||[]};await c.updateTask(T.taskId,m,{loadingBeforeFetch:!1}),S("updated")}catch(m){w.value=((v=(e=m.response)==null?void 0:e.data)==null?void 0:v.message)||"An error occurred while updating the task."}finally{a.value=!1}};return(s,e)=>{var m,g,F,V;const v=$("RequiredIcon");return r(),l("div",K,[t("div",P,[e[5]||(e[5]=t("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Edit Task",-1)),a.value?(r(),l("div",Q,"Loading form...")):u("",!0)]),t("form",{onSubmit:N(R,["prevent"]),class:"my-4"},[t("div",W,[e[6]||(e[6]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task Title",-1)),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.title=o),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,n.value.title]])]),(m=i.value)!=null&&m.requirement?(r(),l("div",X,[e[7]||(e[7]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Requirement",-1)),t("div",null,[t("p",null,p((F=(g=i.value)==null?void 0:g.requirement)==null?void 0:F.title),1)])])):u("",!0),((V=i.value)==null?void 0:V.parent_id)===0?(r(),l(f,{key:1},[t("div",Z,[t("label",D,[e[8]||(e[8]=U(" From Department ")),B(v)]),y(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.from_department_id=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[9]||(e[9]=t("option",{value:""},"--select department--",-1)),(r(!0),l(f,null,x(_(k).companies,o=>(r(),l("optgroup",{key:o.id,label:o.name},[(r(!0),l(f,null,x(o.departments,d=>(r(),l("option",{value:d.id,key:d.id},p(d.name),9,te))),128))],8,ee))),128))],512),[[M,n.value.from_department_id]])]),t("div",se,[t("label",oe,[e[10]||(e[10]=U(" To Department ")),B(v)]),y(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.to_department_id=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[11]||(e[11]=t("option",{value:""},"--select department--",-1)),(r(!0),l(f,null,x(_(k).companies,o=>(r(),l("optgroup",{key:o.id,label:o.name},[(r(!0),l(f,null,x(o.departments,d=>(r(),l("option",{value:d.id,key:d.id},p(d.name),9,le))),128))],8,re))),128))],512),[[M,n.value.to_department_id]])])],64)):u("",!0),t("div",ne,[e[12]||(e[12]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Description",-1)),y(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.description=o),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[C,n.value.description]])]),t("div",ae,[_(c).error?(r(),l("div",ie,p(_(c).error),1)):u("",!0),_(c).error?(r(),l("hr",de)):u("",!0),t("div",ue,[t("button",{type:"button",onClick:e[4]||(e[4]=N(o=>S("close"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),t("button",{disabled:a.value,type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-semibold px-5 py-2 rounded transition"},p(a.value?"Updating...":"Update Task"),9,me),w.value?(r(),l("div",pe,p(w.value),1)):u("",!0)])])],32),a.value?(r(),z(J,{key:0})):u("",!0)])}}};export{ge as _};
