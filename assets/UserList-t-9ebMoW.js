import{r as _,m as H,z as w,s as j,c as r,g as z,o as c,a as e,j as P,t as f,k as b,h as k,B as U,F as q,q as A,v as R,u as oe,b as se,e as ae,n as le,p as S,i as C,l as ne,x as ie,X as de}from"./index-D1uv_qEI.js";import{L as re}from"./LoaderView-Crq6wuxx.js";import{u as W}from"./shift-BIHWvNJ7.js";import{d as F}from"./dayjs.min-Cbbdfn5l.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as pe}from"./MultiselectDropdown-J3l7-YLj.js";import{_ as ue}from"./UserChip-GYhF_7NS.js";import{u as fe}from"./company-CvDY86cR.js";import{u as me}from"./department-CkoZSvei.js";import{u as ye}from"./user-BNCf19gd.js";const ve={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},_e={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},be={class:"text-lg font-semibold mb-4"},xe={class:"mb-4"},he=["value"],ge={class:"mb-4"},Se={class:"mb-4"},ke={class:"flex justify-end gap-3 mt-4"},we={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(D,{emit:M}){const E=M,i=D,l=_({shift_id:"",employee_id:i.employee.id,start_date:"",end_date:""}),y=H(()=>{const u=Object.keys(i.shifts)[0];return i.shifts[u]||[]});w(()=>i.employee,u=>{l.value.employee_id=(u==null?void 0:u.id)||0},{immediate:!0,deep:!0}),w(()=>i.isOpen,u=>{var n;u&&(i.hasShift?(l.value.shift_id=i.hasShift.shift_id||"",l.value.start_date=i.hasShift.start_date?F(i.hasShift.start_date).format("YYYY-MM-DD"):"",l.value.end_date=i.hasShift.end_date?F(i.hasShift.end_date).format("YYYY-MM-DD"):"",l.value.employee_id=((n=i.employee)==null?void 0:n.id)||""):(l.value.shift_id="",l.value.start_date="",l.value.end_date=""))},{immediate:!0});const m=()=>{E("close",!1)},v=W(),{message:x}=j(v),h=async()=>{if(!l.value.shift_id||!l.value.start_date||!l.value.employee_id){alert("All fields are required!");return}try{const u={...l.value},n=await v.shiftAssign(u);console.log("Shift assigned successfully:",n),alert(i.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),m()}catch(u){console.error("Failed to assign shift:",u),alert("Failed to assign shift.")}};return(u,n)=>D.isOpen?(c(),r("div",ve,[e("div",_e,[e("h2",be,f(i.hasShift?"Update Shift for":"Assign Shift to")+" "+f(D.employee.name),1),P(" "+f(b(x))+" ",1),e("div",xe,[n[4]||(n[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),k(e("select",{"onUpdate:modelValue":n[0]||(n[0]=d=>l.value.shift_id=d),class:"w-full p-2 border rounded"},[n[3]||(n[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(c(!0),r(q,null,A(y.value,d=>(c(),r("option",{key:d==null?void 0:d.id,value:d==null?void 0:d.id},f(d==null?void 0:d.name),9,he))),128))],512),[[U,l.value.shift_id]])]),e("div",ge,[n[5]||(n[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),k(e("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=d=>l.value.start_date=d),class:"w-full border rounded p-2"},null,512),[[R,l.value.start_date]])]),e("div",Se,[n[6]||(n[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),k(e("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=d=>l.value.end_date=d),class:"w-full border rounded p-2"},null,512),[[R,l.value.end_date]])]),e("div",ke,[e("button",{onClick:m,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:h,class:"px-4 py-2 bg-green-600 text-white rounded"},f(i.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:m,class:"absolute top-2 right-2 text-red-500 text-xl"},n[7]||(n[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):z("",!0)}},Ce=ce(we,[["__scopeId","data-v-c3e70801"]]),Ue={class:"space-y-2 px-4"},qe={class:"flex items-center justify-between gap-2"},Ae={class:"flex gap-4"},De={class:"flex flex-wrap items-center gap-4"},Me=["value"],je=["value"],Ee={key:0,class:"text-center py-4"},Le={key:1,class:"space-y-4"},$e={class:"title-md"},Ve={class:"overflow-x-auto"},Te={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},Ne={class:"border border-gray-300 px-2"},Oe=["innerHTML"],Be=["innerHTML"],Ye={class:"border border-gray-300 px-2"},Ie={class:"border border-gray-300 px-2"},Re={class:"border border-gray-300 px-2"},Fe={class:"border border-gray-300 px-2"},He={class:"border border-gray-300 px-2 py-3"},ze={class:"flex justify-center items-center gap-4"},Pe={class:"text-sm text-gray-700"},We={key:0,class:"text-green-600"},Je={key:1,class:"text-red-500 italic"},Ke=["onClick"],Xe={key:0},Ge={key:1},Qe={key:0},Ze={class:"border border-gray-300 px-2"},et={class:"border border-gray-300 px-2"},tt={class:"border border-gray-300 px-2"},ot={key:0,class:"text-green-500"},st={key:1,class:"text-red-500"},at={class:"border border-gray-300 px-2"},lt={class:"flex gap-2"},_t={__name:"UserList",setup(D){const M=W(),{shifts:E}=j(M),i=oe(),l=se(),y=ye(),m=_(l.query.company||"all"),v=_(l.query.department||"all"),x=_(l.query.line_type||"all"),h=_(l.query.status||"active"),u=_(""),n=_(""),d=_(!1),L=me(),$=fe(),{companies:J}=j($),{departments:K}=j(L);ae(()=>{y.fetchUsers(),$.fetchCompanies(),V(m.value)});const X=()=>{i.go(-1)};w(m,a=>{V(a),i.push({query:{...l.query,company:a}})}),w(v,a=>{i.push({query:{...l.query,department:a}})}),w(x,a=>{i.push({query:{...l.query,line_type:a}})}),w(h,a=>{i.push({query:{...l.query,status:a}})});const V=async a=>{await L.fetchDepartments(a)},G=H(()=>{var g;let a=[...(y==null?void 0:y.users)||[]];if(m.value!=="all"&&(a=a.filter(t=>{var p;return((p=t==null?void 0:t.company)==null?void 0:p.id)==m.value})),v.value!=="all"&&(a=a.filter(t=>{var p;return((p=t==null?void 0:t.department)==null?void 0:p.id)==v.value})),x.value!=="all"&&(a=a.filter(t=>(t==null?void 0:t.type)==x.value)),h.value){const t=h.value==="active"?1:0;a=a.filter(p=>(p==null?void 0:p.is_active)==t)}(g=u.value)!=null&&g.id&&(a=a.filter(t=>(t==null?void 0:t.id)==u.value.id));const o={};return a.forEach(t=>{var s;const p=((s=t==null?void 0:t.company)==null?void 0:s.name)||"Unknown Company";o[p]||(o[p]=[]),o[p].push(t)}),o}),T=_("");function Q(a){T.value=a.id,n.value=a,(a==null?void 0:a.company_id)!==void 0&&(M.fetchShifts(a==null?void 0:a.company_id),d.value=!d.value)}function Z(){d.value=!1}async function ee(){await y.fetchUsersExcelExport({data:{company_id:m.value,department_id:v.value,line_type:x.value,status:h.value}})}const N=a=>{if(a){const o=a.split(" "),g=o.slice(0,2).join(" "),t=o.length>2?`<br>${o.slice(2).join(" ")}`:"";return g+t}return""};return(a,o)=>{const g=le("RouterLink");return c(),r("div",Ue,[e("div",qe,[e("button",{class:"btn-3",onClick:X},o[5]||(o[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),o[8]||(o[8]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),e("div",Ae,[S(g,{to:{name:"UserAdd",query:{company:b(l).query.company}},class:"btn-2"},{default:C(()=>o[6]||(o[6]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[6]},8,["to"]),e("button",{type:"button",onClick:ee,class:"btn-3"},o[7]||(o[7]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),P("Excel ")]))])]),e("div",De,[e("div",null,[k(e("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>m.value=t),class:"input-1"},[o[9]||(o[9]=e("option",{value:"all",selected:""},"All Company",-1)),(c(!0),r(q,null,A(b(J),(t,p)=>(c(),r("option",{key:p,value:t.id},f(t==null?void 0:t.name),9,Me))),128))],512),[[U,m.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>v.value=t),class:"input-1"},[o[10]||(o[10]=e("option",{value:"all",selected:""},"All Department",-1)),(c(!0),r(q,null,A(b(K),(t,p)=>(c(),r("option",{key:p,value:t.id},f(t==null?void 0:t.name),9,je))),128))],512),[[U,v.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>x.value=t),class:"input-1"},o[11]||(o[11]=[ne('<option value="all">All Category</option><option value="executive">Executive</option><option value="support_staff">Support Staff</option><option value="doctor">Doctor</option><option value="academy_body">Academy Body</option>',5)]),512),[[U,x.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":o[3]||(o[3]=t=>h.value=t),class:"input-1"},o[12]||(o[12]=[e("option",{value:"active"},"Active",-1),e("option",{value:"in_active"},"In Active",-1)]),512),[[U,h.value]])]),S(pe,{modelValue:u.value,"onUpdate:modelValue":o[4]||(o[4]=t=>u.value=t),options:b(y).users,multiple:!1,label:"name","label-prefix":"employee_id",class:"w-1/3",placeholder:"Select user"},{option:C(({option:t})=>[S(ue,{user:t,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"])]),b(y).isLoading?(c(),r("div",Ee,[S(re)])):(c(),r("div",Le,[(c(!0),r(q,null,A(G.value,(t,p)=>(c(),r("div",{key:p},[e("h2",$e,f(p)+" ("+f(t.length)+")",1),e("div",Ve,[e("table",Te,[o[17]||(o[17]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Finger ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Employee ID"),e("th",{class:"border border-gray-300 px-2 text-left"},"Joining Date"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(c(!0),r(q,null,A(t,(s,te)=>{var O,B,Y,I;return c(),r("tr",{key:s.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",Ne,f(te+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:N(s==null?void 0:s.name)},null,8,Oe),e("td",{class:"border border-gray-300 px-2",innerHTML:N((O=s==null?void 0:s.designation)==null?void 0:O.title)},null,8,Be),e("td",Ye,f(s==null?void 0:s.device_user_id),1),e("td",Ie,f(s==null?void 0:s.employee_id),1),e("td",Re,f(s.joining_date),1),e("td",Fe,f(s.role),1),e("td",He,[e("div",ze,[e("div",Pe,[(Y=(B=s.current_shift)==null?void 0:B.shift)!=null&&Y.name?(c(),r("span",We,f((I=s.current_shift.shift)==null?void 0:I.name),1)):(c(),r("span",Je,"Not Assigned"))]),e("button",{type:"button",onClick:nt=>Q(s),class:ie(["px-3 py-1 rounded text-white text-xs transition-all duration-150",s!=null&&s.current_shift?"btn-1":"btn-2"])},[s!=null&&s.current_shift?(c(),r("span",Xe,o[13]||(o[13]=[e("i",{class:"far fa-repeat-alt text-yellow-500 hover:text-yellow-600"},null,-1)]))):(c(),r("span",Ge,o[14]||(o[14]=[e("i",{class:"far fa-plus"},null,-1)])))],10,Ke)]),S(de,{name:"fade"},{default:C(()=>[T.value===s.id&&d.value?(c(),r("div",Qe,[S(Ce,{isOpen:d.value,shifts:b(E),hasShift:s==null?void 0:s.current_shift,employee:{id:n.value.id,name:n.value.name},onClose:Z},null,8,["isOpen","shifts","hasShift","employee"])])):z("",!0)]),_:2},1024)]),e("td",Ze,f(s.phone),1),e("td",et,f(s.email||"নেই"),1),e("td",tt,[s.is_active?(c(),r("span",ot,"Active")):(c(),r("span",st,"Inactive"))]),e("td",at,[e("div",lt,[S(g,{to:{name:"UserShow",params:{id:s.id},query:{company:b(l).query.company}},class:"btn-icon"},{default:C(()=>o[15]||(o[15]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[15]},1032,["to"]),S(g,{to:{name:"UserEdit",params:{id:s.id},query:{company:b(l).query.company}},class:"btn-icon"},{default:C(()=>o[16]||(o[16]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[16]},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{_t as default};
