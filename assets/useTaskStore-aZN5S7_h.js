import{H as O,r as d,y as i,I as f}from"./index-D9pNkE95.js";const F=O("task",()=>{const c=d([]),v=d(null),n=d(!1),u=d(null),p=async(a,l)=>{var e,t;n.value=!0,u.value=null;try{await f.post(`/tasks/${a}/assign-users`,{user_ids:l}),await y(a)}catch(r){throw u.value=((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||"Assign users failed",r}finally{n.value=!1}},T=async(a,l={loadingBeforeFetch:!0})=>{var e,t,r;l.loadingBeforeFetch&&(n.value=!0),u.value=null;try{const s=await f.get("/tasks",{params:a});c.value=((e=s.data)==null?void 0:e.tasks)||[]}catch(s){u.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",s)}finally{n.value=!1}};function k(a,l=0){return Array.isArray(a)===!1||a.length===0?[]:a.filter(e=>e.parent_id===l).map(e=>({...e,children_tasks:k(a,e.id)}))}function h(){return k(c.value,0)}function m(){const a=[],l=(e,t=0,r="")=>{e.forEach(s=>{a.push({...s,depth:t,idPath:r+s.id}),s.children_tasks&&s.children_tasks.length&&l(s.children_tasks,t+1,r+s.id+"-")})};return l(h()),a}const y=async(a,l={},e={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,r,s;e.fetchOnly||(n.value=!0),u.value=null;try{const o=await f.get(`/tasks/${a}`,{params:l});return e.fetchOnly||(v.value=((t=o.data)==null?void 0:t.task)||{}),o.data}catch(o){const g=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.message)||`টাস্ক (ID: ${a}) লোড করতে ব্যর্থ হয়েছে।`;return e.fetchOnly||(u.value=g),g}finally{e.fetchOnly||(n.value=!1)}},w=async a=>{var l,e,t,r;n.value=!0,u.value=null;try{const s=await f.post("/tasks",a);return(l=s.data)!=null&&l.data&&c.value.push((e=s.data)==null?void 0:e.data),s.data.data}catch(s){u.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",s)}finally{n.value=!1}},$=async(a,l)=>{var e,t;n.value=!0,u.value=null;try{const r=await f.put(`/tasks/${a}`,l),s=c.value.findIndex(o=>o.id===a);return s!==-1&&(c.value[s]=r.data.data),r.data.data}catch(r){u.value=((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.message)||`টাস্ক (ID: ${a}) আপডেট করতে ব্যর্থ হয়েছে।`,console.error(`Error updating task with id ${a}:`,r)}finally{n.value=!1}},E=async a=>{var l,e;n.value=!0,u.value=null;try{await f.delete(`/tasks/${a}`),c.value=c.value.filter(t=>t.id!==a)}catch(t){u.value=((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.message)||`টাস্ক (ID: ${a}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${a}:`,t)}finally{n.value=!1}};return{tasks:i(()=>c.value),task:i(()=>v.value),loading:i(()=>n.value),error:i(()=>u.value),taskListTree:i(h),flattenedTasks:i(m),fetchTasks:T,fetchTask:y,createTask:w,updateTask:$,deleteTask:E,assignUsers:p}});export{F as u};
