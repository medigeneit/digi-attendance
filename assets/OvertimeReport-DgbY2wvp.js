import{_ as S}from"./EmployeeFilter-oF9mJLSL.js";import{_ as B}from"./FlexibleDatePicker-Jk2z-8yj.js";import{L as U}from"./LoaderView-BEaHKhEr.js";import{u as T}from"./overtime-DOz8odih.js";import{u as j,f as Y,D as H,r as q,x as k,h as Q,q as N,p as z,c as d,o as p,a as e,b as C,d as f,m as D,n as b,t as a,F as G,e as I}from"./index-DKNJ0-JN.js";import"./company-D0PyeQ6I.js";import"./department-nJQvHvQG.js";import"./EmployeeDropdownInput-CuZ5vCSn.js";import"./SelectDropdown-CY9hJPm9.js";import"./UserChip-4L4O85tE.js";import"./user-t7uGqQHj.js";const J={class:"space-y-4 px-4"},K={class:"flex flex-wrap gap-4 p-3 bg-white rounded-md shadow-sm border border-slate-200 items-end"},W={class:"flex gap-2"},X={key:0,class:"text-center py-4"},Z={key:1,class:"space-y-4"},ee={key:0,class:"rounded-2xl border border-slate-200 bg-white shadow-sm"},te={class:"flex items-center justify-between border-b border-slate-100 bg-slate-50 px-4 py-3"},se={class:"flex items-center gap-3 text-sm font-bold text-slate-500"},oe={class:"overflow-x-auto"},ne={class:"min-w-full text-sm text-slate-600"},le={class:"divide-y divide-slate-100 bg-white"},ae={class:"px-4 py-3 font-semibold text-slate-700"},re={class:"px-4 py-3 text-slate-800"},ie={class:"px-4 py-3"},de={class:"px-4 py-3"},pe={class:"px-4 py-3 text-center"},ue={class:"px-4 py-3 text-center"},me={class:"px-4 py-3 text-center"},ce={class:"px-4 py-3 text-center print:hidden"},ye={class:"bg-slate-100 text-sm font-semibold"},_e={class:"px-4 py-3 text-center"},xe={class:"px-4 py-3 text-center"},fe={class:"px-4 py-3 text-center"},ve={key:1,class:"text-center text-red-500 text-xl italic mt-10"},Ee={__name:"OvertimeReport",setup(he){const g=j(),u=Y(),m=T(),{reports:v,loading:R,selectedMonth:F}=H(m),c=new Date,O=s=>String(s||"").padStart(2,"0"),y=q((s=>{if(!s)return{year:c.getFullYear(),month:c.getMonth()+1};const[t="",n=""]=s.split("-");return!t||!n?{year:c.getFullYear(),month:c.getMonth()+1}:{year:Number(t)||c.getFullYear(),month:Number(n)||c.getMonth()+1}})(u.query.date||F.value)),r=k(()=>!y.value.year||!y.value.month?"":`${y.value.year}-${O(y.value.month)}`),l=q({company_id:u.query.company_id||"",department_id:u.query.department_id||"all",line_type:u.query.line_type||"all",employee_id:u.query.employee_id||""}),w=(s={})=>{var t,n,o,i;g.replace({query:{...u.query,company_id:(t=l.value)==null?void 0:t.company_id,department_id:(n=l.value)==null?void 0:n.department_id,line_type:(o=l.value)==null?void 0:o.line_type,employee_id:(i=l.value)==null?void 0:i.employee_id,date:r.value,...s}})},h=()=>{const s=r.value;l.value.company_id&&s&&m.getCompanyDepartmentOvertimeReport(s,l.value)},E=()=>{w(),h()},$=()=>{w(),h()},V=()=>g.go(-1),A=()=>{r.value&&m.exportCompanyDepartmentOvertimeExcel(r.value,l.value)},L=()=>{r.value&&m.exportCompanyDepartmentOvertimePdf(r.value,l.value)};Q(()=>{l.value.company_id&&r.value&&m.getCompanyDepartmentOvertimeReport(r.value,l.value)}),N(r,(s,t)=>{!s||s===t||$()}),N(r,s=>{s&&(m.selectedMonth=s)},{immediate:!0});const M=s=>{if(s==null||s==="")return 0;if(typeof s=="number")return Math.round(s*60);if(typeof s=="string"){const t=s.trim();if(/^\d+:\d{1,2}$/.test(t)){const[o,i]=t.split(":").map(P=>Number(P)||0);return o*60+i}const n=Number(t);if(!Number.isNaN(n))return Math.round(n*60)}return 0},x=s=>{const t=Math.floor(s/60),n=s%60;return`${t}h ${n}m`},_=k(()=>(v.value||[]).reduce((t,n)=>(t.entries+=Number(n==null?void 0:n.total_overtime_entries)||0,t.requestedMin+=M(n==null?void 0:n.total_request_overtime_hours),t.approvedMin+=M(n==null?void 0:n.total_approval_overtime_hours),t),{entries:0,requestedMin:0,approvedMin:0}));return(s,t)=>{const n=z("RouterLink");return p(),d("div",J,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:V},t[5]||(t[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[8]||(t[8]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Overtime Report",-1)),e("div",{class:"flex gap-2"},[e("button",{onClick:A,class:"btn-1",title:"Download Excel"},t[6]||(t[6]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),C(" Excel Download ")])),e("button",{onClick:L,class:"btn-1",title:"Download PDF"},t[7]||(t[7]=[e("i",{class:"far fa-file-pdf text-2xl text-red-500"},null,-1),C(" PDF Download ")]))])]),e("div",K,[f(S,{company_id:l.value.company_id,"onUpdate:company_id":t[1]||(t[1]=o=>l.value.company_id=o),department_id:l.value.department_id,"onUpdate:department_id":t[2]||(t[2]=o=>l.value.department_id=o),employee_id:l.value.employee_id,"onUpdate:employee_id":t[3]||(t[3]=o=>l.value.employee_id=o),line_type:l.value.line_type,"onUpdate:line_type":t[4]||(t[4]=o=>l.value.line_type=o),"with-type":!0,"initial-value":s.$route.query,onFilterChange:E,class:"w-full"},{default:D(()=>[e("div",W,[f(B,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=o=>y.value=o),"show-year":!1,"show-month":!0,"show-date":!1,label:"Month"},null,8,["modelValue"]),e("button",{onClick:h,class:"btn-2 rounded"},t[9]||(t[9]=[e("i",{class:"far fa-sync"},null,-1),e("span",null,"Run Report",-1)]))])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])]),b(R)?(p(),d("div",X,[f(U)])):(p(),d("div",Z,[b(v).length?(p(),d("div",ee,[e("div",te,[t[10]||(t[10]=e("div",null,[e("p",{class:"text-xs uppercase tracking-wide text-slate-500"},"Summary"),e("h2",{class:"text-base font-semibold text-slate-900"},"Overtime across departments")],-1)),e("div",se,[e("span",null,"Entries: "+a(_.value.entries),1),e("span",null,"Requested: "+a(x(_.value.requestedMin)),1),e("span",null,"Approved: "+a(x(_.value.approvedMin)),1)])]),e("div",oe,[e("table",ne,[t[14]||(t[14]=e("thead",{class:"bg-slate-50 text-[11px] uppercase tracking-wider text-slate-500"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left"},"#"),e("th",{class:"px-4 py-3 text-left"},"Employee"),e("th",{class:"px-4 py-3 text-left"},"Company"),e("th",{class:"px-4 py-3 text-left"},"Department"),e("th",{class:"px-4 py-3 text-center"},"Entries"),e("th",{class:"px-4 py-3 text-center"},"Requested"),e("th",{class:"px-4 py-3 text-center"},"Approved"),e("th",{class:"px-4 py-3 text-center print:hidden"},"Actions")])],-1)),e("tbody",le,[(p(!0),d(G,null,I(b(v),(o,i)=>(p(),d("tr",{key:o.user_id||i,class:"hover:bg-slate-50"},[e("td",ae,a(i+1),1),e("td",re,a(o.user_name||"N/A"),1),e("td",ie,a(o.company_name||"N/A"),1),e("td",de,a(o.department_name||"N/A"),1),e("td",pe,a(o.total_overtime_entries),1),e("td",ue,a(o.total_request_overtime_hours),1),e("td",me,a(o.total_approval_overtime_hours),1),e("td",ce,[f(n,{to:{name:"OvertimeList",query:{...l.value,employee_id:o.user_id,date:r.value}},class:"inline-flex items-center justify-center rounded-full bg-indigo-50 px-3 py-1 text-xs font-semibold text-indigo-700 hover:bg-indigo-100"},{default:D(()=>t[11]||(t[11]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[11]},1032,["to"])])]))),128))]),e("tfoot",ye,[e("tr",null,[t[12]||(t[12]=e("td",{colspan:"4",class:"px-4 py-3 text-left"},"Totals",-1)),e("td",_e,a(_.value.entries),1),e("td",xe,a(x(_.value.requestedMin)),1),e("td",fe,a(x(_.value.approvedMin)),1),t[13]||(t[13]=e("td",{class:"px-4 py-3 text-center print:hidden"},null,-1))])])])])])):(p(),d("div",ve," No data available for this month. "))]))])}}};export{Ee as default};
