import{r as c,e as T,z as q,c as f,o as g,a as o,f as A,g as w,w as k,F as B,p as m,k as u,i as S,j as I,x as E,t as $,b as U,u as j}from"./index-CvTkKZxT.js";import{_ as z}from"./CompanyDepartmentSelectInput-CO0FeI29.js";import{R as F}from"./RequiredIcon-D1R9JQ7W.js";import{f as D,u as L}from"./requirement-DHW761qp.js";import{u as M}from"./company-CFwoZYfP.js";import{u as W}from"./tags-BinLyY7I.js";import{L as h}from"./LoaderView-DUC2TBRd.js";import{_ as G}from"./MultiselectDropdown-CDetHa1T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"max-h-[90vh] overflow-auto max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},J={class:"sticky top-0 pt-4 bg-white z-10"},K={class:"mb-4"},O={class:"block text-gray-600 text-sm mb1 font-medium"},P={class:"block text-gray-600 text-sm mb-1 font-medium"},Q={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},R={class:"flex items-center justify-between gap-4"},X=["disabled"],Y={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(V,{emit:x}){const d=V,p=x,i=W(),y=M(),a=c(""),l=c([]),C=c(),_=c(""),n=c({from_department_id:"",to_department_id:"",website_tags:[]});T(async()=>{var t;a.value="loading",i.fetchTags("website"),await y.fetchCompanies({with:"departments",ignore_permission:!0}),C.value=(t=(await D(d.requirementId)).data)==null?void 0:t.requirement,a.value=""}),q(C,function(t){var e;t&&(n.value.from_department_id=t.from_department_id,n.value.to_department_id=t.to_department_id,Array.isArray(t==null?void 0:t.website_tags)&&((e=t.website_tags)==null?void 0:e.length)>0&&(l.value=t.website_tags))});async function N(){var e,b,v,r;a.value="submitting";const t={...n.value,...l.value&&Array.isArray(l.value)?{website_tags:l.value.map(s=>s.id)}:{}};console.log({payload:t});try{const s=await L(d.requirementId,t);p("update",s),a.value="created",_.value=(e=s==null?void 0:s.data)==null?void 0:e.message}catch(s){p("error",(b=s==null?void 0:s.response)==null?void 0:b.data),_.value=(r=(v=s==null?void 0:s.response)==null?void 0:v.data)==null?void 0:r.message,a.value="error"}}return(t,e)=>{var b,v;return g(),f("div",H,[o("div",J,[e[5]||(e[5]=o("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[6]||(e[6]=o("hr",{class:"mb-4"},null,-1)),o("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=k(r=>p("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),o("form",{onSubmit:k(N,["prevent"]),class:"z-0"},[a.value!=="loading"&&a.value!=="submitting"?(g(),f(B,{key:0},[o("div",K,[e[7]||(e[7]=o("label",{class:"text-gray-800"},"Websites",-1)),m(G,{options:u(i).tags,modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value=r),multiple:!0,label:"name","track-by":"id"},null,8,["options","modelValue"])]),m(z,{modelValue:n.value.from_department_id,"onUpdate:modelValue":e[2]||(e[2]=r=>n.value.from_department_id=r),companies:((b=u(y))==null?void 0:b.companies)||[],class:"mb-4"},{label:S(()=>[o("label",O,[e[8]||(e[8]=I(" From Department ")),m(F)])]),_:1},8,["modelValue","companies"]),m(z,{modelValue:n.value.to_department_id,"onUpdate:modelValue":e[3]||(e[3]=r=>n.value.to_department_id=r),companies:((v=u(y))==null?void 0:v.companies)||[],class:"mb-4"},{label:S(()=>[o("label",P,[e[9]||(e[9]=I(" To Department ")),m(F)])]),_:1},8,["modelValue","companies"])],64)):w("",!0),o("div",Q,[_.value?(g(),f("div",{key:0,class:E(["mb-4 font-medium text-center",{"text-red-500":a.value=="error","text-green-500":a.value=="created"}])},$(_.value),3)):w("",!0),o("div",R,[o("button",{type:"button",onClick:e[4]||(e[4]=k(r=>p("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),o("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},$(a.value=="submitting"?"Saving...":"Save"),9,X)])])],32),a.value==="loading"||a.value==="submitting"?(g(),A(h,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):w("",!0)])}}},Z={class:"container mx-auto p-6"},me={__name:"RequirementEdit",setup(V){const x=U(),d=j();return(p,i)=>(g(),f("div",Z,[m(Y,{requirementId:u(x).params.id,onUpdate:i[0]||(i[0]=()=>u(d).back()),onCancelClick:i[1]||(i[1]=()=>u(d).back())},null,8,["requirementId"])]))}};export{me as default};
