import{f as gt,g as kt,r as h,x as d,q as Je,c as a,o,a as e,j as f,t as n,m as O,b as G,F as y,e as g,k as z,v as B,s as Xe,O as he,n as wt}from"./index-Bvm-KyRW.js";import{u as Nt}from"./kpi-xGTuaH2M.js";const Ct={class:"max-w-7xl mx-auto px-4 py-6 space-y-6"},Ft={class:"border rounded-2xl bg-white/80 backdrop-blur px-4 py-3 shadow-sm"},St={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},At={class:"space-y-1"},Lt={class:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1"},Mt={class:"text-xs text-indigo-900"},Ht={class:"text-sm text-slate-600"},Rt={class:"font-medium text-slate-800"},jt={class:"flex flex-wrap gap-2 text-xs mt-0.5"},$t={key:0,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},Gt={class:"ml-1 font-medium text-slate-800"},Tt={key:1,class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},Et={class:"ml-1 font-medium text-slate-800"},Pt={class:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 text-slate-600"},Vt={key:0,class:"ml-1 inline-flex items-center gap-1"},Dt={key:1,class:"ml-1 font-semibold text-slate-800"},Ut={class:"flex items-end gap-4"},Kt={class:"text-right"},Ot={class:"text-lg font-bold text-slate-900"},zt={class:"text-slate-400"},Bt={class:"text-xs text-slate-500"},It={key:0},Yt={class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},qt={key:0,class:"p-4 text-sm font-bold text-slate-500"},Qt=["innerHTML"],Wt={key:1,class:"border rounded-2xl bg-white shadow-sm overflow-hidden"},Jt={class:"overflow-auto"},Xt={class:"min-w-[980px] w-full text-sm"},Zt={class:"bg-slate-50 sticky top-0 z-10"},es={class:"text-slate-700"},ts={class:"font-medium"},ss={class:"text-[11px] text-slate-500 flex flex-col items-center"},ls={key:0,class:"mt-0.5 inline-flex items-center rounded-full bg-blue-50 px-2 py-0.5 text-[10px] font-medium text-blue-700 border border-blue-200"},as={class:"bg-slate-100/80 border-t"},os=["colspan"],ns={class:"px-3 py-2 text-center text-slate-500"},rs={class:"px-3 py-2 align-top"},is={class:"font-medium text-slate-800"},ds={class:"mt-1 flex gap-1 text-[11px] text-slate-500"},us=["disabled","onClick"],cs=["disabled","onClick"],xs=["disabled","onClick"],ms={class:"px-3 py-2 text-center text-slate-700"},ps={key:0,class:"flex items-center justify-center"},vs=["max","onUpdate:modelValue","onChange"],_s={key:1,class:"text-slate-700 text-sm"},bs={key:2,class:"text-slate-300 text-sm"},fs={class:"bg-slate-50 border-t"},hs={class:"px-3 py-2 text-center font-semibold text-slate-800"},ys=["colspan"],gs={class:"font-semibold text-slate-900"},ks={class:"text-slate-500"},ws={class:"mt-2"},Ns={class:"grid gap-4 lg:grid-cols-5"},Cs={key:0,class:"space-y-4 lg:col-span-3"},Fs={class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2.5"},Ss={class:"text-sm font-semibold text-slate-800"},As={class:"flex items-center gap-2 text-[11px] text-slate-500"},Ls=["onClick","disabled"],Ms=["onClick","disabled"],Hs=["onClick","disabled"],Rs={class:"overflow-auto"},js={class:"w-full text-sm"},$s={class:"px-3 py-2 text-center text-slate-500"},Gs={class:"px-3 py-2"},Ts={class:"font-medium text-slate-800"},Es={class:"px-3 py-2 text-center text-slate-700"},Ps={class:"px-3 py-2 text-center"},Vs=["max","onUpdate:modelValue","onChange"],Ds={key:1,class:"text-slate-700 text-sm"},Us={class:"bg-slate-50 border-t"},Ks={class:"px-3 py-2 text-center font-semibold text-slate-800"},Os={class:"px-3 py-2 text-center text-sm"},zs={key:0,class:"border rounded-2xl bg-white shadow-sm"},Bs={class:"flex flex-wrap items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},Is={class:"flex flex-wrap items-center gap-2 text-[11px] text-slate-500"},Ys={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},qs={key:0,class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Qs={class:"rounded-full border bg-slate-50 px-2 py-0.5 text-slate-700"},Ws={class:"p-4 space-y-4 max-h-[360px] overflow-y-auto"},Js={class:"flex flex-wrap gap-2 border-b border-slate-100 pb-3"},Xs=["onClick"],Zs={class:"space-y-4"},el={class:"grid grid-cols-1 gap-3 sm:grid-cols-2"},tl={class:"rounded-xl border bg-slate-50 p-3"},sl={class:"flex items-center justify-between"},ll={class:"text-[11px] px-1.5 py-0.5 rounded bg-blue-50 text-blue-700 border border-blue-200"},al={class:"mt-1 text-sm font-semibold text-slate-900"},ol={class:"text-xs text-slate-500"},nl={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},rl={class:"rounded-xl border bg-slate-50 p-3"},il={class:"flex items-center justify-between"},dl={class:"text-[11px] px-1.5 py-0.5 rounded bg-violet-50 text-violet-700 border border-violet-200"},ul={class:"mt-1 text-sm font-semibold text-slate-900"},cl={class:"text-xs text-slate-500"},xl={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},ml={class:"rounded-xl border bg-slate-50 p-3 sm:col-span-2"},pl={class:"flex items-center justify-between"},vl={class:"text-[11px] px-1.5 py-0.5 rounded bg-emerald-50 text-emerald-700 border border-emerald-200"},_l={class:"mt-1 text-sm font-semibold text-slate-900"},bl={class:"text-xs text-slate-500"},fl={class:"mt-2 h-2 rounded bg-slate-100 overflow-hidden"},hl={class:"border-t pt-2 text-xs"},yl={key:0,class:"mt-3 rounded-xl border border-slate-200 bg-slate-50 p-3 text-xs space-y-2"},gl={class:"grid grid-cols-2 gap-2"},kl={class:"font-medium text-slate-800"},wl={class:"font-medium text-slate-800"},Nl={class:"font-medium text-slate-800"},Cl={class:"font-medium text-slate-800"},Fl={class:"font-medium text-slate-800"},Sl={class:"font-medium text-slate-800"},Al={class:"font-medium text-slate-800"},Ll={class:"font-medium text-slate-800"},Ml={class:"font-medium text-slate-800"},Hl={key:1,class:"border rounded-2xl bg-white shadow-sm"},Rl={class:"flex items-center justify-between border-b px-4 py-3 text-sm font-semibold text-slate-800"},jl={class:"text-[11px] text-slate-500"},$l={class:"p-4 space-y-3"},Gl={class:"max-h-96 overflow-auto border rounded-xl"},Tl={class:"min-w-full text-xs text-left"},El={class:"px-2 py-2"},Pl={class:"font-semibold text-slate-700"},Vl={key:0,class:"mt-0.5 text-[11px] text-slate-400"},Dl={class:"px-2 py-2"},Ul={key:0,class:"flex flex-wrap gap-1"},Kl={key:1,class:"text-slate-400"},Ol={class:"px-2 py-2"},zl={key:0,class:"flex flex-wrap gap-1"},Bl={key:1,class:"text-slate-400"},Il={class:"px-2 py-2"},Yl={key:0,class:"flex flex-wrap gap-1"},ql={key:1,class:"text-slate-400"},Ql={key:2,class:"rounded-2xl bg-white border shadow-sm px-4 py-4 space-y-4"},Wl={class:"grid gap-4 md:grid-cols-3"},Jl={class:"space-y-3"},Xl={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},Zl={key:0,class:"text-[11px] text-emerald-600"},ea={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 max-h-32 overflow-y-auto"},ta={class:"flex flex-wrap gap-1.5"},sa=["onClick","disabled"],la={key:1,class:"text-[11px] text-slate-400"},aa={class:"space-y-1"},oa={class:"space-y-3"},na={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},ra={key:0,class:"text-[11px] text-amber-600"},ia={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 max-h-32 overflow-y-auto"},da={class:"flex flex-wrap gap-1.5"},ua=["onClick","disabled"],ca={key:1,class:"text-[11px] text-slate-400"},xa={class:"space-y-1"},ma={class:"space-y-3"},pa={class:"flex items-center justify-between text-xs font-semibold text-slate-600"},va={key:0,class:"text-[11px] text-sky-600"},_a={key:0,class:"rounded-2xl border border-slate-200 bg-slate-50/70 p-3 max-h-32 overflow-y-auto"},ba={class:"flex flex-wrap gap-1.5"},fa=["onClick","disabled"],ha={class:"space-y-1"},ya={class:"mt-2 flex flex-col gap-3 border-t pt-3 md:flex-row md:items-center md:justify-between"},ga={class:"text-sm text-slate-600"},ka={class:"text-slate-900"},wa={class:"text-slate-400"},Na=["disabled"],Aa={__name:"KpiReviewForm",setup(Ca){const oe=gt(),w=Nt(),ne=kt(),_=h({}),S=h({}),I=h(""),Y=h(""),q=h(""),T=h(null),Q=h(null),V=h(!1),ye=h([]),W=h({}),A=h(null),re=h(!1),ie=d(()=>{var s;return((s=w.cycle)==null?void 0:s.groups_json)||[]}),ge=s=>(s==null?void 0:s.id)==="personal"||/personal/i.test((s==null?void 0:s.label)||""),M=d(()=>ie.value.find(ge)||null),D=d(()=>ie.value.filter(s=>!ge(s))),Ze=(s,t)=>(s==null?void 0:s.label)||`Group ${t+1}`,et=s=>/^hr\d*$/i.test(s)||s==="hr",ke=s=>et((s==null?void 0:s.key)||"")||(s==null?void 0:s.is_hr_lane)===!0,we=d(()=>[...ye.value||[]].sort((s,t)=>(s.rank??999)-(t.rank??999))),de=d(()=>we.value.filter(ke)),H=d(()=>we.value.filter(s=>!ke(s))),tt=d(()=>H.value.find(s=>s.key===A.value)||null),st=d(()=>{var s;return((s=tt.value)==null?void 0:s.rank)??null}),lt=d(()=>{var s;return Number(((s=ne==null?void 0:ne.user)==null?void 0:s.id)||0)}),ue=d(()=>{const s=lt.value;if(!s)return null;const t=de.value.find(r=>Number(r.assigned_user_id)===s);return t||de.value.find(r=>r.can_current_user_review)||null}),L=d(()=>{var s;return((s=ue.value)==null?void 0:s.key)||null}),at=d(()=>!!(ue.value&&ue.value.can_current_user_review)),C=d(()=>!!(re.value||at.value)),R=d(()=>!!A.value&&H.value.some(s=>s.key===A.value&&s.can_current_user_review)),J=d(()=>C.value&&L.value?L.value:A.value),Ne=d(()=>!!(J.value&&L.value&&J.value===L.value));function ce(s){var r;return(((r=W.value)==null?void 0:r[s])||[])[0]||null}function Ce(s,t){var i;const r=ce(s);return((i=r==null?void 0:r.marks)==null?void 0:i[t])??""}function Fe(s){var r,i,m,u;if(L.value){const b=ce(L.value),k=(r=b==null?void 0:b.marks)==null?void 0:r[s];if(k!=null)return k}let t=null;for(const b of de.value){const p=(((i=W.value)==null?void 0:i[b.key])||[])[0];if(!(!p||((m=p==null?void 0:p.marks)==null?void 0:m[s])==null)){if(!t){t=p;continue}p.submitted_at&&t.submitted_at&&p.submitted_at>t.submitted_at&&(t=p)}}return((u=t==null?void 0:t.marks)==null?void 0:u[s])??""}function xe(s,t){const r=Number(_.value[s]??0);r<0&&(_.value[s]=0),r>Number(t)&&(_.value[s]=Number(t))}function X(s,t,r){r==="zero"?_.value[s]=0:r==="half"?_.value[s]=Number(t)/2:r==="threeQuarter"?_.value[s]=Number((Number(t)*.75).toFixed(1)):r==="full"&&(_.value[s]=Number(t)),xe(s,t)}function me(s,t){s.items.forEach(r=>X(r.id,r.max,t))}const U=d(()=>{let s=0,t=0;const r=M.value;r&&r.items.forEach(m=>{s+=Number(m.max||0);const u=Number(_.value[m.id]||0);t+=Math.min(Math.max(u,0),Number(m.max||0))});const i=s>0?t/s*100:0;return{max:Number(s.toFixed(2)),got:Number(t.toFixed(2)),percent:Number(i.toFixed(2))}}),ot=d(()=>!!T.value&&typeof T.value=="object"),nt=d(()=>{var s;return((s=T.value)==null?void 0:s.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),rt=d(()=>{var s;return((s=T.value)==null?void 0:s.year)??null}),it=d(()=>{var s;return((s=Q.value)==null?void 0:s.avg)||{per_scored_month:{},per_form_yearly:{},percent_simple:0,percent_weighted:0}}),dt=d(()=>{var s;return((s=Q.value)==null?void 0:s.year)??null}),j=h("target"),pe=[{key:"target",label:"Annual Target"},{key:"performance",label:"Annual Performance"}],Se=d(()=>{var s;return((s=T.value)==null?void 0:s.months_total_form)??0}),ut=d(()=>{var s;return((s=Q.value)==null?void 0:s.months_total_form)??Se.value}),v=d(()=>j.value==="target"?nt.value:it.value),ve=d(()=>j.value==="target"?rt.value:dt.value),Ae=d(()=>j.value==="target"?Se.value:ut.value),_e=d(()=>{var s;return((s=pe.find(t=>t.key===j.value))==null?void 0:s.label)||"Annual Target"}),ct={target:"target",performance:"regular_activities_of_the_department"},xt=d(()=>{const s=ct[j.value];return s&&D.value.find(t=>t.id===s)||null}),mt=d(()=>{var s;return((s=xt.value)==null?void 0:s.label)||_e.value}),pt=s=>{pe.some(t=>t.key===s)&&(j.value=s)};Je(j,()=>{V.value=!1});const Z=d(()=>{const s=W.value||{},t=H.value||[],r=[],i=Ne.value||C.value?1/0:st.value??null,m=u=>{if(!u)return[];const b=[];if(Array.isArray(u))b.push(...u);else if(typeof u=="string"&&u.trim())b.push(u.trim());else return[];const k=new Set;return b.reduce((p,$)=>{const F=typeof $=="string"?$.trim():"";return!F||k.has(F)||(k.add(F),p.push(F)),p},[])};return t.forEach(u=>{const b=u.key;if(!b||i!=null&&(u.rank??999)>i)return;const k=s[b]||[];if(!Array.isArray(k)||!k.length)return;const p=k[0],$=m(p.strengths),F=m(p.gaps),K=m(p.suggestions);!$.length&&!F.length&&!K.length||r.push({key:b,lane:b,label:u.label||(p==null?void 0:p.lane_label)||b,reviewer_id:p.reviewer_id,reviewer_name:p.reviewer_name,strengths:$,gaps:F,suggestions:K,submitted_at:p.submitted_at??null})}),r}),vt=s=>{const t=new Set;return Z.value.forEach(r=>{(Array.isArray(r[s])?r[s]:[]).forEach(m=>{const u=typeof m=="string"?m.trim():"";u&&t.add(u)})}),Array.from(t)},Le=s=>{if(!Array.isArray(s))return[];const t=new Set;return s.forEach(r=>{const i=typeof r=="string"?r.trim():"";i&&t.add(i)}),Array.from(t)},ee=d(()=>Le(w.strengths)),te=d(()=>Le(w.gaps)),se=d(()=>vt("suggestions"));h([]),h([]),h([]);const Me={strengths:I,gaps:Y,suggestions:q};function _t(s,t){const r=(t||"").trim();return r?s!=null&&s.trim()?`${s.trim()}
${r}`:r:s}const bt=d(()=>{const s={};let t=1;const r=M.value;return r&&r.items.forEach(i=>{s[i.id]=t++}),s}),ft=d(()=>Number(oe.params.employeeId)),ht=s=>{var t,r;if(S.value=s.employee,T.value=(s==null?void 0:s.annual_target_avg_marks)||null,Q.value=(s==null?void 0:s.annual_performance_avg_marks)||null,ye.value=s.lanes||[],W.value=s.reviews_by_lane||{},re.value=!!(((t=s==null?void 0:s.meta)==null?void 0:t.is_hr)??(s==null?void 0:s.hr)??!1),A.value=((r=H.value.find(i=>i.can_current_user_review))==null?void 0:r.key)||null,ie.value.forEach(i=>i.items.forEach(m=>{_.value[m.id]==null&&(_.value[m.id]=0)})),A.value){const i=ce(A.value);i!=null&&i.marks&&Object.assign(_.value,i.marks)}C.value&&D.value.forEach(i=>{i.items.forEach(m=>{let u=L.value?Ce(L.value,m.id):"";(u===""||u==null)&&(u=Fe(m.id)),u!==""&&u!=null&&(_.value[m.id]=Number(u))})})};Je(ft,async(s,t)=>{if(!s||t&&s===t)return;await w.fetchActiveCycle(s);const r=await w.fetchLanes(w.cycle.id,s);ht(r)},{immediate:!0});async function yt(){const s=J.value;if(!s){alert("Unable to determine reviewer lane.");return}L.value,await w.submitReview({cycle_id:w.cycle.id,employee_id:Number(oe.params.employeeId),reviewer_lane:s,marks:_.value,strengths:I.value,gaps:Y.value,suggestions:q.value}),alert("Submitted")}function N(s){const t=Number(s??0);return isNaN(t)?"0.00":t.toFixed(2)}function E(s,t){const r=Number(s??0),i=Number(t??0);return i>0?Math.round(r/i*100):0}function le(s,t){const r=Me[s];if(!r)return!1;const i=(r.value||"").split(`
`).map(u=>u.trim()).filter(Boolean),m=(t||"").trim();return m?i.includes(m):!1}function be(s,t){const r=Me[s];if(!r)return;const i=typeof t=="string"?t.trim():"";i&&(le(s,i)||(r.value=_t(r.value,i)))}return(s,t)=>{var r,i,m,u,b,k,p,$,F,K,fe,He,Re,je,$e,Ge,Te,Ee,Pe,Ve,De,Ue,Ke,Oe,ze,Be,Ie,Ye,qe,Qe,We;return o(),a("div",Ct,[e("header",Ft,[e("div",St,[e("div",At,[e("div",Lt,[t[5]||(t[5]=e("span",{class:"text-xs font-semibold text-indigo-700"},"KPI Cycle",-1)),e("span",Mt,n((r=O(w).cycle)==null?void 0:r.title),1)]),e("div",Ht,[e("div",Rt,n(((i=S.value)==null?void 0:i.name)||"Employee"),1),e("div",jt,[(u=(m=S.value)==null?void 0:m.designation)!=null&&u.title?(o(),a("span",$t,[t[6]||(t[6]=G(" Designation: ")),e("span",Gt,n(S.value.designation.title),1)])):f("",!0),(k=(b=S.value)==null?void 0:b.department)!=null&&k.name?(o(),a("span",Tt,[t[7]||(t[7]=G(" Department: ")),e("span",Et,n(S.value.department.name),1)])):f("",!0),e("span",Pt,[t[9]||(t[9]=G(" Reviewing as: ")),Ne.value?(o(),a("span",Vt,t[8]||(t[8]=[e("span",{class:"font-semibold text-emerald-700"},"HR",-1),e("span",{class:"text-[10px] rounded bg-emerald-50 border border-emerald-200 px-1.5 py-0.5 text-emerald-700"}," HR mode ",-1)]))):(o(),a("span",Dt,n(J.value||"No lane"),1))])])])]),e("div",Ut,[e("div",Kt,[t[10]||(t[10]=e("div",{class:"text-[11px] uppercase tracking-wide text-slate-500"}," Personal group total ",-1)),e("div",Ot,[G(n(U.value.got.toFixed(2))+" ",1),e("span",zt,"/ "+n(U.value.max.toFixed(2)),1)]),e("div",Bt,n(U.value.percent.toFixed(2))+"% achieved ",1)]),re.value?(o(),a("button",{key:0,onClick:t[0]||(t[0]=l=>O(w).submitFinalResult(O(w).cycle.id,O(oe).params.employeeId)),class:"inline-flex items-center gap-2 rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-medium text-white shadow hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-300 focus:outline-none"},t[11]||(t[11]=[e("span",null,"Finalize & Lock",-1)]))):f("",!0)])])]),(p=S.value)!=null&&p.active_criteria?(o(),a("div",It,[e("section",Yt,[t[12]||(t[12]=e("div",{class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2"},[e("div",{class:"text-sm font-semibold text-slate-800"},"কার্যসম্পাদন বিষয়")],-1)),((F=($=S.value)==null?void 0:$.active_criteria)==null?void 0:F.length)===0?(o(),a("div",qt," -- ")):f("",!0),(o(!0),a(y,null,g(S.value.active_criteria,l=>(o(),a("div",{class:"p-4 text-sm text-slate-700",key:l.id},[e("div",{class:"print:block richtext print:break-inside-avoid",innerHTML:l==null?void 0:l.description},null,8,Qt)]))),128))])])):f("",!0),O(w).cycle&&M.value?(o(),a("section",Wt,[t[18]||(t[18]=e("div",{class:"flex items-center justify-between border-b bg-slate-50 px-4 py-2"},[e("div",{class:"text-sm font-semibold text-slate-800"},"Personal Evaluation"),e("div",{class:"text-xs text-slate-500"},"Fill only your lane; others appear as read-only.")],-1)),e("div",Jt,[e("table",Xt,[e("thead",Zt,[e("tr",es,[t[13]||(t[13]=e("th",{class:"px-3 py-2 w-[40px] text-center font-medium"},"#",-1)),t[14]||(t[14]=e("th",{class:"text-left px-3 py-2 w-[20%] font-medium"},"মূল্যায়নের বিষয় (Personal)",-1)),t[15]||(t[15]=e("th",{class:"px-3 py-2 text-center font-medium"},"Max",-1)),(o(!0),a(y,null,g(H.value,l=>(o(),a("th",{key:l.key,class:"px-3 py-2 text-center font-medium"},[e("div",ts,n(l.label||l.key),1),e("div",ss,[e("span",null,n(l.assigned_user_name||"-"),1),l.key===A.value&&l.can_current_user_review?(o(),a("span",ls," You can edit ")):f("",!0)])]))),128))])]),e("tbody",null,[e("tr",as,[e("td",{colspan:3+H.value.length,class:"px-3 py-2 font-medium text-slate-800"},n(M.value.label||"Personal"),9,os)]),(o(!0),a(y,null,g(M.value.items,l=>(o(),a("tr",{key:l.id,class:"border-t hover:bg-slate-50/60"},[e("td",ns,n(bt.value[l.id]),1),e("td",rs,[e("div",is,n(l.label),1),e("div",ds,[e("button",{class:"border rounded px-1.5 py-0.5 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!R.value,onClick:c=>R.value&&X(l.id,l.max,"half")}," ½ ",8,us),e("button",{class:"border rounded px-1.5 py-0.5 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!R.value,onClick:c=>R.value&&X(l.id,l.max,"threeQuarter")}," ¾ ",8,cs),e("button",{class:"border rounded px-1.5 py-0.5 disabled:opacity-40 disabled:cursor-not-allowed",disabled:!R.value,onClick:c=>R.value&&X(l.id,l.max,"full")}," Full ",8,xs)])]),e("td",ms,n(l.max),1),(o(!0),a(y,null,g(H.value,c=>(o(),a("td",{key:c.key,class:"px-3 py-2 text-center"},[c.key===A.value&&c.can_current_user_review?(o(),a("div",ps,[z(e("input",{type:"number",step:"0.1",min:"0",max:l.max,"onUpdate:modelValue":x=>_.value[l.id]=x,onChange:x=>xe(l.id,l.max),inputmode:"decimal",class:"w-24 text-right rounded-lg border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200"},null,40,vs),[[B,_.value[l.id],void 0,{number:!0}]])])):c.can_view_marks?(o(),a("div",_s,n(Ce(c.key,l.id)),1)):(o(),a("div",bs,"—"))]))),128))]))),128)),e("tr",fs,[t[16]||(t[16]=e("td",null,null,-1)),t[17]||(t[17]=e("td",{class:"px-3 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),e("td",hs,n(M.value.items.reduce((l,c)=>l+Number(c.max||0),0).toFixed(2)),1),e("td",{colspan:H.value.length,class:"px-3 py-2 text-center text-sm"},[e("span",gs,n(M.value.items.reduce((l,c)=>{const x=Number(_.value[c.id]||0);return l+Math.min(Math.max(x,0),Number(c.max||0))},0).toFixed(2)),1),e("span",ks," / "+n(M.value.items.reduce((l,c)=>l+Number(c.max||0),0).toFixed(2)),1)],8,ys)])])])])])):f("",!0),e("section",ws,[e("div",Ns,[D.value.length?(o(),a("div",Cs,[(o(!0),a(y,null,g(D.value,(l,c)=>(o(),a("div",{key:c,class:"overflow-hidden border rounded-2xl bg-white shadow-sm"},[e("div",Fs,[e("div",Ss," Group "+n(c+1)+" — "+n(Ze(l,c)),1),e("div",As,[t[19]||(t[19]=e("span",null,"Quick fill:",-1)),e("button",{class:"rounded border px-1.5 py-0.5 hover:bg-slate-100 disabled:opacity-40",onClick:x=>me(l,"half"),disabled:!C.value}," All ½ ",8,Ls),e("button",{class:"rounded border px-1.5 py-0.5 hover:bg-slate-100 disabled:opacity-40",onClick:x=>me(l,"threeQuarter"),disabled:!C.value}," All ¾ ",8,Ms),e("button",{class:"rounded border px-1.5 py-0.5 hover:bg-slate-100 disabled:opacity-40",onClick:x=>me(l,"full"),disabled:!C.value}," All Full ",8,Hs)])]),e("div",Rs,[e("table",js,[t[22]||(t[22]=e("thead",{class:"sticky top-0 bg-white z-10"},[e("tr",{class:"bg-slate-100 text-slate-700"},[e("th",{class:"px-3 py-2 w-[40px] text-center font-medium"},"#"),e("th",{class:"text-left px-3 py-2 w-[30%] font-medium"},"Item"),e("th",{class:"px-3 py-2 text-center w-[40px] font-medium"},"Max"),e("th",{class:"px-3 py-2 text-center w-[80px] font-medium"},"HR Score")])],-1)),e("tbody",null,[(o(!0),a(y,null,g(l.items,(x,P)=>(o(),a("tr",{key:x.id,class:"border-t hover:bg-slate-50/60"},[e("td",$s,n(P+1),1),e("td",Gs,[e("div",Ts,n(x.label),1)]),e("td",Es,n(x.max),1),e("td",Ps,[C.value?z((o(),a("input",{key:0,type:"number",step:"0.1",min:"0",max:x.max,"onUpdate:modelValue":ae=>_.value[x.id]=ae,onChange:ae=>xe(x.id,x.max),inputmode:"decimal",class:"w-24 text-right rounded-lg border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200"},null,40,Vs)),[[B,_.value[x.id],void 0,{number:!0}]]):(o(),a("p",Ds,n(Fe(x.id)||"—"),1))])]))),128)),e("tr",Us,[t[20]||(t[20]=e("td",null,null,-1)),t[21]||(t[21]=e("td",{class:"px-3 py-2 text-right font-medium text-slate-700"},"Group Total",-1)),e("td",Ks,n(l.items.reduce((x,P)=>x+Number(P.max||0),0).toFixed(2)),1),e("td",Os,n(l.items.reduce((x,P)=>{const ae=Number(_.value[P.id]||0);return x+Math.min(Math.max(ae,0),Number(P.max||0))},0).toFixed(2)),1)])])])])]))),128))])):f("",!0),e("aside",{class:Xe(["space-y-4",[D.value.length===0?"lg:col-span-full":"lg:col-span-2"]])},[ot.value&&C.value?(o(),a("section",zs,[e("header",Bs,[t[23]||(t[23]=e("span",null,"Annual Summary",-1)),e("div",Is,[e("span",Ys,n(_e.value),1),ve.value?(o(),a("span",qs," Year "+n(ve.value),1)):f("",!0),e("span",Qs,n(Ae.value)+" month(s) ",1)])]),e("div",Ws,[e("div",Js,[(o(),a(y,null,g(pe,l=>e("button",{key:l.key,type:"button",onClick:c=>pt(l.key),class:Xe(["px-3 py-1 rounded-full text-xs font-semibold transition",j.value===l.key?"bg-slate-900 text-white shadow":"border border-slate-200 text-slate-700 bg-white hover:border-slate-400"])},n(l.label),11,Xs)),64))]),e("div",Zs,[e("div",el,[e("div",tl,[e("div",sl,[t[24]||(t[24]=e("span",{class:"text-xs font-medium text-slate-600"},"Incharge",-1)),e("span",ll,n(E((K=v.value.per_scored_month)==null?void 0:K.incharge,(fe=v.value.per_scored_month)==null?void 0:fe.max))+"% ",1)]),e("div",al,[G(n(N((He=v.value.per_scored_month)==null?void 0:He.incharge))+" ",1),e("span",ol,"/ "+n(N((Re=v.value.per_scored_month)==null?void 0:Re.max)),1)]),e("div",nl,[e("div",{class:"h-2 bg-blue-500",style:he({width:E((je=v.value.per_scored_month)==null?void 0:je.incharge,($e=v.value.per_scored_month)==null?void 0:$e.max)+"%"})},null,4)])]),e("div",rl,[e("div",il,[t[25]||(t[25]=e("span",{class:"text-xs font-medium text-slate-600"},"Coordinator",-1)),e("span",dl,n(E((Ge=v.value.per_scored_month)==null?void 0:Ge.coordinator,(Te=v.value.per_scored_month)==null?void 0:Te.max))+"% ",1)]),e("div",ul,[G(n(N((Ee=v.value.per_scored_month)==null?void 0:Ee.coordinator))+" ",1),e("span",cl,"/ "+n(N((Pe=v.value.per_scored_month)==null?void 0:Pe.max)),1)]),e("div",xl,[e("div",{class:"h-2 bg-violet-500",style:he({width:E((Ve=v.value.per_scored_month)==null?void 0:Ve.coordinator,(De=v.value.per_scored_month)==null?void 0:De.max)+"%"})},null,4)])]),e("div",ml,[e("div",pl,[t[26]||(t[26]=e("span",{class:"text-xs font-medium text-slate-600"},"Final",-1)),e("span",vl,n(E((Ue=v.value.per_form_yearly)==null?void 0:Ue.final,(Ke=v.value.per_scored_month)==null?void 0:Ke.max))+"% ",1)]),e("div",_l,[G(n(N((Oe=v.value.per_form_yearly)==null?void 0:Oe.final))+" ",1),e("span",bl,"/ "+n(N((ze=v.value.per_scored_month)==null?void 0:ze.max)),1)]),e("div",fl,[e("div",{class:"h-2 bg-emerald-500",style:he({width:E((Be=v.value.per_form_yearly)==null?void 0:Be.final,(Ie=v.value.per_scored_month)==null?void 0:Ie.max)+"%"})},null,4)])])]),e("div",hl,[e("button",{class:"text-xs px-3 py-1.5 rounded-md border hover:bg-slate-50",onClick:t[1]||(t[1]=l=>V.value=!V.value)},n(V.value?"Hide details":"Show "+_e.value+" details"),1),V.value?(o(),a("div",yl,[e("div",gl,[t[27]||(t[27]=e("div",{class:"text-slate-500"},"Year",-1)),e("div",kl,n(ve.value||"-"),1),t[28]||(t[28]=e("div",{class:"text-slate-500"},"Months counted",-1)),e("div",wl,n(Ae.value),1),t[29]||(t[29]=e("div",{class:"text-slate-500"},"Group",-1)),e("div",Nl,n(mt.value),1),t[30]||(t[30]=e("div",{class:"text-slate-500"},"Max (denominator)",-1)),e("div",Cl,n(N((Ye=v.value.per_scored_month)==null?void 0:Ye.max)),1),t[31]||(t[31]=e("div",{class:"text-slate-500"},"Incharge avg",-1)),e("div",Fl,n(N((qe=v.value.per_form_yearly)==null?void 0:qe.incharge)),1),t[32]||(t[32]=e("div",{class:"text-slate-500"},"Coordinator avg",-1)),e("div",Sl,n(N((Qe=v.value.per_form_yearly)==null?void 0:Qe.coordinator)),1),t[33]||(t[33]=e("div",{class:"text-slate-500"},"Final avg",-1)),e("div",Al,n(N((We=v.value.per_form_yearly)==null?void 0:We.final)),1),t[34]||(t[34]=e("div",{class:"text-slate-500"},"Percent (simple)",-1)),e("div",Ll,n(N(v.value.percent_simple))+"% ",1),t[35]||(t[35]=e("div",{class:"text-slate-500"},"Percent (weighted)",-1)),e("div",Ml,n(N(v.value.percent_weighted))+"% ",1)])])):f("",!0)])])])])):f("",!0),Z.value.length?(o(),a("section",Hl,[e("header",Rl,[t[36]||(t[36]=e("span",null,"Review Comments",-1)),e("span",jl,n(Z.value.length)+" lane(s) ",1)]),e("div",$l,[e("div",Gl,[e("table",Tl,[t[37]||(t[37]=e("thead",{class:"text-[11px] text-slate-600 uppercase tracking-wide bg-slate-50"},[e("tr",null,[e("th",{class:"px-2 py-2 w-[90px]"},"Lane"),e("th",{class:"px-2 py-2"},"Strengths"),e("th",{class:"px-2 py-2"},"Gaps"),e("th",{class:"px-2 py-2"},"Suggestions")])],-1)),e("tbody",null,[(o(!0),a(y,null,g(Z.value,l=>(o(),a("tr",{key:l.key,class:"border-t hover:bg-slate-50/60 align-top"},[e("td",El,[e("div",Pl,n(l.label),1),l.submitted_at?(o(),a("div",Vl,n(new Date(l.submitted_at).toLocaleDateString()),1)):f("",!0)]),e("td",Dl,[l.strengths&&l.strengths.length?(o(),a("div",Ul,[(o(!0),a(y,null,g(l.strengths,(c,x)=>(o(),a("span",{key:"s-"+x,class:"inline-flex items-center rounded-full bg-emerald-50 border border-emerald-100 px-2 py-0.5 text-[11px] text-emerald-700"},n(c),1))),128))])):(o(),a("span",Kl,"—"))]),e("td",Ol,[l.gaps&&l.gaps.length?(o(),a("div",zl,[(o(!0),a(y,null,g(l.gaps,(c,x)=>(o(),a("span",{key:"g-"+x,class:"inline-flex items-center rounded-full bg-amber-50 border border-amber-100 px-2 py-0.5 text-[11px] text-amber-800"},n(c),1))),128))])):(o(),a("span",Bl,"—"))]),e("td",Il,[l.suggestions&&l.suggestions.length?(o(),a("div",Yl,[(o(!0),a(y,null,g(l.suggestions,(c,x)=>(o(),a("span",{key:"su-"+x,class:"inline-flex items-center rounded-full bg-sky-50 border border-sky-100 px-2 py-0.5 text-[11px] text-sky-800"},n(c),1))),128))])):(o(),a("span",ql,"—"))])]))),128))])])])])])):f("",!0)],2)])]),R.value||C.value?(o(),a("section",Ql,[t[44]||(t[44]=wt('<header class="flex items-center justify-between mb-1"><div><h2 class="text-sm font-semibold text-slate-800">Overall Review Notes</h2><p class="text-[11px] text-slate-500"> Use saved hints or write your own detailed comments. </p></div><div class="hidden md:flex items-center gap-2 text-[11px] text-slate-500"><span class="inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 border border-emerald-100"><span class="text-xs">●</span> Strengths </span><span class="inline-flex items-center gap-1 rounded-full bg-amber-50 px-2 py-0.5 border border-amber-100"><span class="text-xs">●</span> Gaps </span><span class="inline-flex items-center gap-1 rounded-full bg-sky-50 px-2 py-0.5 border border-sky-100"><span class="text-xs">●</span> Suggestions </span></div></header>',1)),e("div",Wl,[e("div",Jl,[e("header",Xl,[t[38]||(t[38]=e("div",{class:"flex items-center gap-1"},[e("span",{class:"text-emerald-500 text-base leading-none"},"★"),e("span",null,"Strengths")],-1)),ee.value.length?(o(),a("span",Zl,n(ee.value.length)+" saved hint(s) ",1)):f("",!0)]),ee.value.length?(o(),a("div",ea,[e("div",ta,[(o(!0),a(y,null,g(ee.value,l=>(o(),a("button",{key:l,type:"button",onClick:c=>be("strengths",l),disabled:le("strengths",l),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-emerald-300 hover:bg-emerald-50 hover:text-emerald-800 disabled:opacity-40 disabled:cursor-not-allowed"},n(l),9,sa))),128))])])):(o(),a("p",la," No historical strengths yet. Write your own notes below. ")),e("div",aa,[t[39]||(t[39]=e("label",{class:"text-[11px] font-medium text-slate-500"}," Key Strength(s) ",-1)),z(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=l=>I.value=l),placeholder:"e.g. Strong ownership, proactive problem solving…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-emerald-200"},null,512),[[B,I.value]])])]),e("div",oa,[e("header",na,[t[40]||(t[40]=e("div",{class:"flex items-center gap-1"},[e("span",{class:"text-amber-500 text-base leading-none"},"!"),e("span",null,"Gaps")],-1)),te.value.length?(o(),a("span",ra,n(te.value.length)+" saved hint(s) ",1)):f("",!0)]),te.value.length?(o(),a("div",ia,[e("div",da,[(o(!0),a(y,null,g(te.value,l=>(o(),a("button",{key:l,type:"button",onClick:c=>be("gaps",l),disabled:le("gaps",l),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-amber-300 hover:bg-amber-50 hover:text-amber-800 disabled:opacity-40 disabled:cursor-not-allowed"},n(l),9,ua))),128))])])):(o(),a("p",ca,"No historical gaps yet.")),e("div",xa,[t[41]||(t[41]=e("label",{class:"text-[11px] font-medium text-slate-500"},"GAP(s)",-1)),z(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=l=>Y.value=l),placeholder:"e.g. Needs improvement in documentation, communication…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-amber-200"},null,512),[[B,Y.value]])])]),e("div",ma,[e("header",pa,[t[42]||(t[42]=e("div",{class:"flex items-center gap-1"},[e("span",{class:"text-sky-500 text-base leading-none"},"✱"),e("span",null,"Suggestions / Training")],-1)),se.value.length?(o(),a("span",va,n(se.value.length)+" common suggestion(s) ",1)):f("",!0)]),se.value.length?(o(),a("div",_a,[e("div",ba,[(o(!0),a(y,null,g(se.value,l=>(o(),a("button",{key:l,type:"button",onClick:c=>be("suggestions",l),disabled:le("suggestions",l),class:"rounded-full border px-2.5 py-1 text-[11px] font-medium transition border-slate-200 bg-white text-slate-700 hover:border-sky-300 hover:bg-sky-50 hover:text-sky-800 disabled:opacity-40 disabled:cursor-not-allowed"},n(l),9,fa))),128))])])):f("",!0),e("div",ha,[t[43]||(t[43]=e("label",{class:"text-[11px] font-medium text-slate-500"}," Suggestions / Development plan ",-1)),z(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=l=>q.value=l),placeholder:"Specific actions, training plans, timeline and expectations…",class:"w-full rounded-xl border px-3 py-2 text-sm min-h-28 focus:outline-none focus:ring-2 focus:ring-sky-200"},null,512),[[B,q.value]])])])])])):f("",!0),e("div",ya,[e("div",ga,[t[45]||(t[45]=G(" My (Personal) Total: ")),e("b",ka,n(U.value.got.toFixed(2)),1),e("span",wa,"/ "+n(U.value.max.toFixed(2)),1)]),e("button",{onClick:yt,disabled:!(C.value||R.value),class:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-5 py-2.5 text-sm font-medium text-white shadow hover:bg-emerald-700 disabled:opacity-40 focus:outline-none focus:ring-2 focus:ring-emerald-300"}," Submit ",8,Na)])])}}};export{Aa as default};
