import{C as T,_ as Z,f as I,u as ee,S as te,D as q,x,r as C,h as ae,q as le,c as r,o as d,a as l,k as se,H as ne,F as u,e as f,t as i,d as h,l as _,s as y}from"./index-CPfwXEoI.js";import{u as re}from"./company-B73RytfM.js";import{u as de}from"./department-COfWXir6.js";import{L as oe}from"./LoaderView-eTZQVyNl.js";import{S as L}from"./SelectDropdown-DQIQskYS.js";import{_ as ie}from"./EmployeeDropdownInput-4PYAVIsm.js";import"./UserChip-BGFh-gj5.js";import"./user-CvkweKRA.js";const ce=g=>T.get("/attendance/yearly-delay-early-summary",{params:g}),ue=g=>T.get("/attendance/yearly-delay-early-summary/export",{params:g,responseType:"blob"}),ye={class:"space-y-3 px-3 pb-4"},pe={class:"rounded-xl border border-slate-200 bg-white p-3 shadow-sm"},me={class:"grid gap-2 items-end xl:grid-cols-[90px_1.1fr_1.1fr_1fr_1.1fr_110px_130px]"},_e={class:"min-w-0 relative"},be=["value"],ve={class:"min-w-0 relative"},xe=["title"],fe={key:0},he={key:1,class:"text-gray-500 whitespace-nowrap"},ge=["title"],we={class:"min-w-0 relative"},ke=["title"],Se={key:0},De={key:1,class:"text-gray-500 whitespace-nowrap"},Ee=["title"],Ve={class:"min-w-0 relative"},Ae=["title"],Ce={key:0},Le={key:1,class:"text-gray-500 whitespace-nowrap"},Ue=["title"],Fe={class:"min-w-0 relative"},Oe=["disabled"],Re=["disabled"],Ye={class:"rounded-xl border border-slate-200 bg-white shadow-sm"},qe={key:0,class:"py-8"},Te={key:1,class:"empty-state"},Me={key:2,class:"overflow-x-auto table-scroll"},Ne={class:"min-w-full table-auto border-collapse"},$e={class:"sticky top-0 bg-white shadow-sm"},Be={class:"bg-slate-50 text-[11px] text-left"},Je={class:"bg-slate-50 text-[11px] text-left"},je={class:"text-[11px]"},Pe={class:"td"},ze={class:"td font-semibold text-slate-700 whitespace-nowrap"},Ge={class:"td text-center text-red-500 font-bold !text-lg"},He={__name:"YearlyDelayEarlyAttendanceSummary",setup(g){const b=I(),M=ee(),D=te(),w=re(),E=de(),{companies:V,employees:N}=q(w),{departments:U}=q(E),F=new Date().getFullYear(),$=x(()=>Array.from({length:6},(s,t)=>{const e=F-t;return{id:String(e),label:String(e)}})),a=C({year:b.query.year||String(F),company_id:b.query.company_id||"",department_id:b.query.department_id||"",line_type:b.query.line_type||"all",employee_id:b.query.employee_id||""}),k=C([]),p=C(!1),S=[{key:"01",label:"Jan"},{key:"02",label:"Feb"},{key:"03",label:"Mar"},{key:"04",label:"Apr"},{key:"05",label:"May"},{key:"06",label:"Jun"},{key:"07",label:"Jul"},{key:"08",label:"Aug"},{key:"09",label:"Sep"},{key:"10",label:"Oct"},{key:"11",label:"Nov"},{key:"12",label:"Dec"}],B=[{id:"all",label:"All Types"},{id:"executive",label:"Executive"},{id:"support_staff",label:"Support Staff"},{id:"doctor",label:"Doctor"},{id:"academy_body",label:"Academy Body"}],J=x(()=>(V.value||[]).map(s=>({id:String(s.id),label:s.name}))),j=x(()=>(U.value||[]).map(s=>({id:String(s.id),label:s.name}))),O=x(()=>N.value||[]),R=s=>({...s,id:String(s.id),label:s.name||s.label||`${s.first_name??""} ${s.last_name??""}`.trim()}),P=x(()=>{let s=[...O.value];a.value.department_id&&a.value.department_id!=="all"&&(s=s.filter(e=>String(e.department_id)===String(a.value.department_id))),a.value.line_type&&a.value.line_type!=="all"&&(s=s.filter(e=>String(e.type)===String(a.value.line_type)));let t=s.map(R);if(a.value.employee_id&&!t.some(n=>n.id===String(a.value.employee_id))){const n=O.value.find(o=>String(o.id)===String(a.value.employee_id));n&&(t=[R(n),...t])}return t}),A=(s,t)=>{var e;return((e=s==null?void 0:s.months)==null?void 0:e[t])||{score:null,late:0,early:0,total:0}},z=s=>{var e,n,o;const t=(e=S[0])==null?void 0:e.key;return t?((o=(n=s==null?void 0:s.months)==null?void 0:n[t])==null?void 0:o.score)??null:null},G=s=>{const t=Number(s);return Number.isFinite(t)?t.toFixed(2):"-"},c=s=>s%2===0?"month-group-odd":"month-group-even",H=()=>{M.replace({query:{year:a.value.year||void 0,company_id:a.value.company_id||void 0,department_id:a.value.department_id||void 0,line_type:a.value.line_type||void 0,employee_id:a.value.employee_id||void 0}})},Y=async()=>{var s,t,e;if(!a.value.company_id){k.value=[];return}p.value=!0;try{const n={company_id:a.value.company_id,department_id:a.value.department_id||void 0,line_type:a.value.line_type||void 0,employee_id:a.value.employee_id||void 0,year:a.value.year},o=await ce(n);k.value=((s=o==null?void 0:o.data)==null?void 0:s.data)??(o==null?void 0:o.data)??[],H()}catch(n){D.error(((e=(t=n==null?void 0:n.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to load report")}finally{p.value=!1}},Q=async()=>{await Y()},K=async()=>{var s,t;if(!a.value.company_id){D.info("Select a company first.");return}try{const e={company_id:a.value.company_id,department_id:a.value.department_id||void 0,line_type:a.value.line_type||void 0,employee_id:a.value.employee_id||void 0,year:a.value.year},n=await ue(e),o=new Blob([n.data]),m=window.URL.createObjectURL(o),v=document.createElement("a");v.href=m;const W=a.value.department_id||"all",X=`yearly_delay_early_attendance_${a.value.company_id}_${a.value.year}_${W}.xlsx`;v.setAttribute("download",X),document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(m)}catch(e){D.error(((t=(s=e==null?void 0:e.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to export excel")}};return ae(async()=>{await w.fetchCompanies(),!a.value.company_id&&(V.value||[]).length===1&&(a.value.company_id=String(V.value[0].id)),a.value.company_id&&await Promise.all([E.fetchDepartments(a.value.company_id),w.fetchEmployee(a.value.company_id,{with:"department,company"})]),a.value.company_id&&await Y()}),le(()=>a.value.company_id,async s=>{if(a.value.department_id="",a.value.employee_id="",!s){U.value=[];return}await Promise.all([E.fetchDepartments(s),w.fetchEmployee(s,{with:"department,company"})])}),(s,t)=>(d(),r("section",ye,[t[14]||(t[14]=l("header",{class:"rounded-xl border border-slate-200 bg-white px-4 py-3 shadow-sm"},[l("h1",{class:"text-base font-semibold text-slate-900"},"Yearly Delay Early Attendance Summary"),l("p",{class:"text-xs text-slate-500"}," Month-wise late, early, and total with yearly score average. ")],-1)),l("div",pe,[l("div",me,[l("div",_e,[t[5]||(t[5]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Year",-1)),se(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.value.year=e),class:"input-1 h-8 py-0 w-full text-xs"},[(d(!0),r(u,null,f($.value,e=>(d(),r("option",{key:e.id,value:e.id},i(e.label),9,be))),128))],512),[[ne,a.value.year]])]),l("div",ve,[t[6]||(t[6]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Company",-1)),h(L,{modelValue:a.value.company_id,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value.company_id=e),options:J.value,class:"border border-gray-300 rounded h-8 w-full bg-white text-xs",clearable:""},{"selected-option":_(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:e==null?void 0:e.label},[e!=null&&e.label?(d(),r("span",fe,i(e==null?void 0:e.label),1)):(d(),r("span",he,"--Select Company--"))],8,xe)]),option:_(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},i(e.label),9,ge)]),_:1},8,["modelValue","options"])]),l("div",we,[t[7]||(t[7]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Department",-1)),h(L,{modelValue:a.value.department_id,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.department_id=e),options:j.value,class:"border border-gray-300 rounded h-8 w-full bg-white text-xs",clearable:""},{"selected-option":_(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:e==null?void 0:e.label},[e!=null&&e.label?(d(),r("span",Se,i(e==null?void 0:e.label),1)):(d(),r("span",De,"--Select Department--"))],8,ke)]),option:_(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},i(e.label),9,Ee)]),_:1},8,["modelValue","options"])]),l("div",Ve,[t[8]||(t[8]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Line Type",-1)),h(L,{modelValue:a.value.line_type,"onUpdate:modelValue":t[3]||(t[3]=e=>a.value.line_type=e),options:B,class:"border border-gray-300 rounded h-8 w-full bg-white text-xs"},{"selected-option":_(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:e==null?void 0:e.label},[e!=null&&e.label?(d(),r("span",Ce,i(e==null?void 0:e.label),1)):(d(),r("span",Le,"All Types"))],8,Ae)]),option:_(({option:e})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900 whitespace-nowrap",title:e.label},i(e.label),9,Ue)]),_:1},8,["modelValue"])]),l("div",Fe,[t[9]||(t[9]=l("label",{class:"top-label text-[10px] font-semibold uppercase tracking-wide text-slate-500"},"Employee",-1)),h(ie,{modelValue:a.value.employee_id,"onUpdate:modelValue":t[4]||(t[4]=e=>a.value.employee_id=e),employees:P.value,class:"border border-gray-300 rounded h-8 w-full bg-white text-xs"},null,8,["modelValue","employees"])]),l("div",null,[l("button",{class:"btn-2 w-full rounded h-8 text-xs",disabled:p.value,onClick:Q},i(p.value?"Loading...":"Apply"),9,Oe)]),l("div",null,[l("button",{class:"btn-1 rounded h-8 text-xs",disabled:p.value,onClick:K}," Download Excel ",8,Re)])])]),l("div",Ye,[p.value?(d(),r("div",qe,[h(oe)])):k.value.length===0?(d(),r("div",Te,t[10]||(t[10]=[l("p",{class:"text-base font-semibold text-slate-700"},"No data found",-1),l("p",{class:"text-xs text-slate-500"},"Try changing filters or year.",-1)]))):(d(),r("div",Me,[l("table",Ne,[l("thead",$e,[l("tr",Be,[t[11]||(t[11]=l("th",{class:"th w-12",rowspan:"2"},"#",-1)),t[12]||(t[12]=l("th",{class:"th min-w-[180px]",rowspan:"2"},"User",-1)),(d(),r(u,null,f(S,(e,n)=>l("th",{key:e.key,class:y(["th text-center",c(n)]),colspan:"3"},i(e.label),3)),64)),t[13]||(t[13]=l("th",{class:"th text-center",rowspan:"2"},"Score Avg",-1))]),l("tr",Je,[(d(),r(u,null,f(S,(e,n)=>(d(),r(u,{key:e.key},[l("th",{class:y(["th text-center",c(n)])},"Late",2),l("th",{class:y(["th text-center",c(n)])},"Early",2),l("th",{class:y(["th text-center",c(n)])},"Score",2)],64))),64))])]),l("tbody",je,[(d(!0),r(u,null,f(k.value,(e,n)=>(d(),r("tr",{key:e.user_id||n,class:"border-b hover:bg-sky-200"},[l("td",Pe,i(n+1),1),l("td",ze,[l("div",null,i(e.user_name||"-"),1)]),(d(),r(u,null,f(S,(o,m)=>(d(),r(u,{key:o.key},[l("td",{class:y(["td text-center",c(m)])},i(A(e,o.key).late),3),l("td",{class:y(["td text-center",c(m)])},i(A(e,o.key).early),3),l("td",{class:y(["td text-center text-red-500 font-semibold",c(m)])},i(A(e,o.key).total),3)],64))),64)),l("td",Ge,i(G(z(e))),1)]))),128))])])]))])]))}},lt=Z(He,[["__scopeId","data-v-f937af6f"]]);export{lt as default};
