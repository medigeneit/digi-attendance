import{B,r as p,x as P,C as g}from"./index-5QuK440Q.js";const O=B("monthlyKpiForms",()=>{const o=p([]),d=p(null),i=p(!1),s=p(!1),c=p(null),u=p({total:0,per_page:15,current_page:1,last_page:1}),_=p({type:"",month:"",date_from:"",date_to:"",sort_by:"created_at",sort_dir:"desc",per_page:15,page:1}),S=P(()=>u.value.current_page<u.value.last_page),w=P(()=>u.value.current_page>1),m=()=>c.value=null,h=a=>({id:a.id,type:a.type??"",start_month:a.start_month??"",end_month:a.end_month??null,performance_mark:Number(a.performance_mark??0),target_marks:Number(a.target_marks??0),created_at:a.created_at??null,updated_at:a.updated_at??null}),C=a=>{const t={},e=["type","month","date_from","date_to","sort_by","sort_dir","per_page","page"];for(const n of e){const l=a[n];l!=null&&l!==""&&(t[n]=l)}return t.per_page&&(t.per_page=Number(t.per_page)),t.page&&(t.page=Number(t.page)),t},N=a=>({type:String(a.type||"").toLowerCase(),start_month:String(a.start_month||""),end_month:a.end_month?String(a.end_month):null,performance_mark:Number(a.performance_mark??0),target_marks:Number(a.target_marks??0)}),f=a=>{var t,e;return((e=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"Something went wrong"},k=a=>{const t=o.value.findIndex(e=>e.id===a.id);t===-1?o.value.unshift(a):o.value.splice(t,1,a)},x=a=>{const t=o.value.findIndex(e=>e.id===a);t!==-1&&o.value.splice(t,1)};let v=null;async function y(a={}){var n,l;m();const t={..._.value,...a},e=C(t);v&&v.abort(),v=new AbortController,i.value=!0;try{const r=await g.get("/monthly-kpi-forms",{params:e,signal:v.signal}),F=((n=r==null?void 0:r.data)==null?void 0:n.data)??[],b=((l=r==null?void 0:r.data)==null?void 0:l.meta)??{};o.value=F.map(h),u.value={total:b.total??F.length,per_page:b.per_page??t.per_page,current_page:b.current_page??t.page??1,last_page:b.last_page??1},_.value={..._.value,...e,page:u.value.current_page,per_page:u.value.per_page}}catch(r){(r==null?void 0:r.name)!=="CanceledError"&&(r==null?void 0:r.message)!=="canceled"&&(c.value=f(r))}finally{i.value=!1,v=null}}async function L(a){var t;m(),i.value=!0;try{const e=await g.get(`/monthly-kpi-forms/${a}`),n=h(((t=e==null?void 0:e.data)==null?void 0:t.data)??(e==null?void 0:e.data));return d.value=n,k(n),n}catch(e){throw c.value=f(e),e}finally{i.value=!1}}async function I(a){var t;m(),s.value=!0;try{const e=await g.post("/monthly-kpi-forms",N(a)),n=h(((t=e==null?void 0:e.data)==null?void 0:t.data)??(e==null?void 0:e.data));return k(n),n}catch(e){throw c.value=f(e),e}finally{s.value=!1}}async function E(a,t){var e,n;m(),s.value=!0;try{const l=await g.put(`/monthly-kpi-forms/${a}`,N(t)),r=h(((e=l==null?void 0:l.data)==null?void 0:e.data)??(l==null?void 0:l.data));return k(r),((n=d.value)==null?void 0:n.id)===a&&(d.value=r),r}catch(l){throw c.value=f(l),l}finally{s.value=!1}}async function $(a){m(),s.value=!0;try{return await g.delete(`/monthly-kpi-forms/${a}`),x(a),o.value.length===0&&w.value&&await y({page:u.value.current_page-1}),!0}catch(t){throw c.value=f(t),t}finally{s.value=!1}}async function z(a,t=""){var n;const e=await g.get("available-criteria",{params:{q:t}});return((n=e==null?void 0:e.data)==null?void 0:n.data)||[]}async function A(a){return y({page:Number(a)})}async function K(a){return y({per_page:Number(a),page:1})}function q(){o.value=[],d.value=null,u.value={total:0,per_page:15,current_page:1,last_page:1},_.value={type:"",month:"",date_from:"",date_to:"",sort_by:"created_at",sort_dir:"desc",per_page:15,page:1},m(),i.value=!1,s.value=!1}return{items:o,current:d,isLoading:i,isSaving:s,error:c,meta:u,filters:_,hasNextPage:S,hasPrevPage:w,fetchList:y,fetchOne:L,createForm:I,updateForm:E,deleteForm:$,setPage:A,setPerPage:K,reset:q,fetchAvailableCriteria:z}});export{O as u};
