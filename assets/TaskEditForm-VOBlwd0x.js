import{r as b,e as R,A as P,k as G,c as l,o as r,a as t,m as A,f as d,g as _,v as F,t as p,F as f,n as I,l as U,C as S,x,h as g,w as j}from"./index-kQSw102a.js";import{a as B}from"./datetime-q3Sn87-f.js";import{u as K}from"./company-He6FtPOO.js";import{u as Y}from"./useTaskStore-BHmH79dO.js";import{S as $}from"./SectionLoading-C2c07NG1.js";const z={class:"px-4 max-h-[90vh] overflow-auto"},H={class:"sticky top-0 pt-4 -mx-4 px-4 border-b bg-white rounded-t-md"},J={key:0,class:"text-center py-4 text-gray-500"},Q={class:"mb-4"},W={key:0,class:"mb-4"},X={class:"mb-4"},Z={class:"block text-gray-600 text-sm mb-1 font-medium"},D=["label"],ee=["value"],te={class:"mb-4"},se={class:"block text-gray-600 text-sm mb-1 font-medium"},oe=["label"],re=["value"],le={key:2,class:"grid grid-cols-2 gap-4 mb-4"},ie={class:"mb-4"},ne={class:"sticky bottom-0 bg-white py-4 border-t"},ae={key:0,class:"mb-4 text-red-500 font-medium"},de={key:1,class:"mb-4"},ue={class:"flex items-center gap-4"},me=["disabled"],pe={key:0,class:"text-red-500 text-sm"},ge={__name:"TaskEditForm",props:{taskId:{type:[String,Number],required:!0}},emits:["updated","cancel"],setup(M,{emit:L}){const T=M,E=L,c=Y(),k=K(),n=b(),a=b(!1),w=b([]),h=b(""),i=b({title:"",from_department_id:"",to_department_id:"",requirement_id:"",user_ids:[],status:"PENDING",progress:0,description:"",is_important:!1,is_urgent:!1,is_target:!1,started_at:"",deadline:""});R(async()=>{var s;a.value=!0,n.value=(s=await c.fetchTask(T.taskId,{},{fetchOnly:!0,loadingBeforeFetch:!1}))==null?void 0:s.task,await k.fetchCompanies({with:"departments",ignore_permission:!0}),N(n.value),w.value=n.value.users,a.value=!1}),P(()=>n.value,s=>{N(s),w.value=s.users});function N(s){i.value={title:s.title,from_department_id:s.from_department_id,to_department_id:s.to_department_id,requirement_id:s.requirement_id,user_ids:s.users.map(e=>e.id).join(","),status:s.status,progress:s.progress,description:s.description,is_important:s.is_important,is_urgent:s.is_urgent,is_target:s.is_target,started_at:B(s.started_at),deadline:B(s.deadline)}}const O=async()=>{var s,e,v;a.value=!0;try{const u={...i.value,user_ids:((s=w.value)==null?void 0:s.map(y=>Number(y.id)))||[]};console.log({payload:u}),await c.updateTask(T.taskId,u,{loadingBeforeFetch:!1}),E("updated")}catch(u){h.value=((v=(e=u.response)==null?void 0:e.data)==null?void 0:v.message)||"An error occurred while updating the task."}finally{a.value=!1}};return(s,e)=>{var u,y,q,C,V;const v=G("RequiredIcon");return r(),l("div",z,[t("div",H,[e[6]||(e[6]=t("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Edit Task",-1)),a.value?(r(),l("div",J,"Loading form...")):d("",!0)]),a.value?(r(),A($,{key:0})):d("",!0),t("form",{onSubmit:j(O,["prevent"]),class:"my-4"},[t("div",Q,[e[7]||(e[7]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task Title",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.title=o),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,i.value.title]])]),(u=n.value)!=null&&u.requirement?(r(),l("div",W,[e[8]||(e[8]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Requirement",-1)),t("div",null,[t("p",null,p((q=(y=n.value)==null?void 0:y.requirement)==null?void 0:q.title),1)])])):d("",!0),((C=n.value)==null?void 0:C.parent_id)===0?(r(),l(f,{key:1},[t("div",X,[t("label",Z,[e[9]||(e[9]=I(" From Department ")),U(v)]),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.from_department_id=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[10]||(e[10]=t("option",{value:""},"--select department--",-1)),(r(!0),l(f,null,x(g(k).companies,o=>(r(),l("optgroup",{key:o.id,label:o.name},[(r(!0),l(f,null,x(o.departments,m=>(r(),l("option",{value:m.id,key:m.id},p(m.name),9,ee))),128))],8,D))),128))],512),[[S,i.value.from_department_id]])]),t("div",te,[t("label",se,[e[11]||(e[11]=I(" To Department ")),U(v)]),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.to_department_id=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},[e[12]||(e[12]=t("option",{value:""},"--select department--",-1)),(r(!0),l(f,null,x(g(k).companies,o=>(r(),l("optgroup",{key:o.id,label:o.name},[(r(!0),l(f,null,x(o.departments,m=>(r(),l("option",{value:m.id,key:m.id},p(m.name),9,re))),128))],8,oe))),128))],512),[[S,i.value.to_department_id]])])],64)):d("",!0),((V=n.value)==null?void 0:V.children_task_count)===0?(r(),l("div",le,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Status",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.status=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[13]||(e[13]=[t("option",null,"PENDING",-1),t("option",null,"IN_PROGRESS",-1),t("option",null,"COMPLETED",-1),t("option",null,"BLOCKED",-1)]),512),[[S,i.value.status]])])])):d("",!0),t("div",ie,[e[15]||(e[15]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Description",-1)),_(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>i.value.description=o),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[F,i.value.description]])]),t("div",ne,[g(c).error?(r(),l("div",ae,p(g(c).error),1)):d("",!0),g(c).error?(r(),l("hr",de)):d("",!0),t("div",ue,[t("button",{disabled:a.value,type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-semibold px-5 py-2 rounded transition"},p(a.value?"Updating...":"Update Task"),9,me),t("button",{type:"button",onClick:e[5]||(e[5]=o=>E("close")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),h.value?(r(),l("div",pe,p(h.value),1)):d("",!0)])])],32)])}}};export{ge as _};
