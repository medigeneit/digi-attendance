import{r as V,h as B,q as R,x as O,p as P,c as m,o as n,a as t,k as _,j as E,w as T,d,m as k,b,t as c,n as y,F as L,l as j,v as G,G as W,s as H,f as J,u as K}from"./index-k3fRG1Da.js";import{_ as q}from"./CompanyDepartmentSelectInput-LJlftN56.js";import{R as D}from"./RequiredIcon-DHvhmrPu.js";import{b as Q}from"./datetime-y2WWmmYq.js";import{f as X,u as Y}from"./requirement-Bn6WCjL4.js";import{u as Z}from"./company-BetdIvX0.js";import{u as h}from"./tags-1AGAnU12.js";import{L as ee}from"./LoaderView-fwJi9Rs_.js";import{_ as te}from"./DescriptionView-Dfcvv_ig.js";import{S as se}from"./SelectDropdown-CXaZna61.js";import{_ as ae}from"./TextEditor-DSSoaZ2v.js";import{_ as z}from"./UserChip-BLDIZVQ2.js";import"./user-Dt0cSLXv.js";const oe={ref:"containerRef",class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},le={class:"sticky top-0 pt-4 bg-white z-10"},ie={key:0,class:"text-lg font-semibold mb-4 text-center"},re={class:"flex gap-4 items-center justify-center text-gray-500"},ne={class:"text-sm"},de={key:0,class:"flex items-center gap-1"},me={key:0,class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},ue={class:"text-sm flex items-center gap-2 text-red-400 font-semibold"},pe={class:"mt-[2px]"},be={key:0,class:"text-gray-800 flex items-center gap-2"},ve={class:"flex gap-4 items-center justify-center"},ge={class:"mb-4"},ce={class:"text-gray-800"},ye={class:"mb-4"},fe={class:"mb-4"},_e={class:"text-gray-800"},xe={class:"mb-4"},we={key:0,class:"mb-4"},ke={class:"border rounded px-2 py-1 text-gray-600 bg-gray-50"},Ce={class:"block text-gray-600 text-sm mb1 font-medium"},Ve={class:"block text-gray-600 text-sm mb-1 font-medium"},De={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Se={class:"flex items-center justify-between gap-4"},Te=["disabled"],Ue={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(U,{emit:S}){const x=U,w=S,v=h(),u=Z(),l=V(""),i=V(),C=V(""),a=V({from_department_id:"",to_department_id:"",website_tags:[],priority:""});B(async()=>{var s;l.value="loading",v.fetchTags("website"),await u.fetchCompanies({with:"departments",ignore_permission:!0}),await u.fetchMyCompanies({with:"departments"}),i.value=(s=(await X(x.requirementId)).data)==null?void 0:s.requirement,l.value=""}),R(i,function(s){var e;s&&(a.value.title=s.title,a.value.priority=s.priority||"",a.value.description=s.description,a.value.from_department_id=s.from_department_id,a.value.to_department_id=s.to_department_id,Array.isArray(s==null?void 0:s.website_tags)&&((e=s.website_tags)==null?void 0:e.length)>0&&(a.value.website_tags=s.website_tags.map(p=>p.name)))});async function F(){var e,p,f,g;l.value="submitting";const s={...a.value};console.log({payload:s});try{const r=await Y(x.requirementId,s);w("update",r),l.value="created",C.value=(e=r==null?void 0:r.data)==null?void 0:e.message}catch(r){w("error",(p=r==null?void 0:r.response)==null?void 0:p.data),C.value=(g=(f=r==null?void 0:r.response)==null?void 0:f.data)==null?void 0:g.message,l.value="error"}}const A=O(()=>{var s,e;for(let p in u.myCompanies)if((((e=(s=u==null?void 0:u.myCompanies)==null?void 0:s[p])==null?void 0:e.departments)||[]).some(g=>g.id==a.value.from_department_id))return!0;return!1});return(s,e)=>{var f,g,r,I,M,N,$;const p=P("RouterLink");return n(),m("div",oe,[t("div",le,[e[9]||(e[9]=t("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[10]||(e[10]=t("hr",{class:"mb-4"},null,-1)),t("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=T(o=>w("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),i.value?(n(),m("div",ie,[d(te,{"line-clamp":"3",class:"mb-2"},{default:k(()=>[b(c(i.value.title),1)]),btnText:k(({lineClampClass:o})=>[b(c(o?"More":"Less"),1)]),_:1}),t("div",re,[t("div",ne,[e[11]||(e[11]=t("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),b(" "+c(y(Q)(i.value.created_at)),1)]),i.value.created_by?(n(),m("div",de,[e[12]||(e[12]=t("span",{class:"text-gray-400 text-sm"},"By",-1)),d(z,{"avatar-size":"xsmall",user:i.value.created_by,class:"border-sky-300"},null,8,["user"])])):_("",!0)])])):_("",!0),t("form",{onSubmit:T(F,["prevent"]),class:"z-0"},[l.value!=="loading"&&l.value!=="submitting"?(n(),m(L,{key:0},[(f=i.value)!=null&&f.closed_at?(n(),m("div",me,[t("div",ue,[e[13]||(e[13]=t("span",{class:"fad fa-lock"},null,-1)),e[14]||(e[14]=t("span",{class:"mt-[2px]"},"CLOSED AT",-1)),t("span",pe,c(new Date(i.value.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),i.value.closed_by_user?(n(),m("div",be,[e[15]||(e[15]=t("span",{class:"text-sm"},"Closed by",-1)),d(z,{user:i.value.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):_("",!0),t("div",ve,[d(p,{to:{name:"RequirementShow",params:{id:(g=s.req)==null?void 0:g.id}},class:"btn-2 h-6",onClick:e[1]||(e[1]=o=>o.stopPropagation())},{default:k(()=>e[16]||(e[16]=[t("i",{class:"fad fa-eye"},null,-1),b(" Show ")])),_:1,__:[16]},8,["to"])])])):(n(),m(L,{key:1},[t("div",ge,[t("label",ce,[e[17]||(e[17]=b("Title ")),d(D)]),j(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.title=o),required:"",placeholder:"Ender Requirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[G,a.value.title]])]),t("div",ye,[e[19]||(e[19]=t("label",{class:"text-gray-800"},"Priority",-1)),j(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.priority=o),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[18]||(e[18]=[t("option",{value:""},"Normal",-1),t("option",{value:"IMPORTANT"},"Important",-1),t("option",{value:"URGENT"},"Urgent",-1)]),512),[[W,a.value.priority]])]),t("div",fe,[t("label",_e,[e[20]||(e[20]=b("Description ")),d(D)]),d(ae,{modelValue:a.value.description,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.description=o)},null,8,["modelValue"])]),t("div",xe,[e[21]||(e[21]=t("label",{class:"text-gray-800"},"Websites",-1)),d(se,{options:y(v).tags,modelValue:a.value.website_tags,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.website_tags=o),taggable:"",label:"name",value:"name"},null,8,["options","modelValue"])]),A.value?(n(),E(q,{key:1,modelValue:a.value.from_department_id,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.from_department_id=o),companies:((M=y(u))==null?void 0:M.myCompanies)||[],disabled:!!i.value.status,class:"mb-4"},{label:k(()=>[t("label",Ce,[e[23]||(e[23]=b(" From Department ")),d(D)])]),_:1},8,["modelValue","companies","disabled"])):(n(),m("div",we,[e[22]||(e[22]=t("label",{class:"block text-gray-600 text-sm mb1 font-medium"}," From Department ",-1)),t("div",ke,c((I=(r=i.value)==null?void 0:r.from_department)==null?void 0:I.name),1)])),d(q,{modelValue:a.value.to_department_id,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.to_department_id=o),companies:((N=y(u))==null?void 0:N.companies)||[],disabled:!!(($=i.value)!=null&&$.status),class:"mb-4"},{label:k(()=>[t("label",Ve,[e[24]||(e[24]=b(" To Department ")),d(D)])]),_:1},8,["modelValue","companies","disabled"])],64))],64)):_("",!0),t("div",De,[C.value?(n(),m("div",{key:0,class:H(["mb-4 font-medium text-center",{"text-red-500":l.value=="error","text-green-500":l.value=="created"}])},c(C.value),3)):_("",!0),t("div",Se,[t("button",{type:"button",onClick:e[8]||(e[8]=T(o=>w("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),t("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},c(l.value=="submitting"?"Saving...":"Save"),9,Te)])])],32),l.value==="loading"||l.value==="submitting"?(n(),E(ee,{key:1,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):_("",!0)],512)}}},Ie={class:"container mx-auto p-6"},Pe={__name:"RequirementEdit",setup(U){const S=J(),x=K();return(w,v)=>(n(),m("div",Ie,[d(Ue,{requirementId:y(S).params.id,onUpdate:v[0]||(v[0]=()=>y(x).back()),onCancelClick:v[1]||(v[1]=()=>y(x).back())},null,8,["requirementId"])]))}};export{Pe as default};
