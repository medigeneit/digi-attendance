import{L as Z}from"./LoaderView-BywLMY3B.js";import{O as F}from"./OverlyModal-WKWBR2qF.js";import{d as ee}from"./datetime-DcVwRp76.js";import{_ as H}from"./DepartmentChip-BysbHuUC.js";import{_ as te}from"./TaskTreeChildrenTable-B040hdMg.js";import{r as w,A as K,c as p,o as s,a as t,x as V,g as y,t as q,j as se,k as c,p as v,i as E,L as ae,b as ie,u as re,z as J,m as W,e as le,f as T,F as O,y as U,I as ne}from"./index-mZ1aQlf1.js";import{_ as oe}from"./TaskAddForm-nSn61qtO.js";import{_ as de}from"./TaskEditForm-DFDGjIn_.js";import{_ as ue}from"./TaskHeader-BMGVYNJS.js";import{_ as me}from"./TaskUserAssignForm-DUj-OENp.js";import{u as ce}from"./task-priority-BBU8emka.js";import{u as pe}from"./useRequirementStore-ClJl1SKf.js";import{u as fe}from"./useTaskStore-D35e9e--.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./url-CePbr-gY.js";import"./TaskUrgentBadge-DtqLxyUc.js";import"./TaskAssignedUsers-D4J6s8QK.js";import"./UserChip-CLdO7r54.js";import"./TaskStatus-BJuaK4D7.js";import"./RequiredIcon-BOltY9og.js";import"./company-CSRx16lE.js";import"./CompanyDepartmentSelectInput-Cg9rbWt2.js";import"./SelectDropdown-BtOuxwCc.js";import"./SectionLoading-23u3P2La.js";import"./TextWithHr-CByRyzvK.js";import"./TaskUrgencyInput-CfeywSrq.js";import"./tags-Cyiz94p1.js";import"./MultiselectDropdown-DiULR5nU.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DQWy5lGF.js";import"./task-Dbg7V3Q8.js";import"./EmployeeDropdownInput-DD0DmjWT.js";import"./SearchInput-DtHUd19X.js";import"./user-Bjw7-dmA.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-DpaEiyqs.js";import"./TaskUserChip-qu1jNrLo.js";import"./requirement-V8jv8fgE.js";const ke={class:"flex-grow rounded overflow-y-auto"},ye={class:"items-start group"},ve={class:"flex items-start justify-between w-full gap-4"},ge={class:"flex gap-2 flex-grow items-center"},xe={key:0,class:"text-xl font-semibold text-blue-500"},he={class:"font-semibold text-blue-800 line-clamp-1"},be={class:"flex items-center justify-between gap-16 w-full"},_e={class:"flex-shrink-0 flex items-center gap-6"},Te={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},we={class:"text-xs text-gray-400 whitespace-nowrap"},qe={class:"flex items-center gap-2"},Ce={class:"ml-0 col-span-full"},G={__name:"RequirementDetailItemWithTaskList",props:{detail:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number,default:0}},emits:["commentButtonClick","editClick","taskAddClick","employeeAssignClick"],setup(a,{emit:A}){const d=A;function f(i){d("editClick",i)}function N(i){d("employeeAssignClick",i)}const l=w([]),k=localStorage.getItem("sub_task_opened_list");if(k)try{l.value=JSON.parse(k)}catch{l.value=[]}return K(l,i=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(i))},{deep:!0}),(i,n)=>{var u,S,D,C;return s(),p("div",{class:V(["flex w-full text-gray-800 bg-white",{"border-blue-500":a.index%2===0,"border-purple-500":a.index%2===1}])},[t("div",ke,[t("div",ye,[t("div",{class:V(["task-details py-3 shadow-slate-100 flex flex-wrap z-30 pl-3",{"shadow-sm":a.treeLevel>0}])},[t("div",ve,[t("div",ge,[a.index!==void 0?(s(),p("div",xe,q(a.index+1)+". ",1)):y("",!0),t("div",he,q(a.detail.title),1)])]),t("div",be,[t("div",_e,[t("div",Te,[t("div",we,[n[0]||(n[0]=t("i",{class:"fas fa-clock"},null,-1)),se(" "+q(c(ee)((S=(u=a.detail)==null?void 0:u.requirement)==null?void 0:S.submission_date)),1)])]),t("div",qe,[n[1]||(n[1]=t("span",{class:"text-sm text-gray-600"},"From",-1)),v(H,{department:(D=a.detail.requirement)==null?void 0:D.from_department},null,8,["department"]),n[2]||(n[2]=t("span",{class:"text-sm text-gray-600"},"To",-1)),v(H,{department:(C=a.detail.requirement)==null?void 0:C.to_department},null,8,["department"])])])])],2),t("div",Ce,[v(te,{childrenTasks:a.detail.tasks,parentTask:{},isMyTask:a.isMyTask,"hide-buttons":a.hideButtons,"hide-assigned-users":a.hideAssignedUsers,"parent-tree-level":a.treeLevel,onEditClick:f,onEmployeeAssignClick:N,class:"*:mb-0",taskLinkTo:g=>({name:"RequirementTaskShow",params:{id:(g==null?void 0:g.id)||0}})},{"tree-item-end":E(({task:g,level:M})=>[ae(i.$slots,"item-end",{level:M,task:g})]),_:3},8,["childrenTasks","isMyTask","hide-buttons","hide-assigned-users","parent-tree-level","taskLinkTo"])])])])],2)}}},Ie={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},$e={class:"mb-4"},Le={key:4,class:"text-center py-4 text-red-500"},Ae={class:"relative min-h-[20vh]"},Se={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},De={class:"font-semibold flex items-center gap-2"},Me={class:"text-white text-base"},Be={class:"rounded-b-md p-3"},Oe={class:"space-y-3"},Ue={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},xt={__name:"RequirementTaskList",setup(a){const A=fe(),d=pe(),f=ie(),N=re(),l=w(""),k=w(null),i=w(!1),n=J({parentId:0,requirementId:0}),u=J({taskId:0,isOpen:!1}),S=W(()=>{const r=f.query["user-ids"]||null,e=d.requirementDetails.flatMap(m=>(m.tasks||[]).flatMap(x=>{var $;return r?($=x.users)==null?void 0:$.filter(B=>r.includes(B.id)):x.users}));return[...new Map(e.map(m=>[m.id,m])).values()].sort((m,x)=>m.id-x.id)}),D=w(null),C=w([]),{saveTaskPriority:g,listHasRearranged:M}=ce(()=>A.taskListTree,0);le(()=>{console.log("Task List Mounted"),l.value="loading",b()});async function b(){let r;await d.fetchRequirementsWithTasks({...f.query,page:1}),l.value="",C.value=r.query_log||[]}const R=r=>{i.value=!0,n.parentId=r},j=r=>{u.taskId=r,u.isOpen=!0};async function z(){k.value=null,i.value=!1,n.parentId=0,l.value="loading",await b()}async function Q(){i.value=!1,n.parentId=0,await b()}async function X(){l.value="loading",await g()&&await b()}function Y(r){return d.requirementDetails.filter(e=>(e.tasks||[]).some(I=>(I.users||[]).some(m=>m.id===r)))}K(()=>({...f.query}),async()=>{try{A.resetTaskList(),l.value="loading",await b()}catch{console.warn("...")}});const P=W({get(){return{...f.query}},set(r){localStorage.removeItem("sub_task_opened_list"),N.push({query:{...r}})}});return(r,e)=>{var I,m,x,$,B;return s(),p("div",Ie,[k.value?(s(),T(F,{key:0},{default:E(()=>[v(de,{taskId:k.value,onClose:e[0]||(e[0]=o=>k.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):y("",!0),i.value?(s(),T(F,{key:1},{default:E(()=>[v(oe,{parentTaskId:n.parentId,requirementId:n.requirementId,onClose:Q,onTaskCreated:z},null,8,["parentTaskId","requirementId"])]),_:1})):y("",!0),u.isOpen?(s(),T(F,{key:2,class:"*:max-w-4xl"},{default:E(()=>[v(me,{taskId:u.taskId,onCancelClick:e[1]||(e[1]=()=>{u.isOpen=!1,u.taskId=0}),onSuccess:e[2]||(e[2]=()=>{u.isOpen=!1,u.taskId=0,l.value="loading",b()})},null,8,["taskId"])]),_:1})):y("",!0),v(ue,{modelValue:P.value,"onUpdate:modelValue":e[3]||(e[3]=o=>P.value=o),onClickAddTask:R,onClickPrioritySave:X,onClickPriorityDiscard:e[4]||(e[4]=()=>c(M)?D.value.resetItems:null),"list-has-rearranged":c(M),isMyTask:c(f).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((m=(I=c(f))==null?void 0:I.query)==null?void 0:m["query-log"])=="true"?(s(!0),p(O,{key:3},U(C.value,(o,_)=>(s(),p("div",{key:_,class:"text-xs text-gray-500"},[t("div",$e,q(o.raw_query),1)]))),128)):y("",!0),c(d).error?(s(),p("div",Le,q(c(d).error),1)):y("",!0),t("div",Ae,[((x=c(f).query)==null?void 0:x.view)==="userwise"?(s(!0),p(O,{key:0},U(S.value,o=>(s(),p("div",{key:o.id,class:"my-4 rounded-md border-2 border-sky-300"},[t("div",Se,[t("div",De,[v(ne,{user:o},null,8,["user"]),t("div",Me,q(o.label),1)])]),t("div",Be,[t("div",Oe,[(s(!0),p(O,null,U(Y(o.id),(_,h)=>(s(),T(G,{key:_.id,index:h,detail:_,onEditClick:e[5]||(e[5]=L=>k.value=L),onAddClick:e[6]||(e[6]=L=>R(L)),onEmployeeAssignClick:e[7]||(e[7]=L=>j(L)),class:"border rounded-md"},null,8,["index","detail"]))),128))])])]))),128)):(s(!0),p(O,{key:1},U(c(d).requirementDetails,(o,_)=>(s(),T(G,{key:o.id,index:_,detail:o,onEditClick:e[8]||(e[8]=h=>k.value=h),onAddClick:e[9]||(e[9]=h=>R(h)),onEmployeeAssignClick:e[10]||(e[10]=h=>j(h)),class:"border rounded-md my-4"},null,8,["index","detail"]))),128)),l.value!=="loading"&&(($=c(d).requirementDetails)==null?void 0:$.length)===0?(s(),p("div",Ue," No tasks ")):y("",!0),l.value==="loading"?(s(),T(Z,{key:3,class:V(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((B=c(d).requirementDetails)==null?void 0:B.length)===0?"justify-center":""]])},null,8,["class"])):y("",!0)])])}}};export{xt as default};
