import{x as H,c as o,o as n,r as g,h as te,q as Pe,j as m,a as e,i as N,F,e as Q,t as x,m as B,s as P,d as q,M as ne,l as I,w as L,G as J,p as Ne,b as M,k as Le,v as Oe,C as Ee,g as Be,Q as He,y as Me,A as Ue,f as ze,u as Ge}from"./index-RrCjYlRB.js";import{_ as Ve}from"./TextEditor-I1sRiP-K.js";import{s as je,_ as We}from"./TaskAddForm-BioFYeBQ.js";import{u as Ye}from"./useCommentStore-DyRxHlfO.js";import{O as W}from"./OverlyModal-Cl3IkYRx.js";import{_ as Qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{L as re}from"./LoaderView-DRhDy6zl.js";import{_ as Ke}from"./ShareComponent-DkiNhPKX.js";import{_ as Ie}from"./DepartmentChip-GqFmv_1a.js";import{_ as ee}from"./DescriptionView-NHRMrftL.js";import{i as Xe,f as De,a as Je,_ as Ze,b as et}from"./TaskTableRow-D6-mXGbZ.js";import{b as tt,r as st,c as rt,f as le,d as nt,s as at}from"./requirement-DzXo-C1C.js";import{_ as ot}from"./AttachmentPreview-VsaXr1vG.js";import{_ as Z}from"./UserChip-ezBDFo3y.js";import{o as lt}from"./url-CePbr-gY.js";import{u as it}from"./user-BJcisL-J.js";import{_ as In,a as ut}from"./TaskUserAssignForm--TVQ6Hi6.js";import{u as dt}from"./useTaskStore-DPjRdu7e.js";import{_ as mt}from"./TaskSelectionInput-C7lCzHW6.js";import{_ as ct}from"./TaskEditForm-C9anGu8m.js";import{T as ae}from"./TextWithHr-iifP1oDr.js";import{d as oe,b as pt}from"./datetime-Du_mcDA9.js";import{c as vt}from"./dom-Bic1TNqD.js";import{_ as bt}from"./ApproveAndReject-D9ZdKW9B.js";import"./RequiredIcon-LyBsK6eC.js";import"./company-V5v6RvZw.js";import"./CompanyDepartmentSelectInput-CfsIkM5M.js";import"./SelectDropdown-Cg_7aKSy.js";import"./SectionLoading-CWEoVi8x.js";import"./TaskUrgencyInput-DlIkTYH6.js";import"./TaskUrgentBadge-B0NI5fXt.js";import"./TaskTitle-CvIPdghO.js";import"./TaskAssignedUsers-DjpSyPse.js";import"./TaskIsClosedBadge-BFqQBrf4.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-Cnb8Ft93.js";import"./tags-Ol-W9Q08.js";import"./MultiselectDropdown-BDc3Zx0c.js";function ft(b){const a=new DOMParser().parseFromString(b,"text/html"),d=/#(\d+)/g;function c(v){v.childNodes.forEach(l=>{if(l.nodeType===Node.TEXT_NODE){const t=l.textContent.replace(d,(p,S)=>`<a href="/requirement-tasks/${S}" class="text-pink-600 hover:underline font-bold">${p}</a>`);if(t!==l.textContent){const p=document.createElement("span");p.innerHTML=t,l.replaceWith(...p.childNodes)}}else c(l)})}return c(a.body),a.body.innerHTML}function xt(b){const a=new DOMParser().parseFromString(b,"text/html"),d=/(https?:\/\/[^\s]+)/g;function c(v){v.childNodes.forEach(l=>{if(l.nodeType===Node.TEXT_NODE){const t=l.textContent.replace(d,p=>`<a href="${p}" target="_blank" class="text-blue-600 hover:underline">
            ${p}
            <i class="fas fa-external-link text-xs text-blue-600"></i>
          </a>`);if(t!==l.textContent){const p=document.createElement("span");p.innerHTML=t,l.replaceWith(...p.childNodes)}}else c(l)})}return c(a.body),a.body.innerHTML}const yt=["innerHTML"],Fe={__name:"HTMLTextBody",props:{message:{type:String,required:!0}},setup(b){const k=b,a=H(()=>xt(ft(k.message)));return(d,c)=>(n(),o("div",{class:"prose prose-sm max-w-none leading-loose text-sm",innerHTML:a.value},null,8,yt))}},gt={class:"space-y-4"},_t={key:0,class:"space-y-2"},kt={class:"text-xs opacity-80"},ht=["onClick"],wt={class:"space-y-4"},qt={key:0,class:"text-sm text-gray-500"},$t={key:1,class:"text-sm text-gray-500"},Ct={key:0,class:"shrink-0 mt-2"},Tt={class:"bg-inherit bubble-inner px-4 py-3 rounded-md"},St={class:"text-sm font-bold text-gray-800"},Rt={class:"text-xs text-gray-400"},jt=["onClick"],It={key:1,class:"mt-2 space-y-1"},Dt={key:1,class:"shrink-0 mt-2"},At={class:"bg-white rounded-xl shadow-sm border p-4 space-y-3"},Nt={class:"flex items-center gap-2"},Lt={class:"text-sm font-semibold text-gray-700"},Ot={class:"flex items-center justify-end gap-2"},Et=["disabled"],Bt={key:0,class:"text-xs text-red-600"},Mt={class:"bg-white rounded-2xl w-full p-5 space-y-4"},Ut={class:"rounded-xl bg-slate-50 border border-slate-100 p-3 text-sm text-gray-700 max-h-40 overflow-auto"},Vt=["innerHTML"],Ft={__name:"CommentBox",props:{commentableType:{type:String,required:!0},commentableId:{type:[Number,String],required:!0},currentUser:{type:Object,required:!0}},setup(b){const k=b,a=g(!1),d=g(null),c=y=>{d.value=y,a.value=!0},v=()=>{a.value=!1,d.value=null},l=async()=>{if(!d.value)return;const y=d.value.id;v(),await O(y)},t=g([]),p=g({}),S=y=>{y&&t.value.push({id:crypto.randomUUID(),message:y,time:new Date().toISOString()})},u=(y,$)=>{!y||!$||(p.value[y]||(p.value[y]=[]),p.value[y].push($))},s=y=>{p.value[y]=[]},i=Ye(),f=H(()=>i.comments),_=H(()=>i.loading),h=H(()=>i.error),j=g(""),R=g(!1),D=async()=>{await i.fetchComments({commentable_type:k.commentableType,commentable_id:k.commentableId})},A=async()=>{if(!(!j.value||!je(String(j.value)).trim())){R.value=!0;try{await i.createComment({commentable_type:k.commentableType,commentable_id:Number(k.commentableId),user_id:k.currentUser.id,message:j.value}),j.value=""}catch(y){S(y.message)}finally{R.value=!1}}},O=async y=>{var $,r;s(y);try{await i.deleteComment(y)}catch(w){u(y,(r=($=w.response)==null?void 0:$.data)==null?void 0:r.message)}};te(D),Pe(()=>[k.commentableType,k.commentableId],()=>D());const C=y=>y?new Date(y).toLocaleString():"",K=y=>(y==null?void 0:y.user_id)===k.currentUser.id,E=y=>(y==null?void 0:y.user_id)===k.currentUser.id;return(y,$)=>{var r;return n(),o("div",gt,[t.value.length?(n(),o("div",_t,[(n(!0),o(F,null,Q(t.value,w=>(n(),o("div",{key:w.id,class:"rounded-xl border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-700 flex items-start justify-between gap-3"},[e("div",null,[$[1]||($[1]=e("p",{class:"font-semibold"},"Error",-1)),e("p",kt,x(w.message),1)]),e("button",{class:"text-xs text-red-500 hover:underline",onClick:z=>t.value=t.value.filter(U=>U.id!==w.id)}," Dismiss ",8,ht)]))),128))])):m("",!0),e("div",wt,[_.value&&B(i).action=="fetching"?(n(),o("div",qt," Loading comments... ")):f.value.length?m("",!0):(n(),o("div",$t,"No comments yet.")),(n(!0),o(F,null,Q(f.value,w=>{var z,U;return n(),o("div",{key:w.id,class:P(["flex gap-3",E(w)?"justify-end":"justify-start"])},[E(w)?m("",!0):(n(),o("div",Ct,[q(ne,{user:w.user},null,8,["user"])])),e("div",{class:P(["group relative min-w-[25%] max-w-[90%] rounded-md shadow border bubble-arrow",E(w)?"bubble-right bg-indigo-50 border-indigo-100":"bubble-left bg-white border-gray-100"])},[e("div",Tt,[e("div",{class:P(["flex items-center gap-2 mb-2 pb-1 border-b border-dashed",E(w)?"justify-end":"justify-start"])},[e("p",St,x(E(w)?"You":((z=w.user)==null?void 0:z.name)||"Unknown"),1),$[2]||($[2]=e("span",{class:"text-xs text-gray-400"},"•",-1)),e("p",Rt,x(C(w.created_at)),1)],2),q(Fe,{message:w.message},null,8,["message"]),K(w)?(n(),o("div",{key:0,class:P(["mt-2 flex",E(w)?"justify-end":"justify-start"])},[e("button",{class:"text-[11px] text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100",onClick:G=>c(w)}," Delete ",8,jt)],2)):m("",!0),(U=p.value[w.id])!=null&&U.length?(n(),o("div",It,[(n(!0),o(F,null,Q(p.value[w.id],(G,se)=>(n(),o("p",{key:se,class:P(["text-xs text-red-600",E(w)?"text-right":"text-left"])},x(G),3))),128))])):m("",!0)])],2),E(w)?(n(),o("div",Dt,[q(ne,{user:w.user||b.currentUser},null,8,["user"])])):m("",!0)],2)}),128))]),e("div",At,[e("div",Nt,[q(ne,{user:b.currentUser},null,8,["user"]),e("div",Lt,x(((r=b.currentUser)==null?void 0:r.name)||"You"),1)]),q(Ve,{modelValue:j.value,"onUpdate:modelValue":$[0]||($[0]=w=>j.value=w)},null,8,["modelValue"]),e("div",Ot,[e("button",{class:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm disabled:opacity-60",disabled:R.value||!B(je)(String(j.value)).trim(),onClick:A},x(R.value?"Posting...":"Post Comment"),9,Et)]),h.value?(n(),o("p",Bt,x(h.value),1)):m("",!0)]),a.value?(n(),N(W,{key:1},{default:I(()=>{var w;return[e("div",Mt,[$[3]||($[3]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Delete comment?",-1)),$[4]||($[4]=e("p",{class:"text-sm text-gray-600 leading-relaxed"}," আপনি কি নিশ্চিত যে এই কমেন্টটি মুছে ফেলতে চান? মুছে ফেলা কমেন্ট পুনরুদ্ধার করা যাবে না। ",-1)),e("div",Ut,[e("div",{innerHTML:(w=d.value)==null?void 0:w.message},null,8,Vt)]),e("div",{class:"flex items-center justify-end gap-2 pt-2"},[e("button",{class:"px-4 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-50",onClick:v}," Cancel "),e("button",{class:"px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700",onClick:l}," Yes, Delete ")])])]}),_:1})):m("",!0)])}}},Pt=Qe(Ft,[["__scopeId","data-v-44914bc3"]]),Ht={class:"flex items-center border-b w-full pb-2"},zt={class:""},Gt={class:"mt-4 border h-40 flex items-center flex-col justify-center rounded border-dashed bg-red-50 text-center"},Wt={key:1,class:"text-red-500 text-center mt-2"},Yt={class:"flex items-center justify-between mt-4"},Qt={__name:"RequirementAttachmentForm",props:{requirementId:[String,Number],default:()=>null},emits:["uploaded","error","clickBack"],setup(b,{emit:k}){const a=b,d=g({attachments:[]}),c=g(""),v=g(""),l=k;function t(u){d.value.attachments=[...d.value.attachments,...Array.from(u.target.files)]}function p(u){d.value.attachments.splice(u,1)}async function S(){var s,i,f,_;c.value="submitting";const u=new FormData;for(const h in d.value)h==="attachments"?d.value.attachments.forEach(j=>u.append("attachments[]",j)):u.append(h,d.value[h]);try{const h=await tt(a.requirementId,u);d.value.attachments=[],l("uploaded",h),c.value="uploaded"}catch(h){l("error",(i=(s=h.response)==null?void 0:s.data)==null?void 0:i.message),v.value=(_=(f=h.response)==null?void 0:f.data)==null?void 0:_.message,c.value="error"}}return(u,s)=>{var i;return n(),o("form",{class:"p-4 flex flex-col relative",onSubmit:L(S,["prevent"])},[c.value=="submitting"?(n(),N(re,{key:0,class:"absolute inset-0 bg-opacity-80 flex items-center justify-center"})):m("",!0),e("div",Ht,[s[3]||(s[3]=e("h3",null,"Requirement Attachment",-1)),e("button",{class:"btn-icon ml-auto",onClick:s[0]||(s[0]=L(()=>{l("clickBack")},["prevent"]))},s[2]||(s[2]=[e("span",{class:"fas fa-times"},null,-1)]))]),e("div",zt,[e("label",Gt,[s[4]||(s[4]=e("div",{class:"block text-gray-600 font-medium text-sm md:text-xl mb-4"}," Click to Select files or Drop Here ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",class:"border rounded-r-md text-gray-600 bg-gray-50",onChange:t},null,32)])]),q(ot,{files:((i=d.value)==null?void 0:i.attachments)||[],onRemove:p,class:"border p-1 rounded overflow-y-auto flex-grow"},null,8,["files"]),s[6]||(s[6]=e("hr",{class:"mt-4"},null,-1)),v.value?(n(),o("div",Wt,x(v.value),1)):m("",!0),e("div",Yt,[e("button",{class:"btn-3",onClick:s[1]||(s[1]=L(f=>l("clickBack"),["prevent"]))},"Cancel"),s[5]||(s[5]=e("button",{class:"btn-2"},"Save",-1))])],32)}}},Kt={class:"card-bg p-4 pt-2"},Xt={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 w-full"},Jt=["onClick"],Zt=["src"],es=["href"],ts={key:2,class:"text-xs text-gray-500 text-center"},ss={__name:"RequirementAttachments",props:{requirement:{type:Array,default:()=>[]}},setup(b){const k=b,a=H(()=>{var v;return((v=k.requirement)==null?void 0:v.attachments)||[]}),d=J({show:!1}),c=J({show:!1,selectedFile:""});return(v,l)=>(n(),o("div",Kt,[e("div",null,[l[6]||(l[6]=e("h4",{class:"text-gray-900 font-semibold mb-3 border-b font-e"},"Attachments",-1)),e("div",Xt,[a.value&&a.value.length?(n(!0),o(F,{key:0},Q(a.value,(t,p)=>(n(),o("div",{key:p,class:"border p-1 rounded aspect-square flex items-center justify-center bg-gray-50 relative",tabindex:"0",onClick:L(()=>{c.show=!0,c.selectedFile=t},["prevent"])},[B(Xe)(t)?(n(),o("img",{key:0,src:B(De)(t),alt:"attachment",class:"object-cover w-full h-full rounded"},null,8,Zt)):B(Je)(t)?(n(),o("a",{key:1,href:B(De)(t),target:"_blank",class:"text-xs text-blue-600 text-center break-words hover:underline"},l[4]||(l[4]=[e("i",{class:"fas fa-file-pdf fa-2x mb-1 text-amber-700"},null,-1),e("div",{class:"whitespace-nowrap text-xs mt-1"},"Open PDF",-1)]),8,es)):(n(),o("span",ts,"Unknown"))],8,Jt))),128)):m("",!0),e("button",{title:"Add Attachments",onClick:l[0]||(l[0]=L(t=>d.show=!d.show,["prevent"])),class:"border rounded aspect-square flex items-center justify-center bg-sky-50 hover:bg-sky-100 relative group/btn"},l[5]||(l[5]=[e("i",{class:"fas fa-plus-circle text-2xl text-blue-300 group-hover/btn:text-blue-500"},null,-1)]))])]),d.show?(n(),N(W,{key:0},{default:I(()=>[q(Qt,{onClickBack:l[1]||(l[1]=t=>d.show=!1),onUploaded:l[2]||(l[2]=t=>d.show=!1),requirementId:b.requirement.id,class:"max-h-[70vh]"},null,8,["requirementId"])]),_:1})):m("",!0),c.show?(n(),N(W,{key:1,class:"*:max-w-4xl *:min-h-[60vh]"},{default:I(()=>[q(Ze,{attachments:a.value,selected:c.selectedFile,onClickClose:l[3]||(l[3]=t=>c.show=!1)},null,8,["attachments","selected"])]),_:1})):m("",!0)]))}},rs={class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},ns={class:"text-sm flex flex-col xl:flex-row items-center mt-2 xl:mt-0 gap-x-2 text-red-400 font-semibold whitespace-nowrap"},as={class:"mt-[2px]"},os={key:0,class:"text-gray-800 flex items-center gap-2"},ls={key:1,class:"text-gray-800 w-full my-2 text-center"},is={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},us=["innerHTML"],ds={key:1,class:"flex gap-4 items-center justify-center mt-2"},ms={key:2,class:"mb-2"},cs={class:"flex justify-end text-sky-500"},ps={key:3,class:"text-center w-full"},vs={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick","closeClick","showHistoryClick"],setup(b,{emit:k}){const a=k;return(d,c)=>{var v,l;return n(),o("div",rs,[b.requirement.closed_at?(n(),o(F,{key:0},[c[6]||(c[6]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",ns,[c[3]||(c[3]=e("span",{class:"flex items-center gap-2 text-gray-600"},[e("span",{class:"fad fa-lock"}),e("span",{class:"mt-[2px]"},"CLOSED AT")],-1)),e("span",as,x(new Date(b.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),b.requirement.closed_by_user?(n(),o("div",os,[c[4]||(c[4]=e("span",{class:"text-sm"},"Closed by",-1)),q(Z,{user:b.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):m("",!0),b.requirement.closing_note?(n(),o("div",ls,[c[5]||(c[5]=e("div",{class:"text-xs text-left"},"Note",-1)),e("div",is,[e("p",{innerHTML:b.requirement.closing_note},null,8,us)])])):m("",!0)],64)):m("",!0),b.requirement.closed_at?(n(),o("div",ds,[e("button",{class:"btn-2 h-8",onClick:c[0]||(c[0]=L(t=>a("reOpenClick"),["prevent"]))},"Re Open")])):m("",!0),b.requirement.closed_at?m("",!0):(n(),o("div",ms,[e("div",cs,[e("button",{class:"btn-1 border border-sky-800",onClick:c[1]||(c[1]=L(t=>a("closeClick"),["prevent"]))}," Close Requirement ")])])),((l=(v=b.requirement)==null?void 0:v.closing_history)==null?void 0:l.length)>1?(n(),o("div",ps,[e("button",{onClick:c[2]||(c[2]=t=>a("showHistoryClick")),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):m("",!0)])}}},bs={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},fs={class:"my-6"},xs={class:"text-center font-semibold text-blue-800 mb-4"},ys={class:"text-center my-1"},gs={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},_s={class:"mt-4"},ks=["placeholder","required"],hs={class:"flex"},ws={class:"text-red-600 text-center mt-2 text-sm"},qs={class:"flex justify-between mt-3"},$s=["disabled"],Cs={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(b,{emit:k}){const a=b,d=k,c=H({get:()=>a.loading,set:()=>d("update:loading")}),v=g(""),l=g(""),t=g(255),p=H(()=>t.value-v.value.length);async function S(){var u,s,i;c.value=!0;try{(u=a.requirement)!=null&&u.closed_at?await st(a.requirement.id,v.value):await rt(a.requirement.id,v.value),d("updateStatus")}catch(f){l.value=(i=(s=f.response)==null?void 0:s.data)==null?void 0:i.message,d("error")}finally{c.value=!1}}return(u,s)=>{var f,_,h,j,R;const i=Ne("LoaderView");return n(),o("form",{class:"p-4 rounded relative border",onSubmit:L(S,["prevent"])},[c.value?(n(),N(i,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:I(()=>s[3]||(s[3]=[M(" Submitting! ")])),_:1,__:[3]})):m("",!0),e("h3",bs,x((f=b.requirement)!=null&&f.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",fs,[e("div",xs,x((_=b.requirement)==null?void 0:_.title),1),s[6]||(s[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",ys,[s[4]||(s[4]=M(" Want to ")),e("span",gs,x((h=b.requirement)!=null&&h.closed_at?"Re-Open":"Close"),1),s[5]||(s[5]=M(" the requirement? "))]),e("div",_s,[Le(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=D=>v.value=D),rows:"4",placeholder:`Write about why are you ${(j=b.requirement)!=null&&j.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:u.currentAction==="reject",onInput:s[1]||(s[1]=D=>v.value.length>t.value?v.value=v.value.slice(0,t.value):null)},null,40,ks),[[Oe,v.value]]),e("div",hs,[e("div",{class:P(["ml-auto inline-block text-sm text-gray-500",v.value.length>=t.value?"text-red-500":""])}," left "+x(p.value)+"/"+x(t.value)+" words ",3)])])]),s[7]||(s[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",ws,x(l.value),1),e("div",qs,[e("button",{class:"btn-3",onClick:s[2]||(s[2]=L(D=>d("clickCancel"),["prevent"]))},"Cancel"),e("button",{class:"btn-2 disabled:opacity-45",disabled:v.value.trim().length==0},x((R=b.requirement)!=null&&R.closed_at?"Re-Open Requirement":"Close Requirement"),9,$s)])])],32)}}};async function Ts(b,k,{params:a={}}={}){return Ee.get(`/requirements/${b}/details/${k}`,{params:a})}async function Ss(b,k,{params:a={}}={}){const d=lt(a);return Ee.delete(`/requirements/${b}/details/${k}${d?"?"+d:""}`)}const Rs={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},js={class:"mb-4"},Is={class:"font-semibold"},Ds={class:"mb-4"},As={class:"line-clamp-2"},Ns={key:1,class:"min-h-40"},Ls={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Os={key:0,class:"mb-4 text-red-500 font-medium"},Es={key:1,class:"mb-4"},Bs={class:"flex items-center justify-between gap-4"},Ms=["disabled"],Us={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(b,{emit:k}){const a=b,d=k,c=it(),v=g(null),l=g(""),t=g(),p=g([]);async function S(){var u,s;l.value="submitting";try{const i=await Ss(a.requirementId,a.detailId);d("delete",i),l.value="create"}catch(i){l.value="error",t.value=((s=(u=i.response)==null?void 0:u.data)==null?void 0:s.message)||"Failed to update requirement detail: "+i,d("error",t.value)}}return te(async()=>{var u,s,i;l.value="loading";try{p.value=await c.fetchDepartmentWiseEmployees(),v.value=(u=(await Ts(a.requirementId,a.detailId)).data)==null?void 0:u.detail}catch(f){t.value=((i=(s=f.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to fetch requirement detail"}finally{l.value=""}}),(u,s)=>{var i,f;return n(),o("div",Rs,[s[4]||(s[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:L(S,["prevent"]),class:"z-0"},[l.value!=="loading"?(n(),o(F,{key:0},[e("div",js,[s[1]||(s[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Is,x((i=v.value)==null?void 0:i.title),1)]),e("div",Ds,[s[2]||(s[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",As,x((f=v.value)==null?void 0:f.description),1)]),s[3]||(s[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),o("div",Ns)),e("div",Ls,[t.value?(n(),o("div",Os,x(t.value),1)):m("",!0),t.value?(n(),o("hr",Es)):m("",!0),e("div",Bs,[e("button",{type:"button",onClick:s[0]||(s[0]=L(_=>d("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},x(l.value=="submitting"?"Deleting...":"Delete"),9,Ms)])])],32),l.value==="loading"||l.value==="submitting"?(n(),N(re,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):m("",!0)])}}};const Vs={class:"sticky top-0 pt-4 bg-white z-10"},Fs={class:"mb-4"},Ps={class:"mb-4"},Hs={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},zs={key:0,class:"mb-4 text-red-500 font-medium"},Gs={key:1,class:"mb-4"},Ws={class:"flex items-center justify-between gap-4"},Ys=["disabled"],Qs={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(b,{emit:k}){const a=b,d=k,c=g(),v=g(null),l=g(""),t=g(),p=g({feedback:""});async function S(){var u,s;l.value="submitting";try{const i=await nt(a.requirementId,p.value.feedback);d("update",i),l.value="create"}catch(i){l.value="error",t.value=((s=(u=i.response)==null?void 0:u.data)==null?void 0:s.message)||"Failed to update requirement requirement",d("error",t.value)}}return te(async()=>{var u,s,i,f;l.value="loading";try{await le(a.requirementId),v.value=(u=(await le(a.requirementId)).data)==null?void 0:u.requirement,p.value={feedback:(s=v.value)==null?void 0:s.feedback}}catch(_){t.value=((f=(i=_.response)==null?void 0:i.data)==null?void 0:f.message)||"Failed to fetch requirement requirement"}finally{l.value=""}}),(u,s)=>{var i;return n(),o("div",{ref_key:"formContainerRef",ref:c,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Vs,[s[3]||(s[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),s[4]||(s[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:s[0]||(s[0]=L(f=>d("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:L(S,["prevent"]),class:"z-0"},[l.value!=="loading"?(n(),o(F,{key:0},[e("div",Fs,[s[5]||(s[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),q(ee,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:I(()=>{var f;return[M(x((f=v.value)==null?void 0:f.title),1)]}),_:1})]),e("div",Ps,[s[6]||(s[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),q(Ve,{modelValue:p.value.feedback,"onUpdate:modelValue":s[1]||(s[1]=f=>p.value.feedback=f)},null,8,["modelValue"])])],64)):m("",!0),e("div",Hs,[t.value?(n(),o("div",zs,x(t.value),1)):m("",!0),t.value?(n(),o("hr",Gs)):m("",!0),e("div",Ws,[e("button",{type:"button",onClick:s[2]||(s[2]=L(f=>d("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:l.value=="loading"||l.value=="submitting",type:"submit",class:"btn-2"},x(l.value=="submitting"?"Saving...":(i=v.value)!=null&&i.feedback?"Update Feedback":"Add Feedback"),9,Ys)])])],32),l.value==="loading"||l.value==="submitting"?(n(),N(re,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):m("",!0)],512)}}},Ks={class:"flex justify-center items-center"},Xs={class:"modal-card"},Js=["required"],Zs={class:"flex"},er={class:"flex justify-between gap-2 mt-4"},tr=["disabled"],sr=["disabled"],rr={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(b,{emit:k}){const a=b,d=k,c=g(255),v=H(()=>c.value-u.value.length),l=He(),t=g(null),p=g(null),S=g(null),u=g(""),s=g(!1),i=H(()=>S.value!==null);function f(D){S.value=D,u.value="",R()}function _(){S.value=null,u.value=""}async function h(){var D,A;if(S.value==="reject"&&!u.value)return l.error("Rejection Reason is required!");if(typeof a.onSubmit=="function")return a.onSubmit({note:u.value,action:S.value});d("loading",!0),s.value=!0;try{await at(a.requirementId,{note:u.value}),d("success"),_()}catch(O){return d("error",O),l.error(((A=(D=O==null?void 0:O.response)==null?void 0:D.data)==null?void 0:A.message)||"Submission failed!")}finally{d("loading",!1),s.value=!1}}function j(D){var A,O;i.value&&(D.key==="ArrowLeft"?(A=p.value)==null||A.focus():D.key==="ArrowRight"&&((O=t.value)==null||O.focus()))}function R(){Ue(()=>{var D;(D=t.value)==null||D.focus()})}return te(()=>{window.addEventListener("keydown",j)}),Me(()=>{window.removeEventListener("keydown",j)}),(D,A)=>(n(),o("div",null,[e("div",Ks,[e("button",{onClick:A[0]||(A[0]=O=>f("accept"))},A[3]||(A[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),i.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:L(_,["self"])},[e("div",Xs,[A[4]||(A[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Le(e("textarea",{"onUpdate:modelValue":A[1]||(A[1]=O=>u.value=O),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:S.value==="reject",onInput:A[2]||(A[2]=O=>u.value.length>c.value?u.value=u.value.slice(0,c.value):null)},null,40,Js),[[Oe,u.value]]),e("div",Zs,[e("div",{class:P(["ml-auto inline-block text-sm text-gray-500",u.value.length>=c.value?"text-red-500":""])}," left "+x(v.value)+"/"+x(c.value)+" words ",3)])]),e("div",er,[e("button",{ref_key:"cancelBtnRef",ref:p,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:_,disabled:s.value}," Cancel ",8,tr),e("button",{ref_key:"confirmBtnRef",ref:t,class:P(["focus:ring-2 ring-offset-2 disabled:opacity-30",S.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:h,disabled:s.value}," Confirm Submission ",10,sr)])])])):m("",!0)]))}},nr={class:"flex items-center gap-6 justify-center my-16"},ar={key:0,class:"border rounded-md"},or={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(b,{emit:k}){const a=b,d=k,c=dt(),v=g(""),l=g(null),t=g(""),p=g(!1);async function S(){await c.setTaskRequirement(t.value,a.requirement.id),d("assignTask")}return(u,s)=>(n(),o("div",{class:P(["text-left p-4",[v.value&&!l.value?"min-h-[400px]":""]])},[e("div",nr,[e("button",{onClick:s[0]||(s[0]=L(i=>d("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),s[5]||(s[5]=e("span",null,"or",-1)),e("button",{class:P({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:s[1]||(s[1]=L(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value&&!l.value?(n(),o("div",ar,[e("form",{onSubmit:L(S,["prevent"]),class:"p-4 flex items-end"},[q(mt,{class:"flex-grow mr-4 h-12",taskId:t.value,"onUpdate:taskId":s[2]||(s[2]=i=>t.value=i),show:p.value,"onUpdate:show":s[3]||(s[3]=i=>p.value=i),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":b.fromDepartmentId},filterTasks:i=>!i.requirement_id,onAddNewTaskClick:s[4]||(s[4]=i=>d("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),s[6]||(s[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):m("",!0)],2))}},lr={class:"flex flex-col items-center gax-x-1 justify-end"},ir={key:0},ur={key:1},dr={class:"text-sm text-gray-600 whitespace-normal w-64"},mr={class:"text-gray-900 font-semibold text-sm md:text-base"},cr={class:"ml-2"},pr={key:0,class:"text-red-700 text-sm"},vr={key:1,class:"text-green-600 ml-2"},br={key:2,class:"ml-2 text-yellow-700"},Ae={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(b,{emit:k}){const a=b,d=k,c=Be(),v=H(()=>{var u,s,i,f,_;return{from_in_charge:!!((u=a.requirement)!=null&&u.status&&((s=a.requirement)!=null&&s.submission_date)),from_coordinator:!!((i=a.requirement)!=null&&i.from_coordinator),to_in_charge:!!((f=a.requirement)!=null&&f.to_incharge),to_coordinator:!!((_=a.requirement)!=null&&_.to_coordinator)}}),l=H(()=>{var u,s,i,f,_,h,j,R;return{from_in_charge:(s=(u=a.requirement)==null?void 0:u.from_department)==null?void 0:s.in_charge,from_coordinator:(f=(i=a.requirement)==null?void 0:i.from_department)==null?void 0:f.coordinator,to_in_charge:(h=(_=a.requirement)==null?void 0:_.to_department)==null?void 0:h.in_charge,to_coordinator:(R=(j=a.requirement)==null?void 0:j.to_department)==null?void 0:R.coordinator}}),t=H(()=>{var f;const u=Object.keys(v.value),s=u.indexOf(a.approvalType);let i=!0;for(let _=s-1;_>=0;_--){const h=u[_];i=i&&(l.value[h]?(f=v.value)==null?void 0:f[h]:!0)}return i}),p=H(()=>{var h,j,R,D,A,O,C,K,E,y,$,r,w,z,U,G;let u=null,s=null,i="",f="";a.approvalType==="from_in_charge"&&(u=(h=a.requirement)==null?void 0:h.from_department,s=(R=(j=a.requirement)==null?void 0:j.from_department)==null?void 0:R.in_charge,i="In Charge",f=(D=a.requirement)==null?void 0:D.from_incharge_note),a.approvalType==="from_coordinator"&&(u=(A=a.requirement)==null?void 0:A.from_department,s=(O=a.requirement)==null?void 0:O.from_coordinator,i="Coordinator",f=(C=a.requirement)==null?void 0:C.from_coordinator_note),a.approvalType==="to_in_charge"&&(u=(K=a.requirement)==null?void 0:K.to_department,s=(E=a.requirement)==null?void 0:E.to_in_charge,i="In Charge",f=(y=a.requirement)==null?void 0:y.to_incharge_note),a.approvalType==="to_coordinator"&&(u=($=a.requirement)==null?void 0:$.to_department,s=(r=a.requirement)==null?void 0:r.to_coordinator,i="Coordinator",f=(w=a.requirement)==null?void 0:w.to_coordinator_note);const _=(z=l.value)==null?void 0:z[a.approvalType];return{department:u,department_user:_,approved:(U=v.value)==null?void 0:U[a.approvalType],approval_user:s,is_rejected:((G=a.requirement)==null?void 0:G.rejected_by_user_id)==(_==null?void 0:_.id),userType:i,approval_note:f}});function S(){d("updateApproval")}return(u,s)=>{var i,f,_,h,j,R;return n(),o("div",lr,[p.value.department_user?(n(),o("div",ir,[q(Z,{user:p.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),o("div",ur,s[0]||(s[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",dr,[p.value.is_rejected?(n(),N(ee,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:I(()=>[M(x(b.requirement.rejection_reason),1)]),_:1})):(n(),N(ee,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:I(()=>[M(x(p.value.approval_note),1)]),_:1}))]),e("div",null,[!p.value.is_rejected&&!p.value.approved&&t.value&&((i=B(c).user)==null?void 0:i.id)==((_=(f=p.value)==null?void 0:f.department_user)==null?void 0:_.id)?(n(),N(bt,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(h=a.requirement)==null?void 0:h.id,onSuccess:S,variant:1},null,8,["applicationId"])):m("",!0)]),s[2]||(s[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",mr,[e("span",null,x(((j=p.value.department)==null?void 0:j.short_name)||((R=p.value.department)==null?void 0:R.name)),1),e("span",cr,x(p.value.userType),1),p.value.department_user?(n(),o(F,{key:0},[p.value.is_rejected?(n(),o("span",pr," (Rejected)")):p.value.approved?(n(),o("span",vr,"(✔)")):(n(),o("span",br,s[1]||(s[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):m("",!0)])])}}},fr={class:"container mx-auto print:p-0 w-full print:max-w-full"},xr={class:"border-b px-3 py-1 bg-gray-50 flex items-center justify-between rounded-t-md"},yr={key:0,class:"p-3 max-h-[50vh] overflow-auto"},gr={class:"border table-auto w-full"},_r={class:"border-y px-4 py-2 text-right"},kr={class:"border-y pr-4 py-2 whitespace-nowrap"},hr={class:"border-y px-4 py-2"},wr={class:"line-clamp-2 text-sm text-amber-950"},qr={class:"border-y px-4 py-2 text-center"},$r={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},Cr={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},Tr={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},Sr={class:"text-center text-xl font-bold mb-2 flex items-center"},Rr={class:"mb-8"},jr={class:"text-lg font-semibold mb-2"},Ir={class:"flex gap-4 items-center text-gray-500"},Dr={class:"text-sm"},Ar={key:0,class:"flex items-center gap-1"},Nr={key:0,class:"mb-5"},Lr={class:"mb-8"},Or={class:"font-semibold text-lg px-2"},Er={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},Br={class:"w-full border-collapse"},Mr={key:0},Ur={class:"mb-8"};const Vr={key:2,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Fr={class:"flex flex-col items-end"},Pr={key:3,class:"mt-6 mb-8 break-before-avoid-page"},Hr={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},zr={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},Gr={class:"bg-white shadow rounded-lg space-y-4 p-4 mb-4"},Wr={class:"border col-span-3 p-3 rounded-md"},Yr={class:"flex items-center gap-2 mb-4"},Qr={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},Kr={class:"flex items-center gap-2 mb-4"},Xr={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},Jr={class:"font-bold print:text-gray-900"},Zr={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},en={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},tn={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},sn={class:"print:text-gray-900 text-sm text-right"},rn={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},nn={class:"print:text-gray-900 text-sm text-right"},an={class:"flex justify-between items-center mb-4"},on={class:"mb-4"},ln={class:"flex justify-between items-center"},un={key:1,class:"text-red-600"},dn={key:0,class:"mb-2"},mn={class:"flex justify-between items-center"},cn={key:1,class:"mb-4 text-red-700 text-sm flex justify-between"},pn={key:2,class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},Jn={__name:"RequirementShow",setup(b){const k=ze(),a=Ge(),d=g(""),c=Be(),v=g(),l=g(!1),t=g(null),p=J({detail:null,open:!1}),S=J({detail:null,open:!1}),u=J({detail:null,open:!1}),s=g(!1),i=()=>s.value=!0,f=()=>s.value=!1,_=g(),h=g({isOpen:!1,taskId:null});te(async()=>{await R(),window.addEventListener("beforeprint",i),window.addEventListener("afterprint",f),window.addEventListener("resize",j),await Ue(),vt(v.value,()=>{})});function j(){}Me(()=>{window.removeEventListener("beforeprint",i),window.removeEventListener("afterprint",f),window.removeEventListener("resize",j)});async function R(){var $;d.value="loading",t.value=($=(await le(k.params.id)).data)==null?void 0:$.requirement,d.value=""}function D(){var $,r,w,z,U,G,se,ie,ue;if(c.user.role!=="super_admin"&&(($=c.user)==null?void 0:$.id)!==((w=(r=t.value)==null?void 0:r.to_department)==null?void 0:w.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(U=(z=t.value)==null?void 0:z.to_department)==null?void 0:U.name}'s In charge can create or assign.`);console.log({requirement:t}),C.modalShown=!0,C.from_department_id=t.value.from_department_id,C.to_department_id=t.value.to_department_id,C.taskDefaultValues={title:"",description:"",from_department_id:t.value.from_department_id,to_department_id:t.value.to_department_id,is_important:((G=t.value)==null?void 0:G.priority)=="IMPORTANT",is_urgent:((se=t.value)==null?void 0:se.priority)=="URGENT",supervisor_ids:(ie=t.value)!=null&&ie.supervisor_id?[(ue=t.value)==null?void 0:ue.supervisor_id]:[]},C.requirement=t.value}function A($){p.open=!0,p.detail=$}function O($){u.open=!0,u.detail=$}const C=J({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function K(){_.value=null,C.modalShown=!1,await R()}async function E(){C.modalShown=!1,C.requirement=null,C.creating=!1}const y=g({open:!1});return($,r)=>{var z,U,G,de,me,ce,pe,ve,be,fe,xe,ye,ge,_e,ke,he,we,qe,$e,Ce,Te,Se;const w=Ne("RouterLink");return n(),o("div",fr,[S.open?(n(),N(W,{key:0},{default:I(()=>{var T;return[q(Qs,{requirementId:t.value.id,detailId:(T=S.requirement.value)==null?void 0:T.id,onCloseClick:r[0]||(r[0]=Y=>S.open=!1),onUpdate:r[1]||(r[1]=async()=>{S.open=!1,await R()})},null,8,["requirementId","detailId"])]}),_:1})):m("",!0),u.open?(n(),N(W,{key:1},{default:I(()=>{var T;return[q(Us,{requirementId:t.value.id,detailId:(T=u.requirement.value)==null?void 0:T.id,onCloseClick:r[2]||(r[2]=Y=>u.open=!1),onDelete:r[3]||(r[3]=async()=>{u.open=!1,await R()})},null,8,["requirementId","detailId"])]}),_:1})):m("",!0),C.modalShown?(n(),N(W,{key:2,class:"*:relative"},{default:I(()=>{var T,Y;return[e("button",{onClick:L(E,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},r[20]||(r[20]=[e("i",{class:"fas fa-times-circle"},null,-1)])),C!=null&&C.creating?m("",!0):(n(),N(or,{key:0,"from-department-id":(T=t.value)==null?void 0:T.from_department_id,requirement:C==null?void 0:C.requirement,onCancelClick:E,onAddNewTaskClick:r[4]||(r[4]=()=>{C.modalShown=!0,C.creating=!0}),onAssignTask:K},null,8,["from-department-id","requirement"])),C!=null&&C.creating?(n(),N(We,{key:1,requirementDetailId:(Y=C==null?void 0:C.requirement.value)==null?void 0:Y.id,requirementId:t.value.id,onClose:E,onTaskCreated:K,defaultValues:C.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):m("",!0)]}),_:1})):m("",!0),_.value?(n(),N(W,{key:3},{default:I(()=>[q(ct,{taskId:_.value,onClose:r[5]||(r[5]=T=>_.value=null),onUpdated:K},null,8,["taskId"])]),_:1})):m("",!0),h.value.isOpen?(n(),N(W,{key:4,class:"*:max-w-4xl"},{default:I(()=>[q(ut,{taskId:h.value.taskId,onCancelClick:r[6]||(r[6]=()=>{h.value.isOpen=!1,h.value.taskId=0}),onSuccess:r[7]||(r[7]=()=>{h.value.isOpen=!1,h.value.taskId=0,d.value="loading",R()})},null,8,["taskId"])]),_:1})):m("",!0),y.value.open?(n(),N(W,{key:5},{default:I(()=>[q(Cs,{requirement:t.value,onClickCancel:r[8]||(r[8]=T=>y.value.open=!1),onUpdateStatus:r[9]||(r[9]=()=>{R(),y.value.open=!1})},null,8,["requirement"])]),_:1})):m("",!0),l.value?(n(),N(W,{key:6},{default:I(()=>{var T,Y,X,Re;return[e("div",xr,[r[22]||(r[22]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon size-8",onClick:r[10]||(r[10]=L(V=>l.value=!1,["prevent"]))},r[21]||(r[21]=[e("i",{class:"fas fa-times"},null,-1)]))]),(T=t.value)!=null&&T.closing_history&&((X=(Y=t.value)==null?void 0:Y.closing_history)!=null&&X.length)?(n(),o("div",yr,[e("table",gr,[r[23]||(r[23]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-right"},"Close/Open"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status")])],-1)),e("tbody",null,[(n(!0),o(F,null,Q(((Re=t.value)==null?void 0:Re.closing_history)||[],V=>(n(),o("tr",{key:V.at,class:"text-sm"},[e("td",_r,x(V==null?void 0:V.type),1),e("td",kr,x(V.at?B(oe)(V.at):""),1),e("td",hr,[e("div",wr,x(V==null?void 0:V.closing_note),1)]),e("td",qr,x(V==null?void 0:V.status),1)]))),128))])])])):m("",!0)]}),_:1})):m("",!0),e("div",$r,[t.value?(n(),o("div",Cr,[e("div",Tr,[e("div",Sr,[e("button",{class:"btn-3 h-8 px-4",onClick:r[11]||(r[11]=L(()=>B(a).back(),["prevent"]))},"Back"),r[24]||(r[24]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),r[39]||(r[39]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",Rr,[e("div",null,[e("div",jr,[q(ee,{"line-clamp":"3",class:"mb-2"},{default:I(()=>[M(x(t.value.title),1)]),btnText:I(({lineClampClass:T})=>[M(x(T?"More":"Less"),1)]),_:1}),e("div",Ir,[e("div",Dr,[r[25]||(r[25]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),M(" "+x(B(oe)(t.value.created_at)),1)]),t.value.created_by?(n(),o("div",Ar,[r[26]||(r[26]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),q(Z,{"show-details-on-avatar-hover":B(c).isAdminMood,"avatar-size":"xsmall",user:t.value.created_by,class:"border-sky-300"},null,8,["show-details-on-avatar-hover","user"])])):m("",!0)])]),t.value.description?(n(),o("div",Nr,[r[27]||(r[27]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),q(ee,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:I(()=>[q(Fe,{message:t.value.description},null,8,["message"])]),_:1})])):m("",!0)])]),e("div",Lr,[q(ae,{class:"mb-4"},{default:I(()=>[e("h2",Or,[r[28]||(r[28]=e("span",null,"Task List ",-1)),t.value.status=="approved"?(n(),o("span",{key:0,class:P(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":t.value.tasks_count>0&&t.value.completed_tasks_count==t.value.tasks_count,"text-red-700 font-semibold":t.value.tasks_count==0||t.value.completed_tasks_count!=t.value.tasks_count}]])}," ("+x(t.value.completed_tasks_count)+"/"+x(t.value.tasks_count)+" task(s) done) ",3)):m("",!0)])]),_:1}),e("div",Er,[e("table",Br,[r[30]||(r[30]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[d.value!="loading"&&((U=(z=t.value)==null?void 0:z.tasks)==null?void 0:U.length)===0?(n(),o("tr",Mr,r[29]||(r[29]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),o(F,{key:1},Q(((G=t.value)==null?void 0:G.tasks)||[],(T,Y)=>(n(),N(et,{key:T.id,task:T,indexing:Y+1,class:"*:py-3 *:border-b-0",onEditClick:r[12]||(r[12]=X=>_.value=X),onEmployeeAssignClick:r[13]||(r[13]=X=>{h.value.isOpen=!0,h.value.taskId=X})},null,8,["task","indexing"]))),128))])])])]),e("div",Ur,[q(ae,{class:"mb-4"},{default:I(()=>r[31]||(r[31]=[e("h2",{class:"font-semibold text-lg px-2"},"Comments",-1)])),_:1,__:[31]}),q(Pt,{"commentable-type":"requirement","commentable-id":t.value.id,"current-user":B(c).user},null,8,["commentable-id","current-user"])]),m("",!0),(t.value,m("",!0)),d.value!="loading"&&!((de=t.value)!=null&&de.status)?(n(),o("div",Vr,[e("div",Fr,[q(rr,{"requirement-id":(me=t.value)==null?void 0:me.id,onSuccess:R},{heading:I(()=>r[35]||(r[35]=[M(" Requirement Submission ")])),acceptButtonLabel:I(()=>r[36]||(r[36]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),M("Submit Requirement ")],-1)])),submitButtonLabel:I(()=>r[37]||(r[37]=[M(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):m("",!0),(ce=t.value)!=null&&ce.status?(n(),o("div",Pr,[q(ae,null,{default:I(()=>r[38]||(r[38]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[38]}),e("div",Hr,[(n(),o(F,null,Q(["from_in_charge","from_coordinator"],T=>q(Ae,{class:"pt-12",key:T,requirement:t.value,"approval-type":T,onUpdateApproval:r[15]||(r[15]=()=>R())},null,8,["requirement","approval-type"])),64))]),((pe=t.value)==null?void 0:pe.from_department_id)!==((ve=t.value)==null?void 0:ve.to_department_id)?(n(),o("div",zr,[(n(),o(F,null,Q(["to_in_charge","to_coordinator"],T=>q(Ae,{class:"pt-12",key:T,requirement:t.value,"approval-type":T,onUpdateApproval:r[16]||(r[16]=()=>R())},null,8,["requirement","approval-type"])),64))])):m("",!0)])):m("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:v},[e("div",Gr,[e("div",Wr,[e("div",null,[e("div",Yr,[r[40]||(r[40]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),q(Ie,{department:(be=t.value)==null?void 0:be.from_department,"short-name":!0},null,8,["department"])]),r[41]||(r[41]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",Qr,[(fe=t.value)!=null&&fe.supervisor?(n(),N(Z,{key:0,"show-details-on-avatar-hover":B(c).isAdminMood,user:(xe=t.value)==null?void 0:xe.supervisor},null,8,["show-details-on-avatar-hover","user"])):m("",!0)])]),r[43]||(r[43]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Kr,[r[42]||(r[42]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),q(Ie,{department:(ye=t.value)==null?void 0:ye.to_department,"short-name":!0},null,8,["department"])])])]),e("div",Xr,[r[44]||(r[44]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",Jr,x((ge=t.value)==null?void 0:ge.id),1)]),((ke=(_e=t.value)==null?void 0:_e.website_tags)==null?void 0:ke.length)>0?(n(),o("div",Zr,[r[45]||(r[45]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",en,[(n(!0),o(F,null,Q(((he=t.value)==null?void 0:he.website_tags)||[],T=>(n(),o("div",{key:T.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},x(T.name),1))),128))])])):m("",!0),(we=t.value)!=null&&we.submission_date?(n(),o("div",tn,[r[46]||(r[46]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",sn,x(B(oe)((qe=t.value)==null?void 0:qe.submission_date)),1)])):m("",!0),($e=t.value)!=null&&$e.better_to_complete_on?(n(),o("div",rn,[r[47]||(r[47]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",nn,x(B(pt)((Ce=t.value)==null?void 0:Ce.better_to_complete_on,{weekDay:"long"})),1)])):m("",!0),e("div",null,[e("div",an,[r[48]||(r[48]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:P(["font-semibold text-sm",{"text-yellow-600 ":t.value.priority=="IMPORTANT","text-red-700 ":t.value.priority=="URGENT"}])},x(t.value.priority||"NORMAL"),3)])]),e("div",on,[e("div",ln,[r[49]||(r[49]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),t.value.status?(n(),o("span",{key:0,class:P(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":t.value.status!="approved","bg-green-300 text-green-700 border-green-400":t.value.status=="approved"}])},x(String(t.value.status).toUpperCase()),3)):(n(),o("span",un,"..."))])]),t.value.rejected_by?(n(),o("div",dn,[e("div",mn,[r[50]||(r[50]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),q(Z,{user:t.value.rejected_by},null,8,["user"])])])):m("",!0),t.value.rejection_reason?(n(),o("div",cn,[r[51]||(r[51]=e("p",{class:"text-gray-600 mb-1"},"Reason:",-1)),e("p",null,x(t.value.rejection_reason),1)])):m("",!0),r[54]||(r[54]=e("hr",{class:"mb-3"},null,-1)),(Te=t.value)!=null&&Te.closed_at?m("",!0):(n(),o("div",pn,[t.value.status=="approved"?(n(),o("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:L(D,["prevent"])},r[52]||(r[52]=[e("i",{class:"fas fa-plus text-sm"},null,-1),M(" Add/Assign Task ")]))):m("",!0),q(w,{class:"btn-2 h-8",to:`/requirements/edit/${(Se=t.value)==null?void 0:Se.id}`},{default:I(()=>r[53]||(r[53]=[M(" Edit ")])),_:1,__:[53]},8,["to"])]))])]),q(vs,{requirement:t.value,onReOpenClick:r[17]||(r[17]=T=>y.value.open=!0),class:"mb-4 card-bg bg-white",onCloseClick:r[18]||(r[18]=T=>y.value.open=!0),onShowHistoryClick:r[19]||(r[19]=T=>l.value=!l.value)},null,8,["requirement"]),q(ss,{requirement:t.value,class:"mb-4"},null,8,["requirement"]),q(Ke,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3",ref:"shareComponent"},null,512)],512)])):m("",!0),d.value==="loading"?(n(),N(re,{key:1,class:"absolute inset-0 bg-opacity-90"})):m("",!0)])])}}};export{Jn as default};
