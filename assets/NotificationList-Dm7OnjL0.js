import{u as C,N as q,s as L,r as h,b as I,x as E,o as i,c as _,d as B,v as O,a as r,e as l,t as S,h as b,F as Z,q as K,p as Q,k as W,j as A,m,g as X,f as Y,n as M}from"./index-BMFUpxpI.js";import{u as G}from"./leave-application-BTFi9wsy.js";import{u as ee}from"./exchange-BMnhvFmx.js";import{u as ae}from"./short-leave-DxWj2VoU.js";const te={key:0,class:"text-center space-y-2 print:hidden"},oe={key:0,class:"mt-2"},ne={class:"flex justify-end gap-2 pt-2"},re={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(R){const f=C(),p=q(),y=ee(),{user:x}=L(f),k=R,t=h(null);I(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=h(!1),c=h(""),j=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.handoverAccept(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.inChargeAccept(a),await e()),alert("In-Charge approved!")}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await y.recommendByAccept(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure to final approval?")&&(await y.approvedByAccept(a),await e())}}],o=E(()=>j.find(a=>{var n,d,g,w;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((g=t.value)!=null&&g[a.approved_field])&&((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id:!1})),s=()=>{u.value&&c.value?(v(),u.value=!1):u.value=!0};async function v(){try{await y.rejectExchange(t.value.id,c.value),alert("Exchange application rejected!"),c.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await p.markAsRead(k.notificationId)}return(a,n)=>o.value&&t.value?(i(),_("div",te,[u.value?(i(),_("div",oe,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):l("",!0),r("div",ne,[r("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))}," Approve "),r("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:s}," Reject ")])])):l("",!0)}},se={key:0,class:"text-center space-y-2 print:hidden"},ie={key:0,class:"mt-2"},le={class:"flex justify-end gap-2 pt-2"},P={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(R){const f=C(),p=G(),y=q(),{user:x}=L(f),k=R,t=h(null);I(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=h(!1),c=h(""),j=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptHandover(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptInCharge(a),await e())}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptCoordinator(a),await e())}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptOperationalAdmin(a),await e())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptRecommendBy(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.acceptApprovedBy(a),await e())}}],o=E(()=>j.find(a=>{var g,w,$,N;if(!t.value)return!1;if(a.key==="handover")return a.condition();const n=!!((g=t.value)!=null&&g[a.approved_field]),d=((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id;return(($=t.value)==null?void 0:$.status)!=="Rejected"&&((N=t.value)==null?void 0:N.status)!=="Approved"&&!n&&d})),s=()=>{u.value&&c.value?(v(),u.value=!1):u.value=!0};async function v(){try{await p.rejectLeaveApplication(t.value.id,{rejection_reason:c.value}),alert("Application rejected!"),c.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await y.markAsRead(k.notificationId)}return(a,n)=>o.value&&t.value?(i(),_("div",se,[u.value?(i(),_("div",ie,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):l("",!0),r("div",le,[r("button",{class:"btn-2",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))},"Approve"),r("button",{class:"btn-1",onClick:s},"Reject")])])):l("",!0)}},ce={key:0,class:"text-center space-y-2 print:hidden"},de={key:0,class:"mt-2"},pe={class:"flex justify-end gap-2 pt-2"},ue={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(R){const f=C(),p=ae(),y=q(),{user:x}=L(f),k=R,t=h(null);I(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=h(!1),c=h(""),j=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.handoverAccept(a),await e())},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===x.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.inChargeAccept(a),await e())}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.recommendByAccept(a),await e())}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{confirm("Are you sure you want to approve?")&&(await p.approvedByAccept(a),await e())}}],o=E(()=>j.find(a=>{var n,d,g,w;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((d=t.value)==null?void 0:d.status)!=="Approved"&&!((g=t.value)!=null&&g[a.approved_field])&&((w=t.value)==null?void 0:w[a.approved_by_field])===x.value.id:!1})),s=()=>{u.value&&c.value?(v(),u.value=!1):u.value=!0};async function v(){try{await p.rejectShortLeave(t.value.id,c.value),alert("Application rejected!"),c.value="",await e(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function e(a){await y.markAsRead(k.notificationId)}return(a,n)=>o.value&&t.value?(i(),_("div",ce,[u.value?(i(),_("div",de,[B(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=d=>c.value=d),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[O,c.value]])])):l("",!0),r("div",pe,[u.value?l("",!0):(i(),_("button",{key:0,class:"btn-2",onClick:n[1]||(n[1]=d=>o.value.action(t.value.id))}," Approve ")),r("button",{class:"btn-1",onClick:s},S(u.value?"Submit":"Reject"),1)])])):l("",!0)}},_e={class:"space-y-6 px-4 py-4"},ve={class:"text-2xl font-semibold capitalize text-gray-700"},fe={key:0,class:"space-y-4"},ye={class:"flex items-start gap-4"},he={class:"text-2xl text-blue-500"},ge={class:"flex-1"},we={class:"flex gap-8"},be={class:"text-gray-800 font-medium"},xe={key:0,class:"flex gap-2 text-sm"},ke={key:0,class:"text-gray-800 font-medium"},Ae={class:"text-red-600 text-sm font-semibold"},Se={key:1,class:"text-xs text-gray-400"},je={key:0,class:"grid gap-1"},Re={class:"flex items-center gap-4"},me=["href"],$e={class:"grow-0 w-full"},Ne={key:0,class:"text-xs font-semibold"},Le={class:"text-xs text-gray-400"},Ce={key:1,class:"text-center text-red-500 py-10"},Oe={__name:"NotificationList",setup(R){X();const f=Y(),p=q(),{notifications:y}=L(p);G();const x=C();L(x),h(!1),h({}),h({}),I(()=>{p.fetchNotifications()});const k=(o,s)=>{if(!o)return"application not found";switch(s){case"leaveApplication":return`Last Office ( ${o.last_working_date} ) → Join Date ( ${o.resumption_date} )`;case"shortLeave":return`Short Leave on ${o.date} form ${j(o.start_time)??"N/A"} to ${o.end_time?j(o.end_time):"N/A"}`;case"shift":return o.exchange_type==="shift"?`Exchange (${o.exchange_type}) on ${o.current_date} (${(o==null?void 0:o.shift_name)??"No Shift"})`:`Exchange (${o.exchange_type})`;case"offday":return o.exchange_type==="offday"?`Exchange (Offday): ${o.exchange_date} → ${o.current_date}`:`Exchange (${o.exchange_type})`;case"manualAttendance":const v=o.check_in?c(o.check_in):"N/A",e=o.check_out?c(o.check_out):"N/A";return`Checked in (${v}) → Checked out (${e})`;default:return"Unknown Event"}},t=o=>{switch(o){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"manualAttendance":return"fas fa-clock";case"exchange":return"fas fa-random";case"offday":return"fas fa-random";default:return"fas fa-bell"}},u=o=>new Date(o).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});function c(o){const s={year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"2-digit",hour12:!0};return new Date(o).toLocaleString("en-US",s)}const j=o=>{const[s,v]=o.split(":").map(Number),e=new Date;return e.setHours(s,v),e.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(o,s)=>{const v=M("RouterLink");return i(),_("div",_e,[r("h2",ve,S(b(f).query.type.replace(/([A-Z])/g," $1")),1),b(y)[b(f).query.type]?(i(),_("div",fe,[(i(!0),_(Z,null,K(b(y)[b(f).query.type],(e,a)=>{var n,d,g,w,$,N,T,D,J,U,V,H,z,F;return i(),_("div",{key:e.id,class:"bg-white p-4 rounded-xl shadow border"},[r("div",ye,[r("div",he,[r("i",{class:Q(t(e.event_type))},null,2)]),r("div",ge,[r("div",we,[r("p",be,S((n=e.event_model)==null?void 0:n.user_name),1),e!=null&&e.monthly_short_leave_count?(i(),_("p",xe,[r("strong",null,"Pending: "+S((e==null?void 0:e.monthly_short_leave_count.Pending)||0),1),s[0]||(s[0]=W("/ ")),r("strong",null,"Approved: "+S(e==null?void 0:e.monthly_short_leave_count.Approved),1)])):l("",!0)]),(d=e.event_model)!=null&&d.reason?(i(),_("p",ke," Reason: "+S((g=e.event_model)==null?void 0:g.reason),1)):l("",!0),r("p",Ae,S(k(e.event_model,e.event_type)),1),(w=e==null?void 0:e.event_model)!=null&&w.total_leave_days_without_week?(i(),_("p",Se," Total Leave: "+S(e==null?void 0:e.event_model.total_leave_days_without_week)+" days ",1)):l("",!0)]),e!=null&&e.event_model?(i(),_("div",je,[r("div",Re,[e!=null&&e.event_model.attachment?(i(),_("a",{key:0,href:($=e==null?void 0:e.event_model)==null?void 0:$.attachment,target:"_blank",class:"btn-1"},s[1]||(s[1]=[r("i",{class:"fad fa-link"},null,-1)]),8,me)):l("",!0),b(f).query.type==="leaveApplication"?(i(),A(v,{key:1,to:{name:"LeaveApplicationShow",params:{id:(N=e==null?void 0:e.event_model)==null?void 0:N.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:m(()=>s[2]||(s[2]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),b(f).query.type==="shortLeave"?(i(),A(v,{key:2,to:{name:"ShortLeaveShow",params:{id:(T=e==null?void 0:e.event_model)==null?void 0:T.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:m(()=>s[3]||(s[3]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),b(f).query.type==="exchange"?(i(),A(v,{key:3,to:{name:((D=e==null?void 0:e.event_model)==null?void 0:D.exchange_type)=="offday"?"ExchangeOffdayShow":"ExchangeShiftShow",params:{id:(J=e==null?void 0:e.event_model)==null?void 0:J.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:m(()=>s[4]||(s[4]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),b(f).query.type==="offday"?(i(),A(v,{key:4,to:{name:"ExchangeOffdayShow",params:{id:(U=e==null?void 0:e.event_model)==null?void 0:U.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:m(()=>s[5]||(s[5]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),b(f).query.type==="shift"?(i(),A(v,{key:5,to:{name:"ExchangeShiftShow",params:{id:(V=e==null?void 0:e.event_model)==null?void 0:V.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:m(()=>s[6]||(s[6]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0),b(f).query.type==="manualAttendance"?(i(),A(v,{key:6,to:{name:"ExchangeShiftShow",params:{id:(H=e==null?void 0:e.event_model)==null?void 0:H.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:m(()=>s[7]||(s[7]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):l("",!0)]),r("div",$e,[(z=e==null?void 0:e.event_model)!=null&&z.type?(i(),_("p",Ne," Type : "+S((F=e==null?void 0:e.event_model)==null?void 0:F.type),1)):l("",!0),r("p",Le,S(u(e.created_at)),1)])])):l("",!0)]),e!=null&&e.event_model&&e.event_type==="leaveApplication"?(i(),A(P,{key:0,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):l("",!0),e!=null&&e.event_model&&e.event_type==="manualAttendance"?(i(),A(P,{key:1,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):l("",!0),e!=null&&e.event_model&&e.event_type==="shortLeave"?(i(),A(ue,{key:2,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):l("",!0),e!=null&&e.event_model&&(e.event_type==="offday"||e.event_type==="shift")?(i(),A(re,{key:3,application:e.event_model,notificationId:e.id},null,8,["application","notificationId"])):l("",!0)])}),128))])):(i(),_("div",Ce,"No notifications found."))])}}};export{Oe as default};
