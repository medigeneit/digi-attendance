import{_ as Ie,R as Ne,f as Oe,u as Fe,r as m,h as ve,y as me,x as N,q as pe,c as o,o as a,l as ge,a as t,d as fe,I as xe,t as c,k as v,b as r,i as ze,m as He,w as O,z as Pe,O as Be,T as Ve,A as qe,af as Re}from"./index-D75smV2Z.js";import{L as Ue}from"./LoaderView-y7dXlN9V.js";import{u as Ye}from"./useDisciplineReportStore-AJbPTIeR.js";import{n as Ze}from"./notice-CXWxBjIl.js";const Ke={class:"my-container py-6 print:px-0"},We={class:"sticky top-0 z-40 border-b bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60"},Xe={class:"mx-auto max-w-6xl px-3 py-2 flex items-center justify-between gap-2"},Ge={class:"flex items-center gap-2 min-w-0"},Je={class:"truncate font-medium text-sm text-gray-800"},Qe={class:"flex items-center gap-2"},et={class:"mx-auto max-w-6xl"},tt={class:"rounded-2xl overflow-hidden bg-white shadow-sm ring-1 ring-gray-100"},st={class:"px-6 py-5 flex items-start justify-between gap-4"},lt={class:"min-w-0"},nt=["innerHTML"],ot={class:"mt-2 flex flex-wrap items-center gap-2 text-xs text-gray-500"},at={class:"font-medium text-gray-700"},it={key:0},rt={class:"font-medium text-gray-700"},dt={key:1},ut={class:"font-medium text-gray-700"},ct={class:"shrink-0 flex flex-col items-end gap-2"},vt={key:0,class:"badge-amber",title:"Pending acknowledgment"},mt={key:1,class:"badge-emerald",title:"Acknowledged"},pt={class:"hidden md:flex items-center gap-2"},gt={class:"mt-6 grid grid-cols-1 lg:grid-cols-12 gap-6"},ft={class:"lg:col-span-8 space-y-6"},xt={key:0,class:"rounded-2xl bg-white shadow-sm ring-1 ring-gray-100"},yt={class:"px-6 py-5"},bt={key:0},wt={key:1,class:"rounded-lg bg-red-50 text-red-700 px-4 py-3"},kt={key:2},ht=["innerHTML"],_t=["innerHTML"],Ct={key:2,class:"text-gray-500 text-sm"},Dt={key:1,class:"rounded-2xl bg-white shadow-sm ring-1 ring-gray-100 overflow-hidden"},At={class:"px-6 py-4 md:flex items-center justify-between"},$t={class:"px-6 pb-6"},Lt={key:0,class:"relative rounded-xl overflow-hidden border bg-gray-50"},Mt={key:0,class:"aspect-video w-full animate-pulse bg-gray-200","aria-hidden":"true"},Et=["src"],St={key:1,class:"p-6 flex items-center justify-between"},Tt={class:"flex items-center gap-3 text-gray-700"},jt={class:"text-sm text-gray-500 break-all"},It={class:"flex items-center gap-2"},Nt={key:2,class:"absolute top-2 right-2 flex items-center gap-2"},Ot={class:"flex items-center justify-between px-4 py-2 border-t bg-white"},Ft=["title"],zt={class:"flex items-center gap-2"},Ht={key:1,class:"rounded-xl overflow-hidden border bg-white relative"},Pt=["src"],Bt={class:"absolute top-2 right-2 flex items-center gap-2"},Vt={class:"flex items-center justify-between px-4 py-2 border-t bg-white"},qt={class:"truncate text-sm text-gray-700"},Rt={class:"flex items-center gap-2"},Ut={key:2,class:"rounded-xl bg-gray-50 p-4 border flex items-center justify-between"},Yt=["title"],Zt={class:"flex items-center gap-2"},Kt={class:"lg:col-span-4 space-y-6"},Wt={class:"rounded-2xl bg-white shadow-sm ring-1 ring-gray-100"},Xt={class:"px-6 py-5 space-y-3"},Gt={class:"grid grid-cols-2 gap-3 text-sm"},Jt={class:"rounded-lg bg-gray-50 p-3"},Qt={class:"font-medium text-gray-800"},es={class:"rounded-lg bg-gray-50 p-3"},ts={class:"font-medium text-gray-800"},ss={class:"rounded-lg bg-gray-50 p-3 col-span-2"},ls={class:"font-medium text-gray-800"},ns={class:"pt-3 flex flex-wrap gap-2"},os={key:0,class:"chip chip-amber"},as={key:1,class:"chip chip-emerald"},is={class:"px-6 pb-5 flex flex-col gap-2"},rs={class:"rounded-2xl bg-white shadow-sm ring-1 ring-gray-100"},ds={class:"px-6 py-5"},us={class:"mt-4 space-y-3"},cs={key:0,class:"rounded-xl bg-emerald-50 border border-emerald-200 px-4 py-3 text-emerald-800"},vs={class:"flex items-start gap-3"},ms={class:"text-sm mt-0.5"},ps={key:0},gs=["disabled"],fs={class:"flex items-center md:mt-14 justify-end p-3 text-white"},xs={class:"flex items-center gap-2"},ys={class:"px-2 text-sm"},bs=["src","alt"],ws={__name:"DisciplineAttachmentDetails",setup(ks){const M=Ye(),_=Ne(),F=Oe(),ye=Fe(),n=m(null),y=m(!0),b=m(null),z=m(!1),H=()=>{const s=window.scrollY||document.documentElement.scrollTop;z.value=s>160};ve(()=>window.addEventListener("scroll",H,{passive:!0})),me(()=>window.removeEventListener("scroll",H));const E=s=>s?new Date(s).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A",P=s=>!!s&&/\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(s),be=s=>!!s&&/\.pdf$/i.test(s),d=s=>(s==null?void 0:s.split("/").pop())||"file",l=N(()=>{var s,e,i;return((s=n.value)==null?void 0:s.file)||((e=n.value)==null?void 0:e.file_url)||((i=n.value)==null?void 0:i.url)||""}),D=N(()=>{var s,e;return!!((s=n.value)!=null&&s.acknowledged_at)||!!((e=n.value)!=null&&e.acknowledged_by)}),we=async()=>{var s,e;try{y.value=!0,b.value=null;const i=F.params.id,w=await M.showAttachment(i);n.value=w}catch(i){b.value=((e=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to load attachment details",_.error(b.value)}finally{y.value=!1}},ke=async()=>{var e,i,w;const s=((e=n.value)==null?void 0:e.id)||F.params.id;if(!(!s||D.value))try{y.value=!0,await M.acknowledgeAttachment(s);const x=await M.showAttachment(s);n.value=x,_.success("Attachment acknowledged")}catch(x){b.value=((w=(i=x==null?void 0:x.response)==null?void 0:i.data)==null?void 0:w.message)||"Failed to acknowledge",_.error(b.value)}finally{y.value=!1}};pe(()=>n.value,s=>{Re({title:(s==null?void 0:s.title)||"Discipline Attachment",meta:[{property:"og:title",content:(s==null?void 0:s.title)||"Discipline Attachment"},{property:"og:image",content:l.value||Ze},{property:"og:description",content:(s==null?void 0:s.note)||(s==null?void 0:s.description)||""}]})},{immediate:!0});const f=s=>s&&window.open(s,"_blank","noopener,noreferrer"),g=(s,e="")=>{if(!s)return;const i=document.createElement("a");i.href=s,i.download=e,document.body.appendChild(i),i.click(),i.remove()},S=async()=>{try{await navigator.clipboard.writeText(window.location.href),_.success("Link copied to clipboard")}catch{_.error("Failed to copy link")}},he=()=>window.print(),_e=()=>ye.back(),A=m(!1),k=m(!1),Ce=()=>{A.value=!1,k.value=!1};pe(()=>l.value,s=>{if(Ce(),P(s)){const e=new Image;e.onload=()=>A.value=!0,e.onerror=()=>k.value=!0,e.src=s}},{immediate:!0});const De=N(()=>{const s=l.value||"";return s?s.includes("#")?s:`${s}#toolbar=0&navpanes=0&view=FitH`:""}),$=m(!1),B=m(null),p=m(1),h=m({x:0,y:0}),C=m(!1),T=m({x:0,y:0}),j=m({x:0,y:0}),I=s=>{s.key==="Escape"&&L()},Ae=()=>document.documentElement.classList.add("overflow-hidden"),V=()=>document.documentElement.classList.remove("overflow-hidden"),$e=()=>{$.value=!0,p.value=1,h.value={x:0,y:0},Ae(),document.addEventListener("keydown",I),qe(()=>{var s;return(s=B.value)==null?void 0:s.focus()})},L=()=>{$.value=!1,C.value=!1,V(),document.removeEventListener("keydown",I)},Le=()=>p.value=Math.min(p.value*1.2,8),Me=()=>p.value=Math.max(p.value/1.2,.25),Ee=()=>{p.value=p.value===1?2:1,p.value===1&&(h.value={x:0,y:0})},Se=s=>{const e=s.deltaY>0?-.1:.1;p.value=Math.min(Math.max(p.value+e,.25),8)},Te=s=>{$.value&&(C.value=!0,T.value={x:s.clientX,y:s.clientY},j.value={...h.value})},je=s=>{C.value&&(h.value={x:j.value.x+(s.clientX-T.value.x),y:j.value.y+(s.clientY-T.value.y)})},q=()=>C.value=!1;return me(()=>{document.removeEventListener("keydown",I),V()}),ve(we),(s,e)=>{var i,w,x,R,U,Y,Z,K,W,X,G,J,Q,ee,te,se,le,ne,oe,ae,ie,re,de,ue,ce;return a(),o("div",Ke,[ge(t("div",We,[t("div",Xe,[t("div",Ge,[t("button",{class:"text-gray-500 hover:text-indigo-600",onClick:_e,title:"Back"},e[20]||(e[20]=[t("i",{class:"far fa-arrow-left"},null,-1)])),t("div",Je,c(((w=(i=n.value)==null?void 0:i.title)==null?void 0:w.replace(/<[^>]*>?/gm,""))||"Discipline Attachment"),1)]),t("div",Qe,[t("button",{class:"btn",onClick:S},e[21]||(e[21]=[t("i",{class:"far fa-link mr-1"},null,-1),r("Copy")])),l.value?(a(),o("button",{key:0,class:"btn",onClick:e[0]||(e[0]=u=>f(l.value))},e[22]||(e[22]=[t("i",{class:"far fa-arrow-up-right-from-square mr-1"},null,-1),r("Open ")]))):v("",!0),l.value?(a(),o("button",{key:1,class:"btn",onClick:e[1]||(e[1]=u=>g(l.value,d(l.value)))},e[23]||(e[23]=[t("i",{class:"far fa-download mr-1"},null,-1),r("Download ")]))):v("",!0),t("button",{class:"btn-primary",onClick:he},e[24]||(e[24]=[t("i",{class:"far fa-print mr-1"},null,-1),r("Print")]))])])],512),[[xe,z.value&&n.value]]),t("div",et,[t("div",tt,[e[34]||(e[34]=t("div",{class:"h-1 bg-gradient-to-r from-indigo-600 via-sky-500 to-emerald-400"},null,-1)),t("div",st,[t("div",lt,[e[28]||(e[28]=t("div",{class:"text-[11px] uppercase tracking-wider text-gray-500"},"Discipline Attachment",-1)),t("h1",{class:"mt-1 text-xl md:text-2xl font-semibold text-gray-900 leading-snug",innerHTML:((x=n.value)==null?void 0:x.title)||"Attachment Details"},null,8,nt),t("div",ot,[t("span",null,[e[25]||(e[25]=r(" Created: ")),t("span",at,c(E((R=n.value)==null?void 0:R.created_at)),1)]),(U=n.value)!=null&&U.month_start?(a(),o("span",it,[e[26]||(e[26]=r(" - Month: ")),t("span",rt,c((Y=n.value)==null?void 0:Y.month_start),1)])):v("",!0),(Z=n.value)!=null&&Z.user_name||(K=n.value)!=null&&K.employee_name?(a(),o("span",dt,[e[27]||(e[27]=r(" - Employee: ")),t("span",ut,c(((W=n.value)==null?void 0:W.user_name)||((X=n.value)==null?void 0:X.employee_name)),1)])):v("",!0)])]),t("div",ct,[D.value?(a(),o("span",mt,e[30]||(e[30]=[t("i",{class:"far fa-check"},null,-1),r(" Acknowledged ")]))):(a(),o("span",vt,e[29]||(e[29]=[t("span",{class:"h-2 w-2 rounded-full bg-amber-500"},null,-1),r(" Pending Acknowledgment ")]))),t("div",pt,[t("button",{class:"btn",onClick:S},e[31]||(e[31]=[t("i",{class:"far fa-link mr-1"},null,-1),r("Copy")])),l.value?(a(),o("button",{key:0,class:"btn",onClick:e[2]||(e[2]=u=>f(l.value))},e[32]||(e[32]=[t("i",{class:"far fa-arrow-up-right-from-square mr-1"},null,-1),r("Open ")]))):v("",!0),l.value?(a(),o("button",{key:1,class:"btn",onClick:e[3]||(e[3]=u=>g(l.value,d(l.value)))},e[33]||(e[33]=[t("i",{class:"far fa-download mr-1"},null,-1),r("Download ")]))):v("",!0)])])])]),t("div",gt,[t("div",ft,[(G=n.value)!=null&&G.description||(J=n.value)!=null&&J.note||(Q=n.value)!=null&&Q.body_html?(a(),o("div",xt,[t("div",yt,[y.value?(a(),o("div",bt,[fe(Ue,{class:"shadow-none"})])):b.value?(a(),o("div",wt,c(b.value),1)):(a(),o("div",kt,[(ee=n.value)!=null&&ee.description||(te=n.value)!=null&&te.note?(a(),o("div",{key:0,class:"prose max-w-none prose-img:my-0 text-gray-800",innerHTML:((se=n.value)==null?void 0:se.description)||((le=n.value)==null?void 0:le.note)},null,8,ht)):(ne=n.value)!=null&&ne.body_html?(a(),o("div",{key:1,class:"prose max-w-none prose-img:my-0 text-gray-800",innerHTML:(oe=n.value)==null?void 0:oe.body_html},null,8,_t)):(a(),o("div",Ct,"No description provided."))]))])])):v("",!0),l.value?(a(),o("div",Dt,[t("div",At,[e[35]||(e[35]=t("div",{class:"text-sm font-semibold text-gray-800 flex items-center gap-2"},[t("i",{class:"far fa-paperclip"}),r(" Attachment ")],-1)),t("button",{class:"text-sm underline text-indigo-600 truncate hover:text-indigo-700",onClick:e[4]||(e[4]=u=>g(l.value,d(l.value)))}," Download ("+c(d(l.value))+") ",1)]),t("div",$t,[P(l.value)?(a(),o("div",Lt,[!A.value&&!k.value?(a(),o("div",Mt)):v("",!0),ge(t("img",{src:l.value,alt:"Attachment",loading:"lazy",class:"w-full max-h-[70vh] object-contain select-none",onClick:$e},null,8,Et),[[xe,A.value&&!k.value]]),k.value?(a(),o("div",St,[t("div",Tt,[e[37]||(e[37]=t("i",{class:"far fa-triangle-exclamation text-red-500 text-lg"},null,-1)),t("div",null,[e[36]||(e[36]=t("p",{class:"font-medium"},"Failed to load image",-1)),t("p",jt,c(d(l.value)),1)])]),t("div",It,[t("button",{class:"btn",onClick:e[5]||(e[5]=u=>f(l.value))},"Open"),t("button",{class:"btn-primary",onClick:e[6]||(e[6]=u=>g(l.value,d(l.value)))},"Download")])])):v("",!0),k.value?v("",!0):(a(),o("div",Nt,[t("button",{class:"btn-4 py-1",title:"Download",onClick:e[7]||(e[7]=u=>g(l.value,d(l.value)))},e[38]||(e[38]=[t("i",{class:"far fa-download"},null,-1)]))])),t("div",Ot,[t("div",{class:"truncate text-sm text-gray-700",title:d(l.value)},[e[39]||(e[39]=t("span",{class:"font-medium"},"Image:",-1)),r(" "+c(d(l.value)),1)],8,Ft),t("div",zt,[t("button",{class:"btn",onClick:e[8]||(e[8]=u=>f(l.value))},"Open"),t("button",{class:"btn-primary",onClick:e[9]||(e[9]=u=>g(l.value,d(l.value)))},"Download")])])])):be(l.value)?(a(),o("div",Ht,[t("iframe",{src:De.value,class:"w-full h-[80vh] bg-white",title:"Attachment PDF"},null,8,Pt),t("div",Bt,[t("button",{class:"btn-4 py-1",title:"Open in new tab",onClick:e[10]||(e[10]=u=>f(l.value))},e[40]||(e[40]=[t("i",{class:"far fa-arrow-up-right-from-square"},null,-1)])),t("button",{class:"btn-4 py-1",title:"Download",onClick:e[11]||(e[11]=u=>g(l.value,d(l.value)))},e[41]||(e[41]=[t("i",{class:"far fa-download"},null,-1)]))]),t("div",Vt,[t("div",qt,[e[42]||(e[42]=t("span",{class:"font-medium"},"PDF:",-1)),r(" "+c(d(l.value)),1)]),t("div",Rt,[t("button",{class:"btn",onClick:e[12]||(e[12]=u=>f(l.value))},"Open"),t("button",{class:"btn-primary",onClick:e[13]||(e[13]=u=>g(l.value,d(l.value)))},"Download")])])])):(a(),o("div",Ut,[t("div",{class:"text-gray-700 truncate",title:d(l.value)},[e[43]||(e[43]=t("span",{class:"font-medium"},"File:",-1)),r(" "+c(d(l.value)),1)],8,Yt),t("div",Zt,[t("button",{class:"btn",onClick:e[14]||(e[14]=u=>f(l.value))},"Open"),t("button",{class:"btn-primary",onClick:e[15]||(e[15]=u=>g(l.value,d(l.value)))},"Download")])]))])])):v("",!0)]),t("aside",Kt,[t("div",Wt,[t("div",Xt,[e[48]||(e[48]=t("div",{class:"text-xs uppercase tracking-wider text-gray-500"},"Summary",-1)),t("div",Gt,[t("div",Jt,[e[44]||(e[44]=t("div",{class:"text-[11px] text-gray-500"},"Created",-1)),t("div",Qt,c(E((ae=n.value)==null?void 0:ae.created_at)),1)]),t("div",es,[e[45]||(e[45]=t("div",{class:"text-[11px] text-gray-500"},"Doc Type",-1)),t("div",ts,c(((ie=n.value)==null?void 0:ie.doc_type)||"N/A"),1)]),t("div",ss,[e[46]||(e[46]=t("div",{class:"text-[11px] text-gray-500"},"Mode",-1)),t("div",ls,c(((re=n.value)==null?void 0:re.mode)||"N/A"),1)])]),t("div",ns,[e[47]||(e[47]=t("span",{class:"chip"},"Discipline",-1)),D.value?(a(),o("span",as,"Acknowledged")):(a(),o("span",os,"Pending"))])]),t("div",is,[t("button",{class:"btn w-full",onClick:S},e[49]||(e[49]=[t("i",{class:"far fa-link mr-2"},null,-1),r("Copy link")])),l.value?(a(),o("button",{key:0,class:"btn w-full",onClick:e[16]||(e[16]=u=>f(l.value))},e[50]||(e[50]=[t("i",{class:"far fa-arrow-up-right-from-square mr-2"},null,-1),r("Open attachment")]))):v("",!0),l.value?(a(),o("button",{key:1,class:"btn-primary w-full",onClick:e[17]||(e[17]=u=>g(l.value,d(l.value)))},e[51]||(e[51]=[t("i",{class:"far fa-download mr-2"},null,-1),r("Download")]))):v("",!0)])]),t("div",rs,[t("div",ds,[e[54]||(e[54]=ze('<div class="flex items-center justify-between" data-v-834a61e2><div class="flex items-center gap-2" data-v-834a61e2><div class="h-8 w-8 rounded-lg bg-emerald-50 flex items-center justify-center" data-v-834a61e2><i class="far fa-comment-dots text-emerald-600" data-v-834a61e2></i></div><h3 class="text-base md:text-lg font-semibold text-gray-900" data-v-834a61e2>Acknowledgment</h3></div></div>',1)),t("div",us,[D.value?(a(),o("div",cs,[t("div",vs,[e[53]||(e[53]=t("i",{class:"far fa-check-circle mt-0.5"},null,-1)),t("div",null,[e[52]||(e[52]=t("div",{class:"text-sm font-semibold"},"Acknowledged",-1)),t("div",ms,[r(c(E((de=n.value)==null?void 0:de.acknowledged_at))+" ",1),(ue=n.value)!=null&&ue.acknowledged_by?(a(),o("span",ps,"- "+c((ce=n.value)==null?void 0:ce.acknowledged_by),1)):v("",!0)])])])])):(a(),o("button",{key:1,onClick:ke,disabled:y.value,class:"px-4 py-2 rounded-xl text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-60 disabled:cursor-not-allowed"},c(y.value?"Saving...":"Acknowledge"),9,gs))])])])])])]),fe(Ve,{name:"fade"},{default:He(()=>[$.value?(a(),o("div",{key:0,ref_key:"lightboxEl",ref:B,role:"dialog","aria-modal":"true",class:"fixed inset-0 z-50 bg-black/10 backdrop-blur-sm flex flex-col",onKeydown:Pe(L,["esc"]),onClick:O(L,["self"]),tabindex:"0"},[t("div",fs,[t("div",xs,[t("button",{class:"btn-4 py-1",title:"Zoom out",onClick:Me},"-"),t("span",ys,c(Math.round(p.value*100))+"%",1),t("button",{class:"btn-4 py-1",title:"Zoom in",onClick:Le},"+"),t("button",{class:"btn-2",title:"Download",onClick:e[18]||(e[18]=u=>g(l.value,d(l.value)))},e[55]||(e[55]=[t("i",{class:"far fa-download"},null,-1)])),t("button",{class:"btn-4 py-1 text-red-500",title:"Close",onClick:L},"x")])]),t("div",{class:"flex-1 overflow-hidden cursor-grab active:cursor-grabbing",onWheel:O(Se,["prevent"]),onMousedown:Te,onMouseup:q,onMouseleave:q,onMousemove:je,onDblclick:Ee},[t("div",{class:"w-full h-full md:mt-10 flex items-center justify-center",style:Be({transform:`translate(${h.value.x}px, ${h.value.y}px) scale(${p.value})`,transition:C.value?"none":"transform 120ms ease"})},[t("img",{src:l.value,alt:d(l.value)||"Attachment Image",class:"max-w-none select-none",draggable:"false",onDragstart:e[19]||(e[19]=O(()=>{},["prevent"]))},null,40,bs)],4)],32)],544)):v("",!0)]),_:1})])}}},As=Ie(ws,[["__scopeId","data-v-834a61e2"]]);export{As as default};
