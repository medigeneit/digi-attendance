import{d as O,r as _,q,a1 as W,A as Q,e as j,c as u,o as n,a as e,m as Y,w as X,f as h,g as x,v as C,D as Z,t as f,F as B,x as H,h as L,a2 as R,l as M,u as ee,b as te,s as se,a3 as le}from"./index-BbzRfK9P.js";import{_ as ae}from"./EmployeeFilter-BhGuXrMW.js";import{L as z}from"./LoaderView-C1NM80HL.js";import{_ as oe}from"./MultiselectDropdown-CA_RznvV.js";import{u as re}from"./holiday-BJCWYZ4A.js";import{u as I}from"./leave-application-GE3xRUwK.js";import{u as ne}from"./leave-type-CN0ToLIt.js";import{u as P}from"./user-2Z2tTgyv.js";import"./company-BRDX6aiz.js";import"./department-BfjUVQ3T.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"space-y-4 p-2 md:p-4"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ie={class:"inline-flex items-center space-x-2"},pe={key:0},ve={class:"text-blue-600 font-medium"},ce={key:1,class:"bg-gray-100 p-2 rounded-md"},ye={class:"font-semibold"},me={class:"flex flex-wrap gap-2"},_e=["name","value","onUpdate:modelValue"],fe={class:"flex items-center space-x-1"},be=["name","onUpdate:modelValue"],ge={class:"flex items-center space-x-1"},xe=["name","onUpdate:modelValue"],he={key:2},ke={key:3,class:"text-red-500 text-sm"},we={__name:"AdminLeaveApplicationAddForm",props:{userId:{type:Number,required:!0}},emits:["close"],setup(E,{emit:S}){const m=E,g=S,F=I(),k=ne(),D=P(),y=O(),N=re(),c=_(""),b=_(!1),r=_({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),i=_([]),A=_(!1),w=_(null),$=q(()=>{var l,t,o;return((t=(l=y==null?void 0:y.user)==null?void 0:l.assign_weekend)==null?void 0:t.weekends)||((o=y==null?void 0:y.user)==null?void 0:o.weekends)}),s=q(()=>{const l=r.value.last_working_date,t=r.value.resumption_date;if(!l||!t)return[];const o=new Date(l),p=new Date(t);if(p<=o)return[];const d=[];let v=new Date(o);for(v.setDate(v.getDate()+1);v<p;){const J=v.getFullYear(),G=(v.getMonth()+1).toString().padStart(2,"0"),K=v.getDate().toString().padStart(2,"0");d.push(`${J}-${G}-${K}`),v.setDate(v.getDate()+1)}return d}),U=q(()=>{if(!r.value.last_working_date||!r.value.resumption_date)return"";const l=new Date(r.value.last_working_date);return new Date(r.value.resumption_date)<=l?"Resumption date must be after Last Working Date.":s.value.length===0?"No leave days between the selected dates.":`Total leave days: ${s.value.length}`});W(()=>{s.value.length&&k.leaveTypes.length&&(i.value.length!==s.value.length&&(i.value=s.value.map(()=>k.leaveTypes[0].id)),s.value.forEach(async(l,t)=>{const o=new Date(l).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),p=o.charAt(0).toUpperCase()+o.slice(1);$.value.includes(p)&&(i.value[t]="weekend"),await a(l)&&(i.value[t]="holiday")}))}),Q(()=>c.value,l=>{r.value.handover_user_id=l==null?void 0:l.id});const T=async()=>{A.value=!0,w.value=null;try{const l=s.value.map((d,v)=>({date:d,leave_type_id:i.value[v]!=="weekend"&&i.value[v]!=="holiday"?i.value[v]:null})).filter(d=>d.leave_type_id!==null),t=s.value.map((d,v)=>({date:d,leave_type_id:i.value[v]||""})).filter(d=>d.leave_type_id!==null),o={user_id:m.userId,last_working_date:r.value.last_working_date,resumption_date:r.value.resumption_date,reason:r.value.reason,works_in_hand:r.value.works_in_hand,handover_user_id:b.value?null:r.value.handover_user_id,leave_days:l,json_data:t};await F.storeLeaveApplication(o)&&g("close")}catch(l){w.value=l.message||"Failed to submit leave application"}finally{A.value=!1}};j(()=>{W(()=>{var t;const l=(t=y==null?void 0:y.user)==null?void 0:t.company_id;l&&k.fetchLeaveTypes(l)}),D.fetchTypeWiseEmployees({except:"auth"})});const V=()=>{g("close")},a=async l=>{var t;try{return(((t=(await N.fetchHolidays({start_date:l}))[0])==null?void 0:t.start_date)||[]).includes(l)}catch(o){return console.error("Error fetching holidays:",o),!1}};return(l,t)=>(n(),u("div",de,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:V},t[5]||(t[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[6]||(t[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),t[7]||(t[7]=e("div",null,null,-1))]),A.value?(n(),Y(z,{key:0})):(n(),u("form",{key:1,onSubmit:X(T,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",ue,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>r.value.last_working_date=o),class:"input-1 w-full",required:""},null,512),[[C,r.value.last_working_date]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=o=>r.value.resumption_date=o),class:"input-1 w-full",required:""},null,512),[[C,r.value.resumption_date]])])]),e("div",null,[e("label",ie,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=o=>b.value=o),class:"form-checkbox text-blue-600"},null,512),[[Z,b.value]]),t[10]||(t[10]=e("span",{class:"text-sm font-medium"},"Direct Approve",-1))])]),r.value.last_working_date&&r.value.resumption_date?(n(),u("div",pe,[e("p",ve,f(U.value),1)])):h("",!0),s.value.length?(n(),u("div",ce,[t[13]||(t[13]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),e("div",null,[(n(!0),u(B,null,H(s.value,(o,p)=>(n(),u("div",{key:p,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[e("div",ye,f(o),1),e("div",me,[(n(!0),u(B,null,H(L(k).leaveTypes,d=>(n(),u("label",{key:d.id,class:"flex items-center space-x-1"},[x(e("input",{type:"radio",name:"leaveType-"+p,value:d.id,"onUpdate:modelValue":v=>i.value[p]=v},null,8,_e),[[R,i.value[p]]]),e("span",null,f(d.name),1)]))),128)),e("label",fe,[x(e("input",{type:"radio",name:"leaveType-"+p,value:"weekend","onUpdate:modelValue":d=>i.value[p]=d},null,8,be),[[R,i.value[p]]]),t[11]||(t[11]=e("span",null,"Weekend",-1))]),e("label",ge,[x(e("input",{type:"radio",name:"leaveType-"+p,value:"holiday","onUpdate:modelValue":d=>i.value[p]=d},null,8,xe),[[R,i.value[p]]]),t[12]||(t[12]=e("span",null,"Holiday",-1))])])]))),128))])])):h("",!0),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),x(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.value.reason=o),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[C,r.value.reason]])]),b.value?h("",!0):(n(),u("div",he,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),M(oe,{modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=o=>c.value=o),options:L(D).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),w.value?(n(),u("div",ke,f(w.value),1)):h("",!0),t[16]||(t[16]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},De={class:"space-y-2 px-4"},Ae={class:"flex gap-2"},$e={key:0,class:"text-center py-4"},Le={key:1,class:"space-y-4"},Se={class:"overflow-x-auto"},Ue={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},Te={key:0,class:"bg-sky-200/20 text-center"},Ve={class:"border border-gray-300 py-2 text-center",colspan:"6"},qe={class:"text-sky-600 text-lg"},Ce={class:"border border-gray-300 px-2 py-2"},Me={class:"border border-gray-300 px-2 py-2"},Be={class:"border border-gray-300 px-2 py-2"},Fe={class:"border border-gray-300 px-2 py-2"},Ne={class:"border border-gray-300 px-2 py-2"},Re=["innerHTML"],He={class:"border border-gray-300 px-2 py-2"},Ee={key:0},We={key:0},je={class:"text-center py-2",colspan:"6"},Ye={key:0,class:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center"},ze={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},st={__name:"AdminLeaveApplication",setup(E){const S=ee(),m=te(),g=I();P();const{user:F,leaveApplications:k,loading:D}=se(g),y=_(m.query.year||g.selectedYear),N=_(m.query.search||""),c=_({company_id:m.query.company_id||"",department_id:m.query.department_id||"all",type:m.query.type||"all",employee_id:m.query.employee_id||""}),b=_(!1),r=async()=>{const $={selectedYear:y.value,selectedStatus:g.selectedStatus,query:N.value};c.value.employee_id?($.user_id=c.value.employee_id,D.value=!0,await g.fetchYearlyUserLeaveApplications($),D.value=!1):k.value=[]};j(async()=>{await r()});const i=q(()=>k.value||[]),A=()=>S.go(-1),w=async()=>{S.replace({query:{...m.query,company_id:c.value.company_id,department_id:c.value.department_id,type:c.value.type,employee_id:c.value.employee_id}}),await r()};return($,s)=>{var U,T,V;return n(),u(B,null,[e("div",De,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:A},s[5]||(s[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),s[6]||(s[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),s[7]||(s[7]=e("div",null,null,-1))]),e("div",Ae,[M(ae,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=a=>c.value=a),"initial-value":L(m).query,onFilterChange:w},null,8,["modelValue","initial-value"]),e("div",null,[x(e("input",{id:"yearSelect",type:"year","onUpdate:modelValue":s[1]||(s[1]=a=>y.value=a),onChange:r,class:"input-1"},null,544),[[C,y.value]])])]),L(g).loading?(n(),u("div",$e,[M(z)])):(n(),u("div",Le,[e("div",Se,[e("table",Ue,[e("thead",null,[(U=c.value)!=null&&U.employee_id?(n(),u("tr",Te,[e("th",Ve,[e("span",qe,f((T=L(F))==null?void 0:T.name),1)])])):h("",!0),s[8]||(s[8]=e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-left"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-left"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-left"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-left"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-left"},"Status")],-1))]),e("tbody",null,[(n(!0),u(B,null,H(i.value,(a,l)=>(n(),u("tr",{key:l,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",Ce,f(l+1),1),e("td",Me,f(a==null?void 0:a.last_working_date),1),e("td",Be,f(a==null?void 0:a.resumption_date),1),e("td",Fe,f(a==null?void 0:a.leave_period),1),e("td",Ne,[e("div",{innerHTML:a.duration||(a==null?void 0:a.total_leave_days)},null,8,Re)]),e("td",He,f((a==null?void 0:a.status)||"N/A"),1)]))),128)),i.value.length?h("",!0):(n(),u("tr",Ee,s[9]||(s[9]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(V=c.value)!=null&&V.employee_id?(n(),u("tr",We,[e("th",je,[e("button",{onClick:s[2]||(s[2]=a=>b.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):h("",!0)])])])]))]),(n(),Y(le,{to:"body"},[b.value?(n(),u("div",Ye,[e("div",ze,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:s[3]||(s[3]=a=>b.value=!1)}," × "),M(we,{onClose:s[4]||(s[4]=a=>b.value=!1)})])])):h("",!0)]))],64)}}};export{st as default};
