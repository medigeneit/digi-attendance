import{L as Q}from"./LoaderView-oU8U-q3u.js";import{r as L,x as _,e as K,A as H,c,o as l,J as N,a as e,F as B,y as q,t as S,g as b,w as C,q as z,n as j,f as U,G as ae,i as E,k as D,d as te,m as ie,j as A,H as oe,I as pe,K as ve,T as fe,h as de,v as re,U as V,V as Y}from"./index-DK6hEot4.js";import{f as ge,h as be,b as X,g as J,i as he,j as ke}from"./datetime-BixRpIok.js";import{u as G}from"./useTodoStore-CzOG7QKl.js";import{_ as xe}from"./DraggableList.vue_vue_type_script_setup_true_lang-mGBwO6rL.js";import{_ as we}from"./UserChip-DCxIMqJc.js";import{O as ee}from"./OverlyModal-BkhfXoiV.js";import{u as Ce}from"./useTaskStore-DjASRry4.js";const $e={class:"grid grid-cols-7 *:text-center *:p-2 *:border-r *:border-b *:text-blue-800 *:text-sm"},De={class:"flex flex-col"},Te={key:0,class:"p-2 border-r border-t"},Se={__name:"CalenderView",props:{month:{type:String,required:!0,validator:o=>/^\d{4}-(0[1-9]|1[0-2])$/.test(o)}},emits:["change"],setup(o,{emit:$}){const i=o,s=$,m=L(),t=L(),r=L(),p=L(),a=["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday"];function d(k,u,x,T){const w=[];for(let O=x-1;O>=0;O--){const g=T-O,I=new Date(k,u-1,g);w.push({date:I,day:I.getDate(),month:I.getMonth()+1,year:I.getFullYear(),isCurrentMonth:!1})}return w}function h(k,u,x){const T=[];for(let w=1;w<=x;w++){const g={date:new Date(k,u,w),day:w,month:u+1,year:k,isCurrentMonth:!0};T.push(g)}return T}function v(k,u,x){const T=[...k],w=Math.ceil(T.length/7)*7,O=1;for(let g=0;T.length<w;g++){const I=new Date(u,x+1,O+g);T.push({date:I,day:I.getDate(),month:I.getMonth()+1,year:I.getFullYear(),isCurrentMonth:!1})}return T}function n(k,u){const x=new Date(k,u,1),w=new Date(k,u+1,0).getDate(),g=(x.getDay()+1)%7,M=new Date(k,u,0).getDate();let R=[];R=[...d(k,u,g,M)];const F=h(k,u,w);return r.value=F[0],p.value=F[F.length-1],R=[...R,...F],R=[...v(R,k,u)],m.value=R[0],t.value=R[R.length-1],R}const y=_(()=>{const[k,u]=i.month.split("-"),x=parseInt(k),T=parseInt(u)-1;return console.log({yearStr:k,monthStr:u}),n(x,T)}),f=_(()=>{const k=y.value,u=[];for(let x=0;x<k.length;x+=7)u.push(k.slice(x,x+7));return u});function P(){s("change",{gridStartDate:m.value,gridEndDate:t.value,startOfMonth:r.value,endOfMonth:p.value})}return K(()=>P()),H(()=>i.month,P),(k,u)=>(l(),c("div",null,[N(k.$slots,"calender-top"),e("div",$e,[(l(),c(B,null,q(a,x=>e("div",{key:x},S(x),1)),64))]),e("div",De,[(l(!0),c(B,null,q(f.value,(x,T)=>(l(),c("div",{class:"week grid grid-cols-7 min-h-28 items-stretch",key:T},[(l(!0),c(B,null,q(x,(w,O)=>N(k.$slots,"date",{key:O,day:w.day,month:w.month,year:w.year,weekday:(w.date.getDay()+1)%7,isCurrentMonth:w.isCurrentMonth,yearMonthDate:`${w.year}-${String(w.month).padStart(2,"0")}-${String(w.day).padStart(2,"0")}`},()=>{var g;return[w!=null&&w.date?(l(),c("div",Te,S((g=w==null?void 0:w.date)==null?void 0:g.getDate()),1)):b("",!0)]})),128))]))),128))]),N(k.$slots,"calender-bottom")]))}},Ie={class:"px-4 py-2 flex items-center lg:justify-start flex-wrap bg-gray-50 group md:gap-x-2 gap-y-4"},Me=["disabled"],Ee=["value"],Re=["value"],Oe={key:2,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},Ne=["value"],Le={key:3,class:"md:ml-auto flex items-center justify-between md:justify-start gap-2 w-full lg:w-auto"},je=["value"],Pe={__name:"TodoHeading",props:{selected:{type:Object,default:()=>({type:"month-view",month:"",day:"",year:"",week:""})},loading:{type:Boolean,default:!1}},emits:["reloadClick",,"change"],setup(o,{emit:$}){const i=o,s=[{value:"month-view",label:"Monthly"},{value:"day-view",label:"Daily"}],m=$,t=L();function r(u){t.value=u,m("change",{...i.selected,type:u})}H(()=>{var u;return(u=i.selected)==null?void 0:u.type},u=>r(u),{immediate:!0});const p=_(()=>t.value=="month-view"&&i.selected.year&&i.selected.month?[i.selected.year,i.selected.month-1,1]:t.value=="day-view"&&i.selected.year&&i.selected.month&&i.selected.day?[i.selected.year,i.selected.month-1,i.selected.day]:[new Date().getFullYear(),new Date().getMonth(),new Date().getDate()]);function a(){t.value=="month-view"&&f(new Date)}function d(){if(t.value=="month-view"){const u=new Date(...p.value);u.setMonth(u.getMonth()+1),f(u)}}function h(){if(t.value=="month-view"){const u=new Date(...p.value);u.setMonth(u.getMonth()-1),f(u)}}function v(){t.value=="day-view"&&f(new Date)}function n(){if(t.value=="day-view"){const u=new Date(...p.value);u.setDate(u.getDate()+1),f(u)}}function y(){if(t.value=="day-view"){const u=new Date(...p.value);u.setDate(u.getDate()-1),f(u)}}function f(u){m("change",{type:t.value,month:u.getMonth()+1,day:u.getDate(),year:u.getFullYear(),week:u.getDay()})}const P=_(()=>t.value=="month-view"?`${i.selected.year}-${i.selected.month.toString().padStart(2,"0")}`:t.value=="day-view"?`${i.selected.year}-${i.selected.month.toString().padStart(2,"0")}-${i.selected.day.toString().padStart(2,"0")}`:i.selected),k=u=>{var x,T;if(t.value=="month-view"){const[w,O]=(x=u.target.value)==null?void 0:x.split("-").map(Number),g=new Date(w,O-1,1);f(g)}if(t.value=="day-view"){const w=new Date((T=u.target)==null?void 0:T.value);f(w)}};return(u,x)=>(l(),c("div",null,[e("div",Ie,[N(u.$slots,"before",{selected:o.selected}),e("button",{class:z(["px-2 py-2 disabled:text-gray-300 border size-[32px] flex items-center justify-center rounded-full",{"animate-spin !bg-opacity-0":o.loading}]),onClick:x[0]||(x[0]=C(T=>m("reloadClick"),["prevent"])),disabled:o.loading},[e("i",{class:z(["fas fa-redo",[o.loading?"text-gray-400":"text-gray-500"]])},null,2)],10,Me),N(u.$slots,"typeSelection",{selected:o.selected,types:s,changeType:r},()=>[e("select",{class:"px-2 h-7 border rounded",value:t.value,onChange:x[1]||(x[1]=T=>r(T.target.value))},[(l(),c(B,null,q(s,T=>e("option",{value:T.value,key:T.id},S(T.label),9,Re)),64))],40,Ee)]),t.value=="month-view"?(l(),c("button",{key:0,class:"h-7",onClick:C(a,["prevent"])})):b("",!0),t.value=="day-view"?(l(),c("button",{key:1,class:"h-7",onClick:C(v,["prevent"])})):b("",!0),N(u.$slots,"inner",{selected:o.selected}),t.value=="month-view"?(l(),c("div",Oe,[e("button",{class:"btn-3 px-3 rounded h-7",onClick:C(h,["prevent"])},x[2]||(x[2]=[e("span",{class:"fas fa-arrow-left"},null,-1)])),t.value=="month-view"?(l(),c("input",{key:0,type:"month",value:P.value,onInput:k,class:"border-2 px-2 rounded border-blue-900"},null,40,Ne)):b("",!0),e("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:C(d,["prevent"])},x[3]||(x[3]=[e("span",{class:"fas fa-arrow-right"},null,-1)]))])):b("",!0),t.value=="day-view"?(l(),c("div",Le,[e("button",{class:"btn-3 px-3 rounded h-7",onClick:C(y,["prevent"])},x[4]||(x[4]=[e("span",{class:"fas fa-arrow-left"},null,-1)])),t.value=="day-view"?(l(),c("input",{key:0,type:"date",value:P.value,onInput:k,class:"border-2 px-2 rounded border-blue-900 w-28"},null,40,je)):b("",!0),e("button",{class:"btn-3 px-3 rounded h-7 md:ml-0",onClick:C(n,["prevent"])},x[5]||(x[5]=[e("span",{class:"fas fa-arrow-right"},null,-1)]))])):b("",!0),N(u.$slots,"after",{selected:o.selected})]),N(u.$slots,"bottom",{selected:o.selected})]))}},Ue={key:0,class:"fa fa-exclamation-square",title:"Pending"},_e={key:1,class:"fa fa-pause",title:"Working"},Fe={key:2,class:"fa fa-check-square",title:"Completed"},ne={__name:"TodoStatusIcon",props:{todo:{type:Object,required:!0}},setup(o){const $=o,i=_(()=>{switch($.todo.status){case"PENDING":return"text-red-400";case"WORKING":return"text-yellow-600";case"COMPLETED":return"text-green-400"}return""});return(s,m)=>(l(),c("span",{class:z(i.value)},[o.todo.status=="PENDING"?(l(),c("i",Ue)):b("",!0),o.todo.status=="WORKING"?(l(),c("i",_e)):b("",!0),o.todo.status=="COMPLETED"?(l(),c("i",Fe)):b("",!0)],2))}},Ae=["title","onClick"],Be={class:"line-clamp-1"},ze={key:0,class:"text-purple-600 text-center"},ue={__name:"TodosInDate",props:{date:{type:String,required:!0},maxItems:{type:[Number,String],default:3}},emits:["clickTodo"],setup(o,{emit:$}){const i=o,s=$,{getTodosByDate:m}=G(),t=_(()=>{let r=[],p=!1,a=[];if(typeof m=="function"){const d=m(i.date);if(a=Array.isArray(d)?d:[],i.maxItems==="all")return{all:a,items:a,moreItemsCount:0};r=a.slice(0,i.maxItems),p=a.length-r.length}return{all:a,items:r,moreItemsCount:p}});return(r,p)=>(l(),c("div",null,[t.value.items.length===0?N(r.$slots,"noTodos",{key:0},()=>[p[0]||(p[0]=e("div",{class:"text-gray-400 text-center"},"No todos",-1))]):(l(),c(B,{key:1},[N(r.$slots,"todoItems",{todos:t.value.items,allTodos:t.value.items,moreItemsCount:t.value.moreItemsCount},()=>[(l(!0),c(B,null,q(t.value.items,a=>N(r.$slots,"todoItem",{key:a.id,todo:a,moreItemsCount:t.value.moreItemsCount},()=>{var d,h,v,n;return[e("div",{title:`${a==null?void 0:a.title} ${a!=null&&a.user?`
by:`:""} ${(d=a==null?void 0:a.user)==null?void 0:d.name} ${(h=a==null?void 0:a.user)!=null&&h.department?`
DEPT:`:""} ${(n=(v=a.user)==null?void 0:v.department)==null?void 0:n.name}`,class:z(["px-1 mb-2 text-sm rounded cursor-pointer flex items-center gap-2",{"bg-sky-50 text-sky-900 hover:bg-sky-700 hover:text-white border border-sky-300":a.status!=="COMPLETED","bg-green-500 text-white":a.status==="COMPLETED"}]),onClick:C(y=>s("clickTodo",a),["prevent","stop"])},[j(ne,{todo:a,class:z(["text-sm",[a.status=="COMPLETED"?"!text-white":""]])},null,8,["todo","class"]),e("div",Be,S(a.title),1),a.user?(l(),U(ae,{key:0,user:a.user,size:"xsmall",class:"ml-auto"},null,8,["user"])):b("",!0)],10,Ae)]})),128))]),t.value.moreItemsCount>0?(l(),c("div",ze," + "+S(t.value.moreItemsCount)+" more todo"+S(t.value.moreItemsCount>1?"s":""),1)):b("",!0)],64))]))}},We={class:"relative"},qe=["onClick","onKeypress"],Ge={class:"flex items-center justify-center"},He=["onClick"],Ke={__name:"TodosInCalenderView",props:{month:{type:String,required:!0,validator:o=>/^\d{4}-(0[1-9]|1[0-2])$/.test(o)}},emits:["dateClick","clickTodo","clickDateCell"],setup(o,{emit:$}){const i=$;function s(t,r){t.isTrusted&&t.ctrlKey&&t.which==10&&i("dateClick",r)}function m(t){const[r,p,a]=String(t).split("-").map(Number),d=new Date(r,p-1,a);return be(d)}return(t,r)=>(l(),c("div",We,[o.month?(l(),U(Se,{key:0,month:o.month,class:"border-t border-blue-200/50 relative"},{date:E(({day:p,month:a,yearMonthDate:d,isCurrentMonth:h})=>[e("div",{tabindex:"0",class:z(["border p-4 cursor-pointer group/date relative focus:outline-slate-400",{"bg-sky-50   border-sky-300 focus:bg-sky-50 focus:outline-sky-400":m(d),"hover:bg-slate-50  hover:border-slate-300 focus:bg-slate-50 ":!m(d)}]),onClick:C(v=>i("dateClick",d),["prevent","stop"]),onKeypress:C(v=>s(v,d),["prevent"])},[e("button",{tabindex:"1",class:z([{"text-gray-300 hover:bg-sky-200  hover:text-white":!h,"text-sky-400 hover:bg-sky-200":h},"text-center mb-2 font-semibold w-full rounded"])},S(p)+" "+S(h?"":D(ge)(a-1)),3),e("div",null,[j(ue,{date:d,onClickTodo:r[0]||(r[0]=v=>i("clickTodo",v))},{noTodos:E(()=>r[1]||(r[1]=[e("span",null,null,-1)])),_:2},1032,["date"])]),e("div",Ge,[e("button",{onClick:C(v=>i("clickDateCell",d),["prevent","stop"]),class:"btn-3 !py-1 invisible group-hover/date:visible text-sm text-red-800/40"},r[2]||(r[2]=[e("i",{class:"fas fa-plus"},null,-1),e("span",{class:"hidden lg:inline whitespace-nowrap"}," Add todo ",-1)]),8,He)])],42,qe)]),_:1},8,["month"])):b("",!0)]))}},Ve={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},ce={__name:"DepartmentChip",props:{department:Object},setup(o){return($,i)=>{var s;return l(),c("div",Ve,S((s=o.department)==null?void 0:s.name),1)}}},Ye={class:""},Je={key:0,class:"mt-1 flex items-center gap-2"},Qe={key:0,class:"line-clamp-2 text-gray-500 whitespace-nowrap mr-2"},Xe={class:"md:ml-auto w-full md:w-auto flex items-center justify-center gap-2"},Ze={key:0,class:"flex items-center gap-1 text-red-600"},et={__name:"TodoItemCard",props:{todo:{type:Object,required:!0},hideDepartment:{type:Boolean,default:!1},hideUser:{type:Boolean,default:!1},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","clickDelete","clickChangeStatus","clickDelete"],setup(o,{emit:$}){const i=te(),s=$;return(m,t)=>{var p,a,d;const r=ie("RouterLink");return l(),c("div",{class:z(["px-4 py-4 md:py-2 cursor-pointer flex flex-wrap items-center gap-y-2 gap-x-4",{"bg-green-100":o.todo.status=="COMPLETED","hover:bg-gray-50":o.todo.status!="COMPLETED"}]),onClick:t[4]||(t[4]=C(h=>s("clickTodo",o.todo),["prevent"]))},[j(ne,{todo:o.todo},null,8,["todo"]),e("div",Ye,[e("div",{class:z(["line-clamp-1",{"text-green-800":o.todo.status=="COMPLETED","text-blue-800":o.todo.status!="COMPLETED"}])},S(o.todo.id)+" - "+S(o.todo.title),3),o.todo.user?(l(),c("div",Je,[o.hideUser?b("",!0):(l(),U(we,{key:0,user:o.todo.user,"avatar-size":"xsmall"},null,8,["user"])),o.hideDepartment?b("",!0):(l(),U(ce,{key:1,department:(a=(p=o.todo)==null?void 0:p.user)==null?void 0:a.department},null,8,["department"]))])):b("",!0)]),o.todo.todo_type&&o.todo.todo_type_id?(l(),c("div",Qe,[A(S(o.todo.todo_type)+" id: ",1),j(r,{class:"text-blue-600 font-semibold underline hover:text-sky-400",onClick:C(h=>null,["stop"]),to:{name:o.userRole=="employee"?"MyTaskShow":"TaskShow",params:{id:o.todo.todo_type_id}}},{default:E(()=>[t[5]||(t[5]=e("i",{class:"fas fa-link"},null,-1)),A(" "+S(o.todo.todo_type_id),1)]),_:1,__:[5]},8,["to"])])):b("",!0),e("div",Xe,[o.todo.status=="WORKING"?(l(),c("div",Ze,t[6]||(t[6]=[e("span",{class:"fas fa-circle animate-pulse text-xs"},null,-1),e("span",{class:"text-xs"},"Working",-1)]))):b("",!0),o.todo.user_id===((d=D(i).user)==null?void 0:d.id)?(l(),c(B,{key:1},[o.todo.status==="WORKING"?(l(),c("button",{key:0,title:"Mark as Completed",class:"btn-icon bg-transparent text-green-400 border-green-400 border hover:bg-green-400 hover:text-white",onClick:t[0]||(t[0]=C(()=>s("clickChangeStatus",o.todo,"COMPLETED"),["prevent","stop"]))},t[7]||(t[7]=[e("i",{class:"fas fa-check"},null,-1)]))):b("",!0),o.todo.status==="PENDING"?(l(),c("button",{key:1,title:"Start Working",class:"btn-icon bg-transparent text-red-400 border-red-400 border hover:bg-red-400 hover:text-white",onClick:t[1]||(t[1]=C(()=>s("clickChangeStatus",o.todo,"WORKING"),["prevent","stop"]))},t[8]||(t[8]=[e("i",{class:"fas fa-play ml-[4px]"},null,-1)]))):b("",!0),e("button",{class:"btn-icon bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:t[2]||(t[2]=C(h=>s("clickEdit",o.todo),["prevent","stop"]))},t[9]||(t[9]=[e("i",{class:"fas fa-pen"},null,-1)])),e("button",{class:"btn-icon bg-red-400 text-white hover:bg-red-600 hover:text-white",onClick:t[3]||(t[3]=C(()=>s("clickDelete",o.todo),["prevent","stop"]))},t[10]||(t[10]=[e("i",{class:"fas fa-trash-alt"},null,-1)]))],64)):b("",!0),e("button",{onClick:C(()=>null,["stop","prevent"]),class:"btn-icon bg-gray-400 text-white hover:bg-gray-600 hover:text-white handle"},t[11]||(t[11]=[e("i",{class:"fas fa-arrows-alt-v"},null,-1)]))])],2)}}},tt={class:"border rounded-md"},ot={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},nt={class:"font-semibold flex items-center gap-2"},st={class:"text-white text-base"},lt={class:"ml-auto flex items-center gap-2"},at={key:0,class:"flex items-center gap-3 mr-6"},it=["disabled"],dt=["disabled"],rt=["date"],ut={key:1,class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"},ct={__name:"UserTodos",props:{todos:{type:Array,required:!0},user:{type:Object,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","update"],setup(o,{emit:$}){const i=o,s=L(null),m=$,t=G();async function r(d){confirm(`Are your sure want to delete todo
'${d==null?void 0:d.title}'`)&&(await t.deleteTodo(d.id),m("update"))}async function p(d,h){confirm(`Are your sure?
want to change status to ${h} 
todo: '${d==null?void 0:d.title}'`)&&(await t.updateTodoStatus(d.id,h),m("update"))}async function a(){var h;const d=(h=s==null?void 0:s.value.items)==null?void 0:h.map(v=>v.id);await t.rearrangeMyTodos(d,{date:i.date}),m("update")}return(d,h)=>{var v,n;return l(),c("div",tt,[e("div",ot,[e("div",nt,[j(ae,{user:o.user},null,8,["user"]),e("div",st,S(o.user.label),1)]),e("div",lt,[(v=s.value)!=null&&v.isItemsChanged?(l(),c("div",at,[e("button",{onClick:h[0]||(h[0]=C(()=>a(),["prevent"])),class:"btn-2 disabled:opacity-40 disabled:pointer-events-none",disabled:D(t).updatingPriority}," Save Rearranged ",8,it),e("button",{onClick:h[1]||(h[1]=C(()=>s.value.resetItems(),["prevent"])),class:"btn-3 disabled:opacity-40 disabled:pointer-events-none",disabled:D(t).updatingPriority}," Discard ",8,dt)])):b("",!0),j(ce,{department:(n=o.user)==null?void 0:n.department,class:"px-2"},null,8,["department"])])]),e("div",{date:d.date,"max-items":"all",class:"w-full"},[o.todos.length>0?(l(),U(xe,{key:0,items:o.todos,ref_key:"draggableTodos",ref:s,handle:"handle"},{item:E(({item:y})=>[j(et,{todo:y,onClickTodo:f=>m("clickTodo",f),onClickEdit:f=>m("clickEdit",f),onClickDelete:f=>r(f),onClickChangeStatus:(f,P)=>p(f,P),"hide-department":"","hide-user":"",class:"border-b border-sky-200",userRole:o.userRole},null,8,["todo","onClickTodo","onClickEdit","onClickDelete","onClickChangeStatus","userRole"])]),_:1},8,["items"])):b("",!0),o.todos.length===0?(l(),c("div",ut," No Todos ")):b("",!0)],8,rt)])}}},mt={class:"relative bg-white p-4"},yt={key:0,class:"text-red-500 text-sm border border-red-300 max-w-6xl mx-auto py-2 gap-2 shadow-sm rounded flex items-center px-3"},pt={class:"max-w-6xl mx-auto border rounded my-5"},vt={class:"text-gray-700 border-b py-2 px-4 flex items-center"},ft={class:"text-lg font-semibold"},gt={key:0,class:"ml-auto flex items-center gap-2"},bt={__name:"TodosInDailyView",props:{date:{type:String,required:!0},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickAdd","clickEdit","clickDelete","clickChangeStatus","backClick","update"],setup(o,{emit:$}){const i=o,s=$,m=te(),t=G(),r=_(()=>new Date(i.date)),p=a=>{if(i.userRole=="employee")return[{...m.user,todos:a}];const d={};return a.forEach(h=>{const v=h.user.id;d[v]||(d[v]={...h.user,todos:[]}),d[v].todos.push(h)}),Object.values(d)};return(a,d)=>(l(),c("div",mt,[D(t).error?(l(),c("div",yt,[d[5]||(d[5]=e("i",{class:"fad fa-exclamation-circle"},null,-1)),e("div",null,S(D(t).error),1)])):b("",!0),e("div",pt,[e("div",vt,[e("button",{class:"fa fa-arrow-left btn-icon mr-2",onClick:d[0]||(d[0]=C(h=>s("backClick"),["prevent"]))}),e("div",ft,S(D(X)(r.value,{weekDay:"long"}))+" "+S(a.type),1),o.userRole=="employee"?(l(),c("div",gt,[e("button",{class:"btn btn-icon",onClick:d[1]||(d[1]=C(h=>s("clickAdd",i.date),["prevent"]))},d[6]||(d[6]=[e("i",{class:"fas fa-plus"},null,-1)]))])):b("",!0)]),j(ue,{date:o.date,"max-items":"all",class:"w-full space-y-4 p-2"},{todoItems:E(({allTodos:h})=>[(l(!0),c(B,null,q(p(h),v=>(l(),U(ct,{key:v.id,todos:(v==null?void 0:v.todos)||[],user:v,onClickTodo:d[2]||(d[2]=n=>s("clickTodo",n)),onClickEdit:d[3]||(d[3]=n=>s("clickEdit",n)),onUpdate:d[4]||(d[4]=n=>s("update"))},null,8,["todos","user"]))),128))]),noTodos:E(()=>d[7]||(d[7]=[e("div",{class:"flex min-h-[38vh] items-center justify-center text-gray-400 text-center rounded-md"}," No Todos ",-1)])),_:1},8,["date"])])]))}},ht={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md"},kt={key:0,class:"mb-4 text-red-500 font-medium"},xt={key:1,class:"mb-4 text-blue-500 font-medium"},wt={class:"flex justify-between items-center gap-4"},Ct=["disabled"],me={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(o,{emit:$}){const i=$;return(s,m)=>(l(),c("form",{onSubmit:m[1]||(m[1]=C(t=>i("submit"),["prevent"]))},[N(s.$slots,"default"),e("div",ht,[o.error?(l(),c("div",kt,S(o.error),1)):b("",!0),o.isSubmitting?(l(),c("div",xt,"Saving changes...")):b("",!0),N(s.$slots,"footer",{},()=>[e("div",wt,[e("button",{type:"button",onClick:m[0]||(m[0]=t=>i("clickCancel")),class:"btn-3"},"Cancel"),e("button",{disabled:o.isSubmitting||o.isLoading,type:"submit",class:"btn-2"},S(o.isSubmitting?"Saving...":"Save"),9,Ct)])])])],32))}},$t={class:"border"},Dt={class:"flex items-center py-1"},Tt=["onClick"],St={key:0,class:"border ml-4 mt-4"},It={class:"line-clamp-1 group-hover/sub:text-green-500"},Mt=["onClick"],Et={key:0,class:"border ml-4 mt-2"},Rt={class:"line-clamp-1 group-hover/subSub:text-purple-800"},Ot=["onClick"],ye={__name:"TodoTypeInput",props:{todoType:{type:String,default:"task"},todoTypeId:{type:[String,Number],default:null},show:{type:Boolean,default:!1}},emits:["update:todoType","update:todoTypeId","update:show"],setup(o,{emit:$}){const i=o,s=$,m=_({get:()=>i.todoType,set:n=>s("update:todoType",n)}),t=_({get:()=>i.todoTypeId,set:n=>s("update:todoTypeId",n)}),r=_({get:()=>i.show,set:n=>s("update:show",n)}),p=L(null),a=L({});function d(){if(!(p!=null&&p.value))return;const n=p.value.getBoundingClientRect(),y=window.innerHeight,f=300,k=y-n.bottom<f;a.value={position:"fixed",top:k?n.top-f+"px":n.bottom+"px",left:n.left+"px",width:n.width+"px",zIndex:5e3}}function h(n){t.value=n.id,r.value=!1}K(async()=>{await oe(),window.addEventListener("resize",d),document.addEventListener("scroll",d),r.value=!0,m.value="task"});const v=Ce();return H(()=>r.value,async n=>{n&&await v.fetchMyTasks()}),pe(()=>{window.removeEventListener("resize",d),document.removeEventListener("scroll",d)}),(n,y)=>(l(),c("div",{class:"relative",ref_key:"anchor",ref:p},[e("div",{class:z(["w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 cursor-pointer",t.value?"":"text-gray-400"]),onClick:y[0]||(y[0]=C(()=>{r.value=!0,d()},["stop"]))},S(t.value||"Click to select todo"),3),(l(),U(fe,{to:"body"},[r.value?(l(),c("div",{key:0,style:ve(a.value),class:"fixed h-[300px] bg-white rounded-b-md overflow-y-auto shadow-lg border z-[5000] p-4"},[e("div",$t,[(l(!0),c(B,null,q(D(v).tasks,f=>{var P;return l(),c("div",{key:f.id,class:"px-2 border-b py-3 over text-sm relative group/main"},[e("div",Dt,[e("div",{class:z(["line-clamp-2 mr-4 ",{"text-red-50 bg-green-800 px-2":f.id==t.value},{"group-hover/main:text-blue-500":f.id!=t.value}])},S(f.title),3),e("button",{class:"border btn-2 ml-auto",onClick:C(()=>h(f),["prevent"])}," Select ",8,Tt)]),(P=f==null?void 0:f.children_tasks)!=null&&P.length?(l(),c("div",St,[(l(!0),c(B,null,q((f==null?void 0:f.children_tasks)||[],k=>{var u;return l(),c("div",{key:k.id,class:"px-2 border-b py-3 over text-sm relative group/sub"},[e("div",It,S(k.title),1),e("button",{class:"border absolute right-2 top-1 btn-2 from-green-100 to-green-50 border-green-700 text-green-800 hover:text-green-900",onClick:C(()=>h(k),["prevent"])}," Select ",8,Mt),(u=k==null?void 0:k.children_tasks)!=null&&u.length?(l(),c("div",Et,[(l(!0),c(B,null,q((k==null?void 0:k.children_tasks)||[],x=>(l(),c("div",{key:x.id,class:"px-2 border-b py-4 over text-sm relative group/subSub"},[e("div",Rt,S(x.title),1),e("button",{class:"border absolute right-2 top-2 btn-2 from-green-100 to-purple-50 border-purple-700 text-purple-800 hover:text-purple-900",onClick:C(()=>h(x),["prevent"])}," Select ",8,Ot)]))),128))])):b("",!0)])}),128))])):b("",!0)])}),128))])],4)):b("",!0)]))],512))}},Nt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Lt={class:"mb-2"},jt={class:"mb-4"},Pt={class:"mb-4"},Ut={__name:"TodoAddForm",props:{date:{type:String,default:J(new Date)},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(o,{emit:$}){const i=o,s=L(),m=L(!1),t=L(),r=G(),p=$,a=L({title:"",date:i.date||"",task_id:""});async function d(){try{s.value="submitting",await r.createTodo(a.value,{returnWith:i.userRole!=="employee"?"user,department,company":""}),p("update")}finally{s.value=""}}const h=_(()=>new Date(i.date));return K(async()=>{var v;await oe(),(v=t.value)==null||v.focus()}),(v,n)=>(l(),c("div",{onClick:n[5]||(n[5]=y=>m.value=!1)},[D(r).loading?(l(),U(Q,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:E(()=>n[6]||(n[6]=[A(" Loading... ")])),_:1,__:[6]})):b("",!0),j(me,{onSubmit:d,onClickCancel:n[4]||(n[4]=y=>p("cancelClick")),isSubmitting:s.value=="submitting",error:D(r).error,class:"rounded-md relative"},{default:E(()=>[n[10]||(n[10]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),e("div",Nt,[e("div",Lt,[n[7]||(n[7]=e("span",{class:"font-semibold"}," Date ",-1)),e("span",null,S(D(X)(h.value,{weekDay:"long"})),1)]),e("div",jt,[n[8]||(n[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),de(e("input",{ref_key:"titleRef",ref:t,"onUpdate:modelValue":n[0]||(n[0]=y=>a.value.title=y),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[re,a.value.title]])]),e("div",Pt,[n[9]||(n[9]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),j(ye,{show:m.value,"onUpdate:show":n[1]||(n[1]=y=>m.value=y),todoType:a.value.todo_type,"onUpdate:todoType":n[2]||(n[2]=y=>a.value.todo_type=y),todoTypeId:a.value.todo_type_id,"onUpdate:todoTypeId":n[3]||(n[3]=y=>a.value.todo_type_id=y)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","error"])]))}},_t={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Ft={class:"mb-2"},At={class:"mb-4"},Bt={class:"mb-4"},zt={__name:"TodoEditForm",props:{date:{type:String,default:J(new Date)},todo:{type:Object,default:()=>{}}},emits:["update","cancelClick"],setup(o,{emit:$}){const i=o,s=L(),m=L(!1),t=L(),r=G(),p=$,a=L({title:"",todo_type:"task",todo_type_id:""});async function d(){var n,y,f;await r.fetchTodo((n=i.todo)==null?void 0:n.id),a.value.title=(y=r.todo)==null?void 0:y.title,a.value.todo_type_id=(f=r.todo)==null?void 0:f.todoable_id}async function h(){s.value="submitting",console.log({form:a.value});try{await r.updateTodo(i.todo.id,a.value),p("update")}finally{s.value=""}}const v=_(()=>new Date(i.todo.date));return K(async()=>{var n;await d(),await oe(),(n=t.value)==null||n.focus()}),(n,y)=>(l(),c("div",{class:"relative",onClick:y[5]||(y[5]=f=>m.value=!1)},[D(r).loading?(l(),U(Q,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:E(()=>y[6]||(y[6]=[A(" Loading... ")])),_:1,__:[6]})):b("",!0),j(me,{onSubmit:h,onClickCancel:y[4]||(y[4]=f=>p("cancelClick")),isSubmitting:s.value=="submitting",isLoading:D(r).loading,error:D(r).error,id:"todoEditForm"},{default:E(()=>[y[10]||(y[10]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),e("div",_t,[e("div",Ft,[y[7]||(y[7]=e("span",{class:"font-semibold"}," Date ",-1)),e("span",null,S(D(X)(v.value,{weekDay:"long"})),1)]),e("div",At,[y[8]||(y[8]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Title",-1)),de(e("input",{ref_key:"titleRef",ref:t,"onUpdate:modelValue":y[0]||(y[0]=f=>a.value.title=f),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[re,a.value.title]])]),e("div",Bt,[y[9]||(y[9]=e("label",{class:"block text-gray-700 font-medium mb-2"},"Task ID (optional)",-1)),j(ye,{show:m.value,"onUpdate:show":y[1]||(y[1]=f=>m.value=f),todoType:a.value.todo_type,"onUpdate:todoType":y[2]||(y[2]=f=>a.value.todo_type=f),todoTypeId:a.value.todo_type_id,"onUpdate:todoTypeId":y[3]||(y[3]=f=>a.value.todo_type_id=f)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","isLoading","error"])]))}},Wt={class:"relative"},qt={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},Gt={class:"mb-4"},Ht={class:"mb-4"},Kt={key:0,class:"mt-1 flex items-center gap-2"},Vt={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},Yt={class:"flex items-center gap-4"},Jt={key:0,class:"flex items-center gap-2"},Qt={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},Xt={key:0,class:"ml-auto flex items-center gap-2"},Zt={__name:"TodoShow",props:{todo:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update"],setup(o,{emit:$}){const i=o,s=G(),m=te(),t=$;async function r(){var v;await s.fetchTodo((v=i.todo)==null?void 0:v.id)}const p=_(()=>{var v,n;return(v=s.todo)!=null&&v.date?new Date((n=s.todo)==null?void 0:n.date):null}),a=_(()=>{var v;return i.todo.user_id===((v=m.user)==null?void 0:v.id)});async function d(v){var n;confirm(`Are your sure want to delete todo
'${(n=s.todo)==null?void 0:n.title}'`)&&(await s.deleteTodo(v.id),t("update"))}async function h(v,n){var y;confirm(`Are your sure want to compete todo
'${(y=s.todo)==null?void 0:y.title}'`)&&(await s.updateTodoStatus(v.id,n),t("update"))}return K(async()=>{await r()}),(v,n)=>{var f,P,k,u,x,T,w,O;const y=ie("UserChip");return l(),c("div",Wt,[D(s).loading?(l(),U(Q,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:E(()=>n[5]||(n[5]=[A(" Loading... ")])),_:1,__:[5]})):b("",!0),e("div",null,[n[11]||(n[11]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),e("div",qt,[e("div",Gt,[n[6]||(n[6]=e("div",{class:"font-semibold text-xs text-gray-500"},"Date",-1)),e("span",null,S(D(X)(p.value,{weekDay:"long"})),1)]),e("div",Ht,[n[7]||(n[7]=e("div",{class:"text-xs text-gray-500"},"Todo",-1)),A(" "+S((f=D(s).todo)==null?void 0:f.title),1)]),o.todo.user?(l(),c("div",Kt,[j(y,{user:o.todo.user,"avatar-size":"xsmall"},null,8,["user"]),e("div",Vt,S((k=(P=o.todo.user)==null?void 0:P.department)==null?void 0:k.name),1)])):b("",!0),e("div",null,[n[10]||(n[10]=e("div",{class:"text-xs text-gray-500"},"Status",-1)),e("div",Yt,[e("div",null,[(u=D(s))!=null&&u.todo?(l(),U(ne,{key:0,todo:(x=D(s))==null?void 0:x.todo},null,8,["todo"])):b("",!0),A(" "+S((T=D(s).todo)==null?void 0:T.status),1)]),a.value&&!D(s).loading?(l(),c("div",Jt,[((w=D(s).todo)==null?void 0:w.status)==="PENDING"?(l(),c("button",{key:0,class:"btn-2 from-yellow-700 to-yellow-500 text-white hover:bg-green-600 hover:text-white",onClick:n[0]||(n[0]=C(()=>h(D(s).todo,"WORKING"),["prevent","stop"]))},n[8]||(n[8]=[e("i",{class:"fas fa-exclamation-circle"},null,-1),A(" Change to Working ")]))):b("",!0),((O=D(s).todo)==null?void 0:O.status)==="WORKING"?(l(),c("button",{key:1,class:"btn-2 from-green-700 to-green-300 text-white hover:bg-green-600 hover:text-white",onClick:n[1]||(n[1]=C(()=>h(D(s).todo,"COMPLETED"),["prevent","stop"]))},n[9]||(n[9]=[e("i",{class:"fas fa-check"},null,-1),A(" Make Complete ")]))):b("",!0)])):b("",!0)])])])]),e("div",Qt,[e("button",{type:"button",onClick:n[2]||(n[2]=g=>t("cancelClick")),class:"btn-3"},"Cancel"),a.value&&!D(s).loading?(l(),c("div",Xt,[e("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:n[3]||(n[3]=C(g=>t("clickEdit",D(s).todo),["prevent","stop"]))},n[12]||(n[12]=[e("i",{class:"fas fa-pen"},null,-1),A(" Edit ")])),e("button",{class:"btn-2-red",onClick:n[4]||(n[4]=C(()=>d(D(s).todo),["prevent","stop"]))},n[13]||(n[13]=[e("i",{class:"fas fa-trash-alt"},null,-1),A(" Delete ")]))])):b("",!0)])])}}},eo={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","update","clickEdit","clickDelete","clickChangeStatus"],setup(o,{emit:$}){const i=$;function s(){i("update")}return(m,t)=>(l(),c(B,null,[o.todoModal.action=="add"?(l(),U(ee,{key:0},{default:E(()=>{var r;return[j(Ut,{onCancelClick:t[0]||(t[0]=p=>i("cancelClick")),onUpdate:s,date:(r=o.todoModal)==null?void 0:r.date,userRole:o.userRole},null,8,["date","userRole"])]}),_:1})):b("",!0),o.todoModal.action=="edit"?(l(),U(ee,{key:1},{default:E(()=>{var r;return[j(zt,{onCancelClick:t[1]||(t[1]=p=>i("cancelClick")),onUpdate:s,todo:(r=o.todoModal)==null?void 0:r.todo,userRole:o.userRole},null,8,["todo","userRole"])]}),_:1})):b("",!0),o.todoModal.action=="show"?(l(),U(ee,{key:2},{default:E(()=>{var r;return[j(Zt,{onCancelClick:t[2]||(t[2]=p=>i("cancelClick")),onUpdate:s,onClickEdit:t[3]||(t[3]=p=>i("clickEdit",p)),onClickDelete:t[4]||(t[4]=p=>i("clickDelete",p)),onClickChangeStatus:t[5]||(t[5]=(p,a)=>i("clickChangeStatus",p,a)),todo:(r=o.todoModal)==null?void 0:r.todo,userRole:o.userRole},null,8,["todo","userRole"])]}),_:1})):b("",!0)],64))}},to={class:"border bg-white relative"},co={__name:"TodoSection",props:{year:{type:Number,default:()=>new Date().getFullYear()},month:{type:Number,default:()=>new Date().getMonth()+1},day:{type:Number,default:()=>new Date().getDate()},week:{type:Number,default:()=>new Date().getDay()},type:{type:String,default:"month-view"},companyId:{type:String,default:""},departmentId:{type:String,default:""},employeeId:{type:String,default:""},lineType:{type:String,default:""},status:{type:String,default:""},userRole:{type:String,default:"employee"}},emits:["changeInput"],setup(o,{emit:$}){const i=new Date,s=o,m=L({type:"month-view",month:i.getMonth()+1,day:i.getDate(),year:i.getFullYear(),week:i.getDay()}),t=$;H(()=>({...m.value}),g=>{t("changeInput",g)}),H(()=>({year:s.year,month:s.month,day:s.day,week:s.week,type:s.type}),g=>{m.value={...g}},{immediate:!0});const r=L({action:null}),p=G();async function a(){await O()}function d(){r.value={...r.value,action:""}}async function h(g,I){await p.updateTodoStatus(g,I)}async function v(g){await p.deleteTodo(g)}function n(){m.value={...m.value,type:"month-view"}}function y(g){m.value={...m.value,...g}}function f(g){const[I,M,R]=g.split("-").map(Number);m.value={...m.value,type:"day-view",year:I,month:M,day:R}}function P(g){r.value={...r.value,action:"show",todo:g}}function k(g){r.value={...r.value,action:"edit",todo:g}}function u(g){r.value={...r.value,action:"add",date:g}}function x(){r.value={action:null,todo:null}}const T=_(()=>{var R,W,F,Z,se,le;const g=(W=(R=m.value)==null?void 0:R.year)==null?void 0:W.toString(),I=(Z=(F=m.value)==null?void 0:F.month)==null?void 0:Z.toString().padStart(2,"0"),M=(le=(se=m.value)==null?void 0:se.day)==null?void 0:le.toString().padStart(2,"0");return`${g}-${I}-${M}`}),w=_(()=>{var M,R,W,F;const g=(R=(M=m.value)==null?void 0:M.year)==null?void 0:R.toString(),I=(F=(W=m.value)==null?void 0:W.month)==null?void 0:F.toString().padStart(2,"0");return`${g}-${I}`});async function O(){const[g,I]=[Number(s.year),Number(s.month)],M=J(new Date(g,I-1,1)),R=J(he(g,I-1));console.log("FETCHING...",{startDate1:M,endDate1:R});const[W,F]=ke(g,I-1);console.log("FETCHING...",{startDate:W,endDate:F}),s.userRole=="employee"?await p.fetchMyTodos({"start-date":W,"end-date":F}):await p.fetchTodos({"company-id":s.companyId,"department-id":s.departmentId,"employee-id":s.employeeId,"line-type":s.lineType,"start-date":W,"end-date":F,status:s.status})}return K(async()=>{await O()}),H(()=>({"company-id":s.companyId,"department-id":s.departmentId,"employee-id":s.employeeId,"line-type":s.lineType,status:s.status,month:s.month}),()=>O()),(g,I)=>(l(),c("div",null,[e("div",to,[D(p).loading?(l(),U(Q,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:E(()=>I[0]||(I[0]=[A(" Loading... ")])),_:1,__:[0]})):b("",!0),j(Pe,{selected:m.value,class:"border-b shadow z-20",onChange:y,onReloadClick:a},{before:E(M=>[N(g.$slots,"beforeHeader",V(Y(M)))]),inner:E(M=>[N(g.$slots,"innerHeader",V(Y(M)))]),after:E(M=>[N(g.$slots,"afterHeader",V(Y(M)))]),bottom:E(M=>[N(g.$slots,"bottomHeader",V(Y(M)))]),typeSelection:E(M=>[N(g.$slots,"typeSelection",V(Y(M)))]),_:3},8,["selected"]),m.value.type=="month-view"?(l(),U(Ke,{key:1,month:w.value,class:"bg-white",onDateClick:f,onClickTodo:P,onClickDateCell:u},null,8,["month"])):b("",!0),m.value.type=="day-view"?(l(),U(bt,{key:2,date:T.value,userRole:o.userRole,onClickTodo:P,onClickEdit:k,onClickAdd:u,onClickDelete:v,onClickChangeStatus:h,onBackClick:n,onUpdate:d},null,8,["date","userRole"])):b("",!0)]),j(eo,{todoModal:r.value,userRole:o.userRole,onCancelClick:x,onUpdate:d,onClickEdit:k},null,8,["todoModal","userRole"])]))}};export{Se as _,co as a};
