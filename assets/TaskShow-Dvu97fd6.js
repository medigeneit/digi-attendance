import{L as mt,r as D,e as ft,E as wt,z as yt,m as S,c as o,o as a,g as v,t as b,H as R,d as vt,b as bt,a as t,F as E,k as u,w as $,p as h,i as w,D as F,f as I,h as xt,j as T,v as gt,q as j,x as M,M as It,C as ct,u as Dt,n as pt}from"./index-Cw8jGluf.js";import{L as B}from"./LoaderView-BbSlqFl_.js";import{O as A}from"./OverlyModal-CBjcdzWw.js";import{_ as Pt}from"./TaskAddForm-BsFI5vKh.js";import{_ as Ut}from"./TaskEditForm-B3Ua7hMw.js";import{_ as Lt,a as Et,b as Mt,c as At}from"./TaskTreeView-RnqUI3i-.js";import{a as Nt,_ as Ot}from"./TaskUserAssignForm-xPKF_3OH.js";import{u as jt,r as Rt,d as Ft,a as Bt}from"./task-priority-D33eaIOv.js";import{g as V}from"./datetime-q3Sn87-f.js";import{_ as q}from"./UserChip-DqBgq7Xx.js";import{u as Vt}from"./useTaskStore-qOMJZmj5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-8rR9Aqvf.js";import"./company-yejwjnQD.js";import"./useRequirementStore-D--gtazv.js";import"./requirement-DvzMdtj_.js";import"./CompanyDepartmentSelectInput-DfC3_nAw.js";import"./SectionLoading-Ck4ORw6G.js";import"./TextWithHr-DSRY8epi.js";import"./TaskUrgencyInput-Cfyc1gin.js";import"./tags-BqnW7M8c.js";import"./MultiselectDropdown-CI78IzCa.js";import"./url-CePbr-gY.js";import"./TaskUserChip-BLqGk61b.js";const Gt={key:0},qt={key:0},Ht={key:1},zt={key:2},Zt={key:3},Wt={key:1},_t=mt({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(i){const e=i;let n=0;const r=D(k());let l;function p(){return e.millisecond&&typeof e.millisecond=="number"}function k(){p()?n&&(n-=1e3):n=new Date(e.targetDateTime).getTime()-new Date().getTime();const f=Math.floor(n/1e3%60),s=Math.floor(n/1e3/60%60),_=Math.floor(n/(1e3*60*60)%24),U=Math.floor(n/(1e3*60*60*24));return{total:n,days:U,hours:_,minutes:s,seconds:f}}function x(){r.value=k()}ft(()=>{p()&&(n=e.millisecond),console.log("MOUNTED"),x(),l=setInterval(()=>{x(),r.value.total<=0&&clearInterval(l)},1e3)}),wt(()=>clearInterval(l)),yt(()=>e.targetDateTime,()=>{x(),clearInterval(l)});const d=S(()=>r.value.days.toString().padStart(2,"0")),m=S(()=>r.value.hours.toString().padStart(2,"0")),y=S(()=>r.value.minutes.toString().padStart(2,"0")),g=S(()=>r.value.seconds.toString().padStart(2,"0"));return(f,s)=>r.value.total>0?(a(),o("span",Gt,[!f.hideIfZeroValue||d.value!="00"?(a(),o("span",qt,b(d.value)+"d : ",1)):v("",!0),!f.hideIfZeroValue||m.value!="00"?(a(),o("span",Ht,b(m.value)+"h : ",1)):v("",!0),!f.hideIfZeroValue||y.value!="00"?(a(),o("span",zt,b(y.value)+"m : ",1)):v("",!0),!f.hideIfZeroValue||g.value!="00"?(a(),o("span",Zt,b(g.value)+"s",1)):v("",!0)])):(a(),o("span",Wt,[R(f.$slots,"expired")]))}}),Kt={class:"mb-3"},Jt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Qt={key:1,class:"text-center py-4 text-gray-500"},Xt={key:2,class:"text-center py-4 text-red-500"},Yt={key:3,class:"space-y-4"},te={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(i,{emit:e}){const n=i,r=vt(),l=bt(),p=S(()=>{var f;return!!(((f=r==null?void 0:r.user)==null?void 0:f.role)!=="employee"&&(r!=null&&r.isAdminMood))}),k=e,x=D(null),{handleItemsPriorityUpdate:d,saveTaskPriority:m,listHasRearranged:y}=jt(()=>n.tasks,n.parentId),g=async()=>{await m(),k("updatePriority")};return(f,s)=>(a(),o("div",null,[t("div",Kt,[R(f.$slots,"task:header")]),p.value?(a(),o(E,{key:0},[u(y)?(a(),o("div",Jt,[s[4]||(s[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:$(g,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:s[0]||(s[0]=$((..._)=>x.value.resetItems&&x.value.resetItems(..._),["prevent"]))},"Discard")])):v("",!0)],64)):v("",!0),i.loading?(a(),o("div",Qt,"Loading tasks...")):i.error?(a(),o("div",Xt,b(i.error),1)):(a(),o("div",Yt,[h(Nt,{items:i.tasks,handle:"handle",onItemsUpdate:u(d),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:x},{item:w(({item:_,index:U})=>[h(Lt,{isMyTask:u(l).name=="MyTaskShow",index:U,task:_,showDraggableHandle:p.value,"tree-level":i.treeLevel,class:"!border-0",onCommentButtonClick:L=>k("commentButtonClick",_.id),onEditClick:s[1]||(s[1]=L=>k("editClick",L)),onAddClick:s[2]||(s[2]=L=>k("addClick",L)),onEmployeeAssignClick:s[3]||(s[3]=L=>k("employeeAssignClick",L))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},ee={class:"flex justify-between mt-5"},se={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},ae={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(i,{emit:e}){const n=i,r=F({taskId:0,isOpen:!1}),l=e,p=D(),k=F({show:!1,parentId:n.parentId,requirementId:null}),x=f=>{k.show=!0,k.parentId=f,console.log({addForm:k})};function d(){k.show=!1,k.parentId=n.parentId,l("created")}function m(){l("assignUser")}function y(){p.value=!1,l("updated")}function g(){k.show=!1,k.parentId=n.parentId}return(f,s)=>(a(),o("div",null,[p.value?(a(),I(A,{key:0},{default:w(()=>[h(Ut,{taskId:p.value,onClose:s[0]||(s[0]=_=>p.value=null),onUpdated:y},null,8,["taskId"])]),_:1})):v("",!0),k.show?(a(),I(A,{key:1},{default:w(()=>[h(Pt,{parentTaskId:k.parentId,requirementId:k.requirementId,onTaskCreated:d,onError:f.handleTaskError,onClose:g},null,8,["parentTaskId","requirementId","onError"])]),_:1})):v("",!0),r.isOpen?(a(),I(A,{key:2},{default:w(()=>[h(Ot,{taskId:r.taskId,onCancelClick:s[1]||(s[1]=()=>{r.isOpen=!1,r.taskId=0}),onSuccess:s[2]||(s[2]=()=>{r.isOpen=!1,r.taskId=0,m()})},null,8,["taskId"])]),_:1})):v("",!0),h(te,{tasks:i.subTasks,parentId:i.parentId,treeLevel:i.treeLevel,onAddClick:s[4]||(s[4]=_=>x(_)),onEditClick:s[5]||(s[5]=_=>p.value=_),onUpdatePriority:s[6]||(s[6]=_=>l("updatePriority")),onEmployeeAssignClick:s[7]||(s[7]=_=>{r.taskId=_,r.isOpen=!0})},{"task:header":w(()=>[t("div",ee,[s[8]||(s[8]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks")],-1)),i.subTaskIsCreatable?(a(),o("div",se,[t("button",{class:"btn-1 ml-auto",onClick:s[3]||(s[3]=$(()=>x(i.parentId),["prevent"]))}," Add Sub Task ")])):v("",!0)])]),_:1},8,["tasks","parentId","treeLevel"])]))}},ne={class:"mb-2 mt-6"},le={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},oe={class:"flex justify-center"},re={class:"py-6 w-full text-center"},ie={class:"block mb-2"},de={class:"font-semibold text-red-600 mx-2 text-xl"},ue={class:"mt-2"},ce={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},pe={class:"flex justify-between items-center"},ke={key:0,class:"btn-2-red"},me={key:1,class:"btn-2-red"},kt=5e3,fe={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(i,{emit:e}){const n=i,r=D(""),l=D(""),p=e,k=D("");let x=0;async function d(){var g,f;if(!r.value)return k.value="Type the task title on input box";clearTimeout(x);try{k.value="",l.value==="deleted"?(l.value="restoring",await Rt(n.task.id),l.value="restored"):(l.value="deleting",await Ft(n.task.id,{params:{security_check:r.value}}),l.value="deleted"),l.value=="deleted"?x=setTimeout(()=>{y()},kt):p("closeClick")}catch(s){l.value="error",k.value=((f=(g=s.response)==null?void 0:g.data)==null?void 0:f.message)||`Failed to update ${n.type}`}}function m(){l.value==="deleted"&&y(),p("closeClick")}function y(){l.value="",p("delete")}return(g,f)=>{var s,_;return a(),o("form",{class:"p-4 relative",onSubmit:$(d,["prevent"])},[f[7]||(f[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",ne,[f[1]||(f[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,b((s=i.task)==null?void 0:s.title),1)]),l.value=="deleted"?(a(),o("div",le,f[2]||(f[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(a(),o(E,{key:1},[t("div",oe,[t("div",re,[t("label",ie,[f[3]||(f[3]=T(" Type ")),t("span",de,b((_=i.task)==null?void 0:_.title),1),f[4]||(f[4]=T(" and submit to delete "))]),xt(t("input",{type:"text","onUpdate:modelValue":f[0]||(f[0]=U=>r.value=U),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[gt,r.value]])])]),f[5]||(f[5]=t("hr",null,null,-1)),t("div",ue,[k.value?(a(),o("div",ce,b(k.value),1)):v("",!0)])],64)),t("div",pe,[t("button",{class:"btn-3",type:"button",onClick:$(m,["prevent"])},"Close"),l.value=="deleted"?(a(),o("button",ke,[f[6]||(f[6]=T(" Undo Delete in ")),l.value=="deleted"?(a(),I(_t,{key:0,"hide-if-zero-value":!0,millisecond:kt})):v("",!0)])):(a(),o("button",me,"Delete"))]),l.value=="deleting"||l.value=="restoring"?(a(),I(B,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:w(()=>[T(b(String(l.value).charAt(0).toUpperCase()+String(l.value).slice(1)),1)]),_:1})):v("",!0)],32)}}},ye=i=>i==null?void 0:i.reduce((e,n)=>e+n.task_weight,0),ht=(i,e)=>{const n=ye(i);return i.map(r=>{const l=e.filter(p=>p.user_id===r.id).reduce((p,k)=>p+k.progress,0);return{...r,task_progress:Math.floor(l*(r.task_weight/n)),user_progress:l}})},ve=(i,e)=>{let n=0;const r=[],l=x=>x.status==="COMPLETED",p=x=>x.users.some(d=>d.id===e),k=(x,d)=>{x.forEach(m=>{const y=p(m);r[d]=r[d]||{user_id:e,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const g=y&&m.children_tasks.length===0;r[d].total_assigned+=y?1:0,r[d].total_assigned_on_leaf_task+=g?1:0,n+=g?1:0,y&&l(m)&&(r[d].completed_count++,m.children_tasks.length),m.children_tasks.length>0&&k(m.children_tasks,d+1)})};return k(i,0),{sub_task_infos:r,assigned_on_any_leaf_task:n>0}},be=(i,e)=>i.map(n=>({...n,...ve(e,n.id)})),xe={key:0,class:"min-w-full bg-white rounded overflow-hidden"},ge={class:"py-0.5 text-bg font-semibold"},_e={class:"bg-gray-50"},he={class:"px-2 py-1 border-y"},Te={class:"px-2 py-1 border-y"},$e={key:0,class:"text-sm text-gray-400"},Ce={key:1},Se={key:1,class:"min-w-full bg-white rounded overflow-hidden"},we={class:"py-0.5 text-bg font-semibold"},Ie={class:"px-2 py-1 border-y text-center"},De={class:"px-2 py-1 border-y border-r"},Pe={class:"px-2 py-1 border-y text-center"},Ue={class:"px-2 py-1 border-y text-center"},Le=mt({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(i){const e=i,n=S(()=>ht(e.task.users,e.task.task_reports||[])),r=S(()=>be(e.task.users,e.subTasks));return(l,p)=>{var k,x;return e.task.children_task_count>0?(a(),o("table",xe,[t("caption",ge,[R(l.$slots,"caption",{},()=>[p[0]||(p[0]=T("Progress"))])]),t("thead",_e,[t("tr",null,[p[1]||(p[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),p[2]||(p[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(a(!0),o(E,null,j(((x=(k=r.value[0]||{})==null?void 0:k.sub_task_infos)==null?void 0:x.length)||1,d=>(a(),o("th",{key:d,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},b(d===1?"Completed Sub Task":"")+" "+b(d===2?"Completed Sub Sub Task":"")+" "+b(d===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(a(!0),o(E,null,j(r.value,(d,m)=>(a(),o("tr",{key:d.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",he,b(m+1),1),t("td",Te,[h(q,{user:d},null,8,["user"])]),(a(!0),o(E,null,j(d.sub_task_infos,(y,g)=>(a(),o("td",{class:"px-2 py-1 border-y text-center",key:g},[y.total_assigned===0||!d.assigned_on_any_leaf_task?(a(),o("div",$e," Not Assigned To Any Task ")):(a(),o("div",Ce,b(y.completed_count)+" / "+b(y.total_assigned),1))]))),128))]))),128))])])):(a(),o("table",Se,[t("caption",we,[R(l.$slots,"caption",{},()=>[p[3]||(p[3]=T("Progress"))])]),p[4]||(p[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(a(!0),o(E,null,j(n.value,(d,m)=>(a(),o("tr",{key:d.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ie,b(m+1),1),t("td",De,[h(q,{user:d},null,8,["user"])]),t("td",Pe,b(u(V)(d.task_started_at)),1),t("td",Ue,b(u(V)(d.task_finished_at)),1)]))),128))])]))}}}),Ee={class:"flex justify-center items-center"},Me={key:0,class:"flex flex-col justify-center items-center"},Ae={key:1},Ne={key:1},Oe={key:2,class:"flex justify-center items-center flex-col"},je={key:3,class:"flex flex-col justify-center items-center"},Re={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},Fe={class:"my-6"},Be={class:"text-center font-semibold text-blue-800 mb-4"},Ve={class:"text-center my-1"},Ge={class:"border px-2 rounded-md bg-gray-50"},qe={class:"text-red-600 text-center mt-2 text-sm"},He={class:"flex justify-between mt-3"},ze={class:"btn-2"},Ze={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(i,{emit:e}){const n=i,r=e,l=D(""),p=D(),k=D(),x=S(()=>({"bg-yellow-50":n.task.status==="IN_PROGRESS","bg-green-50":n.task.status==="COMPLETED","bg-red-50":n.task.status==="PENDING","bg-blue-50":n.task.closed_at})),d=S(()=>n.task.status=="PENDING"?"Start":n.task.status=="IN_PROGRESS"?"Finish":n.task.status=="COMPLETED"?"Close":""),m=S(()=>d.value=="Start"?"Start Task":d.value=="Finish"?"Finish Task":d.value=="Close"?"Close Task":"");async function y(){var f,s;p.value="submitting";try{await Bt(n.task.id,{status:l.value}),l.value="",r("updateStatus")}catch(_){k.value=(s=(f=_.response)==null?void 0:f.data)==null?void 0:s.message,r("error")}finally{p.value=""}}const g=S(()=>d.value=="Start"?"fas fa-play-circle text-blue-500":d.value=="Finish"?"fas fa-stop-circle text-blue-500":"");return(f,s)=>i.task.children_task_count>0&&i.task.status!=="PENDING"||i.task.children_task_count===0?(a(),o("div",{key:0,class:M(["border py-8 px-4 rounded",x.value])},[t("div",Ee,[i.task.closed_at?(a(),o("div",Me,s[4]||(s[4]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):i.task.status==="PENDING"?(a(),o("div",Ae,[i.task.children_task_count===0?(a(),o("button",{key:0,class:"btn-3",onClick:s[0]||(s[0]=$(_=>l.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(a(),o("div",Ne,"Task Pending"))])):i.task.status==="IN_PROGRESS"?(a(),o("div",Oe,[s[5]||(s[5]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),s[6]||(s[6]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),i.task.children_task_count===0?(a(),o("button",{key:0,class:"btn-3",onClick:s[1]||(s[1]=$(_=>l.value="COMPLETED",["prevent"]))}," Finish Task ")):v("",!0)])):i.task.status==="COMPLETED"?(a(),o("div",je,[s[7]||(s[7]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),s[8]||(s[8]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:s[2]||(s[2]=$(_=>l.value="CLOSED",["prevent"]))},"Close Task")])):v("",!0)]),l.value?(a(),I(A,{key:0},{default:w(()=>[t("form",{class:"p-4 rounded relative",onSubmit:$(y,["prevent"])},[p.value==="submitting"?(a(),I(B,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:w(()=>s[9]||(s[9]=[T("Submitting!")])),_:1,__:[9]})):v("",!0),t("h3",Re,b(m.value),1),t("div",Fe,[t("div",Be,b(i.task.title),1),s[12]||(s[12]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",Ve,[s[10]||(s[10]=T(" Want to ")),t("span",Ge,[t("i",{class:M(["text-sm",g.value])},null,2),T(" "+b(d.value),1)]),s[11]||(s[11]=T(" the task? "))])]),s[13]||(s[13]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",qe,b(k.value),1),t("div",He,[t("button",{class:"btn-3",onClick:s[3]||(s[3]=$(_=>l.value="",["prevent"]))},"Cancel"),t("button",ze,[t("i",{class:M(["text-xl text-white",g.value])},null,2),T(" "+b(d.value)+" Task ",1)])])])],32)]),_:1})):v("",!0)],2)):v("",!0)}},We=It("task-user",()=>({updateUserStartDate:async(n,r,l)=>await ct.patch(`/task-user/task/${n}/user/${r}/update-start-date/${l}`),updateUserFinishDate:async(n,r,l)=>await ct.patch(`/task-user/task/${n}/user/${r}/update-finish-date/${l}`)})),Ke={class:"border-b text-center"},Je={key:0},Qe={key:1},Xe={class:"mb-2 mt-6"},Ye={class:"flex justify-center"},ts={class:"py-6"},es={class:"mt-2"},ss={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},as={class:"flex justify-between items-center"},ns={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(i,{emit:e}){const n=i,r=e,l=We(),p=D(""),k=D("");async function x(){var d,m;console.log({date:p.value});try{n.type=="start-date"?await l.updateUserStartDate(n.task.id,n.user.id,p.value||"0"):n.type=="finish-date"&&await l.updateUserFinishDate(n.task.id,n.user.id,p.value||"0"),r("updateDate")}catch(y){k.value=((m=(d=y.response)==null?void 0:d.data)==null?void 0:m.message)||`Failed to update ${n.type}`}}return(d,m)=>(a(),o("form",{class:"p-4",onSubmit:$(x,["prevent"])},[t("div",Ke,[i.type=="start-date"?(a(),o("h2",Je,"Edit Start Date")):i.type=="finish-date"?(a(),o("h2",Qe,"Edit Finish Date")):v("",!0)]),t("div",Xe,[m[2]||(m[2]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,b(i.task.title),1)]),t("div",null,[m[3]||(m[3]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"User:",-1)),h(q,{user:i.user},null,8,["user"])]),t("div",Ye,[t("div",ts,[m[4]||(m[4]=t("label",{class:"block text-xs font-semibold"},"Date",-1)),xt(t("input",{type:"date","onUpdate:modelValue":m[0]||(m[0]=y=>p.value=y),class:"border py-2 px-4 rounded-md",size:"8"},null,512),[[gt,p.value]])])]),t("div",es,[k.value?(a(),o("div",ss,b(k.value),1)):v("",!0)]),t("div",as,[m[5]||(m[5]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1)),t("button",{class:"btn-3",onClick:m[1]||(m[1]=$(y=>r("closeClick"),["prevent"]))},"Close")])],32))}},ls={class:"container mx-auto p-6"},os={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},rs={class:"grid grid-cols-4"},is={class:"mb-4 flex col-span-full"},ds={class:"font-medium text-xl"},us={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},cs={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},ps={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},ks={key:2,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},ms={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},fs={class:"col-span-full mb-4"},ys=["innerHTML"],vs={class:"mt-4 col-span-full mb-6"},bs={class:"ml-auto text-right text-sm col-span-full"},xs={key:1,class:"text-gray-500"},gs={class:"font-semibold text-green-800"},_s={key:2,class:"ml-4 text-gray-500"},hs={class:"text-red-500 font-semibold"},Ts={class:"mt-6 py-2 flex justify-center items-center gap-2 col-span-full"},$s=["disabled"],Cs={class:"ml-auto flex gap-4"},Ss=["disabled"],ws=["disabled"],Is={key:0},Ds={key:1},Ps={key:1,class:"text-center py-4 text-red-500"},ea={__name:"TaskShow",setup(i){const e=Vt(),n=bt(),r=Dt(),l=D(""),p=vt(),k=S(()=>e.tasks),x=D({}),d=F({open:!1,task:null}),m=D(!0);ft(async()=>{l.value="loading",await g(n.params.id),l.value=""});const y=F({user:null,type:""});async function g(P){await e.fetchTask(P)}const f=S(()=>ht(e.task.users,e.task.task_reports||[])),s=S(()=>V(e.task.started_at)),_=S(()=>V(e.task.deadline));function U(P){y.user=p.user,y.type=P}async function L(){await g(n.params.id),y.user=null,y.type=""}const Tt=P=>{r.push({name:"TaskEdit",params:{id:P}})},G=S(()=>{var P,c;return e.task?((P=e.task)==null?void 0:P.parent_id)==0?{name:n.name==="MyTaskShow"?"MyTaskList":"TaskList"}:{params:{id:(c=e.task)==null?void 0:c.parent_id}}:null});function $t(){d.open=!0,d.task=e.task}function Ct(){d.open=!1,console.log({STATE:"Deleted",backLink:G.value}),r.push(G.value)}return yt(()=>n.params.id,async P=>{l.value="changing",await g(P),l.value=""}),(P,c)=>{var H,z,Z,W,K,J,Q,X,Y,tt,et,st,at,nt,lt,ot,rt,it,dt;const O=pt("RouterLink"),St=pt("router-view");return a(),o("div",ls,[y.user?(a(),I(A,{key:0},{default:w(()=>[h(ns,{task:u(e).task,user:y.user,type:y.type,onCloseClick:c[0]||(c[0]=C=>y.user=null),onUpdateDate:L},null,8,["task","user","type"])]),_:1})):v("",!0),d.open?(a(),I(A,{key:1},{default:w(()=>[h(fe,{onCloseClick:c[1]||(c[1]=C=>d.open=!1),task:d.task,onDelete:Ct},null,8,["task"])]),_:1})):v("",!0),l.value==="loading"?(a(),I(B,{key:2})):(a(),o("div",os,[u(e).task?(a(),o(E,{key:0},[t("section",rs,[t("div",is,[t("div",null,[t("h2",ds,b(u(e).task.title),1),t("div",us,[u(e).task.parent_id==0?(a(),o("div",cs," MAIN TASK ")):v("",!0),(H=u(e).task)!=null&&H.is_important?(a(),o("span",ps,"IMPORTANT")):v("",!0),(z=u(e).task)!=null&&z.is_urgent?(a(),o("span",ks,"URGENT")):v("",!0)])]),t("div",ms,[h(Et,{status:(Z=u(e).task)==null?void 0:Z.status,progressPercent:(W=u(e).task)==null?void 0:W.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),u(e).task?(a(),I(Mt,{key:0,task:u(e).task,ref_key:"progress",ref:x,class:"!text-lg"},null,8,["task"])):v("",!0)])]),t("div",fs,[t("p",{innerHTML:(K=u(e).task)==null?void 0:K.description,class:M(["text-gray-700",{"line-clamp-3":m.value}])},null,10,ys),((Q=(J=u(e).task)==null?void 0:J.description)==null?void 0:Q.length)>=600?(a(),o("button",{key:0,class:"text-blue-500 mt-2",onClick:c[2]||(c[2]=$(C=>m.value=!m.value,["prevent"]))}," Show "+b(m.value?"More":"Less"),1)):v("",!0)]),h(At,{task:(X=u(e))==null?void 0:X.task,"tree-level":(tt=(Y=u(e))==null?void 0:Y.task)==null?void 0:tt.level},null,8,["task","tree-level"]),t("section",vs,[h(Le,{"task-users":((et=u(e).task)==null?void 0:et.users)||[],task:u(e).task,"sub-tasks":u(e).tasks,"progress-users":f.value},{caption:w(()=>c[15]||(c[15]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])]),t("div",bs,[u(e).task.deadline?(a(),I(_t,{key:0,targetDateTime:u(e).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):v("",!0),s.value?(a(),o("span",xs,[c[16]||(c[16]=T(" Started: ")),t("span",gs,b(s.value),1)])):v("",!0),_.value?(a(),o("span",_s,[c[17]||(c[17]=T(" Deadline: ")),t("span",hs,b(_.value),1)])):v("",!0)]),h(Ze,{task:((st=u(e))==null?void 0:st.task)||{},class:"col-span-full",onUpdateStatus:c[3]||(c[3]=C=>{var N,ut;return g((ut=(N=u(e))==null?void 0:N.task)==null?void 0:ut.id)})},null,8,["task"]),t("div",Ts,[t("button",{onClick:c[4]||(c[4]=$(C=>{var N;return Tt((N=u(e).task)==null?void 0:N.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!u(e).task.closed_at}," Edit ",8,$s),h(O,{to:{name:"TaskUserAssign",params:{id:(at=u(e).task)==null?void 0:at.id}},class:M(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",u(e).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:c[5]||(c[5]=C=>C.stopPropagation())},{default:w(()=>c[18]||(c[18]=[t("i",{class:"fas fa-user-plus"},null,-1),T(" Assign Users ")])),_:1,__:[18]},8,["to","class"]),h(O,{to:G.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none",onClick:c[6]||(c[6]=C=>C.stopPropagation())},{default:w(()=>c[19]||(c[19]=[t("i",{class:"fas fa-arrow-left"},null,-1),T(" Back ")])),_:1,__:[19]},8,["to"]),t("div",Cs,[((nt=u(e).task)==null?void 0:nt.children_task_count)===0?(a(),o(E,{key:0},[t("button",{class:"btn-2-red h-8",onClick:$($t,["prevent"])}," Delete "),t("button",{class:"btn-3 px-3 py-0.5 text-sm h-8 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:c[7]||(c[7]=$(()=>U("start-date"),["prevent"])),disabled:!!((lt=P.authUserProgress)!=null&&lt.started_at)||!!u(e).task.closed_at}," Set Started Date ",8,Ss),t("button",{class:"btn-3 px-3 py-0.5 text-sm h-8 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:c[8]||(c[8]=$(()=>U("finish-date"),["prevent"])),disabled:!!((ot=P.authUserProgress)!=null&&ot.finished_at)||!!u(e).task.closed_at}," Set Finish Date ",8,ws)],64)):v("",!0),k.value.length>0?(a(),I(O,{key:1,to:{params:{id:(rt=u(e).task)==null?void 0:rt.id}},onClick:c[9]||(c[9]=C=>C.stopPropagation()),class:M(["py-0.5 btn-3 ml-auto text-sm h-8",{"bg-blue-500 text-white":u(n).name=="TaskShow"||u(n).name==="MyTaskShow"}])},{default:w(()=>c[20]||(c[20]=[t("i",{class:"fal fa-list-ul"},null,-1),T(" Sub Tasks ")])),_:1,__:[20]},8,["to","class"])):v("",!0),h(O,{to:{name:"TaskReports",params:{id:(it=u(e).task)==null?void 0:it.id}},onClick:c[10]||(c[10]=C=>C.stopPropagation()),class:M(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":u(n).name=="TaskReports"}])},{default:w(()=>c[21]||(c[21]=[t("i",{class:"fal fa-file-alt"},null,-1),T(" Reports ")])),_:1,__:[21]},8,["to","class"])])])]),(u(n).name=="TaskShow"||u(n).name==="MyTaskShow")&&((dt=u(e).task)==null?void 0:dt.level)<=2?(a(),o("section",Is,[h(ae,{subTasks:k.value,"parent-id":u(n).params.id,"tree-level":u(e).task.level+1,onCreated:c[11]||(c[11]=C=>g(u(n).params.id)),onUpdated:c[12]||(c[12]=C=>g(u(n).params.id)),onUpdatePriority:c[13]||(c[13]=C=>g(u(n).params.id)),onAssignUser:c[14]||(c[14]=C=>g(u(n).params.id)),"sub-task-is-creatable":!u(e).task.closed_at},null,8,["subTasks","parent-id","tree-level","sub-task-is-creatable"])])):(a(),o("section",Ds,[h(St)]))],64)):(a(),o("div",Ps,b(u(e).error),1)),l.value==="changing"?(a(),I(B,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):v("",!0)]))])}}};export{ea as default};
