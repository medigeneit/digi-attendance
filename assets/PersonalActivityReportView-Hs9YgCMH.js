import{_ as ye,g as ce,D as fe,f as xe,u as ge,G as ve,r as Z,x as c,q as L,h as be,c as p,o as d,a as e,j as f,i as ee,w as D,k as te,v as se,t as l,m as b,d as F,l as V,b as S,F as ne,e as oe,N as le,s as he}from"./index-vfsYf8tT.js";import{_ as _e}from"./EmployeeFilter-BGTHT7K-.js";import{L as we}from"./LoaderView-CHF2jPBx.js";import{U as ke}from"./UserChip-CIeTIAtg.js";import{g as ae,m as Ie,c as De,b as $,a as q}from"./datetime-Du_mcDA9.js";import{u as Te}from"./useTodoDateStore-Dk1Fb5_e.js";import"./company-DtFGY7nT.js";import"./department-XIk8MNpZ.js";import"./EmployeeDropdownInput-BgvCPwi4.js";import"./SelectDropdown-BbcpwSvb.js";import"./user-BA4PQQ21.js";import"./url-CePbr-gY.js";const Oe={class:"container mx-auto print:w-full print:px-0 print:py-0"},Me={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},Ne={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},Se={key:0,class:"relative h-[32px] flex gap-1 ml-auto justify-end print:hidden"},Ce={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Ee={key:1,class:"text-gray-400"},Re=["disabled"],Pe={key:0,class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0 shadow-sm"},Ue={class:"flex flex-wrap items-center gap-3"},Le={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Fe={class:"relative h-[32px] flex"},Ve={key:0,class:"text-xs text-blue-600 flex items-center gap-2 w-full md:w-auto md:ml-auto"},$e={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},qe={key:3,class:"space-y-4"},Ae={key:0,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},Be={class:"text-sm text-gray-700"},je={class:"font-semibold"},ze={class:"text-sm text-gray-700"},Ge={class:"font-semibold"},We={class:"text-sm text-gray-700"},Ke={class:"font-semibold text-green-600"},Qe={class:"text-sm text-gray-700"},Ye={class:"font-semibold text-blue-600"},He={class:"text-sm text-gray-700"},Je={class:"font-semibold text-amber-600"},Xe={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},Ze={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},et={class:"flex items-center gap-3"},tt={class:"font-semibold text-gray-800"},st={class:"text-xs text-gray-500"},nt={class:"text-[11px] text-gray-400"},ot={key:0},lt={key:1,class:"flex items-center gap-3"},at={class:"font-semibold text-gray-800"},rt={class:"text-xs text-gray-500"},dt={class:"text-[11px] text-gray-400"},it={key:0},pt={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},ut={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},mt={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},yt={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},ct={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},ft={class:"overflow-x-auto"},xt={class:"min-w-full text-left text-sm border-separate border-spacing-0"},gt={key:0},vt={class:"px-4 py-3 text-center border"},bt={class:"px-4 py-3 border"},ht={class:"font-semibold text-gray-800"},_t={class:"text-xs text-gray-500"},wt={class:"px-4 py-3 border text-xs text-gray-700"},kt={class:"px-4 py-3 border text-center"},It={__name:"PersonalActivityReportView",props:{selfOnly:{type:Boolean,default:!1}},setup(C){const u=C,T=Te(),re=ce(),{user:x}=fe(re),O=xe(),de=ge(),o=ve({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),r=Z(""),A=Z(null),k=c(()=>{if(!r.value)return"";const[s,t]=r.value.split("-").map(Number);return!s||!t?"":ae(new Date(s,t-1,1))}),I=c(()=>{if(!r.value)return"";const[s,t]=r.value.split("-").map(Number);return!s||!t?"":ae(Ie(new Date(s,t-1,1)))}),E=c(()=>r.value?De(`${r.value}-01`):""),h=c(()=>k.value&&I.value?`${$(k.value)} ~ ${$(I.value)}`:""),R=c(()=>{var s;return u.selfOnly?((s=x.value)==null?void 0:s.company_id)||"":o.companyId}),B=c(()=>!k.value||!I.value?!1:u.selfOnly?!!g.value&&!!R.value:!!R.value),j=c(()=>T.todo_dates||[]),g=c(()=>{var s;return(s=x.value)!=null&&s.id?String(x.value.id):""});function ie(s){o.companyId=s.company_id||"",o.departmentId=s.department_id||"",o.employeeId=u.selfOnly?g.value:s.employee_id||"",o.lineType=s.line_type||"all"}function pe(s){return s==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":s==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":s==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"}function z(s){var t,n;return s.todo_id||s.todoId||((t=s.todo)==null?void 0:t.id)||((n=s.todo)==null?void 0:n.todo_id)||s.id||`${s.title}-${s.date}`}const G=c(()=>{var m;if(u.selfOnly&&x.value)return[x.value];const s=((m=A.value)==null?void 0:m.employees)||[];if(s.length)return s;const t=[],n=new Set;return j.value.forEach(_=>{const a=_.user;if(!a||!a.id)return;const y=String(a.id);n.has(y)||(n.add(y),t.push(a))}),t}),ue=c(()=>o.employeeId?G.value.filter(s=>String(s.id)===String(o.employeeId)):G.value),M=c(()=>ue.value.map(s=>{const t=j.value.filter(a=>{var y;return String(((y=a.user)==null?void 0:y.id)??a.user_id)===String(s.id)}),n={};for(const a of t){const y=z(a),w=n[y],i=new Date(a.date),v=w?new Date(w.date):null;(!w||v&&i>v)&&(n[y]=a)}const m=Object.values(n).sort((a,y)=>new Date(y.date).getTime()-new Date(a.date).getTime()),_={total:m.length,completed:m.filter(a=>a.status==="COMPLETED").length,working:m.filter(a=>a.status==="WORKING").length,pending:m.filter(a=>a.status==="PENDING").length};return{user:s,latestTodos:m,totals:_}}).sort((s,t)=>{var n,m;return(((n=s.user)==null?void 0:n.name)||"").localeCompare(((m=t.user)==null?void 0:m.name)||"")})),N=c(()=>M.value.reduce((s,t)=>({totalTodos:s.totalTodos+t.totals.total,completed:s.completed+t.totals.completed,working:s.working+t.totals.working,pending:s.pending+t.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));function W(){console.log("syncQuery",o),de.replace({query:{...O.query,month:r.value||void 0,...u.selfOnly?{}:{company_id:o.companyId||void 0,department_id:o.departmentId||void 0,employee_id:o.employeeId||void 0,line_type:o.lineType||void 0}}})}async function P(){B.value&&await T.fetchTodoDates({"company-id":R.value||void 0,"department-id":u.selfOnly?void 0:o.departmentId,"employee-id":u.selfOnly?g.value:o.employeeId,"line-type":u.selfOnly?void 0:o.lineType,"start-date":k.value,"end-date":I.value})}function U(){u.selfOnly&&g.value&&(o.employeeId=g.value)}function K(){const s=O.query||{};r.value=typeof s.month=="string"&&s.month?s.month:r.value||q(new Date),o.companyId=u.selfOnly?"":s.company_id||"",o.departmentId=u.selfOnly?"":s.department_id||"",o.employeeId=u.selfOnly?g.value:s.employee_id||"",o.lineType=u.selfOnly?"all":s.line_type||"all",U()}L(()=>[o.companyId,o.departmentId,o.employeeId,o.lineType,k.value,I.value,r.value],()=>{U(),W(),P()}),L(()=>O.query,()=>{K()}),L(g,()=>{U(),W(),P()}),be(()=>{r.value=r.value||q(new Date),K(),P()});function me(){window.print()}function Q(s){const t=r.value?new Date(`${r.value}-01`):new Date;t.setMonth(t.getMonth()+s),r.value=q(t)}function Y(){Q(-1)}function H(){Q(1)}return(s,t)=>(d(),p("div",Oe,[e("div",Me,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),e("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),e("span",Ne,[u.selfOnly?(d(),p("div",Se,[e("button",{class:"btn-3 h-[32px] px-3",onClick:D(Y,["prevent"])},t[6]||(t[6]=[e("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),e("div",Ce,[t[7]||(t[7]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),te(e("input",{id:"month",type:"month","onUpdate:modelValue":t[0]||(t[0]=n=>r.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[se,r.value]])]),e("button",{class:"btn-3 h-[32px] px-3",onClick:D(H,["prevent"])},t[8]||(t[8]=[e("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])):f("",!0),t[9]||(t[9]=e("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),e("span",null,l(E.value),1),h.value?(d(),p("span",Ee,"("+l(h.value)+")",1)):f("",!0)]),e("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:D(me,["prevent"]),disabled:b(T).loading,title:"Print"},t[10]||(t[10]=[e("i",{class:"fas fa-print"},null,-1)]),8,Re)]),u.selfOnly?f("",!0):(d(),p("div",Pe,[e("div",Ue,[F(_e,{ref_key:"employeeFilterRef",ref:A,company_id:o.companyId,"onUpdate:company_id":t[2]||(t[2]=n=>o.companyId=n),department_id:o.departmentId,"onUpdate:department_id":t[3]||(t[3]=n=>o.departmentId=n),employee_id:o.employeeId,"onUpdate:employee_id":t[4]||(t[4]=n=>o.employeeId=n),line_type:o.lineType,"onUpdate:line_type":t[5]||(t[5]=n=>o.lineType=n),"initial-value":b(O).query,onFilterChange:ie,class:"flex-1 min-w-[240px]"},{default:V(()=>[e("div",Le,[e("button",{class:"btn-3 h-[32px] px-3",onClick:D(Y,["prevent"])},t[12]||(t[12]=[e("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),e("div",Fe,[t[13]||(t[13]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),te(e("input",{id:"month",type:"month","onUpdate:modelValue":t[1]||(t[1]=n=>r.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[se,r.value]])]),e("button",{class:"btn-3 h-[32px] px-3",onClick:D(H,["prevent"])},t[14]||(t[14]=[e("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),u.selfOnly?(d(),p("div",Ve,[t[15]||(t[15]=e("i",{class:"fas fa-user-lock"},null,-1)),S(" Showing only my todos (Employee ID: "+l(g.value||"loading...")+") ",1)])):f("",!0)])])),B.value?b(T).loading?(d(),ee(we,{key:2},{default:V(()=>t[17]||(t[17]=[S("Loading report...")])),_:1,__:[17]})):(d(),p("div",qe,[C.selfOnly?f("",!0):(d(),p("div",Ae,[e("div",Be,[t[18]||(t[18]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",je,l(M.value.length),1)]),e("div",ze,[t[19]||(t[19]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),e("div",Ge,l(N.value.totalTodos),1)]),e("div",We,[t[20]||(t[20]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),e("div",Ke,l(N.value.completed),1)]),e("div",Qe,[t[21]||(t[21]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),e("div",Ye,l(N.value.working),1)]),e("div",He,[t[22]||(t[22]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),e("div",Je,l(N.value.pending),1)])])),M.value.length===0?(d(),p("div",Xe," No data available for the selected month. ")):f("",!0),(d(!0),p(ne,null,oe(M.value,(n,m)=>{var _,a,y,w;return d(),p("div",{key:((_=n.user)==null?void 0:_.id)||m,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[e("div",Ze,[C.selfOnly?(d(),p("div",lt,[F(le,{user:b(x),size:"medium"},null,8,["user"]),e("div",null,[e("div",at,l(((a=b(x))==null?void 0:a.name)||"Unknown user"),1),e("div",rt,l(((w=(y=b(x))==null?void 0:y.department)==null?void 0:w.name)||"-"),1),e("div",dt,[S(" Month: "+l(E.value)+" ",1),h.value?(d(),p("span",it,"("+l(h.value)+")",1)):f("",!0)])])])):(d(),ee(ke,{key:0,user:n.user},{trigger:V(({user:i})=>{var v;return[e("div",et,[F(le,{user:i,size:"medium"},null,8,["user"]),e("div",null,[e("div",tt,l((i==null?void 0:i.name)||"Unknown user"),1),e("div",st,l(((v=i==null?void 0:i.department)==null?void 0:v.name)||"-"),1),e("div",nt,[S(" Month: "+l(E.value)+" ",1),h.value?(d(),p("span",ot,"("+l(h.value)+")",1)):f("",!0)])])])]}),_:2},1032,["user"])),e("div",pt,[e("span",ut," Total "+l(n.totals.total),1),e("span",mt," Done "+l(n.totals.completed),1),e("span",yt," Working "+l(n.totals.working),1),e("span",ct," Pending "+l(n.totals.pending),1)])]),e("div",ft,[e("table",xt,[t[24]||(t[24]=e("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[e("tr",{class:"border-b"},[e("th",{class:"px-4 py-3 border text-center w-12"},"sl"),e("th",{class:"px-4 py-3 border text-left"},"Todo"),e("th",{class:"px-4 py-3 border text-left"},"Last Activity"),e("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),e("tbody",null,[n.latestTodos.length===0?(d(),p("tr",gt,t[23]||(t[23]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-400 border rounded-b"}," No activity recorded for this month. ",-1)]))):f("",!0),(d(!0),p(ne,null,oe(n.latestTodos,(i,v)=>{var J,X;return d(),p("tr",{key:z(i),class:"border-b"},[e("td",vt,l(v+1),1),e("td",bt,[e("div",ht,l(i.title),1),e("div",_t,l(((X=(J=i.todo)==null?void 0:J.todoable)==null?void 0:X.title)||""),1)]),e("td",wt,l(b($)(i.date)||i.date),1),e("td",kt,[e("span",{class:he(["text-xs font-semibold px-2.5 py-1 rounded-full",pe(i.status)])},l(i.status||"N/A"),3)])])}),128))])])])])}),128))])):(d(),p("div",$e,t[16]||(t[16]=[e("i",{class:"fad fa-tasks text-4xl"},null,-1),e("div",{class:"empty-state glass-panel"},[e("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),e("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)])))]))}},Ft=ye(It,[["__scopeId","data-v-8b6b7cdc"]]);export{Ft as default};
