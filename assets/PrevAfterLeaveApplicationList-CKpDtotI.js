import{u as P,b as F,A as $,r as p,e as j,y as c,p as E,B as O,c as m,o as v,a as t,t as u,s as b,h as g,z as U,v as W,k as x,g as D,F as H,q as I,f as Q,i as R}from"./index-BfqwrobQ.js";import{_ as z}from"./EmployeeFilter-6Dduxr0L.js";import{L as G}from"./LoaderView-D1jhxjBv.js";import{u as J}from"./leave-application-CnDwbLW2.js";import{u as K}from"./user-uY5kDsiA.js";import"./company-CF-un3li.js";import"./department-DXELAgue.js";import"./SelectDropdown-DsCax4KP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-3DcKPkca.js";const X={class:"space-y-2 px-4"},Y={class:"flex items-center justify-between gap-2"},Z={class:"title-md md:title-lg flex-wrap text-center"},ee={class:"flex flex-wrap gap-2 items-center"},te={key:0,class:"text-center py-4"},re={key:1,class:"space-y-4"},se={class:"overflow-x-auto"},le={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},oe={class:"border border-gray-300 px-2"},de={class:"border border-gray-300 px-2"},ae={class:"border border-gray-300 px-2"},ne={class:"border border-gray-300 px-2"},ue={class:"border border-gray-300 px-2"},ie={class:"border border-gray-300 px-2"},ye=["innerHTML"],ve={class:"border border-gray-300 px-2"},_e={class:"border border-gray-300 px-2"},me={class:"border border-gray-300 px-2"},pe={class:"flex justify-center gap-2"},fe=["onClick"],ce={key:0},Te={__name:"PrevAfterLeaveApplicationList",setup(be){const h=P(),i=F(),d=J(),k=K(),{leaveApplications:T,loading:w}=$(d),C=p(null),a=p(i.query.applicationType==="after"?"after":"prev"),n=p(i.query.date||d.selectedMonth||new Date().toISOString().slice(0,7)),s=p({company_id:i.query.company_id||"",department_id:i.query.department_id||"",line_type:i.query.line_type||"all",employee_id:i.query.employee_id||""});function q(l){return/^\d{4}-\d{2}$/.test(l||"")?`${l}-15`:l||new Date().toISOString().slice(0,10)}const _=async()=>{const l=a.value==="after"?"next_week":"prev_week",r=q(n.value),o={company_id:s.value.company_id,department_id:s.value.department_id,selectedDate:n.value,selectedStatus:d.selectedStatus,query:l,anchor_date:r};s.value.employee_id&&(o.user_id=s.value.employee_id),s.value.line_type&&s.value.line_type!=="all"&&(o.line_type=s.value.line_type),w.value=!0;try{await d.fetchLeaveApplications(o)}finally{w.value=!1}};j(async()=>{s.value.employee_id&&(await k.fetchUser(s.value.employee_id),C.value=k.user||null),await _()});function B(){const l={type:a.value,date:n.value};return s.value.company_id&&(l.company_id=String(s.value.company_id)),s.value.department_id&&(l.department_id=String(s.value.department_id)),s.value.line_type&&s.value.line_type!=="all"&&(l.line_type=String(s.value.line_type)),s.value.employee_id&&(l.employee_id=String(s.value.employee_id)),l}let f=null;function A(){f&&clearTimeout(f),f=setTimeout(()=>{h.replace({query:B()}).catch(()=>{})},120)}c(()=>i.query,l=>{const r=l.type==="after"?"after":"prev",o=l.date||"",e={company_id:l.company_id||"",department_id:l.department_id||"",line_type:l.line_type||"all",employee_id:l.employee_id||""};let y=!1;r!==a.value&&(a.value=r,y=!0),o&&o!==n.value&&(n.value=o,y=!0),(e.company_id!==s.value.company_id||e.department_id!==s.value.department_id||e.type!==s.value.type||e.employee_id!==s.value.employee_id)&&(s.value=e,y=!0),y&&_()}),c(()=>[a.value,n.value,s.value.company_id,s.value.department_id,s.value.employee_id],()=>{A(),_()}),c(()=>d.selectedStatus,()=>_());const S=E(()=>T.value||[]),V=async l=>{confirm("Are you sure to delete this application?")&&(await d.deleteLeaveApplication(l),await _())},M=()=>h.go(-1),N=()=>{A()};return(l,r)=>{const o=O("RouterLink");return v(),m("div",X,[t("div",Y,[t("button",{class:"btn-3",onClick:M},r[7]||(r[7]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),t("h1",Z,u(a.value==="after"?"Upcoming Leave Applications":"Previous 1 Week Leave Applications"),1),r[8]||(r[8]=t("div",null,null,-1))]),t("div",ee,[b(z,{company_id:s.value.company_id,"onUpdate:company_id":r[0]||(r[0]=e=>s.value.company_id=e),department_id:s.value.department_id,"onUpdate:department_id":r[1]||(r[1]=e=>s.value.department_id=e),employee_id:s.value.employee_id,"onUpdate:employee_id":r[2]||(r[2]=e=>s.value.employee_id=e),line_type:s.value.line_type,"onUpdate:line_type":r[3]||(r[3]=e=>s.value.line_type=e),"with-type":!0,"initial-value":l.$route.query,onFilterChange:N},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",null,[g(t("select",{"onUpdate:modelValue":r[4]||(r[4]=e=>a.value=e),class:"input-1"},r[9]||(r[9]=[t("option",{value:"prev"},"Previous 1 Week",-1),t("option",{value:"after"},"After Applications",-1)]),512),[[U,a.value]])]),t("div",null,[g(t("input",{id:"monthOrDate",type:"date","onUpdate:modelValue":r[5]||(r[5]=e=>n.value=e),class:"input-1"},null,512),[[W,n.value]])]),t("div",null,[g(t("select",{"onUpdate:modelValue":r[6]||(r[6]=e=>x(d).selectedStatus=e),class:"input-1"},r[10]||(r[10]=[t("option",{value:""},"All",-1),t("option",{value:"Pending"},"Pending",-1),t("option",{value:"Approved"},"Approved",-1),t("option",{value:"Rejected"},"Rejected",-1)]),512),[[U,x(d).selectedStatus]])]),t("div",null,[t("button",{onClick:_,class:"btn-3"},r[11]||(r[11]=[t("i",{class:"far fa-sync"},null,-1),t("span",null,"Refresh",-1)]))])]),x(d).loading?(v(),m("div",te,[b(G)])):(v(),m("div",re,[t("div",se,[t("table",le,[r[16]||(r[16]=t("thead",null,[t("tr",{class:"bg-gray-200"},[t("th",{class:"border border-gray-300 px-2 text-left"},"#"),t("th",{class:"border border-gray-300 px-2 text-left"},"Employee Name"),t("th",{class:"border border-gray-300 px-2 text-left"},"Last Working Day"),t("th",{class:"border border-gray-300 px-2 text-left"},"Resumption Date"),t("th",{class:"border border-gray-300 px-2 text-left"},"Leave Period"),t("th",{class:"border border-gray-300 px-2 text-left"},"Total Days"),t("th",{class:"border border-gray-300 px-2 text-left"},"Type"),t("th",{class:"border border-gray-300 px-2 text-left"},"Status"),t("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),t("tbody",null,[(v(!0),m(H,null,I(S.value,(e,y)=>{var L;return v(),m("tr",{key:y,class:"border-b border-gray-200 hover:bg-blue-200"},[t("td",oe,u(y+1),1),t("td",de,u(((L=e==null?void 0:e.user)==null?void 0:L.name)||"Unknown"),1),t("td",ae,u(e==null?void 0:e.last_working_date),1),t("td",ne,u(e==null?void 0:e.resumption_date),1),t("td",ue,u(e==null?void 0:e.leave_period),1),t("td",ie,[t("div",{innerHTML:e.duration||(e==null?void 0:e.total_leave_days)},null,8,ye)]),t("td",ve,u(e==null?void 0:e.application_types),1),t("td",_e,u((e==null?void 0:e.status)||"N/A"),1),t("td",me,[t("div",pe,[b(o,{to:{name:"LeaveApplicationShow",params:{id:e==null?void 0:e.id}},class:"btn-icon"},{default:R(()=>r[12]||(r[12]=[t("i",{class:"far fa-eye"},null,-1)])),_:2,__:[12]},1032,["to"]),(e==null?void 0:e.status)!=="Approved"?(v(),Q(o,{key:0,to:{name:"LeaveApplicationEdit",params:{id:e==null?void 0:e.id}},class:"btn-icon"},{default:R(()=>r[13]||(r[13]=[t("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[13]},1032,["to"])):D("",!0),t("button",{onClick:ge=>V(e==null?void 0:e.id),class:"btn-icon text-red-500"},r[14]||(r[14]=[t("i",{class:"far fa-trash"},null,-1)]),8,fe)])])])}),128)),S.value.length?D("",!0):(v(),m("tr",ce,r[15]||(r[15]=[t("td",{colspan:"9",class:"p-1 text-center text-red-500"},"No application found",-1)])))])])])]))])}}};export{Te as default};
