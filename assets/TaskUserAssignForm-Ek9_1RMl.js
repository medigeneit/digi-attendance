import{x as R,f as A,o,i as T,n as w,a as s,q as Z,T as ee,c as n,g as k,w as z,d as se,r as x,e as L,t as V,k as F,F as P,y as te,h as W,v as H}from"./index-W-8vDVy9.js";import{g as Y}from"./datetime-DcVwRp76.js";import{u as le}from"./user-DlIcYnNf.js";import{u as ae}from"./useTaskStore-U0vvO3SO.js";import{L as oe}from"./LoaderView-BOPiIUWG.js";import{T as re}from"./TextWithHr-CnE87nRR.js";import{_ as ie,a as ne}from"./TaskUrgencyInput-CRMUDhQg.js";import{_ as ue}from"./DraggableList.vue_vue_type_script_setup_true_lang-DhIzC79e.js";import{S as de}from"./SelectDropdown-BBOSh6ti.js";import{_ as G}from"./UserChip-Cd-hMJpK.js";import{_ as me}from"./TaskUserChip-DiCorsfX.js";const pe={class:"w-full"},ce=["onClick"],ve={key:2,class:"btn-icon size-6 bg-blue-200 text-blue-800 border-blue-300"},fe={key:3,class:"btn-icon size-8 ml-auto bg-blue-200 text-blue-800 border-blue-300"},J={__name:"TaskAssignEmployeeInput",props:{modelValue:{type:Array,default:()=>[]},employees:{type:Array,required:!0},listType:{type:String,default:"employee"},placeholder:{type:String,default:""},isRemovable:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(U,{emit:E}){const h=U,y=E,C=R({get(){return h.modelValue},set(m){y("update:modelValue",m)}});function d(m){C.value=[...m],console.log({newList:m})}function g(){return h.listType==="supervisor"}function v(m){return h.listType==="employee"&&m===0}return(m,i)=>(o(),A(de,{modelValue:C.value,"onUpdate:modelValue":i[0]||(i[0]=f=>C.value=f),options:U.employees,placeholder:U.placeholder,class:"border-gray-300 bg-sky-50/10 !rounded-2xl shadow-sm",multiple:"","hide-selected-value":""},{"selected-options":T(({items:f,removeItem:t,getOption:l})=>[s("div",pe,[w(ue,{items:f||[],handle:"handle",class:"flex flex-col gap-x-4 gap-y-2 w-full",onItemsUpdate:d},{item:T(({item:S,index:c})=>[w(G,{user:l(S),isRemovable:c>0,isSortable:c>0,"avatar-size":v(c)?"medium":"small","avatar-class":["transition"],class:Z(["w-full flex bg-sky-100/40 !shadow-sm border-sky-200 "]),onRemoveClick:()=>t(S),onClick:$=>v(c)?$.stopPropagation():null},ee({after:T(()=>[!v(c)||g()?(o(),n("button",{key:0,class:"btn-icon size-6 ml-auto font-bold text-base text-red-600/60 hover:text-red-600 border border-red-200 flex items-center justify-center",onClick:z($=>t(S),["prevent","stop"])},i[2]||(i[2]=[s("i",{class:"fas fa-times"},null,-1)]),8,ce)):k("",!0),f.length>1&&!v(c)&&!g()?(o(),n("button",{key:1,type:"button",class:"btn-icon size-6 handle text-gray-500 hover:text-gray-800",onClick:z(()=>null,["stop"])},i[3]||(i[3]=[s("i",{class:"fas fa-arrows"},null,-1)]))):k("",!0),g()?(o(),n("div",ve,i[4]||(i[4]=[s("i",{class:"fas fa-user-cowboy text-base"},null,-1)]))):v(c)?(o(),n("div",fe,i[5]||(i[5]=[s("i",{class:"fas fa-user-crown text-xl"},null,-1)]))):k("",!0)]),_:2},[v(c)?{name:"title-bottom",fn:T(()=>[i[1]||(i[1]=s("span",{class:"text-xs italic text-gray-400"},"Responsible for Task",-1))]),key:"0"}:void 0]),1032,["user","isRemovable","isSortable","avatar-size","onRemoveClick","onClick"])]),_:2},1032,["items"])])]),option:T(({option:f})=>[w(G,{user:f,class:"w-full border-gray-300"},null,8,["user"])]),_:1},8,["modelValue","options","placeholder"]))}},ye={class:"bg-white z-20 sticky top-0 -mx-4 px-4"},ge={class:"col-span-full mb-2 font-semibold text-gray-800 text-sm line-clamp-3 mb-4"},be={class:"min-h-[150px]"},_e={key:1,class:"grid grid-cols-4 gap-8 mb-4 items-stretch"},xe={class:"col-span-2 flex flex-col"},ke={key:0,class:"mb-4"},we={class:"text-base"},he={key:2,class:"flex gap-x-3 gap-y-4 flex-wrap border p-2 rounded items-center flex-grow justify-center"},Se={key:1,class:"text-center w-full text-sm text-gray-400 py-2"},Ve={class:"col-span-2 w-full flex flex-col"},Te={key:0,class:"mb-4"},Ue={class:"text-base"},Ce={class:"flex items-end col-span-full md:col-span-2 gap-4"},$e={class:"w-1/2"},Fe={class:"w-1/2"},Ae={class:"block text-gray-600 text-sm mb-1 font-medium"},Ee={class:"bg-white border-t px-4 -mx-4 py-4 sticky bottom-0"},Re={key:0,class:"mb-4 text-red-500 font-medium"},ze={key:1,class:"mb-4 text-blue-500 font-medium"},Me={class:"flex justify-between items-center gap-4"},Be=["disabled"],Ge={__name:"TaskUserAssignForm",props:{taskId:{type:[Number,String],required:!0}},emits:["success","cancelClick"],setup(U,{emit:E}){var M;const h=ae(),y=se(),C=x([]),d=x(""),g=x(null),v=x([]),m=x([]),i=U,f=le(),t=x(null),l=x(((M=y.user)==null?void 0:M.role)=="employee"?{}:{is_important:!1,is_urgent:!1,is_target:!1,assigned_at:"",deadline:""}),S=E;L(async()=>{var e,u,p;d.value="loading";const a=await h.fetchTask(i.taskId,{with_parent:"true",with_department_users:"true"},{loadingBeforeFetch:!1,fetchOnly:!0});t.value=a.task,v.value=(e=t.value)!=null&&e.parent?(u=t.value.parent)==null?void 0:u.users:(a==null?void 0:a.to_department_users)||[],Q(t.value),C.value=t.value.users,m.value=((p=t.value)==null?void 0:p.supervisors)||[],d.value=""});const c=R(()=>{var a,e;return[...v.value,...(e=(a=t.value)==null?void 0:a.users)!=null&&e.length?[...t.value.users]:[]]}),$=R(()=>{var e,u,p,b;return[...(e=t.value)!=null&&e.parent?(u=t.value.parent)==null?void 0:u.supervisors:f.users,...(b=(p=t.value)==null?void 0:p.supervisors)!=null&&b.length?[...t.value.supervisors]:[]]}),K=async()=>{var a,e;d.value="submitting",g.value=null;try{await h.updateTask(i.taskId,l.value,{loadingBeforeFetch:!1}),S("success")}catch(u){g.value=((e=(a=u.response)==null?void 0:a.data)==null?void 0:e.message)||"Assign users failed"}finally{d.value=""}};function Q(a){var e,u,p,b;l.value=((e=y.user)==null?void 0:e.role)=="employee"?{user_ids:(u=t.value.users)==null?void 0:u.map(_=>_.id)}:{is_important:a.is_important,is_urgent:a.is_urgent,is_target:a.is_target,assigned_at:Y(a.assigned_at),deadline:Y(a.deadline),user_ids:(p=t.value.users)==null?void 0:p.map(_=>_.id),supervisor_ids:(b=t.value.supervisors)==null?void 0:b.map(_=>_.id)}}const X=x();return L(async()=>{await f.fetchTypeWiseEmployees({type:"academy_body,doctor,executive"})}),(a,e)=>{var u,p,b,_,B,I,N,D,O,j,q;return o(),n("div",{class:"px-4 rounded border max-h-[98vh] overflow-auto",ref_key:"taskFormContainerRef",ref:X},[s("div",ye,[e[8]||(e[8]=s("h2",{class:"text-xl font-semibold text-gray-800 mb-1 mt-4"},"Manage Employee(s) for Task",-1)),e[9]||(e[9]=s("hr",{class:"mb-4 !mt-0"},null,-1)),s("h3",ge,V((u=t.value)==null?void 0:u.title),1)]),s("form",{onSubmit:z(K,["prevent"]),class:"relative min-h-40"},[s("div",be,[d.value==="loading"?(o(),A(oe,{key:0,class:"absolute inset-0 border-0 shadow-none"})):(o(),n("div",_e,[s("div",xe,[(p=t.value)!=null&&p.from_department?(o(),n("div",ke,[e[10]||(e[10]=s("div",{class:"text-sm text-gray-500"},"Task From Department",-1)),s("div",we,V((_=(b=t.value)==null?void 0:b.from_department)==null?void 0:_.name),1)])):k("",!0),e[11]||(e[11]=s("label",{class:"block uppercase text-xs text-gray-600"}," Supervisors ",-1)),((I=(B=F(y))==null?void 0:B.user)==null?void 0:I.role)!=="employee"&&F(y).isAdminMood?(o(),A(J,{key:1,employees:$.value,"list-type":"supervisor",isRemovable:!0,modelValue:l.value.supervisor_ids,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value.supervisor_ids=r),class:"flex-grow",placeholder:"--No Supervisor assigned--"},null,8,["employees","modelValue"])):(o(),n("div",he,[(m.value||[]).length>0?(o(!0),n(P,{key:0},te(m.value,r=>(o(),A(me,{key:r.id,user:r},null,8,["user"]))),128)):(o(),n("div",Se," No Supervisor assigned "))]))]),s("div",Ve,[(N=t.value)!=null&&N.to_department?(o(),n("div",Te,[e[12]||(e[12]=s("div",{class:"text-sm text-gray-500"},"Task To Department",-1)),s("div",Ue,V((O=(D=t.value)==null?void 0:D.to_department)==null?void 0:O.name),1)])):k("",!0),e[13]||(e[13]=s("label",{class:"block uppercase text-xs text-gray-600"}," Employees ",-1)),w(J,{employees:c.value,modelValue:l.value.user_ids,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value.user_ids=r),class:"flex-grow",placeholder:"--No employee(s) assigned--"},null,8,["employees","modelValue"])]),((q=(j=F(y))==null?void 0:j.user)==null?void 0:q.role)!=="employee"&&F(y).isAdminMood?(o(),n(P,{key:0},[w(re,{class:"col-span-full"},{default:T(()=>e[14]||(e[14]=[s("div",{class:"px-2"},[s("b",{class:"fas fa-cog text-gray-400"}),s("span",{class:"text-gray-700 ml-2"},"Task Settings for Employee")],-1)])),_:1,__:[14]}),w(ie,{class:"col-span-full",isImportant:l.value.is_important,"onUpdate:isImportant":e[2]||(e[2]=r=>l.value.is_important=r),isUrgent:l.value.is_urgent,"onUpdate:isUrgent":e[3]||(e[3]=r=>l.value.is_urgent=r)},null,8,["isImportant","isUrgent"]),w(ne,{modelValue:l.value.is_target,"onUpdate:modelValue":e[4]||(e[4]=r=>l.value.is_target=r),class:"col-span-full md:col-span-2 mt-4"},null,8,["modelValue"]),s("div",Ce,[s("div",$e,[e[15]||(e[15]=s("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Assign Date",-1)),W(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>l.value.assigned_at=r),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[H,l.value.assigned_at]])]),s("div",Fe,[s("label",Ae,V(l.value.is_target?"Target":"")+" Deadline",1),W(s("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>l.value.deadline=r),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[H,l.value.deadline]])])])],64)):k("",!0)]))]),s("div",Ee,[g.value?(o(),n("div",Re,V(g.value),1)):k("",!0),d.value=="submitting"?(o(),n("div",ze," Saving changes... ")):k("",!0),s("div",Me,[s("button",{type:"button",onClick:e[7]||(e[7]=r=>S("cancelClick")),class:"btn-3"},"Cancel"),s("button",{disabled:d.value=="submitting"||d.value=="loading",type:"submit",class:"btn-2"},V(d.value=="submitting"?"Saving...":"Save"),9,Be)])])],32)],512)}}};export{Ge as _};
