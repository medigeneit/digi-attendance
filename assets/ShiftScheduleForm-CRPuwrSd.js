import{E as Q,r as d,G as T,s as j,p as I,q as U,b as X,c as r,a,d as w,z as Y,F as b,x as y,h as z,v as Z,y as k,o as i,t as f,k as B,D as P}from"./index-CxG37pJ2.js";import{u as ee}from"./company-BTgZzfHD.js";import{u as te}from"./shift-kVIYaVrX.js";import{d as M}from"./dayjs.min-Cbbdfn5l.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae=Q("shiftSchedule",()=>{const C=d([]);return{schedules:C,fetchSchedules:async c=>{const x=await T.get("/shift-schedules",c);return C.value=x.data,x.data},saveSchedules:async c=>{await T.post("/shift-schedules",{schedules:c==null?void 0:c.payload})}}}),oe={class:"p-4 max-w-[1600px] mx-auto"},le={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},ne=["value"],re=["value"],ie={class:"flex flex-wrap gap-3 mb-4"},ue=["onClick"],de={class:"text-sm"},ce={class:"overflow-auto"},ve={class:"table-auto w-full border text-sm"},pe={class:"sticky top-0 bg-white z-10"},he={class:"text-xs text-gray-400"},fe={class:"border p-2"},ge=["value"],be={class:"border p-2 whitespace-nowrap"},ye={class:"border p-2"},me=["onClick"],Se=["onClick"],xe=["title"],Ee={__name:"ShiftScheduleForm",setup(C){const D=ae(),m=ee(),c=te(),{companies:x,employees:W}=j(m),{shifts:O}=j(c),h=d(M().format("YYYY-MM")),g=d("");d(""),d("");const u=d("");d([]),d([]);const n=d({}),v=d([]),S=d({WEEKEND:"bg-red-700"}),A=["bg-green-700","bg-pink-600","bg-blue-800","bg-cyan-600","bg-red-300","bg-purple-700","bg-yellow-500","bg-indigo-500","bg-amber-600"],E=I(()=>Object.values(O.value||{}).flat());function K(){const s=E.value;let t=0;s.forEach(e=>{S.value[e.id]=A[t%A.length],t++}),S.value.WEEKEND="bg-red-700"}const _=I(()=>Array.from({length:M(h.value).daysInMonth()},(s,t)=>t+1)),$=s=>{const t=`${h.value}-${String(s).padStart(2,"0")}`;return M(t).format("ddd")},q=(s,t)=>{var o,l;const e=(l=(o=n.value)==null?void 0:o[s])==null?void 0:l[t];return e?["WEEKEND"].includes(e)?S.value[e]||"bg-gray-300":S.value[parseInt(e)]||"bg-gray-300":"bg-gray-300"},G=(s,t)=>{var l,p;const e=(p=(l=n.value)==null?void 0:l[s])==null?void 0:p[t],o=E.value.find(N=>N.id===e);return(o==null?void 0:o.name)||""},L=(s,t)=>{v.value.includes(parseInt(s))&&u.value&&(n.value[s]||(n.value[s]={}),n.value[s][t]=u.value)},F=s=>{v.value.includes(parseInt(s))&&u.value&&(n.value[s]||(n.value[s]={}),_.value.forEach(t=>{n.value[s][t]=u.value}))},R=()=>{v.value.forEach(s=>{F(s)})},H=()=>{v.value.forEach(s=>{var o;const t=W.value.find(l=>l.id===parseInt(s)),e=((o=t==null?void 0:t.weekends)==null?void 0:o.map(l=>l.slice(0,3)))||[];n.value[s]||(n.value[s]={}),_.value.forEach(l=>{const p=$(l);e.includes(p)&&(n.value[s][l]="WEEKEND")})})},J=async()=>{const s=Object.entries(n.value).flatMap(([t,e])=>v.value.includes(parseInt(t))?Object.entries(e).map(([o,l])=>({employee_id:parseInt(t),date:`${h.value}-${String(o).padStart(2,"0")}`,shift_id:l})):[]);try{await D.saveSchedules({payload:s}),alert("Shift schedule saved successfully!")}catch(t){console.error("Failed to save schedule",t),alert("Something went wrong while saving.")}};U(g,async s=>{s&&(await m.fetchEmployee(s),await c.fetchShifts({companyId:s}),K(),await V(s,h.value))}),U(h,async s=>{s&&(await m.fetchEmployee(g.value),await c.fetchShifts({companyId:g.value}),K(),await V(g.value,s))}),X(async()=>{await m.fetchCompanies()});const V=async(s,t)=>{try{const e=await D.fetchSchedules({params:{company_id:s,month:t}}),o={};e.forEach(l=>{v.value.push(l.employee_id),u.value=l==null?void 0:l.shift_id;const p=l.employee_id,N=parseInt(l.date.split("-")[2]);o[p]||(o[p]={}),o[p][N]=l.shift_id||"WEEKEND"}),console.log({mapped:o}),n.value=o}catch(e){console.error("Failed to load schedule data:",e)}};return(s,t)=>(i(),r("div",oe,[a("div",le,[w(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),class:"p-2 border rounded"},[t[5]||(t[5]=a("option",{value:""},"Select Company",-1)),(i(!0),r(b,null,y(z(x),e=>(i(),r("option",{key:e.id,value:e.id},f(e.name),9,ne))),128))],512),[[Y,g.value]]),w(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),class:"p-2 border rounded"},[t[6]||(t[6]=a("option",{value:""},"- Shift -",-1)),(i(!0),r(b,null,y(E.value,e=>(i(),r("option",{key:e.id,value:e.id},f(e.name),9,re))),128))],512),[[Y,u.value]]),w(a("input",{type:"month","onUpdate:modelValue":t[2]||(t[2]=e=>h.value=e),class:"p-2 border rounded"},null,512),[[Z,h.value]])]),a("div",ie,[(i(!0),r(b,null,y(E.value,e=>(i(),r("div",{key:e.id,class:k(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":u.value===e.id}]),onClick:o=>u.value=e.id},[a("div",{class:k(["w-5 h-5 rounded",S.value[e.id]||"bg-gray-300"])},null,2),a("span",de,f(e.name),1)],10,ue))),128)),a("div",{class:k(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":u.value==="WEEKEND"}]),onClick:t[3]||(t[3]=e=>u.value="WEEKEND")},t[7]||(t[7]=[a("div",{class:"w-5 h-5 rounded bg-red-700"},null,-1),a("span",{class:"text-sm"},"Weekend",-1)]),2)]),a("div",{class:"mb-4 flex gap-4"},[a("button",{onClick:R,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),a("button",{onClick:H,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),a("div",ce,[a("table",ve,[a("thead",pe,[a("tr",null,[t[8]||(t[8]=a("th",{class:"border p-2"},"Emp ID",-1)),t[9]||(t[9]=a("th",{class:"border p-2"},"Name",-1)),t[10]||(t[10]=a("th",{class:"border p-2"},"Action",-1)),(i(!0),r(b,null,y(_.value,e=>(i(),r("th",{key:e,class:"border text-center p-1 w-10"},[B(f(e)+" ",1),a("div",he,f($(e)),1)]))),128))])]),a("tbody",null,[(i(!0),r(b,null,y(z(W),e=>(i(),r("tr",{key:e.id},[a("td",fe,[w(a("input",{type:"checkbox",class:"mr-2",value:e.id,"onUpdate:modelValue":t[4]||(t[4]=o=>v.value=o)},null,8,ge),[[P,v.value]]),B(" "+f(e.code),1)]),a("td",be,f(e.name),1),a("td",ye,[a("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:o=>F(e.id)}," Apply to All Dates ",8,me)]),(i(!0),r(b,null,y(_.value,o=>(i(),r("td",{key:o,class:"border text-center cursor-pointer",onClick:l=>L(e.id,o)},[a("div",{title:G(e.id,o),class:k([q(e.id,o),"w-full h-6"])},null,10,xe)],8,Se))),128))]))),128))])])]),a("div",{class:"mb-4 mt-4"},[a("button",{onClick:J,class:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow"}," ðŸ’¾ Save Schedule ")])]))}},Ne=se(Ee,[["__scopeId","data-v-afad8da0"]]);export{Ne as default};
