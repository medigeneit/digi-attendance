import{_}from"./ApprovalItem-BByRxd--.js";import{L as Ke}from"./LoaderView-CbijMZGm.js";import{_ as Qe}from"./ShareComponent-a0_Z0nuU.js";import{d as et,u as tt,b as at,m as w,r as y,e as st,c as r,o as n,a as e,f as lt,p as g,j as i,t as l,F as D,y as j,g as p,x as C}from"./index-CmYiCXOi.js";import{u as ot}from"./leave-application-1j5zW9qc.js";import"./AcceptAndRejectHandler-rSUmXI46.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const nt={class:"my-container max-w-3xl space-y-6"},rt={key:1,class:"card-bg p-4 md:p-8 print:text-black"},it={class:"title-lg text-center"},dt={class:"text-center text-sm"},ut={class:"space-y-4"},pt={class:"grid md:grid-cols-2 print:grid-cols-2 gap-8"},ct={class:"text-sm"},vt={class:"pt-6"},bt={key:0},mt={key:1,class:"font-semibold"},yt={class:"flex justify-end gap-4"},gt={class:"table-auto border border-black bg-white text-xs"},_t={class:"border border-black px-2"},ft={class:"border border-black px-2"},xt={class:"border border-black px-2"},kt={class:"font-bold"},ht={class:"border border-black px-2"},wt={class:"table-auto border border-black bg-white text-xs"},Dt={class:"border border-black"},At={colspan:"2",class:"border border-black px-2 w-32"},Lt={class:"border border-black px-2"},jt={class:"border border-black px-2"},Tt={class:"font-bold"},Rt={class:"border border-black px-2"},Bt={class:"grid print:grid-cols-2 md:grid-cols-2 text-sm"},Ct={class:"text-sm"},St={class:"whitespace-pre-line"},Ft={class:"pt-8 grid grid-cols-2"},Mt={class:"text-sm"},Ut={class:"font-bold"},Et={class:"text-blue-700 print:text-black"},Wt={class:"overflow-x-auto"},Nt={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},It={class:"border border-gray-500 px-4 py-0.5 text-left"},Pt={class:"border border-gray-500 px-4 py-0.5 text-center"},$t={class:"border border-gray-500 px-4 py-0.5 text-center"},zt={class:"space-y-14"},Ot={class:"font-bold text-center text-lg"},Vt={key:0},Gt={key:0,class:"text-xs text-slate-600"},Ht={class:"grid md:grid-cols-3 print:grid-cols-3 gap-4 text-sm items-end"},Jt={class:"flex justify-evenly text-sm items-end"},qt={class:"mt-10 print:hidden space-y-3"},Xt={key:0,class:"border rounded-lg bg-white p-3 flex items-center gap-3"},Yt={class:"shrink-0"},Zt=["src"],Kt={key:1,class:"h-16 w-16 grid place-items-center rounded-md border text-slate-500"},Qt={class:"min-w-0 flex-1"},ea={class:"text-sm font-medium truncate"},ta=["href"],aa={key:0,class:"flex gap-2"},sa=["disabled"],la=["disabled"],oa=["disabled"],na=["accept"],ra={key:0,class:"mt-3 text-sm inline-flex items-center gap-2"},ia={key:2,class:"text-green-600 text-sm"},da={key:3,class:"text-red-600 text-sm"},Ne="JPG, PNG, WEBP, PDF",S=10,_a={__name:"LeaveApplicationShow",setup(ua){const T=et(),f=ot(),Ie=tt(),Pe=at(),R=w(()=>Pe.params.id),F=y(!0),c=y(!1),x=y(""),k=y(""),A=y(null),L=y(!1),M=y(null),U=["image/jpeg","image/png","image/webp","application/pdf"],a=w(()=>f.leaveApplication),E=w(()=>{var s;return typeof((s=a.value)==null?void 0:s.attachment)=="string"&&a.value.attachment.length>0}),W=w(()=>{var s,t;return((s=a.value)==null?void 0:s.user_id)===((t=T==null?void 0:T.user)==null?void 0:t.id)});st(async()=>{try{await f.fetchLeaveApplicationById(R.value)}catch(s){console.error("Failed to load leave application:",s)}finally{F.value=!1}});const $e=()=>Ie.go(-1),ze=()=>window.print(),v=s=>{if(!s)return"";const t=new Date(s),d=t.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}),b=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${d} , ${b}`},Oe=s=>/\.(png|jpe?g|webp|gif)$/i.test(s||""),Ve=s=>{try{const t=new URL(s);return decodeURIComponent(t.pathname.split("/").pop()||"attachment")}catch{return(s||"").split("/").pop()||"attachment"}},B=s=>{x.value=s,k.value="",setTimeout(()=>x.value="",2500)},h=s=>{k.value=s,x.value="",setTimeout(()=>k.value="",3500)},N=w(()=>{const s=a.value;if(!s||!s.last_working_date||!s.resumption_date)return 0;const t=new Date(s.last_working_date),d=new Date(s.resumption_date);return Math.ceil((d-t)/(1e3*60*60*24))-1}),m=async()=>{await f.fetchLeaveApplicationById(R.value)},Ge=s=>U.includes(s.type)?s.size/(1024*1024)>S?(h(`Max file size ${S} MB`),!1):!0:(h(`Only ${Ne} allowed`),!1),I=async s=>{await f.uploadLeaveApplicationAttachment(R.value,{attachment:s}),await m()},P=async s=>{if(!(!s||!Ge(s))){c.value=!0;try{const t=new FormData;t.append("file",s),t.append("folder","leave-application");const d=await f.fetchFileUpload(t);M.value=d==null?void 0:d.url,await I(M.value),B("Attachment uploaded")}catch(t){console.error("Upload failed:",t),h("Upload failed. Try again.")}finally{c.value=!1,A.value&&(A.value.value="")}}},He=async s=>{var d;const t=(d=s.target.files)==null?void 0:d[0];t&&await P(t)},Je=s=>{s.preventDefault(),L.value=!0},qe=s=>{s.preventDefault(),L.value=!1},Xe=async s=>{var d,b;s.preventDefault(),L.value=!1;const t=(b=(d=s.dataTransfer)==null?void 0:d.files)==null?void 0:b[0];t&&await P(t)},$=()=>{var s;return(s=A.value)==null?void 0:s.click()},Ye=async()=>{var s;try{await navigator.clipboard.writeText(((s=a.value)==null?void 0:s.attachment)||""),B("Link copied")}catch{h("Copy failed")}},Ze=async()=>{if(E.value&&confirm("Remove current attachment?")){c.value=!0;try{await I(null),B("Attachment removed")}catch(s){console.error("Remove failed:",s),h("Failed to remove attachment")}finally{c.value=!1}}};return(s,t)=>{var d,b,z,O,V,G,H,J,q,X,Y,Z,K,Q,ee,te,ae,se,le,oe,ne,re,ie,de,ue,pe,ce,ve,be,me,ye,ge,_e,fe,xe,ke,he,we,De,Ae,Le,je,Te,Re,Be,Ce,Se,Fe,Me,Ue,Ee,We;return n(),r("div",nt,[e("div",{class:"flex items-center justify-between gap-2 print:hidden"},[e("button",{class:"btn-3",onClick:$e},t[0]||(t[0]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[2]||(t[2]=e("h1",{class:"title-md md:title-xl flex-wrap text-center"},"Leave Application",-1)),e("button",{class:"btn-2",onClick:ze},t[1]||(t[1]=[e("i",{class:"far fa-print"},null,-1),i(" Print")]))]),F.value?(n(),lt(Ke,{key:0})):(n(),r("div",rt,[e("div",null,[e("h1",it,l((z=(b=(d=a.value)==null?void 0:d.user)==null?void 0:b.company)==null?void 0:z.name),1),e("p",dt,l((V=(O=a.value)==null?void 0:O.user)==null?void 0:V.company.address),1)]),e("div",ut,[e("div",pt,[e("div",null,[t[5]||(t[5]=e("p",null,"To",-1)),t[6]||(t[6]=e("p",{class:"font-bold"},"Managing Director",-1)),e("p",null,l((J=(H=(G=a.value)==null?void 0:G.user)==null?void 0:H.company)==null?void 0:J.name),1),e("p",ct,l((X=(q=a.value)==null?void 0:q.user)==null?void 0:X.company.address),1),e("p",vt,[t[3]||(t[3]=e("b",null,"Subject:",-1)),t[4]||(t[4]=i(" Leave Application for ")),(n(!0),r(D,null,j((Y=a.value)==null?void 0:Y.leave_types,(o,u)=>(n(),r(D,{key:u},[u&&o.days?(n(),r("span",bt,", ")):p("",!0),o.days?(n(),r("span",mt,l(o.type),1)):p("",!0)],64))),128))])]),e("div",yt,[e("div",null,[t[10]||(t[10]=e("h1",{class:"font-bold"},"Summary",-1)),e("table",gt,[t[9]||(t[9]=e("thead",null,[e("tr",{class:"bg-gray-200 border border-black"},[e("th",{class:"border border-black px-2"},"Type"),e("th",{class:"border border-black px-2"},"Days")])],-1)),e("tbody",null,[(n(!0),r(D,null,j((Z=a.value)==null?void 0:Z.leave_types,(o,u)=>(n(),r("tr",{key:u,class:"border border-black"},[e("td",_t,l(o.type),1),e("td",ft,l(o.days),1)]))),128)),e("tr",null,[t[7]||(t[7]=e("td",{class:"border-black px-2"},"WL/GHD",-1)),e("td",xt,l(N.value-((Q=(K=a.value)==null?void 0:K.leave_days)==null?void 0:Q.length)),1)]),e("tr",kt,[t[8]||(t[8]=e("td",{class:"border border-black px-2"},"Total",-1)),e("td",ht,l(N.value),1)])])])]),e("div",null,[t[14]||(t[14]=e("h1",{class:"font-bold"},"Last Leave",-1)),e("table",wt,[e("thead",null,[t[11]||(t[11]=e("tr",{class:"bg-gray-200 border border-black"},[e("th",{colspan:"2",class:"border border-black px-2"},"Date")],-1)),e("tr",Dt,[e("td",At,l(((te=(ee=a.value)==null?void 0:ee.last_leave)==null?void 0:te.date)||"N/A"),1)]),t[12]||(t[12]=e("tr",{class:"bg-gray-200 border border-black"},[e("th",{class:"border border-black px-2"},"Type"),e("th",{class:"border border-black px-2"},"Days")],-1))]),e("tbody",null,[(n(!0),r(D,null,j((se=(ae=a.value)==null?void 0:ae.last_leave)==null?void 0:se.types,(o,u)=>(n(),r("tr",{key:u,class:"border border-black"},[e("td",Lt,l(o==null?void 0:o.type),1),e("td",jt,l(o==null?void 0:o.days),1)]))),128)),e("tr",Tt,[t[13]||(t[13]=e("td",{class:"border border-black px-2"},"Total",-1)),e("td",Rt,l((oe=(le=a.value)==null?void 0:le.last_leave)!=null&&oe.types?a.value.last_leave.types.reduce((o,u)=>o+u.days,0):0),1)])])])])])]),e("div",null,[t[22]||(t[22]=e("h3",{class:"font-bold"},"Leave Details:",-1)),e("div",Bt,[e("li",null,[t[15]||(t[15]=e("strong",null,"Reason: ",-1)),i(l(((ne=a.value)==null?void 0:ne.reason)||"No reason provided"),1)]),e("li",null,[t[16]||(t[16]=e("strong",null,"Leave Days:",-1)),i(" "+l((re=a.value)==null?void 0:re.leave_period),1)]),e("li",null,[t[17]||(t[17]=e("strong",null,"Total Days:",-1)),i(" "+l((ie=a.value)==null?void 0:ie.total_leave_days),1)]),e("li",null,[t[18]||(t[18]=e("strong",null,"Weekends:",-1)),i(" "+l((ce=(pe=(ue=(de=a.value)==null?void 0:de.user)==null?void 0:ue.assign_weekend)==null?void 0:pe.weekends)==null?void 0:ce.join(", ")),1)]),e("li",null,[t[19]||(t[19]=e("strong",null,"Last Working Date:",-1)),i(" "+l((ve=a.value)==null?void 0:ve.last_working_date),1)]),e("li",null,[t[20]||(t[20]=e("strong",null,"Resumption Date:",-1)),i(" "+l((be=a.value)==null?void 0:be.resumption_date),1)]),e("li",null,[t[21]||(t[21]=e("strong",null,"Create Date:",-1)),i(" "+l(v((me=a.value)==null?void 0:me.created_at)),1)])])]),e("div",Ct,[e("p",St,[t[23]||(t[23]=e("strong",null,"Works in Hand: ",-1)),i(l(((ye=a.value)==null?void 0:ye.works_in_hand)||"No details provided"),1)])]),e("div",Ft,[e("div",Mt,[t[29]||(t[29]=e("hr",{class:"w-44 border-black hidden print:block my-1"},null,-1)),e("p",Ut,[t[24]||(t[24]=e("strong",null,"Applicant: ",-1)),e("span",Et,l((_e=(ge=a.value)==null?void 0:ge.user)==null?void 0:_e.name),1)]),e("p",null,[t[25]||(t[25]=e("strong",null,"Designation:",-1)),i(" "+l((ke=(xe=(fe=a.value)==null?void 0:fe.user)==null?void 0:xe.designation)==null?void 0:ke.title),1)]),e("p",null,[t[26]||(t[26]=e("strong",null,"Department:",-1)),i(" "+l((De=(we=(he=a.value)==null?void 0:he.user)==null?void 0:we.department)==null?void 0:De.name),1)]),e("p",null,[t[27]||(t[27]=e("strong",null,"Phone:",-1)),i(" "+l((Le=(Ae=a.value)==null?void 0:Ae.user)==null?void 0:Le.phone),1)]),e("p",null,[t[28]||(t[28]=e("strong",null,"Joining Date:",-1)),i(" "+l((Te=(je=a.value)==null?void 0:je.user)==null?void 0:Te.joining_date),1)])]),g(_,{application:a.value,type:"leave_applications",item:"handover",date:v(a.value.handover_set_at),onAction:m},null,8,["application","date"])]),e("div",null,[t[31]||(t[31]=e("h1",{class:"font-bold"},"Leave Balance",-1)),e("div",Wt,[e("table",Nt,[t[30]||(t[30]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-500 px-4 py-0.5 text-left"},"Leave Type"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Total Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Used Days"),e("th",{class:"border border-gray-500 px-4 py-0.5 text-center"},"Remaining Days")])],-1)),e("tbody",null,[(n(!0),r(D,null,j((Re=a.value)==null?void 0:Re.leave_balance,(o,u)=>(n(),r("tr",{key:u,class:"hover:bg-blue-200"},[e("td",It,l(o.leave_type),1),e("td",Pt,l(o==null?void 0:o.annual_quota),1),e("td",$t,l(o.used_days),1),e("td",{class:C(["border border-gray-500 px-4 py-0.5 text-center",{"text-green-600 font-bold":o.remaining_days>0,"text-red-600 font-bold":o.remaining_days===0}])},l(o.remaining_days),3)]))),128))])])])])]),e("div",zt,[e("p",Ot,[t[32]||(t[32]=i(" Leave Approval: ")),e("b",{class:C({"text-yellow-600":((Be=a.value)==null?void 0:Be.status)==="Pending","text-green-600":((Ce=a.value)==null?void 0:Ce.status)==="Approved","text-red-600":((Se=a.value)==null?void 0:Se.status)==="Rejected"})},l(((Fe=a.value)==null?void 0:Fe.status)||"N/A"),3)]),((Me=a.value)==null?void 0:Me.status)==="Rejected"?(n(),r("div",Vt,[e("p",null,[t[33]||(t[33]=e("b",null,"Rejected by: ",-1)),i(" "+l((Ee=(Ue=a.value)==null?void 0:Ue.rejected_by_user)==null?void 0:Ee.name),1)]),e("p",null,[t[34]||(t[34]=e("b",null,"Rejection Reason: ",-1)),i(" "+l(a.value.rejection_reason),1)]),(We=a.value)!=null&&We.rejected_at?(n(),r("p",Gt,[t[35]||(t[35]=e("i",{class:"far fa-clock"},null,-1)),i(" "+l(v(a.value.rejected_at)),1)])):p("",!0)])):p("",!0),e("div",Ht,[g(_,{application:a.value,type:"leave_applications",item:"in_charge",date:v(a.value.in_charge_set_at),onAction:m},null,8,["application","date"]),g(_,{application:a.value,type:"leave_applications",item:"coordinator",date:v(a.value.coordinator_set_at),onAction:m},null,8,["application","date"]),g(_,{application:a.value,type:"leave_applications",item:"operational_admin",date:v(a.value.operational_admin_set_at),onAction:m},null,8,["application","date"])]),e("div",Jt,[g(_,{application:a.value,type:"leave_applications",item:"recommend_by",date:v(a.value.recommended_at),onAction:m},null,8,["application","date"]),g(_,{application:a.value,type:"leave_applications",item:"approved_by",date:v(a.value.approved_at),onAction:m},null,8,["application","date"])])])])),e("section",qt,[E.value?(n(),r("div",Xt,[e("div",Yt,[Oe(a.value.attachment)?(n(),r("img",{key:0,src:a.value.attachment,alt:"Attachment preview",class:"h-16 w-16 object-cover rounded-md border"},null,8,Zt)):(n(),r("div",Kt,t[36]||(t[36]=[e("i",{class:"far fa-file text-2xl"},null,-1)])))]),e("div",Qt,[e("p",ea,l(Ve(a.value.attachment)),1),e("a",{href:a.value.attachment,target:"_blank",class:"text-blue-600 underline text-xs"},"Open link",8,ta)]),W.value?(n(),r("div",aa,[e("button",{class:"px-3 py-1.5 rounded-md border text-sm",onClick:Ye,disabled:c.value},"Copy link",8,sa),e("button",{class:"px-3 py-1.5 rounded-md border text-sm",onClick:$,disabled:c.value},"Replace",8,la),e("button",{class:"px-3 py-1.5 rounded-md border text-sm text-red-600",onClick:Ze,disabled:c.value},"Remove",8,oa)])):p("",!0)])):p("",!0),W.value?(n(),r("div",{key:1,class:C(["rounded-xl border-2 border-dashed p-6 transition grid place-items-center text-center",[L.value?"border-blue-500 bg-blue-50":"border-slate-300 hover:border-slate-400",c.value?"opacity-60 pointer-events-none":""]]),onDragover:Je,onDragleave:qe,onDrop:Xe},[e("div",{class:"space-y-2"},[t[38]||(t[38]=e("i",{class:"far fa-cloud-upload-alt text-3xl"},null,-1)),e("p",{class:"text-sm text-slate-600"},[t[37]||(t[37]=i(" Drag & drop your file here, or ")),e("button",{class:"text-blue-700 underline font-medium",type:"button",onClick:$},"browse")]),e("p",{class:"text-xs text-slate-500"}," Allowed: "+l(Ne)+" • Max "+l(S)+" MB ")]),e("input",{ref_key:"fileInput",ref:A,class:"hidden",type:"file",accept:U.join(","),onChange:He},null,40,na),c.value?(n(),r("div",ra,t[39]||(t[39]=[e("i",{class:"far fa-circle-notch fa-spin"},null,-1),i(" Uploading… ")]))):p("",!0)],34)):p("",!0),x.value?(n(),r("p",ia,l(x.value),1)):p("",!0),k.value?(n(),r("p",da,l(k.value),1)):p("",!0)]),g(Qe)])}}};export{_a as default};
