import{L as ge,u as _e,b as be,s as fe,r as M,x as u,A as xe,e as ye,c as x,o as y,a as t,n as te,k as n,t as d,j as U,h as k,v as N}from"./index-4LVguuel.js";import{L as he}from"./LoaderView-CQlnlSAE.js";import{C as we}from"./CriteriaAssignModal-Bf9ZJzKV.js";import{u as ke}from"./user-monthly-kpi-BWuSDyqK.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./monthly-kpi-assignments-RVMXyw75.js";const Ce={class:"space-y-4 px-4 print:px-0 max-w-7xl mx-auto"},Se={class:"flex items-center justify-between gap-2 sticky top-0 z-10 bg-white/80 backdrop-blur p-2 rounded-b-lg border-b print:hidden"},Te={class:"flex gap-2"},Ae=["disabled"],Me={key:0,class:"py-8 text-center"},Ve={key:1,class:"rounded-md border border-red-200 bg-red-50 p-3 text-red-700"},ze={key:2,class:"rounded-2xl bg-white p-5 shadow-sm space-y-4"},Fe={class:"text-center"},Ie={class:"text-sm text-gray-600"},Oe={class:"grid grid-cols-12 gap-2 text-sm"},je={class:"col-span-6 border p-2 rounded"},De={class:"font-medium"},Ue={class:"col-span-3 border p-2 rounded"},Be={class:"font-medium"},Ee={class:"col-span-3 border p-2 rounded"},Le={class:"col-span-6 border p-2 rounded"},Pe={class:"col-span-3 border p-2 rounded"},$e={class:"font-medium"},Ke={class:"grid grid-cols-1 print:grid-cols-3 md:grid-cols-3 gap-2 text-sm"},Re={class:"rounded-lg border p-2 text-center"},He={class:"font-semibold"},Ge={class:"rounded-lg border p-2 text-center"},Je={class:"font-semibold"},Ye={class:"rounded-lg border p-2 text-center"},qe={class:"font-semibold"},Qe={class:"overflow-x-auto"},We={class:"min-w-full border text-sm"},Xe={class:"border px-2 py-2 align-top"},Ze=["innerHTML"],et={key:1,class:"mt-2"},tt={key:0,viewBox:"0 0 24 24",class:"h-4 w-4 opacity-90"},st={key:1,viewBox:"0 0 24 24",class:"h-4 w-4 opacity-80"},ot={class:"border px-2 py-2 align-top text-right"},rt={class:"border px-2 py-2 align-top"},nt={class:"flex items-center justify-end gap-2"},at=["max","readonly"],it=["disabled"],dt={class:"border px-2 py-2 align-top"},lt={class:"flex items-center justify-end gap-2"},ct=["max","readonly"],ut=["disabled"],mt={class:"border px-2 py-2"},vt=["readonly"],pt={class:"mt-2 flex justify-end gap-2 print:hidden"},gt=["disabled"],_t={class:"border px-2 py-2 align-top text-right"},bt={class:"border px-2 py-2 align-top"},ft={class:"flex items-center justify-end gap-2"},xt=["max","readonly"],yt=["disabled"],ht={class:"border px-2 py-2 align-top"},wt={class:"flex items-center justify-end gap-2"},kt=["max","readonly"],Nt=["disabled"],Ct={class:"bg-gray-50 font-medium"},St={class:"border px-2 py-2 text-right"},Tt={class:"border px-2 py-2 text-right"},At={class:"border px-2 py-2 text-right"},Mt={class:"mt-4"},Vt={class:"grid grid-cols-12 gap-2 text-sm"},zt={class:"col-span-10 border p-2 rounded"},Ft=["readonly"],It={class:"mt-2 flex justify-end print:hidden"},Ot=["disabled"],jt={class:"col-span-10 border p-2 rounded"},Dt=["readonly"],Ut={class:"mt-2 flex justify-end print:hidden"},Bt=["disabled"],Et={key:3,class:"rounded-md border bg-white p-4 text-gray-600"},Lt={__name:"EvaluationShow",setup(Pt){const g=ge(),se=_e(),oe=be(),_=Number(oe.params.id),m=ke(),{current:a,isLoading:re,isSaving:h,error:E}=fe(m),v=M({max_score:0,incharge_score:0,incharge_comment:"",coordinator_score:0,coordinator_comment:"",final_score:0}),p=M({max_score:0,incharge_score:0,incharge_comment:"",coordinator_score:0,coordinator_comment:"",final_score:0}),V=M(""),z=M(""),l=u(()=>{var s;return!!((s=a.value)!=null&&s.finalized_at)}),F=u(()=>{var s;return((s=a.value)==null?void 0:s.form)??{}}),b=u(()=>{var s;return Number(p.value.max_score||((s=F.value)==null?void 0:s.performance_mark)||0)}),f=u(()=>{var s;return Number(v.value.max_score||((s=F.value)==null?void 0:s.target_marks)||0)}),I=u(()=>b.value+f.value),L=u(()=>C(p.value.incharge_score,0,b.value)+C(v.value.incharge_score,0,f.value)),P=u(()=>C(p.value.coordinator_score,0,b.value)+C(v.value.coordinator_score,0,f.value)),ne=u(()=>Number(p.value.final_score||0)+Number(v.value.final_score||0));function C(s,e,o){let r=Number(s??0);return Number.isFinite(r)||(r=0),r<e?e:r>o?o:r}function B(s){var r,c;const e=(s==null?void 0:s.target)??{};v.value={max_score:Number(e.max_score||((r=F.value)==null?void 0:r.target_marks)||0),incharge_score:Number(e.incharge_score||0),incharge_comment:String(e.incharge_comment||""),coordinator_score:Number(e.coordinator_score||0),coordinator_comment:String(e.coordinator_comment||""),final_score:Number(e.final_score||0)};const o=(s==null?void 0:s.performance)??{};p.value={max_score:Number(o.max_score||((c=F.value)==null?void 0:c.performance_mark)||0),incharge_score:Number(o.incharge_score||0),incharge_comment:String(o.incharge_comment||""),coordinator_score:Number(o.coordinator_score||0),coordinator_comment:String(o.coordinator_comment||""),final_score:Number(o.final_score||0)}}const w=u(()=>{var s;return((s=a.value)==null?void 0:s.user)??null}),ae=u(()=>{var s;return((s=w.value)==null?void 0:s.criteria_assignments)??null}),ie=u(()=>{const s=ae.value;return Array.isArray(s)?s.length:Array.isArray(s==null?void 0:s.items)?s.items.length:typeof(s==null?void 0:s.count)=="number"?s.count:typeof(s==null?void 0:s.length)=="number"?s.length:0}),O=M(!1);function de(){w.value&&(O.value=!0)}async function le(s){var e;O.value=!1;try{await m.show(_),B(a.value),g.success("Criteria updated")}catch{s&&((e=a.value)!=null&&e.user)&&(a.value.user.criteria_assignments=s.criteria_assignments||s)}}async function ce(){var e,o,r;await m.show(_),B(a.value);const s=((e=a.value)==null?void 0:e.observations)??[];V.value=((o=s.find(c=>c.role==="incharge"))==null?void 0:o.observation)||"",z.value=((r=s.find(c=>c.role==="coordinator"))==null?void 0:r.observation)||""}xe(a,B);async function ue(){var s,e,o;try{await m.updateTarget(_,((s=a.value)==null?void 0:s.monthly_target)||""),g.success("Target text saved"),await m.show(_)}catch(r){g.error(((o=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to save target")}}async function j(s,e){var T,A;const o=s==="target"?v.value:p.value,r=s==="target"?f.value:b.value,c=C(e==="incharge"?o.incharge_score:o.coordinator_score,0,r),D=e==="incharge"?o.incharge_comment:o.coordinator_comment;try{await m.rateScore(_,s,e,c,D||""),g.success(`${s} score saved`),await m.show(_)}catch(S){g.error(((A=(T=S==null?void 0:S.response)==null?void 0:T.data)==null?void 0:A.message)||"Failed to save score")}}async function $(s){var e,o;try{const r=s==="incharge"?V.value:z.value;await m.saveObservation(_,s,r),g.success("Observation saved")}catch(r){g.error(((o=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to save")}}async function me(){var s,e;if(confirm("Finalize this evaluation?"))try{await m.finalize(_),g.success("Finalized"),await m.show(_)}catch(o){g.error(((e=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to finalize")}}function ve(){se.back(-1)}ye(ce);function pe(){typeof window<"u"&&typeof window.print=="function"&&window.print()}return(s,e)=>{var o,r,c,D,T,A,S,K,R,H,G,J,Y,q,Q,W,X,Z,ee;return y(),x("div",Ce,[t("div",Se,[t("div",{class:"flex items-center gap-2"},[t("button",{class:"btn-3",onClick:ve},e[14]||(e[14]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[15]||(e[15]=t("h1",{class:"title-md md:title-lg"},"KPI Sheet",-1))]),t("div",Te,[t("button",{class:"btn-2",disabled:n(h)||l.value||!n(a),onClick:me},d(l.value?"Finalized":"Finalize"),9,Ae),t("button",{class:"btn-3",onClick:pe},e[16]||(e[16]=[t("i",{class:"far fa-print mr-1"},null,-1),U("Print")]))])]),n(re)?(y(),x("div",Me,[te(he)])):n(E)?(y(),x("div",Ve,d(n(E)),1)):n(a)?(y(),x("div",ze,[t("div",Fe,[e[17]||(e[17]=t("h2",{class:"text-xl font-semibold"},"Key Performance Indicator (KPI)",-1)),t("p",Ie," Bi-monthly: "+d((o=n(a).form)==null?void 0:o.start_month)+d((r=n(a).form)!=null&&r.end_month?` – ${n(a).form.end_month}`:""),1)]),t("div",Oe,[t("div",je,[e[18]||(e[18]=U("NAME: ")),t("span",De,d((D=(c=n(a))==null?void 0:c.user)==null?void 0:D.name),1)]),t("div",Ue,[e[19]||(e[19]=U("DESIGNATION: ")),t("span",Be,d((A=(T=n(a))==null?void 0:T.user)==null?void 0:A.designation),1)]),t("div",Ee,"DATE OF JOINING: "+d((K=(S=n(a))==null?void 0:S.user)==null?void 0:K.joining_date),1),t("div",Le,"DEPARTMENT: "+d((H=(R=n(a))==null?void 0:R.user)==null?void 0:H.department),1),t("div",Pe,[e[20]||(e[20]=U("COMPANY:")),t("span",$e,d((J=(G=n(a))==null?void 0:G.user)==null?void 0:J.company),1)])]),t("div",Ke,[t("div",Re,[e[21]||(e[21]=t("div",{class:"text-gray-500"},"In-charge total",-1)),t("div",He,d(L.value)+" / "+d(I.value),1)]),t("div",Ge,[e[22]||(e[22]=t("div",{class:"text-gray-500"},"Coordinator total",-1)),t("div",Je,d(P.value)+" / "+d(I.value),1)]),t("div",Ye,[e[23]||(e[23]=t("div",{class:"text-gray-500"},"Final (server)",-1)),t("div",qe,d(ne.value)+" / "+d(I.value),1)])]),t("div",Qe,[t("table",We,[e[31]||(e[31]=t("thead",null,[t("tr",{class:"bg-gray-100 text-gray-800"},[t("th",{class:"border px-2 py-2 w-10"},"ক্রম"),t("th",{class:"border px-2 py-2"},"কার্যসম্পাদন বিষয়"),t("th",{class:"border px-2 py-2 w-32 text-right"},"সর্বোচ্চ"),t("th",{class:"border px-2 py-2 w-32 text-right"},"In-charge"),t("th",{class:"border px-2 py-2 w-36 text-right"},"Coordinator/AD/DD")])],-1)),t("tbody",null,[t("tr",null,[e[27]||(e[27]=t("td",{class:"border px-2 py-2 align-top text-center"},"১",-1)),t("td",Xe,[(q=(Y=w.value)==null?void 0:Y.criteria_assignments)!=null&&q.description?(y(),x("div",{key:0,class:"prose prose-sm max-w-none text-slate-700 line-clamp-3",innerHTML:(W=(Q=w.value)==null?void 0:Q.criteria_assignments)==null?void 0:W.description},null,8,Ze)):(y(),x("div",et,[t("button",{onClick:de,title:"Assign KPI criteria",class:"btn-4"},[ie.value>0?(y(),x("svg",tt,e[24]||(e[24]=[t("path",{fill:"currentColor",d:"M9 16.2l-3.5-3.5L4 14.2l5 5 11-11-1.5-1.5z"},null,-1)]))):(y(),x("svg",st,e[25]||(e[25]=[t("path",{fill:"currentColor",d:"M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2z"},null,-1)]))),e[26]||(e[26]=t("span",{class:"ml-1 hidden lg:inline"}," Assign ",-1))])]))]),t("td",ot,d(b.value),1),t("td",rt,[t("div",nt,[k(t("input",{type:"number",min:"0",max:b.value,readonly:l.value,"onUpdate:modelValue":e[0]||(e[0]=i=>p.value.incharge_score=i),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,at),[[N,p.value.incharge_score,void 0,{number:!0}]]),t("button",{class:"btn-4 print:hidden",disabled:n(h)||l.value||!b.value,onClick:e[1]||(e[1]=i=>j("performance","incharge"))},"Save",8,it)])]),t("td",dt,[t("div",lt,[k(t("input",{type:"number",min:"0",max:b.value,readonly:l.value,"onUpdate:modelValue":e[2]||(e[2]=i=>p.value.coordinator_score=i),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,ct),[[N,p.value.coordinator_score,void 0,{number:!0}]]),t("button",{class:"btn-4 print:hidden",disabled:n(h)||l.value||!b.value,onClick:e[3]||(e[3]=i=>j("performance","coordinator"))},"Save",8,ut)])])]),t("tr",null,[e[29]||(e[29]=t("td",{class:"border px-2 py-2 align-top text-center"},"২",-1)),t("td",mt,[e[28]||(e[28]=t("label",{class:"block text-xs text-gray-600 mb-1"},"Target (মাসিক লক্ষ্য)",-1)),k(t("textarea",{rows:"3","onUpdate:modelValue":e[4]||(e[4]=i=>n(a).monthly_target=i),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200",placeholder:"এই মাসের স্পষ্ট টার্গেট লিখুন…"},null,8,vt),[[N,n(a).monthly_target]]),t("div",pt,[t("button",{class:"btn-4",disabled:n(h)||l.value,onClick:ue},"Save Target",8,gt)])]),t("td",_t,d(f.value),1),t("td",bt,[t("div",ft,[k(t("input",{type:"number",min:"0",max:f.value,readonly:l.value,"onUpdate:modelValue":e[5]||(e[5]=i=>v.value.incharge_score=i),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,xt),[[N,v.value.incharge_score,void 0,{number:!0}]]),t("button",{class:"btn-4 print:hidden",disabled:n(h)||l.value||!f.value,onClick:e[6]||(e[6]=i=>j("target","incharge"))},"Save",8,yt)])]),t("td",ht,[t("div",wt,[k(t("input",{type:"number",min:"0",max:f.value,readonly:l.value,"onUpdate:modelValue":e[7]||(e[7]=i=>v.value.coordinator_score=i),class:"w-20 rounded-md border px-2 py-1 text-right focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,kt),[[N,v.value.coordinator_score,void 0,{number:!0}]]),t("button",{class:"btn-4 print:hidden",disabled:n(h)||l.value||!f.value,onClick:e[8]||(e[8]=i=>j("target","coordinator"))},"Save",8,Nt)])])]),t("tr",Ct,[e[30]||(e[30]=t("td",{class:"border px-2 py-2 text-right",colspan:"2"},"সর্বমোট",-1)),t("td",St,d(I.value),1),t("td",Tt,d(L.value),1),t("td",At,d(P.value),1)])])])]),t("div",Mt,[e[34]||(e[34]=t("div",{class:"text-sm font-semibold mb-2"},"Observation:",-1)),t("div",Vt,[e[32]||(e[32]=t("div",{class:"col-span-2 border p-2 bg-gray-50 rounded"},"ইনচার্জ",-1)),t("div",zt,[k(t("textarea",{rows:"3","onUpdate:modelValue":e[9]||(e[9]=i=>V.value=i),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Ft),[[N,V.value]]),t("div",It,[t("button",{class:"btn-4",disabled:n(h)||l.value,onClick:e[10]||(e[10]=i=>$("incharge"))},"Save",8,Ot)])]),e[33]||(e[33]=t("div",{class:"col-span-2 border p-2 bg-gray-50 rounded"},"বিভাগীয় কো-অর্ডিনেটর",-1)),t("div",jt,[k(t("textarea",{rows:"3","onUpdate:modelValue":e[11]||(e[11]=i=>z.value=i),readonly:l.value,class:"w-full rounded-md border px-2 py-1 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-200"},null,8,Dt),[[N,z.value]]),t("div",Ut,[t("button",{class:"btn-4",disabled:n(h)||l.value,onClick:e[12]||(e[12]=i=>$("coordinator"))},"Save",8,Bt)])])])]),e[35]||(e[35]=t("div",{class:"grid grid-cols-12 gap-2 pt-4 text-sm"},[t("div",{class:"col-span-6 border p-3 rounded"},"মূল্যায়নকারীর নাম:"),t("div",{class:"col-span-6 border p-3 rounded"},"স্বাক্ষর:")],-1))])):(y(),x("div",Et,"Data not available.")),te(we,{modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=i=>O.value=i),"user-id":(X=w.value)==null?void 0:X.id,"user-label":(Z=w.value)==null?void 0:Z.name,criteria_assignments:(ee=w.value)==null?void 0:ee.criteria_assignments,onAssigned:le},null,8,["modelValue","user-id","user-label","criteria_assignments"])])}}},Yt=Ne(Lt,[["__scopeId","data-v-da9c9215"]]);export{Yt as default};
