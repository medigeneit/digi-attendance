import{r as y,h as fe,S as ve,x as L,A as pe,q as ne,c as u,o as i,a as f,k as P,N as m,j as D,F as I,e as J,t as h,w,v as oe,z as V,b as M,s as T,J as me}from"./index-DUG-Uvq3.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"w-full h-full"},ge={key:0,class:"flex flex-wrap items-center gap-2 w-full h-full justify-items-stretch py-1.5"},he={class:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm"},we=["onClick"],ke={key:1,class:"text-gray-400"},xe=["placeholder","onKeydown"],Se={key:1,class:"flex items-center h-full"},Ve=["title"],$e={key:1,class:"text-gray-500 text-sm"},Be={class:"flex items-center gap-0.5"},Ce={key:0,class:"px-2 pt-2"},Ke={class:"max-h-60 overflow-y-auto py-2"},Oe={key:0},Le={class:"mx-2 text-sm font-semibold"},Ge={class:"px-2 text-sm text-gray-700"},Ae=["onClick","onKeydown"],Ee=["onClick","onKeydown"],je={key:1,class:"px-3 py-2 text-gray-500 min-h-24 flex justify-center items-center -mt-2"},De={__name:"SelectDropdown",props:{options:{type:Array,required:!0},modelValue:{type:[Object,Array,String,Number,null],default:null},placeholder:{type:String,default:null},multiple:{type:Boolean,default:!1},label:{type:String,default:"label"},value:{type:String,default:"id"},clearable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},searchBy:{type:Function,default:null},position:{type:String,default:"auto",validator:r=>["top","left","right","bottom","auto"].includes(r)},containment:{type:Object,default:()=>window},taggable:{type:Boolean,default:!1},createOption:Function,hideSelectedValue:{type:Boolean,default:!1},isOptionGroup:{type:Boolean,default:!1},optGroupOptionKey:{type:String,default:"children"},groupLabel:{type:String,default:"name"}},emits:["update:modelValue","input","open","close","search","search:focus","search:blur","option:selecting","option:selected","option:deselecting","option:deselected"],setup(r,{emit:se}){const n=r,s=se,d=y(!1),c=y(""),W=y(null),Q=y(null),G=y(),X=y(),A=y(n.position),N=y(""),k=y(0);function Y(e){G.value&&!G.value.contains(e.target)&&d.value&&(d.value=!1,s("close"))}function R(e){var t;return(n.isOptionGroup?((t=z(e))==null?void 0:t[n.optGroupOptionKey])||[]:n.options).find(o=>(o==null?void 0:o[n.value])==e)}function Z(e){console.log(`handleKeydown:${e.key}`),!(!d.value||n.isOptionGroup)&&(e.key==="ArrowDown"?(e.preventDefault(),k.value<C.value.length&&k.value++):e.key==="ArrowUp"&&(e.preventDefault(),k.value>0&&k.value--))}const ae=e=>{if(!(!d.value||n.isOptionGroup)&&k.value>=0&&e.key==="Enter"){const l=C.value[k.value];l&&b(l)}};fe(()=>{var e;document.addEventListener("click",Y),window.addEventListener("keydown",Z),(e=n.containment)==null||e.addEventListener("scroll",()=>{U(d.value)}),setTimeout(()=>{var l;(l=Q.value)==null||l.focus()})}),ve(()=>{var e;document.removeEventListener("click",Y),window.removeEventListener("keydown",Z),(e=n.containment)==null||e.removeEventListener("scroll",()=>U(d.value))});const re=L(()=>n.multiple||n.taggable),ue=L(()=>{const e={top:"bottom-[100%] mb-0.5",left:"right-[100%] mr-0.5",right:"left-[100%] ml-0.5",bottom:"top-[100%] mt-0.5"};return e[A.value]||e.bottom}),v=L(()=>n.multiple||n.taggable?Array.isArray(n.modelValue)?n.modelValue:[]:n.modelValue),$=e=>(e==null?void 0:e[n.label])??(e==null?void 0:e.label)??e,B=e=>{let l=[];if(n.isOptionGroup){const o=z(e);l=(o==null?void 0:o[n.optGroupOptionKey])||[]}else l=n.options;const t=l.find(o=>typeof o=="string"||typeof o=="number"?String(o)===String(e):(o==null?void 0:o[n.value])==e);return t?(t==null?void 0:t[n.label])??(t==null?void 0:t.label)??t:n.taggable?e:null},p=e=>typeof e=="object"?(e==null?void 0:e[n.value])??(e==null?void 0:e.value)??e:typeof e=="string"||typeof e=="number"?e:"",ie=()=>{n.disabled||(d.value=!d.value,s(d.value?"open":"close"),d.value&&setTimeout(()=>{var e;(e=W.value)==null||e.focus()},0))},E=e=>{const l=p(e);return n.multiple||n.taggable?v.value.some(t=>p(t)===l):p(v.value)===l},b=(e,l=null)=>{if(console.log({parentOption:l}),l&&(N.value=l),n.multiple||n.taggable)if(E(e)){s("option:deselecting",e);const t=v.value.filter(o=>p(o)!==p(e));s("update:modelValue",t),s("option:deselected",e)}else{s("option:selecting",e);const t=[...v.value,p(e)];s("update:modelValue",t),s("option:selected",e)}else s("option:selected",e),typeof n.modelValue=="object"&&n.modelValue?s("update:modelValue",e):s("update:modelValue",p(e));d.value=!1,s("close"),s("input",e),c.value=""},F=e=>{const l=v.value.filter(t=>p(t)!==p(e));s("update:modelValue",l),s("option:deselected",e)},C=L(()=>{if(!n.searchable)return n.options;const e=(c.value||"").trim();if(!e)return H(n.options);const l=e.toLowerCase(),{options:t,isOptionGroup:o,searchBy:a,optGroupOptionKey:x}=n;if(!o)return typeof a=="function"?a(t,l):H(t).filter(K=>{const g=$(K);return g&&g.toLowerCase().includes(l)});const S=[],ee=x||"children";for(let K=0;K<t.length;K++){const g=t[K],O=(g==null?void 0:g[ee])||[],q=typeof a=="function"?a(O,l):(()=>{const te=[];for(let j=0;j<O.length;j++){const le=$(O[j]);le&&le.toLowerCase().includes(l)&&te.push(O[j])}return te})();q.length>0&&(q.length===O.length?S.push(g):S.push({...g,[ee]:H(q)}))}return S}),H=e=>Array.isArray(e)?n.hideSelectedValue?e.filter(l=>!E(l)):[...e]:[];async function U(e){if(!n.containment)return null;if(e&&n.position==="auto"){await pe();const l=G.value,t=X.value;if(l&&t){console.log({cm:n.containment});const o=l.getBoundingClientRect(),a=t.offsetHeight,x=(n.containment.innerHeight||n.containment.clientHeight)-o.bottom,S=o.top;console.log({triggerRect:o,dropdownHeight:a,spaceBelow:x,spaceAbove:S}),S<a?A.value="bottom":A.value=x<a&&S>a?"top":"bottom"}}else A.value=n.position}const _=L(()=>C.value.find(e=>$(e).toLowerCase()===c.value.toLowerCase()));function de(e){if(c.value.length===0&&n.taggable&&Array.isArray(n.modelValue)){const l=[...n.modelValue];l.pop(),s("update:modelValue",l)}}function ce(e){if(e.preventDefault(),!(!n.taggable||!c.value.trim())){if(_.value)b(_.value);else{const l=n.createOption?n.createOption(c.value):c.value.trim();s("option:created",l),s("option:selected",l),s("input",l),s("update:modelValue",[...n.modelValue,l])}c.value="",e.target.focus()}}function z(e){return n.options.find(l=>{var t;return(t=l==null?void 0:l[n.optGroupOptionKey])==null?void 0:t.some(o=>(o==null?void 0:o[n.value])==e)})}return ne(()=>n.modelValue,e=>{n.isOptionGroup&&(N.value=z(e))}),ne(d,U),(e,l)=>(i(),u("div",{class:"border rounded-md cursor-pointer relative",ref_key:"dropdownRef",ref:G},[f("div",{class:T(["flex items-center justify-between px-2 h-full gap-2",{"bg-gray-100":r.disabled}]),onClick:ie,tabindex:"0"},[f("div",be,[re.value?(i(),u("div",ge,[Array.isArray(v.value)&&v.value.length>0?m(e.$slots,"selected-options",{key:0,items:v.value,removeItem:t=>F(t),getOption:R,label:B},()=>[(i(!0),u(I,null,J(v.value,t=>m(e.$slots,"selected-option",{key:p(t),option:R(t),removeItem:o=>F(o)},()=>[f("span",he,[f("span",null,h(B(t)),1),f("button",{onClick:w(o=>F(t),["prevent","stop"]),type:"button",class:"ml-1 text-xs"}," × ",8,we)])],!0)),128))],!0):r.taggable?D("",!0):(i(),u("span",ke,h(r.placeholder||"Select.."),1)),r.taggable?P((i(),u("input",{key:2,"onUpdate:modelValue":l[0]||(l[0]=t=>c.value=t),ref_key:"tagSearchInput",ref:Q,type:"text",class:"flex-grow px-2 py-1 rounded outline-none",placeholder:r.placeholder||"Type and enter to add",onKeydown:[V(w(ce,["prevent","stop"]),["enter"]),V(de,["backspace"])],onKeyup:l[1]||(l[1]=()=>d.value=!!c.value),onFocus:l[2]||(l[2]=t=>e.$emit("search:focus")),onBlur:l[3]||(l[3]=t=>e.$emit("search:blur"))},null,40,xe)),[[oe,c.value]]):D("",!0)])):(i(),u("div",Se,[m(e.$slots,"selected-option",{option:R(r.modelValue),group:N.value},()=>[B(v.value)?(i(),u("span",{key:0,class:"line-clamp-1",title:B(v.value)},h(B(v.value)),9,Ve)):(i(),u("span",$e,h(r.placeholder||"Select..."),1))],!0)]))]),f("div",Be,[n.modelValue&&r.clearable&&!n.disabled?(i(),u("button",{key:0,onClick:l[4]||(l[4]=w(()=>s("update:modelValue",""),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700 text-xl",title:"Clear selection"},[m(e.$slots,"clear-icon",{},()=>[l[9]||(l[9]=M(" × "))],!0)])):D("",!0),m(e.$slots,"open-indicator",{},()=>[l[10]||(l[10]=f("svg",{class:"w-4 h-4 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[f("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M19 9l-7 7-7-7"})],-1))],!0)])],2),P(f("div",{class:T(["absolute border rounded shadow-[0px_0px_10px_0px_rgba(0,0,0,0.25)] z-50 border-teal-500 bg-white",ue.value]),ref_key:"dropdownMenuRef",ref:X},[r.searchable&&!r.taggable?(i(),u("div",Ce,[m(e.$slots,"search",{},()=>[P(f("input",{type:"text","onUpdate:modelValue":l[5]||(l[5]=t=>c.value=t),ref_key:"searchInput",ref:W,class:"w-full px-2 py-1 border rounded outline-blue-400 focus:outline-1",placeholder:"Search...",onFocus:l[6]||(l[6]=t=>e.$emit("search:focus")),onBlur:l[7]||(l[7]=t=>e.$emit("search:blur")),onKeydown:l[8]||(l[8]=V(w(t=>ae(t),["stop"]),["enter"]))},null,544),[[oe,c.value]])],!0)])):D("",!0),m(e.$slots,"list-header",{},void 0,!0),f("ul",Ke,[C.value.length?(i(!0),u(I,{key:0},J(C.value,(t,o)=>(i(),u(I,{key:p(t)},[r.isOptionGroup?(i(),u("li",Oe,[f("div",Le,h(t==null?void 0:t[r.groupLabel]),1),f("ul",Ge,[(i(!0),u(I,null,J((t==null?void 0:t[r.optGroupOptionKey])||[],a=>(i(),u("li",{key:p(a),tabindex:"0",class:T([{"bg-blue-50":E(a)},"px-3 py-1 my-0.5 hover:bg-blue-100 focus:bg-blue-100 focus:outline-blue-500 cursor-pointer"]),onClick:x=>b(a,t),onKeydown:[V(w(x=>b(a,t),["prevent"]),["space"]),V(w(x=>b(a,t),["prevent"]),["enter"])]},[m(e.$slots,"option",{option:a,group:t},()=>[M(h($(a)),1)],!0)],42,Ae))),128))])])):(i(),u("li",{key:1,tabindex:"0",class:T([{"bg-blue-50":E(t),"border border-blue-700":k.value===o},"px-3 py-1 my-0.5 hover:bg-blue-100 focus:bg-blue-100 focus:outline-blue-500 cursor-pointer"]),onClick:a=>b(t),onKeydown:[V(w(a=>b(t),["prevent"]),["space"]),V(w(a=>b(t),["prevent"]),["enter"])]},[m(e.$slots,"option",{option:t},()=>[M(h($(t)),1)],!0)],42,Ee))],64))),128)):(i(),u("li",je,[m(e.$slots,"no-options",{},()=>[M(h(r.taggable?"No option found, Enter to add":"No options found"),1)],!0)]))]),m(e.$slots,"list-footer",{},void 0,!0)],2),[[me,d.value]])],512))}},Te=ye(De,[["__scopeId","data-v-ce60aeb2"]]);export{Te as S};
