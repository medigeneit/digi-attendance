import{H as se,r as v,I as F,s as K,y as U,A as I,b as ae,c as n,a,d as E,C as T,F as y,x as b,h as j,m as le,v as oe,e as ne,q as V,o as r,t as g,l as G,G as re}from"./index-CKknogop.js";import{_ as ue}from"./MultiselectDropdown-q6dnAQUf.js";import{u as ie}from"./company-2RI7UgQL.js";import{u as de}from"./department-BztXZSFx.js";import{u as ce}from"./shift-Chbe5Qi1.js";import{d as Y}from"./dayjs.min-Cbbdfn5l.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-multiselect.esm-BoQhFJUE.js";const ve=se("shiftSchedule",()=>{const _=v([]);return{schedules:_,fetchSchedules:async d=>{const u=await F.get("/shift-schedules",d);return _.value=u==null?void 0:u.data,u.data},saveSchedules:async d=>{await F.post("/shift-schedules",{schedules:d==null?void 0:d.payload})},fetchDefaultSchedules:async d=>{const u=await F.get("/default-shift-schedules",d);return _.value=u==null?void 0:u.data,u.data}}}),fe={class:"p-4 max-w-[1600px] mx-auto"},he={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},me=["value"],ge=["value"],ye=["value"],be={key:0,class:"text-yellow-600 font-medium mb-2 p-2 border rounded border-black"},Se={class:"flex flex-wrap gap-3 mb-4 p-4"},we=["onClick"],xe={class:"text-sm"},Ee={class:"overflow-auto"},_e={class:"table-auto w-full border text-sm"},ke={class:"sticky top-0 bg-white z-10"},Ce={class:"text-xs text-gray-400"},De={class:"border p-2"},Ne=["value"],Me={class:"border p-2 whitespace-nowrap"},Ve={class:"border p-2"},We=["onClick"],Ae=["onClick"],$e=["title"],Fe={__name:"ShiftScheduleForm",setup(_){const k=ve(),S=ie(),C=ce(),d=de(),u=v(!1),{companies:H,employees:w}=K(S),{departments:L}=K(d),{shifts:R}=K(C),f=v(Y().format("YYYY-MM")),h=v(""),W=v(""),D=v(""),c=v(""),i=v({}),p=v([]),x=v({WEEKEND:"bg-red-700"}),B=["bg-green-700","bg-pink-600","bg-blue-800","bg-cyan-600","bg-red-300","bg-purple-700","bg-yellow-500","bg-indigo-500","bg-amber-600"],N=U(()=>Object.values(R.value||{}).flat());function O(){const s=N.value;let t=0;s.forEach(e=>{x.value[e.id]=B[t%B.length],t++}),x.value.WEEKEND="bg-red-700"}const M=U(()=>Array.from({length:Y(f.value).daysInMonth()},(s,t)=>t+1)),z=s=>{const t=`${f.value}-${String(s).padStart(2,"0")}`;return Y(t).format("ddd")},J=(s,t)=>{var o,l;const e=(l=(o=i.value)==null?void 0:o[s])==null?void 0:l[t];return e?["WEEKEND"].includes(e)?x.value[e]||"bg-gray-300":x.value[parseInt(e)]||"bg-gray-300":"bg-gray-300"},Q=(s,t)=>{var l,m;const e=(m=(l=i.value)==null?void 0:l[s])==null?void 0:m[t],o=N.value.find($=>$.id===e);return(o==null?void 0:o.name)||""},X=(s,t)=>{p.value.includes(parseInt(s))&&c.value&&(i.value[s]||(i.value[s]={}),i.value[s][t]=c.value)},q=s=>{p.value.includes(parseInt(s))&&c.value&&(i.value[s]||(i.value[s]={}),M.value.forEach(t=>{i.value[s][t]=c.value}))},Z=()=>{p.value.forEach(s=>{q(s)})},P=()=>{p.value.forEach(s=>{var o;const t=w.value.find(l=>l.id===parseInt(s)),e=((o=t==null?void 0:t.weekends)==null?void 0:o.map(l=>l.slice(0,3)))||[];i.value[s]||(i.value[s]={}),M.value.forEach(l=>{const m=z(l);e.includes(m)&&(i.value[s][l]="WEEKEND")})})},ee=async()=>{const s=Object.entries(i.value).flatMap(([t,e])=>p.value.includes(parseInt(t))?Object.entries(e).map(([o,l])=>({employee_id:parseInt(t),date:`${f.value}-${String(o).padStart(2,"0")}`,shift_id:l})):[]);try{await k.saveSchedules({payload:s}),alert("Shift schedule saved successfully!")}catch(t){console.error("Failed to save schedule",t),alert("Something went wrong while saving.")}};I(h,async s=>{s&&(await S.fetchEmployee(s),await d.fetchDepartments({companyId:s}),await C.fetchShifts({companyId:s}),O(),await A(s,f.value))}),I(W,async s=>{if(s){const t={companyId:h.value,departmentIds:s?[s]:[]},e=await d.fetchDepartmentEmployee(t);w.value=e,p.value=[],await A(h.value,f.value)}}),I(f,async s=>{s&&(await S.fetchEmployee(h.value),await C.fetchShifts({companyId:h.value}),O(),await A(h.value,s))});const te=U(()=>D.value?w.value.filter(s=>{var t;return s.id===parseInt((t=D.value)==null?void 0:t.id)}):w.value);ae(async()=>{await S.fetchCompanies()});const A=async(s,t)=>{try{let e=await k.fetchSchedules({params:{company_id:s,month:t}});const o={};if(e.length)u.value=!1;else{const l=await k.fetchDefaultSchedules({params:{company_id:s,month:t}});console.log("[Fallback Schedule]",l),e=l,p.value=[],u.value=!0}e.forEach(l=>{!u.value&&!p.value.includes(l.employee_id)&&p.value.push(l.employee_id),c.value=l==null?void 0:l.shift_id;const m=l.employee_id,$=parseInt(l.date.split("-")[2]);o[m]||(o[m]={}),o[m][$]=l.shift_id||"WEEKEND"}),i.value=o}catch(e){console.error("Failed to load schedule data:",e)}};return(s,t)=>(r(),n("div",fe,[a("div",he,[E(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),class:"p-2 border rounded"},[t[7]||(t[7]=a("option",{value:""},"Select Company",-1)),(r(!0),n(y,null,b(j(H),e=>(r(),n("option",{key:e.id,value:e.id},g(e.name),9,me))),128))],512),[[T,h.value]]),E(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>W.value=e),class:"p-2 border rounded"},[t[8]||(t[8]=a("option",{value:""},"- Department -",-1)),(r(!0),n(y,null,b(j(L),e=>(r(),n("option",{key:e.id,value:e.id},g(e.name),9,ge))),128))],512),[[T,W.value]]),a("div",null,[le(ue,{modelValue:D.value,"onUpdate:modelValue":t[2]||(t[2]=e=>D.value=e),options:j(w),multiple:!1,label:"name","label-prefix":"employee_id",placeholder:"Select user"},null,8,["modelValue","options"])]),E(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>c.value=e),class:"p-2 border rounded"},[t[9]||(t[9]=a("option",{value:""},"- Shift -",-1)),(r(!0),n(y,null,b(N.value,e=>(r(),n("option",{key:e.id,value:e.id},g(e.name),9,ye))),128))],512),[[T,c.value]]),E(a("input",{type:"month","onUpdate:modelValue":t[4]||(t[4]=e=>f.value=e),class:"p-2 border rounded"},null,512),[[oe,f.value]])]),u.value?(r(),n("p",be," âš  Showing default schedule from current shift. Select employees manually before saving. ")):ne("",!0),a("div",Se,[(r(!0),n(y,null,b(N.value,e=>(r(),n("div",{key:e.id,class:V(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":c.value===e.id}]),onClick:o=>c.value=e.id},[a("div",{class:V(["w-5 h-5 rounded",x.value[e.id]||"bg-gray-300"])},null,2),a("span",xe,g(e.name),1)],10,we))),128)),a("div",{class:V(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":c.value==="WEEKEND"}]),onClick:t[5]||(t[5]=e=>c.value="WEEKEND")},t[10]||(t[10]=[a("div",{class:"w-5 h-5 rounded bg-red-700"},null,-1),a("span",{class:"text-sm"},"Weekend",-1)]),2)]),a("div",{class:"mb-4 flex gap-4"},[a("button",{onClick:Z,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),a("button",{onClick:P,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),a("div",Ee,[a("table",_e,[a("thead",ke,[a("tr",null,[t[11]||(t[11]=a("th",{class:"border p-2"},"Emp ID",-1)),t[12]||(t[12]=a("th",{class:"border p-2"},"Name",-1)),t[13]||(t[13]=a("th",{class:"border p-2"},"Action",-1)),(r(!0),n(y,null,b(M.value,e=>(r(),n("th",{key:e,class:"border text-center p-1 w-10"},[G(g(e)+" ",1),a("div",Ce,g(z(e)),1)]))),128))])]),a("tbody",null,[(r(!0),n(y,null,b(te.value,e=>(r(),n("tr",{key:e.id},[a("td",De,[E(a("input",{type:"checkbox",class:"mr-2",value:e.id,"onUpdate:modelValue":t[6]||(t[6]=o=>p.value=o)},null,8,Ne),[[re,p.value]]),G(" "+g(e.code),1)]),a("td",Me,g(e.name),1),a("td",Ve,[a("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:o=>q(e.id)}," Apply to All Dates ",8,We)]),(r(!0),n(y,null,b(M.value,o=>(r(),n("td",{key:o,class:"border text-center cursor-pointer",onClick:l=>X(e.id,o)},[a("div",{title:Q(e.id,o),class:V([J(e.id,o),"w-full h-6"])},null,10,$e)],8,Ae))),128))]))),128))])])]),a("div",{class:"mb-4 mt-4"},[a("button",{onClick:ee,class:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow"}," ðŸ’¾ Save Schedule ")])]))}},ze=pe(Fe,[["__scopeId","data-v-69e52a58"]]);export{ze as default};
