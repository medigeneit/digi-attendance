import{Q as be,u as fe,f as ye,r as c,D as ee,x as n,G as ge,q as $,h as xe,p as _e,c as y,o as m,a as t,j as V,i as he,w as we,t as r,s as v,k as q,v as O,b as S,F as Ce,e as ke,d as j,O as De,l as Ve}from"./index-CTcgIfVy.js";import{L as Se}from"./LoaderView-ZJ7vlxMx.js";import{_ as I}from"./MultiselectDropdown-DQzTF0Ux.js";import{_ as je}from"./TextEditor-D67iqexd.js";import{u as Ne}from"./company-DnjFM36P.js";import{u as Ae}from"./department-JqPiY6wX.js";import{u as ze}from"./notice-ljQg5mQa.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BCnbWemA.js";const Ee={class:"my-container space-y-4"},Ue={class:"card-bg md:p-8 p-4 mx-4"},Be={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Fe={class:"rounded-xl border bg-white p-4 flex items-center justify-between"},Me={class:"flex items-center gap-3"},$e={class:"font-semibold"},Le={class:"rounded-xl border bg-white p-4 flex items-center justify-between"},Pe={class:"flex items-center gap-3"},Re={class:"font-semibold"},Te={class:"rounded-xl border bg-white p-4"},Ge={class:"flex items-center justify-between"},He={class:"flex items-center gap-3"},qe={class:"font-semibold"},Oe={class:"border p-4 rounded-xl bg-white space-y-6 shadow-sm"},Ie={class:"grid md:grid-cols-3 gap-4"},Je={class:"w-full"},Qe={class:"inline-flex rounded-lg border overflow-hidden"},Xe={class:"w-full"},Ke={class:"w-full"},We={key:0,class:"text-xs text-red-600 mt-1"},Ye={class:"space-y-2"},Ze={class:"flex flex-wrap gap-2"},et=["onClick"],tt={key:0,class:"text-xs text-red-500 mt-1"},lt={class:"space-y-3"},st={class:"flex items-center justify-between"},at={class:"inline-flex rounded-lg border overflow-hidden"},ot={class:"grid md:grid-cols-2 gap-6"},it={class:"space-y-3"},nt={class:"flex items-center justify-between"},rt={class:"inline-flex rounded-lg border overflow-hidden"},dt={class:"space-y-3"},ut={class:"flex items-center justify-between"},pt={class:"inline-flex items-center gap-3"},ct={class:"text-xs text-gray-500"},mt={class:"inline-flex rounded-lg border overflow-hidden"},vt={class:"border p-4 rounded-xl bg-white space-y-6 shadow-sm"},bt={class:"space-y-2"},ft={key:0,class:"mb-2"},yt=["href"],gt={class:"w-full rounded-lg border border-dashed p-4 hover:bg-gray-50 transition"},xt={class:"flex items-center justify-between gap-3"},_t={class:"inline-flex items-center"},ht=["disabled"],wt={key:0,class:"mt-3"},Ct={class:"h-2 bg-gray-200 rounded overflow-hidden"},kt={class:"flex items-center justify-between mt-1 text-xs text-gray-600"},Dt={class:"sticky bottom-0 bg-white/90 backdrop-blur flex justify-center gap-4 p-3 rounded-xl border"},Vt=["disabled"],St={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4"},jt={class:"bg-white rounded-xl shadow-xl w-full max-w-md p-6 space-y-4"},Nt={class:"text-sm text-gray-600 break-words"},At={class:"flex justify-end gap-3"},Tt={__name:"NoticeEdit",setup(zt){const u=be(),J=fe(),L=ye(),P=c(!1),N=c(!1),h=c(!0),R=ze(),T=Ne(),p=Ae(),{companies:te}=ee(T),{employees:G}=ee(p),w=n(()=>p.departments||[]),C=n(()=>Array.isArray(G.value)?G.value:[]),k=n(()=>te.value||[]),l=ge({title:"",type:1,description:"",published_at:"",expired_at:"",all_companies:!1,all_departments:!1,all_employees:!1,file_url:null,receiver_type:""}),le=[{value:"doctor",label:"Doctor"},{value:"executive",label:"Executive"},{value:"support_staff",label:"Support Staff"},{value:"academic_body",label:"Academic Body"}],g=c([]),x=c([]),d=c([]),b=c(null),A=c(0),_=c(!1),z=c(!1);let D=null;const se=n(()=>{var a;return((a=b.value)==null?void 0:a.name)||""}),ae=n(()=>b.value?(b.value.size/(1024*1024)).toFixed(2):"0.00"),E=n(()=>g.value.map(a=>a.id)),Q=n(()=>x.value.map(a=>a.id)),oe=n(()=>d.value.map(a=>a.id)),X=a=>{if(!a)return"";const e=String(a).split(" ")[0];return e.includes("-")?e:""},H=n(()=>{if(l.type===2||!l.published_at||!l.expired_at)return!0;try{const a=new Date(l.published_at);return new Date(l.expired_at)>=a}catch{return!0}}),ie=n(()=>!!l.title&&!!l.receiver_type&&!_.value&&H.value),U=n({get:()=>l.all_companies?"all":"custom",set:a=>{l.all_companies=a==="all",g.value=l.all_companies?[...k.value]:[]}}),B=n({get:()=>l.all_departments?"all":"custom",set:a=>{l.all_departments=a==="all",x.value=l.all_departments?[...w.value]:[]}}),F=n({get:()=>l.all_employees?"all":"custom",set:a=>{l.all_employees=a==="all",d.value=l.all_employees?[...C.value]:[]}});$(()=>l.all_companies,async a=>{h.value||(a?await p.fetchDepartments():await p.fetchDepartments(E.value))}),$(E,async a=>{h.value||l.all_companies||await p.fetchDepartments(a)});const ne=n(()=>l.all_departments?(w.value||[]).map(a=>a.id):Q.value);$([ne,()=>l.receiver_type],async([a,e])=>{if(!h.value){if(!e){p.employees=[],d.value=[],l.all_employees=!1;return}Array.isArray(a)&&a.length>0?(await p.fetchDepartmentEmployee(a,e),l.all_employees&&Array.isArray(C.value)&&(d.value=[...C.value])):(p.employees=[],d.value=[],l.all_employees=!1)}},{immediate:!0}),$([d,G],([a,e])=>{if(h.value)return;const o=Array.isArray(e)?e.length:0;l.all_employees=o>0&&a.length===o});const re=async()=>{var e,o,s,f,W;const a=L.params.id;try{const i=await R.fetchNotice(a);l.title=i.title??"",l.type=Number(i.type??1),l.published_at=X(i.published_at),l.expired_at=X(i.expired_at),l.description=i.description??"",l.file_url=i.file_url||i.file||null,l.receiver_type=i.receiver_type||"";const M=(((e=i.companies_notice)==null?void 0:e.length)??0)>0;l.all_companies=!M,k.value.length===0&&await T.fetchCompanies(),g.value=M?i.companies_notice:[...k.value],l.all_companies?await p.fetchDepartments():await p.fetchDepartments(E.value);const Y=(((o=i.departments)==null?void 0:o.length)??0)>0;l.all_departments=!Y,x.value=Y?i.departments:[...w.value];const Z=(((s=i.employees)==null?void 0:s.length)??0)>0;l.all_employees=!Z,d.value=Z?i.employees:[]}catch(i){const M=((W=(f=i==null?void 0:i.response)==null?void 0:f.data)==null?void 0:W.message)||"Failed to load notice data";u.error(M),J.push({name:"NoticeList"})}},de=a=>{var s,f;const e=(f=(s=a==null?void 0:a.target)==null?void 0:s.files)==null?void 0:f[0];if(!e)return;if(!["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)){u.error("Unsupported file type. Allowed: jpg, jpeg, png, pdf, doc, docx.");return}if(e.size>2*1024*1024){u.error("File size must be ≤ 2MB.");return}b.value=e,z.value=!0},ue=async()=>{var a,e;try{const o=L.params.id;if(!(b.value instanceof Blob))return;A.value=0,_.value=!0,D=new AbortController;const s=await R.updateNoticeFile(o,b.value,{onProgress:f=>A.value=f,signal:D.signal});l.file_url=(s==null?void 0:s.file_url)||(s==null?void 0:s.file)||l.file_url,u.success("File uploaded successfully.")}catch(o){if((o==null?void 0:o.name)==="CanceledError"||(o==null?void 0:o.message)==="canceled")u.info("Upload canceled.");else{const s=((e=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Upload failed.";u.error(s)}}finally{_.value=!1,z.value=!1,b.value=null,D=null}},pe=()=>{D&&D.abort()},ce=async()=>{var a,e;if(!l.receiver_type){u.error("Receiver type is required.");return}if(!H.value){u.error("Expire date must be the same or after Publish date.");return}try{N.value=!0;const o=L.params.id,s={title:l.title,type:l.type,description:l.description,published_at:l.type===2?null:l.published_at||null,expired_at:l.type===2?null:l.expired_at||null,all_companies:!!l.all_companies,all_departments:!!l.all_departments,all_employees:!!l.all_employees,company_ids:E.value,department_ids:Q.value,employee_ids:oe.value,receiver_type:l.receiver_type};await R.updateNotice(o,s),u.success("Notice updated successfully"),J.push({name:"NoticeShow",params:{id:o}})}catch(o){const s=((e=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:e.message)||(o==null?void 0:o.message)||"Failed to update notice";u.error(s)}finally{N.value=!1}};xe(async()=>{P.value=!0,await T.fetchCompanies(),await re(),P.value=!1,h.value=!1});const me=n(()=>k.value.length),ve=n(()=>w.value.length),K=n(()=>C.value.length);return(a,e)=>{const o=_e("RouterLink");return m(),y("div",Ee,[t("div",Ue,[e[38]||(e[38]=t("h2",{class:"title-lg text-center"},"Edit Notice",-1)),P.value?(m(),he(Se,{key:0,class:"bg-gray-100 border shadow-none"})):(m(),y("form",{key:1,onSubmit:we(ce,["prevent"]),class:"space-y-5"},[t("div",Be,[t("div",Fe,[t("div",Me,[e[17]||(e[17]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-blue-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-blue-600"},[t("path",{fill:"currentColor",d:"M3 10v10h18V10H3zm9-7l9 7H3l9-7z"})])],-1)),t("div",null,[e[16]||(e[16]=t("div",{class:"text-sm text-gray-500"},"Companies",-1)),t("div",$e,r(l.all_companies?"All":g.value.length)+" / "+r(me.value),1)])])]),t("div",Le,[t("div",Pe,[e[19]||(e[19]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-purple-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-purple-600"},[t("path",{fill:"currentColor",d:"M3 5h18v2H3V5zm3 4h12v10H6V9z"})])],-1)),t("div",null,[e[18]||(e[18]=t("div",{class:"text-sm text-gray-500"},"Departments",-1)),t("div",Re,r(l.all_departments?"All":x.value.length)+" / "+r(ve.value),1)])])]),t("div",Te,[t("div",Ge,[t("div",He,[e[21]||(e[21]=t("span",{class:"inline-flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-100"},[t("svg",{viewBox:"0 0 24 24",class:"h-5 w-5 text-emerald-600"},[t("path",{fill:"currentColor",d:"M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"})])],-1)),t("div",null,[e[20]||(e[20]=t("div",{class:"text-sm text-gray-500"},"Employees",-1)),t("div",qe,r(l.all_employees?"All":d.value.length)+" / "+r(K.value),1)])])])])]),t("div",Oe,[e[29]||(e[29]=t("h2",{class:"text-lg font-semibold"},"Notice Information",-1)),t("div",Ie,[t("div",Je,[e[22]||(e[22]=t("label",{for:"type",class:"font-medium block mb-1"},"Type*",-1)),t("div",Qe,[t("button",{type:"button",class:v(["px-4 py-2 text-sm",l.type===1?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[0]||(e[0]=s=>l.type=1)}," General ",2),t("button",{type:"button",class:v(["px-4 py-2 text-sm border-l",l.type===2?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[1]||(e[1]=s=>l.type=2)}," Policy ",2)])]),t("div",Xe,[e[23]||(e[23]=t("label",{class:"font-medium block mb-1"},"Publish Date",-1)),q(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.published_at=s),type:"date",class:"w-full p-2 border rounded"},null,512),[[O,l.published_at]])]),t("div",Ke,[e[24]||(e[24]=t("label",{class:"font-medium block mb-1"},"Expire Date",-1)),q(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.expired_at=s),type:"date",class:"w-full p-2 border rounded"},null,512),[[O,l.expired_at]]),H.value?V("",!0):(m(),y("p",We," Expire date must be the same or after Publish date. "))])]),t("div",Ye,[e[25]||(e[25]=t("label",{class:"font-medium block mb-1"},[S(" Send To "),t("span",{class:"text-red-500"},"*")],-1)),t("div",Ze,[(m(),y(Ce,null,ke(le,s=>t("button",{key:s.value,type:"button",class:v(["px-3 py-1.5 rounded-full border text-xs",l.receiver_type===s.value?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 hover:bg-gray-50"]),onClick:f=>l.receiver_type=s.value},r(s.label),11,et)),64))]),l.receiver_type?V("",!0):(m(),y("p",tt," Receiver type is required. "))]),t("div",lt,[t("div",st,[e[26]||(e[26]=t("label",{class:"font-medium"},"Companies",-1)),t("div",at,[t("button",{type:"button",class:v(["px-3 py-1.5 text-xs",U.value==="all"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[4]||(e[4]=s=>U.value="all")},"All",2),t("button",{type:"button",class:v(["px-3 py-1.5 text-xs border-l",U.value==="custom"?"bg-blue-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[5]||(e[5]=s=>U.value="custom")},"Custom",2)])]),t("div",null,[j(I,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),options:k.value,multiple:!0,searchable:!0,placeholder:"Select companies","track-by":"id",label:"name"},null,8,["modelValue","options"])])]),t("div",ot,[t("div",it,[t("div",nt,[e[27]||(e[27]=t("label",{class:"font-medium"},"Departments",-1)),t("div",rt,[t("button",{type:"button",class:v(["px-3 py-1.5 text-xs",B.value==="all"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[7]||(e[7]=s=>B.value="all")},"All",2),t("button",{type:"button",class:v(["px-3 py-1.5 text-xs border-l",B.value==="custom"?"bg-purple-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[8]||(e[8]=s=>B.value="custom")},"Custom",2)])]),j(I,{modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=s=>x.value=s),options:w.value,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name"},null,8,["modelValue","options"])]),t("div",dt,[t("div",ut,[e[28]||(e[28]=t("label",{class:"font-medium"},"Employees",-1)),t("div",pt,[t("span",ct," Selected "+r(d.value.length)+" / "+r(K.value),1),t("div",mt,[t("button",{type:"button",class:v(["px-3 py-1.5 text-xs",F.value==="all"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[10]||(e[10]=s=>F.value="all")},"All",2),t("button",{type:"button",class:v(["px-3 py-1.5 text-xs border-l",F.value==="custom"?"bg-emerald-600 text-white":"bg-white hover:bg-gray-50"]),onClick:e[11]||(e[11]=s=>F.value="custom")},"Custom",2)])])]),j(I,{modelValue:d.value,"onUpdate:modelValue":e[12]||(e[12]=s=>d.value=s),options:C.value,multiple:!0,searchable:!0,placeholder:"Select employee","track-by":"id",label:"name"},null,8,["modelValue","options"])])])]),t("div",vt,[e[36]||(e[36]=t("h2",{class:"text-lg font-semibold"},"Notice Content",-1)),t("div",null,[e[30]||(e[30]=t("label",{class:"font-medium block mb-1"},"Title*",-1)),q(t("input",{"onUpdate:modelValue":e[13]||(e[13]=s=>l.title=s),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[O,l.title]])]),t("div",bt,[e[34]||(e[34]=t("label",{class:"font-medium block mb-1"},"Attachment",-1)),l.file_url?(m(),y("div",ft,[t("a",{href:l.file_url,target:"_blank",class:"inline-flex items-center gap-2 text-blue-600 underline"},e[31]||(e[31]=[t("svg",{viewBox:"0 0 24 24",class:"h-4 w-4"},[t("path",{fill:"currentColor",d:"M14 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"}),t("path",{fill:"currentColor",d:"M14 3v6h6"})],-1),S(" View Current File ")]),8,yt)])):V("",!0),t("div",gt,[t("div",xt,[e[33]||(e[33]=t("div",{class:"text-sm text-gray-600"},[t("div",{class:"font-medium"},"Upload new file"),t("div",null,"JPG, JPEG, PNG, PDF, DOC, DOCX (≤ 2MB)")],-1)),t("label",_t,[t("input",{type:"file",accept:".jpg,.jpeg,.png,.pdf,.doc,.docx",onChange:de,class:"hidden",disabled:_.value},null,40,ht),e[32]||(e[32]=t("span",{class:"px-4 py-2 rounded border bg-white hover:bg-gray-50 cursor-pointer"}," Browse… ",-1))])]),_.value?(m(),y("div",wt,[t("div",Ct,[t("div",{class:"h-2 bg-blue-600 transition-all",style:De({width:A.value+"%"})},null,4)]),t("div",kt,[t("span",null,r(A.value)+"%",1),t("button",{type:"button",class:"px-3 py-1 rounded border hover:bg-gray-50",onClick:pe}," Cancel ")])])):V("",!0)])]),t("div",null,[e[35]||(e[35]=t("label",{class:"font-medium block mb-1"},"Description",-1)),j(je,{modelValue:l.description,"onUpdate:modelValue":e[14]||(e[14]=s=>l.description=s),class:"w-full px-4 py-2"},null,8,["modelValue"])])]),t("div",Dt,[j(o,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:Ve(()=>e[37]||(e[37]=[S(" Cancel ")])),_:1,__:[37]}),t("button",{disabled:N.value||_.value||!ie.value,type:"submit",class:"bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 disabled:opacity-60"},r(N.value?"Saving…":"Save"),9,Vt)])],32))]),z.value?(m(),y("div",St,[t("div",jt,[e[42]||(e[42]=t("h3",{class:"text-lg font-semibold"},"Upload this file?",-1)),t("p",Nt,[e[39]||(e[39]=t("span",{class:"font-medium"},"Name:",-1)),S(" "+r(se.value),1),e[40]||(e[40]=t("br",null,null,-1)),e[41]||(e[41]=t("span",{class:"font-medium"},"Size:",-1)),S(" "+r(ae.value)+" MB ",1)]),t("div",At,[t("button",{class:"px-4 py-2 rounded border hover:bg-gray-50",onClick:e[15]||(e[15]=s=>{z.value=!1,b.value=null})}," Cancel "),t("button",{class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700",onClick:ue}," Upload ")])])])):V("",!0)])}}};export{Tt as default};
