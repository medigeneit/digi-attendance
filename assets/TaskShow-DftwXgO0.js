import{o as i,c as u,a as e,E as j,t as T,F as h,x as F,m as g,r as I,D as G,k as E,n as y,e as _,w as V,y as q,b as z,A as K,h as o,q as C,p as D,l as v,f as H,g as J}from"./index-B0zE6B4y.js";import{O as M}from"./OverlyModal-B5cliVC1.js";import{_ as Q}from"./TaskAddForm-lsqJEm6J.js";import{_ as W}from"./TaskEditForm-Daek3V9b.js";import{_ as X}from"./TaskTreeView-ClVqwKhs.js";import{u as Y}from"./useTaskStore-pdaarL-Q.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-B9KbOG7r.js";const Z={class:"mb-3"},tt={key:0,class:"text-center py-4 text-gray-500"},st={key:1,class:"text-center py-4 text-red-500"},et={key:2,class:"space-y-4"},at={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String}},emits:["commentButtonClick","editClick","addClick"],setup(p,{emit:s}){const l=s;return(x,d)=>(i(),u("div",null,[e("div",Z,[j(x.$slots,"task:header")]),p.loading?(i(),u("div",tt,"Loading tasks...")):p.error?(i(),u("div",st,T(p.error),1)):(i(),u("div",et,[(i(!0),u(h,null,F(p.tasks||[],n=>(i(),u("div",{key:n.id,class:"rounded-lg border bg-white overflow-hidden"},[g(X,{task:n,class:"!border-0",onCommentButtonClick:r=>l("commentButtonClick",n.id),onEditClick:d[0]||(d[0]=r=>l("editClick",r)),onAddClick:d[1]||(d[1]=r=>l("addClick",r))},null,8,["task","onCommentButtonClick"])]))),128))]))]))}},nt={class:"flex justify-between mt-5"},ot={class:"flex flex-wrap items-center gap-2 mt-3"},rt={__name:"SubTaskList",props:{subTasks:Array,parentId:Number},emits:["created","error"],setup(p,{emit:s}){const l=p,x=s,d=I(),n=G({show:!1,parentId:l.parentId,requirementId:null}),r=t=>{n.show=!0,n.parentId=t,console.log({addForm:n})};function f(){n.show=!1,n.parentId=l.parentId,x("created")}function m(){d.value=!1,x("updated")}function c(){n.show=!1,n.parentId=l.parentId}return(t,a)=>(i(),u("div",null,[d.value?(i(),E(M,{key:0},{default:y(()=>[g(W,{taskId:d.value,onClose:a[0]||(a[0]=b=>d.value=null),onUpdated:m},null,8,["taskId"])]),_:1})):_("",!0),n.show?(i(),E(M,{key:1},{default:y(()=>[g(Q,{parentTaskId:n.parentId,requirementId:n.requirementId,onTaskCreated:f,onError:t.handleTaskError,onClose:c},null,8,["parentTaskId","requirementId","onError"])]),_:1})):_("",!0),g(at,{tasks:p.subTasks,onAddClick:a[2]||(a[2]=b=>r(b)),onEditClick:a[3]||(a[3]=b=>d.value=b)},{"task:header":y(()=>[e("div",nt,[a[4]||(a[4]=e("div",{class:"flex justify-between items-center"},[e("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),e("div",ot,[e("button",{class:"btn-1 ml-auto",onClick:a[1]||(a[1]=V(()=>r(p.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks"])]))}},it=()=>{const p=I(),s=I(0);function l(r,f){p.value=r,s.value=f}function x(){const r=[],f=(m,c=0,t="")=>{m.forEach(a=>{r.push({...a,depth:c,idPath:t+a.id}),a.children_tasks&&a.children_tasks.length&&f(a.children_tasks,c+1,t+a.id+"-")})};return f(n()),r}function d(r,f=0){return Array.isArray(r)===!1||r.length===0?[]:r.filter(m=>m.parent_id===f).map(m=>({...m,children_tasks:d(r,m.id)}))}function n(){return d(p.value,s.value)}return{getTaskListTree:n,getFlattenedTasks:x,setTaskList:l}},lt={class:"container mx-auto p-6"},dt={class:"max-w-8xl mx-auto bg-white shadow-lg rounded-lg p-6"},ut={class:"grid grid-cols-4"},kt={class:"py-2 font-medium col-span-full text-xl"},pt={class:"py-2 font-medium mb-4 col-span-full md:col-span-2"},mt={class:"flex gap-2 flex-wrap"},ct={class:"py-2 col-span-full md:col-span-1"},ft={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},gt={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},xt={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},yt={class:"py-4 text-right col-span-full md:col-span-1"},bt={class:"py-2 flex justify-center items-center gap-2 col-span-full"},vt={class:"ml-auto flex gap-4"},Tt={key:0},_t={key:1},wt={key:1,class:"text-center py-4 text-red-500"},Rt={__name:"TaskShow",setup(p){const s=Y(),l=H(),x=J(),d=it(),n=q(()=>d.getTaskListTree());z(async()=>{});const r=c=>{x.push({name:"TaskEdit",params:{id:c}})},f=q(()=>{var c,t;return s.task.parent_id==0?{name:"TaskList",params:{id:(c=s.task)==null?void 0:c.id}}:{name:"TaskShow",params:{id:(t=s.task)==null?void 0:t.parent_id}}});async function m(c){const t=await s.fetchTask(c);d.setTaskList(t.sub_tasks,s.task.id)}return K(()=>l.params.id,m,{initial:!0,immediate:!0}),(c,t)=>{var $,L,S,A,R,B,N,P,O,U;const a=D("RouterLink"),b=D("router-view");return i(),u("div",lt,[e("div",dt,[o(s).task?(i(),u(h,{key:0},[e("section",ut,[e("div",kt,T(o(s).task.title),1),e("div",pt,[t[9]||(t[9]=e("div",{class:"text-xs mb-0.5 text-gray-600 uppercase"},"Assigns",-1)),e("div",mt,[(i(!0),u(h,null,F(o(s).task.users,k=>(i(),u("span",{onClick:t[0]||(t[0]=w=>w.stopPropagation()),key:k.id,class:"btn-1 !inline-flex flex-shrink-0"},[t[8]||(t[8]=e("i",{class:"fad fa-user"},null,-1)),v(" "+T(k==null?void 0:k.name),1)]))),128))])]),e("div",ct,[e("div",ft,[($=o(s).task)!=null&&$.is_important?(i(),u("span",gt,"IMPORTANT")):_("",!0),(L=o(s).task)!=null&&L.is_urgent?(i(),u("span",xt,"URGENT")):_("",!0)])]),e("div",yt,[e("span",{class:C([{"bg-gray-200":((S=o(s).task)==null?void 0:S.status)==="PENDING","bg-blue-200":((A=o(s).task)==null?void 0:A.status)==="IN_PROGRESS","bg-green-200":((R=o(s).task)==null?void 0:R.status)==="COMPLETED","bg-red-200":((B=o(s).task)==null?void 0:B.status)==="BLOCKED"},"px-3 py-0.5 rounded-full"])},T((N=o(s).task)==null?void 0:N.status),3)]),t[14]||(t[14]=e("hr",{class:"my-3 col-span-full"},null,-1)),e("div",bt,[e("button",{onClick:t[1]||(t[1]=V(k=>{var w;return r((w=o(s).task)==null?void 0:w.id)},["stop"])),class:"btn-2"},"Edit"),g(a,{to:{name:"TaskUserAssign",params:{id:(P=o(s).task)==null?void 0:P.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[2]||(t[2]=k=>k.stopPropagation())},{default:y(()=>t[10]||(t[10]=[e("i",{class:"fas fa-user-plus"},null,-1),v(" Assign Users ")])),_:1},8,["to"]),g(a,{to:f.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-1 rounded-full transition",onClick:t[3]||(t[3]=k=>k.stopPropagation())},{default:y(()=>t[11]||(t[11]=[e("i",{class:"fas fa-arrow-left"},null,-1),v(" Back ")])),_:1},8,["to"]),e("div",vt,[n.value.length>0?(i(),E(a,{key:0,to:{name:"TaskShow",params:{id:(O=o(s).task)==null?void 0:O.id}},onClick:t[4]||(t[4]=k=>k.stopPropagation()),class:C(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":o(l).name=="TaskShow"}])},{default:y(()=>t[12]||(t[12]=[e("i",{class:"fal fa-list-ul"},null,-1),v(" Sub Tasks ")])),_:1},8,["to","class"])):_("",!0),g(a,{to:{name:"TaskReports",params:{id:(U=o(s).task)==null?void 0:U.id}},onClick:t[5]||(t[5]=k=>k.stopPropagation()),class:C(["py-1 btn-3",{"bg-blue-500 text-white":o(l).name=="TaskReports"}])},{default:y(()=>t[13]||(t[13]=[e("i",{class:"fal fa-file-alt"},null,-1),v(" Reports ")])),_:1},8,["to","class"])])])]),o(l).name=="TaskShow"?(i(),u("section",Tt,[g(rt,{subTasks:n.value,onCreated:t[6]||(t[6]=k=>m(o(l).params.id)),onUpdated:t[7]||(t[7]=k=>m(o(l).params.id))},null,8,["subTasks"])])):(i(),u("section",_t,[g(b)]))],64)):(i(),u("div",wt,T(o(s).error||"Task not found."),1))])])}}};export{Rt as default};
