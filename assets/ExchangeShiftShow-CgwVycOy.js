import{N as gt,u as ft,i as yt,r as y,x as bt,b as xt,c as o,a as t,k as l,j as ht,t as a,h as b,e as i,p as kt,l as ot,m as wt,d as jt,v as At,F as Ct,f as Nt,o as n,g as Rt}from"./index-BZsW2fX5.js";import{L as Dt}from"./LoaderView-BtfvGQ18.js";import{_ as Ft}from"./ScreenshotCapture-CCSB2CM7.js";import{_ as Et}from"./ShareComponent-C-JpHbAA.js";import{u as St}from"./exchange-BWaKfKRc.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Bt={class:"my-container max-w-3xl space-y-6"},$t={key:1,class:"bg-white rounded p-4 md:p-8",id:"leave-application"},Vt={class:"flex justify-end"},qt={class:"font-medium"},It={class:"gap-y-1"},Lt={class:"gap-y-1"},Mt={class:"grid md:grid-cols-2 pt-3"},Tt={class:"col-span-2 pt-2"},Ut={class:"grid print:grid-cols-2 md:grid-cols-2 gap-4 pt-10"},Wt={key:0,class:"print:hidden"},Ht={class:"text-xs"},Pt={class:"flex gap-2"},zt={class:"font-bold"},Ot={key:0,class:"text-green-600 print:text-black"},Gt={key:1,class:"pl-2 text-yellow-700"},Jt={class:"title-md"},Kt={key:0},Qt={class:"grid grid-cols-2 print:grid-cols-3 md:grid-cols-3 justify-center items-center gap-4"},Xt={class:"pt-10"},Yt={key:0},Zt={key:1},es={key:2,class:"print:hidden"},ts={class:"text-xs text-blue-600"},ss={class:"flex gap-4"},ls={class:"font-bold"},as={key:0,class:"text-green-600"},ns={key:1,class:"pl-2 text-yellow-700"},os={class:"pt-10"},rs={key:0},is={key:1},us={key:2,class:"print:hidden"},ds={class:"text-xs text-blue-600"},ps={class:"flex gap-4"},vs={class:"font-bold"},cs={key:0,class:"text-green-600"},ms={key:1,class:"pl-2 text-yellow-700"},_s={class:"pt-10"},gs={key:0},fs={key:1},ys={key:2,class:"print:hidden"},bs={class:"text-xs text-blue-600"},xs={class:"flex gap-4"},hs={class:"font-bold"},ks={key:0,class:"text-green-600"},ws={key:1,class:"pl-2 text-yellow-700"},js={class:"print:hidden"},As={key:0,class:"mb-2"},Cs=["href"],Ns={key:0,class:"modal-bg"},Rs={class:"modal-card"},Ds={class:"flex justify-end gap-2 mt-4"},Is={__name:"ExchangeShiftShow",setup(Fs){const rt=gt(),it=Rt(),p=Nt(),u=St(),m=ft(),h=yt(),k=y(!0),_=y(!1),g=y(""),w=y(null),s=bt(()=>u.exchange);xt(async()=>{const{id:r}=p.params;try{await u.fetchExchange(r),console.log()}catch(e){console.error("Failed to fetch exchange details:",e)}finally{k.value=!1}});const ut=async()=>{try{await u.rejectExchange(p.params.id,g.value),_.value=!1,g.value="",await u.fetchExchange(p.params.id),j()}catch(r){console.error("Failed to reject exchange request:",r),alert("Failed to reject exchange request.")}},x=()=>{_.value=!0},f=async r=>{try{const{id:e}=p.params;r==="handover"&&await u.handoverAccept(e),r==="inCharge"&&await u.inChargeAccept(e),r==="recommend"&&await u.recommendByAccept(e),r==="approve"&&await u.approvedByAccept(e),alert(`${r} accepted successfully!`),await u.fetchExchange(e),j()}catch(e){console.error(`Failed to accept ${r}:`,e),alert(`Failed to accept ${r}.`)}},dt=async r=>{const e=r.target.files[0];if(e){const c=new FormData;c.append("file",e);const d=await u.fetchFileUpload(c);w.value=d==null?void 0:d.url,d!=null&&d.url?(pt(),h.success("File uploaded successfully")):h.error("Failed to upload file")}},pt=async()=>{try{const r={attachment:w.value};await u.uploadAttachmentExchange(p.params.id,r)}catch(r){console.error("Failed to reject short leave:",r),alert("Failed to reject short leave.")}};function vt(){window.print()}const ct=()=>it.go(-1),mt=r=>new Date(r).toISOString().slice(0,10),_t=r=>new Date(r).toLocaleDateString("en-US",{weekday:"long"});async function j(){await rt.markAsRead(p.query.notifyId)}return(r,e)=>{var c,d,A,C,N,R,D,F,E,S,B,$,V,q,I,L,M,T,U,W,H,P,z,O,G,J,K,Q,X,Y,Z,ee,te,se,le,ae,ne,oe,re,ie,ue,de,pe,ve,ce,me,_e,ge,fe,ye,be,xe,he,ke,we,je,Ae,Ce,Ne,Re,De,Fe,Ee,Se,Be,$e,Ve,qe,Ie,Le,Me,Te,Ue,We,He,Pe,ze,Oe,Ge,Je,Ke,Qe,Xe,Ye,Ze,et,tt,st,lt,at,nt;return n(),o(Ct,null,[t("div",Bt,[t("div",{class:"flex items-center justify-between gap-2 print:hidden"},[t("button",{class:"btn-3",onClick:ct},e[6]||(e[6]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[8]||(e[8]=t("h1",{class:"title-lg text-center"},"Exchange Details",-1)),t("div",null,[t("button",{class:"btn-2",onClick:vt},e[7]||(e[7]=[t("i",{class:"far fa-print"},null,-1),l(" Print ")]))])]),k.value?(n(),ht(Dt,{key:0})):(n(),o("div",$t,[e[42]||(e[42]=t("div",null,[t("h1",{class:"title-lg text-center"},"Shift Exchange Application")],-1)),t("div",Vt,[t("div",null,"Date: "+a(mt((c=s.value)==null?void 0:c.created_at)),1)]),t("div",null,[t("p",qt,[e[9]||(e[9]=l(" Name: ")),t("b",null,a((A=(d=s.value)==null?void 0:d.user)==null?void 0:A.name),1)]),t("div",It,[t("p",null,[e[10]||(e[10]=l(" Designation: ")),t("b",null,a((R=(N=(C=s.value)==null?void 0:C.user)==null?void 0:N.designation)==null?void 0:R.title),1)])]),t("div",Lt,[t("p",null,[e[11]||(e[11]=l(" Department: ")),t("b",null,a((E=(F=(D=s.value)==null?void 0:D.user)==null?void 0:F.company)==null?void 0:E.name),1)])])]),t("div",Mt,[t("div",null,[e[12]||(e[12]=t("b",null,"Exchange Day:",-1)),l(" "+a(_t((S=s.value)==null?void 0:S.exchange_date)),1)]),t("div",null,[e[13]||(e[13]=t("b",null,"Date:",-1)),l(" "+a((B=s.value)==null?void 0:B.exchange_date),1)]),t("div",null,[e[14]||(e[14]=t("b",null,"From:",-1)),l(" "+a((V=($=s.value)==null?void 0:$.current_shift)==null?void 0:V.name),1)]),t("div",null,[e[15]||(e[15]=t("b",null,"To:",-1)),l(" "+a((I=(q=s.value)==null?void 0:q.shift)==null?void 0:I.name),1)]),t("div",Tt,[e[16]||(e[16]=t("b",null,"Reason:",-1)),l(" "+a(((L=s.value)==null?void 0:L.reason)||"N/A"),1)])]),t("div",Ut,[t("div",null,[t("div",null,[e[17]||(e[17]=t("b",null,"Works in Hand:",-1)),l(" "+a(((M=s.value)==null?void 0:M.works_in_hand)||"N/A"),1)])]),t("div",null,[t("p",null,a(((U=(T=s.value)==null?void 0:T.handover_user)==null?void 0:U.name)||"Not assigned"),1),!((W=s.value)!=null&&W.status)&&s.value.handover_user_id===b(m).user.id?(n(),o("div",Wt,[t("p",Ht,[l(a((P=(H=s.value)==null?void 0:H.user)==null?void 0:P.name)+" has assigned you for his handover.",1),e[18]||(e[18]=t("br",null,null,-1)),e[19]||(e[19]=l(" Do you agree? "))]),t("div",Pt,[t("button",{class:"font-bold text-lg text-green-600 px-2",onClick:e[0]||(e[0]=v=>f("handover"))}," ✔ "),e[20]||(e[20]=t("button",{class:"px-2"},"❌",-1))])])):i("",!0),e[23]||(e[23]=t("hr",{class:"w-44 border-black mt-2"},null,-1)),t("h4",zt,[e[22]||(e[22]=l(" Handover ")),(z=s.value)!=null&&z.handover_user_id&&((O=s.value)!=null&&O.status)?(n(),o("span",Ot," (✔) ")):i("",!0),(G=s.value)!=null&&G.handover_user_id&&!((J=s.value)!=null&&J.status)?(n(),o("span",Gt,e[21]||(e[21]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])])]),e[43]||(e[43]=t("hr",{class:"mt-2"},null,-1)),t("div",null,[t("h3",Jt,[e[24]||(e[24]=l(" Approvals ")),t("span",{class:kt({"text-yellow-500":((K=s.value)==null?void 0:K.status)==="Pending","text-green-500":((Q=s.value)==null?void 0:Q.status)==="Approved","text-red-500":((X=s.value)==null?void 0:X.status)==="Rejected"})}," ("+a(((Y=s.value)==null?void 0:Y.status)||"N/A")+") ",3)]),((Z=s.value)==null?void 0:Z.status)==="Rejected"?(n(),o("div",Kt,[t("div",null,[e[25]||(e[25]=t("b",null,"Rejected By:",-1)),l(" "+a(((te=(ee=s.value)==null?void 0:ee.rejected_by_user)==null?void 0:te.name)||"N/A"),1)]),t("div",null,[e[26]||(e[26]=t("b",null,"Rejection Reason:",-1)),l(" "+a(((se=s.value)==null?void 0:se.rejection_reason)||"N/A"),1)])])):i("",!0)]),t("div",Qt,[t("div",Xt,[(le=s.value)!=null&&le.in_charge_user?(n(),o("p",Yt,a(((ne=(ae=s.value)==null?void 0:ae.in_charge_user)==null?void 0:ne.name)||""),1)):(n(),o("p",Zt,a(((ue=(ie=(re=(oe=s.value)==null?void 0:oe.user)==null?void 0:re.other_approval)==null?void 0:ie.in_charge_user)==null?void 0:ue.name)||"N/A"),1)),s.value.status!=="Rejected"&&s.value.status!=="Approved"&&!((de=s.value)!=null&&de.in_charge_user_id)&&((ce=(ve=(pe=s.value)==null?void 0:pe.user)==null?void 0:ve.other_approval)==null?void 0:ce.in_charge_user_id)===b(m).user.id?(n(),o("div",es,[t("p",ts,[l(a((_e=(me=s.value)==null?void 0:me.user)==null?void 0:_e.name)+" has submitted an application. ",1),e[27]||(e[27]=t("br",null,null,-1)),e[28]||(e[28]=l(" Will you forward it? "))]),t("div",ss,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[1]||(e[1]=v=>f("inCharge"))}," ✔ "),t("button",{class:"",onClick:x},"❌")])])):i("",!0),e[31]||(e[31]=t("hr",{class:"w-28 md:w-44 border-black mt-2"},null,-1)),t("p",ls,[e[30]||(e[30]=l(" In-Charge ")),(ge=s.value)!=null&&ge.in_charge_user_id?(n(),o("span",as,"(✔)")):i("",!0),!((fe=s.value)!=null&&fe.in_charge_user_id)&&((xe=(be=(ye=s.value)==null?void 0:ye.user)==null?void 0:be.other_approval)!=null&&xe.in_charge_user)?(n(),o("span",ns,e[29]||(e[29]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])]),t("div",os,[(he=s.value)!=null&&he.recommend_by_user?(n(),o("p",rs,a(((we=(ke=s.value)==null?void 0:ke.recommend_by_user)==null?void 0:we.name)||""),1)):(n(),o("p",is,a(((Ne=(Ce=(Ae=(je=s.value)==null?void 0:je.user)==null?void 0:Ae.other_approval)==null?void 0:Ce.recommend_by_user)==null?void 0:Ne.name)||"N/A"),1)),s.value.status!=="Rejected"&&s.value.status!=="Approved"&&!((Re=s.value)!=null&&Re.recommend_by_user_id)&&((Ee=(Fe=(De=s.value)==null?void 0:De.user)==null?void 0:Fe.other_approval)==null?void 0:Ee.recommend_by_user_id)===b(m).user.id?(n(),o("div",us,[t("p",ds,[l(a((Be=(Se=s.value)==null?void 0:Se.user)==null?void 0:Be.name)+" has submitted an application.",1),e[32]||(e[32]=t("br",null,null,-1)),e[33]||(e[33]=l(" Will you recommend it? "))]),t("div",ps,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[2]||(e[2]=v=>f("recommend"))}," ✔ "),t("button",{class:"",onClick:x},"❌")])])):i("",!0),e[36]||(e[36]=t("hr",{class:"w-28 md:w-44 border-black mt-2"},null,-1)),t("p",vs,[e[35]||(e[35]=l(" Recommend By ")),($e=s.value)!=null&&$e.recommend_by_user_id?(n(),o("span",cs,"(✔)")):i("",!0),!((Ve=s.value)!=null&&Ve.recommend_by_user_id)&&((Le=(Ie=(qe=s.value)==null?void 0:qe.user)==null?void 0:Ie.other_approval)!=null&&Le.recommend_by_user)?(n(),o("span",ms,e[34]||(e[34]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])]),t("div",_s,[(Me=s.value)!=null&&Me.approved_by_user?(n(),o("p",gs,a(((Ue=(Te=s.value)==null?void 0:Te.approved_by_user)==null?void 0:Ue.name)||""),1)):(n(),o("p",fs,a(((ze=(Pe=(He=(We=s.value)==null?void 0:We.user)==null?void 0:He.other_approval)==null?void 0:Pe.approved_by_user)==null?void 0:ze.name)||"N/A"),1)),s.value.status!=="Rejected"&&s.value.status!=="Approved"&&!((Oe=s.value)!=null&&Oe.approved_by_user_id)&&((Ke=(Je=(Ge=s.value)==null?void 0:Ge.user)==null?void 0:Je.other_approval)==null?void 0:Ke.approved_by_user_id)===b(m).user.id?(n(),o("div",ys,[t("p",bs,[l(a((Xe=(Qe=s.value)==null?void 0:Qe.user)==null?void 0:Xe.name)+" has submitted an application.",1),e[37]||(e[37]=t("br",null,null,-1)),e[38]||(e[38]=l(" Will you accept it? "))]),t("div",xs,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[3]||(e[3]=v=>f("approve"))}," ✔ "),t("button",{class:"",onClick:x},"❌")])])):i("",!0),e[41]||(e[41]=t("hr",{class:"w-44 border-black mt-2"},null,-1)),t("p",hs,[e[40]||(e[40]=l(" Approved By ")),(Ye=s.value)!=null&&Ye.approved_by_user_id?(n(),o("span",ks,"(✔)")):i("",!0),!((Ze=s.value)!=null&&Ze.approved_by_user_id)&&((st=(tt=(et=s.value)==null?void 0:et.user)==null?void 0:tt.other_approval)!=null&&st.approved_by_user)?(n(),o("span",ws,e[39]||(e[39]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])])])])),t("div",js,[t("div",null,[e[44]||(e[44]=t("label",null,"Attachment",-1)),(lt=s.value)!=null&&lt.attachment&&typeof((at=s.value)==null?void 0:at.attachment)=="string"?(n(),o("div",As,[t("a",{href:(nt=s.value)==null?void 0:nt.attachment,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,Cs)])):i("",!0),t("input",{type:"file",onChange:dt,class:"w-full p-2 border rounded"},null,32),e[45]||(e[45]=t("p",{class:"text-sm text-gray-600 mt-1"},"Selected File",-1))])]),ot(Et,null,{default:wt(()=>[ot(Ft,{targetId:"leave-application",platform:"whatsapp"})]),_:1})]),_.value?(n(),o("div",Ns,[t("div",Rs,[e[46]||(e[46]=t("h3",{class:"title-lg"},"Reject Exchange Request",-1)),jt(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=v=>g.value=v),rows:"4",placeholder:"Enter rejection reason...",class:"w-full border rounded-lg p-2 text-gray-700"},null,512),[[At,g.value]]),t("div",Ds,[t("button",{class:"btn-3",onClick:e[5]||(e[5]=v=>_.value=!1)},"Cancel"),t("button",{class:"btn-2 bg-red-500 text-white",onClick:ut},"Confirm")])])])):i("",!0)],64)}}};export{Is as default};
