import{r as v,q as R,A,s as D,c as i,f as F,o as d,a as e,n as H,t as f,h as b,g as k,C as L,F as C,x as U,v as Y,u as Z,b as ee,e as te,k as se,l as g,p as w,i as oe,y as le,W as ae}from"./index-BfwuEPo9.js";import{L as ne}from"./LoaderView-DgTSCVTN.js";import{u as I}from"./shift-Pkvra0Rb.js";import{d as B}from"./dayjs.min-Cbbdfn5l.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as de}from"./MultiselectDropdown-CO8F6Tg2.js";import{_ as re}from"./UserChip-Do_C4vXa.js";import{u as pe}from"./company-DIgXDh98.js";import{u as ce}from"./department-D2kn7WHe.js";import{u as ue}from"./user-Dp4hEy9b.js";const fe={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},me={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},ye={class:"text-lg font-semibold mb-4"},_e={class:"mb-4"},ve=["value"],be={class:"mb-4"},he={class:"mb-4"},xe={class:"flex justify-end gap-3 mt-4"},ge={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(q,{emit:M}){const $=M,r=q,a=v({shift_id:"",employee_id:r.employee.id,start_date:"",end_date:""}),y=R(()=>{const c=Object.keys(r.shifts)[0];return r.shifts[c]||[]});A(()=>r.employee,c=>{a.value.employee_id=(c==null?void 0:c.id)||0},{immediate:!0,deep:!0}),A(()=>r.isOpen,c=>{var n;c&&(r.hasShift?(a.value.shift_id=r.hasShift.shift_id||"",a.value.start_date=r.hasShift.start_date?B(r.hasShift.start_date).format("YYYY-MM-DD"):"",a.value.end_date=r.hasShift.end_date?B(r.hasShift.end_date).format("YYYY-MM-DD"):"",a.value.employee_id=((n=r.employee)==null?void 0:n.id)||""):(a.value.shift_id="",a.value.start_date="",a.value.end_date=""))},{immediate:!0});const m=()=>{$("close",!1)},_=I(),{message:h}=D(_),S=async()=>{if(!a.value.shift_id||!a.value.start_date||!a.value.employee_id){alert("All fields are required!");return}try{const c={...a.value},n=await _.shiftAssign(c);console.log("Shift assigned successfully:",n),alert(r.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),m()}catch(c){console.error("Failed to assign shift:",c),alert("Failed to assign shift.")}};return(c,n)=>q.isOpen?(d(),i("div",fe,[e("div",me,[e("h2",ye,f(r.hasShift?"Update Shift for":"Assign Shift to")+" "+f(q.employee.name),1),H(" "+f(b(h))+" ",1),e("div",_e,[n[4]||(n[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),k(e("select",{"onUpdate:modelValue":n[0]||(n[0]=p=>a.value.shift_id=p),class:"w-full p-2 border rounded"},[n[3]||(n[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(d(!0),i(C,null,U(y.value,p=>(d(),i("option",{key:p==null?void 0:p.id,value:p==null?void 0:p.id},f(p==null?void 0:p.name),9,ve))),128))],512),[[L,a.value.shift_id]])]),e("div",be,[n[5]||(n[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),k(e("input",{type:"date","onUpdate:modelValue":n[1]||(n[1]=p=>a.value.start_date=p),class:"w-full border rounded p-2"},null,512),[[Y,a.value.start_date]])]),e("div",he,[n[6]||(n[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),k(e("input",{type:"date","onUpdate:modelValue":n[2]||(n[2]=p=>a.value.end_date=p),class:"w-full border rounded p-2"},null,512),[[Y,a.value.end_date]])]),e("div",xe,[e("button",{onClick:m,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:S,class:"px-4 py-2 bg-green-600 text-white rounded"},f(r.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:m,class:"absolute top-2 right-2 text-red-500 text-xl"},n[7]||(n[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):F("",!0)}},Se=ie(ge,[["__scopeId","data-v-c3e70801"]]),ke={class:"space-y-2 px-4"},we={class:"flex items-center justify-between gap-2"},Ce={class:"flex items-center gap-4"},Ue=["value"],Ae=["value"],qe={key:0,class:"text-center py-4"},Me={key:1,class:"space-y-4"},De={class:"title-md"},Le={class:"overflow-x-auto"},$e={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},Ee={class:"border border-gray-300 px-2"},je=["innerHTML"],Te=["innerHTML"],Ve={class:"border border-gray-300 px-2"},Ne={class:"border border-gray-300 px-2 py-3"},Oe={class:"flex justify-center items-center gap-4"},Ye={class:"text-sm text-gray-700"},Be={key:0,class:"text-green-600"},Re={key:1,class:"text-red-500 italic"},Fe=["onClick"],He={key:0},Ie={key:1},We={key:0},ze={class:"border border-gray-300 px-2"},Pe={class:"border border-gray-300 px-2"},Ke={class:"border border-gray-300 px-2"},Ge={key:0,class:"text-green-500"},Je={key:1,class:"text-red-500"},Qe={class:"border border-gray-300 px-2"},Xe={class:"flex gap-2"},pt={__name:"UserList",setup(q){const M=I(),{shifts:$}=D(M),r=Z(),a=ee(),y=ue();v([]);const m=v(a.query.company||"all"),_=v(a.query.department||"all"),h=v(a.query.line_type||"all"),S=v(""),c=v(""),n=v(!1),p=ce(),E=pe(),{companies:W}=D(E),{departments:z}=D(p);te(()=>{y.fetchUsers(),E.fetchCompanies(),j(m.value)});const P=()=>{r.go(-1)};A(m,o=>{j(o),r.push({query:{...a.query,company:o}})}),A(_,o=>{r.push({query:{...a.query,department:o}})}),A(h,o=>{r.push({query:{...a.query,line_type:o}})});const j=async o=>{await p.fetchDepartments(o)},K=R(()=>{var x;let o=[...(y==null?void 0:y.users)||[]];m.value!=="all"&&(o=o.filter(t=>{var u;return((u=t==null?void 0:t.company)==null?void 0:u.id)==m.value})),_.value!=="all"&&(o=o.filter(t=>{var u;return((u=t==null?void 0:t.department)==null?void 0:u.id)==_.value})),h.value!=="all"&&(o=o.filter(t=>(t==null?void 0:t.type)==h.value)),(x=S.value)!=null&&x.id&&(o=o.filter(t=>(t==null?void 0:t.id)==S.value.id));const s={};return o.forEach(t=>{var l;const u=((l=t==null?void 0:t.company)==null?void 0:l.name)||"Unknown Company";s[u]||(s[u]=[]),s[u].push(t)}),s}),T=v("");function G(o){T.value=o.id,c.value=o,(o==null?void 0:o.company_id)!==void 0&&(M.fetchShifts(o==null?void 0:o.company_id),n.value=!n.value)}function J(){n.value=!1}async function Q(){await y.fetchUsersExcelExport({data:{company_id:m.value,department_id:_.value,line_type:h.value}})}const V=o=>{if(o){const s=o.split(" "),x=s.slice(0,2).join(" "),t=s.length>2?`<br>${s.slice(2).join(" ")}`:"";return x+t}return""};return(o,s)=>{const x=se("RouterLink");return d(),i("div",ke,[e("div",we,[e("button",{class:"btn-3",onClick:P},s[4]||(s[4]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),s[6]||(s[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),g(x,{to:{name:"UserAdd",query:{company:b(a).query.company}},class:"btn-2"},{default:w(()=>s[5]||(s[5]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1,__:[5]},8,["to"])]),e("div",Ce,[e("div",null,[k(e("select",{"onUpdate:modelValue":s[0]||(s[0]=t=>m.value=t),class:"input-1"},[s[7]||(s[7]=e("option",{value:"all",selected:""},"All Company",-1)),(d(!0),i(C,null,U(b(W),(t,u)=>(d(),i("option",{key:u,value:t.id},f(t==null?void 0:t.name),9,Ue))),128))],512),[[L,m.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>_.value=t),class:"input-1"},[s[8]||(s[8]=e("option",{value:"all",selected:""},"All Department",-1)),(d(!0),i(C,null,U(b(z),(t,u)=>(d(),i("option",{key:u,value:t.id},f(t==null?void 0:t.name),9,Ae))),128))],512),[[L,_.value]])]),e("div",null,[k(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>h.value=t),class:"input-1"},s[9]||(s[9]=[oe('<option value="all">All Category</option><option value="executive">Executive</option><option value="support_staff">Support Staff</option><option value="doctor">Doctor</option><option value="academy_body">Academy Body</option>',5)]),512),[[L,h.value]])]),g(de,{modelValue:S.value,"onUpdate:modelValue":s[3]||(s[3]=t=>S.value=t),options:b(y).users,multiple:!1,label:"name","label-prefix":"employee_id",class:"w-1/3",placeholder:"Select user"},{option:w(({option:t})=>[g(re,{user:t,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),e("button",{type:"button",onClick:Q,class:"btn-3"},s[10]||(s[10]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),H("Excel ")]))]),b(y).isLoading?(d(),i("div",qe,[g(ne)])):(d(),i("div",Me,[(d(!0),i(C,null,U(K.value,(t,u)=>(d(),i("div",{key:u},[e("h2",De,f(u)+" ("+f(t.length)+")",1),e("div",Le,[e("table",$e,[s[15]||(s[15]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(d(!0),i(C,null,U(t,(l,X)=>{var N,O;return d(),i("tr",{key:l.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",Ee,f(X+1),1),e("td",{class:"border border-gray-300 px-2",innerHTML:V(l==null?void 0:l.name)},null,8,je),e("td",{class:"border border-gray-300 px-2",innerHTML:V((N=l==null?void 0:l.designation)==null?void 0:N.title)},null,8,Te),e("td",Ve,f(l.role),1),e("td",Ne,[e("div",Oe,[e("div",Ye,[(O=l.current_shift)!=null&&O.shift.name?(d(),i("span",Be,f(l.current_shift.shift.name),1)):(d(),i("span",Re,"Not Assigned"))]),e("button",{type:"button",onClick:Ze=>G(l),class:le(["px-3 py-1 rounded text-white text-xs transition-all duration-150",l!=null&&l.current_shift?"btn-1":"btn-2"])},[l!=null&&l.current_shift?(d(),i("span",He,s[11]||(s[11]=[e("i",{class:"far fa-repeat-alt text-yellow-500 hover:text-yellow-600"},null,-1)]))):(d(),i("span",Ie,s[12]||(s[12]=[e("i",{class:"far fa-plus"},null,-1)])))],10,Fe)]),g(ae,{name:"fade"},{default:w(()=>[T.value===l.id&&n.value?(d(),i("div",We,[g(Se,{isOpen:n.value,shifts:b($),hasShift:l==null?void 0:l.current_shift,employee:{id:c.value.id,name:c.value.name},onClose:J},null,8,["isOpen","shifts","hasShift","employee"])])):F("",!0)]),_:2},1024)]),e("td",ze,f(l.phone),1),e("td",Pe,f(l.email||"নেই"),1),e("td",Ke,[l.is_active?(d(),i("span",Ge,"Active")):(d(),i("span",Je,"Inactive"))]),e("td",Qe,[e("div",Xe,[g(x,{to:{name:"UserShow",params:{id:l.id},query:{company:b(a).query.company}},class:"btn-icon"},{default:w(()=>s[13]||(s[13]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[13]},1032,["to"]),g(x,{to:{name:"UserEdit",params:{id:l.id},query:{company:b(a).query.company}},class:"btn-icon"},{default:w(()=>s[14]||(s[14]=[e("i",{class:"far fa-edit"},null,-1)])),_:2,__:[14]},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{pt as default};
