import{m as C,c as y,o as c,t as a,u as P,b as M,d as E,r as f,z as F,x as T,e as R,A as $,a as t,f as w,q as b,h as B,v as U,k as l,F as V,n as W,g as N,i as I,j}from"./index-BKRuc3xX.js";import{_ as z}from"./EmployeeFilter-D70eznsw.js";import{L as O}from"./LoaderView-D7rXjkqI.js";import{u as Q}from"./attendance-CbPkxppr.js";import{u as G,_ as J}from"./UpdateOrCreate-Ce2C493q.js";import"./company-CEGCq4X8.js";import"./department-FpVJL1bh.js";import"./SelectDropdown-B8GCp2F8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-U1AAOwFq.js";import"./TimePickerAsFloatHour-CPcOQlib.js";const K={__name:"DisplayFormattedWorkingHours",props:["workingHours"],setup(h){const i=h,n=C(()=>{if(!i.workingHours)return"-";const _=Math.floor(i.workingHours),o=Math.round((i.workingHours-_)*60);return o?`${_}h ${o}m`:`${_}h`});return(_,o)=>(c(),y("span",null,a(n.value),1))}},X={class:"px-4 space-y-4"},Y={class:"flex flex-wrap gap-4"},Z={class:"flex gap-4"},g={key:1,class:"space-y-4"},ee={key:0,class:"overflow-x-auto card-bg"},te={class:"min-w-full table-auto border-collapse border border-gray-300 bg-white"},se={class:"text-center text-sm"},ae={class:"border px-2 py-0.5"},re={class:"border px-2 py-0.5"},de={class:"border px-2 py-0.5"},ne={class:"border px-2 py-0.5"},oe={class:"border px-2 py-0.5"},pe={class:"border px-2 py-0.5"},ce={class:"border px-2 py-0.5"},ie={class:"border px-2 py-0.5"},ye={class:"border px-2 py-0.5"},_e={class:"border px-2 py-0.5"},ue={class:"border px-2 py-0.5"},le={class:"border px-2 py-0.5"},me={class:"border px-2 py-0.5"},be={class:"border px-2 py-0.5"},he={class:"border px-2 py-0.5"},xe={class:"border px-2 py-0.5"},ve={class:"border py-0.5"},fe={class:"border-b border-black font-semibold text-green-600"},we={class:"text-gray-600"},ke={class:"border px-2 py-0.5"},He={class:"border px-2 py-0.5"},De={class:"border px-2 py-0.5"},Le={class:"border px-2 py-0.5"},qe={class:"border px-2 py-0.5"},Ae={class:"border px-2 py-0.5"},Se={class:"border px-2 py-0.5"},Ce={class:"border px-2 py-0.5"},Pe={class:"border px-2 py-0.5"},Me={class:"border px-2 py-0.5"},Ee={class:"flex gap-2 items-center"},Fe={class:"border px-2 py-0.5"},Te={class:"border px-4 py-0.5"},Re={key:1,class:"text-center text-red-500 text-xl italic mt-10"},Ge={__name:"MonthlyAttendanceSummaryReport",setup(h){const i=P(),n=M(),_=E(),o=Q();G();const p=f(n.query.date||o.selectedMonth),{monthly_company_summary:k}=F(o),r=f({company_id:n.query.company_id||"",department_id:n.query.department_id||"all",type:n.query.type||"all",employee_id:n.query.employee_id||""}),m=async()=>{const d=r.value.company_id,s=r.value.employee_id||"",u=r.value.type!=="all"?r.value.type:"";if(!d){alert("⚠️ Please select a company first.");return}try{await o.getMonthlyAttendanceSummaryReport(d,s,u,p.value)}catch(e){console.error("❌ Failed to load attendance:",e),alert("❌ Failed to load attendance data.")}},H=()=>{const d=n.query,s={...d,company_id:r.value.company_id,department_id:r.value.department_id,type:r.value.type,employee_id:r.value.employee_id,date:p.value};Object.keys(s).some(e=>d[e]!==String(s[e]))&&i.replace({query:s})};T(p,d=>{n.query.date!==d&&i.replace({query:{...n.query,date:d}})}),R(()=>{r.value.company_id&&m()});const D=async()=>{if(r.value.company_id){const d=r.value.type!=="all"?r.value.type:"";await o.downloadExcel(r.value.company_id,d,p.value)}},L=async()=>{if(r.value.company_id){const d=r.value.type!=="all"?r.value.type:"";await o.downloadPDF(r.value.company_id,d,p.value)}},q=()=>i.go(-1),A=async()=>{await m()};return(d,s)=>{const u=$("router-link");return c(),y("div",X,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:q},s[6]||(s[6]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),s[9]||(s[9]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Attendance Summary Report",-1)),t("div",{class:"flex gap-4"},[t("button",{type:"button",onClick:D,class:"btn-1"},s[7]||(s[7]=[t("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1)])),t("button",{type:"button",onClick:L,class:"btn-1"},s[8]||(s[8]=[t("i",{class:"fal fa-file-pdf text-2xl text-red-500"},null,-1)]))])]),t("div",Y,[b(z,{company_id:r.value.company_id,"onUpdate:company_id":s[0]||(s[0]=e=>r.value.company_id=e),department_id:r.value.department_id,"onUpdate:department_id":s[1]||(s[1]=e=>r.value.department_id=e),employee_id:r.value.employee_id,"onUpdate:employee_id":s[2]||(s[2]=e=>r.value.employee_id=e),category:r.value.category,"onUpdate:category":s[3]||(s[3]=e=>r.value.category=e),"with-type":!0,"initial-value":d.$route.query,onFilterChange:H},null,8,["company_id","department_id","employee_id","category","initial-value"]),t("div",Z,[B(t("input",{type:"month","onUpdate:modelValue":s[4]||(s[4]=e=>p.value=e),class:"input-1"},null,512),[[U,p.value]]),t("button",{type:"button",onClick:s[5]||(s[5]=e=>m()),class:"btn-2"},"Search")])]),l(o).isLoading?(c(),w(O,{key:0})):(c(),y("div",g,[r.value.company_id?(c(),y("div",ee,[t("table",te,[s[11]||(s[11]=t("thead",{class:"sticky top-0 z-10 bg-white shadow-sm"},[t("tr",{class:"bg-gray-100 text-sm"},[t("th",{rowspan:"2",class:"border px-1 py-0.5"},"#"),t("th",{rowspan:"2",class:"border px-1 py-0.5"},"Employee Name"),t("th",{rowspan:"2",class:"border px-1 py-0.5"},"Designation"),t("th",{colspan:"5",class:"border px-1 py-0.5"},"Attendance Summary"),t("th",{colspan:"2",class:"border px-1 py-0.5"},"Actual Late"),t("th",{colspan:"2",class:"border px-1 py-0.5"},"Remaining Late"),t("th",{colspan:"2",class:"border px-1 py-0.5"},"Actual Early"),t("th",{colspan:"2",class:"border px-1 py-0.5"},"Remaining Early"),t("th",{rowspan:"2",class:"border px-1 py-0.5"},"Working Hour"),t("th",{colspan:"4",class:"border px-1 py-0.5"},"Leave Day"),t("th",{colspan:"2",class:"border px-1 py-0.5"},"Short Leave"),t("th",{rowspan:"2",class:"border px-1 py-0.5"},"OT Hour"),t("th",{colspan:"4",class:"border px-1 py-0.5"},"Deduction"),t("th",{rowspan:"2",class:"border px-8 py-0.5"},"Action")]),t("tr",{class:"bg-gray-100 text-xs"},[t("th",{class:"border px-2 py-0.5"},"TD"),t("th",{class:"border px-2 py-0.5"},"TP"),t("th",{class:"border px-2 py-0.5"},"TW"),t("th",{class:"border px-2 py-0.5"},"TL"),t("th",{class:"border px-2 py-0.5"},"TA"),t("th",{class:"border px-1 py-0.5"},"Day"),t("th",{class:"border px-2 py-0.5"},"Hour"),t("th",{class:"border px-1 py-0.5"},"Day"),t("th",{class:"border px-2 py-0.5"},"Hour"),t("th",{class:"border px-1 py-0.5"},"Day"),t("th",{class:"border px-2 py-0.5"},"Hour"),t("th",{class:"border px-1 py-0.5"},"Day"),t("th",{class:"border px-2 py-0.5"},"Hour"),t("th",{class:"border px-2 py-0.5"},"CL"),t("th",{class:"border px-2 py-0.5"},"ML"),t("th",{class:"border px-2 py-0.5"},"SL"),t("th",{class:"border px-2 py-0.5"},"WPL"),t("th",{class:"border px-2 py-0.5"},"Delay"),t("th",{class:"border px-2 py-0.5"},"Early"),t("th",{class:"border px-2 py-0.5"},"Absent Hour"),t("th",{class:"border px-2 py-0.5"},"WPL(Hour)"),t("th",{class:"border px-2 py-0.5"},"Pay Cut"),t("th",{class:"border px-2 py-0.5"},"Payable Hour")])],-1)),t("tbody",se,[(c(!0),y(V,null,W(l(k),(e,S)=>{var x,v;return c(),y("tr",{key:e==null?void 0:e.date,class:"border-b border-gray-200 hover:bg-blue-200"},[t("td",ae,a(S+1),1),t("td",re,a(e==null?void 0:e.user),1),t("td",de,a(e==null?void 0:e.designation),1),t("td",ne,a(e==null?void 0:e.total_monthly_days),1),t("td",oe,a(e==null?void 0:e.total_present),1),t("td",pe,a(e==null?void 0:e.total_weekend),1),t("td",ce,a(e==null?void 0:e.total_leave),1),t("td",ie,a(e==null?void 0:e.total_absent),1),t("td",ye,a(e==null?void 0:e.actual_late_day),1),t("td",_e,a(e==null?void 0:e.actual_late_hour),1),t("td",ue,a(e==null?void 0:e.total_remain_late_day),1),t("td",le,a(e==null?void 0:e.total_remain_late_hour),1),t("td",me,a(e==null?void 0:e.actual_early_day),1),t("td",be,a(e==null?void 0:e.actual_early_hour),1),t("td",he,a(e==null?void 0:e.total_remain_early_day),1),t("td",xe,a(e==null?void 0:e.total_remain_early_hour),1),t("td",ve,[t("div",fe,a((e==null?void 0:e.total_working_hours)||0),1),t("div",we,a((e==null?void 0:e.total_shift_hour)||0),1)]),t("td",ke,a(e==null?void 0:e.total_cl_leave),1),t("td",He,a(e==null?void 0:e.total_ml_leave),1),t("td",De,a(e==null?void 0:e.total_sl_leave),1),t("td",Le,a(e==null?void 0:e.total_wpl_leave),1),t("td",qe,a(e==null?void 0:e.total_first_short_leave),1),t("td",Ae,a(e==null?void 0:e.total_last_short_leave),1),t("td",Se,a(e!=null&&e.total_overtime_hours?(e==null?void 0:e.total_overtime_hours)+" H":""),1),t("td",Ce,a((e==null?void 0:e.remain_total_absent)*9)+"H",1),t("td",Pe,a(e==null?void 0:e.total_wpl_hour)+"H",1),t("td",Me,[t("div",Ee,[b(K,{workingHours:(x=e==null?void 0:e.paycut)==null?void 0:x.paycut_hours},null,8,["workingHours"]),((v=l(_).user)==null?void 0:v.id)===8?(c(),w(J,{key:0,class:"mr-2",userId:e==null?void 0:e.user_id,month:p.value,onUpdated:A},null,8,["userId","month"])):N("",!0)])]),t("td",Fe,a(e==null?void 0:e.payable_hour)+"H",1),t("td",Te,[b(u,{to:{name:"EmployeeAttendance",query:{...l(n).query,employee_id:e==null?void 0:e.user_id,date:p.value}},target:"_blank",class:"text-blue-500 hover:underline inline-flex items-center gap-1"},{default:I(()=>s[10]||(s[10]=[t("i",{class:"fas fa-calendar-check"},null,-1),j(" Go to ")])),_:2,__:[10]},1032,["to"])])])}),128))])])])):(c(),y("div",Re,"Please select company"))]))])}}};export{Ge as default};
