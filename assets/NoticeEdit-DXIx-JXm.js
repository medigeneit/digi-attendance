import{j as G,u as I,b as z,r as b,s as A,E as H,q as V,A as r,e as J,k as K,c as m,o as u,a,m as O,w as Q,f as k,l as c,g as i,n as v,D as h,h as S,C as W,v as D,p as X}from"./index-D3P1gRIA.js";import{L as Y}from"./LoaderView-BQz1f-PA.js";import{_ as N}from"./MultiselectDropdown-06_CFyUf.js";import{_ as Z}from"./TextEditor-BwO0RZan.js";import{u as ee}from"./company-DoZcSpZS.js";import{u as te}from"./department-f-YBhICg.js";import{u as le}from"./notice-CWgZDeZJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"my-container space-y-2"},se={class:"card-bg md:p-8 p-4 mx-4"},oe={class:"grid gap-4"},ne={class:"border p-4 rounded-md bg-gray-100"},ie={class:"grid md:grid-cols-2 gap-4"},de={class:"w-full"},pe={key:0},re={key:1},ue={class:"col-span-3 flex justify-between gap-8"},me={class:"w-full"},ce={class:"w-full"},ye={key:0,class:"mb-2"},fe=["href"],be={class:"col-span-full"},ve={class:"flex justify-center gap-4"},Ne={__name:"NoticeEdit",setup(ge){const g=G(),C=I(),_=z(),w=b(!1),x=le(),y=ee(),n=te(),{companies:M}=A(y),{employees:T}=A(n),t=H({title:"",type:"",description:"",published_at:"",expired_at:"",company_id:"all",department_id:"",file:"",all_companies:!1,all_departments:!1,all_employees:!1}),d=b([]),p=b([]),f=b([]),U=V(()=>d.value.map(s=>s.id)),E=V(()=>p.value.map(s=>s.id)),F=V(()=>f.value.map(s=>s.id)),R=()=>{d.value=t.all_companies?[...y.companies]:[]},B=()=>{p.value=t.all_departments?[...n.departments]:[]},j=()=>{t.all_employees&&(F.value=[])};r(d,s=>{t.all_companies=s.length===y.companies.length}),r(p,s=>{t.all_departments=s.length===n.departments.length}),r(()=>t.all_companies,async s=>{s&&await n.fetchDepartments()}),r(()=>t.all_departments,async s=>{s&&await n.fetchDepartmentEmployee("all")}),r(U,async s=>{s.length&&await n.fetchDepartments(s)}),r(E,async s=>{s.length&&await n.fetchDepartmentEmployee(s)});const P=async s=>{const e=s.target.files[0];if(e){const o=new FormData;o.append("file",e);const l=await x.fetchFileUpload(o);t.file=l==null?void 0:l.url}},L=s=>{if(!s)return;const e=s.split(" ")[0];return e.includes("-")?e:"Invalid Date Format"},q=async()=>{var s,e;try{const o=_.params.id,l=await x.fetchNotice(o);t.title=l.title,t.type=l.type,t.file=l.file,t.published_at=L(l.published_at),t.expired_at=L(l.expired_at),t.description=l.description,t.company_id=l.company_id??"all",t.department_id=l.department_id,d.value=l.companies_notice,p.value=l.departments,f.value=l.employees,t.all_companies=l.companies_notice.length===0,t.all_departments=l.departments.length===0,t.all_employees=l.employees.length===0}catch(o){const l=((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to load notice data";g.error(l),C.push({name:"NoticeList"})}},$=async()=>{var s,e;try{const o={...t,company_ids:U.value,department_ids:E.value,employee_ids:F.value};await x.updateNotice(_.params.id,o),g.success("Notice updated successfully"),C.push({name:"NoticeShow",params:{id:_.params.id}})}catch(o){const l=((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to update notice";g.error(l)}};return J(async()=>{w.value=!0,await y.fetchCompanies(),await q(),w.value=!1}),(s,e)=>{const o=K("RouterLink");return u(),m("div",ae,[a("div",se,[e[25]||(e[25]=a("h2",{class:"title-lg text-center"},"Edit Notice",-1)),w.value?(u(),O(Y,{key:0,class:"bg-gray-100 border shadow-none"})):(u(),m("form",{key:1,onSubmit:Q($,["prevent"]),class:"space-y-4"},[a("div",oe,[a("div",ne,[e[21]||(e[21]=a("p",{class:"title-md"},"Notice Info",-1)),e[22]||(e[22]=a("hr",{class:"my-2"},null,-1)),a("div",ie,[a("div",de,[a("label",null,[i(a("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=l=>t.all_companies=l),onChange:R},null,544),[[h,t.all_companies]]),e[11]||(e[11]=v(" Select All Companies "))]),c(N,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=l=>d.value=l),options:S(M),multiple:!0,searchable:!0,placeholder:"Select companies","track-by":"id",label:"name",disabled:t.all_companies},null,8,["modelValue","options","disabled"])]),a("div",null,[e[13]||(e[13]=a("label",null,"Type*",-1)),i(a("select",{id:"type","onUpdate:modelValue":e[2]||(e[2]=l=>t.type=l),class:"w-full border rounded px-3 py-2",required:""},e[12]||(e[12]=[a("option",{value:"1"},"General",-1),a("option",{value:"2"},"Policy",-1)]),512),[[W,t.type]])]),t.type!=="2"?(u(),m("div",pe,[e[14]||(e[14]=a("label",null,"Publish Date",-1)),i(a("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>t.published_at=l),type:"date",class:"w-full p-2 border rounded"},null,512),[[D,t.published_at]])])):k("",!0),t.type!=="2"?(u(),m("div",re,[e[15]||(e[15]=a("label",null,"Expire Date",-1)),i(a("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>t.expired_at=l),type:"date",class:"w-full p-2 border rounded"},null,512),[[D,t.expired_at]])])):k("",!0),a("div",ue,[a("div",me,[a("label",null,[i(a("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=l=>t.all_departments=l),onChange:B},null,544),[[h,t.all_departments]]),e[16]||(e[16]=v(" Select All Departments "))]),c(N,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=l=>p.value=l),options:S(n).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",disabled:t.all_departments},null,8,["modelValue","options","disabled"])]),a("div",ce,[a("label",null,[i(a("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>t.all_employees=l),onChange:j},null,544),[[h,t.all_employees]]),e[17]||(e[17]=v(" Select All Employees "))]),c(N,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=l=>f.value=l),options:S(T),multiple:!0,searchable:!0,placeholder:"Select Employee","track-by":"id",label:"name",disabled:t.all_employees},null,8,["modelValue","options","disabled"])])]),a("div",null,[e[18]||(e[18]=a("label",null,"Title*",-1)),i(a("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>t.title=l),type:"text",class:"w-full p-2 border rounded"},null,512),[[D,t.title]])]),a("div",null,[e[19]||(e[19]=a("label",null,"File",-1)),t.file&&typeof t.file=="string"?(u(),m("div",ye,[a("a",{href:t.file,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,fe)])):k("",!0),a("input",{type:"file",onChange:P,class:"w-full p-2 border rounded"},null,32)]),a("div",be,[e[20]||(e[20]=a("label",null,"Description",-1)),c(Z,{modelValue:t.description,"onUpdate:modelValue":e[10]||(e[10]=l=>t.description=l),cols:"30",rows:"10",class:"w-full px-4 py-2"},null,8,["modelValue"])])])])]),a("div",ve,[c(o,{to:{name:"NoticeList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:X(()=>e[23]||(e[23]=[v(" Cancel ")])),_:1,__:[23]}),e[24]||(e[24]=a("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32))])])}}};export{Ne as default};
