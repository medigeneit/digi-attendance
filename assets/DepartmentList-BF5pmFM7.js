import{s as U,r as _,z as j,q as E,o as n,c as r,a as t,t as u,w as q,d as b,A as F,F as S,x as M,h as V,v as $,e as L,i as B,p as I,b as T,l as k}from"./index-B8mSMKDk.js";import{u as O}from"./company-wCYEeYru.js";import{_ as z,a as R}from"./HeaderWithButtons-CRl9o9vk.js";import{L as G}from"./LoaderView-tnCXQklQ.js";import{u as H}from"./department-D9_z-el8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={key:0,class:"modal-bg"},K={class:"modal-card"},P={class:"text-lg font-semibold mb-4"},Q={class:"mb-4"},W=["value"],X={class:"mb-4"},Y={class:"mb-4"},Z={class:"mb-4"},ee={class:"mb-4"},te={class:"flex justify-end"},se={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},oe={__name:"DepartmentModal",props:{show:{type:Boolean,required:!0},department:{type:Object,default:null}},emits:["close","save"],setup(D,{emit:d}){const l=D,c=d,m=O(),{companies:i}=U(m),p=_(!1),v=_(!1),o=j({id:null,company_id:"",name:"",short_name:"",description:"",status:"Active"}),h=()=>{p.value=!1,o.id=null,o.company_id="",o.name="",o.short_name="",o.description="",o.status="Active"};E(()=>l.department,a=>{a&&typeof a=="object"&&Object.keys(a).length>0?(p.value=!0,o.id=a.id||null,o.company_id=a.company_id||"",o.name=a.name||"",o.short_name=a.short_name||"",o.description=a.description||"",o.status=a.status||"Active"):h()},{immediate:!0,deep:!0}),E(()=>l.show,async a=>{a&&!v.value&&await C()});const x=()=>{c("save",{...o}),h(),g()},g=()=>{h(),c("close")},C=async()=>{try{await m.fetchCompanies(),v.value=!0}catch(a){console.error("Failed to fetch companies:",a)}};return(a,e)=>D.show?(n(),r("div",J,[t("div",K,[t("h2",P,u(p.value?"Edit Department":"Add Department"),1),t("form",{onSubmit:q(x,["prevent"])},[t("div",Q,[e[6]||(e[6]=t("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),b(t("select",{id:"company_id","onUpdate:modelValue":e[0]||(e[0]=s=>o.company_id=s),class:"w-full border rounded px-3 py-2",required:""},[e[5]||(e[5]=t("option",{value:"",disabled:""},"Select a company",-1)),(n(!0),r(S,null,M(V(i),s=>(n(),r("option",{key:s.id,value:s.id},u(s.name),9,W))),128))],512),[[F,o.company_id]])]),t("div",X,[e[7]||(e[7]=t("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),b(t("input",{id:"name","onUpdate:modelValue":e[1]||(e[1]=s=>o.name=s),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter department name",required:""},null,512),[[$,o.name]])]),t("div",Y,[e[8]||(e[8]=t("label",{for:"short_name",class:"block text-sm font-medium mb-2"},"Short Name",-1)),b(t("input",{id:"short_name","onUpdate:modelValue":e[2]||(e[2]=s=>o.short_name=s),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter short name"},null,512),[[$,o.short_name]])]),t("div",Z,[e[9]||(e[9]=t("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),b(t("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=s=>o.description=s),class:"w-full border rounded px-3 py-2",placeholder:"Enter description"},null,512),[[$,o.description]])]),t("div",ee,[e[11]||(e[11]=t("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),b(t("select",{id:"status","onUpdate:modelValue":e[4]||(e[4]=s=>o.status=s),class:"w-full border rounded px-3 py-2",required:""},e[10]||(e[10]=[t("option",{value:"Active"},"Active",-1),t("option",{value:"Inactive"},"Inactive",-1)]),512),[[F,o.status]])]),t("div",te,[t("button",{type:"button",onClick:g,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),t("button",se,u(p.value?"Update":"Create"),1)])],32)])])):L("",!0)}},ae={class:"my-container space-y-4"},le={key:0,class:"text-center py-4"},ne={key:1,class:"space-y-4"},re={class:"title-md"},de={class:"overflow-x-auto"},ie={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ce={class:"text-gray-600 text-sm"},ue={class:"py-3 px-2 text-left"},me={class:"py-3 px-2 text-left whitespace-nowrap"},pe={class:"py-3 px-2 text-center"},fe={class:"py-3 px-2 text-center"},ye={class:"flex item-center justify-center gap-4"},ve=["onClick"],he=["onClick"],De={__name:"DepartmentList",setup(D){const d=H(),l=B(),c=_(!1),m=_(!1),i=_(null),p=()=>{i.value=null,c.value=!0},v=()=>{c.value=!1},o=e=>{i.value=e,c.value=!0},h=e=>{i.value=e,m.value=!0},x=()=>{m.value=!1},g=async e=>{try{e.id?(await d.updateDepartment(e.id,e),l.success("Department updated successfully!"),await d.fetchDepartments()):(await d.createDepartment(e),l.success("Department added successfully!"))}catch(s){l.error("Failed to save department!"),console.error("Error handling save:",s)}finally{v()}},C=async()=>{var e;if(!((e=i.value)!=null&&e.id)){l.error("Invalid department selected for deletion!");return}try{await d.deleteDepartment(i.value.id),l.success("Department deleted successfully!")}catch(s){l.error("Failed to delete department!"),console.error("Error deleting department:",s)}finally{x()}},a=I(()=>{const e={};return d.departments.forEach(s=>{var w;const f=((w=s.company)==null?void 0:w.name)||"Unknown Company";e[f]||(e[f]=[]),e[f].push(s)}),e});return T(async()=>{try{await d.fetchDepartments()}catch(e){l.error("Failed to fetch departments!"),console.error("Error fetching departments:",e)}}),(e,s)=>{var f;return n(),r("div",ae,[k(R,{title:"Department List",onAdd:p}),V(d).loading?(n(),r("div",le,[k(G)])):(n(),r("div",ne,[(n(!0),r(S,null,M(a.value,(w,A)=>(n(),r("div",{key:A},[t("h2",re,u(A),1),t("div",de,[t("table",ie,[s[2]||(s[2]=t("thead",null,[t("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[t("th",{class:"py-3 px-2 text-left"},"Name"),t("th",{class:"py-3 px-2 text-left"},"Short Name"),t("th",{class:"py-3 px-2 text-center"},"Status"),t("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),t("tbody",ce,[(n(!0),r(S,null,M(w,y=>(n(),r("tr",{key:y.id,class:"border-b border-gray-200 hover:bg-gray-100"},[t("td",ue,u(y.name),1),t("td",me,u(y.short_name),1),t("td",pe,u(y.status),1),t("td",fe,[t("div",ye,[t("button",{onClick:N=>o(y),class:"text-blue-600 hover:text-blue-800"},s[0]||(s[0]=[t("i",{class:"fas fa-edit"},null,-1)]),8,ve),t("button",{onClick:N=>h(y),class:"text-red-600 hover:text-red-800"},s[1]||(s[1]=[t("i",{class:"fas fa-trash"},null,-1)]),8,he)])])]))),128))])])])]))),128))])),k(oe,{show:c.value,department:i.value,onClose:v,onSave:g},null,8,["show","department"]),k(z,{show:m.value,title:"Delete Department",message:`Are you sure you want to delete ${(f=i.value)==null?void 0:f.name}?`,onClose:x,onConfirm:C},null,8,["show","message"])])}}};export{De as default};
