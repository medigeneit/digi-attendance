import{f as K,u as J,G as W,q as R,h as X,c as f,o as y,a as n,d as Q,k as Z,H as te,l as ne,m as O,A as ae,B as se,r as N,x as L,C as H,aa as le,j as F,F as E,e as Y,s as B,t as m,O as G,b as j,v as oe,i as re}from"./index-rQIGEqvT.js";import{_ as ie}from"./EmployeeFilter-CFgdnkFj.js";import"./company-gGZJWLFe.js";import"./department-CgFEAFnx.js";import"./EmployeeDropdownInput-B3C5wvsV.js";import"./SelectDropdown-Dblg_1sB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-B1LLYRom.js";const de={class:"flex flex-wrap items-end gap-3"},ce={__name:"BoardFilters",props:{modelValue:{type:Object,required:!0},companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(v,{emit:r}){const I=v,T=r,M=K(),P=J(),_={type:null,user_type:"Probationary"},w=(t={})=>({type:t.type??_.type,company_id:t.companyId??null,department_id:t.departmentId??null,employee_id:t.employeeId??null,line_type:t.lineType??null,user_type:t.user_type??_.user_type}),b=(t={})=>({type:t.type??_.type,companyId:t.company_id??null,departmentId:t.department_id??null,employeeId:t.employee_id??null,lineType:t.line_type??null,user_type:t.user_type??_.user_type}),o=W(w(I.modelValue));let c=!1;function C(){c||T("update:modelValue",{...b(o)})}const g=["type","company_id","department_id","employee_id","line_type","user_type"],p=t=>t===""||t===null||t===void 0||t==="all";function $(){const t={};return!p(o.type)&&String(o.type)!==String(_.type)&&(t.type=String(o.type)),p(o.company_id)||(t.company_id=String(o.company_id)),p(o.department_id)||(t.department_id=String(o.department_id)),p(o.employee_id)||(t.employee_id=String(o.employee_id)),p(o.line_type)||(t.line_type=String(o.line_type)),!p(o.user_type)&&String(o.user_type)!==_.user_type&&(t.user_type=String(o.user_type)),t}function x(t={}){const e={...M.query};for(const d of g)delete e[d];const l={...e,...$(),...t};for(const d of Object.keys(l)){const D=l[d];(D===""||D===null||D===void 0)&&delete l[d]}return l}let h=null;function s({replace:t=!0,partial:e={},debounce:l=150}={}){h&&clearTimeout(h),h=setTimeout(()=>{const d=x(e);(t?P.replace({query:d}):P.push({query:d})).catch(()=>{})},l)}function i(){const t={...b(o)};T("submit",t),s({replace:!0,debounce:0})}return R(()=>I.modelValue,t=>{const e=w(t||{});let l=!1;for(const d of Object.keys(e))if(o[d]!==e[d]){l=!0;break}l&&(c=!0,Object.assign(o,e),ae(()=>{c=!1}))},{deep:!0}),R(()=>[o.type,o.company_id,o.department_id,o.employee_id,o.line_type,o.user_type],()=>{C(),s({replace:!0,debounce:150})}),X(()=>{M.query.user_type&&(o.user_type=String(M.query.user_type))}),R(()=>M.query.user_type,t=>{t!=null&&(o.user_type=String(t))}),(t,e)=>(y(),f("div",de,[n("div",null,[e[7]||(e[7]=n("label",{class:"block text-xs text-gray-500 mb-1"},"User Type",-1)),Z(n("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.user_type=l),class:"border rounded px-2 py-1"},e[6]||(e[6]=[n("option",{value:"Probationary"},"Probationary",-1),n("option",{value:"Permanent"},"Permanent",-1),n("option",{value:"Contract"},"Contract",-1)]),512),[[te,o.user_type]])]),Q(ie,{company_id:o.company_id,"onUpdate:company_id":e[1]||(e[1]=l=>o.company_id=l),department_id:o.department_id,"onUpdate:department_id":e[2]||(e[2]=l=>o.department_id=l),employee_id:o.employee_id,"onUpdate:employee_id":e[3]||(e[3]=l=>o.employee_id=l),line_type:o.line_type,"onUpdate:line_type":e[4]||(e[4]=l=>o.line_type=l),"with-type":!0,"initial-value":O(M).query,companies:v.companies,departments:v.departments,onFilterChange:e[5]||(e[5]=l=>{Object.assign(o,l)})},{default:ne(()=>[n("button",{class:"btn-2 rounded py-1",onClick:i}," Apply ")]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value","companies","departments"])]))}},ee=se("checklistBoard",()=>{const v=N(!1),r=N(null),I=N("joining"),T=N("Probationary"),M=N(null),P=N(null),_=N(""),w=N([]),b=N([]),o=N(Object.create(null)),c=N(null),C=a=>typeof a=="string"?a.toLowerCase():"",g=a=>Array.isArray(a)?a:[],p=a=>{var u;return((u=a==null?void 0:a.data)==null?void 0:u.data)??(a==null?void 0:a.data)},$=a=>{var u,k;return((u=a==null?void 0:a.company)==null?void 0:u.name)||(a==null?void 0:a.company_name)||((k=a==null?void 0:a.organization)==null?void 0:k.name)||"—"},x=a=>{var u,k;return((u=a==null?void 0:a.department)==null?void 0:u.name)||((k=a==null?void 0:a.dept)==null?void 0:k.name)||(a==null?void 0:a.department_name)||"—"},h=a=>{var u;return((u=a==null?void 0:a.position)==null?void 0:u.title)||(a==null?void 0:a.designation)||"—"},s=(a={})=>{const u={user_type:T.value||void 0,type:I.value||void 0,company_id:M.value||void 0,department_id:P.value||void 0,search:(_.value||"").trim()||void 0,template_id:t.value||void 0};return Object.keys(u).forEach(k=>(u[k]==null||u[k]==="")&&delete u[k]),{...u,...a}},i=L(()=>{const a=C(I.value);return w.value.find(u=>C(u==null?void 0:u.type)===a)||null}),t=L(()=>{var a;return((a=i.value)==null?void 0:a.id)??null});async function e(a={}){try{const u=await H.get("/checklist-templates",{params:a});w.value=g(p(u))}catch(u){throw w.value=[],r.value=u,u}}async function l(a,u){const{data:k}=await H.patch(`/user/${a}/employment-type`,{employment_type:u}),S=b.value.findIndex(z=>z.id===a);return S!==-1&&(this.users[S]={...this.users[S],employment_type:I}),this.rows[a]&&(this.rows[a]={...this.rows[a]}),k}async function d(a={}){if(c.value)try{await c.value}catch{}v.value=!0,r.value=null;const u=s(a),k=(async()=>{try{const S=await H.get("/users-checklists",{params:u});b.value=g(p(S))}catch(S){throw b.value=[],r.value=S,S}finally{v.value=!1,c.value=null}})();return c.value=k,k}async function D({withUsers:a=!0,templateParams:u={},userParams:k={}}={}){v.value=!0,r.value=null;try{w.value.length||await e(u),a&&await d(k)}catch(S){throw r.value=S,S}finally{v.value=!1}}function V(a){b.value=g(a)}function A(a={}){"type"in a&&(I.value=a.type),"companyId"in a&&(M.value=a.companyId),"departmentId"in a&&(P.value=a.departmentId),"search"in a&&(_.value=a.search)}function U(){I.value="joining",M.value=null,P.value=null,_.value=""}function q(){o.value=Object.create(null)}return{loading:v,error:r,type:I,companyId:M,departmentId:P,search:_,templates:w,users:b,rows:o,templateByType:i,templateId:t,companyNameOf:$,departmentNameOf:x,positionTitleOf:h,loadBoard:D,loadTemplates:e,loadUsers:d,setUsers:V,setFilters:A,resetFilters:U,clearRowCache:q,updateEmploymentType:l}}),pe={class:"space-y-1"},ue={class:"inline-flex rounded-lg border p-0.5 text-[11px] bg-white"},ye=["onClick"],me={key:0,class:"group relative"},fe={class:"relative h-2 w-full overflow-hidden rounded-full bg-gray-100 ring-1 ring-inset ring-gray-200"},ve=["aria-valuenow"],_e={class:"mt-1 flex items-center justify-between text-[11px] text-gray-600"},be={class:"flex items-center gap-2"},ge={class:"font-medium"},he={class:"hidden sm:inline"},xe={key:1,class:"space-y-1.5"},we={key:0},ke={key:1,class:"text-red-600"},Ce={key:2,class:"text-gray-500"},$e={key:2,class:"space-y-1.5"},Me={key:0},Ie={key:1,class:"text-red-600"},Pe={key:2,class:"text-gray-500"},Ne={__name:"ChecklistProgressCell",props:{user:{type:Object,required:!0},actualPercent:{type:Number,required:!0},targetPercent:{type:Number,required:!0}},setup(v){const r=v,I=(e,l,d)=>Math.min(Math.max(Number(e||0),l),d),T=e=>e<0?0:e>100?100:Math.round(e),M=e=>e?new Date(e):null,P=(e,l)=>{const d=new Date(e.getTime()),D=d.getMonth()+(l||0);return d.setMonth(D),d.getMonth()!==(D%12+12)%12&&d.setDate(0),d},_=(e,l)=>Math.round((e-l)/864e5),w=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",b=e=>String(e||"").toLowerCase(),o=L(()=>{var e;return b((e=r.user)==null?void 0:e.employment_type)});function c(e){const l=b(e==null?void 0:e.employment_type)==="probationary",d=M(e==null?void 0:e.joining_date)||M(e==null?void 0:e.created_at),D=Number(e==null?void 0:e.probation_months)||0,V=Number(e==null?void 0:e.probation_extension_months)||0;if(!l||!d||Number.isNaN(D)||D<=0)return{enabled:!1,start:null,end:null,pct:0,leftDays:null,status:"inactive",reason:l?"No probation months/start date":"Not probationary"};const A=Math.max(1,D+(V||0)),U=P(d,A),q=new Date,a=Math.max(1,_(U,d)),u=Math.max(0,Math.min(a,_(q,d))),k=_(U,q),S=T(u/a*100),z=k<0?"overdue":k<=14?"near_end":"active";return{enabled:!0,start:d,end:U,pct:S,leftDays:k,status:z}}function C(e){const l=b(e==null?void 0:e.employment_type)==="contract",d=M(e==null?void 0:e.joining_date)||M(e==null?void 0:e.created_at),D=Number((e==null?void 0:e.contract_month)??(e==null?void 0:e.contract_months)??(e==null?void 0:e.contract_duration_months)??0),V=Number((e==null?void 0:e.contract_extension_months)??0);if(!l||!d||Number.isNaN(D)||D<=0)return{enabled:!1,start:null,end:null,pct:0,leftDays:null,status:"inactive",reason:l?"No contract months/start date":"Not contract"};const A=Math.max(1,D+(V||0)),U=P(d,A),q=new Date,a=Math.max(1,_(U,d)),u=Math.max(0,Math.min(a,_(q,d))),k=_(U,q),S=T(u/a*100),z=k<0?"overdue":k<=30?"near_end":"active";return{enabled:!0,start:d,end:U,pct:S,leftDays:k,status:z}}const g=e=>e?"bg-gradient-to-r from-emerald-500 to-emerald-600":"bg-gradient-to-r from-amber-500 to-amber-600",p=(e,l="amber")=>e==="overdue"?{track:"bg-red-100",fill:"bg-red-500",tone:"text-red-600"}:e==="near_end"?{track:l==="blue"?"bg-indigo-100":"bg-orange-100",fill:l==="blue"?"bg-indigo-500":"bg-orange-500",tone:"text-gray-700"}:e==="inactive"?{track:"bg-gray-100",fill:"bg-gray-300",tone:"text-gray-500"}:{track:l==="blue"?"bg-blue-100":"bg-amber-100",fill:l==="blue"?"bg-blue-500":"bg-amber-500",tone:"text-gray-600"},$=N("permanent"),x=L(()=>c(r.user)),h=L(()=>C(r.user)),s=L(()=>[{key:"permanent",label:"Permanent"},{key:"probationary",label:"Probationary"},{key:"contract",label:"Contract"}]);le(()=>{s.value.map(l=>l.key).includes($.value)||($.value="permanent")}),R([o],()=>{const e=o.value;e&&["permanent","probationary","contract"].includes(e)&&$.value!==e&&($.value=e)},{immediate:!0});function i(e){["permanent","probationary","contract"].includes(e)&&($.value=e)}const t=L(()=>{const e=I(r.actualPercent,0,100),l=I(r.targetPercent,1,100);return $.value!=="permanent"?"":e>=l?"Met":`Short by ${Math.max(0,l-e)}%`});return(e,l)=>(y(),f("div",pe,[n("div",ue,[(y(!0),f(E,null,Y(s.value,d=>(y(),f("button",{key:d.key,class:B(["px-2 py-0.5 rounded-md",$.value===d.key?"bg-gray-900 text-white":"text-gray-700"]),onClick:D=>i(d.key)},m(d.label),11,ye))),128))]),$.value==="permanent"?(y(),f("div",me,[n("div",fe,[n("div",{class:"pointer-events-none absolute top-0 h-2 w-0.5 bg-gray-600/60",style:G({left:`calc(${v.targetPercent}% - 1px)`})},null,4),n("div",{class:B(["h-2 transition-all duration-500 ease-out",g(v.actualPercent>=v.targetPercent)]),style:G({width:v.actualPercent+"%"}),role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":v.actualPercent},null,14,ve)]),n("div",_e,[n("div",be,[n("span",ge,"Actual: "+m(v.actualPercent)+"%",1),n("span",he,"Target: "+m(v.targetPercent)+"%",1)]),n("span",{class:B(["rounded-full px-1.5 py-0.5 ring-1 text-[10px]",v.actualPercent>=v.targetPercent?"bg-emerald-50 text-emerald-700 ring-emerald-200":"bg-amber-50 text-amber-700 ring-amber-200"])},m(t.value),3)])])):$.value==="probationary"?(y(),f("div",xe,[n("div",{class:B(["relative w-full h-1.5 overflow-hidden rounded-full",p(x.value.status).track])},[n("div",{class:B(["h-1.5 transition-all duration-500 ease-out",p(x.value.status).fill]),style:G({width:(x.value.enabled?x.value.pct:0)+"%"})},null,6)],2),n("div",{class:B(["flex items-center justify-between text-[11px]",p(x.value.status).tone])},[n("span",null,[l[0]||(l[0]=j(" Probation: ")),x.value.enabled?(y(),f(E,{key:0},[j(m(x.value.pct)+"%",1)],64)):(y(),f(E,{key:1},[j("Not set")],64))]),x.value.enabled&&x.value.leftDays>=0?(y(),f("span",we,m(w(x.value.start))+" → "+m(w(x.value.end))+" · "+m(x.value.leftDays)+"d left ",1)):x.value.enabled?(y(),f("span",ke,m(w(x.value.start))+" → "+m(w(x.value.end))+" · Overdue "+m(Math.abs(x.value.leftDays))+"d ",1)):(y(),f("span",Ce,"No tenure data"))],2)])):$.value==="contract"?(y(),f("div",$e,[n("div",{class:B(["relative w-full h-1.5 overflow-hidden rounded-full",p(h.value.status,"blue").track])},[n("div",{class:B(["h-1.5 transition-all duration-500 ease-out",p(h.value.status,"blue").fill]),style:G({width:(h.value.enabled?h.value.pct:0)+"%"})},null,6)],2),n("div",{class:B(["flex items-center justify-between text-[11px]",p(h.value.status,"blue").tone])},[n("span",null,[l[1]||(l[1]=j(" Contract: ")),h.value.enabled?(y(),f(E,{key:0},[j(m(h.value.pct)+"%",1)],64)):(y(),f(E,{key:1},[j("Not set")],64))]),h.value.enabled&&h.value.leftDays>=0?(y(),f("span",Me,m(w(h.value.start))+" → "+m(w(h.value.end))+" · "+m(h.value.leftDays)+"d left ",1)):h.value.enabled?(y(),f("span",Ie,m(w(h.value.start))+" → "+m(w(h.value.end))+" · Expired "+m(Math.abs(h.value.leftDays))+"d ",1)):(y(),f("span",Pe,"No data"))],2)])):F("",!0)]))}},Te={class:"flex items-center gap-2"},De={class:"relative"},Se=["disabled","value"],je=["value"],Be={key:0,class:"absolute right-2 top-1/2 h-3 w-3 -translate-y-1/2 animate-spin text-gray-400",viewBox:"0 0 24 24"},Oe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Le={class:"relative z-10 w-[92vw] max-w-sm rounded-xl bg-white p-4 shadow-xl"},Ue={class:"mt-2 text-[13px] text-gray-600"},qe={class:"font-medium"},Ee={class:"font-medium"},Fe={class:"font-medium"},Ve={__name:"EmploymentTypeCell",props:{user:{type:Object,required:!0},saving:{type:Boolean,default:!1},value:{type:String,required:!0},onConfirmChange:{type:Function,required:!0}},setup(v){const r=v,I=[{value:"probationary",label:"Probationary"},{value:"permanent",label:"Permanent"},{value:"contract",label:"Contract"}],T=g=>{var p;return((p=I.find($=>$.value===g))==null?void 0:p.label)||"—"},M=g=>g==="probationary"?"bg-amber-50 text-amber-700 ring-amber-200":g==="permanent"?"bg-green-50 text-green-700 ring-green-200":g==="contract"?"bg-blue-50 text-blue-700 ring-blue-200":"bg-gray-50 text-gray-700 ring-gray-200",P=N(!1),_=N(""),w=L(()=>T(r.value)),b=L(()=>T(_.value));function o(g){const p=g.target.value;p!==r.value&&(_.value=p,P.value=!0)}async function c(){const g=_.value;P.value=!1,g&&(await r.onConfirmChange(g),_.value="")}function C(){P.value=!1,_.value=""}return(g,p)=>{var $,x,h;return y(),f("div",Te,[n("span",{class:B(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] ring-1",M(v.value)])},m(T(v.value)),3),n("div",De,[n("select",{disabled:v.saving,value:v.value,class:"rounded-md border bg-white px-2 py-1 text-[11px] outline-none disabled:opacity-50",onChange:o,"aria-label":"Change employment type"},[(y(),f(E,null,Y(I,s=>n("option",{key:s.value,value:s.value},m(s.label),9,je)),64))],40,Se),v.saving?(y(),f("svg",Be,p[0]||(p[0]=[n("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3",fill:"none"},null,-1),n("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3A5 5 0 007 12H4z"},null,-1)]))):F("",!0)]),P.value?(y(),f("div",Oe,[p[6]||(p[6]=n("div",{class:"absolute inset-0 bg-black/40"},null,-1)),n("div",Le,[p[5]||(p[5]=n("h3",{class:"text-sm font-semibold"},"Confirm status change",-1)),n("p",Ue,[p[1]||(p[1]=j(" Change ")),n("span",qe,m(w.value),1),p[2]||(p[2]=j(" ➜ ")),n("span",Ee,m(b.value),1),p[3]||(p[3]=j(" for ")),n("span",Fe,m((($=v.user)==null?void 0:$.name)||((x=v.user)==null?void 0:x.full_name)||((h=v.user)==null?void 0:h.email)),1),p[4]||(p[4]=j("? "))]),n("div",{class:"mt-4 flex items-center justify-end gap-2"},[n("button",{class:"px-3 py-1.5 rounded-md text-[12px] border",onClick:C},"Cancel"),n("button",{class:"px-3 py-1.5 rounded-md text-[12px] bg-gray-900 text-white hover:bg-black",onClick:c}," Confirm ")])])])):F("",!0)])}}},Ae={class:"space-y-4"},ze={class:"flex flex-wrap items-center gap-2"},Re={class:"relative"},Ge={class:"ml-auto"},Qe={class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs text-blue-700"},He={class:"ml-1 font-medium"},Je={class:"overflow-x-auto rounded-xl border shadow-sm"},Ye={class:"min-w-full text-[13px]"},Ke={class:"p-2"},We={class:"p-2"},Xe={class:"flex items-center gap-2"},Ze={class:"relative h-8 w-8 shrink-0"},et=["src"],tt={key:1,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 text-[11px] font-semibold text-gray-700"},nt={class:"min-w-0"},at={class:"font-medium truncate"},st={class:"text-[11px] text-gray-500 space-x-2 truncate"},lt={key:0},ot={class:"hidden sm:inline"},rt={class:"p-2 hidden md:table-cell"},it=["title"],dt={class:"p-2"},ct={class:"p-2"},pt={class:"p-2"},ut=["disabled","title","onClick"],yt={key:0,class:"text-gray-600 text-sm"},mt={key:1,class:"rounded-xl border border-dashed p-10 text-center text-sm text-gray-500"},ft={__name:"ChecklistBoardTable",setup(v){const r=ee(),I=J(),T=N(""),M=N(!1),P=N("progress_desc"),_=W({}),w=s=>{var i;return((i=r.rows)==null?void 0:i[String(s==null?void 0:s.id)])||{}},b=(s,i,t)=>Math.min(Math.max(Number(s||0),i),t),o=s=>{const t=w(s).percent??(s==null?void 0:s.percent)??0;return b(t,0,100)},c=s=>{var i;return b(((i=s==null?void 0:s.checklist)==null?void 0:i.required_completion_percent)??100,1,100)},C=s=>{const i=e=>String(e||"").toLowerCase(),t=i(T.value);return t?[s==null?void 0:s.name,s==null?void 0:s.employee_id,s==null?void 0:s.department,s==null?void 0:s.designation].filter(Boolean).some(e=>i(e).includes(t)):!0},g=L(()=>{let s=(r.users||[]).filter(C);return M.value&&(s=s.filter(i=>o(i)<c(i))),P.value==="name_asc"?s=[...s].sort((i,t)=>(i.name||"").localeCompare(t.name||"")):P.value==="progress_asc"?s=[...s].sort((i,t)=>o(i)-o(t)):s=[...s].sort((i,t)=>o(t)-o(i)),s});function p(s){const i=r.templateId;i&&I.push({name:"checklist.create",params:{userId:s.id,templateId:i}})}const $=s=>String(s||"").toLowerCase();async function x(s,i){if(!(s!=null&&s.id))return;const t=$(s.employment_type),l=(d=>d==="probationary"?"Probationary":d==="permanent"?"Permanent":d==="contract"?"Contract":"—")(i);_[s.id]=!0,s.employment_type=i;try{await r.updateEmploymentType(s.id,l)}catch(d){s.employment_type=t,console.error(d),alert("Failed to update employment type. Please try again.")}finally{_[s.id]=!1}}const h=s=>s?new Date(s).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"";return(s,i)=>(y(),f("div",Ae,[n("div",ze,[n("div",Re,[Z(n("input",{"onUpdate:modelValue":i[0]||(i[0]=t=>T.value=t),type:"search",placeholder:"Search name / ID / dept / designation…",class:"w-64 md:w-80 max-w-full rounded-lg border bg-white/90 px-8 py-2 text-sm outline-none focus:border-gray-400"},null,512),[[oe,T.value]]),i[2]||(i[2]=n("svg",{class:"pointer-events-none absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M12.9 14.32a8 8 0 111.414-1.414l3.387 3.387a1 1 0 01-1.414 1.414L12.9 14.32zM14 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1)),T.value?(y(),f("button",{key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",onClick:i[1]||(i[1]=t=>T.value=""),"aria-label":"Clear search"},"✕")):F("",!0)]),n("div",Ge,[n("span",Qe,[i[3]||(i[3]=j(" Template: ")),n("span",He,m(O(r).templateId||"Not selected"),1)])])]),n("div",Je,[n("table",Ye,[i[4]||(i[4]=n("thead",{class:"sticky top-0 bg-gray-50/90 backdrop-blur"},[n("tr",{class:"text-left border-b"},[n("th",{class:"p-2 w-10"},"#"),n("th",{class:"p-2 min-w-[220px]"},"User"),n("th",{class:"p-2 hidden md:table-cell min-w-[160px]"},"Role"),n("th",{class:"p-2 min-w-[260px]"},"Progress"),n("th",{class:"p-2 w-48"},"Status"),n("th",{class:"p-2 w-36"},"Actions")])],-1)),n("tbody",null,[(y(!0),f(E,null,Y(g.value,(t,e)=>(y(),f("tr",{key:t.id,class:"border-b hover:bg-gray-50/70"},[n("td",Ke,m(e+1),1),n("td",We,[n("div",Xe,[n("div",Ze,[t.avatar?(y(),f("img",{key:0,src:t.avatar,alt:"",class:"h-8 w-8 rounded-full object-cover"},null,8,et)):(y(),f("div",tt,m((t.name||t.full_name||t.email||"??").slice(0,2).toUpperCase()),1))]),n("div",nt,[n("div",at,m(t.name||t.full_name||t.email),1),n("div",st,[t.joining_date?(y(),f("span",lt,"Joining Date: "+m(h(t.joining_date)),1)):F("",!0),n("span",ot,"Dept: "+m(t.department||"—"),1)])])])]),n("td",rt,[n("div",{class:"truncate",title:t.designation},m(t.designation||"—"),9,it)]),n("td",dt,[Q(Ne,{user:t,"actual-percent":o(t),"target-percent":c(t)},null,8,["user","actual-percent","target-percent"])]),n("td",ct,[Q(Ve,{user:t,value:String(t.employment_type).toLowerCase(),saving:!!_[t.id],"on-confirm-change":l=>x(t,l)},null,8,["user","value","saving","on-confirm-change"])]),n("td",pt,[n("button",{class:"px-3 py-1.5 rounded-md text-[12px] font-medium bg-gray-900 text-white hover:bg-black disabled:opacity-40",disabled:!O(r).templateId,title:O(r).templateId?"":"Select a template first",onClick:l=>p(t)},m(t!=null&&t.checklist?"Open":"Create"),9,ut)])]))),128))])])]),O(r).loading?(y(),f("div",yt,"Loading…")):!O(r).loading&&g.value.length===0?(y(),f("div",mt," No users found for the current filters. ")):F("",!0)]))}},vt={class:"p-6 space-y-6"},_t={class:"flex items-center justify-between"},bt={class:"text-2xl font-semibold"},gt={class:"text-gray-500"},ht={key:0,class:"text-gray-600"},xt={key:1,class:"text-red-600"},Tt={__name:"JoiningExitBoard",setup(v){const r=ee(),I=K(),T=J(),M=N([]),P=N([]),_=(c={})=>({type:c.type??r.type,companyId:c.company_id?Number(c.company_id):null,departmentId:c.department_id?Number(c.department_id):null,employeeId:c.employee_id?Number(c.employee_id):null,lineType:c.line_type??null,user_type:c.user_type??null,search:c.search??r.search}),w=(c={})=>{const C={type:c.type||void 0,company_id:c.companyId||void 0,department_id:c.departmentId||void 0,employee_id:c.employeeId||void 0,line_type:c.lineType||void 0,user_type:c.user_type||void 0,search:c.search||void 0};return Object.keys(C).forEach(g=>(C[g]==null||C[g]==="")&&delete C[g]),C},b=N({type:r.type,companyId:r.companyId,departmentId:r.departmentId,employeeId:null,lineType:null,user_type:null,search:r.search});R(b,c=>{r.type=c.type,r.user_type=c.user_type,r.companyId=c.companyId??null,r.departmentId=c.departmentId??null,r.search=c.search??"",T.replace({query:{...I.query,...w(c)}})},{deep:!0,immediate:!0});async function o(){await r.loadUsers({type:b.value.type,company_id:b.value.companyId,department_id:b.value.departmentId,employee_id:b.value.employeeId,line_type:b.value.lineType,user_type:b.value.user_type,search:b.value.search})}return X(async()=>{Object.assign(b.value,_(I.query)),await r.loadBoard({withUsers:!0,userParams:w(b.value)})}),(c,C)=>{var g,p;return y(),f("div",vt,[n("div",_t,[n("h1",bt,[n("b",null,m(((g=O(r).templateByType)==null?void 0:g.name)||"—"),1),C[1]||(C[1]=j(" Board"))]),n("div",gt,[C[2]||(C[2]=j(" Template: ")),n("b",null,m(((p=O(r).templateByType)==null?void 0:p.name)||"—"),1)])]),Q(ce,{modelValue:b.value,"onUpdate:modelValue":C[0]||(C[0]=$=>b.value=$),companies:M.value,departments:P.value,onSubmit:o},null,8,["modelValue","companies","departments"]),O(r).loading?(y(),f("div",ht,"Loading…")):O(r).error?(y(),f("div",xt,"Failed to load.")):(y(),re(ft,{key:2}))])}}};export{Tt as default};
