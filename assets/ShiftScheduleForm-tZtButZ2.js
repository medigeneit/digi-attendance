import{E as J,r as i,G as V,s as I,p as N,q as Q,b as W,c as n,a as o,d as _,z as T,F as g,x as b,h as j,v as X,o as r,t as v,y as D,k as U,D as Z}from"./index-BPSQoUXf.js";import{u as P}from"./company-BZ3iwlvS.js";import{u as ee}from"./shift-D5N92zPG.js";import{d as A}from"./dayjs.min-Cbbdfn5l.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se=J("shiftSchedule",()=>{const x=i([]);return{schedules:x,fetchSchedules:async u=>{const y=await V.get("/shift-schedules",u);return x.value=y.data,y.data},saveSchedules:async u=>{await V.post("/shift-schedules",{schedules:u==null?void 0:u.payload})}}}),oe={class:"p-4 max-w-[1600px] mx-auto"},ae={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},le=["value"],ne=["value"],re={class:"flex flex-wrap gap-3 mb-4"},ie=["onClick"],de={class:"text-sm"},ue={class:"overflow-auto"},ce={class:"table-auto w-full border text-sm"},pe={class:"sticky top-0 bg-white z-10"},ve={class:"text-xs text-gray-400"},he={class:"border p-2"},fe=["value"],ge={class:"border p-2 whitespace-nowrap"},be={class:"border p-2"},me=["onClick"],ye=["onClick"],Se=["title"],_e={__name:"ShiftScheduleForm",setup(x){const w=se(),m=P(),u=ee(),{companies:y,employees:Y}=I(m),{shifts:z}=I(u),h=i(A().format("YYYY-MM")),k=i("");i(""),i("");const c=i("");i([]),i([]);const d=i({}),p=i([]),C=i({}),F=["bg-green-700","bg-pink-600","bg-blue-800","bg-cyan-600","bg-red-600","bg-purple-700","bg-yellow-500","bg-indigo-500","bg-amber-600"],S=N(()=>Object.values(z.value||{}).flat());function B(){const s=S.value;let t=0;s.forEach(e=>{C.value[e.id]=F[t%F.length],t++})}const E=N(()=>Array.from({length:A(h.value).daysInMonth()},(s,t)=>t+1)),O=s=>{const t=`${h.value}-${String(s).padStart(2,"0")}`;return A(t).format("ddd")},q=(s,t)=>{var a,l;const e=(l=(a=d.value)==null?void 0:a[s])==null?void 0:l[t];return e&&C.value[parseInt(e)]||"bg-gray-300"},G=(s,t)=>{var l,f;const e=(f=(l=d.value)==null?void 0:l[s])==null?void 0:f[t],a=S.value.find(M=>M.id===e);return(a==null?void 0:a.name)||""},K=(s,t)=>{p.value.includes(parseInt(s))&&c.value&&(d.value[s]||(d.value[s]={}),d.value[s][t]=c.value)},$=s=>{p.value.includes(parseInt(s))&&c.value&&(d.value[s]||(d.value[s]={}),E.value.forEach(t=>{d.value[s][t]=c.value}))},L=()=>{p.value.forEach(s=>{$(s)})},R=async()=>{const s=Object.entries(d.value).flatMap(([t,e])=>p.value.includes(parseInt(t))?Object.entries(e).map(([a,l])=>({employee_id:parseInt(t),date:`${h.value}-${String(a).padStart(2,"0")}`,shift_id:l})):[]);try{await w.saveSchedules({payload:s}),alert("Shift schedule saved successfully!")}catch(t){console.error("Failed to save schedule",t),alert("Something went wrong while saving.")}};Q(k,async s=>{s&&(await m.fetchEmployee(s),await u.fetchShifts({companyId:s}),B(),await H(s,h.value))}),W(async()=>{await m.fetchCompanies()});const H=async(s,t)=>{try{const e=await w.fetchSchedules({params:{company_id:s,month:t}}),a={};e.forEach(l=>{p.value.push(l.employee_id);const f=l.employee_id,M=parseInt(l.date.split("-")[2]);a[f]||(a[f]={}),a[f][M]=l==null?void 0:l.shift_id}),d.value=a}catch(e){console.error("Failed to load schedule data:",e)}};return(s,t)=>(r(),n("div",oe,[o("div",ae,[_(o("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),class:"p-2 border rounded"},[t[4]||(t[4]=o("option",{value:""},"Select Company",-1)),(r(!0),n(g,null,b(j(y),e=>(r(),n("option",{key:e.id,value:e.id},v(e.name),9,le))),128))],512),[[T,k.value]]),_(o("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e),class:"p-2 border rounded"},[t[5]||(t[5]=o("option",{value:""},"- Shift -",-1)),(r(!0),n(g,null,b(S.value,e=>(r(),n("option",{key:e.id,value:e.id},v(e.name),9,ne))),128))],512),[[T,c.value]]),_(o("input",{type:"month","onUpdate:modelValue":t[2]||(t[2]=e=>h.value=e),class:"p-2 border rounded"},null,512),[[X,h.value]])]),o("div",re,[(r(!0),n(g,null,b(S.value,e=>(r(),n("div",{key:e.id,class:D(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":c.value===e.id}]),onClick:a=>c.value=e.id},[o("div",{class:D(["w-5 h-5 rounded",C.value[e.id]||"bg-gray-300"])},null,2),o("span",de,v(e.name),1)],10,ie))),128))]),o("div",{class:"mb-4 flex gap-4"},[o("button",{onClick:L,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees ")]),o("div",ue,[o("table",ce,[o("thead",pe,[o("tr",null,[t[6]||(t[6]=o("th",{class:"border p-2"},"Emp ID",-1)),t[7]||(t[7]=o("th",{class:"border p-2"},"Name",-1)),t[8]||(t[8]=o("th",{class:"border p-2"},"Action",-1)),(r(!0),n(g,null,b(E.value,e=>(r(),n("th",{key:e,class:"border text-center p-1 w-10"},[U(v(e)+" ",1),o("div",ve,v(O(e)),1)]))),128))])]),o("tbody",null,[(r(!0),n(g,null,b(j(Y),e=>(r(),n("tr",{key:e.id},[o("td",he,[_(o("input",{type:"checkbox",class:"mr-2",value:e.id,"onUpdate:modelValue":t[3]||(t[3]=a=>p.value=a)},null,8,fe),[[Z,p.value]]),U(" "+v(e.code),1)]),o("td",ge,v(e.name),1),o("td",be,[o("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:a=>$(e.id)}," Apply to All Dates ",8,me)]),(r(!0),n(g,null,b(E.value,a=>(r(),n("td",{key:a,class:"border text-center cursor-pointer",onClick:l=>K(e.id,a)},[o("div",{title:G(e.id,a),class:D([q(e.id,a),"w-full h-6"])},null,10,Se)],8,ye))),128))]))),128))])])]),o("div",{class:"mb-4 mt-4"},[o("button",{onClick:R,class:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow"}," ðŸ’¾ Save Schedule ")])]))}},Me=te(_e,[["__scopeId","data-v-9fb6893b"]]);export{Me as default};
