import{E as F,r as i,x as y,G as d}from"./index-CE4LFMzm.js";const L=F("todo",()=>{const h=i(null),u=i(!1),T=i(!1),s=i(null),l=i([]),m=async()=>{var r,a,t;u.value=!0,s.value=null;try{const e=await d.get("/todos");l.value=((r=e.data)==null?void 0:r.todos)||[],f()}catch(e){throw s.value=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Todos load failed",e}finally{u.value=!1}};function f(){l.value=[...l.value.sort((r,a)=>{var t,e,o,n;return((t=r==null?void 0:r.user)==null?void 0:t.id)!==((e=a==null?void 0:a.user)==null?void 0:e.id)?((o=r==null?void 0:r.user)==null?void 0:o.id)-((n=a==null?void 0:a.user)==null?void 0:n.id):r.priority!==a.priority?r.priority-a.priority:a.id-r.id})]}const w=async()=>{var r,a,t;u.value=!0,s.value=null;try{const e=await d.get("/my-todos");l.value=((r=e.data)==null?void 0:r.todos)||[],f()}catch(e){throw s.value=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Todos load failed",e}finally{u.value=!1}},$=r=>{var a;return(a=l.value)==null?void 0:a.filter(t=>t.date==r)},S=async r=>{var a,t;u.value=!0,s.value=null;try{const e=await d.get(`/todos/${r}`);h.value=e.data,h.value=l.value.find(o=>o.id==r)}catch(e){throw s.value=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Todo load failed",e}finally{u.value=!1}},x=async(r,{returnWith:a}={})=>{var t,e,o;u.value=!0,s.value=null;try{const n=await d.post("/todos",r,{params:{return_with:a}});return l.value=[...l.value,(t=n.data)==null?void 0:t.todo],f(),n.data}catch(n){throw s.value=((o=(e=n.response)==null?void 0:e.data)==null?void 0:o.message)||"Todo create failed",n}finally{u.value=!1}},M=async(r,a)=>{var t,e;u.value=!0,s.value=null;try{const o=await d.put(`/todos/${r}`,a);return l.value=l.value.map(n=>{var g,c,v,p;return n.id==((c=(g=o.data)==null?void 0:g.todo)==null?void 0:c.id)?n.user?{...(v=o.data)==null?void 0:v.todo,user:{...n.user}}:{...(p=o.data)==null?void 0:p.todo}:{...n}}),o.data}catch(o){throw s.value=((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||"Todo update failed",o}finally{u.value=!1}},C=async(r,a)=>{var t,e;u.value=!0,s.value=null;try{await d.put(`/todos/status/${r}`,{status:a}),l.value=l.value.map(o=>o.id===r?{...o,status:a}:{...o})}catch(o){throw s.value=((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to update todo status",o}finally{u.value=!1}},D=async(r,{date:a}={})=>{var t,e;u.value=!0,T.value=!0,s.value=null;try{const o=await d.put("/my-todos/rearrange",{ids:r,date:a});l.value=l.value.map(n=>{var v;const c=(((v=o.data)==null?void 0:v.changes)||[]).find(p=>p.id==n.id);return c?{...n,priority:c.priority}:n}),f()}catch(o){throw s.value=((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||"Todo rearranging failed",o}finally{T.value=!0,u.value=!1}},E=async r=>{var a,t;u.value=!0,s.value=null;try{await d.delete(`/todos/${r}`),l.value=l.value.filter(e=>e.id!==r)}catch(e){throw s.value=((t=(a=e.response)==null?void 0:a.data)==null?void 0:t.message)||"Todo delete failed",e}finally{u.value=!1}};return{todos:y(()=>l.value),todo:y(()=>h.value),loading:y(()=>u.value),error:y(()=>s.value),fetchTodos:m,fetchTodo:S,createTodo:x,updateTodo:M,rearrangeMyTodos:D,deleteTodo:E,fetchMyTodos:w,updateTodoStatus:C,getTodosByDate:$}});export{L as u};
