import{u as M,B as g,r as p,q as N,e as R,c as a,o as l,a as e,y as $,k as u,F as c,x as _,h as v,g as x,A as F,t as k,K as C}from"./index-nvZG5ov6.js";import{_ as L}from"./MultiselectDropdown-B6Ce7iS6.js";import{u as j}from"./company-BMqDv-V0.js";import{u as q}from"./department-Bf7uhEmZ.js";import{u as E}from"./user-CUrwngW_.js";import{u as K}from"./userPermissionStore-BIlihWRA.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DON16gRn.js";const T={class:"max-w-4xl mx-auto mt-10 p-6 bg-white shadow-md rounded-xl space-y-6"},z={class:"space-y-4"},G={class:"flex items-center justify-between"},H=["onClick"],I=["onUpdate:modelValue","onChange"],J=["value"],O={key:0},Q={class:"space-y-1 mt-2"},W={class:"flex items-center space-x-2"},X=["onUpdate:modelValue"],Y={key:0,class:"grid grid-cols-2 gap-2"},Z=["value","onUpdate:modelValue"],ee=["disabled"],te={key:0},se={key:1},me={__name:"PermissionAdd",setup(oe){const b=E(),d=K(),S=M(),y=j(),f=q(),{users:U}=g(b),{companies:w}=g(y),m=p(null),r=p({user_id:"",companies:[]}),i=p({});N(m,n=>{r.value.user_id=(n==null?void 0:n.id)||""});const V=async n=>{n.department_ids=[],await f.fetchDepartments(n.company_id),i.value[n.company_id]=f.departments},D=()=>{r.value.companies.push({company_id:"",department_ids:[]})},P=n=>{r.value.companies.splice(n,1)},A=async()=>{try{await d.createPermission(r.value),S.push({name:"PermissionList"})}catch{alert(d.error)}};return R(()=>{b.fetchUsers({type:"admin"}),y.fetchCompanies()}),(n,t)=>(l(),a("div",T,[t[6]||(t[6]=e("h2",{class:"text-2xl font-bold text-gray-700"},"Add Permission",-1)),e("div",null,[t[1]||(t[1]=e("label",{class:"block font-medium mb-1"},"Select User",-1)),$(L,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),options:u(U),multiple:!1,label:"label",placeholder:"Select employee"},null,8,["modelValue","options"])]),e("div",z,[(l(!0),a(c,null,_(r.value.companies,(s,h)=>(l(),a("div",{key:h,class:"p-4 border rounded space-y-3 bg-gray-50"},[e("div",G,[t[2]||(t[2]=e("label",{class:"font-medium"},"Select Company",-1)),e("button",{onClick:o=>P(h),class:"text-red-500"},"Remove",8,H)]),v(e("select",{"onUpdate:modelValue":o=>s.company_id=o,onChange:o=>V(s),class:"w-full border rounded px-3 py-2 mt-1"},[t[3]||(t[3]=e("option",{value:""},"-- Select Company --",-1)),(l(!0),a(c,null,_(u(w),o=>(l(),a("option",{key:o.id,value:o.id},k(o.name),9,J))),128))],40,I),[[F,s.company_id]]),s.company_id&&i.value[s.company_id]&&i.value[s.company_id].length?(l(),a("div",O,[t[5]||(t[5]=e("label",{class:"block font-medium mb-1 mt-3"},"Select Departments",-1)),e("div",Q,[e("label",W,[v(e("input",{type:"checkbox",value:"*","onUpdate:modelValue":o=>s.department_ids=o},null,8,X),[[C,s.department_ids]]),t[4]||(t[4]=e("span",null,"All Departments",-1))]),s.department_ids.includes("*")?x("",!0):(l(),a("div",Y,[(l(!0),a(c,null,_(i.value[s.company_id],o=>(l(),a("label",{key:o.id,class:"flex items-center space-x-2"},[v(e("input",{type:"checkbox",value:o.id,"onUpdate:modelValue":B=>s.department_ids=B},null,8,Z),[[C,s.department_ids]]),e("span",null,k(o.name),1)]))),128))]))])])):x("",!0)]))),128))]),e("button",{onClick:D,class:"py-2 px-4 bg-green-600 text-white rounded hover:bg-green-700"}," + Add Company "),e("button",{onClick:A,disabled:u(d).loading,class:"w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mt-4"},[u(d).loading?(l(),a("span",te,"Saving...")):(l(),a("span",se,"Save Permission"))],8,ee)]))}};export{me as default};
