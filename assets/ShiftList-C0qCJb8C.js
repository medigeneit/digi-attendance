import{u as q}from"./shift-Dq_9LNxQ.js";import{r as x,y as T,i as V,o as d,c as r,a as e,t as u,w as j,d as v,z as F,F as M,q as E,h as D,v as w,e as L,x as N,n as B,b as I,k as S}from"./index-4IjiUvet.js";import{_ as O,a as z}from"./HeaderWithButtons-BlimuTqK.js";import{u as G}from"./company-BHEAUYny.js";import{L as H}from"./LoaderView-B-JsmDqY.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={key:0,class:"modal-bg"},K={class:"modal-card"},P={class:"text-lg font-semibold mb-4"},Q={class:"mb-4"},R=["value"],W={class:"mb-4"},X={class:"mb-4"},Y={class:"mb-4"},Z={class:"mb-4"},ee={class:"mb-4"},te={class:"flex justify-end"},se={type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"},oe={__name:"ShiftModal",props:{show:{type:Boolean,required:!0},shift:{type:Object,default:null}},emits:["close","save"],setup(k,{emit:c}){const i=k,m=c,p=G();p.companies;const a=x(!1),h=x(!1),s=T({id:null,company_id:"",name:"",start_time:"",end_time:"",description:"",status:"Active"}),_=()=>{a.value=!1,s.id=null,s.company_id="",s.name="",s.start_time="",s.end_time="",s.description="",s.status="Active"};V(()=>i.shift,l=>{l&&typeof l=="object"&&Object.keys(l).length>0?(a.value=!0,s.id=l.id||null,s.company_id=l.company_id||"",s.name=l.name||"",s.start_time=l.start_time||"",s.end_time=l.end_time||"",s.description=l.description||"",s.status=l.status||"Active"):_()},{immediate:!0,deep:!0}),V(()=>i.show,async l=>{l&&!h.value&&await C()});const $=()=>{m("save",{...s}),_(),b()},b=()=>{_(),m("close")},C=async()=>{try{await p.fetchCompanies(),h.value=!0}catch(l){console.error("Failed to fetch companies:",l)}};return(l,o)=>k.show?(d(),r("div",J,[e("div",K,[e("h2",P,u(a.value?"Edit Shift":"Add Shift"),1),e("form",{onSubmit:j($,["prevent"])},[e("div",Q,[o[7]||(o[7]=e("label",{for:"company_id",class:"block text-sm font-medium mb-2"},"Company",-1)),v(e("select",{id:"company_id","onUpdate:modelValue":o[0]||(o[0]=t=>s.company_id=t),class:"w-full border rounded px-3 py-2",required:""},[o[6]||(o[6]=e("option",{value:"",disabled:""},"Select a company",-1)),(d(!0),r(M,null,E(D(p).companies,t=>(d(),r("option",{key:t.id,value:t.id},u(t.name),9,R))),128))],512),[[F,s.company_id]])]),e("div",W,[o[8]||(o[8]=e("label",{for:"name",class:"block text-sm font-medium mb-2"},"Name",-1)),v(e("input",{id:"name","onUpdate:modelValue":o[1]||(o[1]=t=>s.name=t),type:"text",class:"w-full border rounded px-3 py-2",placeholder:"Enter shift name",required:""},null,512),[[w,s.name]])]),e("div",X,[o[9]||(o[9]=e("label",{for:"start_time",class:"block text-sm font-medium mb-2"},"Start Time",-1)),v(e("input",{id:"start_time","onUpdate:modelValue":o[2]||(o[2]=t=>s.start_time=t),type:"time",class:"w-full border rounded px-3 py-2",required:""},null,512),[[w,s.start_time]])]),e("div",Y,[o[10]||(o[10]=e("label",{for:"end_time",class:"block text-sm font-medium mb-2"},"End Time",-1)),v(e("input",{id:"end_time","onUpdate:modelValue":o[3]||(o[3]=t=>s.end_time=t),type:"time",class:"w-full border rounded px-3 py-2",required:""},null,512),[[w,s.end_time]])]),e("div",Z,[o[11]||(o[11]=e("label",{for:"description",class:"block text-sm font-medium mb-2"},"Description",-1)),v(e("textarea",{id:"description","onUpdate:modelValue":o[4]||(o[4]=t=>s.description=t),class:"w-full border rounded px-3 py-2",placeholder:"Enter description (optional)"},null,512),[[w,s.description]])]),e("div",ee,[o[13]||(o[13]=e("label",{for:"status",class:"block text-sm font-medium mb-2"},"Status",-1)),v(e("select",{id:"status","onUpdate:modelValue":o[5]||(o[5]=t=>s.status=t),class:"w-full border rounded px-3 py-2",required:""},o[12]||(o[12]=[e("option",{value:"Active"},"Active",-1),e("option",{value:"Inactive"},"Inactive",-1)]),512),[[F,s.status]])]),e("div",te,[e("button",{type:"button",onClick:b,class:"bg-gray-300 text-gray-700 px-4 py-2 rounded mr-2"}," Cancel "),e("button",se,u(a.value?"Update":"Create"),1)])],32)])])):L("",!0)}},le={class:"my-container space-y-4"},ae={key:0,class:"text-center py-4"},ne={key:1,class:"space-y-4"},ie={class:"title-md"},de={class:"overflow-x-auto"},re={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ce={class:"text-gray-600 text-sm"},ue={class:"py-3 px-2 text-left"},me={class:"py-3 px-2 text-left"},pe={class:"py-3 px-2 text-left"},fe={class:"py-3 px-2 text-center"},ye={class:"py-3 px-2 text-center"},ve={class:"flex item-center justify-center gap-4"},_e=["onClick"],be=["onClick"],$e={__name:"ShiftList",setup(k){const c=q(),i=N(),m=x(!1),p=x(!1),a=x(null),h=()=>{a.value=null,m.value=!0},s=()=>{m.value=!1},_=t=>{a.value=t,m.value=!0},$=t=>{a.value=t,p.value=!0},b=()=>{p.value=!1},C=async t=>{try{t.id?(await c.updateShift(t.id,t),i.success("Shift updated successfully!")):(await c.createShift(t),i.success("Shift added successfully!"))}catch(n){i.error("Failed to save shift!"),console.error("Error handling save:",n)}finally{s()}},l=async()=>{if(!a.value||!a.value.id){i.error("Invalid shift selected for deletion!");return}try{await c.deleteShift(a.value.id),i.success("Shift deleted successfully!")}catch(t){i.error("Failed to delete shift!"),console.error("Error deleting shift:",t)}finally{b()}},o=B(()=>{const t={};return c.shifts.forEach(n=>{var g;const y=((g=n==null?void 0:n.company)==null?void 0:g.name)||"Unknown Company";t[y]||(t[y]=[]),t[y].push(n)}),t});return I(async()=>{try{await c.fetchShifts()}catch(t){i.error("Failed to fetch shifts!"),console.error("Error fetching shifts:",t)}}),(t,n)=>{var y;return d(),r("div",le,[S(z,{title:"Shift List",onAdd:h}),D(c).loading?(d(),r("div",ae,[S(H)])):(d(),r("div",ne,[(d(!0),r(M,null,E(o.value,(g,A)=>(d(),r("div",{key:A},[e("h2",ie,u(A),1),e("div",de,[e("table",re,[n[2]||(n[2]=e("thead",null,[e("tr",{class:"bg-gray-200 text-gray-700 text-sm leading-normal"},[e("th",{class:"py-3 px-2 text-left"},"Name"),e("th",{class:"py-3 px-2 text-left"},"Start Time"),e("th",{class:"py-3 px-2 text-left"},"End Time"),e("th",{class:"py-3 px-2 text-center"},"Status"),e("th",{class:"py-3 px-2 text-center"},"Action")])],-1)),e("tbody",ce,[(d(!0),r(M,null,E(g,f=>(d(),r("tr",{key:f.id,class:"border-b border-gray-200 hover:bg-gray-100"},[e("td",ue,u(f.name),1),e("td",me,u(f.start_time),1),e("td",pe,u(f.end_time),1),e("td",fe,u(f.status),1),e("td",ye,[e("div",ve,[e("button",{onClick:U=>_(f),class:"text-blue-600 hover:text-blue-800"},n[0]||(n[0]=[e("i",{class:"fas fa-edit"},null,-1)]),8,_e),e("button",{onClick:U=>$(f),class:"text-red-600 hover:text-red-800"},n[1]||(n[1]=[e("i",{class:"fas fa-trash"},null,-1)]),8,be)])])]))),128))])])])]))),128))])),S(oe,{show:m.value,shift:a.value,onClose:s,onSave:C},null,8,["show","shift"]),S(O,{show:p.value,title:"Delete Shift",message:`Are you sure you want to delete ${(y=a.value)==null?void 0:y.name}?`,onClose:b,onConfirm:l},null,8,["show","message"])])}}};export{$e as default};
