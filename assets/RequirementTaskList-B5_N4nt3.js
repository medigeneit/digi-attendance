import{L as ie}from"./LoaderView-Ct2SYqoM.js";import{O as F}from"./OverlyModal-D8PqHGcU.js";import{_ as X}from"./DepartmentChip-Di2xOzLY.js";import{_ as ne}from"./TaskAddForm-Cj46Oyzz.js";import{_ as le}from"./TaskEditForm--bvu1xTa.js";import{_ as de}from"./TaskHeader-BMy7kH71.js";import{_ as ue}from"./TaskUserAssignForm-ghhXx-xm.js";import{b as te,m as U,c as i,o as r,g as d,a as e,F as I,y as B,x as V,t as x,k as p,j,p as _,f as T,w as Y,u as me,r as R,d as ce,z as Z,e as pe,A as G,i as N,I as ye}from"./index-Bplul_9Z.js";import{u as fe}from"./task-priority-BIKcPGb-.js";import{u as _e}from"./useRequirementStore-D-WexHhm.js";import{u as ge}from"./useTaskStore-sdaPfQeX.js";import{_ as ke,T as xe,a as ve,b as be}from"./TaskUrgentBadge-DDqQXLB9.js";import{_ as he,a as Te}from"./TaskAssignedUsers-DAaQ-vrI.js";import{T as we}from"./TaskIsClosedBadge-CcCpKaIb.js";import{d as Ce,b as $e}from"./datetime-Efw590t9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-Ct6TYccq.js";import"./company-Ce15nGWu.js";import"./requirement-t9AOzxgw.js";import"./CompanyDepartmentSelectInput-CWRctqF3.js";import"./SelectDropdown-mdf2fRFY.js";import"./SectionLoading-rDdqffeF.js";import"./TextWithHr-6f8ze5bj.js";import"./TaskUrgencyInput-QiggfDg6.js";import"./tags-abeJlwh-.js";import"./MultiselectDropdown-kB_SMcVU.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BWA0Me9q.js";import"./task-DnG21zaU.js";import"./url-CePbr-gY.js";import"./EmployeeDropdownInput-DfoTJhMc.js";import"./UserChip-BmCKFIYy.js";import"./SearchInput-B3hpT_Kt.js";import"./user-D-sZJD9G.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-4BFhqqJi.js";import"./TaskUserChip-CxM2Zxoz.js";import"./TaskTitle-BDtZzzp8.js";const Le={class:"w-full p-1"},qe={key:0,class:"w-full rounded-b"},Ie={class:"group/dept"},Ae={class:"flex gap-1 items-start text-base"},Me={class:"font-bold text-lime-600"},Re={class:"line-clamp-2"},Be={class:"ml-auto"},Se=["onClick"],De={class:"border text-center py-2 px-1 border-gray-200"},ze={key:0,class:"font-semibold text-purple-400 text-sm"},Ee={class:"border px-3 py-1 border-gray-200 relative"},Oe={class:"flex items-center justify-between gap-2"},Pe={class:"flex items-center gap-3 mb-0.5"},Ue={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Ve={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},Fe={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},je={class:"text-xs flex items-center gap-1 text-sky-400 ml-4"},Ne={class:"text-xs flex items-center gap-1 text-sky-400 ml-3"},He=["href","onClick"],Ke={class:"border px-3 py-1 border-gray-200"},Je={class:"flex gap-2 justify-between items-center relative w-full"},Qe={key:0,class:"shrink-0"},We=["href","onClick"],Xe={class:"border px-3 py-1 border-gray-200 text-center"},Ye={key:0,class:"ml-4 text-gray-500 text-sm"},Ze={class:"text-blue-500 font-semibold whitespace-nowrap"},Ge={class:"border px-3 border-gray-200 sticky right-0 border-l bg-gray-50"},et={class:"flex justify-end flex-wrap gap-2 py-2"},ee={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick","clickAddClick"],setup($,{emit:g}){const S=$,u=te(),A=U(()=>S.tasks.reduce((k,o)=>{var C;const w=((C=o.requirement)==null?void 0:C.id)||"-",a=[...k],m=a.find(t=>(t==null?void 0:t.key)==w);return m?m.tasks=[...m.tasks,o]:a.push({key:w,position:o!=null&&o.requirement?0:1,...(o==null?void 0:o.requirement)||{title:"(Other tasks)",id:0},tasks:[o]}),a},[]).sort((k,o)=>k.position-o.position)),f=g;return(k,o)=>{var w;return r(),i("div",Le,[((w=$.tasks)==null?void 0:w.length)>0?(r(),i("table",qe,[o[6]||(o[6]=e("thead",null,[e("tr",null,[e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(r(!0),i(I,null,B(A.value,(a,m)=>{var C;return r(),i(I,{key:a.id},[e("tr",Ie,[e("th",{colspan:"10",class:V(["font-semibold",[(m>0,"")]])},[e("div",{class:V(["text-left -mx-[2px] -mb-[1px] py-2 px-2 flex items-center border border-b-0 rounded-t bg-emerald-50",[a.id===0?"text-gray-500":"text-sky-800",m>0?"mt-4":""]])},[e("div",Ae,[e("div",Me,x(m+1)+".",1),e("p",Re,x(a.title),1)]),e("div",Be,[((C=p(u))==null?void 0:C.name)=="RequirementTaskList"?(r(),i("button",{key:0,onClick:t=>f("clickAddTask",{requirement_id:a==null?void 0:a.id,from_department_id:a==null?void 0:a.from_department_id,to_department_id:a==null?void 0:a.to_department_id},{requirement_id:!0,from_department_id:!0,to_department_id:!0}),class:"btn-2 whitespace-nowrap h-6 px-3 opacity-20 group-hover/dept:opacity-100"},o[0]||(o[0]=[e("i",{class:"fas fa-plus-circle"},null,-1),j(" Add Task ")]),8,Se)):d("",!0)])],2)],2)]),(r(!0),i(I,null,B(a.tasks,(t,D)=>{var M,z;return r(),i("tr",{key:t.id,class:V(["group/sub-task-row",{" bg-green-400/20":t.status=="COMPLETED"," bg-white hover:bg-slate-50":t.status!=="COMPLETED"}])},[e("td",De,[D!==void 0?(r(),i("div",ze,x(m+1)+"."+x(D+1),1)):d("",!0)]),e("td",Ee,[e("div",Oe,[e("div",null,[e("div",Pe,[_(ke,{titleClass:"text-sm",task:t,"sub-tasks-open":!1,isMyTask:p(u).name=="RequirementList",to:$.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",Ue,[e("div",Ve,[o[1]||(o[1]=e("i",{class:"fas fa-clock"},null,-1)),e("span",null,x(p(Ce)(t.created_at)),1)]),e("div",Fe,[t!=null&&t.is_important?(r(),T(xe,{key:0})):d("",!0),t!=null&&t.is_urgent?(r(),T(ve,{key:1})):d("",!0)]),e("div",je,[o[2]||(o[2]=e("i",{class:"fas fa-tasks"},null,-1)),j(" "+x(t==null?void 0:t.todos_count),1)]),e("div",Ne,[o[3]||(o[3]=e("i",{class:"fas fa-book"},null,-1)),j(" "+x((M=t==null?void 0:t.requirement)==null?void 0:M.id),1)])])]),!t.closed_at&&!$.hideButtons?(r(),i("a",{key:0,href:`/tasks/edit/${t.id}`,onClick:Y(L=>f("editClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},o[4]||(o[4]=[e("i",{class:"fas fa-edit"},null,-1)]),8,He)):d("",!0)])]),e("td",Ke,[e("div",Je,[_(he,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:t.users||[],isTargetTask:t.is_target,maxItem:1,"route-to":L=>`/requirement-tasks?status=not-completed&view=userwise&user-ids=${L.id}`},null,8,["users","isTargetTask","route-to"]),t.closed_at?d("",!0):(r(),i("div",Qe,[$.hideButtons?d("",!0):(r(),i("a",{key:0,href:`/tasks/${t.id}/assign-users`,onClick:Y(L=>f("employeeAssignClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},o[5]||(o[5]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,We))]))])]),e("td",Xe,[t.deadline?(r(),i("span",Ye,[e("span",Ze,x(p($e)(t.deadline)),1)])):d("",!0)]),e("td",Ge,[e("div",et,[t.closed_at?(r(),T(we,{key:0})):d("",!0),_(Te,{status:t==null?void 0:t.status,progressPercent:(t==null?void 0:t.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((z=t==null?void 0:t.children_tasks)==null?void 0:z.length)>0?(r(),T(be,{key:1,ref_for:!0,ref:"progress",task:t,class:"text-sm w-full"},null,8,["task"])):d("",!0)])])],2)}),128))],64)}),128))])])):d("",!0)])}}},tt={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},st={class:"mb-4"},rt={key:4,class:"text-center py-4 text-red-500"},ot={class:"relative min-h-[20vh]"},at={key:0,class:"space-y-6"},it={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},nt={class:"font-semibold flex items-center gap-2"},lt={class:"text-white text-base"},dt={class:"rounded-b-md overflow-y-auto"},ut={key:1,class:"space-y-6"},mt={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},ct={class:"font-semibold flex items-center gap-2"},pt={class:"ml-auto"},yt=["onClick"],ft={class:"rounded-b-md overflow-y-auto"},_t={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},Gt={__name:"RequirementTaskList",setup($){const g=ge(),S=_e(),u=te(),A=me(),f=R(""),k=R(null),o=R(!1),w=ce(),a=Z({parentId:0,requirementId:0,params:{}}),m=Z({taskId:0,isOpen:!1}),C=U(()=>{const n=u.query["user-ids"]||null,s=(g.tasks||[]).flatMap(y=>{var v;return n?(v=y.users)==null?void 0:v.filter(O=>n.includes(O.id)):y.users});return[...new Map(s.map(y=>[y.id,y])).values()].sort((y,v)=>y.id-v.id)}),t=U(()=>(g.tasks||[]).reduce((n,s)=>{const b=`${s.from_department_id}-${s.to_department_id}`,y=n.find(v=>v.key==b);return y?y.tasks=[...y.tasks,s]:n.push({key:b,from_department:s.from_department,to_department:s.to_department,tasks:[s]}),n},[])),D=R(null),M=R([]),{saveTaskPriority:z,listHasRearranged:L}=fe(()=>g.taskListTree,0);pe(()=>{console.log("Task List Mounted"),f.value="loading",q()});async function q(){console.log({name:u.name}),u.name=="RequirementTaskList"&&await g.fetchAllTasks({...u.query,page:1}),u.name=="MyRequirementTaskList"&&await g.fetchAllMyTasks({...u.query,page:1}),f.value="",M.value=[]}const E=(n,s)=>{o.value=!0,a.params=n,a.readonlyValues=s},H=n=>{m.taskId=n,m.isOpen=!0};async function K(){k.value=null,o.value=!1,f.value="loading",a.params={},await q()}async function se(){o.value=!1,a.params={},await q()}async function re(){f.value="loading",await z()&&await q()}function oe(n){return g.tasks.filter(s=>(s.users||[]).some(b=>b.id===n))}G(()=>({...u.query}),async()=>{try{g.resetTaskList(),f.value="loading",await q()}catch(n){console.warn(n)}}),G(()=>w.isAdminMood,n=>{n?A.push({name:"RequirementTaskList",query:u.query}):A.push({name:"MyRequirementTaskList",query:u.query})});const J=U({get(){return{...u.query}},set(n){localStorage.removeItem("sub_task_opened_list"),A.push({query:{...n}})}});function ae(n){return{name:"RequirementTaskShow",params:{id:(n==null?void 0:n.id)||0}}}return(n,s)=>{var b,y,v,O,Q;return r(),i("div",tt,[k.value?(r(),T(F,{key:0},{default:N(()=>[_(le,{taskId:k.value,onClose:s[0]||(s[0]=l=>k.value=null),onUpdated:K},null,8,["taskId"])]),_:1})):d("",!0),o.value?(r(),T(F,{key:1},{default:N(()=>{var l,c;return[_(ne,{parentTaskId:a.parentId,requirementId:(l=a.params)==null?void 0:l.requirement_id,requirementDetailId:(c=a.params)==null?void 0:c.requirement_detail_id,"default-values":a.params,"readonly-fields":a.readonlyValues,onClose:se,onTaskCreated:K},null,8,["parentTaskId","requirementId","requirementDetailId","default-values","readonly-fields"])]}),_:1})):d("",!0),m.isOpen?(r(),T(F,{key:2,class:"*:max-w-4xl"},{default:N(()=>[_(ue,{taskId:m.taskId,onCancelClick:s[1]||(s[1]=()=>{m.isOpen=!1,m.taskId=0}),onSuccess:s[2]||(s[2]=()=>{m.isOpen=!1,m.taskId=0,f.value="loading",q()})},null,8,["taskId"])]),_:1})):d("",!0),_(de,{modelValue:J.value,"onUpdate:modelValue":s[3]||(s[3]=l=>J.value=l),onClickAddTask:E,onClickPrioritySave:re,onClickPriorityDiscard:s[4]||(s[4]=()=>p(L)?D.value.resetItems:null),"list-has-rearranged":p(L),isMyTask:p(u).name==="MyRequirementTaskList",class:"mb-4"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((y=(b=p(u))==null?void 0:b.query)==null?void 0:y["query-log"])=="true"?(r(!0),i(I,{key:3},B(M.value,(l,c)=>(r(),i("div",{key:c,class:"text-xs text-gray-500"},[e("div",st,x(l.raw_query),1)]))),128)):d("",!0),p(S).error?(r(),i("div",rt,x(p(S).error),1)):d("",!0),e("div",ot,[((v=p(u).query)==null?void 0:v.view)==="userwise"?(r(),i("div",at,[(r(!0),i(I,null,B(C.value,l=>(r(),i("div",{key:l.id,class:"rounded-md border-2 border-sky-300"},[e("div",it,[e("div",nt,[_(ye,{user:l},null,8,["user"]),e("div",lt,x(l.label),1)])]),e("div",dt,[_(ee,{tasks:oe(l.id),onEditClick:s[5]||(s[5]=c=>k.value=c),onAddClick:s[6]||(s[6]=c=>E(c)),onEmployeeAssignClick:s[7]||(s[7]=c=>H(c)),taskLinkTo:c=>({name:"RequirementTaskShow",params:{id:(c==null?void 0:c.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128))])):(r(),i("div",ut,[(r(!0),i(I,null,B(t.value,l=>{var c,W;return r(),i("div",{key:l.key,class:"rounded-md border-2 border-sky-300"},[e("div",mt,[e("div",ct,[s[11]||(s[11]=e("span",{class:"text-white text-sm"},"From",-1)),_(X,{department:l.from_department},null,8,["department"]),s[12]||(s[12]=e("span",{class:"text-white text-sm"},"To",-1)),_(X,{department:l.to_department},null,8,["department"])]),e("div",pt,[((c=p(u))==null?void 0:c.name)=="RequirementTaskList"?(r(),i("button",{key:0,onClick:()=>{var h,P;return E({from_department_id:(h=l==null?void 0:l.from_department)==null?void 0:h.id,to_department_id:(P=l==null?void 0:l.to_department)==null?void 0:P.id},{from_department_id:!0,to_department_id:!0})},class:"btn-3 h-6 whitespace-nowrap bg-white border-white px-2"}," Add Task ",8,yt)):d("",!0)])]),e("div",ft,[_(ee,{tasks:l.tasks,groupBy:"requirement",onEditClick:s[8]||(s[8]=h=>k.value=h),onClickAddTask:s[9]||(s[9]=(h,P)=>E(h,P)),onEmployeeAssignClick:s[10]||(s[10]=h=>H(h)),hideButtons:((W=p(u))==null?void 0:W.name)!=="RequirementTaskList",taskLinkTo:ae},null,8,["tasks","hideButtons"])])])}),128))])),f.value!=="loading"&&((O=p(g).tasks)==null?void 0:O.length)===0?(r(),i("div",_t," No tasks ")):d("",!0),f.value==="loading"?(r(),T(ie,{key:3,class:V(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((Q=p(g).tasks)==null?void 0:Q.length)===0?"justify-center":""]])},null,8,["class"])):d("",!0)])])}}};export{Gt as default};
