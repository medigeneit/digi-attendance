import{L as H}from"./LoaderView-CWQCGk86.js";import{G as F,r as v,z as I,H as j,p as $,a1 as V,e as A,I as z,c as i,o,a as e,g as p,n as C,w as D,t as _,h as E,v as U,j as L,L as G,b as K,B as O,q as Z,C as J,k as b,y as R,F as S,x as M,i as P}from"./index-CPk8MaBb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const q=F("task-notification",()=>{const u=v([]),n=v(),c=v(!1),w=I({"pending-requirements":0,"pending-tasks":0}),T={"pending-requirements":"ðŸ“œ","pending-tasks":"ðŸ“œ"};async function d(x){var s,a,m;n.value=null,c.value=!0;try{const t=await j.get(`/task-notifications/${x}`);return u.value=(s=t==null?void 0:t.data)==null?void 0:s.notifications,t==null?void 0:t.data}catch(t){throw n.value=((m=(a=t.response)==null?void 0:a.data)==null?void 0:m.message)||"Failed to fetch notifications",t}finally{c.value=!1}}async function h(x,s,a,m){var t,y,g;n.value=null;try{const r=await j.put(`/task-notifications/${x}/${s}/${a}`,{note:m});return u.value=(t=r==null?void 0:r.data)==null?void 0:t.notifications,r==null?void 0:r.data}catch(r){throw n.value=((g=(y=r.response)==null?void 0:y.data)==null?void 0:g.message)||"Failed to update notifications",r}}return{fetchTaskNotification:d,updateNotification:h,loading:c,notifications:u,notification_count:w,error:n,icons:T}}),Q={key:0,class:"font-bold text-lg text-green-600"},W={key:1,class:"btn-2"},X={key:0,class:"text-base"},Y={key:1,class:"btn-1"},ee={class:"modal-card"},te={class:"title-lg"},se=["placeholder","required"],ae={class:"flex"},ne={class:"flex justify-between gap-2 mt-4"},ie={class:"capitalize hidden md:inline"},oe={__name:"ApproveAndReject",props:{notificationType:{type:String,required:!0},applicationId:{type:[String,Number],required:!0},onSuccess:{type:Function,default:null},onSubmit:{type:Function,default:null},variant:{type:Number,default:1}},setup(u){const n=u,c=v(255),w=$(()=>c.value-a.value.length),T=V(),d=q(),h=v(null),x=v(null),s=v(null),a=v(""),m=$(()=>s.value!==null),t=$(()=>s.value==="accept"?"Accept Application":"Reject Application");function y(f){(f==="accept"||f==="reject")&&(s.value=f,a.value="",B())}function g(){s.value=null,a.value=""}async function r(){if(!d.loading){if(s.value==="reject"&&!a.value)return T.error("Rejection Reason is required!");if(typeof n.onSubmit=="function")return n.onSubmit({note:a.value,action:s.value});await d.updateNotification(n.notificationType,n.applicationId,s.value,a.value),n.onSuccess?n.onSuccess():d.fetchTaskNotification(),g()}}function N(f){var l,k;m.value&&(f.key==="ArrowLeft"?(l=x.value)==null||l.focus():f.key==="ArrowRight"&&((k=h.value)==null||k.focus()))}function B(){G(()=>{var f;(f=h.value)==null||f.focus()})}return A(()=>{window.addEventListener("keydown",N)}),z(()=>{window.removeEventListener("keydown",N)}),(f,l)=>(o(),i("div",null,[e("div",{class:C(["flex justify-center items-center",u.variant===1?"gap-5":"gap-2"])},[e("button",{onClick:l[0]||(l[0]=k=>y("accept"))},[u.variant===1?(o(),i("span",Q,"âœ”")):p("",!0),u.variant===2?(o(),i("span",W,l[4]||(l[4]=[e("span",{class:"text-base scale-110"},"âœ”",-1),e("span",{class:"hidden md:inline"},"Approve",-1)]))):p("",!0)]),e("button",{onClick:l[1]||(l[1]=k=>y("reject"))},[u.variant===1?(o(),i("span",X,"âŒ")):p("",!0),u.variant===2?(o(),i("span",Y,l[5]||(l[5]=[e("span",{class:"text-base"},"âŒ",-1),e("span",{class:"hidden md:inline"},"Reject",-1)]))):p("",!0)])],2),m.value?(o(),i("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:D(g,["self"])},[e("div",ee,[e("h3",te,_(t.value),1),e("div",null,[E(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=k=>a.value=k),rows:"7",placeholder:s.value==="accept"?"Accept Note...":"Rejection Reason...",class:"w-full border rounded-lg p-2 text-gray-700",required:s.value==="reject",onInput:l[3]||(l[3]=k=>a.value.length>c.value?a.value=a.value.slice(0,c.value):null)},null,40,se),[[U,a.value]]),e("div",ae,[e("div",{class:C(["ml-auto inline-block text-sm text-gray-500",a.value.length>=c.value?"text-red-500":""])}," left "+_(w.value)+"/"+_(c.value)+" words ",3)])]),e("div",ne,[e("button",{ref_key:"cancelBtnRef",ref:x,class:"btn-3 focus:ring-2 ring-offset-2",onClick:g}," Cancel ",512),e("button",{ref_key:"confirmBtnRef",ref:h,class:C(["focus:ring-2 ring-offset-2",s.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:r},[l[6]||(l[6]=L(" Confirm ")),e("span",ie,_(s.value),1)],2)])])])):p("",!0)]))}},le={class:"my-container space-y-6 px-4 py-4"},re={class:"md:text-2xl font-semibold capitalize text-gray-700"},ce={key:0,class:"ml-auto text-xs bg-red-500 text-white rounded-full px-2 py-0.5 font-semibold"},ue={key:0,class:"text-center text-red-500 py-10 text-xl italic"},de={key:1,class:"space-y-4"},pe={class:"flex gap-2 md:gap-3 items-center"},fe={class:"shrink grow font-semibold text-sm md:text-base"},me=["innerHTML"],ve={class:"ml-auto shrink-0 grow-0 flex gap-2 md:gap-3 items-center"},xe=["innerHTML"],ye={key:0,class:"flex flex-wrap gap-y-1 gap-x-3 items-center text-xs md:text-sm lg:text-base"},ge={key:0},_e={class:"flex gap-3 items-center"},he={class:"flex items-center gap-8"},ke={key:0,class:"flex flex-wrap flex-col md:flex-row gap-x-1 text-xs md:text-sm text-left"},be={key:0,class:"hidden md:inline font-bold"},we=["innerHTML"],Re={__name:"MyTaskNotificationList",setup(u){const n=K(),c=q(),{notifications:w,notification_count:T}=O(c),d=v(!1);A(async()=>{n.params.type&&(d.value=!0,c.fetchTaskNotification(n.params.type),d.value=!1)}),Z(()=>n.params.type,async(s,a)=>{s&&s!==a&&(d.value=!0,c.fetchTaskNotification(s),d.value=!1)});const h=s=>{if(n.params.type=="pending-requirements")return{name:"RequirementShow",params:{id:s.application_id}}},x=$(()=>n.params.type?n.params.type.replace(/[_-]/g," ").replace(/([A-Z])/g," $1").replace(/\s+/g," ").trim().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):"");return(s,a)=>{const m=J("RouterLink");return o(),i("div",le,[e("h2",re,[L(_(x.value||"Notifications")+" ",1),b(T)[b(n).params.type]?(o(),i("span",ce,_(b(T)[b(n).params.type]),1)):p("",!0)]),d.value?(o(),i("div",ue,[R(H)])):b(w).length?(o(),i("div",de,[(o(!0),i(S,null,M(b(w),t=>{var y;return o(),i("div",{key:t.application_id,class:"bg-white p-3 md:p-4 rounded-xl shadow border grid gap-2"},[e("div",pe,[e("div",fe,[e("div",{class:"flex items-center text-green-600 text-xs md:text-sm lg:text-base",innerHTML:t.title},null,8,me),e("div",null,_(t.user_name),1)]),e("div",ve,[R(m,{to:h(t),class:"btn-1 px-3"},{default:P(()=>a[0]||(a[0]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[0]},1032,["to"])])]),e("div",{class:"flex items-center text-red-600 text-xs md:text-sm lg:text-base",innerHTML:t.description},null,8,xe),t.type?(o(),i("div",ye,[t.type?(o(),i("div",ge,[a[1]||(a[1]=e("span",{class:"text-gray-400"},"Type:",-1)),L(" "+_(t.type),1)])):p("",!0)])):p("",!0),e("div",_e,[e("div",he,[(y=t.messages)!=null&&y.length?(o(),i("p",ke,[(o(!0),i(S,null,M(t.messages,(g,r)=>(o(),i(S,{key:r},[r?(o(),i("span",be,"|")):p("",!0),e("span",{innerHTML:g,class:"text-black"},null,8,we)],64))),128))])):p("",!0)]),R(oe,{class:"ml-auto",notificationType:b(n).params.type,applicationId:t==null?void 0:t.application_id,onSuccess:s.onSuccess,variant:2},null,8,["notificationType","applicationId","onSuccess"])])])}),128))])):p("",!0)])}}};export{Re as default};
