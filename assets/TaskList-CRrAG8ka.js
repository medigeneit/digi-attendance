import{_ as ke}from"./CommentModal-oi4XTj1m.js";import{_ as ve,a as be}from"./TaskUserAssignForm-CN_Hnq4S.js";import{L as ge}from"./LoaderView-B-sQaKe1.js";import{O as K}from"./OverlyModal-Bty1CAss.js";import{_ as ne,a as xe}from"./TaskAddForm-DAZs7I4Z.js";import{_ as we}from"./TaskEditForm-X86_rXx2.js";import{D as Ce,d as me,b as pe,q as c,r as D,e as ye,A as X,k as Te,c as i,o as a,a as t,f as g,h as o,w as J,m as L,g as M,C as re,F as P,x as W,t as Z,p as _,l as T,E as Q,v as ie,n as ue,y as ee,u as Ie,G as de}from"./index-CNbbc4fw.js";import{_ as Ae}from"./MultiselectDropdown-BSRrC9Zp.js";import{u as Ve}from"./company-DD8eTCRX.js";import{_ as ce}from"./UserChip-6oOFDuF3.js";import{_ as fe}from"./TaskTreeView-1yMo4Hfs.js";import{u as Le}from"./task-priority-DPOmXdDx.js";import{u as _e}from"./useTaskStore-x_bR5e16.js";import"./useCommentStore-CDEuvcow.js";import"./datetime-q3Sn87-f.js";import"./TaskUrgencyInput-C9sUl0nT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-B-j7flnx.js";import"./useRequirementStore-DdTCcsMU.js";import"./SectionLoading-CgC6tSMj.js";async function qe({params:$={}}={}){return Ce.get("/tasks/employees",{params:$})}const Se={class:"mb-3 task-header"},Ue={class:"flex justify-between items-start mb-4"},$e={key:0,class:"ml-auto flex gap-6 items-center"},Ee={key:0,class:"flex gap-2 items-center"},Me={class:"flex flex-wrap items-center gap-2 mt-3"},De={class:"flex flex-wrap gap-4 w-full"},Pe={class:"relative w-full md:w-64"},Oe=["value"],he={key:1,class:"relative w-full md:w-72"},Be={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Ne={class:"text-gray-600 w-40 relative"},Re={class:"flex gap-4 items-center flex-shrink-0"},Fe={class:"flex gap-2"},He={class:"flex gap-2"},je={class:"flex gap-2"},ze={class:"text-gray-600 w-full md:w-40 relative"},Ge={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-5 gap-2"},We={class:"text-gray-600 w-full md:w-64 lg:w-96 md:ml-auto relative"},Ye={class:"w-full flex justify-end gap-5 mt-4"},Ke={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup($,{emit:v}){const p=$,d=me(),f=pe(),I=c(b("company-id")),q=c(b("from-department-id")),r=c(b("to-department-id")),n=c(b("user-ids")),y=c(b("month")),k=c(b("status")),m=c(b("is-important")),x=c(b("is-urgent")),h=c(b("is-target")),F=c(H()),E=v,V=Ve(),w=D([]);function b(s){return{get:()=>p.modelValue[s]||"",set:e=>{E("update:modelValue",{...p.modelValue,[s]:e||void 0})}}}function H(){let s=0;const e=C=>{E("update:modelValue",{...p.modelValue,search:C||void 0})};return{get:()=>p.modelValue.search||"",set:C=>{clearTimeout(s),s=setTimeout(e,500,C)}}}const B=c(()=>j(n.value));async function N(){var S,U,u;const s=(S=p.modelValue)==null?void 0:S["company-id"],e=r.value,C={...s?{company_id:s}:{},...e?{department_ids:[e]}:{}};w.value=((u=(U=await qe({params:C}))==null?void 0:U.data)==null?void 0:u.employees)||[]}ye(async()=>{await N(),await V.fetchCompanies({with:"departments",ignore_permission:!0})});function j(s){return Array.isArray(w.value)&&w.value.find(e=>e.id==s)||null}function Y(s){n.value=(s==null?void 0:s.id)||""}function z(){n.value=""}const G=c(()=>V==null?void 0:V.companies.filter(s=>s.id==I.value));return X(()=>r.value,N),X(()=>I.value,()=>{r.value!==""?r.value="":N()}),(s,e)=>{var S,U,u,O,A,te,se,le,ae,oe;const C=Te("RouterLink");return a(),i(P,null,[t("div",Se,[t("div",Ue,[e[13]||(e[13]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),((U=(S=o(d))==null?void 0:S.user)==null?void 0:U.role)!=="employee"&&((u=o(d))!=null&&u.isAdminMood)?(a(),i("div",$e,[$.listHasRearranged?(a(),i("div",Ee,[e[12]||(e[12]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=J(l=>E("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=J(l=>E("clickPriorityDiscard"),["prevent"]))},"Discard")])):g("",!0),t("button",{onClick:e[2]||(e[2]=l=>E("clickAddTask")),class:"btn-1"},"Add Task")])):g("",!0)]),t("div",Me,[t("div",De,[t("div",Pe,[e[15]||(e[15]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),M(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>I.value=l),class:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[14]||(e[14]=t("option",{value:""},"--ALL COMPANY--",-1)),(a(!0),i(P,null,W((O=o(V))==null?void 0:O.companies,l=>(a(),i("option",{key:l.id,value:l.id},Z(l.name),9,Oe))),128))],512),[[re,I.value]])]),o(f).name!=="MyTaskList"?(a(),L(ne,{key:0,modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=l=>r.value=l),companies:G.value||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:_(()=>e[16]||(e[16]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):g("",!0),o(d).isAdminMood&&((te=(A=o(d))==null?void 0:A.user)==null?void 0:te.role)!=="employee"?(a(),i("div",he,[T(Ae,{modelValue:B.value,onSelect:Y,onRemove:z,options:w.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full"},{option:_(({option:l})=>[T(ce,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),B.value?(a(),i("div",Be,[t("button",{onClick:J(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):g("",!0),e[17]||(e[17]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):g("",!0),t("div",Ne,[e[19]||(e[19]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),M(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>k.value=l),class:"input-1"},e[18]||(e[18]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[re,k.value]])]),o(f).name!=="MyTaskList"?(a(),L(ne,{key:2,modelValue:q.value,"onUpdate:modelValue":e[6]||(e[6]=l=>q.value=l),companies:((se=o(V))==null?void 0:se.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:_(()=>e[20]||(e[20]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"])):g("",!0),t("div",Re,[t("label",Fe,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>m.value=l)},null,512),[[Q,m.value]]),e[21]||(e[21]=t("span",null,"Important",-1))]),t("label",He,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>x.value=l)},null,512),[[Q,x.value]]),e[22]||(e[22]=t("span",null,"Urgent",-1))]),t("label",je,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=l=>h.value=l)},null,512),[[Q,h.value]]),e[23]||(e[23]=t("span",null,"Is Target",-1))])]),t("div",ze,[e[24]||(e[24]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),M(t("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),type:"month",class:"input-1",placeholder:"All month"},null,512),[[ie,y.value]])])])])]),t("div",Ge,[t("div",We,[e[25]||(e[25]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),M(t("input",{id:"search","onUpdate:modelValue":e[11]||(e[11]=l=>F.value=l),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[ie,F.value]]),e[26]||(e[26]=t("i",{class:"fas fa-search absolute right-2 top-[50%] translate-y-[-50%]"},null,-1))]),t("div",Ye,[o(f).name!=="MyTaskList"?(a(),L(C,{key:0,class:ee(["text-xs sm:text-sm btn-3 py-0.5",((le=o(f).query)==null?void 0:le.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...o(f).query,view:"userwise"}}},{default:_(()=>e[27]||(e[27]=[ue(" User Wise List ")])),_:1,__:[27]},8,["class","to"])):g("",!0),o(f).name!=="MyTaskList"?(a(),L(C,{key:1,class:ee(["text-xs sm:text-sm btn-3 py-0.5",((ae=o(f).query)==null?void 0:ae.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((oe=o(f))==null?void 0:oe.query)||{}).filter(l=>{var R;return((R=o(f))==null?void 0:R.query[l])!=="userwise"}).reduce((l,R)=>({...l,[R]:o(f).query[R]}),{})}}},{default:_(()=>e[28]||(e[28]=[ue(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])):g("",!0)])])],64)}}},Je={class:"w-full bg-white rounded"},Qe=["rowspan"],Xe={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup($,{emit:v}){const p=$,d=v,f=c(()=>p.tasks.reduce((r,n)=>(r.push(...n.users.filter(y=>!r.find(k=>k.id==y.id&&y.id))),r),[]).filter(r=>p.selectedUserId?r.id==p.selectedUserId:!0)),I=r=>p.tasks.filter(k=>k.users.some(m=>m.id===r)),q=c(()=>f.value.map(r=>{const n=I(r.id);return{...r,tasks:n}}));return(r,n)=>(a(),i("div",null,[t("table",Je,[t("tbody",null,[(a(!0),i(P,null,W(q.value,y=>(a(),i(P,{key:y.id},[(a(!0),i(P,null,W(y.tasks,(k,m)=>(a(),i("tr",{key:k.id},[m==0?(a(),i("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(y.tasks.length,1)},[T(ce,{user:y,class:"sticky top-[80px]"},null,8,["user"])],8,Qe)):g("",!0),t("td",{class:ee(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":m==0,"border-b":y.tasks.length-1===m}])},[T(fe,{task:k,class:"!border-0 my-0",index:m,onCommentButtonClick:n[0]||(n[0]=x=>d("commentButtonClick",r.item.id)),onEditClick:n[1]||(n[1]=x=>d("editClick",x)),onAddClick:n[2]||(n[2]=x=>d("addClick",x)),onEmployeeAssignClick:n[3]||(n[3]=x=>d("employeeAssignClick",x))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Ze={class:"container mx-auto p-6 mt-2 relative bg-white rounded-md shadow-md"},et={class:"mb-4"},tt={key:4},st={key:0,class:"text-center py-4 text-red-500"},lt={key:1},at={class:"flex items-stretched"},ot={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},nt=1,Lt={__name:"TaskList",setup($){const v=_e(),p=me(),d=pe(),f=Ie(),I=D(!1),q=D(null),r=c(()=>{var s;return((s=p==null?void 0:p.user)==null?void 0:s.role)==="employee"||!(p!=null&&p.isAdminMood)?!0:!!d.query["user-ids"]}),n=D(null),y=D(!1),k=de({parentId:0,requirementId:0}),m=de({taskId:0,isOpen:!1}),x=D(null),h=D([]),{handleItemsPriorityUpdate:F,saveTaskPriority:E,listHasRearranged:V}=Le(()=>v.taskListTree,0);ye(async()=>{d.query.status||f.push({query:{...d.query,status:"not-completed"}}),await w({loadingBeforeFetch:!0})});async function w({loadingBeforeFetch:s=!1}={}){const e=await v.fetchTasks({...d.query},{newList:!0,loadingBeforeFetch:s});h.value=e.query_log||[]}const b=s=>{y.value=!0,k.parentId=s},H=s=>{m.taskId=s,m.isOpen=!0},B=s=>{q.value=s,I.value=!0},N=()=>{I.value=!1,q.value=null};async function j(){n.value=null,y.value=!1,k.parentId=0,await w()}async function Y(){y.value=!1,k.parentId=0,await w()}async function z(){E()&&await w()}X(()=>({...d.query}),async()=>{await w()});const G=c({get(){return{...d.query}},set(s){localStorage.removeItem("sub_task_opened_list"),f.push({query:{...s}})}});return(s,e)=>{var C,S,U;return a(),i("div",Ze,[n.value?(a(),L(K,{key:0},{default:_(()=>[T(we,{taskId:n.value,onClose:e[0]||(e[0]=u=>n.value=null),onUpdated:j},null,8,["taskId"])]),_:1})):g("",!0),y.value?(a(),L(K,{key:1},{default:_(()=>[T(xe,{parentTaskId:k.parentId,requirementId:k.requirementId,onClose:Y,onTaskCreated:j},null,8,["parentTaskId","requirementId"])]),_:1})):g("",!0),m.isOpen?(a(),L(K,{key:2,class:"*:max-w-4xl"},{default:_(()=>[T(ve,{taskId:m.taskId,onCancelClick:e[1]||(e[1]=()=>{m.isOpen=!1,m.taskId=0}),onSuccess:e[2]||(e[2]=()=>{m.isOpen=!1,m.taskId=0,w()})},null,8,["taskId"])]),_:1})):g("",!0),T(Ke,{modelValue:G.value,"onUpdate:modelValue":e[3]||(e[3]=u=>G.value=u),onClickAddTask:b,onClickPrioritySave:z,onClickPriorityDiscard:e[4]||(e[4]=()=>o(V)?x.value.resetItems:null),"list-has-rearranged":o(V),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((S=(C=o(d))==null?void 0:C.query)==null?void 0:S["query-log"])=="true"?(a(!0),i(P,{key:3},W(h.value,(u,O)=>(a(),i("div",{key:O,class:"text-xs text-gray-500"},[t("div",et,Z(u.raw_query),1)]))),128)):g("",!0),o(v).loading?(a(),i("div",tt,[T(ge)])):(a(),i(P,{key:5},[o(v).error?(a(),i("div",st,Z(o(v).error),1)):o(v).tasks.length>0?(a(),i("div",lt,[((U=o(d).query)==null?void 0:U.view)=="userwise"?(a(),L(Xe,{key:0,tasks:o(v).tasks,selectedUserId:o(d).query["user-ids"],onCommentButtonClick:e[5]||(e[5]=u=>B(u,s.task.id)),onEditClick:e[6]||(e[6]=u=>n.value=u),onAddClick:e[7]||(e[7]=u=>b(u)),onEmployeeAssignClick:e[8]||(e[8]=u=>H(u))},null,8,["tasks","selectedUserId"])):(a(),L(be,{key:1,items:o(v).tasks,handle:"handle",onItemsUpdate:o(F),class:"space-y-4",ref_key:"draggableTaskList",ref:x},{item:_(({item:u,index:O})=>[t("div",at,[T(fe,{task:u,index:O,showDraggableHandle:!r.value,onCommentButtonClick:e[9]||(e[9]=A=>B(A,s.task.id)),onEditClick:e[10]||(e[10]=A=>n.value=A),onAddClick:e[11]||(e[11]=A=>b(A)),onEmployeeAssignClick:e[12]||(e[12]=A=>H(A)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(a(),i("div",ot," No tasks found. "))],64)),T(ke,{show:I.value,"commentable-id":q.value,"commentable-type":"task","user-id":nt,"on-close":N,onSubmitted:o(v).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Lt as default};
