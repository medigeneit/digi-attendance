import{c as o,j as d,o as n,a as e,t as c,d as h,w as I,x as z,r as y,p as Le,i as S,l as C,b as D,k as Oe,v as Be,s as E,C as Ee,h as ae,F as P,g as Ve,e as se,m as K,Q as Fe,y as Me,A as Ue,f as Pe,u as ze,G as ne}from"./index-DPHauDGQ.js";import{L as ue}from"./LoaderView-unxlgxpi.js";import{O as G}from"./OverlyModal-BhyiJmTt.js";import{_ as He}from"./ShareComponent-CoxizGla.js";import{_ as Ae}from"./DepartmentChip-Ca1QD_mj.js";import{_ as Y}from"./DescriptionView-DxmX30x4.js";import{_ as re}from"./UserChip-CFlW2UfS.js";import{r as Ge,c as We,f as de,b as Qe,s as Ke}from"./requirement-C-l37qdO.js";import{o as Ye}from"./url-CePbr-gY.js";import{u as Je}from"./user-MAp0gV1I.js";import{_ as Ar,a as Xe}from"./TaskUserAssignForm-Cea1kQbM.js";import{_ as Ze}from"./TextEditor-BJUi34lg.js";import{u as et}from"./useTaskStore-B92v_u1J.js";import{_ as tt}from"./TaskSelectionInput-Dr74ZQ8G.js";import{_ as st}from"./TaskAddForm-CKo4YIMR.js";import{_ as rt}from"./TaskEditForm-BfFBfGW1.js";import{_ as nt}from"./TaskTableRow-DoJI4Q3d.js";import{T as ie}from"./TextWithHr-CBu70yk5.js";import{d as oe,b as at}from"./datetime-BEfC2TVK.js";import{c as lt}from"./dom-Bic1TNqD.js";import{_ as it}from"./ApproveAndReject-DOPxpljX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-D6MxcWGk.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-BncXGiMj.js";import"./SelectDropdown-C2sTYNCj.js";import"./TaskTitle-CdgNfKqo.js";import"./RequiredIcon-BqcEylnb.js";import"./company-Ca4Sbzlr.js";import"./CompanyDepartmentSelectInput-Da-TPwfF.js";import"./SectionLoading-Caz7xTGr.js";import"./tags-DKDBpNLf.js";import"./MultiselectDropdown-A1IKZPVt.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BVF7xtmr.js";import"./TaskUrgentBadge-B_-M7cFZ.js";import"./TaskAssignedUsers-_sAfztqD.js";import"./TaskIsClosedBadge-CpKFTbz-.js";const ot={key:0,class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},dt={class:"text-sm flex items-center gap-2 text-red-400 font-semibold"},ut={class:"mt-[2px]"},mt={key:0,class:"text-gray-800 flex items-center gap-2"},ct={key:1,class:"text-gray-800 w-full my-2 text-center"},pt={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},vt=["innerHTML"],bt={class:"flex gap-4 items-center justify-center mt-2"},ft={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick"],setup(g,{emit:j}){const a=j;return(p,f)=>{var v;return(v=g.requirement)!=null&&v.closed_at?(n(),o("div",ot,[f[5]||(f[5]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",dt,[f[1]||(f[1]=e("span",{class:"fad fa-lock"},null,-1)),f[2]||(f[2]=e("span",{class:"mt-[2px]"},"CLOSED AT",-1)),e("span",ut,c(new Date(g.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),g.requirement.closed_by_user?(n(),o("div",mt,[f[3]||(f[3]=e("span",{class:"text-sm"},"Closed by",-1)),h(re,{user:g.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):d("",!0),g.requirement.closing_note?(n(),o("div",ct,[f[4]||(f[4]=e("div",{class:"text-x"},"Closing Note",-1)),e("div",pt,[e("p",{innerHTML:g.requirement.closing_note},null,8,vt)])])):d("",!0),e("div",bt,[e("button",{class:"btn-2 h-8",onClick:f[0]||(f[0]=I(m=>a("reOpenClick"),["prevent"]))},"Re Open")])])):d("",!0)}}},xt={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},yt={class:"my-6"},gt={class:"text-center font-semibold text-blue-800 mb-4"},_t={class:"text-center my-1"},kt={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},wt={class:"mt-4"},ht=["placeholder","required"],qt={class:"flex"},$t={class:"text-red-600 text-center mt-2 text-sm"},Ct={class:"flex justify-between mt-3"},Tt={class:"btn-2"},Rt={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(g,{emit:j}){const a=g,p=j,f=z({get:()=>a.loading,set:()=>p("update:loading")}),v=y(""),m=y(""),x=y(255),t=z(()=>x.value-v.value.length);async function R(){var i,r,l;f.value=!0;try{(i=a.requirement)!=null&&i.closed_at?await Ge(a.requirement.id,v.value):await We(a.requirement.id,v.value),p("updateStatus")}catch(u){m.value=(l=(r=u.response)==null?void 0:r.data)==null?void 0:l.message,p("error")}finally{f.value=!1}}return(i,r)=>{var u,_,$,q,N;const l=Le("LoaderView");return n(),o("form",{class:"p-4 rounded relative border",onSubmit:I(R,["prevent"])},[f.value?(n(),S(l,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:C(()=>r[3]||(r[3]=[D(" Submitting! ")])),_:1,__:[3]})):d("",!0),e("h3",xt,c((u=g.requirement)!=null&&u.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",yt,[e("div",gt,c((_=g.requirement)==null?void 0:_.title),1),r[6]||(r[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",_t,[r[4]||(r[4]=D(" Want to ")),e("span",kt,c(($=g.requirement)!=null&&$.closed_at?"Re-Open":"Close"),1),r[5]||(r[5]=D(" the requirement? "))]),e("div",wt,[Oe(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=k=>v.value=k),rows:"4",placeholder:`Write about why are you ${(q=g.requirement)!=null&&q.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:i.currentAction==="reject",onInput:r[1]||(r[1]=k=>v.value.length>x.value?v.value=v.value.slice(0,x.value):null)},null,40,ht),[[Be,v.value]]),e("div",qt,[e("div",{class:E(["ml-auto inline-block text-sm text-gray-500",v.value.length>=x.value?"text-red-500":""])}," left "+c(t.value)+"/"+c(x.value)+" words ",3)])])]),r[7]||(r[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",$t,c(m.value),1),e("div",Ct,[e("button",{class:"btn-3",onClick:r[2]||(r[2]=I(k=>p("clickCancel"),["prevent"]))},"Cancel"),e("button",Tt,c((N=g.requirement)!=null&&N.closed_at?"Re-Open":"Close"),1)])])],32)}}};async function St(g,j,{params:a={}}={}){return Ee.get(`/requirements/${g}/details/${j}`,{params:a})}async function jt(g,j,{params:a={}}={}){const p=Ye(a);return Ee.delete(`/requirements/${g}/details/${j}${p?"?"+p:""}`)}const It={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Nt={class:"mb-4"},At={class:"font-semibold"},Dt={class:"mb-4"},Lt={class:"line-clamp-2"},Ot={key:1,class:"min-h-40"},Bt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Et={key:0,class:"mb-4 text-red-500 font-medium"},Vt={key:1,class:"mb-4"},Mt={class:"flex items-center justify-between gap-4"},Ut=["disabled"],Ft={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(g,{emit:j}){const a=g,p=j,f=Je(),v=y(null),m=y(""),x=y(),t=y([]);async function R(){var i,r;m.value="submitting";try{const l=await jt(a.requirementId,a.detailId);p("delete",l),m.value="create"}catch(l){m.value="error",x.value=((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to update requirement detail: "+l,p("error",x.value)}}return ae(async()=>{var i,r,l;m.value="loading";try{t.value=await f.fetchDepartmentWiseEmployees(),v.value=(i=(await St(a.requirementId,a.detailId)).data)==null?void 0:i.detail}catch(u){x.value=((l=(r=u.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to fetch requirement detail"}finally{m.value=""}}),(i,r)=>{var l,u;return n(),o("div",It,[r[4]||(r[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:I(R,["prevent"]),class:"z-0"},[m.value!=="loading"?(n(),o(P,{key:0},[e("div",Nt,[r[1]||(r[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",At,c((l=v.value)==null?void 0:l.title),1)]),e("div",Dt,[r[2]||(r[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",Lt,c((u=v.value)==null?void 0:u.description),1)]),r[3]||(r[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),o("div",Ot)),e("div",Bt,[x.value?(n(),o("div",Et,c(x.value),1)):d("",!0),x.value?(n(),o("hr",Vt)):d("",!0),e("div",Mt,[e("button",{type:"button",onClick:r[0]||(r[0]=I(_=>p("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:m.value=="loading"||m.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},c(m.value=="submitting"?"Deleting...":"Delete"),9,Ut)])])],32),m.value==="loading"||m.value==="submitting"?(n(),S(ue,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):d("",!0)])}}};const Pt={class:"sticky top-0 pt-4 bg-white z-10"},zt={class:"mb-4"},Ht={class:"mb-4"},Gt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Wt={key:0,class:"mb-4 text-red-500 font-medium"},Qt={key:1,class:"mb-4"},Kt={class:"flex items-center justify-between gap-4"},Yt=["disabled"],Jt={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(g,{emit:j}){const a=g,p=j,f=y(),v=y(null),m=y(""),x=y(),t=y({feedback:""});async function R(){var i,r;m.value="submitting";try{const l=await Qe(a.requirementId,t.value.feedback);p("update",l),m.value="create"}catch(l){m.value="error",x.value=((r=(i=l.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to update requirement requirement",p("error",x.value)}}return ae(async()=>{var i,r,l,u;m.value="loading";try{await de(a.requirementId),v.value=(i=(await de(a.requirementId)).data)==null?void 0:i.requirement,t.value={feedback:(r=v.value)==null?void 0:r.feedback}}catch(_){x.value=((u=(l=_.response)==null?void 0:l.data)==null?void 0:u.message)||"Failed to fetch requirement requirement"}finally{m.value=""}}),(i,r)=>{var l;return n(),o("div",{ref_key:"formContainerRef",ref:f,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Pt,[r[3]||(r[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),r[4]||(r[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=I(u=>p("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:I(R,["prevent"]),class:"z-0"},[m.value!=="loading"?(n(),o(P,{key:0},[e("div",zt,[r[5]||(r[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),h(Y,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:C(()=>{var u;return[D(c((u=v.value)==null?void 0:u.title),1)]}),_:1})]),e("div",Ht,[r[6]||(r[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),h(Ze,{modelValue:t.value.feedback,"onUpdate:modelValue":r[1]||(r[1]=u=>t.value.feedback=u)},null,8,["modelValue"])])],64)):d("",!0),e("div",Gt,[x.value?(n(),o("div",Wt,c(x.value),1)):d("",!0),x.value?(n(),o("hr",Qt)):d("",!0),e("div",Kt,[e("button",{type:"button",onClick:r[2]||(r[2]=I(u=>p("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:m.value=="loading"||m.value=="submitting",type:"submit",class:"btn-2"},c(m.value=="submitting"?"Saving...":(l=v.value)!=null&&l.feedback?"Update Feedback":"Add Feedback"),9,Yt)])])],32),m.value==="loading"||m.value==="submitting"?(n(),S(ue,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):d("",!0)],512)}}},Xt={class:"flex justify-center items-center"},Zt={class:"modal-card"},es=["required"],ts={class:"flex"},ss={class:"flex justify-between gap-2 mt-4"},rs=["disabled"],ns=["disabled"],as={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(g,{emit:j}){const a=g,p=j,f=y(255),v=z(()=>f.value-i.value.length),m=Fe(),x=y(null),t=y(null),R=y(null),i=y(""),r=y(!1),l=z(()=>R.value!==null);function u(k){R.value=k,i.value="",N()}function _(){R.value=null,i.value=""}async function $(){var k,T;if(R.value==="reject"&&!i.value)return m.error("Rejection Reason is required!");if(typeof a.onSubmit=="function")return a.onSubmit({note:i.value,action:R.value});p("loading",!0),r.value=!0;try{await Ke(a.requirementId,{note:i.value}),p("success"),_()}catch(A){return p("error",A),m.error(((T=(k=A==null?void 0:A.response)==null?void 0:k.data)==null?void 0:T.message)||"Submission failed!")}finally{p("loading",!1),r.value=!1}}function q(k){var T,A;l.value&&(k.key==="ArrowLeft"?(T=t.value)==null||T.focus():k.key==="ArrowRight"&&((A=x.value)==null||A.focus()))}function N(){Ue(()=>{var k;(k=x.value)==null||k.focus()})}return ae(()=>{window.addEventListener("keydown",q)}),Me(()=>{window.removeEventListener("keydown",q)}),(k,T)=>(n(),o("div",null,[e("div",Xt,[e("button",{onClick:T[0]||(T[0]=A=>u("accept"))},T[3]||(T[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),l.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:I(_,["self"])},[e("div",Zt,[T[4]||(T[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Oe(e("textarea",{"onUpdate:modelValue":T[1]||(T[1]=A=>i.value=A),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:R.value==="reject",onInput:T[2]||(T[2]=A=>i.value.length>f.value?i.value=i.value.slice(0,f.value):null)},null,40,es),[[Be,i.value]]),e("div",ts,[e("div",{class:E(["ml-auto inline-block text-sm text-gray-500",i.value.length>=f.value?"text-red-500":""])}," left "+c(v.value)+"/"+c(f.value)+" words ",3)])]),e("div",ss,[e("button",{ref_key:"cancelBtnRef",ref:t,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:_,disabled:r.value}," Cancel ",8,rs),e("button",{ref_key:"confirmBtnRef",ref:x,class:E(["focus:ring-2 ring-offset-2 disabled:opacity-30",R.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:$,disabled:r.value}," Confirm Submission ",10,ns)])])])):d("",!0)]))}},ls={class:"flex items-center gap-6 justify-center my-16"},is={key:0,class:"border rounded-md"},os={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(g,{emit:j}){const a=g,p=j,f=et(),v=y(""),m=y(null),x=y(""),t=y(!1);async function R(){await f.setTaskRequirement(x.value,a.requirement.id),p("assignTask")}return(i,r)=>(n(),o("div",{class:E(["text-left p-4",[v.value&&!m.value?"min-h-[400px]":""]])},[e("div",ls,[e("button",{onClick:r[0]||(r[0]=I(l=>p("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),r[5]||(r[5]=e("span",null,"or",-1)),e("button",{class:E({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:r[1]||(r[1]=I(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value&&!m.value?(n(),o("div",is,[e("form",{onSubmit:I(R,["prevent"]),class:"p-4 flex items-end"},[h(tt,{class:"flex-grow mr-4 h-12",taskId:x.value,"onUpdate:taskId":r[2]||(r[2]=l=>x.value=l),show:t.value,"onUpdate:show":r[3]||(r[3]=l=>t.value=l),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":g.fromDepartmentId},filterTasks:l=>!l.requirement_id,onAddNewTaskClick:r[4]||(r[4]=l=>p("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),r[6]||(r[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):d("",!0)],2))}},ds={class:"flex flex-col items-center gax-x-1 justify-end"},us={key:0},ms={key:1},cs={class:"text-sm text-gray-600 whitespace-normal w-64"},ps={class:"text-gray-900 font-semibold text-sm md:text-base"},vs={class:"ml-2"},bs={key:0,class:"text-red-700 text-sm"},fs={key:1,class:"text-green-600 ml-2"},xs={key:2,class:"ml-2 text-yellow-700"},De={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(g,{emit:j}){const a=g,p=j,f=Ve(),v=z(()=>{var i,r,l,u,_;return{from_in_charge:!!((i=a.requirement)!=null&&i.status&&((r=a.requirement)!=null&&r.submission_date)),from_coordinator:!!((l=a.requirement)!=null&&l.from_coordinator),to_in_charge:!!((u=a.requirement)!=null&&u.to_incharge),to_coordinator:!!((_=a.requirement)!=null&&_.to_coordinator)}}),m=z(()=>{var i,r,l,u,_,$,q,N;return{from_in_charge:(r=(i=a.requirement)==null?void 0:i.from_department)==null?void 0:r.in_charge,from_coordinator:(u=(l=a.requirement)==null?void 0:l.from_department)==null?void 0:u.coordinator,to_in_charge:($=(_=a.requirement)==null?void 0:_.to_department)==null?void 0:$.in_charge,to_coordinator:(N=(q=a.requirement)==null?void 0:q.to_department)==null?void 0:N.coordinator}}),x=z(()=>{var u;const i=Object.keys(v.value),r=i.indexOf(a.approvalType);let l=!0;for(let _=r-1;_>=0;_--){const $=i[_];l=l&&(m.value[$]?(u=v.value)==null?void 0:u[$]:!0)}return l}),t=z(()=>{var $,q,N,k,T,A,le,w,W,Q,M,L,s,H,U,F;let i=null,r=null,l="",u="";a.approvalType==="from_in_charge"&&(i=($=a.requirement)==null?void 0:$.from_department,r=(N=(q=a.requirement)==null?void 0:q.from_department)==null?void 0:N.in_charge,l="In Charge",u=(k=a.requirement)==null?void 0:k.from_incharge_note),a.approvalType==="from_coordinator"&&(i=(T=a.requirement)==null?void 0:T.from_department,r=(A=a.requirement)==null?void 0:A.from_coordinator,l="Coordinator",u=(le=a.requirement)==null?void 0:le.from_coordinator_note),a.approvalType==="to_in_charge"&&(i=(w=a.requirement)==null?void 0:w.to_department,r=(W=a.requirement)==null?void 0:W.to_in_charge,l="In Charge",u=(Q=a.requirement)==null?void 0:Q.to_incharge_note),a.approvalType==="to_coordinator"&&(i=(M=a.requirement)==null?void 0:M.to_department,r=(L=a.requirement)==null?void 0:L.to_coordinator,l="Coordinator",u=(s=a.requirement)==null?void 0:s.to_coordinator_note);const _=(H=m.value)==null?void 0:H[a.approvalType];return{department:i,department_user:_,approved:(U=v.value)==null?void 0:U[a.approvalType],approval_user:r,is_rejected:((F=a.requirement)==null?void 0:F.rejected_by_user_id)==(_==null?void 0:_.id),userType:l,approval_note:u}});function R(){p("updateApproval")}return(i,r)=>{var l,u,_,$,q,N;return n(),o("div",ds,[t.value.department_user?(n(),o("div",us,[h(re,{user:t.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),o("div",ms,r[0]||(r[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",cs,[t.value.is_rejected?(n(),S(Y,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:C(()=>[D(c(g.requirement.rejection_reason),1)]),_:1})):(n(),S(Y,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:C(()=>[D(c(t.value.approval_note),1)]),_:1}))]),e("div",null,[!t.value.is_rejected&&!t.value.approved&&x.value&&((l=K(f).user)==null?void 0:l.id)==((_=(u=t.value)==null?void 0:u.department_user)==null?void 0:_.id)?(n(),S(it,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:($=a.requirement)==null?void 0:$.id,onSuccess:R,variant:1},null,8,["applicationId"])):d("",!0)]),r[2]||(r[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",ps,[e("span",null,c(((q=t.value.department)==null?void 0:q.short_name)||((N=t.value.department)==null?void 0:N.name)),1),e("span",vs,c(t.value.userType),1),t.value.department_user?(n(),o(P,{key:0},[t.value.is_rejected?(n(),o("span",bs," (Rejected)")):t.value.approved?(n(),o("span",fs,"(âœ”)")):(n(),o("span",xs,r[1]||(r[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):d("",!0)])])}}},ys={class:"container mx-auto print:p-0 w-full print:max-w-full"},gs={class:"border-b px-4 py-2 bg-gray-50 flex items-center justify-between rounded-t-md"},_s={key:0},ks={class:"border table-auto w-full"},ws={class:"border-y px-4 py-1"},hs={class:"border-y px-4 py-1"},qs={class:"border-y px-4 py-1 text-center"},$s={class:"border-y px-4 py-1 text-center"},Cs={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},Ts={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},Rs={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},Ss={class:"text-center text-xl font-bold mb-2 flex items-center"},js={class:"mb-8"},Is={class:"text-lg font-semibold mb-2"},Ns={class:"flex gap-4 items-center text-gray-500"},As={class:"text-sm"},Ds={key:0,class:"flex items-center gap-1"},Ls={key:0,class:"mb-5"},Os=["innerHTML"],Bs={class:"mb-8"},Es={class:"font-semibold text-lg px-2"},Vs={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},Ms={class:"w-full border-collapse"},Us={key:0},Fs={class:"mb-8"},Ps={class:"font-semibold text-lg px-2"},zs={key:0},Hs=["innerHTML"],Gs={key:1,class:"text-center my-2 text-gray-400"};const Ws={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Qs={class:"flex flex-col items-end"},Ks={key:2,class:"mt-6 mb-8 break-before-avoid-page"},Ys={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},Js={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},Xs={class:"bg-white shadow rounded-lg space-y-4 p-4"},Zs={class:"border col-span-3 p-3 rounded-md"},er={class:"flex items-center gap-2 mb-4"},tr={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},sr={class:"flex items-center gap-2 mb-4"},rr={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},nr={class:"font-bold print:text-gray-900"},ar={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},lr={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},ir={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},or={class:"print:text-gray-900 text-sm text-right"},dr={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},ur={class:"print:text-gray-900 text-sm text-right"},mr={class:"flex justify-between items-center mb-4"},cr={class:"mb-6"},pr={class:"flex justify-between items-center"},vr={key:1,class:"text-red-600"},br={key:0,class:"mb-2"},fr={class:"flex justify-end text-sky-500"},xr={key:1,class:"text-right w-full mb-4"},yr={key:2,class:"mb-6"},gr={class:"flex justify-between items-center"},_r={key:3,class:"text-center mb-4 text-red-700 mt-8 text-sm"},kr={key:5,class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},an={__name:"RequirementShow",setup(g){const j=Pe(),a=ze(),p=y(""),f=Ve(),v=y(),m=y(!1),x=y(),t=y(null),R=ne({detail:null,open:!1}),i=ne({detail:null,open:!1}),r=ne({detail:null,open:!1}),l=y(!1),u=()=>l.value=!0,_=()=>l.value=!1,$=y(),q=y({isOpen:!1,taskId:null});ae(async()=>{await k(),window.addEventListener("beforeprint",u),window.addEventListener("afterprint",_),window.addEventListener("resize",N),await Ue(),lt(v.value,()=>{})});function N(){}Me(()=>{window.removeEventListener("beforeprint",u),window.removeEventListener("afterprint",_),window.removeEventListener("resize",N)});async function k(){var L;p.value="loading",t.value=(L=(await de(j.params.id)).data)==null?void 0:L.requirement,p.value=""}function T(){var L,s,H,U,F,J,X,Z,ee;if(f.user.role!=="super_admin"&&((L=f.user)==null?void 0:L.id)!==((H=(s=t.value)==null?void 0:s.to_department)==null?void 0:H.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(F=(U=t.value)==null?void 0:U.to_department)==null?void 0:F.name}'s In charge can create or assign.`);console.log({requirement:t}),w.modalShown=!0,w.from_department_id=t.value.from_department_id,w.to_department_id=t.value.to_department_id,w.taskDefaultValues={title:"",description:"",from_department_id:t.value.from_department_id,to_department_id:t.value.to_department_id,is_important:((J=t.value)==null?void 0:J.priority)=="IMPORTANT",is_urgent:((X=t.value)==null?void 0:X.priority)=="URGENT",supervisor_ids:(Z=t.value)!=null&&Z.supervisor_id?[(ee=t.value)==null?void 0:ee.supervisor_id]:[]},w.requirement=t.value}function A(L){R.open=!0,R.detail=L}function le(L){r.open=!0,r.detail=L}const w=ne({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function W(){$.value=null,w.modalShown=!1,await k()}async function Q(){w.modalShown=!1,w.requirement=null,w.creating=!1}const M=y({open:!1});return(L,s)=>{var U,F,J,X,Z,ee,me,ce,pe,ve,be,fe,xe,ye,ge,_e,ke,we,he,qe,$e,Ce,Te,Re,Se,je,Ie,Ne;const H=Le("RouterLink");return n(),o("div",ys,[i.open?(n(),S(G,{key:0},{default:C(()=>{var b;return[h(Jt,{requirementId:t.value.id,detailId:(b=i.requirement.value)==null?void 0:b.id,onCloseClick:s[0]||(s[0]=B=>i.open=!1),onUpdate:s[1]||(s[1]=async()=>{i.open=!1,await k()})},null,8,["requirementId","detailId"])]}),_:1})):d("",!0),r.open?(n(),S(G,{key:1},{default:C(()=>{var b;return[h(Ft,{requirementId:t.value.id,detailId:(b=r.requirement.value)==null?void 0:b.id,onCloseClick:s[2]||(s[2]=B=>r.open=!1),onDelete:s[3]||(s[3]=async()=>{r.open=!1,await k()})},null,8,["requirementId","detailId"])]}),_:1})):d("",!0),w.modalShown?(n(),S(G,{key:2,class:"*:relative"},{default:C(()=>{var b,B;return[e("button",{onClick:I(Q,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},s[20]||(s[20]=[e("i",{class:"fas fa-times-circle"},null,-1)])),w!=null&&w.creating?d("",!0):(n(),S(os,{key:0,"from-department-id":(b=t.value)==null?void 0:b.from_department_id,requirement:w==null?void 0:w.requirement,onCancelClick:Q,onAddNewTaskClick:s[4]||(s[4]=()=>{w.modalShown=!0,w.creating=!0}),onAssignTask:W},null,8,["from-department-id","requirement"])),w!=null&&w.creating?(n(),S(st,{key:1,requirementDetailId:(B=w==null?void 0:w.requirement.value)==null?void 0:B.id,requirementId:t.value.id,onClose:Q,onTaskCreated:W,defaultValues:w.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):d("",!0)]}),_:1})):d("",!0),$.value?(n(),S(G,{key:3},{default:C(()=>[h(rt,{taskId:$.value,onClose:s[5]||(s[5]=b=>$.value=null),onUpdated:W},null,8,["taskId"])]),_:1})):d("",!0),q.value.isOpen?(n(),S(G,{key:4,class:"*:max-w-4xl"},{default:C(()=>[h(Xe,{taskId:q.value.taskId,onCancelClick:s[6]||(s[6]=()=>{q.value.isOpen=!1,q.value.taskId=0}),onSuccess:s[7]||(s[7]=()=>{q.value.isOpen=!1,q.value.taskId=0,p.value="loading",k()})},null,8,["taskId"])]),_:1})):d("",!0),M.value.open?(n(),S(G,{key:5},{default:C(()=>[h(Rt,{requirement:t.value,onClickCancel:s[8]||(s[8]=b=>M.value.open=!1),onUpdateStatus:s[9]||(s[9]=()=>{k(),M.value.open=!1})},null,8,["requirement"])]),_:1})):d("",!0),m.value?(n(),S(G,{key:6},{default:C(()=>{var b,B,V,te;return[e("div",gs,[s[22]||(s[22]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon",onClick:s[10]||(s[10]=I(O=>m.value=!1,["prevent"]))},s[21]||(s[21]=[e("i",{class:"fas fa-times"},null,-1)]))]),(b=t.value)!=null&&b.closing_history&&((V=(B=t.value)==null?void 0:B.closing_history)!=null&&V.length)?(n(),o("div",_s,[e("table",ks,[s[23]||(s[23]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Close/Open")])],-1)),e("tbody",null,[(n(!0),o(P,null,se(((te=t.value)==null?void 0:te.closing_history)||[],O=>(n(),o("tr",{key:O.at},[e("td",ws,c(O.at?K(oe)(O.at):""),1),e("td",hs,c(O==null?void 0:O.closing_note),1),e("td",qs,c(O==null?void 0:O.status),1),e("td",$s,c(O==null?void 0:O.type),1)]))),128))])])])):d("",!0)]}),_:1})):d("",!0),e("div",Cs,[t.value?(n(),o("div",Ts,[e("div",Rs,[e("div",Ss,[e("button",{class:"btn-3 h-8 px-4",onClick:s[11]||(s[11]=I(()=>K(a).back(),["prevent"]))},"Back"),s[24]||(s[24]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),s[38]||(s[38]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",js,[e("div",null,[e("div",Is,[h(Y,{"line-clamp":"3",class:"mb-2"},{default:C(()=>[D(c(t.value.title),1)]),btnText:C(({lineClampClass:b})=>[D(c(b?"More":"Less"),1)]),_:1}),e("div",Ns,[e("div",As,[s[25]||(s[25]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),D(" "+c(K(oe)(t.value.created_at)),1)]),t.value.created_by?(n(),o("div",Ds,[s[26]||(s[26]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),h(re,{"avatar-size":"xsmall",user:t.value.created_by,class:"border-sky-300"},null,8,["user"])])):d("",!0)])]),t.value.description?(n(),o("div",Ls,[s[27]||(s[27]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),h(Y,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:C(()=>[e("p",{innerHTML:t.value.description,class:"text-justify"},null,8,Os)]),_:1})])):d("",!0)])]),e("div",Bs,[h(ie,{class:"mb-4"},{default:C(()=>[e("h2",Es,[s[28]||(s[28]=e("span",null,"Task List ",-1)),t.value.status=="approved"?(n(),o("span",{key:0,class:E(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":t.value.tasks_count>0&&t.value.completed_tasks_count==t.value.tasks_count,"text-red-700 font-semibold":t.value.tasks_count==0||t.value.completed_tasks_count!=t.value.tasks_count}]])}," ("+c(t.value.completed_tasks_count)+"/"+c(t.value.tasks_count)+" task(s) done) ",3)):d("",!0)])]),_:1}),e("div",Vs,[e("table",Ms,[s[30]||(s[30]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[p.value!="loading"&&((F=(U=t.value)==null?void 0:U.tasks)==null?void 0:F.length)===0?(n(),o("tr",Us,s[29]||(s[29]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),o(P,{key:1},se(((J=t.value)==null?void 0:J.tasks)||[],(b,B)=>(n(),S(nt,{key:b.id,task:b,indexing:B+1,class:"*:py-3 *:border-b-0",onEditClick:s[12]||(s[12]=V=>$.value=V),onEmployeeAssignClick:s[13]||(s[13]=V=>{q.value.isOpen=!0,q.value.taskId=V})},null,8,["task","indexing"]))),128))])])])]),e("div",Fs,[h(ie,{class:"mb-4"},{default:C(()=>{var b,B,V,te;return[e("h2",Ps," '"+c(((B=(b=t.value)==null?void 0:b.to_department)==null?void 0:B.short_name)||((te=(V=t.value)==null?void 0:V.to_department)==null?void 0:te.name))+"' Feedback ",1)]}),_:1}),e("div",{class:E(["px-3 border border-dashed rounded-lg border-sky-600",[(X=t.value)!=null&&X.feedback?"py-3":"py-8"]]),colspan:"5"},[p.value!="loading"&&((Z=t.value)!=null&&Z.status)?(n(),o("div",zs,[String(((ee=t.value)==null?void 0:ee.feedback)||"").trim().length>0?(n(),S(Y,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:C(()=>{var b;return[e("p",{class:"text-sm text-justify",innerHTML:(b=t.value)==null?void 0:b.feedback},null,8,Hs)]}),_:1})):(n(),o("div",Gs,"No Feedback")),e("div",{class:E([((me=t.value)!=null&&me.feedback,"w-full flex justify-center")])},[t.value.closed_at?d("",!0):(n(),o("button",{key:0,class:"btn-3 print:hidden",onClick:s[14]||(s[14]=I(()=>{i.open=!0,i.requirement=t.value},["prevent"]))},c(t.value.feedback?"Update Feedback":"Add feedback"),1))],2)])):d("",!0)],2)]),(t.value,d("",!0)),p.value!="loading"&&!((ce=t.value)!=null&&ce.status)?(n(),o("div",Ws,[e("div",Qs,[h(as,{"requirement-id":(pe=t.value)==null?void 0:pe.id,onSuccess:k},{heading:C(()=>s[34]||(s[34]=[D(" Requirement Submission ")])),acceptButtonLabel:C(()=>s[35]||(s[35]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),D("Submit Requirement ")],-1)])),submitButtonLabel:C(()=>s[36]||(s[36]=[D(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):d("",!0),(ve=t.value)!=null&&ve.status?(n(),o("div",Ks,[h(ie,null,{default:C(()=>s[37]||(s[37]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[37]}),e("div",Ys,[(n(),o(P,null,se(["from_in_charge","from_coordinator"],b=>h(De,{class:"pt-12",key:b,requirement:t.value,"approval-type":b,onUpdateApproval:s[15]||(s[15]=()=>k())},null,8,["requirement","approval-type"])),64))]),((be=t.value)==null?void 0:be.from_department_id)!==((fe=t.value)==null?void 0:fe.to_department_id)?(n(),o("div",Js,[(n(),o(P,null,se(["to_in_charge","to_coordinator"],b=>h(De,{class:"pt-12",key:b,requirement:t.value,"approval-type":b,onUpdateApproval:s[16]||(s[16]=()=>k())},null,8,["requirement","approval-type"])),64))])):d("",!0)])):d("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:v},[e("div",Xs,[e("div",Zs,[e("div",null,[e("div",er,[s[39]||(s[39]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),h(Ae,{department:(xe=t.value)==null?void 0:xe.from_department,"short-name":!0},null,8,["department"])]),s[40]||(s[40]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",tr,[(ye=t.value)!=null&&ye.supervisor?(n(),S(re,{key:0,user:(ge=t.value)==null?void 0:ge.supervisor},null,8,["user"])):d("",!0)])]),s[42]||(s[42]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",sr,[s[41]||(s[41]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),h(Ae,{department:(_e=t.value)==null?void 0:_e.to_department,"short-name":!0},null,8,["department"])])])]),e("div",rr,[s[43]||(s[43]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",nr,c((ke=t.value)==null?void 0:ke.id),1)]),((he=(we=t.value)==null?void 0:we.website_tags)==null?void 0:he.length)>0?(n(),o("div",ar,[s[44]||(s[44]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",lr,[(n(!0),o(P,null,se(((qe=t.value)==null?void 0:qe.website_tags)||[],b=>(n(),o("div",{key:b.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},c(b.name),1))),128))])])):d("",!0),($e=t.value)!=null&&$e.submission_date?(n(),o("div",ir,[s[45]||(s[45]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",or,c(K(oe)((Ce=t.value)==null?void 0:Ce.submission_date)),1)])):d("",!0),(Te=t.value)!=null&&Te.better_to_complete_on?(n(),o("div",dr,[s[46]||(s[46]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",ur,c(K(at)((Re=t.value)==null?void 0:Re.better_to_complete_on,{weekDay:"long"})),1)])):d("",!0),e("div",null,[e("div",mr,[s[47]||(s[47]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:E(["font-semibold text-sm",{"text-yellow-600 ":t.value.priority=="IMPORTANT","text-red-700 ":t.value.priority=="URGENT"}])},c(t.value.priority||"NORMAL"),3)])]),e("div",cr,[e("div",pr,[s[48]||(s[48]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),t.value.status?(n(),o("span",{key:0,class:E(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":t.value.status!="approved","bg-green-300 text-green-700 border-green-400":t.value.status=="approved"}])},c(String(t.value.status).toUpperCase()),3)):(n(),o("span",vr,"..."))])]),t.value.closed_at?d("",!0):(n(),o("div",br,[e("div",fr,[e("button",{class:"btn-1 border border-sky-800",onClick:s[17]||(s[17]=I(b=>M.value.open=!0,["prevent"]))}," Close Requirement ")])])),((je=(Se=t.value)==null?void 0:Se.closing_history)==null?void 0:je.length)>1?(n(),o("div",xr,[e("button",{onClick:s[18]||(s[18]=b=>m.value=!m.value),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):d("",!0),t.value.rejected_by?(n(),o("div",yr,[e("div",gr,[s[49]||(s[49]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),h(re,{user:t.value.rejected_by},null,8,["user"])])])):d("",!0),t.value.rejection_reason?(n(),o("div",_r,[s[50]||(s[50]=e("p",{class:"text-gray-600 mb-1 italic"},"Reason",-1)),e("p",null,c(t.value.rejection_reason),1)])):d("",!0),s[53]||(s[53]=e("hr",{class:"mb-3"},null,-1)),(Ie=t.value)!=null&&Ie.closed_at?(n(),S(ft,{key:4,requirement:t.value,onReOpenClick:s[19]||(s[19]=b=>M.value.open=!0)},null,8,["requirement"])):(n(),o("div",kr,[t.value.status=="approved"?(n(),o("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:I(T,["prevent"])},s[51]||(s[51]=[e("i",{class:"fas fa-plus text-sm"},null,-1),D(" Add/Assign Task ")]))):d("",!0),h(H,{class:"btn-2 h-8",to:`/requirements/edit/${(Ne=t.value)==null?void 0:Ne.id}`},{default:C(()=>s[52]||(s[52]=[D(" Edit ")])),_:1,__:[52]},8,["to"])]))])]),h(He,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3 md:sticky",ref_key:"shareComponent",ref:x},null,512)],512)])):d("",!0),p.value==="loading"?(n(),S(ue,{key:1,class:"absolute inset-0 bg-opacity-90"})):d("",!0)])])}}};export{an as default};
