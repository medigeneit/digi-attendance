import{L as U,u as K,b as O,x as v,z as V,r as h,e as R,M as I,A as T,m as q,c as m,o as p,a as t,n as w,t as o,i as L,j as y,h as z,v as $,g,q as k,w as P}from"./index-DT7IHcEh.js";import{_ as G}from"./TextEditor-AyA5l7Om.js";import{u as H}from"./monthly-assessment-criteria-D3woYMXm.js";const J={class:"my-container mx-auto max-w-4xl px-4 py-6"},Q={class:"mb-6 flex items-center justify-between"},W={class:"text-xl font-semibold text-gray-900"},X={class:"grid gap-6"},Y=["aria-invalid","aria-describedby"],Z={class:"mt-1 flex items-center justify-between"},ee={key:0,id:"name-error",class:"text-sm text-red-600"},te={class:"ml-auto text-right text-xs text-gray-500"},se={class:"flex items-center gap-3"},ie=["aria-pressed"],ae=["value"],ne={key:0,class:"mt-1 text-sm text-red-600"},oe={class:"rounded-lg overflow-hidden border border-gray-300"},re={key:0,class:"mt-1 text-sm text-red-600"},le={class:"mt-8 flex items-center justify-end gap-3"},de=["disabled"],ce={key:0,class:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none"},C=120,ve={__name:"KpiFormatForm",setup(ue){const f=U(),j=K(),B=O(),d=H(),x=v(()=>{var i;const a=(i=B.params)==null?void 0:i.id,e=Number(a);return Number.isFinite(e)&&e>0?e:null}),r=v(()=>!!x.value),s=V({name:"",description:"",is_active:1}),c=h(!1),u=h(!1),n=V({name:"",description:"",is_active:""}),b=v(()=>s.name.trim().length),S=v(()=>!c.value&&b.value>0&&b.value<=C);function E(){for(const a of Object.keys(n))n[a]=""}function M(){return{name:s.name.trim(),description:(s.description||"").trim(),is_active:Number(s.is_active??0)}}async function F(){var a,e;if(r.value){u.value=!0,E();try{const i=typeof d.fetchOne=="function"?await d.fetchOne(x.value):null;i&&(s.name=i.name??"",s.description=i.description??"",s.is_active=Number(i.is_active??0))}catch(i){f.error(((e=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to load item")}finally{u.value=!1}}}async function N(){var a;if(S.value){c.value=!0,E();try{r.value?(await d.updateCriteria(x.value,M()),f.success("Criteria updated successfully")):(await d.createCriteria(M()),f.success("Criteria created successfully")),await d.fetchList(),j.replace("/kpi/monthly-format-list")}catch(e){const i=(a=e==null?void 0:e.response)==null?void 0:a.data;if(i!=null&&i.errors)for(const[l,_]of Object.entries(i.errors))n[l]=Array.isArray(_)?_[0]:String(_);f.error((i==null?void 0:i.message)||(r.value?"Failed to update criteria":"Failed to create criteria")),console.error(e)}finally{c.value=!1}}}function A(a){(a.ctrlKey||a.metaKey)&&a.key==="Enter"&&(a.preventDefault(),N())}R(()=>{window.addEventListener("keydown",A),F()}),I(()=>window.removeEventListener("keydown",A));const D=h(!1);return T(()=>[s.name,s.description,s.is_active],()=>D.value=!0),(a,e)=>{const i=q("RouterLink");return p(),m("div",J,[t("div",Q,[t("h1",W,o(r.value?"Edit Monthly Assessment Criteria":"Create Monthly Assessment Criteria"),1),w(i,{to:"/kpi/monthly-format-list",class:"inline-flex items-center rounded-lg border px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:L(()=>e[3]||(e[3]=[y(" Back to list ")])),_:1,__:[3]})]),t("form",{onSubmit:P(N,["prevent"]),class:"card-bg rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",novalidate:""},[t("div",X,[t("div",null,[e[4]||(e[4]=t("label",{for:"name",class:"mb-1 block text-sm font-medium text-gray-700"},[y(" Name "),t("span",{class:"text-red-500"},"*")],-1)),z(t("input",{id:"name","onUpdate:modelValue":e[0]||(e[0]=l=>s.name=l),type:"text",maxlength:C,"aria-invalid":!!n.name,"aria-describedby":n.name?"name-error":void 0,class:"w-full rounded-lg border px-3 py-2 outline-none transition border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",placeholder:"e.g., Punctuality and Attendance",required:""},null,8,Y),[[$,s.name,void 0,{trim:!0}]]),t("div",Z,[n.name?(p(),m("p",ee,o(n.name),1)):g("",!0),t("p",te,o(b.value)+" / "+o(C),1)])]),t("div",null,[e[5]||(e[5]=t("label",{class:"mb-1 block text-sm font-medium text-gray-700"},[y(" Status "),t("span",{class:"text-red-500"},"*")],-1)),t("div",se,[t("button",{type:"button","aria-pressed":s.is_active===1,onClick:e[1]||(e[1]=l=>s.is_active=s.is_active===1?0:1),class:k(["relative inline-flex h-6 w-11 items-center rounded-full transition bg-gray-300",s.is_active===1?"bg-green-500":""])},[t("span",{class:k(["inline-block h-5 w-5 transform rounded-full bg-white shadow transition",s.is_active===1?"translate-x-5":"translate-x-1"])},null,2)],10,ie),t("span",{class:k(["text-sm font-medium",s.is_active===1?"text-green-700":"text-gray-600"])},o(s.is_active===1?"Active":"Inactive"),3),t("input",{type:"hidden",name:"is_active",value:s.is_active},null,8,ae)]),n.is_active?(p(),m("p",ne,o(n.is_active),1)):g("",!0)]),t("div",null,[e[6]||(e[6]=t("label",{for:"description",class:"mb-1 block text-sm font-medium text-gray-700"}," Description / Criteria Details ",-1)),t("div",oe,[w(G,{id:"description",modelValue:s.description,"onUpdate:modelValue":e[2]||(e[2]=l=>s.description=l),class:"w-full"},null,8,["modelValue"])]),n.description?(p(),m("p",re,o(n.description),1)):g("",!0)])]),t("div",le,[w(i,{to:"/kpi/monthly-format-list",class:"inline-flex items-center rounded-lg border px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:L(()=>e[7]||(e[7]=[y(" Cancel ")])),_:1,__:[7]}),t("button",{type:"submit",disabled:!S.value||u.value,class:"inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 disabled:opacity-50 disabled:cursor-not-allowed"},[c.value||u.value?(p(),m("svg",ce,e[8]||(e[8]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",opacity:"0.25"},null,-1),t("path",{d:"M22 12a10 10 0 0 1-10 10",stroke:"currentColor","stroke-width":"4"},null,-1)]))):g("",!0),t("span",null,o(c.value||u.value?r.value?"Updating...":"Saving...":r.value?"Update":"Save"),1)],8,de)])],32)])}}};export{ve as default};
