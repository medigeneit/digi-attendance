import{L as re}from"./LoaderView-B2QIsCRQ.js";import{O as D}from"./OverlyModal-Um6DQShP.js";import{_ as W}from"./DepartmentChip-90wdsvQ8.js";import{_ as ie}from"./TaskAddForm-C4OIgQNi.js";import{_ as ne}from"./TaskEditForm-CEFLMVfX.js";import{_ as le}from"./TaskHeader-CPe7i0R3.js";import{a as de}from"./TaskUserAssignForm-DFyqFOlE.js";import{f as ee,x as E,p as ue,c as n,o,j as f,a as s,F as C,e as M,s as N,i as L,t as q,l as O,b as X,m as p,u as me,r as B,g as ce,G as Y,h as pe,q as Z,d as v,M as ke}from"./index-Bn8VUdIu.js";import{u as ye}from"./task-priority-CBb_zJdJ.js";import{u as fe}from"./useRequirementStore-C5TCoLdb.js";import{u as _e}from"./useTaskStore-D5M8QlaT.js";import{_ as ge}from"./TaskTableRow-C5ecRVfI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-BCmGySpR.js";import"./company-Za1C5fpF.js";import"./requirement-9PuPnGLI.js";import"./CompanyDepartmentSelectInput-BgyPOoOB.js";import"./SelectDropdown-AIroYaNd.js";import"./SectionLoading-gmDezzdw.js";import"./TextWithHr-U0mb7LBW.js";import"./TaskUrgencyInput-b-9It5Db.js";import"./datetime-BEfC2TVK.js";import"./tags-dAQx8HGv.js";import"./MultiselectDropdown-88qMnZ7w.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-JlkJpiw2.js";import"./task-tIBjm1xR.js";import"./url-CePbr-gY.js";import"./EmployeeDropdownInput-C2wrfI83.js";import"./UserChip-Ctr9xMKt.js";import"./SearchInput-ZKww3jPi.js";import"./user-C88-N-Ir.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-CkAbkHx4.js";import"./TaskUrgentBadge-DWLxQpzu.js";import"./TaskTitle-ZpekRA9q.js";import"./TaskAssignedUsers-DKYABK4I.js";import"./TaskIsClosedBadge-C8phgn8N.js";const ve={class:"w-full p-1"},xe={key:0,class:"w-full rounded-b"},be={class:"group/dept"},he={class:"flex gap-1 items-start text-base"},Te={class:"font-bold text-lime-600"},we={key:0},Le={class:"ml-auto"},Ce=["onClick"],G={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick","clickAddClick"],setup($,{emit:k}){const S=$,l=ee(),A=E(()=>S.tasks.reduce((y,a)=>{var _;const T=((_=a.requirement)==null?void 0:_.id)||"-",u=[...y],t=u.find(x=>(x==null?void 0:x.key)==T);return t?t.tasks=[...t.tasks,a]:u.push({key:T,position:a!=null&&a.requirement?0:1,...(a==null?void 0:a.requirement)||{title:"(Other tasks)",id:0},tasks:[a]}),u},[]).sort((y,a)=>y.position-a.position)),c=k;return(y,a)=>{var u;const T=ue("RouterLink");return o(),n("div",ve,[((u=$.tasks)==null?void 0:u.length)>0?(o(),n("table",xe,[a[3]||(a[3]=s("thead",null,[s("tr",null,[s("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),s("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),s("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),s("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),s("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),s("tbody",null,[(o(!0),n(C,null,M(A.value,(t,_)=>{var x;return o(),n(C,{key:t.id},[s("tr",be,[s("th",{colspan:"10",class:N(["font-semibold",[(_>0,"")]])},[s("div",{class:N(["text-left -mx-[2px] -mb-[1px] py-2 px-2 flex items-center border border-b-0 rounded-t bg-emerald-50",[t.id===0?"text-gray-500":"text-sky-800",_>0?"mt-4":""]])},[s("div",he,[s("div",Te,q(_+1)+".",1),t.id===0?(o(),n("p",we,q(t.title),1)):(o(),L(T,{key:1,to:`requirements/show/${t.id}`,class:"line-clamp-2 hover:underline"},{default:O(()=>[X(q(t.title),1)]),_:2},1032,["to"]))]),s("div",Le,[((x=p(l))==null?void 0:x.name)=="RequirementTaskList"?(o(),n("button",{key:0,onClick:I=>c("clickAddTask",{requirement_id:t==null?void 0:t.id,from_department_id:t==null?void 0:t.from_department_id,to_department_id:t==null?void 0:t.to_department_id},{requirement_id:!0,from_department_id:!0,to_department_id:!0}),class:"btn-2 whitespace-nowrap h-6 px-3 opacity-70 group-hover/dept:opacity-100"},a[2]||(a[2]=[s("i",{class:"fas fa-plus-circle"},null,-1),X(" Add Task ")]),8,Ce)):f("",!0)])],2)],2)]),(o(!0),n(C,null,M(t.tasks,(I,V)=>(o(),L(ge,{key:I.id,task:I,indexing:`${_+1}.${V+1}`,onEditClick:a[0]||(a[0]=R=>c("editClick",R)),onEmployeeAssignClick:a[1]||(a[1]=R=>c("employeeAssignClick",R)),taskLinkTo:$.taskLinkTo,hideButtons:$.hideButtons},null,8,["task","indexing","taskLinkTo","hideButtons"]))),128))],64)}),128))])])):f("",!0)])}}},qe={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},$e={class:"mb-4"},Ae={key:4,class:"text-center py-4 text-red-500"},Ie={class:"relative min-h-[20vh]"},Re={key:0,class:"space-y-6"},Be={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},Me={class:"font-semibold flex items-center gap-2"},Se={class:"text-white text-base"},Ve={class:"rounded-b-md overflow-y-auto"},ze={key:1,class:"space-y-6"},Fe={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},Ue={class:"font-semibold flex items-center gap-2"},Ee={class:"ml-auto"},Oe=["onClick"],De={class:"rounded-b-md overflow-y-auto"},Ne={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},Lt={__name:"RequirementTaskList",setup($){const k=_e(),S=fe(),l=ee(),A=me(),c=B(""),y=B(null),a=B(!1),T=ce(),u=Y({parentId:0,requirementId:0,params:{}}),t=Y({taskId:0,isOpen:!1}),_=E(()=>{const r=l.query["user-ids"]||null,e=(k.tasks||[]).flatMap(m=>{var g;return r?(g=m.users)==null?void 0:g.filter(F=>r.includes(F.id)):m.users});return[...new Map(e.map(m=>[m.id,m])).values()].sort((m,g)=>m.id-g.id)}),x=E(()=>(k.tasks||[]).reduce((r,e)=>{const b=`${e.from_department_id}-${e.to_department_id}`,m=r.find(g=>g.key==b);return m?m.tasks=[...m.tasks,e]:r.push({key:b,from_department:e.from_department,to_department:e.to_department,tasks:[e]}),r},[])),I=B(null),V=B([]),{saveTaskPriority:R,listHasRearranged:P}=ye(()=>k.taskListTree,0);pe(()=>{console.log("Task List Mounted"),c.value="loading",w()});async function w(){console.log({name:l.name}),l.name=="RequirementTaskList"&&await k.fetchAllTasks({...l.query,page:1}),l.name=="MyRequirementTaskList"&&await k.fetchAllMyTasks({...l.query,page:1}),c.value="",V.value=[]}const z=(r,e)=>{a.value=!0,u.params=r,u.readonlyValues=e},j=r=>{t.taskId=r,t.isOpen=!0};async function H(){y.value=null,a.value=!1,c.value="loading",u.params={},await w()}async function te(){a.value=!1,u.params={},await w()}async function se(){c.value="loading",await R()&&await w()}function ae(r){return k.tasks.filter(e=>(e.users||[]).some(b=>b.id===r))}Z(()=>({...l.query}),async()=>{try{k.resetTaskList(),c.value="loading",await w()}catch(r){console.warn(r)}}),Z(()=>T.isAdminMood,r=>{r?A.push({name:"RequirementTaskList",query:l.query}):A.push({name:"MyRequirementTaskList",query:l.query})});const K=E({get(){return{...l.query}},set(r){localStorage.removeItem("sub_task_opened_list"),A.push({query:{...r}})}});function oe(r){return{name:"RequirementTaskShow",params:{id:(r==null?void 0:r.id)||0}}}return(r,e)=>{var b,m,g,F,J;return o(),n("div",qe,[y.value?(o(),L(D,{key:0},{default:O(()=>[v(ne,{taskId:y.value,onClose:e[0]||(e[0]=i=>y.value=null),onUpdated:H},null,8,["taskId"])]),_:1})):f("",!0),a.value?(o(),L(D,{key:1},{default:O(()=>{var i,d;return[v(ie,{parentTaskId:u.parentId,requirementId:(i=u.params)==null?void 0:i.requirement_id,requirementDetailId:(d=u.params)==null?void 0:d.requirement_detail_id,"default-values":u.params,"readonly-fields":u.readonlyValues,onClose:te,onTaskCreated:H},null,8,["parentTaskId","requirementId","requirementDetailId","default-values","readonly-fields"])]}),_:1})):f("",!0),t.isOpen?(o(),L(D,{key:2,class:"*:max-w-4xl"},{default:O(()=>[v(de,{taskId:t.taskId,onCancelClick:e[1]||(e[1]=()=>{t.isOpen=!1,t.taskId=0}),onSuccess:e[2]||(e[2]=()=>{t.isOpen=!1,t.taskId=0,c.value="loading",w()})},null,8,["taskId"])]),_:1})):f("",!0),v(le,{modelValue:K.value,"onUpdate:modelValue":e[3]||(e[3]=i=>K.value=i),onClickAddTask:z,onClickPrioritySave:se,onClickPriorityDiscard:e[4]||(e[4]=()=>p(P)?I.value.resetItems:null),"list-has-rearranged":p(P),isMyTask:p(l).name==="MyRequirementTaskList",class:"mb-4"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((m=(b=p(l))==null?void 0:b.query)==null?void 0:m["query-log"])=="true"?(o(!0),n(C,{key:3},M(V.value,(i,d)=>(o(),n("div",{key:d,class:"text-xs text-gray-500"},[s("div",$e,q(i.raw_query),1)]))),128)):f("",!0),p(S).error?(o(),n("div",Ae,q(p(S).error),1)):f("",!0),s("div",Ie,[((g=p(l).query)==null?void 0:g.view)==="userwise"?(o(),n("div",Re,[(o(!0),n(C,null,M(_.value,i=>(o(),n("div",{key:i.id,class:"rounded-md border-2 border-sky-300"},[s("div",Be,[s("div",Me,[v(ke,{user:i},null,8,["user"]),s("div",Se,q(i.label),1)])]),s("div",Ve,[v(G,{tasks:ae(i.id),onEditClick:e[5]||(e[5]=d=>y.value=d),onAddClick:e[6]||(e[6]=d=>z(d)),onEmployeeAssignClick:e[7]||(e[7]=d=>j(d)),taskLinkTo:d=>({name:"RequirementTaskShow",params:{id:(d==null?void 0:d.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128))])):(o(),n("div",ze,[(o(!0),n(C,null,M(x.value,i=>{var d,Q;return o(),n("div",{key:i.key,class:"rounded-md border-2 border-sky-300"},[s("div",Fe,[s("div",Ue,[e[11]||(e[11]=s("span",{class:"text-white text-sm"},"From",-1)),v(W,{department:i.from_department},null,8,["department"]),e[12]||(e[12]=s("span",{class:"text-white text-sm"},"To",-1)),v(W,{department:i.to_department},null,8,["department"])]),s("div",Ee,[((d=p(l))==null?void 0:d.name)=="RequirementTaskList"?(o(),n("button",{key:0,onClick:()=>{var h,U;return z({from_department_id:(h=i==null?void 0:i.from_department)==null?void 0:h.id,to_department_id:(U=i==null?void 0:i.to_department)==null?void 0:U.id},{from_department_id:!0,to_department_id:!0})},class:"btn-3 h-6 whitespace-nowrap bg-white border-white px-2"}," Add Task ",8,Oe)):f("",!0)])]),s("div",De,[v(G,{tasks:i.tasks,groupBy:"requirement",onEditClick:e[8]||(e[8]=h=>y.value=h),onClickAddTask:e[9]||(e[9]=(h,U)=>z(h,U)),onEmployeeAssignClick:e[10]||(e[10]=h=>j(h)),hideButtons:((Q=p(l))==null?void 0:Q.name)!=="RequirementTaskList",taskLinkTo:oe},null,8,["tasks","hideButtons"])])])}),128))])),c.value!=="loading"&&((F=p(k).tasks)==null?void 0:F.length)===0?(o(),n("div",Ne," No tasks ")):f("",!0),c.value==="loading"?(o(),L(re,{key:3,class:N(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((J=p(k).tasks)==null?void 0:J.length)===0?"justify-center":""]])},null,8,["class"])):f("",!0)])])}}};export{Lt as default};
