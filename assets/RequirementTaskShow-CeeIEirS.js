import{m as R,r as Y,n as gt,c as i,o as a,f as S,g as p,a as e,i as $,j as C,t as h,w as j,d as xt,z as Q,F as N,y as X,x as K,b as Et,u as At,e as Mt,A as pt,p as v,k as n,G as Rt,R as mt,I as jt}from"./index-C2qI2jOf.js";import{L as ft}from"./LoaderView-D_-D8Yer.js";import{O as J}from"./OverlyModal-BRRchmTG.js";import{_ as kt}from"./DepartmentChip-BqGFjdan.js";import{_ as yt}from"./DescriptionView-DBYc4BBb.js";import{_ as _t,a as Lt}from"./TaskAssignedUsers-C6h92zf1.js";import{u as Ot}from"./task-D5YlBcxJ.js";import{_ as Ut,a as Nt,b as Pt}from"./TaskStatusManager-iPn42UwT.js";import{_ as Bt}from"./TodoItemCard-BXnsrehw.js";import{b as W,d as Vt}from"./datetime-Efw590t9.js";import{s as vt}from"./dom-BKn8Ftnz.js";import{u as Gt}from"./useTaskStore-xnPbKtJo.js";import{u as qt}from"./useTodoDateStore-BbiEnS8N.js";import{_ as zt}from"./TodoCreateEditShow-c2amYBaQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-DgQOZDrF.js";import"./url-CePbr-gY.js";import"./requirement-DCWnpv2d.js";import"./useTodoStore-O6xrEI0C.js";import"./TaskSelectionInput-DnKZI99y.js";import"./TaskTitle-Cb_U8wAY.js";const Ft={class:"my-6"},Ht={class:"text-center font-semibold text-blue-800 mb-4"},Wt={class:"text-red-600 text-center mt-2 text-sm"},Kt={class:"flex justify-between mt-3"},Jt={__name:"TaskClosingForm",props:{loading:{type:Boolean,default:!1},task:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(G,{emit:s}){const d=G,D=s,u=R({get:()=>d.loading,set:()=>D("update:loading")}),w=Y("");async function g(){var x,r;u.value=!0;try{await Ot(d.task.id,{status:"CLOSED"}),D("updateStatus")}catch(T){w.value=(r=(x=T.response)==null?void 0:x.data)==null?void 0:r.message,D("error")}finally{u.value=!1}}return(x,r)=>{var P;const T=gt("LoaderView");return a(),i("form",{class:"p-4 rounded relative border",onSubmit:j(g,["prevent"])},[u.value?(a(),S(T,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:$(()=>r[1]||(r[1]=[C(" Submitting! ")])),_:1,__:[1]})):p("",!0),r[5]||(r[5]=e("h3",{class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},"Task Closing",-1)),e("div",Ft,[e("div",Ht,h((P=G.task)==null?void 0:P.title),1),r[2]||(r[2]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),r[3]||(r[3]=e("div",{class:"text-center my-1"},[C(" Want to "),e("span",{class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},[e("i",{class:"text-sm fas fa-lock text-blue-600"}),C("Close")]),C(" the task? ")],-1))]),r[6]||(r[6]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",Wt,h(w.value),1),e("div",Kt,[e("button",{class:"btn-3",onClick:r[0]||(r[0]=j(m=>D("clickCancel"),["prevent"]))},"Cancel"),r[4]||(r[4]=e("button",{class:"btn-2"},[e("i",{class:"text-xl text-white fas fa-lock"}),C(" Close")],-1))])])],32)}}},Qt={class:"border-gray-300"},Xt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Yt={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Zt={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},It={key:0,class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-2 justify-between"},te={key:0},ee=["disabled"],se=["disabled"],ae={class:"text-base font-semibold text-gray-700"},oe={__name:"TaskTimeline",props:{task:{type:Object}},emits:["updateStatus","error"],setup(G,{emit:s}){const d=G,D=xt(),u=Q({user:null,type:""});function w(m){u.user=D.user,u.type=m}const g={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},x=R(()=>(g==null?void 0:g[T.value])||0),r=R(()=>{var m;return{"bg-yellow-50":T.value==="IN_PROGRESS","bg-green-50":T.value==="COMPLETED","bg-red-50":T.value==="PENDING","bg-blue-50":(m=d.task)==null?void 0:m.closed_at}}),T=R(()=>{var m;return(m=d.task)==null?void 0:m.status}),P=R(()=>{var m,f,L,k,B,O,A,_;return[{date:W((m=d.task)==null?void 0:m.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((f=d.task)!=null&&f.assigned_at)},{date:W((L=d.task)==null?void 0:L.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((k=d.task)!=null&&k.started_at)||x.value>=g.IN_PROGRESS},{date:W((B=d.task)==null?void 0:B.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((O=d.task)!=null&&O.completed_at)||x.value>=g.COMPLETED},{date:W((A=d.task)==null?void 0:A.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((_=d.task)!=null&&_.deadline)}].sort((U,V)=>U.date===null||V.date===null||new Date(U.date)==new Date(V.date)?U.serial-V.serial:new Date(U.date)-new Date(V.date))});return(m,f)=>{var L;return a(),i("div",{class:K(["border py-8 px-4 rounded",r.value])},[e("div",Qt,[(L=d.task)!=null&&L.is_target?(a(),i("div",Xt,f[2]||(f[2]=[e("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),C(" TARGET TASK ")]))):p("",!0),e("ol",Yt,[(a(!0),i(N,null,X(P.value,(k,B)=>{var O,A;return a(),i("li",{class:"ml-5",key:B},[e("div",Zt,[k.active?(a(),i("i",{key:0,class:K([k.icon,"text-xs"])},null,2)):p("",!0)]),e("div",{class:K({"opacity-30":!k.active})},[k.active?(a(),i("div",It,[k.date?(a(),i("span",te,h(k.date),1)):p("",!0),((O=d.task)==null?void 0:O.children_task_count)===0&&k.status==="started"&&k.active?(a(),i("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:f[0]||(f[0]=j(()=>w("start-date"),["prevent"])),disabled:!!d.task.closed_at},h(k.date?"Edit":"Set Date"),9,ee)):p("",!0),((A=d.task)==null?void 0:A.children_task_count)===0&&k.active&&k.status==="completed"?(a(),i("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:f[1]||(f[1]=j(()=>w("finish-date"),["prevent"])),disabled:!!d.task.closed_at},h(k.date?"Edit":"Set Date"),9,se)):p("",!0)])):p("",!0),e("h3",ae,h(k.title),1)],2)])}),128))])])],2)}}},ne={class:"container mx-auto px-4"},le={key:3,class:"w-full xl:max-w-8xl min-h-64 mx-auto relative"},ie={key:0,class:"text-sm mb-4 border-b","aria-label":"Breadcrumb"},re={class:"flex items-center gap-2"},de={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},ue=["title"],ce={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},pe={class:"grid grid-cols-12 gap-x-4 gap-y-3"},me={class:"col-span-full md:col-span-7 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},fe={class:"font-medium text-md flex items-start gap-2"},ke={class:"mt-2 col-span-full flex items-center"},ye={class:"text-gray-400 text-xs"},_e={class:"flex items-center gap-0.5"},ve={class:"text-sky-400 text-sm font-semibold"},ge=["innerHTML"],xe={class:"flex justify-between items-end mt-6 mb-2"},be={key:0,class:"border flex items-center justify-center h-96 rounded bg-gray-50 text-sm italic"},he={class:"text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 border-b py-2 px-4 flex items-center"},Ce={class:"font-semibold flex items-center gap-2"},we={class:"text-white text-base"},Te={class:"col-span-full md:col-span-5 xl:col-span-4 2xl:col-span-3 space-y-4 sticky top-[74px] bg-white shadow rounded-lg p-4 pb-0"},Se={class:"border col-span-3 p-3 rounded-md"},$e={class:"flex items-center gap-2 mb-4"},De={class:"flex items-center gap-2 mb-4"},Ee={key:0,class:"flex items-center gap-4 flex-wrap justify-between col-span-3 sticky bottom-0 bg-white"},Ae=["disabled"],Me={key:0,class:"flex items-start justify-center !text-lg mb-4"},Re={key:2,class:"py-4 flex items-center justify-between"},je={key:3,class:"h-1"},Le={key:2},Oe={key:1,class:"text-center py-4 text-red-500"},as={__name:"RequirementTaskShow",setup(G){const s=Gt(),d=xt(),D=qt(),u=Et(),w=At(),g=Y(""),x=Q({open:!1,task:null}),r=Q({open:!1,task:null});function T(){x.open=!0,x.task=s.task}function P(){r.open=!0,r.task=s.task}Mt(async()=>{g.value="loading";try{await f(u.params.id)}catch(o){o.response.status===404&&w.push({name:"RequirementTaskList"})}g.value="",u.hash=="#sub-tasks"&&setTimeout(()=>vt(u.hash,66),0)});const m=Q({user:null,type:""});async function f(o){await s.fetchTask(o,{with_todos:"true"})}async function L(){await f(u.params.id),m.user=null,m.type=""}const k=o=>{w.push({name:"TaskEdit",params:{id:o}})};function B(){x.open=!1,w.back()}const O=R(()=>{var o,t;return(t=(o=s==null?void 0:s.task)==null?void 0:o.users)==null?void 0:t.find(c=>{var b;return((b=d.user)==null?void 0:b.id)==c.id})}),A=R(()=>{var t,c,b,E,q,z,F,H;const o=[];return(c=(t=s.task)==null?void 0:t.requirement)!=null&&c.id&&o.push({id:(E=(b=s.task)==null?void 0:b.requirement)==null?void 0:E.id,title:(z=(q=s.task)==null?void 0:q.requirement)==null?void 0:z.title,is_current_page:!1}),o.push({id:(F=s.task)==null?void 0:F.id,title:(H=s.task)==null?void 0:H.title,is_current_page:!0}),o});pt(()=>u.params.id,async o=>{g.value="changing",await f(o),g.value=""}),pt(()=>u.hash,async function(){setTimeout(()=>vt(u.hash,66),0)});const _=Y({action:null}),U=R(()=>{const t=((s==null?void 0:s.task_todo_dates)||[]).reduce((c,b)=>{const E=b.date;return c[E]||(c[E]=[]),c[E].push(b),c},{});return Object.keys(t).sort((c,b)=>new Date(b)-new Date(c)).map(c=>({date:c,todo_dates:t[c]}))});function V(){_.value={..._.value,action:""},f(u.params.id)}function bt(){_.value={..._.value,action:""},f(u.params.id)}function Z(o){console.log({todo:o}),_.value={..._.value,action:"edit",todo:o}}function ht(o,t){console.log({yearMonthDay:t,todoId:o}),_.value={..._.value,action:"addDate",date:t,todo_id:o,formReadonlyValues:{date:!0}}}function Ct(){_.value={action:null,todo:null}}function wt(o){console.log({todo:o}),_.value={..._.value,action:"show",todo:o}}function Tt(){var o;_.value={..._.value,action:"add",todoTypeId:(o=u.params)==null?void 0:o.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}async function St(o,t){var c;confirm(`Are your sure?
want to change status to ${t} 
todo: '${o==null?void 0:o.title}'`)&&(await D.updateStatus(o.id,t),f((c=u.params)==null?void 0:c.id))}async function $t(o){var t;confirm(`Are your sure want to delete todo
'${o==null?void 0:o.title}'`)&&(await D.deleteTodoDate(o.id),f((t=u.params)==null?void 0:t.id))}return(o,t)=>{var b,E,q,z,F,H,I,tt,et,st,at,ot,nt,lt,it,rt,dt,ut,ct;const c=gt("router-view");return a(),i("div",ne,[m.user?(a(),S(J,{key:0},{default:$(()=>[v(Ut,{task:n(s).task,user:m.user,type:m.type,onCloseClick:t[0]||(t[0]=l=>m.user=null),onUpdateDate:L},null,8,["task","user","type"])]),_:1})):p("",!0),x.open?(a(),S(J,{key:1},{default:$(()=>[v(Nt,{onCloseClick:t[1]||(t[1]=l=>x.open=!1),task:x.task,onDelete:B},null,8,["task"])]),_:1})):p("",!0),g.value==="loading"?(a(),S(ft,{key:2,class:"h-[80vh] items-center justify-center"})):(a(),i("div",le,[n(s).task?(a(),i(N,{key:0},[A.value.length>1?(a(),i("nav",ie,[e("ol",re,[(a(!0),i(N,null,X(A.value,(l,y)=>(a(),i(N,{key:l.id},[y>0?(a(),i("li",de,"/")):p("",!0),e("li",{title:l==null?void 0:l.title,class:"text-gray-600 line-clamp-1"},[l.is_current_page?(a(),i("span",ce,h(l==null?void 0:l.title),1)):(a(),S(Rt(n(d).isAdminMood?n(mt):o.div),{key:0,to:`${n(d).isAdminMood?"/requirements/show/"+l.id:"/tasks"}`,class:K(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":y>0,"whitespace-nowrap":y===0}])},{default:$(()=>[C(h(l==null?void 0:l.title),1)]),_:2},1032,["to","class"]))],8,ue)],64))),128))])])):p("",!0),e("div",pe,[e("div",me,[e("div",null,[e("h2",fe,[e("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:t[2]||(t[2]=l=>n(w).back())},t[9]||(t[9]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),v(yt,null,{default:$(()=>[C(h(n(s).task.title),1)]),_:1})]),e("div",ke,[e("div",ye,[t[10]||(t[10]=e("i",{class:"fas fa-clock"},null,-1)),C(" "+h(n(Vt)(n(s).task.created_at)),1)]),(b=n(s).task)!=null&&b.created_by_user?(a(),i(N,{key:0},[t[11]||(t[11]=e("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),e("div",_e,[v(jt,{user:(E=n(s).task)==null?void 0:E.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),e("div",ve,h((z=(q=n(s).task)==null?void 0:q.created_by_user)==null?void 0:z.label),1)])],64)):p("",!0)])]),v(yt,null,{default:$(()=>{var l;return[e("p",{innerHTML:(l=n(s).task)==null?void 0:l.description,class:"text-justify"},null,8,ge)]}),_:1}),e("div",null,[e("div",xe,[t[13]||(t[13]=e("h3",{class:"font-semibold text-xl"},"Todos",-1)),O.value?(a(),i("button",{key:0,class:"btn btn-3 h-8",onClick:t[3]||(t[3]=j(()=>Tt(),["prevent"]))},t[12]||(t[12]=[e("i",{class:"fas fa-plus"},null,-1),C(" Add Todo ")]))):p("",!0)]),e("div",null,[U.value.length===0?(a(),i("div",be," No Todos ")):p("",!0),(a(!0),i(N,null,X(U.value,l=>(a(),i("div",{key:l.date,class:"border rounded-md overflow-hidden mb-4"},[e("div",he,[e("div",Ce,[e("div",we,h(n(W)(l.date)),1)])]),e("div",null,[(a(!0),i(N,null,X((l==null?void 0:l.todo_dates)||[],y=>(a(),S(Bt,{key:y.id,todoDate:y,onClickTodo:M=>wt(M),onClickEdit:()=>Z(y==null?void 0:y.todo),onClickChangeStatus:(M,Dt)=>St(M,Dt),onClickDelete:M=>$t(M),"hide-sorting-btn":"",class:"border-b border-sky-200"},null,8,["todoDate","onClickTodo","onClickEdit","onClickChangeStatus","onClickDelete"]))),128))])]))),128))])])]),e("div",Te,[e("div",Se,[e("div",null,[e("div",$e,[t[14]||(t[14]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),v(kt,{department:(H=(F=n(s))==null?void 0:F.task)==null?void 0:H.from_department,"short-name":!0},null,8,["department"])]),t[15]||(t[15]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisors",-1)),v(_t,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((tt=(I=n(s))==null?void 0:I.task)==null?void 0:tt.supervisors)||[],listType:"supervisors",maxItem:3},null,8,["users"])]),t[18]||(t[18]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",De,[t[16]||(t[16]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),v(kt,{department:(st=(et=n(s))==null?void 0:et.task)==null?void 0:st.to_department,"short-name":!0},null,8,["department"])]),t[17]||(t[17]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Assigned Users",-1)),v(_t,{class:"flex items-center gap-x-3 gap-y-2 flex-wrap",users:((ot=(at=n(s))==null?void 0:at.task)==null?void 0:ot.users)||[],isTargetTask:(lt=(nt=n(s))==null?void 0:nt.task)==null?void 0:lt.is_target,maxItem:5},null,8,["users","isTargetTask"])])]),n(d).isAdminMood?(a(),i("div",Ee,[v(n(mt),{to:{name:"TaskUserAssign",params:{id:(it=n(s).task)==null?void 0:it.id}},class:K(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",n(s).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:t[4]||(t[4]=l=>l.stopPropagation())},{default:$(()=>t[19]||(t[19]=[e("i",{class:"fas fa-users-cog"},null,-1),C(" Employees ")])),_:1,__:[19]},8,["to","class"]),e("button",{onClick:t[5]||(t[5]=j(l=>{var y;return k((y=n(s).task)==null?void 0:y.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!n(s).task.closed_at},t[20]||(t[20]=[e("i",{class:"fas fa-edit"},null,-1),C(" Edit ")]),8,Ae)])):p("",!0),v(oe,{task:(rt=n(s))==null?void 0:rt.task},null,8,["task"]),(dt=n(s))!=null&&dt.task?(a(),S(Pt,{key:1,task:((ut=n(s))==null?void 0:ut.task)||{},class:"col-span-full",onUpdateStatus:t[6]||(t[6]=()=>{var l,y;return f((y=(l=n(s))==null?void 0:l.task)==null?void 0:y.id)}),"hide-timeline":""},{top:$(()=>{var l,y,M;return[(l=n(s).task)!=null&&l.closed_at?p("",!0):(a(),i("div",Me,[v(Lt,{status:(y=n(s).task)==null?void 0:y.status,progressPercent:(M=n(s).task)==null?void 0:M.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"])]))]}),_:1},8,["task"])):p("",!0),n(d).isAdminMood?(a(),i("div",Re,[e("button",{class:"btn-2-red h-8",onClick:j(T,["prevent"])},"Delete"),(ct=n(s).task)!=null&&ct.closed_at?p("",!0):(a(),i("button",{key:0,class:"btn-3 h-8",onClick:j(P,["prevent"])}," Close Task "))])):(a(),i("div",je))])]),n(u).name==="TaskReportAdd"?(a(),S(J,{key:1,class:"*:bg-transparent"},{default:$(()=>[v(c)]),_:1})):(a(),i("section",Le,[v(c)]))],64)):(a(),i("div",Oe,h(n(s).error),1)),g.value==="changing"?(a(),S(ft,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):p("",!0)])),v(zt,{userRole:"employee",todoModal:_.value,onCancelClick:Ct,onTodoUpdate:V,onTodoDateUpdate:bt,onClickEdit:Z,onClickAddTodoDate:ht},null,8,["todoModal"]),r.open?(a(),S(J,{key:4},{default:$(()=>[v(Jt,{task:n(s).task,onClickCancel:t[7]||(t[7]=l=>r.open=!1),onUpdateStatus:t[8]||(t[8]=()=>{var l;f((l=n(s).task)==null?void 0:l.id),r.open=!1})},null,8,["task"])]),_:1})):p("",!0)])}}};export{as as default};
