import{o as a,c as n,a as l,D,s as k,r as c,y as $,b as N,A as h,k as R,n as j,e as F,d as O,C as z,F as q,x as B,h as r,m,t as V,f as G,g as P}from"./index-DFR998CW.js";import{_ as Q}from"./CommentModal-DtZYYuUx.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as J}from"./MultiselectDropdown-DRtu2cBr.js";import{_ as K}from"./TaskEditForm-e7WsLq2r.js";import{_ as W}from"./TaskTreeView-B3eK-xEs.js";import{u as X}from"./attendance-CO6CHi4j.js";import{u as Y}from"./company-4Nvx5R2C.js";import{u as Z}from"./useTaskStore-DqXsb1m9.js";import"./useCommentStore-DHq4ScF5.js";import"./vue-multiselect.esm-DjTFajPy.js";const ee={},te={class:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50"},se={class:"max-w-4xl w-full bg-white min-h-40 mx-4 rounded-full"};function oe(x,o){return a(),n("div",te,[l("div",se,[D(x.$slots,"default")])])}const ae=H(ee,[["render",oe]]),le={class:"container mx-auto p-6 relative"},ne={class:"mb-3"},re={class:"flex flex-wrap items-center gap-2 mt-3"},ie=["value"],ue={key:1,class:"text-center py-4 text-gray-500"},de={key:2,class:"text-center py-4 text-red-500"},ce={key:3,class:"space-y-4"},me=1,Ce={__name:"TaskList",setup(x){const o=Z(),A=X(),f=Y();k(o);const{companies:E,employees:b}=k(f),i=G(),g=P(),p=c(!1),v=c(null),y=$(C("company-id")),w=$(C("user-id")),d=c();k(A);const u=c(null);N(async()=>{await f.fetchCompanies(),await o.fetchTasks(i.query["user-id"]?{user_ids:i.query["user-id"]}:{})});const I=()=>{g.push({name:"TaskAdd"})};function C(e){return{set:t=>{g.push({query:{...i.query,[e]:t}})},get:()=>i.query[e]||void 0}}const L=e=>{v.value=e,p.value=!0},M=()=>{p.value=!1,v.value=null};h(()=>y.value,async e=>{e&&(await f.fetchEmployee(e),d.value=b.value.find(t=>t.id==w.value)||null)},{initial:!0,immediate:!0}),h(()=>({id:i.query["user-id"]}),async e=>{console.log("Selected Employee:",e),T(e.id)});async function T(e){e?await o.fetchTasks({user_ids:e}):await o.fetchTasks()}function U(){u.value=null,T(i.query["user-id"])}return h(d,e=>{w.value=e==null?void 0:e.id}),(e,t)=>{var S;return a(),n("div",le,[u.value?(a(),R(ae,{key:0},{default:j(()=>[m(K,{taskId:u.value,class:"rounded-full",onClose:t[0]||(t[0]=s=>u.value=null),onUpdated:U},null,8,["taskId"])]),_:1})):F("",!0),l("div",ne,[t[5]||(t[5]=l("div",{class:"flex justify-between items-center"},[l("h2",{class:"text-2xl font-bold text-gray-800"},"Task List")],-1)),l("div",re,[l("div",null,[O(l("select",{id:"company-filter","onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),class:"input-1"},[t[4]||(t[4]=l("option",{value:""},"Select Company",-1)),(a(!0),n(q,null,B(r(E),s=>(a(),n("option",{key:s.id,value:s.id},V(s.name),9,ie))),128))],512),[[z,y.value]])]),l("div",null,[m(J,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=s=>d.value=s),options:r(b),multiple:!1,label:"name",placeholder:"Please select employee..."},null,8,["modelValue","options"])]),l("button",{onClick:I,class:"btn-1 ml-auto"},"Add Task")])]),r(o).loading?(a(),n("div",ue,"Loading tasks...")):r(o).error?(a(),n("div",de,V(r(o).error),1)):(a(),n("div",ce,[(a(!0),n(q,null,B(((S=r(o))==null?void 0:S.taskListTree)||[],s=>(a(),n("div",{key:s.id,class:"rounded-lg border bg-white overflow-hidden"},[m(W,{task:s,class:"!border-0",onCommentButtonClick:_=>L(_,s.id),onEditClick:t[3]||(t[3]=_=>u.value=_)},null,8,["task","onCommentButtonClick"])]))),128))])),m(Q,{show:p.value,"commentable-id":v.value,"commentable-type":"task","user-id":me,"on-close":M,onSubmitted:r(o).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Ce as default};
