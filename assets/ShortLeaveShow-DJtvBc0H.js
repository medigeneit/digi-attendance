import{N as Wt,i as qt,u as Ht,r as _,x as Pt,b as zt,c as r,a as t,k as o,j as Ot,t as l,h,e as i,p as Gt,l as Lt,m as Jt,d as Nt,v as Rt,F as Kt,f as Qt,o as n,g as Xt}from"./index-CV9fc69a.js";import{L as Yt}from"./LoaderView-CEOb9vAb.js";import{_ as Zt}from"./ScreenshotCapture-Df68bTzv.js";import{_ as es}from"./ShareComponent-z6EpB-mx.js";import{u as ts}from"./short-leave-B6XZWrF8.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ss={class:"my-container max-w-3xl space-y-6"},ls={key:1,class:"bg-white rounded space-y-2 p-4 md:p-8",id:"leave-application"},as={class:"flex justify-end"},os={class:"font-medium"},ns={class:"gap-y-1"},rs={class:"gap-y-1"},is={class:""},us={class:"grid md:grid-cols-2"},ds={class:"grid md:grid-cols-2 gap-4 pt-10 items-center"},vs={key:0,class:"print:hidden"},ps={class:"text-xs"},cs={class:"flex gap-2"},ms={class:"font-semibold text-sm"},_s={key:0,class:"text-green-600 print:text-black"},fs={key:1,class:"pl-2 text-yellow-700"},ys={class:"text-xs text-gray-500"},bs={class:"text-center"},gs={class:"title-md"},xs={key:0},hs={class:"grid grid-cols-2 text-sm md:text-base md:grid-cols-3 md:gap-4"},ks={class:"pt-10"},ws={key:0},As={key:1},js={key:2,class:"print:hidden"},Cs={class:"text-xs text-blue-600"},Ss={class:"flex gap-4"},Ls={class:"font-semibold text-sm"},Ns={key:0,class:"text-green-600"},Rs={key:1,class:"pl-2 text-yellow-700"},Fs={class:"text-xs text-gray-500"},Bs={class:"pt-10"},Ds={key:0},$s={key:1,class:"print:hidden"},Is={class:"text-xs text-blue-600"},Vs={class:"flex gap-4"},Ms={class:"font-semibold text-sm"},Ts={key:0,class:"text-green-600"},Us={key:1,class:"pl-2 text-yellow-700"},Es={class:"text-xs text-gray-500"},Ws={class:"pt-10"},qs={key:0},Hs={key:1},Ps={key:2,class:"print:hidden"},zs={class:"text-xs text-blue-600"},Os={class:"flex gap-4"},Gs={class:"font-semibold text-sm"},Js={key:0,class:"text-green-600"},Ks={key:1,class:"pl-2 text-yellow-700"},Qs={class:"text-xs text-gray-500"},Xs={key:0,class:"mb-2"},Ys=["href"],Zs={key:0,class:"modal-bg"},el={class:"modal-card"},tl={class:"flex justify-end gap-2 mt-4"},sl={key:1,class:"modal-bg"},ll={class:"modal-card"},al={class:"flex justify-end gap-2 mt-4"},pl={__name:"ShortLeaveShow",setup(ol){const Ft=Wt(),w=qt(),Bt=Xt(),p=Qt(),d=ts(),f=Ht(),A=_(null),j=_(!0),y=_(!1),b=_(""),g=_(!1),c=_(""),s=Pt(()=>d.shortLeave);zt(async()=>{const{id:a}=p.params;try{await d.fetchShortLeaveById(a)}catch(e){console.error("Failed to fetch short leave details:",e)}finally{j.value=!1}});let C=_("");function x(a){C.value=a,g.value=!0}async function Dt(){Vt(C.value),g.value=!1}const $t=async()=>{try{await d.rejectShortLeave(p.params.id,b.value),alert("Short leave rejected successfully!"),y.value=!1,b.value="",await d.fetchShortLeaveById(p.params.id),L()}catch(a){console.error("Failed to reject short leave:",a),alert("Failed to reject short leave.")}},It=async()=>{try{const a={attachment:A.value};await d.uploadShortLeaveAttachment(p.params.id,a)}catch(a){console.error("Failed to reject short leave:",a),alert("Failed to reject short leave.")}},k=()=>{y.value=!0},Vt=async a=>{try{const{id:e}=p.params;console.log(a,e,c.value),a==="handover"&&await d.handoverAccept({id:e,note:c.value}),a==="inCharge"&&await d.inChargeAccept({id:e,note:c.value}),a==="recommend"&&await d.recommendByAccept({id:e,note:c.value}),a==="approve"&&await d.approvedByAccept({id:e,note:c.value}),alert(`${a} accepted successfully!`),await d.fetchShortLeaveById(e),L()}catch(e){console.error(`Failed to accept ${a}:`,e),alert(`Failed to accept ${a}.`)}},Mt=()=>Bt.go(-1);function Tt(){window.print()}const Ut=async a=>{const e=a.target.files[0];if(e){const m=new FormData;m.append("file",e);const u=await d.fetchFileUpload(m);A.value=u==null?void 0:u.url,u!=null&&u.url?(It(),w.success("File uploaded successfully!")):w.error("Failed to upload file!")}},Et=a=>new Date(a).toISOString().slice(0,10),S=a=>{if(!a)return"N/A";const[e,m]=a.split(":").map(Number),u=new Date;return u.setHours(e,m),u.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};async function L(){p.query.notifyId&&await Ft.markAsRead(p.query.notifyId)}return(a,e)=>{var m,u,N,R,F,B,D,$,I,V,M,T,U,E,W,q,H,P,z,O,G,J,K,Q,X,Y,Z,ee,te,se,le,ae,oe,ne,re,ie,ue,de,ve,pe,ce,me,_e,fe,ye,be,ge,xe,he,ke,we,Ae,je,Ce,Se,Le,Ne,Re,Fe,Be,De,$e,Ie,Ve,Me,Te,Ue,Ee,We,qe,He,Pe,ze,Oe,Ge,Je,Ke,Qe,Xe,Ye,Ze,et,tt,st,lt,at,ot,nt,rt,it,ut,dt,vt,pt,ct,mt,_t,ft,yt,bt,gt,xt,ht,kt,wt,At,jt,Ct,St;return n(),r(Kt,null,[t("div",ss,[t("div",{class:"flex items-center justify-between gap-2 print:hidden"},[t("button",{class:"btn-3",onClick:Mt},e[8]||(e[8]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[10]||(e[10]=t("h1",{class:"title-lg flex-wrap text-center"},"Short Leave Details",-1)),t("div",null,[t("button",{class:"btn-2",onClick:Tt},e[9]||(e[9]=[t("i",{class:"far fa-print"},null,-1),o(" Print ")]))])]),j.value?(n(),Ot(Yt,{key:0})):(n(),r("div",ls,[e[43]||(e[43]=t("div",null,[t("h1",{class:"title-lg text-center"},"Short Leave Application")],-1)),t("div",as,[t("div",null,"Date: "+l(Et((m=s.value)==null?void 0:m.created_at)),1)]),t("div",null,[t("p",os,[e[11]||(e[11]=o(" Name: ")),t("b",null,l((N=(u=s.value)==null?void 0:u.user)==null?void 0:N.name),1)]),t("div",ns,[t("p",null,[e[12]||(e[12]=o(" Designation: ")),t("b",null,l((B=(F=(R=s.value)==null?void 0:R.user)==null?void 0:F.designation)==null?void 0:B.title),1)])]),t("div",rs,[t("p",null,[e[13]||(e[13]=o(" Department: ")),t("b",null,l((I=($=(D=s.value)==null?void 0:D.user)==null?void 0:$.company)==null?void 0:I.name),1)])])]),t("div",is,[t("div",us,[t("div",null,[e[14]||(e[14]=t("b",null,"From:",-1)),o(" "+l((V=s.value)!=null&&V.start_time?S((M=s.value)==null?void 0:M.start_time):""),1)]),t("div",null,[e[15]||(e[15]=t("b",null,"To:",-1)),o(" "+l((T=s.value)!=null&&T.end_time?S((U=s.value)==null?void 0:U.end_time):""),1)]),t("div",null,[e[16]||(e[16]=t("b",null,"Short Leave Date:",-1)),o(" "+l((E=s.value)==null?void 0:E.date),1)]),t("div",null,[e[17]||(e[17]=t("b",null,"Total Minutes:",-1)),o(" "+l((W=s.value)==null?void 0:W.total_minutes),1)])]),t("div",ds,[t("div",null,[e[18]||(e[18]=t("b",null,"Reason:",-1)),o(" "+l(((q=s.value)==null?void 0:q.reason)||"N/A"),1)]),t("div",null,[t("p",null,l(((P=(H=s.value)==null?void 0:H.handover_user)==null?void 0:P.name)||"Not assigned"),1),!((z=s.value)!=null&&z.status)&&((O=s.value)==null?void 0:O.handover_user_id)===((J=(G=h(f))==null?void 0:G.user)==null?void 0:J.id)?(n(),r("div",vs,[t("p",ps,[o(l((Q=(K=s.value)==null?void 0:K.user)==null?void 0:Q.name)+" has assigned you for his handover. ",1),e[19]||(e[19]=t("br",null,null,-1)),e[20]||(e[20]=o(" Do you agree? "))]),t("div",cs,[t("button",{class:"font-bold text-lg text-green-600 px-2",onClick:e[0]||(e[0]=v=>x("handover"))}," ✔ "),e[21]||(e[21]=t("button",{class:"px-2"},"❌",-1))])])):i("",!0),e[24]||(e[24]=t("hr",{class:"w-44 border-black mt-1"},null,-1)),t("h4",ms,[e[23]||(e[23]=o(" Handover ")),(X=s.value)!=null&&X.handover_user_id&&((Y=s.value)!=null&&Y.status)?(n(),r("span",_s," (✔) ")):i("",!0),(Z=s.value)!=null&&Z.handover_user_id&&!((ee=s.value)!=null&&ee.status)?(n(),r("span",fs,e[22]||(e[22]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)]),t("p",ys,l((te=s.value)==null?void 0:te.handover_note),1)])])]),e[44]||(e[44]=t("hr",null,null,-1)),t("div",bs,[t("h3",gs,[e[25]||(e[25]=o(" Approvals ")),t("span",{class:Gt({"text-yellow-500":((se=s.value)==null?void 0:se.status)==="Pending","text-green-500":((le=s.value)==null?void 0:le.status)==="Approved","text-red-500":((ae=s.value)==null?void 0:ae.status)==="Rejected"})}," ("+l(((oe=s.value)==null?void 0:oe.status)||"N/A")+") ",3)]),((ne=s.value)==null?void 0:ne.status)==="Rejected"?(n(),r("div",xs,[t("div",null,[e[26]||(e[26]=t("b",null,"Rejected By:",-1)),o(" "+l(((ie=(re=s.value)==null?void 0:re.rejected_by_user)==null?void 0:ie.name)||"N/A"),1)]),t("div",null,[e[27]||(e[27]=t("b",null,"Rejection Reason:",-1)),o(" "+l(((ue=s.value)==null?void 0:ue.rejection_reason)||"N/A"),1)])])):i("",!0)]),t("div",hs,[t("div",ks,[(de=s.value)!=null&&de.in_charge_user?(n(),r("p",ws,l(((pe=(ve=s.value)==null?void 0:ve.in_charge_user)==null?void 0:pe.name)||""),1)):(n(),r("p",As,l(((fe=(_e=(me=(ce=s.value)==null?void 0:ce.user)==null?void 0:me.other_approval)==null?void 0:_e.in_charge_user)==null?void 0:fe.name)||"N/A"),1)),((ye=s.value)==null?void 0:ye.status)!=="Rejected"&&((be=s.value)==null?void 0:be.status)!=="Approved"&&!((ge=s.value)!=null&&ge.in_charge_user_id)&&((ke=(he=(xe=s.value)==null?void 0:xe.user)==null?void 0:he.other_approval)==null?void 0:ke.in_charge_user_id)===((Ae=(we=h(f))==null?void 0:we.user)==null?void 0:Ae.id)?(n(),r("div",js,[t("p",Cs,[o(l((Ce=(je=s.value)==null?void 0:je.user)==null?void 0:Ce.name)+" has submitted an application. ",1),e[28]||(e[28]=t("br",null,null,-1)),e[29]||(e[29]=o(" Will you forward it? "))]),t("div",Ss,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[1]||(e[1]=v=>x("inCharge"))}," ✔ "),t("button",{class:"",onClick:k},"❌")])])):i("",!0),e[32]||(e[32]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",Ls,[e[31]||(e[31]=o(" In-Charge ")),(Se=s.value)!=null&&Se.in_charge_user_id?(n(),r("span",Ns,"(✔)")):i("",!0),!((Le=s.value)!=null&&Le.in_charge_user_id)&&((Fe=(Re=(Ne=s.value)==null?void 0:Ne.user)==null?void 0:Re.other_approval)!=null&&Fe.in_charge_user)?(n(),r("span",Rs,e[30]||(e[30]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)]),t("p",Fs,l((Be=s.value)==null?void 0:Be.in_charge_note),1)]),t("div",Bs,[(De=s.value)!=null&&De.recommend_by_user?(n(),r("p",Ds,l(((Ie=($e=s.value)==null?void 0:$e.recommend_by_user)==null?void 0:Ie.name)||""),1)):i("",!0),t("p",null,l(((Ue=(Te=(Me=(Ve=s.value)==null?void 0:Ve.user)==null?void 0:Me.other_approval)==null?void 0:Te.recommend_by_user)==null?void 0:Ue.name)||"N/A"),1),((Ee=s.value)==null?void 0:Ee.status)!=="Rejected"&&((We=s.value)==null?void 0:We.status)!=="Approved"&&!((qe=s.value)!=null&&qe.recommend_by_user_id)&&((ze=(Pe=(He=s.value)==null?void 0:He.user)==null?void 0:Pe.other_approval)==null?void 0:ze.recommend_by_user_id)===((Ge=(Oe=h(f))==null?void 0:Oe.user)==null?void 0:Ge.id)?(n(),r("div",$s,[t("p",Is,[o(l((Ke=(Je=s.value)==null?void 0:Je.user)==null?void 0:Ke.name)+" has submitted an application.",1),e[33]||(e[33]=t("br",null,null,-1)),e[34]||(e[34]=o(" Will you recommend it? "))]),t("div",Vs,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[2]||(e[2]=v=>x("recommend"))}," ✔ "),t("button",{class:"",onClick:k},"❌")])])):i("",!0),e[37]||(e[37]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",Ms,[e[36]||(e[36]=o(" Recommend By ")),(Qe=s.value)!=null&&Qe.recommend_by_user_id?(n(),r("span",Ts,"(✔)")):i("",!0),!((Xe=s.value)!=null&&Xe.recommend_by_user_id)&&((et=(Ze=(Ye=s.value)==null?void 0:Ye.user)==null?void 0:Ze.other_approval)!=null&&et.recommend_by_user)?(n(),r("span",Us,e[35]||(e[35]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)]),t("p",Es,l((tt=s.value)==null?void 0:tt.recommend_note),1)]),t("div",Ws,[(st=s.value)!=null&&st.approved_by_user?(n(),r("p",qs,l(((at=(lt=s.value)==null?void 0:lt.approved_by_user)==null?void 0:at.name)||""),1)):(n(),r("p",Hs,l(((it=(rt=(nt=(ot=s.value)==null?void 0:ot.user)==null?void 0:nt.other_approval)==null?void 0:rt.approved_by_user)==null?void 0:it.name)||"N/A"),1)),((ut=s.value)==null?void 0:ut.status)!=="Rejected"&&((dt=s.value)==null?void 0:dt.status)!=="Approved"&&!((vt=s.value)!=null&&vt.approved_by_user_id)&&((mt=(ct=(pt=s.value)==null?void 0:pt.user)==null?void 0:ct.other_approval)==null?void 0:mt.approved_by_user_id)===((ft=(_t=h(f))==null?void 0:_t.user)==null?void 0:ft.id)?(n(),r("div",Ps,[t("p",zs,[o(l((bt=(yt=s.value)==null?void 0:yt.user)==null?void 0:bt.name)+" has submitted an application.",1),e[38]||(e[38]=t("br",null,null,-1)),e[39]||(e[39]=o(" Will you accept it? "))]),t("div",Os,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[3]||(e[3]=v=>x("approve"))}," ✔ "),t("button",{class:"",onClick:k},"❌")])])):i("",!0),e[42]||(e[42]=t("hr",{class:"w-28 md:w-36 border-black mt-2"},null,-1)),t("p",Gs,[e[41]||(e[41]=o(" Approved By ")),(gt=s.value)!=null&&gt.approved_by_user_id?(n(),r("span",Js,"(✔)")):i("",!0),!((xt=s.value)!=null&&xt.approved_by_user_id)&&((wt=(kt=(ht=s.value)==null?void 0:ht.user)==null?void 0:kt.other_approval)!=null&&wt.approved_by_user)?(n(),r("span",Ks,e[40]||(e[40]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)]),t("p",Qs,l((At=s.value)==null?void 0:At.approval_note),1)])])])),t("div",null,[t("div",null,[e[45]||(e[45]=t("label",null,"Attachment",-1)),(jt=s.value)!=null&&jt.attachment&&typeof((Ct=s.value)==null?void 0:Ct.attachment)=="string"?(n(),r("div",Xs,[t("a",{href:(St=s.value)==null?void 0:St.attachment,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,Ys)])):i("",!0),t("input",{type:"file",onChange:Ut,class:"w-full p-2 border rounded"},null,32)])]),Lt(es,null,{default:Jt(()=>[Lt(Zt,{targetId:"leave-application",platform:"whatsapp"})]),_:1})]),g.value?(n(),r("div",Zs,[t("div",el,[e[46]||(e[46]=t("h3",{class:"title-lg"},"Accept Application",-1)),Nt(t("input",{"onUpdate:modelValue":e[4]||(e[4]=v=>c.value=v),rows:"4",placeholder:"Enter rejection reason...",class:"w-full border rounded-lg p-2 text-gray-700"},null,512),[[Rt,c.value]]),t("div",tl,[t("button",{class:"btn-3",onClick:e[5]||(e[5]=v=>g.value=!1)},"Cancel"),t("button",{class:"btn-2 bg-red-500 text-white",onClick:Dt},"Confirm")])])])):i("",!0),y.value?(n(),r("div",sl,[t("div",ll,[e[47]||(e[47]=t("h3",{class:"title-lg"},"Reject Short Leave",-1)),Nt(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=v=>b.value=v),rows:"4",placeholder:"Enter rejection reason...",class:"w-full border rounded-lg p-2 text-gray-700"},null,512),[[Rt,b.value]]),t("div",al,[t("button",{class:"btn-3",onClick:e[7]||(e[7]=v=>y.value=!1)},"Cancel"),t("button",{class:"btn-2 bg-red-500 text-white",onClick:$t},"Confirm")])])])):i("",!0)],64)}}};export{pl as default};
