import{r as p,e as C,A as M,k as T,c as v,o as m,m as B,f as c,a as t,g as n,v as y,E as x,t as g,C as h,y as R,n as k,l as q,h as w,w as z}from"./index-dpcgwVL6.js";import{u as F}from"./useTaskStore-h-u1RS2D.js";import{S as L}from"./SectionLoading-BobLq8FH.js";const O={class:"p-4"},P={key:1,class:"text-center py-4 text-gray-500"},$={class:"mb-4"},j={class:"mb-4"},G={class:"flex gap-1 items-center"},A={class:"flex gap-1 items-center"},K={key:0,class:"mb-4"},Y={class:"grid grid-cols-2 gap-4 mb-4"},H={class:"mt-8"},J={class:"grid grid-cols-2 gap-4 mb-4 mt-12"},Q={class:"mb-4"},W={class:"block text-gray-600 text-sm mb-1 font-medium"},X={class:"mb-4"},Z={class:"block text-gray-600 text-sm mb-1 font-medium"},ee={class:"mb-4"},te={key:1,class:"mb-4 text-red-500 font-medium"},se={class:"flex items-center gap-4"},ae=["disabled"],le={key:0,class:"text-red-500 text-sm"},ne={__name:"TaskEditForm",props:{taskId:{type:[String,Number],required:!0}},emits:["updated","cancel"],setup(U,{emit:V}){const S=U,D=V,b=F(),s=p(),o=p(!1),E=p([]),_=p(""),a=p({title:"",requirement_id:"",user_ids:"",status:"PENDING",progress:0,description:"",is_important:!1,is_urgent:!1,is_target:!1,started_at:"",deadline:""}),f=r=>{if(!r)return"";try{const e=new Date(r);if(isNaN(e))return"";const u=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),d=String(e.getDate()).padStart(2,"0");return`${u}-${i}-${d}`}catch{return""}};C(async()=>{var r;o.value=!0,s.value=(r=await b.fetchTask(S.taskId,{},{fetchOnly:!0,loadingBeforeFetch:!1}))==null?void 0:r.task,console.log({task:s.value}),E.value=s.value.users,o.value=!1,a.value={title:s.value.title,requirement_id:s.value.requirement_id,user_ids:s.value.users.map(e=>e.id).join(","),status:s.value.status,progress:s.value.progress,description:s.value.description,is_important:s.value.is_important,is_urgent:s.value.is_urgent,is_target:s.value.is_target,started_at:f(s.value.started_at),deadline:f(s.value.deadline)}}),M(()=>s.value,r=>{a.value={title:r.title,requirement_id:r.requirement_id,user_ids:r.users.map(e=>e.id).join(","),status:r.status,progress:s.value.progress,description:r.description,is_important:s.value.is_important,is_urgent:s.value.is_urgent,is_target:s.value.is_target,started_at:f(s.value.started_at),deadline:f(s.value.deadline)}});const I=async()=>{var r,e,u;o.value=!0;try{const i={...a.value,user_ids:((r=E.value)==null?void 0:r.map(d=>Number(d.id)))||[]};await b.updateTask(S.taskId,i,{loadingBeforeFetch:!1}),D("updated")}catch(i){_.value=((u=(e=i.response)==null?void 0:e.data)==null?void 0:u.message)||"An error occurred while updating the task."}finally{o.value=!1}};return(r,e)=>{var i,d,N;const u=T("RequiredIcon");return m(),v("div",O,[o.value?(m(),B(L,{key:0})):c("",!0),e[19]||(e[19]=t("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Edit Task",-1)),o.value?(m(),v("div",P,"Loading form...")):c("",!0),t("form",{onSubmit:z(I,["prevent"])},[t("div",$,[e[9]||(e[9]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Task Title",-1)),n(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.title=l),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[y,a.value.title]])]),t("div",j,[t("label",G,[n(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=l=>a.value.is_important=l),class:"size-4"},null,512),[[x,a.value.is_important]]),e[10]||(e[10]=t("span",{class:"block text-gray-600 text-base pt-1 mb-1 font-medium"},"Important",-1))]),t("label",A,[n(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=l=>a.value.is_urgent=l),class:"size-4"},null,512),[[x,a.value.is_urgent]]),e[11]||(e[11]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Urgent",-1))])]),(i=s.value)!=null&&i.requirement?(m(),v("div",K,[e[12]||(e[12]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Requirement",-1)),t("div",null,[t("p",null,g((N=(d=s.value)==null?void 0:d.requirement)==null?void 0:N.title),1)])])):c("",!0),t("div",Y,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Status",-1)),n(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.status=l),class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},e[13]||(e[13]=[t("option",null,"PENDING",-1),t("option",null,"IN_PROGRESS",-1),t("option",null,"COMPLETED",-1),t("option",null,"BLOCKED",-1)]),512),[[h,a.value.status]])])]),t("div",H,[t("label",{class:R(["flex gap-1 items-center mt-4 border rounded py-2 justify-center cursor-pointer",{"bg-yellow-200":a.value.is_target}])},[n(t("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>a.value.is_target=l),class:"size-6"},null,512),[[x,a.value.is_target]]),e[15]||(e[15]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Is Target Task",-1))],2)]),t("div",J,[t("div",Q,[t("label",W,[e[16]||(e[16]=k(" Start Date ")),q(u),k(" "+g(a.value.started_at),1)]),n(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.started_at=l),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[y,a.value.started_at]])]),t("div",X,[t("label",Z,[e[17]||(e[17]=k(" Deadline ")),q(u)]),n(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.deadline=l),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[y,a.value.deadline]])])]),t("div",ee,[e[18]||(e[18]=t("label",{class:"block text-gray-700 font-medium mb-2"},"Description",-1)),n(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.description=l),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[y,a.value.description]])]),w(b).error?(m(),v("div",te,g(w(b).error),1)):c("",!0),t("div",se,[t("button",{disabled:o.value,type:"submit",class:"bg-green-500 hover:bg-green-600 text-white font-semibold px-5 py-2 rounded transition"},g(o.value?"Updating...":"Update Task"),9,ae),t("button",{type:"button",onClick:e[8]||(e[8]=l=>D("close")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),_.value?(m(),v("div",le,g(_.value),1)):c("",!0)])],32)])}}};export{ne as _};
