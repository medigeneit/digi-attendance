import{d as oe,B as Y,r as g,p as E,a4 as Z,q as H,e as te,c as i,o as r,a as e,f as z,w as se,g as k,h as x,v as C,K as ne,t as f,F as M,x as j,k as T,a5 as W,y as B,u as re,b as de,C as ue,A as ie,i as ee,a6 as ce}from"./index-x9cp87Ge.js";import{L as ae}from"./LoaderView-CoyRIDVZ.js";import{_ as ve}from"./MultiselectDropdown-BKfa2-wK.js";import{u as ye}from"./holiday-8h4h-_-c.js";import{u as le}from"./leave-application-j5a8QZqI.js";import{u as pe}from"./leave-type-DjeRczbM.js";import{u as O}from"./user-H_b8FPmd.js";import{_ as me}from"./EmployeeFilter-BbDLlQMl.js";import{S as _e}from"./SelectedEmployeeCard-Cdih1qlb.js";import{u as fe}from"./company-DCmdFkD2.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-I7vW5i8n.js";import"./department-bphk08wv.js";import"./EmployeeDropdownInput-01dzgpDA.js";import"./SelectDropdown-DxrgI5l_.js";import"./UserChip-D1T-42jA.js";const be={class:"space-y-4 p-2 md:p-4"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},xe={class:"inline-flex items-center space-x-2"},he={key:0},we={class:"text-blue-600 font-medium"},ke={key:1,class:"bg-gray-100 p-2 rounded-md"},Le={class:"font-semibold"},Se={class:"flex flex-wrap gap-2"},$e=["name","value","onUpdate:modelValue"],Ue={class:"flex items-center space-x-1"},Ae=["name","onUpdate:modelValue"],De={class:"flex items-center space-x-1"},Ce=["name","onUpdate:modelValue"],qe={key:2},Ve={key:3},Be={key:4,class:"text-red-500 text-sm"},Te={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(q,{emit:F}){const l=q,h=F,A=le();pe();const w=O();oe();const $=ye(),{userLeaveBalance:L}=Y(w),D=g(""),S=g(!0),d=g({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),o=g([]),n=g(!1),v=g(null),V=E(()=>{var y,s,c;return((s=(y=l==null?void 0:l.userInfo)==null?void 0:y.assign_weekend)==null?void 0:s.weekends)||((c=l==null?void 0:l.userInfo)==null?void 0:c.weekends)}),u=E(()=>{const y=d.value.last_working_date,s=d.value.resumption_date;if(!y||!s)return[];const c=new Date(y),p=new Date(s);if(p<=c)return[];const _=[];let m=new Date(c);for(m.setDate(m.getDate()+1);m<p;){const U=m.getFullYear(),b=(m.getMonth()+1).toString().padStart(2,"0"),a=m.getDate().toString().padStart(2,"0");_.push(`${U}-${b}-${a}`),m.setDate(m.getDate()+1)}return _}),R=E(()=>{if(!d.value.last_working_date||!d.value.resumption_date)return"";const y=new Date(d.value.last_working_date);return new Date(d.value.resumption_date)<=y?"Resumption date must be after Last Working Date.":u.value.length===0?"No leave days between the selected dates.":`Total leave days: ${u.value.length}`});Z(async()=>{var y;u.value.length&&L.value.length&&(o.value.length!==u.value.length&&(o.value=u.value.map(()=>L.value[0].id)),await $.fetchHolidays({company_id:(y=l==null?void 0:l.userInfo)==null?void 0:y.company_id,start_date:u.value[0],end_date:u.value[u.value.length-1]}),u.value.forEach(async(s,c)=>{const p=new Date(s).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),_=p.charAt(0).toUpperCase()+p.slice(1);V.value.includes(_)&&(o.value[c]="weekend"),$.holidayDates.includes(s)&&(o.value[c]="holiday")}))}),H(()=>D.value,y=>{d.value.handover_user_id=y==null?void 0:y.id});const N=async()=>{var y;n.value=!0,v.value=null;try{const s=u.value.map((m,U)=>({date:m,leave_type_id:o.value[U]!=="weekend"&&o.value[U]!=="holiday"?o.value[U]:null})).filter(m=>m.leave_type_id!==null),c=u.value.map((m,U)=>({date:m,leave_type_id:o.value[U]||""})).filter(m=>m.leave_type_id!==null),p={user_id:(y=l==null?void 0:l.userInfo)==null?void 0:y.id,last_working_date:d.value.last_working_date,resumption_date:d.value.resumption_date,reason:d.value.reason,works_in_hand:d.value.works_in_hand,handover_user_id:S.value?null:d.value.handover_user_id,leave_days:s,json_data:c,is_direct_approve:S.value};await A.storeAdminLeaveApplication(p)&&h("formSuccessClosed")}catch(s){v.value=s.message||"Failed to submit leave application"}finally{n.value=!1}};return te(async()=>{Z(()=>{var s;const y=(s=l==null?void 0:l.userInfo)==null?void 0:s.id;y&&w.fetchUserLeaveBalances(y)}),await w.fetchTypeWiseEmployees({except:"auth"})}),(y,s)=>(r(),i("div",be,[s[16]||(s[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),n.value?(r(),z(ae,{key:0})):(r(),i("form",{key:1,onSubmit:se(N,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",ge,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=c=>d.value.last_working_date=c),class:"input-1 w-full",required:""},null,512),[[C,d.value.last_working_date]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),x(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=c=>d.value.resumption_date=c),class:"input-1 w-full",required:""},null,512),[[C,d.value.resumption_date]])])]),e("div",null,[e("label",xe,[x(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=c=>S.value=c),class:"form-checkbox text-blue-600"},null,512),[[ne,S.value]]),s[8]||(s[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),d.value.last_working_date&&d.value.resumption_date?(r(),i("div",he,[e("p",we,f(R.value),1)])):k("",!0),u.value.length?(r(),i("div",ke,[s[11]||(s[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),e("div",null,[(r(!0),i(M,null,j(u.value,(c,p)=>(r(),i("div",{key:p,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[e("div",Le,f(c),1),e("div",Se,[(r(!0),i(M,null,j(T(L),_=>(r(),i("label",{key:_.id,class:"flex items-center space-x-1"},[x(e("input",{type:"radio",name:"leaveType-"+p,value:_.id,"onUpdate:modelValue":m=>o.value[p]=m},null,8,$e),[[W,o.value[p]]]),e("span",null,f(_.leave_type),1)]))),128)),e("label",Ue,[x(e("input",{type:"radio",name:"leaveType-"+p,value:"weekend","onUpdate:modelValue":_=>o.value[p]=_},null,8,Ae),[[W,o.value[p]]]),s[9]||(s[9]=e("span",null,"Weekend",-1))]),e("label",De,[x(e("input",{type:"radio",name:"leaveType-"+p,value:"holiday","onUpdate:modelValue":_=>o.value[p]=_},null,8,Ce),[[W,o.value[p]]]),s[10]||(s[10]=e("span",null,"Holiday",-1))])])]))),128))])])):k("",!0),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),x(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=c=>d.value.reason=c),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[C,d.value.reason]])]),S.value?k("",!0):(r(),i("div",qe,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),B(ve,{modelValue:D.value,"onUpdate:modelValue":s[4]||(s[4]=c=>D.value=c),options:T(w).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),S.value?k("",!0):(r(),i("div",Ve,[s[14]||(s[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),x(e("textarea",{id:"works-in-hand","onUpdate:modelValue":s[5]||(s[5]=c=>d.value.works_in_hand=c),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[C,d.value.works_in_hand]])])),v.value?(r(),i("div",Be,f(v.value),1)):k("",!0),s[15]||(s[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Me={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},Fe={class:"bg-white rounded-lg shadow-lg w-full max-w-3xl"},je={class:"px-6 py-4 border-b"},Re={class:"text-lg font-bold"},Ie={class:"table-auto w-full border"},Ee={class:"p-2"},He=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],We={class:"p-2"},Ye=["onUpdate:modelValue"],ze={class:"p-2"},Oe=["onUpdate:modelValue"],Pe={__name:"UserLeaveBalanceModal",props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0}},emits:["close"],setup(q,{emit:F}){const l=q,h=F,A=fe(),w=O(),$=g([]),L=g(!1);H(()=>l.show,async o=>{var n;o&&((n=l.user)!=null&&n.id)&&!L.value&&(await D(),L.value=!0)}),H(()=>{var o;return(o=l.user)==null?void 0:o.id},()=>{L.value=!1,$.value=[]});const D=async()=>{try{const o=await w.fetchUserLeaveTypes(l.user.id);if(o!=null&&o.length)$.value=o;else{const n=await A.fetchCompanyLeaveTypes(l.user.company_id);$.value=n.data.map(v=>({id:v.id,name:v.name,annual_quota:v.annual_quota||0,max_consecutive_days:v.max_consecutive_days||null,type:v.type||"Paid"}))}}catch(o){console.error("Failed to load leave balances or fallback types:",o)}},S=async()=>{try{await w.saveLeaveBalances(l.user.id,$.value),h("close")}catch(o){console.error("Failed to save leave balances:",o)}},d=()=>{h("close")};return(o,n)=>q.show&&q.user?(r(),i("div",Me,[e("div",Fe,[e("div",je,[e("h3",Re,"Set Leave Balances for "+f(q.user.name),1)]),e("form",{onSubmit:se(S,["prevent"]),class:"p-6 space-y-4"},[e("table",Ie,[n[0]||(n[0]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"p-2"},"Leave Type"),e("th",{class:"p-2"},"Annual Quota"),e("th",{class:"p-2"},"Max Consecutive Days")])],-1)),e("tbody",null,[(r(!0),i(M,null,j($.value,(v,V)=>(r(),i("tr",{key:V},[e("td",Ee,[x(e("input",{type:"hidden","onUpdate:modelValue":u=>v.id=u,class:"input-1 w-full"},null,8,He),[[C,v.id]]),x(e("input",{"onUpdate:modelValue":u=>v.name=u,class:"input-1 w-full",disabled:""},null,8,Ne),[[C,v.name]])]),e("td",We,[x(e("input",{"onUpdate:modelValue":u=>v.annual_quota=u,type:"number",min:"0",class:"input-1 w-full"},null,8,Ye),[[C,v.annual_quota,void 0,{number:!0}]])]),e("td",ze,[x(e("input",{"onUpdate:modelValue":u=>v.max_consecutive_days=u,type:"number",min:"0",class:"input-1 w-full"},null,8,Oe),[[C,v.max_consecutive_days,void 0,{number:!0}]])])]))),128))])]),e("div",{class:"flex justify-end gap-2 pt-4 border-t"},[e("button",{type:"button",onClick:d,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancel "),n[1]||(n[1]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," Save ",-1))])],32)])])):k("",!0)}},Je={class:"space-y-2 px-4"},Ke={class:"flex flex-wrap gap-2"},Qe=["value"],Ge={key:0,class:"text-center py-4"},Xe={key:1,class:"space-y-4"},Ze={key:0,class:"bg-sky-100/30 p-4 rounded-lg shadow mb-6 space-y-6"},et={class:"grid md:grid-cols-2 gap-6"},tt={class:"bg-white border rounded-lg p-4 shadow"},st={class:"overflow-x-auto"},at={class:"min-w-full text-sm text-left text-gray-700 border"},lt={class:"px-4 py-1 text-center font-medium"},ot={class:"px-4 py-1 text-center"},nt={class:"px-4 py-1 text-center"},rt={class:"px-4 py-1 text-center"},dt={class:"overflow-x-auto"},ut={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},it={class:"border border-gray-300 px-2 py-2"},ct={class:"border border-gray-300 px-2 py-2 text-center"},vt={class:"border border-gray-300 px-2 py-2 text-center"},yt={class:"border border-gray-300 px-2 py-2"},pt={class:"border border-gray-300 px-2 py-2"},mt=["innerHTML"],_t={class:"border border-gray-300 px-2 py-2 text-center"},ft={class:"border border-gray-300 px-2 py-2"},bt={class:"border border-gray-300 px-2"},gt={class:"flex justify-center gap-2"},xt=["onClick"],ht={key:0},wt={key:0},kt={class:"text-center py-2",colspan:"6"},Lt={key:0,class:"fixed inset-0 z-[1000] bg-black bg-opacity-50 flex items-center justify-center"},St={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},Nt={__name:"AdminLeaveApplication",setup(q){const F=re(),l=de(),h=le(),A=O(),{user:w,leave_balances:$,leaveApplications:L,loading:D}=Y(h),{userLeaveBalance:S}=Y(A),d=g(l.query.year||h.selectedYear),o=g(l.query.search||""),n=g({company_id:l.query.company_id||"",department_id:l.query.department_id||"all",line_type:l.query.line_type||"all",employee_id:l.query.employee_id||""}),v=g(!1),V=g(!1),u=async()=>{const b={selectedYear:d.value,selectedStatus:h.selectedStatus,query:o.value};n.value.employee_id?(b.user_id=n.value.employee_id,D.value=!0,await h.fetchYearlyUserLeaveApplications(b),D.value=!1):L.value=[]};te(async()=>{await u(),l.query.employee_id&&await A.fetchUserLeaveBalances(l.query.employee_id)}),H(()=>l.query.employee_id,async b=>{b&&await A.fetchUserLeaveBalances(b)});const R=E(()=>L.value||[]),N=()=>F.go(-1),y=async()=>{F.replace({query:{...l.query,company_id:n.value.company_id,department_id:n.value.department_id,line_type:n.value.line_type,employee_id:n.value.employee_id}}),await u()},s=()=>{V.value=!0},c=async()=>{v.value=!1,await u()},p=new Date().getFullYear(),_=g([]);for(let b=2023;b<=p;b++)_.value.push(b);const m=async b=>{confirm("Are you sure to delete this application?")&&(await h.deleteLeaveApplication(b),await u())},U=()=>{V.value=!1,A.fetchUserLeaveBalances(l.query.employee_id)};return(b,a)=>{var J,K;const P=ue("RouterLink");return r(),i(M,null,[e("div",Je,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:N},a[8]||(a[8]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),a[9]||(a[9]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),a[10]||(a[10]=e("div",null,null,-1))]),e("div",Ke,[B(me,{company_id:n.value.company_id,"onUpdate:company_id":a[0]||(a[0]=t=>n.value.company_id=t),department_id:n.value.department_id,"onUpdate:department_id":a[1]||(a[1]=t=>n.value.department_id=t),employee_id:n.value.employee_id,"onUpdate:employee_id":a[2]||(a[2]=t=>n.value.employee_id=t),line_type:n.value.line_type,"onUpdate:line_type":a[3]||(a[3]=t=>n.value.line_type=t),"with-type":!0,"initial-value":b.$route.query,onFilterChange:y},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),e("div",null,[x(e("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>d.value=t),onChange:u,class:"input-1"},[(r(!0),i(M,null,j(_.value,t=>(r(),i("option",{key:t,value:t},f(t),9,Qe))),128))],544),[[ie,d.value]])])]),T(h).loading?(r(),i("div",Ge,[B(ae)])):(r(),i("div",Xe,[(J=n.value)!=null&&J.employee_id?(r(),i("div",Ze,[a[13]||(a[13]=e("h2",{class:"text-xl font-bold text-gray-800 text-center"},"Employee Overview",-1)),e("div",et,[B(_e,{user:T(w)},null,8,["user"]),e("div",tt,[e("div",{class:"flex justify-between items-center"},[a[11]||(a[11]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Leave Balance",-1)),e("button",{onClick:s,type:"button",class:"btn-2"},"Set Leave Balance")]),e("div",st,[e("table",at,[a[12]||(a[12]=e("thead",{class:"bg-gray-100 text-xs uppercase"},[e("tr",null,[e("th",{class:"px-4 py-2 text-center"},"Type"),e("th",{class:"px-4 py-2 text-center"},"Total"),e("th",{class:"px-4 py-2 text-center"},"Used"),e("th",{class:"px-4 py-2 text-center"},"Remaining")])],-1)),e("tbody",null,[(r(!0),i(M,null,j(T(S),t=>(r(),i("tr",{key:t.id,class:"border-t hover:bg-gray-50"},[e("td",lt,f(t.leave_type),1),e("td",ot,f(t.annual_quota),1),e("td",nt,f(t.used_days),1),e("td",rt,f(t.remaining_days),1)]))),128))])])])])])])):k("",!0),e("div",dt,[e("table",ut,[a[18]||(a[18]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Type"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")])],-1)),e("tbody",null,[(r(!0),i(M,null,j(R.value,(t,Q)=>{var G;return r(),i("tr",{key:Q,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",it,f(Q+1),1),e("td",ct,f(t==null?void 0:t.last_working_date),1),e("td",vt,f(t==null?void 0:t.resumption_date),1),e("td",yt,f(t==null?void 0:t.leave_period),1),e("td",pt,[e("div",{innerHTML:(t==null?void 0:t.duration)||(t==null?void 0:t.total_leave_days)},null,8,mt)]),e("td",_t,f([...new Set((G=t==null?void 0:t.leave_days)==null?void 0:G.map(I=>{var X;return(X=I==null?void 0:I.leave_type)==null?void 0:X.name}))].join(",")),1),e("td",ft,f((t==null?void 0:t.status)||"N/A"),1),e("td",bt,[e("div",gt,[B(P,{to:{name:"LeaveApplicationShow",params:{id:t==null?void 0:t.id}},class:"btn-icon",target:"_blank"},{default:ee(()=>a[14]||(a[14]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[14]},1032,["to"]),["Approved","Rejected"].includes(t==null?void 0:t.status)?k("",!0):(r(),z(P,{key:0,to:{name:"LeaveApplicationEdit",params:{id:t==null?void 0:t.id}},class:"btn-icon",target:"_blank"},{default:ee(()=>a[15]||(a[15]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[15]},1032,["to"])),e("button",{onClick:I=>m(t==null?void 0:t.id),class:"btn-icon text-red-500"},a[16]||(a[16]=[e("i",{class:"far fa-trash"},null,-1)]),8,xt)])])])}),128)),R.value.length?k("",!0):(r(),i("tr",ht,a[17]||(a[17]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(K=n.value)!=null&&K.employee_id?(r(),i("tr",wt,[e("th",kt,[e("button",{onClick:a[5]||(a[5]=t=>v.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):k("",!0)])])])]))]),B(Pe,{show:V.value,user:T(w),onClose:U},null,8,["show","user"]),(r(),z(ce,{to:"body"},[v.value?(r(),i("div",Lt,[e("div",St,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:a[6]||(a[6]=t=>v.value=!1)}," × "),B(Te,{userInfo:T(w),onClose:a[7]||(a[7]=t=>v.value=!1),onFormSuccessClosed:c},null,8,["userInfo"])])])):k("",!0)]))],64)}}};export{Nt as default};
