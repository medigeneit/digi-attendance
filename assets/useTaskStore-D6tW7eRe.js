import{b as W,c as D}from"./requirement-EV53ec5p.js";import{S as F,r as v,m as d,Q as i}from"./index-DKvvHbAy.js";const U=F("task",()=>{const o=v([]),k=v([]),h=v([]),y=v(null),u=v(!1),n=v(null),T=v(1),_=v(!0),$=async(s,r,{updateStoreData:e=!0})=>{var t,a;e==!0&&(u.value=!0,n.value=null);try{await i.post(`/tasks/${s}/assign-users`,{user_ids:r}),await w(s)}catch(l){throw e==!0&&(n.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Assign users failed"),l}finally{e==!0&&(u.value=!1)}};function q(){T.value=1,o.value=[]}const E=async(s={})=>{var r,e,t;u.value=!0,n.value=null;try{const a=await W({params:s});o.value=((r=a.data)==null?void 0:r.tasks)||[],console.log({response:a})}catch(a){throw n.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"রিকোয়ারমেন্ট লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching requirements:",a),a}finally{u.value=!1}},A=async(s={})=>{var r,e,t;u.value=!0,n.value=null;try{const a=await D({params:s});o.value=((r=a.data)==null?void 0:r.tasks)||[],console.log({response:a})}catch(a){throw n.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"রিকোয়ারমেন্ট লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching requirements:",a),a}finally{u.value=!1}};async function O(s,r={}){var e,t,a;n.value=null;try{const l={...s,per_page:5e3};u.value=!0;const c=await i.get("/tasks",{params:l,...r});return o.value=((e=c.data)==null?void 0:e.tasks)||[],u.value=!1,c.data}catch(l){throw n.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",l}}const C=async(s,r)=>{var e,t,a;n.value=null;try{const l=await i.get("/my-tasks",{params:s,...r});return o.value=((e=l.data)==null?void 0:e.tasks)||[],l.data}catch(l){throw n.value=((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",l),l}};function g(s,r=0){return Array.isArray(s)===!1||s.length===0?[]:s.filter(e=>(e==null?void 0:e.parent_id)===r).map(e=>({...e,children_tasks:g(s,e.id)}))}function p(){return g(o.value,0)}function M(){const s=[],r=(e,t=0,a="")=>{e.forEach(l=>{s.push({...l,depth:t,idPath:a+l.id}),l.children_tasks&&l.children_tasks.length&&r(l.children_tasks,t+1,a+l.id+"-")})};return r(p()),s}const w=async(s,r={},e={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,a,l,c,m;e.fetchOnly||(u.value=!0),n.value=null;try{const f=await i.get(`/tasks/${s}`,{params:r});return e.fetchOnly||(y.value=((t=f.data)==null?void 0:t.task)||{},h.value=((a=f.data)==null?void 0:a.todos)||{},k.value=((l=f.data)==null?void 0:l.todo_dates)||{},o.value=f.data.sub_tasks||[]),f.data}catch(f){const R=((m=(c=f.response)==null?void 0:c.data)==null?void 0:m.message)||`টাস্ক (ID: ${s}) লোড করতে ব্যর্থ হয়েছে।`;throw e.fetchOnly||(n.value=R),f}finally{e.fetchOnly||(u.value=!1)}},P=async(s,r={loadingBeforeCreate:!1})=>{var e,t,a,l;r.loadingBeforeCreate&&(u.value=!0),n.value=null;try{const c=await i.post("/tasks",s);return(e=c.data)!=null&&e.data&&o.value.push((t=c.data)==null?void 0:t.data),c.data.data}catch(c){throw n.value=((l=(a=c.response)==null?void 0:a.data)==null?void 0:l.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",c),c}finally{r.loadingBeforeCreate&&(u.value=!1)}},b=async(s,r,{loadingBeforeFetch:e=!0})=>{e&&(u.value=!0),n.value=null;try{const t=await i.put(`/tasks/${s}`,r),a=o.value.findIndex(l=>l.id===s);return a!==-1&&(o.value[a]=t.data.data),t.data.data}catch(t){throw t}finally{e&&(u.value=!1)}},x=async(s,r)=>(await i.put(`/tasks/${s}/update-priorities`,{task_ids:r})).data,B=async s=>{var r,e;u.value=!0,n.value=null;try{await i.delete(`/tasks/${s}`),o.value=o.value.filter(t=>t.id!==s)}catch(t){throw n.value=((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.message)||`টাস্ক (ID: ${s}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${s}:`,t),t}finally{u.value=!1}},L=async(s,r)=>{var e,t;u.value=!0,n.value=null;try{await i.patch(`/tasks/${s}/update-requirement-detail/${r}`),o.value=o.value.filter(a=>a.id!==s)}catch(a){throw n.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||`টাস্ক (ID: ${s}) রেকয়্যারমেন্ট সেট করতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${s}:`,a),a}finally{u.value=!1}};return{tasks:d(()=>o.value),task_todos:d(()=>h.value),task_todo_dates:d(()=>k.value),task:d(()=>y.value),loading:d(()=>u.value),error:d(()=>n.value),taskListTree:d(p),flattenedTasks:d(M),fetchAllTasks:E,fetchAllMyTasks:A,fetchTasks:O,hasMoreTask:_,fetchMyTasks:C,resetTaskList:q,fetchTask:w,createTask:P,updateTask:b,deleteTask:B,assignUsers:$,updateTaskPriorities:x,setTaskRequirement:L}});export{U as u};
