import{u as F,d as z,r as _,s as q,e as Y,A as D,x as L,a5 as J,m as O,c as p,o as v,a,f as P,n as T,i as G,j as K,w as Q,g as U,h as f,v as g,t as w,F as A,y as C,q as X,k as E,a6 as S}from"./index-DQONqKpV.js";import{L as Z}from"./LoaderView-CsKc_L0i.js";import{_ as I}from"./MultiselectDropdown-Bi9o_rrm.js";import{u as ee}from"./holiday-Dg4cTdKH.js";import{u as ae}from"./leave-application-Ctd60Oa2.js";import{u as te}from"./leave-type-BUAR8X8U.js";import{u as se}from"./user-CHyf_T8R.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-pg8SNG6m.js";const le={class:"my-container max-w-3xl space-y-4"},ne={class:"flex items-center justify-between gap-2"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={key:0,class:""},ie={class:"text-blue-600 font-medium"},de={key:1,class:"bg-gray-100 p-2 rounded-md"},ue={class:"font-semibold"},me={class:"flex flex-wrap gap-2"},ve=["name","value","onUpdate:modelValue","disabled"],pe={class:"flex items-center space-x-1"},ce=["name","onUpdate:modelValue"],fe={class:"flex items-center space-x-1"},_e=["name","onUpdate:modelValue"],ye={key:2,class:"flex items-start gap-3 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700 shadow-sm"},ge={class:"flex-1 text-sm leading-5"},we={class:"mt-0.5"},Te={__name:"LeaveApplicationAdd",setup(ke){const V=F(),R=ae(),r=z();te();const c=se(),B=ee(),k=_(""),{userLeaveBalance:b}=q(c),o=_({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),d=_([]),h=_([]),x=_(!1),y=_(null);Y(async()=>{var t;try{(t=r==null?void 0:r.user)!=null&&t.id&&c.userLeaveBalance.length===0&&await c.fetchUserLeaveBalances(r.user.id),await c.fetchTypeWiseEmployees({except:"auth"})}catch(e){console.error("Error while initializing leave form:",e)}}),D(()=>{var t;return(t=r.user)==null?void 0:t.id},async t=>{t&&c.userLeaveBalance.length===0&&await c.fetchUserLeaveBalances(t)});const W=L(()=>{var t,e,i;return((e=(t=r==null?void 0:r.user)==null?void 0:t.assign_weekend)==null?void 0:e.weekends)||((i=r==null?void 0:r.user)==null?void 0:i.weekends)}),u=L(()=>{const t=o.value.last_working_date,e=o.value.resumption_date;if(!t||!e)return[];const i=new Date(t),s=new Date(e);if(s<=i)return[];const n=[];let l=new Date(i);for(l.setDate(l.getDate()+1);l<s;){const m=l.getFullYear(),$=(l.getMonth()+1).toString().padStart(2,"0"),j=l.getDate().toString().padStart(2,"0");n.push(`${m}-${$}-${j}`),l.setDate(l.getDate()+1)}return n}),H=L(()=>{const t=o.value.last_working_date,e=o.value.resumption_date;if(!t||!e)return"";const i=new Date(t);return new Date(e)<=i?"Resumption date must be after Last Working Date.":u.value.length===0?"No leave days between the selected dates.":`Total leave days: ${u.value.length}`});J(async()=>{var t;u.value.length&&b.value.length&&(await B.fetchHolidays({company_id:(t=r==null?void 0:r.user)==null?void 0:t.company_id,start_date:u.value[0],end_date:u.value[u.value.length-1]}),u.value.forEach(async(e,i)=>{const s=new Date(e).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),n=s.charAt(0).toUpperCase()+s.slice(1);W.value.includes(n)&&(d.value[i]="weekend"),B.holidayDates.includes(e)&&(d.value[i]="holiday")}))}),D(()=>k.value,t=>{o.value.handover_user_id=t==null?void 0:t.id}),D(d,t=>{const e={};t.forEach(s=>{typeof s=="number"&&(e[s]=(e[s]||0)+1)});const i=b.value.filter(s=>(e[s.id]||0)>s.remaining_days);i.length?(h.value=i.map(s=>s.name),alert(`You have exceeded remaining days for: ${h.value.join(", ")}`)):h.value=[]});const M=async()=>{var t;x.value=!0,y.value=null;try{const e=u.value.map((l,m)=>({date:l,leave_type_id:d.value[m]!=="weekend"&&d.value[m]!=="holiday"?d.value[m]:null})).filter(l=>l.leave_type_id!==null),i=u.value.map((l,m)=>({date:l,leave_type_id:d.value[m]||""})).filter(l=>l.leave_type_id!==null),s={user_id:(t=r==null?void 0:r.user)==null?void 0:t.id,last_working_date:o.value.last_working_date,resumption_date:o.value.resumption_date,reason:o.value.reason,works_in_hand:o.value.works_in_hand,handover_user_id:o.value.handover_user_id,leave_days:e,json_data:i},n=await R.storeLeaveApplication(s);n&&V.push({name:"LeaveApplicationShow",params:{id:n==null?void 0:n.id}})}catch(e){y.value=e.message||"Failed to submit leave application"}finally{x.value=!1}},N=()=>{V.go(-1)};return(t,e)=>{const i=O("RouterLink");return v(),p("div",le,[a("div",ne,[a("button",{class:"btn-3",onClick:N},e[5]||(e[5]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=a("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),a("div",null,[T(i,{to:"/applications",class:"btn-2"},{default:G(()=>e[6]||(e[6]=[K("Home")])),_:1,__:[6]})])]),x.value?(v(),P(Z,{key:0})):(v(),p("form",{key:1,onSubmit:Q(M,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[a("div",oe,[a("div",null,[e[8]||(e[8]=a("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),f(a("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=s=>o.value.last_working_date=s),class:"input-1 w-full",required:""},null,512),[[g,o.value.last_working_date]])]),a("div",null,[e[9]||(e[9]=a("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),f(a("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=s=>o.value.resumption_date=s),class:"input-1 w-full",required:""},null,512),[[g,o.value.resumption_date]])])]),o.value.last_working_date&&o.value.resumption_date?(v(),p("div",re,[a("p",ie,w(H.value),1)])):U("",!0),u.value.length?(v(),p("div",de,[e[12]||(e[12]=a("h2",{class:"text-lg font-semibold"},"Leave Days ",-1)),a("div",null,[(v(!0),p(A,null,C(u.value,(s,n)=>(v(),p("div",{key:n,class:X(["flex gap-4 mb-2 bg-white p-2 rounded-md",{"!bg-red-500":d.value[n]==="Weekend"}])},[a("div",ue,w(s),1),a("div",me,[(v(!0),p(A,null,C(E(b),l=>(v(),p("label",{key:l.id,class:"flex items-center space-x-1"},[f(a("input",{type:"radio",name:"leaveType-"+n,value:l.id,"onUpdate:modelValue":m=>d.value[n]=m,disabled:d.value.filter(m=>m===l.id).length>=l.remaining_days},null,8,ve),[[S,d.value[n]]]),a("span",null,w(l.leave_type),1)]))),128)),a("label",pe,[f(a("input",{type:"radio",name:"leaveType-"+n,value:"weekend","onUpdate:modelValue":l=>d.value[n]=l},null,8,ce),[[S,d.value[n]]]),e[10]||(e[10]=a("span",null,"Weekend",-1))]),a("label",fe,[f(a("input",{type:"radio",name:"leaveType-"+n,value:"holiday","onUpdate:modelValue":l=>d.value[n]=l},null,8,_e),[[S,d.value[n]]]),e[11]||(e[11]=a("span",null,"Holiday",-1))])])],2))),128))])])):U("",!0),a("div",null,[e[13]||(e[13]=a("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),f(a("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=s=>o.value.reason=s),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[g,o.value.reason]])]),a("div",null,[e[14]||(e[14]=a("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),T(I,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=s=>k.value=s),options:E(c).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])]),a("div",null,[e[15]||(e[15]=a("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),f(a("textarea",{id:"works-in-hand","onUpdate:modelValue":e[4]||(e[4]=s=>o.value.works_in_hand=s),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[g,o.value.works_in_hand]])]),y.value?(v(),p("div",ye,[e[17]||(e[17]=a("div",{class:"flex-shrink-0"},[a("i",{class:"fas fa-exclamation-triangle text-red-500"})],-1)),a("div",ge,[e[16]||(e[16]=a("p",{class:"font-medium"},"Something went wrong!",-1)),a("p",we,w(y.value),1)])])):U("",!0),e[18]||(e[18]=a("div",{class:"flex justify-end"},[a("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{Te as default};
