import{D as L,x as A,c as p,o as r,a as t,d as B,m as e,j as f,k as y,v as $,H as D,F as U,e as S,t as u,s as C,w as W,r as I,q as P,y as X,b as V,Q as G,h as Y,i as Z}from"./index-CU9x6Hhu.js";import{useBloodDonorAdminStore as M}from"./bloodDonorAdmin-DcVDg5GY.js";import{_ as R}from"./EmployeeFilter-BcXD1XCh.js";import{u as tt}from"./user-DFy7ZEnP.js";import"./company-BigvQK01.js";import"./department-CPuWsILF.js";import"./EmployeeDropdownInput-I2PIRFwx.js";import"./SelectDropdown-TP-n70ML.js";import"./UserChip-Bn0SdRmp.js";const et={class:"rounded-xl border border-zinc-200 bg-white p-4"},st={class:"mb-4 rounded-lg border border-zinc-200 bg-zinc-50 p-2"},it={class:"grid grid-cols-1 gap-3 md:grid-cols-4"},lt={class:"space-y-1"},ot={class:"space-y-1"},nt={class:"space-y-1"},at=["value"],dt={class:"space-y-1"},rt={key:0,class:"space-y-1"},pt={class:"space-y-1"},ct={class:"space-y-1"},ut={class:"space-y-1"},mt={class:"flex items-end gap-2"},xt={class:"flex-1 space-y-1"},bt=["disabled"],vt={__name:"BloodDonorFilters",setup(v){const x=M(),{filters:d,loading:g}=L(x),b=A(()=>d.value.availability==="soon"),w=["A+","A-","B+","B-","AB+","AB-","O+","O-"];return(k,i)=>(r(),p("div",et,[t("div",st,[B(R,{company_id:e(d).company_id,"onUpdate:company_id":i[0]||(i[0]=a=>e(d).company_id=a),department_id:e(d).department_id,"onUpdate:department_id":i[1]||(i[1]=a=>e(d).department_id=a),employee_id:e(d).employee_id,"onUpdate:employee_id":i[2]||(i[2]=a=>e(d).employee_id=a),line_type:e(d).line_type,"onUpdate:line_type":i[3]||(i[3]=a=>e(d).line_type=a),"with-type":!0,"initial-value":e(d),class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"])]),t("div",it,[t("div",lt,[i[14]||(i[14]=t("label",{class:"text-xs text-zinc-600"},"Search",-1)),y(t("input",{"onUpdate:modelValue":i[4]||(i[4]=a=>e(d).search=a),class:"input-1 h-9 w-full text-sm",placeholder:"Name / phone / ID"},null,512),[[$,e(d).search,void 0,{trim:!0}]])]),t("div",ot,[i[15]||(i[15]=t("label",{class:"text-xs text-zinc-600"},"Address",-1)),y(t("input",{"onUpdate:modelValue":i[5]||(i[5]=a=>e(d).address=a),class:"input-1 h-9 w-full text-sm",placeholder:"Street, city, area"},null,512),[[$,e(d).address,void 0,{trim:!0}]])]),t("div",nt,[i[17]||(i[17]=t("label",{class:"text-xs text-zinc-600"},"Blood Group",-1)),y(t("select",{"onUpdate:modelValue":i[6]||(i[6]=a=>e(d).blood_group=a),class:"input-1 h-9 w-full text-sm"},[i[16]||(i[16]=t("option",{value:""},"All",-1)),(r(),p(U,null,S(w,a=>t("option",{key:a,value:a},u(a),9,at)),64))],512),[[D,e(d).blood_group]])]),t("div",dt,[i[19]||(i[19]=t("label",{class:"text-xs text-zinc-600"},"Availability",-1)),y(t("select",{"onUpdate:modelValue":i[7]||(i[7]=a=>e(d).availability=a),class:"input-1 h-9 w-full text-sm"},i[18]||(i[18]=[t("option",{value:"all"},"All",-1),t("option",{value:"available"},"Available",-1),t("option",{value:"not_available"},"Not Available",-1),t("option",{value:"soon"},"Reset in 15 days",-1)]),512),[[D,e(d).availability]])]),b.value?(r(),p("div",rt,[i[20]||(i[20]=t("label",{class:"text-xs text-zinc-600"},"Soon Days",-1)),y(t("input",{"onUpdate:modelValue":i[8]||(i[8]=a=>e(d).soon_days=a),type:"number",min:"1",max:"365",class:"input-1 h-9 w-full text-sm"},null,512),[[$,e(d).soon_days,void 0,{number:!0}]])])):f("",!0),t("div",pt,[i[22]||(i[22]=t("label",{class:"text-xs text-zinc-600"},"Status",-1)),y(t("select",{"onUpdate:modelValue":i[9]||(i[9]=a=>e(d).status=a),class:"input-1 h-9 w-full text-sm"},i[21]||(i[21]=[t("option",{value:""},"All",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1),t("option",{value:"blocked"},"Blocked",-1)]),512),[[D,e(d).status]])]),t("div",ct,[i[23]||(i[23]=t("label",{class:"text-xs text-zinc-600"},"Last Donation From",-1)),y(t("input",{"onUpdate:modelValue":i[10]||(i[10]=a=>e(d).last_donation_from=a),type:"date",class:"input-1 h-9 w-full text-sm"},null,512),[[$,e(d).last_donation_from]])]),t("div",ut,[i[24]||(i[24]=t("label",{class:"text-xs text-zinc-600"},"Last Donation To",-1)),y(t("input",{"onUpdate:modelValue":i[11]||(i[11]=a=>e(d).last_donation_to=a),type:"date",class:"input-1 h-9 w-full text-sm"},null,512),[[$,e(d).last_donation_to]])]),t("div",mt,[t("div",xt,[i[26]||(i[26]=t("label",{class:"text-xs text-zinc-600"},"Per Page",-1)),y(t("select",{"onUpdate:modelValue":i[12]||(i[12]=a=>e(d).per_page=a),class:"input-1 h-9 w-full text-sm"},i[25]||(i[25]=[t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1)]),512),[[D,e(d).per_page,void 0,{number:!0}]])]),t("button",{class:"btn-3 h-9",disabled:e(g),onClick:i[13]||(i[13]=a=>e(x).resetFilters())}," Reset ",8,bt)])])]))}},yt={class:"rounded-2xl border border-zinc-200 bg-white shadow-sm"},gt={class:"flex items-center justify-between border-b border-zinc-100 px-4 py-3"},_t={class:"text-xs text-zinc-500"},ft={key:0},ht={key:1},zt={class:"max-h-[70vh] overflow-auto"},wt={class:"w-full table-fixed"},kt={class:"divide-y divide-zinc-100 text-[13px]"},$t=["onClick"],At={class:"px-4 py-3 font-medium text-zinc-900"},Nt={class:"px-4 py-3"},Ut={class:"flex items-start gap-3"},Dt={class:"mt-0.5 flex h-9 w-9 shrink-0 items-center justify-center rounded-xl bg-zinc-100 text-xs font-bold text-zinc-700"},Bt={class:"min-w-0"},St={class:"flex items-center gap-2"},Ct={class:"truncate font-semibold text-zinc-900"},Vt={key:0,class:"text-[11px] text-zinc-500"},Pt={class:"mt-1 flex flex-wrap items-center gap-x-2 gap-y-1 text-[11px] text-zinc-500"},jt={class:"truncate"},Lt=["title"],Mt={class:"px-4 py-3 font-semibold text-zinc-900"},Et={class:"px-4 py-3"},Ft={class:"flex items-center gap-2"},Tt={key:0,class:"text-[11px] text-zinc-500"},Ot={key:0,class:"mt-1 line-clamp-1 text-[11px] text-zinc-500"},Ht={class:"px-4 py-3 text-zinc-800"},Gt={class:"font-medium"},It={class:"px-4 py-3"},Rt={class:"sticky right-0 px-4 py-3 bg-white border-l border-zinc-100 text-right"},Kt=["onClick"],qt={key:0},Jt={__name:"BloodDonorTable",props:{donors:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},meta:{type:Object,default:()=>({page:1,per_page:25})}},emits:["edit"],setup(v,{emit:x}){const d=v,g=x,b=A(()=>{var l,h;const n=Number(((l=d.meta)==null?void 0:l.page)||1),o=Number(((h=d.meta)==null?void 0:h.per_page)||25);return(n-1)*o}),w=n=>n===!0||n===1||n==="1"||n==="true",k=n=>w(n==null?void 0:n.is_available),i=n=>k(n)?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":"bg-rose-50 text-rose-700 ring-1 ring-rose-200",a=n=>{switch(String(n||"").toLowerCase()){case"active":return"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200";case"inactive":return"bg-amber-50 text-amber-700 ring-1 ring-amber-200";case"blocked":return"bg-rose-50 text-rose-700 ring-1 ring-rose-200";default:return"bg-zinc-50 text-zinc-700 ring-1 ring-zinc-200"}},z=n=>{if(!n)return"—";const o=new Date(n);return Number.isNaN(o.getTime())?"—":o.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})};return(n,o)=>(r(),p("div",yt,[t("div",gt,[o[0]||(o[0]=t("div",null,[t("div",{class:"text-sm font-semibold text-zinc-900"},"Donor List"),t("div",{class:"text-xs text-zinc-500"},"Click row or press History to update")],-1)),t("div",_t,[v.loading?(r(),p("span",ft,"Loading…")):(r(),p("span",ht,u(v.donors.length)+" rows",1))])]),t("div",zt,[t("table",wt,[o[4]||(o[4]=t("colgroup",null,[t("col",{class:"w-14"}),t("col",{class:"w-[320px]"}),t("col",{class:"w-20"}),t("col",{class:"w-[230px]"}),t("col",{class:"w-36"}),t("col",{class:"w-28"}),t("col",{class:"w-28"})],-1)),o[5]||(o[5]=t("thead",{class:"sticky top-0 z-20 bg-zinc-50"},[t("tr",{class:"text-left text-[11px] font-semibold uppercase tracking-wide text-zinc-600"},[t("th",{class:"px-4 py-3"},"SL"),t("th",{class:"px-4 py-3"},"Donor"),t("th",{class:"px-4 py-3"},"Blood"),t("th",{class:"px-4 py-3"},"Availability"),t("th",{class:"px-4 py-3"},"Last donation"),t("th",{class:"px-4 py-3"},"Status"),t("th",{class:"sticky right-0 px-4 py-3 text-right bg-zinc-50 border-l border-zinc-100"}," Action ")])],-1)),t("tbody",kt,[v.loading?(r(),p(U,{key:0},S(10,l=>t("tr",{key:`sk-${l}`,class:"animate-pulse"},o[1]||(o[1]=[t("td",{class:"px-4 py-3"},[t("div",{class:"h-3 w-8 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-3"},[t("div",{class:"h-3 w-64 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-3"},[t("div",{class:"h-3 w-10 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-3"},[t("div",{class:"h-3 w-44 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-3"},[t("div",{class:"h-3 w-24 rounded bg-zinc-100"})],-1),t("td",{class:"px-4 py-3"},[t("div",{class:"h-3 w-16 rounded bg-zinc-100"})],-1),t("td",{class:"sticky right-0 px-4 py-3 bg-white border-l border-zinc-100"},[t("div",{class:"ml-auto h-8 w-20 rounded bg-zinc-100"})],-1)]))),64)):(r(),p(U,{key:1},[(r(!0),p(U,null,S(v.donors,(l,h)=>(r(),p("tr",{key:l==null?void 0:l.id,class:"group cursor-pointer hover:bg-sky-100",onClick:N=>g("edit",l),title:"Open history update"},[t("td",At,u(b.value+h+1),1),t("td",Nt,[t("div",Ut,[t("div",Dt,u(((l==null?void 0:l.blood)||"—").slice(0,2)),1),t("div",Bt,[t("div",St,[t("div",Ct,u((l==null?void 0:l.name)||"N/A"),1),l!=null&&l.id?(r(),p("span",Vt,"#"+u(l.id),1)):f("",!0)]),t("div",Pt,[t("span",jt,u((l==null?void 0:l.phone)||"N/A"),1),o[2]||(o[2]=t("span",{class:"text-zinc-300"},"•",-1)),t("span",{class:"truncate",title:(l==null?void 0:l.address)||""},u((l==null?void 0:l.address)||"N/A"),9,Lt)])])])]),t("td",Mt,u((l==null?void 0:l.blood)||"N/A"),1),t("td",Et,[t("div",Ft,[t("span",{class:C(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold",i(l)])},u(k(l)?"Available":"Not available"),3),l!=null&&l.available_from?(r(),p("span",Tt," From "+u(z(l.available_from)),1)):f("",!0)]),l!=null&&l.availability_note?(r(),p("div",Ot,u(l.availability_note),1)):f("",!0)]),t("td",Ht,[t("span",Gt,u(z(l==null?void 0:l.last_donation_date)),1)]),t("td",It,[t("span",{class:C(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold",a(l==null?void 0:l.status)])},u((l==null?void 0:l.status)||"N/A"),3)]),t("td",Rt,[t("button",{type:"button",class:"inline-flex items-center justify-center rounded-lg border border-indigo-200 bg-indigo-50 px-3 py-2 text-[11px] font-semibold text-indigo-700 hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-indigo-200",onClick:W(N=>g("edit",l),["stop"])}," History ",8,Kt)])],8,$t))),128)),v.donors.length===0?(r(),p("tr",qt,o[3]||(o[3]=[t("td",{colspan:"7",class:"px-4 py-12 text-center text-sm text-zinc-500"}," No donors found. ",-1)]))):f("",!0)],64))])])])]))}},Qt={class:"flex flex-col items-center justify-between gap-2 rounded-lg border border-zinc-200 bg-white px-4 py-3 text-sm md:flex-row"},Wt={class:"text-zinc-600"},Xt={class:"flex items-center gap-1"},Yt=["disabled"],Zt=["onClick"],te=["disabled"],ee={__name:"PaginationBar",props:{page:{type:Number,default:1},perPage:{type:Number,default:15},total:{type:Number,default:0},lastPage:{type:Number,default:1}},emits:["page-change"],setup(v,{emit:x}){const d=v,g=x,b=A(()=>d.total===0?0:(d.page-1)*d.perPage+1),w=A(()=>d.total===0?0:Math.min(d.total,d.page*d.perPage)),k=A(()=>{const a=Math.max(1,Number(d.lastPage||1)),z=Math.min(a,Math.max(1,Number(d.page||1)));if(a<=7)return Array.from({length:a},(l,h)=>h+1);let n=Math.max(1,z-3),o=n+6;return o>a&&(o=a,n=o-6),Array.from({length:o-n+1},(l,h)=>n+h)}),i=a=>g("page-change",a);return(a,z)=>(r(),p("div",Qt,[t("div",Wt," Showing "+u(b.value)+"-"+u(w.value)+" of "+u(v.total),1),t("div",Xt,[t("button",{type:"button",class:"h-8 rounded-md border border-zinc-300 px-2 text-xs font-semibold text-zinc-600 hover:bg-zinc-50 disabled:opacity-50",disabled:v.page<=1,onClick:z[0]||(z[0]=n=>i(v.page-1))}," Prev ",8,Yt),(r(!0),p(U,null,S(k.value,n=>(r(),p("button",{key:n,type:"button",class:C(["h-8 w-8 rounded-md border text-xs font-semibold",n===v.page?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-zinc-300 text-zinc-600 hover:bg-zinc-50"]),onClick:o=>i(n)},u(n),11,Zt))),128)),t("button",{type:"button",class:"h-8 rounded-md border border-zinc-300 px-2 text-xs font-semibold text-zinc-600 hover:bg-zinc-50 disabled:opacity-50",disabled:v.page>=v.lastPage,onClick:z[1]||(z[1]=n=>i(v.page+1))}," Next ",8,te)])]))}},se={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center px-4 py-6 top-4"},ie={class:"relative w-full max-w-6xl overflow-hidden rounded-2xl bg-white shadow-2xl ring-1 ring-black/5"},le={class:"sticky top-0 z-20 flex items-start justify-between gap-3 border-b bg-white/90 px-6 py-4 backdrop-blur"},oe=["disabled"],ne={class:"max-h-[76vh] overflow-y-auto px-6 py-5"},ae={key:0,class:"mb-4 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700"},de={class:"mb-5 rounded-2xl border border-zinc-200 bg-white p-4"},re={class:"mb-2 flex items-start justify-between gap-3"},pe={key:0,class:"rounded-full bg-zinc-100 px-2.5 py-1 text-xs text-zinc-700"},ce={class:"font-semibold"},ue={class:"grid grid-cols-1 gap-5 lg:grid-cols-12"},me={class:"lg:col-span-4 space-y-5"},xe={class:"rounded-2xl border border-zinc-200 bg-white p-4"},be={key:0,class:"space-y-2 text-sm"},ve={class:"flex justify-between gap-3"},ye={class:"font-medium text-zinc-900 text-right"},ge={class:"flex justify-between gap-3"},_e={class:"font-medium text-zinc-900"},fe={class:"flex justify-between gap-3"},he={class:"font-medium text-zinc-900 text-right"},ze={key:1,class:"text-sm text-zinc-500"},we={class:"rounded-2xl border border-zinc-200 bg-white p-4"},ke={class:"mb-3 flex items-start justify-between gap-3"},$e={key:0,class:"text-xs text-zinc-500"},Ae={key:0,class:"rounded-xl border border-rose-200 bg-rose-50 px-3 py-3 text-sm text-rose-700"},Ne={key:1,class:"space-y-2"},Ue={key:2,class:"rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-3 text-sm text-zinc-600"},De={key:3,class:"max-h-[320px] overflow-auto pr-1 space-y-2"},Be={class:"flex items-start justify-between gap-3"},Se={class:"min-w-0"},Ce={class:"text-sm font-semibold text-zinc-900"},Ve={class:"mt-0.5 text-xs text-zinc-500"},Pe={key:0,class:"mt-1 line-clamp-2 text-xs text-zinc-600"},je={class:"flex flex-col items-end gap-1 shrink-0"},Le={class:"lg:col-span-8 space-y-5"},Me={class:"rounded-2xl border border-zinc-200 bg-white p-4"},Ee={class:"mb-3 flex items-start justify-between gap-3"},Fe={key:0,class:"text-xs text-zinc-500"},Te={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Oe={class:"flex items-center justify-between rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-2"},He=["disabled"],Ge={class:"flex items-center justify-between rounded-xl border border-zinc-200 bg-zinc-50 px-3 py-2"},Ie=["disabled"],Re={class:"space-y-1"},Ke=["disabled"],qe={key:0,class:"text-xs text-rose-600"},Je={class:"space-y-1"},Qe=["disabled"],We={class:"space-y-1 md:col-span-2"},Xe=["disabled"],Ye={key:0,class:"space-y-1 md:col-span-2"},Ze=["disabled"],ts={class:"rounded-2xl border border-zinc-200 bg-white p-4"},es={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ss={class:"space-y-1"},is=["disabled"],ls={class:"space-y-1 md:col-span-2"},os=["disabled"],ns={class:"sticky bottom-0 z-20 flex items-center justify-between border-t bg-zinc-50 px-6 py-3"},as={class:"flex items-center gap-2"},ds=["disabled"],rs=["disabled"],ps={key:0},cs={key:1},us={__name:"DonorAdminModal",setup(v){const x=M(),d=tt(),{modalOpen:g,saving:b,formError:w,errors:k,selectedUser:i,histories:a,loadingHistories:z,historiesError:n,form:o}=L(x),l=I({company_id:"",department_id:"",employee_id:"",line_type:"all"}),h=A(()=>i.value),N=()=>x.closeModal(),j=m=>{m.key==="Escape"&&N()};P(g,m=>{var s;m?(window.addEventListener("keydown",j),(s=i.value)!=null&&s.id&&(l.value.employee_id=String(i.value.id))):(window.removeEventListener("keydown",j),l.value={company_id:"",department_id:"",employee_id:"",line_type:"all"})},{immediate:!0}),X(()=>window.removeEventListener("keydown",j)),P(()=>o.value.last_donation_date,m=>x.setLastDonationDate(m)),P(()=>o.value.has_disease,m=>{m||(o.value.disease_note="")});const E=m=>{var _;const s=(_=k.value)==null?void 0:_[m];return s?Array.isArray(s)?s[0]||"":String(s):""},K=m=>m===!0||m===1||m==="1"||m==="true",F=m=>K(m==null?void 0:m.is_available),q=m=>F(m)?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":"bg-rose-50 text-rose-700 ring-1 ring-rose-200",J=m=>m==="active"?"bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200":m==="inactive"?"bg-amber-50 text-amber-700 ring-1 ring-amber-200":m==="blocked"?"bg-rose-50 text-rose-700 ring-1 ring-rose-200":"bg-zinc-50 text-zinc-700 ring-1 ring-zinc-200",T=m=>{if(!m)return"—";const s=new Date(m);return Number.isNaN(s.getTime())?"—":s.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})},Q=async m=>{if(!m)return;const _=await d.fetchUser(m)||d.user;_!=null&&_.id&&x.openModalForUser({id:_.id,name:_.name,phone:_.phone,blood_group:_.blood_group||_.blood,address:_.address,alternate_phone:_.alternate_phone})};return(m,s)=>{var _,O,H;return e(g)?(r(),p("div",se,[t("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-[2px]",onClick:s[0]||(s[0]=c=>e(b)?null:N)}),t("div",ie,[t("div",le,[s[15]||(s[15]=t("div",{class:"space-y-0.5"},[t("h3",{class:"text-base font-semibold text-zinc-900"},"Update Donor Profile"),t("p",{class:"text-xs text-zinc-500"},"Admin panel • update donor availability & donation entry")],-1)),t("button",{type:"button",class:"inline-flex h-9 w-9 items-center justify-center rounded-full text-zinc-500 hover:bg-zinc-100 hover:text-zinc-700 disabled:opacity-50",onClick:N,disabled:e(b),"aria-label":"Close",title:"Close"},s[14]||(s[14]=[t("i",{class:"far fa-times"},null,-1)]),8,oe)]),t("div",ne,[e(w)?(r(),p("div",ae,u(e(w)),1)):f("",!0),t("div",de,[t("div",re,[s[17]||(s[17]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Select employee"),t("p",{class:"text-xs text-zinc-500"},"Choose who you want to update")],-1)),(_=h.value)!=null&&_.blood_group?(r(),p("span",pe,[s[16]||(s[16]=V(" Blood: ")),t("b",ce,u(h.value.blood_group),1)])):f("",!0)]),B(R,{company_id:l.value.company_id,"onUpdate:company_id":s[1]||(s[1]=c=>l.value.company_id=c),department_id:l.value.department_id,"onUpdate:department_id":s[2]||(s[2]=c=>l.value.department_id=c),employee_id:l.value.employee_id,"onUpdate:employee_id":[s[3]||(s[3]=c=>l.value.employee_id=c),Q],line_type:l.value.line_type,"onUpdate:line_type":s[4]||(s[4]=c=>l.value.line_type=c),"with-type":!0,"initial-value":l.value,class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"])]),t("div",ue,[t("div",me,[t("div",xe,[s[21]||(s[21]=t("div",{class:"mb-3"},[t("h4",{class:"text-sm font-semibold text-zinc-900"},"User info")],-1)),h.value?(r(),p("div",be,[t("div",ve,[s[18]||(s[18]=t("span",{class:"text-zinc-500"},"Name",-1)),t("span",ye,u(h.value.name||"N/A"),1)]),t("div",ge,[s[19]||(s[19]=t("span",{class:"text-zinc-500"},"Phone",-1)),t("span",_e,u(h.value.phone||"N/A"),1)]),t("div",fe,[s[20]||(s[20]=t("span",{class:"text-zinc-500"},"Address",-1)),t("span",he,u(h.value.address||"N/A"),1)])])):(r(),p("div",ze,"Select an employee to view details."))]),t("div",we,[t("div",ke,[s[22]||(s[22]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Donation history")],-1)),(O=e(a))!=null&&O.length?(r(),p("span",$e,u(e(a).length)+" items",1)):f("",!0)]),e(n)?(r(),p("div",Ae,u(e(n)),1)):e(z)?(r(),p("div",Ne,s[23]||(s[23]=[t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1),t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1),t("div",{class:"h-10 w-full animate-pulse rounded-xl bg-zinc-100"},null,-1)]))):(H=e(a))!=null&&H.length?(r(),p("div",De,[(r(!0),p(U,null,S(e(a),c=>(r(),p("div",{key:c.id,class:"rounded-xl border border-zinc-200 p-3 hover:bg-zinc-50 transition"},[t("div",Be,[t("div",Se,[t("div",Ce,u(T(c.last_donation_date)),1),t("div",Ve," Available from: "+u(T(c.available_from)),1),c.availability_note?(r(),p("div",Pe,u(c.availability_note),1)):f("",!0)]),t("div",je,[t("span",{class:C(["rounded-full px-2 py-0.5 text-[11px] font-semibold",q(c)])},u(F(c)?"Available":"Not available"),3),t("span",{class:C(["rounded-full px-2 py-0.5 text-[11px] font-semibold",J(c.status)])},u(c.status||"N/A"),3)])])]))),128))])):(r(),p("div",Ue,s[24]||(s[24]=[V(" No donation history yet. "),t("div",{class:"mt-1 text-xs text-zinc-500"},"Create an entry from the form to the right.",-1)])))])]),t("div",Le,[t("div",Me,[t("div",Ee,[s[25]||(s[25]=t("div",null,[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Availability")],-1)),e(o).user_id?(r(),p("span",Fe,"User ID: "+u(e(o).user_id),1)):f("",!0)]),t("div",Te,[t("div",Oe,[s[26]||(s[26]=t("div",null,[t("div",{class:"text-sm font-medium text-zinc-800"},"Available for donation"),t("div",{class:"text-xs text-zinc-500"},"Visible to seekers")],-1)),y(t("input",{"onUpdate:modelValue":s[5]||(s[5]=c=>e(o).is_available=c),type:"checkbox",class:"h-5 w-5",disabled:e(b)},null,8,He),[[G,e(o).is_available]])]),t("div",Ge,[s[27]||(s[27]=t("div",null,[t("div",{class:"text-sm font-medium text-zinc-800"},"Has disease"),t("div",{class:"text-xs text-zinc-500"},"Optional disclosure")],-1)),y(t("input",{"onUpdate:modelValue":s[6]||(s[6]=c=>e(o).has_disease=c),type:"checkbox",class:"h-5 w-5",disabled:e(b)},null,8,Ie),[[G,e(o).has_disease]])]),t("div",Re,[s[28]||(s[28]=t("label",{class:"text-xs font-medium text-zinc-600"},"Last donation date *",-1)),y(t("input",{"onUpdate:modelValue":s[7]||(s[7]=c=>e(o).last_donation_date=c),type:"date",class:"input-1 h-10 w-full text-sm",disabled:e(b)},null,8,Ke),[[$,e(o).last_donation_date]]),E("last_donation_date")?(r(),p("div",qe,u(E("last_donation_date")),1)):f("",!0)]),t("div",Je,[s[29]||(s[29]=t("label",{class:"text-xs font-medium text-zinc-600"},"Available from",-1)),y(t("input",{"onUpdate:modelValue":s[8]||(s[8]=c=>e(o).available_from=c),type:"date",class:"input-1 h-10 w-full text-sm bg-zinc-100",readonly:"",disabled:e(b)},null,8,Qe),[[$,e(o).available_from]])]),t("div",We,[s[30]||(s[30]=t("label",{class:"text-xs font-medium text-zinc-600"},"Availability note",-1)),y(t("input",{"onUpdate:modelValue":s[9]||(s[9]=c=>e(o).availability_note=c),class:"input-1 h-10 w-full text-sm",disabled:e(b)},null,8,Xe),[[$,e(o).availability_note,void 0,{trim:!0}]])]),e(o).has_disease?(r(),p("div",Ye,[s[31]||(s[31]=t("label",{class:"text-xs font-medium text-zinc-600"},"Disease note",-1)),y(t("textarea",{"onUpdate:modelValue":s[10]||(s[10]=c=>e(o).disease_note=c),class:"input-1 min-h-[90px] w-full text-sm",disabled:e(b)},null,8,Ze),[[$,e(o).disease_note,void 0,{trim:!0}]])])):f("",!0)])]),t("div",ts,[s[35]||(s[35]=t("div",{class:"mb-3"},[t("h4",{class:"text-sm font-semibold text-zinc-900"},"Status & notes"),t("p",{class:"text-xs text-zinc-500"},"Visibility + internal remark")],-1)),t("div",es,[t("div",ss,[s[33]||(s[33]=t("label",{class:"text-xs font-medium text-zinc-600"},"Status",-1)),y(t("select",{"onUpdate:modelValue":s[11]||(s[11]=c=>e(o).status=c),class:"input-1 h-10 w-full text-sm",disabled:e(b)},s[32]||(s[32]=[t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1),t("option",{value:"blocked"},"Blocked",-1)]),8,is),[[D,e(o).status]])]),t("div",ls,[s[34]||(s[34]=t("label",{class:"text-xs font-medium text-zinc-600"},"Notes",-1)),y(t("textarea",{"onUpdate:modelValue":s[12]||(s[12]=c=>e(o).notes=c),class:"input-1 min-h-[110px] w-full text-sm",disabled:e(b)},null,8,os),[[$,e(o).notes,void 0,{trim:!0}]])])])])])])]),t("div",ns,[s[36]||(s[36]=t("div",{class:"text-xs text-zinc-500"},[V(" Press "),t("span",{class:"rounded bg-white px-1.5 py-0.5 ring-1 ring-zinc-200"},"Esc"),V(" to close ")],-1)),t("div",as,[t("button",{type:"button",class:"btn-3",onClick:N,disabled:e(b)},"Cancel",8,ds),t("button",{type:"button",class:"btn-1",disabled:e(b)||!e(o).user_id||!e(o).last_donation_date,onClick:s[13]||(s[13]=c=>e(x).saveHistory())},[e(b)?(r(),p("span",ps,"Saving...")):(r(),p("span",cs,"Save"))],8,rs)])])])])):f("",!0)}}},ms={class:"space-y-4 p-5"},xs={key:0,class:"rounded-md border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700"},bs={key:1,class:"rounded-lg border border-dashed border-zinc-300 bg-white p-6 text-center text-sm text-zinc-500"},$s={__name:"BloodDonorList",setup(v){const x=M(),{donors:d,meta:g,loading:b,error:w}=L(x),k=I(!1);Y(async()=>{k.value=!0,await x.fetchDonors()});const i=A(()=>JSON.stringify(x.filters));P(i,async()=>{k.value&&(x.setPage(1),await x.fetchDonors())});const a=async n=>{x.setPage(n),await x.fetchDonors()},z=n=>{x.openModalForUser({id:n.id,name:n.name,phone:n.phone,blood_group:n.blood,address:n.address,alternate_phone:n.alternate_phone}),x.form.user_id=String(n.id),x.form.is_available=!!Number(n.is_available||0),x.form.status=n.status||"inactive",x.form.availability_note=n.availability_note||"",x.form.notes=n.notes||"",x.form.last_donation_date=n.last_donation_date||"",x.setLastDonationDate(x.form.last_donation_date)};return(n,o)=>(r(),p("div",ms,[o[0]||(o[0]=t("div",{class:"flex items-center justify-between"},[t("h1",{class:"title-md md:title-lg"},"Blood Donors"),t("div",{class:"text-sm text-zinc-500"},"Admin only")],-1)),B(vt),e(w)?(r(),p("div",xs,u(e(w)),1)):f("",!0),B(Jt,{donors:e(d),loading:e(b),meta:e(g),onEdit:z},null,8,["donors","loading","meta"]),!e(b)&&e(d).length===0&&!e(w)?(r(),p("div",bs," No donors found. Try adjusting the filters. ")):f("",!0),e(g).total>0?(r(),Z(ee,{key:2,page:e(g).page,"per-page":e(g).per_page,total:e(g).total,"last-page":e(g).last_page,onPageChange:a},null,8,["page","per-page","total","last-page"])):f("",!0),B(us)]))}};export{$s as default};
