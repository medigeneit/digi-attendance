import{u as R,M as $,s as S,r as u,b as C,p as B,o as p,c as v,d as I,v as L,a as n,e as h,t as j,h as k,F as H,x as J,y as F,j as N,g as U,f as V}from"./index-DS9B9Wv1.js";import{u as q}from"./leave-application-DSQYbKt1.js";import{u as D}from"./exchange-DUj6W362.js";import{u as T}from"./short-leave-j-ubBqgS.js";const z={key:0,class:"text-center space-y-2 print:hidden"},G={key:0,class:"mt-2"},Z={class:"flex justify-end gap-2 pt-2"},K={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(x){const f=R(),s=$(),d=D(),{user:_}=S(f),y=x,a=u(null);C(()=>{a.value=JSON.parse(JSON.stringify(y.application))});const l=u(!1),r=u(""),g=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await d.handoverAccept(e),alert("Handover approved!"),await i()},condition:()=>{var e,o;return!((e=a.value)!=null&&e.status)&&((o=a.value)==null?void 0:o.handover_user_id)===_.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await d.inChargeAccept(e),alert("In-Charge approved!"),await i()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await d.recommendByAccept(e),alert("Recommendation approved!"),await i()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await d.approvedByAccept(e),alert("Final approval successful!"),await i()}}],t=B(()=>g.find(e=>{var o,c,m,b;return a.value?e.key==="handover"?e.condition():((o=a.value)==null?void 0:o.status)!=="Rejected"&&((c=a.value)==null?void 0:c.status)!=="Approved"&&!((m=a.value)!=null&&m[e.approved_field])&&((b=a.value)==null?void 0:b[e.approved_by_field])===_.value.id:!1})),w=()=>{l.value&&r.value?(A(),l.value=!1):l.value=!0};async function A(){try{await d.rejectExchange(a.value.id,r.value),alert("Exchange application rejected!"),r.value="",await i(a.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function i(e){await s.markAsRead(y.notificationId)}return(e,o)=>t.value&&a.value?(p(),v("div",z,[l.value?(p(),v("div",G,[I(n("textarea",{"onUpdate:modelValue":o[0]||(o[0]=c=>r.value=c),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[L,r.value]])])):h("",!0),n("div",Z,[n("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:o[1]||(o[1]=c=>t.value.action(a.value.id))}," Approve "),n("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:w}," Reject ")])])):h("",!0)}},P={key:0,class:"text-center space-y-2 print:hidden"},Q={key:0,class:"mt-2"},W={class:"flex justify-end gap-2 pt-2"},X={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(x){const f=R(),s=q(),d=$(),{user:_}=S(f),y=x,a=u(null);C(()=>{a.value=JSON.parse(JSON.stringify(y.application))});const l=u(!1),r=u(""),g=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await s.acceptHandover(e),alert("Handover approved!"),await i()},condition:()=>{var e,o;return!((e=a.value)!=null&&e.status)&&((o=a.value)==null?void 0:o.handover_user_id)===_.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await s.acceptInCharge(e),alert("In-Charge approved!"),await i()}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async e=>{await s.acceptCoordinator(e),alert("Coordinator approved!"),await i()}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async e=>{await s.acceptOperationalAdmin(e),alert("Operational Admin approved!"),await i()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await s.acceptRecommendBy(e),alert("Recommendation approved!"),await i()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await s.acceptApprovedBy(e),alert("Final approval successful!"),await i()}}],t=B(()=>g.find(e=>{var m,b,E,O;if(!a.value)return!1;if(e.key==="handover")return e.condition();const o=!!((m=a.value)!=null&&m[e.approved_field]),c=((b=a.value)==null?void 0:b[e.approved_by_field])===_.value.id;return((E=a.value)==null?void 0:E.status)!=="Rejected"&&((O=a.value)==null?void 0:O.status)!=="Approved"&&!o&&c})),w=()=>{l.value&&r.value?(A(),l.value=!1):l.value=!0};async function A(){try{await s.rejectLeaveApplication(a.value.id,{rejection_reason:r.value}),alert("Application rejected!"),r.value="",await i(a.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function i(e){await d.markAsRead(y.notificationId)}return(e,o)=>t.value&&a.value?(p(),v("div",P,[l.value?(p(),v("div",Q,[I(n("textarea",{"onUpdate:modelValue":o[0]||(o[0]=c=>r.value=c),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[L,r.value]])])):h("",!0),n("div",W,[n("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:o[1]||(o[1]=c=>t.value.action(a.value.id))}," Approve "),n("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:w}," Reject ")])])):h("",!0)}},Y={key:0,class:"text-center space-y-2 print:hidden"},M={key:0,class:"mt-2"},ee={class:"flex justify-end gap-2 pt-2"},ae={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(x){const f=R(),s=T(),d=$(),{user:_}=S(f),y=x,a=u(null);C(()=>{a.value=JSON.parse(JSON.stringify(y.application))});const l=u(!1),r=u(""),g=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await s.handoverAccept(e),alert("Handover approved!"),await i()},condition:()=>{var e,o;return!((e=a.value)!=null&&e.status)&&((o=a.value)==null?void 0:o.handover_user_id)===_.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await s.inChargeAccept(e),alert("In-Charge approved!"),await i()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await s.recommendByAccept(e),alert("Recommendation approved!"),await i()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await s.approvedByAccept(e),alert("Final approval successful!"),await i()}}],t=B(()=>g.find(e=>{var o,c,m,b;return a.value?e.key==="handover"?e.condition():((o=a.value)==null?void 0:o.status)!=="Rejected"&&((c=a.value)==null?void 0:c.status)!=="Approved"&&!((m=a.value)!=null&&m[e.approved_field])&&((b=a.value)==null?void 0:b[e.approved_by_field])===_.value.id:!1})),w=()=>{l.value&&r.value?(A(),l.value=!1):l.value=!0};async function A(){try{await s.rejectShortLeave(a.value.id,r.value),alert("Application rejected!"),r.value="",await i(a.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function i(e){await d.markAsRead(y.notificationId)}return(e,o)=>t.value&&a.value?(p(),v("div",Y,[l.value?(p(),v("div",M,[I(n("textarea",{"onUpdate:modelValue":o[0]||(o[0]=c=>r.value=c),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[L,r.value]])])):h("",!0),n("div",ee,[n("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:o[1]||(o[1]=c=>t.value.action(a.value.id))}," Approve "),n("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:w}," Reject ")])])):h("",!0)}},te={class:"space-y-6 px-4 py-4"},oe={class:"text-2xl font-semibold capitalize text-gray-700"},re={key:0,class:"space-y-4"},ne={class:"flex items-start gap-4"},ie={class:"text-2xl text-blue-500 mt-1"},se={class:"flex-1 space-y-1"},le={class:"text-gray-800 font-medium"},ce={class:"text-gray-600 text-sm"},pe={class:"text-xs text-gray-400"},de={key:1,class:"text-center text-red-500 py-10"},fe={__name:"NotificationList",setup(x){U();const f=V(),s=$(),{notifications:d}=S(s);q();const _=R();S(_),u(!1),u({}),u({}),C(()=>{s.fetchNotifications()});const y=(r,g)=>{if(!r)return"No application details";switch(g){case"leaveApplication":return`Leave: ${r.last_working_date} â†’ ${r.resumption_date}`;case"shortLeave":return`Short Leave on ${r.leave_date??"N/A"}`;case"exchange":return`Exchange (${r.exchange_type}) on ${r.exchange_date}`;default:return"Unknown Event"}},a=r=>{switch(r){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"exchange":return"fas fa-random";default:return"fas fa-bell"}},l=r=>new Date(r).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return(r,g)=>(p(),v("div",te,[n("h2",oe,j(k(f).query.type.replace(/([A-Z])/g," $1")),1),k(d)[k(f).query.type]?(p(),v("div",re,[(p(!0),v(H,null,J(k(d)[k(f).query.type],(t,w)=>(p(),v("div",{key:t.id,class:"bg-white p-4 rounded-xl shadow border space-y-2"},[n("div",ne,[n("div",ie,[n("i",{class:F(a(t.event_type))},null,2)]),n("div",se,[n("p",le,j(t.message),1),n("p",ce,j(y(t.event_model,t.event_type)),1),n("p",pe,j(l(t.created_at)),1)])]),t!=null&&t.event_model&&t.event_type==="leaveApplication"?(p(),N(X,{key:0,application:t.event_model,"notification-id":t.id},null,8,["application","notification-id"])):h("",!0),t!=null&&t.event_model&&t.event_type==="shortLeave"?(p(),N(ae,{key:1,application:t.event_model,"notification-id":t.id},null,8,["application","notification-id"])):h("",!0),t!=null&&t.event_model&&t.event_type==="exchange"?(p(),N(K,{key:2,application:t.event_model,notificationId:t.id},null,8,["application","notificationId"])):h("",!0)]))),128))])):(p(),v("div",de,"No notifications found."))]))}};export{fe as default};
