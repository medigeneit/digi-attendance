import{c as i,o as s,a as e,j as y,r as E,b as H,m as h,g as r,F as U,n as Z,p as D,t as o,q as k,k as g,f,w as p,x as ee,A as te,i as V,G as se}from"./index-CjQ6e_c5.js";import{_ as F,a as ae,b as G,c as J,T as K,d as Q,e as le}from"./TaskSupervisorAndEmployee-CKaAS7Qg.js";import{b as W,a as v}from"./datetime-DLUp6MRA.js";import{o as re}from"./url-CePbr-gY.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ne={},oe={class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"};function de(t,w){return s(),i("div",oe,w[0]||(w[0]=[e("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),y("CLOSED ")]))}const X=ie(ne,[["render",de]]),ce={class:"-mx-3"},ue={key:0,class:"w-full"},xe={class:"border-y text-center py-2 border-gray-200"},ge={key:0,class:"text-base font-semibold text-purple-600"},ye={class:"border px-3 py-1 border-gray-200 relative"},me={class:"flex items-center justify-between"},fe={class:"flex items-center gap-3"},ke={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},be={class:"text-gray-400 text-xs mr-4"},he={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},pe=["href","onClick"],ve={class:"border px-3 py-1 border-gray-200"},we={class:"flex justify-center items-center relative pr-4"},Te={class:"absolute right-0 flex-shrink-0"},$e=["href","onClick"],_e={class:"border px-3 py-1 border-gray-200 text-center"},Ce={key:0,class:"text-gray-500 text-sm"},Ae={class:"font-semibold text-blue-800"},Be={class:"border px-3 py-1 border-gray-200 text-center"},De={key:0,class:"ml-4 text-gray-500 text-sm"},Se={class:"text-blue-500 font-semibold"},Le={class:"border px-3 py-1 border-gray-200 text-center"},Ee={key:0,class:"text-gray-500 text-sm"},ze={class:"font-semibold text-blue-800"},Me={class:"border-y px-3 py-1 border-gray-200"},Ne={class:"flex justify-end gap-2"},je={class:"flex gap-1 items-center mt-2 mb-1 text-sm"},Ie={key:1,class:"text-red-800 italic"},Pe=["href"],Oe={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},parentTask:{type:Object},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5}},emits:["editClick","addClick","employeeAssignClick"],setup(t,{emit:w}){const d=t,m=E(!1),T=H(),b=h(()=>m.value?d.childrenTasks:d.childrenTasks.slice(0,d.maxItem)),$=h(()=>m.value?[]:d.childrenTasks.slice(d.maxItem));function S(){m.value=!m.value}const u=w;return(B,n)=>{var _;return s(),i("div",ce,[((_=t.childrenTasks)==null?void 0:_.length)>0?(s(),i("table",ue,[n[4]||(n[4]=e("thead",null,[e("tr",null,[e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20"}," Sub Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20"}," Assign Date "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20"}," Started "),e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20"}," Status ")])],-1)),e("tbody",null,[(s(!0),i(U,null,Z(b.value,(a,C)=>(s(),i("tr",{key:a.id,class:D(["group/sub-task-row",{" bg-green-400/20":a.status=="COMPLETED"," bg-white hover:bg-slate-50":a.status!=="COMPLETED"}])},[e("td",xe,[C!==void 0?(s(),i("div",ge,o(C+1)+". ",1)):r("",!0)]),e("td",ye,[e("div",me,[e("div",null,[e("div",fe,[k(F,{titleClass:"text-sm",task:a,"sub-tasks-open":!1,"is-my-task":B.isMyTask},null,8,["task","is-my-task"])]),e("div",ke,[e("div",be,[n[1]||(n[1]=e("i",{class:"fas fa-clock"},null,-1)),y(" "+o(g(W)(a.created_at)),1)]),e("div",he,[a!=null&&a.is_important?(s(),f(K,{key:0})):r("",!0),a!=null&&a.is_urgent?(s(),f(Q,{key:1})):r("",!0)])])]),!a.is_closed&&!t.hideButtons?(s(),i("a",{key:0,href:`/tasks/edit/${a.id}`,onClick:p(A=>u("editClick",a.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},n[2]||(n[2]=[e("i",{class:"fas fa-edit"},null,-1)]),8,pe)):r("",!0)])]),e("td",ve,[e("div",we,[k(ae,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:a.users||[],isTargetTask:a.is_target,maxItem:1,"route-to":A=>`/tasks?status=not-completed&view=userwise&user-ids=${A.id}`},null,8,["users","isTargetTask","route-to"]),e("div",Te,[!a.is_closed&&!t.hideButtons?(s(),i("a",{key:0,href:`/tasks/${a.id}/assign-users`,onClick:p(A=>u("employeeAssignClick",a.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},n[3]||(n[3]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,$e)):r("",!0)])])]),e("td",_e,[a.assigned_at?(s(),i("span",Ce,[e("span",Ae,o(g(v)(a.assigned_at)),1)])):r("",!0)]),e("td",Be,[a.deadline?(s(),i("span",De,[e("span",Se,o(g(v)(a.deadline)),1)])):r("",!0)]),e("td",Le,[a.started_at?(s(),i("span",Ee,[e("span",ze,o(g(v)(a.started_at)),1)])):r("",!0)]),e("td",Me,[e("div",Ne,[a.closed_at?(s(),f(X,{key:0})):r("",!0),k(G,{status:a==null?void 0:a.status,progressPercent:(a==null?void 0:a.progress_percent)||0},null,8,["status","progressPercent"]),k(J,{ref_for:!0,ref:"progress",task:a,class:"text-sm"},null,8,["task"])])])],2))),128))])])):r("",!0),e("div",je,[t.childrenTasks.length>0?(s(),i(U,{key:0},[$.value.length>0||m.value?(s(),i("button",{key:0,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border ml-2",onClick:p(S,["prevent","stop"])},o(m.value?"Hide":"Show")+" All ",1)):r("",!0),$.value.length>0?(s(),i("span",Ie,o($.value.length)+" More sub task"+o($.value.length>1?"s":""),1)):r("",!0)],64)):r("",!0),t.parentTask.level<2&&!t.hideButtons?(s(),i("a",{key:1,href:`/tasks/add?parent_id=${t.parentTask.id}&back-to=${encodeURIComponent(g(T).path+"?"+g(re)(g(T).query)).toLowerCase()}`,class:D(["hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-indigo-300",{"ml-2":t.childrenTasks.length===0,"ml-3":t.childrenTasks.length>0}]),onClick:n[0]||(n[0]=p(a=>u("addClick",t.parentTask.id),["stop","prevent"]))},n[5]||(n[5]=[e("i",{class:"fas fa-plus"},null,-1),y(" Add Sub Task ")]),10,Pe)):r("",!0)])])}}},Re={class:"flex w-full text-gray-800 bg-white"},qe={key:0,class:"border-l border-gray-200 last:border-l-0"},Ue={class:"items-start group"},Ve={class:"flex items-start gap-6 w-full pb-4"},He={class:"flex-grow w-6/12"},Fe={class:"flex gap-2"},Ge={key:0,class:"text-xl font-semibold text-blue-500"},Je={class:"flex items-center mb-2"},Ke={key:0,class:"flex gap-4 items-center mr-3"},Qe={key:1,class:"text-gray-500 text-sm"},We={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Xe={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},Ye={class:"text-xs text-gray-400 whitespace-nowrap"},Ze={class:"justify-end items-center gap-2 ml-auto flex flex-wrap w-[350px]"},et={class:"ml-0 col-span-full"},tt={class:"flex gap-3 items-center"},st={class:"text-right text-sm flex gap-1 mt-2 opacity-80"},at={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},lt={key:1,class:"text-sm"},rt={class:"font-semibold text-blue-800"},it={key:2,class:"text-gray-500"},nt={key:3,class:"text-sm md:mr-10"},ot={class:"text-blue-500 font-semibold"},dt={key:4,class:"text-sm"},ct={class:"font-semibold text-blue-500"},ut={key:5,class:"text-gray-500"},xt={key:6,class:"text-sm"},gt={class:"font-semibold text-green-500"},yt={class:"flex items-center sm:ml-auto order-0 sm:order-1"},mt={key:0,class:"flex gap-2 ml-4 items-center text-xs"},ft=["href"],kt=["href"],Tt={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(t,{emit:w}){const d=t,m=H(),T=E(null),b=w;function $(c){b("editClick",c)}function S(c){b("employeeAssignClick",c)}const u=E([]),B=localStorage.getItem("sub_task_opened_list");if(B)try{u.value=JSON.parse(B)}catch{u.value=[]}const n=h(()=>v(d.task.assigned_at)),_=h(()=>v(d.task.deadline)),a=h(()=>v(d.task.started_at)),C=h(()=>v(d.task.completed_at)),A=h({get:()=>u.value.includes(d.task.id),set:c=>{const l=u.value.includes(d.task.id);c&&!l?u.value.push(d.task.id):!c&&l&&(u.value=u.value.filter(L=>L!==d.task.id))}});return ee(u,c=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(c))},{deep:!0}),(c,l)=>{var z,M,N,j,I,P,O,R,q;const L=te("RouterLink");return s(),i("div",Re,[t.treeLevel>0?(s(),i("div",qe,l[4]||(l[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):r("",!0),e("div",{class:D(["flex-grow border-2 rounded pb-3 px-3",{"border-blue-500":t.index%2===0,"border-pink-300":t.index%2===1}])},[e("div",Ue,[e("div",{class:D(["-mx-3 px-3 pt-3 shadow-slate-100 flex flex-wrap z-30",{"bg-blue-100/30  ":t.task.closed_at,"bg-green-100  ":((z=T.value)==null?void 0:z.completedPercentage)===100,"bg-white hover:bg-gray-50":((M=T.value)==null?void 0:M.completedPercentage)<100&&!t.task.closed_at,"shadow-sm":t.treeLevel>0}])},[e("div",Ve,[e("div",He,[e("div",Fe,[t.index!==void 0?(s(),i("div",Ge,o(t.index+1)+". ",1)):r("",!0),k(F,{task:t.task,"sub-tasks-open":A.value,"is-my-task":t.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",Je,[t.showDraggableHandle||t.task.serial?(s(),i("div",Ke,[t.showDraggableHandle?(s(),i("button",{key:0,onMousedown:l[0]||(l[0]=p((...x)=>c.handleDragging&&c.handleDragging(...x),["stop"])),class:"handle"},l[5]||(l[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):r("",!0),t.task.serial?(s(),i("span",Qe," #"+o(t.task.serial),1)):r("",!0)])):r("",!0),e("div",We,[t.treeLevel===0?(s(),i("div",Xe," Main ")):r("",!0),(N=t.task)!=null&&N.is_important?(s(),f(K,{key:1,class:"flex-none"})):r("",!0),(j=t.task)!=null&&j.is_urgent?(s(),f(Q,{key:2,class:"flex-none"})):r("",!0)])]),e("div",Ye,[l[6]||(l[6]=e("i",{class:"fas fa-clock"},null,-1)),y(" "+o(g(W)(t.task.created_at)),1)])]),t.hideAssignedUsers?r("",!0):(s(),f(le,{key:0,task:t.task,"tree-level":t.treeLevel,class:"flex-nowrap w-1/2","employee-route-to":x=>({query:{...g(m).query,view:"userwise","company-id":x.company_id,"user-ids":x.id}})},null,8,["task","tree-level","employee-route-to"])),e("div",Ze,[t.task.closed_at?(s(),f(X,{key:0})):r("",!0),k(G,{status:(I=t.task)==null?void 0:I.status,progressPercent:((P=t.task)==null?void 0:P.progress_percent)||0,class:"w-[150px] text-center !border-2"},null,8,["status","progressPercent"]),((R=(O=t.task)==null?void 0:O.children_tasks)==null?void 0:R.length)>0?(s(),f(J,{key:1,ref_key:"progress",ref:T,task:t.task,class:"text-sm w-[150px] text-center"},null,8,["task"])):r("",!0)])])],2),e("div",et,[k(Oe,{childrenTasks:t.task.children_tasks,parentTask:t.task,"hide-buttons":t.hideButtons,"hide-assigned-users":t.hideAssignedUsers,"parent-tree-level":t.treeLevel,onEditClick:$,onAddClick:l[1]||(l[1]=x=>b("addClick",x)),onEmployeeAssignClick:S},{"tree-item-end":V(({task:x,level:Y})=>[se(c.$slots,"item-end",{level:Y,task:x})]),_:3},8,["childrenTasks","parentTask","hide-buttons","hide-assigned-users","parent-tree-level"])])]),e("div",null,[e("div",tt,[e("div",st,[t.task.is_target?(s(),i("div",at,l[7]||(l[7]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),y(" TARGET TASK ")]))):r("",!0),n.value?(s(),i("span",lt,[l[8]||(l[8]=e("span",{class:"italic text-gray-500"},"Assign: ",-1)),e("span",rt,o(n.value),1)])):r("",!0),_.value?(s(),i("span",it,"......")):r("",!0),_.value?(s(),i("span",nt,[l[9]||(l[9]=e("span",{class:"italic text-gray-500"},"Deadline: ",-1)),e("span",ot,o(_.value),1)])):r("",!0),a.value?(s(),i("span",dt,[l[10]||(l[10]=e("span",{class:"italic text-gray-500"},"Started: ",-1)),e("span",ct,o(a.value),1)])):r("",!0),C.value?(s(),i("span",ut,"......")):r("",!0),C.value?(s(),i("span",xt,[l[12]||(l[12]=e("span",{class:"italic text-gray-500"},"Completed: ",-1)),e("span",gt,[y(o(C.value)+" ",1),l[11]||(l[11]=e("i",{class:"fas fa-check-circle"},null,-1))])])):r("",!0)]),e("div",yt,[t.hideButtons?r("",!0):(s(),i("div",mt,[t.task.is_closed?r("",!0):(s(),i("a",{key:0,href:`/tasks/edit/${t.task.id}`,onClick:l[2]||(l[2]=p(x=>b("editClick",t.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},l[13]||(l[13]=[e("i",{class:"fas fa-edit"},null,-1),y(" Edit ")]),8,ft)),t.task.is_closed?r("",!0):(s(),i("a",{key:1,href:`/tasks/${t.task.id}/assign-users`,onClick:l[3]||(l[3]=p(x=>b("employeeAssignClick",t.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},l[14]||(l[14]=[e("i",{class:"fas fa-users-cog"},null,-1),y(" Manage Employee & Supervisor ")]),8,kt)),k(L,{to:{name:"TaskReports",params:{id:(q=t.task)==null?void 0:q.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:V(()=>l[15]||(l[15]=[e("i",{class:"far fa-file-alt"},null,-1),y(" Reports ")])),_:1,__:[15]},8,["to"])]))])])])],2)])}}};export{Tt as _};
