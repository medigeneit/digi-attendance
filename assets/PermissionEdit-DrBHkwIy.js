import{s as m,b as E,u as B,r as x,A as F,e as L,c as n,o as l,a as s,f as g,l as M,h as r,g as p,C as N,F as h,x as k,t as S,E as U}from"./index-B3AlSP1P.js";import{_ as R}from"./MultiselectDropdown-DqRaXK42.js";import{u as A}from"./company-Chy2C6mK.js";import{u as T}from"./department-DJh1vec2.js";import{u as $}from"./user-CWssIA4R.js";import{u as j}from"./userPermissionStore-8tipQWHb.js";import"./vue-multiselect.esm-CnmxZeLu.js";const q={class:"max-w-xl mx-auto mt-10 p-6 bg-white shadow-md rounded-xl space-y-6"},z=["value"],G={key:0},H={class:"space-y-1 mt-2"},I={class:"flex items-center space-x-2"},J={key:0,class:"grid grid-cols-2 gap-2"},K=["value"],O=["disabled"],Q={key:0},W={key:1},ne={__name:"PermissionEdit",setup(X){const c=$(),i=j(),v=A(),u=T(),{users:y}=m(c),{companies:C}=m(v),{departments:_}=m(u),f=E(),b=B(),d=x(null),t=x({user_id:"",company_id:"",department_ids:[]}),P=async()=>{try{const o=await i.fetchPermission(f.params.id);t.value.user_id=o.user_id,t.value.company_id=o.company_id,t.value.department_ids=o.department_ids.includes("*")?["*"]:o.department_ids,d.value=y.value.find(e=>e.id===o.user_id)||null,await u.fetchDepartments(o.company_id)}catch{alert(i.error||"Failed to load permission"),b.push({name:"PermissionList"})}};F(d,o=>{t.value.user_id=(o==null?void 0:o.id)||""});const w=async()=>{t.value.department_ids=[],await u.fetchDepartments(t.value.company_id)},D=async()=>{try{await i.updatePermission(f.params.id,t.value),b.push({name:"PermissionList"})}catch{alert(i.error||"Update failed")}};return L(async()=>{await Promise.all([c.fetchUsers(),v.fetchCompanies()]),await P()}),(o,e)=>(l(),n("div",q,[e[9]||(e[9]=s("h2",{class:"text-2xl font-bold text-gray-700"},"Edit Permission",-1)),s("div",null,[e[4]||(e[4]=s("label",{class:"block font-medium mb-1"},"Select User",-1)),M(R,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),options:r(y),multiple:!1,label:"label",placeholder:"Select employee"},null,8,["modelValue","options"])]),s("div",null,[e[6]||(e[6]=s("label",{class:"block font-medium mb-1"},"Select Company",-1)),p(s("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.company_id=a),onChange:w,class:"w-full border rounded px-3 py-2"},[e[5]||(e[5]=s("option",{value:""},"-- Select Company --",-1)),(l(!0),n(h,null,k(r(C),a=>(l(),n("option",{key:a.id,value:a.id},S(a.name),9,z))),128))],544),[[N,t.value.company_id]])]),r(_).length?(l(),n("div",G,[e[8]||(e[8]=s("label",{class:"block font-medium mb-1"},"Select Departments",-1)),s("div",H,[s("label",I,[p(s("input",{type:"checkbox",value:"*","onUpdate:modelValue":e[2]||(e[2]=a=>t.value.department_ids=a)},null,512),[[U,t.value.department_ids]]),e[7]||(e[7]=s("span",null,"All Departments",-1))]),t.value.department_ids.includes("*")?g("",!0):(l(),n("div",J,[(l(!0),n(h,null,k(r(_),a=>(l(),n("label",{key:a.id,class:"flex items-center space-x-2"},[p(s("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":e[3]||(e[3]=V=>t.value.department_ids=V)},null,8,K),[[U,t.value.department_ids]]),s("span",null,S(a.name),1)]))),128))]))])])):g("",!0),s("button",{onClick:D,disabled:r(i).loading,class:"w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},[r(i).loading?(l(),n("span",Q,"Updating...")):(l(),n("span",W,"Update Permission"))],8,O)]))}};export{ne as default};
