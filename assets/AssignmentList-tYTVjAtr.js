import{L as V}from"./LoaderView-C714tD3t.js";import{u as j}from"./monthly-kpi-assignments-CLSGjO4y.js";import{Q as E,f as $,u as O,D as T,r as F,x as f,h as z,c as n,o,a as e,d as S,m as l,t as r,j as g,F as I,e as K,s as M}from"./index-B9ASKgxZ.js";import{_ as P}from"./EmployeeFilter-6uGj8zCh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-CuI7ahus.js";import"./department-CEgUMF6M.js";import"./EmployeeDropdownInput-CseOwugr.js";import"./SelectDropdown-CZA4XKgu.js";import"./UserChip-BQuZAoP3.js";const Q={class:"space-y-4 px-4"},Y={class:"rounded-xl border bg-white p-4 shadow-sm"},G={class:"grid gap-3 md:grid-cols-12"},H={class:"col-span-full"},J={class:"md:col-span-12 flex flex-wrap gap-2 items-center justify-end pt-2"},W=["disabled"],X=["disabled"],Z={key:0,class:"py-8 text-center"},ee={key:1,class:"rounded-md border border-red-200 bg-red-50 p-3 text-red-700"},te={key:2,class:"overflow-x-auto rounded-xl border bg-white shadow-sm"},se={class:"min-w-full text-sm"},ae={class:"px-3 py-2"},ie={class:"px-3 py-2"},ne={key:0,class:"text-xs text-gray-700"},oe={class:"px-3 py-2"},de={key:0,class:"text-xs text-gray-700"},le={class:"px-3 py-2"},re={class:"px-3 py-2"},pe={class:"px-3 py-2 text-right"},ue=["disabled","onClick"],ce={key:0},qe={__name:"AssignmentList",setup(me){const u=E(),d=$(),w=O(),y=j(),{items:c,isLoading:x,isSaving:h,error:b}=T(y),s=F({company_id:d.query.company_id?Number(d.query.company_id):"",department_id:d.query.department_id?Number(d.query.department_id):"",employee_id:d.query.employee_id?Number(d.query.employee_id):"",line_type:d.query.line_type??""}),m=f(()=>!!s.value.company_id&&!!s.value.department_id),A=f(()=>m.value||!!s.value.employee_id||!!s.value.line_type),k=f(()=>x.value||h.value),L=new Date().toISOString().slice(0,10),C=F({user_id:s.value.employee_id||"",monthly_kpi_form_id:"",assigned_from:L,assigned_to:"",assigned_by:"",active:!0});async function _(){var a,t;if(!m.value){c.value=[];return}const p={company_id:Number(s.value.company_id),department_id:Number(s.value.department_id),line_type:s.value.line_type||void 0,user_id:s.value.employee_id||void 0};try{await y.fetchList(p)}catch(i){u.error(((t=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to load assignments")}}function U(){C.value.user_id=s.value.employee_id||"",v()}function v(){w.replace({query:{company_id:s.value.company_id||void 0,department_id:s.value.department_id||void 0,line_type:s.value.line_type||void 0,employee_id:s.value.employee_id||void 0}}).catch(()=>{})}async function R(){if(!m.value)return u.error("Select Company & Department");await _(),v()}async function B(){s.value={company_id:"",department_id:"",employee_id:"",line_type:""},C.value.user_id="",await _(),v()}async function D(p){var a,t;if(confirm("Close this assignment?"))try{await y.close(p.id),u.success("Closed"),await _()}catch(i){u.error(((t=(a=i==null?void 0:i.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed")}}return z(_),(p,a)=>(o(),n("div",Q,[a[7]||(a[7]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg"},"Criteria Assignments")],-1)),e("div",Y,[e("div",G,[e("div",H,[a[4]||(a[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Employee Scope",-1)),S(P,{company_id:s.value.company_id,"onUpdate:company_id":a[0]||(a[0]=t=>s.value.company_id=t),department_id:s.value.department_id,"onUpdate:department_id":a[1]||(a[1]=t=>s.value.department_id=t),employee_id:s.value.employee_id,"onUpdate:employee_id":a[2]||(a[2]=t=>s.value.employee_id=t),line_type:s.value.line_type,"onUpdate:line_type":a[3]||(a[3]=t=>s.value.line_type=t),"with-type":!0,"initial-value":{...p.$route.query},onFilterChange:U,class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"])]),e("div",J,[e("button",{class:"btn-3",onClick:B,disabled:k.value||!A.value},"Reset",8,W),e("button",{class:"btn-3",onClick:R,disabled:k.value||!m.value},"Search",8,X)])])]),l(x)?(o(),n("div",Z,[S(V)])):l(b)?(o(),n("div",ee,r(l(b)),1)):(o(),n("div",te,[e("table",se,[a[6]||(a[6]=e("thead",null,[e("tr",{class:"bg-gray-100 text-left text-gray-700"},[e("th",{class:"px-3 py-2 w-12"},"#"),e("th",{class:"px-3 py-2"},"User"),e("th",{class:"px-3 py-2"},"Criteria"),e("th",{class:"px-3 py-2"},"Period"),e("th",{class:"px-3 py-2"},"Active"),e("th",{class:"px-3 py-2 text-right w-28"},"Actions")])],-1)),e("tbody",null,[(o(!0),n(I,null,K(l(c),(t,i)=>{var N,q;return o(),n("tr",{key:t.id,class:"border-t"},[e("td",ae,r(i+1),1),e("td",ie,[(N=t.user)!=null&&N.name?(o(),n("div",ne,r(t.user.name),1)):g("",!0)]),e("td",oe,[(q=t==null?void 0:t.criteria)!=null&&q.name?(o(),n("div",de,r(t.criteria.name),1)):g("",!0)]),e("td",le,r(t.assigned_from)+" â†’ "+r(t.assigned_to||"present"),1),e("td",re,[e("span",{class:M(t.active?"text-green-600":"text-gray-500")},r(t.active?"Yes":"No"),3)]),e("td",pe,[e("button",{class:"btn-3",disabled:l(h)||!t.active,onClick:_e=>D(t)},"Close",8,ue)])])}),128)),!l(c)||l(c).length===0?(o(),n("tr",ce,a[5]||(a[5]=[e("td",{colspan:"6",class:"px-3 py-6 text-center text-gray-600"},"No assignments",-1)]))):g("",!0)])])]))]))}};export{qe as default};
