import{P as M,r as f,x as d,Q as i}from"./index-eMx-qoGE.js";const F=M("task",()=>{const o=f([]),k=f([]),h=f([]),y=f(null),u=f(!1),n=f(null),m=f(1),$=f(!0),E=async(e,l,{updateStoreData:a=!0})=>{var t,r;a==!0&&(u.value=!0,n.value=null);try{await i.post(`/tasks/${e}/assign-users`,{user_ids:l}),await w(e)}catch(s){throw a==!0&&(n.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Assign users failed"),s}finally{a==!0&&(u.value=!1)}};function O(){m.value=1,o.value=[]}async function P(e,l={}){var a,t,r;n.value=null;try{const s={...e,per_page:5e3};u.value=!0;const c=await i.get("/tasks",{params:s,...l});return o.value=((a=c.data)==null?void 0:a.tasks)||[],u.value=!1,c.data}catch(s){throw n.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",s}}const x=async(e,l)=>{var a,t,r;n.value=null;try{const s=await i.get("/my-tasks",{params:e,...l});return o.value=((a=s.data)==null?void 0:a.tasks)||[],s.data}catch(s){throw n.value=((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",s),s}};function g(e,l=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>(a==null?void 0:a.parent_id)===l).map(a=>({...a,children_tasks:g(e,a.id)}))}function p(){return g(o.value,0)}function C(){const e=[],l=(a,t=0,r="")=>{a.forEach(s=>{e.push({...s,depth:t,idPath:r+s.id}),s.children_tasks&&s.children_tasks.length&&l(s.children_tasks,t+1,r+s.id+"-")})};return l(p()),e}const w=async(e,l={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,r,s,c,T;a.fetchOnly||(u.value=!0),n.value=null;try{const v=await i.get(`/tasks/${e}`,{params:l});return a.fetchOnly||(y.value=((t=v.data)==null?void 0:t.task)||{},h.value=((r=v.data)==null?void 0:r.todos)||{},k.value=((s=v.data)==null?void 0:s.todo_dates)||{},o.value=v.data.sub_tasks||[]),v.data}catch(v){const _=((T=(c=v.response)==null?void 0:c.data)==null?void 0:T.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(n.value=_),_}finally{a.fetchOnly||(u.value=!1)}},q=async(e,l={loadingBeforeCreate:!1})=>{var a,t,r,s;l.loadingBeforeCreate&&(u.value=!0),n.value=null;try{const c=await i.post("/tasks",e);return(a=c.data)!=null&&a.data&&o.value.push((t=c.data)==null?void 0:t.data),c.data.data}catch(c){throw n.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",c),c}finally{l.loadingBeforeCreate&&(u.value=!1)}},A=async(e,l,{loadingBeforeFetch:a=!0})=>{a&&(u.value=!0),n.value=null;try{const t=await i.put(`/tasks/${e}`,l),r=o.value.findIndex(s=>s.id===e);return r!==-1&&(o.value[r]=t.data.data),t.data.data}catch(t){throw t}finally{a&&(u.value=!1)}},B=async(e,l)=>(await i.put(`/tasks/${e}/update-priorities`,{task_ids:l})).data,L=async e=>{var l,a;u.value=!0,n.value=null;try{await i.delete(`/tasks/${e}`),o.value=o.value.filter(t=>t.id!==e)}catch(t){throw n.value=((a=(l=t.response)==null?void 0:l.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,t),t}finally{u.value=!1}},b=async(e,l)=>{var a,t;u.value=!0,n.value=null;try{await i.patch(`/tasks/${e}/update-requirement-detail/${l}`),o.value=o.value.filter(r=>r.id!==e)}catch(r){throw n.value=((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||`টাস্ক (ID: ${e}) রেকয়্যারমেন্ট সেট করতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,r),r}finally{u.value=!1}};return{tasks:d(()=>o.value),task_todos:d(()=>h.value),task_todo_dates:d(()=>k.value),task:d(()=>y.value),loading:d(()=>u.value),error:d(()=>n.value),taskListTree:d(p),flattenedTasks:d(C),fetchTasks:P,hasMoreTask:$,fetchMyTasks:x,resetTaskList:O,fetchTask:w,createTask:q,updateTask:A,deleteTask:L,assignUsers:E,updateTaskPriorities:B,setTaskRequirement:b}});export{F as u};
