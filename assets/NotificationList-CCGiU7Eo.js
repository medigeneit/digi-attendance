import{u as N,M as I,s as L,r as g,b as E,p as B,o as i,c as v,d as O,v as q,a as r,e as _,t as S,h as A,F,x as V,y as z,j as m,m as C,g as G,f as Z,n as K}from"./index-B7jr5AeI.js";import{u as U}from"./leave-application-CVIFbuEq.js";import{u as P}from"./exchange-BvnGEjD9.js";import{u as Q}from"./short-leave-C0oNpBy5.js";const W={key:0,class:"text-center space-y-2 print:hidden"},X={key:0,class:"mt-2"},Y={class:"flex justify-end gap-2 pt-2"},M={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(R){const f=N(),p=I(),y=P(),{user:w}=L(f),k=R,t=g(null);E(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=g(!1),l=g(""),o=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{await y.handoverAccept(a),alert("Handover approved!"),await d()},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{await y.inChargeAccept(a),alert("In-Charge approved!"),await d()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{await y.recommendByAccept(a),alert("Recommendation approved!"),await d()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{await y.approvedByAccept(a),alert("Final approval successful!"),await d()}}],s=B(()=>o.find(a=>{var n,c,b,x;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((c=t.value)==null?void 0:c.status)!=="Approved"&&!((b=t.value)!=null&&b[a.approved_field])&&((x=t.value)==null?void 0:x[a.approved_by_field])===w.value.id:!1})),h=()=>{u.value&&l.value?(e(),u.value=!1):u.value=!0};async function e(){try{await y.rejectExchange(t.value.id,l.value),alert("Exchange application rejected!"),l.value="",await d(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function d(a){await p.markAsRead(k.notificationId)}return(a,n)=>s.value&&t.value?(i(),v("div",W,[u.value?(i(),v("div",X,[O(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=c=>l.value=c),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,l.value]])])):_("",!0),r("div",Y,[r("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:n[1]||(n[1]=c=>s.value.action(t.value.id))}," Approve "),r("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:h}," Reject ")])])):_("",!0)}},ee={key:0,class:"text-center space-y-2 print:hidden"},ae={key:0,class:"mt-2"},te={class:"flex justify-end gap-2 pt-2"},oe={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(R){const f=N(),p=U(),y=I(),{user:w}=L(f),k=R,t=g(null);E(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=g(!1),l=g(""),o=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{await p.acceptHandover(a),alert("Handover approved!"),await d()},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{await p.acceptInCharge(a),alert("In-Charge approved!"),await d()}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async a=>{await p.acceptCoordinator(a),alert("Coordinator approved!"),await d()}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async a=>{await p.acceptOperationalAdmin(a),alert("Operational Admin approved!"),await d()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{await p.acceptRecommendBy(a),alert("Recommendation approved!"),await d()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{await p.acceptApprovedBy(a),alert("Final approval successful!"),await d()}}],s=B(()=>o.find(a=>{var b,x,j,$;if(!t.value)return!1;if(a.key==="handover")return a.condition();const n=!!((b=t.value)!=null&&b[a.approved_field]),c=((x=t.value)==null?void 0:x[a.approved_by_field])===w.value.id;return((j=t.value)==null?void 0:j.status)!=="Rejected"&&(($=t.value)==null?void 0:$.status)!=="Approved"&&!n&&c})),h=()=>{u.value&&l.value?(e(),u.value=!1):u.value=!0};async function e(){try{await p.rejectLeaveApplication(t.value.id,{rejection_reason:l.value}),alert("Application rejected!"),l.value="",await d(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function d(a){await y.markAsRead(k.notificationId)}return(a,n)=>s.value&&t.value?(i(),v("div",ee,[u.value?(i(),v("div",ae,[O(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=c=>l.value=c),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,l.value]])])):_("",!0),r("div",te,[r("button",{class:"btn-2",onClick:n[1]||(n[1]=c=>s.value.action(t.value.id))},"Approve"),r("button",{class:"btn-1",onClick:h},"Reject")])])):_("",!0)}},ne={key:0,class:"text-center space-y-2 print:hidden"},re={key:0,class:"mt-2"},se={class:"flex justify-end gap-2 pt-2"},ie={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(R){const f=N(),p=Q(),y=I(),{user:w}=L(f),k=R,t=g(null);E(()=>{t.value=JSON.parse(JSON.stringify(k.application))});const u=g(!1),l=g(""),o=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async a=>{await p.handoverAccept(a),alert("Handover approved!"),await d()},condition:()=>{var a,n;return!((a=t.value)!=null&&a.status)&&((n=t.value)==null?void 0:n.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async a=>{await p.inChargeAccept(a),alert("In-Charge approved!"),await d()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async a=>{await p.recommendByAccept(a),alert("Recommendation approved!"),await d()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async a=>{await p.approvedByAccept(a),alert("Final approval successful!"),await d()}}],s=B(()=>o.find(a=>{var n,c,b,x;return t.value?a.key==="handover"?a.condition():((n=t.value)==null?void 0:n.status)!=="Rejected"&&((c=t.value)==null?void 0:c.status)!=="Approved"&&!((b=t.value)!=null&&b[a.approved_field])&&((x=t.value)==null?void 0:x[a.approved_by_field])===w.value.id:!1})),h=()=>{u.value&&l.value?(e(),u.value=!1):u.value=!0};async function e(){try{await p.rejectShortLeave(t.value.id,l.value),alert("Application rejected!"),l.value="",await d(t.value.id)}catch(a){alert(a.message||"Something went wrong!")}}async function d(a){await y.markAsRead(k.notificationId)}return(a,n)=>s.value&&t.value?(i(),v("div",ne,[u.value?(i(),v("div",re,[O(r("textarea",{"onUpdate:modelValue":n[0]||(n[0]=c=>l.value=c),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,l.value]])])):_("",!0),r("div",se,[u.value?_("",!0):(i(),v("button",{key:0,class:"btn-2",onClick:n[1]||(n[1]=c=>s.value.action(t.value.id))}," Approve ")),r("button",{class:"btn-1",onClick:h},S(u.value?"Submit":"Reject"),1)])])):_("",!0)}},le={class:"space-y-6 px-4 py-4"},de={class:"text-2xl font-semibold capitalize text-gray-700"},ce={key:0,class:"space-y-4"},pe={class:"flex items-start gap-4"},ue={class:"text-2xl text-blue-500"},_e={class:"flex-1"},ve={class:"text-gray-800 font-medium"},fe={class:"text-gray-800 font-medium"},ye={class:"text-red-600 text-sm font-semibold"},he={key:0,class:"text-xs text-gray-400"},ge={key:0,class:"grid gap-1"},be={class:"flex items-center gap-4"},xe=["href"],we={class:"grow-0 w-full"},ke={key:0,class:"text-xs font-semibold"},Ae={class:"text-xs text-gray-400"},Se={key:1,class:"text-center text-red-500 py-10"},Le={__name:"NotificationList",setup(R){G();const f=Z(),p=I(),{notifications:y}=L(p);U();const w=N();L(w),g(!1),g({}),g({}),E(()=>{p.fetchNotifications()});const k=(o,s)=>{if(!o)return"application not found";switch(s){case"leaveApplication":return`Last Office ( ${o.last_working_date} ) → Join Date ( ${o.resumption_date} )`;case"shortLeave":return`Short Leave on ${o.date} form ${l(o.start_time)??"N/A"} to ${o.end_time?l(o.end_time):"N/A"}`;case"exchange":return o.exchange_type==="offday"?`Exchange (Offday): ${o.exchange_date} → ${o.current_date}`:o.exchange_type==="shift"?`Exchange (${o.exchange_type}) on ${o.current_date} (${(o==null?void 0:o.shift_name)??"No Shift"})`:`Exchange (${o.exchange_type})`;case"offday":return o.exchange_type==="offday"?`Exchange (Offday): ${o.exchange_date} → ${o.current_date}`:`Exchange (${o.exchange_type})`;default:return"Unknown Event"}},t=o=>{switch(o){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"exchange":return"fas fa-random";case"offday":return"fas fa-random";default:return"fas fa-bell"}},u=o=>new Date(o).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=o=>{const[s,h]=o.split(":").map(Number),e=new Date;return e.setHours(s,h),e.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(o,s)=>{const h=K("RouterLink");return i(),v("div",le,[r("h2",de,S(A(f).query.type.replace(/([A-Z])/g," $1")),1),A(y)[A(f).query.type]?(i(),v("div",ce,[(i(!0),v(F,null,V(A(y)[A(f).query.type],(e,d)=>{var a,n,c,b,x,j,$,H,J,T,D;return i(),v("div",{key:e.id,class:"bg-white p-4 rounded-xl shadow border"},[r("div",pe,[r("div",ue,[r("i",{class:z(t(e.event_type))},null,2)]),r("div",_e,[r("p",ve,S((a=e.event_model)==null?void 0:a.user_name),1),r("p",fe,"Reason: "+S((n=e.event_model)==null?void 0:n.reason),1),r("p",ye,S(k(e.event_model,e.event_type)),1),(c=e==null?void 0:e.event_model)!=null&&c.total_leave_days_without_week?(i(),v("p",he," Total Leave: "+S(e==null?void 0:e.event_model.total_leave_days_without_week)+" days ",1)):_("",!0)]),e!=null&&e.event_model?(i(),v("div",ge,[r("div",be,[e!=null&&e.event_model.attachment?(i(),v("a",{key:0,href:(b=e==null?void 0:e.event_model)==null?void 0:b.attachment,target:"_blank",class:"btn-1"},s[0]||(s[0]=[r("i",{class:"fad fa-link"},null,-1)]),8,xe)):_("",!0),A(f).query.type==="leaveApplication"?(i(),m(h,{key:1,to:{name:"LeaveApplicationShow",params:{id:(x=e==null?void 0:e.event_model)==null?void 0:x.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:C(()=>s[1]||(s[1]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),A(f).query.type==="shortLeave"?(i(),m(h,{key:2,to:{name:"ShortLeaveShow",params:{id:(j=e==null?void 0:e.event_model)==null?void 0:j.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:C(()=>s[2]||(s[2]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),A(f).query.type==="exchange"?(i(),m(h,{key:3,to:{name:(($=e==null?void 0:e.event_model)==null?void 0:$.exchange_type)=="offday"?"ExchangeOffdayShow":"ExchangeShiftShow",params:{id:(H=e==null?void 0:e.event_model)==null?void 0:H.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:C(()=>s[3]||(s[3]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),A(f).query.type==="offday"?(i(),m(h,{key:4,to:{name:"ExchangeOffdayShow",params:{id:(J=e==null?void 0:e.event_model)==null?void 0:J.id},query:{notifyId:e==null?void 0:e.id}},class:"btn-4"},{default:C(()=>s[4]||(s[4]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0)]),r("div",we,[(T=e==null?void 0:e.event_model)!=null&&T.type?(i(),v("p",ke," Type : "+S((D=e==null?void 0:e.event_model)==null?void 0:D.type),1)):_("",!0),r("p",Ae,S(u(e.created_at)),1)])])):_("",!0)]),e!=null&&e.event_model&&e.event_type==="leaveApplication"?(i(),m(oe,{key:0,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):_("",!0),e!=null&&e.event_model&&e.event_type==="shortLeave"?(i(),m(ie,{key:1,application:e.event_model,"notification-id":e.id},null,8,["application","notification-id"])):_("",!0),e!=null&&e.event_model&&(e.event_type==="offday"||e.event_type==="offday")?(i(),m(M,{key:2,application:e.event_model,notificationId:e.id},null,8,["application","notificationId"])):_("",!0)])}),128))])):(i(),v("div",Se,"No notifications found."))])}}};export{Le as default};
