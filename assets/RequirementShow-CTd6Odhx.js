import{c as o,j as u,o as n,a as e,t as v,d as q,w as N,x as F,r as _,p as Ie,i as j,l as C,b as D,k as Ne,v as Ae,s as O,C as De,h as re,F as z,g as Le,e as te,m as Z,Q as Ee,y as Oe,A as Be,f as Ve,u as Me,G as se}from"./index-BpNrwv2X.js";import{L as ie}from"./LoaderView-DkWoTVjk.js";import{O as Q}from"./OverlyModal-BgKHmY5P.js";import{_ as Ue}from"./ShareComponent-D2Vomcua.js";import{_ as Re}from"./DepartmentChip-CKi5ND0Z.js";import{_ as K}from"./DescriptionView-CmlDvAsu.js";import{_ as ee}from"./UserChip-C-NytmfC.js";import{r as Fe,c as Pe,f as ae,b as ze,s as He}from"./requirement-CKK4wZSs.js";import{o as Ge}from"./url-CePbr-gY.js";import{u as We}from"./user-BJVqNVcc.js";import{_ as kr,a as Qe}from"./TaskUserAssignForm-DVPhRP2f.js";import{_ as Ke}from"./TextEditor-CwIrSYgi.js";import{u as Ye}from"./useTaskStore-DBo2mVC8.js";import{_ as Je}from"./TaskSelectionInput-B0Oq0eVz.js";import{_ as Xe}from"./TaskAddForm-J5oBoIuq.js";import{_ as Ze}from"./TaskEditForm-QADOPa6y.js";import{_ as et}from"./TaskTableRow-Cg3Po59R.js";import{T as ne}from"./TextWithHr-DgCTm8Ks.js";import{d as Se,b as tt}from"./datetime-BEfC2TVK.js";import{c as st}from"./dom-Bic1TNqD.js";import{_ as rt}from"./ApproveAndReject-oqRsoq7k.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-Sv3qOMiB.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-GpeegGk0.js";import"./SelectDropdown-CRTTqzlz.js";import"./TaskTitle-CASt_OlX.js";import"./RequiredIcon-BH943ZFZ.js";import"./company-cyvvTvpO.js";import"./CompanyDepartmentSelectInput-BY-sMGdR.js";import"./SectionLoading-BHORDM-C.js";import"./tags-BY18jXdr.js";import"./MultiselectDropdown-C8VypNR3.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-Cw3aCk7H.js";import"./TaskUrgentBadge-DnGm7iPe.js";import"./TaskAssignedUsers-C-6H6xXQ.js";import"./TaskIsClosedBadge-BrTxGdnG.js";const nt={key:0,class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},at={class:"text-sm flex items-center gap-2 text-red-400 font-semibold"},it={class:"mt-[2px]"},lt={key:0,class:"text-gray-800 flex items-center gap-2"},ot={key:1,class:"text-gray-800 w-full my-2 text-center"},dt={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},ut=["innerHTML"],mt={class:"flex gap-4 items-center justify-center mt-2"},ct={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick"],setup(g,{emit:S}){const a=S;return(c,f)=>{var p;return(p=g.requirement)!=null&&p.closed_at?(n(),o("div",nt,[f[5]||(f[5]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",at,[f[1]||(f[1]=e("span",{class:"fad fa-lock"},null,-1)),f[2]||(f[2]=e("span",{class:"mt-[2px]"},"CLOSED AT",-1)),e("span",it,v(new Date(g.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),g.requirement.closed_by_user?(n(),o("div",lt,[f[3]||(f[3]=e("span",{class:"text-sm"},"Closed by",-1)),q(ee,{user:g.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):u("",!0),g.requirement.closing_note?(n(),o("div",ot,[f[4]||(f[4]=e("div",{class:"text-x"},"Closing Note",-1)),e("div",dt,[e("p",{innerHTML:g.requirement.closing_note},null,8,ut)])])):u("",!0),e("div",mt,[e("button",{class:"btn-2 h-8",onClick:f[0]||(f[0]=N(m=>a("reOpenClick"),["prevent"]))},"Re Open")])])):u("",!0)}}},pt={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},vt={class:"my-6"},ft={class:"text-center font-semibold text-blue-800 mb-4"},bt={class:"text-center my-1"},xt={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},yt={class:"mt-4"},gt=["placeholder","required"],_t={class:"flex"},kt={class:"text-red-600 text-center mt-2 text-sm"},wt={class:"flex justify-between mt-3"},ht={class:"btn-2"},qt={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(g,{emit:S}){const a=g,c=S,f=F({get:()=>a.loading,set:()=>c("update:loading")}),p=_(""),m=_(""),t=_(255),y=F(()=>t.value-p.value.length);async function h(){var l,s,i;f.value=!0;try{(l=a.requirement)!=null&&l.closed_at?await Fe(a.requirement.id,p.value):await Pe(a.requirement.id,p.value),c("updateStatus")}catch(d){m.value=(i=(s=d.response)==null?void 0:s.data)==null?void 0:i.message,c("error")}finally{f.value=!1}}return(l,s)=>{var d,b,w,I,$;const i=Ie("LoaderView");return n(),o("form",{class:"p-4 rounded relative border",onSubmit:N(h,["prevent"])},[f.value?(n(),j(i,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:C(()=>s[3]||(s[3]=[D(" Submitting! ")])),_:1,__:[3]})):u("",!0),e("h3",pt,v((d=g.requirement)!=null&&d.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",vt,[e("div",ft,v((b=g.requirement)==null?void 0:b.title),1),s[6]||(s[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",bt,[s[4]||(s[4]=D(" Want to ")),e("span",xt,v((w=g.requirement)!=null&&w.closed_at?"Re-Open":"Close"),1),s[5]||(s[5]=D(" the requirement? "))]),e("div",yt,[Ne(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=T=>p.value=T),rows:"4",placeholder:`Write about why are you ${(I=g.requirement)!=null&&I.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:l.currentAction==="reject",onInput:s[1]||(s[1]=T=>p.value.length>t.value?p.value=p.value.slice(0,t.value):null)},null,40,gt),[[Ae,p.value]]),e("div",_t,[e("div",{class:O(["ml-auto inline-block text-sm text-gray-500",p.value.length>=t.value?"text-red-500":""])}," left "+v(y.value)+"/"+v(t.value)+" words ",3)])])]),s[7]||(s[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",kt,v(m.value),1),e("div",wt,[e("button",{class:"btn-3",onClick:s[2]||(s[2]=N(T=>c("clickCancel"),["prevent"]))},"Cancel"),e("button",ht,v(($=g.requirement)!=null&&$.closed_at?"Re-Open":"Close"),1)])])],32)}}};async function $t(g,S,{params:a={}}={}){return De.get(`/requirements/${g}/details/${S}`,{params:a})}async function Ct(g,S,{params:a={}}={}){const c=Ge(a);return De.delete(`/requirements/${g}/details/${S}${c?"?"+c:""}`)}const Tt={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Rt={class:"mb-4"},St={class:"font-semibold"},jt={class:"mb-4"},It={class:"line-clamp-2"},Nt={key:1,class:"min-h-40"},At={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Dt={key:0,class:"mb-4 text-red-500 font-medium"},Lt={key:1,class:"mb-4"},Ot={class:"flex items-center justify-between gap-4"},Bt=["disabled"],Et={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(g,{emit:S}){const a=g,c=S,f=We(),p=_(null),m=_(""),t=_(),y=_([]);async function h(){var l,s;m.value="submitting";try{const i=await Ct(a.requirementId,a.detailId);c("delete",i),m.value="create"}catch(i){m.value="error",t.value=((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to update requirement detail: "+i,c("error",t.value)}}return re(async()=>{var l,s,i;m.value="loading";try{y.value=await f.fetchDepartmentWiseEmployees(),p.value=(l=(await $t(a.requirementId,a.detailId)).data)==null?void 0:l.detail}catch(d){t.value=((i=(s=d.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to fetch requirement detail"}finally{m.value=""}}),(l,s)=>{var i,d;return n(),o("div",Tt,[s[4]||(s[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:N(h,["prevent"]),class:"z-0"},[m.value!=="loading"?(n(),o(z,{key:0},[e("div",Rt,[s[1]||(s[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",St,v((i=p.value)==null?void 0:i.title),1)]),e("div",jt,[s[2]||(s[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",It,v((d=p.value)==null?void 0:d.description),1)]),s[3]||(s[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),o("div",Nt)),e("div",At,[t.value?(n(),o("div",Dt,v(t.value),1)):u("",!0),t.value?(n(),o("hr",Lt)):u("",!0),e("div",Ot,[e("button",{type:"button",onClick:s[0]||(s[0]=N(b=>c("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:m.value=="loading"||m.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},v(m.value=="submitting"?"Deleting...":"Delete"),9,Bt)])])],32),m.value==="loading"||m.value==="submitting"?(n(),j(ie,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):u("",!0)])}}};const Vt={class:"sticky top-0 pt-4 bg-white z-10"},Mt={class:"mb-4"},Ut={class:"mb-4"},Ft={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Pt={key:0,class:"mb-4 text-red-500 font-medium"},zt={key:1,class:"mb-4"},Ht={class:"flex items-center justify-between gap-4"},Gt=["disabled"],Wt={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(g,{emit:S}){const a=g,c=S,f=_(),p=_(null),m=_(""),t=_(),y=_({feedback:""});async function h(){var l,s;m.value="submitting";try{const i=await ze(a.requirementId,y.value.feedback);c("update",i),m.value="create"}catch(i){m.value="error",t.value=((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to update requirement requirement",c("error",t.value)}}return re(async()=>{var l,s,i,d;m.value="loading";try{await ae(a.requirementId),p.value=(l=(await ae(a.requirementId)).data)==null?void 0:l.requirement,y.value={feedback:(s=p.value)==null?void 0:s.feedback}}catch(b){t.value=((d=(i=b.response)==null?void 0:i.data)==null?void 0:d.message)||"Failed to fetch requirement requirement"}finally{m.value=""}}),(l,s)=>{var i;return n(),o("div",{ref_key:"formContainerRef",ref:f,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Vt,[s[3]||(s[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),s[4]||(s[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:s[0]||(s[0]=N(d=>c("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:N(h,["prevent"]),class:"z-0"},[m.value!=="loading"?(n(),o(z,{key:0},[e("div",Mt,[s[5]||(s[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),q(K,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:C(()=>{var d;return[D(v((d=p.value)==null?void 0:d.title),1)]}),_:1})]),e("div",Ut,[s[6]||(s[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),q(Ke,{modelValue:y.value.feedback,"onUpdate:modelValue":s[1]||(s[1]=d=>y.value.feedback=d)},null,8,["modelValue"])])],64)):u("",!0),e("div",Ft,[t.value?(n(),o("div",Pt,v(t.value),1)):u("",!0),t.value?(n(),o("hr",zt)):u("",!0),e("div",Ht,[e("button",{type:"button",onClick:s[2]||(s[2]=N(d=>c("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:m.value=="loading"||m.value=="submitting",type:"submit",class:"btn-2"},v(m.value=="submitting"?"Saving...":(i=p.value)!=null&&i.feedback?"Update Feedback":"Add Feedback"),9,Gt)])])],32),m.value==="loading"||m.value==="submitting"?(n(),j(ie,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):u("",!0)],512)}}},Qt={class:"flex justify-center items-center"},Kt={class:"modal-card"},Yt=["required"],Jt={class:"flex"},Xt={class:"flex justify-between gap-2 mt-4"},Zt=["disabled"],es=["disabled"],ts={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(g,{emit:S}){const a=g,c=S,f=_(255),p=F(()=>f.value-l.value.length),m=Ee(),t=_(null),y=_(null),h=_(null),l=_(""),s=_(!1),i=F(()=>h.value!==null);function d(T){h.value=T,l.value="",$()}function b(){h.value=null,l.value=""}async function w(){var T,R;if(h.value==="reject"&&!l.value)return m.error("Rejection Reason is required!");if(typeof a.onSubmit=="function")return a.onSubmit({note:l.value,action:h.value});c("loading",!0),s.value=!0;try{await He(a.requirementId,{note:l.value}),c("success"),b()}catch(A){return c("error",A),m.error(((R=(T=A==null?void 0:A.response)==null?void 0:T.data)==null?void 0:R.message)||"Submission failed!")}finally{c("loading",!1),s.value=!1}}function I(T){var R,A;i.value&&(T.key==="ArrowLeft"?(R=y.value)==null||R.focus():T.key==="ArrowRight"&&((A=t.value)==null||A.focus()))}function $(){Be(()=>{var T;(T=t.value)==null||T.focus()})}return re(()=>{window.addEventListener("keydown",I)}),Oe(()=>{window.removeEventListener("keydown",I)}),(T,R)=>(n(),o("div",null,[e("div",Qt,[e("button",{onClick:R[0]||(R[0]=A=>d("accept"))},R[3]||(R[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),i.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:N(b,["self"])},[e("div",Kt,[R[4]||(R[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Ne(e("textarea",{"onUpdate:modelValue":R[1]||(R[1]=A=>l.value=A),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:h.value==="reject",onInput:R[2]||(R[2]=A=>l.value.length>f.value?l.value=l.value.slice(0,f.value):null)},null,40,Yt),[[Ae,l.value]]),e("div",Jt,[e("div",{class:O(["ml-auto inline-block text-sm text-gray-500",l.value.length>=f.value?"text-red-500":""])}," left "+v(p.value)+"/"+v(f.value)+" words ",3)])]),e("div",Xt,[e("button",{ref_key:"cancelBtnRef",ref:y,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:b,disabled:s.value}," Cancel ",8,Zt),e("button",{ref_key:"confirmBtnRef",ref:t,class:O(["focus:ring-2 ring-offset-2 disabled:opacity-30",h.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:w,disabled:s.value}," Confirm Submission ",10,es)])])])):u("",!0)]))}},ss={class:"flex items-center gap-6 justify-center my-16"},rs={key:0,class:"border rounded-md"},ns={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(g,{emit:S}){const a=g,c=S,f=Ye(),p=_(""),m=_(null),t=_(""),y=_(!1);async function h(){await f.setTaskRequirement(t.value,a.requirement.id),c("assignTask")}return(l,s)=>(n(),o("div",{class:O(["text-left p-4",[p.value&&!m.value?"min-h-[400px]":""]])},[e("div",ss,[e("button",{onClick:s[0]||(s[0]=N(i=>c("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),s[5]||(s[5]=e("span",null,"or",-1)),e("button",{class:O({"btn-3":p.value!=="direct-assign","btn-2":p.value=="direct-assign"}),onClick:s[1]||(s[1]=N(()=>p.value="direct-assign",["prevent"]))}," Assign Task ",2)]),p.value&&!m.value?(n(),o("div",rs,[e("form",{onSubmit:N(h,["prevent"]),class:"p-4 flex items-end"},[q(Je,{class:"flex-grow mr-4 h-12",taskId:t.value,"onUpdate:taskId":s[2]||(s[2]=i=>t.value=i),show:y.value,"onUpdate:show":s[3]||(s[3]=i=>y.value=i),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":g.fromDepartmentId},filterTasks:i=>!i.requirement_id,onAddNewTaskClick:s[4]||(s[4]=i=>c("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),s[6]||(s[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):u("",!0)],2))}},as={class:"flex flex-col items-center gax-x-1 justify-end"},is={key:0},ls={key:1},os={class:"text-sm text-gray-600 whitespace-normal w-64"},ds={class:"text-gray-900 font-semibold text-sm md:text-base"},us={class:"ml-2"},ms={key:0,class:"text-red-700 text-sm"},cs={key:1,class:"text-green-600 ml-2"},ps={key:2,class:"ml-2 text-yellow-700"},je={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(g,{emit:S}){const a=g,c=S,f=Le(),p=F(()=>{var l,s,i,d,b;return{from_in_charge:!!((l=a.requirement)!=null&&l.status&&((s=a.requirement)!=null&&s.submission_date)),from_coordinator:!!((i=a.requirement)!=null&&i.from_coordinator),to_in_charge:!!((d=a.requirement)!=null&&d.to_incharge),to_coordinator:!!((b=a.requirement)!=null&&b.to_coordinator)}}),m=F(()=>{var l,s,i,d,b,w,I,$;return{from_in_charge:(s=(l=a.requirement)==null?void 0:l.from_department)==null?void 0:s.in_charge,from_coordinator:(d=(i=a.requirement)==null?void 0:i.from_department)==null?void 0:d.coordinator,to_in_charge:(w=(b=a.requirement)==null?void 0:b.to_department)==null?void 0:w.in_charge,to_coordinator:($=(I=a.requirement)==null?void 0:I.to_department)==null?void 0:$.coordinator}}),t=F(()=>{var d;const l=Object.keys(p.value),s=l.indexOf(a.approvalType);let i=!0;for(let b=s-1;b>=0;b--){const w=l[b];i=i&&(m.value[w]?(d=p.value)==null?void 0:d[w]:!0)}return i}),y=F(()=>{var w,I,$,T,R,A,k,H,G,E,L,r,P,V,M,U;let l=null,s=null,i="",d="";a.approvalType==="from_in_charge"&&(l=(w=a.requirement)==null?void 0:w.from_department,s=($=(I=a.requirement)==null?void 0:I.from_department)==null?void 0:$.in_charge,i="In Charge",d=(T=a.requirement)==null?void 0:T.from_incharge_note),a.approvalType==="from_coordinator"&&(l=(R=a.requirement)==null?void 0:R.from_department,s=(A=a.requirement)==null?void 0:A.from_coordinator,i="Coordinator",d=(k=a.requirement)==null?void 0:k.from_coordinator_note),a.approvalType==="to_in_charge"&&(l=(H=a.requirement)==null?void 0:H.to_department,s=(G=a.requirement)==null?void 0:G.to_in_charge,i="In Charge",d=(E=a.requirement)==null?void 0:E.to_incharge_note),a.approvalType==="to_coordinator"&&(l=(L=a.requirement)==null?void 0:L.to_department,s=(r=a.requirement)==null?void 0:r.to_coordinator,i="Coordinator",d=(P=a.requirement)==null?void 0:P.to_coordinator_note);const b=(V=m.value)==null?void 0:V[a.approvalType];return{department:l,department_user:b,approved:(M=p.value)==null?void 0:M[a.approvalType],approval_user:s,is_rejected:((U=a.requirement)==null?void 0:U.rejected_by_user_id)==(b==null?void 0:b.id),userType:i,approval_note:d}});function h(){c("updateApproval")}return(l,s)=>{var i,d,b,w,I,$;return n(),o("div",as,[y.value.department_user?(n(),o("div",is,[q(ee,{user:y.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),o("div",ls,s[0]||(s[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",os,[y.value.is_rejected?(n(),j(K,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:C(()=>[D(v(g.requirement.rejection_reason),1)]),_:1})):(n(),j(K,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:C(()=>[D(v(y.value.approval_note),1)]),_:1}))]),e("div",null,[!y.value.is_rejected&&!y.value.approved&&t.value&&((i=Z(f).user)==null?void 0:i.id)==((b=(d=y.value)==null?void 0:d.department_user)==null?void 0:b.id)?(n(),j(rt,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(w=a.requirement)==null?void 0:w.id,onSuccess:h,variant:1},null,8,["applicationId"])):u("",!0)]),s[2]||(s[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",ds,[e("span",null,v(((I=y.value.department)==null?void 0:I.short_name)||(($=y.value.department)==null?void 0:$.name)),1),e("span",us,v(y.value.userType),1),y.value.department_user?(n(),o(z,{key:0},[y.value.is_rejected?(n(),o("span",ms," (Rejected)")):y.value.approved?(n(),o("span",cs,"(âœ”)")):(n(),o("span",ps,s[1]||(s[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):u("",!0)])])}}},vs={class:"container mx-auto print:p-0 w-full print:max-w-full"},fs={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},bs={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},xs={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},ys={class:"text-center text-xl font-bold mb-2 flex items-center"},gs={class:"mb-8"},_s={class:"text-lg font-semibold mb-2"},ks={class:"flex gap-4 items-center text-gray-500"},ws={class:"text-sm"},hs={key:0,class:"flex items-center gap-1"},qs={key:0,class:"mb-5"},$s=["innerHTML"],Cs={class:"mb-8"},Ts={class:"font-semibold text-lg px-2"},Rs={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},Ss={class:"w-full border-collapse"},js={key:0},Is={class:"mb-8"},Ns={class:"font-semibold text-lg px-2"},As={key:0},Ds=["innerHTML"],Ls={key:1,class:"text-center my-2 text-gray-400"};const Os={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Bs={class:"flex flex-col items-end"},Es={key:2,class:"mt-6 mb-8 break-before-avoid-page"},Vs={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},Ms={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},Us={class:"bg-white shadow rounded-lg space-y-4 p-4"},Fs={class:"border col-span-3 p-3 rounded-md"},Ps={class:"flex items-center gap-2 mb-4"},zs={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},Hs={class:"flex items-center gap-2 mb-4"},Gs={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},Ws={class:"font-bold print:text-gray-900"},Qs={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},Ks={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},Ys={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},Js={class:"print:text-gray-900 text-sm text-right"},Xs={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},Zs={class:"print:text-gray-900 text-sm text-right"},er={class:"flex justify-between items-center mb-4"},tr={class:"mb-6"},sr={class:"flex justify-between items-center"},rr={key:1,class:"text-red-600"},nr={key:0,class:"mb-6"},ar={class:"flex justify-end text-sky-500"},ir={key:1,class:"mb-6"},lr={class:"flex justify-between items-center"},or={key:2,class:"text-center mb-4 text-red-700 mt-8 text-sm"},dr={key:4,class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},Wr={__name:"RequirementShow",setup(g){const S=Ve(),a=Me(),c=_(""),f=Le(),p=_(),m=_(),t=_(null),y=se({detail:null,open:!1}),h=se({detail:null,open:!1}),l=se({detail:null,open:!1}),s=_(!1),i=()=>s.value=!0,d=()=>s.value=!1,b=_(),w=_({isOpen:!1,taskId:null});re(async()=>{await $(),window.addEventListener("beforeprint",i),window.addEventListener("afterprint",d),window.addEventListener("resize",I),await Be(),st(p.value,()=>{})});function I(){}Oe(()=>{window.removeEventListener("beforeprint",i),window.removeEventListener("afterprint",d),window.removeEventListener("resize",I)});async function $(){var L;c.value="loading",t.value=(L=(await ae(S.params.id)).data)==null?void 0:L.requirement,c.value=""}function T(){var L,r,P,V,M,U,Y,J,X;if(f.user.role!=="super_admin"&&((L=f.user)==null?void 0:L.id)!==((P=(r=t.value)==null?void 0:r.to_department)==null?void 0:P.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(M=(V=t.value)==null?void 0:V.to_department)==null?void 0:M.name}'s In charge can create or assign.`);console.log({requirement:t}),k.modalShown=!0,k.from_department_id=t.value.from_department_id,k.to_department_id=t.value.to_department_id,k.taskDefaultValues={title:"",description:"",from_department_id:t.value.from_department_id,to_department_id:t.value.to_department_id,is_important:((U=t.value)==null?void 0:U.priority)=="IMPORTANT",is_urgent:((Y=t.value)==null?void 0:Y.priority)=="URGENT",supervisor_ids:(J=t.value)!=null&&J.supervisor_id?[(X=t.value)==null?void 0:X.supervisor_id]:[]},k.requirement=t.value}function R(L){y.open=!0,y.detail=L}function A(L){l.open=!0,l.detail=L}const k=se({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function H(){b.value=null,k.modalShown=!1,await $()}async function G(){k.modalShown=!1,k.requirement=null,k.creating=!1}const E=_({open:!1});return(L,r)=>{var V,M,U,Y,J,X,le,oe,de,ue,me,ce,pe,ve,fe,be,xe,ye,ge,_e,ke,we,he,qe,$e,Ce;const P=Ie("RouterLink");return n(),o("div",vs,[h.open?(n(),j(Q,{key:0},{default:C(()=>{var x;return[q(Wt,{requirementId:t.value.id,detailId:(x=h.requirement.value)==null?void 0:x.id,onCloseClick:r[0]||(r[0]=B=>h.open=!1),onUpdate:r[1]||(r[1]=async()=>{h.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):u("",!0),l.open?(n(),j(Q,{key:1},{default:C(()=>{var x;return[q(Et,{requirementId:t.value.id,detailId:(x=l.requirement.value)==null?void 0:x.id,onCloseClick:r[2]||(r[2]=B=>l.open=!1),onDelete:r[3]||(r[3]=async()=>{l.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):u("",!0),k.modalShown?(n(),j(Q,{key:2,class:"*:relative"},{default:C(()=>{var x,B;return[e("button",{onClick:N(G,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},r[18]||(r[18]=[e("i",{class:"fas fa-times-circle"},null,-1)])),k!=null&&k.creating?u("",!0):(n(),j(ns,{key:0,"from-department-id":(x=t.value)==null?void 0:x.from_department_id,requirement:k==null?void 0:k.requirement,onCancelClick:G,onAddNewTaskClick:r[4]||(r[4]=()=>{k.modalShown=!0,k.creating=!0}),onAssignTask:H},null,8,["from-department-id","requirement"])),k!=null&&k.creating?(n(),j(Xe,{key:1,requirementDetailId:(B=k==null?void 0:k.requirement.value)==null?void 0:B.id,requirementId:t.value.id,onClose:G,onTaskCreated:H,defaultValues:k.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):u("",!0)]}),_:1})):u("",!0),b.value?(n(),j(Q,{key:3},{default:C(()=>[q(Ze,{taskId:b.value,onClose:r[5]||(r[5]=x=>b.value=null),onUpdated:H},null,8,["taskId"])]),_:1})):u("",!0),w.value.isOpen?(n(),j(Q,{key:4,class:"*:max-w-4xl"},{default:C(()=>[q(Qe,{taskId:w.value.taskId,onCancelClick:r[6]||(r[6]=()=>{w.value.isOpen=!1,w.value.taskId=0}),onSuccess:r[7]||(r[7]=()=>{w.value.isOpen=!1,w.value.taskId=0,c.value="loading",$()})},null,8,["taskId"])]),_:1})):u("",!0),E.value.open?(n(),j(Q,{key:5},{default:C(()=>[q(qt,{requirement:t.value,onClickCancel:r[8]||(r[8]=x=>E.value.open=!1),onUpdateStatus:r[9]||(r[9]=()=>{$(),E.value.open=!1})},null,8,["requirement"])]),_:1})):u("",!0),e("div",fs,[t.value?(n(),o("div",bs,[e("div",xs,[e("div",ys,[e("button",{class:"btn-3 h-8 px-4",onClick:r[10]||(r[10]=N(()=>Z(a).back(),["prevent"]))},"Back"),r[19]||(r[19]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),r[33]||(r[33]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",gs,[e("div",null,[e("div",_s,[q(K,{"line-clamp":"3",class:"mb-2"},{default:C(()=>[D(v(t.value.title),1)]),btnText:C(({lineClampClass:x})=>[D(v(x?"More":"Less"),1)]),_:1}),e("div",ks,[e("div",ws,[r[20]||(r[20]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),D(" "+v(Z(Se)(t.value.created_at)),1)]),t.value.created_by?(n(),o("div",hs,[r[21]||(r[21]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),q(ee,{"avatar-size":"xsmall",user:t.value.created_by,class:"border-sky-300"},null,8,["user"])])):u("",!0)])]),t.value.description?(n(),o("div",qs,[r[22]||(r[22]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),q(K,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:C(()=>[e("p",{innerHTML:t.value.description,class:"text-justify"},null,8,$s)]),_:1})])):u("",!0)])]),e("div",Cs,[q(ne,{class:"mb-4"},{default:C(()=>[e("h2",Ts,[r[23]||(r[23]=e("span",null,"Task List ",-1)),t.value.status=="approved"?(n(),o("span",{key:0,class:O(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":t.value.tasks_count>0&&t.value.completed_tasks_count==t.value.tasks_count,"text-red-700 font-semibold":t.value.tasks_count==0||t.value.completed_tasks_count!=t.value.tasks_count}]])}," ("+v(t.value.completed_tasks_count)+"/"+v(t.value.tasks_count)+" task(s) done) ",3)):u("",!0)])]),_:1}),e("div",Rs,[e("table",Ss,[r[25]||(r[25]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[c.value!="loading"&&((M=(V=t.value)==null?void 0:V.tasks)==null?void 0:M.length)===0?(n(),o("tr",js,r[24]||(r[24]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),o(z,{key:1},te(((U=t.value)==null?void 0:U.tasks)||[],(x,B)=>(n(),j(et,{key:x.id,task:x,indexing:B+1,class:"*:py-3 *:border-b-0",onEditClick:r[11]||(r[11]=W=>b.value=W),onEmployeeAssignClick:r[12]||(r[12]=W=>{w.value.isOpen=!0,w.value.taskId=W})},null,8,["task","indexing"]))),128))])])])]),e("div",Is,[q(ne,{class:"mb-4"},{default:C(()=>{var x,B,W,Te;return[e("h2",Ns," '"+v(((B=(x=t.value)==null?void 0:x.to_department)==null?void 0:B.short_name)||((Te=(W=t.value)==null?void 0:W.to_department)==null?void 0:Te.name))+"' Feedback ",1)]}),_:1}),e("div",{class:O(["px-3 border border-dashed rounded-lg border-sky-600",[(Y=t.value)!=null&&Y.feedback?"py-3":"py-8"]]),colspan:"5"},[c.value!="loading"&&((J=t.value)!=null&&J.status)?(n(),o("div",As,[String(((X=t.value)==null?void 0:X.feedback)||"").trim().length>0?(n(),j(K,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:C(()=>{var x;return[e("p",{class:"text-sm text-justify",innerHTML:(x=t.value)==null?void 0:x.feedback},null,8,Ds)]}),_:1})):(n(),o("div",Ls,"No Feedback")),e("div",{class:O([((le=t.value)!=null&&le.feedback,"w-full flex justify-center")])},[t.value.closed_at?u("",!0):(n(),o("button",{key:0,class:"btn-3 print:hidden",onClick:r[13]||(r[13]=N(()=>{h.open=!0,h.requirement=t.value},["prevent"]))},v(t.value.feedback?"Update Feedback":"Add feedback"),1))],2)])):u("",!0)],2)]),(t.value,u("",!0)),c.value!="loading"&&!((oe=t.value)!=null&&oe.status)?(n(),o("div",Os,[e("div",Bs,[q(ts,{"requirement-id":(de=t.value)==null?void 0:de.id,onSuccess:$},{heading:C(()=>r[29]||(r[29]=[D(" Requirement Submission ")])),acceptButtonLabel:C(()=>r[30]||(r[30]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),D("Submit Requirement ")],-1)])),submitButtonLabel:C(()=>r[31]||(r[31]=[D(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):u("",!0),(ue=t.value)!=null&&ue.status?(n(),o("div",Es,[q(ne,null,{default:C(()=>r[32]||(r[32]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[32]}),e("div",Vs,[(n(),o(z,null,te(["from_in_charge","from_coordinator"],x=>q(je,{class:"pt-12",key:x,requirement:t.value,"approval-type":x,onUpdateApproval:r[14]||(r[14]=()=>$())},null,8,["requirement","approval-type"])),64))]),((me=t.value)==null?void 0:me.from_department_id)!==((ce=t.value)==null?void 0:ce.to_department_id)?(n(),o("div",Ms,[(n(),o(z,null,te(["to_in_charge","to_coordinator"],x=>q(je,{class:"pt-12",key:x,requirement:t.value,"approval-type":x,onUpdateApproval:r[15]||(r[15]=()=>$())},null,8,["requirement","approval-type"])),64))])):u("",!0)])):u("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:p},[e("div",Us,[e("div",Fs,[e("div",null,[e("div",Ps,[r[34]||(r[34]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),q(Re,{department:(pe=t.value)==null?void 0:pe.from_department,"short-name":!0},null,8,["department"])]),r[35]||(r[35]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",zs,[(ve=t.value)!=null&&ve.supervisor?(n(),j(ee,{key:0,user:(fe=t.value)==null?void 0:fe.supervisor},null,8,["user"])):u("",!0)])]),r[37]||(r[37]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Hs,[r[36]||(r[36]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),q(Re,{department:(be=t.value)==null?void 0:be.to_department,"short-name":!0},null,8,["department"])])])]),e("div",Gs,[r[38]||(r[38]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",Ws,v((xe=t.value)==null?void 0:xe.id),1)]),((ge=(ye=t.value)==null?void 0:ye.website_tags)==null?void 0:ge.length)>0?(n(),o("div",Qs,[r[39]||(r[39]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",Ks,[(n(!0),o(z,null,te(((_e=t.value)==null?void 0:_e.website_tags)||[],x=>(n(),o("div",{key:x.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},v(x.name),1))),128))])])):u("",!0),(ke=t.value)!=null&&ke.submission_date?(n(),o("div",Ys,[r[40]||(r[40]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",Js,v(Z(Se)((we=t.value)==null?void 0:we.submission_date)),1)])):u("",!0),(he=t.value)!=null&&he.better_to_complete_on?(n(),o("div",Xs,[r[41]||(r[41]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",Zs,v(Z(tt)((qe=t.value)==null?void 0:qe.better_to_complete_on,{weekDay:"long"})),1)])):u("",!0),e("div",null,[e("div",er,[r[42]||(r[42]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:O(["font-semibold text-sm",{"text-yellow-600 ":t.value.priority=="IMPORTANT","text-red-700 ":t.value.priority=="URGENT"}])},v(t.value.priority||"NORMAL"),3)])]),e("div",tr,[e("div",sr,[r[43]||(r[43]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),t.value.status?(n(),o("span",{key:0,class:O(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":t.value.status!="approved","bg-green-300 text-green-700 border-green-400":t.value.status=="approved"}])},v(String(t.value.status).toUpperCase()),3)):(n(),o("span",rr,"..."))])]),t.value.closed_at?u("",!0):(n(),o("div",nr,[e("div",ar,[e("button",{class:"btn-1 border border-sky-800",onClick:r[16]||(r[16]=N(x=>E.value.open=!0,["prevent"]))}," Close Requirement ")])])),t.value.rejected_by?(n(),o("div",ir,[e("div",lr,[r[44]||(r[44]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),q(ee,{user:t.value.rejected_by},null,8,["user"])])])):u("",!0),t.value.rejection_reason?(n(),o("div",or,[r[45]||(r[45]=e("p",{class:"text-gray-600 mb-1 italic"},"Reason",-1)),e("p",null,v(t.value.rejection_reason),1)])):u("",!0),r[48]||(r[48]=e("hr",{class:"mb-3"},null,-1)),($e=t.value)!=null&&$e.closed_at?(n(),j(ct,{key:3,requirement:t.value,onReOpenClick:r[17]||(r[17]=x=>E.value.open=!0)},null,8,["requirement"])):(n(),o("div",dr,[t.value.status=="approved"?(n(),o("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:N(T,["prevent"])},r[46]||(r[46]=[e("i",{class:"fas fa-plus text-sm"},null,-1),D(" Add/Assign Task ")]))):u("",!0),q(P,{class:"btn-2 h-8",to:`/requirements/edit/${(Ce=t.value)==null?void 0:Ce.id}`},{default:C(()=>r[47]||(r[47]=[D(" Edit ")])),_:1,__:[47]},8,["to"])]))])]),q(Ue,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3 md:sticky",ref_key:"shareComponent",ref:m},null,512)],512)])):u("",!0),c.value==="loading"?(n(),j(ie,{key:1,class:"absolute inset-0 bg-opacity-90"})):u("",!0)])])}}};export{Wr as default};
