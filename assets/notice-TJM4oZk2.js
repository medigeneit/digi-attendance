import{B as N,r as f,C as u}from"./index-CS60ICU2.js";const M=N("notice",()=>{const b=f([]),v=f([]),w=f([]),p=f({}),o=f(null),c=f(!1),g=f([]),y=f(0);return{notices:v,notice:p,error:o,isLoading:c,policies:w,feedbacks:g,totalFeedbacks:y,fetchPolices:async()=>{var t,s,a;try{c.value=!0;const e=await u.get("/policies");w.value=(t=e==null?void 0:e.data)==null?void 0:t.polices,o.value=null}catch(e){o.value=((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Something went wrong"}finally{c.value=!1}},fetchFileUpload:async t=>{var s,a;try{return c.value=!0,(await u.post("file-upload",t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){o.value=((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Something went wrong"}finally{c.value=!1}},createNoticeFeedback:async(t,s)=>{var a,e;try{return c.value=!0,await u.post(`/user/notice/feedback/${t}`,s)}catch(n){o.value=((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"Something went wrong"}finally{c.value=!1}},fetchNotices:async()=>{var t,s,a;try{c.value=!0;const e=await u.get("/notices");v.value=((t=e==null?void 0:e.data)==null?void 0:t.data)??(e==null?void 0:e.data)??[],o.value=null}catch(e){o.value=((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Something went wrong"}finally{c.value=!1}},fetchNotice:async t=>{var s,a;try{c.value=!0;const n=(await u.get(`/notices/${t}`)).data;return n&&(p.value=n),o.value=null,n}catch(e){o.value=((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Something went wrong"}finally{c.value=!1}},createNotice:async t=>{var s,a,e,n,i,l,h;try{c.value=!0,o.value=null;const{data:r}=await u.post("/notices",{title:t.title,type:t.type,description:t.description,published_at:t.published_at,expired_at:t.expired_at,receiver_type:t.receiver_type,all_companies:!!t.all_companies,all_departments:!!t.all_departments,all_employees:!!t.all_employees,company_ids:t.company_ids||[],department_ids:t.department_ids||[],employee_ids:t.employee_ids||[]});let d=r==null?void 0:r.notice;if(d!=null&&d.id&&t.file instanceof Blob){const m=new FormData;m.append("file",t.file,t.file.name||"attachment"),d=((s=(await u.post(`/notices/${d.id}/file`,m,{transformRequest:[_=>_],headers:{}})).data)==null?void 0:s.notice)||d}return d&&v.value.unshift(d),d}catch(r){const d=(e=(a=r==null?void 0:r.response)==null?void 0:a.data)==null?void 0:e.message,m=(i=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:i.errors;throw o.value=m?((h=(l=Object.values(m))==null?void 0:l[0])==null?void 0:h[0])||d:d||(r==null?void 0:r.message)||"Something went wrong",r}finally{c.value=!1}},updateNotice:async(t,s)=>{var a,e;try{c.value=!0;const n=await u.put(`/notices/${t}`,s),i=b.value.findIndex(l=>l.id===t);i!==-1&&(p.value[i]=n.data.notice),o.value=null}catch(n){o.value=((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"Something went wrong"}finally{c.value=!1}},fetchUserNotices:async()=>{var t,s,a;try{c.value=!0;const e=await u.get("/user/notices");v.value=(t=e==null?void 0:e.data)==null?void 0:t.notices,o.value=null}catch(e){o.value=((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Something went wrong"}finally{c.value=!1}},fetchNoticeDetails:async t=>{var s,a;try{c.value=!0;const n=(await u.get(`/notices/details/${t}`)).data;return n&&(p.value=n),o.value=null,n}catch(e){o.value=((a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)||"Something went wrong"}finally{c.value=!1}},fetchFeedbacks:async(t,s={})=>{var e,n,i,l;const a=await u.get(`/notice/${t}/feedbacks`,s);g.value=(e=a==null?void 0:a.data)==null?void 0:e.data,y.value=(i=(n=a==null?void 0:a.data)==null?void 0:n.meta)==null?void 0:i.total,p.value=(l=a==null?void 0:a.data)==null?void 0:l.notice},downloadFeedbackUserExcel:async(t,s={})=>{var a,e;c.value=!0;try{const n=await u.get(`/notice/feedbacks/${t}?flag=excel`,{params:s,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([n.data])),l=document.createElement("a");l.href=i,l.setAttribute("download",`notice_feedback_users_${t}.xlsx`),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(n){o.value=((e=(a=n.response)==null?void 0:a.data)==null?void 0:e.message)||"Something went wrong",console.error(o.value)}finally{c.value=!1}},updateNoticeFile:async(t,s,{onProgress:a,signal:e}={})=>{const n=new FormData;n.append("file",s,s.name||"attachment");const{data:i}=await u.post(`/notices/${t}/file`,n,{transformRequest:[l=>l],headers:{},onUploadProgress:l=>{if(a&&l.total){const h=Math.round(l.loaded*100/l.total);a(h)}},signal:e});return i==null?void 0:i.notice}}});export{M as u};
