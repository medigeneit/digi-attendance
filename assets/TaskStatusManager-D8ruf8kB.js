import{V as X,r as w,h as A,S as ee,q as Z,x as _,c as n,o as a,k as f,t as u,N as W,a as e,j as U,F as z,l as K,b as T,v as q,w as S,s as O,m as F,B as te,C as V,W as se,g as ae,E as le,e as ne,d as oe}from"./index-dMf477I8.js";import{r as ie,d as re,u as de}from"./task-DLoiJdOU.js";import{L as H}from"./LoaderView-DBo-ZuGs.js";import{g as ue,c as R}from"./datetime-y2WWmmYq.js";import{O as G}from"./OverlyModal-FaFj02ng.js";const ce={key:0},ve={key:0},fe={key:1},pe={key:2},me={key:3},ke={key:1},ye=X({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(p){const x=p;let s=0;const c=w(v());let l;function y(){return x.millisecond&&typeof x.millisecond=="number"}function v(){y()?s&&(s-=1e3):s=new Date(x.targetDateTime).getTime()-new Date().getTime();const o=Math.floor(s/1e3%60),C=Math.floor(s/1e3/60%60),k=Math.floor(s/(1e3*60*60)%24),h=Math.floor(s/(1e3*60*60*24));return{total:s,days:h,hours:k,minutes:C,seconds:o}}function g(){c.value=v()}A(()=>{y()&&(s=x.millisecond),console.log("MOUNTED"),g(),l=setInterval(()=>{g(),c.value.total<=0&&clearInterval(l)},1e3)}),ee(()=>clearInterval(l)),Z(()=>x.targetDateTime,()=>{g(),clearInterval(l)});const D=_(()=>c.value.days.toString().padStart(2,"0")),i=_(()=>c.value.hours.toString().padStart(2,"0")),d=_(()=>c.value.minutes.toString().padStart(2,"0")),m=_(()=>c.value.seconds.toString().padStart(2,"0"));return(o,C)=>c.value.total>0?(a(),n("span",ce,[!o.hideIfZeroValue||D.value!="00"?(a(),n("span",ve,u(D.value)+"d : ",1)):f("",!0),!o.hideIfZeroValue||i.value!="00"?(a(),n("span",fe,u(i.value)+"h : ",1)):f("",!0),!o.hideIfZeroValue||d.value!="00"?(a(),n("span",pe,u(d.value)+"m : ",1)):f("",!0),!o.hideIfZeroValue||m.value!="00"?(a(),n("span",me,u(m.value)+"s",1)):f("",!0)])):(a(),n("span",ke,[W(o.$slots,"expired")]))}}),be={class:"mb-2 mt-6"},xe={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},ge={class:"flex justify-center"},he={class:"py-6 w-full text-center"},_e={class:"block mb-2"},Se={class:"font-semibold text-red-600 mx-2 text-xl"},De={class:"mt-2"},Te={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Ce={class:"flex justify-between items-center"},we={key:0,class:"btn-2 bg-green-600 bg-none"},$e={key:1,class:"btn-2-red"},B=5e3,bt={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(p,{emit:x}){const s=p,c=w(""),l=w(""),y=x,v=w("");let g=0;async function D(){var m,o;if(!c.value)return v.value="Type the task title on input box";clearTimeout(g);try{v.value="",l.value==="deleted"?(l.value="restoring",await ie(s.task.id),l.value="restored"):(l.value="deleting",await re(s.task.id,{params:{security_check:encodeURIComponent(c.value)}}),l.value="deleted"),l.value=="deleted"?g=setTimeout(()=>{d()},B):y("closeClick")}catch(C){l.value="error",v.value=((o=(m=C.response)==null?void 0:m.data)==null?void 0:o.message)||`Failed to update ${s.type}`}}function i(){l.value==="deleted"&&d(),y("closeClick")}function d(){l.value="",y("delete")}return(m,o)=>{var C,k;return a(),n("form",{class:"p-4 relative",onSubmit:S(D,["prevent"])},[o[7]||(o[7]=e("div",{class:"border-b text-center"},[e("h2",null,"Delete Task")],-1)),e("div",be,[o[1]||(o[1]=e("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),e("div",null,u((C=p.task)==null?void 0:C.title),1)]),l.value=="deleted"?(a(),n("div",xe,o[2]||(o[2]=[e("i",{class:"fad fa-check-circle fa-4x"},null,-1),e("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(a(),n(z,{key:1},[e("div",ge,[e("div",he,[e("label",_e,[o[3]||(o[3]=T(" Type ")),e("span",Se,u((k=p.task)==null?void 0:k.title),1),o[4]||(o[4]=T(" and submit to delete "))]),K(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=h=>c.value=h),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[q,c.value]])])]),o[5]||(o[5]=e("hr",null,null,-1)),e("div",De,[v.value?(a(),n("div",Te,u(v.value),1)):f("",!0)])],64)),e("div",Ce,[e("button",{class:O({"btn-2-red":l.value=="deleted","btn-3":l.value!="deleted"}),type:"button",onClick:S(i,["prevent"])},u(l.value==="deleted"?"Delete":"Close"),3),l.value=="deleted"?(a(),n("button",we,[o[6]||(o[6]=T(" Undo Delete in ")),l.value=="deleted"?(a(),U(ye,{key:0,"hide-if-zero-value":!0,millisecond:B})):f("",!0)])):(a(),n("button",$e,"Delete"))]),l.value=="deleting"||l.value=="restoring"?(a(),U(H,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:F(()=>[T(u(String(l.value).charAt(0).toUpperCase()+String(l.value).slice(1)),1)]),_:1})):f("",!0)],32)}}},Ee=te("task-user",()=>({updateUserStartDate:async(s,c,l)=>await V.patch(`/task-user/task/${s}/user/${c}/update-start-date/${l}`),updateUserFinishDate:async(s,c,l)=>await V.patch(`/task-user/task/${s}/user/${c}/update-finish-date/${l}`)})),Ne={class:"border-b text-center"},Oe={key:0},je={key:1},Le={class:"text-center font-semibold text-blue-800 my-4"},Pe={class:"flex justify-center w-full"},Me={class:"py-6 w-4/12"},Ue={class:"block text-xs font-semibold"},Re={class:"mt-3"},Fe={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Ie={class:"flex justify-between items-center"},Ve={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(p,{emit:x}){const s=p,c=x,l=Ee(),y=w(""),v=w("");async function g(){var i,d;console.log({date:y.value});try{s.type=="start-date"?await l.updateUserStartDate(s.task.id,s.user.id,y.value||"0"):s.type=="finish-date"&&await l.updateUserFinishDate(s.task.id,s.user.id,y.value||"0"),c("updateDate")}catch(m){v.value=((d=(i=m.response)==null?void 0:i.data)==null?void 0:d.message)||`Failed to update ${s.type}`}}function D(i){if(i){const d=s.type==="start-date"?i.started_at:i.completed_at;y.value=ue(d)}}return Z(()=>s.task,i=>{D(i)},{immediate:!0}),A(()=>{D(s.task)}),(i,d)=>(a(),n("form",{class:"p-4",onSubmit:S(g,["prevent"])},[e("div",Ne,[p.type=="start-date"?(a(),n("h2",Oe,"Edit Start Date")):p.type=="finish-date"?(a(),n("h2",je,"Edit Completed Date")):f("",!0)]),e("div",Le,u(p.task.title),1),e("div",Pe,[e("div",Me,[e("label",Ue,u(p.type=="start-date"?"Start date":"Completed date"),1),K(e("input",{type:"date","onUpdate:modelValue":d[0]||(d[0]=m=>y.value=m),class:"border py-2 px-4 rounded-md w-full"},null,512),[[q,y.value]])])]),d[3]||(d[3]=e("hr",{class:"mt-4"},null,-1)),e("div",Re,[v.value?(a(),n("div",Fe,u(v.value),1)):f("",!0)]),e("div",Ie,[e("button",{class:"btn-3",onClick:d[1]||(d[1]=S(m=>c("closeClick"),["prevent"]))},"Close"),d[2]||(d[2]=e("div",null,[e("button",{class:"btn-2"},"Submit")],-1))])],32))}},Ge={key:0},Be={key:1,class:"flex"},Ae={key:0,class:"border-r-2 border-dashed pr-6 border-gray-300"},Ze={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},We={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},ze={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},Ke={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},qe={key:0},He=["disabled"],Ye=["disabled"],Je={class:"text-lg font-semibold text-gray-700"},Qe={class:"text-sm text-gray-500"},Xe={class:"flex flex-grow justify-center items-center"},et={key:0,class:"flex flex-col justify-center items-center"},tt={key:1},st={key:1},at={key:2,class:"flex justify-center items-center flex-col"},lt={key:3,class:"flex flex-col justify-center items-center"},nt={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},ot={class:"my-6"},it={class:"text-center font-semibold text-blue-800 mb-4"},rt={class:"text-center my-1"},dt={class:"border px-2 rounded-md bg-gray-50"},ut={class:"text-red-600 text-center mt-2 text-sm"},ct={class:"flex justify-between mt-3"},vt={class:"btn-2"},xt={__name:"TaskStatusManager",props:{task:{type:Object},hideTimeline:{type:Boolean,default:!1}},emits:["updateStatus","error"],setup(p,{emit:x}){const s=p,c=se(),l=x,y=ae(),v=w(""),g=w(),D=w(),i=le({user:null,type:""});function d(b){i.user=y.user,i.type=b}const m={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},o=_(()=>(m==null?void 0:m[k.value])||0),C=_(()=>{var b;return{"bg-yellow-50":k.value==="IN_PROGRESS","bg-green-50":k.value==="COMPLETED","bg-red-50":k.value==="PENDING","bg-blue-50":(b=s.task)==null?void 0:b.closed_at}}),k=_(()=>{var b;return(b=s.task)==null?void 0:b.status}),h=_(()=>k.value=="PENDING"?"Start":k.value=="IN_PROGRESS"?"Finish":k.value=="COMPLETED"?"Close":""),Y=_(()=>h.value=="Start"?"Start Task":h.value=="Finish"?"Finish Task":h.value=="Close"?"Close Task":"");async function J(){var b,t;g.value="submitting";try{await de(s.task.id,{status:v.value}),v.value="",l("updateStatus"),await c.fetchTaskNotificationCount()}catch($){D.value=(t=(b=$.response)==null?void 0:b.data)==null?void 0:t.message,l("error")}finally{g.value=""}}const I=_(()=>h.value=="Start"?"fas fa-play-circle text-blue-500":h.value=="Finish"?"fas fa-stop-circle text-blue-500":""),Q=_(()=>{var b,t,$,j,L,P,r,M;return[{date:R((b=s.task)==null?void 0:b.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((t=s.task)!=null&&t.assigned_at)},{date:R(($=s.task)==null?void 0:$.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((j=s.task)!=null&&j.started_at)||o.value>=m.IN_PROGRESS},{date:R((L=s.task)==null?void 0:L.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((P=s.task)!=null&&P.completed_at)||o.value>=m.COMPLETED},{date:R((r=s.task)==null?void 0:r.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((M=s.task)!=null&&M.deadline)}].sort((E,N)=>E.date===null||N.date===null||new Date(E.date)==new Date(N.date)?E.serial-N.serial:new Date(E.date)-new Date(N.date))});return(b,t)=>{var $,j,L,P;return a(),n("div",{class:O(["border py-8 px-4 rounded",C.value])},[W(b.$slots,"top"),k.value==="BLOCKED"?(a(),n("div",Ge,t[8]||(t[8]=[e("div",{class:"flex flex-col items-center"},[e("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),e("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(a(),n("div",Be,[p.hideTimeline?f("",!0):(a(),n("div",Ae,[($=s.task)!=null&&$.is_target?(a(),n("div",Ze,t[9]||(t[9]=[e("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),T(" TARGET TASK ")]))):f("",!0),e("ol",We,[(a(!0),n(z,null,ne(Q.value,(r,M)=>{var E,N;return a(),n("li",{class:"ml-5",key:M},[e("div",ze,[r.active?(a(),n("i",{key:0,class:O([r.icon,"text-xs"])},null,2)):f("",!0)]),e("div",{class:O({"opacity-30":!r.active})},[e("div",Ke,[r.date?(a(),n("span",qe,u(r.date),1)):f("",!0),((E=s.task)==null?void 0:E.children_task_count)===0&&r.status==="started"&&r.active?(a(),n("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:t[0]||(t[0]=S(()=>d("start-date"),["prevent"])),disabled:!!s.task.closed_at},u(r.date?"Edit":"Set Date"),9,He)):f("",!0),((N=s.task)==null?void 0:N.children_task_count)===0&&r.active&&r.status==="completed"?(a(),n("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:t[1]||(t[1]=S(()=>d("finish-date"),["prevent"])),disabled:!!s.task.closed_at},u(r.date?"Edit":"Set Date"),9,Ye)):f("",!0)]),e("h3",Je,u(r.title),1),e("p",Qe,u(r.description),1)],2)])}),128))])])),e("div",Xe,[(j=p.task)!=null&&j.closed_at?(a(),n("div",et,t[10]||(t[10]=[e("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),e("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):k.value==="PENDING"?(a(),n("div",tt,[((L=p.task)==null?void 0:L.children_task_count)===0?(a(),n("button",{key:0,class:"btn-3 mt-2",onClick:t[2]||(t[2]=S(r=>v.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(a(),n("div",st,t[11]||(t[11]=[e("div",{class:"text-center"},[e("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),e("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):k.value==="IN_PROGRESS"?(a(),n("div",at,[t[12]||(t[12]=e("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),t[13]||(t[13]=e("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((P=p.task)==null?void 0:P.children_task_count)===0?(a(),n("button",{key:0,class:"btn-3",onClick:t[3]||(t[3]=S(r=>v.value="COMPLETED",["prevent"]))}," Finish Task ")):f("",!0)])):k.value==="COMPLETED"?(a(),n("div",lt,[t[14]||(t[14]=e("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),t[15]||(t[15]=e("div",{class:"text-green-700 text-lg"},"Task Has been completed",-1)),e("button",{class:"btn-3 mt-8",onClick:t[4]||(t[4]=S(r=>v.value="CLOSED",["prevent"]))},"Close Task")])):f("",!0)])])),v.value?(a(),U(G,{key:2},{default:F(()=>{var r;return[e("form",{class:"p-4 rounded relative",onSubmit:S(J,["prevent"])},[g.value==="submitting"?(a(),U(H,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:F(()=>t[16]||(t[16]=[T("Submitting!")])),_:1,__:[16]})):f("",!0),e("h3",nt,u(Y.value),1),e("div",ot,[e("div",it,u((r=p.task)==null?void 0:r.title),1),t[19]||(t[19]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",rt,[t[17]||(t[17]=T(" Want to ")),e("span",dt,[e("i",{class:O(["text-sm",I.value])},null,2),T(" "+u(h.value),1)]),t[18]||(t[18]=T(" the task? "))])]),t[20]||(t[20]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",ut,u(D.value),1),e("div",ct,[e("button",{class:"btn-3",onClick:t[5]||(t[5]=S(M=>v.value="",["prevent"]))},"Cancel"),e("button",vt,[e("i",{class:O(["text-xl text-white",I.value])},null,2),T(" "+u(h.value)+" Task ",1)])])])],32)]}),_:1})):f("",!0),i!=null&&i.user?(a(),U(G,{key:3},{default:F(()=>[oe(Ve,{task:s.task,user:i.user,type:i.type,onCloseClick:t[6]||(t[6]=r=>i.user=null),onUpdateDate:t[7]||(t[7]=()=>{i.user=null,i.type=null,l("updateStatus")})},null,8,["task","user","type"])]),_:1})):f("",!0)],2)}}};export{Ve as _,bt as a,xt as b};
