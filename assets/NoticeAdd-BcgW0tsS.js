import{a1 as q,u as B,B as F,z as L,r as v,p as g,e as R,q as d,C as j,c as P,o as $,a as l,w as z,y as u,h as i,j as c,H as _,k as w,A as G,v as x,i as H}from"./index-jT5HqFSz.js";import{_ as V}from"./MultiselectDropdown-BfCeq70C.js";import{_ as I}from"./TextEditor-Dvsd6CGZ.js";import{u as J}from"./company-DWIvlrmT.js";import{u as K}from"./department-Citf1z9b.js";import{u as O}from"./notice-D1Dg5IMu.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-LmWu6Fog.js";const Q={class:"my-container space-y-2"},W={class:"card-bg md:p-8 p-4 mx-4"},X={class:"grid gap-4"},Y={class:"border p-4 rounded-md bg-gray-100"},Z={class:"grid md:grid-cols-2 gap-4"},ee={class:"w-full"},le={class:"col-span-2 flex justify-between gap-8"},te={class:"w-full"},se={class:"w-full"},oe={class:"col-span-full"},ae={class:"col-span-full"},ne={class:"flex justify-center gap-4"},fe={__name:"NoticeAdd",setup(ie){const S=q(),k=B(),y=O(),m=J(),a=K(),{companies:N}=F(m),t=L({title:"",type:1,description:"",published_at:"",expired_at:"",company_id:"",file:"",all_companies:!1,all_departments:!1,all_employees:!1}),p=v([]),r=v([]),f=v([]),C=g(()=>p.value.map(o=>o.id)),D=g(()=>r.value.map(o=>o.id)),U=g(()=>f.value.map(o=>o.id)),A=()=>{p.value=t.all_companies?[...m.companies]:[]},E=()=>{r.value=t.all_departments?[...a.departments]:[]},T=()=>{t.all_employees&&(U.value=[])};R(async()=>{await m.fetchCompanies()}),d(()=>t.all_companies,async o=>{o&&await a.fetchDepartments()}),d(()=>t.all_departments,async o=>{o&&await a.fetchDepartmentEmployee("all")}),d(C,async o=>{await a.fetchDepartments(o)}),d(D,async o=>{await a.fetchDepartmentEmployee(o)}),d(p,o=>{t.all_companies=o.length===m.companies.length}),d(r,o=>{t.all_departments=o.length===a.departments.length});const M=async o=>{var n;const e=o.target.files[0];if(e){const s=new FormData;s.append("file",e);const b=await y.fetchFileUpload(s);t.file=(n=b==null?void 0:b.data)==null?void 0:n.url}},h=async()=>{var o,e;try{const n={title:t.title,type:t.type,description:t.description,published_at:t.published_at,expired_at:t.expired_at,company_id:t.company_id,company_ids:C.value,department_id:t.department_id,department_ids:D.value,employee_ids:U.value,file:t.file};await y.createNotice(n),S.success("Notice created successfully"),await y.fetchNotices(),k.replace("/hrd/notice")}catch(n){const s=((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to save notice";S.error(s),console.error(s)}};return(o,e)=>{const n=j("RouterLink");return $(),P("div",Q,[l("div",W,[e[25]||(e[25]=l("h2",{class:"title-lg text-center"},"Add Notice",-1)),l("form",{onSubmit:z(h,["prevent"]),class:"space-y-4"},[l("div",X,[l("div",Y,[e[21]||(e[21]=l("p",{class:"title-md"},"Notice Info",-1)),e[22]||(e[22]=l("hr",{class:"my-2"},null,-1)),l("div",Z,[l("div",ee,[l("label",null,[i(l("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>t.all_companies=s),onChange:A},null,544),[[_,t.all_companies]]),e[11]||(e[11]=c(" Select All Companies "))]),u(V,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),options:w(N),multiple:!0,searchable:!0,placeholder:"Select companies","track-by":"id",label:"name",disabled:t.all_companies},null,8,["modelValue","options","disabled"])]),l("div",null,[e[13]||(e[13]=l("label",null,"Type*",-1)),i(l("select",{id:"type","onUpdate:modelValue":e[2]||(e[2]=s=>t.type=s),class:"w-full border rounded px-3 py-2",required:""},e[12]||(e[12]=[l("option",{value:"1"},"General",-1),l("option",{value:"2"},"Policy",-1)]),512),[[G,t.type]])]),l("div",null,[e[14]||(e[14]=l("label",null,"Publish Date*",-1)),i(l("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.published_at=s),type:"date",class:"w-full p-2 border rounded",required:""},null,512),[[x,t.published_at]])]),l("div",null,[e[15]||(e[15]=l("label",null,"Expired Date*",-1)),i(l("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.expired_at=s),type:"date",class:"w-full p-2 border rounded",required:""},null,512),[[x,t.expired_at]])]),l("div",le,[l("div",te,[l("label",null,[i(l("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>t.all_departments=s),onChange:E},null,544),[[_,t.all_departments]]),e[16]||(e[16]=c(" Select All Departments "))]),u(V,{modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=s=>r.value=s),options:w(a).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",disabled:t.all_departments},null,8,["modelValue","options","disabled"])]),l("div",se,[l("label",null,[i(l("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>t.all_employees=s),onChange:T},null,544),[[_,t.all_employees]]),e[17]||(e[17]=c(" Select All Employees "))]),u(V,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=s=>f.value=s),options:w(a).employees,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select Employees",disabled:t.all_employees},null,8,["modelValue","options","disabled"])])]),l("div",oe,[e[18]||(e[18]=l("label",null,"Title*",-1)),i(l("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>t.title=s),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[x,t.title]])]),l("div",null,[e[19]||(e[19]=l("label",null,"File",-1)),l("input",{onChange:M,type:"file",class:"w-full p-2 border rounded"},null,32)]),l("div",ae,[e[20]||(e[20]=l("label",null,"Description",-1)),u(I,{modelValue:t.description,"onUpdate:modelValue":e[10]||(e[10]=s=>t.description=s),cols:"30",rows:"10",class:"w-full"},null,8,["modelValue"])])])])]),l("div",ne,[u(n,{to:{name:"UserList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:H(()=>e[23]||(e[23]=[c(" Cancel ")])),_:1,__:[23]}),e[24]||(e[24]=l("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32)])])}}};export{fe as default};
