import{d as ft,b as z,x as P,r as D,c as d,o,a,g as u,L as ct,F as B,k as s,w as O,t as L,n as p,i as v,z as H,f as x,h as yt,B as vt,u as gt,e as xt,A as ut,m as pt,y as bt,j as A,q as F,I as _t}from"./index-Bsza4PJG.js";import{L as mt}from"./LoaderView-TNYhAaCH.js";import{O as E}from"./OverlyModal-CMDEFYB-.js";import{_ as wt}from"./DescriptionView-CNX61I8W.js";import{m as ht,_ as Tt}from"./task-tree-By0Bklmx.js";import{_ as Ct}from"./TaskAddForm-DV-bE_0o.js";import{_ as It}from"./TaskEditForm-VRYseGi2.js";import{_ as $t}from"./TaskTreeView-InYxO2-g.js";import{_ as St}from"./DraggableList.vue_vue_type_script_setup_true_lang-BRUooLjD.js";import{u as Ut}from"./task-priority-a5OMkqZ7.js";import{_ as At}from"./TaskUserAssignForm-9XXZNaCk.js";import{b as Lt,c as Pt,T as Mt,a as Bt}from"./TaskSupervisorAndEmployee-MmnsuaEp.js";import{g as Dt,_ as Et,a as Nt,b as qt,c as jt}from"./TaskStatusManager-vgcDix20.js";import{_ as Rt}from"./TaskStatus-Clg-9iTQ.js";import{d as Vt}from"./datetime-DcVwRp76.js";import{s as kt}from"./dom-BKn8Ftnz.js";import{u as Ot}from"./useTaskStore-BurqVITq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-DX3SQxPP.js";import"./company-Djbe1dEM.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-CqchO63u.js";import"./SelectDropdown-DQzcLAab.js";import"./SectionLoading-BXqK5ubE.js";import"./TextWithHr-D8rYZT8H.js";import"./TaskUrgencyInput-cubnQCsf.js";import"./tags-glJJcmkU.js";import"./MultiselectDropdown-B7uone1i.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BM_lKKa_.js";import"./TaskTitleRouterLink-DKAD1kw3.js";import"./user-ER3iY2ia.js";import"./UserChip-BvxQOY54.js";import"./TaskUserChip-g7sDv87a.js";import"./task-DCnTqEuL.js";const Ft={class:"mb-3"},Ht={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},zt={key:1,class:"text-center py-4 text-gray-500"},Kt={key:2,class:"text-center py-4 text-red-500"},Gt={key:3,class:"space-y-4"},Jt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(g,{emit:e}){const l=g,w=ft(),h=z(),C=P(()=>{var S;return!!(((S=w==null?void 0:w.user)==null?void 0:S.role)!=="employee"&&(w!=null&&w.isAdminMood))}),T=e,m=D(null),{handleItemsPriorityUpdate:b,saveTaskPriority:k,listHasRearranged:_}=Ut(()=>l.tasks,l.parentId),M=async()=>{await k(),T("updatePriority")};return(S,f)=>(o(),d("div",null,[a("div",Ft,[ct(S.$slots,"task:header")]),C.value?(o(),d(B,{key:0},[s(_)?(o(),d("div",Ht,[f[4]||(f[4]=a("span",{class:"text-red-500"},"Priority Changed",-1)),a("button",{class:"btn-3",onClick:O(M,["prevent"])},"Save"),a("button",{class:"btn-3",onClick:f[0]||(f[0]=O((...U)=>m.value.resetItems&&m.value.resetItems(...U),["prevent"]))},"Discard")])):u("",!0)],64)):u("",!0),g.loading?(o(),d("div",zt,"Loading tasks...")):g.error?(o(),d("div",Kt,L(g.error),1)):(o(),d("div",Gt,[p(St,{items:g.tasks,handle:"handle",onItemsUpdate:s(b),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:m},{item:v(({item:U,index:N})=>[p($t,{isMyTask:s(h).name=="MyTaskShow",index:N,task:U,showDraggableHandle:C.value,"tree-level":g.treeLevel,class:"!border-0",onCommentButtonClick:c=>T("commentButtonClick",U.id),onEditClick:f[1]||(f[1]=c=>T("editClick",c)),onAddClick:f[2]||(f[2]=c=>T("addClick",c)),onEmployeeAssignClick:f[3]||(f[3]=c=>T("employeeAssignClick",c))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Qt={class:"flex justify-between mt-5"},Wt={class:"flex justify-between items-center gap-4"},Xt={class:"w-32 relative h-8 mx-4"},Yt={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},Zt={key:3,class:"border p-4 rounded text-center text-gray-500 italic"},te={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(g,{emit:e}){const l=g,w=z(),h=ft(),C=D(""),T=D(""),m=H({taskId:0,isOpen:!1}),b=e,k=D(),_=H({show:!1,parentId:l.parentId,requirementId:null}),M=I=>{_.show=!0,_.parentId=I};function S(){_.show=!1,_.parentId=l.parentId,b("created")}function f(){b("assignUser")}function U(){k.value=!1,b("updated")}function N(){_.show=!1,_.parentId=l.parentId}const c=P(()=>{var I;return Array.isArray(l.subTasks)?ht(l.subTasks,{status:T.value,...w.name=="MyTaskShow"?{"user-ids":(I=h==null?void 0:h.user)==null?void 0:I.id}:{}}).filter(r=>{var i,t,y;return C.value?(y=(i=r==null?void 0:r.title)==null?void 0:i.toUpperCase())==null?void 0:y.includes((t=C.value)==null?void 0:t.toUpperCase()):!0}):[]});return(I,r)=>{var i;return o(),d("div",null,[k.value?(o(),x(E,{key:0},{default:v(()=>[p(It,{taskId:k.value,onClose:r[0]||(r[0]=t=>k.value=null),onUpdated:U},null,8,["taskId"])]),_:1})):u("",!0),_.show?(o(),x(E,{key:1},{default:v(()=>[p(Ct,{parentTaskId:_.parentId,requirementId:_.requirementId,onTaskCreated:S,onError:I.handleTaskError,onClose:N},null,8,["parentTaskId","requirementId","onError"])]),_:1})):u("",!0),m.isOpen?(o(),x(E,{key:2},{default:v(()=>[p(At,{taskId:m.taskId,onCancelClick:r[1]||(r[1]=()=>{m.isOpen=!1,m.taskId=0}),onSuccess:r[2]||(r[2]=()=>{m.isOpen=!1,m.taskId=0,f()})},null,8,["taskId"])]),_:1})):u("",!0),p(Jt,{tasks:c.value,parentId:g.parentId,treeLevel:g.treeLevel,onAddClick:r[6]||(r[6]=t=>M(t)),onEditClick:r[7]||(r[7]=t=>k.value=t),onUpdatePriority:r[8]||(r[8]=t=>b("updatePriority")),onEmployeeAssignClick:r[9]||(r[9]=t=>{m.taskId=t,m.isOpen=!0})},{"task:header":v(()=>{var t;return[a("div",Qt,[a("div",Wt,[r[12]||(r[12]=a("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks",-1)),((t=l==null?void 0:l.subTasks)==null?void 0:t.length)>0?(o(),d(B,{key:0},[p(Tt,{modelValue:C.value,"onUpdate:modelValue":r[3]||(r[3]=y=>C.value=y),class:"w-full md:w-48 md:ml-auto h-8","debounce-time":0},null,8,["modelValue"]),a("div",Xt,[r[11]||(r[11]=a("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),yt(a("select",{"onUpdate:modelValue":r[4]||(r[4]=y=>T.value=y),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},r[10]||(r[10]=[a("option",{value:""},"--ALL TASKS--",-1),a("option",{value:"not-completed"},"Not Completed",-1),a("option",{value:"only-completed"},"Completed",-1)]),512),[[vt,T.value]])])],64)):u("",!0)]),g.subTaskIsCreatable?(o(),d("div",Yt,[a("button",{class:"btn-1 ml-auto",onClick:r[5]||(r[5]=O(()=>M(g.parentId),["prevent"]))}," Add Sub Task ")])):u("",!0)])]}),_:1},8,["tasks","parentId","treeLevel"]),((i=c.value)==null?void 0:i.length)===0&&g.treeLevel<=2?(o(),d("div",Zt," No Sub Tasks ")):u("",!0)])}}},ee={class:"container mx-auto p-6"},se={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},ae={key:0,class:"text-sm mb-2 border-b","aria-label":"Breadcrumb"},oe={class:"flex items-center gap-2"},ne={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},le=["title"],re={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},ie={class:"grid grid-cols-4"},de={class:"mb-4 flex col-span-full"},ue={class:"font-medium text-xl"},pe={class:"flex items-center gap-3 text-xs text-gray-500 mt-2 opacity-80 text-left"},me={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-2 py-[2px] rounded-full border border-green-200 opacity-80"},ke={class:"font-semibold"},fe={class:"mt-2 col-span-full flex items-center"},ce={class:"text-gray-400 text-xs"},ye={class:"flex items-center gap-0.5"},ve={class:"text-sky-400 text-sm font-semibold"},ge={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},xe={class:"col-span-full mb-4"},be=["innerHTML"],_e={key:0,class:"mt-4 col-span-full mb-6"},we={class:"mt-2 py-2 flex flex-col lg:flex-row gap-y-4 justify-center items-center gap-2 col-span-full"},he={class:"flex items-center gap-4 flex-wrap justify-center"},Te=["disabled"],Ce={class:"lg:ml-auto flex gap-4 items-center"},Ie={key:1},$e={key:3},Se={key:1,class:"text-center py-4 text-red-500"},ds={__name:"TaskShow",setup(g){const e=Ot(),l=z(),w=gt(),h=D(""),C=P(()=>e.tasks),T=D({}),m=H({open:!1,task:null});xt(async()=>{h.value="loading",await k(l.params.id),h.value="",l.hash=="#sub-tasks"&&setTimeout(()=>kt(l.hash,66),0)});const b=H({user:null,type:""});async function k(i){await e.fetchTask(i)}const _=P(()=>Dt(e.task.users,e.task.task_reports||[]));async function M(){await k(l.params.id),b.user=null,b.type=""}const S=i=>{w.push({name:"TaskEdit",params:{id:i}})},f=P(()=>{var i,t;return e.task?((i=e.task)==null?void 0:i.parent_id)==0?{name:c.value?"MyTaskList":"TaskList"}:{params:{id:(t=e.task)==null?void 0:t.parent_id},query:{"is-my-task":c.value}}:null});function U(){m.open=!0,m.task=e.task}function N(){m.open=!1,console.log({STATE:"Deleted",backLink:f.value}),w.push(f.value)}const c=P(()=>l.name=="MyTaskShow"||!!l.query["is-my-task"]),I=(i,t=!1)=>({id:i==null?void 0:i.id,title:i==null?void 0:i.title,status:i==null?void 0:i.status,is_current_page:t}),r=P(()=>{var t,y,q,j,R,V;const i=[];return(t=e==null?void 0:e.task)!=null&&t.parent&&(i.push(I((y=e.task)==null?void 0:y.parent)),(j=(q=e==null?void 0:e.task)==null?void 0:q.parent)!=null&&j.parent&&i.push(I((V=(R=e.task)==null?void 0:R.parent)==null?void 0:V.parent))),[...i.reverse(),I(e.task,!0)]});return ut(()=>l.params.id,async i=>{h.value="changing",await k(i),h.value=""}),ut(()=>l.hash,async function(){setTimeout(()=>kt(l.hash,66),0)}),(i,t)=>{var j,R,V,K,G,J,Q,W,X,Y,Z,tt,et,st,at,ot,nt,lt,rt,it,dt;const y=pt("RouterLink"),q=pt("router-view");return o(),d("div",ee,[b.user?(o(),x(E,{key:0},{default:v(()=>[p(Et,{task:s(e).task,user:b.user,type:b.type,onCloseClick:t[0]||(t[0]=n=>b.user=null),onUpdateDate:M},null,8,["task","user","type"])]),_:1})):u("",!0),m.open?(o(),x(E,{key:1},{default:v(()=>[p(Nt,{onCloseClick:t[1]||(t[1]=n=>m.open=!1),task:m.task,onDelete:N},null,8,["task"])]),_:1})):u("",!0),h.value==="loading"?(o(),x(mt,{key:2})):(o(),d("div",se,[s(e).task?(o(),d(B,{key:0},[r.value.length>1?(o(),d("nav",ae,[a("ol",oe,[(o(!0),d(B,null,bt(r.value,(n,$)=>(o(),d(B,{key:n.id},[$>0?(o(),d("li",ne,"/")):u("",!0),a("li",{title:n==null?void 0:n.title,class:"text-gray-600 line-clamp-1"},[n.is_current_page?(o(),d("span",re,L(n==null?void 0:n.title),1)):(o(),x(y,{key:0,to:`${c.value?"/my-tasks":"/tasks"}/${n.id}`,class:F(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":$>0,"whitespace-nowrap":$===0}])},{default:v(()=>[A(L(n==null?void 0:n.title),1)]),_:2},1032,["to","class"]))],8,le)],64))),128))])])):u("",!0),a("section",ie,[a("div",de,[a("div",null,[a("h2",ue,L(s(e).task.title),1),a("div",pe,[s(e).task.parent_id==0?(o(),d("div",me," MAIN TASK ")):u("",!0),a("div",ke,"#"+L((j=s(e).task)==null?void 0:j.serial),1),(R=s(e).task)!=null&&R.is_important?(o(),x(Mt,{key:1})):u("",!0),(V=s(e).task)!=null&&V.is_urgent?(o(),x(Bt,{key:2})):u("",!0)]),a("div",fe,[a("div",ce,[t[13]||(t[13]=a("i",{class:"fas fa-clock"},null,-1)),A(" "+L(s(Vt)(s(e).task.created_at)),1)]),(K=s(e).task)!=null&&K.created_by_user?(o(),d(B,{key:0},[t[14]||(t[14]=a("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),a("div",ye,[p(_t,{user:(G=s(e).task)==null?void 0:G.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),a("div",ve,L((Q=(J=s(e).task)==null?void 0:J.created_by_user)==null?void 0:Q.label),1)])],64)):u("",!0)])]),a("div",ge,[p(Rt,{status:(W=s(e).task)==null?void 0:W.status,progressPercent:(X=s(e).task)==null?void 0:X.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),s(e).task?(o(),x(Lt,{key:0,task:s(e).task,ref_key:"progress",ref:T,class:"!text-lg"},null,8,["task"])):u("",!0)])]),a("div",xe,[p(wt,null,{default:v(()=>{var n;return[a("p",{innerHTML:(n=s(e).task)==null?void 0:n.description,class:"text-justify"},null,8,be)]}),_:1})]),p(Pt,{task:(Y=s(e))==null?void 0:Y.task,"tree-level":(tt=(Z=s(e))==null?void 0:Z.task)==null?void 0:tt.level,class:"justify-center border col-span-full border-dashed rounded-lg"},null,8,["task","tree-level"]),s(e).task.children_task_count>0?(o(),d("section",_e,[p(qt,{"task-users":((et=s(e).task)==null?void 0:et.users)||[],task:s(e).task,"sub-tasks":s(e).tasks,"progress-users":_.value},{caption:v(()=>t[15]||(t[15]=[a("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):u("",!0),(st=s(e))!=null&&st.task?(o(),x(jt,{key:1,task:((at=s(e))==null?void 0:at.task)||{},class:"col-span-full mt-4",onUpdateStatus:t[2]||(t[2]=()=>{var n,$;return k(($=(n=s(e))==null?void 0:n.task)==null?void 0:$.id)})},null,8,["task"])):u("",!0),a("div",we,[a("div",he,[a("button",{onClick:t[3]||(t[3]=O(n=>{var $;return S(($=s(e).task)==null?void 0:$.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!s(e).task.closed_at},t[16]||(t[16]=[a("i",{class:"fas fa-edit"},null,-1),A(" Edit ")]),8,Te),p(y,{to:{name:"TaskUserAssign",params:{id:(ot=s(e).task)==null?void 0:ot.id}},class:F(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",s(e).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:t[4]||(t[4]=n=>n.stopPropagation())},{default:v(()=>t[17]||(t[17]=[a("i",{class:"fas fa-users-cog"},null,-1),A(" Assign Users ")])),_:1,__:[17]},8,["to","class"]),a("button",{class:"border-2 border-indigo-500 hover:bg-indigo-500 hover:text-white text-indigo-500 font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none whitespace-nowrap",onClick:t[5]||(t[5]=n=>s(w).back())},t[18]||(t[18]=[a("i",{class:"fas fa-arrow-left"},null,-1),A(" Back ")])),p(y,{to:f.value,class:"border-2 border-indigo-500 hover:bg-indigo-500 hover:text-white ml-2 text-indigo-500 font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none whitespace-nowrap",onClick:t[6]||(t[6]=n=>n.stopPropagation())},{default:v(()=>t[19]||(t[19]=[a("i",{class:"fas fa-arrow-left"},null,-1),A(" Parent Task ")])),_:1,__:[19]},8,["to"])]),a("div",Ce,[((nt=s(e).task)==null?void 0:nt.children_task_count)===0&&((lt=s(e).task)==null?void 0:lt.status)==="PENDING"?(o(),d("button",{key:0,class:"btn-2-red h-8",onClick:O(U,["prevent"])}," Delete ")):u("",!0),C.value.length>0?(o(),x(y,{key:1,to:{name:c.value||s(l).query["is-my-task"]?"MyTaskShow":"TaskShow",params:{id:(rt=s(e).task)==null?void 0:rt.id},hash:"#sub-tasks"},onClick:t[7]||(t[7]=n=>n.stopPropagation()),class:F(["py-0.5 btn-3 ml-auto text-sm h-8 whitespace-nowrap",{"bg-blue-500 text-white":s(l).name=="TaskShow"||s(l).name==="MyTaskShow"}])},{default:v(()=>t[20]||(t[20]=[a("i",{class:"fal fa-list-ul"},null,-1),A(" Sub Tasks ")])),_:1,__:[20]},8,["to","class"])):u("",!0),p(y,{to:{name:"TaskReports",params:{id:(it=s(e).task)==null?void 0:it.id},query:{"is-my-task":c.value},hash:"#task-reports"},onClick:t[8]||(t[8]=n=>n.stopPropagation()),class:F(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":s(l).name=="TaskReports"}])},{default:v(()=>t[21]||(t[21]=[a("i",{class:"fal fa-file-alt"},null,-1),A(" Reports ")])),_:1,__:[21]},8,["to","class"])])])]),t[22]||(t[22]=a("div",{id:"sub-tasks"},null,-1)),(s(l).name=="TaskShow"||s(l).name==="MyTaskShow")&&((dt=s(e).task)==null?void 0:dt.level)<=2?(o(),d("section",Ie,[p(te,{subTasks:C.value,"parent-id":s(l).params.id,"sub-task-is-creatable":!s(e).task.closed_at,"tree-level":s(e).task.level+1,onCreated:t[9]||(t[9]=n=>k(s(l).params.id)),onUpdated:t[10]||(t[10]=n=>k(s(l).params.id)),onUpdatePriority:t[11]||(t[11]=n=>k(s(l).params.id)),onAssignUser:t[12]||(t[12]=n=>k(s(l).params.id))},null,8,["subTasks","parent-id","sub-task-is-creatable","tree-level"])])):u("",!0),s(l).name==="TaskReportAdd"?(o(),x(E,{key:2,class:"*:bg-transparent"},{default:v(()=>[p(q)]),_:1})):(o(),d("section",$e,[p(q)]))],64)):(o(),d("div",Se,L(s(e).error),1)),h.value==="changing"?(o(),x(mt,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):u("",!0)]))])}}};export{ds as default};
