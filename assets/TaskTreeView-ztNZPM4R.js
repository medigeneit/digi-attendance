import{c as i,o as n,F,x as G,m as _,p as C,I as U,G as Q,q as y,a as t,y as v,z as W,n as p,t as f,k as H,b as X,r as V,A as Z,f as k,w as N,l as S,h as ee}from"./index-Cy2jJ23R.js";import{_ as te}from"./UserChip-D7SJ0En4.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"mt-3"},ae={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(e,{emit:d}){const a=d;return(m,u)=>(n(),i("div",se,[(n(!0),i(F,null,G(e.childrenTasks,(c,g)=>(n(),_(Ve,{key:c.id,index:g,task:c,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:u[0]||(u[0]=r=>a("editClick",r)),onAddClick:u[1]||(u[1]=r=>a("addClick",r))},{"item-end":C(({task:r,level:l})=>[U(m.$slots,"treeItemEnd",{task:r,level:l})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ne=Q({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:d}){const a=e,m=y(function(){if(a.task.children_tasks.length===0)return a.task.status==="COMPLETED"?1:0;const g=r=>{let l=0;for(let x=0;x<r.length;x++){const b=r[x];if(b.children_tasks.length===0)b.status==="COMPLETED"&&(l+=1);else{const $=b.children_tasks.length;g(b.children_tasks)===$&&(l+=1)}}return l};return g(a.task.children_tasks)}),u=y(()=>a.task.children_tasks.length===0?a.task.status==="COMPLETED"?100:0:m.value/a.task.children_tasks.length*100),c=y(()=>{const g=u.value;let r,l,x;return g===100?(r="bg-green-50",l="bg-green-200",x="text-green-600 "):g<100&&(r="bg-red-50",l="bg-red-200",x="text-red-600 "),{container:r,bar:l,text:x}});return d({completedPercentage:u.value,completedSubTaskCount:m.value}),(g,r)=>(n(),i("div",null,[t("div",{class:v(["rounded-full border py-0.5 relative overflow-hidden h-6",c.value.container]),style:{width:"180px"}},[t("div",{class:v(["z-10 absolute top-0 bottom-0",c.value.bar]),style:W(`width: ${u.value}%`)},null,6),t("span",{class:v(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",c.value.text])},[t("span",null,[t("span",null,f(m.value),1),r[0]||(r[0]=p(" / ")),t("span",null,f(g.task.children_tasks.length||1),1)])],2)],2)]))}}),j=e=>{if(!e)return"";try{const d=new Date(e);if(isNaN(d))return"";const a=String(d.getDate()).padStart(2,"0"),u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()],c=d.getFullYear();return`${a}-${u}-${c}`}catch{return""}},le={},re={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function ie(e,d){return n(),i("span",re,"IMPORTANT")}const oe=K(le,[["render",ie]]),de={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(d,a)=>{const m=H("RouterLink");return n(),_(m,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:C(()=>[t("div",null,f(e.task.title),1)]),_:1},8,["to"])}}},ue={},ce={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function ke(e,d){return n(),i("span",ce,"URGENT")}const ge=K(ue,[["render",ke]]),fe={class:"flex w-full"},me={key:0,class:"border-l border-gray-200 last:border-l-0"},xe={class:"items-start grid grid-cols-3 group"},he={class:"flex gap-4 items-center"},ve={key:0,class:"text-xl font-semibold text-sky-500"},be={class:"text-gray-500 text-sm"},ye={class:"text-red-500 text-2xl"},pe={class:"flex items-center gap-2"},_e={key:0,class:"text-sm text-gray-500 mt-2"},Ce={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},we={class:"flex items-center flex-wrap gap-3"},Te={key:0,class:"text-gray-500 text-xs"},Se={class:"flex justify-end items-center gap-2"},$e={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200"},Le={class:"mt-4"},Ne={class:"flex items-center"},Ae={class:"flex gap-3 items-center"},Be={class:"text-xs text-gray-500 flex gap-3"},De=["href"],Ee={class:"ml-auto text-right text-sm flex items-center gap-4"},Re={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Oe={key:1,class:"text-gray-500"},Me={class:"font-semibold text-green-800"},Pe={key:2,class:"ml-4 text-gray-500"},qe={class:"text-red-500 font-semibold"},Ie={key:0,class:"flex gap-2 ml-4 items-center text-xs"},ze=["href"],Je={class:"ml-0"},Ve={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick"],setup(e,{emit:d}){const a=e,m=X(),u=V(null),c=d;function g(o){c("addClick",o)}function r(o){c("editClick",o)}const l=V([]),x=localStorage.getItem("sub_task_opened_list");if(x)try{l.value=JSON.parse(x)}catch{l.value=[]}const b=y(()=>j(a.task.started_at)),$=y(()=>j(a.task.deadline)),w=y({get:()=>l.value.includes(a.task.id),set:o=>{const s=l.value.includes(a.task.id);o&&!s?l.value.push(a.task.id):!o&&s&&(l.value=l.value.filter(T=>T!==a.task.id))}});Z(l,o=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(o))},{deep:!0});const A=y(()=>{var o,s;return((s=(o=a.task)==null?void 0:o.children_tasks)==null?void 0:s.length)>0});function Y(){a.task.children_tasks.length>0&&(w.value=!w.value)}return(o,s)=>{var B,D,E,R,O,M,P,q,I,z;const T=H("RouterLink");return n(),i("div",fe,[e.treeLevel>0?(n(),i("div",me,s[3]||(s[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):k("",!0),t("div",{class:v(["flex-grow border rounded py-3 px-3",{"bg-green-100  ":((B=u.value)==null?void 0:B.completedPercentage)===100,"bg-white hover:bg-gray-50":((D=u.value)==null?void 0:D.completedPercentage)<100,"shadow-sm":e.treeLevel>0}])},[t("div",xe,[t("div",null,[t("div",null,[t("div",he,[e.index!==void 0?(n(),i("div",ve,f(e.index+1),1)):k("",!0),e.showDraggableHandle?(n(),i("button",{key:1,onMousedown:s[0]||(s[0]=N((...h)=>o.handleDragging&&o.handleDragging(...h),["stop"])),class:"handle"},s[4]||(s[4]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):k("",!0),t("span",be," #"+f(e.task.id),1),t("div",ye,f(e.treeLevel),1)]),t("div",pe,[S(de,{task:e.task},null,8,["task"])])]),(E=e.task)!=null&&E.requirement?(n(),i("p",_e," Requirement: "+f((O=(R=e.task)==null?void 0:R.requirement)==null?void 0:O.title),1)):k("",!0),t("div",Ce,[(M=e.task)!=null&&M.is_important?(n(),_(oe,{key:0})):k("",!0),(P=e.task)!=null&&P.is_urgent?(n(),_(ge,{key:1})):k("",!0)])]),t("div",we,[(n(!0),i(F,null,G(e.task.users,(h,L)=>(n(),_(T,{key:L,to:{name:"TaskList",query:{...ee(m).query,view:"userwise","company-id":h.company_id,"user-ids":h.id}}},{default:C(()=>{var J;return[S(te,{class:v(["flex items-center gap-2 border rounded-full px-1 py-0.5 shadow-sm",{"!bg-yellow-400":(J=e.task)==null?void 0:J.is_target}]),user:h},null,8,["class","user"])]}),_:2},1032,["to"]))),128)),e.task.users.length===0?(n(),i("div",Te," Not Assigned To Anyone ")):k("",!0),S(T,{to:{name:"TaskUserAssign",params:{id:(q=e.task)==null?void 0:q.id}},title:"Assign user",class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},{default:C(()=>s[5]||(s[5]=[t("i",{class:"fas fa-user-plus"},null,-1)])),_:1},8,["to"])]),t("div",Se,[t("span",$e,f(e.task.status),1),S(ne,{task:e.task,ref_key:"progress",ref:u,class:"text-sm"},null,8,["task"])])]),t("div",Le,[t("div",Ne,[t("div",Ae,[t("div",Be,[t("button",{class:v([{"text-yellow-600 font-semibold  inline-block animate-bounce":A.value},"flex items-center gap-1 group"]),onClick:Y},[t("i",{class:v([w.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:v(A.value?"group-hover:underline":"")}," Sub Tasks ("+f((I=e.task.children_tasks)==null?void 0:I.length)+") ",3)],2),e.treeLevel<2?(n(),i("a",{key:0,href:`/tasks/add?parent_id=${a.task.id}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:s[1]||(s[1]=N(h=>c("addClick",a.task.id),["stop","prevent"]))},s[6]||(s[6]=[t("i",{class:"fas fa-plus"},null,-1),p(" Add Sub Task ")]),8,De)):k("",!0)])]),t("div",Ee,[e.task.is_target?(n(),i("div",Re," TARGET TASK ")):k("",!0),b.value?(n(),i("span",Oe,[s[7]||(s[7]=p(" Started: ")),t("span",Me,f(b.value),1)])):k("",!0),$.value?(n(),i("span",Pe,[s[8]||(s[8]=p(" Deadline: ")),t("span",qe,f($.value),1)])):k("",!0)]),e.hideButtons?k("",!0):(n(),i("div",Ie,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:s[2]||(s[2]=N(h=>c("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},s[9]||(s[9]=[t("i",{class:"fas fa-edit"},null,-1),p(" Edit ")]),8,ze),S(T,{to:{name:"TaskReports",params:{id:(z=e.task)==null?void 0:z.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:C(()=>s[10]||(s[10]=[t("i",{class:"far fa-file-alt"},null,-1),p(" Reports ")])),_:1},8,["to"])]))]),t("div",Je,[w.value?(n(),_(ae,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:r,onAddClick:g},{"tree-item-end":C(({task:h,level:L})=>[U(o.$slots,"item-end",{level:L,task:h})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):k("",!0)])])],2)])}}};export{Ve as _,ne as a,j as g};
