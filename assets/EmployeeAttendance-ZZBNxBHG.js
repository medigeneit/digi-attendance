import{u as Q,b as Y,r as _,A as h,e as G,J as X,m as Z,n as I,c as v,o as c,a as t,p as k,g as z,f as V,h as J,i as O,v as ee,j as d,t as p,k as r,E as te}from"./index-DKvvHbAy.js";import{_ as se}from"./AttendanceTable-BRmY0RW1.js";import{_ as ne}from"./EmployeeFilter-BntCo-xT.js";import{L as oe}from"./LoaderView-a1BRn5bT.js";import{S as le}from"./SelectedEmployeeCard-BIjk_RWt.js";import{u as ae}from"./attendance-DrUYwgoZ.js";import{u as re}from"./user-DA5B48op.js";import"./datetime-Efw590t9.js";import"./company-B6J0YW63.js";import"./department-CqCOGS51.js";import"./EmployeeDropdownInput-Bk38Y4rM.js";import"./SelectDropdown-imgkIA7V.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BciQLR_x.js";const ie={class:"px-4 space-y-4"},de={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl"},pe={class:"grid md:grid-cols-2 gap-4 text-sm mt-2"},ue={class:"card-bg p-4 gap-1"},me={class:"flex justify-between items-center"},ce={class:"px-1 pt-1 pb-0.5 overflow-hidden"},ye={class:"-mx-1 flex items-center gap-2 overflow-x-auto px-1"},fe={key:0,class:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-0.5 text-[11px] font-medium text-emerald-700 whitespace-nowrap"},xe={class:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2.5 py-0.5 text-[11px] font-medium text-amber-700 whitespace-nowrap"},ge={class:"inline-flex items-center gap-1 rounded-full border border-red-200 bg-red-50 px-2.5 py-0.5 text-[11px] font-medium text-red-700 whitespace-nowrap"},_e={class:"inline-flex items-center gap-1 rounded-full border border-sky-200 bg-sky-50 px-2.5 py-0.5 text-[11px] font-medium text-sky-700 whitespace-nowrap"},ve={class:"grid md:grid-cols-3 gap-2 mt-1"},be={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},we={class:"text-sm text-zinc-900"},he={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},ke={class:"text-sm text-zinc-900"},ze={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Se={class:"text-sm text-zinc-900"},$e={key:0},Ae={key:2,class:"space-y-4"},Ve={__name:"EmployeeAttendance",setup(Ue){const S=Q(),$=Y(),o=ae(),A=re(),f=s=>{if(!s)return"";if(typeof s=="string"){if(/^\d{4}-\d{2}$/.test(s))return s;const e=s.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(s),l=e.getFullYear(),m=String(e.getMonth()+1).padStart(2,"0");return`${l}-${m}`}catch{return""}},y=$.query,i=_(f(y.date)||f(o.selectedMonth)||f(new Date)),n=_({company_id:y.company_id||"",department_id:y.department_id||"all",line_type:y.line_type||"all",employee_id:y.employee_id||""}),u=_(null);let b=null;const x=(s={})=>{b&&clearTimeout(b),b=setTimeout(()=>{const e={...$.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:i.value||"",...s};Object.keys(e).forEach(l=>{(e[l]===""||e[l]===void 0||e[l]===null)&&delete e[l]}),S.replace({query:e}).catch(()=>{})},150)},U=async s=>{if(!s){u.value=null;return}try{await A.fetchUser(s),u.value=A.user||null}catch(e){console.error("fetchUser error:",e),u.value=null}},g=_(""),w=async()=>{const s=n.value.employee_id,e=i.value;if(!s||!e)return;const l=`${s}|${e}`;if(l!==g.value){g.value=l;try{await o.getMonthlyAttendanceByShift(s,e)}catch(m){console.error("fetchAttendance error:",m),g.value=""}}};h(()=>i.value,s=>{i.value=f(s),x({date:i.value})}),h(()=>({...n.value}),()=>{x()}),h(()=>n.value.employee_id,async(s,e)=>{s&&s!==e&&(await U(s),await w()),s||(u.value=null,g.value="")}),G(async()=>{n.value.employee_id&&await U(n.value.employee_id),n.value.employee_id&&i.value&&await w(),await X(),x()});const K=()=>S.go(-1),P=()=>{x()},C=Z(()=>!!n.value.employee_id);return(s,e)=>{var m,M,q,T,j,B,L,D,E,F,H,N,W,R;const l=I("router-link");return c(),v("div",ie,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:K},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Job Card",-1)),e[7]||(e[7]=t("div",null,null,-1))]),k(ne,{company_id:n.value.company_id,"onUpdate:company_id":e[1]||(e[1]=a=>n.value.company_id=a),department_id:n.value.department_id,"onUpdate:department_id":e[2]||(e[2]=a=>n.value.department_id=a),employee_id:n.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=a=>n.value.employee_id=a),line_type:n.value.line_type,"onUpdate:line_type":e[4]||(e[4]=a=>n.value.line_type=a),"with-type":!0,"initial-value":s.$route.query,onFilterChange:P,class:"w-full"},{default:O(()=>[J(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),onChange:w,class:"input-1 py-0.5","aria-label":"Select month"},null,544),[[ee,i.value]])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",de,[t("div",pe,[C.value?(c(),V(le,{key:0,user:u.value},null,8,["user"])):z("",!0),t("div",ue,[t("div",me,[e[9]||(e[9]=t("h2",{class:"text-sm md:text-base font-semibold text-zinc-900"},"Attendance Summary",-1)),k(l,{to:{name:"MonthWiseApplicationLog",query:{...s.$route.query}},class:"inline-flex items-center gap-1 rounded-md border border-zinc-200 bg-white px-2.5 py-1 text-[12px] font-medium text-zinc-700 hover:bg-zinc-50 active:scale-[.99]",target:"_blank",rel:"noopener noreferrer"},{default:O(()=>e[8]||(e[8]=[t("i",{class:"far fa-clock text-[12px]"},null,-1),t("span",{class:"hidden sm:inline"},"Application History",-1),t("span",{class:"sm:hidden"},"History",-1)])),_:1,__:[8]},8,["to"])]),e[21]||(e[21]=t("div",{class:"h-px w-full bg-gradient-to-r from-indigo-500/70 via-sky-400/70 to-cyan-400/70"},null,-1)),t("div",ce,[t("div",ye,[s.presentRate!==null?(c(),v("span",fe,[e[10]||(e[10]=t("i",{class:"far fa-check-circle text-[11px]"},null,-1)),e[11]||(e[11]=d(" Present ")),t("strong",null,p(((M=(m=r(o))==null?void 0:m.summary)==null?void 0:M.total_present_days)||0)+"d",1)])):z("",!0),t("span",xe,[e[12]||(e[12]=t("i",{class:"far fa-clock text-[11px]"},null,-1)),e[13]||(e[13]=d(" Late ")),t("strong",null,p((T=(q=r(o))==null?void 0:q.summary)==null?void 0:T.actual_late_day)+"d",1)]),t("span",ge,[e[14]||(e[14]=t("i",{class:"far fa-user-times text-[11px]"},null,-1)),e[15]||(e[15]=d(" Absent ")),t("strong",null,p(((B=(j=r(o))==null?void 0:j.summary)==null?void 0:B.total_absent_days)||0)+"d",1)]),t("span",_e,[e[16]||(e[16]=t("i",{class:"far fa-bolt text-[11px]"},null,-1)),e[17]||(e[17]=d(" Total Weekends ")),t("strong",null,p((D=(L=r(o))==null?void 0:L.summary)==null?void 0:D.total_weekend_days)+"d",1)])])]),t("div",ve,[t("div",be,[e[18]||(e[18]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-briefcase text-[12px]"}),d(" Total Working Days ")],-1)),t("strong",we,p(((F=(E=r(o))==null?void 0:E.summary)==null?void 0:F.total_working_days)||0),1)]),t("div",he,[e[19]||(e[19]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-hourglass-half text-[12px]"}),d(" Working Hours ")],-1)),t("strong",ke,p((((N=(H=r(o))==null?void 0:H.summary)==null?void 0:N.total_working_hours)??"").toString().trim()||"—"),1)]),t("div",ze,[e[20]||(e[20]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-bolt text-[12px]"}),d(" Overtime Hours ")],-1)),t("strong",Se,p(((R=(W=r(o))==null?void 0:W.summary)==null?void 0:R.total_overtime_hours)||"—"),1)])])])])]),u.value?z("",!0):(c(),v("div",$e,e[22]||(e[22]=[t("p",{class:"text-gray-400 text-center text-2xl italic"},"Select an employee, please.",-1)]))),r(o).isLoading?(c(),V(oe,{key:1})):J((c(),v("div",Ae,[k(se,{logs:r(o).monthlyLogs},null,8,["logs"])],512)),[[te,C.value]])])}}};export{Ve as default};
