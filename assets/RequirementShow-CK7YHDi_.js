import{r as _,e as L,I as ke,c as p,o as n,a as e,g as x,s as ue,n as F,w as h,J as we,j as T,t as k,f as R,F as E,h as N,y as q,v as V,i as I,A as pe,d as _e,p as ce,C as be,x as G,q as he,k as ve,b as $e,u as qe,z as j}from"./index-nvZG5ov6.js";import{L as z}from"./LoaderView-DYNZ0Zil.js";import{O as M}from"./OverlyModal-DWXgngsG.js";import{R as fe}from"./RequiredIcon-CsiMf5kz.js";import{f as Y}from"./requirement-CHwcQKaY.js";import{a as Ce,f as K,d as Ie,u as De,b as Se,_ as Re}from"./TaskAddForm-CGoLMm3T.js";import{u as xe}from"./department-Bf7uhEmZ.js";import{S as ye}from"./SelectDropdown-CSb2COyL.js";import{_ as W}from"./UserChip-B7a2f22X.js";import{u as ge}from"./user-CUrwngW_.js";import{_ as Te}from"./TaskUserChip-Ch3PHzMs.js";import{u as Ee}from"./useTaskStore-DddiGCCa.js";import{_ as me}from"./TaskStatus-BMnSTbEe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-BMqDv-V0.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-B1XM7BBB.js";import"./SectionLoading-Dafk3oxR.js";import"./TextWithHr-BFUo_QnS.js";import"./TaskUrgencyInput-Bhmv5RoD.js";const J={__name:"DescriptionView",props:{lineClamp:{type:[String,Number],default:2},className:{type:Object,default:()=>{}}},setup(g){const D=[""," line-clamp-1 "," line-clamp-2 "," line-clamp-3 "," line-clamp-4 "," line-clamp-5 "," line-clamp-6 "," line-clamp-7 "," line-clamp-8 "," line-clamp-9 "," line-clamp-10 "],c=g,b=_(D[c.lineClamp]),u=_(!1),v=_(null);function a(){const f=v.value;f&&(u.value=f.scrollHeight>f.clientHeight)}function m(){b.value=b.value?"":D[c.lineClamp],we(()=>a())}let s=null;return L(()=>{a(),window.addEventListener("resize",()=>a()),s=new MutationObserver(()=>a()),s.observe(v.value,{childList:!0,subtree:!0,characterData:!0})}),ke(()=>{window.removeEventListener("resize",a),s&&s.disconnect()}),(f,o)=>{var l,t;return n(),p("div",null,[e("p",{ref_key:"descriptionEl",ref:v,class:F(["print:line-clamp-none",b.value+(((l=c==null?void 0:c.className)==null?void 0:l.paragraph)||"")])},[ue(f.$slots,"default")],2),u.value||b.value===""?(n(),p("button",{key:0,class:F(["text-blue-500 hover:text-sky-400 ml-auto text-sm print:hidden mt-2 whitespace-nowrap",((t=c==null?void 0:c.className)==null?void 0:t.button)||""]),onClick:h(m,["prevent"])},[ue(f.$slots,"btnText",{lineClampClass:b.value,isOverflowing:u.value},()=>[T(k(b.value?"Show More":"Show Less"),1)])],2)):x("",!0)])}}},Ne={class:"sticky top-0 pt-4 bg-white z-10"},Fe={class:"mb-4"},Ue={class:"block text-gray-600 text-sm mb-1 font-medium"},Ve={class:"mb-4"},Ae={class:"mb-4"},Le={class:"mb-4"},Oe={class:"mb-4"},je={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Me={key:0,class:"mb-4 text-red-500 font-medium"},ze={key:1,class:"mb-4"},Pe={class:"flex items-center justify-between gap-4"},Be=["disabled"],He={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["create","closeClick","error"],setup(g,{emit:D}){const c=g,b=D,u=xe(),v=_(),a=_(""),m=_(),s=_({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),f=_([]);async function o(){var t,d;a.value="submitting";const l={...s.value};console.log({payload:l});try{const C=await Ce(c.requirementId,l);b("create",C),a.value="create"}catch(C){a.value="error",m.value=((d=(t=C.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to create requirement detail",b("error",m.value)}}return L(async()=>{var t;const l=((t=(await Y(c.requirementId)).data)==null?void 0:t.requirement)||{};f.value=await u.fetchDepartmentEmployee([l.from_department_id])}),(l,t)=>(n(),p("div",{class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative",ref_key:"formContainerRef",ref:v},[e("div",Ne,[t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement",-1)),t[8]||(t[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=h(d=>b("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(o,["prevent"]),class:"z-0"},[a.value!=="loading"?(n(),p(E,{key:0},[e("div",Fe,[e("label",Ue,[t[9]||(t[9]=T("Title ")),q(fe)]),N(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>s.value.title=d),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,s.value.title]])]),e("div",Ve,[t[10]||(t[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Details",-1)),N(e("textarea",{rows:"10","onUpdate:modelValue":t[2]||(t[2]=d=>s.value.description=d),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,s.value.description]])]),e("div",Ae,[t[12]||(t[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),q(ye,{modelValue:s.value.supervisor_id,"onUpdate:modelValue":t[3]||(t[3]=d=>s.value.supervisor_id=d),options:f.value,placeholder:"--NO SUPERVISOR--",containment:v.value,clearable:"",class:"h-10"},{"list-header":I(()=>t[11]||(t[11]=[e("div",{class:"px-3 pt-2 pb-1 shadow-md text-xs uppercase bg-gray-50 text-gray-500"}," Employees ",-1)])),option:I(({option:d})=>[q(W,{user:d||{},class:"pr-5 -mx-1"},null,8,["user"])]),"selected-option":I(({option:d})=>[d?(n(),R(W,{key:0,user:d||{},class:"pr-4"},null,8,["user"])):x("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",Le,[t[14]||(t[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),N(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[4]||(t[4]=d=>s.value.priority=d)},t[13]||(t[13]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[pe,s.value.priority]])]),e("div",Oe,[t[15]||(t[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),N(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=d=>s.value.better_to_complete_on=d),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,s.value.better_to_complete_on]])])],64)):x("",!0),e("div",je,[m.value?(n(),p("div",Me,k(m.value),1)):x("",!0),m.value?(n(),p("hr",ze)):x("",!0),e("div",Pe,[e("button",{type:"button",onClick:t[6]||(t[6]=h(d=>b("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},k(a.value=="submitting"?"Saving...":"Add Requirement"),9,Be)])])],32),a.value==="loading"||a.value==="submitting"?(n(),R(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):x("",!0)],512))}},Ge={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},We={class:"mb-4"},Je={class:"font-semibold"},Ye={class:"mb-4"},Ke={class:"line-clamp-2"},Qe={key:1,class:"min-h-40"},Xe={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Ze={key:0,class:"mb-4 text-red-500 font-medium"},et={key:1,class:"mb-4"},tt={class:"flex items-center justify-between gap-4"},st=["disabled"],lt={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(g,{emit:D}){const c=g,b=D,u=ge(),v=_(null),a=_(""),m=_(),s=_([]);async function f(){var o,l;a.value="submitting";try{const t=await Ie(c.requirementId,c.detailId);b("delete",t),a.value="create"}catch(t){a.value="error",m.value=((l=(o=t.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to update requirement detail: "+t,b("error",m.value)}}return L(async()=>{var o,l,t;a.value="loading";try{s.value=await u.fetchDepartmentWiseEmployees(),v.value=(o=(await K(c.requirementId,c.detailId)).data)==null?void 0:o.detail}catch(d){m.value=((t=(l=d.response)==null?void 0:l.data)==null?void 0:t.message)||"Failed to fetch requirement detail"}finally{a.value=""}}),(o,l)=>{var t,d;return n(),p("div",Ge,[l[4]||(l[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:h(f,["prevent"]),class:"z-0"},[a.value!=="loading"?(n(),p(E,{key:0},[e("div",We,[l[1]||(l[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Je,k((t=v.value)==null?void 0:t.title),1)]),e("div",Ye,[l[2]||(l[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",Ke,k((d=v.value)==null?void 0:d.description),1)]),l[3]||(l[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),p("div",Qe)),e("div",Xe,[m.value?(n(),p("div",Ze,k(m.value),1)):x("",!0),m.value?(n(),p("hr",et)):x("",!0),e("div",tt,[e("button",{type:"button",onClick:l[0]||(l[0]=h(C=>b("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},k(a.value=="submitting"?"Deleting...":"Delete"),9,st)])])],32),a.value==="loading"||a.value==="submitting"?(n(),R(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):x("",!0)])}}},rt={class:"sticky top-0 pt-4 bg-white z-10"},it={class:"mb-4"},nt={class:"block text-gray-600 text-sm mb-1 font-medium"},at={class:"mb-4"},ot={class:"mb-4"},dt={key:0,class:"relative w-full"},ut={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},mt={class:"mb-4"},pt={class:"mb-4"},ct={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},bt={key:0,class:"mb-4 text-red-500 font-medium"},vt={key:1,class:"mb-4"},ft={class:"flex items-center justify-between gap-4"},xt=["disabled"],yt={__name:"RequirementDetailEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(g,{emit:D}){const c=g,b=D,u=_(),v=ge(),a=xe(),m=_(null),s=_(""),f=_(),o=_({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),l=_([]),t=_([]);async function d(){var r,S;s.value="submitting";const C={...o.value};try{const y=await De(c.requirementId,c.detailId,C);b("update",y),s.value="create"}catch(y){s.value="error",f.value=((S=(r=y.response)==null?void 0:r.data)==null?void 0:S.message)||"Failed to update requirement detail",b("error",f.value)}}return L(async()=>{var C,r,S,y,$,i,P,O;s.value="loading";try{l.value=await v.fetchDepartmentWiseEmployees();const A=((C=(await Y(c.requirementId)).data)==null?void 0:C.requirement)||{};t.value=await a.fetchDepartmentEmployee([A.from_department_id]),m.value=(r=(await K(c.requirementId,c.detailId)).data)==null?void 0:r.detail,o.value={title:(S=m.value)==null?void 0:S.title,description:(y=m.value)==null?void 0:y.description,priority:($=m.value)==null?void 0:$.priority,supervisor_id:(i=m.value)==null?void 0:i.supervisor_id};const B=new Date(m.value.better_to_complete_on);o.value.better_to_complete_on=B.toISOString().split("T")[0]}catch(A){f.value=((O=(P=A.response)==null?void 0:P.data)==null?void 0:O.message)||"Failed to fetch requirement detail"}finally{s.value=""}}),(C,r)=>{var S;return n(),p("div",{ref_key:"formContainerRef",ref:u,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",rt,[r[8]||(r[8]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),r[9]||(r[9]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=h(y=>b("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(d,["prevent"]),class:"z-0"},[s.value!=="loading"?(n(),p(E,{key:0},[e("div",it,[e("label",nt,[r[10]||(r[10]=T("Title ")),q(fe)]),N(e("input",{"onUpdate:modelValue":r[1]||(r[1]=y=>o.value.title=y),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,o.value.title]])]),e("div",at,[r[11]||(r[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),N(e("textarea",{rows:"10","onUpdate:modelValue":r[2]||(r[2]=y=>o.value.description=y),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,o.value.description]])]),e("div",ot,[r[12]||(r[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),q(ye,{modelValue:o.value.supervisor_id,"onUpdate:modelValue":r[4]||(r[4]=y=>o.value.supervisor_id=y),options:[...t.value,...t.value.find(y=>{var $,i;return y.id==((i=($=m.value)==null?void 0:$.supervisor)==null?void 0:i.id)})?[]:[(S=m.value)==null?void 0:S.supervisor]],containment:u.value,placeholder:"--NO SUPERVISOR--",class:"h-10"},{option:I(({option:y})=>[q(W,{user:y||{}},null,8,["user"])]),"selected-option":I(({option:y})=>[y?(n(),p("div",dt,[q(W,{user:y||{}},null,8,["user"]),o.value.supervisor_id?(n(),p("div",ut,[e("button",{onClick:r[3]||(r[3]=h($=>o.value.supervisor_id=null,["prevent"])),class:"text-gray-6 font-semibold 00 hover:text-red-700"}," × ")])):x("",!0)])):x("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",mt,[r[14]||(r[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),N(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":r[5]||(r[5]=y=>o.value.priority=y)},r[13]||(r[13]=[e("option",{value:null},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[pe,o.value.priority]])]),e("div",pt,[r[15]||(r[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),N(e("input",{type:"date","onUpdate:modelValue":r[6]||(r[6]=y=>o.value.better_to_complete_on=y),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,o.value.better_to_complete_on]])])],64)):x("",!0),e("div",ct,[f.value?(n(),p("div",bt,k(f.value),1)):x("",!0),f.value?(n(),p("hr",vt)):x("",!0),e("div",ft,[e("button",{type:"button",onClick:r[7]||(r[7]=h(y=>b("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:s.value=="loading"||s.value=="submitting",type:"submit",class:"btn-2"},k(s.value=="submitting"?"Saving...":"Edit"),9,xt)])])],32),s.value==="loading"||s.value==="submitting"?(n(),R(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):x("",!0)],512)}}},gt=["rowspan"],kt={class:"text-2xl font-medium"},wt=["rowspan"],_t={class:"text-lg font-semibold mb-2 flex items-start gap-3"},ht={key:0},$t={key:0,class:"mb-5"},qt=["innerHTML"],Ct={key:1,class:"mt-4 flex justify-between items-end pb-4 print:pb-0"},It={class:""},Dt={class:"flex items-end"},St={class:"ml-auto flex gap-6 items-center"},Rt=["rowspan"],Tt={class:"text-center print:text-xs"},Et={class:"border-2 border-gray-700 p-3 text-center"},Nt=["title"],Ft={class:"border-2 border-gray-700 p-3"},Ut={class:"whitespace-nowrap text-center print:whitespace-break-spaces"},Vt={key:0,class:"print:text-xs"},At={key:1,class:"text-gray-500"},Lt={key:2,colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Ot={__name:"RequirementDetailTableRow",props:{detail:{type:Object},requirement:{type:Object},serial:{type:Number}},emits:["editClick","deleteClick","taskCreateClick"],setup(g,{emit:D}){const c=g,b=D,u=_e(),v=ce(()=>{var m,s,f;return((s=(m=c.detail)==null?void 0:m.tasks)==null?void 0:s.length)>0?(f=c.detail)==null?void 0:f.tasks:[{id:0}]});function a(){var m,s,f,o;if(((m=u.user)==null?void 0:m.department_id)!==((s=c.requirement)==null?void 0:s.to_department_id))return alert(`You can't create or assign task for this requirement. 
Only ${(o=(f=c.requirement)==null?void 0:f.to_department)==null?void 0:o.name}'s user can create or assign.`);b("taskCreateClick",c.detail)}return(m,s)=>{const f=be("RouterLink");return n(!0),p(E,null,G(v.value,(o,l)=>{var t,d,C,r,S,y;return n(),p("tr",{key:o.id,class:"group/item border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},[l===0?(n(),p(E,{key:0},[e("td",{class:"border-2 border-gray-700 p-3 align-top",rowspan:((d=(t=g.detail)==null?void 0:t.tasks)==null?void 0:d.length)||1},[e("span",kt,k(g.serial),1)],8,gt),e("td",{class:"border-2 border-gray-700 p-3",rowspan:((r=(C=g.detail)==null?void 0:C.tasks)==null?void 0:r.length)||1},[e("div",null,[e("div",_t,[q(J,{"line-clamp":"3",class:"grow"},{default:I(()=>[T(k(g.detail.title),1)]),btnText:I(({lineClampClass:$})=>[T(k($?"More":"Less"),1)]),_:1}),g.detail.priority?(n(),p("div",ht,[e("span",{class:F(["font-semibold text-sm",{"text-yellow-600 ":g.detail.priority=="IMPORTANT","text-red-700 ":g.detail.priority=="URGENT"}])},k(g.detail.priority),3)])):x("",!0)]),s[4]||(s[4]=e("hr",{class:"mb-4 -mx-4"},null,-1)),g.detail.description?(n(),p("div",$t,[s[2]||(s[2]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),q(J,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"}},{default:I(()=>[e("p",{innerHTML:g.detail.description,class:"text-justify"},null,8,qt)]),_:1})])):x("",!0),g.detail.supervisor?(n(),p("div",Ct,[e("div",It,[s[3]||(s[3]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Supervisor:",-1)),q(Te,{user:g.detail.supervisor},null,8,["user"])])])):x("",!0)]),e("div",Dt,[e("div",St,[e("button",{class:"btn-2",onClick:s[0]||(s[0]=h($=>b("editClick",g.detail),["prevent"]))},s[5]||(s[5]=[e("i",{class:"fas fa-edit"},null,-1),T("Edit ")])),e("button",{class:"btn-2-red",onClick:s[1]||(s[1]=h($=>b("deleteClick",g.detail),["prevent"]))},s[6]||(s[6]=[e("i",{class:"fas fa-trash-alt"},null,-1),T("Delete ")]))])])],8,wt),e("td",{class:"border-2 border-gray-700 p-3 whitespace-nowrap print:whitespace-break-spaces print:px-0",rowspan:((y=(S=g.detail)==null?void 0:S.tasks)==null?void 0:y.length)||1},[e("div",Tt,k(new Date(g.detail.better_to_complete_on).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)],8,Rt)],64)):x("",!0),o.id?(n(),p(E,{key:1},[e("td",Et,[q(f,{to:{name:"TaskShow",params:{id:o.id}},class:"hover:underline text-gray-900 hover:text-blue-600 whitespace-nowrap block",target:"_blank"},{default:I(()=>[T(k(o.id)+" ",1),e("i",{title:o.status,class:F(["ml-1",{"fad fa-exclamation-circle text-red-600":o.status=="PENDING","fad fa-exclamation-square text-yellow-600":o.status=="IN_PROGRESS","fad fa-check-circle text-green-600":o.status=="COMPLETED"}])},null,10,Nt)]),_:2},1032,["to"])]),e("td",Ft,[e("div",Ut,[o.deadline?(n(),p("div",Vt,k(new Date(o.deadline).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)):(n(),p("div",At,"-"))])])],64)):(n(),p("td",Lt,[e("button",{onClick:h(a,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"}," Create / Assign Task ")]))])}),128)}}},jt={class:"sticky top-0 pt-4 bg-white z-10"},Mt={class:"mb-4"},zt={class:"mb-4"},Pt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Bt={key:0,class:"mb-4 text-red-500 font-medium"},Ht={key:1,class:"mb-4"},Gt={class:"flex items-center justify-between gap-4"},Wt=["disabled"],Jt={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(g,{emit:D}){const c=g,b=D,u=_(),v=_(null),a=_(""),m=_(),s=_({feedback:""});async function f(){var o,l;a.value="submitting";try{const t=await Se(c.requirementId,c.detailId,s.value.feedback);b("update",t),a.value="create"}catch(t){a.value="error",m.value=((l=(o=t.response)==null?void 0:o.data)==null?void 0:l.message)||"Failed to update requirement detail",b("error",m.value)}}return L(async()=>{var o,l,t,d;a.value="loading";try{await Y(c.requirementId),v.value=(o=(await K(c.requirementId,c.detailId)).data)==null?void 0:o.detail,s.value={feedback:(l=v.value)==null?void 0:l.feedback}}catch(C){m.value=((d=(t=C.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to fetch requirement detail"}finally{a.value=""}}),(o,l)=>{var t;return n(),p("div",{ref_key:"formContainerRef",ref:u,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",jt,[l[3]||(l[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),l[4]||(l[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:l[0]||(l[0]=h(d=>b("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:h(f,["prevent"]),class:"z-0"},[a.value!=="loading"?(n(),p(E,{key:0},[e("div",Mt,[l[5]||(l[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),q(J,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:I(()=>{var d;return[T(k((d=v.value)==null?void 0:d.title),1)]}),_:1})]),e("div",zt,[l[6]||(l[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),N(e("textarea",{rows:"5","onUpdate:modelValue":l[1]||(l[1]=d=>s.value.feedback=d),placeholder:"Enter requirement feedback",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[V,s.value.feedback]])])],64)):x("",!0),e("div",Pt,[m.value?(n(),p("div",Bt,k(m.value),1)):x("",!0),m.value?(n(),p("hr",Ht)):x("",!0),e("div",Gt,[e("button",{type:"button",onClick:l[2]||(l[2]=h(d=>b("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"btn-2"},k(a.value=="submitting"?"Saving...":(t=v.value)!=null&&t.feedback?"Update Feedback":"Add Feedback"),9,Wt)])])],32),a.value==="loading"||a.value==="submitting"?(n(),R(z,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):x("",!0)],512)}}},Yt={class:"text-left p-4"},Kt={class:"flex items-center gap-6 justify-center my-16"},Qt={key:0},Xt={class:"bg-blue-50 px-6 py-4 rounded text-blue-500"},Zt={class:"text-left text-base w-full font-semibold group flex items-center gap-2 mb-5 border-b border-blue-100 py-4"},es={class:"flex items-center w-full"},ts={class:"grow"},ss={class:"text-center text-red-500 text-sm font-semibold mb-4"},ls={class:"flex items-center justify-between"},rs={key:1,class:"border rounded-md"},is={class:"flex flex-col justify-start items-start min-h-28 max-h-[70vh] overflow-y-auto"},ns=["onClick"],as={class:"flex items-center w-full"},os={class:"grow"},ds={class:"line-clamp-1"},us={key:0,class:"text-red-400 text-xs font-normal mt-1"},ms={__name:"TaskParentIdSelector",props:{fromDepartmentId:{type:Number},requirementDetail:{type:Object}},emits:["parentIdSelect","cancelClick","assignTask"],setup(g,{emit:D}){const c=g,b=D,u=Ee(),v=_(""),a=_(null);he(()=>v.value,(o,l)=>{l||u.fetchTasks({"from-department-id":c.fromDepartmentId})},{immediate:!0});function m(o){if(v.value=="sub-task")b("parentIdSelect",o.id);else{if(o.requirement_detail_id)return alert("This task already assigned to another requirement. Can't be assigned.");a.value=o}}async function s(){await u.setTaskRequirement(a.value.id,c.requirementDetail.id),b("assignTask")}const f=ce(()=>(u==null?void 0:u.tasks)||[]);return(o,l)=>{var t;return n(),p("div",Yt,[e("div",Kt,[e("button",{onClick:l[0]||(l[0]=h(d=>b("parentIdSelect",0,v.value),["prevent"])),class:"btn-3"}," Add as Main Task "),e("button",{class:F({"btn-3":v.value!=="sub-task","btn-2":v.value=="sub-task"}),onClick:l[1]||(l[1]=h(()=>{v.value="sub-task",a.value=null},["prevent"]))}," Add as Sub Task ",2),e("button",{class:F({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:l[2]||(l[2]=h(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value=="direct-assign"&&a.value?(n(),p("div",Qt,[e("div",Xt,[e("div",Zt,[e("i",{class:F(["fad text-xl group:hover-text-white",((t=a.value)==null?void 0:t.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",es,[e("div",ts,k(a.value.title),1),q(me,{status:a.value.status,class:"ml-auto"},null,8,["status"])])]),e("div",ss,k(ve(u).error),1),e("div",ls,[e("button",{onClick:h(s,["prevent"]),class:"btn-2"},"Assign"),e("button",{onClick:l[3]||(l[3]=h(d=>b("cancelClick"),["prevent"])),class:"btn-3"},"Cancel")])])])):x("",!0),v.value&&!a.value?(n(),p("div",rs,[l[4]||(l[4]=e("div",{class:"py-2 px-4 font-bold text-center border-b shadow"},"Click to select task",-1)),e("div",is,[(n(!0),p(E,null,G(f.value,d=>(n(),p("div",{key:d.id,class:"w-full mb-2"},[e("button",{type:"button",class:"text-left text-base w-full bg-blue-50 px-2 hover:bg-blue-500 hover:text-white py-2 text-blue-500 font-semibold group flex items-center gap-2",onClick:h(()=>m(d),["prevent"])},[e("i",{class:F(["fad text-xl group:hover-text-white",(d==null?void 0:d.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",as,[e("div",os,[e("div",ds,k(d.title),1),d.requirement_detail_id&&v.value=="direct-assign"?(n(),p("div",us," Already assigned to a requirement ")):x("",!0)]),q(me,{status:d.status,class:"ml-auto"},null,8,["status"])])],8,ns)]))),128))])])):x("",!0)])}}},ps={class:"container mx-auto p-6 print:p-0 w-full print:max-w-full"},cs={class:"bg-white rounded shadow print:shadow-none p-4 print:p-0 relative"},bs={class:"flex items-start"},vs={class:"mb-4 text-lg print:black print:font-bold"},fs={class:"ml-auto print:hidden flex gap-2 items-center"},xs={class:"mb-4 flex items-center gap-1 print:mb-1"},ys={class:"font-bold print:text-gray-900"},gs={class:"mb-3 flex items-center gap-3 print:mb-1"},ks={class:"print:text-gray-900"},ws={key:0,class:"mb-3 flex items-center gap-3 print:mb-1"},_s={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},hs={class:"mb-3 flex items-center gap-3 print:mb-1"},$s={class:"print:text-gray-900"},qs={key:0,class:"overflow-x-auto print:overflow-visible"},Cs={class:"w-full table-auto print:table-fixed"},Is={colspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap px-3 py-1 print:whitespace-normal w-[25%]"},Ds={class:""},Ss={class:"whitespace-nowrap print:whitespace-break-spaces print:px-0 p-3 text-center border-2 border-gray-800"},Rs={class:"text-gray-900 text-base"},Ts={class:"p-3 border-2 border-gray-800",colspan:"4"},Es={key:0,class:"font-semibold text-sm mb-2"},Ns=["innerHTML"],Fs=["onClick"],Us={class:"mt-8 border rounded-md p-8 flex items-center justify-center bg-gray-50"},sl={__name:"RequirementShow",setup(g){const D=$e(),c=qe(),b=_(""),u=_(null),v=j({open:!1}),a=j({detail:null,open:!1}),m=j({detail:null,open:!1}),s=j({detail:null,open:!1});L(async()=>{await f()});async function f(){var $;b.value="loading",u.value=($=(await Y(D.params.id)).data)==null?void 0:$.requirement,b.value=""}function o($){console.log({detail:$}),r.modalShown=!0,r.from_department_id=u.value.from_department_id,r.to_department_id=u.value.to_department_id,r.taskDefaultValues={title:$.title,description:$.description,from_department_id:u.value.from_department_id,to_department_id:u.value.to_department_id},r.requirementDetail=$}function l(){v.open=!0}function t($){a.open=!0,a.detail=$}function d($){s.open=!0,s.detail=$}function C(){window.print()}const r=j({parentId:null,modalShown:!1,requirementId:0,taskDefaultValues:{},requirementDetail:null});async function S(){r.parentId=0,r.parentId=null,r.modalShown=!1,r.requirementDetail=null,b.value="loading",await f()}async function y(){r.parentId=null,r.modalShown=!1,r.requirementDetail=null}return($,i)=>{var O,A,B,Q,X,Z,ee,te,se,le,re,ie,ne,ae,oe;const P=be("RouterLink");return n(),p("div",ps,[v.open?(n(),R(M,{key:0,class:"*:max-w-4xl"},{default:I(()=>[q(He,{requirementId:u.value.id,onCloseClick:i[0]||(i[0]=w=>v.open=!1),onCreate:i[1]||(i[1]=async()=>{v.open=!1,await f()})},null,8,["requirementId"])]),_:1})):x("",!0),a.open?(n(),R(M,{key:1},{default:I(()=>{var w;return[q(yt,{requirementId:u.value.id,detailId:(w=a.detail)==null?void 0:w.id,onCloseClick:i[2]||(i[2]=U=>a.open=!1),onUpdate:i[3]||(i[3]=async()=>{a.open=!1,await f()})},null,8,["requirementId","detailId"])]}),_:1})):x("",!0),m.open?(n(),R(M,{key:2},{default:I(()=>{var w;return[q(Jt,{requirementId:u.value.id,detailId:(w=m.detail)==null?void 0:w.id,onCloseClick:i[4]||(i[4]=U=>m.open=!1),onUpdate:i[5]||(i[5]=async()=>{m.open=!1,await f()})},null,8,["requirementId","detailId"])]}),_:1})):x("",!0),s.open?(n(),R(M,{key:3},{default:I(()=>{var w;return[q(lt,{requirementId:u.value.id,detailId:(w=s.detail)==null?void 0:w.id,onCloseClick:i[6]||(i[6]=U=>s.open=!1),onDelete:i[7]||(i[7]=async()=>{s.open=!1,await f()})},null,8,["requirementId","detailId"])]}),_:1})):x("",!0),r.modalShown?(n(),R(M,{key:4,class:"*:relative"},{default:I(()=>{var w,U;return[e("button",{onClick:h(y,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},i[10]||(i[10]=[e("i",{class:"fas fa-times-circle"},null,-1)])),r.parentId===null?(n(),R(ms,{key:0,"from-department-id":(w=u.value)==null?void 0:w.from_department_id,requirementDetail:r==null?void 0:r.requirementDetail,onParentIdSelect:i[8]||(i[8]=H=>r.parentId=H),onCancelClick:y,onAssignTask:S},null,8,["from-department-id","requirementDetail"])):(n(),R(Re,{key:1,parentTaskId:r.parentId,requirementDetailId:(U=r==null?void 0:r.requirementDetail)==null?void 0:U.id,requirementId:u.value.id,onClose:y,onTaskCreated:S,defaultValues:r.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["parentTaskId","requirementDetailId","requirementId","defaultValues"]))]}),_:1})):x("",!0),e("div",cs,[e("div",bs,[e("div",vs,[i[11]||(i[11]=e("div",{class:"text-gray-800 leading-none"},"To",-1)),e("div",null,k((A=(O=u.value)==null?void 0:O.to_department)==null?void 0:A.name),1)]),e("div",fs,[(((B=u.value)==null?void 0:B.details)||[]).length>0?(n(),p("button",{key:0,class:"btn-3 font-semibold !pl-2 !pr-4",onClick:h(C,["prevent"])},i[12]||(i[12]=[e("i",{class:"fad fa-print text-xl"},null,-1),T("Print ")]))):x("",!0),e("button",{class:"btn-3",onClick:i[9]||(i[9]=h(()=>ve(c).back(),["prevent"]))},"Back"),q(P,{class:"btn-2",to:`/requirements/edit/${(Q=u.value)==null?void 0:Q.id}`},{default:I(()=>i[13]||(i[13]=[T("Edit")])),_:1,__:[13]},8,["to"])])]),i[25]||(i[25]=e("div",{class:"text-center text-xl font-bold mb-2 underline"},"Requirement Form",-1)),e("div",xs,[i[14]||(i[14]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",ys,k((X=u.value)==null?void 0:X.id),1)]),e("div",gs,[i[15]||(i[15]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),e("div",ks,k((ee=(Z=u.value)==null?void 0:Z.from_department)==null?void 0:ee.name),1)]),((se=(te=u.value)==null?void 0:te.website_tags)==null?void 0:se.length)>0?(n(),p("div",ws,[i[16]||(i[16]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",_s,[(n(!0),p(E,null,G(((le=u.value)==null?void 0:le.website_tags)||[],w=>(n(),p("div",{key:w.id,class:"border px-2 rounded-md bg-gray-50 shadow-sm whitespace-nowrap"},k(w.name),1))),128))])])):x("",!0),e("div",hs,[i[17]||(i[17]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",$s,k(new Date((re=u.value)==null?void 0:re.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)]),i[26]||(i[26]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[i[24]||(i[24]=e("div",{class:"flex items-end mb-3"},[e("h2",{class:"text-xl font-semibold"},"Requirements"),e("div",{class:"ml-auto print:hidden flex gap-2 text-sm"})],-1)),(((ie=u.value)==null?void 0:ie.details)||[]).length>0?(n(),p("div",qs,[e("table",Cs,[e("thead",null,[e("tr",null,[i[18]||(i[18]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-left px-4 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[15%]"}," SL ",-1)),i[19]||(i[19]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap w-[65%]"}," Requirement Details ",-1)),i[20]||(i[20]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Better To Complete ",-1)),e("th",Is," For '"+k(((ne=u.value.to_department)==null?void 0:ne.short_name)||((ae=u.value.to_department)==null?void 0:ae.name))+"' Use ",1)]),i[21]||(i[21]=e("tr",null,[e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal"}," Issue No "),e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal print:p-0"}," Expected Date ")],-1))]),e("tbody",null,[(n(!0),p(E,null,G(((oe=u.value)==null?void 0:oe.details)||[],(w,U)=>{var H,de;return n(),p(E,{key:w.id},[q(Ot,{requirement:u.value,detail:w,serial:U+1,onEditClick:t,onDeleteClick:d,onTaskCreateClick:o},null,8,["requirement","detail","serial"]),e("tr",Ds,[e("td",Ss,[e("div",Rs," For '"+k(((H=u.value.to_department)==null?void 0:H.short_name)||((de=u.value.to_department)==null?void 0:de.name))+"' Use ",1),i[22]||(i[22]=e("div",{class:"text-gray-800 text-xs"},"(Feedback)",-1))]),e("td",Ts,[e("div",null,[w!=null&&w.feedback?(n(),p("div",Es,"Feedback")):x("",!0),w!=null&&w.feedback?(n(),R(J,{key:1,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:I(()=>[e("p",{class:"text-sky-500 text-sm",innerHTML:w==null?void 0:w.feedback},null,8,Ns)]),_:2},1024)):x("",!0),e("div",null,[e("button",{class:"btn-3 print:hidden",onClick:h(()=>{m.open=!0,m.detail=w},["prevent"])},k(w.feedback?"Update Feedback":"Add feedback"),9,Fs)])])])])],64)}),128))])])])):x("",!0),e("div",Us,[e("button",{class:"btn-2 pl-2 text-base",onClick:h(l,["prevent"])},i[23]||(i[23]=[e("i",{class:"fad fa-plus-circle text-2xl mr-2"},null,-1),T("Add Requirement ")]))])]),b.value==="loading"?(n(),R(z,{key:1,class:"absolute inset-0 bg-opacity-90"})):x("",!0)])])}}};export{sl as default};
