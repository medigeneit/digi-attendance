import{u as te,f as se,r as p,x as v,h as le,q as N,c as a,o as i,a as t,i as oe,d as k,m as R,n as B,k as D,b as g,t as c,l as x,Q as E,T as ne,F as ae,e as ie,s as de,w as y,v as V,H as re}from"./index-C-UcOQwp.js";import{_ as ue}from"./EmployeeFilter-C11oeSfo.js";import{_ as pe}from"./FlexibleDatePicker-BAuXFuLL.js";import{L as ce}from"./LoaderView-CxA1mRNn.js";import{S as me}from"./SelectedEmployeeCard-D6A4MCII.js";import{u as xe}from"./manual-attendance-J832XTZG.js";import{u as ye}from"./user-DJ9YNwUR.js";import"./company-OMvKcwyp.js";import"./department-BxQpWnsy.js";import"./EmployeeDropdownInput-wfR7oUEG.js";import"./SelectDropdown-DFpGRPHF.js";import"./UserChip-BBHV_FtI.js";const fe={class:"max-w-7xl mx-auto px-4 py-4 space-y-4"},be={class:"p-3 rounded-2xl border border-white/20 bg-white/60 backdrop-blur-md shadow-sm supports-[backdrop-filter]:bg-white/50 sticky top-14 z-50"},_e={class:"flex flex-wrap gap-3 items-start"},ve={key:0,class:"py-8"},ge={key:1,class:"space-y-4"},he={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},we={class:"rounded-2xl border border-slate-200 bg-white shadow-sm p-4 flex flex-col justify-between gap-3"},ke={class:"space-y-2 text-sm"},Se={class:"flex items-center justify-between"},Ce={class:"inline-flex items-center gap-1 rounded-full border border-indigo-100 bg-indigo-50 px-2 py-0.5 text-[11px] text-indigo-700"},Ve={class:"font-semibold"},Ae={class:"grid grid-cols-3 gap-3 mt-1 text-xs text-slate-600"},Me={class:"flex flex-col gap-0.5"},Ue={class:"text-sm font-semibold text-slate-900"},Te={class:"flex flex-col gap-0.5"},Ne={class:"text-sm font-semibold text-emerald-700"},De={class:"flex flex-col gap-0.5"},Fe={class:"text-sm font-semibold"},qe={key:0,class:"text-emerald-700"},ze={key:1,class:"text-slate-600"},$e={class:"flex items-center justify-between border-t border-slate-100 pt-3 mt-1"},je={for:"directApprove",class:"flex items-center gap-2 text-xs md:text-sm text-slate-700 cursor-pointer"},Oe={class:"rounded-2xl border border-slate-200 bg-white shadow-sm"},Re={class:"flex flex-wrap items-center justify-between gap-2 border-b border-slate-100 px-4 py-3"},Be={class:"flex flex-wrap items-center gap-2 text-xs"},Ee={class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-slate-50 px-2 py-0.5 text-slate-600"},Ie={class:"font-semibold text-emerald-700"},Pe={class:"px-4 pt-3"},He={key:0,class:"mb-3 rounded-lg border border-red-100 bg-red-50 px-3 py-2 text-xs text-red-700"},Le={class:"min-h-[220px]"},Qe={key:0,class:"min-w-full table-fixed border-separate border-spacing-0 text-sm"},Ke={class:"bg-slate-50 text-slate-700 sticky top-40 z-50"},We={class:"sticky top-0 z-10 w-[80px] border-b border-slate-200 px-2 py-2 text-center text-xs font-medium"},Ye={class:"inline-flex items-center gap-2"},Je=["onClick"],Ge={class:"px-2 py-2 text-center"},Xe=["onUpdate:modelValue"],Ze={class:"px-2 py-2"},et=["onUpdate:modelValue","disabled"],tt={class:"px-2 py-2"},st=["onUpdate:modelValue","disabled"],lt={class:"px-2 py-2"},ot=["onUpdate:modelValue","disabled"],nt={class:"px-2 py-2"},at=["onUpdate:modelValue","disabled"],it={class:"px-2 py-2"},dt=["onUpdate:modelValue","disabled"],rt={key:1,class:"flex min-h-[180px] flex-col items-center justify-center gap-2 text-center"},ut={class:"flex flex-col md:flex-row items-center justify-between gap-3 border-t border-slate-100 px-4 py-3 bg-slate-50/60"},pt={class:"text-xs md:text-sm text-slate-600"},ct={class:"font-semibold text-slate-900"},mt={class:"font-semibold text-slate-900"},xt={class:"flex items-center gap-3"},yt={key:0,class:"text-xs text-red-500"},ft=["disabled"],bt={key:0},_t={key:1},Dt={__name:"AdminManualAttendanceApplication",setup(vt){const F=te(),h=se(),d=xe(),I=ye(),A=h.query.date||d.selectedMonth||new Date().toISOString().slice(0,7),f=p(A),r=p([]),m=p(!1),b=p(null),S=p(!0),o=p({company_id:h.query.company_id||"",department_id:h.query.department_id||"",line_type:h.query.line_type||"all",employee_id:h.query.employee_id||""}),P=l=>l.toString().padStart(2,"0"),_=p({year:Number(A.split("-")[0]||new Date().getFullYear()),month:Number(A.split("-")[1]||new Date().getMonth()+1),day:1}),M=v(()=>{var l,e;return!((l=_.value)!=null&&l.year)||!((e=_.value)!=null&&e.month)?"":`${_.value.year}-${P(_.value.month)}`}),q=async()=>{const l={company_id:o.value.company_id,department_id:o.value.department_id,line_type:o.value.line_type,selectedMonth:f.value,selectedStatus:d.selectedStatus};if(o.value.employee_id){l.user_id=o.value.employee_id,m.value=!0;try{await d.fetchAdminManualAttendances(l)}finally{m.value=!1}}else typeof d.setAttendances=="function"?d.setAttendances([]):d.attendances=[]};function H(){const l={};return f.value&&(l.date=String(f.value)),o.value.company_id&&(l.company_id=String(o.value.company_id)),o.value.department_id&&(l.department_id=String(o.value.department_id)),o.value.line_type&&o.value.line_type!=="all"&&(l.line_type=String(o.value.line_type)),o.value.employee_id&&(l.employee_id=String(o.value.employee_id)),l}let U=null;function L(){U&&clearTimeout(U),U=setTimeout(()=>{F.replace({query:H()}).catch(()=>{})},120)}let T=null;const z=p("");async function Q(){L();const l=JSON.stringify({m:f.value||"",c:o.value.company_id||"",d:o.value.department_id||"",t:o.value.line_type||"all",e:o.value.employee_id||""});l!==z.value&&(await q(),z.value=l)}function C(){T&&clearTimeout(T),T=setTimeout(Q,200)}le(async()=>{await I.fetchUsers(),C()});function K(){C()}function W(){F.go(-1)}N(M,()=>{f.value=M.value,C()}),N(()=>({...o.value,month:M.value}),()=>C(),{deep:!0}),v(()=>d.attendances||[]);const w=v(()=>r.value.filter(l=>l.is_check).length),Y=v(()=>!!o.value.employee_id&&w.value>0),$=v(()=>!!o.value.employee_id),j=v(()=>r.value.length),J=l=>{if(!l)return"";if(typeof l=="string"){const e=l.indexOf("T");return e>-1?l.slice(0,e):l.slice(0,10)}try{const e=new Date(l);if(!Number.isNaN(e.getTime()))return e.toISOString().slice(0,10)}catch{}return""},O=l=>{if(!l)return"";if(typeof l=="string"){const e=l.indexOf("T");return e>-1&&l.length>=e+9?l.slice(e+1,e+6):l.slice(0,5)}try{const e=new Date(l);if(!Number.isNaN(e.getTime())){const s=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0");return`${s}:${u}`}}catch{}return""},G=l=>[...l||[]].sort((e,s)=>{const u=new Date((e==null?void 0:e.date)||(e==null?void 0:e.created_at)||null),n=new Date((s==null?void 0:s.date)||(s==null?void 0:s.created_at)||null);return(u.getTime()||0)-(n.getTime()||0)});N(()=>d.attendances,l=>{r.value=[],G(l).forEach(s=>{r.value.push({date:J(s==null?void 0:s.date),type:"Forget Punch",check_in:O(s==null?void 0:s.entry_time),check_out:O(s==null?void 0:s.exit_time),description:"",is_check:!1})})},{immediate:!0,deep:!0});function X(){const l=r.value.length>0&&r.value.every(e=>e.is_check);r.value.forEach(e=>{e.is_check=!l})}function Z(l){l.is_check=!l.is_check}async function ee(){var l;if(m.value=!0,b.value=null,!o.value.employee_id){b.value="Please select an employee.",m.value=!1;return}try{const e=r.value.filter(n=>n.is_check&&(n.check_in||n.check_out));if(!e.length){b.value="Please select at least one row and fill Check-In/Check-Out time.";return}const s=e.map(n=>({user_id:o.value.employee_id,type:n.type,check_in:n.check_in?`${n.date} ${n.check_in}:00`:null,check_out:n.check_out?`${n.date} ${n.check_out}:00`:null,description:n.description||""})),u=await d.createBulkManualAttendance({records:s,direct_approve:S.value});(l=u==null?void 0:u.data)!=null&&l.length&&await q()}catch(e){b.value=(e==null?void 0:e.message)||"Failed to submit manual attendance requests."}finally{m.value=!1}}return(l,e)=>(i(),a("div",fe,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-1.5 text-sm text-slate-700 shadow-sm hover:bg-slate-50",onClick:W},e[13]||(e[13]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:inline"},"Back",-1)])),e[14]||(e[14]=t("div",{class:"flex flex-col items-center text-center"},[t("h1",{class:"text-base md:text-lg font-semibold text-slate-900"}," Admin Bulk Manual Attendance "),t("p",{class:"text-[11px] md:text-xs text-slate-500"}," Create multiple manual records for a single employee within a selected month ")],-1)),e[15]||(e[15]=t("div",{class:"w-[80px] md:w-[120px]"},null,-1))]),t("section",be,[e[16]||(e[16]=oe('<div class="flex items-center justify-between gap-2 mb-3"><div class="flex flex-col"><span class="text-xs font-semibold uppercase tracking-wide text-slate-500"> Filters </span><span class="text-[11px] text-slate-400"> Select company, department &amp; employee, then choose the month </span></div><div class="flex items-center gap-2 text-xs text-slate-500"><span class="inline-flex items-center gap-1 rounded-full border border-amber-100 bg-amber-50 px-2 py-0.5 text-amber-700"><span class="h-1.5 w-1.5 rounded-full bg-amber-500"></span> Required: Employee &amp; Month </span></div></div>',1)),t("div",_e,[k(ue,{company_id:o.value.company_id,"onUpdate:company_id":e[1]||(e[1]=s=>o.value.company_id=s),department_id:o.value.department_id,"onUpdate:department_id":e[2]||(e[2]=s=>o.value.department_id=s),employee_id:o.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=s=>o.value.employee_id=s),line_type:o.value.line_type,"onUpdate:line_type":e[4]||(e[4]=s=>o.value.line_type=s),"with-type":!0,"initial-value":l.$route.query,onFilterChange:K},{default:R(()=>[k(pe,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),"show-year":!1,"show-month":!0,"show-date":!1,label:"Month"},null,8,["modelValue"])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])])]),B(d).loading?(i(),a("div",ve,[k(ce)])):(i(),a("div",ge,[$.value?(i(),a("section",he,[k(me,{user:B(d).user},null,8,["user"]),t("div",we,[t("div",ke,[t("div",Se,[e[18]||(e[18]=t("span",{class:"text-xs font-semibold uppercase tracking-wide text-slate-500"}," Summary ",-1)),t("span",Ce,[e[17]||(e[17]=g(" Month: ")),t("span",Ve,c(f.value),1)])]),t("div",Ae,[t("div",Me,[e[19]||(e[19]=t("span",{class:"text-slate-500"},"Total rows",-1)),t("span",Ue,c(j.value),1)]),t("div",Te,[e[20]||(e[20]=t("span",{class:"text-slate-500"},"Selected rows",-1)),t("span",Ne,c(w.value),1)]),t("div",De,[e[21]||(e[21]=t("span",{class:"text-slate-500"},"Direct approve",-1)),t("span",Fe,[S.value?(i(),a("span",qe,"Yes")):(i(),a("span",ze,"No (goes for approval)"))])])])]),t("div",$e,[t("label",je,[x(t("input",{id:"directApprove",type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>S.value=s),class:"h-4 w-4 accent-emerald-600 rounded cursor-pointer"},null,512),[[E,S.value]]),e[22]||(e[22]=t("span",null,"Approve immediately without extra review",-1))])])])])):D("",!0),t("section",Oe,[t("header",Re,[e[26]||(e[26]=t("div",{class:"flex flex-col"},[t("span",{class:"text-sm font-semibold text-slate-800"}," Manual Attendance Rows "),t("span",{class:"text-[11px] text-slate-500"}," Select the rows you want to send and optionally edit type / time / description. ")],-1)),t("div",Be,[t("span",Ee,[e[23]||(e[23]=t("span",{class:"h-1.5 w-1.5 rounded-full bg-emerald-500"},null,-1)),e[24]||(e[24]=g(" Selected: ")),t("span",Ie,c(w.value),1)]),e[25]||(e[25]=t("span",{class:"hidden md:inline text-slate-400"}," Click the row or checkbox to (de)select ",-1))])]),t("div",Pe,[k(ne,{name:"fade"},{default:R(()=>[b.value?(i(),a("div",He,c(b.value),1)):D("",!0)]),_:1})]),t("div",Le,[r.value.length?(i(),a("table",Qe,[t("thead",null,[t("tr",Ke,[t("th",We,[t("div",Ye,[t("input",{id:"allCheck",type:"checkbox",onChange:X,class:"h-4 w-4 cursor-pointer accent-indigo-600"},null,32),e[27]||(e[27]=t("label",{for:"allCheck",class:"cursor-pointer text-[11px] font-medium text-slate-700"}," Select all ",-1))])]),e[28]||(e[28]=t("th",{class:"sticky top-0 z-10 border-b border-slate-200 px-2 py-2 text-left text-xs font-medium"}," Date ",-1)),e[29]||(e[29]=t("th",{class:"sticky top-0 z-10 border-b border-slate-200 px-2 py-2 text-left text-xs font-medium"}," Type ",-1)),e[30]||(e[30]=t("th",{class:"sticky top-0 z-10 border-b border-slate-200 px-2 py-2 text-left text-xs font-medium"}," Check-In ",-1)),e[31]||(e[31]=t("th",{class:"sticky top-0 z-10 border-b border-slate-200 px-2 py-2 text-left text-xs font-medium"}," Check-Out ",-1)),e[32]||(e[32]=t("th",{class:"sticky top-0 z-10 border-b border-slate-200 px-2 py-2 text-left text-xs font-medium"}," Description ",-1))])]),t("tbody",null,[(i(!0),a(ae,null,ie(r.value,(s,u)=>(i(),a("tr",{key:u,onClick:n=>Z(s),class:de(["border-b border-slate-100 transition-colors",s.is_check?"bg-amber-50 hover:bg-amber-100":"bg-white hover:bg-slate-50"])},[t("td",Ge,[x(t("input",{type:"checkbox","onUpdate:modelValue":n=>s.is_check=n,class:"h-4 w-4 cursor-pointer accent-indigo-600",onClick:e[6]||(e[6]=y(()=>{},["stop"]))},null,8,Xe),[[E,s.is_check]])]),t("td",Ze,[x(t("input",{type:"date","onUpdate:modelValue":n=>s.date=n,class:"w-full rounded-md border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200 disabled:bg-slate-100 disabled:text-slate-400",onClick:e[7]||(e[7]=y(()=>{},["stop"])),disabled:!s.is_check},null,8,et),[[V,s.date]])]),t("td",tt,[x(t("select",{"onUpdate:modelValue":n=>s.type=n,class:"w-full rounded-md border px-2 py-1 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-indigo-200 disabled:bg-slate-100 disabled:text-slate-400",onClick:e[8]||(e[8]=y(()=>{},["stop"])),disabled:!s.is_check},e[33]||(e[33]=[t("option",{value:""},"Select Type",-1),t("option",{value:"Home Office"},"Home Office",-1),t("option",{value:"Remote Work"},"Remote Work",-1),t("option",{value:"Forget Punch"},"Forget Punch",-1)]),8,st),[[re,s.type]])]),t("td",lt,[x(t("input",{type:"time","onUpdate:modelValue":n=>s.check_in=n,class:"w-full rounded-md border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200 disabled:bg-slate-100 disabled:text-slate-400",onClick:e[9]||(e[9]=y(()=>{},["stop"])),disabled:!s.is_check},null,8,ot),[[V,s.check_in]])]),t("td",nt,[x(t("input",{type:"time","onUpdate:modelValue":n=>s.check_out=n,class:"w-full rounded-md border px-2 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-200 disabled:bg-slate-100 disabled:text-slate-400",onClick:e[10]||(e[10]=y(()=>{},["stop"])),disabled:!s.is_check},null,8,at),[[V,s.check_out]])]),t("td",it,[x(t("textarea",{"onUpdate:modelValue":n=>s.description=n,onKeyup:e[11]||(e[11]=y(()=>{},["stop"])),onClick:e[12]||(e[12]=y(()=>{},["stop"])),disabled:!s.is_check,class:"w-full rounded-md border px-2 py-1 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-indigo-200 disabled:bg-slate-100 disabled:text-slate-400",rows:"2"},null,40,dt),[[V,s.description]])])],10,Je))),128))])])):(i(),a("div",rt,e[34]||(e[34]=[t("div",{class:"flex h-10 w-10 items-center justify-center rounded-full bg-slate-100 text-slate-400"},[t("i",{class:"far fa-calendar-times"})],-1),t("p",{class:"text-sm font-medium text-slate-700"}," No manual attendance rows available ",-1),t("p",{class:"text-xs text-slate-500 max-w-sm"}," Please select a company, department, employee and month. Existing attendance dates for the month will appear here. ",-1)])))]),t("footer",ut,[t("div",pt,[e[35]||(e[35]=g(" Selected ")),t("span",ct,c(w.value),1),e[36]||(e[36]=g(" of ")),t("span",mt,c(j.value),1),e[37]||(e[37]=g(" row(s) ")),e[38]||(e[38]=t("span",{class:"text-slate-400"}," Â· Only selected rows with time will be submitted",-1))]),t("div",xt,[$.value?D("",!0):(i(),a("p",yt," Select an employee to enable submission. ")),t("button",{type:"button",class:"inline-flex items-center justify-center rounded-xl bg-emerald-600 px-4 py-2 text-sm font-medium text-white shadow hover:bg-emerald-700 disabled:opacity-40 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-emerald-300",disabled:m.value||!Y.value,onClick:ee},[m.value?(i(),a("span",bt,e[39]||(e[39]=[t("i",{class:"fas fa-spinner fa-spin mr-2"},null,-1),g(" Submitting... ")]))):(i(),a("span",_t," Submit "+c(w.value||0)+" row(s) ",1))],8,ft)])])])]))]))}};export{Dt as default};
