import{d as Q,u as X,b as Z,m as g,r as _,e as ee,a3 as ae,z as te,n as le,c,o as p,a,f as se,p as $,i as oe,j as ne,w as ie,g as R,h as f,v as U,t as T,F as q,q as I,k as z,a4 as B}from"./index-PRN0QYaB.js";import{L as de}from"./LoaderView-D6tv3RFD.js";import{_ as re}from"./MultiselectDropdown-B2CbaYNw.js";import{u as ue}from"./holiday-BtNrSjKi.js";import{u as pe}from"./leave-application-Cb28wOva.js";import{u as ve}from"./leave-type-CE0JF5HP.js";import{u as ce}from"./user-GiMZkKjj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"my-container max-w-3xl space-y-4"},_e={class:"flex items-center justify-between gap-2"},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye={key:0,class:""},we={class:"text-blue-600 font-medium"},ge={key:1,class:"bg-gray-100 p-2 rounded-md"},ke={class:"font-semibold"},be={class:"flex flex-wrap gap-2"},he=["name","value","onUpdate:modelValue","disabled"],De={class:"flex items-center space-x-1"},Ae=["name","onUpdate:modelValue"],xe={class:"flex items-center space-x-1"},Le=["name","onUpdate:modelValue"],Se={key:2,class:"text-red-500 text-sm"},Fe={__name:"LeaveApplicationEdit",setup(Ue){const v=Q(),i=pe(),M=X(),j=Z(),k=ve(),y=ce(),C=ue(),V=g(()=>i.leaveApplication),J=g(()=>j.params.id),h=_(null),l=_({user_id:"",last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),r=_([]);_([]);const D=_(!1),A=_(null),P=_(!1),Y=g(()=>{var n,e,d;return((e=(n=v==null?void 0:v.user)==null?void 0:n.assign_weekend)==null?void 0:e.weekends)||((d=v==null?void 0:v.user)==null?void 0:d.weekends)});ee(async()=>{var e,d,o,t,s,m,x,L,F,H,N,W;const{id:n}=j.params;P.value=!!n;try{await i.fetchLeaveApplicationById(n);const S=(o=(d=(e=i.leaveApplication)==null?void 0:e.user)==null?void 0:d.company)==null?void 0:o.id;if(S&&await k.fetchLeaveTypes(S),i.leaveApplication){if(await y.fetchTypeWiseEmployees({type:i.leaveApplication.user.type,except:[i.leaveApplication.user.id]}),y.users=y.users.map(w=>({...w,label:w.name})),y.users.length>0){const w=g(()=>y.users.find(E=>{var b;return E.id===((b=i.leaveApplication)==null?void 0:b.handover_user_id)})||{});h.value=w.value}l.value.user_id=(t=i.leaveApplication)==null?void 0:t.user_id,l.value.last_working_date=(s=i.leaveApplication)==null?void 0:s.last_working_date,l.value.resumption_date=(m=i.leaveApplication)==null?void 0:m.resumption_date,l.value.reason=(x=i.leaveApplication)==null?void 0:x.reason,l.value.works_in_hand=(L=i.leaveApplication)==null?void 0:L.works_in_hand,l.value.handover_user_id=(F=i.leaveApplication)==null?void 0:F.handover_user_id,l.value.leave_days=(H=i.leaveApplication)==null?void 0:H.leave_days,console.log(i.leaveApplication),(N=i.leaveApplication)!=null&&N.json_data&&((W=i.leaveApplication)==null||W.json_data.forEach((w,E)=>{var b;r.value[E]=w.leave_type_id||((b=k.leaveTypes[0])==null?void 0:b.id)}))}}catch(S){console.error("Failed to load leave application:",S)}finally{D.value=!1}});const u=g(()=>{const n=l.value.last_working_date,e=l.value.resumption_date;if(!n||!e)return[];const d=new Date(n),o=new Date(e);if(o<=d)return[];const t=[];let s=new Date(d);for(s.setDate(s.getDate()+1);s<o;){const m=s.getFullYear(),x=(s.getMonth()+1).toString().padStart(2,"0"),L=s.getDate().toString().padStart(2,"0");t.push(`${m}-${x}-${L}`),s.setDate(s.getDate()+1)}return t}),G=g(()=>{const n=l.value.last_working_date,e=l.value.resumption_date;if(!n||!e)return"";const d=new Date(n);return new Date(e)<=d?"Resumption date must be after Last Working Date.":u.value.length===0?"No leave days between the selected dates.":`Total leave days: ${u.value.length}`});ae(async()=>{var n;u.value.length&&k.leaveTypes.length&&(r.value.length!==u.value.length&&(r.value=u.value.map(()=>{var e;return(e=k.leaveTypes[0])==null?void 0:e.id})),await C.fetchHolidays({company_id:(n=v==null?void 0:v.user)==null?void 0:n.company_id,start_date:u.value[0],end_date:u.value[u.value.length-1]}),u.value.forEach(async(e,d)=>{const o=new Date(e).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),t=o.charAt(0).toUpperCase()+o.slice(1);Y.value.includes(t)&&(r.value[d]="weekend"),C.holidayDates.includes(e)&&(r.value[d]="holiday")}))}),te(()=>h.value,n=>{l.value.handover_user_id=n==null?void 0:n.id});const K=async()=>{var n;D.value=!0,A.value=null;try{const e=u.value.map((t,s)=>({date:t,leave_type_id:r.value[s]!=="weekend"&&r.value[s]!=="holiday"?r.value[s]:null})).filter(t=>t.leave_type_id!==null),d=u.value.map((t,s)=>({date:t,leave_type_id:r.value[s]||""})),o={id:J.value,user_id:(n=V==null?void 0:V.value)==null?void 0:n.user_id,last_working_date:l.value.last_working_date,resumption_date:l.value.resumption_date,reason:l.value.reason,works_in_hand:l.value.works_in_hand,handover_user_id:l.value.handover_user_id,leave_days:e,json_data:d};if(o.id){const t=await i.updateLeaveApplication(o.id,o);t&&M.push({name:"LeaveApplicationShow",params:{id:t==null?void 0:t.id}})}}catch(e){A.value=e.message||"Failed to submit leave application"}finally{D.value=!1}},O=()=>M.go(-1);return(n,e)=>{const d=le("RouterLink");return p(),c("div",me,[a("div",_e,[a("button",{class:"btn-3",onClick:O},e[5]||(e[5]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=a("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),a("div",null,[$(d,{to:"/applications",class:"btn-2"},{default:oe(()=>e[6]||(e[6]=[ne("Home")])),_:1,__:[6]})])]),D.value?(p(),se(de,{key:0})):(p(),c("form",{key:1,onSubmit:ie(K,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[a("div",fe,[a("div",null,[e[8]||(e[8]=a("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),f(a("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=o=>l.value.last_working_date=o),class:"input-1 w-full",required:""},null,512),[[U,l.value.last_working_date]])]),a("div",null,[e[9]||(e[9]=a("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),f(a("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=o=>l.value.resumption_date=o),class:"input-1 w-full",required:""},null,512),[[U,l.value.resumption_date]])])]),l.value.last_working_date&&l.value.resumption_date?(p(),c("div",ye,[a("p",we,T(G.value),1)])):R("",!0),u.value.length?(p(),c("div",ge,[e[12]||(e[12]=a("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),a("div",null,[(p(!0),c(q,null,I(u.value,(o,t)=>(p(),c("div",{key:t,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[a("div",ke,T(o),1),a("div",be,[(p(!0),c(q,null,I(z(k).leaveTypes,s=>(p(),c("label",{key:s.id,class:"flex items-center space-x-1"},[f(a("input",{type:"radio",name:"leaveType-"+t,value:s.id,"onUpdate:modelValue":m=>r.value[t]=m,disabled:r.value.filter(m=>m===s.id).length>=s.remaining_days},null,8,he),[[B,r.value[t]]]),a("span",null,T(s.leave_type),1)]))),128)),a("label",De,[f(a("input",{type:"radio",name:"leaveType-"+t,value:"weekend","onUpdate:modelValue":s=>r.value[t]=s},null,8,Ae),[[B,r.value[t]]]),e[10]||(e[10]=a("span",null,"Weekend",-1))]),a("label",xe,[f(a("input",{type:"radio",name:"leaveType-"+t,value:"holiday","onUpdate:modelValue":s=>r.value[t]=s},null,8,Le),[[B,r.value[t]]]),e[11]||(e[11]=a("span",null," Holiday",-1))])])]))),128))])])):R("",!0),a("div",null,[e[13]||(e[13]=a("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),f(a("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=o=>l.value.reason=o),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[U,l.value.reason]])]),a("div",null,[e[14]||(e[14]=a("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),$(re,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=o=>h.value=o),options:z(y).users,multiple:!1,label:"label",placeholder:"Select user"},null,8,["modelValue","options"])]),a("div",null,[e[15]||(e[15]=a("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),f(a("textarea",{id:"works-in-hand","onUpdate:modelValue":e[4]||(e[4]=o=>l.value.works_in_hand=o),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[U,l.value.works_in_hand]])]),A.value?(p(),c("div",Se,T(A.value),1)):R("",!0),e[16]||(e[16]=a("div",{class:"flex justify-end"},[a("button",{type:"submit",class:"btn-1"},"Update")],-1))],32))])}}};export{Fe as default};
