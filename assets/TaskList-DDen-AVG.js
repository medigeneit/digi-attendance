import{_ as G}from"./CommentModal-DyixxIN7.js";import{u as J,O as N,_ as K}from"./task-priority-DFDfrara.js";import{L as X}from"./LoaderView-BioOsaK0.js";import{_ as Y}from"./TaskAddForm-DjEzI3l6.js";import{_ as Z}from"./TaskEditForm-QmtFFv18.js";import{_ as ee,a as te}from"./UserWiseList-C8YkrZSm.js";import{_ as se}from"./TaskTreeView-GorUnDw7.js";import{u as ae}from"./useTaskStore-BzZcgwVg.js";import{b as re,u as oe,r as d,D as ne,e as le,A as ie,q as ue,k as de,c as i,o as r,m as v,f as w,l as u,a as b,p,h as t,F as R,x as me,t as j,n as E,y as H}from"./index-CUUNTXsO.js";import"./useCommentStore-DNXwUgMf.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-DMyJIX1a.js";import"./SectionLoading-DRV7J5OH.js";import"./MultiselectDropdown-CRNmjI8r.js";import"./vue-multiselect.esm-BsRRcyO4.js";import"./company-4TEzPl0a.js";import"./UserChip-DnGEdzkj.js";const ce={class:"container mx-auto p-6 relative bg-white border rounded-md shadow-md"},ye={class:"mb-4"},ke={class:"w-full flex justify-end gap-5 mb-4"},pe={key:3},fe={key:0,class:"text-center py-4 text-red-500"},ve={key:1},ge={class:"flex items-stretched"},_e={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},qe=1,Re={__name:"TaskList",setup(we){const n=ae(),a=re(),T=oe(),g=d(!1),_=d(null),x=d(!1),m=d(null),f=d(!1),c=ne({parentId:0,requirementId:0}),C=d(null),I=d([]),{handleItemsPriorityUpdate:M,saveTaskPriority:O,listHasRearranged:h}=J(()=>n.taskListTree,0);le(async()=>{a.query.status||T.push({query:{...a.query,status:"not-completed"}}),await y()});async function y(){x.value=!!a.query["user-ids"];const o=await n.fetchTasks({...a.query},{loadingBeforeFetch:!0});console.log({dataQuery:o.query_log}),I.value=o.query_log||[]}const q=o=>{f.value=!0,c.parentId=o},L=o=>{_.value=o,g.value=!0},W=()=>{g.value=!1,_.value=null};async function U(){m.value=null,f.value=!1,c.parentId=0,await y()}async function z(){f.value=!1,c.parentId=0,await y()}async function Q(){O()&&await y()}ie(()=>({...a.query}),async()=>await y());const V=ue({get(){return{...a.query}},set(o){T.push({query:{...o}})}});return(o,e)=>{var B,D,A,F,P,S;const $=de("RouterLink");return r(),i("div",ce,[m.value?(r(),v(N,{key:0},{default:p(()=>[u(Z,{taskId:m.value,class:"rounded-full",onClose:e[0]||(e[0]=s=>m.value=null),onUpdated:U},null,8,["taskId"])]),_:1})):w("",!0),f.value?(r(),v(N,{key:1},{default:p(()=>[u(Y,{parentTaskId:c.parentId,requirementId:c.requirementId,class:"rounded-full",onClose:z,onTaskCreated:U},null,8,["parentTaskId","requirementId"])]),_:1})):w("",!0),u(ee,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s),onClickAddTask:q,onClickPrioritySave:Q,onClickPriorityDiscard:e[2]||(e[2]=()=>t(h)?C.value.resetItems:null),"list-has-rearranged":t(h),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((D=(B=t(a))==null?void 0:B.query)==null?void 0:D["query-log"])=="true"?(r(!0),i(R,{key:2},me(I.value,(s,l)=>(r(),i("div",{key:l,class:"text-xs text-gray-500"},[b("div",ye,j(s.raw_query),1)]))),128)):w("",!0),b("div",ke,[u($,{class:H(["text-sm btn-3 py-0.5",((A=t(a).query)==null?void 0:A.view)==="userwise"?"bg-blue-500 text-white":""]),to:{name:"TaskList",query:{...t(a).query,view:"userwise"}}},{default:p(()=>e[9]||(e[9]=[E(" User Wise List ")])),_:1},8,["class","to"]),u($,{class:H(["text-sm btn-3 py-0.5",((F=t(a).query)==null?void 0:F.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{name:"TaskList",query:{...Object.keys(((P=t(a))==null?void 0:P.query)||{}).filter(s=>{var l;return((l=t(a))==null?void 0:l.query[s])!=="userwise"}).reduce((s,l)=>({...s,[l]:t(a).query[l]}),{})}}},{default:p(()=>e[10]||(e[10]=[E(" TaskWise List ")])),_:1},8,["class","to"])]),t(n).loading?(r(),i("div",pe,[u(X)])):(r(),i(R,{key:4},[t(n).error?(r(),i("div",fe,j(t(n).error),1)):t(n).tasks.length>0?(r(),i("div",ve,[((S=t(a).query)==null?void 0:S.view)=="userwise"?(r(),v(te,{key:0,tasks:t(n).tasks,selectedUserId:t(a).query["user-ids"],onCommentButtonClick:e[3]||(e[3]=s=>L(s,o.task.id)),onEditClick:e[4]||(e[4]=s=>m.value=s),onAddClick:e[5]||(e[5]=s=>q(s))},null,8,["tasks","selectedUserId"])):(r(),v(K,{key:1,items:t(n).taskListTree,handle:"handle",onItemsUpdate:t(M),class:"space-y-4",ref_key:"draggableTaskList",ref:C},{item:p(({item:s,index:l})=>[b("div",ge,[u(se,{task:s,index:l,showDraggableHandle:!x.value,onCommentButtonClick:e[6]||(e[6]=k=>L(k,o.task.id)),onEditClick:e[7]||(e[7]=k=>m.value=k),onAddClick:e[8]||(e[8]=k=>q(k)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(r(),i("div",_e," No tasks found. "))],64)),u(G,{show:g.value,"commentable-id":_.value,"commentable-type":"task","user-id":qe,"on-close":W,onSubmitted:t(n).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Re as default};
