import{c as n,o as r,F as $,x as A,m as w,p as T,I as Y,G as re,q as y,f as k,y as b,a as t,z as le,n as v,t as f,T as ne,l as h,B as K,k as Z,b as ae,r as Q,A as oe,w as C,h as ie}from"./index-fO5p_Xlo.js";import{g as W}from"./datetime-q3Sn87-f.js";import{_ as X}from"./UserChip-vqby0PRy.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"mt-3"},ue={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick","employeeAssignClick"],setup(e,{emit:a}){const l=a;return(g,o)=>(r(),n("div",de,[(r(!0),n($,null,A(e.childrenTasks,(d,x)=>(r(),w(at,{key:d.id,index:x,task:d,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:o[0]||(o[0]=u=>l("editClick",u)),onAddClick:o[1]||(o[1]=u=>l("addClick",u)),onEmployeeAssignClick:o[2]||(o[2]=u=>l("employeeAssignClick",u))},{"item-end":T(({task:u,level:m})=>[Y(g.$slots,"treeItemEnd",{task:u,level:m})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ce=re({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:a}){const l=e,g=y(function(){return l.task.completed_count}),o=y(()=>l.task.children_task_count===0?l.task.status==="COMPLETED"?100:0:g.value/l.task.children_task_count*100),d=y(()=>{const x=o.value;let u,m,c;return x===100?(u="bg-green-50",m="bg-green-200",c="text-green-600 "):x<100&&(u="bg-red-50",m="bg-red-200",c="text-red-600 "),{container:u,bar:m,text:c}});return a({completedPercentage:o.value,completedSubTaskCount:g.value}),(x,u)=>(r(),n("div",null,[x.task.children_task_count>0?(r(),n("div",{key:0,class:b(["rounded-full border py-0.5 relative overflow-hidden h-6",d.value.container]),style:{width:"180px"}},[t("div",{class:b(["z-10 absolute top-0 bottom-0",d.value.bar]),style:le(`width: ${o.value}%`)},null,6),t("span",{class:b(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",d.value.text])},[t("span",null,[t("span",null,f(g.value),1),u[0]||(u[0]=v(" / ")),t("span",null,f(x.task.children_task_count),1)])],2)],2)):k("",!0)]))}}),ke={key:0},ge={__name:"TaskStatus",props:{status:{type:String,required:!0},progressPercent:{type:Number,required:!0}},setup(e){const a=e,l=y(()=>{switch(a.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),g=y(()=>{switch(a.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(o,d)=>(r(),n("div",{class:b(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",l.value])},[t("i",{class:b(g.value)},null,2),t("span",null,f(e.status),1),e.progressPercent!==null||e.progressPercent!==void 0?(r(),n("span",ke,f(e.progressPercent)+"% ",1)):k("",!0)],2))}},fe={class:"relative"},me={key:0,class:"text-gray-500 text-xs"},xe={key:2,class:"text-sm text-gray-500 group/users"},ye={class:"cursor-pointer hover:underline text-blue-600"},be={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg z-30"},pe={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:()=>null},isTargetTask:{Boolean,default:!1}},setup(e){const a=e,l=y(()=>a.users.slice(0,2)),g=y(()=>a.users.slice(2));function o(x){if(typeof a.routeTo=="function")return a.routeTo(x)}const d=y(()=>typeof a.routeTo=="function"?ne:"div");return(x,u)=>(r(),n("div",fe,[a.users.length===0?(r(),n("div",me,"Not Assigned To Anyone")):(r(!0),n($,{key:1},A(l.value,(m,c)=>(r(),w(K(d.value),{key:c,to:o(m)},{default:T(()=>[h(X,{class:b(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask}]),user:m},null,8,["class","user"])]),_:2},1032,["to"]))),128)),g.value.length>0?(r(),n("div",xe,[t("div",ye," + "+f(g.value.length)+" more users ",1),t("div",be,[(r(!0),n($,null,A(g.value,(m,c)=>(r(),w(K(d.value),{key:c,to:o(m),class:"w-full block mb-2"},{default:T(()=>[h(X,{class:b(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:m},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):k("",!0)]))}},ve={},he={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function we(e,a){return r(),n("span",he,"IMPORTANT")}const Te=ee(ve,[["render",we]]),_e={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(a,l)=>{const g=Z("RouterLink");return r(),w(g,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:T(()=>[t("div",null,f(e.task.title),1)]),_:1},8,["to"])}}},Ce={},$e={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function Se(e,a){return r(),n("span",$e,"URGENT")}const Ae=ee(Ce,[["render",Se]]),Le={class:"flex w-full"},Ee={key:0,class:"border-l border-gray-200 last:border-l-0"},Ne={class:"items-start grid grid-cols-4 gap-4 group"},Be={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},Pe={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},Re={key:0,class:"text-xl font-semibold text-sky-500"},De={key:1,class:"text-sm text-gray-500 mt-2"},qe={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Ie={class:"flex items-center gap-6 flex-none lg:w-full order-0 lg:order-1"},Oe={class:"flex gap-4 items-center"},je={class:"text-gray-500 text-sm"},Me={class:"text-red-500 text-sm"},ze={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ge={class:"col-span-full flex items-center my-2 lg:my-0 justify-center flex-wrap gap-x-3 gap-y-2"},Ue={class:"text-xs px-2 py-0.5 rounded-full border bg-sky-500 text-white"},Ve={class:"text-xs px-2 py-0.5 rounded-full border bg-blue-500 text-white"},Fe=["href"],He={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4"},Je={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Ke={key:1,class:"text-gray-500"},Qe={class:"font-semibold text-green-800"},We={key:2,class:"ml-4 text-gray-500"},Xe={class:"text-red-500 font-semibold"},Ye={class:"mt-4 col-span-full"},Ze={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},et={class:"text-xs text-gray-500 flex gap-3 order-1 sm:order-0"},tt=["href"],st={class:"flex items-center sm:ml-auto order-0 sm:order-1"},rt={key:0,class:"flex gap-2 ml-4 items-center text-xs"},lt=["href"],nt={class:"ml-0"},at={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(e,{emit:a}){const l=e,g=ae(),o=Q(null),d=a;function x(i){d("addClick",i)}function u(i){d("editClick",i)}function m(i){d("employeeAssignClick",i)}const c=Q([]),L=localStorage.getItem("sub_task_opened_list");if(L)try{c.value=JSON.parse(L)}catch{c.value=[]}const E=y(()=>W(l.task.started_at)),N=y(()=>W(l.task.deadline)),_=y({get:()=>c.value.includes(l.task.id),set:i=>{const s=c.value.includes(l.task.id);i&&!s?c.value.push(l.task.id):!i&&s&&(c.value=c.value.filter(S=>S!==l.task.id))}});oe(c,i=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(i))},{deep:!0});const B=y(()=>{var i,s;return((s=(i=l.task)==null?void 0:i.children_tasks)==null?void 0:s.length)>0});function te(){l.task.children_tasks.length>0&&(_.value=!_.value)}return(i,s)=>{var P,R,D,q,I,O,j,M,z,G,U,V,F,H,J;const S=Z("RouterLink");return r(),n("div",Le,[e.treeLevel>0?(r(),n("div",Ee,s[4]||(s[4]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):k("",!0),t("div",{class:b(["flex-grow border-2 rounded py-3 px-3",{"bg-green-100  ":((P=o.value)==null?void 0:P.completedPercentage)===100,"bg-white hover:bg-gray-50":((R=o.value)==null?void 0:R.completedPercentage)<100,"shadow-sm":e.treeLevel>0,"border-sky-500":e.index%2===0,"border-pink-300":e.index%2===1}])},[t("div",Ne,[t("div",Be,[t("div",Pe,[e.index!==void 0?(r(),n("div",Re,f(e.index+1)+". ",1)):k("",!0),h(_e,{task:e.task},null,8,["task"]),(D=e.task)!=null&&D.requirement?(r(),n("p",De," Requirement: "+f((I=(q=e.task)==null?void 0:q.requirement)==null?void 0:I.title),1)):k("",!0)]),t("div",qe,[h(ge,{status:(O=e.task)==null?void 0:O.status,progressPercent:((j=e.task)==null?void 0:j.progress_percent)||0},null,8,["status","progressPercent"]),h(ce,{task:e.task,ref_key:"progress",ref:o,class:"text-sm"},null,8,["task"])]),t("div",Ie,[t("div",Oe,[e.showDraggableHandle?(r(),n("button",{key:0,onMousedown:s[0]||(s[0]=C((...p)=>i.handleDragging&&i.handleDragging(...p),["stop"])),class:"handle"},s[5]||(s[5]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):k("",!0),t("span",je," #"+f(e.task.id),1),t("div",Me,f(e.treeLevel),1)]),t("div",ze,[(M=e.task)!=null&&M.is_important?(r(),w(Te,{key:0})):k("",!0),(z=e.task)!=null&&z.is_urgent?(r(),w(Ae,{key:1})):k("",!0)])])]),t("div",Ge,[e.treeLevel===0?(r(),n($,{key:0},[t("div",Ue,f(((U=(G=e.task)==null?void 0:G.from_department)==null?void 0:U.name)||"--"),1),s[6]||(s[6]=t("span",{class:"text-2xl text-gray-400"},"â‡’",-1)),t("div",Ve,f(((F=(V=e.task)==null?void 0:V.to_department)==null?void 0:F.name)||"--"),1)],64)):k("",!0),h(pe,{class:"flex items-center justify-center flex-wrap gap-x-3",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:p=>({query:{...ie(g).query,view:"userwise","company-id":p.company_id,"user-ids":p.id}})},null,8,["users","isTargetTask","routeTo"]),t("a",{href:`/tasks/${e.task.id}/assign-users`,onClick:s[1]||(s[1]=C(p=>d("employeeAssignClick",e.task.id),["stop","prevent"])),class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},s[7]||(s[7]=[t("i",{class:"fas fa-users-cog"},null,-1),v(" Manage Employee ")]),8,Fe)])]),t("div",He,[e.task.is_target?(r(),n("div",Je," TARGET TASK ")):k("",!0),E.value?(r(),n("span",Ke,[s[8]||(s[8]=v(" Started: ")),t("span",Qe,f(E.value),1)])):k("",!0),N.value?(r(),n("span",We,[s[9]||(s[9]=v(" Deadline: ")),t("span",Xe,f(N.value),1)])):k("",!0)]),t("div",Ye,[t("div",Ze,[t("div",et,[t("button",{class:b([{"text-yellow-600 font-semibold  inline-block  ":B.value},"flex items-center gap-1 group"]),onClick:te},[t("i",{class:b([_.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:b(B.value?"group-hover:underline":"")}," Sub Tasks ("+f((H=e.task.children_tasks)==null?void 0:H.length)+") ",3)],2),e.treeLevel<2?(r(),n("a",{key:0,href:`/tasks/add?parent_id=${l.task.id}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:s[2]||(s[2]=C(p=>d("addClick",l.task.id),["stop","prevent"]))},s[10]||(s[10]=[t("i",{class:"fas fa-plus"},null,-1),v(" Add Sub Task ")]),8,tt)):k("",!0)]),t("div",st,[e.hideButtons?k("",!0):(r(),n("div",rt,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:s[3]||(s[3]=C(p=>d("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},s[11]||(s[11]=[t("i",{class:"fas fa-edit"},null,-1),v(" Edit ")]),8,lt),h(S,{to:{name:"TaskReports",params:{id:(J=e.task)==null?void 0:J.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:T(()=>s[12]||(s[12]=[t("i",{class:"far fa-file-alt"},null,-1),v(" Reports ")])),_:1,__:[12]},8,["to"])]))])]),t("div",nt,[_.value?(r(),w(ue,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:u,onAddClick:x,onEmployeeAssignClick:m},{"tree-item-end":T(({task:p,level:se})=>[Y(i.$slots,"item-end",{level:se,task:p})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):k("",!0)])])],2)])}}};export{at as _,ge as a,ce as b};
