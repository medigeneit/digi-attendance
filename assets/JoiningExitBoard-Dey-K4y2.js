import{b as Z,u as H,z as W,A as R,e as X,c as v,o as m,a as t,p as J,h as Y,B as ee,k as O,J as ne,Q as ae,r as N,m as U,N as G,ad as se,g as E,F as V,y as K,x as B,t as f,M as Q,j,v as le,f as oe}from"./index-C_Hd4Q4D.js";import{_ as re}from"./EmployeeFilter-DGNq3xoL.js";import"./company-dmcOllOy.js";import"./department-CeyQ_z6y.js";import"./EmployeeDropdownInput-ByV3JJag.js";import"./SelectDropdown-DSfen_tK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-B81KJ38V.js";const ie={class:"flex flex-wrap items-end gap-3"},de={__name:"BoardFilters",props:{modelValue:{type:Object,required:!0},companies:{type:Array,default:()=>[]},departments:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(b,{emit:d}){const P=b,S=d,x=Z(),I=H(),g={type:null,user_type:"Probationary"},k=(i={})=>({type:i.type??g.type,company_id:i.companyId??null,department_id:i.departmentId??null,employee_id:i.employeeId??null,line_type:i.lineType??null,user_type:i.user_type??g.user_type}),_=(i={})=>({type:i.type??g.type,companyId:i.company_id??null,departmentId:i.department_id??null,employeeId:i.employee_id??null,lineType:i.line_type??null,user_type:i.user_type??g.user_type}),o=W(k(P.modelValue));let c=!1;function $(){c||S("update:modelValue",{..._(o)})}const h=["type","company_id","department_id","employee_id","line_type","user_type"],p=i=>i===""||i===null||i===void 0||i==="all";function M(){const i={};return!p(o.type)&&String(o.type)!==String(g.type)&&(i.type=String(o.type)),p(o.company_id)||(i.company_id=String(o.company_id)),p(o.department_id)||(i.department_id=String(o.department_id)),p(o.employee_id)||(i.employee_id=String(o.employee_id)),p(o.line_type)||(i.line_type=String(o.line_type)),!p(o.user_type)&&String(o.user_type)!==g.user_type&&(i.user_type=String(o.user_type)),i}function w(i={}){const e={...x.query};for(const u of h)delete e[u];const l={...e,...M(),...i};for(const u of Object.keys(l)){const T=l[u];(T===""||T===null||T===void 0)&&delete l[u]}return l}let n=null;function s({replace:i=!0,partial:e={},debounce:l=150}={}){n&&clearTimeout(n),n=setTimeout(()=>{const u=w(e);(i?I.replace({query:u}):I.push({query:u})).catch(()=>{})},l)}function r(){const i={..._(o)};S("submit",i),s({replace:!0,debounce:0})}return R(()=>P.modelValue,i=>{const e=k(i||{});let l=!1;for(const u of Object.keys(e))if(o[u]!==e[u]){l=!0;break}l&&(c=!0,Object.assign(o,e),ne(()=>{c=!1}))},{deep:!0}),R(()=>[o.type,o.company_id,o.department_id,o.employee_id,o.line_type,o.user_type],()=>{$(),s({replace:!0,debounce:150})}),X(()=>{x.query.user_type&&(o.user_type=String(x.query.user_type))}),R(()=>x.query.user_type,i=>{i!=null&&(o.user_type=String(i))}),(i,e)=>(m(),v("div",ie,[t("div",null,[e[7]||(e[7]=t("label",{class:"block text-xs text-gray-500 mb-1"},"User Type",-1)),Y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.user_type=l),class:"border rounded px-2 py-1"},e[6]||(e[6]=[t("option",{value:"Probationary"},"Probationary",-1),t("option",{value:"Permanent"},"Permanent",-1),t("option",{value:"Contract"},"Contract",-1)]),512),[[ee,o.user_type]])]),J(re,{company_id:o.company_id,"onUpdate:company_id":e[1]||(e[1]=l=>o.company_id=l),department_id:o.department_id,"onUpdate:department_id":e[2]||(e[2]=l=>o.department_id=l),employee_id:o.employee_id,"onUpdate:employee_id":e[3]||(e[3]=l=>o.employee_id=l),line_type:o.line_type,"onUpdate:line_type":e[4]||(e[4]=l=>o.line_type=l),"with-type":!0,"initial-value":O(x).query,companies:b.companies,departments:b.departments,onFilterChange:e[5]||(e[5]=l=>{Object.assign(o,l)})},null,8,["company_id","department_id","employee_id","line_type","initial-value","companies","departments"]),t("button",{class:"btn-2 py-1",onClick:r}," Apply ")]))}},te=ae("checklistBoard",()=>{const b=N(!1),d=N(null),P=N("joining"),S=N("Probationary"),x=N(null),I=N(null),g=N(""),k=N([]),_=N([]),o=N(Object.create(null)),c=N(null),$=a=>typeof a=="string"?a.toLowerCase():"",h=a=>Array.isArray(a)?a:[],p=a=>{var y;return((y=a==null?void 0:a.data)==null?void 0:y.data)??(a==null?void 0:a.data)},M=a=>{var y,C;return((y=a==null?void 0:a.company)==null?void 0:y.name)||(a==null?void 0:a.company_name)||((C=a==null?void 0:a.organization)==null?void 0:C.name)||"—"},w=a=>{var y,C;return((y=a==null?void 0:a.department)==null?void 0:y.name)||((C=a==null?void 0:a.dept)==null?void 0:C.name)||(a==null?void 0:a.department_name)||"—"},n=a=>{var y;return((y=a==null?void 0:a.position)==null?void 0:y.title)||(a==null?void 0:a.designation)||"—"},s=(a={})=>{const y={user_type:S.value||void 0,type:P.value||void 0,company_id:x.value||void 0,department_id:I.value||void 0,search:(g.value||"").trim()||void 0,template_id:i.value||void 0};return Object.keys(y).forEach(C=>(y[C]==null||y[C]==="")&&delete y[C]),{...y,...a}},r=U(()=>{const a=$(P.value);return k.value.find(y=>$(y==null?void 0:y.type)===a)||null}),i=U(()=>{var a;return((a=r.value)==null?void 0:a.id)??null});async function e(a={}){try{const y=await G.get("/checklist-templates",{params:a});k.value=h(p(y))}catch(y){throw k.value=[],d.value=y,y}}async function l(a,y){const{data:C}=await G.patch(`/user/${a}/employment-type`,{employment_type:y}),D=_.value.findIndex(z=>z.id===a);return D!==-1&&(this.users[D]={...this.users[D],employment_type:P}),this.rows[a]&&(this.rows[a]={...this.rows[a]}),C}async function u(a={}){if(c.value)try{await c.value}catch{}b.value=!0,d.value=null;const y=s(a),C=(async()=>{try{const D=await G.get("/users-checklists",{params:y});_.value=h(p(D))}catch(D){throw _.value=[],d.value=D,D}finally{b.value=!1,c.value=null}})();return c.value=C,C}async function T({withUsers:a=!0,templateParams:y={},userParams:C={}}={}){b.value=!0,d.value=null;try{k.value.length||await e(y),a&&await u(C)}catch(D){throw d.value=D,D}finally{b.value=!1}}function F(a){_.value=h(a)}function A(a={}){"type"in a&&(P.value=a.type),"companyId"in a&&(x.value=a.companyId),"departmentId"in a&&(I.value=a.departmentId),"search"in a&&(g.value=a.search)}function L(){P.value="joining",x.value=null,I.value=null,g.value=""}function q(){o.value=Object.create(null)}return{loading:b,error:d,type:P,companyId:x,departmentId:I,search:g,templates:k,users:_,rows:o,templateByType:r,templateId:i,companyNameOf:M,departmentNameOf:w,positionTitleOf:n,loadBoard:T,loadTemplates:e,loadUsers:u,setUsers:F,setFilters:A,resetFilters:L,clearRowCache:q,updateEmploymentType:l}}),ce={class:"space-y-1"},pe={class:"inline-flex rounded-lg border p-0.5 text-[11px] bg-white"},ue=["onClick"],ye={key:0,class:"group relative"},me={class:"relative h-2 w-full overflow-hidden rounded-full bg-gray-100 ring-1 ring-inset ring-gray-200"},fe=["aria-valuenow"],ve={class:"mt-1 flex items-center justify-between text-[11px] text-gray-600"},be={class:"flex items-center gap-2"},ge={class:"font-medium"},_e={class:"hidden sm:inline"},he={key:1,class:"space-y-1.5"},xe={key:0},we={key:1,class:"text-red-600"},ke={key:2,class:"text-gray-500"},Ce={key:2,class:"space-y-1.5"},$e={key:0},Me={key:1,class:"text-red-600"},Ie={key:2,class:"text-gray-500"},Pe={__name:"ChecklistProgressCell",props:{user:{type:Object,required:!0},actualPercent:{type:Number,required:!0},targetPercent:{type:Number,required:!0}},setup(b){const d=b,P=(e,l,u)=>Math.min(Math.max(Number(e||0),l),u),S=e=>e<0?0:e>100?100:Math.round(e),x=e=>e?new Date(e):null,I=(e,l)=>{const u=new Date(e.getTime()),T=u.getMonth()+(l||0);return u.setMonth(T),u.getMonth()!==(T%12+12)%12&&u.setDate(0),u},g=(e,l)=>Math.round((e-l)/864e5),k=e=>e?e.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"",_=e=>String(e||"").toLowerCase(),o=U(()=>{var e;return _((e=d.user)==null?void 0:e.employment_type)});function c(e){const l=_(e==null?void 0:e.employment_type)==="probationary",u=x(e==null?void 0:e.joining_date)||x(e==null?void 0:e.created_at),T=Number(e==null?void 0:e.probation_months)||0,F=Number(e==null?void 0:e.probation_extension_months)||0;if(!l||!u||Number.isNaN(T)||T<=0)return{enabled:!1,start:null,end:null,pct:0,leftDays:null,status:"inactive",reason:l?"No probation months/start date":"Not probationary"};const A=Math.max(1,T+(F||0)),L=I(u,A),q=new Date,a=Math.max(1,g(L,u)),y=Math.max(0,Math.min(a,g(q,u))),C=g(L,q),D=S(y/a*100),z=C<0?"overdue":C<=14?"near_end":"active";return{enabled:!0,start:u,end:L,pct:D,leftDays:C,status:z}}function $(e){const l=_(e==null?void 0:e.employment_type)==="contract",u=x(e==null?void 0:e.joining_date)||x(e==null?void 0:e.created_at),T=Number((e==null?void 0:e.contract_month)??(e==null?void 0:e.contract_months)??(e==null?void 0:e.contract_duration_months)??0),F=Number((e==null?void 0:e.contract_extension_months)??0);if(!l||!u||Number.isNaN(T)||T<=0)return{enabled:!1,start:null,end:null,pct:0,leftDays:null,status:"inactive",reason:l?"No contract months/start date":"Not contract"};const A=Math.max(1,T+(F||0)),L=I(u,A),q=new Date,a=Math.max(1,g(L,u)),y=Math.max(0,Math.min(a,g(q,u))),C=g(L,q),D=S(y/a*100),z=C<0?"overdue":C<=30?"near_end":"active";return{enabled:!0,start:u,end:L,pct:D,leftDays:C,status:z}}const h=e=>e?"bg-gradient-to-r from-emerald-500 to-emerald-600":"bg-gradient-to-r from-amber-500 to-amber-600",p=(e,l="amber")=>e==="overdue"?{track:"bg-red-100",fill:"bg-red-500",tone:"text-red-600"}:e==="near_end"?{track:l==="blue"?"bg-indigo-100":"bg-orange-100",fill:l==="blue"?"bg-indigo-500":"bg-orange-500",tone:"text-gray-700"}:e==="inactive"?{track:"bg-gray-100",fill:"bg-gray-300",tone:"text-gray-500"}:{track:l==="blue"?"bg-blue-100":"bg-amber-100",fill:l==="blue"?"bg-blue-500":"bg-amber-500",tone:"text-gray-600"},M=N("permanent"),w=U(()=>c(d.user)),n=U(()=>$(d.user)),s=U(()=>[{key:"permanent",label:"Permanent"},{key:"probationary",label:"Probationary"},{key:"contract",label:"Contract"}]);se(()=>{s.value.map(l=>l.key).includes(M.value)||(M.value="permanent")}),R([o],()=>{const e=o.value;e&&["permanent","probationary","contract"].includes(e)&&M.value!==e&&(M.value=e)},{immediate:!0});function r(e){["permanent","probationary","contract"].includes(e)&&(M.value=e)}const i=U(()=>{const e=P(d.actualPercent,0,100),l=P(d.targetPercent,1,100);return M.value!=="permanent"?"":e>=l?"Met":`Short by ${Math.max(0,l-e)}%`});return(e,l)=>(m(),v("div",ce,[t("div",pe,[(m(!0),v(V,null,K(s.value,u=>(m(),v("button",{key:u.key,class:B(["px-2 py-0.5 rounded-md",M.value===u.key?"bg-gray-900 text-white":"text-gray-700"]),onClick:T=>r(u.key)},f(u.label),11,ue))),128))]),M.value==="permanent"?(m(),v("div",ye,[t("div",me,[t("div",{class:"pointer-events-none absolute top-0 h-2 w-0.5 bg-gray-600/60",style:Q({left:`calc(${b.targetPercent}% - 1px)`})},null,4),t("div",{class:B(["h-2 transition-all duration-500 ease-out",h(b.actualPercent>=b.targetPercent)]),style:Q({width:b.actualPercent+"%"}),role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":b.actualPercent},null,14,fe)]),t("div",ve,[t("div",be,[t("span",ge,"Actual: "+f(b.actualPercent)+"%",1),t("span",_e,"Target: "+f(b.targetPercent)+"%",1)]),t("span",{class:B(["rounded-full px-1.5 py-0.5 ring-1 text-[10px]",b.actualPercent>=b.targetPercent?"bg-emerald-50 text-emerald-700 ring-emerald-200":"bg-amber-50 text-amber-700 ring-amber-200"])},f(i.value),3)])])):M.value==="probationary"?(m(),v("div",he,[t("div",{class:B(["relative w-full h-1.5 overflow-hidden rounded-full",p(w.value.status).track])},[t("div",{class:B(["h-1.5 transition-all duration-500 ease-out",p(w.value.status).fill]),style:Q({width:(w.value.enabled?w.value.pct:0)+"%"})},null,6)],2),t("div",{class:B(["flex items-center justify-between text-[11px]",p(w.value.status).tone])},[t("span",null,[l[0]||(l[0]=j(" Probation: ")),w.value.enabled?(m(),v(V,{key:0},[j(f(w.value.pct)+"%",1)],64)):(m(),v(V,{key:1},[j("Not set")],64))]),w.value.enabled&&w.value.leftDays>=0?(m(),v("span",xe,f(k(w.value.start))+" → "+f(k(w.value.end))+" · "+f(w.value.leftDays)+"d left ",1)):w.value.enabled?(m(),v("span",we,f(k(w.value.start))+" → "+f(k(w.value.end))+" · Overdue "+f(Math.abs(w.value.leftDays))+"d ",1)):(m(),v("span",ke,"No tenure data"))],2)])):M.value==="contract"?(m(),v("div",Ce,[t("div",{class:B(["relative w-full h-1.5 overflow-hidden rounded-full",p(n.value.status,"blue").track])},[t("div",{class:B(["h-1.5 transition-all duration-500 ease-out",p(n.value.status,"blue").fill]),style:Q({width:(n.value.enabled?n.value.pct:0)+"%"})},null,6)],2),t("div",{class:B(["flex items-center justify-between text-[11px]",p(n.value.status,"blue").tone])},[t("span",null,[l[1]||(l[1]=j(" Contract: ")),n.value.enabled?(m(),v(V,{key:0},[j(f(n.value.pct)+"%",1)],64)):(m(),v(V,{key:1},[j("Not set")],64))]),n.value.enabled&&n.value.leftDays>=0?(m(),v("span",$e,f(k(n.value.start))+" → "+f(k(n.value.end))+" · "+f(n.value.leftDays)+"d left ",1)):n.value.enabled?(m(),v("span",Me,f(k(n.value.start))+" → "+f(k(n.value.end))+" · Expired "+f(Math.abs(n.value.leftDays))+"d ",1)):(m(),v("span",Ie,"No data"))],2)])):E("",!0)]))}},Ne={class:"flex items-center gap-2"},Se={class:"relative"},Te=["disabled","value"],De=["value"],je={key:0,class:"absolute right-2 top-1/2 h-3 w-3 -translate-y-1/2 animate-spin text-gray-400",viewBox:"0 0 24 24"},Be={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Oe={class:"relative z-10 w-[92vw] max-w-sm rounded-xl bg-white p-4 shadow-xl"},Ue={class:"mt-2 text-[13px] text-gray-600"},Le={class:"font-medium"},qe={class:"font-medium"},Ve={class:"font-medium"},Ee={__name:"EmploymentTypeCell",props:{user:{type:Object,required:!0},saving:{type:Boolean,default:!1},value:{type:String,required:!0},onConfirmChange:{type:Function,required:!0}},setup(b){const d=b,P=[{value:"probationary",label:"Probationary"},{value:"permanent",label:"Permanent"},{value:"contract",label:"Contract"}],S=h=>{var p;return((p=P.find(M=>M.value===h))==null?void 0:p.label)||"—"},x=h=>h==="probationary"?"bg-amber-50 text-amber-700 ring-amber-200":h==="permanent"?"bg-green-50 text-green-700 ring-green-200":h==="contract"?"bg-blue-50 text-blue-700 ring-blue-200":"bg-gray-50 text-gray-700 ring-gray-200",I=N(!1),g=N(""),k=U(()=>S(d.value)),_=U(()=>S(g.value));function o(h){const p=h.target.value;p!==d.value&&(g.value=p,I.value=!0)}async function c(){const h=g.value;I.value=!1,h&&(await d.onConfirmChange(h),g.value="")}function $(){I.value=!1,g.value=""}return(h,p)=>{var M,w,n;return m(),v("div",Ne,[t("span",{class:B(["inline-flex items-center rounded-full px-2 py-0.5 text-[11px] ring-1",x(b.value)])},f(S(b.value)),3),t("div",Se,[t("select",{disabled:b.saving,value:b.value,class:"rounded-md border bg-white px-2 py-1 text-[11px] outline-none disabled:opacity-50",onChange:o,"aria-label":"Change employment type"},[(m(),v(V,null,K(P,s=>t("option",{key:s.value,value:s.value},f(s.label),9,De)),64))],40,Te),b.saving?(m(),v("svg",je,p[0]||(p[0]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3",fill:"none"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v3A5 5 0 007 12H4z"},null,-1)]))):E("",!0)]),I.value?(m(),v("div",Be,[p[6]||(p[6]=t("div",{class:"absolute inset-0 bg-black/40"},null,-1)),t("div",Oe,[p[5]||(p[5]=t("h3",{class:"text-sm font-semibold"},"Confirm status change",-1)),t("p",Ue,[p[1]||(p[1]=j(" Change ")),t("span",Le,f(k.value),1),p[2]||(p[2]=j(" ➜ ")),t("span",qe,f(_.value),1),p[3]||(p[3]=j(" for ")),t("span",Ve,f(((M=b.user)==null?void 0:M.name)||((w=b.user)==null?void 0:w.full_name)||((n=b.user)==null?void 0:n.email)),1),p[4]||(p[4]=j("? "))]),t("div",{class:"mt-4 flex items-center justify-end gap-2"},[t("button",{class:"px-3 py-1.5 rounded-md text-[12px] border",onClick:$},"Cancel"),t("button",{class:"px-3 py-1.5 rounded-md text-[12px] bg-gray-900 text-white hover:bg-black",onClick:c}," Confirm ")])])])):E("",!0)])}}},Fe={class:"space-y-4"},Ae={class:"flex flex-wrap items-center gap-2"},ze={class:"relative"},Re={class:"rounded-lg border p-1 text-xs"},Qe={class:"ml-auto"},Je={class:"inline-flex items-center rounded-full bg-blue-50 px-2 py-1 text-xs text-blue-700"},Ge={class:"ml-1 font-medium"},Ye={class:"overflow-x-auto rounded-xl border shadow-sm"},He={class:"min-w-full text-[13px]"},Ke={class:"p-2"},Ze={class:"p-2"},We={class:"flex items-center gap-2"},Xe={class:"relative h-8 w-8 shrink-0"},et=["src"],tt={key:1,class:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-200 text-[11px] font-semibold text-gray-700"},nt={class:"min-w-0"},at={class:"font-medium truncate"},st={class:"text-[11px] text-gray-500 space-x-2 truncate"},lt={key:0},ot={class:"hidden sm:inline"},rt={class:"p-2 hidden md:table-cell"},it=["title"],dt={class:"p-2"},ct={class:"p-2"},pt={class:"p-2"},ut=["disabled","title","onClick"],yt={key:0,class:"text-gray-600 text-sm"},mt={key:1,class:"rounded-xl border border-dashed p-10 text-center text-sm text-gray-500"},ft={__name:"ChecklistBoardTable",setup(b){const d=te(),P=H(),S=N(""),x=N(!1),I=N("progress_desc"),g=W({}),k=n=>{var s;return((s=d.rows)==null?void 0:s[String(n==null?void 0:n.id)])||{}},_=(n,s,r)=>Math.min(Math.max(Number(n||0),s),r),o=n=>{const r=k(n).percent??(n==null?void 0:n.percent)??0;return _(r,0,100)},c=n=>{var s;return _(((s=n==null?void 0:n.checklist)==null?void 0:s.required_completion_percent)??100,1,100)},$=n=>{const s=i=>String(i||"").toLowerCase(),r=s(S.value);return r?[n==null?void 0:n.name,n==null?void 0:n.employee_id,n==null?void 0:n.department,n==null?void 0:n.designation].filter(Boolean).some(i=>s(i).includes(r)):!0},h=U(()=>{let n=(d.users||[]).filter($);return x.value&&(n=n.filter(s=>o(s)<c(s))),I.value==="name_asc"?n=[...n].sort((s,r)=>(s.name||"").localeCompare(r.name||"")):I.value==="progress_asc"?n=[...n].sort((s,r)=>o(s)-o(r)):n=[...n].sort((s,r)=>o(r)-o(s)),n});function p(n){const s=d.templateId;s&&P.push({name:"checklist.create",params:{userId:n.id,templateId:s}})}const M=n=>String(n||"").toLowerCase();async function w(n,s){if(!(n!=null&&n.id))return;const r=M(n.employment_type),e=(l=>l==="probationary"?"Probationary":l==="permanent"?"Permanent":l==="contract"?"Contract":"—")(s);g[n.id]=!0,n.employment_type=s;try{await d.updateEmploymentType(n.id,e)}catch(l){n.employment_type=r,console.error(l),alert("Failed to update employment type. Please try again.")}finally{g[n.id]=!1}}return(n,s)=>(m(),v("div",Fe,[t("div",Ae,[t("div",ze,[Y(t("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>S.value=r),type:"search",placeholder:"Search name / ID / dept / designation…",class:"w-64 md:w-80 max-w-full rounded-lg border bg-white/90 px-8 py-2 text-sm outline-none focus:border-gray-400"},null,512),[[le,S.value]]),s[5]||(s[5]=t("svg",{class:"pointer-events-none absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M12.9 14.32a8 8 0 111.414-1.414l3.387 3.387a1 1 0 01-1.414 1.414L12.9 14.32zM14 8a6 6 0 11-12 0 6 6 0 0112 0z","clip-rule":"evenodd"})],-1)),S.value?(m(),v("button",{key:0,class:"absolute right-2 top-1/2 -translate-y-1/2 text-xs text-gray-500",onClick:s[1]||(s[1]=r=>S.value=""),"aria-label":"Clear search"},"✕")):E("",!0)]),t("div",Re,[t("button",{class:B(["rounded-md px-2 py-1",x.value?"":"bg-gray-900 text-white"]),onClick:s[2]||(s[2]=r=>x.value=!1)},"All",2),t("button",{class:B(["rounded-md px-2 py-1",x.value?"bg-gray-900 text-white":""]),onClick:s[3]||(s[3]=r=>x.value=!0),title:"Show only users below checklist target"},"Only Missing",2)]),Y(t("select",{"onUpdate:modelValue":s[4]||(s[4]=r=>I.value=r),class:"rounded-md border bg-white px-2 py-1 text-xs outline-none"},s[6]||(s[6]=[t("option",{value:"progress_desc"},"Sort: Progress ↓",-1),t("option",{value:"progress_asc"},"Sort: Progress ↑",-1),t("option",{value:"name_asc"},"Sort: Name A–Z",-1)]),512),[[ee,I.value]]),t("div",Qe,[t("span",Je,[s[7]||(s[7]=j(" Template: ")),t("span",Ge,f(O(d).templateId||"Not selected"),1)])])]),t("div",Ye,[t("table",He,[s[8]||(s[8]=t("thead",{class:"sticky top-0 bg-gray-50/90 backdrop-blur"},[t("tr",{class:"text-left border-b"},[t("th",{class:"p-2 w-10"},"#"),t("th",{class:"p-2 min-w-[220px]"},"User"),t("th",{class:"p-2 hidden md:table-cell min-w-[160px]"},"Role"),t("th",{class:"p-2 min-w-[260px]"},"Progress"),t("th",{class:"p-2 w-48"},"Status"),t("th",{class:"p-2 w-36"},"Actions")])],-1)),t("tbody",null,[(m(!0),v(V,null,K(h.value,(r,i)=>(m(),v("tr",{key:r.id,class:"border-b hover:bg-gray-50/70"},[t("td",Ke,f(i+1),1),t("td",Ze,[t("div",We,[t("div",Xe,[r.avatar?(m(),v("img",{key:0,src:r.avatar,alt:"",class:"h-8 w-8 rounded-full object-cover"},null,8,et)):(m(),v("div",tt,f((r.name||r.full_name||r.email||"??").slice(0,2).toUpperCase()),1))]),t("div",nt,[t("div",at,f(r.name||r.full_name||r.email),1),t("div",st,[r.joining_date?(m(),v("span",lt,"Joining Date: "+f(r.joining_date),1)):E("",!0),t("span",ot,"Dept: "+f(r.department||"—"),1)])])])]),t("td",rt,[t("div",{class:"truncate",title:r.designation},f(r.designation||"—"),9,it)]),t("td",dt,[J(Pe,{user:r,"actual-percent":o(r),"target-percent":c(r)},null,8,["user","actual-percent","target-percent"])]),t("td",ct,[J(Ee,{user:r,value:String(r.employment_type).toLowerCase(),saving:!!g[r.id],"on-confirm-change":e=>w(r,e)},null,8,["user","value","saving","on-confirm-change"])]),t("td",pt,[t("button",{class:"px-3 py-1.5 rounded-md text-[12px] font-medium bg-gray-900 text-white hover:bg-black disabled:opacity-40",disabled:!O(d).templateId,title:O(d).templateId?"":"Select a template first",onClick:e=>p(r)},f(r!=null&&r.checklist?"Open":"Create"),9,ut)])]))),128))])])]),O(d).loading?(m(),v("div",yt,"Loading…")):!O(d).loading&&h.value.length===0?(m(),v("div",mt," No users found for the current filters. ")):E("",!0)]))}},vt={class:"p-6 space-y-6"},bt={class:"flex items-center justify-between"},gt={class:"text-2xl font-semibold"},_t={class:"text-gray-500"},ht={key:0,class:"text-gray-600"},xt={key:1,class:"text-red-600"},St={__name:"JoiningExitBoard",setup(b){const d=te(),P=Z(),S=H(),x=N([]),I=N([]),g=(c={})=>({type:c.type??d.type,companyId:c.company_id?Number(c.company_id):null,departmentId:c.department_id?Number(c.department_id):null,employeeId:c.employee_id?Number(c.employee_id):null,lineType:c.line_type??null,user_type:c.user_type??null,search:c.search??d.search}),k=(c={})=>{const $={type:c.type||void 0,company_id:c.companyId||void 0,department_id:c.departmentId||void 0,employee_id:c.employeeId||void 0,line_type:c.lineType||void 0,user_type:c.user_type||void 0,search:c.search||void 0};return Object.keys($).forEach(h=>($[h]==null||$[h]==="")&&delete $[h]),$},_=N({type:d.type,companyId:d.companyId,departmentId:d.departmentId,employeeId:null,lineType:null,user_type:null,search:d.search});R(_,c=>{d.type=c.type,d.user_type=c.user_type,d.companyId=c.companyId??null,d.departmentId=c.departmentId??null,d.search=c.search??"",S.replace({query:{...P.query,...k(c)}})},{deep:!0,immediate:!0});async function o(){await d.loadUsers({type:_.value.type,company_id:_.value.companyId,department_id:_.value.departmentId,employee_id:_.value.employeeId,line_type:_.value.lineType,user_type:_.value.user_type,search:_.value.search})}return X(async()=>{Object.assign(_.value,g(P.query)),await d.loadBoard({withUsers:!0,userParams:k(_.value)})}),(c,$)=>{var h,p;return m(),v("div",vt,[t("div",bt,[t("h1",gt,[t("b",null,f(((h=O(d).templateByType)==null?void 0:h.name)||"—"),1),$[1]||($[1]=j(" Board"))]),t("div",_t,[$[2]||($[2]=j(" Template: ")),t("b",null,f(((p=O(d).templateByType)==null?void 0:p.name)||"—"),1)])]),J(de,{modelValue:_.value,"onUpdate:modelValue":$[0]||($[0]=M=>_.value=M),companies:x.value,departments:I.value,onSubmit:o},null,8,["modelValue","companies","departments"]),O(d).loading?(m(),v("div",ht,"Loading…")):O(d).error?(m(),v("div",xt,"Failed to load.")):(m(),oe(ft,{key:2}))])}}};export{St as default};
