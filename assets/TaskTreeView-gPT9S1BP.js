import{c as l,o as s,F as S,n as _,f as T,i as w,H as Y,L as ae,m as y,g as n,p as h,a as t,A as le,j as x,t as c,R as re,q as p,N as ne,O as oe,B as K,z as Z,b as ie,r as Q,x as de,w as A,k as $}from"./index-2SPaUKUG.js";import{a as L,b as ue}from"./datetime-BlGg5F0U.js";import{o as ce}from"./url-CePbr-gY.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as W}from"./UserChip-DY_gvV0H.js";const fe={class:"mt-3"},me={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick","employeeAssignClick"],setup(e,{emit:o}){const r=o;return(d,i)=>(s(),l("div",fe,[(s(!0),l(S,null,_(e.childrenTasks,(u,g)=>(s(),T(Tt,{key:u.id,index:g,task:u,class:"mb-3","hide-buttons":e.hideButtons,"hide-assigned-users":d.hideAssignedUsers,"tree-level":e.parentTreeLevel+1,onEditClick:i[0]||(i[0]=k=>r("editClick",k)),onAddClick:i[1]||(i[1]=k=>r("addClick",k)),onEmployeeAssignClick:i[2]||(i[2]=k=>r("employeeAssignClick",k))},{"item-end":w(({task:k,level:b})=>[Y(d.$slots,"treeItemEnd",{task:k,level:b})]),_:2},1032,["index","task","hide-buttons","hide-assigned-users","tree-level"]))),128))]))}},ke=ae({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:o}){const r=e,d=y(function(){return r.task.completed_count}),i=y(()=>r.task.children_task_count===0?r.task.status==="COMPLETED"?100:0:d.value/r.task.children_task_count*100),u=y(()=>{const g=i.value;let k,b,f;return g===100?(k="bg-green-50",b="bg-green-200",f="text-green-600 "):g<100&&(k="bg-red-50",b="bg-red-200",f="text-red-600 "),{container:k,bar:b,text:f}});return o({completedPercentage:i,completedSubTaskCount:d}),(g,k)=>(s(),l("div",null,[g.task.children_task_count>0?(s(),l("div",{key:0,class:h(["rounded-full border py-0.5 relative overflow-hidden h-6",u.value.container]),style:{width:"180px"}},[t("div",{class:h(["z-10 absolute top-0 bottom-0",u.value.bar]),style:le(`width: ${i.value}%`)},null,6),t("span",{class:h(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",u.value.text])},[t("span",null,[t("span",null,c(d.value),1),k[0]||(k[0]=x(" / ")),t("span",null,c(g.task.children_task_count),1)])],2)],2)):n("",!0)]))}}),ge={key:0},xe={__name:"TaskStatus",props:{status:{type:String,required:!0},progressPercent:{type:Number,required:!0}},setup(e){const o=e,r=y(()=>{switch(o.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),d=y(()=>{switch(o.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(i,u)=>(s(),l("div",{class:h(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",r.value])},[t("i",{class:h(d.value)},null,2),t("span",null,c(e.status),1),e.progressPercent!==null||e.progressPercent!==void 0?(s(),l("span",ge,c(e.progressPercent)+"% ",1)):n("",!0)],2))}},ye={},be={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function ve(e,o){return s(),l("span",be,o[0]||(o[0]=[t("i",{class:"far fa-exclamation-circle"},null,-1),x(" IMPORTANT ")]))}const he=ee(ye,[["render",ve]]),pe={class:"relative"},Te={key:0,class:"text-gray-400 text-xs"},we={class:"border rounded-full size-6 flex justify-center items-center border-blue-300 bg-blue-100"},Ce={key:0,class:"fas fa-user-cowboy text-blue-500"},$e={key:1,class:"fas fa-user-crown text-blue-300"},Se={key:2,class:"text-sm text-gray-500 group/users"},Ae={class:"cursor-pointer hover:underline text-blue-600"},Le={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg z-30"},X={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:null},isTargetTask:{Boolean,default:!1},listType:{String,default:"employee"},maxItem:{Number,default:2}},setup(e){const o=e,r=y(()=>o.users.slice(0,o.maxItem)),d=y(()=>o.users.slice(o.maxItem));function i(g){return typeof o.routeTo=="function"?o.routeTo(g):{}}const u=y(()=>typeof o.routeTo=="function"?re:"div");return(g,k)=>(s(),l("div",pe,[o.users.length===0?(s(),l("div",Te,c(e.listType=="supervisors"?"No Supervisor assigned":"Not Assigned To Anyone"),1)):(s(!0),l(S,{key:1},_(r.value,(b,f)=>(s(),T(K(u.value),oe({key:f},{ref_for:!0},{...typeof o.routeTo=="function"?{to:i(b)}:{}}),{default:w(()=>[p(W,{class:h(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask," !bg-blue-100":!e.isTargetTask&&e.listType=="employee"&&f===0}]),user:b},ne({_:2},[f===0||e.listType=="supervisors"?{name:"after",fn:w(()=>[t("div",we,[e.listType=="supervisors"?(s(),l("i",Ce)):(s(),l("i",$e))])]),key:"0"}:void 0]),1032,["class","user"])]),_:2},1040))),128)),d.value.length>0?(s(),l("div",Se,[t("div",Ae," + "+c(d.value.length)+" more "+c(e.listType=="employee"?"users":e.listType=="supervisors"?"supervisor":""),1),t("div",Le,[(s(!0),l(S,null,_(d.value,(b,f)=>(s(),T(K(u.value),{key:f,to:i(b),class:"w-full block mb-2"},{default:w(()=>[p(W,{class:h(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:b},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):n("",!0)]))}},_e={class:"col-span-full flex flex-col md:flex-row items-stretched my-2 lg:my-0 justify-center flex-wrap gap-x-5 gap-y-4"},Ne={class:"flex flex-col items-start justify-center gap-2 border border-dashed border-gray-200 rounded shadow shadow-gray-100 bg-gray-50/40 p-4"},Be={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-sky-500 text-white"},Ee={class:"flex flex-col items-start justify-center gap-2 border border-dashed border-gray-200 rounded shadow shadow-gray-100 bg-gray-50/40 p-4"},De={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-blue-500 text-white"},Re={__name:"TaskSupervisorAndEmployee",props:{treeLevel:{type:Number,required:!0},task:{type:Object,required:!0},employeeRouteTo:{type:Function,default:null}},setup(e){return(o,r)=>{var d,i,u,g;return s(),l("div",_e,[t("div",Ne,[e.treeLevel===0?(s(),l("div",Be,c(((i=(d=e.task)==null?void 0:d.from_department)==null?void 0:i.name)||"--"),1)):n("",!0),p(X,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:e.task.supervisors||[],listType:"supervisors",maxItem:1},null,8,["users"])]),r[0]||(r[0]=t("div",null,[t("span",{class:"flex md:hidden text-2xl text-gray-200 items-center justify-center h-full"},[t("i",{class:"fad fa-arrow-down"})]),t("span",{class:"hidden md:flex text-2xl text-gray-200 items-center justify-center h-full"},[t("i",{class:"fad fa-arrow-right"})])],-1)),t("div",Ee,[e.treeLevel===0?(s(),l("div",De,c(((g=(u=e.task)==null?void 0:u.to_department)==null?void 0:g.name)||"--"),1)):n("",!0),p(X,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:e.employeeRouteTo,maxItem:1},null,8,["users","isTargetTask","routeTo"])])])}}},je={class:"flex items-center gap-2"},Pe={__name:"TaskTitleRouterLink",props:{task:Object,subTasksOpen:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},setup(e){return(o,r)=>{var i;const d=Z("RouterLink");return s(),l("div",je,[t("i",{class:h(["fad",((i=e.task)==null?void 0:i.children_task_count)>0?{"fa-folder text-blue-800/70":!e.subTasksOpen,"fa-folder-open text-blue-400":e.subTasksOpen}:"fa-file-alt text-gray-400"])},null,2),p(d,{to:{name:e.isMyTask?"MyTaskShow":"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-blue-700"},{default:w(()=>[t("div",null,c(e.task.title),1)]),_:1},8,["to"])])}}},Oe={},Ie={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function qe(e,o){return s(),l("span",Ie,o[0]||(o[0]=[t("i",{class:"far fa-exclamation-triangle"},null,-1),x(" URGENT ")]))}const Me=ee(Oe,[["render",qe]]),Ue={class:"flex w-full text-gray-800"},ze={key:0,class:"border-l border-gray-200 last:border-l-0"},Ve={class:"items-start grid grid-cols-4 gap-4 group"},Fe={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},Ge={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},He={key:0,class:"text-xl font-semibold text-blue-500"},Je={key:1,class:"text-sm text-gray-500 mt-2"},Ke={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Qe={key:0,class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"},We={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Xe={key:0,class:"flex gap-4 items-center mr-3"},Ye={key:1,class:"text-gray-500 text-sm"},Ze={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},et={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},tt={class:"text-gray-400 text-xs col-span-full"},st={class:"flex flex-wrap gap-2 mb-2 col-span-full"},at={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4 mt-4 opacity-80"},lt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},rt={key:1,class:"text-gray-500 text-sm"},nt={class:"font-semibold text-blue-800"},ot={key:2,class:"ml-4 text-gray-500 text-sm"},it={class:"text-blue-500 font-semibold"},dt={key:3,class:"text-gray-500 text-sm"},ut={class:"font-semibold text-blue-800"},ct={key:4,class:"text-gray-500 text-sm"},ft={class:"font-semibold text-blue-800"},mt={class:"mt-4 col-span-full"},kt={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},gt={class:"text-xs text-gray-400 flex gap-3 order-1 sm:order-0"},xt=["href"],yt={class:"flex items-center sm:ml-auto order-0 sm:order-1"},bt={key:0,class:"flex gap-2 ml-4 items-center text-xs"},vt=["href"],ht=["href"],pt={class:"ml-0"},Tt={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(e,{emit:o}){const r=e,d=ie(),i=Q(null),u=o;function g(m){u("addClick",m)}function k(m){u("editClick",m)}function b(m){u("employeeAssignClick",m)}const f=Q([]),B=localStorage.getItem("sub_task_opened_list");if(B)try{f.value=JSON.parse(B)}catch{f.value=[]}const E=y(()=>L(r.task.assigned_at||r.task.created_at)),D=y(()=>L(r.task.deadline)),R=y(()=>L(r.task.started_at)),j=y(()=>L(r.task.completed_at)),C=y({get:()=>f.value.includes(r.task.id),set:m=>{const a=f.value.includes(r.task.id);m&&!a?f.value.push(r.task.id):!m&&a&&(f.value=f.value.filter(N=>N!==r.task.id))}});de(f,m=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(m))},{deep:!0});const P=y(()=>{var m,a;return((a=(m=r.task)==null?void 0:m.children_tasks)==null?void 0:a.length)>0});function te(){r.task.children_tasks.length>0&&(C.value=!C.value)}return(m,a)=>{var O,I,q,M,U,z,V,F,G,H,J;const N=Z("RouterLink");return s(),l("div",Ue,[e.treeLevel>0?(s(),l("div",ze,a[4]||(a[4]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):n("",!0),t("div",{class:h(["flex-grow border-2 rounded py-3 px-3",{"bg-blue-100/30  ":e.task.closed_at,"bg-green-100  ":((O=i.value)==null?void 0:O.completedPercentage)===100,"bg-white hover:bg-gray-50":((I=i.value)==null?void 0:I.completedPercentage)<100&&!e.task.closed_at,"shadow-sm":e.treeLevel>0,"border-blue-500":e.index%2===0,"border-pink-300":e.index%2===1}])},[t("div",Ve,[t("div",Fe,[t("div",Ge,[e.index!==void 0?(s(),l("div",He,c(e.index+1)+". ",1)):n("",!0),p(Pe,{task:e.task,"sub-tasks-open":C.value,"is-my-task":e.isMyTask},null,8,["task","sub-tasks-open","is-my-task"]),(q=e.task)!=null&&q.requirement?(s(),l("p",Je," Requirement: "+c((U=(M=e.task)==null?void 0:M.requirement)==null?void 0:U.title),1)):n("",!0)]),t("div",Ke,[e.task.closed_at?(s(),l("div",Qe,a[5]||(a[5]=[t("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),x("CLOSED ")]))):n("",!0),p(xe,{status:(z=e.task)==null?void 0:z.status,progressPercent:((V=e.task)==null?void 0:V.progress_percent)||0},null,8,["status","progressPercent"]),p(ke,{ref_key:"progress",ref:i,task:e.task,class:"text-sm"},null,8,["task"])]),t("div",We,[e.showDraggableHandle||e.task.serial?(s(),l("div",Xe,[e.showDraggableHandle?(s(),l("button",{key:0,onMousedown:a[0]||(a[0]=A((...v)=>m.handleDragging&&m.handleDragging(...v),["stop"])),class:"handle"},a[6]||(a[6]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):n("",!0),e.task.serial?(s(),l("span",Ye," #"+c(e.task.serial),1)):n("",!0)])):n("",!0),t("div",Ze,[e.treeLevel===0?(s(),l("div",et," Main ")):n("",!0),(F=e.task)!=null&&F.is_important?(s(),T(he,{key:1})):n("",!0),(G=e.task)!=null&&G.is_urgent?(s(),T(Me,{key:2})):n("",!0)])])]),t("div",tt,[a[7]||(a[7]=t("i",{class:"fas fa-clock"},null,-1)),x(" "+c($(ue)(e.task.created_at)),1)]),t("div",st,[(s(!0),l(S,null,_(e.task.website_tags||[],v=>(s(),l("div",{class:"border bg-gray-50 text-xs px-2 rounded-lg shadow-sm text-gray-700 bg-gradient-to-b to-slate-50 from-blue-100",key:v.id},c(v.name),1))),128))]),e.hideAssignedUsers?n("",!0):(s(),T(Re,{key:0,task:e.task,"tree-level":e.treeLevel,"employee-route-to":v=>({query:{...$(d).query,view:"userwise","company-id":v.company_id,"user-ids":v.id}})},null,8,["task","tree-level","employee-route-to"]))]),t("div",at,[e.task.is_target?(s(),l("div",lt,a[8]||(a[8]=[t("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),x(" TARGET TASK ")]))):n("",!0),E.value?(s(),l("span",rt,[a[9]||(a[9]=x(" Assign: ")),t("span",nt,c(E.value),1)])):n("",!0),D.value?(s(),l("span",ot,[a[10]||(a[10]=x(" Deadline: ")),t("span",it,c(D.value),1)])):n("",!0),R.value?(s(),l("span",dt,[a[11]||(a[11]=x(" Started: ")),t("span",ut,c(R.value),1)])):n("",!0),j.value?(s(),l("span",ct,[a[12]||(a[12]=x(" Completed: ")),t("span",ft,c(j.value),1)])):n("",!0)]),t("div",mt,[t("div",kt,[t("div",gt,[t("button",{class:h([{"text-blue-600 font-semibold  inline-block  ":P.value},"flex items-center gap-1 group"]),onClick:te},[t("i",{class:h([C.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:h(P.value?"group-hover:underline":"")}," Sub Tasks ("+c((H=e.task.children_tasks)==null?void 0:H.length)+") ",3)],2),!e.task.closed_at&&!e.hideButtons?(s(),l(S,{key:0},[e.treeLevel<2?(s(),l("a",{key:0,href:`/tasks/add?parent_id=${r.task.id}&back-to=${encodeURIComponent($(d).path+"?"+$(ce)($(d).query)).toLowerCase()}`,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:a[1]||(a[1]=A(v=>u("addClick",r.task.id),["stop","prevent"]))},a[13]||(a[13]=[t("i",{class:"fas fa-plus"},null,-1),x(" Add Sub Task ")]),8,xt)):n("",!0)],64)):n("",!0)]),t("div",yt,[e.hideButtons?n("",!0):(s(),l("div",bt,[e.task.is_closed?n("",!0):(s(),l("a",{key:0,href:`/tasks/edit/${e.task.id}`,onClick:a[2]||(a[2]=A(v=>u("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},a[14]||(a[14]=[t("i",{class:"fas fa-edit"},null,-1),x(" Edit ")]),8,vt)),e.task.is_closed?n("",!0):(s(),l("a",{key:1,href:`/tasks/${e.task.id}/assign-users`,onClick:a[3]||(a[3]=A(v=>u("employeeAssignClick",e.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},a[15]||(a[15]=[t("i",{class:"fas fa-users-cog"},null,-1),x(" Manage Employee & Supervisor ")]),8,ht)),p(N,{to:{name:"TaskReports",params:{id:(J=e.task)==null?void 0:J.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:w(()=>a[16]||(a[16]=[t("i",{class:"far fa-file-alt"},null,-1),x(" Reports ")])),_:1,__:[16]},8,["to"])]))])]),t("div",pt,[C.value?(s(),T(me,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"hide-assigned-users":e.hideAssignedUsers,"parent-tree-level":e.treeLevel,onEditClick:k,onAddClick:g,onEmployeeAssignClick:b},{"tree-item-end":w(({task:v,level:se})=>[Y(m.$slots,"item-end",{level:se,task:v})]),_:3},8,["childrenTasks","hide-buttons","hide-assigned-users","parent-tree-level"])):n("",!0)])])],2)])}}};export{he as T,Tt as _,Pe as a,xe as b,ke as c,Me as d,Re as e};
