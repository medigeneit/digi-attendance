import{d as G,r as c,q as w,e as H,c as i,o,a as t,t as x,w as F,i as J,f as m,l as k,p as S,F as K,x as P,m as Q,g as b,D as V,y as W,n as T,v as z}from"./index-DGK8Wbtz.js";import{_ as X}from"./MultiselectDropdown-BN6BcYkG.js";import{_ as B}from"./UserChip-D-Zo07Z7.js";import{a as D}from"./datetime-q3Sn87-f.js";import{u as Z}from"./company-BK1fGjFi.js";import{u as ee}from"./useTaskStore-7-FDdAv4.js";import{u as te}from"./user-6Ec0A6T6.js";import{R as I}from"./RequiredIcon-Cqi83pRD.js";const se={class:"px-4 max-h-[90vh] overflow-auto rounded"},ae={class:"sticky top-0 bg-white z-20"},le={class:"mb-2 flex items-center gap-2"},oe={class:"font-semibold text-gray-600 text-sm leading-none"},ie={key:0,class:"text-center text-gray-500 py-4"},re={class:"mb-4"},ne={class:"mb-2 flex flex-wrap gap-2"},ue=["onClick"],de={class:"flex gap-16 items-center mb-8"},me={key:0,class:"flex gap-1 items-center"},pe={key:1,class:"flex gap-1 items-center"},ce={key:0,class:"mt-8"},ve={class:"grid grid-cols-2 gap-4 mb-4 mt-12"},ge={key:0,class:"mb-4"},be={class:"block text-gray-600 text-sm mb-1 font-medium"},fe={key:1,class:"mb-4"},ye={class:"block text-gray-600 text-sm mb-1 font-medium"},_e={class:"flex justify-between items-center gap-4 sticky bottom-0 bg-white border-t px-4 -mx-4 py-3"},xe={key:0,class:"mb-4 text-red-500 font-medium"},ke={key:1,class:"mb-4 text-blue-500 font-medium"},he=["disabled"],Ee={__name:"TaskUserAssignForm",props:{taskId:{type:[Number,String],required:!0}},emits:["success","cancelClick"],setup(N,{emit:$}){var E;const C=ee(),q=Z(),M=te(),r=G(),u=c([]),O=w(()=>u.value.map(s=>s.id)),n=c(""),f=c(null),y=c([]),U=N,p=c(null),l=c({...((E=r.user)==null?void 0:E.role)=="employee"?{}:{is_important:!1,is_urgent:!1,is_target:!1,started_at:"",deadline:""}}),A=$;H(async()=>{var e,d,a,g,_,h;n.value="loading";const s=await C.fetchTask(U.taskId,{with_parent:"true"},{loadingBeforeFetch:!1,fetchOnly:!0});p.value=s.task,p.value.parent?y.value=((d=(e=p.value)==null?void 0:e.parent)==null?void 0:d.users)||[]:((a=r.user)==null?void 0:a.role)==="employee"?y.value=((h=(_=await q.fetchEmployees((g=r.user)==null?void 0:g.company_id))==null?void 0:_.data)==null?void 0:h.employees)||[]:(await M.fetchUsers(),y.value=M.users),R(p.value),u.value=p.value.users,n.value=""});const j=w(()=>y.value.filter(s=>!u.value.find(e=>e.id===s.id))),L=async()=>{var s,e;n.value="submitting",f.value=null;try{await C.updateTask(U.taskId,{...l.value,user_ids:O.value},{loadingBeforeFetch:!1}),A("success")}catch(d){f.value=((e=(s=d.response)==null?void 0:s.data)==null?void 0:e.message)||"Assign users failed"}finally{n.value=""}};function R(s){var e;l.value={...((e=r.user)==null?void 0:e.role)=="employee"?{}:{is_important:s.is_important,is_urgent:s.is_urgent,is_target:s.is_target,started_at:D(s.started_at),deadline:D(s.deadline)}}}const v=w(()=>{let s={is_important:!1,is_urgent:!1,is_target:!1,started_at:!1,deadline:!1};return r.user.role==="employee"||(s.is_important=r.isAdminMood,s.is_urgent=r.isAdminMood,s.is_target=r.isAdminMood,s.started_at=r.isAdminMood,s.deadline=r.isAdminMood),s});return(s,e)=>{var d;return o(),i("div",se,[t("div",ae,[e[8]||(e[8]=t("h2",{class:"text-xl font-semibold text-gray-800 mb-1 mt-4"},"Manage Employee(s) for Task",-1)),t("h3",le,[e[7]||(e[7]=t("div",{class:"uppercase text-sm text-gray-600"},"Task:",-1)),t("div",oe,x((d=p.value)==null?void 0:d.title),1)]),e[9]||(e[9]=t("hr",{class:"mb-4 !mt-0"},null,-1))]),n.value==="loading"?(o(),i("div",ie,"Loading users...")):(o(),i("form",{key:1,onSubmit:F(L,["prevent"])},[t("div",re,[e[10]||(e[10]=t("label",{class:"block uppercase text-xs text-gray-600"},"Employees",-1)),k(X,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),options:j.value,multiple:!0,"track-by":"id",label:"label",placeholder:"Select users"},{selection:S(({...a})=>[t("div",ne,[(o(!0),i(K,null,P((a==null?void 0:a.values)||[],g=>(o(),Q(B,{key:g.id,user:g},{after:S(({user:_})=>[t("button",{class:"size-6 border rounded-full hover:bg-red-400 hover:text-white",onClick:F(h=>u.value=u.value.filter(Y=>Y.id!==_.id),["prevent"])}," Ã— ",8,ue)]),_:2},1032,["user"]))),128))])]),option:S(({option:a})=>[k(B,{user:a},null,8,["user"])]),_:1},8,["modelValue","options"])]),e[16]||(e[16]=J('<hr><h3 class="my-6 text-center w-full relative"><div class="inline-block bg-white px-4"><b class="fas fa-cog text-gray-400"></b><span class="text-gray-700">Task Settings for Employee</span></div><hr class="bottom-0 border-gray-400 -mt-3"></h3>',2)),t("div",de,[v.value.is_important?(o(),i("label",me,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>l.value.is_important=a),class:"size-4"},null,512),[[V,l.value.is_important]]),e[11]||(e[11]=t("span",{class:"block text-gray-600 text-base font-medium"},"Important",-1))])):m("",!0),v.value.is_urgent?(o(),i("label",pe,[b(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>l.value.is_urgent=a),class:"size-4"},null,512),[[V,l.value.is_urgent]]),e[12]||(e[12]=t("span",{class:"block text-gray-600 text-base font-medium"},"Urgent",-1))])):m("",!0)]),v.value.is_target?(o(),i("div",ce,[t("label",{class:W(["flex gap-1 items-center mt-4 border rounded py-2 justify-center cursor-pointer",{"bg-yellow-200":l.value.is_target}])},[b(t("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>l.value.is_target=a),class:"size-6"},null,512),[[V,l.value.is_target]]),e[13]||(e[13]=t("span",{class:"block text-gray-600 text-base mb-1 font-medium"},"Is Target Task",-1))],2)])):m("",!0),t("div",ve,[v.value.started_at?(o(),i("div",ge,[t("label",be,[e[14]||(e[14]=T(" Start Date ")),k(I),T(" "+x(l.value.started_at),1)]),b(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.started_at=a),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[z,l.value.started_at]])])):m("",!0),v.value.deadline?(o(),i("div",fe,[t("label",ye,[e[15]||(e[15]=T(" Deadline ")),k(I)]),b(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.deadline=a),type:"date",placeholder:"Enter Start Date",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[z,l.value.deadline]])])):m("",!0)]),t("div",_e,[f.value?(o(),i("div",xe,x(f.value),1)):m("",!0),n.value=="submitting"?(o(),i("div",ke," Saving changes... ")):m("",!0),t("button",{disabled:n.value=="submitting"||n.value=="loading",type:"submit",class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-5 py-2 rounded transition"},x(n.value=="submitting"?"Saving...":"Save"),9,he),t("button",{type:"button",onClick:e[6]||(e[6]=a=>A("cancelClick")),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel ")])],32))])}}};export{Ee as _};
