import{A,r as _,p as h,e as R,y as c,c as r,o as u,a as s,g as m,s as y,i as g,t as S,w,_ as q}from"./index-PVxjk86_.js";import{u as G}from"./company-DSxqNWSi.js";import{u as H}from"./department-CNqBoyVq.js";import{S as V}from"./SelectDropdown-nIExiyTF.js";import{_ as J}from"./UserChip-Dtr8a9t0.js";const K={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Q={class:"relative"},W={key:0,class:"relative w-full pr-6"},X={class:"flex items-center gap-2 text-sm text-gray-700"},Y={class:"line-clamp-1"},Z={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},ee={class:"relative"},te={key:0,class:"relative w-full pr-6"},le={class:"flex items-center gap-2 text-sm text-gray-700"},ae={class:"line-clamp-1"},ie={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},se={key:0,class:"absolute inset-0 bg-white/50 cursor-not-allowed rounded","aria-hidden":"true"},oe={key:0,class:"relative"},ne={key:0,class:"relative w-full pr-6"},de={class:"flex items-center gap-2 text-sm text-gray-700"},re={class:"line-clamp-1"},ue={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},pe={class:"relative"},me={key:0,class:"relative w-full pr-6"},ce={key:0,class:"flex items-center gap-2 text-sm text-gray-700"},ve={class:"line-clamp-1"},ye={key:1,class:"text-sm text-gray-500"},fe={key:2,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},Se={__name:"EmployeeFilter",props:{company_id:{type:[String,Number],default:""},department_id:{type:[String,Number],default:""},employee_id:{type:[String,Number],default:""},line_type:{type:String,default:"all"},withType:{type:Boolean,default:!0},initialValue:{type:Object,default:()=>({})}},emits:["update:company_id","update:department_id","update:employee_id","update:line_type","filter-change"],setup(E,{emit:N}){const a=E,n=N,b=G(),D=H(),{companies:B}=A(b),{departments:k}=A(D),p=_(String(a.company_id||a.initialValue.company_id||"")),o=_(a.department_id!==""?String(a.department_id):a.initialValue.department_id&&a.initialValue.department_id!=="all"?String(a.initialValue.department_id):""),d=_(a.withType?String(a.line_type||a.initialValue.line_type||"all"):null),i=_(String(a.employee_id||a.initialValue.employee_id||"")),z=h(()=>(B.value||[]).map(l=>({id:String(l.id),label:l.name}))),O=h(()=>(k.value||[]).map(e=>({id:String(e.id),label:e.name}))),U=h(()=>a.withType?[{id:"all",label:"All Types"},{id:"executive",label:"Executive"},{id:"support_staff",label:"Support Staff"},{id:"doctor",label:"Doctor"},{id:"academy_body",label:"Academy Body"}]:[]),F=h(()=>b.employees||[]),v=_([]);R(async()=>{await b.fetchCompanies(),p.value&&await $(p.value),f(),i.value&&(v.value.find(e=>e.id===String(i.value))||(i.value="",n("update:employee_id",""))),M()}),c(()=>a.company_id,l=>{String(l||"")!==p.value&&(p.value=String(l||""))}),c(()=>a.department_id,l=>{const e=l===""||l==null?"":String(l);e!==o.value&&(o.value=e)}),c(()=>a.employee_id,l=>{String(l||"")!==i.value&&(i.value=String(l||""))}),c(()=>a.line_type,l=>{if(!a.withType)return;const e=String(l||"all");e!==d.value&&(d.value=e)}),c(p,async l=>{o.value="",i.value="",v.value=[],n("update:company_id",l||""),n("update:department_id",""),n("update:employee_id",""),l?await $(l):k.value=[],f(),x()}),c([o,d],()=>{n("update:department_id",o.value||""),a.withType&&n("update:line_type",d.value||"all"),f(),x()}),c(i,()=>{n("update:employee_id",i.value||""),x()});async function $(l){await Promise.all([D.fetchDepartments(l),b.fetchEmployee(l)])}function f(){let l=[...F.value];o.value&&(l=l.filter(e=>String(e.department_id)===String(o.value))),a.withType&&d.value&&d.value!=="all"&&(l=l.filter(e=>String(e.type)===String(d.value))),v.value=l.map(e=>({...e,id:String(e.id),label:e.name||e.label||`${e.first_name??""} ${e.last_name??""}`.trim()})),i.value&&(v.value.some(t=>t.id===String(i.value))||(i.value="",n("update:employee_id","")))}function M(){n("update:company_id",p.value||""),n("update:department_id",o.value||""),a.withType&&n("update:line_type",d.value||"all"),n("update:employee_id",i.value||""),x()}let T=null;function x(){T&&clearTimeout(T),T=setTimeout(()=>n("filter-change"),0)}function j(){p.value="",o.value="",i.value="",v.value=[],k.value=[]}function I(){o.value="",i.value="",f()}function L(){a.withType&&(d.value="all",i.value="",f())}function P(){i.value=""}return(l,e)=>(u(),r("div",K,[s("div",Q,[y(V,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),options:z.value,placeholder:"Select Company",class:"border-2 border-gray-300 rounded h-[44px] w-full bg-white"},{"selected-option":g(({option:t})=>[t?(u(),r("div",W,[s("div",X,[s("div",Y,S(t==null?void 0:t.label),1)]),p.value?(u(),r("div",Z,[s("button",{onClick:e[0]||(e[0]=w(C=>j(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"},"×")])):m("",!0)])):m("",!0)]),_:1},8,["modelValue","options"]),e[8]||(e[8]=s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),s("div",ee,[y(V,{modelValue:o.value,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value=t),options:O.value,placeholder:"Select Department",class:"border-2 border-gray-300 rounded h-[44px] w-full bg-white"},{"selected-option":g(({option:t})=>[t||o.value===""?(u(),r("div",te,[s("div",le,[s("div",ae,S((t==null?void 0:t.label)||"All Departments"),1)]),o.value?(u(),r("div",ie,[s("button",{onClick:e[2]||(e[2]=w(C=>I(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"},"×")])):m("",!0)])):m("",!0)]),_:1},8,["modelValue","options"]),e[9]||(e[9]=s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Department ",-1)),p.value?m("",!0):(u(),r("div",se))]),E.withType?(u(),r("div",oe,[y(V,{modelValue:d.value,"onUpdate:modelValue":e[5]||(e[5]=t=>d.value=t),options:U.value,placeholder:"Select Type",class:"border-2 border-gray-300 rounded h-[44px] w-full bg-white"},{"selected-option":g(({option:t})=>[t?(u(),r("div",ne,[s("div",de,[s("div",re,S(t==null?void 0:t.label),1)]),d.value&&d.value!=="all"?(u(),r("div",ue,[s("button",{onClick:e[4]||(e[4]=w(C=>L(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"},"×")])):m("",!0)])):m("",!0)]),_:1},8,["modelValue","options"]),e[10]||(e[10]=s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Line Type ",-1))])):m("",!0),s("div",pe,[y(V,{modelValue:i.value,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value=t),options:v.value,placeholder:"--Select Employee--",class:"border-2 border-gray-300 rounded h-[44px] w-full bg-white"},{option:g(({option:t})=>[y(J,{user:t||{},class:"w-full overflow-hidden border relative"},null,8,["user"])]),"selected-option":g(({option:t})=>[t||i.value===""?(u(),r("div",me,[t?(u(),r("div",ce,[y(q,{user:t},null,8,["user"]),s("div",ve,S(t==null?void 0:t.label),1)])):(u(),r("div",ye,"All Employees")),i.value?(u(),r("div",fe,[s("button",{onClick:e[6]||(e[6]=w(C=>P(),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700",title:"Clear selection"},"×")])):m("",!0)])):m("",!0)]),_:1},8,["modelValue","options"]),e[11]||(e[11]=s("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))])]))}};export{Se as _};
