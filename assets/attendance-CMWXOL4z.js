import{B as $,r as p,C as y}from"./index-DNKWsMNv.js";const G=$("attendance",()=>{const g=p([]),w=p([]),h=p([]),v=p([]),f=p([]),b=p(null),S=p(null),D=p(new Date().toISOString().substring(0,7)),L=p(new Date().toISOString().substring(0,10)),e=p(null),d=p(!1),R=async(o,r)=>{const t=_(r);return g.value.find(a=>a.date===t)},_=o=>{const r=new Date(o),t=String(r.getDate()).padStart(2,"0"),a=r.toLocaleString("en-US",{month:"short"}),n=r.getFullYear();return`${t} ${a} ${n}`};return{monthlyLogs:g,dailyLateLogs:v,monthlyLateLogs:f,summary:b,monthly_company_summary:S,selectedMonth:D,selectedDate:L,error:e,isLoading:d,dailyLogs:h,attendanceLogs:w,getUserDailyLogsByDate:R,getMonthlyAttendanceByShift:async(o,r)=>{var t,a;if(!o||!r){e.value="Invalid user ID or month";return}d.value=!0;try{const n=await y.get(`/user/${o}/attendance/monthly/${r}`);g.value=n.data.monthly_logs,b.value=n.data.summary,e.value=null}catch(n){e.value=((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},getTodayAttendanceReport:async(o={})=>{var r,t;d.value=!0;try{const a=await y.get("/attendance/today",{params:o});h.value=a.data,e.value=null}catch(a){e.value=((t=(r=a.response)==null?void 0:r.data)==null?void 0:t.message)||"Something went wrong",console.error("[Attendance Error]",e.value)}finally{d.value=!1}},getAttendanceLateReport:async(o,r=null,t=null,a=null,n,s)=>{var l,c;d.value=!0;try{const u={company_id:o,department_id:r,category:t,employee_id:a,type:s,...s==="daily"?{date:n}:{month:n}},i=await y.get("/monthly/attendance/late-reports",{params:u});s==="daily"?v.value=i.data:s==="monthly"&&(f.value=i.data),e.value=null}catch(u){e.value=((c=(l=u.response)==null?void 0:l.data)==null?void 0:c.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},getMonthlyAttendanceSummaryReport:async(o,r,t,a)=>{var n,s;if(!o||!a){e.value="Company & month are required";return}d.value=!0;try{const l={month:a},c=await y.post("/attendance/monthly-summary-reports",l);e.value=null}catch(l){e.value=((s=(n=l.response)==null?void 0:n.data)==null?void 0:s.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},downloadExcel:async(o,r,t)=>{var a,n;if(!o||!t){e.value="Invalid company ID or month";return}d.value=!0;try{const s={company_id:o,line_type:r,month:t},l=await y.get("/attendance/monthly-summary-reports?flag=excel",{params:s,responseType:"blob"}),c=window.URL.createObjectURL(new Blob([l.data])),u=document.createElement("a");u.href=c,u.setAttribute("download",`${t} attendance_summary.xlsx`),document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(s){e.value=((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},downloadPDF:async(o,r,t,a=0)=>{var n,s;if(!o||!t){e.value="Invalid user ID or month";return}d.value=!0;try{const l={company_id:o,category:r,month:t},c=await y.get("/attendance/monthly-summary-reports?flag=pdf",{params:l,responseType:"blob"}),u=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=u,i.setAttribute("download",`${t} attendance_summary.pdf`),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(l){e.value=((s=(n=l.response)==null?void 0:n.data)==null?void 0:s.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},attendanceDownloadExcel:async(o,r,t,a,n)=>{var s,l;d.value=!0;try{const c={companyId:o,employee_id:r,line_type:t,month:a,status:n},u=await y.get("/attendance/today?flag=excel",{params:c,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([u.data])),m=document.createElement("a");m.href=i,m.setAttribute("download",`${a} attendance_summary.xlsx`),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(c){e.value=((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},attendanceDownloadPdf:async(o,r,t,a,n)=>{var s,l;d.value=!0;try{const c={companyId:o,employee_id:r,category:t,month:a,status:n},u=await y.get("/attendance/today?flag=pdf",{params:c,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([u.data])),m=document.createElement("a");m.href=i,m.setAttribute("download",`${a} attendance_summary.pdf`),document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(c){e.value=((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},lateReportDownloadExcel:async(o,r,t,a)=>{var n,s;if(!o){e.value="Invalid company ID or date/month";return}d.value=!0;try{const l={company_id:o,...r?{employee_id:r}:{},type:a,...a==="daily"?{date:t}:{month:t}},c=await y.get("/monthly/attendance/late-reports?flag=excel",{params:l,responseType:"blob"}),u=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=u;const m=`${t}-late-attendance.xlsx`;i.setAttribute("download",m),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(l){e.value=((s=(n=l.response)==null?void 0:n.data)==null?void 0:s.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},getMonthlyAttendanceLog:async(o,r)=>{var t,a;if(!o||!r){e.value="Invalid user ID or month";return}d.value=!0;try{const n=await y.get(`/user/${o}/attendance/monthly/${r}/log`);w.value=n.data.attendance_logs}catch(n){e.value=((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},getDateRangeAttendanceSummary:async(o,r,t,a,n)=>{var s,l;if(!t||!o||!r){e.value="Company, Start Date, and End Date are required";return}d.value=!0;try{return(await y.get("/attendance/date-range-summary",{params:{company_id:t,line_type:a||"all",start_date:o,end_date:r,employee_id:n||void 0}})).data}catch(c){return e.value=((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message)||"Something went wrong",console.error(e.value),null}finally{d.value=!1}},downloadDateRangeExcel:async(o,r,t,a="all",n=null)=>{var u;if(!t||!o||!r){e.value="Company, Start Date, and End Date are required";return}const s=(u=y.defaults.baseURL)==null?void 0:u.replace(/\/$/,"");let l=`flag=excel&company_id=${t}&start_date=${o}&end_date=${r}`;n&&(l+=`&employee_id=${n}`),a&&(l+=`&line_type=${a}`);const c=`${s}/attendance/date-range-summary?${l}`;console.log("ðŸ“ Opening Excel Download URL:",c),window.open(c,"_blank")},downloadDateRangePdf:(o,r,t,a,n=null,s="")=>{if(!t||!o||!r){e.value="Company, Start Date, and End Date are required";return}const l=new URLSearchParams({flag:"pdf",company_id:t,line_type:a,start_date:o,end_date:r});n&&l.append("employee_id",n),s&&l.append("category",s);const c=`/attendance/date-range-summary?${l.toString()}`;window.open(c,"_blank")},getDailyLateReport:async(o,r=null,t=null,a=null,n,s)=>{var l,c;d.value=!0;try{const u={company_id:o,department_id:r,line_type:t,employee_id:a,type:s,...s==="daily"?{date:n}:{month:n}},i=await y.get("/attendance/late-reports",{params:u});s==="daily"?v.value=i.data:s==="monthly"&&(f.value=i.data),e.value=null}catch(u){e.value=((c=(l=u.response)==null?void 0:l.data)==null?void 0:c.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},recalculateMonthlySnapshot:async(o,r,t,a)=>{var n,s;if(!o||!a){e.value="Company & month are required";return}d.value=!0;try{const l={month:a},c=await y.post("/attendance/monthly-snapshot/recalculate",l);e.value=null}catch(l){e.value=((s=(n=l.response)==null?void 0:n.data)==null?void 0:s.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}},finalizeMonthlySnapshot:async(o,r,t,a,n="finalize")=>{var s,l;if(!o||!a){e.value="Company & month are required";return}d.value=!0;try{const c={company_id:o,line_type:r,employee_id:t,month:a,action:n},u=await y.post("/attendance/monthly-snapshot/finalize",c);e.value=null}catch(c){e.value=((l=(s=c.response)==null?void 0:s.data)==null?void 0:l.message)||"Something went wrong",console.error(e.value)}finally{d.value=!1}}}});export{G as u};
