import{r as l,i as E,o as b,c as h,a as e,e as M,t as w,b as O,j as P,k as D,l as I,w as N,d as U,v as C,F as A,m as R}from"./index-B4ZWr-Ut.js";import{u as T}from"./user--1MYI6TX.js";const z={key:0,class:"modal-bg z-50"},L={class:"modal-card relative"},q={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-200 bg-opacity-75 z-10"},G=["src"],H={class:"flex justify-center mt-4"},J=["disabled"],K={__name:"PhotoModal",props:{imageSrc:{type:String,default:""},isOpen:{type:Boolean,default:!1}},emits:["close","fileSelected","uploadPhoto"],setup(V,{emit:m}){const s=m,u=l(null),n=l(!1),a=l(!1),d=l(!1),i=V,c=l(i.isOpen),p=l(i.imageSrc),g=()=>{c.value=!1,s("close"),_()},y=v=>{const o=v.target.files[0];if(o){const S=new FileReader;S.onload=x=>{p.value=x.target.result,n.value=!0},S.readAsDataURL(o),s("fileSelected",o)}},k=()=>{u.value.click()},F=()=>{n.value?(a.value=!0,s("uploadPhoto",u.value.files[0]),setTimeout(()=>{a.value=!1,d.value=!0},2e3)):k()},_=()=>{n.value=!1,a.value=!1,d.value=!1};return E(()=>i.isOpen,v=>{c.value=v,v&&(p.value=i.imageSrc,_())}),(v,o)=>c.value?(b(),h("div",z,[e("div",L,[a.value?(b(),h("div",q,o[0]||(o[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"},null,-1)]))):M("",!0),p.value?(b(),h("img",{key:1,src:p.value,alt:"Modal Image",class:"aspect-[3/4] object-cover rounded-md"},null,8,G)):M("",!0),e("div",H,[e("button",{class:"btn-2",onClick:F,disabled:a.value},w(n.value?"Upload Photo":"Change Photo"),9,J)]),e("input",{type:"file",ref_key:"fileInput",ref:u,class:"hidden",onChange:y},null,544),e("button",{onClick:g,class:"absolute top-2 right-2 text-red-500 text-xl"},o[1]||(o[1]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):M("",!0)}},Q={class:"my-container max-w-xl"},W={class:"card-bg p-4 md:p-8 flex flex-col items-center relative"},X={class:"flex justify-center w-full"},Y=["src"],Z={key:0,class:"space-y-4"},ee={class:"title-md text-center"},te={key:1},le={class:"flex gap-2 items-center"},se={class:"flex gap-2 items-center"},ae={class:"flex gap-2 items-center"},oe={class:"flex gap-2 items-center"},ue={__name:"ProfileView",setup(V){const m=T(),s=l({}),u=l(!1),n=l(""),a=l(""),d=l(""),i=l(""),c=l(!1),p=l(null),g=l(null),y=l(!1),k=l(!1),F=()=>{p.value=s.value.photo,c.value=!0},_=()=>{c.value=!1,g.value=null},v=()=>{u.value=!0,n.value=s.value.name,a.value=s.value.phone,d.value=s.value.date_of_birth,i.value=s.value.address},o=()=>{u.value=!1},S=async()=>{const r={name:n.value,phone:a.value,date_of_birth:d.value,address:i.value};await m.updateProfile(r),u.value=!1,await x()},x=async()=>{await m.fetchUser(),s.value=m.user};O(async()=>{await x()});const j=r=>{g.value=r},$=async()=>{if(!g.value)return;const r=new FormData;r.append("photo",g.value),r.append("user_id",s.value.id);try{y.value=!0,await m.uploadPhoto(r),await x(),k.value=!0,setTimeout(()=>{_(),y.value=!1,k.value=!1},1500)}catch(t){console.error("Failed to upload photo:",t)}finally{y.value=!1}};return(r,t)=>{const B=R("RouterLink");return b(),h(A,null,[e("div",Q,[e("div",W,[t[15]||(t[15]=e("h1",{class:"title-lg"},"My Profile",-1)),e("div",{onClick:F,class:"bg-gray-200 size-40 rounded-full overflow-hidden relative"},[e("div",X,[e("img",{class:"object-cover",src:s.value.photo,alt:"Profile Photo"},null,8,Y)])]),u.value?(b(),h("div",te,[t[14]||(t[14]=e("h1",{class:"text-center title-md"},"Edit Profile",-1)),e("form",{onSubmit:N(S,["prevent"]),class:"space-y-2"},[e("div",le,[t[9]||(t[9]=e("label",{for:"name"},"Name:",-1)),U(e("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=f=>n.value=f),type:"text",class:"input-1"},null,512),[[C,n.value]])]),e("div",se,[t[10]||(t[10]=e("label",{for:"phone"},"Phone:",-1)),U(e("input",{id:"phone","onUpdate:modelValue":t[1]||(t[1]=f=>a.value=f),type:"text",class:"input-1"},null,512),[[C,a.value]])]),e("div",ae,[t[11]||(t[11]=e("label",{for:"date_of_birth"},"Date of Birth:",-1)),U(e("input",{id:"date_of_birth","onUpdate:modelValue":t[2]||(t[2]=f=>d.value=f),type:"date",class:"input-1"},null,512),[[C,d.value]])]),e("div",oe,[t[12]||(t[12]=e("label",{for:"address"},"Address:",-1)),U(e("input",{id:"address","onUpdate:modelValue":t[3]||(t[3]=f=>i.value=f),type:"text",class:"input-1"},null,512),[[C,i.value]])]),e("div",{class:"flex justify-center gap-4"},[e("button",{class:"btn-3",onClick:o},"Cancel"),t[13]||(t[13]=e("button",{class:"btn-2",type:"submit"},"Update",-1))])],32)])):(b(),h("div",Z,[e("p",ee,w(s.value.name),1),e("p",null,[t[4]||(t[4]=e("strong",null,"Phone:",-1)),P(" "+w(s.value.phone),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"Date of Birth:",-1)),P(" "+w(s.value.date_of_birth),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"Address:",-1)),P(" "+w(s.value.address),1)]),e("button",{class:"btn-2 absolute top-4 right-4",onClick:v},t[7]||(t[7]=[e("i",{class:"far fa-edit"},null,-1),P("Edit ")])),D(B,{class:"btn-2",to:"/profile/change-password"},{default:I(()=>t[8]||(t[8]=[P(" Change Password ")])),_:1})]))])]),D(K,{imageSrc:p.value,isOpen:c.value,onClose:_,onFileSelected:j,onUploadPhoto:$},null,8,["imageSrc","isOpen"])],64)}}};export{ue as default};
