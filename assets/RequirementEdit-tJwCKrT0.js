import{r as g,e as z,n as B,c as _,o as c,a as s,f as D,g as y,w,F as E,x as m,k as u,i as C,j as S,s as T,t as I,b as U,u as j}from"./index-B86yBwLa.js";import{_ as F}from"./CompanyDepartmentSelectInput-Bbwd2kMl.js";import{R as N}from"./RequiredIcon-sQvydGOp.js";import{f as A,u as L}from"./requirement-TuEzh0J_.js";import{u as M}from"./company-CB0_S1Tc.js";import{u as R}from"./tags-C_o9OZSU.js";import{L as W}from"./LoaderView-DPgzfdzS.js";import{S as G}from"./SelectDropdown-DyegF-qG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"sticky top-0 pt-4 bg-white z-10"},J={class:"mb-4"},K={class:"block text-gray-600 text-sm mb1 font-medium"},O={class:"block text-gray-600 text-sm mb-1 font-medium"},P={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Q={class:"flex items-center justify-between gap-4"},X=["disabled"],Y={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(k,{emit:f}){const d=k,p=f,i=R(),x=M(),a=g(""),V=g(),v=g(""),$=g(),r=g({from_department_id:"",to_department_id:"",website_tags:[]});z(async()=>{var t;a.value="loading",i.fetchTags("website"),await x.fetchCompanies({with:"departments",ignore_permission:!0}),V.value=(t=(await A(d.requirementId)).data)==null?void 0:t.requirement,a.value=""}),B(V,function(t){var e;t&&(r.value.from_department_id=t.from_department_id,r.value.to_department_id=t.to_department_id,Array.isArray(t==null?void 0:t.website_tags)&&((e=t.website_tags)==null?void 0:e.length)>0&&(r.value.website_tags=t.website_tags.map(l=>l.name)))});async function q(){var e,l,b,n;a.value="submitting";const t={...r.value};console.log({payload:t});try{const o=await L(d.requirementId,t);p("update",o),a.value="created",v.value=(e=o==null?void 0:o.data)==null?void 0:e.message}catch(o){p("error",(l=o==null?void 0:o.response)==null?void 0:l.data),v.value=(n=(b=o==null?void 0:o.response)==null?void 0:b.data)==null?void 0:n.message,a.value="error"}}return(t,e)=>{var l,b;return c(),_("div",{ref_key:"containerRef",ref:$,class:"max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[s("div",H,[e[5]||(e[5]=s("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[6]||(e[6]=s("hr",{class:"mb-4"},null,-1)),s("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=w(n=>p("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),s("form",{onSubmit:w(q,["prevent"]),class:"z-0"},[a.value!=="loading"&&a.value!=="submitting"?(c(),_(E,{key:0},[s("div",J,[e[7]||(e[7]=s("label",{class:"text-gray-800"},"Websites",-1)),m(G,{options:u(i).tags,modelValue:r.value.website_tags,"onUpdate:modelValue":e[1]||(e[1]=n=>r.value.website_tags=n),taggable:"",label:"name",value:"name"},null,8,["options","modelValue"])]),m(F,{modelValue:r.value.from_department_id,"onUpdate:modelValue":e[2]||(e[2]=n=>r.value.from_department_id=n),companies:((l=u(x))==null?void 0:l.companies)||[],class:"mb-4"},{label:C(()=>[s("label",K,[e[8]||(e[8]=S(" From Department ")),m(N)])]),_:1},8,["modelValue","companies"]),m(F,{modelValue:r.value.to_department_id,"onUpdate:modelValue":e[3]||(e[3]=n=>r.value.to_department_id=n),companies:((b=u(x))==null?void 0:b.companies)||[],class:"mb-4"},{label:C(()=>[s("label",O,[e[9]||(e[9]=S(" To Department ")),m(N)])]),_:1},8,["modelValue","companies"])],64)):y("",!0),s("div",P,[v.value?(c(),_("div",{key:0,class:T(["mb-4 font-medium text-center",{"text-red-500":a.value=="error","text-green-500":a.value=="created"}])},I(v.value),3)):y("",!0),s("div",Q,[s("button",{type:"button",onClick:e[4]||(e[4]=w(n=>p("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),s("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},I(a.value=="submitting"?"Saving...":"Save"),9,X)])])],32),a.value==="loading"||a.value==="submitting"?(c(),D(W,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):y("",!0)],512)}}},Z={class:"container mx-auto p-6"},le={__name:"RequirementEdit",setup(k){const f=U(),d=j();return(p,i)=>(c(),_("div",Z,[m(Y,{requirementId:u(f).params.id,onUpdate:i[0]||(i[0]=()=>u(d).back()),onCancelClick:i[1]||(i[1]=()=>u(d).back())},null,8,["requirementId"])]))}};export{le as default};
