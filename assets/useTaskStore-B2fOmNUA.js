import{Q as E,r as v,y as f,R as i}from"./index-BwlsWjXD.js";const O=E("task",()=>{const o=v([]),k=v(null),u=v(!1),c=v(null),p=async(e,r)=>{var a,t;u.value=!0,c.value=null;try{await i.post(`/tasks/${e}/assign-users`,{user_ids:r}),await y(e)}catch(l){throw c.value=((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.message)||"Assign users failed",l}finally{u.value=!1}},T=async(e,{loadingBeforeFetch:r=!0})=>{var a,t,l;r&&(u.value=!0),c.value=null;try{const s=await i.get("/tasks",{params:e});o.value=((a=s.data)==null?void 0:a.tasks)||[]}catch(s){c.value=((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",s)}finally{u.value=!1}};function g(e,r=0){return Array.isArray(e)===!1||e.length===0?[]:e.filter(a=>a.parent_id===r).map(a=>({...a,children_tasks:g(e,a.id)}))}function h(){return g(o.value,0)}function w(){const e=[],r=(a,t=0,l="")=>{a.forEach(s=>{e.push({...s,depth:t,idPath:l+s.id}),s.children_tasks&&s.children_tasks.length&&r(s.children_tasks,t+1,l+s.id+"-")})};return r(h()),e}const y=async(e,r={},a={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,l,s;a.fetchOnly||(u.value=!0),c.value=null;try{const n=await i.get(`/tasks/${e}`,{params:r});return a.fetchOnly||(k.value=((t=n.data)==null?void 0:t.task)||{}),n.data}catch(n){const d=((s=(l=n.response)==null?void 0:l.data)==null?void 0:s.message)||`টাস্ক (ID: ${e}) লোড করতে ব্যর্থ হয়েছে।`;return a.fetchOnly||(c.value=d),d}finally{a.fetchOnly||(u.value=!1)}},m=async(e,r={loadingBeforeCreate:!1})=>{var a,t,l,s;r.loadingBeforeCreate&&(u.value=!0),c.value=null;try{const n=await i.post("/tasks",e);return(a=n.data)!=null&&a.data&&o.value.push((t=n.data)==null?void 0:t.data),n.data.data}catch(n){c.value=((s=(l=n.response)==null?void 0:l.data)==null?void 0:s.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",n)}finally{r.loadingBeforeCreate&&(u.value=!1)}},$=async(e,r,a={loadingBeforeFetch:!0})=>{var t,l;a.loadingBeforeFetch&&(u.value=!0),c.value=null;try{const s=await i.put(`/tasks/${e}`,r),n=o.value.findIndex(d=>d.id===e);return n!==-1&&(o.value[n]=s.data.data),s.data.data}catch(s){c.value=((l=(t=s.response)==null?void 0:t.data)==null?void 0:l.message)||`টাস্ক (ID: ${e}) আপডেট করতে ব্যর্থ হয়েছে।`,console.error(`Error updating task with id ${e}:`,s)}finally{a.loadingBeforeFetch&&(u.value=!1)}},B=async(e,r)=>(await i.put(`/tasks/${e}/update-priorities`,{task_ids:r})).data,_=async e=>{var r,a;u.value=!0,c.value=null;try{await i.delete(`/tasks/${e}`),o.value=o.value.filter(t=>t.id!==e)}catch(t){c.value=((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.message)||`টাস্ক (ID: ${e}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${e}:`,t)}finally{u.value=!1}};return{tasks:f(()=>o.value),task:f(()=>k.value),loading:f(()=>u.value),error:f(()=>c.value),taskListTree:f(h),flattenedTasks:f(w),fetchTasks:T,fetchTask:y,createTask:m,updateTask:$,deleteTask:_,assignUsers:p,updateTaskPriorities:B}});export{O as u};
