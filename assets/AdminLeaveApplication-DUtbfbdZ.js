import{d as me,r as x,m as N,a4 as de,z as Y,e as ie,c as i,o as r,a as e,f as z,w as ce,g as L,h,v as V,K as _e,t as v,F as T,q as j,k as g,a5 as W,p as M,B as ve,u as fe,b as ge,s as be,n as xe,j as D,i as ue,a6 as he}from"./index-B6GCABiU.js";import{L as ye}from"./LoaderView-dTwLNxmq.js";import{_ as we}from"./MultiselectDropdown-DaNHUTHd.js";import{u as ke}from"./holiday-C2AMmQAz.js";import{u as pe}from"./leave-application-HrhzYFSW.js";import{u as Le}from"./leave-type-SeHFIxga.js";import{u as P}from"./user-CqjAO5pC.js";import{_ as $e}from"./EmployeeFilter-BSWb0k01.js";import{u as Se}from"./company-BLMFFVX-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./department-88lK8An6.js";const Ae={class:"space-y-4 p-2 md:p-4"},Ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De={class:"inline-flex items-center space-x-2"},Ce={key:0},Ve={class:"text-blue-600 font-medium"},Te={key:1,class:"bg-gray-100 p-2 rounded-md"},qe={class:"font-semibold"},Be={class:"flex flex-wrap gap-2"},Me=["name","value","onUpdate:modelValue"],je={class:"flex items-center space-x-1"},Fe=["name","onUpdate:modelValue"],Re={class:"flex items-center space-x-1"},Ie=["name","onUpdate:modelValue"],Ne={key:2},Ee={key:3},He={key:4,class:"text-red-500 text-sm"},We={__name:"AdminLeaveApplicationAddForm",props:{userInfo:Object},emits:["close","formSuccessClosed"],setup(C,{emit:q}){const n=C,w=q,b=pe(),S=Le(),k=P();me();const A=ke(),U=x(""),$=x(!0),o=x({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),a=x([]),_=x(!1),c=x(null),B=N(()=>{var p,s,u;return((s=(p=n==null?void 0:n.userInfo)==null?void 0:p.assign_weekend)==null?void 0:s.weekends)||((u=n==null?void 0:n.userInfo)==null?void 0:u.weekends)}),y=N(()=>{const p=o.value.last_working_date,s=o.value.resumption_date;if(!p||!s)return[];const u=new Date(p),m=new Date(s);if(m<=u)return[];const f=[];let d=new Date(u);for(d.setDate(d.getDate()+1);d<m;){const t=d.getFullYear(),F=(d.getMonth()+1).toString().padStart(2,"0"),R=d.getDate().toString().padStart(2,"0");f.push(`${t}-${F}-${R}`),d.setDate(d.getDate()+1)}return f}),E=N(()=>{if(!o.value.last_working_date||!o.value.resumption_date)return"";const p=new Date(o.value.last_working_date);return new Date(o.value.resumption_date)<=p?"Resumption date must be after Last Working Date.":y.value.length===0?"No leave days between the selected dates.":`Total leave days: ${y.value.length}`});de(async()=>{var p;y.value.length&&S.leaveTypes.length&&(a.value.length!==y.value.length&&(a.value=y.value.map(()=>S.leaveTypes[0].id)),await A.fetchHolidays({company_id:(p=n==null?void 0:n.userInfo)==null?void 0:p.company_id,start_date:y.value[0],end_date:y.value[y.value.length-1]}),y.value.forEach(async(s,u)=>{const m=new Date(s).toLocaleString("en-us",{weekday:"long"}).toLowerCase(),f=m.charAt(0).toUpperCase()+m.slice(1);B.value.includes(f)&&(a.value[u]="weekend"),A.holidayDates.includes(s)&&(a.value[u]="holiday")}))}),Y(()=>U.value,p=>{o.value.handover_user_id=p==null?void 0:p.id});const H=async()=>{var p;_.value=!0,c.value=null;try{const s=y.value.map((d,t)=>({date:d,leave_type_id:a.value[t]!=="weekend"&&a.value[t]!=="holiday"?a.value[t]:null})).filter(d=>d.leave_type_id!==null),u=y.value.map((d,t)=>({date:d,leave_type_id:a.value[t]||""})).filter(d=>d.leave_type_id!==null),m={user_id:(p=n==null?void 0:n.userInfo)==null?void 0:p.id,last_working_date:o.value.last_working_date,resumption_date:o.value.resumption_date,reason:o.value.reason,works_in_hand:o.value.works_in_hand,handover_user_id:$.value?null:o.value.handover_user_id,leave_days:s,json_data:u,is_direct_approve:$.value};await b.storeAdminLeaveApplication(m)&&w("formSuccessClosed")}catch(s){c.value=s.message||"Failed to submit leave application"}finally{_.value=!1}};return ie(async()=>{de(()=>{var s;const p=(s=n==null?void 0:n.userInfo)==null?void 0:s.company_id;p&&S.fetchLeaveTypes(p)}),await k.fetchTypeWiseEmployees({except:"auth"})}),(p,s)=>(r(),i("div",Ae,[s[16]||(s[16]=e("div",{class:"flex items-center justify-between gap-2"},[e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form"),e("div")],-1)),_.value?(r(),z(ye,{key:0})):(r(),i("form",{key:1,onSubmit:ce(H,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[e("div",Ue,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium"},"Last Working Date",-1)),h(e("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=u=>o.value.last_working_date=u),class:"input-1 w-full",required:""},null,512),[[V,o.value.last_working_date]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium"},"Resumption Date",-1)),h(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=u=>o.value.resumption_date=u),class:"input-1 w-full",required:""},null,512),[[V,o.value.resumption_date]])])]),e("div",null,[e("label",De,[h(e("input",{type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=u=>$.value=u),class:"form-checkbox text-blue-600"},null,512),[[_e,$.value]]),s[8]||(s[8]=e("span",{class:"text-lg font-sem"},"Direct Approve",-1))])]),o.value.last_working_date&&o.value.resumption_date?(r(),i("div",Ce,[e("p",Ve,v(E.value),1)])):L("",!0),y.value.length?(r(),i("div",Te,[s[11]||(s[11]=e("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),e("div",null,[(r(!0),i(T,null,j(y.value,(u,m)=>(r(),i("div",{key:m,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[e("div",qe,v(u),1),e("div",Be,[(r(!0),i(T,null,j(g(S).leaveTypes,f=>(r(),i("label",{key:f.id,class:"flex items-center space-x-1"},[h(e("input",{type:"radio",name:"leaveType-"+m,value:f.id,"onUpdate:modelValue":d=>a.value[m]=d},null,8,Me),[[W,a.value[m]]]),e("span",null,v(f.name),1)]))),128)),e("label",je,[h(e("input",{type:"radio",name:"leaveType-"+m,value:"weekend","onUpdate:modelValue":f=>a.value[m]=f},null,8,Fe),[[W,a.value[m]]]),s[9]||(s[9]=e("span",null,"Weekend",-1))]),e("label",Re,[h(e("input",{type:"radio",name:"leaveType-"+m,value:"holiday","onUpdate:modelValue":f=>a.value[m]=f},null,8,Ie),[[W,a.value[m]]]),s[10]||(s[10]=e("span",null,"Holiday",-1))])])]))),128))])])):L("",!0),e("div",null,[s[12]||(s[12]=e("label",{class:"block text-sm font-medium"},"Reason",-1)),h(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=u=>o.value.reason=u),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[V,o.value.reason]])]),$.value?L("",!0):(r(),i("div",Ne,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium"},"Handover User",-1)),M(we,{modelValue:U.value,"onUpdate:modelValue":s[4]||(s[4]=u=>U.value=u),options:g(k).users,multiple:!1,label:"label",placeholder:"Select user",class:"z-50"},null,8,["modelValue","options"])])),$.value?L("",!0):(r(),i("div",Ee,[s[14]||(s[14]=e("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),h(e("textarea",{id:"works-in-hand","onUpdate:modelValue":s[5]||(s[5]=u=>o.value.works_in_hand=u),class:"input-1 w-full",placeholder:"Enter details of works in hand",rows:"6"},null,512),[[V,o.value.works_in_hand]])])),c.value?(r(),i("div",He,v(c.value),1)):L("",!0),s[15]||(s[15]=e("div",{class:"flex justify-end"},[e("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}},Ye={key:0,class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},ze={class:"bg-white rounded-lg shadow-lg w-full max-w-3xl"},Pe={class:"px-6 py-4 border-b"},Oe={class:"text-lg font-bold"},Je={class:"table-auto w-full border"},Ge={class:"p-2"},Ke=["onUpdate:modelValue"],Qe={class:"p-2"},Xe=["onUpdate:modelValue"],Ze={class:"p-2"},et=["onUpdate:modelValue"],tt={class:"p-2"},st=["onUpdate:modelValue"],lt={__name:"UserLeaveBalanceModal",props:{show:{type:Boolean,required:!0},user:{type:Object,required:!0}},emits:["close"],setup(C,{emit:q}){const n=C,w=q,b=Se(),S=P(),k=x([]),A=x(!1);Y(()=>n.show,async a=>{var _;a&&((_=n.user)!=null&&_.id)&&!A.value&&(await U(),A.value=!0)}),Y(()=>{var a;return(a=n.user)==null?void 0:a.id},()=>{A.value=!1,k.value=[]});const U=async()=>{try{const a=await S.fetchUserLeaveBalances(n.user.id);if(console.log(a),a!=null&&a.length)k.value=a;else{const _=await b.fetchCompanyLeaveTypes(n.user.company_id);k.value=_.data.map(c=>({name:c.name,annual_quota:c.annual_quota||0,max_consecutive_days:c.max_consecutive_days||null,type:c.type||"Paid"}))}}catch(a){console.error("Failed to load leave balances or fallback types:",a)}},$=async()=>{try{await S.saveLeaveBalances(n.user.id,k.value),w("close")}catch(a){console.error("Failed to save leave balances:",a)}},o=()=>{w("close")};return(a,_)=>C.show&&C.user?(r(),i("div",Ye,[e("div",ze,[e("div",Pe,[e("h3",Oe,"Set Leave Balances for "+v(C.user.name),1)]),e("form",{onSubmit:ce($,["prevent"]),class:"p-6 space-y-4"},[e("table",Je,[_[1]||(_[1]=e("thead",{class:"bg-gray-100 text-left"},[e("tr",null,[e("th",{class:"p-2"},"Leave Type"),e("th",{class:"p-2"},"Annual Quota"),e("th",{class:"p-2"},"Max Consecutive Days"),e("th",{class:"p-2"},"Category")])],-1)),e("tbody",null,[(r(!0),i(T,null,j(k.value,(c,B)=>(r(),i("tr",{key:B},[e("td",Ge,[h(e("input",{"onUpdate:modelValue":y=>c.name=y,class:"input-1 w-full"},null,8,Ke),[[V,c.name]])]),e("td",Qe,[h(e("input",{"onUpdate:modelValue":y=>c.annual_quota=y,type:"number",min:"0",class:"input-1 w-full"},null,8,Xe),[[V,c.annual_quota,void 0,{number:!0}]])]),e("td",Ze,[h(e("input",{"onUpdate:modelValue":y=>c.max_consecutive_days=y,type:"number",min:"0",class:"input-1 w-full"},null,8,et),[[V,c.max_consecutive_days,void 0,{number:!0}]])]),e("td",tt,[h(e("select",{"onUpdate:modelValue":y=>c.type=y,class:"input-1 w-full"},_[0]||(_[0]=[e("option",{value:"Paid"},"Paid",-1),e("option",{value:"Unpaid"},"Unpaid",-1)]),8,st),[[ve,c.type]])])]))),128))])]),e("div",{class:"flex justify-end gap-2 pt-4 border-t"},[e("button",{type:"button",onClick:o,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancel "),_[2]||(_[2]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"}," Save ",-1))])],32)])])):L("",!0)}},at={class:"space-y-2 px-4"},ot={class:"flex flex-wrap gap-2"},nt=["value"],rt={key:0,class:"text-center py-4"},dt={key:1,class:"space-y-4"},ut={key:0,class:"bg-sky-100/30 p-4 rounded-lg shadow mb-6 space-y-6"},it={class:"grid md:grid-cols-2 gap-6"},ct={class:"bg-white border rounded-lg p-4 shadow"},vt={class:"grid grid-cols-1 sm:grid-cols-2 gap-y-2 text-sm text-gray-600"},yt={class:"bg-white border rounded-lg p-4 shadow"},pt={class:"overflow-x-auto"},mt={class:"min-w-full text-sm text-left text-gray-700 border"},_t={class:"px-4 py-1 text-center font-medium"},ft={class:"px-4 py-1 text-center"},gt={class:"px-4 py-1 text-center"},bt={class:"px-4 py-1 text-center"},xt={class:"overflow-x-auto"},ht={class:"min-w-full table-auto border-collapse border border-gray-200 bg-white rounded-md text-sm"},wt={class:"border border-gray-300 px-2 py-2"},kt={class:"border border-gray-300 px-2 py-2 text-center"},Lt={class:"border border-gray-300 px-2 py-2 text-center"},$t={class:"border border-gray-300 px-2 py-2"},St={class:"border border-gray-300 px-2 py-2"},At=["innerHTML"],Ut={class:"border border-gray-300 px-2 py-2 text-center"},Dt={class:"border border-gray-300 px-2 py-2"},Ct={class:"border border-gray-300 px-2"},Vt={class:"flex justify-center gap-2"},Tt=["onClick"],qt={key:0},Bt={key:0},Mt={class:"text-center py-2",colspan:"6"},jt={key:0,class:"fixed inset-0 z-[1000] bg-black bg-opacity-50 flex items-center justify-center"},Ft={class:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto shadow-lg p-4 relative"},Gt={__name:"AdminLeaveApplication",setup(C){const q=fe(),n=ge(),w=pe();P();const{user:b,leave_balances:S,leaveApplications:k,loading:A}=be(w),U=x(n.query.year||w.selectedYear),$=x(n.query.search||""),o=x({company_id:n.query.company_id||"",department_id:n.query.department_id||"all",type:n.query.type||"all",employee_id:n.query.employee_id||""}),a=x(!1),_=x(!1),c=async()=>{const d={selectedYear:U.value,selectedStatus:w.selectedStatus,query:$.value};o.value.employee_id?(d.user_id=o.value.employee_id,A.value=!0,await w.fetchYearlyUserLeaveApplications(d),A.value=!1):k.value=[]};ie(async()=>{await c()});const B=N(()=>k.value||[]),y=()=>q.go(-1),E=async()=>{q.replace({query:{...n.query,company_id:o.value.company_id,department_id:o.value.department_id,type:o.value.type,employee_id:o.value.employee_id}}),await c()},H=()=>{_.value=!0},p=async()=>{console.log("test close"),a.value=!1,await c()},s=new Date().getFullYear(),u=x([]);for(let d=2023;d<=s;d++)u.value.push(d);const m=async d=>{confirm("Are you sure to delete this application?")&&(await w.deleteLeaveApplication(d),await c())},f=()=>{_.value=!1};return(d,t)=>{var R,O,J,G,K,Q,X,Z,ee,te,se,le,ae;const F=xe("RouterLink");return r(),i(T,null,[e("div",at,[e("div",{class:"flex items-center justify-between gap-2"},[e("button",{class:"btn-3",onClick:y},t[5]||(t[5]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),t[6]||(t[6]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Applications",-1)),t[7]||(t[7]=e("div",null,null,-1))]),e("div",ot,[M($e,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value=l),"initial-value":g(n).query,onFilterChange:E},null,8,["modelValue","initial-value"]),e("div",null,[h(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>U.value=l),onChange:c,class:"input-1"},[(r(!0),i(T,null,j(u.value,l=>(r(),i("option",{key:l,value:l},v(l),9,nt))),128))],544),[[ve,U.value]])])]),g(w).loading?(r(),i("div",rt,[M(ye)])):(r(),i("div",dt,[(R=o.value)!=null&&R.employee_id?(r(),i("div",ut,[t[19]||(t[19]=e("h2",{class:"text-xl font-bold text-gray-800 text-center"},"Employee Overview",-1)),e("div",it,[e("div",ct,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"User Info",-1)),e("div",vt,[e("p",null,[t[8]||(t[8]=e("strong",null,"Name:",-1)),D(" "+v((O=g(b))==null?void 0:O.name),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"Designation:",-1)),D(" "+v((G=(J=g(b))==null?void 0:J.designation)==null?void 0:G.title),1)]),e("p",null,[t[10]||(t[10]=e("strong",null,"Department:",-1)),D(" "+v((Q=(K=g(b))==null?void 0:K.department)==null?void 0:Q.name),1)]),e("p",null,[t[11]||(t[11]=e("strong",null,"Company:",-1)),D(" "+v((Z=(X=g(b))==null?void 0:X.company)==null?void 0:Z.name),1)]),e("p",null,[t[12]||(t[12]=e("strong",null,"Phone:",-1)),D(" "+v((ee=g(b))==null?void 0:ee.phone),1)]),e("p",null,[t[13]||(t[13]=e("strong",null,"Email:",-1)),D(" "+v((te=g(b))==null?void 0:te.email),1)]),e("p",null,[t[14]||(t[14]=e("strong",null,"Joining Date:",-1)),D(" "+v((se=g(b))==null?void 0:se.joining_date),1)]),e("p",null,[t[15]||(t[15]=e("strong",null,"Blood Group:",-1)),D(" "+v(((le=g(b))==null?void 0:le.blood)||"N/A"),1)])])]),e("div",yt,[e("div",{class:"flex justify-between items-center"},[t[17]||(t[17]=e("h3",{class:"text-lg font-semibold text-gray-700 mb-4"},"Leave Balance",-1)),e("button",{onClick:H,type:"button",class:"btn-2"},"Set Leave Balance")]),e("div",pt,[e("table",mt,[t[18]||(t[18]=e("thead",{class:"bg-gray-100 text-xs uppercase"},[e("tr",null,[e("th",{class:"px-4 py-2 text-center"},"Type"),e("th",{class:"px-4 py-2 text-center"},"Total"),e("th",{class:"px-4 py-2 text-center"},"Used"),e("th",{class:"px-4 py-2 text-center"},"Remaining")])],-1)),e("tbody",null,[(r(!0),i(T,null,j(g(S),l=>(r(),i("tr",{key:l.id,class:"border-t hover:bg-gray-50"},[e("td",_t,v(l.leave_type),1),e("td",ft,v(l.total_leave_days),1),e("td",gt,v(l.used_days),1),e("td",bt,v(l.remaining_days),1)]))),128))])])])])])])):L("",!0),e("div",xt,[e("table",ht,[t[24]||(t[24]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"#"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Last Working Day"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Resumption Date"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Period"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Total Days"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Leave Type"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Status"),e("th",{class:"border border-gray-300 px-2 py-1 text-center"},"Action")])],-1)),e("tbody",null,[(r(!0),i(T,null,j(B.value,(l,oe)=>{var ne;return r(),i("tr",{key:oe,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",wt,v(oe+1),1),e("td",kt,v(l==null?void 0:l.last_working_date),1),e("td",Lt,v(l==null?void 0:l.resumption_date),1),e("td",$t,v(l==null?void 0:l.leave_period),1),e("td",St,[e("div",{innerHTML:(l==null?void 0:l.duration)||(l==null?void 0:l.total_leave_days)},null,8,At)]),e("td",Ut,v([...new Set((ne=l==null?void 0:l.leave_days)==null?void 0:ne.map(I=>{var re;return(re=I==null?void 0:I.leave_type)==null?void 0:re.name}))].join(",")),1),e("td",Dt,v((l==null?void 0:l.status)||"N/A"),1),e("td",Ct,[e("div",Vt,[M(F,{to:{name:"LeaveApplicationShow",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:ue(()=>t[20]||(t[20]=[e("i",{class:"far fa-eye"},null,-1)])),_:2,__:[20]},1032,["to"]),["Approved","Rejected"].includes(l==null?void 0:l.status)?L("",!0):(r(),z(F,{key:0,to:{name:"LeaveApplicationEdit",params:{id:l==null?void 0:l.id}},class:"btn-icon",target:"_blank"},{default:ue(()=>t[21]||(t[21]=[e("i",{class:"far fa-edit text-orange-600"},null,-1)])),_:2,__:[21]},1032,["to"])),e("button",{onClick:I=>m(l==null?void 0:l.id),class:"btn-icon text-red-500"},t[22]||(t[22]=[e("i",{class:"far fa-trash"},null,-1)]),8,Tt)])])])}),128)),B.value.length?L("",!0):(r(),i("tr",qt,t[23]||(t[23]=[e("td",{colspan:"7",class:"p-1 text-center text-red-500"},"No application found",-1)])))]),e("tfoot",null,[(ae=o.value)!=null&&ae.employee_id?(r(),i("tr",Bt,[e("th",Mt,[e("button",{onClick:t[2]||(t[2]=l=>a.value=!0),class:"text-white font-semibold px-4 py-2 rounded-lg shadow-md bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 transition"}," + Add Application ")])])):L("",!0)])])])]))]),M(lt,{show:_.value,user:g(b),onClose:f},null,8,["show","user"]),(r(),z(he,{to:"body"},[a.value?(r(),i("div",jt,[e("div",Ft,[e("button",{class:"absolute top-2 right-2 text-gray-500 hover:text-red-500 text-xl font-bold",onClick:t[3]||(t[3]=l=>a.value=!1)}," × "),M(We,{userInfo:g(b),onClose:t[4]||(t[4]=l=>a.value=!1),onFormSuccessClosed:p},null,8,["userInfo"])])])):L("",!0)]))],64)}}};export{Gt as default};
