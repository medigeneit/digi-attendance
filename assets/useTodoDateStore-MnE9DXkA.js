import{o as m}from"./url-Buz9GlSr.js";import{C as l,B as F,r as p,x as T}from"./index-B51W9D4O.js";async function E(s,{params:t={}}={}){return l.get(`/todos/${s}/settings`,{params:t})}async function G(s,t){return l.post(`/todos/${s}/settings`,t)}async function I(s,t,{params:i={}}={}){const u=m(i);return l.delete(`/todos/${s}/settings/${t}${u?`?${u}`:""}`)}async function H({params:s={}}={}){return l.get("/todo-dates",{params:s})}async function L(s){return l.post("/todo-dates",s)}async function N(s,t){return l.get(`/todo-dates/${s}`,t)}async function J(s,{params:t={}}={}){return l.get(`/todos/${s}/histories`,{params:t})}async function P(s,t){return l.patch(`/my-todo-dates/${s}/status`,t)}async function Q(s,{params:t={}}={}){const i=m(t);return l.delete(`/todo-dates/${s}${i?"?"+i:""}`)}const K=F("todo-date",()=>{const s=p(null),t=p(!1),i=p(!1),u=p(null),d=p([]),w=()=>s.value=[],$=async o=>{var a,n,r;t.value=!0,u.value=null;try{const e=await H({params:o});d.value=((a=e.data)==null?void 0:a.todo_dates)||[],v()}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"TodoDates load failed",e}finally{t.value=!1}};function v(){d.value=[...d.value.sort((o,a)=>(o==null?void 0:o.user_id)!==(a==null?void 0:a.user_id)?(o==null?void 0:o.user_id)-(a==null?void 0:a.user_id):o.priority!==a.priority?o.priority-a.priority:a.id-o.id)]}const _=async o=>{var a,n,r;t.value=!0,u.value=null;try{const e=await l.get("/my-todo-dates",{params:o});d.value=((a=e.data)==null?void 0:a.todo_dates)||[],v()}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"TodoDates load failed",e}finally{t.value=!1}},S=o=>{var a;return(a=d.value)==null?void 0:a.filter(n=>n.date==o)},q=async o=>{var a,n;t.value=!0,u.value=null;try{const r=await N(o);s.value=r.data.todo_date}catch(r){throw u.value=((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Todo load failed",r}finally{t.value=!1}},x=async o=>{var a,n,r;t.value=!0,u.value=null;try{const e=await L(o);return d.value=[...d.value,(a=e.data)==null?void 0:a.todo_date],v(),e.data}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo create failed",e}finally{t.value=!1}},C=o=>{d.value=[...d.value,o],v()},D=async(o,a)=>{var n,r;t.value=!0,u.value=null;try{const e=await D(o,a);return d.value=d.value.map(c=>{var h,f,y,g;return c.id==((f=(h=e.data)==null?void 0:h.todo)==null?void 0:f.id)?c.user?{...(y=e.data)==null?void 0:y.todo,user:{...c.user}}:{...(g=e.data)==null?void 0:g.todo}:{...c}}),e.data}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo update failed",e}finally{t.value=!1}},M=async(o,a)=>{var n,r;t.value=!0,u.value=null;try{await P(o,{status:a}),d.value=d.value.map(e=>e.id===o?{...e,status:a}:{...e})}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to update todo status",e}finally{t.value=!1}},b=async(o,{date:a}={})=>{var n,r;t.value=!0,i.value=!0,u.value=null;try{const e=await l.put("/my-todo-dates/rearrange",{ids:o,date:a});d.value=d.value.map(c=>{var y;const f=(((y=e.data)==null?void 0:y.changes)||[]).find(g=>g.id==c.id);return f?{...c,priority:f.priority}:c}),v()}catch(e){throw u.value=((r=(n=e.response)==null?void 0:n.data)==null?void 0:r.message)||"Todo rearranging failed",e}finally{i.value=!0,t.value=!1}};async function j(o){var a,n;t.value=!0,u.value=null;try{await Q(o),d.value=d.value.filter(r=>r.id!==o)}catch(r){throw u.value=((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Todo delete failed",r}finally{t.value=!1}}return{loading:T(()=>t.value),error:T(()=>u.value),todo_dates:T(()=>d.value),todo_date:T(()=>s.value),fetchTodoDates:$,fetchTodoDate:q,createTodoDate:x,updateTodoDate:D,rearrangeMyTodoDates:b,deleteTodoDate:j,fetchMyTodoDates:_,updateStatus:M,getTodoDatesByDate:S,setNewTodoDate:C,emptyTodoDates:w}});export{G as a,I as d,E as f,J as g,K as u};
