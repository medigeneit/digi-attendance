import{d as F,u as L,b as U,r as y,q as w,e as B,c as d,o,a,f as S,k as m,y as D,h as M,v as V,F as $,x as I,t as p,g as R}from"./index-yd3cfJZ9.js";import{_ as E}from"./EmployeeFilter-BeACvKRQ.js";import{L as O}from"./LoaderView-DVwPfBcS.js";import{u as Q,_ as j}from"./UpdateOrCreate-l9SnOKtU.js";import"./company-ufcIxRBl.js";import"./department-BjSyjc-8.js";import"./EmployeeDropdownInput-jpjRr0qr.js";import"./SelectDropdown-Dz1IcDMy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-DuWXzSgM.js";import"./TimePickerAsFloatHour-C9VjF1KE.js";const H={class:"px-4 space-y-4"},J={class:"flex items-center justify-between gap-2"},K={class:"flex flex-wrap gap-4 items-center"},z={key:1},G={class:"table-auto w-full border mt-4 text-sm"},W={class:"p-2"},X={class:"p-2"},Y={class:"p-2"},Z={class:"p-2"},ee={class:"p-2"},te={class:"p-2 text-center flex gap-2"},ae=["onClick"],le={key:2,class:"text-red-500 text-sm text-center"},ne={key:3,class:"text-gray-400 text-sm text-center"},he={__name:"PayCutList",setup(ie){const P=F(),g=L(),s=U(),r=Q(),i=y(s.query.month||new Date().toISOString().slice(0,7)),e=y({company_id:s.query.company_id||"",department_id:s.query.department_id||"",line_type:s.query.line_type||"all",employee_id:s.query.employee_id||""}),c=y(!1);async function _(){if(!i.value||!e.value.company_id){r.paycuts=[];return}const l={month:i.value,company_id:String(e.value.company_id)};e.value.employee_id&&(l.user_id=String(e.value.employee_id)),c.value=!0;try{await r.fetchPaycuts(l)}finally{c.value=!1}}function q(){const l={};return i.value&&(l.month=String(i.value)),e.value.company_id&&(l.company_id=String(e.value.company_id)),e.value.department_id&&(l.department_id=String(e.value.department_id)),e.value.employee_id&&(l.employee_id=String(e.value.employee_id)),e.value.line_type&&e.value.line_type!=="all"&&(l.line_type=String(e.value.line_type)),l}let v=null;function C(){v&&clearTimeout(v),v=setTimeout(()=>{const l=q();g.replace({query:l}).catch(()=>{})},120)}let f=null;const x=y("");async function N(){C();const l=JSON.stringify({m:i.value||"",c:e.value.company_id||"",d:e.value.department_id||"",t:e.value.line_type||"all",e:e.value.employee_id||""});l!==x.value&&(await _(),x.value=l)}function h(){f&&clearTimeout(f),f=setTimeout(N,200)}w(()=>({...e.value,month:i.value}),()=>h(),{deep:!0}),w(()=>s.query,l=>{const t=l.month||"";t!==i.value&&(i.value=t);const n={company_id:l.company_id||"",department_id:l.department_id||"",line_type:l.line_type||"all",employee_id:l.employee_id||""},u=e.value;(n.company_id!==u.company_id||n.department_id!==u.department_id||n.line_type!==u.line_type||n.employee_id!==u.employee_id)&&(e.value=n)}),B(async()=>{h()});function T(){h()}async function A(l){confirm("Are you sure you want to delete this paycut?")&&(await r.deletePaycut(l),await _())}return(l,t)=>(o(),d("div",H,[a("div",J,[a("button",{type:"button",class:"btn-3",onClick:t[0]||(t[0]=n=>m(g).go(-1))},t[6]||(t[6]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden md:flex"},"Back",-1)])),t[7]||(t[7]=a("h1",{class:"title-md md:title-lg text-center"},"Monthly Paycut List",-1)),t[8]||(t[8]=a("div",null,null,-1))]),a("div",K,[D(E,{company_id:e.value.company_id,"onUpdate:company_id":t[1]||(t[1]=n=>e.value.company_id=n),department_id:e.value.department_id,"onUpdate:department_id":t[2]||(t[2]=n=>e.value.department_id=n),employee_id:e.value.employee_id,"onUpdate:employee_id":t[3]||(t[3]=n=>e.value.employee_id=n),line_type:e.value.line_type,"onUpdate:line_type":t[4]||(t[4]=n=>e.value.line_type=n),"with-type":!0,"initial-value":l.$route.query,onFilterChange:T,class:"w-full"},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),a("div",null,[M(a("input",{type:"month","onUpdate:modelValue":t[5]||(t[5]=n=>i.value=n),class:"input-1"},null,512),[[V,i.value]])]),t[9]||(t[9]=a("div",null,null,-1))]),c.value?(o(),S(O,{key:0})):m(r).paycuts.length?(o(),d("div",z,[a("table",G,[t[11]||(t[11]=a("thead",{class:"bg-gray-100 text-left"},[a("tr",null,[a("th",{class:"p-2"},"#"),a("th",{class:"p-2"},"Employee"),a("th",{class:"p-2"},"Paycut Hours"),a("th",{class:"p-2"},"Reason"),a("th",{class:"p-2"},"Note"),a("th",{class:"p-2 text-center"},"Actions")])],-1)),a("tbody",null,[(o(!0),d($,null,I(m(r).paycuts,(n,u)=>{var b,k;return o(),d("tr",{key:n.id,class:"border-t"},[a("td",W,p(u+1),1),a("td",X,p(((b=n.user)==null?void 0:b.name)||"N/A"),1),a("td",Y,p(n.paycut_hours),1),a("td",Z,p(n.reason||"-"),1),a("td",ee,p(n.note||"-"),1),a("td",te,[((k=m(P).user)==null?void 0:k.id)===8?(o(),S(j,{key:0,userId:n.user_id,month:i.value,onUpdated:_},null,8,["userId","month"])):R("",!0),a("button",{type:"button",class:"text-red-500",onClick:oe=>A(n.id)},t[10]||(t[10]=[a("i",{class:"fa fa-trash"},null,-1)]),8,ae)])])}),128))])])])):e.value.company_id?(o(),d("p",ne," No paycuts found for the selected filters. ")):(o(),d("p",le," Please select a company to load paycut data. "))]))}};export{he as default};
