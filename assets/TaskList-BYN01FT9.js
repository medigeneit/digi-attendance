import{_ as Te}from"./CommentModal-Bsb6WXTa.js";import{_ as $e,a as _e}from"./TaskUserAssignForm-ByJKim5x.js";import{L as Ae}from"./LoaderView-_4L6T2p6.js";import{O as se}from"./OverlyModal-CKoVddlj.js";import{_ as Ie}from"./TaskAddForm-C3SemFdQ.js";import{_ as Se}from"./TaskEditForm-DzxgJI8R.js";import{r as U,m as g,c as n,o as s,a as e,h as J,v as me,g as i,w as H,d as ce,b as ae,e as pe,x as te,z as fe,f as L,F as O,q as C,C as re,n as Y,t as _,k as p,i as P,K as le,j as M,p as K,H as Le,u as Ve,s as ie}from"./index-ZNHNxqAm.js";import{_ as Me}from"./MultiselectDropdown-BraSeiUQ.js";import{g as De,u as qe}from"./task-priority-Dri4u9YU.js";import{u as Ee}from"./company-2df1a7yX.js";import{_ as de}from"./CompanyDepartmentSelectInput-tQ3TgWLT.js";import{_ as ye}from"./UserChip-BMFmiH1S.js";import{_ as ke,a as Ue,b as ve,c as ge,T as xe,d as be,e as Be}from"./TaskUrgentBadge-Dz-Td4oW.js";import{b as he,a as ee}from"./datetime-BlGg5F0U.js";import{o as Pe}from"./url-CePbr-gY.js";import{_ as Oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Ne}from"./useTaskStore-Bboywtii.js";import"./useCommentStore-Dxjcd4pr.js";import"./TextWithHr-DJCkKcrI.js";import"./TaskUrgencyInput-DhDIclR3.js";import"./TaskUserChip-Dxy5WINN.js";import"./RequiredIcon-A2Gqw15F.js";import"./useRequirementStore-vGFrOP-_.js";import"./requirement-DjSlF40L.js";import"./SectionLoading-H9zTPdEn.js";import"./tags-C_jGiFpI.js";const je={class:"text-gray-600 relative"},Re={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},ue={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(l,{emit:w}){const u=l,m=U(),T=w,f=y=>{T("update:modelValue",y||void 0)};let I=0;const c=g({get(){return u.modelValue},set(y){clearTimeout(I),I=setTimeout(f,500,y)}});return(y,a)=>(s(),n("div",je,[a[3]||(a[3]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),J(e("input",{ref_key:"searchInput",ref:m,id:"search","onUpdate:modelValue":a[0]||(a[0]=x=>c.value=x),type:"text",class:"!pr-7 w-full rounded-md px-2 py-1 border-2 border-gray-400 placeholder:text-sm focus:outline-gray-400",placeholder:"Search by main task title"},null,512),[[me,c.value]]),e("div",Re,[c.value?(s(),n("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:a[1]||(a[1]=H(()=>{f(""),m.value.focus()},["prevent"]))})):i("",!0),a[2]||(a[2]=e("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},He={class:"mb-3 task-header"},Fe={class:"flex justify-between items-start mb-4"},ze={key:0,class:"ml-auto flex gap-6 items-center"},We={key:0,class:"flex gap-2 items-center"},Ke={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ge={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Je={class:"relative w-full md:w-48 flex-grow"},Ye=["value"],Qe={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Xe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Ze={class:"w-32 relative h-8"},et={class:"flex gap-4 items-center flex-shrink-0"},tt={class:"flex gap-2"},st={class:"flex gap-2"},lt={class:"flex gap-2"},at={class:"text-gray-600 w-full md:w-32 relative"},ot={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6"},nt={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},rt={key:0,class:"text-[9px] text-green-800"},it=["onClick"],dt={key:1,class:"flex justify-end gap-5"},ut={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(l,{emit:w}){const u=l,m=ce(),T=ae(),f=g(o("company-id")),I=g(o("from-department-id")),c=g(o("to-department-id")),y=g(o("user-ids")),a=g(o("month")),x=g(o("status")),$=g(o("is-important")),h=g(o("is-urgent")),N=g(o("is-target")),j=g(o("search")),W=w,q=Ee(),v=U([]);function o(b){return{get:()=>u.modelValue[b]||"",set:t=>{W("update:modelValue",{...u.modelValue,[b]:t||void 0})}}}const B=g(()=>G(y.value));async function F(){var b,t,r;if(!u.isMyTask){const S=(b=u.modelValue)==null?void 0:b["company-id"],A=c.value,V={...S?{company_id:S}:{},...A?{department_ids:[A]}:{}};v.value=((r=(t=await De({params:V}))==null?void 0:t.data)==null?void 0:r.employees)||[]}}pe(async()=>{await F(),await q.fetchCompanies({with:"departments",ignore_permission:!0}),await q.fetchMyCompanies({with:"departments"})});function G(b){return Array.isArray(v.value)&&v.value.find(t=>t.id==b)||null}function Q(b){y.value=(b==null?void 0:b.id)||""}function z(){y.value=""}te(()=>c.value,F),te(()=>f.value,()=>{c.value!==""?c.value="":F()});function R(b,t,{value:r,id:S,label:A,onCancel:V}={}){if(!b)return[];const k=Array.isArray(t)?t.find(D=>(D==null?void 0:D[S])==b):null;return k?[{label:A,value:k==null?void 0:k[r],id:k==null?void 0:k[S],onCancel:V}]:[]}const X=g(()=>{var S;const b=q.companies.reduce((A,V)=>[...A,...V.departments],[]),t=(A,{label:V,value:k,id:D,onCancel:E})=>A?[{label:V,value:k,id:D,onCancel:E}]:[],r=(A,{label:V,onCancel:k})=>{if(!A)return[];const D=new Date(A);return[{label:V,value:D.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:A,onCancel:k}]};return[...R(f.value,q.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{f.value=""}}),...R(I.value,b,{label:"From",value:"short_name",id:"id",onCancel:()=>{I.value=""}}),...R(c.value,b,{label:"To",value:"short_name",id:"id",onCancel:()=>{c.value=""}}),...R((S=B.value)==null?void 0:S.id,v.value,{label:"Employee",value:"name",id:"id",onCancel:z}),...R(x.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{x.value=""}}),...t($.value,{label:"",value:"Important ",id:!0,onCancel:()=>{$.value=""}}),...t(h.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{h.value=""}}),...t(N.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{N.value=""}}),...r(a.value,{label:"",onCancel:()=>{a.value=""}})]});return(b,t)=>{var S,A,V,k,D,E,oe,ne;const r=fe("RouterLink");return s(),n(O,null,[e("div",He,[e("div",Fe,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),l.isMyTask?i("",!0):(s(),n("div",ze,[l.listHasRearranged?(s(),n("div",We,[t[13]||(t[13]=e("span",{class:"text-red-500"},"Priority Changed",-1)),e("button",{class:"btn-3",onClick:t[0]||(t[0]=H(d=>W("clickPrioritySave"),["prevent"]))},"Save"),e("button",{class:"btn-3",onClick:t[1]||(t[1]=H(d=>W("clickPriorityDiscard"),["prevent"]))},"Discard")])):i("",!0),e("button",{onClick:t[2]||(t[2]=d=>W("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),e("div",Ke,[e("div",Ge,[l.isMyTask?i("",!0):(s(),n(O,{key:0},[e("div",Je,[t[16]||(t[16]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),J(e("select",{"onUpdate:modelValue":t[3]||(t[3]=d=>f.value=d),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[t[15]||(t[15]=e("option",{value:""},"--ALL COMPANY--",-1)),(s(!0),n(O,null,Y((S=p(q))==null?void 0:S.myCompanies,d=>(s(),n("option",{key:d.id,value:d.id},_(d.name),9,Ye))),128))],512),[[re,f.value]])]),C(de,{modelValue:I.value,"onUpdate:modelValue":t[4]||(t[4]=d=>I.value=d),companies:((A=p(q))==null?void 0:A.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:P(()=>t[17]||(t[17]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),p(T).name!=="MyTaskList"?(s(),L(de,{key:0,modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=d=>c.value=d),companies:((V=p(q))==null?void 0:V.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:P(()=>t[18]||(t[18]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):i("",!0),p(m).isAdminMood&&((D=(k=p(m))==null?void 0:k.user)==null?void 0:D.role)!=="employee"?(s(),n("div",Qe,[C(Me,{modelValue:B.value,onSelect:Q,onRemove:z,options:v.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:P(({option:d})=>[C(ye,{user:d,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),B.value?(s(),n("div",Xe,[e("button",{onClick:H(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):i("",!0),t[19]||(t[19]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):i("",!0)],64)),e("div",Ze,[t[21]||(t[21]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),J(e("select",{"onUpdate:modelValue":t[6]||(t[6]=d=>x.value=d),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},t[20]||(t[20]=[e("option",{value:""},"--ALL TASKS--",-1),e("option",{value:"not-completed"},"Not Completed",-1),e("option",{value:"only-completed"},"Completed",-1)]),512),[[re,x.value]])]),e("div",et,[e("label",tt,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=d=>$.value=d)},null,512),[[le,$.value]]),t[22]||(t[22]=e("span",null,"Important",-1))]),e("label",st,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=d=>h.value=d)},null,512),[[le,h.value]]),t[23]||(t[23]=e("span",null,"Urgent",-1))]),e("label",lt,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=d=>N.value=d)},null,512),[[le,N.value]]),t[24]||(t[24]=e("span",null,"Is Target",-1))])]),e("div",at,[t[25]||(t[25]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),J(e("input",{id:"month-filter","onUpdate:modelValue":t[10]||(t[10]=d=>a.value=d),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[me,a.value]])])]),l.isMyTask?(s(),L(ue,{key:0,modelValue:j.value,"onUpdate:modelValue":t[11]||(t[11]=d=>j.value=d),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):i("",!0)])]),e("div",ot,[l.isMyTask?i("",!0):(s(),L(ue,{key:0,modelValue:j.value,"onUpdate:modelValue":t[12]||(t[12]=d=>j.value=d),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),e("div",nt,[(s(!0),n(O,null,Y(X.value,d=>(s(),n("div",{key:d.label||d.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[e("div",null,[d.label?(s(),n("span",rt,_(d.label)+": ",1)):i("",!0),M(_(d.value),1)]),e("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:H(d.onCancel,["prevent"])},t[26]||(t[26]=[e("i",{class:"fas fa-times-circle"},null,-1)]),8,it)]))),128))]),l.isMyTask?i("",!0):(s(),n("div",dt,[C(r,{class:K(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((E=p(T).query)==null?void 0:E.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...p(T).query,view:"userwise"}}},{default:P(()=>t[27]||(t[27]=[M(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),C(r,{class:K(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((oe=p(T).query)==null?void 0:oe.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ne=p(T))==null?void 0:ne.query)||{}).filter(d=>{var Z;return((Z=p(T))==null?void 0:Z.query[d])!=="userwise"}).reduce((d,Z)=>({...d,[Z]:p(T).query[Z]}),{})}}},{default:P(()=>t[28]||(t[28]=[M(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},mt={},ct={class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"};function pt(l,w){return s(),n("div",ct,w[0]||(w[0]=[e("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),M("CLOSED ")]))}const we=Oe(mt,[["render",pt]]),ft={class:"mt-3 -mx-3"},yt={class:"w-full"},kt={class:"border-y pr-2 pl-8 py-4 border-gray-300"},vt={class:"mb-1 flex items-center gap-3"},gt={key:0,class:"text-base font-semibold text-purple-600"},xt={class:"flex items-center flex-none lg:w-full order-0 lg:order-1 mb-2"},bt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},ht={class:"text-gray-400 text-xs"},wt={class:"border-y px-2 py-4 border-gray-300"},Ct={class:"flex"},Tt={class:"border-y py-4 pl-2 pr-4 border-gray-300"},$t={class:"flex justify-end gap-2"},_t={key:0},At={colspan:"10",class:"py-2 px-8"},It={class:"text-sm"},St={key:0,class:"text-red-800"},Lt={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:2}},emits:["editClick","addClick","employeeAssignClick"],setup(l,{emit:w}){const u=l,m=U(!1),T=g(()=>m.value?u.childrenTasks:u.childrenTasks.slice(0,u.maxItem)),f=g(()=>m.value?[]:u.childrenTasks.slice(u.maxItem));function I(){m.value=!m.value}return(c,y)=>(s(),n("div",ft,[e("table",yt,[e("tbody",null,[(s(!0),n(O,null,Y(T.value,(a,x)=>(s(),n("tr",{key:a.id,class:K(["",{" bg-green-100/50":a.status=="COMPLETED"," bg-slate-100 hover:bg-slate-200/60":a.status!=="COMPLETED"}])},[e("td",kt,[e("div",vt,[x!==void 0?(s(),n("div",gt,_(x+1)+". ",1)):i("",!0),C(ke,{titleClass:"text-sm",task:a,"sub-tasks-open":!1,"is-my-task":c.isMyTask},null,8,["task","is-my-task"])]),e("div",xt,[e("div",bt,[a!=null&&a.is_important?(s(),L(xe,{key:0})):i("",!0),a!=null&&a.is_urgent?(s(),L(be,{key:1})):i("",!0)])]),e("div",ht,[y[0]||(y[0]=e("i",{class:"fas fa-clock"},null,-1)),M(" "+_(p(he)(a.created_at)),1)])]),e("td",wt,[e("div",Ct,[C(Ue,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:a.users||[],isTargetTask:a.is_target,maxItem:1},null,8,["users","isTargetTask"])])]),e("td",Tt,[e("div",$t,[a.closed_at?(s(),L(we,{key:0})):i("",!0),C(ve,{status:a==null?void 0:a.status,progressPercent:(a==null?void 0:a.progress_percent)||0},null,8,["status","progressPercent"]),C(ge,{ref_for:!0,ref:"progress",task:a,class:"text-sm"},null,8,["task"])])])],2))),128)),l.childrenTasks.length>0?(s(),n("tr",_t,[e("td",At,[e("div",It,[f.value.length>0?(s(),n("span",St,_(f.value.length)+" More sub task"+_(f.value.length>1?"s":""),1)):i("",!0),f.value.length>0||m.value?(s(),n("button",{key:1,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent ml-2",onClick:H(I,["prevent","stop"])},_(m.value?"Hide":"Show")+" All ",1)):i("",!0)])])])):i("",!0)])])]))}},Vt={class:"flex w-full text-gray-800"},Mt={key:0,class:"border-l border-gray-200 last:border-l-0"},Dt={class:"items-start grid grid-cols-4 gap-4 group"},qt={class:"col-span-full md:col-span-full border-b -mx-3 px-3 pt-3 shadow-md shadow-slate-100 flex flex-wrap bg-white z-30"},Et={class:"flex items-start gap-2 w-full"},Ut={class:"flex gap-2"},Bt={key:0,class:"text-xl font-semibold text-blue-500"},Pt={class:"flex items-center w-full mb-2"},Ot={key:0,class:"flex gap-4 items-center mr-3"},Nt={key:1,class:"text-gray-500 text-sm"},jt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Rt={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},Ht={class:"mb-4 text-xs text-gray-400 whitespace-nowrap"},Ft={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},zt={class:"text-gray-400 text-xs col-span-full flex justify-between"},Wt={class:"ml-auto flex flex-wrap gap-2 mb-2 items-start"},Kt={class:"text-xs text-gray-400 flex gap-3 sm:order-0"},Gt=["href"],Jt={class:"mt-4 col-span-full"},Yt={class:"flex gap-3 items-end"},Qt={class:"text-right text-sm flex gap-4 mt-4 opacity-80"},Xt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Zt={key:1,class:"text-gray-500 text-sm"},es={class:"font-semibold text-blue-800"},ts={key:2,class:"ml-4 text-gray-500 text-sm"},ss={class:"text-blue-500 font-semibold"},ls={key:3,class:"text-gray-500 text-sm"},as={class:"font-semibold text-blue-800"},os={key:4,class:"text-gray-500 text-sm"},ns={class:"font-semibold text-blue-800"},rs={class:"flex items-center sm:ml-auto order-0 sm:order-1"},is={key:0,class:"flex gap-2 ml-4 items-center text-xs"},ds=["href"],us=["href"],Ce={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(l,{emit:w}){const u=l,m=ae(),T=U(null),f=w;function I(v){f("addClick",v)}function c(v){f("editClick",v)}function y(v){f("employeeAssignClick",v)}const a=U([]),x=localStorage.getItem("sub_task_opened_list");if(x)try{a.value=JSON.parse(x)}catch{a.value=[]}const $=g(()=>ee(u.task.assigned_at||u.task.created_at)),h=g(()=>ee(u.task.deadline)),N=g(()=>ee(u.task.started_at)),j=g(()=>ee(u.task.completed_at)),W=g({get:()=>a.value.includes(u.task.id),set:v=>{const o=a.value.includes(u.task.id);v&&!o?a.value.push(u.task.id):!v&&o&&(a.value=a.value.filter(B=>B!==u.task.id))}});te(a,v=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(v))},{deep:!0});const q=g(()=>{var v,o;return((o=(v=u.task)==null?void 0:v.children_tasks)==null?void 0:o.length)>0});return(v,o)=>{var F,G,Q,z,R,X,b,t;const B=fe("RouterLink");return s(),n("div",Vt,[l.treeLevel>0?(s(),n("div",Mt,o[4]||(o[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):i("",!0),e("div",{class:K(["flex-grow border-2 rounded pb-3 px-3",{"bg-blue-100/30  ":l.task.closed_at,"bg-green-100  ":((F=T.value)==null?void 0:F.completedPercentage)===100,"bg-white hover:bg-gray-50":((G=T.value)==null?void 0:G.completedPercentage)<100&&!l.task.closed_at,"shadow-sm":l.treeLevel>0,"border-blue-500":l.index%2===0,"border-pink-300":l.index%2===1}])},[e("div",Dt,[e("div",qt,[e("div",Et,[e("div",null,[e("div",Ut,[l.index!==void 0?(s(),n("div",Bt,_(l.index+1)+". ",1)):i("",!0),C(ke,{task:l.task,"sub-tasks-open":W.value,"is-my-task":l.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",Pt,[l.showDraggableHandle||l.task.serial?(s(),n("div",Ot,[l.showDraggableHandle?(s(),n("button",{key:0,onMousedown:o[0]||(o[0]=H((...r)=>v.handleDragging&&v.handleDragging(...r),["stop"])),class:"handle"},o[5]||(o[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):i("",!0),l.task.serial?(s(),n("span",Nt," #"+_(l.task.serial),1)):i("",!0)])):i("",!0),e("div",jt,[l.treeLevel===0?(s(),n("div",Rt," Main ")):i("",!0),(Q=l.task)!=null&&Q.is_important?(s(),L(xe,{key:1,class:"flex-none"})):i("",!0),(z=l.task)!=null&&z.is_urgent?(s(),L(be,{key:2,class:"flex-none"})):i("",!0)])]),e("div",Ht,[o[6]||(o[6]=e("i",{class:"fas fa-clock"},null,-1)),M(" "+_(p(he)(l.task.created_at)),1)])]),l.hideAssignedUsers?i("",!0):(s(),L(Be,{key:0,task:l.task,"tree-level":l.treeLevel,class:"my-2 w-full","employee-route-to":r=>({query:{...p(m).query,view:"userwise","company-id":r.company_id,"user-ids":r.id}})},null,8,["task","tree-level","employee-route-to"])),e("div",Ft,[l.task.closed_at?(s(),L(we,{key:0})):i("",!0),C(ve,{status:(R=l.task)==null?void 0:R.status,progressPercent:((X=l.task)==null?void 0:X.progress_percent)||0},null,8,["status","progressPercent"]),C(ge,{ref_key:"progress",ref:T,task:l.task,class:"text-sm"},null,8,["task"])])])]),e("div",zt,[e("div",Wt,[(s(!0),n(O,null,Y(l.task.website_tags||[],r=>(s(),n("div",{class:"border bg-gray-50 text-xs px-2 rounded-lg shadow-sm text-gray-700 bg-gradient-to-b to-slate-50 from-blue-100",key:r.id},_(r.name),1))),128))])]),e("div",{class:K(["ml-0 col-span-full",{"mt-4":q.value}])},[e("div",{class:K({"ml-6":q.value})},[e("div",Kt,[e("h2",{class:K([{"text-blue-600 font-semibold  inline-block  ":q.value},"flex items-center gap-1 group"])},[e("span",null," Sub Tasks ("+_((b=l.task.children_tasks)==null?void 0:b.length)+") ",1)],2),!l.task.closed_at&&!l.hideButtons?(s(),n(O,{key:0},[l.treeLevel<2?(s(),n("a",{key:0,href:`/tasks/add?parent_id=${u.task.id}&back-to=${encodeURIComponent(p(m).path+"?"+p(Pe)(p(m).query)).toLowerCase()}`,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:o[1]||(o[1]=H(r=>f("addClick",u.task.id),["stop","prevent"]))},o[7]||(o[7]=[e("i",{class:"fas fa-plus"},null,-1),M(" Add Sub Task ")]),8,Gt)):i("",!0)],64)):i("",!0)])],2),C(Lt,{childrenTasks:l.task.children_tasks,"hide-buttons":l.hideButtons,"hide-assigned-users":l.hideAssignedUsers,"parent-tree-level":l.treeLevel,onEditClick:c,onAddClick:I,onEmployeeAssignClick:y},{"tree-item-end":P(({task:r,level:S})=>[Le(v.$slots,"item-end",{level:S,task:r})]),_:3},8,["childrenTasks","hide-buttons","hide-assigned-users","parent-tree-level"])],2)]),e("div",Jt,[e("div",Yt,[e("div",Qt,[l.task.is_target?(s(),n("div",Xt,o[8]||(o[8]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),M(" TARGET TASK ")]))):i("",!0),$.value?(s(),n("span",Zt,[o[9]||(o[9]=M(" Assign: ")),e("span",es,_($.value),1)])):i("",!0),h.value?(s(),n("span",ts,[o[10]||(o[10]=M(" Deadline: ")),e("span",ss,_(h.value),1)])):i("",!0),N.value?(s(),n("span",ls,[o[11]||(o[11]=M(" Started: ")),e("span",as,_(N.value),1)])):i("",!0),j.value?(s(),n("span",os,[o[12]||(o[12]=M(" Completed: ")),e("span",ns,_(j.value),1)])):i("",!0)]),e("div",rs,[l.hideButtons?i("",!0):(s(),n("div",is,[l.task.is_closed?i("",!0):(s(),n("a",{key:0,href:`/tasks/edit/${l.task.id}`,onClick:o[2]||(o[2]=H(r=>f("editClick",l.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},o[13]||(o[13]=[e("i",{class:"fas fa-edit"},null,-1),M(" Edit ")]),8,ds)),l.task.is_closed?i("",!0):(s(),n("a",{key:1,href:`/tasks/${l.task.id}/assign-users`,onClick:o[3]||(o[3]=H(r=>f("employeeAssignClick",l.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},o[14]||(o[14]=[e("i",{class:"fas fa-users-cog"},null,-1),M(" Manage Employee & Supervisor ")]),8,us)),C(B,{to:{name:"TaskReports",params:{id:(t=l.task)==null?void 0:t.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:P(()=>o[15]||(o[15]=[e("i",{class:"far fa-file-alt"},null,-1),M(" Reports ")])),_:1,__:[15]},8,["to"])]))])])])],2)])}}},ms={class:"w-full bg-white rounded"},cs=["rowspan"],ps={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(l,{emit:w}){const u=l,m=w,T=g(()=>u.tasks.reduce((c,y)=>(c.push(...y.users.filter(a=>!c.find(x=>x.id==a.id&&a.id))),c),[]).filter(c=>u.selectedUserId?c.id==u.selectedUserId:!0)),f=c=>u.tasks.filter(x=>x.users.some($=>$.id===c)),I=g(()=>T.value.map(c=>{const y=f(c.id);return{...c,tasks:y}}));return(c,y)=>(s(),n("div",null,[e("table",ms,[e("tbody",null,[(s(!0),n(O,null,Y(I.value,a=>(s(),n(O,{key:a.id},[(s(!0),n(O,null,Y(a.tasks,(x,$)=>(s(),n("tr",{key:x.id},[$==0?(s(),n("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(a.tasks.length,1)},[C(ye,{user:a,class:"sticky top-[80px]"},null,8,["user"])],8,cs)):i("",!0),e("td",{class:K(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":$==0,"border-b":a.tasks.length-1===$}])},[C(Ce,{task:x,class:"!border-0 my-0",index:$,onCommentButtonClick:y[0]||(y[0]=h=>m("commentButtonClick",c.item.id)),onEditClick:y[1]||(y[1]=h=>m("editClick",h)),onAddClick:y[2]||(y[2]=h=>m("addClick",h)),onEmployeeAssignClick:y[3]||(y[3]=h=>m("employeeAssignClick",h))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},fs={class:"max-w-full mx-4 p-6 mt-2 relative bg-white rounded-md shadow-md"},ys={class:"mb-4"},ks={class:"relative min-h-[30vh]"},vs={key:0,class:"text-center py-4 text-red-500"},gs={key:1},xs={class:"flex items-stretched"},bs={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},hs=1,Gs={__name:"TaskList",setup(l){const w=Ne(),u=ce(),m=ae(),T=Ve(),f=U(""),I=U(!1),c=U(null),y=g(()=>{var t;return((t=u==null?void 0:u.user)==null?void 0:t.role)==="employee"||!(u!=null&&u.isAdminMood)?!0:!!m.query["user-ids"]}),a=U(null),x=U(!1),$=ie({parentId:0,requirementId:0}),h=ie({taskId:0,isOpen:!1}),N=U(null),j=U([]),{handleItemsPriorityUpdate:W,saveTaskPriority:q,listHasRearranged:v}=qe(()=>w.taskListTree,0);pe(async()=>{f.value="loading",m.query.status?await o():T.push({query:{...m.query,status:"not-completed"}})});async function o(){let t;m.name==="MyTaskList"?t=await w.fetchMyTasks({...m.query,page:1}):t=await w.fetchTasks({...m.query,page:1},{infiniteScrolling:!1}),f.value="",j.value=t.query_log||[]}const B=t=>{x.value=!0,$.parentId=t},F=t=>{h.taskId=t,h.isOpen=!0},G=t=>{c.value=t,I.value=!0},Q=()=>{I.value=!1,c.value=null};async function z(){a.value=null,x.value=!1,$.parentId=0,f.value="loading",await o()}async function R(){x.value=!1,$.parentId=0,await o()}async function X(){f.value="loading",await q()&&await o()}te(()=>({...m.query}),async()=>{w.resetTaskList(),f.value="loading",await o()});const b=g({get(){return{...m.query}},set(t){localStorage.removeItem("sub_task_opened_list"),T.push({query:{...t}})}});return(t,r)=>{var S,A,V;return s(),n("div",fs,[a.value?(s(),L(se,{key:0},{default:P(()=>[C(Se,{taskId:a.value,onClose:r[0]||(r[0]=k=>a.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):i("",!0),x.value?(s(),L(se,{key:1},{default:P(()=>[C(Ie,{parentTaskId:$.parentId,requirementId:$.requirementId,onClose:R,onTaskCreated:z},null,8,["parentTaskId","requirementId"])]),_:1})):i("",!0),h.isOpen?(s(),L(se,{key:2,class:"*:max-w-4xl"},{default:P(()=>[C($e,{taskId:h.taskId,onCancelClick:r[1]||(r[1]=()=>{h.isOpen=!1,h.taskId=0}),onSuccess:r[2]||(r[2]=()=>{h.isOpen=!1,h.taskId=0,f.value="loading",o()})},null,8,["taskId"])]),_:1})):i("",!0),C(ut,{modelValue:b.value,"onUpdate:modelValue":r[3]||(r[3]=k=>b.value=k),onClickAddTask:B,onClickPrioritySave:X,onClickPriorityDiscard:r[4]||(r[4]=()=>p(v)?N.value.resetItems:null),"list-has-rearranged":p(v),isMyTask:p(m).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((A=(S=p(m))==null?void 0:S.query)==null?void 0:A["query-log"])=="true"?(s(!0),n(O,{key:3},Y(j.value,(k,D)=>(s(),n("div",{key:D,class:"text-xs text-gray-500"},[e("div",ys,_(k.raw_query),1)]))),128)):i("",!0),e("div",ks,[p(w).error?(s(),n("div",vs,_(p(w).error),1)):p(w).tasks.length>0?(s(),n("div",gs,[((V=p(m).query)==null?void 0:V.view)=="userwise"?(s(),L(ps,{key:0,tasks:p(w).tasks,selectedUserId:p(m).query["user-ids"],onCommentButtonClick:r[5]||(r[5]=k=>G(k,t.task.id)),onEditClick:r[6]||(r[6]=k=>a.value=k),onAddClick:r[7]||(r[7]=k=>B(k)),onEmployeeAssignClick:r[8]||(r[8]=k=>F(k))},null,8,["tasks","selectedUserId"])):(s(),L(_e,{key:1,items:p(w).tasks,handle:"handle",onItemsUpdate:p(W),class:"space-y-4",ref_key:"draggableTaskList",ref:N},{item:P(({item:k,index:D})=>[e("div",xs,[C(Ce,{"is-my-task":p(m).name==="MyTaskList",task:k,index:D,showDraggableHandle:!y.value,onCommentButtonClick:r[9]||(r[9]=E=>G(E,t.task.id)),onEditClick:r[10]||(r[10]=E=>a.value=E),onAddClick:r[11]||(r[11]=E=>B(E)),onEmployeeAssignClick:r[12]||(r[12]=E=>F(E)),class:"!border-0"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):f.value!=="loading"?(s(),n("div",bs," No tasks found. ")):i("",!0),f.value==="loading"?(s(),L(Ae,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):i("",!0)]),C(Te,{show:I.value,"commentable-id":c.value,"commentable-type":"task","user-id":hs,"on-close":Q,onSubmitted:p(w).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Gs as default};
