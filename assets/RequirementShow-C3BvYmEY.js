import{c as o,g as d,o as n,a as e,t as b,p as h,w as A,m as P,r as _,n as je,f as j,i as T,j as D,x as O,h as Ne,v as Ae,M as De,e as re,F as z,d as Le,y as te,k as Z,N as Ee,J as Oe,I as Be,b as Ve,u as Me,z as se}from"./index-Cyu8r00X.js";import{L as le}from"./LoaderView-BOE938Nu.js";import{O as K}from"./OverlyModal-Cpvs5cJ8.js";import{_ as Ue}from"./ShareComponent-CyEgXktN.js";import{_ as Se}from"./DepartmentChip-CsQYiG0b.js";import{_ as Q}from"./DescriptionView-CsaNOYd3.js";import{_ as ee}from"./UserChip-KRy7AoyK.js";import{r as Pe,c as Fe,f as ie,b as ze,s as He}from"./requirement-CLV27nrX.js";import{o as Ge}from"./url-CePbr-gY.js";import{u as We}from"./user-DwY0w70p.js";import{_ as yr,a as Ke}from"./TaskUserAssignForm-hJ5XndvE.js";import{_ as Qe}from"./TextEditor-xqdwi9QO.js";import{u as Ye}from"./useTaskStore-B1KQVB6K.js";import{_ as Je}from"./TaskSelectionInput-BZRfq07K.js";import{_ as Xe}from"./TaskAddForm-DZcz5S_T.js";import{_ as Ze}from"./TaskEditForm-0MnHBNK_.js";import{_ as et}from"./TaskTableRow-B1GCVA90.js";import{T as ne}from"./TextWithHr-BvX9zPYQ.js";import{d as ae}from"./datetime-BEfC2TVK.js";import{c as tt}from"./dom-Bic1TNqD.js";import{_ as st}from"./ApproveAndReject-P4E6F-p7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-RJZsHSec.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-Bs0Xd2wJ.js";import"./SelectDropdown-BXA6PIO8.js";import"./TaskTitle-CFUnCGJE.js";import"./RequiredIcon-BybitV5i.js";import"./company-Dl_P_6bu.js";import"./CompanyDepartmentSelectInput-C8pigp_d.js";import"./SectionLoading-D-qaL9l_.js";import"./tags-C7QwmM6y.js";import"./MultiselectDropdown-C_B9XVIg.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-CfxXMlYa.js";import"./TaskUrgentBadge-DMd7InTv.js";import"./TaskAssignedUsers-xNU0BQov.js";import"./TaskIsClosedBadge-CUgGilzo.js";const rt={key:0,class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},nt={class:"text-sm flex items-center gap-2 text-red-400 font-semibold"},at={class:"mt-[2px]"},it={key:0,class:"text-gray-800 flex items-center gap-2"},lt={key:1,class:"text-gray-800 w-full my-2 text-center"},ot={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},dt=["innerHTML"],ut={class:"flex gap-4 items-center justify-center mt-2"},mt={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick"],setup(x,{emit:R}){const a=R;return(c,v)=>{var p;return(p=x.requirement)!=null&&p.closed_at?(n(),o("div",rt,[v[5]||(v[5]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",nt,[v[1]||(v[1]=e("span",{class:"fad fa-lock"},null,-1)),v[2]||(v[2]=e("span",{class:"mt-[2px]"},"CLOSED AT",-1)),e("span",at,b(new Date(x.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),x.requirement.closed_by_user?(n(),o("div",it,[v[3]||(v[3]=e("span",{class:"text-sm"},"Closed by",-1)),h(ee,{user:x.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):d("",!0),x.requirement.closing_note?(n(),o("div",lt,[v[4]||(v[4]=e("div",{class:"text-x"},"Closing Note",-1)),e("div",ot,[e("p",{innerHTML:x.requirement.closing_note},null,8,dt)])])):d("",!0),e("div",ut,[e("button",{class:"btn-2 h-8",onClick:v[0]||(v[0]=A(m=>a("reOpenClick"),["prevent"]))},"Re Open")])])):d("",!0)}}},ct={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},pt={class:"my-6"},vt={class:"text-center font-semibold text-blue-800 mb-4"},ft={class:"text-center my-1"},bt={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},xt={key:0,class:"mt-4"},yt=["required"],gt={class:"flex"},_t={class:"text-red-600 text-center mt-2 text-sm"},kt={class:"flex justify-between mt-3"},wt={class:"btn-2"},qt={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(x,{emit:R}){const a=x,c=R,v=P({get:()=>a.loading,set:()=>c("update:loading")}),p=_(""),m=_(""),t=_(255),g=P(()=>t.value-p.value.length);async function q(){var l,s,i;v.value=!0;try{(l=a.requirement)!=null&&l.closed_at?await Pe(a.requirement.id):await Fe(a.requirement.id,p.value),c("updateStatus")}catch(u){m.value=(i=(s=u.response)==null?void 0:s.data)==null?void 0:i.message,c("error")}finally{v.value=!1}}return(l,s)=>{var u,f,w,N,$,S,C;const i=je("LoaderView");return n(),o("form",{class:"p-4 rounded relative border",onSubmit:A(q,["prevent"])},[v.value?(n(),j(i,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:T(()=>s[3]||(s[3]=[D(" Submitting! ")])),_:1,__:[3]})):d("",!0),e("h3",ct,b((u=x.requirement)!=null&&u.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",pt,[e("div",vt,b((f=x.requirement)==null?void 0:f.title),1),s[6]||(s[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",ft,[s[4]||(s[4]=D(" Want to ")),e("span",bt,[e("i",{class:O(["text-sm fas text-blue-600",[(w=x.requirement)!=null&&w.closed_at?"fa-unlock":"fa-lock"]])},null,2),D(b((N=x.requirement)!=null&&N.closed_at?"Re-Open":"Close"),1)]),s[5]||(s[5]=D(" the requirement? "))]),($=x.requirement)!=null&&$.closed_at?d("",!0):(n(),o("div",xt,[Ne(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=I=>p.value=I),rows:"4",placeholder:"Write about why are you closing the requirement?",class:"w-full border rounded-lg p-2 text-gray-700",required:l.currentAction==="reject",onInput:s[1]||(s[1]=I=>p.value.length>t.value?p.value=p.value.slice(0,t.value):null)},null,40,yt),[[Ae,p.value]]),e("div",gt,[e("div",{class:O(["ml-auto inline-block text-sm text-gray-500",p.value.length>=t.value?"text-red-500":""])}," left "+b(g.value)+"/"+b(t.value)+" words ",3)])]))]),s[7]||(s[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",_t,b(m.value),1),e("div",kt,[e("button",{class:"btn-3",onClick:s[2]||(s[2]=A(I=>c("clickCancel"),["prevent"]))},"Cancel"),e("button",wt,[e("i",{class:O(["text-xl text-white fas",[(S=x.requirement)!=null&&S.closed_at?"fa-unlock":"fa-lock"]])},null,2),D(" "+b((C=x.requirement)!=null&&C.closed_at?"Re-Open":"Close"),1)])])])],32)}}};async function ht(x,R,{params:a={}}={}){return De.get(`/requirements/${x}/details/${R}`,{params:a})}async function $t(x,R,{params:a={}}={}){const c=Ge(a);return De.delete(`/requirements/${x}/details/${R}${c?"?"+c:""}`)}const Ct={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Tt={class:"mb-4"},Rt={class:"font-semibold"},St={class:"mb-4"},It={class:"line-clamp-2"},jt={key:1,class:"min-h-40"},Nt={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},At={key:0,class:"mb-4 text-red-500 font-medium"},Dt={key:1,class:"mb-4"},Lt={class:"flex items-center justify-between gap-4"},Ot=["disabled"],Bt={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(x,{emit:R}){const a=x,c=R,v=We(),p=_(null),m=_(""),t=_(),g=_([]);async function q(){var l,s;m.value="submitting";try{const i=await $t(a.requirementId,a.detailId);c("delete",i),m.value="create"}catch(i){m.value="error",t.value=((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to update requirement detail: "+i,c("error",t.value)}}return re(async()=>{var l,s,i;m.value="loading";try{g.value=await v.fetchDepartmentWiseEmployees(),p.value=(l=(await ht(a.requirementId,a.detailId)).data)==null?void 0:l.detail}catch(u){t.value=((i=(s=u.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to fetch requirement detail"}finally{m.value=""}}),(l,s)=>{var i,u;return n(),o("div",Ct,[s[4]||(s[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:A(q,["prevent"]),class:"z-0"},[m.value!=="loading"?(n(),o(z,{key:0},[e("div",Tt,[s[1]||(s[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",Rt,b((i=p.value)==null?void 0:i.title),1)]),e("div",St,[s[2]||(s[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",It,b((u=p.value)==null?void 0:u.description),1)]),s[3]||(s[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),o("div",jt)),e("div",Nt,[t.value?(n(),o("div",At,b(t.value),1)):d("",!0),t.value?(n(),o("hr",Dt)):d("",!0),e("div",Lt,[e("button",{type:"button",onClick:s[0]||(s[0]=A(f=>c("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:m.value=="loading"||m.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},b(m.value=="submitting"?"Deleting...":"Delete"),9,Ot)])])],32),m.value==="loading"||m.value==="submitting"?(n(),j(le,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):d("",!0)])}}};const Et={class:"sticky top-0 pt-4 bg-white z-10"},Vt={class:"mb-4"},Mt={class:"mb-4"},Ut={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Pt={key:0,class:"mb-4 text-red-500 font-medium"},Ft={key:1,class:"mb-4"},zt={class:"flex items-center justify-between gap-4"},Ht=["disabled"],Gt={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(x,{emit:R}){const a=x,c=R,v=_(),p=_(null),m=_(""),t=_(),g=_({feedback:""});async function q(){var l,s;m.value="submitting";try{const i=await ze(a.requirementId,g.value.feedback);c("update",i),m.value="create"}catch(i){m.value="error",t.value=((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.message)||"Failed to update requirement requirement",c("error",t.value)}}return re(async()=>{var l,s,i,u;m.value="loading";try{await ie(a.requirementId),p.value=(l=(await ie(a.requirementId)).data)==null?void 0:l.requirement,g.value={feedback:(s=p.value)==null?void 0:s.feedback}}catch(f){t.value=((u=(i=f.response)==null?void 0:i.data)==null?void 0:u.message)||"Failed to fetch requirement requirement"}finally{m.value=""}}),(l,s)=>{var i;return n(),o("div",{ref_key:"formContainerRef",ref:v,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Et,[s[3]||(s[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),s[4]||(s[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:s[0]||(s[0]=A(u=>c("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:A(q,["prevent"]),class:"z-0"},[m.value!=="loading"?(n(),o(z,{key:0},[e("div",Vt,[s[5]||(s[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),h(Q,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:T(()=>{var u;return[D(b((u=p.value)==null?void 0:u.title),1)]}),_:1})]),e("div",Mt,[s[6]||(s[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),h(Qe,{modelValue:g.value.feedback,"onUpdate:modelValue":s[1]||(s[1]=u=>g.value.feedback=u)},null,8,["modelValue"])])],64)):d("",!0),e("div",Ut,[t.value?(n(),o("div",Pt,b(t.value),1)):d("",!0),t.value?(n(),o("hr",Ft)):d("",!0),e("div",zt,[e("button",{type:"button",onClick:s[2]||(s[2]=A(u=>c("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:m.value=="loading"||m.value=="submitting",type:"submit",class:"btn-2"},b(m.value=="submitting"?"Saving...":(i=p.value)!=null&&i.feedback?"Update Feedback":"Add Feedback"),9,Ht)])])],32),m.value==="loading"||m.value==="submitting"?(n(),j(le,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):d("",!0)],512)}}},Wt={class:"flex justify-center items-center"},Kt={class:"modal-card"},Qt=["required"],Yt={class:"flex"},Jt={class:"flex justify-between gap-2 mt-4"},Xt=["disabled"],Zt=["disabled"],es={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(x,{emit:R}){const a=x,c=R,v=_(255),p=P(()=>v.value-l.value.length),m=Ee(),t=_(null),g=_(null),q=_(null),l=_(""),s=_(!1),i=P(()=>q.value!==null);function u(S){q.value=S,l.value="",$()}function f(){q.value=null,l.value=""}async function w(){var S,C;if(q.value==="reject"&&!l.value)return m.error("Rejection Reason is required!");if(typeof a.onSubmit=="function")return a.onSubmit({note:l.value,action:q.value});c("loading",!0),s.value=!0;try{await He(a.requirementId,{note:l.value}),c("success"),f()}catch(I){return c("error",I),m.error(((C=(S=I==null?void 0:I.response)==null?void 0:S.data)==null?void 0:C.message)||"Submission failed!")}finally{c("loading",!1),s.value=!1}}function N(S){var C,I;i.value&&(S.key==="ArrowLeft"?(C=g.value)==null||C.focus():S.key==="ArrowRight"&&((I=t.value)==null||I.focus()))}function $(){Be(()=>{var S;(S=t.value)==null||S.focus()})}return re(()=>{window.addEventListener("keydown",N)}),Oe(()=>{window.removeEventListener("keydown",N)}),(S,C)=>(n(),o("div",null,[e("div",Wt,[e("button",{onClick:C[0]||(C[0]=I=>u("accept"))},C[3]||(C[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),i.value?(n(),o("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:A(f,["self"])},[e("div",Kt,[C[4]||(C[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Ne(e("textarea",{"onUpdate:modelValue":C[1]||(C[1]=I=>l.value=I),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:q.value==="reject",onInput:C[2]||(C[2]=I=>l.value.length>v.value?l.value=l.value.slice(0,v.value):null)},null,40,Qt),[[Ae,l.value]]),e("div",Yt,[e("div",{class:O(["ml-auto inline-block text-sm text-gray-500",l.value.length>=v.value?"text-red-500":""])}," left "+b(p.value)+"/"+b(v.value)+" words ",3)])]),e("div",Jt,[e("button",{ref_key:"cancelBtnRef",ref:g,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:f,disabled:s.value}," Cancel ",8,Xt),e("button",{ref_key:"confirmBtnRef",ref:t,class:O(["focus:ring-2 ring-offset-2 disabled:opacity-30",q.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:w,disabled:s.value}," Confirm Submission ",10,Zt)])])])):d("",!0)]))}},ts={class:"flex items-center gap-6 justify-center my-16"},ss={key:0,class:"border rounded-md"},rs={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(x,{emit:R}){const a=x,c=R,v=Ye(),p=_(""),m=_(null),t=_(""),g=_(!1);async function q(){await v.setTaskRequirement(t.value,a.requirement.id),c("assignTask")}return(l,s)=>(n(),o("div",{class:O(["text-left p-4",[p.value&&!m.value?"min-h-[400px]":""]])},[e("div",ts,[e("button",{onClick:s[0]||(s[0]=A(i=>c("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),s[5]||(s[5]=e("span",null,"or",-1)),e("button",{class:O({"btn-3":p.value!=="direct-assign","btn-2":p.value=="direct-assign"}),onClick:s[1]||(s[1]=A(()=>p.value="direct-assign",["prevent"]))}," Assign Task ",2)]),p.value&&!m.value?(n(),o("div",ss,[e("form",{onSubmit:A(q,["prevent"]),class:"p-4 flex items-end"},[h(Je,{class:"flex-grow mr-4 h-12",taskId:t.value,"onUpdate:taskId":s[2]||(s[2]=i=>t.value=i),show:g.value,"onUpdate:show":s[3]||(s[3]=i=>g.value=i),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":x.fromDepartmentId},filterTasks:i=>!i.requirement_id,onAddNewTaskClick:s[4]||(s[4]=i=>c("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),s[6]||(s[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):d("",!0)],2))}},ns={class:"flex flex-col items-center gax-x-1 justify-end"},as={key:0},is={key:1},ls={class:"text-sm text-gray-600 whitespace-normal w-64"},os={class:"text-gray-900 font-semibold text-sm md:text-base"},ds={class:"ml-2"},us={key:0,class:"text-red-700 text-sm"},ms={key:1,class:"text-green-600 ml-2"},cs={key:2,class:"ml-2 text-yellow-700"},Ie={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(x,{emit:R}){const a=x,c=R,v=Le(),p=P(()=>{var l,s,i,u,f;return{from_in_charge:!!((l=a.requirement)!=null&&l.status&&((s=a.requirement)!=null&&s.submission_date)),from_coordinator:!!((i=a.requirement)!=null&&i.from_coordinator),to_in_charge:!!((u=a.requirement)!=null&&u.to_incharge),to_coordinator:!!((f=a.requirement)!=null&&f.to_coordinator)}}),m=P(()=>{var l,s,i,u,f,w,N,$;return{from_in_charge:(s=(l=a.requirement)==null?void 0:l.from_department)==null?void 0:s.in_charge,from_coordinator:(u=(i=a.requirement)==null?void 0:i.from_department)==null?void 0:u.coordinator,to_in_charge:(w=(f=a.requirement)==null?void 0:f.to_department)==null?void 0:w.in_charge,to_coordinator:($=(N=a.requirement)==null?void 0:N.to_department)==null?void 0:$.coordinator}}),t=P(()=>{var u;const l=Object.keys(p.value),s=l.indexOf(a.approvalType);let i=!0;for(let f=s-1;f>=0;f--){const w=l[f];i=i&&(m.value[w]?(u=p.value)==null?void 0:u[w]:!0)}return i}),g=P(()=>{var w,N,$,S,C,I,k,H,G,E,L,r,F,V,M,U;let l=null,s=null,i="",u="";a.approvalType==="from_in_charge"&&(l=(w=a.requirement)==null?void 0:w.from_department,s=($=(N=a.requirement)==null?void 0:N.from_department)==null?void 0:$.in_charge,i="In Charge",u=(S=a.requirement)==null?void 0:S.from_incharge_note),a.approvalType==="from_coordinator"&&(l=(C=a.requirement)==null?void 0:C.from_department,s=(I=a.requirement)==null?void 0:I.from_coordinator,i="Coordinator",u=(k=a.requirement)==null?void 0:k.from_coordinator_note),a.approvalType==="to_in_charge"&&(l=(H=a.requirement)==null?void 0:H.to_department,s=(G=a.requirement)==null?void 0:G.to_in_charge,i="In Charge",u=(E=a.requirement)==null?void 0:E.to_incharge_note),a.approvalType==="to_coordinator"&&(l=(L=a.requirement)==null?void 0:L.to_department,s=(r=a.requirement)==null?void 0:r.to_coordinator,i="Coordinator",u=(F=a.requirement)==null?void 0:F.to_coordinator_note);const f=(V=m.value)==null?void 0:V[a.approvalType];return{department:l,department_user:f,approved:(M=p.value)==null?void 0:M[a.approvalType],approval_user:s,is_rejected:((U=a.requirement)==null?void 0:U.rejected_by_user_id)==(f==null?void 0:f.id),userType:i,approval_note:u}});function q(){c("updateApproval")}return(l,s)=>{var i,u,f,w,N,$;return n(),o("div",ns,[g.value.department_user?(n(),o("div",as,[h(ee,{user:g.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),o("div",is,s[0]||(s[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",ls,[g.value.is_rejected?(n(),j(Q,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:T(()=>[D(b(x.requirement.rejection_reason),1)]),_:1})):(n(),j(Q,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:T(()=>[D(b(g.value.approval_note),1)]),_:1}))]),e("div",null,[!g.value.is_rejected&&!g.value.approved&&t.value&&((i=Z(v).user)==null?void 0:i.id)==((f=(u=g.value)==null?void 0:u.department_user)==null?void 0:f.id)?(n(),j(st,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(w=a.requirement)==null?void 0:w.id,onSuccess:q,variant:1},null,8,["applicationId"])):d("",!0)]),s[2]||(s[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",os,[e("span",null,b(((N=g.value.department)==null?void 0:N.short_name)||(($=g.value.department)==null?void 0:$.name)),1),e("span",ds,b(g.value.userType),1),g.value.department_user?(n(),o(z,{key:0},[g.value.is_rejected?(n(),o("span",us," (Rejected)")):g.value.approved?(n(),o("span",ms,"(âœ”)")):(n(),o("span",cs,s[1]||(s[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):d("",!0)])])}}},ps={class:"container mx-auto print:p-0 w-full print:max-w-full"},vs={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},fs={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},bs={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},xs={class:"text-center text-xl font-bold mb-2 flex items-center"},ys={class:"mb-8"},gs={class:"text-lg font-semibold mb-2"},_s={class:"flex gap-4 items-center text-gray-500"},ks={class:"text-sm"},ws={key:0,class:"flex items-center gap-1"},qs={key:0,class:"mb-5"},hs=["innerHTML"],$s={class:"mb-8"},Cs={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},Ts={class:"w-full border-collapse"},Rs={key:0},Ss={class:"mb-8"},Is={class:"font-semibold text-lg px-2"},js={key:0},Ns=["innerHTML"];const As={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Ds={class:"flex flex-col items-end"},Ls={key:2,class:"mt-6 mb-8 break-before-avoid-page"},Os={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},Bs={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},Es={class:"bg-white shadow rounded-lg space-y-4 p-4"},Vs={class:"border col-span-3 p-3 rounded-md"},Ms={class:"flex items-center gap-2 mb-4"},Us={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},Ps={class:"flex items-center gap-2 mb-4"},Fs={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},zs={class:"font-bold print:text-gray-900"},Hs={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},Gs={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},Ws={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},Ks={class:"print:text-gray-900 text-sm text-right"},Qs={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},Ys={class:"print:text-gray-900 text-sm text-right"},Js={class:"flex justify-between items-center mb-4"},Xs={class:"mb-6"},Zs={class:"flex justify-between items-center"},er={key:1,class:"text-red-600"},tr={key:0,class:"mb-6"},sr={class:"flex justify-center items-center gap-2 text-sky-500"},rr={key:1,class:"mb-6"},nr={class:"flex justify-between items-center"},ar={key:2,class:"text-center mb-4 text-red-700 mt-8 text-sm"},ir={key:4,class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},zr={__name:"RequirementShow",setup(x){const R=Ve(),a=Me(),c=_(""),v=Le(),p=_(),m=_(),t=_(null),g=se({detail:null,open:!1}),q=se({detail:null,open:!1}),l=se({detail:null,open:!1}),s=_(!1),i=()=>s.value=!0,u=()=>s.value=!1,f=_(),w=_({isOpen:!1,taskId:null});re(async()=>{await $(),window.addEventListener("beforeprint",i),window.addEventListener("afterprint",u),window.addEventListener("resize",N),await Be(),tt(p.value,()=>{})});function N(){}Oe(()=>{window.removeEventListener("beforeprint",i),window.removeEventListener("afterprint",u),window.removeEventListener("resize",N)});async function $(){var L;c.value="loading",t.value=(L=(await ie(R.params.id)).data)==null?void 0:L.requirement,c.value=""}function S(){var L,r,F,V,M,U,Y,J,X;if(v.user.role!=="super_admin"&&((L=v.user)==null?void 0:L.id)!==((F=(r=t.value)==null?void 0:r.to_department)==null?void 0:F.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(M=(V=t.value)==null?void 0:V.to_department)==null?void 0:M.name}'s In charge can create or assign.`);console.log({requirement:t}),k.modalShown=!0,k.from_department_id=t.value.from_department_id,k.to_department_id=t.value.to_department_id,k.taskDefaultValues={title:"",description:"",from_department_id:t.value.from_department_id,to_department_id:t.value.to_department_id,is_important:((U=t.value)==null?void 0:U.priority)=="IMPORTANT",is_urgent:((Y=t.value)==null?void 0:Y.priority)=="URGENT",supervisor_ids:(J=t.value)!=null&&J.supervisor_id?[(X=t.value)==null?void 0:X.supervisor_id]:[]},k.requirement=t.value}function C(L){g.open=!0,g.detail=L}function I(L){l.open=!0,l.detail=L}const k=se({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function H(){f.value=null,await $()}async function G(){k.modalShown=!1,k.requirement=null,k.creating=!1}const E=_({open:!1});return(L,r)=>{var V,M,U,Y,J,X,oe,de,ue,me,ce,pe,ve,fe,be,xe,ye,ge,_e,ke,we,qe,he,$e,Ce,Te;const F=je("RouterLink");return n(),o("div",ps,[q.open?(n(),j(K,{key:0},{default:T(()=>{var y;return[h(Gt,{requirementId:t.value.id,detailId:(y=q.requirement.value)==null?void 0:y.id,onCloseClick:r[0]||(r[0]=B=>q.open=!1),onUpdate:r[1]||(r[1]=async()=>{q.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):d("",!0),l.open?(n(),j(K,{key:1},{default:T(()=>{var y;return[h(Bt,{requirementId:t.value.id,detailId:(y=l.requirement.value)==null?void 0:y.id,onCloseClick:r[2]||(r[2]=B=>l.open=!1),onDelete:r[3]||(r[3]=async()=>{l.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):d("",!0),k.modalShown?(n(),j(K,{key:2,class:"*:relative"},{default:T(()=>{var y,B;return[e("button",{onClick:A(G,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},r[18]||(r[18]=[e("i",{class:"fas fa-times-circle"},null,-1)])),k!=null&&k.creating?d("",!0):(n(),j(rs,{key:0,"from-department-id":(y=t.value)==null?void 0:y.from_department_id,requirement:k==null?void 0:k.requirement,onCancelClick:G,onAddNewTaskClick:r[4]||(r[4]=()=>{k.modalShown=!0,k.creating=!0}),onAssignTask:H},null,8,["from-department-id","requirement"])),k!=null&&k.creating?(n(),j(Xe,{key:1,requirementDetailId:(B=k==null?void 0:k.requirement.value)==null?void 0:B.id,requirementId:t.value.id,onClose:G,onTaskCreated:H,defaultValues:k.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):d("",!0)]}),_:1})):d("",!0),f.value?(n(),j(K,{key:3},{default:T(()=>[h(Ze,{taskId:f.value,onClose:r[5]||(r[5]=y=>f.value=null),onUpdated:H},null,8,["taskId"])]),_:1})):d("",!0),w.value.isOpen?(n(),j(K,{key:4,class:"*:max-w-4xl"},{default:T(()=>[h(Ke,{taskId:w.value.taskId,onCancelClick:r[6]||(r[6]=()=>{w.value.isOpen=!1,w.value.taskId=0}),onSuccess:r[7]||(r[7]=()=>{w.value.isOpen=!1,w.value.taskId=0,c.value="loading",$()})},null,8,["taskId"])]),_:1})):d("",!0),E.value.open?(n(),j(K,{key:5},{default:T(()=>[h(qt,{requirement:t.value,onClickCancel:r[8]||(r[8]=y=>E.value.open=!1),onUpdateStatus:r[9]||(r[9]=()=>{$(),E.value.open=!1})},null,8,["requirement"])]),_:1})):d("",!0),e("div",vs,[t.value?(n(),o("div",fs,[e("div",bs,[e("div",xs,[e("button",{class:"btn-3 h-8 px-4",onClick:r[10]||(r[10]=A(()=>Z(a).back(),["prevent"]))},"Back"),r[19]||(r[19]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),r[33]||(r[33]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",ys,[e("div",null,[e("div",gs,[h(Q,{"line-clamp":"3",class:"mb-2"},{default:T(()=>[D(b(t.value.title),1)]),btnText:T(({lineClampClass:y})=>[D(b(y?"More":"Less"),1)]),_:1}),e("div",_s,[e("div",ks,[r[20]||(r[20]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),D(" "+b(Z(ae)(t.value.created_at)),1)]),t.value.created_by?(n(),o("div",ws,[r[21]||(r[21]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),h(ee,{"avatar-size":"xsmall",user:t.value.created_by,class:"border-sky-300"},null,8,["user"])])):d("",!0)])]),t.value.description?(n(),o("div",qs,[r[22]||(r[22]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),h(Q,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:T(()=>[e("p",{innerHTML:t.value.description,class:"text-justify"},null,8,hs)]),_:1})])):d("",!0)])]),e("div",$s,[h(ne,{class:"mb-4"},{default:T(()=>r[23]||(r[23]=[e("h2",{class:"font-semibold text-lg px-2"},"Task List",-1)])),_:1,__:[23]}),e("div",Cs,[e("table",Ts,[r[25]||(r[25]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[c.value!="loading"&&((M=(V=t.value)==null?void 0:V.tasks)==null?void 0:M.length)===0?(n(),o("tr",Rs,r[24]||(r[24]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),o(z,{key:1},te(((U=t.value)==null?void 0:U.tasks)||[],(y,B)=>(n(),j(et,{key:y.id,task:y,indexing:B+1,class:"*:py-3 *:border-b-0",onEditClick:r[11]||(r[11]=W=>f.value=W),onEmployeeAssignClick:r[12]||(r[12]=W=>{w.value.isOpen=!0,w.value.taskId=W})},null,8,["task","indexing"]))),128))])])])]),e("div",Ss,[h(ne,{class:"mb-4"},{default:T(()=>{var y,B,W,Re;return[e("h2",Is," '"+b(((B=(y=t.value)==null?void 0:y.to_department)==null?void 0:B.short_name)||((Re=(W=t.value)==null?void 0:W.to_department)==null?void 0:Re.name))+"' Feedback ",1)]}),_:1}),e("div",{class:O(["px-3 border border-dashed rounded-lg border-sky-600",[(Y=t.value)!=null&&Y.feedback?"py-3":"py-8"]]),colspan:"5"},[c.value!="loading"&&((J=t.value)!=null&&J.status)?(n(),o("div",js,[String((X=t.value)==null?void 0:X.feedback).trim().length>0?(n(),j(Q,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:T(()=>{var y;return[e("p",{class:"text-sm text-justify",innerHTML:(y=t.value)==null?void 0:y.feedback},null,8,Ns)]}),_:1})):d("",!0),e("div",{class:O([((oe=t.value)!=null&&oe.feedback,"w-full flex justify-center")])},[t.value.closed_at?d("",!0):(n(),o("button",{key:0,class:"btn-3 print:hidden",onClick:r[13]||(r[13]=A(()=>{q.open=!0,q.requirement=t.value},["prevent"]))},b(t.value.feedback?"Update Feedback":"Add feedback"),1))],2)])):d("",!0)],2)]),(t.value,d("",!0)),c.value!="loading"&&!((de=t.value)!=null&&de.status)?(n(),o("div",As,[e("div",Ds,[h(es,{"requirement-id":(ue=t.value)==null?void 0:ue.id,onSuccess:$},{heading:T(()=>r[29]||(r[29]=[D(" Requirement Submission ")])),acceptButtonLabel:T(()=>r[30]||(r[30]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),D("Submit Requirement ")],-1)])),submitButtonLabel:T(()=>r[31]||(r[31]=[D(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):d("",!0),(me=t.value)!=null&&me.status?(n(),o("div",Ls,[h(ne,null,{default:T(()=>r[32]||(r[32]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[32]}),e("div",Os,[(n(),o(z,null,te(["from_in_charge","from_coordinator"],y=>h(Ie,{class:"pt-12",key:y,requirement:t.value,"approval-type":y,onUpdateApproval:r[14]||(r[14]=()=>$())},null,8,["requirement","approval-type"])),64))]),((ce=t.value)==null?void 0:ce.from_department_id)!==((pe=t.value)==null?void 0:pe.to_department_id)?(n(),o("div",Bs,[(n(),o(z,null,te(["to_in_charge","to_coordinator"],y=>h(Ie,{class:"pt-12",key:y,requirement:t.value,"approval-type":y,onUpdateApproval:r[15]||(r[15]=()=>$())},null,8,["requirement","approval-type"])),64))])):d("",!0)])):d("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:p},[e("div",Es,[e("div",Vs,[e("div",null,[e("div",Ms,[r[34]||(r[34]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),h(Se,{department:(ve=t.value)==null?void 0:ve.from_department,"short-name":!0},null,8,["department"])]),r[35]||(r[35]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",Us,[(fe=t.value)!=null&&fe.supervisor?(n(),j(ee,{key:0,user:(be=t.value)==null?void 0:be.supervisor},null,8,["user"])):d("",!0)])]),r[37]||(r[37]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Ps,[r[36]||(r[36]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),h(Se,{department:(xe=t.value)==null?void 0:xe.to_department,"short-name":!0},null,8,["department"])])])]),e("div",Fs,[r[38]||(r[38]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",zs,b((ye=t.value)==null?void 0:ye.id),1)]),((_e=(ge=t.value)==null?void 0:ge.website_tags)==null?void 0:_e.length)>0?(n(),o("div",Hs,[r[39]||(r[39]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",Gs,[(n(!0),o(z,null,te(((ke=t.value)==null?void 0:ke.website_tags)||[],y=>(n(),o("div",{key:y.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},b(y.name),1))),128))])])):d("",!0),(we=t.value)!=null&&we.submission_date?(n(),o("div",Ws,[r[40]||(r[40]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",Ks,b(Z(ae)((qe=t.value)==null?void 0:qe.submission_date)),1)])):d("",!0),(he=t.value)!=null&&he.better_to_complete_on?(n(),o("div",Qs,[r[41]||(r[41]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",Ys,b(Z(ae)(($e=t.value)==null?void 0:$e.better_to_complete_on)),1)])):d("",!0),e("div",null,[e("div",Js,[r[42]||(r[42]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:O(["font-semibold text-sm",{"text-yellow-600 ":t.value.priority=="IMPORTANT","text-red-700 ":t.value.priority=="URGENT"}])},b(t.value.priority||"NORMAL"),3)])]),e("div",Xs,[e("div",Zs,[r[43]||(r[43]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),t.value.status?(n(),o("span",{key:0,class:O(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":t.value.status!="approved","bg-green-300 text-green-700 border-green-400":t.value.status=="approved"}])},b(String(t.value.status).toUpperCase()),3)):(n(),o("span",er,"..."))])]),t.value.closed_at?d("",!0):(n(),o("div",tr,[e("div",sr,[r[44]||(r[44]=e("div",null,"Task is Open",-1)),e("button",{class:"btn-3 h-8",onClick:r[16]||(r[16]=A(y=>E.value.open=!0,["prevent"]))}," Close Requirement ")])])),t.value.rejected_by?(n(),o("div",rr,[e("div",nr,[r[45]||(r[45]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),h(ee,{user:t.value.rejected_by},null,8,["user"])])])):d("",!0),t.value.rejection_reason?(n(),o("div",ar,[r[46]||(r[46]=e("p",{class:"text-gray-600 mb-1 italic"},"Reason",-1)),e("p",null,b(t.value.rejection_reason),1)])):d("",!0),r[49]||(r[49]=e("hr",{class:"mb-3"},null,-1)),(Ce=t.value)!=null&&Ce.closed_at?(n(),j(mt,{key:3,requirement:t.value,onReOpenClick:r[17]||(r[17]=y=>E.value.open=!0)},null,8,["requirement"])):(n(),o("div",ir,[t.value.status=="approved"?(n(),o("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:A(S,["prevent"])},r[47]||(r[47]=[e("i",{class:"fas fa-plus text-sm"},null,-1),D(" Add/Assign Task ")]))):d("",!0),h(F,{class:"btn-2 h-8",to:`/requirements/edit/${(Te=t.value)==null?void 0:Te.id}`},{default:T(()=>r[48]||(r[48]=[D(" Edit ")])),_:1,__:[48]},8,["to"])]))])]),h(Ue,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3 md:sticky",ref_key:"shareComponent",ref:m},null,512)],512)])):d("",!0),c.value==="loading"?(n(),j(le,{key:1,class:"absolute inset-0 bg-opacity-90"})):d("",!0)])])}}};export{zr as default};
