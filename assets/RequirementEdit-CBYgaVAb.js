import{r as v,e as T,z as q,c as f,o as g,a as s,f as B,g as w,w as k,F as E,p as l,k as m,i as S,j as I,x as U,t as $,b as j,u as D}from"./index-BLs8QlT4.js";import{_ as z}from"./CompanyDepartmentSelectInput-C_jwDyp5.js";import{R as F}from"./RequiredIcon-BvX6kIr7.js";import{f as A,u as L}from"./requirement-CHm1MZ_M.js";import{u as M}from"./company-l_9U4Mrd.js";import{u as W}from"./tags-Be5mOzKJ.js";import{L as h}from"./LoaderView-JLBAsbQh.js";import{_ as G}from"./MultiselectDropdown-wrESA7EC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"max-h-[90vh] overflow-auto max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},J={class:"sticky top-0 pt-4 bg-white z-10"},K={class:"mb-4"},O={class:"block text-gray-600 text-sm mb1 font-medium"},P={class:"block text-gray-600 text-sm mb-1 font-medium"},Q={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},R={class:"flex items-center justify-between gap-4"},X=["disabled"],Y={__name:"RequirementEditForm",props:{requirementId:{type:[Number,String]}},emits:["update","cancelClick","error"],setup(V,{emit:x}){const d=V,u=x,r=W(),y=M(),a=v(""),p=v([]),C=v(),_=v(""),n=v({from_department_id:"",to_department_id:"",website_tags:[]});T(async()=>{var t;a.value="loading",r.fetchTags("website"),await y.fetchCompanies({with:"departments",ignore_permission:!0}),C.value=(t=(await A(d.requirementId)).data)==null?void 0:t.requirement,a.value=""}),q(C,function(t){var e;t&&(n.value.from_department_id=t.from_department_id,n.value.to_department_id=t.to_department_id,Array.isArray(t==null?void 0:t.website_tags)&&((e=t.website_tags)==null?void 0:e.length)>0&&(p.value=t.website_tags[0]))});async function N(){var e,b,c,i;a.value="submitting";const t={...n.value,...p.value.id?{website_tags:[p.value.id]}:{}};console.log({payload:t});try{const o=await L(d.requirementId,t);u("update",o),a.value="created",_.value=(e=o==null?void 0:o.data)==null?void 0:e.message}catch(o){u("error",(b=o==null?void 0:o.response)==null?void 0:b.data),_.value=(i=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:i.message,a.value="error"}}return(t,e)=>{var b,c;return g(),f("div",H,[s("div",J,[e[5]||(e[5]=s("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),e[6]||(e[6]=s("hr",{class:"mb-4"},null,-1)),s("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:e[0]||(e[0]=k(i=>u("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),s("form",{onSubmit:k(N,["prevent"]),class:"z-0"},[a.value!=="loading"&&a.value!=="submitting"?(g(),f(E,{key:0},[s("div",K,[e[7]||(e[7]=s("label",{class:"text-gray-800"},"Websites",-1)),l(G,{options:m(r).tags,modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=i=>p.value=i),label:"name","track-by":"id"},null,8,["options","modelValue"])]),l(z,{modelValue:n.value.from_department_id,"onUpdate:modelValue":e[2]||(e[2]=i=>n.value.from_department_id=i),companies:((b=m(y))==null?void 0:b.companies)||[],class:"mb-4"},{label:S(()=>[s("label",O,[e[8]||(e[8]=I(" From Department ")),l(F)])]),_:1},8,["modelValue","companies"]),l(z,{modelValue:n.value.to_department_id,"onUpdate:modelValue":e[3]||(e[3]=i=>n.value.to_department_id=i),companies:((c=m(y))==null?void 0:c.companies)||[],class:"mb-4"},{label:S(()=>[s("label",P,[e[9]||(e[9]=I(" To Department ")),l(F)])]),_:1},8,["modelValue","companies"])],64)):w("",!0),s("div",Q,[_.value?(g(),f("div",{key:0,class:U(["mb-4 font-medium text-center",{"text-red-500":a.value=="error","text-green-500":a.value=="created"}])},$(_.value),3)):w("",!0),s("div",R,[s("button",{type:"button",onClick:e[4]||(e[4]=k(i=>u("cancelClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),s("button",{disabled:a.value=="loading"||a.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},$(a.value=="submitting"?"Saving...":"Save"),9,X)])])],32),a.value==="loading"||a.value==="submitting"?(g(),B(h,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):w("",!0)])}}},Z={class:"container mx-auto p-6"},me={__name:"RequirementEdit",setup(V){const x=j(),d=D();return(u,r)=>(g(),f("div",Z,[l(Y,{requirementId:m(x).params.id,onUpdate:r[0]||(r[0]=()=>m(d).back()),onCancelClick:r[1]||(r[1]=()=>m(d).back())},null,8,["requirementId"])]))}};export{me as default};
