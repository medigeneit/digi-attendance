import{u as N,M as C,s as L,r as h,b as B,p as I,o as s,c as v,d as O,v as q,a as r,e as _,t as A,h as k,F as D,x as U,y as F,j as R,m as E,g as V,f as z,n as G}from"./index-DxUiRNIc.js";import{u as T}from"./leave-application-DXj5JJVC.js";import{u as Z}from"./exchange-Bkk57dxv.js";import{u as K}from"./short-leave-C7VYBgN8.js";const P={key:0,class:"text-center space-y-2 print:hidden"},Q={key:0,class:"mt-2"},W={class:"flex justify-end gap-2 pt-2"},X={__name:"ExchangeApplicationApprovalSection",props:{application:Object,notificationId:{type:String,required:!0}},setup(S){const y=N(),d=C(),f=Z(),{user:w}=L(y),m=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(m.application))});const u=h(!1),i=h(""),n=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await f.handoverAccept(e),alert("Handover approved!"),await l()},condition:()=>{var e,o;return!((e=t.value)!=null&&e.status)&&((o=t.value)==null?void 0:o.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await f.inChargeAccept(e),alert("In-Charge approved!"),await l()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await f.recommendByAccept(e),alert("Recommendation approved!"),await l()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await f.approvedByAccept(e),alert("Final approval successful!"),await l()}}],c=I(()=>n.find(e=>{var o,p,b,x;return t.value?e.key==="handover"?e.condition():((o=t.value)==null?void 0:o.status)!=="Rejected"&&((p=t.value)==null?void 0:p.status)!=="Approved"&&!((b=t.value)!=null&&b[e.approved_field])&&((x=t.value)==null?void 0:x[e.approved_by_field])===w.value.id:!1})),g=()=>{u.value&&i.value?(a(),u.value=!1):u.value=!0};async function a(){try{await f.rejectExchange(t.value.id,i.value),alert("Exchange application rejected!"),i.value="",await l(t.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function l(e){await d.markAsRead(m.notificationId)}return(e,o)=>c.value&&t.value?(s(),v("div",P,[u.value?(s(),v("div",Q,[O(r("textarea",{"onUpdate:modelValue":o[0]||(o[0]=p=>i.value=p),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,i.value]])])):_("",!0),r("div",W,[r("button",{class:"bg-green-500 text-white text-sm px-4 py-1 rounded hover:bg-green-600",onClick:o[1]||(o[1]=p=>c.value.action(t.value.id))}," Approve "),r("button",{class:"bg-red-500 text-white text-sm px-4 py-1 rounded hover:bg-red-600",onClick:g}," Reject ")])])):_("",!0)}},Y={key:0,class:"text-center space-y-2 print:hidden"},M={key:0,class:"mt-2"},ee={class:"flex justify-end gap-2 pt-2"},ae={__name:"LeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(S){const y=N(),d=T(),f=C(),{user:w}=L(y),m=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(m.application))});const u=h(!1),i=h(""),n=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await d.acceptHandover(e),alert("Handover approved!"),await l()},condition:()=>{var e,o;return!((e=t.value)!=null&&e.status)&&((o=t.value)==null?void 0:o.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await d.acceptInCharge(e),alert("In-Charge approved!"),await l()}},{key:"coordinator",approved_field:"coordinator_user_id",approved_by_field:"approval_coordinator_user_id",label:"Coordinator",action:async e=>{await d.acceptCoordinator(e),alert("Coordinator approved!"),await l()}},{key:"operational_admin",approved_field:"operational_admin_user_id",approved_by_field:"approval_operational_admin_user_id",label:"Operational Admin",action:async e=>{await d.acceptOperationalAdmin(e),alert("Operational Admin approved!"),await l()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await d.acceptRecommendBy(e),alert("Recommendation approved!"),await l()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await d.acceptApprovedBy(e),alert("Final approval successful!"),await l()}}],c=I(()=>n.find(e=>{var b,x,j,$;if(!t.value)return!1;if(e.key==="handover")return e.condition();const o=!!((b=t.value)!=null&&b[e.approved_field]),p=((x=t.value)==null?void 0:x[e.approved_by_field])===w.value.id;return((j=t.value)==null?void 0:j.status)!=="Rejected"&&(($=t.value)==null?void 0:$.status)!=="Approved"&&!o&&p})),g=()=>{u.value&&i.value?(a(),u.value=!1):u.value=!0};async function a(){try{await d.rejectLeaveApplication(t.value.id,{rejection_reason:i.value}),alert("Application rejected!"),i.value="",await l(t.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function l(e){await f.markAsRead(m.notificationId)}return(e,o)=>c.value&&t.value?(s(),v("div",Y,[u.value?(s(),v("div",M,[O(r("textarea",{"onUpdate:modelValue":o[0]||(o[0]=p=>i.value=p),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,i.value]])])):_("",!0),r("div",ee,[r("button",{class:"btn-2",onClick:o[1]||(o[1]=p=>c.value.action(t.value.id))},"Approve"),r("button",{class:"btn-1",onClick:g},"Reject")])])):_("",!0)}},te={key:0,class:"text-center space-y-2 print:hidden"},oe={key:0,class:"mt-2"},ne={class:"flex justify-end gap-2 pt-2"},re={__name:"ShortLeaveApplicationApprovalSection",props:{application:{type:Object,required:!0},notificationId:{type:String,required:!0}},setup(S){const y=N(),d=K(),f=C(),{user:w}=L(y),m=S,t=h(null);B(()=>{t.value=JSON.parse(JSON.stringify(m.application))});const u=h(!1),i=h(""),n=[{key:"handover",approved_field:"handover_user_id",approved_by_field:null,label:"Handover",action:async e=>{await d.handoverAccept(e),alert("Handover approved!"),await l()},condition:()=>{var e,o;return!((e=t.value)!=null&&e.status)&&((o=t.value)==null?void 0:o.handover_user_id)===w.value.id}},{key:"in_charge",approved_field:"in_charge_user_id",approved_by_field:"approval_in_charge_user_id",label:"In-Charge",action:async e=>{await d.inChargeAccept(e),alert("In-Charge approved!"),await l()}},{key:"recommend_by",approved_field:"recommend_by_user_id",approved_by_field:"approval_recommend_by_user_id",label:"Recommend By",action:async e=>{await d.recommendByAccept(e),alert("Recommendation approved!"),await l()}},{key:"approved_by",approved_field:"approved_by_user_id",approved_by_field:"approval_approved_by_user_id",label:"Approved By",action:async e=>{await d.approvedByAccept(e),alert("Final approval successful!"),await l()}}],c=I(()=>n.find(e=>{var o,p,b,x;return t.value?e.key==="handover"?e.condition():((o=t.value)==null?void 0:o.status)!=="Rejected"&&((p=t.value)==null?void 0:p.status)!=="Approved"&&!((b=t.value)!=null&&b[e.approved_field])&&((x=t.value)==null?void 0:x[e.approved_by_field])===w.value.id:!1})),g=()=>{u.value&&i.value?(a(),u.value=!1):u.value=!0};async function a(){try{await d.rejectShortLeave(t.value.id,i.value),alert("Application rejected!"),i.value="",await l(t.value.id)}catch(e){alert(e.message||"Something went wrong!")}}async function l(e){await f.markAsRead(m.notificationId)}return(e,o)=>c.value&&t.value?(s(),v("div",te,[u.value?(s(),v("div",oe,[O(r("textarea",{"onUpdate:modelValue":o[0]||(o[0]=p=>i.value=p),class:"w-full border rounded-md p-2 text-sm",placeholder:"Enter rejection note"},null,512),[[q,i.value]])])):_("",!0),r("div",ne,[u.value?_("",!0):(s(),v("button",{key:0,class:"btn-2",onClick:o[1]||(o[1]=p=>c.value.action(t.value.id))}," Approve ")),r("button",{class:"btn-1",onClick:g},A(u.value?"Submit":"Reject"),1)])])):_("",!0)}},se={class:"space-y-6 px-4 py-4"},ie={class:"text-2xl font-semibold capitalize text-gray-700"},le={key:0,class:"space-y-4"},ce={class:"flex items-start gap-4"},pe={class:"text-2xl text-blue-500"},de={class:"flex-1"},ue={class:"text-gray-800 font-medium"},_e={class:"text-gray-800 font-medium"},ve={class:"text-red-600 text-sm"},ye={key:0,class:"text-xs text-gray-400"},fe={key:1,class:"text-xs"},he={class:"text-xs text-gray-400"},ge={key:0,class:"flex items-center justify-between"},be={key:1,class:"text-center text-red-500 py-10"},Ae={__name:"NotificationList",setup(S){V();const y=z(),d=C(),{notifications:f}=L(d);T();const w=N();L(w),h(!1),h({}),h({}),B(()=>{d.fetchNotifications()});const m=(n,c)=>{if(!n)return"No application details";switch(c){case"leaveApplication":return`Last Office ( ${n.last_working_date} ) → Join Date ( ${n.resumption_date} )`;case"shortLeave":return`Short Leave on ${i(n.start_time)??"N/A"} to ${n.end_time?i(n.end_time):"N/A"}`;case"exchange":return n.exchange_type==="offday"?`Exchange (Offday): ${n.exchange_date} → ${n.current_date}`:n.exchange_type==="shift"?`Exchange (${n.exchange_type}) on ${n.current_date} (${(n==null?void 0:n.shift_name)??"No Shift"})`:`Exchange (${n.exchange_type})`;default:return"Unknown Event"}},t=n=>{switch(n){case"leaveApplication":return"fas fa-calendar-alt";case"shortLeave":return"fas fa-clock";case"exchange":return"fas fa-random";default:return"fas fa-bell"}},u=n=>new Date(n).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),i=n=>{const[c,g]=n.split(":").map(Number),a=new Date;return a.setHours(c,g),a.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(n,c)=>{const g=G("RouterLink");return s(),v("div",se,[r("h2",ie,A(k(y).query.type.replace(/([A-Z])/g," $1")),1),k(f)[k(y).query.type]?(s(),v("div",le,[(s(!0),v(D,null,U(k(f)[k(y).query.type],(a,l)=>{var e,o,p,b,x,j,$,H,J;return s(),v("div",{key:a.id,class:"bg-white p-4 rounded-xl shadow border"},[r("div",ce,[r("div",pe,[r("i",{class:F(t(a.event_type))},null,2)]),r("div",de,[r("p",ue,A((e=a.event_model)==null?void 0:e.user_name),1),r("p",_e,"Reason: "+A((o=a.event_model)==null?void 0:o.reason),1),r("p",ve,A(m(a.event_model,a.event_type)),1),(p=a==null?void 0:a.event_model)!=null&&p.total_leave_days_without_week?(s(),v("p",ye," Total Leave: "+A(a==null?void 0:a.event_model.total_leave_days_without_week)+" days ",1)):_("",!0),(b=a==null?void 0:a.event_model)!=null&&b.type?(s(),v("p",fe," Type : "+A((x=a==null?void 0:a.event_model)==null?void 0:x.type),1)):_("",!0),r("p",he,A(u(a.created_at)),1)]),a!=null&&a.event_model?(s(),v("div",ge,[k(y).query.type==="leaveApplication"?(s(),R(g,{key:0,to:{name:"LeaveApplicationShow",params:{id:(j=a==null?void 0:a.event_model)==null?void 0:j.id}},class:"btn-icon"},{default:E(()=>c[0]||(c[0]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),k(y).query.type==="shortLeave"?(s(),R(g,{key:1,to:{name:"ShortLeaveShow",params:{id:($=a==null?void 0:a.event_model)==null?void 0:$.id}},class:"btn-icon"},{default:E(()=>c[1]||(c[1]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0),k(y).query.type==="exchange"?(s(),R(g,{key:2,to:{name:((H=a==null?void 0:a.event_model)==null?void 0:H.exchange_type)=="offday"?"ExchangeOffdayShow":"ExchangeShiftShow",params:{id:(J=a==null?void 0:a.event_model)==null?void 0:J.id}},class:"btn-icon"},{default:E(()=>c[2]||(c[2]=[r("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"])):_("",!0)])):_("",!0)]),a!=null&&a.event_model&&a.event_type==="leaveApplication"?(s(),R(ae,{key:0,application:a.event_model,"notification-id":a.id},null,8,["application","notification-id"])):_("",!0),a!=null&&a.event_model&&a.event_type==="shortLeave"?(s(),R(re,{key:1,application:a.event_model,"notification-id":a.id},null,8,["application","notification-id"])):_("",!0),a!=null&&a.event_model&&a.event_type==="exchange"?(s(),R(X,{key:2,application:a.event_model,notificationId:a.id},null,8,["application","notificationId"])):_("",!0)])}),128))])):(s(),v("div",be,"No notifications found."))])}}};export{Ae as default};
