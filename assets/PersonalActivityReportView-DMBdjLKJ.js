import{_ as De,g as Ie,D as Ce,f as Oe,u as Me,E as Se,r as K,x as v,q as W,h as Ne,c as u,o as i,a as s,k as g,j as Ee,d as j,w as D,l as ue,v as pe,t as a,n as I,m as Q,b as O,F as Y,e as H,M as ce,s as Re}from"./index-veBv7Iui.js";import{_ as Pe}from"./EmployeeFilter-CvYwn3WM.js";import{L as Ue}from"./LoaderView-D_M0Yro6.js";import{U as je}from"./UserChip-BCkYGuZL.js";import{g as me,l as Ae,m as Be,c as J,a as X}from"./datetime-y2WWmmYq.js";import{t as Le}from"./todos-CHsG8mDp.js";import{j as $e}from"./url-Buz9GlSr.js";import{u as Fe}from"./useTodoDateStore-CeO0DKOU.js";import{_ as Ve}from"./TodoCreateEditShow-NQArvN-t.js";import"./company-CHEihwLw.js";import"./department-Cxbg4IWU.js";import"./EmployeeDropdownInput-DlFXU3GW.js";import"./SelectDropdown-DvfvSoBI.js";import"./user-C7rhijoW.js";import"./OverlyModal-qlJxVOG9.js";import"./useTodoProjectStore-CMemLIeU.js";import"./useTodoStore-BMumUDFq.js";import"./useTaskStore-Ct2U3n0p.js";import"./requirement-D3GiIqzo.js";import"./TaskSelectionInput-sASPEvOn.js";import"./TaskTitle-VnGnNFNV.js";import"./TodoStatusIcon-a4Efwff8.js";const qe={class:"container mx-auto print:w-full print:px-0 print:py-0"},Ge={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},ze={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},Ke={key:0,class:"relative h-[32px] flex gap-1 ml-auto justify-end print:hidden"},We={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Qe={key:1,class:"text-gray-400"},Ye=["disabled"],He={key:0,class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0 shadow-sm"},Je={class:"flex flex-wrap items-center gap-3"},Xe={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Ze={class:"relative h-[32px] flex"},et={key:0,class:"text-xs text-blue-600 flex items-center gap-2 w-full md:w-auto md:ml-auto"},tt={key:1,class:"space-y-4"},st={key:0,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},nt={class:"text-sm text-gray-700"},ot={class:"font-semibold"},lt={class:"text-sm text-gray-700"},at={class:"font-semibold"},rt={class:"text-sm text-gray-700"},it={class:"font-semibold text-green-600"},dt={class:"text-sm text-gray-700"},ut={class:"font-semibold text-blue-600"},pt={class:"text-sm text-gray-700"},ct={class:"font-semibold text-amber-600"},mt={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},ft={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},yt={key:0,class:"flex items-center gap-3"},xt={class:"font-semibold text-gray-800"},vt=["href"],gt={class:"text-xs text-gray-500"},bt={class:"text-[11px] text-blue-800"},ht={key:0,class:"font-bold"},_t={key:1,class:"flex items-center gap-3"},kt={class:"font-semibold text-gray-800"},wt={class:"text-xs text-gray-500"},Tt={class:"text-[11px] text-blue-800"},Dt={key:0,class:"font-bold"},It={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},Ct={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},Ot={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},Mt={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},St={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},Nt={class:"overflow-x-auto"},Et={class:"min-w-full text-left text-sm border-separate border-spacing-0"},Rt={key:0},Pt={class:"bg-gray-100/50"},Ut={colspan:"4",class:"px-4 py-2 border font-bold text-blue-800 text-xs uppercase tracking-wider"},jt={class:"ml-2 font-normal text-gray-500"},At={class:"px-4 py-3 text-center border"},Bt={class:"px-4 py-3 border"},Lt=["onClick"],$t={class:"font-semibold text-gray-800 flex items-center gap-2"},Ft={key:0,class:"text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded-full"},Vt=["onClick"],qt={class:"px-4 py-3 border text-xs text-gray-700"},Gt={class:"px-4 py-3 border text-center"},zt={key:2,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},Kt={__name:"PersonalActivityReportView",props:{selfOnly:{type:Boolean,default:!1}},setup(fe){const c=fe,k=Fe(),ye=Ie(),{user:M}=Ce(ye),A=Oe(),xe=Me(),l=Se({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),p=K(""),Z=K(null),S=v(()=>{if(!p.value)return"";const[t,e]=p.value.split("-").map(Number);return!t||!e?"":me(new Date(t,e-1,1))}),N=v(()=>{if(!p.value)return"";const[t,e]=p.value.split("-").map(Number);return!t||!e?"":me(Ae(new Date(t,e-1,1)))}),V=v(()=>p.value?Be(`${p.value}-01`):""),C=v(()=>S.value&&N.value?`${J(S.value)} ~ ${J(N.value)}`:""),B=v(()=>{var t;return c.selfOnly?((t=M.value)==null?void 0:t.company_id)||"":l.companyId}),q=v(()=>!S.value||!N.value?!1:c.selfOnly?!!_.value&&!!B.value:!!B.value),L=v(()=>k.todo_dates||[]),_=v(()=>{var t;return(t=M.value)!=null&&t.id?String(M.value.id):""});function ve(t){l.companyId=t.company_id||"",l.departmentId=t.department_id||"",l.employeeId=c.selfOnly?_.value:t.employee_id||"",l.lineType=t.line_type||"all"}function ee(t){var e,n;return t.todo_id||t.todoId||((e=t.todo)==null?void 0:e.id)||((n=t.todo)==null?void 0:n.todo_id)||t.id||`${t.title}-${t.date}`}function te(t){var e;return((e=t==null?void 0:t.todo)==null?void 0:e.id)||(t==null?void 0:t.todo_id)||(t==null?void 0:t.todoId)||(t==null?void 0:t.id)||null}function se(t){var y,x,h,w;const e=te(t);if(!e)return 0;const n=k.getTodoDateCount(e);if(typeof n=="number")return n;const f=((y=t==null?void 0:t.todo)==null?void 0:y.todo_dates_count)??(t==null?void 0:t.todo_dates_count)??((h=(x=t==null?void 0:t.todo)==null?void 0:x.todo_dates)==null?void 0:h.length)??((w=t==null?void 0:t.todo)==null?void 0:w.dates_count)??null;return typeof f=="number"?f:(L.value||[]).filter(o=>{var r;return(((r=o==null?void 0:o.todo)==null?void 0:r.id)||(o==null?void 0:o.todo_id)||(o==null?void 0:o.id))==e}).length}const ne=v(()=>{var f;if(c.selfOnly&&M.value)return[M.value];const t=((f=Z.value)==null?void 0:f.employees)||[];if(t.length)return t;const e=[],n=new Set;return L.value.forEach(y=>{const x=y.user;if(!x||!x.id)return;const h=String(x.id);n.has(h)||(n.add(h),e.push(x))}),e}),ge=v(()=>l.employeeId?ne.value.filter(t=>String(t.id)===String(l.employeeId)):ne.value),$=v(()=>ge.value.map(t=>{const e=L.value.filter(o=>{var r;return String(((r=o.user)==null?void 0:r.id)??o.user_id)===String(t.id)}),n={};for(const o of e){const r=ee(o),m=n[r],b=new Date(o.date),d=m?new Date(m.date):null;(!m||d&&b>d)&&(n[r]=o)}const f={WORKING:1,PENDING:2,DEPENDANT:3,COMPLETED:4,BACK_LOG:5},y=Object.values(n).sort((o,r)=>{const m=new Date(o.date).getTime(),b=new Date(r.date).getTime();if(m!==b)return b-m;const d=f[o.status]||999,T=f[r.status]||999;return d!==T?d-T:(o.priority||0)-(r.priority||0)}),x=y.reduce((o,r)=>{var d,T,P,U;const m=((T=(d=r.todo)==null?void 0:d.todo_project)==null?void 0:T.id)||"others",b=((U=(P=r.todo)==null?void 0:P.todo_project)==null?void 0:U.title)||"Others";return o[m]||(o[m]={id:m,name:b,todos:[]}),o[m].todos.push(r),o},{}),h=Object.values(x).sort((o,r)=>o.id==="others"?1:r.id==="others"?-1:o.name.localeCompare(r.name)),w={total:y.length,completed:y.filter(o=>o.status==="COMPLETED").length,working:y.filter(o=>o.status==="WORKING").length,pending:y.filter(o=>o.status==="PENDING").length};return{user:t,projects:h,totals:w}}).sort((t,e)=>{var n,f;return(((n=t.user)==null?void 0:n.name)||"").localeCompare(((f=e.user)==null?void 0:f.name)||"")})),F=v(()=>$.value.reduce((t,e)=>({totalTodos:t.totalTodos+e.totals.total,completed:t.completed+e.totals.completed,working:t.working+e.totals.working,pending:t.pending+e.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));function oe(){console.log("syncQuery",l),xe.replace({query:{...A.query,month:p.value||void 0,...c.selfOnly?{}:{company_id:l.companyId||void 0,department_id:l.departmentId||void 0,employee_id:l.employeeId||void 0,line_type:l.lineType||void 0}}})}async function E(){if(q.value){await k.fetchTodoDates({"company-id":B.value||void 0,"department-id":c.selfOnly?void 0:l.departmentId,"employee-id":c.selfOnly?_.value:l.employeeId,"line-type":c.selfOnly?void 0:l.lineType,"start-date":S.value,"end-date":N.value});try{const t=Array.from(new Set((L.value||[]).map(e=>te(e)).filter(e=>e)));t.length&&await k.fetchTodoDateCounts(t,{companyId:B.value||""})}catch(t){console.error("fetchTodoDateCounts failed",t)}}}function G(){c.selfOnly&&_.value&&(l.employeeId=_.value)}function le(){const t=A.query||{};p.value=typeof t.month=="string"&&t.month?t.month:p.value||X(new Date),l.companyId=c.selfOnly?"":t.company_id||"",l.departmentId=c.selfOnly?"":t.department_id||"",l.employeeId=c.selfOnly?_.value:t.employee_id||"",l.lineType=c.selfOnly?"all":t.line_type||"all",G()}W(()=>[l.companyId,l.departmentId,l.employeeId,l.lineType,S.value,N.value,p.value],()=>{G(),oe(),E()}),W(()=>A.query,()=>{le()}),W(_,()=>{G(),oe(),E()}),Ne(()=>{p.value=p.value||X(new Date),le(),E()});function be(){window.print()}function ae(t){const e=p.value?new Date(`${p.value}-01`):new Date;e.setMonth(e.getMonth()+t),p.value=X(e)}function re(){ae(-1)}function ie(){ae(1)}const R=K({action:null});function de(t){R.value={action:"show",todo:t}}function z(){R.value={action:null,todo:null}}function he(){E(),z()}function _e(){E(),z()}function ke(t){R.value={action:"edit",todo:t}}function we(t,e){R.value={action:"addDate",todo_id:t,date:e}}return(t,e)=>(i(),u("div",qe,[s("div",Ge,[e[11]||(e[11]=s("div",null,[s("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),s("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),s("span",ze,[c.selfOnly?(i(),u("div",Ke,[s("button",{class:"btn-3 h-[32px] px-3",onClick:D(re,["prevent"])},e[6]||(e[6]=[s("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),s("div",We,[e[7]||(e[7]=s("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),ue(s("input",{id:"month",type:"month","onUpdate:modelValue":e[0]||(e[0]=n=>p.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[pe,p.value]])]),s("button",{class:"btn-3 h-[32px] px-3",onClick:D(ie,["prevent"])},e[8]||(e[8]=[s("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])):g("",!0),e[9]||(e[9]=s("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),s("span",null,a(V.value),1),C.value?(i(),u("span",Qe,"("+a(C.value)+")",1)):g("",!0)]),s("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:D(be,["prevent"]),disabled:I(k).loading,title:"Print"},e[10]||(e[10]=[s("i",{class:"fas fa-print"},null,-1)]),8,Ye)]),c.selfOnly?g("",!0):(i(),u("div",He,[s("div",Je,[j(Pe,{ref_key:"employeeFilterRef",ref:Z,company_id:l.companyId,"onUpdate:company_id":e[2]||(e[2]=n=>l.companyId=n),department_id:l.departmentId,"onUpdate:department_id":e[3]||(e[3]=n=>l.departmentId=n),employee_id:l.employeeId,"onUpdate:employee_id":e[4]||(e[4]=n=>l.employeeId=n),line_type:l.lineType,"onUpdate:line_type":e[5]||(e[5]=n=>l.lineType=n),"initial-value":I(A).query,onFilterChange:ve,class:"flex-1 min-w-[240px]"},{default:Q(()=>[s("div",Xe,[s("button",{class:"btn-3 h-[32px] px-3",onClick:D(re,["prevent"])},e[12]||(e[12]=[s("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),s("div",Ze,[e[13]||(e[13]=s("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),ue(s("input",{id:"month",type:"month","onUpdate:modelValue":e[1]||(e[1]=n=>p.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[pe,p.value]])]),s("button",{class:"btn-3 h-[32px] px-3",onClick:D(ie,["prevent"])},e[14]||(e[14]=[s("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),c.selfOnly?(i(),u("div",et,[e[15]||(e[15]=s("i",{class:"fas fa-user-lock"},null,-1)),O(" Showing only my todos (Employee ID: "+a(_.value||"loading...")+") ",1)])):g("",!0)])])),q.value?(i(),u("div",tt,[c.selfOnly?g("",!0):(i(),u("div",st,[s("div",nt,[e[16]||(e[16]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),s("div",ot,a($.value.length),1)]),s("div",lt,[e[17]||(e[17]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),s("div",at,a(F.value.totalTodos),1)]),s("div",rt,[e[18]||(e[18]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),s("div",it,a(F.value.completed),1)]),s("div",dt,[e[19]||(e[19]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),s("div",ut,a(F.value.working),1)]),s("div",pt,[e[20]||(e[20]=s("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),s("div",ct,a(F.value.pending),1)])])),$.value.length===0?(i(),u("div",mt," No data available for the selected month. ")):g("",!0),(i(!0),u(Y,null,H($.value,(n,f)=>{var y,x,h,w,o,r,m;return i(),u("div",{key:((y=n.user)==null?void 0:y.id)||f,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[s("div",ft,[c.selfOnly?(i(),u("div",_t,[j(ce,{user:n.user,size:"medium"},null,8,["user"]),s("div",null,[s("div",kt,a(((o=n.user)==null?void 0:o.name)||"Unknown user"),1),s("div",wt,a(((m=(r=n.user)==null?void 0:r.department)==null?void 0:m.name)||"-"),1),s("div",Tt,[O(" Month: "+a(V.value)+" ",1),C.value?(i(),u("span",Dt,"("+a(C.value)+")",1)):g("",!0)])])])):(i(),u("div",yt,[j(je,{user:n.user},{trigger:Q(()=>[j(ce,{user:n.user,size:"medium"},null,8,["user"])]),_:2},1032,["user"]),s("div",null,[s("div",xt,[s("a",{href:I($e)(n.user,p.value),target:"_blank",rel:"noopener",class:"inline-flex hover:underline"},[s("div",null,[O(a(((x=n.user)==null?void 0:x.name)||"Unknown user")+" ",1),e[21]||(e[21]=s("i",{class:"far fa-external-link-alt print:hidden"},null,-1))])],8,vt)]),s("div",gt,a(((w=(h=n.user)==null?void 0:h.department)==null?void 0:w.name)||"-"),1),s("div",bt,[O(" Month: "+a(V.value)+" ",1),C.value?(i(),u("span",ht,"("+a(C.value)+")",1)):g("",!0)])])])),s("div",It,[s("span",Ct," Total "+a(n.totals.total),1),s("span",Ot," Done "+a(n.totals.completed),1),s("span",Mt," Working "+a(n.totals.working),1),s("span",St," Pending "+a(n.totals.pending),1)])]),s("div",Nt,[s("table",Et,[e[24]||(e[24]=s("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[s("tr",{class:"border-b"},[s("th",{class:"px-4 py-3 border text-center w-12"},"sl"),s("th",{class:"px-4 py-3 border text-left"},"Todo"),s("th",{class:"px-4 py-3 border text-left"},"Last Activity"),s("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),s("tbody",null,[n.projects.length===0?(i(),u("tr",Rt,e[22]||(e[22]=[s("td",{colspan:"4",class:"px-4 py-6 text-center text-gray-400 border rounded-b"}," No activity recorded for this month. ",-1)]))):g("",!0)]),(i(!0),u(Y,null,H(n.projects,b=>(i(),u("tbody",{key:b.id},[s("tr",Pt,[s("td",Ut,[e[23]||(e[23]=s("i",{class:"fas fa-project-diagram mr-2"},null,-1)),O(" "+a(b.name)+" ",1),s("span",jt,"("+a(b.todos.length)+" todos)",1)])]),(i(!0),u(Y,null,H(b.todos,(d,T)=>{var P,U;return i(),u("tr",{key:ee(d),class:"border-b cursor-pointer hover:bg-slate-50"},[s("td",At,a(T+1),1),s("td",Bt,[s("a",{href:"#",class:"text-blue-600 hover:underline",onClick:D(Te=>de(d),["prevent"])},[s("div",$t,[s("span",null,a(d.title),1),se(d)>1?(i(),u("span",Ft," + "+a(se(d))+" dates ",1)):g("",!0)]),s("div",{class:"text-xs text-gray-500",onClick:D(Te=>de(d),["prevent"])},a(((U=(P=d.todo)==null?void 0:P.todoable)==null?void 0:U.title)||""),9,Vt)],8,Lt)]),s("td",qt,a(I(J)(d.date)||d.date),1),s("td",Gt,[s("div",{class:Re(["inline-block text-xs font-semibold px-2.5 py-1 rounded-full whitespace-nowrap",I(Le)(d.status)])},a(d.status==="WORKING"?"IN PROGRESS":d.status||"N/A"),3)])])}),128))]))),128))])])])}),128))])):g("",!0),!q.value&&!I(k).loading?(i(),u("div",zt,e[25]||(e[25]=[s("i",{class:"fad fa-tasks text-4xl"},null,-1),s("div",{class:"empty-state glass-panel"},[s("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),s("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)]))):I(k).loading?(i(),Ee(Ue,{key:3},{default:Q(()=>e[26]||(e[26]=[O("Loading report...")])),_:1,__:[26]})):g("",!0),j(Ve,{todoModal:R.value,userRole:"employee",onCancelClick:z,onTodoUpdate:he,onTodoDateUpdate:_e,onClickEdit:ke,onClickAddTodoDate:we},null,8,["todoModal"])]))}},ys=De(Kt,[["__scopeId","data-v-0add1910"]]);export{ys as default};
