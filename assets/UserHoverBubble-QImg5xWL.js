import{r as p,G as re,x as _,h as ie,y as de,q as ue,c as u,o as d,N as O,i as ce,a as i,d as H,M as W,j as g,t as v,l as me,O as ve,F as j,e as pe,b as ge,T as be,Y as fe,V as he,A as ye}from"./index-I790ZeqQ.js";import{u as _e}from"./user-Dqgu7M5q.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const we={class:"flex items-start gap-2"},ke={class:"leading-tight"},Be={class:"font-medium text-gray-800"},Te={key:0,class:"text-xs text-gray-500"},Se={class:"flex items-start gap-3"},Ue={class:"flex-1 min-w-0"},Ee={class:"font-semibold text-gray-900 leading-tight truncate"},Le={class:"text-xs text-gray-500 leading-tight"},Me={key:0},$e={key:1,class:"mx-1"},He={key:2},Ce={key:0,class:"text-[11px] text-gray-500"},De={class:"text-blue-500 mt-1 text-[11px]"},Ie={class:"mt-3 grid grid-cols-[110px_1fr] gap-x-3 gap-y-1 text-xs"},Fe={class:"text-gray-500"},Ne={class:"text-gray-800 font-medium truncate"},Re={key:0,class:"mt-3"},ze=["href"],Ae={key:1,class:"mt-2 text-[11px] text-indigo-600"},Pe={key:2,class:"mt-2 text-[11px] text-red-600"},Ve=120,Oe={__name:"UserHoverBubble",props:{user:{type:Object,default:()=>({})}},setup(q){const b=q,G=_e(),x=p(!1),w=p(!1),f=p(""),E=p(null),L=p(!1),C=p(null),D=p({}),I=p(null),c=re({trigger:!1,bubble:!1});let k=null;const F=new Date,Y=`${F.getFullYear()}-${String(F.getMonth()+1).padStart(2,"0")}`,h=()=>{k&&(clearTimeout(k),k=null)},J={executive:"Executive",support_staff:"Support Staff",doctor:"Doctor",academy_body:"Academy Body"},s=_(()=>({...b.user||{},...E.value||{}})),B=_(()=>{var e,t;return J[(e=s.value)==null?void 0:e.type]||((t=s.value)==null?void 0:t.type)||""}),N=_(()=>{var l,r,m;const e=s.value||{},t=(e==null?void 0:e.id)||(e==null?void 0:e.user_id)||(e==null?void 0:e.employee_id);if(!t)return"";const o=((l=e==null?void 0:e.department)==null?void 0:l.id)||(e==null?void 0:e.department_id),n=((m=(r=e==null?void 0:e.department)==null?void 0:r.company)==null?void 0:m.id)||(e==null?void 0:e.company_id),a=new URLSearchParams;return o&&a.set("department_id",o),n&&a.set("company_id",n),a.set("employee_id",t),a.set("date",Y),`/hrd/em-attendance?${a.toString()}`}),K=_(()=>{var o,n,a,l,r;const e=s.value||{};return[{label:"Employee ID",value:e.employee_id||e.employeeId||e.id},{label:"Employment type",value:e.employment_type},{label:"Email",value:e.email},{label:"Phone",value:e.phone||e.contact_number||e.mobile},{label:"Designation",value:(o=e.designation)==null?void 0:o.title},{label:"Department",value:(n=e.department)==null?void 0:n.name},{label:"Company",value:((l=(a=e.department)==null?void 0:a.company)==null?void 0:l.name)||((r=e.company)==null?void 0:r.name)},{label:"Line Type",value:B.value},{label:"Blood Group",value:e.blood}].map(m=>({...m,value:m.value||"-"}))}),Q=_(()=>{var t,o,n,a,l,r;if(!((t=b.user)!=null&&t.id))return!1;const e=s.value||{};return!e.email||!(e.phone||e.contact_number||e.mobile)||!((o=e.department)!=null&&o.name)||!((n=e.designation)!=null&&n.name)||!((l=(a=e.department)==null?void 0:a.company)!=null&&l.name||(r=e.company)!=null&&r.name)}),X=()=>{E.value=null,L.value=!1,f.value=""},Z=async()=>{var e;if(!(!Q.value||!((e=b.user)!=null&&e.id)||L.value||w.value)){w.value=!0,f.value="";try{const t=await G.fetchUser(b.user.id);t&&(E.value=t),L.value=!0}catch{f.value="Unable to load full profile right now."}finally{w.value=!1}}},R=()=>{var y;const e=C.value;if(!e)return;const t=e.getBoundingClientRect(),o=320,n=12,a=((y=I.value)==null?void 0:y.offsetHeight)||0,l=window.innerHeight-t.bottom-8,r=t.top-8,m=a&&a>l&&r>l,S=Math.min(Math.max(t.left,n),window.innerWidth-o-n),U=m?t.top-a-8:t.bottom+8;D.value={top:`${Math.max(U,n)}px`,left:`${S}px`,width:`${Math.min(o,window.innerWidth-n*2)}px`}},z=async()=>{x.value=!0,await ye(),R(),await Z()},ee=()=>{x.value=!1},M=()=>{c.trigger||c.bubble||(h(),k=setTimeout(()=>{!c.trigger&&!c.bubble&&ee()},Ve))},T=()=>{x.value&&R()};ie(()=>{window.addEventListener("resize",T),window.addEventListener("scroll",T,!0)}),de(()=>{window.removeEventListener("resize",T),window.removeEventListener("scroll",T,!0),h()}),ue(()=>{var e;return(e=b.user)==null?void 0:e.id},()=>{X()});const te=()=>{h(),c.trigger=!0,z()},ae=()=>{c.trigger=!1,M()},se=()=>{h(),c.trigger=!0,z()},ne=()=>{c.trigger=!1,M()},oe=()=>{h(),c.bubble=!0},le=()=>{c.bubble=!1,M()};return(e,t)=>(d(),u("div",he({class:"relative flex items-start"},e.$attrs,{onMouseenter:te,onMouseleave:ae,onFocusin:se,onFocusout:ne,ref_key:"triggerRef",ref:C}),[O(e.$slots,"trigger",{user:s.value},()=>{var o,n,a,l,r;return[i("div",we,[H(W,{size:"medium",user:s.value,class:"inline-block align-middle"},null,8,["user"]),i("div",ke,[i("div",Be,v(((o=s.value)==null?void 0:o.name)||"Unknown user"),1),(a=(n=s.value)==null?void 0:n.department)!=null&&a.name?(d(),u("div",Te,v((r=(l=s.value)==null?void 0:l.department)==null?void 0:r.name),1)):g("",!0)])])]},!0),(d(),ce(fe,{to:"body"},[H(be,{name:"fade-scale"},{default:me(()=>{var o,n,a,l,r,m,S,U,y,A,P,V;return[x.value?(d(),u("div",{key:0,class:"fixed z-50 rounded-xl border border-gray-200 bg-white p-4 shadow-xl overflow-y-auto max-h-[40vh] w-80 md:w-96",style:ve(D.value),ref_key:"bubbleRef",ref:I,onMouseenter:oe,onMouseleave:le},[i("div",Se,[H(W,{user:s.value,size:"xlarge"},null,8,["user"]),i("div",Ue,[i("div",Ee,v(((o=s.value)==null?void 0:o.name)||"Unknown user"),1),i("div",Le,[(a=(n=s.value)==null?void 0:n.designation)!=null&&a.title?(d(),u("span",Me,v((r=(l=s.value)==null?void 0:l.designation)==null?void 0:r.title),1)):g("",!0),(S=(m=s.value)==null?void 0:m.designation)!=null&&S.title&&B.value?(d(),u("span",$e," • ")):g("",!0),B.value?(d(),u("span",He,v(B.value),1)):g("",!0)]),(U=s.value)!=null&&U.employee_id?(d(),u("div",Ce," ID: "+v((y=s.value)==null?void 0:y.employee_id),1)):g("",!0),i("div",De," Shift: "+v(((V=(P=(A=s.value)==null?void 0:A.current_shift)==null?void 0:P.shift)==null?void 0:V.name)||"N/A"),1),i("div",null,[O(e.$slots,"afterHeader",{user:s.value},void 0,!0)])])]),i("dl",Ie,[(d(!0),u(j,null,pe(K.value,$=>(d(),u(j,{key:$.label},[i("dt",Fe,v($.label),1),i("dd",Ne,v($.value),1)],64))),128))]),N.value?(d(),u("div",Re,[i("a",{href:N.value,target:"_blank",rel:"noopener",class:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-md shadow-sm"},t[0]||(t[0]=[i("i",{class:"far fa-external-link-alt"},null,-1),ge(" Open Job Card ")]),8,ze)])):g("",!0),w.value?(d(),u("div",Ae,"Loading more details…")):f.value?(d(),u("div",Pe,v(f.value),1)):g("",!0)],36)):g("",!0)]}),_:3})]))],16))}},Ge=xe(Oe,[["__scopeId","data-v-31d352b7"]]);export{Ge as U};
