import{B as N,r as f,C as u}from"./index-7Svn_c9o.js";const M=N("notice",()=>{const b=f([]),m=f([]),w=f([]),v=f({}),o=f(null),c=f(!1),g=f([]),y=f(0);return{notices:m,notice:v,error:o,isLoading:c,policies:w,feedbacks:g,totalFeedbacks:y,fetchPolices:async()=>{var e,s,t;try{c.value=!0;const a=await u.get("/policies");w.value=(e=a==null?void 0:a.data)==null?void 0:e.polices,o.value=null}catch(a){o.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Something went wrong"}finally{c.value=!1}},fetchFileUpload:async e=>{var s,t;try{return c.value=!0,(await u.post("file-upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(a){o.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Something went wrong"}finally{c.value=!1}},createNoticeFeedback:async(e,s)=>{var t,a;try{return c.value=!0,await u.post(`/user/notice/feedback/${e}`,s)}catch(n){o.value=((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Something went wrong"}finally{c.value=!1}},fetchNotices:async()=>{var e,s;try{c.value=!0;const t=await u.get("/notices");m.value=t==null?void 0:t.data,o.value=null}catch(t){o.value=((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.message)||"Something went wrong"}finally{c.value=!1}},fetchNotice:async e=>{var s,t;try{c.value=!0;const n=(await u.get(`/notices/${e}`)).data;return n&&(v.value=n),o.value=null,n}catch(a){o.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Something went wrong"}finally{c.value=!1}},createNotice:async e=>{var s,t,a,n,i,l,h;try{c.value=!0,o.value=null;const{data:r}=await u.post("/notices",{title:e.title,type:e.type,description:e.description,published_at:e.published_at,expired_at:e.expired_at,receiver_type:e.receiver_type,all_companies:!!e.all_companies,all_departments:!!e.all_departments,all_employees:!!e.all_employees,company_ids:e.company_ids||[],department_ids:e.department_ids||[],employee_ids:e.employee_ids||[]});let d=r==null?void 0:r.notice;if(d!=null&&d.id&&e.file instanceof Blob){const p=new FormData;p.append("file",e.file,e.file.name||"attachment"),d=((s=(await u.post(`/notices/${d.id}/file`,p,{transformRequest:[_=>_],headers:{}})).data)==null?void 0:s.notice)||d}return d&&m.value.unshift(d),d}catch(r){const d=(a=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:a.message,p=(i=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:i.errors;throw o.value=p?((h=(l=Object.values(p))==null?void 0:l[0])==null?void 0:h[0])||d:d||(r==null?void 0:r.message)||"Something went wrong",r}finally{c.value=!1}},updateNotice:async(e,s)=>{var t,a;try{c.value=!0;const n=await u.put(`/notices/${e}`,s),i=b.value.findIndex(l=>l.id===e);i!==-1&&(v.value[i]=n.data.notice),o.value=null}catch(n){o.value=((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Something went wrong"}finally{c.value=!1}},fetchUserNotices:async()=>{var e,s,t;try{c.value=!0;const a=await u.get("/user/notices");m.value=(e=a==null?void 0:a.data)==null?void 0:e.notices,o.value=null}catch(a){o.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Something went wrong"}finally{c.value=!1}},fetchNoticeDetails:async e=>{var s,t;try{c.value=!0;const n=(await u.get(`/notices/details/${e}`)).data;return n&&(v.value=n),o.value=null,n}catch(a){o.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Something went wrong"}finally{c.value=!1}},fetchFeedbacks:async(e,s={})=>{var a,n,i;const t=await u.get(`/notice/feedbacks/${e}`,s);g.value=(a=t==null?void 0:t.data)==null?void 0:a.data,y.value=(i=(n=t==null?void 0:t.data)==null?void 0:n.meta)==null?void 0:i.total},downloadFeedbackUserExcel:async(e,s={})=>{var t,a;c.value=!0;try{const n=await u.get(`/notice/feedbacks/${e}?flag=excel`,{params:s,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([n.data])),l=document.createElement("a");l.href=i,l.setAttribute("download",`notice_feedback_users_${e}.xlsx`),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(n){o.value=((a=(t=n.response)==null?void 0:t.data)==null?void 0:a.message)||"Something went wrong",console.error(o.value)}finally{c.value=!1}},updateNoticeFile:async(e,s,{onProgress:t,signal:a}={})=>{const n=new FormData;n.append("file",s,s.name||"attachment");const{data:i}=await u.post(`/notices/${e}/file`,n,{transformRequest:[l=>l],headers:{},onUploadProgress:l=>{if(t&&l.total){const h=Math.round(l.loaded*100/l.total);t(h)}},signal:a});return i==null?void 0:i.notice}}});export{M as u};
