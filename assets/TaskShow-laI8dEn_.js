import{G as Q,r as I,e as X,H as ot,A as Y,c as p,o as n,f as v,a as t,t as y,I as A,n as $,h as i,w as C,l as g,p as T,E as Z,m as w,F as tt,x as lt,J as it,K as G,g as dt,v as ut,b as pt,u as ct,d as mt,q as D,k as W,y as J}from"./index-BP02WKKP.js";import{L as K}from"./LoaderView-CKsV7CBK.js";import{u as kt,_ as ft,O as L}from"./task-priority-Bgm9fANJ.js";import{a as yt}from"./TaskAddForm-Dh66dplJ.js";import{_ as vt}from"./TaskEditForm-_e9cZ76I.js";import{_ as gt,a as bt,b as xt}from"./TaskTreeView-BGsufIoV.js";import{g as P}from"./datetime-BISRKKpq.js";import{_ as et}from"./UserChip-Ct7O4fUK.js";import{u as _t}from"./useTaskStore-Ck9K5RhH.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-B_lkEsPy.js";import"./company-BacxdSYi.js";import"./useRequirementStore-HwmkS4e4.js";import"./SectionLoading-BW9ds3u3.js";const ht={key:0},Tt={key:0},$t={key:1},wt=Q({__name:"CountdownTimer",props:{targetDateTime:{}},setup(l){const s=l,e=I(u());let r;function u(){const m=new Date(s.targetDateTime).getTime()-new Date().getTime(),x=Math.floor(m/1e3%60),f=Math.floor(m/1e3/60%60),d=Math.floor(m/(1e3*60*60)%24),c=Math.floor(m/(1e3*60*60*24));return{total:m,days:c,hours:d,minutes:f,seconds:x}}function o(){e.value=u()}return X(()=>{r=setInterval(()=>{o(),e.value.total<=0&&clearInterval(r)},1e3)}),ot(()=>clearInterval(r)),Y(()=>s.targetDateTime,()=>{o(),clearInterval(r)}),(m,x)=>e.value.total>0?(n(),p("div",ht,[e.value.days?(n(),p("span",Tt,y(e.value.days)+"d ",1)):v("",!0),t("span",null,y(e.value.hours.toString().padStart(2,"0"))+"h :",1),t("span",null,y(e.value.minutes.toString().padStart(2,"0"))+"m :",1),t("span",null,y(e.value.seconds.toString().padStart(2,"0"))+"s",1)])):(n(),p("div",$t,[A(m.$slots,"expired",{},()=>[x[0]||(x[0]=$("Timeâ€™s up!"))])]))}}),Ct={class:"mb-3"},St={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},It={key:1,class:"text-center py-4 text-gray-500"},Dt={key:2,class:"text-center py-4 text-red-500"},Ut={key:3,class:"space-y-4"},Pt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(l,{emit:s}){const e=l,r=s,u=I(null),{handleItemsPriorityUpdate:o,saveTaskPriority:m,listHasRearranged:x}=kt(()=>e.tasks,e.parentId),f=async()=>{await m(),r("updatePriority")};return(d,c)=>(n(),p("div",null,[t("div",Ct,[A(d.$slots,"task:header")]),i(x)?(n(),p("div",St,[c[3]||(c[3]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:C(f,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:c[0]||(c[0]=C((...k)=>u.value.resetItems&&u.value.resetItems(...k),["prevent"]))},"Discard")])):v("",!0),l.loading?(n(),p("div",It,"Loading tasks...")):l.error?(n(),p("div",Dt,y(l.error),1)):(n(),p("div",Ut,[g(ft,{items:l.tasks,handle:"handle",onItemsUpdate:i(o),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:u},{item:T(({item:k,index:h})=>[g(gt,{index:h,task:k,showDraggableHandle:!0,"tree-level":l.treeLevel,class:"!border-0",onCommentButtonClick:S=>r("commentButtonClick",k.id),onEditClick:c[1]||(c[1]=S=>r("editClick",S)),onAddClick:c[2]||(c[2]=S=>r("addClick",S))},null,8,["index","task","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Lt={class:"flex justify-between mt-5"},At={class:"flex flex-wrap items-center gap-2 mt-3"},Et={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0}},emits:["created","error","updatePriority"],setup(l,{emit:s}){const e=l,r=s,u=I(),o=Z({show:!1,parentId:e.parentId,requirementId:null}),m=c=>{o.show=!0,o.parentId=c,console.log({addForm:o})};function x(){o.show=!1,o.parentId=e.parentId,r("created")}function f(){u.value=!1,r("updated")}function d(){o.show=!1,o.parentId=e.parentId}return(c,k)=>(n(),p("div",null,[u.value?(n(),w(L,{key:0},{default:T(()=>[g(vt,{taskId:u.value,onClose:k[0]||(k[0]=h=>u.value=null),onUpdated:f},null,8,["taskId"])]),_:1})):v("",!0),o.show?(n(),w(L,{key:1},{default:T(()=>[g(yt,{parentTaskId:o.parentId,requirementId:o.requirementId,onTaskCreated:x,onError:c.handleTaskError,onClose:d},null,8,["parentTaskId","requirementId","onError"])]),_:1})):v("",!0),g(Pt,{tasks:l.subTasks,parentId:l.parentId,treeLevel:l.treeLevel,onAddClick:k[2]||(k[2]=h=>m(h)),onEditClick:k[3]||(k[3]=h=>u.value=h),onUpdatePriority:k[4]||(k[4]=h=>r("updatePriority"))},{"task:header":T(()=>[t("div",Lt,[k[5]||(k[5]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-2xl font-bold text-gray-800"},"Sub Tasks")],-1)),t("div",At,[t("button",{class:"btn-1 ml-auto",onClick:k[1]||(k[1]=C(()=>m(l.parentId),["prevent"]))}," Add Sub Task ")])])]),_:1},8,["tasks","parentId","treeLevel"])]))}},Mt={class:"min-w-full bg-white rounded overflow-hidden"},Bt={class:"py-0.5 text-bg font-semibold"},Ft={class:"px-2 py-1 border-y"},Nt={class:"px-2 py-1 border-y"},Rt={class:"px-2 py-1 border-y text-center"},jt={class:"px-2 py-1 border-y text-center"},qt={class:"px-2 py-1 border-y text-center"},Vt={class:"px-2 py-1 border-y text-center"},Ot=Q({__name:"TaskProgressTable",props:{progressUsers:{}},setup(l){return(s,e)=>(n(),p("table",Mt,[t("caption",Bt,[A(s.$slots,"caption",{},()=>[e[0]||(e[0]=$("Progress"))])]),e[1]||(e[1]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," User Progress "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"}," Task Progress ")])],-1)),t("tbody",null,[(n(!0),p(tt,null,lt(s.progressUsers,(r,u)=>(n(),p("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ft,y(u+1),1),t("td",Nt,[g(et,{user:r},null,8,["user"])]),t("td",Rt,y(i(P)(r.started_at)),1),t("td",jt,y(i(P)(r.finished_at)),1),t("td",qt,y(r.user_progress)+"%",1),t("td",Vt,y(r.task_progress)+"%",1)]))),128))])]))}}),zt=it("task-user",()=>({updateUserStartDate:async(e,r,u)=>await G.patch(`/task-user/task/${e}/user/${r}/update-start-date/${u}`),updateUserFinishDate:async(e,r,u)=>await G.patch(`/task-user/task/${e}/user/${r}/update-finish-date/${u}`)})),Ht={class:"border-b text-center"},Gt={key:0},Wt={key:1},Jt={class:"mb-2 mt-6"},Kt={class:"flex justify-center"},Qt={class:"py-6"},Xt={class:"mt-2"},Yt={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Zt={class:"flex justify-between items-center"},te={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(l,{emit:s}){const e=l,r=s,u=zt(),o=I(""),m=I("");async function x(){var f,d;console.log({date:o.value});try{e.type=="start-date"?await u.updateUserStartDate(e.task.id,e.user.id,o.value||"0"):e.type=="finish-date"&&await u.updateUserFinishDate(e.task.id,e.user.id,o.value||"0"),r("updateDate")}catch(c){m.value=((d=(f=c.response)==null?void 0:f.data)==null?void 0:d.message)||`Failed to update ${e.type}`}}return(f,d)=>(n(),p("form",{class:"p-4",onSubmit:C(x,["prevent"])},[t("div",Ht,[l.type=="start-date"?(n(),p("h2",Gt,"Edit Start Date")):l.type=="finish-date"?(n(),p("h2",Wt,"Edit Finish Date")):v("",!0)]),t("div",Jt,[d[2]||(d[2]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,y(l.task.title),1)]),t("div",null,[d[3]||(d[3]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"User:",-1)),g(et,{user:l.user},null,8,["user"])]),t("div",Kt,[t("div",Qt,[d[4]||(d[4]=t("label",{class:"block text-xs font-semibold"},"Date",-1)),dt(t("input",{type:"date","onUpdate:modelValue":d[0]||(d[0]=c=>o.value=c),class:"border py-2 px-4 rounded-md",size:"8"},null,512),[[ut,o.value]])])]),t("div",Xt,[m.value?(n(),p("div",Yt,y(m.value),1)):v("",!0)]),t("div",Zt,[d[5]||(d[5]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1)),t("button",{class:"btn-3",onClick:d[1]||(d[1]=C(c=>r("closeClick"),["prevent"]))},"Close")])],32))}},ee=l=>l==null?void 0:l.reduce((s,e)=>s+e.task_weight,0),se=(l,s)=>{const e=ee(l);return l.map(r=>{const u=s.filter(o=>o.user_id===r.id).reduce((o,m)=>o+m.progress,0);return{...r,task_progress:Math.floor(u*(r.task_weight/e)),user_progress:u}})},ae={class:"container mx-auto p-6"},ne={key:2,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},re={class:"grid grid-cols-4"},oe={class:"mb-4 flex col-span-full"},le={class:"font-medium text-xl"},ie={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},de={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},ue={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},pe={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},ce={class:"mt-4 col-span-full mb-6"},me={class:"ml-auto text-right text-sm col-span-full"},ke={key:1,class:"text-gray-500"},fe={class:"font-semibold text-green-800"},ye={key:2,class:"ml-4 text-gray-500"},ve={class:"text-red-500 font-semibold"},ge={class:"py-2 flex justify-center items-center gap-2 col-span-full"},be=["disabled"],xe=["disabled"],_e={class:"ml-auto flex gap-4"},he={key:0},Te={key:1},$e={key:1,class:"text-center py-4 text-red-500"},Re={__name:"TaskShow",setup(l){const s=_t(),e=pt(),r=ct(),u=mt(),o=I(""),m=D(()=>s.tasks),x=I({});X(async()=>{o.value="loading",await d(e.params.id),o.value=""});const f=Z({user:null,type:""});async function d(b){await s.fetchTask(b)}const c=D(()=>se(s.task.users,s.task.task_reports||[])),k=D(()=>c.value.find(b=>{var a;return b.id===((a=u.user)==null?void 0:a.id)})),h=D(()=>P(s.task.started_at)),S=D(()=>P(s.task.deadline));function E(b){f.user=u.user,f.type=b}async function st(){await d(e.params.id),f.user=null,f.type=""}const at=b=>{r.push({name:"TaskEdit",params:{id:b}})},nt=D(()=>{var b,a;return s.task?((b=s.task)==null?void 0:b.parent_id)==0?{name:"TaskList"}:{name:"TaskShow",params:{id:(a=s.task)==null?void 0:a.parent_id}}:null});return Y(()=>e.params.id,async b=>{o.value="changing",await d(b),o.value=""}),(b,a)=>{var M,B,F,N,R,j,q,V,O,z;const U=W("RouterLink"),rt=W("router-view");return n(),p("div",ae,[f.user?(n(),w(L,{key:0},{default:T(()=>[g(te,{task:i(s).task,user:f.user,type:f.type,onCloseClick:a[0]||(a[0]=_=>f.user=null),onUpdateDate:st},null,8,["task","user","type"])]),_:1})):v("",!0),o.value==="loading"?(n(),w(K,{key:1})):(n(),p("div",ne,[i(s).task?(n(),p(tt,{key:0},[t("section",re,[t("div",oe,[t("div",null,[t("h2",le,y(i(s).task.title),1),t("div",ie,[(M=i(s).task)!=null&&M.is_important?(n(),p("span",de,"IMPORTANT")):v("",!0),(B=i(s).task)!=null&&B.is_urgent?(n(),p("span",ue,"URGENT")):v("",!0)])]),t("div",pe,[g(bt,{status:(F=i(s).task)==null?void 0:F.status,progressPercent:(N=i(s).task)==null?void 0:N.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),i(s).task?(n(),w(xt,{key:0,task:i(s).task,ref_key:"progress",ref:x,class:"!text-lg"},null,8,["task"])):v("",!0)])]),t("section",ce,[g(Ot,{"progress-users":c.value},{caption:T(()=>a[11]||(a[11]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["progress-users"])]),t("div",me,[i(s).task.deadline?(n(),w(wt,{key:0,targetDateTime:i(s).task.deadline,class:"text-lg font-semibold italic text-green-600"},null,8,["targetDateTime"])):v("",!0),h.value?(n(),p("span",ke,[a[12]||(a[12]=$(" Started: ")),t("span",fe,y(h.value),1)])):v("",!0),S.value?(n(),p("span",ye,[a[13]||(a[13]=$(" Deadline: ")),t("span",ve,y(S.value),1)])):v("",!0)]),a[18]||(a[18]=t("hr",{class:"my-3 col-span-full"},null,-1)),t("div",ge,[t("button",{onClick:a[1]||(a[1]=C(_=>{var H;return at((H=i(s).task)==null?void 0:H.id)},["stop"])),class:"btn-2 py-0.5"},"Edit"),g(U,{to:{name:"TaskUserAssign",params:{id:(R=i(s).task)==null?void 0:R.id}},class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:a[2]||(a[2]=_=>_.stopPropagation())},{default:T(()=>a[14]||(a[14]=[t("i",{class:"fas fa-user-plus"},null,-1),$(" Assign Users ")])),_:1,__:[14]},8,["to"]),g(U,{to:nt.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",onClick:a[3]||(a[3]=_=>_.stopPropagation())},{default:T(()=>a[15]||(a[15]=[t("i",{class:"fas fa-arrow-left"},null,-1),$(" Back ")])),_:1,__:[15]},8,["to"]),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:a[4]||(a[4]=C(()=>E("start-date"),["prevent"])),disabled:!!((j=k.value)!=null&&j.started_at)}," Set Started Date ",8,be),t("button",{class:"btn-3 px-3 py-0.5 font-semibold border disabled:opacity-30 disabled:pointer-events-none",onClick:a[5]||(a[5]=C(()=>E("finish-date"),["prevent"])),disabled:!!((q=k.value)!=null&&q.finished_at)}," Set Finish Date ",8,xe),t("div",_e,[m.value.length>0?(n(),w(U,{key:0,to:{name:"TaskShow",params:{id:(V=i(s).task)==null?void 0:V.id}},onClick:a[6]||(a[6]=_=>_.stopPropagation()),class:J(["py-1 btn-3 ml-auto",{"bg-blue-500 text-white":i(e).name=="TaskShow"}])},{default:T(()=>a[16]||(a[16]=[t("i",{class:"fal fa-list-ul"},null,-1),$(" Sub Tasks ")])),_:1,__:[16]},8,["to","class"])):v("",!0),g(U,{to:{name:"TaskReports",params:{id:(O=i(s).task)==null?void 0:O.id}},onClick:a[7]||(a[7]=_=>_.stopPropagation()),class:J(["py-1 btn-3",{"bg-blue-500 text-white":i(e).name=="TaskReports"}])},{default:T(()=>a[17]||(a[17]=[t("i",{class:"fal fa-file-alt"},null,-1),$(" Reports ")])),_:1,__:[17]},8,["to","class"])])])]),i(e).name=="TaskShow"&&((z=i(s).task)==null?void 0:z.level)<=2?(n(),p("section",he,[g(Et,{subTasks:m.value,"parent-id":i(e).params.id,"tree-level":i(s).task.level+1,onCreated:a[8]||(a[8]=_=>d(i(e).params.id)),onUpdated:a[9]||(a[9]=_=>d(i(e).params.id)),onUpdatePriority:a[10]||(a[10]=_=>d(i(e).params.id))},null,8,["subTasks","parent-id","tree-level"])])):(n(),p("section",Te,[g(rt)]))],64)):(n(),p("div",$e,y(i(s).error),1)),o.value==="changing"?(n(),w(K,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):v("",!0)]))])}}};export{Re as default};
