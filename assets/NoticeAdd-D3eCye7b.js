import{i as F,s as L,A as R,r as b,p as v,b as B,q as k,c as j,a as l,w as I,d as n,D as g,k as u,l as i,h as d,z as P,v as w,m as z,n as G,o as $,g as H}from"./index-MLLiuUIY.js";import{_ as J}from"./TextEditor-BtWv3alH.js";import{u as K}from"./company-DomI0TqM.js";import{u as O}from"./department-DfYxcdmc.js";import{u as Q}from"./notice-D7BKpqqI.js";import{s as x}from"./vue-multiselect.esm-BcdAGKK3.js";const W={class:"my-container space-y-2"},X={class:"card-bg md:p-8 p-4 mx-4"},Y={class:"grid gap-4"},Z={class:"border p-4 rounded-md bg-gray-100"},h={class:"grid md:grid-cols-2 gap-4"},ee={class:"w-full"},le={class:"col-span-2 flex justify-between gap-8"},te={class:"w-full"},oe={class:"w-full"},se={class:"col-span-full"},ae={class:"col-span-full"},ne={class:"flex justify-center gap-4"},ye={__name:"NoticeAdd",setup(de){const _=F(),C=H(),m=Q(),V=K(),p=O(),{companies:N}=L(V),t=R({title:"",type:1,description:"",published_at:"",expired_at:"",company_id:"all",file:"",all_companies:!1,all_departments:!1,all_employees:!1}),r=b([]),c=b([]),S=v(()=>c.value.map(s=>s.id)),D=v(()=>r.value.map(s=>s.id)),y=b([]),U=v(()=>y.value.map(s=>s.id)),A=()=>{t.value.all_departments&&(D.value=[])},E=()=>{t.value.all_company&&(S.value=[])},T=()=>{t.value.all_employees&&(U.value=[])};B(async()=>{await V.fetchCompanies()}),k(()=>t.company_id,async s=>{await p.fetchDepartments(s)}),k(r,s=>{const e=s.map(a=>a.id);p.fetchDepartmentEmployee(e)});const M=async s=>{var a;const e=s.target.files[0];if(e){const o=new FormData;o.append("file",e),console.log({file:e});const f=await m.fetchFileUpload(o);t.file=(a=f==null?void 0:f.data)==null?void 0:a.url}},q=async()=>{var s,e;try{const a={title:t.title,type:t.type,description:t.description,published_at:t.published_at,expired_at:t.expired_at,company_id:t.company_id,company_ids:S.value,department_id:t.department_id,department_ids:D.value,employee_ids:U.value,file:t.file};await m.createNotice(a),_.success("Notice created successfully"),await m.fetchNotices(),C.replace("/hrd/notice")}catch(a){const o=((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Failed to save user";_.error(o),console.error(o)}};return(s,e)=>{const a=G("RouterLink");return $(),j("div",W,[l("div",X,[e[25]||(e[25]=l("h2",{class:"title-lg text-center"},"Add Notice",-1)),l("form",{onSubmit:I(q,["prevent"]),class:"space-y-4"},[l("div",Y,[l("div",Z,[e[21]||(e[21]=l("p",{class:"title-md"},"Notice Info",-1)),e[22]||(e[22]=l("hr",{class:"my-2"},null,-1)),l("div",h,[l("div",ee,[l("label",null,[n(l("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=o=>t.all_companies=o),onChange:E},null,544),[[g,t.all_companies]]),e[11]||(e[11]=u(" Select All Companies "))]),i(d(x),{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),options:d(N),multiple:!0,searchable:!0,placeholder:"Select companies","track-by":"id",label:"name",disabled:t.all_companies},null,8,["modelValue","options","disabled"])]),l("div",null,[e[13]||(e[13]=l("label",null,"Type*",-1)),n(l("select",{id:"type","onUpdate:modelValue":e[2]||(e[2]=o=>t.type=o),class:"w-full border rounded px-3 py-2",required:""},e[12]||(e[12]=[l("option",{value:"1"},"General",-1),l("option",{value:"2"},"Policy",-1)]),512),[[P,t.type]])]),l("div",null,[e[14]||(e[14]=l("label",null,"Publish Date*",-1)),n(l("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.published_at=o),type:"date",class:"w-full p-2 border rounded",required:""},null,512),[[w,t.published_at]])]),l("div",null,[e[15]||(e[15]=l("label",null,"Expired Date*",-1)),n(l("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>t.expired_at=o),type:"date",class:"w-full p-2 border rounded",required:""},null,512),[[w,t.expired_at]])]),l("div",le,[l("div",te,[l("label",null,[n(l("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=o=>t.all_departments=o),onChange:A},null,544),[[g,t.all_departments]]),e[16]||(e[16]=u(" Select All Departments "))]),i(d(x),{modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=o=>r.value=o),options:d(p).departments,multiple:!0,searchable:!0,placeholder:"Select departments","track-by":"id",label:"name",disabled:t.all_departments},null,8,["modelValue","options","disabled"])]),l("div",oe,[l("label",null,[n(l("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=o=>t.all_employees=o),onChange:T},null,544),[[g,t.all_employees]]),e[17]||(e[17]=u(" Select All Employees "))]),i(d(x),{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=o=>y.value=o),options:d(p).employees,multiple:!0,searchable:!0,"track-by":"id",label:"name",placeholder:"Select Employees",disabled:t.all_employees},null,8,["modelValue","options","disabled"])])]),l("div",se,[e[18]||(e[18]=l("label",null,"Title*",-1)),n(l("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>t.title=o),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[w,t.title]])]),l("div",null,[e[19]||(e[19]=l("label",null,"File",-1)),l("input",{onChange:M,type:"file",class:"w-full p-2 border rounded"},null,32)]),l("div",ae,[e[20]||(e[20]=l("label",null,"Description",-1)),i(J,{modelValue:t.description,"onUpdate:modelValue":e[10]||(e[10]=o=>t.description=o),cols:"30",rows:"10",class:"w-full"},null,8,["modelValue"])])])])]),l("div",ne,[i(a,{to:{name:"UserList"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:z(()=>e[23]||(e[23]=[u(" Cancel ")])),_:1}),e[24]||(e[24]=l("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1))])],32)])])}}};export{ye as default};
