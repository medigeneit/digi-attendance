import{_ as B,g as L,r as b,h as W,x as T,c as a,o as l,a as e,k as u,j as V,n as p,b as D,t as d,d as E,F as k,e as j,m as I,l as F,z as O,v as U,w as K}from"./index-BzFWZpQG.js";import{_ as z}from"./CompanyDepartmentSelectInput-DL5f_FCD.js";import{L as N}from"./LoaderView-rmeiYxPO.js";import{O as G}from"./OverlyModal-BPqHht7Q.js";import{u as q}from"./company-Bk99P8a7.js";import{u as H}from"./useTodoProjectStore-BdhKEesn.js";import"./SelectDropdown-C1cQmDvX.js";const J={class:"p-6 max-w-6xl mx-auto"},Q={class:"flex justify-between items-center mb-6"},R={key:0,class:"mb-4 text-red-600 bg-red-100 p-3 rounded"},X={key:1,class:"py-20 text-center"},Y={key:2,class:"space-y-10 pb-20"},Z={class:"flex items-center gap-2 mb-4 border-b pb-2"},ee={class:"bg-gray-200 text-gray-600 text-xs px-2 py-1 rounded-full font-bold"},te={class:"bg-white rounded-lg shadow-sm overflow-hidden border"},se={class:"w-full text-left text-sm"},oe={class:"divide-y divide-gray-100 uppercase text-[12px]"},le={class:"px-6 py-4 font-medium text-gray-800"},ae={class:"px-6 py-4 text-right space-x-3 opacity-0 group-hover:opacity-100 transition-opacity"},re=["onClick"],ne=["onClick"],ie={key:0},de={class:"flex justify-between items-center mb-4 border-b pb-2"},ce={class:"flex items-center gap-3"},ue={class:"text-lg font-bold text-blue-900 uppercase tracking-tight"},pe={class:"text-gray-400 text-xs font-medium px-2 py-0.5 border rounded uppercase"},be={class:"bg-blue-50 text-blue-600 text-xs px-2 py-1 rounded-full font-bold"},xe=["onClick"],me={class:"bg-white rounded-lg shadow-sm overflow-hidden border"},ye={class:"w-full text-left text-sm"},ge={class:"divide-y divide-gray-100 uppercase text-[12px]"},fe={class:"px-6 py-4 font-medium text-gray-800"},ve={class:"px-6 py-4 text-right space-x-3 opacity-0 group-hover:opacity-100 transition-opacity"},he=["onClick"],_e=["onClick"],we={key:0},ke={class:"bg-white overflow-hidden rounded-lg shadow-lg"},je={class:"bg-gray-50 px-6 py-4 border-b flex justify-between items-center"},Ce={class:"text-lg font-bold text-gray-800"},Pe={class:"p-6 space-y-5"},Me={key:0},Ae={class:"bg-gray-50 px-6 py-4 flex justify-end gap-3 border-t"},Te=["disabled"],Ve={__name:"TodoProjectsView",setup(De){const r=H(),v=L(),h=q(),x=b(!1),m=b(null),i=b(""),c=b(null),y=b(!1),g=b(!1);W(async()=>{v.isAdminMood&&await h.fetchMyCompanies({with:"departments"}),r.fetchProjects()});const S=T(()=>{const o=[];return h.myCompanies.forEach(t=>{t.departments.forEach(s=>{o.push({...s,company_name:t.name})})}),o}),_=T(()=>r.projects.filter(o=>!o.department_id)),w=o=>r.projects.filter(t=>t.department_id===o),C=(o=null)=>{x.value=!1,m.value=null,i.value="",c.value=o,y.value=!0},P=o=>{x.value=!0,m.value=o.id,i.value=o.title,c.value=o.department_id||null,y.value=!0},f=()=>{y.value=!1,m.value=null,i.value="",c.value=null,r.error=null},M=async()=>{if(i.value.trim())try{g.value=!0,x.value?await r.updateProject(m.value,{title:i.value,department_id:c.value}):await r.createProject({title:i.value,department_id:c.value}),f()}catch{}finally{g.value=!1}},A=async o=>{confirm("Are you sure you want to delete this project?")&&await r.deleteProject(o)};return(o,t)=>(l(),a("div",J,[e("div",Q,[t[4]||(t[4]=e("h1",{class:"text-2xl font-bold"},"Manage Project/Website/Issue for todo",-1)),p(v).isAdminMood?(l(),a("button",{key:0,onClick:t[0]||(t[0]=s=>C(null)),class:"bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700 transition"},t[3]||(t[3]=[e("i",{class:"fad fa-plus-circle mr-1"},null,-1),D(" Add Project ")]))):u("",!0)]),p(r).error?(l(),a("div",R,d(p(r).error),1)):u("",!0),p(r).loading&&!p(r).projects.length?(l(),a("div",X,[E(N),t[5]||(t[5]=e("p",{class:"mt-4 text-gray-500"},"Loading projects...",-1))])):(l(),a("div",Y,[e("section",null,[e("div",Z,[t[6]||(t[6]=e("h2",{class:"text-lg font-bold text-gray-700 uppercase tracking-wide"}," Global / All Departments ",-1)),e("span",ee,d(_.value.length),1)]),e("div",te,[e("table",se,[t[8]||(t[8]=e("thead",null,[e("tr",{class:"bg-gray-50 border-b text-gray-600 font-semibold uppercase text-[10px] tracking-wider"},[e("th",{class:"px-6 py-3"},"Project Title"),e("th",{class:"px-6 py-3 text-right"},"Actions")])],-1)),e("tbody",oe,[(l(!0),a(k,null,j(_.value,s=>(l(),a("tr",{key:s.id,class:"hover:bg-gray-50 transition-colors group"},[e("td",le,d(s.title),1),e("td",ae,[e("button",{onClick:n=>P(s),class:"text-blue-600 hover:underline"},"Edit",8,re),e("button",{onClick:n=>A(s.id),class:"text-red-500 hover:underline"}," Delete ",8,ne)])]))),128)),_.value.length===0?(l(),a("tr",ie,t[7]||(t[7]=[e("td",{colspan:"2",class:"px-6 py-8 text-center text-gray-400 italic"}," No global projects found. ",-1)]))):u("",!0)])])])]),(l(!0),a(k,null,j(S.value,s=>(l(),a("section",{key:s.id},[e("div",de,[e("div",ce,[e("h2",ue,d(s.name),1),e("span",pe,d(s.company_name),1),e("span",be,d(w(s.id).length)+" Projects ",1)]),e("button",{onClick:n=>C(s.id),class:"text-blue-600 hover:text-blue-800 text-sm font-bold flex items-center gap-1 bg-white px-3 py-1 rounded-full border border-blue-100 shadow-sm"},t[9]||(t[9]=[e("i",{class:"fad fa-plus-circle"},null,-1),D(" Add To Dept ")]),8,xe)]),e("div",me,[e("table",ye,[t[11]||(t[11]=e("thead",null,[e("tr",{class:"bg-gray-50 border-b text-gray-600 font-semibold uppercase text-[10px] tracking-wider"},[e("th",{class:"px-6 py-3"},"Project Title"),e("th",{class:"px-6 py-3 text-right"},"Actions")])],-1)),e("tbody",ge,[(l(!0),a(k,null,j(w(s.id),n=>(l(),a("tr",{key:n.id,class:"hover:bg-blue-50/30 transition-colors group"},[e("td",fe,d(n.title),1),e("td",ve,[e("button",{onClick:$=>P(n),class:"text-blue-600 hover:underline"},"Edit",8,he),e("button",{onClick:$=>A(n.id),class:"text-red-500 hover:underline"}," Delete ",8,_e)])]))),128)),w(s.id).length===0?(l(),a("tr",we,t[10]||(t[10]=[e("td",{colspan:"2",class:"px-6 py-8 text-center text-gray-400 italic"}," No project assigned. ",-1)]))):u("",!0)])])])]))),128))])),y.value?(l(),V(G,{key:3,onClick:K(f,["self"]),class:""},{default:I(()=>{var s;return[e("div",ke,[e("div",je,[e("h2",Ce,d(x.value?"Edit Project/Website/Issue":"New Project/Website/Issue"),1),e("button",{onClick:f,class:"text-gray-400 hover:text-gray-600 text-3xl font-light"}," Ã— ")]),e("div",Pe,[p(v).isAdminMood?(l(),a("div",Me,[E(z,{defaultOption:"-- Accessible for all department --",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=n=>c.value=n),companies:((s=p(h))==null?void 0:s.myCompanies)||[]},{label:I(()=>t[12]||(t[12]=[e("label",{class:"text-sm font-bold text-gray-700 block mb-2 uppercase tracking-wide"},"Target Department",-1)])),_:1},8,["modelValue","companies"]),t[13]||(t[13]=e("p",{class:"text-[10px] text-gray-400 mt-2 uppercase"}," Leave empty to make accessible for all departments. ",-1))])):u("",!0),e("div",null,[t[14]||(t[14]=e("label",{class:"text-sm font-bold text-gray-700 block mb-2 uppercase tracking-wide"}," Project/Website/Issue Title ",-1)),F(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>i.value=n),class:"w-full border-2 border-gray-100 px-4 py-3 rounded-lg focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all",placeholder:"e.g. Website Maintenance",onKeyup:O(M,["enter"]),autoFocus:""},null,544),[[U,i.value]])])]),e("div",Ae,[e("button",{onClick:f,class:"text-gray-500 hover:text-gray-700 px-4 py-2 font-medium transition"}," Cancel "),e("button",{onClick:M,class:"bg-blue-600 text-white px-8 py-2 rounded-lg font-bold shadow-lg shadow-blue-500/20 hover:bg-blue-700 disabled:opacity-50 transition flex items-center justify-center gap-2 min-w-[140px]",disabled:g.value||!i.value.trim()},[g.value?(l(),V(N,{key:0})):u("",!0),e("span",null,d(x.value?"Update":"Create"),1)],8,Te)])])]}),_:1})):u("",!0)]))}},We=B(Ve,[["__scopeId","data-v-2415f063"]]);export{We as default};
