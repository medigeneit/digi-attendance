import{u as R,b as H,d as $,r as h,e as W,A as j,c as u,o as d,a as t,p as V,w as E,g as F,h as g,v as O,B as I,t as c,F as N,y as P,k as w}from"./index-C_SSaupO.js";import{L as Q}from"./LoaderView-BCx_LAKs.js";import{_ as X}from"./TimePickerAsFloatHour-5L6tUrLW.js";import{u as Y}from"./attendance-Dslruwqh.js";import{u as z}from"./department-C8vS9jn4.js";import{u as G}from"./overtime-B5_L3UCT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"max-w-xl mx-auto p-4 space-y-4"},K={key:0,class:"text-center"},Z={class:"grid grid-cols-2 gap-2 md:gap-4"},ee=["max"],te={class:"input-1 w-full text-center px-1 bg-gray-300"},se={class:"input-1 w-full text-center px-1 bg-gray-300"},ne={class:"input-1 w-full text-center px-1 bg-gray-300"},re={class:"flex items-center"},ae={class:"col-span-full"},oe=["label"],ie=["value"],le={key:0,class:"text-red-500 text-sm"},ue=1,de=24,be={__name:"MyOvertimeAdd",setup(me){const k=R(),p=H(),q=z(),y=G(),M=Y(),_=$(),b=h(!1),f=h({}),r=h({date:"",duty_type:"",request_overtime_hours:"",assigned_in_charge_user_id:"",work_details:""}),l=n=>typeof n=="string"?n.replace(/\+/g," ").trim():"",T=(n,e,s)=>Math.max(e,Math.min(s,n)),U=n=>{const e=l(n);if(!e)return null;const s=e.match(/(\d+)\s*h/i),i=e.match(/(\d+)\s*m/i);if(s||i){const a=s?parseInt(s[1],10):0,m=i?parseInt(i[1],10):0;return a+m/60}if(/^\d{1,2}:\d{1,2}$/.test(e)){const[a,m]=e.split(":").map(v=>parseInt(v,10));if(Number.isFinite(a)&&Number.isFinite(m))return a+m/60}const o=Number(e);return Number.isFinite(o)?o:null},S=n=>{const e=l(n);if(!e)return null;const s=e.split(/\s+/),o=(s.length>=2?`${s[s.length-2]} ${s[s.length-1]}`:e).match(/^(\d{1,2}):(\d{2})\s*([AP]M)$/i);if(!o)return null;let a=parseInt(o[1],10);const m=parseInt(o[2],10),v=o[3].toUpperCase();return v==="PM"&&a!==12&&(a+=12),v==="AM"&&a===12&&(a=0),a*60+m},A=(n,e)=>{const s=S(n),i=S(e);if(s==null||i==null)return null;let o=i-s;return o<0&&(o+=24*60),o/60},C=n=>{if(!n)return"";const e=new Date(n);if(isNaN(e.getTime()))return"";const s=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0");return`${s}-${i}`},x=async()=>{var s;if(!r.value.date)return;const n=(s=_.user)==null?void 0:s.id;if(!n)return;const e=C(r.value.date);b.value=!0;try{await M.getMonthlyAttendanceByShift(n,e),f.value=await M.getUserDailyLogsByDate(n,r.value.date)}finally{b.value=!1}},D=async()=>{const n=p.query||{},e=l(n.date),s=l(n.start_time),i=l(n.end_time),o=l(n.request_overtime_hours);e&&(r.value.date=e,await x());let a=U(o);a==null&&(s||i)&&(a=A(s,i)),Number.isFinite(a)&&(r.value.request_overtime_hours=T(Math.round(a*100)/100,ue,de))},B=()=>{k.go(-1)},L=async()=>{await y.createOvertime(r.value),k.push({name:"MyOvertimeList"})};return W(async()=>{var n,e;(n=_.user)!=null&&n.id||await _.fetchUser(),await D(),!r.value.date&&((e=p.query)!=null&&e.date)&&(r.value.date=l(p.query.date),await x()),await q.fetchDepartments("all")}),j(()=>p.query,async()=>{await D()},{deep:!0}),(n,e)=>(d(),u("div",J,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:B},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Overtime Request Form",-1))]),b.value?(d(),u("div",K,[V(Q)])):(d(),u("form",{key:1,onSubmit:E(L,["prevent"]),class:"space-y-4 card-bg md:p-8 p-4 text-sm md:text-base"},[t("div",Z,[t("div",null,[e[7]||(e[7]=t("label",{for:"date",class:"block text-sm font-medium"},"Date",-1)),g(t("input",{onChange:x,type:"date",id:"date","onUpdate:modelValue":e[0]||(e[0]=s=>r.value.date=s),class:"input-1 w-full",required:"",max:new Date(Date.now()-864e5).toISOString().split("T")[0]},null,40,ee),[[O,r.value.date]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"duty_type",class:"block text-sm font-medium"},"Duty Type",-1)),g(t("select",{id:"duty_type","onUpdate:modelValue":e[1]||(e[1]=s=>r.value.duty_type=s),class:"input-1 w-full",required:""},e[8]||(e[8]=[t("option",{value:"",selected:"",disabled:""},"--Duty Type--",-1),t("option",{value:"WL"},"WL",-1),t("option",{value:"HD"},"HD",-1),t("option",{value:"OVT"},"OVT",-1)]),512),[[I,r.value.duty_type]])]),t("div",null,[e[10]||(e[10]=t("span",{class:"block text-sm font-medium"},"Check In",-1)),t("div",te,c(f.value.entry_time||"--:--"),1)]),t("div",null,[e[11]||(e[11]=t("span",{class:"block text-sm font-medium"},"Check Out",-1)),t("div",se,c(f.value.exit_time||"--:--"),1)]),t("div",null,[e[12]||(e[12]=t("span",{class:"block text-sm font-medium"},"Working Hour",-1)),t("div",ne,c(f.value.working_hours||"-"),1)]),t("div",null,[e[13]||(e[13]=t("label",{for:"request_overtime_hours",class:"block text-sm font-medium"}," Request Overtime ",-1)),t("div",re,[V(X,{modelValue:r.value.request_overtime_hours,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value.request_overtime_hours=s),"minute-interval":5,required:!0,"hour-min":1,"hour-max":24},null,8,["modelValue"])])]),t("div",ae,[e[15]||(e[15]=t("label",{for:"assigned_in_charge_user_id",class:"block text-sm font-medium"}," In-Charge ",-1)),g(t("select",{id:"assigned_in_charge_user_id","onUpdate:modelValue":e[3]||(e[3]=s=>r.value.assigned_in_charge_user_id=s),class:"input-1 w-full",required:""},[e[14]||(e[14]=t("option",{value:"",selected:"",disabled:""},"--In-Charge--",-1)),(d(!0),u(N,null,P(w(q).departments,s=>(d(),u(N,{key:s.id},[s.in_charge?(d(),u("optgroup",{key:0,label:s.name},[t("option",{value:s.in_charge.id},c(s.in_charge.name),9,ie)],8,oe)):F("",!0)],64))),128))],512),[[I,r.value.assigned_in_charge_user_id]])])]),t("div",null,[e[16]||(e[16]=t("label",{for:"assigned_in_charge_user_id",class:"block text-sm font-medium"}," Details (Reason / Work description) ",-1)),g(t("textarea",{rows:"6","onUpdate:modelValue":e[4]||(e[4]=s=>r.value.work_details=s),class:"input-1 w-full",required:""},null,512),[[O,r.value.work_details]])]),e[17]||(e[17]=t("hr",null,null,-1)),w(y).error?(d(),u("div",le,c(w(y).error),1)):F("",!0),e[18]||(e[18]=t("div",{class:"flex justify-center"},[t("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))]))}};export{be as default};
