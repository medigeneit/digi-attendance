import{p as H,r as D,e as Q,O as at,A as Y,x as h,c as l,o as s,g as _,t as c,L as G,a as t,f as V,F as O,h as J,j as $,v as X,w as T,q as P,i as A,y as U,n as I,k as W,P as lt,Q as Z,d as nt,z as ot}from"./index-DBkH8yyG.js";import{r as rt,d as it,u as dt}from"./task-DVwSJewi.js";import{L as tt}from"./LoaderView-JXku94jZ.js";import{b as L,g as ut}from"./datetime-DcVwRp76.js";import{_ as z}from"./UserChip-BWY-xgPI.js";import{O as K}from"./OverlyModal-BtYgnQVd.js";const ct={key:0},pt={key:0},ft={key:1},yt={key:2},vt={key:3},kt={key:1},mt=H({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(u){const y=u;let e=0;const i=D(v());let o;function r(){return y.millisecond&&typeof y.millisecond=="number"}function v(){r()?e&&(e-=1e3):e=new Date(y.targetDateTime).getTime()-new Date().getTime();const p=Math.floor(e/1e3%60),b=Math.floor(e/1e3/60%60),S=Math.floor(e/(1e3*60*60)%24),N=Math.floor(e/(1e3*60*60*24));return{total:e,days:N,hours:S,minutes:b,seconds:p}}function m(){i.value=v()}Q(()=>{r()&&(e=y.millisecond),console.log("MOUNTED"),m(),o=setInterval(()=>{m(),i.value.total<=0&&clearInterval(o)},1e3)}),at(()=>clearInterval(o)),Y(()=>y.targetDateTime,()=>{m(),clearInterval(o)});const n=h(()=>i.value.days.toString().padStart(2,"0")),f=h(()=>i.value.hours.toString().padStart(2,"0")),d=h(()=>i.value.minutes.toString().padStart(2,"0")),x=h(()=>i.value.seconds.toString().padStart(2,"0"));return(p,b)=>i.value.total>0?(s(),l("span",ct,[!p.hideIfZeroValue||n.value!="00"?(s(),l("span",pt,c(n.value)+"d : ",1)):_("",!0),!p.hideIfZeroValue||f.value!="00"?(s(),l("span",ft,c(f.value)+"h : ",1)):_("",!0),!p.hideIfZeroValue||d.value!="00"?(s(),l("span",yt,c(d.value)+"m : ",1)):_("",!0),!p.hideIfZeroValue||x.value!="00"?(s(),l("span",vt,c(x.value)+"s",1)):_("",!0)])):(s(),l("span",kt,[G(p.$slots,"expired")]))}}),xt={class:"mb-2 mt-6"},bt={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},_t={class:"flex justify-center"},gt={class:"py-6 w-full text-center"},ht={class:"block mb-2"},St={class:"font-semibold text-red-600 mx-2 text-xl"},$t={class:"mt-2"},Tt={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},Dt={class:"flex justify-between items-center"},Ct={key:0,class:"btn-2 bg-green-600 bg-none"},wt={key:1,class:"btn-2-red"},q=5e3,Fe={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(u,{emit:y}){const e=u,i=D(""),o=D(""),r=y,v=D("");let m=0;async function n(){var x,p;if(!i.value)return v.value="Type the task title on input box";clearTimeout(m);try{v.value="",o.value==="deleted"?(o.value="restoring",await rt(e.task.id),o.value="restored"):(o.value="deleting",await it(e.task.id,{params:{security_check:encodeURIComponent(i.value)}}),o.value="deleted"),o.value=="deleted"?m=setTimeout(()=>{d()},q):r("closeClick")}catch(b){o.value="error",v.value=((p=(x=b.response)==null?void 0:x.data)==null?void 0:p.message)||`Failed to update ${e.type}`}}function f(){o.value==="deleted"&&d(),r("closeClick")}function d(){o.value="",r("delete")}return(x,p)=>{var b,S;return s(),l("form",{class:"p-4 relative",onSubmit:T(n,["prevent"])},[p[7]||(p[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",xt,[p[1]||(p[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,c((b=u.task)==null?void 0:b.title),1)]),o.value=="deleted"?(s(),l("div",bt,p[2]||(p[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(s(),l(O,{key:1},[t("div",_t,[t("div",gt,[t("label",ht,[p[3]||(p[3]=$(" Type ")),t("span",St,c((S=u.task)==null?void 0:S.title),1),p[4]||(p[4]=$(" and submit to delete "))]),J(t("input",{type:"text","onUpdate:modelValue":p[0]||(p[0]=N=>i.value=N),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[X,i.value]])])]),p[5]||(p[5]=t("hr",null,null,-1)),t("div",$t,[v.value?(s(),l("div",Tt,c(v.value),1)):_("",!0)])],64)),t("div",Dt,[t("button",{class:P({"btn-2-red":o.value=="deleted","btn-3":o.value!="deleted"}),type:"button",onClick:T(f,["prevent"])},c(o.value==="deleted"?"Delete":"Close"),3),o.value=="deleted"?(s(),l("button",Ct,[p[6]||(p[6]=$(" Undo Delete in ")),o.value=="deleted"?(s(),V(mt,{key:0,"hide-if-zero-value":!0,millisecond:q})):_("",!0)])):(s(),l("button",wt,"Delete"))]),o.value=="deleting"||o.value=="restoring"?(s(),V(tt,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:A(()=>[$(c(String(o.value).charAt(0).toUpperCase()+String(o.value).slice(1)),1)]),_:1})):_("",!0)],32)}}},Et=u=>u==null?void 0:u.reduce((y,e)=>y+e.task_weight,0),Pt=(u,y)=>{const e=Et(u);return u.map(i=>{const o=y.filter(r=>r.user_id===i.id).reduce((r,v)=>r+v.progress,0);return{...i,task_progress:Math.floor(o*(i.task_weight/e)),user_progress:o}})},Ot=(u,y)=>{let e=0;const i=[],o=m=>m.status==="COMPLETED",r=m=>m.users.some(n=>n.id===y),v=(m,n)=>{m.forEach(f=>{const d=r(f);i[n]=i[n]||{user_id:y,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const x=d&&f.children_tasks.length===0;i[n].total_assigned+=d?1:0,i[n].total_assigned_on_leaf_task+=x?1:0,e+=x?1:0,d&&o(f)&&(i[n].completed_count++,f.children_tasks.length),f.children_tasks.length>0&&v(f.children_tasks,n+1)})};return v(u,0),{sub_task_infos:i,assigned_on_any_leaf_task:e>0}},Lt=(u,y)=>u.map(e=>({...e,...Ot(y,e.id)})),Nt={key:0,class:"min-w-full bg-white rounded overflow-hidden"},jt={class:"py-0.5 text-bg font-semibold"},Mt={class:"bg-gray-50"},Ft={class:"px-2 py-1 border-y"},Rt={class:"px-2 py-1 border-y"},Ut={key:0,class:"text-sm text-gray-400"},Vt={key:1},At={key:1,class:"min-w-full bg-white rounded overflow-hidden"},Gt={class:"py-0.5 text-bg font-semibold"},It={class:"px-2 py-1 border-y text-center"},Bt={class:"px-2 py-1 border-y border-r"},Wt={class:"px-2 py-1 border-y text-center"},Zt={class:"px-2 py-1 border-y text-center"},Re=H({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(u){const y=u,e=h(()=>Pt(y.task.users,y.task.task_reports||[])),i=h(()=>Lt(y.task.users,y.subTasks));return(o,r)=>{var v,m;return y.task.children_task_count>0?(s(),l("table",Nt,[t("caption",jt,[G(o.$slots,"caption",{},()=>[r[0]||(r[0]=$("Progress"))])]),t("thead",Mt,[t("tr",null,[r[1]||(r[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),r[2]||(r[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(s(!0),l(O,null,U(((m=(v=i.value[0]||{})==null?void 0:v.sub_task_infos)==null?void 0:m.length)||1,n=>(s(),l("th",{key:n,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},c(n===1?"Completed Sub Task":"")+" "+c(n===2?"Completed Sub Sub Task":"")+" "+c(n===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(s(!0),l(O,null,U(i.value,(n,f)=>(s(),l("tr",{key:n.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ft,c(f+1),1),t("td",Rt,[I(z,{user:n},null,8,["user"])]),(s(!0),l(O,null,U(n.sub_task_infos,(d,x)=>(s(),l("td",{class:"px-2 py-1 border-y text-center",key:x},[d.total_assigned===0||!n.assigned_on_any_leaf_task?(s(),l("div",Ut," Not Assigned To Any Task ")):(s(),l("div",Vt,c(d.completed_count)+" / "+c(d.total_assigned),1))]))),128))]))),128))])])):(s(),l("table",At,[t("caption",Gt,[G(o.$slots,"caption",{},()=>[r[3]||(r[3]=$("Progress"))])]),r[4]||(r[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(s(!0),l(O,null,U(e.value,(n,f)=>(s(),l("tr",{key:n.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",It,c(f+1),1),t("td",Bt,[I(z,{user:n},null,8,["user"])]),t("td",Wt,c(W(L)(n.task_started_at)),1),t("td",Zt,c(W(L)(n.task_finished_at)),1)]))),128))])]))}}}),zt=lt("task-user",()=>({updateUserStartDate:async(e,i,o)=>await Z.patch(`/task-user/task/${e}/user/${i}/update-start-date/${o}`),updateUserFinishDate:async(e,i,o)=>await Z.patch(`/task-user/task/${e}/user/${i}/update-finish-date/${o}`)})),Kt={class:"border-b text-center"},qt={key:0},Ht={key:1},Qt={class:"text-center font-semibold text-blue-800 my-4"},Yt={class:"flex justify-center w-full"},Jt={class:"py-6 w-4/12"},Xt={class:"block text-xs font-semibold"},te={class:"mt-3"},ee={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},se={class:"flex justify-between items-center"},ae={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(u,{emit:y}){const e=u,i=y,o=zt(),r=D(""),v=D("");async function m(){var f,d;console.log({date:r.value});try{e.type=="start-date"?await o.updateUserStartDate(e.task.id,e.user.id,r.value||"0"):e.type=="finish-date"&&await o.updateUserFinishDate(e.task.id,e.user.id,r.value||"0"),i("updateDate")}catch(x){v.value=((d=(f=x.response)==null?void 0:f.data)==null?void 0:d.message)||`Failed to update ${e.type}`}}function n(f){if(f){const d=e.type==="start-date"?f.started_at:f.completed_at;r.value=ut(d)}}return Y(()=>e.task,f=>{n(f)},{immediate:!0}),Q(()=>{n(e.task)}),(f,d)=>(s(),l("form",{class:"p-4",onSubmit:T(m,["prevent"])},[t("div",Kt,[u.type=="start-date"?(s(),l("h2",qt,"Edit Start Date")):u.type=="finish-date"?(s(),l("h2",Ht,"Edit Completed Date")):_("",!0)]),t("div",Qt,c(u.task.title),1),t("div",Yt,[t("div",Jt,[t("label",Xt,c(u.type=="start-date"?"Start date":"Completed date"),1),J(t("input",{type:"date","onUpdate:modelValue":d[0]||(d[0]=x=>r.value=x),class:"border py-2 px-4 rounded-md w-full"},null,512),[[X,r.value]])])]),d[3]||(d[3]=t("hr",{class:"mt-4"},null,-1)),t("div",te,[v.value?(s(),l("div",ee,c(v.value),1)):_("",!0)]),t("div",se,[t("button",{class:"btn-3",onClick:d[1]||(d[1]=T(x=>i("closeClick"),["prevent"]))},"Close"),d[2]||(d[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},le={key:0},ne={key:1,class:"flex"},oe={class:"border-r-2 border-dashed pr-6 border-gray-300"},re={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},ie={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},de={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},ue={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},ce={key:0},pe=["disabled"],fe=["disabled"],ye={class:"text-lg font-semibold text-gray-700"},ve={class:"text-sm text-gray-500"},ke={class:"flex flex-grow justify-center items-center"},me={key:0,class:"flex flex-col justify-center items-center"},xe={key:1},be={key:1},_e={key:2,class:"flex justify-center items-center flex-col"},ge={key:3,class:"flex flex-col justify-center items-center"},he={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},Se={class:"my-6"},$e={class:"text-center font-semibold text-blue-800 mb-4"},Te={class:"text-center my-1"},De={class:"border px-2 rounded-md bg-gray-50"},Ce={class:"text-red-600 text-center mt-2 text-sm"},we={class:"flex justify-between mt-3"},Ee={class:"btn-2"},Ue={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(u,{emit:y}){const e=u,i=y,o=nt(),r=D(""),v=D(),m=D(),n=ot({user:null,type:""});function f(g){n.user=o.user,n.type=g}const d={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},x=h(()=>(d==null?void 0:d[b.value])||0),p=h(()=>{var g;return{"bg-yellow-50":b.value==="IN_PROGRESS","bg-green-50":b.value==="COMPLETED","bg-red-50":b.value==="PENDING","bg-blue-50":(g=e.task)==null?void 0:g.closed_at}}),b=h(()=>{var g;return(g=e.task)==null?void 0:g.status}),S=h(()=>b.value=="PENDING"?"Start":b.value=="IN_PROGRESS"?"Finish":b.value=="COMPLETED"?"Close":""),N=h(()=>S.value=="Start"?"Start Task":S.value=="Finish"?"Finish Task":S.value=="Close"?"Close Task":"");async function et(){var g,a;v.value="submitting";try{await dt(e.task.id,{status:r.value}),r.value="",i("updateStatus")}catch(C){m.value=(a=(g=C.response)==null?void 0:g.data)==null?void 0:a.message,i("error")}finally{v.value=""}}const B=h(()=>S.value=="Start"?"fas fa-play-circle text-blue-500":S.value=="Finish"?"fas fa-stop-circle text-blue-500":""),st=h(()=>{var g,a,C,j,M,F,k,R;return[{date:L((g=e.task)==null?void 0:g.assigned_at),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((a=e.task)!=null&&a.assigned_at)},{date:L((C=e.task)==null?void 0:C.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((j=e.task)!=null&&j.started_at)||x.value>=d.IN_PROGRESS},{date:L((M=e.task)==null?void 0:M.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((F=e.task)!=null&&F.completed_at)||x.value>=d.COMPLETED},{date:L((k=e.task)==null?void 0:k.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((R=e.task)!=null&&R.deadline)}].sort((w,E)=>w.date===null||E.date===null||new Date(w.date)==new Date(E.date)?w.serial-E.serial:new Date(w.date)-new Date(E.date))});return(g,a)=>{var C,j,M,F;return s(),l("div",{class:P(["border py-8 px-4 rounded",p.value])},[b.value==="BLOCKED"?(s(),l("div",le,a[8]||(a[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(s(),l("div",ne,[t("div",oe,[(C=e.task)!=null&&C.is_target?(s(),l("div",re,a[9]||(a[9]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),$(" TARGET TASK ")]))):_("",!0),t("ol",ie,[(s(!0),l(O,null,U(st.value,(k,R)=>{var w,E;return s(),l("li",{class:"ml-5",key:R},[t("div",de,[k.active?(s(),l("i",{key:0,class:P([k.icon,"text-xs"])},null,2)):_("",!0)]),t("div",{class:P({"opacity-30":!k.active})},[t("div",ue,[k.date?(s(),l("span",ce,c(k.date),1)):_("",!0),((w=e.task)==null?void 0:w.children_task_count)===0&&k.status==="started"&&k.active?(s(),l("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:a[0]||(a[0]=T(()=>f("start-date"),["prevent"])),disabled:!!e.task.closed_at},c(k.date?"Edit":"Set Date"),9,pe)):_("",!0),((E=e.task)==null?void 0:E.children_task_count)===0&&k.active&&k.status==="completed"?(s(),l("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:a[1]||(a[1]=T(()=>f("finish-date"),["prevent"])),disabled:!!e.task.closed_at},c(k.date?"Edit":"Set Date"),9,fe)):_("",!0)]),t("h3",ye,c(k.title),1),t("p",ve,c(k.description),1)],2)])}),128))])]),t("div",ke,[(j=u.task)!=null&&j.closed_at?(s(),l("div",me,a[10]||(a[10]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):b.value==="PENDING"?(s(),l("div",xe,[((M=u.task)==null?void 0:M.children_task_count)===0?(s(),l("button",{key:0,class:"btn-3 mt-2",onClick:a[2]||(a[2]=T(k=>r.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(s(),l("div",be,a[11]||(a[11]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),t("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):b.value==="IN_PROGRESS"?(s(),l("div",_e,[a[12]||(a[12]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),a[13]||(a[13]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((F=u.task)==null?void 0:F.children_task_count)===0?(s(),l("button",{key:0,class:"btn-3",onClick:a[3]||(a[3]=T(k=>r.value="COMPLETED",["prevent"]))}," Finish Task ")):_("",!0)])):b.value==="COMPLETED"?(s(),l("div",ge,[a[14]||(a[14]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),a[15]||(a[15]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:a[4]||(a[4]=T(k=>r.value="CLOSED",["prevent"]))},"Close Task")])):_("",!0)])])),r.value?(s(),V(K,{key:2},{default:A(()=>{var k;return[t("form",{class:"p-4 rounded relative",onSubmit:T(et,["prevent"])},[v.value==="submitting"?(s(),V(tt,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:A(()=>a[16]||(a[16]=[$("Submitting!")])),_:1,__:[16]})):_("",!0),t("h3",he,c(N.value),1),t("div",Se,[t("div",$e,c((k=u.task)==null?void 0:k.title),1),a[19]||(a[19]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",Te,[a[17]||(a[17]=$(" Want to ")),t("span",De,[t("i",{class:P(["text-sm",B.value])},null,2),$(" "+c(S.value),1)]),a[18]||(a[18]=$(" the task? "))])]),a[20]||(a[20]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",Ce,c(m.value),1),t("div",we,[t("button",{class:"btn-3",onClick:a[5]||(a[5]=T(R=>r.value="",["prevent"]))},"Cancel"),t("button",Ee,[t("i",{class:P(["text-xl text-white",B.value])},null,2),$(" "+c(S.value)+" Task ",1)])])])],32)]}),_:1})):_("",!0),n!=null&&n.user?(s(),V(K,{key:3},{default:A(()=>[I(ae,{task:e.task,user:n.user,type:n.type,onCloseClick:a[6]||(a[6]=k=>n.user=null),onUpdateDate:a[7]||(a[7]=()=>{n.user=null,n.type=null,i("updateStatus")})},null,8,["task","user","type"])]),_:1})):_("",!0)],2)}}};export{ae as _,Fe as a,Re as b,Ue as c,Pt as g};
