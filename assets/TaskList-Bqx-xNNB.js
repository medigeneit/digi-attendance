import{_ as se}from"./CommentModal-CTGlPfZy.js";import{_ as te}from"./DraggableList.vue_vue_type_script_setup_true_lang-BmkZsi-A.js";import{L as ae}from"./LoaderView-BN2sgpd9.js";import{O as B}from"./OverlyModal-CLD6l5Rp.js";import{_ as oe}from"./TaskAddForm-DMcR9RQm.js";import{_ as re}from"./TaskEditForm-DE79WMIq.js";import{_ as ie}from"./TaskHeader-Dn2sB1nL.js";import{_ as G}from"./TaskTreeViewWithSubTable-mUvyFG5b.js";import{_ as ne}from"./TaskUserAssignForm-Dq9utvB-.js";import{_ as le}from"./UserChip-BnVQY6bz.js";import{m as J}from"./task-tree-wODDhwOu.js";import{b as K,m as x,c as p,o,a as f,F as S,y as E,g as T,p as _,f as b,d as de,u as ue,r as C,z as j,e as me,A as ke,P as pe,i as L,k as m,t as W}from"./index-CdLn3GUc.js";import{u as ce}from"./task-priority-CovNBfhz.js";import{u as ye}from"./useTaskStore-B9_3DwE7.js";import"./useCommentStore-1ZerDfsL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-AP9AvnO4.js";import"./company-DH0fDGSY.js";import"./requirement-Bb8JAVjd.js";import"./CompanyDepartmentSelectInput-sC3WApSH.js";import"./SelectDropdown-BfcIvciZ.js";import"./SectionLoading-BVRvC4cW.js";import"./TextWithHr-DLIIGOeY.js";import"./TaskUrgencyInput-SdbI-RAA.js";import"./datetime-Efw590t9.js";import"./tags-B3frhKsZ.js";import"./MultiselectDropdown-BlR1kzGi.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-F2LJJuWX.js";import"./task-Dg7rg8kH.js";import"./url-CePbr-gY.js";import"./EmployeeDropdownInput-B1F9Hp6A.js";import"./SearchInput-J0cWnMv0.js";import"./TaskUrgentBadge-B4PTpstH.js";import"./TaskTitle-r4NHNalm.js";import"./TaskAssignedUsers-Do2kxkxU.js";import"./TaskIsClosedBadge-Dt9gHty7.js";import"./TaskSupervisorAndEmployee-HSO0EbT7.js";import"./user-BcWF_8vb.js";import"./TaskUserChip-mxL2QCwk.js";const fe={class:"w-full"},ve={class:"w-full table-fixed bg-white rounded-md"},ge={class:"border rounded-md align-top bg-blue-50"},Ce={key:0,class:"sticky top-16 py-2 px-2 z-40 bg-blue-100/70"},Te={class:"space-y-4 mt-4"},_e={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup($,{emit:d}){const i=$,a=K(),v=d,c=x(()=>i.tasks.reduce((r,s)=>(r.push(...s.users.filter(n=>!r.find(k=>k.id==n.id&&n.id))),r),[]).filter(r=>i.selectedUserId?r.id==i.selectedUserId:!0)),A=r=>{const n=i.tasks.filter(k=>k.users.some(u=>u.id===r));return J(n,{...a.query,"user-ids":r})},q=x(()=>c.value.map(r=>{const s=A(r.id);return{...r,tasks:s}}));return(r,s)=>(o(),p("div",fe,[f("table",ve,[f("tbody",null,[(o(!0),p(S,null,E(q.value,n=>{var k;return o(),p("tr",{key:n.id},[f("td",ge,[f("div",null,[((k=n.tasks)==null?void 0:k.length)>0?(o(),p("div",Ce,[_(le,{user:n,class:""},null,8,["user"])])):T("",!0),f("div",Te,[(o(!0),p(S,null,E(n.tasks,(u,M)=>(o(),b(G,{key:u.id,task:u,class:"!border-0",index:M,isMyTask:$.isMyTask,onCommentButtonClick:s[0]||(s[0]=y=>v("commentButtonClick",r.item.id)),onEditClick:s[1]||(s[1]=y=>v("editClick",y)),onAddClick:s[2]||(s[2]=y=>v("addClick",y)),onEmployeeAssignClick:s[3]||(s[3]=y=>v("employeeAssignClick",y))},null,8,["task","index","isMyTask"]))),128))])])])])}),128))])])]))}},be={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md"},Ie={class:"mb-4"},we={class:"relative min-h-[26vh]"},Ae={key:0,class:"text-center py-4 text-red-500"},qe={key:1},xe={class:"flex items-stretched"},Me={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},Le=1,ys={__name:"TaskList",setup($){const d=ye(),i=de(),a=K(),v=ue(),c=C(""),A=C(!1),q=C(null),r=x(()=>{var t;return((t=i==null?void 0:i.user)==null?void 0:t.role)==="employee"||!(i!=null&&i.isAdminMood)?!0:!!a.query["user-ids"]}),s=C(null),n=C(!1),k=j({parentId:0,requirementId:0}),u=j({taskId:0,isOpen:!1}),M=C(null),y=C([]),{handleItemsPriorityUpdate:Q,saveTaskPriority:X,listHasRearranged:F}=ce(()=>d.taskListTree,0);me(async()=>{console.log("Task List Mounted"),c.value="loading",a.query.status||v.push({query:{...a.query,status:"not-completed"}}),await w()});let I;async function w(){let t;I=new AbortController,console.log({taskAbortController:I}),a.name==="MyTaskList"?t=await d.fetchMyTasks({...a.query,page:1},{signal:I.signal}):t=await d.fetchTasks({...a.query,page:1},{signal:I.signal}),c.value="",y.value=t.query_log||[]}const h=t=>{n.value=!0,k.parentId=t},P=t=>{u.taskId=t,u.isOpen=!0},O=t=>{q.value=t,A.value=!0},Y=()=>{A.value=!1,q.value=null};async function V(){s.value=null,n.value=!1,k.parentId=0,c.value="loading",await w()}async function Z(){n.value=!1,k.parentId=0,await w()}async function ee(){c.value="loading",await X()&&await w()}ke(()=>({...a.query}),async()=>{try{d.resetTaskList(),c.value="loading",await w()}catch{console.warn("...")}});const D=x({get(){return{...a.query}},set(t){localStorage.removeItem("sub_task_opened_list"),v.push({query:{...t}})}}),N=x(()=>{var e;const t={...a.query};return a.name=="MyTaskList"&&(t["user-ids"]=(e=i==null?void 0:i.user)==null?void 0:e.id),Array.isArray(d.tasks)?J(d.tasks,t):[]});return pe(()=>{d.tasks.value=null,I&&I.abort()}),(t,e)=>{var z,H,R;return o(),p("div",be,[s.value?(o(),b(B,{key:0},{default:L(()=>[_(re,{taskId:s.value,onClose:e[0]||(e[0]=l=>s.value=null),onUpdated:V},null,8,["taskId"])]),_:1})):T("",!0),n.value?(o(),b(B,{key:1},{default:L(()=>[_(oe,{parentTaskId:k.parentId,requirementId:k.requirementId,onClose:Z,onTaskCreated:V},null,8,["parentTaskId","requirementId"])]),_:1})):T("",!0),u.isOpen?(o(),b(B,{key:2,class:"*:max-w-4xl"},{default:L(()=>[_(ne,{taskId:u.taskId,onCancelClick:e[1]||(e[1]=()=>{u.isOpen=!1,u.taskId=0}),onSuccess:e[2]||(e[2]=()=>{u.isOpen=!1,u.taskId=0,c.value="loading",w()})},null,8,["taskId"])]),_:1})):T("",!0),_(ie,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=l=>D.value=l),onClickAddTask:h,onClickPrioritySave:ee,onClickPriorityDiscard:e[4]||(e[4]=()=>m(F)?M.value.resetItems:null),"list-has-rearranged":m(F),isMyTask:m(a).name==="MyTaskList"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((H=(z=m(a))==null?void 0:z.query)==null?void 0:H["query-log"])=="true"?(o(!0),p(S,{key:3},E(y.value,(l,U)=>(o(),p("div",{key:U,class:"text-xs text-gray-500"},[f("div",Ie,W(l.raw_query),1)]))),128)):T("",!0),f("div",we,[m(d).error?(o(),p("div",Ae,W(m(d).error),1)):m(d).tasks.length>0?(o(),p("div",qe,[((R=m(a).query)==null?void 0:R.view)=="userwise"?(o(),b(_e,{key:0,tasks:N.value,selectedUserId:m(a).query["user-ids"],isMyTask:m(a).name==="MyTaskList",onCommentButtonClick:e[5]||(e[5]=l=>O(l,t.task.id)),onEditClick:e[6]||(e[6]=l=>s.value=l),onAddClick:e[7]||(e[7]=l=>h(l)),onEmployeeAssignClick:e[8]||(e[8]=l=>P(l))},null,8,["tasks","selectedUserId","isMyTask"])):(o(),b(te,{key:1,items:N.value,handle:"handle",onItemsUpdate:m(Q),class:"space-y-6",ref_key:"draggableTaskList",ref:M},{item:L(({item:l,index:U})=>[f("div",xe,[_(G,{isMyTask:m(a).name==="MyTaskList",task:l,index:U,showDraggableHandle:!r.value,onCommentButtonClick:e[9]||(e[9]=g=>O(g,t.task.id)),onEditClick:e[10]||(e[10]=g=>s.value=g),onAddClick:e[11]||(e[11]=g=>h(g)),onEmployeeAssignClick:e[12]||(e[12]=g=>P(g)),class:"!border-0 shadow hover:shadow-md"},null,8,["isMyTask","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):c.value!=="loading"?(o(),p("div",Me," No tasks found. ")):T("",!0),c.value==="loading"?(o(),b(ae,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):T("",!0)]),_(se,{show:A.value,"commentable-id":q.value,"commentable-type":"task","user-id":Le,"on-close":Y,onSubmitted:m(d).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{ys as default};
