import{b as G,u as P,d as Y,r as p,e as $,q as L,A as j,k as q,c as u,o as i,a as s,t as b,h as g,n as r,w as K,g as _,l as x,C as A,F as R,x as N,v as M,p as H}from"./index-HETKnDfN.js";import{R as S}from"./RequiredIcon-BfuKXtAD.js";import{u as z}from"./useTaskReportStore-CeQyXUVP.js";import{u as J}from"./useTaskStore-C89fc1Zh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"mt-6"},W={class:"max-w-xl w-full mx-auto bg-white border p-4 rounded-md shadow"},X={class:"col-span-full text-red-800 font-semibold"},Z={key:0,class:"w-full flex items-center justify-center h-40 text-red-500 text-xl text-center"},tt={key:0,class:"col-span-full"},st={class:"font-semibold"},et={key:1,class:"col-span-full"},ot={class:"block text-gray-600 text-sm mb-1 font-medium"},lt=["value"],at={class:"col-span-full"},nt={class:"col-span-2"},rt={class:"block text-gray-600 text-sm mb-1 font-medium"},ut={class:"col-span-2"},it={for:"report_date",class:"block text-gray-600 text-sm mb-1 font-medium"},dt={class:"flex justify-between col-span-full"},bt={__name:"AddTaskReport",setup(pt){const V=G(),B=P(),h=z(),a=J(),T=Y(),y=V.params.id,f=p(""),D=p(0),k=p(O()),C=p(0),I=p(0),c=p(""),v=p("");$(async()=>{await a.fetchTask(y),a.task.children_task_count==0&&(v.value=a.task.status)});function E(o,t=[]){const n=[];for(const l of o){const d=[...t,l.title];l.children_tasks.length===0?l.users.some(e=>{var m;return e.id==((m=T.user)==null?void 0:m.id)})&&n.push({id:l.id,title:l.title,status:l.status,task_parents:t,user_ids:l.users.map(e=>e.id)}):n.push(...E(l.children_tasks,d))}return n}const w=L(()=>a.task.children_task_count>0?E(a.tasks):[]),F=async()=>{var n,l,d;const o=D.value*60+C.value,t={task_id:((l=(n=a.task)==null?void 0:n.children)==null?void 0:l.length)>0?c.value:(d=a.task)==null?void 0:d.id,title:f.value,report_date:k.value,progress:I.value,duration:o};console.log({payload:t});try{const e=await h.createTaskReport(t);console.log("Submitted:",e.data),f.value="",k.value="",D.value=0,C.value=0,B.push({name:"TaskReports",params:{id:y}})}catch(e){console.error("Error submitting report:",e)}};function O(){const o=new Date;return`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`}j(()=>c.value,function(){const o=w.value.find(t=>t.id==c.value);console.log({selectedTask:o}),o&&(v.value=o.status)});const U=L(()=>{var o;return a.task.children_task_count>0&&w.value.length>0||a.task.children_task_count===0&&(((o=a.task)==null?void 0:o.users)||[]).some(t=>{var n;return t.id==((n=T.user)==null?void 0:n.id)})});return(o,t)=>{var l,d;const n=q("RouterLink");return i(),u("div",Q,[s("div",W,[s("div",X,b((l=g(h))==null?void 0:l.error),1),U.value?(i(),u("form",{key:1,onSubmit:K(F,["prevent"]),class:"grid gap-x-4 gap-y-6 grid-cols-4"},[g(a).task.children_task_count===0?(i(),u("div",tt,[t[5]||(t[5]=r(" Add Report on ")),s("span",st,b((d=g(a).task)==null?void 0:d.title),1),t[6]||(t[6]=s("hr",{class:"mt-1"},null,-1))])):(i(),u("div",et,[s("label",ot,[t[7]||(t[7]=r(" Task ")),x(S)]),_(s("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e)},[t[8]||(t[8]=s("option",{value:""},"--select---",-1)),(i(!0),u(R,null,N(w.value,e=>(i(),u("option",{key:e.id,class:"w-full",value:e.id},[r(b(e.title)+" ",1),(i(!0),u(R,null,N(e.task_parents,m=>(i(),u(R,{key:m},[r(" â†µ "+b(m),1)],64))),128))],8,lt))),128))],512),[[A,c.value]])])),s("div",at,[t[9]||(t[9]=s("label",{for:"title",class:"block text-gray-600 text-sm mb-1 font-medium"},[r("Report "),s("span",{class:"text-gray-400"},"(optional)")],-1)),_(s("input",{id:"title","onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),type:"text",class:"border rounded p-2 w-full",placeholder:"Enter report title"},null,512),[[M,f.value]])]),s("div",nt,[s("label",rt,[t[10]||(t[10]=r(" Status ")),x(S)]),_(s("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e)},t[11]||(t[11]=[s("option",{value:""},"--select---",-1),s("option",null,"PENDING",-1),s("option",null,"IN_PROGRESS",-1),s("option",null,"COMPLETED",-1),s("option",null,"BLOCKED",-1),s("option",null,"CANCELLED",-1),s("option",null,"BACK_LOG",-1)]),512),[[A,v.value]])]),s("div",ut,[s("label",it,[t[12]||(t[12]=r(" Report Date ")),x(S)]),_(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>k.value=e),id:"report_date",type:"date",class:"border rounded p-2 w-full"},null,512),[[M,k.value]])]),t[15]||(t[15]=s("hr",{class:"col-span-full border-dashed"},null,-1)),s("div",dt,[t[14]||(t[14]=s("button",{type:"submit",class:"btn-2"},"Submit",-1)),x(n,{type:"submit",class:"btn-3",to:{name:"TaskReports",params:{id:g(y)}}},{default:H(()=>t[13]||(t[13]=[r("Cancel")])),_:1,__:[13]},8,["to"])])],32)):(i(),u("div",Z,t[4]||(t[4]=[r(" You Are Not Assigned to this task. "),s("br",null,null,-1),r("You cannot add a report. ")])))])])}}};export{bt as default};
