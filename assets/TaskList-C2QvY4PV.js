import{_ as Ce}from"./CommentModal-CUIME4bi.js";import{_ as Te,a as $e}from"./TaskUserAssignForm-D5z6t-2d.js";import{L as _e}from"./LoaderView-yWlnDcBf.js";import{O as se}from"./OverlyModal-Cnx8Z8Ga.js";import{_ as Ae}from"./TaskAddForm-mVZW0fOt.js";import{_ as Ie}from"./TaskEditForm-DNU7m2qp.js";import{r as B,m as w,c as a,o as s,a as e,h as J,v as me,g as n,w as W,d as ce,b as ae,e as fe,x as te,z as pe,f as V,F as O,q as $,C as re,n as Y,t as S,k as p,i as P,K as le,j as q,p as K,H as Se,u as Le,s as ie}from"./index-Dpa0EZ85.js";import{_ as Ve}from"./MultiselectDropdown-msd7lthb.js";import{g as Me,u as qe}from"./task-priority-CFp8hkD9.js";import{u as De}from"./company-BD4sTw-A.js";import{_ as de}from"./CompanyDepartmentSelectInput-DYs-boUJ.js";import{_ as ye}from"./UserChip-kHg-RdPy.js";import{a as ke,b as ve,c as ge,T as xe,d as be,e as Ee,_ as Ue}from"./TaskTreeView-CUqXV_0E.js";import{b as we,a as ee}from"./datetime-BlGg5F0U.js";import{o as Be}from"./url-CePbr-gY.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Oe}from"./useTaskStore-C5I1snr6.js";import"./useCommentStore-DWH3RLKN.js";import"./TextWithHr-Dj3fm9Xm.js";import"./TaskUrgencyInput-KlzrvrEZ.js";import"./TaskUserChip-sFQ2NowR.js";import"./RequiredIcon-Exgmwodj.js";import"./useRequirementStore-Fhd6YtOb.js";import"./requirement-BS5vVEhX.js";import"./SectionLoading-9zS5sOvn.js";import"./tags-D7qu7Cuw.js";const je={class:"text-gray-600 relative"},Ne={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},ue={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(l,{emit:h}){const f=l,y=B(),m=h,v=g=>{m("update:modelValue",g||void 0)};let M=0;const k=w({get(){return f.modelValue},set(g){clearTimeout(M),M=setTimeout(v,500,g)}});return(g,i)=>(s(),a("div",je,[i[3]||(i[3]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),J(e("input",{ref_key:"searchInput",ref:y,id:"search","onUpdate:modelValue":i[0]||(i[0]=C=>k.value=C),type:"text",class:"!pr-7 w-full rounded-md px-2 py-1 border-2 border-gray-400 placeholder:text-sm focus:outline-gray-400",placeholder:"Search by main task title"},null,512),[[me,k.value]]),e("div",Ne,[k.value?(s(),a("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:i[1]||(i[1]=W(()=>{v(""),y.value.focus()},["prevent"]))})):n("",!0),i[2]||(i[2]=e("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},Re={class:"mb-3 task-header"},Fe={class:"flex justify-between items-start mb-4"},He={key:0,class:"ml-auto flex gap-6 items-center"},ze={key:0,class:"flex gap-2 items-center"},We={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Ke={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Ge={class:"relative w-full md:w-48 flex-grow"},Je=["value"],Ye={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Qe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Xe={class:"w-32 relative h-8"},Ze={class:"flex gap-4 items-center flex-shrink-0"},et={class:"flex gap-2"},tt={class:"flex gap-2"},st={class:"flex gap-2"},lt={class:"text-gray-600 w-full md:w-32 relative"},at={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6"},ot={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},nt={key:0,class:"text-[9px] text-green-800"},rt=["onClick"],it={key:1,class:"flex justify-end gap-5"},dt={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(l,{emit:h}){const f=l,y=ce(),m=ae(),v=w(c("company-id")),M=w(c("from-department-id")),k=w(c("to-department-id")),g=w(c("user-ids")),i=w(c("month")),C=w(c("status")),_=w(c("is-important")),b=w(c("is-urgent")),j=w(c("is-target")),N=w(c("search")),D=h,E=De(),R=B([]);function c(x){return{get:()=>f.modelValue[x]||"",set:t=>{D("update:modelValue",{...f.modelValue,[x]:t||void 0})}}}const o=w(()=>G(g.value));async function F(){var x,t,d;if(!f.isMyTask){const I=(x=f.modelValue)==null?void 0:x["company-id"],T=k.value,A={...I?{company_id:I}:{},...T?{department_ids:[T]}:{}};R.value=((d=(t=await Me({params:A}))==null?void 0:t.data)==null?void 0:d.employees)||[]}}fe(async()=>{await F(),await E.fetchCompanies({with:"departments",ignore_permission:!0}),await E.fetchMyCompanies({with:"departments"})});function G(x){return Array.isArray(R.value)&&R.value.find(t=>t.id==x)||null}function Q(x){g.value=(x==null?void 0:x.id)||""}function z(){g.value=""}te(()=>k.value,F),te(()=>v.value,()=>{k.value!==""?k.value="":F()});function H(x,t,{value:d,id:I,label:T,onCancel:A}={}){if(!x)return[];const r=Array.isArray(t)?t.find(L=>(L==null?void 0:L[I])==x):null;return r?[{label:T,value:r==null?void 0:r[d],id:r==null?void 0:r[I],onCancel:A}]:[]}const X=w(()=>{var I;const x=E.companies.reduce((T,A)=>[...T,...A.departments],[]),t=(T,{label:A,value:r,id:L,onCancel:U})=>T?[{label:A,value:r,id:L,onCancel:U}]:[],d=(T,{label:A,onCancel:r})=>{if(!T)return[];const L=new Date(T);return[{label:A,value:L.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:T,onCancel:r}]};return[...H(v.value,E.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{v.value=""}}),...H(M.value,x,{label:"From",value:"short_name",id:"id",onCancel:()=>{M.value=""}}),...H(k.value,x,{label:"To",value:"short_name",id:"id",onCancel:()=>{k.value=""}}),...H((I=o.value)==null?void 0:I.id,R.value,{label:"Employee",value:"name",id:"id",onCancel:z}),...H(C.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{C.value=""}}),...t(_.value,{label:"",value:"Important ",id:!0,onCancel:()=>{_.value=""}}),...t(b.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{b.value=""}}),...t(j.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{j.value=""}}),...d(i.value,{label:"",onCancel:()=>{i.value=""}})]});return(x,t)=>{var I,T,A,r,L,U,oe,ne;const d=pe("RouterLink");return s(),a(O,null,[e("div",Re,[e("div",Fe,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),l.isMyTask?n("",!0):(s(),a("div",He,[l.listHasRearranged?(s(),a("div",ze,[t[13]||(t[13]=e("span",{class:"text-red-500"},"Priority Changed",-1)),e("button",{class:"btn-3",onClick:t[0]||(t[0]=W(u=>D("clickPrioritySave"),["prevent"]))},"Save"),e("button",{class:"btn-3",onClick:t[1]||(t[1]=W(u=>D("clickPriorityDiscard"),["prevent"]))},"Discard")])):n("",!0),e("button",{onClick:t[2]||(t[2]=u=>D("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),e("div",We,[e("div",Ke,[l.isMyTask?n("",!0):(s(),a(O,{key:0},[e("div",Ge,[t[16]||(t[16]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),J(e("select",{"onUpdate:modelValue":t[3]||(t[3]=u=>v.value=u),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[t[15]||(t[15]=e("option",{value:""},"--ALL COMPANY--",-1)),(s(!0),a(O,null,Y((I=p(E))==null?void 0:I.myCompanies,u=>(s(),a("option",{key:u.id,value:u.id},S(u.name),9,Je))),128))],512),[[re,v.value]])]),$(de,{modelValue:M.value,"onUpdate:modelValue":t[4]||(t[4]=u=>M.value=u),companies:((T=p(E))==null?void 0:T.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:P(()=>t[17]||(t[17]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),p(m).name!=="MyTaskList"?(s(),V(de,{key:0,modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=u=>k.value=u),companies:((A=p(E))==null?void 0:A.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:P(()=>t[18]||(t[18]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):n("",!0),p(y).isAdminMood&&((L=(r=p(y))==null?void 0:r.user)==null?void 0:L.role)!=="employee"?(s(),a("div",Ye,[$(Ve,{modelValue:o.value,onSelect:Q,onRemove:z,options:R.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:P(({option:u})=>[$(ye,{user:u,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),o.value?(s(),a("div",Qe,[e("button",{onClick:W(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):n("",!0),t[19]||(t[19]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):n("",!0)],64)),e("div",Xe,[t[21]||(t[21]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),J(e("select",{"onUpdate:modelValue":t[6]||(t[6]=u=>C.value=u),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},t[20]||(t[20]=[e("option",{value:""},"--ALL TASKS--",-1),e("option",{value:"not-completed"},"Not Completed",-1),e("option",{value:"only-completed"},"Completed",-1)]),512),[[re,C.value]])]),e("div",Ze,[e("label",et,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=u=>_.value=u)},null,512),[[le,_.value]]),t[22]||(t[22]=e("span",null,"Important",-1))]),e("label",tt,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=u=>b.value=u)},null,512),[[le,b.value]]),t[23]||(t[23]=e("span",null,"Urgent",-1))]),e("label",st,[J(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=u=>j.value=u)},null,512),[[le,j.value]]),t[24]||(t[24]=e("span",null,"Is Target",-1))])]),e("div",lt,[t[25]||(t[25]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),J(e("input",{id:"month-filter","onUpdate:modelValue":t[10]||(t[10]=u=>i.value=u),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[me,i.value]])])]),l.isMyTask?(s(),V(ue,{key:0,modelValue:N.value,"onUpdate:modelValue":t[11]||(t[11]=u=>N.value=u),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):n("",!0)])]),e("div",at,[l.isMyTask?n("",!0):(s(),V(ue,{key:0,modelValue:N.value,"onUpdate:modelValue":t[12]||(t[12]=u=>N.value=u),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),e("div",ot,[(s(!0),a(O,null,Y(X.value,u=>(s(),a("div",{key:u.label||u.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[e("div",null,[u.label?(s(),a("span",nt,S(u.label)+": ",1)):n("",!0),q(S(u.value),1)]),e("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:W(u.onCancel,["prevent"])},t[26]||(t[26]=[e("i",{class:"fas fa-times-circle"},null,-1)]),8,rt)]))),128))]),l.isMyTask?n("",!0):(s(),a("div",it,[$(d,{class:K(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((U=p(m).query)==null?void 0:U.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...p(m).query,view:"userwise"}}},{default:P(()=>t[27]||(t[27]=[q(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),$(d,{class:K(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((oe=p(m).query)==null?void 0:oe.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ne=p(m))==null?void 0:ne.query)||{}).filter(u=>{var Z;return((Z=p(m))==null?void 0:Z.query[u])!=="userwise"}).reduce((u,Z)=>({...u,[Z]:p(m).query[Z]}),{})}}},{default:P(()=>t[28]||(t[28]=[q(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},ut={},mt={class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"};function ct(l,h){return s(),a("div",mt,h[0]||(h[0]=[e("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),q("CLOSED ")]))}const he=Pe(ut,[["render",ct]]),ft={class:"mt-3"},pt={class:"w-full"},yt={class:"border-2 w-10 px-4 py-2"},kt={key:0,class:"text-xl font-semibold text-blue-500"},vt={class:"border-2 px-2 py-2"},gt={class:"mb-1"},xt={class:"flex items-center flex-none lg:w-full order-0 lg:order-1 mb-2"},bt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},wt={class:"text-gray-400 text-xs col-span-full"},ht={class:"border-2 px-2 py-2"},Ct={class:"flex justify-end gap-2"},Tt={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick","employeeAssignClick"],setup(l,{emit:h}){return(f,y)=>(s(),a("div",ft,[e("table",pt,[e("tbody",null,[(s(!0),a(O,null,Y(l.childrenTasks,(m,v)=>(s(),a("tr",{key:m.id,class:K(["",{" bg-green-100/50":m.status=="COMPLETED"," bg-white hover:bg-gray-100/60":m.status!=="COMPLETED"}])},[e("td",yt,[v!==void 0?(s(),a("div",kt,S(v+1),1)):n("",!0)]),e("td",vt,[e("div",gt,[$(ke,{task:m,"sub-tasks-open":!1,"is-my-task":f.isMyTask},null,8,["task","is-my-task"])]),e("div",xt,[e("div",bt,[m!=null&&m.is_important?(s(),V(xe,{key:0})):n("",!0),m!=null&&m.is_urgent?(s(),V(be,{key:1})):n("",!0)])]),e("div",wt,[y[0]||(y[0]=e("i",{class:"fas fa-clock"},null,-1)),q(" "+S(p(we)(m.created_at)),1)])]),e("td",ht,[e("div",Ct,[m.closed_at?(s(),V(he,{key:0})):n("",!0),$(ve,{status:m==null?void 0:m.status,progressPercent:(m==null?void 0:m.progress_percent)||0},null,8,["status","progressPercent"]),$(ge,{ref_for:!0,ref:"progress",task:m,class:"text-sm"},null,8,["task"])])])],2))),128))])])]))}},$t={class:"flex w-full text-gray-800"},_t={key:0,class:"border-l border-gray-200 last:border-l-0"},At={class:"items-start grid grid-cols-4 gap-4 group"},It={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},St={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},Lt={key:0,class:"text-xl font-semibold text-blue-500"},Vt={key:1,class:"text-sm text-gray-500 mt-2"},Mt={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},qt={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Dt={key:0,class:"flex gap-4 items-center mr-3"},Et={key:1,class:"text-gray-500 text-sm"},Ut={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Bt={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},Pt={class:"text-gray-400 text-xs col-span-full flex"},Ot={class:"mb-4"},jt={class:"flex flex-wrap gap-2 mb-2 col-span-full"},Nt={class:"flex-grow flex"},Rt={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4 mt-4 opacity-80"},Ft={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Ht={key:1,class:"text-gray-500 text-sm"},zt={class:"font-semibold text-blue-800"},Wt={key:2,class:"ml-4 text-gray-500 text-sm"},Kt={class:"text-blue-500 font-semibold"},Gt={key:3,class:"text-gray-500 text-sm"},Jt={class:"font-semibold text-blue-800"},Yt={key:4,class:"text-gray-500 text-sm"},Qt={class:"font-semibold text-blue-800"},Xt={class:"mt-4 col-span-full"},Zt={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},es={class:"text-xs text-gray-400 flex gap-3 order-1 sm:order-0"},ts=["href"],ss={class:"flex items-center sm:ml-auto order-0 sm:order-1"},ls={key:0,class:"flex gap-2 ml-4 items-center text-xs"},as=["href"],os=["href"],ns={key:0,class:"ml-0"},rs={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(l,{emit:h}){const f=l,y=ae(),m=B(null),v=h;function M(c){v("addClick",c)}function k(c){v("editClick",c)}function g(c){v("employeeAssignClick",c)}const i=B([]),C=localStorage.getItem("sub_task_opened_list");if(C)try{i.value=JSON.parse(C)}catch{i.value=[]}const _=w(()=>ee(f.task.assigned_at||f.task.created_at)),b=w(()=>ee(f.task.deadline)),j=w(()=>ee(f.task.started_at)),N=w(()=>ee(f.task.completed_at)),D=w({get:()=>i.value.includes(f.task.id),set:c=>{const o=i.value.includes(f.task.id);c&&!o?i.value.push(f.task.id):!c&&o&&(i.value=i.value.filter(F=>F!==f.task.id))}});te(i,c=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(c))},{deep:!0});const E=w(()=>{var c,o;return((o=(c=f.task)==null?void 0:c.children_tasks)==null?void 0:o.length)>0});function R(){f.task.children_tasks.length>0&&(D.value=!D.value)}return(c,o)=>{var G,Q,z,H,X,x,t,d,I,T,A;const F=pe("RouterLink");return s(),a("div",$t,[l.treeLevel>0?(s(),a("div",_t,o[4]||(o[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):n("",!0),e("div",{class:K(["flex-grow border-2 rounded py-3 px-3",{"bg-blue-100/30  ":l.task.closed_at,"bg-green-100  ":((G=m.value)==null?void 0:G.completedPercentage)===100,"bg-white hover:bg-gray-50":((Q=m.value)==null?void 0:Q.completedPercentage)<100&&!l.task.closed_at,"shadow-sm":l.treeLevel>0,"border-blue-500":l.index%2===0,"border-pink-300":l.index%2===1}])},[e("div",At,[e("div",It,[e("div",St,[l.index!==void 0?(s(),a("div",Lt,S(l.index+1)+". ",1)):n("",!0),$(ke,{task:l.task,"sub-tasks-open":D.value,"is-my-task":l.isMyTask},null,8,["task","sub-tasks-open","is-my-task"]),(z=l.task)!=null&&z.requirement?(s(),a("p",Vt," Requirement: "+S((X=(H=l.task)==null?void 0:H.requirement)==null?void 0:X.title),1)):n("",!0)]),e("div",Mt,[l.task.closed_at?(s(),V(he,{key:0})):n("",!0),$(ve,{status:(x=l.task)==null?void 0:x.status,progressPercent:((t=l.task)==null?void 0:t.progress_percent)||0},null,8,["status","progressPercent"]),$(ge,{ref_key:"progress",ref:m,task:l.task,class:"text-sm"},null,8,["task"])]),e("div",qt,[l.showDraggableHandle||l.task.serial?(s(),a("div",Dt,[l.showDraggableHandle?(s(),a("button",{key:0,onMousedown:o[0]||(o[0]=W((...r)=>c.handleDragging&&c.handleDragging(...r),["stop"])),class:"handle"},o[5]||(o[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):n("",!0),l.task.serial?(s(),a("span",Et," #"+S(l.task.serial),1)):n("",!0)])):n("",!0),e("div",Ut,[l.treeLevel===0?(s(),a("div",Bt," Main ")):n("",!0),(d=l.task)!=null&&d.is_important?(s(),V(xe,{key:1})):n("",!0),(I=l.task)!=null&&I.is_urgent?(s(),V(be,{key:2})):n("",!0)])])]),e("div",Pt,[e("div",null,[e("div",Ot,[o[6]||(o[6]=e("i",{class:"fas fa-clock"},null,-1)),q(" "+S(p(we)(l.task.created_at)),1)]),e("div",jt,[(s(!0),a(O,null,Y(l.task.website_tags||[],r=>(s(),a("div",{class:"border bg-gray-50 text-xs px-2 rounded-lg shadow-sm text-gray-700 bg-gradient-to-b to-slate-50 from-blue-100",key:r.id},S(r.name),1))),128))])])])]),e("div",Nt,[l.hideAssignedUsers?n("",!0):(s(),V(Ee,{key:0,task:l.task,"tree-level":l.treeLevel,"employee-route-to":r=>({query:{...p(y).query,view:"userwise","company-id":r.company_id,"user-ids":r.id}})},null,8,["task","tree-level","employee-route-to"]))]),e("div",Rt,[l.task.is_target?(s(),a("div",Ft,o[7]||(o[7]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),q(" TARGET TASK ")]))):n("",!0),_.value?(s(),a("span",Ht,[o[8]||(o[8]=q(" Assign: ")),e("span",zt,S(_.value),1)])):n("",!0),b.value?(s(),a("span",Wt,[o[9]||(o[9]=q(" Deadline: ")),e("span",Kt,S(b.value),1)])):n("",!0),j.value?(s(),a("span",Gt,[o[10]||(o[10]=q(" Started: ")),e("span",Jt,S(j.value),1)])):n("",!0),N.value?(s(),a("span",Yt,[o[11]||(o[11]=q(" Completed: ")),e("span",Qt,S(N.value),1)])):n("",!0)]),e("div",Xt,[e("div",Zt,[e("div",es,[e("button",{class:K([{"text-blue-600 font-semibold  inline-block  ":E.value},"flex items-center gap-1 group"]),onClick:R},[e("i",{class:K([D.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),e("span",{class:K(E.value?"group-hover:underline":"")}," Sub Tasks ("+S((T=l.task.children_tasks)==null?void 0:T.length)+") ",3)],2),!l.task.closed_at&&!l.hideButtons?(s(),a(O,{key:0},[l.treeLevel<2?(s(),a("a",{key:0,href:`/tasks/add?parent_id=${f.task.id}&back-to=${encodeURIComponent(p(y).path+"?"+p(Be)(p(y).query)).toLowerCase()}`,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:o[1]||(o[1]=W(r=>v("addClick",f.task.id),["stop","prevent"]))},o[12]||(o[12]=[e("i",{class:"fas fa-plus"},null,-1),q(" Add Sub Task ")]),8,ts)):n("",!0)],64)):n("",!0)]),e("div",ss,[l.hideButtons?n("",!0):(s(),a("div",ls,[l.task.is_closed?n("",!0):(s(),a("a",{key:0,href:`/tasks/edit/${l.task.id}`,onClick:o[2]||(o[2]=W(r=>v("editClick",l.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},o[13]||(o[13]=[e("i",{class:"fas fa-edit"},null,-1),q(" Edit ")]),8,as)),l.task.is_closed?n("",!0):(s(),a("a",{key:1,href:`/tasks/${l.task.id}/assign-users`,onClick:o[3]||(o[3]=W(r=>v("employeeAssignClick",l.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},o[14]||(o[14]=[e("i",{class:"fas fa-users-cog"},null,-1),q(" Manage Employee & Supervisor ")]),8,os)),$(F,{to:{name:"TaskReports",params:{id:(A=l.task)==null?void 0:A.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:P(()=>o[15]||(o[15]=[e("i",{class:"far fa-file-alt"},null,-1),q(" Reports ")])),_:1,__:[15]},8,["to"])]))])]),D.value?(s(),a("div",ns,[$(Tt,{childrenTasks:l.task.children_tasks,"hide-buttons":l.hideButtons,"hide-assigned-users":l.hideAssignedUsers,"parent-tree-level":l.treeLevel,onEditClick:k,onAddClick:M,onEmployeeAssignClick:g},{"tree-item-end":P(({task:r,level:L})=>[Se(c.$slots,"item-end",{level:L,task:r})]),_:3},8,["childrenTasks","hide-buttons","hide-assigned-users","parent-tree-level"])])):n("",!0)])],2)])}}},is={class:"w-full bg-white rounded"},ds=["rowspan"],us={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(l,{emit:h}){const f=l,y=h,m=w(()=>f.tasks.reduce((k,g)=>(k.push(...g.users.filter(i=>!k.find(C=>C.id==i.id&&i.id))),k),[]).filter(k=>f.selectedUserId?k.id==f.selectedUserId:!0)),v=k=>f.tasks.filter(C=>C.users.some(_=>_.id===k)),M=w(()=>m.value.map(k=>{const g=v(k.id);return{...k,tasks:g}}));return(k,g)=>(s(),a("div",null,[e("table",is,[e("tbody",null,[(s(!0),a(O,null,Y(M.value,i=>(s(),a(O,{key:i.id},[(s(!0),a(O,null,Y(i.tasks,(C,_)=>(s(),a("tr",{key:C.id},[_==0?(s(),a("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(i.tasks.length,1)},[$(ye,{user:i,class:"sticky top-[80px]"},null,8,["user"])],8,ds)):n("",!0),e("td",{class:K(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":_==0,"border-b":i.tasks.length-1===_}])},[$(Ue,{task:C,class:"!border-0 my-0",index:_,onCommentButtonClick:g[0]||(g[0]=b=>y("commentButtonClick",k.item.id)),onEditClick:g[1]||(g[1]=b=>y("editClick",b)),onAddClick:g[2]||(g[2]=b=>y("addClick",b)),onEmployeeAssignClick:g[3]||(g[3]=b=>y("employeeAssignClick",b))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},ms={class:"max-w-full mx-4 p-6 mt-2 relative bg-white rounded-md shadow-md"},cs={class:"mb-4"},fs={class:"relative min-h-[30vh]"},ps={key:0,class:"text-center py-4 text-red-500"},ys={key:1},ks={class:"flex items-stretched"},vs={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},gs=1,zs={__name:"TaskList",setup(l){const h=Oe(),f=ce(),y=ae(),m=Le(),v=B(""),M=B(!1),k=B(null),g=w(()=>{var t;return((t=f==null?void 0:f.user)==null?void 0:t.role)==="employee"||!(f!=null&&f.isAdminMood)?!0:!!y.query["user-ids"]}),i=B(null),C=B(!1),_=ie({parentId:0,requirementId:0}),b=ie({taskId:0,isOpen:!1}),j=B(null),N=B([]),{handleItemsPriorityUpdate:D,saveTaskPriority:E,listHasRearranged:R}=qe(()=>h.taskListTree,0);fe(async()=>{v.value="loading",y.query.status?await c():m.push({query:{...y.query,status:"not-completed"}})});async function c(){let t;y.name==="MyTaskList"?t=await h.fetchMyTasks({...y.query,page:1}):t=await h.fetchTasks({...y.query,page:1},{infiniteScrolling:!1}),v.value="",N.value=t.query_log||[]}const o=t=>{C.value=!0,_.parentId=t},F=t=>{b.taskId=t,b.isOpen=!0},G=t=>{k.value=t,M.value=!0},Q=()=>{M.value=!1,k.value=null};async function z(){i.value=null,C.value=!1,_.parentId=0,v.value="loading",await c()}async function H(){C.value=!1,_.parentId=0,await c()}async function X(){v.value="loading",await E()&&await c()}te(()=>({...y.query}),async()=>{h.resetTaskList(),v.value="loading",await c()});const x=w({get(){return{...y.query}},set(t){localStorage.removeItem("sub_task_opened_list"),m.push({query:{...t}})}});return(t,d)=>{var I,T,A;return s(),a("div",ms,[i.value?(s(),V(se,{key:0},{default:P(()=>[$(Ie,{taskId:i.value,onClose:d[0]||(d[0]=r=>i.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):n("",!0),C.value?(s(),V(se,{key:1},{default:P(()=>[$(Ae,{parentTaskId:_.parentId,requirementId:_.requirementId,onClose:H,onTaskCreated:z},null,8,["parentTaskId","requirementId"])]),_:1})):n("",!0),b.isOpen?(s(),V(se,{key:2,class:"*:max-w-4xl"},{default:P(()=>[$(Te,{taskId:b.taskId,onCancelClick:d[1]||(d[1]=()=>{b.isOpen=!1,b.taskId=0}),onSuccess:d[2]||(d[2]=()=>{b.isOpen=!1,b.taskId=0,v.value="loading",c()})},null,8,["taskId"])]),_:1})):n("",!0),$(dt,{modelValue:x.value,"onUpdate:modelValue":d[3]||(d[3]=r=>x.value=r),onClickAddTask:o,onClickPrioritySave:X,onClickPriorityDiscard:d[4]||(d[4]=()=>p(R)?j.value.resetItems:null),"list-has-rearranged":p(R),isMyTask:p(y).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((T=(I=p(y))==null?void 0:I.query)==null?void 0:T["query-log"])=="true"?(s(!0),a(O,{key:3},Y(N.value,(r,L)=>(s(),a("div",{key:L,class:"text-xs text-gray-500"},[e("div",cs,S(r.raw_query),1)]))),128)):n("",!0),e("div",fs,[p(h).error?(s(),a("div",ps,S(p(h).error),1)):p(h).tasks.length>0?(s(),a("div",ys,[((A=p(y).query)==null?void 0:A.view)=="userwise"?(s(),V(us,{key:0,tasks:p(h).tasks,selectedUserId:p(y).query["user-ids"],onCommentButtonClick:d[5]||(d[5]=r=>G(r,t.task.id)),onEditClick:d[6]||(d[6]=r=>i.value=r),onAddClick:d[7]||(d[7]=r=>o(r)),onEmployeeAssignClick:d[8]||(d[8]=r=>F(r))},null,8,["tasks","selectedUserId"])):(s(),V($e,{key:1,items:p(h).tasks,handle:"handle",onItemsUpdate:p(D),class:"space-y-4",ref_key:"draggableTaskList",ref:j},{item:P(({item:r,index:L})=>[e("div",ks,[$(rs,{"is-my-task":p(y).name==="MyTaskList",task:r,index:L,showDraggableHandle:!g.value,onCommentButtonClick:d[9]||(d[9]=U=>G(U,t.task.id)),onEditClick:d[10]||(d[10]=U=>i.value=U),onAddClick:d[11]||(d[11]=U=>o(U)),onEmployeeAssignClick:d[12]||(d[12]=U=>F(U)),class:"!border-0"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):v.value!=="loading"?(s(),a("div",vs," No tasks found. ")):n("",!0),v.value==="loading"?(s(),V(_e,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):n("",!0)]),$(Ce,{show:M.value,"commentable-id":k.value,"commentable-type":"task","user-id":gs,"on-close":Q,onSubmitted:p(h).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{zs as default};
