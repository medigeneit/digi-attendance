import{u as P,b as K,A as _,r as f,y as T,e as M,c as u,o as c,a as t,j as n,s as A,h as W,v as $,k as b,g as G,F as H,q as J,t as o,n as h}from"./index-Dxc5EEcs.js";import{_ as Q}from"./EmployeeFilter-CYDqYjva.js";import{L as I}from"./LoaderView-BcM1hLIT.js";import{u as X}from"./attendance-ByhdrQKz.js";import{u as Y}from"./company-ED4wwEHa.js";import{u as Z}from"./department-DTxlX0oD.js";import{S as ee}from"./sweetalert2.esm.all-DGhwgajj.js";import"./SelectDropdown-BOLxy_Jy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-EBDAdyaN.js";const te={class:"space-y-4 px-4"},ae={class:"rounded-xl border border-zinc-200 bg-white shadow-sm"},le={class:"flex flex-wrap gap-3 p-4"},se={key:0,class:"py-10 text-center"},ne={key:1,class:"overflow-hidden rounded-xl border border-zinc-200 bg-white shadow-sm"},ie={class:"overflow-x-auto"},oe={class:"min-w-full text-sm"},de={class:"px-3 py-2 align-top"},ue={class:"px-3 py-2 align-top"},ce={class:"inline-flex items-center gap-1 rounded-full bg-zinc-100 px-2 py-0.5 text-xs text-zinc-700"},pe={class:"px-3 py-2 align-top"},me={class:"inline-flex items-center gap-1 rounded-full bg-blue-50 text-blue-700 px-2 py-0.5 text-xs"},re={class:"px-3 py-2 align-top"},ye={class:"max-w-[220px] truncate font-medium text-zinc-800"},fe={class:"px-3 py-2 align-top"},ve={class:"max-w-[220px] truncate text-zinc-700"},xe={class:"px-3 py-2 align-top"},ge={class:"max-w-[220px] truncate text-zinc-700"},_e={class:"px-3 py-2 align-top"},be={class:"inline-flex items-center gap-1 rounded-md bg-amber-50 px-2 py-0.5 text-xs font-medium text-amber-700"},he={class:"px-3 py-2 align-top"},we={class:"px-3 py-2 align-top"},ke={key:1,class:"text-xs italic text-zinc-400"},Se={class:"px-3 py-2 align-top"},ze={class:"inline-flex items-center gap-1 rounded-full bg-indigo-50 text-indigo-700 px-2 py-0.5 text-xs"},De={key:0},Oe={__name:"DailyLateAttendanceReport",setup(Ee){const w=P(),r=K(),v=X(),p=Y(),k=Z(),{dailyLateLogs:S,isLoading:q,selectedDate:z}=_(v),{companies:Ce}=_(p),{departments:Le}=_(k),e=f({company_id:r.query.company_id||"",department_id:r.query.department_id||"",employee_id:r.query.employee_id||"",category:r.query.category||"all",date:r.query.date||""});["company_id","department_id","employee_id","date"].forEach(s=>{e.value[s]=e.value[s]?String(e.value[s]):""}),e.value.category=e.value.category||"all";const d=f(null),y=f([]);z.value=e.value.date||"";function D(){d.value&&d.value.id?e.value.employee_id=String(d.value.id):d.value||(e.value.employee_id=e.value.employee_id||"")}async function R(){await v.getDailyLateReport(e.value.company_id||"",e.value.department_id||"",e.value.category||"all",e.value.employee_id||"",e.value.date||"","daily")}async function U(s){if(!s){y.value=[],d.value=null,e.value.department_id="";return}if(await Promise.all([k.fetchDepartments(s),p.fetchEmployee(s)]),y.value=p.employees||[],e.value.department_id&&((p.employees||[]).some(i=>String(i.department_id)===String(e.value.department_id))||(e.value.department_id="")),e.value.employee_id){const l=(p.employees||[]).find(i=>String(i.id)===String(e.value.employee_id));d.value=l||null,D()}}function B(){if(!e.value.company_id){y.value=[],d.value=null,e.value.employee_id="";return}const s=p.employees||[],l=e.value.department_id,i=e.value.category;let a=s;l&&(a=a.filter(m=>String(m.department_id)===String(l))),i&&i!=="all"&&(a=a.filter(m=>String(m.type)===String(i))),y.value=a,e.value.employee_id&&(a.some(O=>String(O.id)===String(e.value.employee_id))||(d.value=null,e.value.employee_id=""))}let x=null;function N(){x&&clearTimeout(x),x=setTimeout(()=>{const s={};e.value.company_id&&(s.company_id=String(e.value.company_id)),e.value.department_id&&(s.department_id=String(e.value.department_id)),e.value.employee_id&&(s.employee_id=String(e.value.employee_id)),e.value.category&&e.value.category!=="all"&&(s.category=String(e.value.category)),e.value.date&&(s.date=String(e.value.date)),w.replace({query:s}).catch(()=>{})},120)}let g=null;const E=f(e.value.company_id||""),C=f("");async function V(){(e.value.company_id||"")!==(E.value||"")&&(await U(e.value.company_id||""),E.value=e.value.company_id||""),e.value.company_id?B():(y.value=[],d.value=null);const s=JSON.stringify({c:e.value.company_id||"",d:e.value.department_id||"",t:e.value.category||"all",e:e.value.employee_id||"",dt:e.value.date||""});s!==C.value&&(await R(),C.value=s),N()}function L(){g&&clearTimeout(g),g=setTimeout(V,200)}T(()=>({...e.value}),()=>{D(),L()},{deep:!0}),T(()=>e.value.date,s=>{z.value=s||""}),M(async()=>{await p.fetchCompanies(),L()});async function F(){try{console.log("sdf"),await v.lateReportDownloadExcel(e.value.company_id||"",e.value.department_id||"",e.value.category||"all",e.value.employee_id||"",e.value.date||"","daily")}catch{ee.fire({icon:"warning",title:"Heads up",text:"Exporting all companies may be restricted by backend.",confirmButtonText:"OK"})}}function j(){w.go(-1)}return(s,l)=>{var i;return c(),u("div",te,[t("div",{class:"flex flex-wrap items-center justify-between gap-3"},[t("button",{class:"btn-3 inline-flex items-center gap-2",onClick:j,"aria-label":"Go back"},l[5]||(l[5]=[t("i",{class:"fas fa-arrow-left"},null,-1),t("span",{class:"hidden md:inline"},"Back",-1)])),l[7]||(l[7]=t("h1",{class:"title-md md:title-lg text-center flex-1"}," Daily Late Reports ",-1)),t("div",{class:"flex items-center gap-2"},[t("button",{type:"button",onClick:F,class:"btn-3 inline-flex items-center gap-2"},l[6]||(l[6]=[t("i",{class:"fas fa-file-excel text-green-600"},null,-1),t("span",{class:"hidden sm:inline"},"Export",-1)]))])]),t("div",ae,[l[9]||(l[9]=t("div",{class:"flex items-center justify-between border-b border-zinc-100 px-4 py-3"},[t("p",{class:"text-sm text-zinc-600"},[t("i",{class:"fas fa-filter mr-2"}),n(" Filters ")]),t("div",{class:"h-1 w-32 bg-gradient-to-r from-indigo-500 via-sky-500 to-cyan-400 rounded-full"})],-1)),t("div",le,[A(Q,{company_id:e.value.company_id,"onUpdate:company_id":l[0]||(l[0]=a=>e.value.company_id=a),department_id:e.value.department_id,"onUpdate:department_id":l[1]||(l[1]=a=>e.value.department_id=a),employee_id:e.value.employee_id,"onUpdate:employee_id":l[2]||(l[2]=a=>e.value.employee_id=a),category:e.value.category,"onUpdate:category":l[3]||(l[3]=a=>e.value.category=a),"initial-value":s.$route.query,class:"w-full"},null,8,["company_id","department_id","employee_id","category","initial-value"]),t("div",null,[l[8]||(l[8]=t("label",{class:"mb-1 block text-xs font-medium text-zinc-500"},"Date",-1)),W(t("input",{id:"filter-date","onUpdate:modelValue":l[4]||(l[4]=a=>e.value.date=a),type:"date",class:"input-1"},null,512),[[$,e.value.date]])])])]),b(q)?(c(),u("div",se,[A(I)])):(c(),u("div",ne,[t("div",ie,[t("table",oe,[l[19]||(l[19]=t("thead",{class:"bg-zinc-50 sticky top-0 z-10"},[t("tr",{class:"text-left text-zinc-700"},[t("th",{class:"px-3 py-2.5"},"#"),t("th",{class:"px-3 py-2.5"},"Date"),t("th",{class:"px-3 py-2.5"},"Weekday"),t("th",{class:"px-3 py-2.5"},"Employee"),t("th",{class:"px-3 py-2.5"},"Company"),t("th",{class:"px-3 py-2.5"},"Department"),t("th",{class:"px-3 py-2.5"},"Entry Time"),t("th",{class:"px-3 py-2.5"},"Late Duration"),t("th",{class:"px-3 py-2.5"},"Application"),t("th",{class:"px-3 py-2.5"},"Shift")])],-1)),t("tbody",null,[(c(!0),u(H,null,J(b(S),(a,m)=>(c(),u("tr",{key:a.id||m,class:"border-t border-zinc-100 odd:bg-white even:bg-zinc-50 hover:bg-sky-50 transition-colors"},[t("td",de,o(m+1),1),t("td",ue,[t("span",ce,[l[10]||(l[10]=t("i",{class:"far fa-calendar-alt"},null,-1)),n(" "+o((a==null?void 0:a.date)||"-"),1)])]),t("td",pe,[t("span",me,[l[11]||(l[11]=t("i",{class:"far fa-calendar-check"},null,-1)),n(" "+o((a==null?void 0:a.weekday)||"-"),1)])]),t("td",re,[t("div",ye,[l[12]||(l[12]=t("i",{class:"far fa-user mr-1 text-zinc-500"},null,-1)),n(o((a==null?void 0:a.user_name)||"Unknown"),1)])]),t("td",fe,[t("div",ve,[l[13]||(l[13]=t("i",{class:"far fa-building mr-1 text-zinc-500"},null,-1)),n(o((a==null?void 0:a.company_name)||"Unknown"),1)])]),t("td",xe,[t("div",ge,[l[14]||(l[14]=t("i",{class:"far fa-sitemap mr-1 text-zinc-500"},null,-1)),n(o((a==null?void 0:a.department_name)||"Unknown"),1)])]),t("td",_e,[t("span",be,[l[15]||(l[15]=t("i",{class:"far fa-clock"},null,-1)),n(o((a==null?void 0:a.entry_time)||"-"),1)])]),t("td",he,[t("span",{class:h(["inline-flex items-center gap-1 rounded-md px-2 py-0.5 text-xs font-semibold",((a==null?void 0:a.late_duration)||"").trim()?"bg-rose-50 text-rose-700":"bg-zinc-100 text-zinc-500"])},[l[16]||(l[16]=t("i",{class:"fas fa-stopwatch"},null,-1)),n(o((a==null?void 0:a.late_duration)||"â€”"),1)],2)]),t("td",we,[a!=null&&a.short_leave?(c(),u("span",{key:0,class:h(["inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium",{"bg-green-50 text-green-700":a.short_leave.status==="Approved","bg-yellow-50 text-yellow-700":a.short_leave.status==="Pending","bg-rose-50 text-rose-700":a.short_leave.status!=="Approved"&&a.short_leave.status!=="Pending"}])},[t("i",{class:h([a.short_leave.status==="Approved"?"fas fa-check-circle":a.short_leave.status==="Pending"?"fas fa-hourglass-half":"fas fa-times-circle"])},null,2),n(" "+o(a.short_leave.status||"Waiting"),1)],2)):(c(),u("span",ke,"No Application"))]),t("td",Se,[t("span",ze,[l[17]||(l[17]=t("i",{class:"far fa-moon"},null,-1)),n(o((a==null?void 0:a.shift_name)||"-"),1)])])]))),128)),(i=b(S))!=null&&i.length?G("",!0):(c(),u("tr",De,l[18]||(l[18]=[t("td",{colspan:"10",class:"px-3 py-8 text-center text-zinc-500"},[t("i",{class:"far fa-folder-open mr-2"}),n("No late entries found for the selected filters. ")],-1)])))])])])]))])}}};export{Oe as default};
