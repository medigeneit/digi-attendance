import{d as vt,b as bt,m as D,r as M,c as l,o as s,a as t,g as b,H as Q,F as q,k as d,w as I,t as x,q as w,i as U,s as J,f as E,h as tt,C as Tt,L as xt,e as et,E as $t,x as st,j as P,v as gt,n as Y,M as Ct,D as kt,p as N,u as St,z as mt}from"./index-2SPaUKUG.js";import{L as X}from"./LoaderView-joPIgo-v.js";import{O as W}from"./OverlyModal-DrmtDoKb.js";import{_ as wt}from"./TaskAddForm-BnHMwb6W.js";import{_ as Dt}from"./TaskEditForm-CUqVp2jf.js";import{_ as Et,b as It,c as Pt,e as Lt,T as Ut,d as Mt}from"./TaskTreeView-gPT9S1BP.js";import{a as At,_ as Ot}from"./TaskUserAssignForm-CkY7kX2c.js";import{u as Nt,r as jt,d as Rt,a as Bt}from"./task-priority-CQuAE2Ql.js";import{a as Z,g as Ft,b as Vt}from"./datetime-BlGg5F0U.js";import{_ as ft}from"./UserChip-DY_gvV0H.js";import{u as Gt}from"./useTaskStore-CKQmTbo7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-9_dZzkA_.js";import"./company-DnRIFKt0.js";import"./useRequirementStore-B_mZBVLU.js";import"./requirement-BUCm83LW.js";import"./CompanyDepartmentSelectInput-DKG1Bgg2.js";import"./SectionLoading-DXJJS38P.js";import"./TextWithHr-Bv7RTCZn.js";import"./TaskUrgencyInput-BAfmD1Ko.js";import"./tags-D2alWKyh.js";import"./MultiselectDropdown-4cqz4cEk.js";import"./url-CePbr-gY.js";import"./TaskUserChip-CpXu5N9c.js";const qt={class:"mb-3"},Ht={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},zt={key:1,class:"text-center py-4 text-gray-500"},Wt={key:2,class:"text-center py-4 text-red-500"},Zt={key:3,class:"space-y-4"},Kt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(p,{emit:a}){const e=p,n=vt(),o=bt(),u=D(()=>{var v;return!!(((v=n==null?void 0:n.user)==null?void 0:v.role)!=="employee"&&(n!=null&&n.isAdminMood))}),y=a,m=M(null),{handleItemsPriorityUpdate:r,saveTaskPriority:f,listHasRearranged:c}=Nt(()=>e.tasks,e.parentId),$=async()=>{await f(),y("updatePriority")};return(v,g)=>(s(),l("div",null,[t("div",qt,[Q(v.$slots,"task:header")]),u.value?(s(),l(q,{key:0},[d(c)?(s(),l("div",Ht,[g[4]||(g[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:I($,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:g[0]||(g[0]=I((...h)=>m.value.resetItems&&m.value.resetItems(...h),["prevent"]))},"Discard")])):b("",!0)],64)):b("",!0),p.loading?(s(),l("div",zt,"Loading tasks...")):p.error?(s(),l("div",Wt,x(p.error),1)):(s(),l("div",Zt,[w(At,{items:p.tasks,handle:"handle",onItemsUpdate:d(r),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:m},{item:U(({item:h,index:_})=>[w(Et,{isMyTask:d(o).name=="MyTaskShow",index:_,task:h,showDraggableHandle:u.value,"tree-level":p.treeLevel,class:"!border-0",onCommentButtonClick:C=>y("commentButtonClick",h.id),onEditClick:g[1]||(g[1]=C=>y("editClick",C)),onAddClick:g[2]||(g[2]=C=>y("addClick",C)),onEmployeeAssignClick:g[3]||(g[3]=C=>y("employeeAssignClick",C))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Yt={class:"flex justify-between mt-5"},Jt={class:"flex justify-between items-center"},Qt={class:"w-32 relative h-8 mx-4"},Xt={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},te={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(p,{emit:a}){const e=p,n=J({taskId:0,isOpen:!1}),o=M("not-completed"),u=a,y=M(),m=J({show:!1,parentId:e.parentId,requirementId:null}),r=h=>{m.show=!0,m.parentId=h,console.log({addForm:m})};function f(){m.show=!1,m.parentId=e.parentId,u("created")}function c(){u("assignUser")}function $(){y.value=!1,u("updated")}function v(){m.show=!1,m.parentId=e.parentId}const g=D(()=>e.subTasks.filter(h=>o.value==="not-completed"?h.status!=="COMPLETED":o.value==="only-completed"?h.status==="COMPLETED":!0));return(h,_)=>(s(),l("div",null,[y.value?(s(),E(W,{key:0},{default:U(()=>[w(Dt,{taskId:y.value,onClose:_[0]||(_[0]=C=>y.value=null),onUpdated:$},null,8,["taskId"])]),_:1})):b("",!0),m.show?(s(),E(W,{key:1},{default:U(()=>[w(wt,{parentTaskId:m.parentId,requirementId:m.requirementId,onTaskCreated:f,onError:h.handleTaskError,onClose:v},null,8,["parentTaskId","requirementId","onError"])]),_:1})):b("",!0),n.isOpen?(s(),E(W,{key:2},{default:U(()=>[w(Ot,{taskId:n.taskId,onCancelClick:_[1]||(_[1]=()=>{n.isOpen=!1,n.taskId=0}),onSuccess:_[2]||(_[2]=()=>{n.isOpen=!1,n.taskId=0,c()})},null,8,["taskId"])]),_:1})):b("",!0),w(Kt,{tasks:g.value,parentId:p.parentId,treeLevel:p.treeLevel,onAddClick:_[5]||(_[5]=C=>r(C)),onEditClick:_[6]||(_[6]=C=>y.value=C),onUpdatePriority:_[7]||(_[7]=C=>u("updatePriority")),onEmployeeAssignClick:_[8]||(_[8]=C=>{n.taskId=C,n.isOpen=!0})},{"task:header":U(()=>[t("div",Yt,[t("div",Jt,[_[11]||(_[11]=t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks",-1)),t("div",Qt,[_[10]||(_[10]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),tt(t("select",{"onUpdate:modelValue":_[3]||(_[3]=C=>o.value=C),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},_[9]||(_[9]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[Tt,o.value]])])]),p.subTaskIsCreatable?(s(),l("div",Xt,[t("button",{class:"btn-1 ml-auto",onClick:_[4]||(_[4]=I(()=>r(p.parentId),["prevent"]))}," Add Sub Task ")])):b("",!0)])]),_:1},8,["tasks","parentId","treeLevel"])]))}},ee={key:0},se={key:0},ae={key:1},le={key:2},ne={key:3},oe={key:1},re=xt({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(p){const a=p;let e=0;const n=M(y());let o;function u(){return a.millisecond&&typeof a.millisecond=="number"}function y(){u()?e&&(e-=1e3):e=new Date(a.targetDateTime).getTime()-new Date().getTime();const v=Math.floor(e/1e3%60),g=Math.floor(e/1e3/60%60),h=Math.floor(e/(1e3*60*60)%24),_=Math.floor(e/(1e3*60*60*24));return{total:e,days:_,hours:h,minutes:g,seconds:v}}function m(){n.value=y()}et(()=>{u()&&(e=a.millisecond),console.log("MOUNTED"),m(),o=setInterval(()=>{m(),n.value.total<=0&&clearInterval(o)},1e3)}),$t(()=>clearInterval(o)),st(()=>a.targetDateTime,()=>{m(),clearInterval(o)});const r=D(()=>n.value.days.toString().padStart(2,"0")),f=D(()=>n.value.hours.toString().padStart(2,"0")),c=D(()=>n.value.minutes.toString().padStart(2,"0")),$=D(()=>n.value.seconds.toString().padStart(2,"0"));return(v,g)=>n.value.total>0?(s(),l("span",ee,[!v.hideIfZeroValue||r.value!="00"?(s(),l("span",se,x(r.value)+"d : ",1)):b("",!0),!v.hideIfZeroValue||f.value!="00"?(s(),l("span",ae,x(f.value)+"h : ",1)):b("",!0),!v.hideIfZeroValue||c.value!="00"?(s(),l("span",le,x(c.value)+"m : ",1)):b("",!0),!v.hideIfZeroValue||$.value!="00"?(s(),l("span",ne,x($.value)+"s",1)):b("",!0)])):(s(),l("span",oe,[Q(v.$slots,"expired")]))}}),ie={class:"mb-2 mt-6"},de={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},ue={class:"flex justify-center"},ce={class:"py-6 w-full text-center"},pe={class:"block mb-2"},ke={class:"font-semibold text-red-600 mx-2 text-xl"},me={class:"mt-2"},fe={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},ye={class:"flex justify-between items-center"},ve={key:0,class:"btn-2-red"},be={key:1,class:"btn-2-red"},yt=5e3,xe={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(p,{emit:a}){const e=p,n=M(""),o=M(""),u=a,y=M("");let m=0;async function r(){var $,v;if(!n.value)return y.value="Type the task title on input box";clearTimeout(m);try{y.value="",o.value==="deleted"?(o.value="restoring",await jt(e.task.id),o.value="restored"):(o.value="deleting",await Rt(e.task.id,{params:{security_check:n.value}}),o.value="deleted"),o.value=="deleted"?m=setTimeout(()=>{c()},yt):u("closeClick")}catch(g){o.value="error",y.value=((v=($=g.response)==null?void 0:$.data)==null?void 0:v.message)||`Failed to update ${e.type}`}}function f(){o.value==="deleted"&&c(),u("closeClick")}function c(){o.value="",u("delete")}return($,v)=>{var g,h;return s(),l("form",{class:"p-4 relative",onSubmit:I(r,["prevent"])},[v[7]||(v[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",ie,[v[1]||(v[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,x((g=p.task)==null?void 0:g.title),1)]),o.value=="deleted"?(s(),l("div",de,v[2]||(v[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(s(),l(q,{key:1},[t("div",ue,[t("div",ce,[t("label",pe,[v[3]||(v[3]=P(" Type ")),t("span",ke,x((h=p.task)==null?void 0:h.title),1),v[4]||(v[4]=P(" and submit to delete "))]),tt(t("input",{type:"text","onUpdate:modelValue":v[0]||(v[0]=_=>n.value=_),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[gt,n.value]])])]),v[5]||(v[5]=t("hr",null,null,-1)),t("div",me,[y.value?(s(),l("div",fe,x(y.value),1)):b("",!0)])],64)),t("div",ye,[t("button",{class:"btn-3",type:"button",onClick:I(f,["prevent"])},"Close"),o.value=="deleted"?(s(),l("button",ve,[v[6]||(v[6]=P(" Undo Delete in ")),o.value=="deleted"?(s(),E(re,{key:0,"hide-if-zero-value":!0,millisecond:yt})):b("",!0)])):(s(),l("button",be,"Delete"))]),o.value=="deleting"||o.value=="restoring"?(s(),E(X,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:U(()=>[P(x(String(o.value).charAt(0).toUpperCase()+String(o.value).slice(1)),1)]),_:1})):b("",!0)],32)}}},ge=p=>p==null?void 0:p.reduce((a,e)=>a+e.task_weight,0),_t=(p,a)=>{const e=ge(p);return p.map(n=>{const o=a.filter(u=>u.user_id===n.id).reduce((u,y)=>u+y.progress,0);return{...n,task_progress:Math.floor(o*(n.task_weight/e)),user_progress:o}})},_e=(p,a)=>{let e=0;const n=[],o=m=>m.status==="COMPLETED",u=m=>m.users.some(r=>r.id===a),y=(m,r)=>{m.forEach(f=>{const c=u(f);n[r]=n[r]||{user_id:a,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const $=c&&f.children_tasks.length===0;n[r].total_assigned+=c?1:0,n[r].total_assigned_on_leaf_task+=$?1:0,e+=$?1:0,c&&o(f)&&(n[r].completed_count++,f.children_tasks.length),f.children_tasks.length>0&&y(f.children_tasks,r+1)})};return y(p,0),{sub_task_infos:n,assigned_on_any_leaf_task:e>0}},he=(p,a)=>p.map(e=>({...e,..._e(a,e.id)})),Te={key:0,class:"min-w-full bg-white rounded overflow-hidden"},$e={class:"py-0.5 text-bg font-semibold"},Ce={class:"bg-gray-50"},Se={class:"px-2 py-1 border-y"},we={class:"px-2 py-1 border-y"},De={key:0,class:"text-sm text-gray-400"},Ee={key:1},Ie={key:1,class:"min-w-full bg-white rounded overflow-hidden"},Pe={class:"py-0.5 text-bg font-semibold"},Le={class:"px-2 py-1 border-y text-center"},Ue={class:"px-2 py-1 border-y border-r"},Me={class:"px-2 py-1 border-y text-center"},Ae={class:"px-2 py-1 border-y text-center"},Oe=xt({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(p){const a=p,e=D(()=>_t(a.task.users,a.task.task_reports||[])),n=D(()=>he(a.task.users,a.subTasks));return(o,u)=>{var y,m;return a.task.children_task_count>0?(s(),l("table",Te,[t("caption",$e,[Q(o.$slots,"caption",{},()=>[u[0]||(u[0]=P("Progress"))])]),t("thead",Ce,[t("tr",null,[u[1]||(u[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),u[2]||(u[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(s(!0),l(q,null,Y(((m=(y=n.value[0]||{})==null?void 0:y.sub_task_infos)==null?void 0:m.length)||1,r=>(s(),l("th",{key:r,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},x(r===1?"Completed Sub Task":"")+" "+x(r===2?"Completed Sub Sub Task":"")+" "+x(r===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(s(!0),l(q,null,Y(n.value,(r,f)=>(s(),l("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Se,x(f+1),1),t("td",we,[w(ft,{user:r},null,8,["user"])]),(s(!0),l(q,null,Y(r.sub_task_infos,(c,$)=>(s(),l("td",{class:"px-2 py-1 border-y text-center",key:$},[c.total_assigned===0||!r.assigned_on_any_leaf_task?(s(),l("div",De," Not Assigned To Any Task ")):(s(),l("div",Ee,x(c.completed_count)+" / "+x(c.total_assigned),1))]))),128))]))),128))])])):(s(),l("table",Ie,[t("caption",Pe,[Q(o.$slots,"caption",{},()=>[u[3]||(u[3]=P("Progress"))])]),u[4]||(u[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(s(!0),l(q,null,Y(e.value,(r,f)=>(s(),l("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Le,x(f+1),1),t("td",Ue,[w(ft,{user:r},null,8,["user"])]),t("td",Me,x(d(Z)(r.task_started_at)),1),t("td",Ae,x(d(Z)(r.task_finished_at)),1)]))),128))])]))}}}),Ne=Ct("task-user",()=>({updateUserStartDate:async(e,n,o)=>await kt.patch(`/task-user/task/${e}/user/${n}/update-start-date/${o}`),updateUserFinishDate:async(e,n,o)=>await kt.patch(`/task-user/task/${e}/user/${n}/update-finish-date/${o}`)})),je={class:"border-b text-center"},Re={key:0},Be={key:1},Fe={class:"text-center font-semibold text-blue-800 my-4"},Ve={class:"flex justify-center w-full"},Ge={class:"py-6 w-4/12"},qe={class:"block text-xs font-semibold"},He={class:"mt-3"},ze={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},We={class:"flex justify-between items-center"},ht={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(p,{emit:a}){const e=p,n=a,o=Ne(),u=M(""),y=M("");async function m(){var f,c;console.log({date:u.value});try{e.type=="start-date"?await o.updateUserStartDate(e.task.id,e.user.id,u.value||"0"):e.type=="finish-date"&&await o.updateUserFinishDate(e.task.id,e.user.id,u.value||"0"),n("updateDate")}catch($){y.value=((c=(f=$.response)==null?void 0:f.data)==null?void 0:c.message)||`Failed to update ${e.type}`}}function r(f){if(f){const c=e.type==="start-date"?f.started_at:f.completed_at;u.value=Ft(c)}}return st(()=>e.task,f=>{r(f)},{immediate:!0}),et(()=>{r(e.task)}),(f,c)=>(s(),l("form",{class:"p-4",onSubmit:I(m,["prevent"])},[t("div",je,[p.type=="start-date"?(s(),l("h2",Re,"Edit Start Date")):p.type=="finish-date"?(s(),l("h2",Be,"Edit Completed Date")):b("",!0)]),t("div",Fe,x(p.task.title),1),t("div",Ve,[t("div",Ge,[t("label",qe,x(p.type=="start-date"?"Start date":"Completed date"),1),tt(t("input",{type:"date","onUpdate:modelValue":c[0]||(c[0]=$=>u.value=$),class:"border py-2 px-4 rounded-md w-full"},null,512),[[gt,u.value]])])]),c[3]||(c[3]=t("hr",{class:"mt-4"},null,-1)),t("div",He,[y.value?(s(),l("div",ze,x(y.value),1)):b("",!0)]),t("div",We,[t("button",{class:"btn-3",onClick:c[1]||(c[1]=I($=>n("closeClick"),["prevent"]))},"Close"),c[2]||(c[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},Ze={key:0},Ke={key:1,class:"flex"},Ye={class:"border-r-2 border-dashed pr-6 border-gray-300"},Je={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Qe={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Xe={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},ts={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},es={key:0},ss=["disabled"],as=["disabled"],ls={class:"text-lg font-semibold text-gray-700"},ns={class:"text-sm text-gray-500"},os={class:"flex flex-grow justify-center items-center"},rs={key:0,class:"flex flex-col justify-center items-center"},is={key:1},ds={key:1},us={key:2,class:"flex justify-center items-center flex-col"},cs={key:3,class:"flex flex-col justify-center items-center"},ps={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},ks={class:"my-6"},ms={class:"text-center font-semibold text-blue-800 mb-4"},fs={class:"text-center my-1"},ys={class:"border px-2 rounded-md bg-gray-50"},vs={class:"text-red-600 text-center mt-2 text-sm"},bs={class:"flex justify-between mt-3"},xs={class:"btn-2"},gs={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(p,{emit:a}){const e=p,n=a,o=vt(),u=M(""),y=M(),m=M(),r=J({user:null,type:""});function f(S){r.user=o.user,r.type=S}const c={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},$=D(()=>(c==null?void 0:c[g.value])||0),v=D(()=>{var S;return{"bg-yellow-50":g.value==="IN_PROGRESS","bg-green-50":g.value==="COMPLETED","bg-red-50":g.value==="PENDING","bg-blue-50":(S=e.task)==null?void 0:S.closed_at}}),g=D(()=>{var S;return(S=e.task)==null?void 0:S.status}),h=D(()=>g.value=="PENDING"?"Start":g.value=="IN_PROGRESS"?"Finish":g.value=="COMPLETED"?"Close":""),_=D(()=>h.value=="Start"?"Start Task":h.value=="Finish"?"Finish Task":h.value=="Close"?"Close Task":"");async function C(){var S,i;y.value="submitting";try{await Bt(e.task.id,{status:u.value}),u.value="",n("updateStatus")}catch(O){m.value=(i=(S=O.response)==null?void 0:S.data)==null?void 0:i.message,n("error")}finally{y.value=""}}const A=D(()=>h.value=="Start"?"fas fa-play-circle text-blue-500":h.value=="Finish"?"fas fa-stop-circle text-blue-500":""),k=D(()=>{var S,i,O,j,R,B,T,F,V,G;return[{date:Z(((S=e.task)==null?void 0:S.assigned_at)||((i=e.task)==null?void 0:i.created_at)),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((O=e.task)!=null&&O.assigned_at)||!!((j=e.task)!=null&&j.created_at)},{date:Z((R=e.task)==null?void 0:R.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((B=e.task)!=null&&B.started_at)||$.value>=c.IN_PROGRESS},{date:Z((T=e.task)==null?void 0:T.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((F=e.task)!=null&&F.completed_at)||$.value>=c.COMPLETED},{date:Z((V=e.task)==null?void 0:V.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((G=e.task)!=null&&G.deadline)}].sort((H,z)=>H.date===null||z.date===null||new Date(H.date)==new Date(z.date)?H.serial-z.serial:new Date(H.date)-new Date(z.date))});return(S,i)=>{var O,j,R,B;return s(),l("div",{class:N(["border py-8 px-4 rounded",v.value])},[g.value==="BLOCKED"?(s(),l("div",Ze,i[8]||(i[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(s(),l("div",Ke,[t("div",Ye,[(O=e.task)!=null&&O.is_target?(s(),l("div",Je,i[9]||(i[9]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),P(" TARGET TASK ")]))):b("",!0),t("ol",Qe,[(s(!0),l(q,null,Y(k.value,(T,F)=>{var V,G;return s(),l("li",{class:"ml-5",key:F},[t("div",Xe,[T.active?(s(),l("i",{key:0,class:N([T.icon,"text-xs"])},null,2)):b("",!0)]),t("div",{class:N({"opacity-30":!T.active})},[t("div",ts,[T.date?(s(),l("span",es,x(T.date),1)):b("",!0),((V=e.task)==null?void 0:V.children_task_count)===0&&T.status==="started"&&T.active?(s(),l("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:i[0]||(i[0]=I(()=>f("start-date"),["prevent"])),disabled:!!e.task.closed_at},x(T.date?"Edit":"Set Date"),9,ss)):b("",!0),((G=e.task)==null?void 0:G.children_task_count)===0&&T.active&&T.status==="completed"?(s(),l("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:i[1]||(i[1]=I(()=>f("finish-date"),["prevent"])),disabled:!!e.task.closed_at},x(T.date?"Edit":"Set Date"),9,as)):b("",!0)]),t("h3",ls,x(T.title),1),t("p",ns,x(T.description),1)],2)])}),128))])]),t("div",os,[(j=p.task)!=null&&j.closed_at?(s(),l("div",rs,i[10]||(i[10]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):g.value==="PENDING"?(s(),l("div",is,[((R=p.task)==null?void 0:R.children_task_count)===0?(s(),l("button",{key:0,class:"btn-3 mt-2",onClick:i[2]||(i[2]=I(T=>u.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(s(),l("div",ds,i[11]||(i[11]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),t("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):g.value==="IN_PROGRESS"?(s(),l("div",us,[i[12]||(i[12]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),i[13]||(i[13]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((B=p.task)==null?void 0:B.children_task_count)===0?(s(),l("button",{key:0,class:"btn-3",onClick:i[3]||(i[3]=I(T=>u.value="COMPLETED",["prevent"]))}," Finish Task ")):b("",!0)])):g.value==="COMPLETED"?(s(),l("div",cs,[i[14]||(i[14]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),i[15]||(i[15]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:i[4]||(i[4]=I(T=>u.value="CLOSED",["prevent"]))},"Close Task")])):b("",!0)])])),u.value?(s(),E(W,{key:2},{default:U(()=>{var T;return[t("form",{class:"p-4 rounded relative",onSubmit:I(C,["prevent"])},[y.value==="submitting"?(s(),E(X,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:U(()=>i[16]||(i[16]=[P("Submitting!")])),_:1,__:[16]})):b("",!0),t("h3",ps,x(_.value),1),t("div",ks,[t("div",ms,x((T=p.task)==null?void 0:T.title),1),i[19]||(i[19]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",fs,[i[17]||(i[17]=P(" Want to ")),t("span",ys,[t("i",{class:N(["text-sm",A.value])},null,2),P(" "+x(h.value),1)]),i[18]||(i[18]=P(" the task? "))])]),i[20]||(i[20]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",vs,x(m.value),1),t("div",bs,[t("button",{class:"btn-3",onClick:i[5]||(i[5]=I(F=>u.value="",["prevent"]))},"Cancel"),t("button",xs,[t("i",{class:N(["text-xl text-white",A.value])},null,2),P(" "+x(h.value)+" Task ",1)])])])],32)]}),_:1})):b("",!0),r!=null&&r.user?(s(),E(W,{key:3},{default:U(()=>[w(ht,{task:e.task,user:r.user,type:r.type,onCloseClick:i[6]||(i[6]=T=>r.user=null),onUpdateDate:i[7]||(i[7]=()=>{r.user=null,r.type=null,n("updateStatus")})},null,8,["task","user","type"])]),_:1})):b("",!0)],2)}}},_s={class:"container mx-auto p-6"},hs={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},Ts={class:"grid grid-cols-4"},$s={class:"mb-4 flex col-span-full"},Cs={class:"font-medium text-xl"},Ss={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},ws={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-2 py-[2px] rounded-full border border-green-200 opacity-80"},Ds={class:"text-gray-400 text-xs mt-2 col-span-full"},Es={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},Is={class:"col-span-full mb-4"},Ps=["innerHTML"],Ls={key:0,class:"mt-4 col-span-full mb-6"},Us={class:"mt-6 py-2 flex justify-center items-center gap-2 col-span-full"},Ms=["disabled"],As={class:"ml-auto flex gap-4"},Os={key:0},Ns={key:1},js={key:1,class:"text-center py-4 text-red-500"},da={__name:"TaskShow",setup(p){const a=Gt(),e=bt(),n=St(),o=M(""),u=D(()=>a.tasks),y=M({}),m=J({open:!1,task:null}),r=M(!0);et(async()=>{o.value="loading",await c(e.params.id),o.value=""});const f=J({user:null,type:""});async function c(A){await a.fetchTask(A)}const $=D(()=>_t(a.task.users,a.task.task_reports||[]));async function v(){await c(e.params.id),f.user=null,f.type=""}const g=A=>{n.push({name:"TaskEdit",params:{id:A}})},h=D(()=>{var A,k;return a.task?((A=a.task)==null?void 0:A.parent_id)==0?{name:e.name==="MyTaskShow"?"MyTaskList":"TaskList"}:{params:{id:(k=a.task)==null?void 0:k.parent_id}}:null});function _(){m.open=!0,m.task=a.task}function C(){m.open=!1,console.log({STATE:"Deleted",backLink:h.value}),n.push(h.value)}return st(()=>e.params.id,async A=>{o.value="changing",await c(A),o.value=""}),(A,k)=>{var O,j,R,B,T,F,V,G,H,z,at,lt,nt,ot,rt,it,dt,ut,ct;const S=mt("RouterLink"),i=mt("router-view");return s(),l("div",_s,[f.user?(s(),E(W,{key:0},{default:U(()=>[w(ht,{task:d(a).task,user:f.user,type:f.type,onCloseClick:k[0]||(k[0]=L=>f.user=null),onUpdateDate:v},null,8,["task","user","type"])]),_:1})):b("",!0),m.open?(s(),E(W,{key:1},{default:U(()=>[w(xe,{onCloseClick:k[1]||(k[1]=L=>m.open=!1),task:m.task,onDelete:C},null,8,["task"])]),_:1})):b("",!0),o.value==="loading"?(s(),E(X,{key:2})):(s(),l("div",hs,[d(a).task?(s(),l(q,{key:0},[t("section",Ts,[t("div",$s,[t("div",null,[t("h2",Cs,x(d(a).task.title),1),t("div",Ss,[d(a).task.parent_id==0?(s(),l("div",ws," MAIN TASK ")):b("",!0),(O=d(a).task)!=null&&O.is_important?(s(),E(Ut,{key:1})):b("",!0),(j=d(a).task)!=null&&j.is_urgent?(s(),E(Mt,{key:2})):b("",!0)]),t("div",Ds,[k[13]||(k[13]=t("i",{class:"fas fa-clock"},null,-1)),P(" "+x(d(Vt)(d(a).task.created_at)),1)])]),t("div",Es,[w(It,{status:(R=d(a).task)==null?void 0:R.status,progressPercent:(B=d(a).task)==null?void 0:B.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),d(a).task?(s(),E(Pt,{key:0,task:d(a).task,ref_key:"progress",ref:y,class:"!text-lg"},null,8,["task"])):b("",!0)])]),t("div",Is,[t("p",{innerHTML:(T=d(a).task)==null?void 0:T.description,class:N(["text-gray-700",{"line-clamp-3":r.value}])},null,10,Ps),((V=(F=d(a).task)==null?void 0:F.description)==null?void 0:V.length)>=600?(s(),l("button",{key:0,class:"text-blue-500 mt-2",onClick:k[2]||(k[2]=I(L=>r.value=!r.value,["prevent"]))}," Show "+x(r.value?"More":"Less"),1)):b("",!0)]),w(Lt,{task:(G=d(a))==null?void 0:G.task,"tree-level":(z=(H=d(a))==null?void 0:H.task)==null?void 0:z.level},null,8,["task","tree-level"]),d(a).task.children_task_count>0?(s(),l("section",Ls,[w(Oe,{"task-users":((at=d(a).task)==null?void 0:at.users)||[],task:d(a).task,"sub-tasks":d(a).tasks,"progress-users":$.value},{caption:U(()=>k[14]||(k[14]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):b("",!0),(lt=d(a))!=null&&lt.task?(s(),E(gs,{key:1,task:((nt=d(a))==null?void 0:nt.task)||{},class:"col-span-full mt-4",onUpdateStatus:k[3]||(k[3]=L=>{var K,pt;return c((pt=(K=d(a))==null?void 0:K.task)==null?void 0:pt.id)})},null,8,["task"])):b("",!0),t("div",Us,[t("button",{onClick:k[4]||(k[4]=I(L=>{var K;return g((K=d(a).task)==null?void 0:K.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!d(a).task.closed_at}," Edit ",8,Ms),w(S,{to:{name:"TaskUserAssign",params:{id:(ot=d(a).task)==null?void 0:ot.id}},class:N(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",d(a).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:k[5]||(k[5]=L=>L.stopPropagation())},{default:U(()=>k[15]||(k[15]=[t("i",{class:"fas fa-user-plus"},null,-1),P(" Assign Users ")])),_:1,__:[15]},8,["to","class"]),w(S,{to:h.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none",onClick:k[6]||(k[6]=L=>L.stopPropagation())},{default:U(()=>k[16]||(k[16]=[t("i",{class:"fas fa-arrow-left"},null,-1),P(" Back ")])),_:1,__:[16]},8,["to"]),t("div",As,[((rt=d(a).task)==null?void 0:rt.children_task_count)===0&&((it=d(a).task)==null?void 0:it.status)==="PENDING"?(s(),l("button",{key:0,class:"btn-2-red h-8",onClick:I(_,["prevent"])}," Delete ")):b("",!0),u.value.length>0?(s(),E(S,{key:1,to:{name:"TaskShow",params:{id:(dt=d(a).task)==null?void 0:dt.id}},onClick:k[7]||(k[7]=L=>L.stopPropagation()),class:N(["py-0.5 btn-3 ml-auto text-sm h-8",{"bg-blue-500 text-white":d(e).name=="TaskShow"||d(e).name==="MyTaskShow"}])},{default:U(()=>k[17]||(k[17]=[t("i",{class:"fal fa-list-ul"},null,-1),P(" Sub Tasks ")])),_:1,__:[17]},8,["to","class"])):b("",!0),w(S,{to:{name:"TaskReports",params:{id:(ut=d(a).task)==null?void 0:ut.id}},onClick:k[8]||(k[8]=L=>L.stopPropagation()),class:N(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":d(e).name=="TaskReports"}])},{default:U(()=>k[18]||(k[18]=[t("i",{class:"fal fa-file-alt"},null,-1),P(" Reports ")])),_:1,__:[18]},8,["to","class"])])])]),(d(e).name=="TaskShow"||d(e).name==="MyTaskShow")&&((ct=d(a).task)==null?void 0:ct.level)<=2?(s(),l("section",Os,[w(te,{subTasks:u.value,"parent-id":d(e).params.id,"tree-level":d(a).task.level+1,onCreated:k[9]||(k[9]=L=>c(d(e).params.id)),onUpdated:k[10]||(k[10]=L=>c(d(e).params.id)),onUpdatePriority:k[11]||(k[11]=L=>c(d(e).params.id)),onAssignUser:k[12]||(k[12]=L=>c(d(e).params.id)),"sub-task-is-creatable":!d(a).task.closed_at},null,8,["subTasks","parent-id","tree-level","sub-task-is-creatable"])])):(s(),l("section",Ns,[w(i)]))],64)):(s(),l("div",js,x(d(a).error),1)),o.value==="changing"?(s(),E(X,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):b("",!0)]))])}}};export{da as default};
