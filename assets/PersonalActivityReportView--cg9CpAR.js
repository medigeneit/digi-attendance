import{g as ae,D as re,f as de,u as ie,G as pe,r as z,x as m,q as N,h as ue,c as y,o as p,a as e,i as W,j as T,t as a,m as E,w as me,k as j,v as K,b as R,l as C,F as Y,e as H,d as Q,M as ye,s as ce}from"./index-rim-Johs.js";import{_ as xe}from"./EmployeeFilter-CxXZgkef.js";import{L as fe}from"./LoaderView-DEVpObhu.js";import{U as ge}from"./UserHoverBubble-DLAARv6I.js";import{g as J,m as ve,c as be,b as P,a as X}from"./datetime-Du_mcDA9.js";import{u as _e}from"./useTodoDateStore-DDGTfr0n.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-MCo-adn3.js";import"./department-COMdvwAX.js";import"./EmployeeDropdownInput-CVkF2gqI.js";import"./SelectDropdown-Ctazh1VN.js";import"./UserChip-WFUGEQMB.js";import"./user-BXd-M3xm.js";import"./url-CePbr-gY.js";const we={class:"container mx-auto print:w-full print:px-0 print:py-0"},ke={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},Ie={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},Te={key:0,class:"text-gray-400"},De=["disabled"],Oe={class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0"},Se={key:0,class:"flex flex-wrap items-center gap-3"},Me={class:"relative h-[32px] w-[170px]"},Ne={class:"text-xs text-blue-600 flex items-center gap-2"},Ee={class:"relative h-[32px]"},Re={key:0,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},Ce={key:2,class:"space-y-4"},Pe={class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},Le={class:"text-sm text-gray-700"},Ue={class:"font-semibold"},Fe={class:"text-sm text-gray-700"},Ve={class:"font-semibold"},Ae={class:"text-sm text-gray-700"},Be={class:"font-semibold text-green-600"},$e={class:"text-sm text-gray-700"},qe={class:"font-semibold text-blue-600"},Ge={class:"text-sm text-gray-700"},ze={class:"font-semibold text-amber-600"},We={key:0,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},je={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},Ke={class:"flex items-center gap-3"},Ye={class:"font-semibold text-gray-800"},He={class:"text-xs text-gray-500"},Qe={class:"text-[11px] text-gray-400"},Je={key:0},Xe={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},Ze={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},et={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},tt={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},st={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},ot={class:"overflow-x-auto"},nt={class:"min-w-full text-left text-sm border-separate border-spacing-0"},lt={key:0},at={class:"px-4 py-3 text-center border"},rt={class:"px-4 py-3 border"},dt={class:"font-semibold text-gray-800"},it={class:"text-xs text-gray-500"},pt={class:"px-4 py-3 border text-xs text-gray-700"},ut={class:"px-4 py-3 border text-center"},mt={__name:"PersonalActivityReportView",props:{selfOnly:{type:Boolean,default:!1}},setup(Z){const i=Z,_=_e(),ee=ae(),{user:g}=re(ee),D=de(),te=ie(),l=pe({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),r=z(""),L=z(null),v=m(()=>{if(!r.value)return"";const[s,t]=r.value.split("-").map(Number);return!s||!t?"":J(new Date(s,t-1,1))}),b=m(()=>{if(!r.value)return"";const[s,t]=r.value.split("-").map(Number);return!s||!t?"":J(ve(new Date(s,t-1,1)))}),U=m(()=>r.value?be(`${r.value}-01`):""),h=m(()=>v.value&&b.value?`${P(v.value)} ~ ${P(b.value)}`:""),O=m(()=>{var s;return i.selfOnly?((s=g.value)==null?void 0:s.company_id)||"":l.companyId}),F=m(()=>!v.value||!b.value?!1:i.selfOnly?!!c.value&&!!O.value:!!O.value),V=m(()=>_.todo_dates||[]),c=m(()=>{var s;return(s=g.value)!=null&&s.id?String(g.value.id):""});function se(s){l.companyId=s.company_id||"",l.departmentId=s.department_id||"",l.employeeId=i.selfOnly?c.value:s.employee_id||"",l.lineType=s.line_type||"all"}function oe(s){return s==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":s==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":s==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"}function A(s){var t,n;return s.todo_id||s.todoId||((t=s.todo)==null?void 0:t.id)||((n=s.todo)==null?void 0:n.todo_id)||s.id||`${s.title}-${s.date}`}const B=m(()=>{var u;if(i.selfOnly&&g.value)return[g.value];const s=((u=L.value)==null?void 0:u.employees)||[];if(s.length)return s;const t=[],n=new Set;return V.value.forEach(x=>{const o=x.user;if(!o||!o.id)return;const d=String(o.id);n.has(d)||(n.add(d),t.push(o))}),t}),ne=m(()=>l.employeeId?B.value.filter(s=>String(s.id)===String(l.employeeId)):B.value),w=m(()=>ne.value.map(s=>{const t=V.value.filter(o=>{var d;return String(((d=o.user)==null?void 0:d.id)??o.user_id)===String(s.id)}),n={};for(const o of t){const d=A(o),f=n[d],I=new Date(o.date),G=f?new Date(f.date):null;(!f||G&&I>G)&&(n[d]=o)}const u=Object.values(n).sort((o,d)=>new Date(d.date).getTime()-new Date(o.date).getTime()),x={total:u.length,completed:u.filter(o=>o.status==="COMPLETED").length,working:u.filter(o=>o.status==="WORKING").length,pending:u.filter(o=>o.status==="PENDING").length};return{user:s,latestTodos:u,totals:x}}).sort((s,t)=>{var n,u;return(((n=s.user)==null?void 0:n.name)||"").localeCompare(((u=t.user)==null?void 0:u.name)||"")})),k=m(()=>w.value.reduce((s,t)=>({totalTodos:s.totalTodos+t.totals.total,completed:s.completed+t.totals.completed,working:s.working+t.totals.working,pending:s.pending+t.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));function $(){te.replace({query:{...D.query,month:r.value||void 0,...i.selfOnly?{}:{company_id:l.companyId||void 0,department_id:l.departmentId||void 0,employee_id:l.employeeId||void 0,line_type:l.lineType||void 0}}})}async function S(){F.value&&await _.fetchTodoDates({"company-id":O.value||void 0,"department-id":i.selfOnly?void 0:l.departmentId,"employee-id":i.selfOnly?c.value:l.employeeId,"line-type":i.selfOnly?void 0:l.lineType,"start-date":v.value,"end-date":b.value})}function M(){i.selfOnly&&c.value&&(l.employeeId=c.value)}function q(){const s=D.query||{};r.value=typeof s.month=="string"&&s.month?s.month:r.value||X(new Date),l.companyId=i.selfOnly?"":s.company_id||"",l.departmentId=i.selfOnly?"":s.department_id||"",l.employeeId=i.selfOnly?c.value:s.employee_id||"",l.lineType=i.selfOnly?"all":s.line_type||"all",M()}N(()=>[l.companyId,l.departmentId,l.employeeId,l.lineType,v.value,b.value,r.value],()=>{M(),$(),S()}),N(()=>D.query,()=>{q()}),N(c,()=>{M(),$(),S()}),ue(()=>{r.value=r.value||X(new Date),q(),S()});function le(){window.print()}return(s,t)=>(p(),y("div",we,[e("div",ke,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),e("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),e("span",Ie,[t[6]||(t[6]=e("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),e("span",null,a(U.value),1),h.value?(p(),y("span",Te,"("+a(h.value)+")",1)):T("",!0)]),e("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:me(le,["prevent"]),disabled:E(_).loading,title:"Print"},t[7]||(t[7]=[e("i",{class:"fas fa-print"},null,-1)]),8,De)]),e("div",Oe,[i.selfOnly?(p(),y("div",Se,[e("div",Me,[t[9]||(t[9]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),j(e("input",{id:"month",type:"month","onUpdate:modelValue":t[0]||(t[0]=n=>r.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[K,r.value]])]),e("div",Ne,[t[10]||(t[10]=e("i",{class:"fas fa-user-lock"},null,-1)),R(" Showing only my todos (Employee ID: "+a(c.value||"loading...")+") ",1)])])):(p(),W(xe,{key:1,ref_key:"employeeFilterRef",ref:L,company_id:l.companyId,"onUpdate:company_id":t[2]||(t[2]=n=>l.companyId=n),department_id:l.departmentId,"onUpdate:department_id":t[3]||(t[3]=n=>l.departmentId=n),employee_id:l.employeeId,"onUpdate:employee_id":t[4]||(t[4]=n=>l.employeeId=n),line_type:l.lineType,"onUpdate:line_type":t[5]||(t[5]=n=>l.lineType=n),onFilterChange:se},{default:C(()=>[e("div",Ee,[t[11]||(t[11]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),j(e("input",{id:"month",type:"month","onUpdate:modelValue":t[1]||(t[1]=n=>r.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[K,r.value]])])]),_:1},8,["company_id","department_id","employee_id","line_type"]))]),F.value?E(_).loading?(p(),W(fe,{key:1},{default:C(()=>t[13]||(t[13]=[R("Loading report...")])),_:1,__:[13]})):(p(),y("div",Ce,[e("div",Pe,[e("div",Le,[t[14]||(t[14]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",Ue,a(w.value.length),1)]),e("div",Fe,[t[15]||(t[15]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),e("div",Ve,a(k.value.totalTodos),1)]),e("div",Ae,[t[16]||(t[16]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),e("div",Be,a(k.value.completed),1)]),e("div",$e,[t[17]||(t[17]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),e("div",qe,a(k.value.working),1)]),e("div",Ge,[t[18]||(t[18]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),e("div",ze,a(k.value.pending),1)])]),w.value.length===0?(p(),y("div",We," No data available for the selected month. ")):T("",!0),(p(!0),y(Y,null,H(w.value,(n,u)=>{var x;return p(),y("div",{key:((x=n.user)==null?void 0:x.id)||u,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[e("div",je,[Q(ge,{user:n.user},{trigger:C(({user:o})=>{var d;return[e("div",Ke,[Q(ye,{user:o,size:"medium"},null,8,["user"]),e("div",null,[e("div",Ye,a((o==null?void 0:o.name)||"Unknown user"),1),e("div",He,a(((d=o==null?void 0:o.department)==null?void 0:d.name)||"-"),1),e("div",Qe,[R(" Month: "+a(U.value)+" ",1),h.value?(p(),y("span",Je,"("+a(h.value)+")",1)):T("",!0)])])])]}),_:2},1032,["user"]),e("div",Xe,[e("span",Ze," Total "+a(n.totals.total),1),e("span",et," Done "+a(n.totals.completed),1),e("span",tt," Working "+a(n.totals.working),1),e("span",st," Pending "+a(n.totals.pending),1)])]),e("div",ot,[e("table",nt,[t[20]||(t[20]=e("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[e("tr",{class:"border-b"},[e("th",{class:"px-4 py-3 border text-center w-12"},"sl"),e("th",{class:"px-4 py-3 border text-left"},"Todo"),e("th",{class:"px-4 py-3 border text-left"},"Last Activity Date"),e("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),e("tbody",null,[n.latestTodos.length===0?(p(),y("tr",lt,t[19]||(t[19]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-400"}," No activity recorded for this month. ",-1)]))):T("",!0),(p(!0),y(Y,null,H(n.latestTodos,(o,d)=>{var f,I;return p(),y("tr",{key:A(o),class:"border-b"},[e("td",at,a(d+1),1),e("td",rt,[e("div",dt,a(o.title),1),e("div",it,a(((I=(f=o.todo)==null?void 0:f.todoable)==null?void 0:I.title)||""),1)]),e("td",pt,a(E(P)(o.date)||o.date),1),e("td",ut,[e("span",{class:ce(["text-xs font-semibold px-2.5 py-1 rounded-full",oe(o.status)])},a(o.status||"N/A"),3)])])}),128))])])])])}),128))])):(p(),y("div",Re,t[12]||(t[12]=[e("i",{class:"fad fa-tasks text-4xl"},null,-1),e("div",{class:"empty-state glass-panel"},[e("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),e("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)])))]))}},Ot=he(mt,[["__scopeId","data-v-c2da9877"]]);export{Ot as default};
