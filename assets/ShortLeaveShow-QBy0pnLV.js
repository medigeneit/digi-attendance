import{i as Lt,u as Nt,r as y,p as Ft,b as Rt,c as r,a as t,k as a,j as Bt,t as o,h as g,e as i,y as Dt,l as ht,m as $t,d as Vt,v as It,F as Tt,f as Mt,o as n,g as Ut}from"./index-Bi70UsqH.js";import{L as Wt}from"./LoaderView-Bg1dVyCM.js";import{_ as Et}from"./ScreenshotCapture-Be9aznU6.js";import{_ as Ht}from"./ShareComponent-CrR44Ig4.js";import{u as Pt}from"./short-leave-B_ujbfJC.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const zt={class:"my-container max-w-3xl space-y-6"},Ot={key:1,class:"bg-white rounded space-y-2 p-4 md:p-8",id:"leave-application"},qt={class:"flex justify-end"},Gt={class:"font-medium"},Jt={class:"gap-y-1"},Kt={class:"gap-y-1"},Qt={class:""},Xt={class:"grid md:grid-cols-2"},Yt={class:"col-span-2 pt-2"},Zt={class:"grid md:grid-cols-2 gap-4 pt-10"},es={key:0,class:"print:hidden"},ts={class:"text-xs"},ss={class:"flex gap-2"},ls={class:"font-bold"},as={key:0,class:"text-green-600 print:text-black"},os={key:1,class:"pl-2 text-yellow-700"},ns={class:"text-center"},rs={class:"title-md"},is={key:0},us={class:"grid grid-cols-2 text-sm md:text-base md:grid-cols-2 md:gap-4"},ds={class:"pt-10"},vs={key:0},ps={key:1,class:"print:hidden"},ms={class:"text-xs text-blue-600"},cs={class:"flex gap-4"},_s={class:"font-semibold md:font-bold"},fs={key:0,class:"text-green-600"},bs={key:1,class:"pl-2 text-yellow-700"},ys={class:"pt-10"},gs={key:0},hs={key:1,class:"print:hidden"},xs={class:"text-xs text-blue-600"},ks={class:"flex gap-4"},ws={class:"font-semibold md:font-bold"},js={key:0,class:"text-green-600"},Ss={key:1,class:"pl-2 text-yellow-700"},As={class:"flex flex-col pt-10"},Cs={key:0},Ls={key:1},Ns={key:2,class:"print:hidden"},Fs={class:"text-xs text-blue-600"},Rs={class:"flex gap-4"},Bs={class:"font-semibold md:font-bold"},Ds={key:0,class:"text-green-600"},$s={key:1,class:"pl-2 text-yellow-700"},Vs={key:0,class:"mb-2"},Is=["href"],Ts={key:1,class:"text-sm text-gray-600 mt-1"},Ms={key:0,class:"modal-bg"},Us={class:"modal-card"},Ws={class:"flex justify-end gap-2 mt-4"},Js={__name:"ShortLeaveShow",setup(Es){const x=Lt(),xt=Ut(),m=Mt(),d=Pt(),c=Nt(),k=y(null),w=y(!0),_=y(!1),f=y(""),s=Ft(()=>d.shortLeave);Rt(async()=>{const{id:l}=m.params;try{await d.fetchShortLeaveById(l)}catch(e){console.error("Failed to fetch short leave details:",e)}finally{w.value=!1}});const kt=async()=>{try{await d.rejectShortLeave(m.params.id,f.value),alert("Short leave rejected successfully!"),_.value=!1,f.value="",await d.fetchShortLeaveById(m.params.id)}catch(l){console.error("Failed to reject short leave:",l),alert("Failed to reject short leave.")}},wt=async()=>{try{const l={attachment:k.value};await d.uploadShortLeaveAttachment(m.params.id,l)}catch(l){console.error("Failed to reject short leave:",l),alert("Failed to reject short leave.")}},h=()=>{_.value=!0},b=async l=>{try{const{id:e}=m.params;l==="handover"&&await d.handoverAccept(e),l==="inCharge"&&await d.inChargeAccept(e),l==="recommend"&&await d.recommendByAccept(e),l==="approve"&&await d.approvedByAccept(e),alert(`${l} accepted successfully!`),await d.fetchShortLeaveById(e)}catch(e){console.error(`Failed to accept ${l}:`,e),alert(`Failed to accept ${l}.`)}},jt=()=>xt.go(-1);function St(){window.print()}const At=async l=>{const e=l.target.files[0];if(e){const v=new FormData;v.append("file",e);const u=await d.fetchFileUpload(v);k.value=u==null?void 0:u.url,u!=null&&u.url?(wt(),x.success("File uploaded successfully!")):x.error("Failed to upload file!")}},Ct=l=>new Date(l).toISOString().slice(0,10),j=l=>{if(!l)return"N/A";const[e,v]=l.split(":").map(Number),u=new Date;return u.setHours(e,v),u.toLocaleString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})};return(l,e)=>{var v,u,S,A,C,L,N,F,R,B,D,$,V,I,T,M,U,W,E,H,P,z,O,q,G,J,K,Q,X,Y,Z,ee,te,se,le,ae,oe,ne,re,ie,ue,de,ve,pe,me,ce,_e,fe,be,ye,ge,he,xe,ke,we,je,Se,Ae,Ce,Le,Ne,Fe,Re,Be,De,$e,Ve,Ie,Te,Me,Ue,We,Ee,He,Pe,ze,Oe,qe,Ge,Je,Ke,Qe,Xe,Ye,Ze,et,tt,st,lt,at,ot,nt,rt,it,ut,dt,vt,pt,mt,ct,_t,ft,bt,yt,gt;return n(),r(Tt,null,[t("div",zt,[t("div",{class:"flex items-center justify-between gap-2 print:hidden"},[t("button",{class:"btn-3",onClick:jt},e[6]||(e[6]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[8]||(e[8]=t("h1",{class:"title-lg flex-wrap text-center"},"Short Leave Details",-1)),t("div",null,[t("button",{class:"btn-2",onClick:St},e[7]||(e[7]=[t("i",{class:"far fa-print"},null,-1),a(" Print ")]))])]),w.value?(n(),Bt(Wt,{key:0})):(n(),r("div",Ot,[e[42]||(e[42]=t("div",null,[t("h1",{class:"title-lg text-center"},"Short Leave Application")],-1)),t("div",qt,[t("div",null,"Date: "+o(Ct((v=s.value)==null?void 0:v.created_at)),1)]),t("div",null,[t("p",Gt,[e[9]||(e[9]=a(" Name: ")),t("b",null,o((S=(u=s.value)==null?void 0:u.user)==null?void 0:S.name),1)]),t("div",Jt,[t("p",null,[e[10]||(e[10]=a(" Designation: ")),t("b",null,o((L=(C=(A=s.value)==null?void 0:A.user)==null?void 0:C.designation)==null?void 0:L.title),1)])]),t("div",Kt,[t("p",null,[e[11]||(e[11]=a(" Department: ")),t("b",null,o((R=(F=(N=s.value)==null?void 0:N.user)==null?void 0:F.company)==null?void 0:R.name),1)])])]),t("div",Qt,[t("div",Xt,[t("div",null,[e[12]||(e[12]=t("b",null,"From:",-1)),a(" "+o((B=s.value)!=null&&B.start_time?j((D=s.value)==null?void 0:D.start_time):""),1)]),t("div",null,[e[13]||(e[13]=t("b",null,"To:",-1)),a(" "+o(($=s.value)!=null&&$.end_time?j((V=s.value)==null?void 0:V.end_time):""),1)]),t("div",null,[e[14]||(e[14]=t("b",null,"Short Leave Date:",-1)),a(" "+o((I=s.value)==null?void 0:I.date),1)]),t("div",null,[e[15]||(e[15]=t("b",null,"Total Minutes:",-1)),a(" "+o((T=s.value)==null?void 0:T.total_minutes),1)]),t("div",Yt,[e[16]||(e[16]=t("b",null,"Reason:",-1)),a(" "+o(((M=s.value)==null?void 0:M.reason)||"N/A"),1)])]),t("div",Zt,[e[23]||(e[23]=t("div",{class:""},null,-1)),t("div",null,[t("p",null,o(((W=(U=s.value)==null?void 0:U.handover_user)==null?void 0:W.name)||"Not assigned"),1),!((E=s.value)!=null&&E.status)&&((H=s.value)==null?void 0:H.handover_user_id)===((z=(P=g(c))==null?void 0:P.user)==null?void 0:z.id)?(n(),r("div",es,[t("p",ts,[a(o((q=(O=s.value)==null?void 0:O.user)==null?void 0:q.name)+" has assigned you for his handover. ",1),e[17]||(e[17]=t("br",null,null,-1)),e[18]||(e[18]=a(" Do you agree? "))]),t("div",ss,[t("button",{class:"font-bold text-lg text-green-600 px-2",onClick:e[0]||(e[0]=p=>b("handover"))}," ✔ "),e[19]||(e[19]=t("button",{class:"px-2"},"❌",-1))])])):i("",!0),e[22]||(e[22]=t("hr",{class:"w-44 border-black mt-1"},null,-1)),t("h4",ls,[e[21]||(e[21]=a(" Handover ")),(G=s.value)!=null&&G.handover_user_id&&((J=s.value)!=null&&J.status)?(n(),r("span",as," (✔) ")):i("",!0),(K=s.value)!=null&&K.handover_user_id&&!((Q=s.value)!=null&&Q.status)?(n(),r("span",os,e[20]||(e[20]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])])])]),e[43]||(e[43]=t("hr",null,null,-1)),t("div",ns,[t("h3",rs,[e[24]||(e[24]=a(" Approvals ")),t("span",{class:Dt({"text-yellow-500":((X=s.value)==null?void 0:X.status)==="Pending","text-green-500":((Y=s.value)==null?void 0:Y.status)==="Approved","text-red-500":((Z=s.value)==null?void 0:Z.status)==="Rejected"})}," ("+o(((ee=s.value)==null?void 0:ee.status)||"N/A")+") ",3)]),((te=s.value)==null?void 0:te.status)==="Rejected"?(n(),r("div",is,[t("div",null,[e[25]||(e[25]=t("b",null,"Rejected By:",-1)),a(" "+o(((le=(se=s.value)==null?void 0:se.rejected_by_user)==null?void 0:le.name)||"N/A"),1)]),t("div",null,[e[26]||(e[26]=t("b",null,"Rejection Reason:",-1)),a(" "+o(((ae=s.value)==null?void 0:ae.rejection_reason)||"N/A"),1)])])):i("",!0)]),t("div",us,[t("div",ds,[(oe=s.value)!=null&&oe.in_charge_user?(n(),r("p",vs,o(((re=(ne=s.value)==null?void 0:ne.in_charge_user)==null?void 0:re.name)||""),1)):i("",!0),t("p",null,o(((ve=(de=(ue=(ie=s.value)==null?void 0:ie.user)==null?void 0:ue.other_approval)==null?void 0:de.in_charge_user)==null?void 0:ve.name)||"N/A"),1),((pe=s.value)==null?void 0:pe.status)!=="Rejected"&&((me=s.value)==null?void 0:me.status)!=="Approved"&&!((ce=s.value)!=null&&ce.in_charge_user_id)&&((be=(fe=(_e=s.value)==null?void 0:_e.user)==null?void 0:fe.other_approval)==null?void 0:be.in_charge_user_id)===((ge=(ye=g(c))==null?void 0:ye.user)==null?void 0:ge.id)?(n(),r("div",ps,[t("p",ms,[a(o((xe=(he=s.value)==null?void 0:he.user)==null?void 0:xe.name)+" has submitted an application. ",1),e[27]||(e[27]=t("br",null,null,-1)),e[28]||(e[28]=a(" Will you forward it? "))]),t("div",cs,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[1]||(e[1]=p=>b("inCharge"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):i("",!0),e[31]||(e[31]=t("hr",{class:"w-28 md:w-44 border-black mt-2"},null,-1)),t("p",_s,[e[30]||(e[30]=a(" In-Charge ")),(ke=s.value)!=null&&ke.in_charge_user_id?(n(),r("span",fs,"(✔)")):i("",!0),!((we=s.value)!=null&&we.in_charge_user_id)&&((Ae=(Se=(je=s.value)==null?void 0:je.user)==null?void 0:Se.other_approval)!=null&&Ae.in_charge_user)?(n(),r("span",bs,e[29]||(e[29]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])]),t("div",ys,[(Ce=s.value)!=null&&Ce.recommend_by_user?(n(),r("p",gs,o(((Ne=(Le=s.value)==null?void 0:Le.recommend_by_user)==null?void 0:Ne.name)||""),1)):i("",!0),t("p",null,o(((De=(Be=(Re=(Fe=s.value)==null?void 0:Fe.user)==null?void 0:Re.other_approval)==null?void 0:Be.recommend_by_user)==null?void 0:De.name)||"N/A"),1),(($e=s.value)==null?void 0:$e.status)!=="Rejected"&&((Ve=s.value)==null?void 0:Ve.status)!=="Approved"&&!((Ie=s.value)!=null&&Ie.recommend_by_user_id)&&((Ue=(Me=(Te=s.value)==null?void 0:Te.user)==null?void 0:Me.other_approval)==null?void 0:Ue.recommend_by_user_id)===((Ee=(We=g(c))==null?void 0:We.user)==null?void 0:Ee.id)?(n(),r("div",hs,[t("p",xs,[a(o((Pe=(He=s.value)==null?void 0:He.user)==null?void 0:Pe.name)+" has submitted an application.",1),e[32]||(e[32]=t("br",null,null,-1)),e[33]||(e[33]=a(" Will you recommend it? "))]),t("div",ks,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[2]||(e[2]=p=>b("recommend"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):i("",!0),e[36]||(e[36]=t("hr",{class:"w-28 md:w-44 border-black mt-2"},null,-1)),t("p",ws,[e[35]||(e[35]=a(" Recommend By ")),(ze=s.value)!=null&&ze.recommend_by_user_id?(n(),r("span",js,"(✔)")):i("",!0),!((Oe=s.value)!=null&&Oe.recommend_by_user_id)&&((Je=(Ge=(qe=s.value)==null?void 0:qe.user)==null?void 0:Ge.other_approval)!=null&&Je.recommend_by_user)?(n(),r("span",Ss,e[34]||(e[34]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])])]),t("div",As,[(Ke=s.value)!=null&&Ke.approved_by_user?(n(),r("p",Cs,o(((Xe=(Qe=s.value)==null?void 0:Qe.approved_by_user)==null?void 0:Xe.name)||""),1)):(n(),r("p",Ls,o(((tt=(et=(Ze=(Ye=s.value)==null?void 0:Ye.user)==null?void 0:Ze.other_approval)==null?void 0:et.approved_by_user)==null?void 0:tt.name)||"N/A"),1)),((st=s.value)==null?void 0:st.status)!=="Rejected"&&((lt=s.value)==null?void 0:lt.status)!=="Approved"&&!((at=s.value)!=null&&at.approved_by_user_id)&&((rt=(nt=(ot=s.value)==null?void 0:ot.user)==null?void 0:nt.other_approval)==null?void 0:rt.approved_by_user_id)===((ut=(it=g(c))==null?void 0:it.user)==null?void 0:ut.id)?(n(),r("div",Ns,[t("p",Fs,[a(o((vt=(dt=s.value)==null?void 0:dt.user)==null?void 0:vt.name)+" has submitted an application.",1),e[37]||(e[37]=t("br",null,null,-1)),e[38]||(e[38]=a(" Will you accept it? "))]),t("div",Rs,[t("button",{class:"font-bold text-lg text-green-600",onClick:e[3]||(e[3]=p=>b("approve"))}," ✔ "),t("button",{class:"",onClick:h},"❌")])])):i("",!0),e[41]||(e[41]=t("hr",{class:"w-44 border-black mt-2"},null,-1)),t("p",Bs,[e[40]||(e[40]=a(" Approved By ")),(pt=s.value)!=null&&pt.approved_by_user_id?(n(),r("span",Ds,"(✔)")):i("",!0),!((mt=s.value)!=null&&mt.approved_by_user_id)&&((ft=(_t=(ct=s.value)==null?void 0:ct.user)==null?void 0:_t.other_approval)!=null&&ft.approved_by_user)?(n(),r("span",$s,e[39]||(e[39]=[t("i",{class:"fad fa-spinner"},null,-1)]))):i("",!0)])])])),t("div",null,[t("div",null,[e[44]||(e[44]=t("label",null,"Attachment",-1)),(bt=s.value)!=null&&bt.attachment&&typeof((yt=s.value)==null?void 0:yt.attachment)=="string"?(n(),r("div",Vs,[t("a",{href:(gt=s.value)==null?void 0:gt.attachment,target:"_blank",class:"text-blue-500 underline"}," View Current File ",8,Is)])):i("",!0),t("input",{type:"file",onChange:At,class:"w-full p-2 border rounded"},null,32),l.fileName?(n(),r("p",Ts,"Selected File: "+o(l.fileName),1)):i("",!0)])]),ht(Ht,null,{default:$t(()=>[ht(Et,{targetId:"leave-application",platform:"whatsapp"})]),_:1})]),_.value?(n(),r("div",Ms,[t("div",Us,[e[45]||(e[45]=t("h3",{class:"title-lg"},"Reject Short Leave",-1)),Vt(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=p=>f.value=p),rows:"4",placeholder:"Enter rejection reason...",class:"w-full border rounded-lg p-2 text-gray-700"},null,512),[[It,f.value]]),t("div",Ws,[t("button",{class:"btn-3",onClick:e[5]||(e[5]=p=>_.value=!1)},"Cancel"),t("button",{class:"btn-2 bg-red-500 text-white",onClick:kt},"Confirm")])])])):i("",!0)],64)}}};export{Js as default};
