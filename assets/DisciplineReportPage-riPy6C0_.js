import{_ as tt,c as d,o as i,a as t,N as ht,k as $,b as H,t as g,F as k,e as M,r as w,s as j,E as _t,x as V,q as G,l as A,v as X,G as Z,i as dt,Q as gt,d as L,g as Dt,p as Tt,m as nt,f as Ft,u as jt,D as Ot,j as mt,n as lt}from"./index-DstRERbg.js";import{L as Et}from"./LoaderView-DIU7nrDk.js";import{_ as Rt}from"./PaginationBar-B1B4U8mt.js";import{_ as Pt}from"./SearchInput-C-gpmo9g.js";import{_ as qt}from"./EmployeeFilter-DQC8JjwN.js";import{u as ut}from"./useDisciplineReportStore-CCjyrsoK.js";import{_ as Bt}from"./LetterEditor-CtTS0p0n.js";import"./company-BMNhDVkI.js";import"./department-CRQ8Yj5v.js";import"./EmployeeDropdownInput-9mgCkQCv.js";import"./SelectDropdown-pk1_IRpu.js";import"./UserChip-B3-yhhfM.js";import"./user-JKr17yah.js";import"./TextEditor-BrU86ScP.js";const zt={class:"month-cell"},Yt={class:"month-cell__header"},Wt={class:"month-cell__body"},Gt={__name:"MonthCell",props:{showAdd:{type:Boolean,default:!0},addLabel:{type:String,default:"Add"}},emits:["add"],setup(y){return(m,n)=>(i(),d("div",zt,[t("div",Yt,[ht(m.$slots,"header",{},void 0,!0),y.showAdd?(i(),d("button",{key:0,type:"button",class:"month-cell__add",onClick:n[0]||(n[0]=p=>m.$emit("add"))},[n[1]||(n[1]=t("i",{class:"far fa-plus"},null,-1)),H(" "+g(y.addLabel),1)])):$("",!0)]),t("div",Wt,[ht(m.$slots,"default",{},void 0,!0)])]))}},xt=tt(Gt,[["__scopeId","data-v-25e831ed"]]),Ht={class:"space-y-1"},Qt={class:"truncate"},Jt={class:"truncate"},Kt={class:"list-actions"},Xt=["onClick"],Zt=["onClick"],te={key:0,class:"empty"},ee={__name:"IndisciplineList",props:{autoItems:{type:Array,default:()=>[]},manualItems:{type:Array,default:()=>[]}},emits:["edit","delete"],setup(y){const m=n=>(n==null?void 0:n.title)||(n==null?void 0:n.reason)||(n==null?void 0:n.note)||(n==null?void 0:n.label)||(n==null?void 0:n.text)||(n==null?void 0:n.description)||"Untitled";return(n,p)=>(i(),d("div",Ht,[(i(!0),d(k,null,M(y.autoItems,f=>(i(),d("div",{key:`auto-${(f==null?void 0:f.id)||(f==null?void 0:f.key)||m(f)}`,class:"list-item list-item--locked"},[p[0]||(p[0]=t("i",{class:"far fa-lock text-[11px]"},null,-1)),t("span",Qt,g(m(f)),1)]))),128)),(i(!0),d(k,null,M(y.manualItems,f=>(i(),d("div",{key:`manual-${(f==null?void 0:f.id)||m(f)}`,class:"list-item"},[t("span",Jt,g(m(f)),1),t("div",Kt,[t("button",{type:"button",class:"list-action list-action--edit",onClick:x=>n.$emit("edit",f)},p[1]||(p[1]=[t("i",{class:"far fa-pen"},null,-1)]),8,Xt),t("button",{type:"button",class:"list-action list-action--delete",onClick:x=>n.$emit("delete",f)},p[2]||(p[2]=[t("i",{class:"far fa-trash"},null,-1)]),8,Zt)])]))),128)),y.autoItems.length===0&&y.manualItems.length===0?(i(),d("p",te," No items ")):$("",!0)]))}},se=tt(ee,[["__scopeId","data-v-84ff40e5"]]),le={class:"space-y-1"},ne={class:"flex items-center gap-2"},ae={class:"truncate"},oe={key:0,class:"badge"},re={class:"truncate"},ie={class:"list-actions"},de=["onClick"],ue=["onClick"],ce={key:0,class:"empty"},pe={__name:"ActionList",props:{autoItems:{type:Array,default:()=>[]},manualItems:{type:Array,default:()=>[]}},emits:["edit","delete"],setup(y){const m=p=>(p==null?void 0:p.title)||(p==null?void 0:p.reason)||(p==null?void 0:p.note)||(p==null?void 0:p.label)||(p==null?void 0:p.text)||(p==null?void 0:p.description)||"Untitled",n=p=>(p==null?void 0:p.hours)||(p==null?void 0:p.pay_hours)||(p==null?void 0:p.paycut_hours)||(p==null?void 0:p.pay_hours_text);return(p,f)=>(i(),d("div",le,[(i(!0),d(k,null,M(y.autoItems,x=>(i(),d("div",{key:`auto-${(x==null?void 0:x.id)||m(x)}`,class:"list-item list-item--locked"},[t("div",ne,[f[0]||(f[0]=t("i",{class:"far fa-lock text-[11px]"},null,-1)),t("span",ae,g((x==null?void 0:x.label)||"Paycut applied"),1)]),n(x)?(i(),d("span",oe,g(n(x))+"h",1)):$("",!0)]))),128)),(i(!0),d(k,null,M(y.manualItems,x=>(i(),d("div",{key:`manual-${(x==null?void 0:x.id)||m(x)}`,class:"list-item"},[t("span",re,g(m(x)),1),t("div",ie,[t("button",{type:"button",class:"list-action list-action--edit",onClick:c=>p.$emit("edit",x)},f[1]||(f[1]=[t("i",{class:"far fa-pen"},null,-1)]),8,de),t("button",{type:"button",class:"list-action list-action--delete",onClick:c=>p.$emit("delete",x)},f[2]||(f[2]=[t("i",{class:"far fa-trash"},null,-1)]),8,ue)])]))),128)),y.autoItems.length===0&&y.manualItems.length===0?(i(),d("p",ce," No items ")):$("",!0)]))}},ve=tt(pe,[["__scopeId","data-v-88bb90ee"]]),fe={class:"flex items-center justify-between gap-2 rounded-md border border-slate-100 bg-white/80 px-2 py-1 text-[11px] text-slate-700"},xe={class:"font-semibold text-slate-600"},ye={__name:"AttachmentCell",props:{count:{type:Number,default:0}},emits:["view"],setup(y){return(m,n)=>(i(),d("div",fe,[t("span",xe,g(y.count),1),t("button",{type:"button",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-600 hover:border-slate-300 hover:text-slate-800",onClick:n[0]||(n[0]=p=>m.$emit("view"))},n[1]||(n[1]=[t("i",{class:"far fa-eye"},null,-1),H(" View ")]))]))}},be={class:"flex items-center justify-center gap-1"},he=["onClick"],_e={__name:"FinalOutcomeCell",props:{userId:{type:[Number,String],required:!0},year:{type:Number,required:!0},value:{type:[Number,String],default:0},disabled:{type:Boolean,default:!1}},setup(y){const m=y,n=ut(),p=w(!1),f=async x=>{if(!(m.disabled||p.value)){p.value=!0;try{await n.updateFinalScore({user_id:m.userId,year:m.year,score:x})}catch(c){console.error("Failed to update final outcome:",c)}finally{p.value=!1}}};return(x,c)=>(i(),d("div",be,[(i(),d(k,null,M(5,v=>t("button",{key:v,type:"button",class:j(["score-dot",{"score-dot--active":Number(y.value)===v,"score-dot--disabled":y.disabled}]),onClick:I=>f(v)},g(v),11,he)),64))]))}},ge=tt(_e,[["__scopeId","data-v-b8d56759"]]),me={key:0,class:"fixed inset-0 z-[1200] flex items-center justify-center bg-slate-900/40"},we={class:"w-full max-w-4xl rounded-2xl border border-slate-100 bg-white shadow-xl"},$e={class:"flex items-center justify-between border-b border-slate-100 px-5 py-3"},ke={class:"text-lg font-semibold text-slate-800"},Ce={class:"text-xs text-slate-500"},Me={class:"flex items-center gap-2 border-b border-slate-100 px-5 py-3"},Se={class:"max-h-[70vh] overflow-auto px-5 py-4"},Ae={key:0,class:"grid gap-4 md:grid-cols-[1.1fr_1fr]"},Ie={class:"space-y-3"},Ne={class:"space-y-2"},Ue={class:"flex items-center gap-2"},Le=["disabled"],Ve={class:"space-y-2"},De={class:"space-y-2"},Te={class:"flex items-start justify-between gap-2"},Fe={class:"text-xs font-semibold text-slate-700"},je={key:0,class:"text-[11px] text-slate-500"},Oe={class:"flex items-center gap-1"},Ee=["onClick"],Re=["onClick"],Pe={key:0,class:"text-xs text-slate-400"},qe={key:1,class:"grid gap-4 md:grid-cols-[1.1fr_1fr]"},Be={class:"space-y-3"},ze={class:"space-y-2"},Ye={class:"flex items-center gap-2"},We=["disabled"],Ge={class:"space-y-2"},He={class:"space-y-2"},Qe={class:"flex items-start justify-between gap-2"},Je={class:"text-xs font-semibold text-slate-700"},Ke={key:0,class:"text-[11px] text-slate-500"},Xe={class:"flex items-center gap-1"},Ze=["onClick"],ts=["onClick"],es={key:0,class:"text-xs text-slate-400"},ss={key:2,class:"space-y-4"},ls={class:"flex flex-wrap items-center gap-4"},ns={class:"flex items-center gap-2 text-xs font-semibold text-slate-600"},as={class:"flex items-center gap-2 text-xs font-semibold text-slate-600"},os={key:0,class:"grid gap-3 md:grid-cols-[1fr_auto]"},rs={class:"space-y-2"},is=["disabled"],ds={key:1,class:"space-y-3"},us={class:"flex justify-end"},cs=["disabled"],ps={class:"space-y-2"},vs={class:"space-y-2"},fs={class:"text-xs font-semibold text-slate-700"},xs={class:"text-[11px] text-slate-500"},ys={key:0,class:"text-xs text-slate-400"},bs={__name:"MonthModal",props:{open:{type:Boolean,default:!1},user:{type:Object,default:null},year:{type:Number,default:new Date().getFullYear()},monthStart:{type:String,default:""},record:{type:Object,default:null},initialTab:{type:String,default:"indiscipline"},editItem:{type:Object,default:null},editType:{type:String,default:""}},emits:["close"],setup(y,{emit:m}){const n=y,p=m,f=ut(),x=w(n.initialTab||"indiscipline"),c=w(!1),v=_t({id:null,title:"",note:"",type:"others"}),I=w("file"),S=w(""),E=w(null),N=w("other"),o=_t({title:"",body_html:"",doc_type:"other"}),h=V(()=>{var u,s;return((u=n.user)==null?void 0:u.id)||((s=n.user)==null?void 0:s.user_id)}),D=V(()=>{var u,s;return((u=n.record)==null?void 0:u.id)||((s=n.record)==null?void 0:s.month_record_id)}),T=V(()=>{var u,s,C;return((u=n.record)==null?void 0:u.manual_indisciplines)||((s=n.record)==null?void 0:s.indisciplines)||((C=n.record)==null?void 0:C.manualIndisciplines)||[]}),F=V(()=>{var u,s,C;return((u=n.record)==null?void 0:u.manual_actions)||((s=n.record)==null?void 0:s.actions)||((C=n.record)==null?void 0:C.manualActions)||[]}),R=V(()=>{var C,z,a,Y,et,Q;const u=((C=n.record)==null?void 0:C.attachments)||((z=n.record)==null?void 0:z.attachment_files)||((a=n.record)==null?void 0:a.files)||[],s=((Y=n.record)==null?void 0:Y.letters)||((et=n.record)==null?void 0:et.text_letters)||((Q=n.record)==null?void 0:Q.letter_attachments)||[];return[...u.map(J=>({...J,_type:"file"})),...s.map(J=>({...J,_type:"letter"}))]}),U=u=>(u==null?void 0:u.title)||(u==null?void 0:u.reason)||(u==null?void 0:u.note)||(u==null?void 0:u.label)||(u==null?void 0:u.text)||(u==null?void 0:u.description)||"Untitled",_=()=>{v.id=null,v.title="",v.note="",v.type="others"},P=(u,s)=>{x.value=u,v.id=(s==null?void 0:s.id)||null,v.title=(s==null?void 0:s.title)||(s==null?void 0:s.reason)||(s==null?void 0:s.label)||"",v.note=(s==null?void 0:s.note)||(s==null?void 0:s.description)||"",v.type=(s==null?void 0:s.type)||"others"};G(()=>n.open,async u=>{u&&(x.value=n.initialTab||"indiscipline",_(),I.value="file",S.value="",E.value=null,N.value="other",o.title="",o.body_html="",o.doc_type="other",h.value&&n.monthStart&&await f.ensureMonthRecord(h.value,n.year,n.monthStart),n.editItem&&P(n.editType||x.value,n.editItem))}),G(()=>n.initialTab,u=>{n.open&&u&&(x.value=u)}),G(()=>n.editItem,u=>{n.open&&u&&P(n.editType||x.value,u)}),G(x,()=>{v.id||_()});const at=async()=>{if(!v.title&&!v.note||!h.value||!n.monthStart)return;c.value=!0;const u={user_id:h.value,year:n.year,month_start:n.monthStart,type:v.type,title:v.title,note:v.note};D.value&&(u.month_record_id=D.value);try{x.value==="indiscipline"?v.id?await f.updateManualIndiscipline(v.id,{title:v.title,note:v.note,type:v.type},{user_id:h.value,month_start:n.monthStart}):await f.createManualIndiscipline(u):v.id?await f.updateManualAction(v.id,{title:v.title,note:v.note,type:v.type},{user_id:h.value,month_start:n.monthStart}):await f.createManualAction(u),_()}catch(s){console.error("Failed to save manual item:",s)}finally{c.value=!1}},ot=async(u,s)=>{s!=null&&s.id&&confirm("Delete this item?")&&(u==="indiscipline"?await f.deleteManualIndiscipline(s.id,{month_start:n.monthStart}):await f.deleteManualAction(s.id,{month_start:n.monthStart}))},q=u=>{var C;const s=(C=u.target.files)==null?void 0:C[0];E.value=s||null},rt=async()=>{if(!(!E.value||!h.value||!n.monthStart)){c.value=!0;try{await f.uploadAttachment({file:E.value,title:S.value,doc_type:N.value,mode:"file",user_id:h.value,month_start:n.monthStart,year:n.year}),E.value=null,S.value="",N.value="other"}catch(u){console.error("Failed to upload attachment:",u)}finally{c.value=!1}}},ct=async()=>{if(!(!o.title||!o.body_html)&&!(!h.value||!n.monthStart)){c.value=!0;try{await f.createLetter({title:o.title,body_html:o.body_html,doc_type:o.doc_type,mode:"text",user_id:h.value,month_start:n.monthStart,year:n.year}),o.title="",o.body_html="",o.doc_type="other"}catch(u){console.error("Failed to save letter:",u)}finally{c.value=!1}}};return(u,s)=>{var C,z;return y.open?(i(),d("div",me,[t("div",we,[t("div",$e,[t("div",null,[s[17]||(s[17]=t("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Month Record",-1)),t("h3",ke,g(((C=y.user)==null?void 0:C.name)||((z=y.user)==null?void 0:z.user)||"Employee"),1),t("p",Ce,g(y.monthStart),1)]),t("button",{type:"button",class:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50",onClick:s[0]||(s[0]=a=>p("close"))},s[18]||(s[18]=[t("i",{class:"far fa-times"},null,-1)]))]),t("div",Me,[t("button",{type:"button",class:j(["tab-btn",{"tab-btn--active":x.value==="indiscipline"}]),onClick:s[1]||(s[1]=a=>x.value="indiscipline")}," Indiscipline ",2),t("button",{type:"button",class:j(["tab-btn",{"tab-btn--active":x.value==="action"}]),onClick:s[2]||(s[2]=a=>x.value="action")}," Action ",2),t("button",{type:"button",class:j(["tab-btn",{"tab-btn--active":x.value==="attachment"}]),onClick:s[3]||(s[3]=a=>x.value="attachment")}," Attachment / Letter ",2)]),t("div",Se,[x.value==="indiscipline"?(i(),d("div",Ae,[t("div",Ie,[s[21]||(s[21]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Manual Indiscipline",-1)),t("div",Ne,[A(t("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>v.title=a),type:"text",placeholder:"Title",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[X,v.title]]),t("div",null,[s[20]||(s[20]=t("label",{class:"text-[11px] font-semibold text-slate-500"},"Type",-1)),A(t("select",{"onUpdate:modelValue":s[5]||(s[5]=a=>v.type=a),class:"mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},s[19]||(s[19]=[dt('<option value="absent" data-v-07e2e676>Absent</option><option value="late" data-v-07e2e676>Late</option><option value="misconduct" data-v-07e2e676>Misconduct</option><option value="negligence" data-v-07e2e676>Negligence</option><option value="others" data-v-07e2e676>Others</option>',5)]),512),[[Z,v.type]])]),A(t("textarea",{"onUpdate:modelValue":s[6]||(s[6]=a=>v.note=a),rows:"3",placeholder:"Notes",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[X,v.note]]),t("div",Ue,[t("button",{type:"button",class:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white",disabled:c.value,onClick:at},g(v.id?"Update":"Save"),9,Le),v.id?(i(),d("button",{key:0,type:"button",class:"rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-600",onClick:_}," Cancel ")):$("",!0)])])]),t("div",Ve,[s[24]||(s[24]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Existing Manual Items",-1)),t("div",De,[(i(!0),d(k,null,M(T.value,a=>(i(),d("div",{key:(a==null?void 0:a.id)||U(a),class:"rounded-lg border border-slate-100 bg-slate-50/70 p-2"},[t("div",Te,[t("div",null,[t("p",Fe,g(U(a)),1),a!=null&&a.note||a!=null&&a.description?(i(),d("p",je,g((a==null?void 0:a.note)||(a==null?void 0:a.description)),1)):$("",!0)]),t("div",Oe,[t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-full text-slate-500 hover:bg-white",onClick:Y=>P("indiscipline",a)},s[22]||(s[22]=[t("i",{class:"far fa-pen text-[11px]"},null,-1)]),8,Ee),t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-full text-rose-500 hover:bg-white",onClick:Y=>ot("indiscipline",a)},s[23]||(s[23]=[t("i",{class:"far fa-trash text-[11px]"},null,-1)]),8,Re)])])]))),128)),T.value.length===0?(i(),d("p",Pe," No manual indiscipline items yet. ")):$("",!0)])])])):x.value==="action"?(i(),d("div",qe,[t("div",Be,[s[27]||(s[27]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Manual Action",-1)),t("div",ze,[A(t("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>v.title=a),type:"text",placeholder:"Title",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[X,v.title]]),t("div",null,[s[26]||(s[26]=t("label",{class:"text-[11px] font-semibold text-slate-500"},"Type",-1)),A(t("select",{"onUpdate:modelValue":s[8]||(s[8]=a=>v.type=a),class:"mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},s[25]||(s[25]=[dt('<option value="warning" data-v-07e2e676>Warning</option><option value="showcause" data-v-07e2e676>Show Cause</option><option value="notice" data-v-07e2e676>Notice</option><option value="training" data-v-07e2e676>Training</option><option value="counselling" data-v-07e2e676>Counselling</option><option value="suspension" data-v-07e2e676>Suspension</option><option value="others" data-v-07e2e676>Others</option>',7)]),512),[[Z,v.type]])]),A(t("textarea",{"onUpdate:modelValue":s[9]||(s[9]=a=>v.note=a),rows:"3",placeholder:"Notes",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[X,v.note]]),t("div",Ye,[t("button",{type:"button",class:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white",disabled:c.value,onClick:at},g(v.id?"Update":"Save"),9,We),v.id?(i(),d("button",{key:0,type:"button",class:"rounded-full border border-slate-200 px-4 py-2 text-xs font-semibold text-slate-600",onClick:_}," Cancel ")):$("",!0)])])]),t("div",Ge,[s[30]||(s[30]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Existing Manual Actions",-1)),t("div",He,[(i(!0),d(k,null,M(F.value,a=>(i(),d("div",{key:(a==null?void 0:a.id)||U(a),class:"rounded-lg border border-slate-100 bg-slate-50/70 p-2"},[t("div",Qe,[t("div",null,[t("p",Je,g(U(a)),1),a!=null&&a.note||a!=null&&a.description?(i(),d("p",Ke,g((a==null?void 0:a.note)||(a==null?void 0:a.description)),1)):$("",!0)]),t("div",Xe,[t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-full text-slate-500 hover:bg-white",onClick:Y=>P("action",a)},s[28]||(s[28]=[t("i",{class:"far fa-pen text-[11px]"},null,-1)]),8,Ze),t("button",{type:"button",class:"inline-flex h-7 w-7 items-center justify-center rounded-full text-rose-500 hover:bg-white",onClick:Y=>ot("action",a)},s[29]||(s[29]=[t("i",{class:"far fa-trash text-[11px]"},null,-1)]),8,ts)])])]))),128)),F.value.length===0?(i(),d("p",es," No manual actions yet. ")):$("",!0)])])])):(i(),d("div",ss,[t("div",ls,[t("label",ns,[A(t("input",{type:"radio",class:"text-slate-700",value:"file","onUpdate:modelValue":s[10]||(s[10]=a=>I.value=a)},null,512),[[gt,I.value]]),s[31]||(s[31]=H(" File Upload "))]),t("label",as,[A(t("input",{type:"radio",class:"text-slate-700",value:"letter","onUpdate:modelValue":s[11]||(s[11]=a=>I.value=a)},null,512),[[gt,I.value]]),s[32]||(s[32]=H(" Write Letter "))])]),I.value==="file"?(i(),d("div",os,[t("div",rs,[A(t("input",{"onUpdate:modelValue":s[12]||(s[12]=a=>S.value=a),type:"text",placeholder:"Attachment title (optional)",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[X,S.value]]),t("div",null,[s[34]||(s[34]=t("label",{class:"text-[11px] font-semibold text-slate-500"},"Doc Type",-1)),A(t("select",{"onUpdate:modelValue":s[13]||(s[13]=a=>N.value=a),class:"mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},s[33]||(s[33]=[dt('<option value="warning_letter" data-v-07e2e676>Warning Letter</option><option value="showcause" data-v-07e2e676>Show Cause</option><option value="notice" data-v-07e2e676>Notice</option><option value="proof" data-v-07e2e676>Proof</option><option value="other" data-v-07e2e676>Other</option>',5)]),512),[[Z,N.value]])]),t("input",{type:"file",class:"w-full rounded-lg border border-dashed border-slate-300 px-3 py-2 text-sm",onChange:q},null,32)]),t("button",{type:"button",class:"h-10 rounded-full bg-slate-900 px-4 text-xs font-semibold text-white",disabled:c.value||!E.value||!N.value,onClick:rt}," Upload ",8,is)])):(i(),d("div",ds,[A(t("input",{"onUpdate:modelValue":s[14]||(s[14]=a=>o.title=a),type:"text",placeholder:"Letter title",class:"w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},null,512),[[X,o.title]]),t("div",null,[s[36]||(s[36]=t("label",{class:"text-[11px] font-semibold text-slate-500"},"Doc Type",-1)),A(t("select",{"onUpdate:modelValue":s[15]||(s[15]=a=>o.doc_type=a),class:"mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},s[35]||(s[35]=[dt('<option value="warning_letter" data-v-07e2e676>Warning Letter</option><option value="showcause" data-v-07e2e676>Show Cause</option><option value="notice" data-v-07e2e676>Notice</option><option value="proof" data-v-07e2e676>Proof</option><option value="other" data-v-07e2e676>Other</option>',5)]),512),[[Z,o.doc_type]])]),L(Bt,{modelValue:o.body_html,"onUpdate:modelValue":s[16]||(s[16]=a=>o.body_html=a)},null,8,["modelValue"]),t("div",us,[t("button",{type:"button",class:"rounded-full bg-slate-900 px-4 py-2 text-xs font-semibold text-white",disabled:c.value||!o.title||!o.body_html||!o.doc_type,onClick:ct}," Save Letter ",8,cs)])])),t("div",ps,[s[37]||(s[37]=t("h4",{class:"text-sm font-semibold text-slate-700"},"Existing Attachments",-1)),t("div",vs,[(i(!0),d(k,null,M(R.value,a=>(i(),d("div",{key:(a==null?void 0:a.id)||U(a),class:"rounded-lg border border-slate-100 bg-slate-50/70 p-2"},[t("p",fs,g(U(a)),1),t("p",xs,g(a._type==="letter"?"Letter":"File"),1)]))),128)),R.value.length===0?(i(),d("p",ys," No attachments added yet. ")):$("",!0)])])]))])])])):$("",!0)}}},hs=tt(bs,[["__scopeId","data-v-07e2e676"]]),_s={key:0,class:"fixed inset-0 z-[1200] flex items-center justify-center bg-slate-900/40"},gs={class:"w-full max-w-3xl rounded-2xl border border-slate-100 bg-white shadow-xl"},ms={class:"flex items-center justify-between border-b border-slate-100 px-5 py-3"},ws={class:"text-lg font-semibold text-slate-800"},$s={class:"text-xs text-slate-500"},ks={class:"max-h-[60vh] space-y-3 overflow-auto px-5 py-4"},Cs={class:"flex items-start justify-between gap-3"},Ms={class:"text-sm font-semibold text-slate-800"},Ss={class:"text-[11px] uppercase tracking-wide text-slate-400"},As={class:"flex items-center gap-2"},Is=["href"],Ns=["onClick"],Us={key:0,class:"mt-2 text-xs text-slate-600"},Ls={key:0,class:"text-sm text-slate-500"},Vs={class:"flex items-center justify-end border-t border-slate-100 px-5 py-3"},Ds={__name:"AttachmentModal",props:{open:{type:Boolean,default:!1},attachments:{type:Array,default:()=>[]},user:{type:Object,default:null},monthStart:{type:String,default:""},year:{type:Number,default:new Date().getFullYear()}},emits:["close"],setup(y,{emit:m}){const n=y,p=m,f=Dt(),x=ut(),c=V(()=>{var D,T;const o=String(((D=f.user)==null?void 0:D.role)||"").toLowerCase(),h=(((T=f.user)==null?void 0:T.roles)||[]).map(F=>String(F).toLowerCase());return["admin","super_admin","developer","hr"].includes(o)||h.includes("hr")}),v=o=>(o==null?void 0:o.title)||(o==null?void 0:o.name)||(o==null?void 0:o.file_name)||(o==null?void 0:o.original_name)||(o==null?void 0:o.filename)||"Attachment",I=o=>(o==null?void 0:o.url)||(o==null?void 0:o.file_url)||(o==null?void 0:o.download_url)||(o==null?void 0:o.path)||"",S=o=>{const h=String((o==null?void 0:o.type)||(o==null?void 0:o.attachment_type)||"").toLowerCase();return h==="letter"||h==="text"},E=o=>String(o||"").replace(/<[^>]*>/g,"").trim(),N=async o=>{c.value&&confirm("Delete this attachment?")&&await x.deleteAttachment(o.id,{month_start:n.monthStart})};return(o,h)=>{var T,F,R,U;const D=Tt("router-link");return y.open?(i(),d("div",_s,[t("div",gs,[t("div",ms,[t("div",null,[h[1]||(h[1]=t("p",{class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},"Attachments",-1)),t("h3",ws,g(((T=y.user)==null?void 0:T.name)||((F=y.user)==null?void 0:F.user)||"Employee"),1),t("p",$s,g(y.monthStart),1)]),t("button",{type:"button",class:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50",onClick:h[0]||(h[0]=_=>p("close"))},h[2]||(h[2]=[t("i",{class:"far fa-times"},null,-1)]))]),t("div",ks,[(i(!0),d(k,null,M(y.attachments,_=>(i(),d("div",{key:(_==null?void 0:_.id)||v(_),class:"rounded-xl border border-slate-100 bg-slate-50/60 p-3"},[t("div",Cs,[t("div",null,[t("p",Ms,g(v(_)),1),t("p",Ss,g(S(_)?"Letter":"File"),1)]),t("div",As,[!S(_)&&I(_)?(i(),d("a",{key:0,href:I(_),target:"_blank",class:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2 py-0.5 text-[10px] font-semibold text-slate-600 hover:text-slate-800"},h[3]||(h[3]=[t("i",{class:"far fa-arrow-up-right-from-square"},null,-1),H(" Open ")]),8,Is)):$("",!0),c.value?(i(),d("button",{key:1,type:"button",class:"inline-flex items-center gap-1 rounded-full border border-rose-200 bg-rose-50 px-2 py-0.5 text-[10px] font-semibold text-rose-600 hover:text-rose-700",onClick:P=>N(_)},h[4]||(h[4]=[t("i",{class:"far fa-trash"},null,-1),H(" Delete ")]),8,Ns)):$("",!0)])]),S(_)?(i(),d("p",Us,g(E((_==null?void 0:_.body_html)||(_==null?void 0:_.body)||(_==null?void 0:_.content)).slice(0,180)),1)):$("",!0)]))),128)),y.attachments.length===0?(i(),d("p",Ls," No attachments yet. ")):$("",!0)]),t("div",Vs,[L(D,{to:{name:"DisciplineAttachments",query:{user_id:((R=y.user)==null?void 0:R.id)||((U=y.user)==null?void 0:U.user_id),month_start:y.monthStart,year:y.year}},class:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-600 hover:text-slate-800"},{default:nt(()=>h[5]||(h[5]=[H(" Open Full Page "),t("i",{class:"far fa-arrow-up-right-from-square text-[10px]"},null,-1)])),_:1,__:[5]},8,["to"])])])])):$("",!0)}}},Ts={class:"px-4 space-y-5"},Fs={class:"glass-panel flex flex-col gap-3 px-5 py-4 md:flex-row md:items-center md:justify-between"},js={class:"text-xs font-semibold text-slate-500"},Os={class:"glass-panel space-y-3 px-5 py-4"},Es={class:"flex items-center gap-2"},Rs=["value"],Ps={class:"flex flex-wrap items-center gap-3"},qs={class:"min-w-[220px]"},Bs={class:"flex items-center gap-2"},zs={class:"flex flex-wrap items-center gap-2"},Ys={class:"flex flex-wrap items-center gap-2"},Ws=["onClick"],Gs={key:1,class:"table-shell"},Hs={key:0,class:"empty-state"},Qs={key:1,class:"table-scroll"},Js={class:"min-w-full table-fixed border-collapse"},Ks={class:"sticky top-0 z-30 bg-slate-50"},Xs={class:"td sticky-col"},Zs={class:"space-y-1"},tl={class:"text-sm font-semibold text-slate-800"},el={class:"text-[11px] text-slate-500"},sl={class:"td min-w-[140px] text-center"},ll={__name:"DisciplineReportPage",setup(y){const m=ut(),n=Ft(),p=jt(),f=n.query,x=new Date().getFullYear(),c=w({company_id:f.company_id||"",department_id:f.department_id==="all"?"":f.department_id||"",line_type:f.line_type||"all",employee_id:f.employee_id||"",year:Number(f.year)||x,search:f.search||"",page:Number(f.page)||1,per_page:Number(f.per_page)||25}),{users:v,months:I,pagination:S,loading:E}=Ot(m),N=w(!1),o=w(!1),h=w(null),D=w(""),T=w("indiscipline"),F=w(null),R=w(""),U=w(null),_=w(""),P=e=>(e==null?void 0:e.id)||(e==null?void 0:e.user_id),at=e=>(e==null?void 0:e.name)||(e==null?void 0:e.user)||(e==null?void 0:e.employee_name)||(e==null?void 0:e.full_name)||"Employee",ot=e=>{var l;return(e==null?void 0:e.designation)||((l=e==null?void 0:e.department)==null?void 0:l.name)||(e==null?void 0:e.dept)||(e==null?void 0:e.department_name)||""},q=(e,l)=>{var r;return((r=e==null?void 0:e._monthMap)==null?void 0:r[l])||null},rt=e=>e?Array.isArray(e.paycuts)?e.paycuts:e.paycut?[e.paycut]:[]:[],ct=e=>rt(e).map(l=>({id:(l==null?void 0:l.id)||(l==null?void 0:l.paycut_id)||`paycut-${(l==null?void 0:l.reason)||""}`,reason:(l==null?void 0:l.reason)||"Paycut applied"})),u=e=>rt(e).map(l=>({id:(l==null?void 0:l.id)||(l==null?void 0:l.paycut_id)||`paycut-${(l==null?void 0:l.pay_hours)||""}`,label:"Paycut applied",hours:(l==null?void 0:l.pay_hours)||(l==null?void 0:l.paycut_hours)||(l==null?void 0:l.hours)})),s=e=>(e==null?void 0:e.manual_indisciplines)||(e==null?void 0:e.indisciplines)||[],C=e=>(e==null?void 0:e.manual_actions)||(e==null?void 0:e.actions)||[],z=e=>{if(!e)return[];const l=e.attachments||e.attachment_files||e.files||[],r=e.letters||e.text_letters||e.letter_attachments||[];return[...l.map(b=>({...b,_type:"file"})),...r.map(b=>({...b,_type:"letter"}))]},a=e=>(e==null?void 0:e.attachments_count)||(e==null?void 0:e.attachment_count)||z(e).length,Y=e=>Number((e==null?void 0:e.final_outcome)||(e==null?void 0:e.final_score)||(e==null?void 0:e.yearly_final_outcome)||0),et=e=>String(e).padStart(2,"0"),Q=e=>{if(!e)return"";const l=new Date(e);return Number.isNaN(l.getTime())?e:new Intl.DateTimeFormat("en",{month:"short"}).format(l)},J=e=>Array.from({length:12},(l,r)=>{const b=r+1,K=`${e}-${et(b)}-01`;return{month_start:K,label:Q(K)}}),it=V(()=>{var e;return(e=I.value)!=null&&e.length?I.value:J(c.value.year)}),pt=V(()=>{const l=et(new Date().getMonth()+1);return`${c.value.year}-${l}-01`}),B=w([]),vt=V(()=>{if(!B.value.length)return it.value;const e=new Set(B.value);return it.value.filter(l=>e.has(l.month_start))}),wt=e=>{const l=J(e).map(r=>r.month_start);e===x?B.value=[pt.value]:B.value=l},$t=e=>{const l=new Set(B.value);l.has(e)?l.delete(e):l.add(e),l.size||l.add(pt.value),B.value=Array.from(l)},kt=()=>{B.value=it.value.map(e=>e.month_start)},Ct=()=>{B.value=[pt.value]},W=e=>e%2===0?"tone-a":"tone-b",st=V(()=>v.value||[]),Mt=V(()=>{const e=[];for(let l=x+1;l>=x-4;l-=1)e.push(l);return e}),St=V(()=>q(U.value,_.value)),At=V(()=>z(St.value)),ft=(e,l,r="indiscipline")=>{h.value=e,D.value=l,T.value=r,F.value=null,R.value="",N.value=!0},yt=(e,l,r,b)=>{h.value=l,D.value=r,T.value=e,F.value=b,R.value=e,N.value=!0},It=()=>{N.value=!1,F.value=null,R.value=""},Nt=(e,l)=>{U.value=e,_.value=l,o.value=!0},Ut=()=>{o.value=!1},bt=async(e,l,r)=>{l!=null&&l.id&&confirm("Delete this item?")&&(e==="indiscipline"?await m.deleteManualIndiscipline(l.id,{month_start:r}):await m.deleteManualAction(l.id,{month_start:r}))},Lt=e=>{const l={};return Object.entries(e).forEach(([r,b])=>{b==null||b===""||(l[r]=b)}),l},Vt=()=>{c.value.page!==1&&(c.value.page=1)};return G(c,async e=>{await m.fetchReport(e),p.replace({query:Lt(e)})},{deep:!0,immediate:!0}),G(()=>[c.value.year,c.value.company_id,c.value.department_id,c.value.line_type,c.value.employee_id,c.value.search,c.value.per_page],()=>{c.value.page=1}),G(()=>c.value.year,e=>{wt(e)},{immediate:!0}),(e,l)=>(i(),d("div",Ts,[t("div",Fs,[l[8]||(l[8]=t("div",null,[t("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400"}," Discipline Report "),t("h1",{class:"text-2xl font-semibold text-slate-900"},"Discipline Report Grid"),t("p",{class:"text-sm text-slate-500"}," Track monthly discipline, actions, and attachments with Excel-style clarity. ")],-1)),t("div",js,g(st.value.length)+" users | "+g(c.value.year),1)]),t("div",Os,[L(qt,{company_id:c.value.company_id,"onUpdate:company_id":l[1]||(l[1]=r=>c.value.company_id=r),department_id:c.value.department_id,"onUpdate:department_id":l[2]||(l[2]=r=>c.value.department_id=r),employee_id:c.value.employee_id,"onUpdate:employee_id":l[3]||(l[3]=r=>c.value.employee_id=r),line_type:c.value.line_type,"onUpdate:line_type":l[4]||(l[4]=r=>c.value.line_type=r),"with-type":!0,"initial-value":e.$route.query,onFilterChange:Vt,class:"w-full"},{default:nt(()=>[t("div",Es,[l[9]||(l[9]=t("label",{class:"text-xs font-semibold text-slate-600"},"Year",-1)),A(t("select",{"onUpdate:modelValue":l[0]||(l[0]=r=>c.value.year=r),class:"rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},[(i(!0),d(k,null,M(Mt.value,r=>(i(),d("option",{key:r,value:r},g(r),9,Rs))),128))],512),[[Z,c.value.year,void 0,{number:!0}]])])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",Ps,[t("div",qs,[L(Pt,{modelValue:c.value.search,"onUpdate:modelValue":l[5]||(l[5]=r=>c.value.search=r),placeholder:"Search by name..."},null,8,["modelValue"])]),t("div",Bs,[l[11]||(l[11]=t("label",{class:"text-xs font-semibold text-slate-600"},"Rows",-1)),A(t("select",{"onUpdate:modelValue":l[6]||(l[6]=r=>c.value.per_page=r),class:"rounded-lg border border-slate-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-200"},l[10]||(l[10]=[t("option",{value:15},"15",-1),t("option",{value:25},"25",-1),t("option",{value:50},"50",-1)]),512),[[Z,c.value.per_page,void 0,{number:!0}]])])]),t("div",zs,[l[12]||(l[12]=t("p",{class:"text-xs font-semibold text-slate-600"},"Months",-1)),t("button",{class:"chip",type:"button",onClick:Ct},"Current"),t("button",{class:"chip",type:"button",onClick:kt},"All"),t("div",Ys,[(i(!0),d(k,null,M(it.value,r=>(i(),d("button",{key:`toggle-${r.month_start}`,type:"button",class:j(["chip",{active:B.value.includes(r.month_start)}]),onClick:b=>$t(r.month_start)},g(r.label||Q(r.month_start)),11,Ws))),128))])])]),lt(E)?(i(),mt(Et,{key:0})):(i(),d("div",Gs,[st.value.length===0?(i(),d("div",Hs,l[13]||(l[13]=[t("p",{class:"text-base font-semibold text-slate-700"},"No discipline records found",-1),t("p",{class:"text-sm text-slate-500"},"Try a different year or adjust filters.",-1)]))):(i(),d("div",Qs,[t("table",Js,[t("thead",Ks,[t("tr",null,[l[14]||(l[14]=t("th",{rowspan:"2",class:"th sticky-col"},[t("div",{class:"text-left"},[t("p",{class:"text-xs font-semibold text-slate-700"},"Employee"),t("p",{class:"text-[10px] text-slate-400"},"Sticky column")])],-1)),(i(!0),d(k,null,M(vt.value,(r,b)=>(i(),d("th",{key:`group-${r.month_start}`,colspan:"3",class:j(["th text-center",W(b)])},g(r.label||Q(r.month_start)),3))),128)),l[15]||(l[15]=t("th",{rowspan:"2",class:"th text-center"},"Final Outcome",-1))]),t("tr",null,[(i(!0),d(k,null,M(vt.value,(r,b)=>(i(),d(k,{key:`sub-${r.month_start}`},[t("th",{class:j(["th",W(b)])},"Indiscipline",2),t("th",{class:j(["th",W(b)])},"Action",2),t("th",{class:j(["th",W(b)])},"Attachment",2)],64))),128))])]),t("tbody",null,[(i(!0),d(k,null,M(st.value,r=>(i(),d("tr",{key:P(r),class:"border-b border-slate-100 hover:bg-slate-50/70"},[t("td",Xs,[t("div",Zs,[t("p",tl,g(at(r)),1),t("p",el,g(ot(r)),1)])]),(i(!0),d(k,null,M(vt.value,(b,K)=>(i(),d(k,{key:`${P(r)}-${b.month_start}`},[t("td",{class:j(["td min-w-[100px]",W(K)])},[L(xt,{onAdd:O=>ft(r,b.month_start,"indiscipline")},{default:nt(()=>[L(se,{"auto-items":ct(q(r,b.month_start)),"manual-items":s(q(r,b.month_start)),onEdit:O=>yt("indiscipline",r,b.month_start,O),onDelete:O=>bt("indiscipline",O,b.month_start)},null,8,["auto-items","manual-items","onEdit","onDelete"])]),_:2},1032,["onAdd"])],2),t("td",{class:j(["td min-w-[100px]",W(K)])},[L(xt,{onAdd:O=>ft(r,b.month_start,"action")},{default:nt(()=>[L(ve,{"auto-items":u(q(r,b.month_start)),"manual-items":C(q(r,b.month_start)),onEdit:O=>yt("action",r,b.month_start,O),onDelete:O=>bt("action",O,b.month_start)},null,8,["auto-items","manual-items","onEdit","onDelete"])]),_:2},1032,["onAdd"])],2),t("td",{class:j(["td min-w-[100px]",W(K)])},[L(xt,{onAdd:O=>ft(r,b.month_start,"attachment")},{default:nt(()=>[L(ye,{count:a(q(r,b.month_start)),onView:O=>Nt(r,b.month_start)},null,8,["count","onView"])]),_:2},1032,["onAdd"])],2)],64))),128)),t("td",sl,[L(ge,{"user-id":P(r),year:c.value.year,value:Y(r)},null,8,["user-id","year","value"])])]))),128))])])]))])),st.value.length?(i(),mt(Rt,{key:2,page:lt(S).page||c.value.page,"per-page":lt(S).per_page||c.value.per_page,total:lt(S).total||st.value.length,"last-page":lt(S).last_page||1,onPageChange:l[7]||(l[7]=r=>c.value.page=r)},null,8,["page","per-page","total","last-page"])):$("",!0),L(hs,{open:N.value,user:h.value,year:c.value.year,"month-start":D.value,record:q(h.value,D.value),"initial-tab":T.value,"edit-item":F.value,"edit-type":R.value,onClose:It},null,8,["open","user","year","month-start","record","initial-tab","edit-item","edit-type"]),L(Ds,{open:o.value,attachments:At.value,user:U.value,"month-start":_.value,year:c.value.year,onClose:Ut},null,8,["open","attachments","user","month-start","year"])]))}},hl=tt(ll,[["__scopeId","data-v-835a169a"]]);export{hl as default};
