import{d as yt,b as vt,m as w,r as L,c as n,o as s,a as t,g as b,p as Q,F as q,k as c,w as D,t as x,x as C,i as P,y as J,f as S,L as bt,e as tt,G as Tt,n as et,h as xt,j as I,v as gt,q as Y,M as $t,E as pt,s as N,u as Ct,A as kt}from"./index-BZgtuML-.js";import{L as X}from"./LoaderView-Dlch2maB.js";import{O as H}from"./OverlyModal-DNl6ErEr.js";import{_ as St}from"./TaskAddForm-CajzLq61.js";import{_ as wt}from"./TaskEditForm-UkzyI7ns.js";import{_ as Dt,a as It,b as Et,c as Pt,T as Lt,d as Ut}from"./TaskTreeView-CiuGtVAb.js";import{a as Mt,_ as At}from"./TaskUserAssignForm-DsXqG7l1.js";import{u as Ot,r as Nt,d as jt,a as Rt}from"./task-priority-BHTi1HA6.js";import{g as z,a as Bt,b as Ft}from"./datetime-DLSuPxzD.js";import{_ as mt}from"./UserChip-BZKLXNTi.js";import{u as Gt}from"./useTaskStore-BDVLqkpK.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-BWSwR2v7.js";import"./company-CwvgamiS.js";import"./useRequirementStore-CNQCdnhD.js";import"./requirement-my3rwaIl.js";import"./CompanyDepartmentSelectInput-_w_HHo68.js";import"./SectionLoading-DAV3baDd.js";import"./TextWithHr-C8fFFmDW.js";import"./TaskUrgencyInput-Bm7HIPLQ.js";import"./tags-Cyk7-xAn.js";import"./MultiselectDropdown-BEJm4UeT.js";import"./url-CePbr-gY.js";import"./TaskUserChip-RNqSDU1j.js";const Vt={class:"mb-3"},qt={key:0,class:"flex gap-2 items-center mx-auto justify-center mb-2"},Ht={key:1,class:"text-center py-4 text-gray-500"},Wt={key:2,class:"text-center py-4 text-red-500"},Zt={key:3,class:"space-y-4"},zt={__name:"TaskList",props:{tasks:{default:null,type:Array},loading:{default:!1,type:Boolean},error:{default:"",type:String},parentId:{type:Number,default:0},treeLevel:{type:Number,required:!0}},emits:["commentButtonClick","editClick","addClick","updatePriority"],setup(p,{emit:a}){const e=p,l=yt(),o=vt(),d=w(()=>{var y;return!!(((y=l==null?void 0:l.user)==null?void 0:y.role)!=="employee"&&(l!=null&&l.isAdminMood))}),m=a,g=L(null),{handleItemsPriorityUpdate:r,saveTaskPriority:v,listHasRearranged:k}=Ot(()=>e.tasks,e.parentId),T=async()=>{await v(),m("updatePriority")};return(y,i)=>(s(),n("div",null,[t("div",Vt,[Q(y.$slots,"task:header")]),d.value?(s(),n(q,{key:0},[c(k)?(s(),n("div",qt,[i[4]||(i[4]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:D(T,["prevent"])},"Save"),t("button",{class:"btn-3",onClick:i[0]||(i[0]=D((..._)=>g.value.resetItems&&g.value.resetItems(..._),["prevent"]))},"Discard")])):b("",!0)],64)):b("",!0),p.loading?(s(),n("div",Ht,"Loading tasks...")):p.error?(s(),n("div",Wt,x(p.error),1)):(s(),n("div",Zt,[C(Mt,{items:p.tasks,handle:"handle",onItemsUpdate:c(r),class:"rounded-lg bg-white overflow-hidden space-y-3",ref_key:"draggableTaskList",ref:g},{item:P(({item:_,index:O})=>[C(Dt,{isMyTask:c(o).name=="MyTaskShow",index:O,task:_,showDraggableHandle:d.value,"tree-level":p.treeLevel,class:"!border-0",onCommentButtonClick:M=>m("commentButtonClick",_.id),onEditClick:i[1]||(i[1]=M=>m("editClick",M)),onAddClick:i[2]||(i[2]=M=>m("addClick",M)),onEmployeeAssignClick:i[3]||(i[3]=M=>m("employeeAssignClick",M))},null,8,["isMyTask","index","task","showDraggableHandle","tree-level","onCommentButtonClick"])]),_:1},8,["items","onItemsUpdate"])]))]))}},Kt={class:"flex justify-between mt-5"},Yt={key:0,class:"flex flex-wrap items-center gap-2 mt-3"},Jt={__name:"SubTaskList",props:{subTasks:Array,parentId:{type:Number,required:!0},treeLevel:{type:Number,required:!0},subTaskIsCreatable:{type:Boolean,default:!0}},emits:["created","error","updatePriority","assignUser"],setup(p,{emit:a}){const e=p,l=J({taskId:0,isOpen:!1}),o=a,d=L(),m=J({show:!1,parentId:e.parentId,requirementId:null}),g=y=>{m.show=!0,m.parentId=y,console.log({addForm:m})};function r(){m.show=!1,m.parentId=e.parentId,o("created")}function v(){o("assignUser")}function k(){d.value=!1,o("updated")}function T(){m.show=!1,m.parentId=e.parentId}return(y,i)=>(s(),n("div",null,[d.value?(s(),S(H,{key:0},{default:P(()=>[C(wt,{taskId:d.value,onClose:i[0]||(i[0]=_=>d.value=null),onUpdated:k},null,8,["taskId"])]),_:1})):b("",!0),m.show?(s(),S(H,{key:1},{default:P(()=>[C(St,{parentTaskId:m.parentId,requirementId:m.requirementId,onTaskCreated:r,onError:y.handleTaskError,onClose:T},null,8,["parentTaskId","requirementId","onError"])]),_:1})):b("",!0),l.isOpen?(s(),S(H,{key:2},{default:P(()=>[C(At,{taskId:l.taskId,onCancelClick:i[1]||(i[1]=()=>{l.isOpen=!1,l.taskId=0}),onSuccess:i[2]||(i[2]=()=>{l.isOpen=!1,l.taskId=0,v()})},null,8,["taskId"])]),_:1})):b("",!0),C(zt,{tasks:p.subTasks,parentId:p.parentId,treeLevel:p.treeLevel,onAddClick:i[4]||(i[4]=_=>g(_)),onEditClick:i[5]||(i[5]=_=>d.value=_),onUpdatePriority:i[6]||(i[6]=_=>o("updatePriority")),onEmployeeAssignClick:i[7]||(i[7]=_=>{l.taskId=_,l.isOpen=!0})},{"task:header":P(()=>[t("div",Kt,[i[8]||(i[8]=t("div",{class:"flex justify-between items-center"},[t("h2",{class:"text-xl font-semibold text-gray-800"},"Sub Tasks")],-1)),p.subTaskIsCreatable?(s(),n("div",Yt,[t("button",{class:"btn-1 ml-auto",onClick:i[3]||(i[3]=D(()=>g(p.parentId),["prevent"]))}," Add Sub Task ")])):b("",!0)])]),_:1},8,["tasks","parentId","treeLevel"])]))}},Qt={key:0},Xt={key:0},te={key:1},ee={key:2},se={key:3},ae={key:1},ne=bt({__name:"CountdownTimer",props:{targetDateTime:{default:null},millisecond:{default:null},hideIfZeroValue:{type:Boolean,default:!1}},setup(p){const a=p;let e=0;const l=L(m());let o;function d(){return a.millisecond&&typeof a.millisecond=="number"}function m(){d()?e&&(e-=1e3):e=new Date(a.targetDateTime).getTime()-new Date().getTime();const y=Math.floor(e/1e3%60),i=Math.floor(e/1e3/60%60),_=Math.floor(e/(1e3*60*60)%24),O=Math.floor(e/(1e3*60*60*24));return{total:e,days:O,hours:_,minutes:i,seconds:y}}function g(){l.value=m()}tt(()=>{d()&&(e=a.millisecond),console.log("MOUNTED"),g(),o=setInterval(()=>{g(),l.value.total<=0&&clearInterval(o)},1e3)}),Tt(()=>clearInterval(o)),et(()=>a.targetDateTime,()=>{g(),clearInterval(o)});const r=w(()=>l.value.days.toString().padStart(2,"0")),v=w(()=>l.value.hours.toString().padStart(2,"0")),k=w(()=>l.value.minutes.toString().padStart(2,"0")),T=w(()=>l.value.seconds.toString().padStart(2,"0"));return(y,i)=>l.value.total>0?(s(),n("span",Qt,[!y.hideIfZeroValue||r.value!="00"?(s(),n("span",Xt,x(r.value)+"d : ",1)):b("",!0),!y.hideIfZeroValue||v.value!="00"?(s(),n("span",te,x(v.value)+"h : ",1)):b("",!0),!y.hideIfZeroValue||k.value!="00"?(s(),n("span",ee,x(k.value)+"m : ",1)):b("",!0),!y.hideIfZeroValue||T.value!="00"?(s(),n("span",se,x(T.value)+"s",1)):b("",!0)])):(s(),n("span",ae,[Q(y.$slots,"expired")]))}}),le={class:"mb-2 mt-6"},oe={key:0,class:"flex gap-2 justify-center items-center mb-12 text-green-600"},re={class:"flex justify-center"},ie={class:"py-6 w-full text-center"},de={class:"block mb-2"},ue={class:"font-semibold text-red-600 mx-2 text-xl"},ce={class:"mt-2"},pe={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},ke={class:"flex justify-between items-center"},me={key:0,class:"btn-2-red"},fe={key:1,class:"btn-2-red"},ft=5e3,ye={__name:"TaskDeletingFrom",props:{task:{type:Object}},emits:["closeClick","delete"],setup(p,{emit:a}){const e=p,l=L(""),o=L(""),d=a,m=L("");let g=0;async function r(){var T,y;if(!l.value)return m.value="Type the task title on input box";clearTimeout(g);try{m.value="",o.value==="deleted"?(o.value="restoring",await Nt(e.task.id),o.value="restored"):(o.value="deleting",await jt(e.task.id,{params:{security_check:l.value}}),o.value="deleted"),o.value=="deleted"?g=setTimeout(()=>{k()},ft):d("closeClick")}catch(i){o.value="error",m.value=((y=(T=i.response)==null?void 0:T.data)==null?void 0:y.message)||`Failed to update ${e.type}`}}function v(){o.value==="deleted"&&k(),d("closeClick")}function k(){o.value="",d("delete")}return(T,y)=>{var i,_;return s(),n("form",{class:"p-4 relative",onSubmit:D(r,["prevent"])},[y[7]||(y[7]=t("div",{class:"border-b text-center"},[t("h2",null,"Delete Task")],-1)),t("div",le,[y[1]||(y[1]=t("div",{class:"text-xs uppercase text-gray-500 font-semibold"},"Task:",-1)),t("div",null,x((i=p.task)==null?void 0:i.title),1)]),o.value=="deleted"?(s(),n("div",oe,y[2]||(y[2]=[t("i",{class:"fad fa-check-circle fa-4x"},null,-1),t("span",{class:"text-xl md:text-2xl"},"Task Successfully deleted",-1)]))):(s(),n(q,{key:1},[t("div",re,[t("div",ie,[t("label",de,[y[3]||(y[3]=I(" Type ")),t("span",ue,x((_=p.task)==null?void 0:_.title),1),y[4]||(y[4]=I(" and submit to delete "))]),xt(t("input",{type:"text","onUpdate:modelValue":y[0]||(y[0]=O=>l.value=O),class:"border py-2 px-4 rounded-md w-[70%]"},null,512),[[gt,l.value]])])]),y[5]||(y[5]=t("hr",null,null,-1)),t("div",ce,[m.value?(s(),n("div",pe,x(m.value),1)):b("",!0)])],64)),t("div",ke,[t("button",{class:"btn-3",type:"button",onClick:D(v,["prevent"])},"Close"),o.value=="deleted"?(s(),n("button",me,[y[6]||(y[6]=I(" Undo Delete in ")),o.value=="deleted"?(s(),S(ne,{key:0,"hide-if-zero-value":!0,millisecond:ft})):b("",!0)])):(s(),n("button",fe,"Delete"))]),o.value=="deleting"||o.value=="restoring"?(s(),S(X,{key:2,class:"absolute inset-0 bg-gray-200/70 flex items-start justify-center"},{default:P(()=>[I(x(String(o.value).charAt(0).toUpperCase()+String(o.value).slice(1)),1)]),_:1})):b("",!0)],32)}}},ve=p=>p==null?void 0:p.reduce((a,e)=>a+e.task_weight,0),_t=(p,a)=>{const e=ve(p);return p.map(l=>{const o=a.filter(d=>d.user_id===l.id).reduce((d,m)=>d+m.progress,0);return{...l,task_progress:Math.floor(o*(l.task_weight/e)),user_progress:o}})},be=(p,a)=>{let e=0;const l=[],o=g=>g.status==="COMPLETED",d=g=>g.users.some(r=>r.id===a),m=(g,r)=>{g.forEach(v=>{const k=d(v);l[r]=l[r]||{user_id:a,total_assigned:0,total_assigned_on_leaf_task:0,completed_count:0};const T=k&&v.children_tasks.length===0;l[r].total_assigned+=k?1:0,l[r].total_assigned_on_leaf_task+=T?1:0,e+=T?1:0,k&&o(v)&&(l[r].completed_count++,v.children_tasks.length),v.children_tasks.length>0&&m(v.children_tasks,r+1)})};return m(p,0),{sub_task_infos:l,assigned_on_any_leaf_task:e>0}},xe=(p,a)=>p.map(e=>({...e,...be(a,e.id)})),ge={key:0,class:"min-w-full bg-white rounded overflow-hidden"},_e={class:"py-0.5 text-bg font-semibold"},he={class:"bg-gray-50"},Te={class:"px-2 py-1 border-y"},$e={class:"px-2 py-1 border-y"},Ce={key:0,class:"text-sm text-gray-400"},Se={key:1},we={key:1,class:"min-w-full bg-white rounded overflow-hidden"},De={class:"py-0.5 text-bg font-semibold"},Ie={class:"px-2 py-1 border-y text-center"},Ee={class:"px-2 py-1 border-y border-r"},Pe={class:"px-2 py-1 border-y text-center"},Le={class:"px-2 py-1 border-y text-center"},Ue=bt({__name:"TaskProgressTable",props:{task:{},subTasks:{}},setup(p){const a=p,e=w(()=>_t(a.task.users,a.task.task_reports||[])),l=w(()=>xe(a.task.users,a.subTasks));return(o,d)=>{var m,g;return a.task.children_task_count>0?(s(),n("table",ge,[t("caption",_e,[Q(o.$slots,"caption",{},()=>[d[0]||(d[0]=I("Progress"))])]),t("thead",he,[t("tr",null,[d[1]||(d[1]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left"},"#",-1)),d[2]||(d[2]=t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left lg:w-[200px]"}," User ",-1)),(s(!0),n(q,null,Y(((g=(m=l.value[0]||{})==null?void 0:m.sub_task_infos)==null?void 0:g.length)||1,r=>(s(),n("th",{key:r,class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},x(r===1?"Completed Sub Task":"")+" "+x(r===2?"Completed Sub Sub Task":"")+" "+x(r===3?"Completed Sub Sub Sub Task":""),1))),128))])]),t("tbody",null,[(s(!0),n(q,null,Y(l.value,(r,v)=>(s(),n("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Te,x(v+1),1),t("td",$e,[C(mt,{user:r},null,8,["user"])]),(s(!0),n(q,null,Y(r.sub_task_infos,(k,T)=>(s(),n("td",{class:"px-2 py-1 border-y text-center",key:T},[k.total_assigned===0||!r.assigned_on_any_leaf_task?(s(),n("div",Ce," Not Assigned To Any Task ")):(s(),n("div",Se,x(k.completed_count)+" / "+x(k.total_assigned),1))]))),128))]))),128))])])):(s(),n("table",we,[t("caption",De,[Q(o.$slots,"caption",{},()=>[d[3]||(d[3]=I("Progress"))])]),d[4]||(d[4]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase w-[50px] text-center"},"#"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-left sm:w-[250px] mx:w-[300px] border-r"}," User "),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Started"),t("th",{class:"px-2 py-1 border-y font-semibold text-xs uppercase text-center"},"Finished")])],-1)),t("tbody",null,[(s(!0),n(q,null,Y(e.value,(r,v)=>(s(),n("tr",{key:r.id,class:"border-t hover:bg-gray-50 cursor-pointer"},[t("td",Ie,x(v+1),1),t("td",Ee,[C(mt,{user:r},null,8,["user"])]),t("td",Pe,x(c(z)(r.task_started_at)),1),t("td",Le,x(c(z)(r.task_finished_at)),1)]))),128))])]))}}}),Me=$t("task-user",()=>({updateUserStartDate:async(e,l,o)=>await pt.patch(`/task-user/task/${e}/user/${l}/update-start-date/${o}`),updateUserFinishDate:async(e,l,o)=>await pt.patch(`/task-user/task/${e}/user/${l}/update-finish-date/${o}`)})),Ae={class:"border-b text-center"},Oe={key:0},Ne={key:1},je={class:"text-center font-semibold text-blue-800 my-4"},Re={class:"flex justify-center w-full"},Be={class:"py-6 w-4/12"},Fe={class:"block text-xs font-semibold"},Ge={class:"mt-3"},Ve={key:0,class:"inline-block text-sm text-orange-700 text-center w-full"},qe={class:"flex justify-between items-center"},ht={__name:"TaskUserDateUpdate",props:{task:{type:Object},user:{user:Object},type:{type:String}},emits:["closeClick","updateDate"],setup(p,{emit:a}){const e=p,l=a,o=Me(),d=L(""),m=L("");async function g(){var v,k;console.log({date:d.value});try{e.type=="start-date"?await o.updateUserStartDate(e.task.id,e.user.id,d.value||"0"):e.type=="finish-date"&&await o.updateUserFinishDate(e.task.id,e.user.id,d.value||"0"),l("updateDate")}catch(T){m.value=((k=(v=T.response)==null?void 0:v.data)==null?void 0:k.message)||`Failed to update ${e.type}`}}function r(v){if(v){const k=e.type==="start-date"?v.started_at:v.completed_at;d.value=Bt(k)}}return et(()=>e.task,v=>{r(v)},{immediate:!0}),tt(()=>{r(e.task)}),(v,k)=>(s(),n("form",{class:"p-4",onSubmit:D(g,["prevent"])},[t("div",Ae,[p.type=="start-date"?(s(),n("h2",Oe,"Edit Start Date")):p.type=="finish-date"?(s(),n("h2",Ne,"Edit Completed Date")):b("",!0)]),t("div",je,x(p.task.title),1),t("div",Re,[t("div",Be,[t("label",Fe,x(p.type=="start-date"?"Start date":"Completed date"),1),xt(t("input",{type:"date","onUpdate:modelValue":k[0]||(k[0]=T=>d.value=T),class:"border py-2 px-4 rounded-md w-full"},null,512),[[gt,d.value]])])]),k[3]||(k[3]=t("hr",{class:"mt-4"},null,-1)),t("div",Ge,[m.value?(s(),n("div",Ve,x(m.value),1)):b("",!0)]),t("div",qe,[t("button",{class:"btn-3",onClick:k[1]||(k[1]=D(T=>l("closeClick"),["prevent"]))},"Close"),k[2]||(k[2]=t("div",null,[t("button",{class:"btn-2"},"Submit")],-1))])],32))}},He={key:0},We={key:1,class:"flex"},Ze={class:"border-r-2 border-dashed pr-6 border-gray-300"},ze={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 border border-yellow-400 w-full mb-6 text-center"},Ke={class:"relative border-l-2 border-gray-300 ml-2 space-y-8"},Ye={class:"absolute size-5 flex items-center justify-center rounded-full -left-3 border-2 bg-white border-gray-300 opacity-100"},Je={class:"mb-1 text-sm font-normal leading-none text-gray-500 flex items-center gap-3 h-5 justify-between"},Qe={key:0},Xe=["disabled"],ts=["disabled"],es={class:"text-lg font-semibold text-gray-700"},ss={class:"text-sm text-gray-500"},as={class:"flex flex-grow justify-center items-center"},ns={key:0,class:"flex flex-col justify-center items-center"},ls={key:1},os={key:1},rs={key:2,class:"flex justify-center items-center flex-col"},is={key:3,class:"flex flex-col justify-center items-center"},ds={class:"border-b -mx-4 px-4 border -mt-4 py-2 text-xl bg-gray-50"},us={class:"my-6"},cs={class:"text-center font-semibold text-blue-800 mb-4"},ps={class:"text-center my-1"},ks={class:"border px-2 rounded-md bg-gray-50"},ms={class:"text-red-600 text-center mt-2 text-sm"},fs={class:"flex justify-between mt-3"},ys={class:"btn-2"},vs={__name:"TaskStatusManager",props:{task:{type:Object}},emits:["updateStatus","error"],setup(p,{emit:a}){const e=p,l=a,o=yt(),d=L(""),m=L(),g=L(),r=J({user:null,type:""});function v($){r.user=o.user,r.type=$}const k={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CLOSED:4},T=w(()=>(k==null?void 0:k[i.value])||0),y=w(()=>{var $;return{"bg-yellow-50":i.value==="IN_PROGRESS","bg-green-50":i.value==="COMPLETED","bg-red-50":i.value==="PENDING","bg-blue-50":($=e.task)==null?void 0:$.closed_at}}),i=w(()=>{var $;return($=e.task)==null?void 0:$.status}),_=w(()=>i.value=="PENDING"?"Start":i.value=="IN_PROGRESS"?"Finish":i.value=="COMPLETED"?"Close":""),O=w(()=>_.value=="Start"?"Start Task":_.value=="Finish"?"Finish Task":_.value=="Close"?"Close Task":"");async function M(){var $,u;m.value="submitting";try{await Rt(e.task.id,{status:d.value}),d.value="",l("updateStatus")}catch(A){g.value=(u=($=A.response)==null?void 0:$.data)==null?void 0:u.message,l("error")}finally{m.value=""}}const U=w(()=>_.value=="Start"?"fas fa-play-circle text-blue-500":_.value=="Finish"?"fas fa-stop-circle text-blue-500":""),f=w(()=>{var $,u,A,j,R,B,h,F,G,V;return[{date:z((($=e.task)==null?void 0:$.assigned_at)||((u=e.task)==null?void 0:u.created_at)),title:"Assigned",description:"Task assigned to team or employee",icon:"fas fa-user-check text-blue-500 ml-[2px]",status:"assigned",serial:1,active:!!((A=e.task)!=null&&A.assigned_at)||!!((j=e.task)!=null&&j.created_at)},{date:z((R=e.task)==null?void 0:R.started_at),title:"Started",description:"Work has been started",icon:"fas fa-play text text-green-500 ml-[2px]",status:"started",serial:2,active:!!((B=e.task)!=null&&B.started_at)||T.value>=k.IN_PROGRESS},{date:z((h=e.task)==null?void 0:h.completed_at),title:"Completed",description:"Task was finished successfully",icon:"fas fa-check-circle text-green-500",status:"completed",serial:3,active:!!((F=e.task)!=null&&F.completed_at)||T.value>=k.COMPLETED},{date:z((G=e.task)==null?void 0:G.deadline),title:"Deadline",description:"Deadline for the task",icon:"fas fa-clock text-yellow-500",status:"deadline",serial:4,active:!!((V=e.task)!=null&&V.deadline)}].sort((W,Z)=>W.date===null||Z.date===null?W.serial-Z.serial:new Date(W.date)-new Date(Z.date))});return($,u)=>{var A,j,R,B;return s(),n("div",{class:N(["border py-8 px-4 rounded",y.value])},[i.value==="BLOCKED"?(s(),n("div",He,u[8]||(u[8]=[t("div",{class:"flex flex-col items-center"},[t("i",{class:"fas fa-lock-alt fa-4x text-violet-500"}),t("div",{class:"text-3xl mb-2 text-violet-500 mt-4"},"Task Blocked")],-1)]))):(s(),n("div",We,[t("div",Ze,[(A=e.task)!=null&&A.is_target?(s(),n("div",ze,u[9]||(u[9]=[t("i",{class:"fad fa-bullseye-arrow mr-3"},null,-1),I(" TARGET TASK ")]))):b("",!0),t("ol",Ke,[(s(!0),n(q,null,Y(f.value,(h,F)=>{var G,V;return s(),n("li",{class:"ml-5",key:F},[t("div",Ye,[h.active?(s(),n("i",{key:0,class:N([h.icon,"text-xs"])},null,2)):b("",!0)]),t("div",{class:N({"opacity-30":!h.active})},[t("div",Je,[h.date?(s(),n("span",Qe,x(h.date),1)):b("",!0),((G=e.task)==null?void 0:G.children_task_count)===0&&h.status==="started"&&h.active?(s(),n("button",{key:1,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:u[0]||(u[0]=D(()=>v("start-date"),["prevent"])),disabled:!!e.task.closed_at},x(h.date?"Edit":"Set Date"),9,Xe)):b("",!0),((V=e.task)==null?void 0:V.children_task_count)===0&&h.active&&h.status==="completed"?(s(),n("button",{key:2,class:"btn-3 px-2 h-5 text-sm font-semibold !border-1 disabled:opacity-30 disabled:pointer-events-none",onClick:u[1]||(u[1]=D(()=>v("finish-date"),["prevent"])),disabled:!!e.task.closed_at},x(h.date?"Edit":"Set Date"),9,ts)):b("",!0)]),t("h3",es,x(h.title),1),t("p",ss,x(h.description),1)],2)])}),128))])]),t("div",as,[(j=p.task)!=null&&j.closed_at?(s(),n("div",ns,u[10]||(u[10]=[t("i",{class:"fad fa-lock-alt fa-6x text-blue-500"},null,-1),t("div",{class:"text-blue-700 text-2xl mt-4"},"Task closed",-1)]))):i.value==="PENDING"?(s(),n("div",ls,[((R=p.task)==null?void 0:R.children_task_count)===0?(s(),n("button",{key:0,class:"btn-3 mt-2",onClick:u[2]||(u[2]=D(h=>d.value="IN_PROGRESS",["prevent"]))}," Start Working ")):(s(),n("div",os,u[11]||(u[11]=[t("div",{class:"text-center"},[t("i",{class:"fas fa-hourglass-half text-yellow-500 fa-2x"})],-1),t("div",{class:"text-yellow-600 text-xl mt-2"},"Task Pending",-1)])))])):i.value==="IN_PROGRESS"?(s(),n("div",rs,[u[12]||(u[12]=t("i",{class:"fas fa-circle fa-2x text-red-800 animate-pulse"},null,-1)),u[13]||(u[13]=t("div",{class:"mb-3 text-2xl my-4 text-red-800"},"Task In Progress",-1)),((B=p.task)==null?void 0:B.children_task_count)===0?(s(),n("button",{key:0,class:"btn-3",onClick:u[3]||(u[3]=D(h=>d.value="COMPLETED",["prevent"]))}," Finish Task ")):b("",!0)])):i.value==="COMPLETED"?(s(),n("div",is,[u[14]||(u[14]=t("i",{class:"fad fa-check-circle fa-6x text-green-500"},null,-1)),u[15]||(u[15]=t("div",{class:"text-green-700 text-2xl"},"Task Has been completed",-1)),t("button",{class:"btn-3 mt-8",onClick:u[4]||(u[4]=D(h=>d.value="CLOSED",["prevent"]))},"Close Task")])):b("",!0)])])),d.value?(s(),S(H,{key:2},{default:P(()=>{var h;return[t("form",{class:"p-4 rounded relative",onSubmit:D(M,["prevent"])},[m.value==="submitting"?(s(),S(X,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:P(()=>u[16]||(u[16]=[I("Submitting!")])),_:1,__:[16]})):b("",!0),t("h3",ds,x(O.value),1),t("div",us,[t("div",cs,x((h=p.task)==null?void 0:h.title),1),u[19]||(u[19]=t("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),t("div",ps,[u[17]||(u[17]=I(" Want to ")),t("span",ks,[t("i",{class:N(["text-sm",U.value])},null,2),I(" "+x(_.value),1)]),u[18]||(u[18]=I(" the task? "))])]),u[20]||(u[20]=t("hr",{class:"mt-3 -mx-4"},null,-1)),t("div",null,[t("div",ms,x(g.value),1),t("div",fs,[t("button",{class:"btn-3",onClick:u[5]||(u[5]=D(F=>d.value="",["prevent"]))},"Cancel"),t("button",ys,[t("i",{class:N(["text-xl text-white",U.value])},null,2),I(" "+x(_.value)+" Task ",1)])])])],32)]}),_:1})):b("",!0),r!=null&&r.user?(s(),S(H,{key:3},{default:P(()=>[C(ht,{task:e.task,user:r.user,type:r.type,onCloseClick:u[6]||(u[6]=h=>r.user=null),onUpdateDate:u[7]||(u[7]=()=>{r.user=null,r.type=null,l("updateStatus")})},null,8,["task","user","type"])]),_:1})):b("",!0)],2)}}},bs={class:"container mx-auto p-6"},xs={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},gs={class:"grid grid-cols-4"},_s={class:"mb-4 flex col-span-full"},hs={class:"font-medium text-xl"},Ts={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},$s={key:0,class:"text-white bg-green-700 text-[12px] uppercase px-2 py-[2px] rounded-full border border-green-200 opacity-80"},Cs={class:"text-gray-400 text-xs mt-2 col-span-full"},Ss={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},ws={class:"col-span-full mb-4"},Ds=["innerHTML"],Is={key:0,class:"mt-4 col-span-full mb-6"},Es={class:"mt-6 py-2 flex justify-center items-center gap-2 col-span-full"},Ps=["disabled"],Ls={class:"ml-auto flex gap-4"},Us={key:0},Ms={key:1},As={key:1,class:"text-center py-4 text-red-500"},oa={__name:"TaskShow",setup(p){const a=Gt(),e=vt(),l=Ct(),o=L(""),d=w(()=>a.tasks),m=L({}),g=J({open:!1,task:null}),r=L(!0);tt(async()=>{o.value="loading",await k(e.params.id),o.value=""});const v=J({user:null,type:""});async function k(U){await a.fetchTask(U)}const T=w(()=>_t(a.task.users,a.task.task_reports||[]));async function y(){await k(e.params.id),v.user=null,v.type=""}const i=U=>{l.push({name:"TaskEdit",params:{id:U}})},_=w(()=>{var U,f;return a.task?((U=a.task)==null?void 0:U.parent_id)==0?{name:e.name==="MyTaskShow"?"MyTaskList":"TaskList"}:{params:{id:(f=a.task)==null?void 0:f.parent_id}}:null});function O(){g.open=!0,g.task=a.task}function M(){g.open=!1,console.log({STATE:"Deleted",backLink:_.value}),l.push(_.value)}return et(()=>e.params.id,async U=>{o.value="changing",await k(U),o.value=""}),(U,f)=>{var A,j,R,B,h,F,G,V,W,Z,st,at,nt,lt,ot,rt,it,dt,ut;const $=kt("RouterLink"),u=kt("router-view");return s(),n("div",bs,[v.user?(s(),S(H,{key:0},{default:P(()=>[C(ht,{task:c(a).task,user:v.user,type:v.type,onCloseClick:f[0]||(f[0]=E=>v.user=null),onUpdateDate:y},null,8,["task","user","type"])]),_:1})):b("",!0),g.open?(s(),S(H,{key:1},{default:P(()=>[C(ye,{onCloseClick:f[1]||(f[1]=E=>g.open=!1),task:g.task,onDelete:M},null,8,["task"])]),_:1})):b("",!0),o.value==="loading"?(s(),S(X,{key:2})):(s(),n("div",xs,[c(a).task?(s(),n(q,{key:0},[t("section",gs,[t("div",_s,[t("div",null,[t("h2",hs,x(c(a).task.title),1),t("div",Ts,[c(a).task.parent_id==0?(s(),n("div",$s," MAIN TASK ")):b("",!0),(A=c(a).task)!=null&&A.is_important?(s(),S(Lt,{key:1})):b("",!0),(j=c(a).task)!=null&&j.is_urgent?(s(),S(Ut,{key:2})):b("",!0)]),t("div",Cs,[f[13]||(f[13]=t("i",{class:"fas fa-clock"},null,-1)),I(" "+x(c(Ft)(c(a).task.created_at)),1)])]),t("div",Ss,[C(It,{status:(R=c(a).task)==null?void 0:R.status,progressPercent:(B=c(a).task)==null?void 0:B.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),c(a).task?(s(),S(Et,{key:0,task:c(a).task,ref_key:"progress",ref:m,class:"!text-lg"},null,8,["task"])):b("",!0)])]),t("div",ws,[t("p",{innerHTML:(h=c(a).task)==null?void 0:h.description,class:N(["text-gray-700",{"line-clamp-3":r.value}])},null,10,Ds),((G=(F=c(a).task)==null?void 0:F.description)==null?void 0:G.length)>=600?(s(),n("button",{key:0,class:"text-blue-500 mt-2",onClick:f[2]||(f[2]=D(E=>r.value=!r.value,["prevent"]))}," Show "+x(r.value?"More":"Less"),1)):b("",!0)]),C(Pt,{task:(V=c(a))==null?void 0:V.task,"tree-level":(Z=(W=c(a))==null?void 0:W.task)==null?void 0:Z.level},null,8,["task","tree-level"]),c(a).task.children_task_count>0?(s(),n("section",Is,[C(Ue,{"task-users":((st=c(a).task)==null?void 0:st.users)||[],task:c(a).task,"sub-tasks":c(a).tasks,"progress-users":T.value},{caption:P(()=>f[14]||(f[14]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):b("",!0),(at=c(a))!=null&&at.task?(s(),S(vs,{key:1,task:((nt=c(a))==null?void 0:nt.task)||{},class:"col-span-full mt-4",onUpdateStatus:f[3]||(f[3]=E=>{var K,ct;return k((ct=(K=c(a))==null?void 0:K.task)==null?void 0:ct.id)})},null,8,["task"])):b("",!0),t("div",Es,[t("button",{onClick:f[4]||(f[4]=D(E=>{var K;return i((K=c(a).task)==null?void 0:K.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!c(a).task.closed_at}," Edit ",8,Ps),C($,{to:{name:"TaskUserAssign",params:{id:(lt=c(a).task)==null?void 0:lt.id}},class:N(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition",c(a).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:f[5]||(f[5]=E=>E.stopPropagation())},{default:P(()=>f[15]||(f[15]=[t("i",{class:"fas fa-user-plus"},null,-1),I(" Assign Users ")])),_:1,__:[15]},8,["to","class"]),C($,{to:_.value,class:"bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition disabled:opacity-30 disabled:pointer-events-none",onClick:f[6]||(f[6]=E=>E.stopPropagation())},{default:P(()=>f[16]||(f[16]=[t("i",{class:"fas fa-arrow-left"},null,-1),I(" Back ")])),_:1,__:[16]},8,["to"]),t("div",Ls,[((ot=c(a).task)==null?void 0:ot.children_task_count)===0&&((rt=c(a).task)==null?void 0:rt.status)==="PENDING"?(s(),n("button",{key:0,class:"btn-2-red h-8",onClick:D(O,["prevent"])}," Delete ")):b("",!0),d.value.length>0?(s(),S($,{key:1,to:{name:"TaskShow",params:{id:(it=c(a).task)==null?void 0:it.id}},onClick:f[7]||(f[7]=E=>E.stopPropagation()),class:N(["py-0.5 btn-3 ml-auto text-sm h-8",{"bg-blue-500 text-white":c(e).name=="TaskShow"||c(e).name==="MyTaskShow"}])},{default:P(()=>f[17]||(f[17]=[t("i",{class:"fal fa-list-ul"},null,-1),I(" Sub Tasks ")])),_:1,__:[17]},8,["to","class"])):b("",!0),C($,{to:{name:"TaskReports",params:{id:(dt=c(a).task)==null?void 0:dt.id}},onClick:f[8]||(f[8]=E=>E.stopPropagation()),class:N(["py-0.5 btn-3 text-sm h-8",{"bg-blue-500 text-white":c(e).name=="TaskReports"}])},{default:P(()=>f[18]||(f[18]=[t("i",{class:"fal fa-file-alt"},null,-1),I(" Reports ")])),_:1,__:[18]},8,["to","class"])])])]),(c(e).name=="TaskShow"||c(e).name==="MyTaskShow")&&((ut=c(a).task)==null?void 0:ut.level)<=2?(s(),n("section",Us,[C(Jt,{subTasks:d.value,"parent-id":c(e).params.id,"tree-level":c(a).task.level+1,onCreated:f[9]||(f[9]=E=>k(c(e).params.id)),onUpdated:f[10]||(f[10]=E=>k(c(e).params.id)),onUpdatePriority:f[11]||(f[11]=E=>k(c(e).params.id)),onAssignUser:f[12]||(f[12]=E=>k(c(e).params.id)),"sub-task-is-creatable":!c(a).task.closed_at},null,8,["subTasks","parent-id","tree-level","sub-task-is-creatable"])])):(s(),n("section",Ms,[C(u)]))],64)):(s(),n("div",As,x(c(a).error),1)),o.value==="changing"?(s(),S(X,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):b("",!0)]))])}}};export{oa as default};
