import{r as n,d as F,e as M,A,c,o as d,a as s,f as I,g as v,h as T,v as S,p as L,k as f,t as y,w as V}from"./index-CWlaYKhI.js";import{g as q}from"./datetime-BEfC2TVK.js";import{u as O}from"./company-BoLFcuSy.js";import{u as W}from"./tags-CeLiEyeB.js";import{u as $}from"./useTaskStore-D4qdW-xz.js";import{S as j}from"./SectionLoading-DOdY2K_I.js";import{_ as R}from"./MultiselectDropdown-D0u9f9HR.js";const Y={class:"px-4 max-h-[90vh] overflow-auto"},z={class:"sticky top-0 pt-4 -mx-4 px-4 border-b bg-white rounded-t-md"},G={key:0,class:"text-center py-4 text-gray-500"},H={class:"mb-4"},J={class:"mb-4"},K={key:0,class:"mb-4"},P={class:"mb-4"},Q={class:"sticky bottom-0 bg-white py-4 border-t"},X={key:0,class:"mb-4 text-red-500 font-medium"},Z={key:1},D={class:"flex items-center gap-4 justify-between"},ee=["disabled"],ne={__name:"TaskEditForm",props:{taskId:{type:[String,Number],required:!0}},emits:["updated","cancel"],setup(B,{emit:N}){const k=B,x=N,u=$(),b=n([]),h=W(),U=F(),C=O(),a=n(),r=n(!1),g=n([]),_=n(""),l=n({});M(async()=>{var t,e;r.value=!0,h.fetchTags("website"),a.value=(t=await u.fetchTask(k.taskId,{},{fetchOnly:!0,loadingBeforeFetch:!1}))==null?void 0:t.task,await C.fetchCompanies({with:"departments",ignore_permission:!0}),w(a.value),b.value=((e=a.value)==null?void 0:e.website_tags)||[],g.value=a.value.users,r.value=!1}),A(()=>a.value,t=>{w(t),g.value=t.users});function w(t){var e;l.value={title:t.title,description:t.description,requirement_id:t.requirement_id,from_department_id:t.from_department_id,to_department_id:t.to_department_id,...((e=U.user)==null?void 0:e.role)!=="employee"?{is_important:t.is_important,is_urgent:t.is_urgent,is_target:t.is_target,started_at:q(t.started_at),deadline:q(t.deadline)}:{}}}const E=async()=>{var t,e,m,p;r.value=!0;try{const i={...l.value,user_ids:((t=g.value)==null?void 0:t.map(o=>Number(o.id)))||[],website_tags:((e=b.value)==null?void 0:e.map(o=>Number(o.id)))||[]};await u.updateTask(k.taskId,i,{loadingBeforeFetch:!1}),x("updated")}catch(i){console.error(i),_.value=((p=(m=i.response)==null?void 0:m.data)==null?void 0:p.message)||"An error occurred while updating the task."}finally{r.value=!1}};return(t,e)=>{var m,p,i;return d(),c("div",Y,[s("div",z,[e[4]||(e[4]=s("h2",{class:"text-2xl font-semibold text-gray-800 mb-4"},"Edit Task",-1)),r.value?(d(),c("div",G,"Loading form...")):v("",!0)]),s("form",{onSubmit:V(E,["prevent"]),class:"mt-4"},[s("div",H,[e[5]||(e[5]=s("label",{class:"block text-gray-700 font-medium mb-2"},"Task Title",-1)),T(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.title=o),required:"",placeholder:"Enter task title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,l.value.title]])]),s("div",J,[e[6]||(e[6]=s("label",{class:"text-gray-800"},"Websites",-1)),L(R,{options:f(h).tags,multiple:!0,modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=o=>b.value=o),label:"name","track-by":"id"},null,8,["options","modelValue"])]),(m=a.value)!=null&&m.requirement?(d(),c("div",K,[e[7]||(e[7]=s("label",{class:"block text-gray-700 font-medium mb-2"},"Requirement",-1)),s("div",null,[s("p",null,y((i=(p=a.value)==null?void 0:p.requirement)==null?void 0:i.title),1)])])):v("",!0),s("div",P,[e[8]||(e[8]=s("label",{class:"block text-gray-700 font-medium mb-2"},"Description",-1)),T(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.description=o),rows:"4",placeholder:"Enter task description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[S,l.value.description]])]),s("div",Q,[f(u).error||_.value?(d(),c("div",X,y(f(u).error||_.value),1)):v("",!0),f(u).error?(d(),c("hr",Z)):v("",!0),s("div",D,[s("button",{type:"button",onClick:e[3]||(e[3]=V(o=>x("close"),["prevent"])),class:"btn-3"},"Cancel"),s("button",{disabled:r.value,type:"submit",class:"btn-2"},y(r.value?"Updating...":"Update Task"),9,ee)])])],32),r.value?(d(),I(j,{key:0})):v("",!0)])}}};export{ne as _};
