import{B as p,C as i}from"./index-Bvm-KyRW.js";const h=p("kpi-report",{state:()=>({meta:null,rows:[],reports:null,isLoading:!1,error:null}),actions:{async fetchBiMonthly(o){var r,t;this.isLoading=!0,this.error=null;try{const{data:e}=await i.get("/kpi/reports/bi-monthly",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:Array.isArray(e==null?void 0:e.data)?e.data:[],{meta:this.meta,rows:this.rows}}catch(e){throw this.error=((t=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to load report",e}finally{this.isLoading=!1}},async exportBiMonthly(o){try{const r=await i.get("/kpi/reports/bi-monthly-export",{params:o,responseType:"blob"}),t=r.headers["content-disposition"]||"";let e="kpi_bi_monthly.xlsx";const s=/filename="?([^"]+)"?/i.exec(t);s&&s[1]&&(e=decodeURIComponent(s[1]));const l=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),n=URL.createObjectURL(l),a=document.createElement("a");a.href=n,a.download=e,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(n)}catch(r){throw console.error(r),r}},async setReportCompletion(o){var r,t;try{const{form_id:e,department_id:s,completed:l}=o||{};if(!e)throw new Error("form_id is required");if(s==null)throw new Error("department_id is required");const{data:n}=await i.patch(`/kpi/forms/${e}/report-completion`,{department_id:s,completed:!!l});return n}catch(e){const s=((t=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:t.message)||(e==null?void 0:e.message)||"Failed to update report completion";throw console.error("setReportCompletion error:",e),new Error(s)}},async setTargetCompletion({form_id:o,department_id:r,completed:t}){const{data:e}=await i.post(`/kpi/bi-monthly/forms/${o}/target-completion`,{department_id:r,completed:t});return e},async fetchYearly(o){var r,t;this.isLoading=!0,this.error=null;try{const{data:e}=await i.get("/kpi/reports/yearly",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:[],this.reports=e??null,{meta:this.meta,rows:this.rows}}catch(e){throw this.error=((t=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to load yearly report",e}finally{this.isLoading=!1}},async fetchYearlyExecutive(o){var r,t;this.isLoading=!0,this.error=null;try{const{data:e}=await i.get("/yearly-executive-kpi-summary-reports",{params:o});return this.meta=(e==null?void 0:e.meta)??null,this.rows=Array.isArray(e==null?void 0:e.rows)?e.rows:[],this.reports=e??null,{meta:this.meta,rows:this.rows,reports:this.reports}}catch(e){throw this.error=((t=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to load yearly report",e}finally{this.isLoading=!1}}}});export{h as u};
