import{r as h,y as V,A as D,s as Y,o as r,c,a as e,t as u,l as B,h as _,d as A,C as R,F as q,x as M,v as N,e as F,b as K,m as S,n as $,f as P,p as H,q as J,g as Q}from"./index-D3fib4Ye.js";import{L as W}from"./LoaderView-BjOikuZx.js";import{u as I}from"./shift-CK_7PuwP.js";import{d as L}from"./dayjs.min-Cbbdfn5l.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Z}from"./MultiselectDropdown-CdgWTmEP.js";import{u as ee}from"./user-Bx6LfADD.js";import"./vue-multiselect.esm-DdZXH3It.js";const te={key:0,class:"flex items-center justify-center fixed top-0 left-0 w-full h-full z-50 bg-opacity-40"},se={class:"modal-card relative bg-white p-6 rounded w-full max-w-md"},oe={class:"text-lg font-semibold mb-4"},ae={class:"mb-4"},le=["value"],ne={class:"mb-4"},de={class:"mb-4"},ie={class:"flex justify-end gap-3 mt-4"},re={__name:"ShiftAssignmentModal",props:{isOpen:Boolean,shifts:{type:Object,default:()=>({})},employee:{type:Object,default:()=>({id:0,name:""})},hasShift:{type:Object,default:()=>null}},emits:["close"],setup(C,{emit:U}){const E=U,l=C,s=h({shift_id:"",employee_id:l.employee.id,start_date:"",end_date:""}),y=V(()=>{const n=Object.keys(l.shifts)[0];return l.shifts[n]||[]});D(()=>l.employee,n=>{s.value.employee_id=(n==null?void 0:n.id)||0},{immediate:!0,deep:!0}),D(()=>l.isOpen,n=>{var o;n&&(l.hasShift?(s.value.shift_id=l.hasShift.shift_id||"",s.value.start_date=l.hasShift.start_date?L(l.hasShift.start_date).format("YYYY-MM-DD"):"",s.value.end_date=l.hasShift.end_date?L(l.hasShift.end_date).format("YYYY-MM-DD"):"",s.value.employee_id=((o=l.employee)==null?void 0:o.id)||""):(s.value.shift_id="",s.value.start_date="",s.value.end_date=""))},{immediate:!0});const v=()=>{E("close",!1)},f=I(),{message:x}=Y(f),k=async()=>{if(!s.value.shift_id||!s.value.start_date||!s.value.employee_id){alert("All fields are required!");return}try{const n={...s.value},o=await f.shiftAssign(n);console.log("Shift assigned successfully:",o),alert(l.hasShift?"Shift updated successfully!":"Shift assigned successfully!"),v()}catch(n){console.error("Failed to assign shift:",n),alert("Failed to assign shift.")}};return(n,o)=>C.isOpen?(r(),c("div",te,[e("div",se,[e("h2",oe,u(l.hasShift?"Update Shift for":"Assign Shift to")+" "+u(C.employee.name),1),B(" "+u(_(x))+" ",1),e("div",ae,[o[4]||(o[4]=e("label",{class:"block text-sm mb-1"},"Select Shift:",-1)),A(e("select",{"onUpdate:modelValue":o[0]||(o[0]=d=>s.value.shift_id=d),class:"w-full p-2 border rounded"},[o[3]||(o[3]=e("option",{value:"",disabled:""},"Select a shift",-1)),(r(!0),c(q,null,M(y.value,d=>(r(),c("option",{key:d==null?void 0:d.id,value:d==null?void 0:d.id},u(d==null?void 0:d.name),9,le))),128))],512),[[R,s.value.shift_id]])]),e("div",ne,[o[5]||(o[5]=e("label",{class:"block text-sm mb-1"},"Start Date:",-1)),A(e("input",{type:"date","onUpdate:modelValue":o[1]||(o[1]=d=>s.value.start_date=d),class:"w-full border rounded p-2"},null,512),[[N,s.value.start_date]])]),e("div",de,[o[6]||(o[6]=e("label",{class:"block text-sm mb-1"},"End Date (optional):",-1)),A(e("input",{type:"date","onUpdate:modelValue":o[2]||(o[2]=d=>s.value.end_date=d),class:"w-full border rounded p-2"},null,512),[[N,s.value.end_date]])]),e("div",ie,[e("button",{onClick:v,class:"px-4 py-2 bg-gray-400 text-white rounded"},"Cancel"),e("button",{onClick:k,class:"px-4 py-2 bg-green-600 text-white rounded"},u(l.hasShift?"Update":"Assign"),1)]),e("button",{type:"button",onClick:v,class:"absolute top-2 right-2 text-red-500 text-xl"},o[7]||(o[7]=[e("i",{class:"far fa-times-circle"},null,-1)]))])])):F("",!0)}},ce=X(re,[["__scopeId","data-v-c3e70801"]]),ue={class:"space-y-2 px-4"},pe={class:"flex items-center justify-between gap-2"},fe={class:"flex items-center gap-4"},me={key:0,class:"text-center py-4"},ye={key:1,class:"space-y-4"},be={class:"title-md"},he={class:"overflow-x-auto"},_e={class:"min-w-full table-auto bg-white shadow-md rounded-lg overflow-hidden"},ve={class:"border border-gray-300 px-2"},xe={class:"border border-gray-300 px-2"},ge={class:"border border-gray-300 px-2"},Se={class:"border border-gray-300 px-2"},ke={class:"border border-gray-300 px-2"},we=["onClick"],Ce={key:0},Ue={class:"border border-gray-300 px-2"},Ae={class:"border border-gray-300 px-2"},qe={class:"border border-gray-300 px-2"},Me={key:0,class:"text-green-500"},Ee={key:1,class:"text-red-500"},$e={class:"border border-gray-300 px-2"},De={class:"flex gap-2"},Fe={__name:"UserList",setup(C){const U=I(),{shifts:E}=Y(U),l=Q(),s=P(),y=ee(),v=h([]),f=h(s.query.company||"all"),x=h(""),k=h(""),n=h(!1);K(()=>{y.fetchUsers()});const o=()=>{l.go(-1)};D(f,i=>{l.push({query:{...s.query,company:i}})});const d=V(()=>{var m;const i={},a=new Set;y==null||y.users.forEach(p=>{var g;const t=((g=p==null?void 0:p.company)==null?void 0:g.name)||"Unknown Company";i[t]||(i[t]=[]),i[t].push(p),a.add(t)}),v.value=Array.from(a);let b=i;if(f.value!=="all"&&(b={[f.value]:i[f.value]||[]}),(m=x.value)!=null&&m.id){const p={};for(const[t,g]of Object.entries(b)){const w=g.filter(j=>j.id===x.value.id);w.length&&(p[t]=w)}return p}return b}),O=h("");function T(i){O.value=i.id,k.value=i,(i==null?void 0:i.company_id)!==void 0&&(U.fetchShifts(i==null?void 0:i.company_id),n.value=!n.value)}function z(){n.value=!1}async function G(){await y.fetchUsersExcelExport({data:{companyName:f.value}})}return(i,a)=>{const b=H("RouterLink");return r(),c("div",ue,[e("div",pe,[e("button",{class:"btn-3",onClick:o},a[2]||(a[2]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),a[4]||(a[4]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Employee List",-1)),S(b,{to:{name:"UserAdd",query:{company:_(s).query.company}},class:"btn-2"},{default:$(()=>a[3]||(a[3]=[e("span",{class:"hidden md:flex"},"Add New",-1),e("i",{class:"far fa-plus"},null,-1)])),_:1},8,["to"])]),e("div",fe,[e("div",null,[A(e("select",{"onUpdate:modelValue":a[0]||(a[0]=m=>f.value=m),class:"input-1"},[a[5]||(a[5]=e("option",{value:"all",selected:""},"All Company",-1)),(r(!0),c(q,null,M(v.value,(m,p)=>(r(),c("option",{key:p},u(m),1))),128))],512),[[R,f.value]])]),S(Z,{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=m=>x.value=m),options:_(y).users,multiple:!1,label:"name",class:"w-1/3",placeholder:"Select user"},null,8,["modelValue","options"]),e("button",{type:"button",onClick:G,class:"btn-3"},a[6]||(a[6]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1),B("Excel ")]))]),_(y).isLoading?(r(),c("div",me,[S(W)])):(r(),c("div",ye,[(r(!0),c(q,null,M(d.value,(m,p)=>(r(),c("div",{key:p},[e("h2",be,u(p),1),e("div",he,[e("table",_e,[a[9]||(a[9]=e("thead",null,[e("tr",{class:"bg-gray-200"},[e("th",{class:"border border-gray-300 px-2 text-left"},"#"),e("th",{class:"border border-gray-300 px-2 text-left"},"Name"),e("th",{class:"border border-gray-300 px-2 text-left"},"Designation"),e("th",{class:"border border-gray-300 px-2 text-left"},"Role"),e("th",{class:"border border-gray-300 px-2 text-left"},"Shift"),e("th",{class:"border border-gray-300 px-2 text-left"},"Phone"),e("th",{class:"border border-gray-300 px-2 text-left"},"Email"),e("th",{class:"border border-gray-300 px-2 text-left"},"Status"),e("th",{class:"border border-gray-300 px-2 text-left"},"Action")])],-1)),e("tbody",null,[(r(!0),c(q,null,M(m,(t,g)=>{var w;return r(),c("tr",{key:t.id,class:"border-b border-gray-200 hover:bg-blue-200"},[e("td",ve,u(g+1),1),e("td",xe,u(t==null?void 0:t.name),1),e("td",ge,u((w=t.designation)==null?void 0:w.title),1),e("td",Se,u(t.role),1),e("td",ke,[e("button",{type:"button",onClick:j=>T(t),class:J(["btn-4 text-sm",t!=null&&t.current_shift?"bg-yellow-500 hover:bg-yellow-600":"btn-4"])},u(t!=null&&t.current_shift?"Change Shift":"Assign Shift"),11,we),O.value===t.id&&n.value?(r(),c("div",Ce,[S(ce,{isOpen:n.value,shifts:_(E),hasShift:t==null?void 0:t.current_shift,employee:{id:k.value.id,name:k.value.name},onClose:z},null,8,["isOpen","shifts","hasShift","employee"])])):F("",!0)]),e("td",Ue,u(t.phone),1),e("td",Ae,u(t.email||"নেই"),1),e("td",qe,[t.is_active?(r(),c("span",Me,"Active")):(r(),c("span",Ee,"Inactive"))]),e("td",$e,[e("div",De,[S(b,{to:{name:"UserShow",params:{id:t.id},query:{company:_(s).query.company}},class:"btn-icon"},{default:$(()=>a[7]||(a[7]=[e("i",{class:"far fa-eye"},null,-1)])),_:2},1032,["to"]),S(b,{to:{name:"UserEdit",params:{id:t.id},query:{company:_(s).query.company}},class:"btn-icon"},{default:$(()=>a[8]||(a[8]=[e("i",{class:"far fa-edit"},null,-1)])),_:2},1032,["to"])])])])}),128))])])])]))),128))]))])}}};export{Fe as default};
