import{x as D,c as p,o as _,t as a,u as N,b as B,d as V,s as I,r as M,A as U,e as W,m as j,a as e,f as q,n as w,h as z,v as O,k,F as J,y as G,q as H,j as $,g as K,i as X}from"./index-CqAksBNS.js";import{_ as Y}from"./EmployeeFilter-CDucJfj9.js";import{L as Z}from"./LoaderView-B4ey7ILm.js";import{_ as Q}from"./UpdateOrCreate-ieKXZZIG.js";import{u as g}from"./attendance-D_VPl5ss.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-CsM8a50S.js";import"./department-V2_wICaN.js";import"./EmployeeDropdownInput-B1vjU1y6.js";import"./SelectDropdown-J3YuZeAq.js";import"./UserChip-BRd62vH2.js";import"./TimePickerAsFloatHour-BGGiHFzV.js";const et={__name:"DisplayFormattedWorkingHours",props:["workingHours"],setup(A){const h=A,r=D(()=>{if(!h.workingHours)return"-";const y=Math.floor(h.workingHours),c=Math.round((h.workingHours-y)*60);return c?`${y}h ${c}m`:`${y}h`});return(y,c)=>(_(),p("span",null,a(r.value),1))}},st={class:"px-4 space-y-4"},at={class:"flex items-center justify-between gap-2"},nt={class:"flex gap-2"},dt=["disabled"],rt=["disabled"],ct={class:"flex flex-wrap items-end gap-4"},ot={class:"flex items-end gap-3"},lt={class:"flex flex-col"},it={key:1,class:"text-center text-red-500 text-lg italic mt-10"},_t={key:2,class:"card-bg p-8 border rounded-lg text-center text-gray-600"},ut={key:3,class:"overflow-x-auto card-bg border rounded-lg"},pt={class:"min-w-full table-auto border-collapse"},ht={class:"text-center text-xs"},yt={class:"td"},mt={class:"td text-left"},vt={class:"td text-left"},ft={class:"td"},xt={class:"td"},bt={class:"td"},wt={class:"td"},kt={class:"td"},Ht={class:"td"},Dt={class:"td"},At={class:"td"},St={class:"td"},Ct={class:"td"},Lt={class:"td"},Mt={class:"td"},qt={class:"td"},$t={class:"text-gray-500"},Ft={class:"td"},Pt={class:"td"},Rt={class:"td"},Tt={class:"td"},Et={class:"td"},Nt={class:"text-xs w-10 text-gray-600"},Bt={class:"td"},Vt={class:"text-xs w-10 text-gray-600"},It={class:"td"},Ut={class:"td"},Wt={class:"td"},jt={class:"td"},zt={class:"flex gap-2 items-center justify-center"},Ot={class:"td"},Jt={class:"td"},Gt={class:"bg-gray-100 font-semibold text-sm text-center"},Kt={class:"td"},Xt={class:"td"},Yt={class:"td"},Zt={class:"td"},Qt={class:"td"},gt={class:"td"},te={class:"td"},ee={class:"td"},se={class:"td"},ae={__name:"MonthlyAttendanceSummaryReport",setup(A){const h=N(),r=B(),y=V(),c=g(),{monthly_company_summary:S}=I(c),C=d=>{const s=Number(d);return Number.isFinite(s)?s:0},o=(d,s)=>d.reduce((u,t)=>{try{const v=s.split(".").reduce((m,f)=>m?m[f]:void 0,t);return u+C(v)}catch{return u}},0),l=M(r.query.date&&String(r.query.date)||c.selectedMonth||""),n=M({company_id:r.query.company_id||"",department_id:r.query.department_id||"all",line_type:r.query.line_type||"all",employee_id:r.query.employee_id||""}),x=D(()=>Array.isArray(S.value)?S.value:[]),i=D(()=>{const d=x.value;return{cl:o(d,"total_cl_leave"),ml:o(d,"total_ml_leave"),sl:o(d,"total_sl_leave"),wplDays:o(d,"total_wpl_leave"),otHour:o(d,"total_overtime_hours"),absentDays:o(d,"total_absent"),wplHour:o(d,"total_wpl_hour"),paycutHour:o(d,"paycut.paycut_hours"),payableHour:o(d,"payable_hour")}}),b=async()=>{const d=n.value.company_id,s=n.value.employee_id||"",u=n.value.line_type!=="all"?n.value.line_type:"";if(!d){alert("⚠️ Please select a company first.");return}try{await c.getMonthlyAttendanceSummaryReport(d,u,s,l.value)}catch(t){console.error("❌ Failed to load attendance:",t),alert("❌ Failed to load attendance data.")}},L=d=>{const s=r.query;Object.keys(d).some(t=>String(s[t]??"")!==String(d[t]??""))&&h.replace({query:d})},F=()=>{L({...r.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:l.value||""})};U(l,d=>{L({...r.query,date:d||""})}),W(()=>{n.value.company_id&&b()});const P=async()=>{if(!n.value.company_id)return;const d=n.value.line_type!=="all"?n.value.line_type:"";await c.downloadExcel(n.value.company_id,d,l.value)},R=async()=>{if(!n.value.company_id)return;const d=n.value.line_type!=="all"?n.value.line_type:"";await c.downloadPDF(n.value.company_id,d,l.value)},T=()=>h.go(-1),E=async()=>{await b()};return(d,s)=>{const u=j("router-link");return _(),p("div",st,[e("div",at,[e("button",{class:"btn-3",onClick:T},s[6]||(s[6]=[e("i",{class:"far fa-arrow-left"},null,-1),e("span",{class:"hidden md:flex"},"Back",-1)])),s[9]||(s[9]=e("h1",{class:"title-md md:title-lg flex-wrap text-center"}," Monthly Attendance Summary Report ",-1)),e("div",nt,[e("button",{type:"button",onClick:P,class:"btn-1",disabled:!n.value.company_id},s[7]||(s[7]=[e("i",{class:"far fa-file-excel text-2xl text-green-500"},null,-1)]),8,dt),e("button",{type:"button",onClick:R,class:"btn-1",disabled:!n.value.company_id},s[8]||(s[8]=[e("i",{class:"fal fa-file-pdf text-2xl text-red-500"},null,-1)]),8,rt)])]),e("div",ct,[w(Y,{company_id:n.value.company_id,"onUpdate:company_id":s[0]||(s[0]=t=>n.value.company_id=t),department_id:n.value.department_id,"onUpdate:department_id":s[1]||(s[1]=t=>n.value.department_id=t),employee_id:n.value.employee_id,"onUpdate:employee_id":s[2]||(s[2]=t=>n.value.employee_id=t),line_type:n.value.line_type,"onUpdate:line_type":s[3]||(s[3]=t=>n.value.line_type=t),"with-type":!0,"initial-value":d.$route.query,onFilterChange:F},null,8,["company_id","department_id","employee_id","line_type","initial-value"]),e("div",ot,[e("div",lt,[s[10]||(s[10]=e("label",{class:"text-xs text-gray-600 mb-1"},"Month",-1)),z(e("input",{type:"month","onUpdate:modelValue":s[4]||(s[4]=t=>l.value=t),class:"input-1"},null,512),[[O,l.value]])]),e("button",{type:"button",onClick:s[5]||(s[5]=t=>b()),class:"btn-2"},"Search")])]),k(c).isLoading?(_(),q(Z,{key:0})):n.value.company_id?x.value.length===0?(_(),p("div",_t," No attendance found for the selected month & filters. ")):(_(),p("div",ut,[e("table",pt,[s[16]||(s[16]=e("thead",{class:"sticky top-0 z-10 bg-white shadow-sm"},[e("tr",{class:"bg-gray-50 text-sm"},[e("th",{rowspan:"2",class:"th"},"#"),e("th",{rowspan:"2",class:"th text-left"},"Employee Name"),e("th",{rowspan:"2",class:"th text-left"},"Designation"),e("th",{colspan:"5",class:"th"},"Attendance Summary"),e("th",{colspan:"2",class:"th"},"Actual Late"),e("th",{colspan:"2",class:"th"},"Remaining Late"),e("th",{colspan:"2",class:"th"},"Actual Early"),e("th",{colspan:"2",class:"th"},"Remaining Early"),e("th",{rowspan:"2",class:"th"},"Working Hour"),e("th",{colspan:"4",class:"th"},"Leave Day"),e("th",{colspan:"2",class:"th"},"Short Leave"),e("th",{rowspan:"2",class:"th"},"OT Hour"),e("th",{colspan:"4",class:"th"},"Deduction"),e("th",{rowspan:"2",class:"th"},"Action")]),e("tr",{class:"bg-gray-50 text-xs"},[e("th",{class:"th"},"TD"),e("th",{class:"th"},"TP"),e("th",{class:"th"},"TW"),e("th",{class:"th"},"TL"),e("th",{class:"th"},"TA"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"Day"),e("th",{class:"th"},"Hour"),e("th",{class:"th"},"CL"),e("th",{class:"th"},"ML"),e("th",{class:"th"},"SL"),e("th",{class:"th"},"WPL"),e("th",{class:"th"},"Delay"),e("th",{class:"th"},"Early"),e("th",{class:"th"},"Absent Hour"),e("th",{class:"th"},"WPL(Hour)"),e("th",{class:"th"},"Pay Cut"),e("th",{class:"th"},"Payable Hour")])],-1)),e("tbody",ht,[(_(!0),p(J,null,G(x.value,(t,v)=>{var m,f;return _(),p("tr",{key:`${(t==null?void 0:t.user_id)||"u"}-${v}`,class:"border-b hover:bg-blue-50"},[e("td",yt,a(v+1),1),e("td",mt,a(t==null?void 0:t.user),1),e("td",vt,a(t==null?void 0:t.designation),1),e("td",ft,a(t==null?void 0:t.total_monthly_days),1),e("td",xt,a(t==null?void 0:t.total_present),1),e("td",bt,a(t==null?void 0:t.total_weekend),1),e("td",wt,a(t==null?void 0:t.total_leave),1),e("td",kt,a(t==null?void 0:t.total_absent),1),e("td",Ht,a(t==null?void 0:t.actual_late_day),1),e("td",Dt,a(t==null?void 0:t.actual_late_hour),1),e("td",At,a(t==null?void 0:t.total_remain_late_day),1),e("td",St,a(t==null?void 0:t.total_remain_late_hour),1),e("td",Ct,a(t==null?void 0:t.actual_early_day),1),e("td",Lt,a(t==null?void 0:t.actual_early_hour),1),e("td",Mt,a(t==null?void 0:t.total_remain_early_day),1),e("td",qt,a(t==null?void 0:t.total_remain_early_hour),1),e("td",{class:H(["td text-xs",{"!text-red-500":t==null?void 0:t.under_target}])},[e("div",{class:H(["font-semibold",t!=null&&t.under_target?"text-red-600":"text-green-600"])},a(t==null?void 0:t.total_working_hours),3),e("div",$t," of "+a(t==null?void 0:t.total_shift_hour),1)],2),e("td",Ft,a(t==null?void 0:t.total_cl_leave),1),e("td",Pt,a(t==null?void 0:t.total_ml_leave),1),e("td",Rt,a(t==null?void 0:t.total_sl_leave),1),e("td",Tt,a(t==null?void 0:t.total_wpl_leave),1),e("td",Et,[e("p",Nt,a((t==null?void 0:t.total_first_short_leave)||0)+" of "+a((t==null?void 0:t.actual_late_day)||0),1)]),e("td",Bt,[e("p",Vt,[$(a((t==null?void 0:t.total_last_short_leave)||0)+" of ",1),e("span",{class:H({"text-red-600 font-bold":(t==null?void 0:t.actual_early_day)>=4})},a((t==null?void 0:t.actual_early_day)||0),3)])]),e("td",It,a(t!=null&&t.total_overtime_hours?`${t==null?void 0:t.total_overtime_hours} H`:""),1),e("td",Ut,a(C(t==null?void 0:t.total_absent)*9)+"H",1),e("td",Wt,a(t==null?void 0:t.total_wpl_hour)+"H",1),e("td",jt,[e("div",zt,[w(et,{workingHours:(m=t==null?void 0:t.paycut)==null?void 0:m.paycut_hours},null,8,["workingHours"]),((f=k(y).user)==null?void 0:f.id)===8?(_(),q(Q,{key:0,class:"mr-2",userId:t==null?void 0:t.user_id,month:l.value,onUpdated:E},null,8,["userId","month"])):K("",!0)])]),e("td",Ot,a(t==null?void 0:t.payable_hour)+"H",1),e("td",Jt,[w(u,{to:{name:"EmployeeAttendance",query:{...k(r).query,employee_id:t==null?void 0:t.user_id,date:l.value}},target:"_blank",class:"inline-flex w-20 items-center gap-1 rounded-md px-1 py-1 font-medium bg-blue-50 text-blue-700 hover:bg-blue-100"},{default:X(()=>s[11]||(s[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M15 3h6v6"}),e("path",{d:"M10 14 21 3"}),e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"})],-1),$(" Job Card ")])),_:2,__:[11]},1032,["to"])])])}),128))]),e("tfoot",null,[e("tr",Gt,[s[12]||(s[12]=e("td",{colspan:"17",class:"td"},"Total",-1)),e("td",Kt,a(i.value.cl),1),e("td",Xt,a(i.value.ml),1),e("td",Yt,a(i.value.sl),1),e("td",Zt,a(i.value.wplDays),1),s[13]||(s[13]=e("td",{class:"td"},null,-1)),s[14]||(s[14]=e("td",{class:"td"},null,-1)),e("td",Qt,a(i.value.otHour),1),e("td",gt,a(i.value.absentDays)+" day",1),e("td",te,a(i.value.wplHour),1),e("td",ee,a(i.value.paycutHour),1),e("td",se,a(i.value.payableHour),1),s[15]||(s[15]=e("td",{class:"td"},null,-1))])])])])):(_(),p("div",it," Please select company "))])}}},me=tt(ae,[["__scopeId","data-v-20bd191e"]]);export{me as default};
