import{_ as fe,g as xe,D as ge,f as ve,u as be,G as he,r as te,x as c,q as G,h as _e,c as i,o as d,a as e,k as h,j as we,w as O,l as se,v as ne,t as l,n as g,d as R,m as F,b as N,F as oe,e as le,N as ae,s as ke}from"./index-BaTmg5Xu.js";import{_ as Ie}from"./EmployeeFilter-Dr5OIj-F.js";import{L as De}from"./LoaderView-Dtv7kKSK.js";import{U as Te}from"./UserChip-Dui7laEM.js";import{g as re,m as Oe,c as Ne,b as V,a as j}from"./datetime-Du_mcDA9.js";import{j as Me}from"./url-Buz9GlSr.js";import{u as Ee}from"./useTodoDateStore-O9z6ZFzA.js";import"./company-DfcuZ72T.js";import"./department-GFrF2TZl.js";import"./EmployeeDropdownInput-BOFDZ1IN.js";import"./SelectDropdown-Ci7Xaqd1.js";import"./user-DFQDlkfp.js";const Se={class:"container mx-auto print:w-full print:px-0 print:py-0"},Ce={class:"flex flex-wrap items-center gap-3 mb-4 bg-white border rounded-md px-4 py-3 print:border-0 print:rounded-none print:px-0 print:py-0"},Re={class:"ml-auto flex items-center gap-2 text-sm text-gray-600 print:hidden"},Pe={key:0,class:"relative h-[32px] flex gap-1 ml-auto justify-end print:hidden"},Le={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Ue={key:1,class:"text-gray-400"},Ae=["disabled"],Be={key:0,class:"bg-white border rounded-md p-4 mb-4 print:border-0 print:rounded-none print:p-0 shadow-sm"},Ge={class:"flex flex-wrap items-center gap-3"},Fe={class:"relative h-[32px] flex gap-1 ml-auto justify-end"},Ve={class:"relative h-[32px] flex"},je={key:0,class:"text-xs text-blue-600 flex items-center gap-2 w-full md:w-auto md:ml-auto"},$e={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md min-h-[60vh] flex flex-col items-center justify-center space-y-4"},qe={key:3,class:"space-y-4"},Ke={key:0,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none px-4 py-3 flex flex-wrap gap-4"},We={class:"text-sm text-gray-700"},ze={class:"font-semibold"},Qe={class:"text-sm text-gray-700"},Ye={class:"font-semibold"},He={class:"text-sm text-gray-700"},Je={class:"font-semibold text-green-600"},Xe={class:"text-sm text-gray-700"},Ze={class:"font-semibold text-blue-600"},et={class:"text-sm text-gray-700"},tt={class:"font-semibold text-amber-600"},st={key:1,class:"text-center text-gray-500 py-12 border bg-gray-50 rounded-md"},nt={class:"flex flex-wrap items-center gap-4 px-4 py-3 border-b bg-gray-50"},ot={key:0,class:"flex items-center gap-3"},lt={class:"font-semibold text-gray-800"},at=["href"],rt={class:"text-xs text-gray-500"},dt={class:"text-[11px] text-blue-800"},it={key:0,class:"font-bold"},ut={key:1,class:"flex items-center gap-3"},pt={class:"font-semibold text-gray-800"},mt={class:"text-xs text-gray-500"},ct={class:"text-[11px] text-blue-800"},yt={key:0,class:"font-bold"},ft={class:"flex items-center gap-2 ml-auto text-xs md:text-sm"},xt={class:"px-2 py-1 rounded-full bg-slate-100 text-gray-800 border border-slate-200"},gt={class:"px-2 py-1 rounded-full bg-green-50 text-green-700 border border-green-100"},vt={class:"px-2 py-1 rounded-full bg-blue-50 text-blue-700 border border-blue-100"},bt={class:"px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-100"},ht={class:"overflow-x-auto"},_t={class:"min-w-full text-left text-sm border-separate border-spacing-0"},wt={key:0},kt={class:"px-4 py-3 text-center border"},It={class:"px-4 py-3 border"},Dt={class:"font-semibold text-gray-800"},Tt={class:"text-xs text-gray-500"},Ot={class:"px-4 py-3 border text-xs text-gray-700"},Nt={class:"px-4 py-3 border text-center"},Mt={__name:"PersonalActivityReportView",props:{selfOnly:{type:Boolean,default:!1}},setup(P){const u=P,M=Ee(),de=xe(),{user:y}=ge(de),E=ve(),ie=be(),o=he({companyId:"",departmentId:"",employeeId:"",lineType:"all"}),r=te(""),$=te(null),D=c(()=>{if(!r.value)return"";const[s,t]=r.value.split("-").map(Number);return!s||!t?"":re(new Date(s,t-1,1))}),T=c(()=>{if(!r.value)return"";const[s,t]=r.value.split("-").map(Number);return!s||!t?"":re(Oe(new Date(s,t-1,1)))}),L=c(()=>r.value?Ne(`${r.value}-01`):""),I=c(()=>D.value&&T.value?`${V(D.value)} ~ ${V(T.value)}`:""),U=c(()=>{var s;return u.selfOnly?((s=y.value)==null?void 0:s.company_id)||"":o.companyId}),q=c(()=>!D.value||!T.value?!1:u.selfOnly?!!_.value&&!!U.value:!!U.value),K=c(()=>M.todo_dates||[]),_=c(()=>{var s;return(s=y.value)!=null&&s.id?String(y.value.id):""});function ue(s){o.companyId=s.company_id||"",o.departmentId=s.department_id||"",o.employeeId=u.selfOnly?_.value:s.employee_id||"",o.lineType=s.line_type||"all"}function pe(s){return s==="COMPLETED"?"bg-green-100 text-green-700 border border-green-200":s==="WORKING"?"bg-blue-100 text-blue-700 border border-blue-200":s==="PENDING"?"bg-yellow-100 text-yellow-700 border border-yellow-200":"bg-gray-100 text-gray-700 border border-gray-200"}function W(s){var t,n;return s.todo_id||s.todoId||((t=s.todo)==null?void 0:t.id)||((n=s.todo)==null?void 0:n.todo_id)||s.id||`${s.title}-${s.date}`}const z=c(()=>{var f;if(u.selfOnly&&y.value)return[y.value];const s=((f=$.value)==null?void 0:f.employees)||[];if(s.length)return s;const t=[],n=new Set;return K.value.forEach(x=>{const v=x.user;if(!v||!v.id)return;const a=String(v.id);n.has(a)||(n.add(a),t.push(v))}),t}),me=c(()=>o.employeeId?z.value.filter(s=>String(s.id)===String(o.employeeId)):z.value),S=c(()=>me.value.map(s=>{const t=K.value.filter(a=>{var m;return String(((m=a.user)==null?void 0:m.id)??a.user_id)===String(s.id)}),n={};for(const a of t){const m=W(a),b=n[m],k=new Date(a.date),w=b?new Date(b.date):null;(!b||w&&k>w)&&(n[m]=a)}const f={WORKING:1,PENDING:2,DEPENDANT:3,COMPLETED:4,BACK_LOG:5},x=Object.values(n).sort((a,m)=>{const b=new Date(a.date).getTime(),k=new Date(m.date).getTime();if(b!==k)return k-b;const w=f[a.status]||999,p=f[m.status]||999;return w!==p?w-p:(a.priority||0)-(m.priority||0)}),v={total:x.length,completed:x.filter(a=>a.status==="COMPLETED").length,working:x.filter(a=>a.status==="WORKING").length,pending:x.filter(a=>a.status==="PENDING").length};return{user:s,latestTodos:x,totals:v}}).sort((s,t)=>{var n,f;return(((n=s.user)==null?void 0:n.name)||"").localeCompare(((f=t.user)==null?void 0:f.name)||"")})),C=c(()=>S.value.reduce((s,t)=>({totalTodos:s.totalTodos+t.totals.total,completed:s.completed+t.totals.completed,working:s.working+t.totals.working,pending:s.pending+t.totals.pending}),{totalTodos:0,completed:0,working:0,pending:0}));function Q(){console.log("syncQuery",o),ie.replace({query:{...E.query,month:r.value||void 0,...u.selfOnly?{}:{company_id:o.companyId||void 0,department_id:o.departmentId||void 0,employee_id:o.employeeId||void 0,line_type:o.lineType||void 0}}})}async function A(){q.value&&await M.fetchTodoDates({"company-id":U.value||void 0,"department-id":u.selfOnly?void 0:o.departmentId,"employee-id":u.selfOnly?_.value:o.employeeId,"line-type":u.selfOnly?void 0:o.lineType,"start-date":D.value,"end-date":T.value})}function B(){u.selfOnly&&_.value&&(o.employeeId=_.value)}function Y(){const s=E.query||{};r.value=typeof s.month=="string"&&s.month?s.month:r.value||j(new Date),o.companyId=u.selfOnly?"":s.company_id||"",o.departmentId=u.selfOnly?"":s.department_id||"",o.employeeId=u.selfOnly?_.value:s.employee_id||"",o.lineType=u.selfOnly?"all":s.line_type||"all",B()}G(()=>[o.companyId,o.departmentId,o.employeeId,o.lineType,D.value,T.value,r.value],()=>{B(),Q(),A()}),G(()=>E.query,()=>{Y()}),G(_,()=>{B(),Q(),A()}),_e(()=>{r.value=r.value||j(new Date),Y(),A()});function ce(){window.print()}function H(s){const t=r.value?new Date(`${r.value}-01`):new Date;t.setMonth(t.getMonth()+s),r.value=j(t)}function J(){H(-1)}function X(){H(1)}return(s,t)=>(d(),i("div",Se,[e("div",Ce,[t[11]||(t[11]=e("div",null,[e("h1",{class:"text-xl font-semibold text-gray-800"},"Personal Activity Report"),e("p",{class:"text-sm text-gray-500"},"Monthwise summary from todo dates")],-1)),e("span",Re,[u.selfOnly?(d(),i("div",Pe,[e("button",{class:"btn-3 h-[32px] px-3",onClick:O(J,["prevent"])},t[6]||(t[6]=[e("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),e("div",Le,[t[7]||(t[7]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),se(e("input",{id:"month",type:"month","onUpdate:modelValue":t[0]||(t[0]=n=>r.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ne,r.value]])]),e("button",{class:"btn-3 h-[32px] px-3",onClick:O(X,["prevent"])},t[8]||(t[8]=[e("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])):h("",!0),t[9]||(t[9]=e("i",{class:"far fa-calendar-alt text-blue-500"},null,-1)),e("span",null,l(L.value),1),I.value?(d(),i("span",Ue,"("+l(I.value)+")",1)):h("",!0)]),e("button",{type:"button",class:"btn-icon print-hide ml-2",onClick:O(ce,["prevent"]),disabled:g(M).loading,title:"Print"},t[10]||(t[10]=[e("i",{class:"fas fa-print"},null,-1)]),8,Ae)]),u.selfOnly?h("",!0):(d(),i("div",Be,[e("div",Ge,[R(Ie,{ref_key:"employeeFilterRef",ref:$,company_id:o.companyId,"onUpdate:company_id":t[2]||(t[2]=n=>o.companyId=n),department_id:o.departmentId,"onUpdate:department_id":t[3]||(t[3]=n=>o.departmentId=n),employee_id:o.employeeId,"onUpdate:employee_id":t[4]||(t[4]=n=>o.employeeId=n),line_type:o.lineType,"onUpdate:line_type":t[5]||(t[5]=n=>o.lineType=n),"initial-value":g(E).query,onFilterChange:ue,class:"flex-1 min-w-[240px]"},{default:F(()=>[e("div",Fe,[e("button",{class:"btn-3 h-[32px] px-3",onClick:O(J,["prevent"])},t[12]||(t[12]=[e("i",{class:"fas fa-arrow-left mr-1"},null,-1)])),e("div",Ve,[t[13]||(t[13]=e("label",{for:"month",class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"},"Month",-1)),se(e("input",{id:"month",type:"month","onUpdate:modelValue":t[1]||(t[1]=n=>r.value=n),class:"border-2 border-gray-300 rounded px-3 h-[32px] text-sm w-full bg-white"},null,512),[[ne,r.value]])]),e("button",{class:"btn-3 h-[32px] px-3",onClick:O(X,["prevent"])},t[14]||(t[14]=[e("i",{class:"fas fa-arrow-right ml-1"},null,-1)]))])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),u.selfOnly?(d(),i("div",je,[t[15]||(t[15]=e("i",{class:"fas fa-user-lock"},null,-1)),N(" Showing only my todos (Employee ID: "+l(_.value||"loading...")+") ",1)])):h("",!0)])])),q.value?g(M).loading?(d(),we(De,{key:2},{default:F(()=>t[17]||(t[17]=[N("Loading report...")])),_:1,__:[17]})):(d(),i("div",qe,[P.selfOnly?h("",!0):(d(),i("div",Ke,[e("div",We,[t[18]||(t[18]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Employees",-1)),e("div",ze,l(S.value.length),1)]),e("div",Qe,[t[19]||(t[19]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Todos (latest in month)",-1)),e("div",Ye,l(C.value.totalTodos),1)]),e("div",He,[t[20]||(t[20]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Completed",-1)),e("div",Je,l(C.value.completed),1)]),e("div",Xe,[t[21]||(t[21]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Working",-1)),e("div",Ze,l(C.value.working),1)]),e("div",et,[t[22]||(t[22]=e("div",{class:"text-xs uppercase tracking-wide text-gray-500"},"Pending",-1)),e("div",tt,l(C.value.pending),1)])])),S.value.length===0?(d(),i("div",st," No data available for the selected month. ")):h("",!0),(d(!0),i(oe,null,le(S.value,(n,f)=>{var x,v,a,m,b,k,w;return d(),i("div",{key:((x=n.user)==null?void 0:x.id)||f,class:"bg-white border rounded-md shadow-sm print:shadow-none print:border-0 print:rounded-none"},[e("div",nt,[P.selfOnly?(d(),i("div",ut,[R(ae,{user:g(y),size:"medium"},null,8,["user"]),e("div",null,[e("div",pt,l(((b=g(y))==null?void 0:b.name)||"Unknown user"),1),e("div",mt,l(((w=(k=g(y))==null?void 0:k.department)==null?void 0:w.name)||"-"),1),e("div",ct,[N(" Month: "+l(L.value)+" ",1),I.value?(d(),i("span",yt,"("+l(I.value)+")",1)):h("",!0)])])])):(d(),i("div",ot,[R(Te,{user:n.user},{trigger:F(({user:p})=>[R(ae,{user:p,size:"medium"},null,8,["user"])]),_:2},1032,["user"]),e("div",null,[e("div",lt,[e("a",{href:g(Me)(n.user,r.value),target:"_blank",rel:"noopener",class:"inline-flex hover:underline"},[e("div",null,[N(l(((v=g(y))==null?void 0:v.name)||"Unknown user")+" ",1),t[23]||(t[23]=e("i",{class:"far fa-external-link-alt print:hidden"},null,-1))])],8,at)]),e("div",rt,l(((m=(a=g(y))==null?void 0:a.department)==null?void 0:m.name)||"-"),1),e("div",dt,[N(" Month: "+l(L.value)+" ",1),I.value?(d(),i("span",it,"("+l(I.value)+")",1)):h("",!0)])])])),e("div",ft,[e("span",xt," Total "+l(n.totals.total),1),e("span",gt," Done "+l(n.totals.completed),1),e("span",vt," Working "+l(n.totals.working),1),e("span",bt," Pending "+l(n.totals.pending),1)])]),e("div",ht,[e("table",_t,[t[25]||(t[25]=e("thead",{class:"bg-gray-50 text-gray-600 uppercase tracking-wide text-xs"},[e("tr",{class:"border-b"},[e("th",{class:"px-4 py-3 border text-center w-12"},"sl"),e("th",{class:"px-4 py-3 border text-left"},"Todo"),e("th",{class:"px-4 py-3 border text-left"},"Last Activity"),e("th",{class:"px-4 py-3 border text-center"},"Status")])],-1)),e("tbody",null,[n.latestTodos.length===0?(d(),i("tr",wt,t[24]||(t[24]=[e("td",{colspan:"5",class:"px-4 py-6 text-center text-gray-400 border rounded-b"}," No activity recorded for this month. ",-1)]))):h("",!0),(d(!0),i(oe,null,le(n.latestTodos,(p,ye)=>{var Z,ee;return d(),i("tr",{key:W(p),class:"border-b"},[e("td",kt,l(ye+1),1),e("td",It,[e("div",Dt,l(p.title),1),e("div",Tt,l(((ee=(Z=p.todo)==null?void 0:Z.todoable)==null?void 0:ee.title)||""),1)]),e("td",Ot,l(g(V)(p.date)||p.date),1),e("td",Nt,[e("div",{class:ke(["inline-block text-xs font-semibold px-2.5 py-1 rounded-full whitespace-nowrap",pe(p.status)])},l(p.status==="WORKING"?"IN PROGRESS":p.status||"N/A"),3)])])}),128))])])])])}),128))])):(d(),i("div",$e,t[16]||(t[16]=[e("i",{class:"fad fa-tasks text-4xl"},null,-1),e("div",{class:"empty-state glass-panel"},[e("p",{class:"text-base font-semibold text-rose-500"},"Select company and month to view PAR."),e("p",{class:"text-sm text-gray-500"},"Use the filter set above to load records.")],-1)])))]))}},jt=fe(Mt,[["__scopeId","data-v-e4b2b104"]]);export{jt as default};
