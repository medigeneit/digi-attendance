import{c as l,o as r,F as L,x as A,m as w,p as T,I as Z,G as ne,q as b,f,y,a as t,z as le,n as h,t as g,T as ae,l as v,B as Q,k as ee,b as oe,r as W,A as ie,w as C,h as $}from"./index-CCxDPQYa.js";import{g as X}from"./datetime-q3Sn87-f.js";import{_ as Y}from"./UserChip-C8IYH6aL.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"mt-3"},ue={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick","employeeAssignClick"],setup(e,{emit:a}){const n=a;return(d,o)=>(r(),l("div",de,[(r(!0),l(L,null,A(e.childrenTasks,(u,x)=>(r(),w(ot,{key:u.id,index:x,task:u,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:o[0]||(o[0]=c=>n("editClick",c)),onAddClick:o[1]||(o[1]=c=>n("addClick",c)),onEmployeeAssignClick:o[2]||(o[2]=c=>n("employeeAssignClick",c))},{"item-end":T(({task:c,level:m})=>[Z(d.$slots,"treeItemEnd",{task:c,level:m})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},ce=ne({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:a}){const n=e,d=b(function(){return n.task.completed_count}),o=b(()=>n.task.children_task_count===0?n.task.status==="COMPLETED"?100:0:d.value/n.task.children_task_count*100),u=b(()=>{const x=o.value;let c,m,k;return x===100?(c="bg-green-50",m="bg-green-200",k="text-green-600 "):x<100&&(c="bg-red-50",m="bg-red-200",k="text-red-600 "),{container:c,bar:m,text:k}});return a({completedPercentage:o.value,completedSubTaskCount:d.value}),(x,c)=>(r(),l("div",null,[x.task.children_task_count>0?(r(),l("div",{key:0,class:y(["rounded-full border py-0.5 relative overflow-hidden h-6",u.value.container]),style:{width:"180px"}},[t("div",{class:y(["z-10 absolute top-0 bottom-0",u.value.bar]),style:le(`width: ${o.value}%`)},null,6),t("span",{class:y(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",u.value.text])},[t("span",null,[t("span",null,g(d.value),1),c[0]||(c[0]=h(" / ")),t("span",null,g(x.task.children_task_count),1)])],2)],2)):f("",!0)]))}}),ke={key:0},fe={__name:"TaskStatus",props:{status:{type:String,required:!0},progressPercent:{type:Number,required:!0}},setup(e){const a=e,n=b(()=>{switch(a.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),d=b(()=>{switch(a.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(o,u)=>(r(),l("div",{class:y(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",n.value])},[t("i",{class:y(d.value)},null,2),t("span",null,g(e.status),1),e.progressPercent!==null||e.progressPercent!==void 0?(r(),l("span",ke,g(e.progressPercent)+"% ",1)):f("",!0)],2))}};function ge(e){return Object.entries(e).map(a=>`${a[0]}=${a[1]}`).join("&")}const me={class:"relative"},xe={key:0,class:"text-gray-500 text-xs"},be={key:2,class:"text-sm text-gray-500 group/users"},ye={class:"cursor-pointer hover:underline text-blue-600"},pe={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg z-30"},he={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:()=>null},isTargetTask:{Boolean,default:!1}},setup(e){const a=e,n=b(()=>a.users.slice(0,2)),d=b(()=>a.users.slice(2));function o(x){if(typeof a.routeTo=="function")return a.routeTo(x)}const u=b(()=>typeof a.routeTo=="function"?ae:"div");return(x,c)=>(r(),l("div",me,[a.users.length===0?(r(),l("div",xe,"Not Assigned To Anyone")):(r(!0),l(L,{key:1},A(n.value,(m,k)=>(r(),w(Q(u.value),{key:k,to:o(m)},{default:T(()=>[v(Y,{class:y(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask}]),user:m},null,8,["class","user"])]),_:2},1032,["to"]))),128)),d.value.length>0?(r(),l("div",be,[t("div",ye," + "+g(d.value.length)+" more users ",1),t("div",pe,[(r(!0),l(L,null,A(d.value,(m,k)=>(r(),w(Q(u.value),{key:k,to:o(m),class:"w-full block mb-2"},{default:T(()=>[v(Y,{class:y(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:m},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):f("",!0)]))}},ve={},we={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function Te(e,a){return r(),l("span",we,"IMPORTANT")}const _e=te(ve,[["render",Te]]),Ce={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(a,n)=>{const d=ee("RouterLink");return r(),w(d,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:T(()=>[t("div",null,g(e.task.title),1)]),_:1},8,["to"])}}},$e={},Le={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function Se(e,a){return r(),l("span",Le,"URGENT")}const Ae=te($e,[["render",Se]]),Ee={class:"flex w-full"},Ne={key:0,class:"border-l border-gray-200 last:border-l-0"},Be={class:"items-start grid grid-cols-4 gap-4 group"},Pe={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},Re={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},De={key:0,class:"text-xl font-semibold text-sky-500"},qe={key:1,class:"text-sm text-gray-500 mt-2"},je={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Ie={class:"flex items-center gap-6 flex-none lg:w-full order-0 lg:order-1"},Oe={class:"flex gap-4 items-center"},Me={class:"text-gray-500 text-sm"},ze={class:"text-red-500 text-sm"},Ue={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ge={class:"col-span-full flex items-center my-2 lg:my-0 justify-center flex-wrap gap-x-3 gap-y-2"},Ve={class:"text-xs px-2 py-0.5 rounded-full border bg-sky-500 text-white"},Fe={class:"text-xs px-2 py-0.5 rounded-full border bg-blue-500 text-white"},He=["href"],Je={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4"},Ke={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Qe={key:1,class:"text-gray-500"},We={class:"font-semibold text-green-800"},Xe={key:2,class:"ml-4 text-gray-500"},Ye={class:"text-red-500 font-semibold"},Ze={class:"mt-4 col-span-full"},et={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},tt={class:"text-xs text-gray-500 flex gap-3 order-1 sm:order-0"},st=["href"],rt={class:"flex items-center sm:ml-auto order-0 sm:order-1"},nt={key:0,class:"flex gap-2 ml-4 items-center text-xs"},lt=["href"],at={class:"ml-0"},ot={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(e,{emit:a}){const n=e,d=oe(),o=W(null),u=a;function x(i){u("addClick",i)}function c(i){u("editClick",i)}function m(i){u("employeeAssignClick",i)}const k=W([]),E=localStorage.getItem("sub_task_opened_list");if(E)try{k.value=JSON.parse(E)}catch{k.value=[]}const N=b(()=>X(n.task.started_at)),B=b(()=>X(n.task.deadline)),_=b({get:()=>k.value.includes(n.task.id),set:i=>{const s=k.value.includes(n.task.id);i&&!s?k.value.push(n.task.id):!i&&s&&(k.value=k.value.filter(S=>S!==n.task.id))}});ie(k,i=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(i))},{deep:!0});const P=b(()=>{var i,s;return((s=(i=n.task)==null?void 0:i.children_tasks)==null?void 0:s.length)>0});function se(){n.task.children_tasks.length>0&&(_.value=!_.value)}return(i,s)=>{var R,D,q,j,I,O,M,z,U,G,V,F,H,J,K;const S=ee("RouterLink");return r(),l("div",Ee,[e.treeLevel>0?(r(),l("div",Ne,s[4]||(s[4]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):f("",!0),t("div",{class:y(["flex-grow border-2 rounded py-3 px-3",{"bg-green-100  ":((R=o.value)==null?void 0:R.completedPercentage)===100,"bg-white hover:bg-gray-50":((D=o.value)==null?void 0:D.completedPercentage)<100,"shadow-sm":e.treeLevel>0,"border-sky-500":e.index%2===0,"border-pink-300":e.index%2===1}])},[t("div",Be,[t("div",Pe,[t("div",Re,[e.index!==void 0?(r(),l("div",De,g(e.index+1)+". ",1)):f("",!0),v(Ce,{task:e.task},null,8,["task"]),(q=e.task)!=null&&q.requirement?(r(),l("p",qe," Requirement: "+g((I=(j=e.task)==null?void 0:j.requirement)==null?void 0:I.title),1)):f("",!0)]),t("div",je,[v(fe,{status:(O=e.task)==null?void 0:O.status,progressPercent:((M=e.task)==null?void 0:M.progress_percent)||0},null,8,["status","progressPercent"]),v(ce,{task:e.task,ref_key:"progress",ref:o,class:"text-sm"},null,8,["task"])]),t("div",Ie,[t("div",Oe,[e.showDraggableHandle?(r(),l("button",{key:0,onMousedown:s[0]||(s[0]=C((...p)=>i.handleDragging&&i.handleDragging(...p),["stop"])),class:"handle"},s[5]||(s[5]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):f("",!0),t("span",Me," #"+g(e.task.id),1),t("div",ze,g(e.treeLevel),1)]),t("div",Ue,[(z=e.task)!=null&&z.is_important?(r(),w(_e,{key:0})):f("",!0),(U=e.task)!=null&&U.is_urgent?(r(),w(Ae,{key:1})):f("",!0)])])]),t("div",Ge,[e.treeLevel===0?(r(),l(L,{key:0},[t("div",Ve,g(((V=(G=e.task)==null?void 0:G.from_department)==null?void 0:V.name)||"--"),1),s[6]||(s[6]=t("span",{class:"text-2xl text-gray-400"},"â‡’",-1)),t("div",Fe,g(((H=(F=e.task)==null?void 0:F.to_department)==null?void 0:H.name)||"--"),1)],64)):f("",!0),v(he,{class:"flex items-center justify-center flex-wrap gap-x-3",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:p=>({query:{...$(d).query,view:"userwise","company-id":p.company_id,"user-ids":p.id}})},null,8,["users","isTargetTask","routeTo"]),t("a",{href:`/tasks/${e.task.id}/assign-users`,onClick:s[1]||(s[1]=C(p=>u("employeeAssignClick",e.task.id),["stop","prevent"])),class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},s[7]||(s[7]=[t("i",{class:"fas fa-users-cog"},null,-1),h(" Manage Employee ")]),8,He)])]),t("div",Je,[e.task.is_target?(r(),l("div",Ke," TARGET TASK ")):f("",!0),N.value?(r(),l("span",Qe,[s[8]||(s[8]=h(" Started: ")),t("span",We,g(N.value),1)])):f("",!0),B.value?(r(),l("span",Xe,[s[9]||(s[9]=h(" Deadline: ")),t("span",Ye,g(B.value),1)])):f("",!0)]),t("div",Ze,[t("div",et,[t("div",tt,[t("button",{class:y([{"text-yellow-600 font-semibold  inline-block  ":P.value},"flex items-center gap-1 group"]),onClick:se},[t("i",{class:y([_.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:y(P.value?"group-hover:underline":"")}," Sub Tasks ("+g((J=e.task.children_tasks)==null?void 0:J.length)+") ",3)],2),e.treeLevel<2?(r(),l("a",{key:0,href:`/tasks/add?parent_id=${n.task.id}&back-to=${encodeURIComponent($(d).path+"?"+$(ge)($(d).query)).toLowerCase()}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:s[2]||(s[2]=C(p=>u("addClick",n.task.id),["stop","prevent"]))},s[10]||(s[10]=[t("i",{class:"fas fa-plus"},null,-1),h(" Add Sub Task ")]),8,st)):f("",!0)]),t("div",rt,[e.hideButtons?f("",!0):(r(),l("div",nt,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:s[3]||(s[3]=C(p=>u("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},s[11]||(s[11]=[t("i",{class:"fas fa-edit"},null,-1),h(" Edit ")]),8,lt),v(S,{to:{name:"TaskReports",params:{id:(K=e.task)==null?void 0:K.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:T(()=>s[12]||(s[12]=[t("i",{class:"far fa-file-alt"},null,-1),h(" Reports ")])),_:1,__:[12]},8,["to"])]))])]),t("div",at,[_.value?(r(),w(ue,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:c,onAddClick:x,onEmployeeAssignClick:m},{"tree-item-end":T(({task:p,level:re})=>[Z(i.$slots,"item-end",{level:re,task:p})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):f("",!0)])])],2)])}}};export{ot as _,fe as a,ce as b};
