import{_ as J}from"./CommentModal-BfwWvxPR.js";import{u as K,O as S,_ as Q}from"./task-priority-CbV4NzVT.js";import{L as X}from"./LoaderView-BewLDnTE.js";import{_ as Y}from"./TaskAddForm-BQZ3t_q2.js";import{_ as Z}from"./TaskEditForm-BBuJrtaf.js";import{_ as ee,a as te}from"./UserWiseList-6h0zxnmg.js";import{_ as se}from"./TaskTreeView-YYh06Sha.js";import{u as ae}from"./useTaskStore-DTMBCkNR.js";import{b as re,u as oe,r as d,D as ne,e as le,A as ie,q as ue,k as de,c as i,o as r,m as v,f as q,l as u,a as b,p,h as t,F as R,x as me,t as j,n as E,y as H}from"./index-DzVbUzHk.js";import"./useCommentStore-B1YTYxTM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRequirementStore-CpONyu3C.js";import"./SectionLoading-Ct1QQAHQ.js";import"./MultiselectDropdown-BgIGnXNc.js";import"./vue-multiselect.esm-FYIE6YOs.js";import"./company-DGvmct0b.js";import"./UserChip-RaIxS1Zx.js";const ce={class:"container mx-auto p-6 relative"},ye={class:"mb-4"},ke={class:"w-full flex justify-end gap-5 mb-1"},pe={key:3},fe={key:0,class:"text-center py-4 text-red-500"},ve={key:1},_e={class:"flex items-stretched"},ge={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},we=1,Re={__name:"TaskListNew",setup(qe){const n=ae(),a=re(),x=oe(),_=d(!1),g=d(null),C=d(!1),m=d(null),f=d(!1),c=ne({parentId:0,requirementId:0}),I=d(null),T=d([]),{handleItemsPriorityUpdate:M,saveTaskPriority:O,listHasRearranged:h}=K(()=>n.taskListTree,0);le(async()=>{a.query.status||x.push({query:{...a.query,status:"not-completed"}}),await y()});async function y(){C.value=!!a.query["user-ids"];const o=await n.fetchTasks({...a.query},{newList:!0,loadingBeforeFetch:!0});T.value=o.query_log||[]}const w=o=>{f.value=!0,c.parentId=o},L=o=>{g.value=o,_.value=!0},W=()=>{_.value=!1,g.value=null};async function U(){m.value=null,f.value=!1,c.parentId=0,await y()}async function z(){f.value=!1,c.parentId=0,await y()}async function G(){O()&&await y()}ie(()=>({...a.query}),async()=>await y());const V=ue({get(){return{...a.query}},set(o){x.push({query:{...o}})}});return(o,e)=>{var B,D,A,F,N,P;const $=de("RouterLink");return r(),i("div",ce,[m.value?(r(),v(S,{key:0},{default:p(()=>[u(Z,{taskId:m.value,class:"rounded-full",onClose:e[0]||(e[0]=s=>m.value=null),onUpdated:U},null,8,["taskId"])]),_:1})):q("",!0),f.value?(r(),v(S,{key:1},{default:p(()=>[u(Y,{parentTaskId:c.parentId,requirementId:c.requirementId,class:"rounded-full",onClose:z,onTaskCreated:U},null,8,["parentTaskId","requirementId"])]),_:1})):q("",!0),u(ee,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s),onClickAddTask:w,onClickPrioritySave:G,onClickPriorityDiscard:e[2]||(e[2]=()=>t(h)?I.value.resetItems:null),"list-has-rearranged":t(h),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((D=(B=t(a))==null?void 0:B.query)==null?void 0:D["query-log"])=="true"?(r(!0),i(R,{key:2},me(T.value,(s,l)=>(r(),i("div",{key:l,class:"text-xs text-gray-500"},[b("div",ye,j(s.raw_query),1)]))),128)):q("",!0),b("div",ke,[u($,{class:H(["text-sm btn-3 py-0.5",((A=t(a).query)==null?void 0:A.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...t(a).query,view:"userwise"}}},{default:p(()=>e[9]||(e[9]=[E(" User Wise List ")])),_:1,__:[9]},8,["class","to"]),u($,{class:H(["text-sm btn-3 py-0.5",((F=t(a).query)==null?void 0:F.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((N=t(a))==null?void 0:N.query)||{}).filter(s=>{var l;return((l=t(a))==null?void 0:l.query[s])!=="userwise"}).reduce((s,l)=>({...s,[l]:t(a).query[l]}),{})}}},{default:p(()=>e[10]||(e[10]=[E(" TaskWise List ")])),_:1,__:[10]},8,["class","to"])]),t(n).loading?(r(),i("div",pe,[u(X)])):(r(),i(R,{key:4},[t(n).error?(r(),i("div",fe,j(t(n).error),1)):t(n).tasks.length>0?(r(),i("div",ve,[((P=t(a).query)==null?void 0:P.view)=="userwise"?(r(),v(te,{key:0,tasks:t(n).tasks,selectedUserId:t(a).query["user-ids"],onCommentButtonClick:e[3]||(e[3]=s=>L(s,o.task.id)),onEditClick:e[4]||(e[4]=s=>m.value=s),onAddClick:e[5]||(e[5]=s=>w(s))},null,8,["tasks","selectedUserId"])):(r(),v(Q,{key:1,items:t(n).tasks,handle:"handle",onItemsUpdate:t(M),class:"space-y-4",ref_key:"draggableTaskList",ref:I},{item:p(({item:s,index:l})=>[b("div",_e,[u(se,{task:s,index:l,showDraggableHandle:!C.value,onCommentButtonClick:e[6]||(e[6]=k=>L(k,o.task.id)),onEditClick:e[7]||(e[7]=k=>m.value=k),onAddClick:e[8]||(e[8]=k=>w(k)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(r(),i("div",ge," No tasks found. "))],64)),u(J,{show:_.value,"commentable-id":g.value,"commentable-type":"task","user-id":we,"on-close":W,onSubmitted:t(n).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Re as default};
