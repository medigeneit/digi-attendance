import{B as T,r as p,C as m}from"./index-BEIG8OVJ.js";const Y=T("attendance",()=>{const g=p([]),w=p([]),h=p([]),v=p([]),f=p([]),b=p(null),S=p(null),D=p(new Date().toISOString().substring(0,7)),L=p(new Date().toISOString().substring(0,10)),t=p(null),d=p(!1),R=async(o,l)=>{const e=_(l);return g.value.find(a=>a.date===e)},_=o=>{const l=new Date(o),e=String(l.getDate()).padStart(2,"0"),a=l.toLocaleString("en-US",{month:"short"}),n=l.getFullYear();return`${e} ${a} ${n}`},$=async(o,l)=>{var e,a;if(!o||!l){t.value="Invalid user ID or month";return}d.value=!0;try{const n=await m.get(`/user/${o}/attendance/monthly/${l}/log`);w.value=n.data.attendance_logs}catch(n){t.value=((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},x=async(o,l,e,a,n)=>{var r,s;if(!e||!o||!l){t.value="Company, Start Date, and End Date are required";return}d.value=!0;try{return(await m.get("/attendance/date-range-summary",{params:{company_id:e,line_type:a||"all",start_date:o,end_date:l,employee_id:n||void 0}})).data}catch(c){return t.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(t.value),null}finally{d.value=!1}},C=async(o,l,e,a="all",n=null)=>{var u;if(!e||!o||!l){t.value="Company, Start Date, and End Date are required";return}const r=(u=m.defaults.baseURL)==null?void 0:u.replace(/\/$/,"");let s=`flag=excel&company_id=${e}&start_date=${o}&end_date=${l}`;n&&(s+=`&employee_id=${n}`),a&&(s+=`&line_type=${a}`);const c=`${r}/attendance/date-range-summary?${s}`;console.log("ðŸ“ Opening Excel Download URL:",c),window.open(c,"_blank")},E=(o,l,e,a,n=null,r="")=>{if(!e||!o||!l){t.value="Company, Start Date, and End Date are required";return}const s=new URLSearchParams({flag:"pdf",company_id:e,line_type:a,start_date:o,end_date:l});n&&s.append("employee_id",n),r&&s.append("category",r);const c=`/attendance/date-range-summary?${s.toString()}`;window.open(c,"_blank")},U=async(o,l)=>{var e,a;if(!o||!l){t.value="Invalid user ID or month";return}d.value=!0;try{const n=await m.get(`/user/${o}/attendance/monthly/${l}`);g.value=n.data.monthly_logs,b.value=n.data.summary,t.value=null}catch(n){t.value=((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},A=async(o={})=>{var l,e;d.value=!0;try{const a=await m.get("/attendance/today",{params:o});h.value=a.data,t.value=null}catch(a){t.value=((e=(l=a.response)==null?void 0:l.data)==null?void 0:e.message)||"Something went wrong",console.error("[Attendance Error]",t.value)}finally{d.value=!1}},k=async(o,l=null,e=null,a=null,n,r)=>{var s,c;d.value=!0;try{const u={company_id:o,department_id:l,category:e,employee_id:a,type:r,...r==="daily"?{date:n}:{month:n}},i=await m.get("/monthly/attendance/late-reports",{params:u});r==="daily"?v.value=i.data:r==="monthly"&&(f.value=i.data),t.value=null}catch(u){t.value=((c=(s=u.response)==null?void 0:s.data)==null?void 0:c.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},B=async(o,l=null,e=null,a=null,n,r)=>{var s,c;d.value=!0;try{const u={company_id:o,department_id:l,line_type:e,employee_id:a,type:r,...r==="daily"?{date:n}:{month:n}},i=await m.get("/attendance/late-reports",{params:u});r==="daily"?v.value=i.data:r==="monthly"&&(f.value=i.data),t.value=null}catch(u){t.value=((c=(s=u.response)==null?void 0:s.data)==null?void 0:c.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},O=async(o,l,e,a)=>{var n,r;if(!o||!a){t.value="Company & month are required";return}d.value=!0;try{const s={month:a},c=await m.post("/attendance/monthly-snapshot/recalculate",s);t.value=null}catch(s){t.value=((r=(n=s.response)==null?void 0:n.data)==null?void 0:r.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},M=async(o,l,e,a,n="finalize")=>{var r,s;if(!o||!a){t.value="Company & month are required";return}d.value=!0;try{const c={company_id:o,line_type:l,employee_id:e,month:a,action:n},u=await m.post("/attendance/monthly-snapshot/finalize",c);t.value=null}catch(c){t.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}};return{monthlyLogs:g,dailyLateLogs:v,monthlyLateLogs:f,summary:b,monthly_company_summary:S,selectedMonth:D,selectedDate:L,error:t,isLoading:d,dailyLogs:h,attendanceLogs:w,getUserDailyLogsByDate:R,getMonthlyAttendanceByShift:U,getTodayAttendanceReport:A,getAttendanceLateReport:k,getMonthlyAttendanceSummaryReport:O,downloadExcel:async(o,l,e)=>{var a,n;if(!o||!e){t.value="Invalid company ID or month";return}d.value=!0;try{const r={company_id:o,line_type:l,month:e},s=await m.get("/attendance/monthly-summary-reports?flag=excel",{params:r,responseType:"blob"}),c=window.URL.createObjectURL(new Blob([s.data])),u=document.createElement("a");u.href=c,u.setAttribute("download",`${e} attendance_summary.xlsx`),document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(r){t.value=((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},downloadPDF:async(o,l,e,a=0)=>{var n,r;if(!o||!e){t.value="Invalid user ID or month";return}d.value=!0;try{const s={company_id:o,category:l,month:e},c=await m.get("/attendance/monthly-summary-reports?flag=pdf",{params:s,responseType:"blob"}),u=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=u,i.setAttribute("download",`${e} attendance_summary.pdf`),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(s){t.value=((r=(n=s.response)==null?void 0:n.data)==null?void 0:r.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},attendanceDownloadExcel:async(o,l,e,a,n)=>{var r,s;d.value=!0;try{const c={companyId:o,employee_id:l,line_type:e,month:a,status:n},u=await m.get("/attendance/today?flag=excel",{params:c,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([u.data])),y=document.createElement("a");y.href=i,y.setAttribute("download",`${a} attendance_summary.xlsx`),document.body.appendChild(y),y.click(),document.body.removeChild(y)}catch(c){t.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},attendanceDownloadPdf:async(o,l,e,a,n)=>{var r,s;d.value=!0;try{const c={companyId:o,employee_id:l,category:e,month:a,status:n},u=await m.get("/attendance/today?flag=pdf",{params:c,responseType:"blob"}),i=window.URL.createObjectURL(new Blob([u.data])),y=document.createElement("a");y.href=i,y.setAttribute("download",`${a} attendance_summary.pdf`),document.body.appendChild(y),y.click(),document.body.removeChild(y)}catch(c){t.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},lateReportDownloadExcel:async(o,l,e,a)=>{var n,r;if(!o){t.value="Invalid company ID or date/month";return}d.value=!0;try{const s={company_id:o,...l?{employee_id:l}:{},type:a,...a==="daily"?{date:e}:{month:e}},c=await m.get("/monthly/attendance/late-reports?flag=excel",{params:s,responseType:"blob"}),u=window.URL.createObjectURL(new Blob([c.data])),i=document.createElement("a");i.href=u;const y=`${e}-late-attendance.xlsx`;i.setAttribute("download",y),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(s){t.value=((r=(n=s.response)==null?void 0:n.data)==null?void 0:r.message)||"Something went wrong",console.error(t.value)}finally{d.value=!1}},getMonthlyAttendanceLog:$,getDateRangeAttendanceSummary:x,downloadDateRangeExcel:C,downloadDateRangePdf:E,getDailyLateReport:B,recalculateMonthlySnapshot,finalizeMonthlySnapshot:M}});export{Y as u};
