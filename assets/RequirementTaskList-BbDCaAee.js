import{L as oe}from"./LoaderView-DNVHXELL.js";import{O as V}from"./OverlyModal-C2Z31al6.js";import{_ as Q}from"./DepartmentChip-Bg_by9x5.js";import{_ as ae}from"./TaskAddForm-B82jQ8SJ.js";import{_ as ne}from"./TaskEditForm-COqVAFpE.js";import{_ as le}from"./TaskHeader-DuvqAoiz.js";import{_ as de}from"./TaskUserAssignForm-DF_8o5iZ.js";import{b as G,m as O,c as n,o as i,g as l,a as e,F as B,y as S,x as P,t as b,k as y,p as _,j as F,f as C,w as W,u as ue,r as D,d as me,z as X,e as ce,A as Y,i as j,I as pe}from"./index-DWJR6Q_F.js";import{u as ye}from"./task-priority-qvJNHbqD.js";import{u as fe}from"./useRequirementStore-Bscqa4Jt.js";import{u as _e}from"./useTaskStore-DOGsusLr.js";import{_ as ge,T as ke,a as xe,b as ve}from"./TaskUrgentBadge-Dg8rOw-1.js";import{_ as be,a as he}from"./TaskAssignedUsers-DH_NhmbN.js";import{T as Te}from"./TaskIsClosedBadge-Do3at4sR.js";import{d as we,b as qe}from"./datetime-Efw590t9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-CFY-cA6F.js";import"./company-gp7cn4hL.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-BBF49lSq.js";import"./SelectDropdown-CDaXby98.js";import"./SectionLoading-B5gqMsT1.js";import"./TextWithHr-Chy4FZeL.js";import"./TaskUrgencyInput-CgVRKXo5.js";import"./tags-vwF03UU0.js";import"./MultiselectDropdown-CmKWPVrv.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-IY9VYNTY.js";import"./task-BfmrAvPa.js";import"./EmployeeDropdownInput-CyPd8ifN.js";import"./UserChip-BELT4agW.js";import"./SearchInput-C7KoUCfv.js";import"./user-B696Golr.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-DxVnIdpY.js";import"./TaskUserChip-DDAO_ON9.js";import"./requirement-ewp-nCcZ.js";import"./TaskTitle-ChodI6Wb.js";const Ce={class:"w-full p-1"},$e={key:0,class:"w-full"},Le={key:0},Ie={class:"line-clamp-1"},Ae={class:"ml-auto"},Me=["onClick"],Be={class:"border text-center py-2 px-1 border-gray-200"},Re={key:0,class:"text-base font-semibold text-purple-600"},De={class:"border px-3 py-1 border-gray-200 relative"},Se={class:"flex items-center justify-between gap-2"},ze={class:"flex items-center gap-3 mb-0.5"},Ee={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Oe={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},Pe={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ue={class:"text-xs flex items-center gap-1 text-sky-400 ml-4"},Ve={class:"text-xs flex items-center gap-1 text-sky-400 ml-3"},Fe=["href","onClick"],je={class:"border px-3 py-1 border-gray-200"},Ne={class:"flex gap-2 justify-between items-center relative w-full"},He={class:"shrink-0"},Ke=["href","onClick"],Je={class:"border px-3 py-1 border-gray-200 text-center"},Qe={key:0,class:"ml-4 text-gray-500 text-sm"},We={class:"text-blue-500 font-semibold whitespace-nowrap"},Xe={class:"border px-3 border-gray-200 sticky right-0 border-l bg-sky-50"},Ye={class:"flex justify-end flex-wrap gap-2 py-2"},Z={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick","clickAddClick"],setup(M,{emit:g}){const z=M,m=G(),$=O(()=>z.tasks.reduce((k,r)=>{var I;const L=((I=r.requirement_detail)==null?void 0:I.id)||"-",o=[...k],c=o.find(h=>(h==null?void 0:h.key)==L);return c?c.tasks=[...c.tasks,r]:o.push({key:L,position:r!=null&&r.requirement_detail?0:1,...(r==null?void 0:r.requirement_detail)||{title:"(Other tasks)",id:0},tasks:[r]}),o},[]).sort((k,r)=>k.position-r.position)),f=g;return(k,r)=>{var L;return i(),n("div",Ce,[((L=M.tasks)==null?void 0:L.length)>0?(i(),n("table",$e,[r[5]||(r[5]=e("thead",null,[e("tr",null,[e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(i(!0),n(B,null,S($.value,(o,c)=>{var I,h;return i(),n(B,{key:o.id},[$.value.length===1&&((I=$.value[0])==null?void 0:I.id)==0?l("",!0):(i(),n("tr",Le,[e("th",{colspan:"10",class:P(["font-semibold border",[(c>0,"")]])},[e("div",{class:P(["text-left pt-4 pb-1 px-2 flex",[o.id===0?"text-gray-500":"text-sky-800"]])},[e("div",null,[e("p",Ie,b(o==null?void 0:o.title),1)]),e("div",Ae,[((h=y(m))==null?void 0:h.name)=="RequirementTaskList"?(i(),n("button",{key:0,onClick:t=>{var T,A,w;return f("clickAddTask",{requirement_id:(T=o.requirement)==null?void 0:T.id,requirement_detail_id:o.id,from_department_id:(A=o.requirement)==null?void 0:A.from_department_id,to_department_id:(w=o.requirement)==null?void 0:w.to_department_id},{requirement_id:!0,from_department_id:!0,to_department_id:!0})},class:"btn-2 whitespace-nowrap"}," Add Task ",8,Me)):l("",!0)])],2)],2)])),(i(!0),n(B,null,S(o.tasks,(t,T)=>{var A,w;return i(),n("tr",{key:t.id,class:P(["group/sub-task-row",{" bg-green-400/20":t.status=="COMPLETED"," bg-white hover:bg-slate-50":t.status!=="COMPLETED"}])},[e("td",Be,[T!==void 0?(i(),n("div",Re,b(T+1)+". ",1)):l("",!0)]),e("td",De,[e("div",Se,[e("div",null,[e("div",ze,[_(ge,{titleClass:"text-sm",task:t,"sub-tasks-open":!1,isMyTask:y(m).name=="RequirementList",to:M.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",Ee,[e("div",Oe,[r[0]||(r[0]=e("i",{class:"fas fa-clock"},null,-1)),F(" "+b(y(we)(t.created_at)),1)]),e("div",Pe,[t!=null&&t.is_important?(i(),C(ke,{key:0})):l("",!0),t!=null&&t.is_urgent?(i(),C(xe,{key:1})):l("",!0)]),e("div",Ue,[r[1]||(r[1]=e("i",{class:"fas fa-tasks"},null,-1)),F(" "+b(t==null?void 0:t.todos_count),1)]),e("div",Ve,[r[2]||(r[2]=e("i",{class:"fas fa-book"},null,-1)),F(" "+b((A=t==null?void 0:t.requirement_detail)==null?void 0:A.id),1)])])]),!t.is_closed&&!M.hideButtons?(i(),n("a",{key:0,href:`/tasks/edit/${t.id}`,onClick:W(x=>f("editClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},r[3]||(r[3]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Fe)):l("",!0)])]),e("td",je,[e("div",Ne,[_(be,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:t.users||[],isTargetTask:t.is_target,maxItem:1,"route-to":x=>`/requirement-tasks?status=not-completed&view=userwise&user-ids=${x.id}`},null,8,["users","isTargetTask","route-to"]),e("div",He,[!t.is_closed&&!M.hideButtons?(i(),n("a",{key:0,href:`/tasks/${t.id}/assign-users`,onClick:W(x=>f("employeeAssignClick",t.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},r[4]||(r[4]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,Ke)):l("",!0)])])]),e("td",Je,[t.deadline?(i(),n("span",Qe,[e("span",We,b(y(qe)(t.deadline)),1)])):l("",!0)]),e("td",Xe,[e("div",Ye,[t.closed_at?(i(),C(Te,{key:0})):l("",!0),_(he,{status:t==null?void 0:t.status,progressPercent:(t==null?void 0:t.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((w=t==null?void 0:t.children_tasks)==null?void 0:w.length)>0?(i(),C(ve,{key:1,ref_for:!0,ref:"progress",task:t,class:"text-sm w-full"},null,8,["task"])):l("",!0)])])],2)}),128))],64)}),128))])])):l("",!0)])}}},Ze={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},Ge={class:"mb-4"},et={key:4,class:"text-center py-4 text-red-500"},tt={class:"relative min-h-[20vh]"},st={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},rt={class:"font-semibold flex items-center gap-2"},it={class:"text-white text-base"},ot={class:"rounded-b-md overflow-y-auto"},at={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},nt={class:"font-semibold flex items-center gap-2"},lt={class:"rounded-b-md overflow-y-auto"},dt={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},Kt={__name:"RequirementTaskList",setup(M){const g=_e(),z=fe(),m=G(),$=ue(),f=D(""),k=D(null),r=D(!1),L=me(),o=X({parentId:0,requirementId:0,params:{}}),c=X({taskId:0,isOpen:!1}),I=O(()=>{const a=m.query["user-ids"]||null,s=(g.tasks||[]).flatMap(p=>{var v;return a?(v=p.users)==null?void 0:v.filter(E=>a.includes(E.id)):p.users});return[...new Map(s.map(p=>[p.id,p])).values()].sort((p,v)=>p.id-v.id)}),h=O(()=>(g.tasks||[]).reduce((a,s)=>{const q=`${s.from_department_id}-${s.to_department_id}`,p=a.find(v=>v.key==q);return p?p.tasks=[...p.tasks,s]:a.push({key:q,from_department:s.from_department,to_department:s.to_department,tasks:[s]}),a},[])),t=D(null),T=D([]),{saveTaskPriority:A,listHasRearranged:w}=ye(()=>g.taskListTree,0);ce(()=>{console.log("Task List Mounted"),f.value="loading",x()});async function x(){console.log({name:m.name}),m.name=="RequirementTaskList"&&await g.fetchAllTasks({...m.query,page:1}),m.name=="MyRequirementTaskList"&&await g.fetchAllMyTasks({...m.query,page:1}),f.value="",T.value=[]}const U=(a,s)=>{r.value=!0,o.params=a,o.readonlyValues=s},N=a=>{c.taskId=a,c.isOpen=!0};async function H(){k.value=null,r.value=!1,f.value="loading",o.params={},await x()}async function ee(){r.value=!1,o.params={},await x()}async function te(){f.value="loading",await A()&&await x()}function se(a){return g.tasks.filter(s=>(s.users||[]).some(q=>q.id===a))}Y(()=>({...m.query}),async()=>{try{g.resetTaskList(),f.value="loading",await x()}catch(a){console.warn(a)}}),Y(()=>L.isAdminMood,a=>{a?$.push({name:"RequirementTaskList"}):$.push({name:"MyRequirementTaskList"})},{immediate:!0});const K=O({get(){return{...m.query}},set(a){localStorage.removeItem("sub_task_opened_list"),$.push({query:{...a}})}});function re(a){return{name:"RequirementTaskShow",params:{id:(a==null?void 0:a.id)||0}}}return(a,s)=>{var q,p,v,E,J;return i(),n("div",Ze,[k.value?(i(),C(V,{key:0},{default:j(()=>[_(ne,{taskId:k.value,onClose:s[0]||(s[0]=d=>k.value=null),onUpdated:H},null,8,["taskId"])]),_:1})):l("",!0),r.value?(i(),C(V,{key:1},{default:j(()=>{var d,u;return[_(ae,{parentTaskId:o.parentId,requirementId:(d=o.params)==null?void 0:d.requirement_id,requirementDetailId:(u=o.params)==null?void 0:u.requirement_detail_id,"default-values":o.params,"readonly-fields":o.readonlyValues,onClose:ee,onTaskCreated:H},null,8,["parentTaskId","requirementId","requirementDetailId","default-values","readonly-fields"])]}),_:1})):l("",!0),c.isOpen?(i(),C(V,{key:2,class:"*:max-w-4xl"},{default:j(()=>[_(de,{taskId:c.taskId,onCancelClick:s[1]||(s[1]=()=>{c.isOpen=!1,c.taskId=0}),onSuccess:s[2]||(s[2]=()=>{c.isOpen=!1,c.taskId=0,f.value="loading",x()})},null,8,["taskId"])]),_:1})):l("",!0),_(le,{modelValue:K.value,"onUpdate:modelValue":s[3]||(s[3]=d=>K.value=d),onClickAddTask:U,onClickPrioritySave:te,onClickPriorityDiscard:s[4]||(s[4]=()=>y(w)?t.value.resetItems:null),"list-has-rearranged":y(w),isMyTask:y(m).name==="MyRequirementTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((p=(q=y(m))==null?void 0:q.query)==null?void 0:p["query-log"])=="true"?(i(!0),n(B,{key:3},S(T.value,(d,u)=>(i(),n("div",{key:u,class:"text-xs text-gray-500"},[e("div",Ge,b(d.raw_query),1)]))),128)):l("",!0),y(z).error?(i(),n("div",et,b(y(z).error),1)):l("",!0),e("div",tt,[((v=y(m).query)==null?void 0:v.view)==="userwise"?(i(!0),n(B,{key:0},S(I.value,d=>(i(),n("div",{key:d.id,class:"mt-8 rounded-md border-2 border-sky-300"},[e("div",st,[e("div",rt,[_(pe,{user:d},null,8,["user"]),e("div",it,b(d.label),1)])]),e("div",ot,[_(Z,{tasks:se(d.id),onEditClick:s[5]||(s[5]=u=>k.value=u),onAddClick:s[6]||(s[6]=u=>U(u)),onEmployeeAssignClick:s[7]||(s[7]=u=>N(u)),taskLinkTo:u=>({name:"RequirementTaskShow",params:{id:(u==null?void 0:u.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128)):(i(!0),n(B,{key:1},S(h.value,d=>{var u;return i(),n("div",{key:d.key,class:"mt-8 rounded-md border-2 border-sky-300"},[e("div",at,[e("div",nt,[s[11]||(s[11]=e("span",{class:"text-white text-sm"},"From",-1)),_(Q,{department:d.from_department},null,8,["department"]),s[12]||(s[12]=e("span",{class:"text-white text-sm"},"To",-1)),_(Q,{department:d.to_department},null,8,["department"])])]),e("div",lt,[_(Z,{tasks:d.tasks,groupBy:"requirement_details",onEditClick:s[8]||(s[8]=R=>k.value=R),onClickAddTask:s[9]||(s[9]=(R,ie)=>U(R,ie)),onEmployeeAssignClick:s[10]||(s[10]=R=>N(R)),hideButtons:((u=y(m))==null?void 0:u.name)!=="RequirementTaskList",taskLinkTo:re},null,8,["tasks","hideButtons"])])])}),128)),f.value!=="loading"&&((E=y(g).tasks)==null?void 0:E.length)===0?(i(),n("div",dt," No tasks ")):l("",!0),f.value==="loading"?(i(),C(oe,{key:3,class:P(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((J=y(g).tasks)==null?void 0:J.length)===0?"justify-center":""]])},null,8,["class"])):l("",!0)])])}}};export{Kt as default};
