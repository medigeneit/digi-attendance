import{u as N,K as j,r as i,x as E,o as d,c as u,a as e,w as O,d as c,L as U,e as D,p as R,s as I,i as z,b as A,z as K,j as S,h as $,v as g,l as F,m as G,F as H,n as J,k as Q,g as W}from"./index-E6ZGdegF.js";import{L as X}from"./LoaderView-B85ukNSz.js";import{_ as Y}from"./PhotoModal-DTYCxwud.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"modal-bg"},ee={class:"modal-card"},se={class:"grid gap-2 space-y-3"},oe={class:"relative"},te=["type"],le={key:0,class:"far fa-eye"},ae={key:1,class:"far fa-eye-slash"},re={class:"relative"},ne=["type"],de={key:0,class:"far fa-eye"},ue={key:1,class:"far fa-eye-slash"},ie={class:"relative"},pe=["type"],fe={key:0,class:"far fa-eye"},ce={key:1,class:"far fa-eye-slash"},me={key:0,class:"text-red-500"},ve={class:"flex justify-center gap-4"},we={__name:"ChangePasswordModal",props:{user:Object},emits:["close","updated"],setup(L,{emit:o}){const p=o,r=N(),l=j({old_password:"",new_password:"",confirm_password:""}),y=i(!1),b=i(!1),f=i(!1),_=()=>y.value=!y.value,h=()=>b.value=!b.value,v=()=>f.value=!f.value,w=E(()=>l.confirm_password?l.new_password===l.confirm_password:!0),P=async()=>{if(!w.value){alert("New Password and Confirm Password do not match!");return}const C={old_password:l.old_password,new_password:l.new_password,confirm_password:l.confirm_password};await r.changePassword(C),p("updated"),p("close")};return(C,t)=>(d(),u("div",Z,[e("div",ee,[t[7]||(t[7]=e("h2",{class:"text-xl font-bold text-center"},"Change Password",-1)),e("form",{onSubmit:O(P,["prevent"]),class:"space-y-4"},[e("div",se,[e("div",oe,[t[4]||(t[4]=e("label",{class:""},"Old Password",-1)),c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=m=>l.old_password=m),type:y.value?"text":"password",class:"w-full p-2 border rounded pr-10",required:""},null,8,te),[[U,l.old_password]]),e("button",{type:"button",onClick:_,class:"absolute inset-y-0 right-2 mt-6 flex items-center px-2 text-gray-600"},[y.value?(d(),u("i",le)):(d(),u("i",ae))])]),e("div",re,[t[5]||(t[5]=e("label",{class:""},"New Password",-1)),c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=m=>l.new_password=m),type:b.value?"text":"password",class:"w-full p-2 border rounded pr-10",required:""},null,8,ne),[[U,l.new_password]]),e("button",{type:"button",onClick:h,class:"absolute inset-y-0 right-2 mt-6 flex items-center px-2 text-gray-600"},[b.value?(d(),u("i",de)):(d(),u("i",ue))])]),e("div",ie,[t[6]||(t[6]=e("label",{class:""},"Confirm Password",-1)),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=m=>l.confirm_password=m),type:f.value?"text":"password",class:"w-full p-2 border rounded pr-10",required:""},null,8,pe),[[U,l.confirm_password]]),e("button",{type:"button",onClick:v,class:"absolute inset-y-0 right-2 mt-6 flex items-center px-2 text-gray-600"},[f.value?(d(),u("i",fe)):(d(),u("i",ce))])]),w.value?D("",!0):(d(),u("p",me,"Passwords do not match!"))]),e("div",ve,[e("button",{type:"submit",class:R(["btn-2",{"pointer-events-none bg-blue-300":!w.value}])}," Set password ",2),e("button",{type:"button",onClick:t[3]||(t[3]=m=>p("close")),class:"btn-3"},"Cancel")])],32)])]))}},ye={class:"my-container space-y-2"},be={class:"card-bg md:p-8 p-4 mx-4"},ge={class:"grid gap-4"},_e={class:"border p-4 rounded-md bg-gray-100"},xe={class:"flex justify-center w-full"},he=["src"],Pe={class:"grid md:grid-cols-2 gap-4"},Ce={class:"flex justify-center gap-4"},Se={__name:"ProfileEdit",setup(L){const o=j({name:"",phone:"",email:"",nid:"",date_of_birth:"",address:""}),p=N(),{user:r}=I(p),l=z(),y=W(),b=i(!1),f=i(!1),_=i(!1),h=i(null),v=i(null),w=i(!1),P=i(!1);A(()=>{r.value&&V()}),K(r,n=>{n&&V()});const C=()=>{h.value=r.value.photo,_.value=!0},t=()=>{_.value=!1,v.value=null},m=()=>{f.value=!1},T=n=>{v.value=n},V=()=>{var n,s,k,x,a,M;o.name=((n=r.value)==null?void 0:n.name)||"",o.phone=((s=r.value)==null?void 0:s.phone)||"",o.email=((k=r.value)==null?void 0:k.email)||"",o.address=((x=r.value)==null?void 0:x.address)||"",o.nid=((a=r.value)==null?void 0:a.nid)||"",o.date_of_birth=((M=r.value)==null?void 0:M.date_of_birth)||""},q=async()=>{try{await p.updateProfile(o),l.success("Profile updated successfully!"),y.push({name:"MyProfile"})}catch(n){console.error("Failed to update profile:",n),l.error(p.error||"Failed to save profile!");return}},B=async()=>{if(console.log(v.value),!v.value)return;const n=new FormData;n.append("photo",v.value),n.append("user_id",r.value.id),console.log({formData:n});try{w.value=!0,await p.uploadProfilePhoto(n),P.value=!0,setTimeout(()=>{t(),w.value=!1,P.value=!1},1500),l.success("Image updated successfully!")}catch(s){console.error("Failed to upload photo:",s),l.error(p.error||"Failed to save profile!")}finally{w.value=!1}};return(n,s)=>{var x;const k=J("RouterLink");return d(),u(H,null,[e("div",ye,[e("div",be,[s[18]||(s[18]=e("h2",{class:"title-lg text-center"},"Edit Profile",-1)),b.value?(d(),S(X,{key:0,class:"bg-gray-100 border shadow-none"})):(d(),u("form",{key:1,onSubmit:O(q,["prevent"]),class:"space-y-4"},[e("div",ge,[e("div",_e,[e("div",xe,[e("div",{onClick:C,class:"relative bg-gray-200 w-40 h-40 rounded-full overflow-hidden mx-auto flex items-center justify-center"},[e("img",{class:"object-cover w-full h-full",src:((x=$(r))==null?void 0:x.photo)||"/default-avatar.png",alt:"Profile Photo"},null,8,he),s[7]||(s[7]=e("div",{class:"absolute inset-0 flex items-end justify-center bg-black/30 opacity-0 hover:opacity-100 transition-opacity"},[e("button",{type:"button",class:"btn-2 px-3 py-1 text-sm rounded-md mb-2"}," Change ")],-1))])]),s[14]||(s[14]=e("p",{class:"title-md"},"Personal Info",-1)),s[15]||(s[15]=e("hr",{class:"my-2"},null,-1)),e("div",Pe,[e("div",null,[s[8]||(s[8]=e("label",null,"Name",-1)),c(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>o.name=a),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[g,o.name]])]),e("div",null,[s[9]||(s[9]=e("label",null,"Phone",-1)),c(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.phone=a),type:"text",class:"w-full p-2 border rounded",required:""},null,512),[[g,o.phone]])]),e("div",null,[s[10]||(s[10]=e("label",null,"Email",-1)),c(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>o.email=a),type:"email",class:"w-full p-2 border rounded"},null,512),[[g,o.email]])]),e("div",null,[s[11]||(s[11]=e("label",null,"Address",-1)),c(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=a=>o.address=a),rows:"2",class:"w-full p-2 border rounded"},null,512),[[g,o.address]])]),e("div",null,[s[12]||(s[12]=e("label",null,"NID",-1)),c(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>o.nid=a),type:"text",class:"w-full p-2 border rounded"},null,512),[[g,o.nid]])]),e("div",null,[s[13]||(s[13]=e("label",null,"Date of Birth",-1)),c(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>o.date_of_birth=a),type:"date",class:"w-full p-2 border rounded"},null,512),[[g,o.date_of_birth]])])])])]),e("div",Ce,[F(k,{to:{name:"MyProfile"},type:"button",class:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"},{default:G(()=>s[16]||(s[16]=[Q(" Cancel ")])),_:1}),s[17]||(s[17]=e("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Save ",-1)),e("button",{type:"button",onClick:s[6]||(s[6]=a=>f.value=!f.value),class:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"}," Change Password ")])],32))])]),f.value?(d(),S(we,{key:0,onClose:m,user:$(r)},null,8,["user"])):D("",!0),F(Y,{imageSrc:h.value,isOpen:_.value,onClose:t,onFileSelected:T,onUploadPhoto:B},null,8,["imageSrc","isOpen"])],64)}}};export{Se as default};
