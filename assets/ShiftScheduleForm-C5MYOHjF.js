import{M as oe,r as m,D as O,y as K,m as L,x as j,e as ne,c as r,o as u,a as s,g as re,h as F,C as H,F as w,n as x,t as S,k as Y,q as ue,v as de,p as I,A as U,j as P,K as ie}from"./index-CN_4pWdn.js";import{_ as ce}from"./MultiselectDropdown-CIoQq2Cn.js";import{u as ve}from"./company-BLqrldYx.js";import{u as fe}from"./department-CL0G1jQ_.js";import{u as pe}from"./shift-D9Qar6PN.js";import{d as T}from"./dayjs.min-Cbbdfn5l.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me=oe("shiftSchedule",()=>{const A=m([]),b=m(!1);return{schedules:A,defaultShift:b,fetchSchedules:async v=>{var h,M,V;const i=await O.get("/shift-schedules",v);return A.value=(h=i==null?void 0:i.data)==null?void 0:h.schedules,b.value=(M=i==null?void 0:i.data)==null?void 0:M.default_shift,(V=i.data)==null?void 0:V.schedules},saveSchedules:async v=>{await O.post("/shift-schedules",{schedules:v==null?void 0:v.payload})},fetchDefaultSchedules:async v=>{const i=await O.get("/default-shift-schedules",v);return A.value=i==null?void 0:i.data,i.data}}}),ye={class:"p-4 max-w-[1600px] mx-auto"},ge={class:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4 items-center"},Se=["value"],be=["value"],De=["value"],we={key:0,class:"text-yellow-600 font-medium mb-2 p-2 border rounded border-black"},xe={class:"flex flex-wrap gap-3 mb-4 p-4 bg-white rounded sticky top-16"},ke=["onClick"],Ee={class:"text-sm"},Ce={class:"overflow-auto"},_e={class:"table-auto w-full border text-sm"},Fe={class:"sticky top-0 bg-white z-10"},Ae={class:"text-xs text-gray-400"},Ne={class:"border p-2"},Me=["value"],Ve={class:"border p-2 whitespace-nowrap"},We={class:"border p-2"},$e=["onClick"],Be=["onClick"],Ke=["title"],Ye={__name:"ShiftScheduleForm",setup(A){const b=me(),E=ve(),N=pe(),C=fe(),{defaultShift:v}=K(b),{companies:i,employees:h}=K(E),{departments:M}=K(C),{shifts:V}=K(N),D=m(T().format("YYYY-MM")),y=m(""),g=m(""),W=m(""),f=m(""),d=m({}),c=m([]),k=m({WEEKEND:"#B91C1C",HOLIDAY:"#6B7280"}),z=["#FF5733","#33C1FF","#33FF57","#FF33D4","#FFD633","#7D33FF","#FF8C33","#33FFF0","#B833FF","#3375FF","#FF3333","#33FFAA"],$=L(()=>Object.values(V.value||{}).flat());function q(){let l=0;$.value.forEach(e=>{k.value[e.id]||(k.value[e.id]=z[l%z.length],l++)})}const B=L(()=>Array.from({length:T(D.value).daysInMonth()},(l,e)=>e+1)),R=l=>{const e=`${D.value}-${String(l).padStart(2,"0")}`;return T(e).format("ddd")},Q=(l,e)=>{var a,o;const t=(o=(a=d.value)==null?void 0:a[l])==null?void 0:o[e];return t?t==="WEEKEND"||t==="HOLIDAY"?{backgroundColor:k.value[t]||"#D1D5DB"}:{backgroundColor:k.value[t]||"#D1D5DB"}:{backgroundColor:"#D1D5DB"}},X=(l,e)=>{var o,p;const t=(p=(o=d.value)==null?void 0:o[l])==null?void 0:p[e],a=$.value.find(n=>n.id===t);return(a==null?void 0:a.name)||""},Z=(l,e)=>{c.value.includes(parseInt(l))&&f.value&&(d.value[l]||(d.value[l]={}),d.value[l][e]=f.value)},G=l=>{c.value.includes(parseInt(l))&&f.value&&(d.value[l]||(d.value[l]={}),B.value.forEach(e=>{d.value[l][e]=f.value}))},ee=()=>{c.value.forEach(G)},te=()=>{c.value.forEach(l=>{var a;const e=h.value.find(o=>o.id===parseInt(l)),t=((a=e==null?void 0:e.weekends)==null?void 0:a.map(o=>o.slice(0,3)))||[];d.value[l]||(d.value[l]={}),B.value.forEach(o=>{const p=R(o);t.includes(p)&&(d.value[l][o]="WEEKEND")})})},le=async()=>{if(!c.value.length){alert("Please select employees before saving.");return}if(!confirm("Are you sure you want to save the schedule?"))return;const l=[];for(const[e,t]of Object.entries(d.value))if(c.value.includes(parseInt(e)))for(const[a,o]of Object.entries(t)){let p=null,n=null;o==="WEEKEND"||o==="HOLIDAY"?n=o:p=o,l.push({employee_id:parseInt(e),date:`${D.value}-${String(a).padStart(2,"0")}`,shift_id:p,status:n})}if(console.log({payload:l}),!l.length){alert("No schedule data to save.");return}try{await b.saveSchedules({payload:l}),alert("Shift schedule saved successfully!")}catch(e){console.error("Failed to save schedule",e),alert("Something went wrong while saving.")}};j(y,async l=>{l&&(g.value="",c.value=[],h.value=[],d.value={},await E.fetchEmployee(l),await C.fetchDepartments({companyId:l}),await N.fetchShifts({companyId:l}),q())}),j(g,async l=>{if(l){const e={departmentIds:[l]},t=await C.fetchDepartmentEmployee(e);h.value=t,c.value=[],await J(y.value,l,D.value)}}),j(D,async l=>{if(l&&y.value&&g.value){if(await E.fetchEmployee(y.value),y.value&&await N.fetchShifts({companyId:y.value}),g.value){const e=await C.fetchDepartmentEmployee({departmentIds:[g.value]});h.value=e}q(),await J(y.value,g.value,l)}});const se=L(()=>W.value?h.value.filter(l=>{var e;return l.id===parseInt((e=W.value)==null?void 0:e.id)}):h.value);ne(async()=>{await E.fetchCompanies()});const J=async(l,e,t)=>{try{if(!l||!e||!t){alert("Company, Department, and Month are required to load schedule.");return}d.value={},c.value=[],v.value=!1;let o=await b.fetchSchedules({params:{company_id:l,department_id:e,month:t}})||[];const p={};if(!o.length){const n=await b.fetchDefaultSchedules({params:{company_id:l,department_id:e,month:t}});console.warn("[Fallback Schedule Loaded]",n),alert("No saved schedule found. Default schedule loaded."),o=n,v.value=!0}o.forEach(n=>{if(!(n!=null&&n.employee_id)||!(n!=null&&n.date))return;const _=n.employee_id,ae=parseInt(n.date.split("-")[2]);p[_]||(p[_]={}),p[_][ae]=n.shift_id||n.status,!v.value&&!c.value.includes(_)&&c.value.push(_)}),d.value=p}catch(a){console.error("Failed to load schedule data:",a),alert("Error loading schedule. Please try again or contact admin.")}};return(l,e)=>(u(),r("div",ye,[e[16]||(e[16]=s("h2",{class:"text-center title-lg mb-4"},"Monthly Shift Schedule Plan",-1)),s("div",ge,[F(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),class:"p-2 border rounded"},[e[8]||(e[8]=s("option",{value:""},"Select Company",-1)),(u(!0),r(w,null,x(Y(i),t=>(u(),r("option",{key:t.id,value:t.id},S(t.name),9,Se))),128))],512),[[H,y.value]]),F(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),class:"p-2 border rounded"},[e[9]||(e[9]=s("option",{value:""},"- Department -",-1)),(u(!0),r(w,null,x(Y(M),t=>(u(),r("option",{key:t.id,value:t.id},S(t.name),9,be))),128))],512),[[H,g.value]]),s("div",null,[ue(ce,{modelValue:W.value,"onUpdate:modelValue":e[2]||(e[2]=t=>W.value=t),options:Y(h),multiple:!1,label:"name","label-prefix":"employee_id",placeholder:"Select user"},null,8,["modelValue","options"])]),F(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t),class:"p-2 border rounded"},[e[10]||(e[10]=s("option",{value:""},"- Shift -",-1)),(u(!0),r(w,null,x($.value,t=>(u(),r("option",{key:t.id,value:t.id},S(t.name),9,De))),128))],512),[[H,f.value]]),F(s("input",{type:"month","onUpdate:modelValue":e[4]||(e[4]=t=>D.value=t),class:"p-2 border rounded"},null,512),[[de,D.value]])]),Y(v)?(u(),r("p",we," âš  Showing default schedule from current shift. Select employees manually before saving. ")):re("",!0),s("div",xe,[(u(!0),r(w,null,x($.value,t=>(u(),r("div",{key:t.id,class:I(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":f.value===t.id}]),onClick:a=>f.value=t.id},[s("div",{class:"w-5 h-5 rounded",style:U({backgroundColor:k.value[t.id]||"#ccc"})},null,4),s("span",Ee,S(t.name),1)],10,ke))),128)),s("div",{class:I(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":f.value==="HOLIDAY"}]),onClick:e[5]||(e[5]=t=>f.value="HOLIDAY")},e[11]||(e[11]=[s("div",{class:"w-5 h-5 rounded bg-gray-500"},null,-1),s("span",{class:"text-sm"},"Holiday",-1)]),2),s("div",{class:I(["flex items-center gap-2 cursor-pointer px-2 py-1 rounded",{"ring-2 ring-blue-500":f.value==="WEEKEND"}]),onClick:e[6]||(e[6]=t=>f.value="WEEKEND")},[s("div",{class:"w-5 h-5 rounded",style:U({backgroundColor:k.value.WEEKEND})},null,4),e[12]||(e[12]=s("span",{class:"text-sm"},"Weekend",-1))],2)]),s("div",{class:"mb-4 flex gap-4"},[s("button",{onClick:ee,class:"bg-indigo-600 text-white px-4 py-2 rounded"}," Assign Selected Shift to Checked Employees "),s("button",{onClick:te,class:"bg-red-700 text-white px-4 py-2 rounded"}," Assign Weekends to Checked Employees ")]),s("div",Ce,[s("table",_e,[s("thead",Fe,[s("tr",null,[e[13]||(e[13]=s("th",{class:"border p-2"},"Emp ID",-1)),e[14]||(e[14]=s("th",{class:"border p-2"},"Name",-1)),e[15]||(e[15]=s("th",{class:"border p-2"},"Action",-1)),(u(!0),r(w,null,x(B.value,t=>(u(),r("th",{key:t,class:"border text-center p-1 w-10"},[P(S(t)+" ",1),s("div",Ae,S(R(t)),1)]))),128))])]),s("tbody",null,[(u(!0),r(w,null,x(se.value,t=>(u(),r("tr",{key:t.id},[s("td",Ne,[F(s("input",{type:"checkbox",class:"mr-2",value:t.id,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value=a)},null,8,Me),[[ie,c.value]]),P(" "+S(t.code),1)]),s("td",Ve,S(t.name),1),s("td",We,[s("button",{class:"text-xs bg-green-600 text-white px-2 py-1 rounded",onClick:a=>G(t.id)}," Apply to All Dates ",8,$e)]),(u(!0),r(w,null,x(B.value,a=>(u(),r("td",{key:a,class:"border text-center cursor-pointer",onClick:o=>Z(t.id,a)},[s("div",{title:X(t.id,a),style:U(Q(t.id,a)),class:"w-full h-6"},null,12,Ke)],8,Be))),128))]))),128))])])]),s("div",{class:"mb-4 flex justify-center mt-4"},[s("button",{onClick:le,class:"btn-2"},"ðŸ’¾ Save Schedule")])]))}},ze=he(Ye,[["__scopeId","data-v-fc785669"]]);export{ze as default};
