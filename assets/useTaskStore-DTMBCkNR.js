import{J as O,r as d,q as f,K as o}from"./index-DzVbUzHk.js";const x=O("task",()=>{const c=d([]),v=d(null),u=d(!1),i=d(null),p=async(a,s)=>{var e,t;u.value=!0,i.value=null;try{await o.post(`/tasks/${a}/assign-users`,{user_ids:s}),await y(a)}catch(l){throw i.value=((t=(e=l.response)==null?void 0:e.data)==null?void 0:t.message)||"Assign users failed",l}finally{u.value=!1}},w=async(a,{loadingBeforeFetch:s=!0,newList:e=!1}={})=>{var t,l,n;s&&(u.value=!0),i.value=null;try{let r;return e?r=await o.get("/tasks2",{params:a}):r=await o.get("/tasks",{params:a}),c.value=((t=r.data)==null?void 0:t.tasks)||[],r.data}catch(r){i.value=((n=(l=r.response)==null?void 0:l.data)==null?void 0:n.message)||"টাস্ক লোড করতে ব্যর্থ হয়েছে।",console.error("Error fetching tasks:",r)}finally{u.value=!1}};function k(a,s=0){return Array.isArray(a)===!1||a.length===0?[]:a.filter(e=>e.parent_id===s).map(e=>({...e,children_tasks:k(a,e.id)}))}function h(){return k(c.value,0)}function T(){const a=[],s=(e,t=0,l="")=>{e.forEach(n=>{a.push({...n,depth:t,idPath:l+n.id}),n.children_tasks&&n.children_tasks.length&&s(n.children_tasks,t+1,l+n.id+"-")})};return s(h()),a}const y=async(a,s={},e={loadingBeforeFetch:!0,fetchOnly:!1})=>{var t,l,n;e.fetchOnly||(u.value=!0),i.value=null;try{const r=await o.get(`/tasks/${a}`,{params:s});return e.fetchOnly||(v.value=((t=r.data)==null?void 0:t.task)||{}),r.data}catch(r){const g=((n=(l=r.response)==null?void 0:l.data)==null?void 0:n.message)||`টাস্ক (ID: ${a}) লোড করতে ব্যর্থ হয়েছে।`;return e.fetchOnly||(i.value=g),g}finally{e.fetchOnly||(u.value=!1)}},$=async(a,s={loadingBeforeCreate:!1})=>{var e,t,l,n;s.loadingBeforeCreate&&(u.value=!0),i.value=null;try{const r=await o.post("/tasks",a);return(e=r.data)!=null&&e.data&&c.value.push((t=r.data)==null?void 0:t.data),r.data.data}catch(r){throw i.value=((n=(l=r.response)==null?void 0:l.data)==null?void 0:n.message)||"টাস্ক তৈরি করতে ব্যর্থ হয়েছে।",console.error("Error creating task:",r),r}finally{s.loadingBeforeCreate&&(u.value=!1)}},m=async(a,s,{loadingBeforeFetch:e=!0})=>{e&&(u.value=!0),i.value=null;try{const t=await o.put(`/tasks/${a}`,s),l=c.value.findIndex(n=>n.id===a);return l!==-1&&(c.value[l]=t.data.data),t.data.data}catch(t){throw console.error(`Error updating task with id ${a}:`,t),t}finally{e&&(u.value=!1)}},_=async(a,s)=>(await o.put(`/tasks/${a}/update-priorities`,{task_ids:s})).data,E=async a=>{var s,e;u.value=!0,i.value=null;try{await o.delete(`/tasks/${a}`),c.value=c.value.filter(t=>t.id!==a)}catch(t){i.value=((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||`টাস্ক (ID: ${a}) মুছতে ব্যর্থ হয়েছে।`,console.error(`Error deleting task with id ${a}:`,t)}finally{u.value=!1}};return{tasks:f(()=>c.value),task:f(()=>v.value),loading:f(()=>u.value),error:f(()=>i.value),taskListTree:f(h),flattenedTasks:f(T),fetchTasks:w,fetchTask:y,createTask:$,updateTask:m,deleteTask:E,assignUsers:p,updateTaskPriorities:_}});export{x as u};
