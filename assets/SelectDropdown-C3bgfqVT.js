import{r as y,e as Z,I as _,p as x,M as ee,q as te,c as r,o as u,a as c,h as M,g as B,F as K,x as T,s as m,t as g,w as b,v as z,V as w,j as O,n as L,W as le}from"./index-dWT35krI.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"w-full h-full"},se={key:0,class:"flex flex-wrap items-center gap-2 w-full h-full justify-items-stretch"},ae={class:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm"},re=["onClick"],ue={key:1,class:"text-gray-400"},ie=["placeholder","onKeydown"],de={key:1,class:"flex items-center h-full"},ce=["title"],fe={key:1,class:"text-gray-500"},pe={class:"flex items-center gap-0.5"},ve={key:0,class:"px-2 pt-2"},me={class:"max-h-60 overflow-y-auto py-2"},ye={key:0},ge={class:"mx-2 text-sm font-semibold"},be={class:"px-2 text-sm text-gray-700"},he=["onClick","onKeydown"],we=["onClick","onKeydown"],ke={key:1,class:"px-3 py-2 text-gray-500 min-h-24 flex justify-center items-center -mt-2"},xe={__name:"SelectDropdown",props:{options:{type:Array,required:!0},modelValue:{type:[Object,Array,String,Number,null],default:null},placeholder:{type:String,default:null},multiple:{type:Boolean,default:!1},label:{type:String,default:"label"},value:{type:String,default:"id"},clearable:{type:Boolean,default:!1},searchable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},filterBy:{type:Function,default:null},position:{type:String,default:"auto",validator:a=>["top","left","right","bottom","auto"].includes(a)},containment:{type:Object,default:()=>window},taggable:{type:Boolean,default:!1},createOption:Function,isOptionGroup:{type:Boolean,default:!1},optGroupOptionKey:{type:String,default:"children"},groupLabel:{type:String,default:"name"}},emits:["update:modelValue","input","open","close","search","search:focus","search:blur","option:selecting","option:selected","option:deselecting","option:deselected"],setup(a,{emit:P}){const n=a,s=P,f=y(!1),d=y(""),D=y(null),E=y(null),S=y(),F=y(),V=y(n.position),$=y("");function N(e){S.value&&!S.value.contains(e.target)&&f.value&&(f.value=!1,s("close"))}function R(e){var t;return(n.isOptionGroup?((t=$.value)==null?void 0:t[n.optGroupOptionKey])||[]:n.options).find(o=>(o==null?void 0:o[n.value])==e)}Z(()=>{var e;document.addEventListener("click",N),(e=n.containment)==null||e.addEventListener("scroll",()=>A(f.value)),setTimeout(()=>{var l;(l=E.value)==null||l.focus()})}),_(()=>{var e;document.removeEventListener("click",N),(e=n.containment)==null||e.removeEventListener("scroll",()=>A(f.value))});const W=x(()=>n.multiple||n.taggable),J=x(()=>{const e={top:"bottom-[100%] mb-0.5",left:"right-[100%] mr-0.5",right:"left-[100%] ml-0.5",bottom:"top-[100%] mt-0.5"};return e[V.value]||e.bottom}),v=x(()=>n.multiple||n.taggable?Array.isArray(n.modelValue)?n.modelValue:[]:n.modelValue),k=e=>(e==null?void 0:e[n.label])??(e==null?void 0:e.label)??e,C=e=>{var o;const t=(n.isOptionGroup?((o=$.value)==null?void 0:o[n.optGroupOptionKey])||[]:n.options).find(i=>typeof i=="string"||typeof i=="number"?String(i)===String(e):(i==null?void 0:i[n.value])==e);return t?(t==null?void 0:t[n.label])??(t==null?void 0:t.label)??t:n.taggable?e:null},p=e=>typeof e=="object"?(e==null?void 0:e[n.value])??(e==null?void 0:e.value)??e:typeof e=="string"||typeof e=="number"?e:"",Q=()=>{n.disabled||(f.value=!f.value,s(f.value?"open":"close"),f.value&&setTimeout(()=>{var e;(e=D.value)==null||e.focus()},0))},G=e=>{const l=p(e);return n.multiple||n.taggable?v.value.some(t=>p(t)===l):p(v.value)===l},h=(e,l=null)=>{if(console.log({parentOption:l}),l&&($.value=l),n.multiple||n.taggable)if(G(e)){s("option:deselecting",e);const t=v.value.filter(o=>p(o)!==p(e));s("update:modelValue",t),s("option:deselected",e)}else{s("option:selecting",e);const t=[...v.value,p(e)];s("update:modelValue",t),s("option:selected",e)}else s("option:selected",e),typeof n.modelValue=="object"&&n.modelValue?s("update:modelValue",e):s("update:modelValue",p(e));f.value=!1,s("close"),s("input",e),d.value=""},H=e=>{const l=v.value.filter(t=>p(t)!==p(e));s("update:modelValue",l),s("option:deselected",e)},j=x(()=>{const e=d.value.toLowerCase();return!n.searchable||!e?n.options:typeof n.filterBy=="function"?n.filterBy(n.options,e):n.isOptionGroup?n.options.filter(l=>(l[n.optGroupOptionKey]||(l==null?void 0:l.children)||[]).some(t=>k(t).toLowerCase().includes(e))).map(l=>{const t=n.optGroupOptionKey;return{...l,[t]:l[t].filter(o=>k(o).toLowerCase().includes(e))}}):n.options.filter(l=>k(l).toLowerCase().includes(e))});async function A(e){if(!n.containment)return null;if(e&&n.position==="auto"){await ee();const l=S.value,t=F.value;if(l&&t){console.log({cm:n.containment});const o=l.getBoundingClientRect(),i=t.offsetHeight,q=(n.containment.innerHeight||n.containment.clientHeight)-o.bottom,I=o.top;console.log({triggerRect:o,dropdownHeight:i,spaceBelow:q,spaceAbove:I}),I<i?V.value="bottom":V.value=q<i&&I>i?"top":"bottom"}}else V.value=n.position}const U=x(()=>j.value.find(e=>k(e).toLowerCase()===d.value.toLowerCase()));function X(e){if(d.value.length===0&&n.taggable&&Array.isArray(n.modelValue)){const l=[...n.modelValue];l.pop(),s("update:modelValue",l)}}function Y(e){if(e.preventDefault(),!(!n.taggable||!d.value.trim())){if(U.value)h(U.value);else{const l=n.createOption?n.createOption(d.value):d.value.trim();s("option:created",l),s("option:selected",l),s("input",l),s("update:modelValue",[...n.modelValue,l])}d.value="",e.target.focus()}}return te(f,A),(e,l)=>(u(),r("div",{class:"border rounded cursor-pointer bg-white relative",ref_key:"dropdownRef",ref:S},[c("div",{class:L(["flex items-center justify-between px-2 h-full",{"bg-gray-100":a.disabled}]),onClick:Q,tabindex:"0"},[c("div",oe,[W.value?(u(),r("div",se,[Array.isArray(v.value)&&v.value.length>0?(u(!0),r(K,{key:0},T(v.value,t=>m(e.$slots,"selected-option",{key:p(t),option:R(t),removeItem:o=>H(o)},()=>[c("span",ae,[c("span",null,g(C(t)),1),c("button",{onClick:b(o=>H(t),["prevent","stop"]),type:"button",class:"ml-1 text-xs"}," × ",8,re)])],!0)),128)):a.taggable?B("",!0):(u(),r("span",ue,g(a.placeholder||"Select.."),1)),a.taggable?M((u(),r("input",{key:2,"onUpdate:modelValue":l[0]||(l[0]=t=>d.value=t),ref_key:"tagSearchInput",ref:E,type:"text",class:"flex-grow px-2 py-1 rounded outline-none",placeholder:a.placeholder||"Type and enter to add",onKeydown:[w(b(Y,["prevent","stop"]),["enter"]),w(X,["backspace"])],onKeyup:l[1]||(l[1]=()=>f.value=!!d.value),onFocus:l[2]||(l[2]=t=>e.$emit("search:focus")),onBlur:l[3]||(l[3]=t=>e.$emit("search:blur"))},null,40,ie)),[[z,d.value]]):B("",!0)])):(u(),r("div",de,[m(e.$slots,"selected-option",{option:R(a.modelValue),group:$.value},()=>[C(v.value)?(u(),r("span",{key:0,class:"line-clamp-1",title:C(v.value)},g(C(v.value)),9,ce)):(u(),r("span",fe,g(a.placeholder||"Select..."),1))],!0)]))]),c("div",pe,[n.modelValue&&a.clearable?(u(),r("button",{key:0,onClick:l[4]||(l[4]=b(()=>s("update:modelValue",""),["prevent"])),class:"text-gray-600 font-semibold hover:text-red-700 text-xl",title:"Clear selection"},[m(e.$slots,"clear-icon",{},()=>[l[9]||(l[9]=O(" × "))],!0)])):B("",!0),m(e.$slots,"open-indicator",{},()=>[l[10]||(l[10]=c("svg",{class:"w-4 h-4 ml-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M19 9l-7 7-7-7"})],-1))],!0)])],2),M(c("div",{class:L(["absolute w-full border rounded shadow-[0px_0px_10px_0px_rgba(0,0,0,0.25)] z-50 border-teal-500 bg-white",J.value]),ref_key:"dropdownMenuRef",ref:F},[a.searchable&&!a.taggable?(u(),r("div",ve,[m(e.$slots,"search",{},()=>[M(c("input",{type:"text","onUpdate:modelValue":l[5]||(l[5]=t=>d.value=t),ref_key:"searchInput",ref:D,class:"w-full px-2 py-1 border rounded outline-blue-400 focus:outline-1",placeholder:"Search...",onFocus:l[6]||(l[6]=t=>e.$emit("search:focus")),onBlur:l[7]||(l[7]=t=>e.$emit("search:blur")),onKeydown:l[8]||(l[8]=w(b(t=>t.preventDefault(),["stop"]),["enter"]))},null,544),[[z,d.value]])],!0)])):B("",!0),m(e.$slots,"list-header",{},void 0,!0),c("ul",me,[j.value.length?(u(!0),r(K,{key:0},T(j.value,t=>(u(),r(K,{key:p(t)},[a.isOptionGroup?(u(),r("li",ye,[c("div",ge,g(t==null?void 0:t[a.groupLabel]),1),c("ul",be,[(u(!0),r(K,null,T((t==null?void 0:t[a.optGroupOptionKey])||[],o=>(u(),r("li",{key:p(o),tabindex:"0",class:L([{"bg-blue-50":G(o)},"px-3 py-1 my-0.5 hover:bg-blue-100 focus:bg-blue-100 focus:outline-blue-500 cursor-pointer"]),onClick:i=>h(o,t),onKeydown:[w(b(i=>h(o,t),["prevent"]),["space"]),w(b(i=>h(o,t),["prevent"]),["enter"])]},[m(e.$slots,"option",{option:o,group:t},()=>[O(g(k(o)),1)],!0)],42,he))),128))])])):(u(),r("li",{key:1,tabindex:"0",class:L([{"bg-blue-50":G(t)},"px-3 py-1 my-0.5 hover:bg-blue-100 focus:bg-blue-100 focus:outline-blue-500 cursor-pointer"]),onClick:o=>h(t),onKeydown:[w(b(o=>h(t),["prevent"]),["space"]),w(b(o=>h(t),["prevent"]),["enter"])]},[m(e.$slots,"option",{option:t},()=>[O(g(k(t)),1)],!0)],42,we))],64))),128)):(u(),r("li",ke,[m(e.$slots,"no-options",{},()=>[O(g(a.taggable?"No option found, Enter to add":"No options found"),1)],!0)]))]),m(e.$slots,"list-footer",{},void 0,!0)],2),[[le,f.value]])],512))}},$e=ne(xe,[["__scopeId","data-v-5951c140"]]);export{$e as S};
