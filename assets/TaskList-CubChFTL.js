import{_ as pe}from"./CommentModal-DOBbHw8J.js";import{_ as ce,a as ye}from"./TaskUserAssignForm-Db4Lr1Nt.js";import{L as fe}from"./LoaderView-C8tzHfAu.js";import{O as K}from"./OverlyModal-_lFlYxet.js";import{_ as te,a as ke}from"./TaskAddForm-CwhAqYwA.js";import{_ as ve}from"./TaskEditForm-DxY16VOi.js";import{d as ne,b as re,q as b,s as be,e as ie,A as ue,k as ge,c as i,o as a,a as t,f as x,h as l,w as Y,m as V,p as L,l as T,g as E,C as xe,D as J,v as se,n as le,y as Q,F as M,x as X,u as we,r as U,E as ae,t as oe}from"./index-SUl1xsbF.js";import{_ as Ce}from"./MultiselectDropdown-BLzyG20s.js";import{u as Te}from"./company-D8ecR7YX.js";import{_ as de}from"./UserChip-B0dZHGGN.js";import{_ as me}from"./TaskTreeView-Ba7hQjd5.js";import{u as Ie}from"./task-priority-BgYKEx5i.js";import{u as Ae}from"./useTaskStore-D2ADMLn2.js";import"./useCommentStore-C6WWP7A9.js";import"./datetime-q3Sn87-f.js";import"./TaskUrgencyInput-CvXopJfZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-Cs1VYhZy.js";import"./useRequirementStore-osMh64x2.js";import"./SectionLoading-BS3M2H_8.js";const Ve={class:"mb-3 task-header"},Le={class:"flex justify-between items-start mb-4"},qe={key:0,class:"ml-auto flex gap-6 items-center"},Se={key:0,class:"flex gap-2 items-center"},_e={class:"flex flex-wrap items-center gap-2 mt-3"},$e={class:"flex flex-wrap gap-4 w-full"},Ee={key:2,class:"relative w-full md:w-72"},Ue={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Me={class:"text-gray-600 w-40 relative"},De={class:"flex gap-4 items-center flex-shrink-0"},he={class:"flex gap-2"},Pe={class:"flex gap-2"},Be={class:"flex gap-2"},Oe={class:"text-gray-600 w-full md:w-40 relative"},Re={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-5 gap-2"},Ne={class:"text-gray-600 w-full md:w-64 lg:w-96 md:ml-auto relative"},Fe={class:"w-full flex justify-end gap-5 mt-4"},He={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(D,{emit:g}){const u=D,p=ne(),f=re(),q=b(v("from-department-id")),C=b(v("to-department-id")),d=b(v("user-ids")),n=b(v("month")),c=b(v("status")),k=b(v("is-important")),m=b(v("is-urgent")),w=b(v("is-target")),h=b(P()),S=g,A=Te(),{employees:_}=be(A);function v(r){return{get:()=>u.modelValue[r]||"",set:e=>{S("update:modelValue",{...u.modelValue,[r]:e||void 0})}}}function P(){let r=0;const e=s=>{S("update:modelValue",{...u.modelValue,search:s||void 0})};return{get:()=>u.modelValue.search||"",set:s=>{clearTimeout(r),r=setTimeout(e,500,s)}}}const B=b(()=>j(d.value));async function H(r){r&&await A.fetchEmployee(r)}async function W(){if(C.value){const r=A.companies.find(e=>e.departments.some(s=>s.id==C.value));await A.fetchEmployee(r.id)}}ie(async()=>{var r,e;await A.fetchCompanies({with:"departments",ignore_permission:!0}),(r=u.modelValue)!=null&&r["company-id"]&&await H((e=u.modelValue)==null?void 0:e["company-id"])});function j(r){return Array.isArray(_.value)&&_.value.find(e=>e.id==r)||null}function G(r){d.value=(r==null?void 0:r.id)||""}function z(){d.value=""}return ue(()=>C.value,W),(r,e)=>{var O,R,N,y,$,I,Z,ee;const s=ge("RouterLink");return a(),i(M,null,[t("div",Ve,[t("div",Le,[e[12]||(e[12]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),((R=(O=l(p))==null?void 0:O.user)==null?void 0:R.role)!=="employee"&&((N=l(p))!=null&&N.isAdminMood)?(a(),i("div",qe,[D.listHasRearranged?(a(),i("div",Se,[e[11]||(e[11]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=Y(o=>S("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=Y(o=>S("clickPriorityDiscard"),["prevent"]))},"Discard")])):x("",!0),t("button",{onClick:e[2]||(e[2]=o=>S("clickAddTask")),class:"btn-1"},"Add Task")])):x("",!0)]),t("div",_e,[t("div",$e,[l(f).name!=="MyTaskList"?(a(),V(te,{key:0,modelValue:q.value,"onUpdate:modelValue":e[3]||(e[3]=o=>q.value=o),companies:((y=l(A))==null?void 0:y.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:L(()=>e[13]||(e[13]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),l(f).name!=="MyTaskList"?(a(),V(te,{key:1,modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=o=>C.value=o),companies:(($=l(A))==null?void 0:$.companies)||[],class:"relative w-full md:w-64",className:{select:"h-10 text-sm px-2 text-gray-600  border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:L(()=>e[14]||(e[14]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):x("",!0),l(f).name!=="MyTaskList"?(a(),i("div",Ee,[T(Ce,{modelValue:B.value,onSelect:G,onRemove:z,options:l(_),multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full"},{option:L(({option:o})=>[T(de,{user:o,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),B.value?(a(),i("div",Ue,[t("button",{onClick:Y(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):x("",!0),e[15]||(e[15]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):x("",!0),t("div",Me,[e[17]||(e[17]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),E(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>c.value=o),class:"input-1"},e[16]||(e[16]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[xe,c.value]])]),t("div",De,[t("label",he,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=o=>k.value=o)},null,512),[[J,k.value]]),e[18]||(e[18]=t("span",null,"Important",-1))]),t("label",Pe,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=o=>m.value=o)},null,512),[[J,m.value]]),e[19]||(e[19]=t("span",null,"Urgent",-1))]),t("label",Be,[E(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=o=>w.value=o)},null,512),[[J,w.value]]),e[20]||(e[20]=t("span",null,"Is Target",-1))])]),t("div",Oe,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),E(t("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=o=>n.value=o),type:"month",class:"input-1",placeholder:"All month"},null,512),[[se,n.value]])])])])]),t("div",Re,[t("div",Ne,[e[22]||(e[22]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),E(t("input",{id:"search","onUpdate:modelValue":e[10]||(e[10]=o=>h.value=o),type:"text",class:"input-1 !pr-7 w-full",placeholder:"Search by main task title"},null,512),[[se,h.value]]),e[23]||(e[23]=t("i",{class:"fas fa-search absolute right-2 top-[50%] translate-y-[-50%]"},null,-1))]),t("div",Fe,[l(f).name!=="MyTaskList"?(a(),V(s,{key:0,class:Q(["text-xs sm:text-sm btn-3 py-0.5",((I=l(f).query)==null?void 0:I.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...l(f).query,view:"userwise"}}},{default:L(()=>e[24]||(e[24]=[le(" User Wise List ")])),_:1,__:[24]},8,["class","to"])):x("",!0),l(f).name!=="MyTaskList"?(a(),V(s,{key:1,class:Q(["text-xs sm:text-sm btn-3 py-0.5",((Z=l(f).query)==null?void 0:Z.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ee=l(f))==null?void 0:ee.query)||{}).filter(o=>{var F;return((F=l(f))==null?void 0:F.query[o])!=="userwise"}).reduce((o,F)=>({...o,[F]:l(f).query[F]}),{})}}},{default:L(()=>e[25]||(e[25]=[le(" TaskWise List ")])),_:1,__:[25]},8,["class","to"])):x("",!0)])])],64)}}},je={class:"w-full bg-white rounded"},ze=["rowspan"],We={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(D,{emit:g}){const u=D,p=g,f=b(()=>u.tasks.reduce((d,n)=>(d.push(...n.users.filter(c=>!d.find(k=>k.id==c.id&&c.id))),d),[]).filter(d=>u.selectedUserId?d.id==u.selectedUserId:!0)),q=d=>u.tasks.filter(k=>k.users.some(m=>m.id===d)),C=b(()=>f.value.map(d=>{const n=q(d.id);return{...d,tasks:n}}));return(d,n)=>(a(),i("div",null,[t("table",je,[t("tbody",null,[(a(!0),i(M,null,X(C.value,c=>(a(),i(M,{key:c.id},[(a(!0),i(M,null,X(c.tasks,(k,m)=>(a(),i("tr",{key:k.id},[m==0?(a(),i("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(c.tasks.length,1)},[T(de,{user:c,class:"sticky top-[80px]"},null,8,["user"])],8,ze)):x("",!0),t("td",{class:Q(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":m==0,"border-b":c.tasks.length-1===m}])},[T(me,{task:k,class:"!border-0 my-0",index:m,onCommentButtonClick:n[0]||(n[0]=w=>p("commentButtonClick",d.item.id)),onEditClick:n[1]||(n[1]=w=>p("editClick",w)),onAddClick:n[2]||(n[2]=w=>p("addClick",w)),onEmployeeAssignClick:n[3]||(n[3]=w=>p("employeeAssignClick",w))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},Ge={class:"container mx-auto p-6 mt-2 relative bg-white rounded-md shadow-md"},Ke={class:"mb-4"},Ye={key:4},Je={key:0,class:"text-center py-4 text-red-500"},Qe={key:1},Xe={class:"flex items-stretched"},Ze={key:2,class:"text-center py-4 text-gray-500 border h-[100px] flex items-center justify-center text-xl rounded bg-gray-50"},et=1,wt={__name:"TaskList",setup(D){const g=Ae(),u=ne(),p=re(),f=we(),q=U(!1),C=U(null),d=b(()=>{var e;return((e=u==null?void 0:u.user)==null?void 0:e.role)==="employee"||!(u!=null&&u.isAdminMood)?!0:!!p.query["user-ids"]}),n=U(null),c=U(!1),k=ae({parentId:0,requirementId:0}),m=ae({taskId:0,isOpen:!1}),w=U(null),h=U([]),{handleItemsPriorityUpdate:S,saveTaskPriority:A,listHasRearranged:_}=Ie(()=>g.taskListTree,0);ie(async()=>{p.query.status||f.push({query:{...p.query,status:"not-completed"}}),await v({loadingBeforeFetch:!0})});async function v({loadingBeforeFetch:e=!1}={}){const s=await g.fetchTasks({...p.query},{newList:!0,loadingBeforeFetch:e});h.value=s.query_log||[]}const P=e=>{c.value=!0,k.parentId=e},B=e=>{m.taskId=e,m.isOpen=!0},H=e=>{C.value=e,q.value=!0},W=()=>{q.value=!1,C.value=null};async function j(){n.value=null,c.value=!1,k.parentId=0,await v()}async function G(){c.value=!1,k.parentId=0,await v()}async function z(){A()&&await v()}ue(()=>({...p.query}),async()=>{await v()});const r=b({get(){return{...p.query}},set(e){localStorage.removeItem("sub_task_opened_list"),f.push({query:{...e}})}});return(e,s)=>{var O,R,N;return a(),i("div",Ge,[n.value?(a(),V(K,{key:0},{default:L(()=>[T(ve,{taskId:n.value,onClose:s[0]||(s[0]=y=>n.value=null),onUpdated:j},null,8,["taskId"])]),_:1})):x("",!0),c.value?(a(),V(K,{key:1},{default:L(()=>[T(ke,{parentTaskId:k.parentId,requirementId:k.requirementId,onClose:G,onTaskCreated:j},null,8,["parentTaskId","requirementId"])]),_:1})):x("",!0),m.isOpen?(a(),V(K,{key:2,class:"*:max-w-4xl"},{default:L(()=>[T(ce,{taskId:m.taskId,onCancelClick:s[1]||(s[1]=()=>{m.isOpen=!1,m.taskId=0}),onSuccess:s[2]||(s[2]=()=>{m.isOpen=!1,m.taskId=0,v()})},null,8,["taskId"])]),_:1})):x("",!0),T(He,{modelValue:r.value,"onUpdate:modelValue":s[3]||(s[3]=y=>r.value=y),onClickAddTask:P,onClickPrioritySave:z,onClickPriorityDiscard:s[4]||(s[4]=()=>l(_)?w.value.resetItems:null),"list-has-rearranged":l(_),class:"mb-6"},null,8,["modelValue","list-has-rearranged"]),((R=(O=l(p))==null?void 0:O.query)==null?void 0:R["query-log"])=="true"?(a(!0),i(M,{key:3},X(h.value,(y,$)=>(a(),i("div",{key:$,class:"text-xs text-gray-500"},[t("div",Ke,oe(y.raw_query),1)]))),128)):x("",!0),l(g).loading?(a(),i("div",Ye,[T(fe)])):(a(),i(M,{key:5},[l(g).error?(a(),i("div",Je,oe(l(g).error),1)):l(g).tasks.length>0?(a(),i("div",Qe,[((N=l(p).query)==null?void 0:N.view)=="userwise"?(a(),V(We,{key:0,tasks:l(g).tasks,selectedUserId:l(p).query["user-ids"],onCommentButtonClick:s[5]||(s[5]=y=>H(y,e.task.id)),onEditClick:s[6]||(s[6]=y=>n.value=y),onAddClick:s[7]||(s[7]=y=>P(y)),onEmployeeAssignClick:s[8]||(s[8]=y=>B(y))},null,8,["tasks","selectedUserId"])):(a(),V(ye,{key:1,items:l(g).tasks,handle:"handle",onItemsUpdate:l(S),class:"space-y-4",ref_key:"draggableTaskList",ref:w},{item:L(({item:y,index:$})=>[t("div",Xe,[T(me,{task:y,index:$,showDraggableHandle:!d.value,onCommentButtonClick:s[9]||(s[9]=I=>H(I,e.task.id)),onEditClick:s[10]||(s[10]=I=>n.value=I),onAddClick:s[11]||(s[11]=I=>P(I)),onEmployeeAssignClick:s[12]||(s[12]=I=>B(I)),class:"!border-0"},null,8,["task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):(a(),i("div",Ze," No tasks found. "))],64)),T(pe,{show:q.value,"commentable-id":C.value,"commentable-type":"task","user-id":et,"on-close":W,onSubmitted:l(g).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{wt as default};
