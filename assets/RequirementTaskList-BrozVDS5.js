import{L as te}from"./LoaderView-BsfxHkMg.js";import{O}from"./OverlyModal-97C5z6dw.js";import{_ as K}from"./DepartmentChip-DkTVJoh3.js";import{_ as se}from"./TaskAddForm-5xjPDpZ_.js";import{_ as re}from"./TaskEditForm-BMavEH_X.js";import{_ as oe}from"./TaskHeader-BBeeQoKD.js";import{_ as ie}from"./TaskUserAssignForm-BvWryi6F.js";import{m as z,c as a,o,g as l,a as t,F as I,y as M,x as R,t as v,p as y,j as P,k as x,f as T,w as J,b as ae,u as ne,r as L,d as le,z as Q,e as de,A as W,i as U,I as ue}from"./index-DXTp_J5-.js";import{u as me}from"./task-priority-DhyukDkZ.js";import{u as ce}from"./useRequirementStore-ukW6dEJ3.js";import{u as pe}from"./useTaskStore-BV5dcOsi.js";import{_ as ye,T as fe,a as ge,b as xe}from"./TaskUrgentBadge-4PVoxwTz.js";import{_ as _e,a as ke}from"./TaskAssignedUsers-Qs3DTyU3.js";import{T as ve}from"./TaskIsClosedBadge-BTrHf0b5.js";import{d as be,b as he}from"./datetime-DcVwRp76.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./RequiredIcon-DDoFnVoU.js";import"./company-BCJhJPTK.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-h6226M-k.js";import"./SelectDropdown-LYgWPLoM.js";import"./SectionLoading-B_0gNBsG.js";import"./TextWithHr-BcVrEiO_.js";import"./TaskUrgencyInput-DuQNwgGN.js";import"./tags-DmAJFoiU.js";import"./MultiselectDropdown-Cv12SXGF.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-DapnBbv4.js";import"./task-BQFxSkDL.js";import"./EmployeeDropdownInput-C3fWQ8IT.js";import"./UserChip-HHlw8xNG.js";import"./SearchInput-MKaojKEf.js";import"./user-DlVAm2BZ.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-DoqOk6Ip.js";import"./TaskUserChip-6F0kOdTV.js";import"./requirement-gbPYsnq2.js";const Te={class:"w-full p-1"},we={key:0,class:"w-full"},qe={key:0,class:""},Ce={class:"line-clamp-1"},$e={class:"border text-center py-2 px-1 border-gray-200"},Ie={key:0,class:"text-base font-semibold text-purple-600"},Le={class:"border px-3 py-1 border-gray-200 relative"},Me={class:"flex items-center justify-between gap-2"},Ae={class:"flex items-center gap-3 mb-0.5"},Be={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},Se={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},De={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},ze={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},Re={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},Ee=["href","onClick"],Oe={class:"border px-3 py-1 border-gray-200"},Pe={class:"flex gap-2 justify-between items-center relative w-full"},Ue={class:"shrink-0"},Fe=["href","onClick"],Ve={class:"border px-3 py-1 border-gray-200 text-center"},je={key:0,class:"ml-4 text-gray-500 text-sm"},Ne={class:"text-blue-500 font-semibold whitespace-nowrap"},He={class:"border px-3 border-gray-200 sticky right-0 border-l bg-sky-50"},Ke={class:"flex justify-end flex-wrap gap-2 py-2"},X={__name:"TaskTable",props:{tasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick"],setup(w,{emit:f}){const A=w,d=z(()=>A.tasks.reduce((c,r)=>{var e;const _=((e=r.requirement_detail)==null?void 0:e.id)||"-",p=[...c],g=p.find(b=>(b==null?void 0:b.key)==_);return g?g.tasks=[...g.tasks,r]:p.push({key:_,position:r!=null&&r.requirement_detail?0:1,...(r==null?void 0:r.requirement_detail)||{title:"(Other tasks)",id:0},tasks:[r]}),p},[]).sort((c,r)=>c.position-r.position)),q=f;return(c,r)=>{var _;return o(),a("div",Te,[((_=w.tasks)==null?void 0:_.length)>0?(o(),a("table",we,[r[5]||(r[5]=t("thead",null,[t("tr",null,[t("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),t("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),t("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),t("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),t("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),t("tbody",null,[(o(!0),a(I,null,M(d.value,(p,g)=>(o(),a(I,{key:p.id},[d.value.length>1?(o(),a("tr",qe,[t("th",{colspan:"10",class:R(["font-semibold border",[(g>0,"")]])},[t("div",{class:R(["text-left pt-4 pb-1 px-2",[p.id===0?"text-gray-500":"text-sky-800"]])},[t("div",Ce,v(p==null?void 0:p.title),1)],2)],2)])):l("",!0),(o(!0),a(I,null,M(p.tasks,(e,b)=>{var B,S;return o(),a("tr",{key:e.id,class:R(["group/sub-task-row",{" bg-green-400/20":e.status=="COMPLETED"," bg-white hover:bg-slate-50":e.status!=="COMPLETED"}])},[t("td",$e,[b!==void 0?(o(),a("div",Ie,v(b+1)+". ",1)):l("",!0)]),t("td",Le,[t("div",Me,[t("div",null,[t("div",Ae,[y(ye,{titleClass:"text-sm",task:e,"sub-tasks-open":!1,isMyTask:w.isMyTask,to:w.taskLinkTo},null,8,["task","isMyTask","to"])]),t("div",Be,[t("div",Se,[r[0]||(r[0]=t("i",{class:"fas fa-clock"},null,-1)),P(" "+v(x(be)(e.created_at)),1)]),t("div",De,[e!=null&&e.is_important?(o(),T(fe,{key:0})):l("",!0),e!=null&&e.is_urgent?(o(),T(ge,{key:1})):l("",!0)]),t("div",ze,[r[1]||(r[1]=t("i",{class:"fas fa-tasks"},null,-1)),P(" "+v(e==null?void 0:e.todos_count),1)]),t("div",Re,[r[2]||(r[2]=t("i",{class:"fas fa-book"},null,-1)),P(" "+v((B=e==null?void 0:e.requirement_detail)==null?void 0:B.id),1)])])]),!e.is_closed&&!w.hideButtons?(o(),a("a",{key:0,href:`/tasks/edit/${e.id}`,onClick:J(C=>q("editClick",e.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},r[3]||(r[3]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ee)):l("",!0)])]),t("td",Oe,[t("div",Pe,[y(_e,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:e.users||[],isTargetTask:e.is_target,maxItem:1,"route-to":C=>`/requirement-tasks?status=not-completed&view=userwise&user-ids=${C.id}`},null,8,["users","isTargetTask","route-to"]),t("div",Ue,[!e.is_closed&&!w.hideButtons?(o(),a("a",{key:0,href:`/tasks/${e.id}/assign-users`,onClick:J(C=>q("employeeAssignClick",e.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},r[4]||(r[4]=[t("i",{class:"fas fa-users-cog"},null,-1)]),8,Fe)):l("",!0)])])]),t("td",Ve,[e.deadline?(o(),a("span",je,[t("span",Ne,v(x(he)(e.deadline)),1)])):l("",!0)]),t("td",He,[t("div",Ke,[e.closed_at?(o(),T(ve,{key:0})):l("",!0),y(ke,{status:e==null?void 0:e.status,progressPercent:(e==null?void 0:e.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((S=e==null?void 0:e.children_tasks)==null?void 0:S.length)>0?(o(),T(xe,{key:1,ref_for:!0,ref:"progress",task:e,class:"text-sm w-full"},null,8,["task"])):l("",!0)])])],2)}),128))],64))),128))])])):l("",!0)])}}},Je={class:"my-container p-6 mt-2 relative bg-white rounded-md shadow-md min-h-[50vh]"},Qe={class:"mb-4"},We={key:4,class:"text-center py-4 text-red-500"},Xe={class:"relative min-h-[20vh]"},Ye={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},Ze={class:"font-semibold flex items-center gap-2"},Ge={class:"text-white text-base"},et={class:"rounded-b-md overflow-y-auto"},tt={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl from-sky-400/60 to-sky-400 py-2 px-4 flex items-center"},st={class:"font-semibold flex items-center gap-2"},rt={class:"rounded-b-md overflow-y-auto"},ot={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center rounded bg-gray-50 italic"},Ut={__name:"RequirementTaskList",setup(w){const f=pe(),A=ce(),d=ae(),q=ne(),c=L(""),r=L(null),_=L(!1),p=le(),g=Q({parentId:0,requirementId:0}),e=Q({taskId:0,isOpen:!1}),b=z(()=>{const n=d.query["user-ids"]||null,s=(f.tasks||[]).flatMap(u=>{var k;return n?(k=u.users)==null?void 0:k.filter(D=>n.includes(D.id)):u.users});return[...new Map(s.map(u=>[u.id,u])).values()].sort((u,k)=>u.id-k.id)}),B=z(()=>(f.tasks||[]).reduce((n,s)=>{const h=`${s.from_department_id}-${s.to_department_id}`,u=n.find(k=>k.key==h);return u?u.tasks=[...u.tasks,s]:n.push({key:h,from_department:s.from_department,to_department:s.to_department,tasks:[s]}),n},[])),S=L(null),C=L([]),{saveTaskPriority:Y,listHasRearranged:F}=me(()=>f.taskListTree,0);de(()=>{console.log("Task List Mounted"),c.value="loading",$()});async function $(){console.log({name:d.name}),d.name=="RequirementTaskList"&&await f.fetchAllTasks({...d.query,page:1}),d.name=="MyRequirementTaskList"&&await f.fetchAllMyTasks({...d.query,page:1}),c.value="",C.value=[]}const E=n=>{_.value=!0,g.parentId=n},V=n=>{e.taskId=n,e.isOpen=!0};async function j(){r.value=null,_.value=!1,g.parentId=0,c.value="loading",await $()}async function Z(){_.value=!1,g.parentId=0,await $()}async function G(){c.value="loading",await Y()&&await $()}function ee(n){return f.tasks.filter(s=>(s.users||[]).some(h=>h.id===n))}W(()=>({...d.query}),async()=>{try{f.resetTaskList(),c.value="loading",await $()}catch(n){console.warn(n)}}),W(()=>p.isAdminMood,n=>{n?q.push({name:"RequirementTaskList"}):q.push({name:"MyRequirementTaskList"})},{immediate:!0});const N=z({get(){return{...d.query}},set(n){localStorage.removeItem("sub_task_opened_list"),q.push({query:{...n}})}});return(n,s)=>{var h,u,k,D,H;return o(),a("div",Je,[r.value?(o(),T(O,{key:0},{default:U(()=>[y(re,{taskId:r.value,onClose:s[0]||(s[0]=m=>r.value=null),onUpdated:j},null,8,["taskId"])]),_:1})):l("",!0),_.value?(o(),T(O,{key:1},{default:U(()=>[y(se,{parentTaskId:g.parentId,requirementId:g.requirementId,onClose:Z,onTaskCreated:j},null,8,["parentTaskId","requirementId"])]),_:1})):l("",!0),e.isOpen?(o(),T(O,{key:2,class:"*:max-w-4xl"},{default:U(()=>[y(ie,{taskId:e.taskId,onCancelClick:s[1]||(s[1]=()=>{e.isOpen=!1,e.taskId=0}),onSuccess:s[2]||(s[2]=()=>{e.isOpen=!1,e.taskId=0,c.value="loading",$()})},null,8,["taskId"])]),_:1})):l("",!0),y(oe,{modelValue:N.value,"onUpdate:modelValue":s[3]||(s[3]=m=>N.value=m),onClickAddTask:E,onClickPrioritySave:G,onClickPriorityDiscard:s[4]||(s[4]=()=>x(F)?S.value.resetItems:null),"list-has-rearranged":x(F),isMyTask:x(d).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((u=(h=x(d))==null?void 0:h.query)==null?void 0:u["query-log"])=="true"?(o(!0),a(I,{key:3},M(C.value,(m,i)=>(o(),a("div",{key:i,class:"text-xs text-gray-500"},[t("div",Qe,v(m.raw_query),1)]))),128)):l("",!0),x(A).error?(o(),a("div",We,v(x(A).error),1)):l("",!0),t("div",Xe,[((k=x(d).query)==null?void 0:k.view)==="userwise"?(o(!0),a(I,{key:0},M(b.value,m=>(o(),a("div",{key:m.id,class:"mt-8 rounded-md border-2 border-sky-300"},[t("div",Ye,[t("div",Ze,[y(ue,{user:m},null,8,["user"]),t("div",Ge,v(m.label),1)])]),t("div",et,[y(X,{tasks:ee(m.id),onEditClick:s[5]||(s[5]=i=>r.value=i),onAddClick:s[6]||(s[6]=i=>E(i)),onEmployeeAssignClick:s[7]||(s[7]=i=>V(i)),taskLinkTo:i=>({name:"RequirementTaskShow",params:{id:(i==null?void 0:i.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128)):(o(!0),a(I,{key:1},M(B.value,m=>(o(),a("div",{key:m.key,class:"mt-8 rounded-md border-2 border-sky-300"},[t("div",tt,[t("div",st,[s[11]||(s[11]=t("span",{class:"text-white text-sm"},"From",-1)),y(K,{department:m.from_department},null,8,["department"]),s[12]||(s[12]=t("span",{class:"text-white text-sm"},"To",-1)),y(K,{department:m.to_department},null,8,["department"])])]),t("div",rt,[y(X,{tasks:m.tasks,groupBy:"requirement_details",onEditClick:s[8]||(s[8]=i=>r.value=i),onAddClick:s[9]||(s[9]=i=>E(i)),onEmployeeAssignClick:s[10]||(s[10]=i=>V(i)),taskLinkTo:i=>({name:"RequirementTaskShow",params:{id:(i==null?void 0:i.id)||0}})},null,8,["tasks","taskLinkTo"])])]))),128)),c.value!=="loading"&&((D=x(f).tasks)==null?void 0:D.length)===0?(o(),a("div",ot," No tasks ")):l("",!0),c.value==="loading"?(o(),T(te,{key:3,class:R(["absolute inset-0 flex items-center z-50 bg-opacity-60 h-full shadow-none border",[((H=x(f).tasks)==null?void 0:H.length)===0?"justify-center":""]])},null,8,["class"])):l("",!0)])])}}};export{Ut as default};
