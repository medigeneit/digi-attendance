import{f as ce,r as u,D as pe,x as r,q as E,h as xe,c as a,o,a as t,j as N,t as n,b as w,k,H as P,F as _,e as C,v as T,s as U,m as H}from"./index-BSddBBCy.js";import{u as ge}from"./notice-wiArr2T7.js";const ve={class:"space-y-6"},be={class:"max-w-7xl mx-auto rounded-3xl border border-gray-100 bg-white/80 p-6 shadow"},fe={class:"flex flex-col gap-3 pb-4 sm:flex-row sm:items-center sm:justify-between"},me=["disabled"],ye={key:0,class:"mr-2 h-5 w-5",fill:"none",stroke:"currentColor","stroke-width":"1.8",viewBox:"0 0 24 24"},he={key:1,class:"mr-2 h-5 w-5 animate-spin text-white",viewBox:"0 0 24 24",fill:"none"},we={class:"grid gap-4 md:grid-cols-2 xl:grid-cols-4"},ke={class:"flex flex-col gap-2 text-sm text-gray-600"},_e=["value"],Ce={class:"flex flex-col gap-2 text-sm text-gray-600"},Fe=["value"],Me={class:"flex flex-col gap-2 text-sm text-gray-600"},Ne={class:"flex flex-col gap-2 text-sm text-gray-600"},Se={class:"mt-4 flex flex-wrap gap-3"},De={class:"relative flex-1"},Ve={key:0,class:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},je={class:"mx-auto max-w-7xl space-y-6 rounded-3xl bg-white p-6 shadow-xl"},Ee={class:"flex flex-col gap-2 border-b border-gray-100 pb-4 sm:flex-row sm:items-end"},Pe={class:"text-sm text-gray-500"},Te={class:"sm:ml-auto flex flex-col gap-2 sm:items-end"},Ue={class:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-gray-500"},Be=["value"],Ae={key:0,class:"space-y-4",role:"status","aria-live":"polite"},Le={class:"grid gap-3"},Oe={key:1},Re={key:0,class:"overflow-hidden rounded-3xl border border-gray-100 shadow-sm ring-1 ring-black/5"},$e={class:"overflow-x-auto"},qe={class:"min-w-full divide-y divide-gray-100 text-left text-sm text-gray-700"},Ie={class:"divide-y divide-gray-100 bg-white"},Ze={class:"px-6 py-4 font-semibold text-gray-900"},He={class:"px-6 py-4 whitespace-nowrap"},Qe={class:"font-medium text-gray-900"},Ge={class:"text-xs text-gray-500"},We={class:"px-6 py-4 whitespace-nowrap"},ze={class:"px-6 py-4 whitespace-nowrap"},Je={class:"px-6 py-4"},Ke={class:"text-sm leading-relaxed text-gray-700"},Xe={class:"px-6 py-4 whitespace-nowrap text-gray-600"},Ye={key:1,class:"flex flex-col items-center justify-center rounded-3xl border border-dashed border-gray-200 bg-gray-50 px-6 py-16 text-center"},et={key:2,class:"flex flex-col gap-4 border-t border-gray-100 pt-4 sm:flex-row sm:items-center sm:justify-between"},tt={class:"text-sm text-gray-500"},lt={class:"flex flex-wrap gap-2"},st=["disabled"],at=["onClick","disabled"],ot=["disabled"],it={__name:"NoticeFeedbackList",props:{noticeId:{type:[String,Number],required:!0}},setup(Q){const V=ce(),j=ge();function G(s,e=300){let l;return function(...d){clearTimeout(l),l=setTimeout(()=>{s.apply(this,d)},e)}}const W=Q,p=u(""),i=u(1),x=u(20),m=u(!1),F=u(!1),g=u("all"),v=u("all"),b=u(""),f=u(""),c=u(!1),z=Object.freeze([10,20,50,100]),{feedbacks:S,totalFeedbacks:B}=pe(j),A=r(()=>{var s;return((s=V==null?void 0:V.params)==null?void 0:s.id)??W.noticeId}),J=r(()=>p.value.trim().length>0),K=r(()=>(i.value-1)*x.value),X=r(()=>{const s=new Set;return S.value.forEach(e=>{var d;const l=(d=e==null?void 0:e.company)==null?void 0:d.name;l&&s.add(l)}),Array.from(s).sort((e,l)=>e.localeCompare(l))}),Y=r(()=>{const s=new Set;return S.value.forEach(e=>{var d;const l=(d=e==null?void 0:e.department)==null?void 0:d.name;l&&s.add(l)}),Array.from(s).sort((e,l)=>e.localeCompare(l))}),D=r(()=>S.value),ee=r(()=>D.value.length),te=r(()=>!m.value&&!D.value.length),M=r(()=>{const s=Math.ceil((B.value||0)/x.value);return s>0?s:1}),le=r(()=>{const s=[],l=Math.max(1,i.value-2),d=Math.min(M.value,i.value+2);for(let h=l;h<=d;h+=1)s.push(h);return s}),se=r(()=>i.value<=1),ae=r(()=>i.value>=M.value),L=r(()=>{let s=0;return g.value!=="all"&&(s+=1),v.value!=="all"&&(s+=1),b.value&&(s+=1),f.value&&(s+=1),c.value&&(s+=1),s}),oe=r(()=>L.value>0),O=()=>{const s={page:i.value,per_page:x.value},e=p.value.trim();return e&&(s.search=e),g.value!=="all"&&(s.company=g.value),v.value!=="all"&&(s.department=v.value),b.value&&(s.start_date=b.value),f.value&&(s.end_date=f.value),c.value&&(s.has_feedback=!0),s},y=async(s=!1)=>{try{m.value=!0,s&&(S.value=[],i.value=1),await j.fetchFeedbacks(A.value,{params:O()})}catch(e){console.error("Error fetching feedbacks:",e)}finally{m.value=!1}},ne=s=>{if(!s)return"--";const e=new Date(s);return Number.isNaN(e.getTime())?"--":e.toLocaleDateString(void 0,{day:"2-digit",month:"short",year:"numeric"})},re=()=>{p.value&&(p.value="",y(!0))},R=s=>{const e=Math.min(Math.max(1,s),M.value);e!==i.value&&(i.value=e,y())},$=s=>{R(i.value+s)},ie=()=>{g.value="all",v.value="all",b.value="",f.value="",c.value=!1},de=G(()=>{y(!0)},400);E(p,()=>{de()}),E([g,v,b,f,c],()=>{y(!0)}),E(x,()=>{y(!0)}),xe(()=>{y()});const ue=async()=>{try{F.value=!0,await j.downloadFeedbackUserExcel(A.value,O())}catch(s){console.error("Error exporting feedbacks:",s)}finally{F.value=!1}};return(s,e)=>(o(),a("div",ve,[t("section",be,[t("div",fe,[e[11]||(e[11]=t("div",null,[t("p",{class:"text-xs font-semibold uppercase tracking-widest text-indigo-500"},"Smart Filters"),t("h4",{class:"text-lg font-semibold text-gray-900"},"Refine by metadata & time")],-1)),t("div",null,[t("button",{onClick:ue,disabled:F.value,class:"group inline-flex items-center justify-center rounded-2xl bg-green-600 px-5 py-3 font-medium text-white shadow-lg shadow-green-200 transition hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-70"},[F.value?(o(),a("svg",he,e[10]||(e[10]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 0 1 8-8v4l3-3-3-3v4a8 8 0 0 0-8 8h3Z"},null,-1)]))):(o(),a("svg",ye,e[9]||(e[9]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8 7V3h8v4m-4 7V5m-5 7 5 5 5-5M4 19h16"},null,-1)]))),t("span",null,n(F.value?"Generating…":"Export Excel"),1)],8,me),oe.value?(o(),a("button",{key:0,onClick:ie,class:"inline-flex items-center rounded-full bg-gray-100 px-4 py-2 text-sm font-medium text-gray-600 transition hover:bg-gray-200"}," Clear filters ("+n(L.value)+") ",1)):N("",!0)])]),t("div",we,[t("label",ke,[e[13]||(e[13]=w(" Company ")),k(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),class:"rounded-2xl border border-gray-200 px-4 py-2.5 text-gray-800 outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},[e[12]||(e[12]=t("option",{value:"all"},"All companies",-1)),(o(!0),a(_,null,C(X.value,l=>(o(),a("option",{key:l,value:l},n(l),9,_e))),128))],512),[[P,g.value]])]),t("label",Ce,[e[15]||(e[15]=w(" Department ")),k(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),class:"rounded-2xl border border-gray-200 px-4 py-2.5 text-gray-800 outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},[e[14]||(e[14]=t("option",{value:"all"},"All departments",-1)),(o(!0),a(_,null,C(Y.value,l=>(o(),a("option",{key:l,value:l},n(l),9,Fe))),128))],512),[[P,v.value]])]),t("label",Me,[e[16]||(e[16]=w(" From date ")),k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>b.value=l),type:"date",class:"rounded-2xl border border-gray-200 px-4 py-2.5 text-gray-800 outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},null,512),[[T,b.value]])]),t("label",Ne,[e[17]||(e[17]=w(" To date ")),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>f.value=l),type:"date",class:"rounded-2xl border border-gray-200 px-4 py-2.5 text-gray-800 outline-none focus:border-blue-400 focus:ring-2 focus:ring-blue-100"},null,512),[[T,f.value]])])]),t("div",Se,[t("div",De,[e[18]||(e[18]=t("span",{class:"pointer-events-none absolute inset-y-0 left-4 flex items-center text-gray-400","aria-hidden":"true"},[t("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-4.35-4.35M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"})])],-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),type:"search",class:"w-full rounded-2xl border bg-white/80 px-10 py-3 text-base shadow-inner outline-none transition focus:border-blue-300 focus:bg-white focus:ring-2 focus:ring-blue-200",placeholder:"Search employees, departments, or companies..."},null,512),[[T,p.value]]),J.value?(o(),a("button",{key:0,onClick:re,class:"absolute inset-y-0 right-3 flex items-center rounded-full bg-gray-100 px-3 text-xs font-medium text-gray-500 shadow-sm transition hover:bg-gray-200"}," Clear ")):N("",!0)]),t("button",{type:"button",onClick:e[5]||(e[5]=l=>c.value=!c.value),class:U(["inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition",c.value?"bg-blue-600 text-white shadow-lg shadow-blue-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"])},[t("span",{class:U(["flex h-5 w-5 items-center justify-center rounded-full border",c.value?"border-white bg-white/20 text-white":"border-gray-400 bg-white text-gray-500"])},[c.value?(o(),a("svg",Ve,e[19]||(e[19]=[t("path",{"fill-rule":"evenodd",d:"M16.704 4.153a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06L8.5 11.06l6.97-6.908a.75.75 0 0 1 1.06 0Z","clip-rule":"evenodd"},null,-1)]))):N("",!0)],2),e[20]||(e[20]=w(" Only entries with written feedback "))],2)])]),t("section",je,[t("header",Ee,[t("div",null,[e[21]||(e[21]=t("p",{class:"text-sm font-semibold uppercase tracking-widest text-blue-500"},"Feedback",-1)),e[22]||(e[22]=t("h3",{class:"title-md text-2xl font-semibold text-gray-900"},"Employee Feedbacks",-1)),t("p",Pe,n(ee.value)+" of "+n(H(B))+" entries • Updated automatically ",1)]),t("div",Te,[e[24]||(e[24]=t("span",{class:"inline-flex items-center justify-center rounded-full bg-blue-50 px-3 py-1 text-xs font-semibold uppercase text-blue-600"}," Live Table ",-1)),t("label",Ue,[e[23]||(e[23]=w(" Rows per page ")),k(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>x.value=l),class:"rounded-full border border-gray-200 px-3 py-1 text-sm font-medium text-gray-700 outline-none focus:border-blue-300 focus:ring-1 focus:ring-blue-200"},[(o(!0),a(_,null,C(H(z),l=>(o(),a("option",{key:l,value:l},n(l),9,Be))),128))],512),[[P,x.value,void 0,{number:!0}]])])])]),m.value?(o(),a("div",Ae,[e[25]||(e[25]=t("div",{class:"h-4 w-1/3 animate-pulse rounded-full bg-gray-100"},null,-1)),t("div",Le,[(o(),a(_,null,C(5,l=>t("div",{key:`skeleton-${l}`,class:"h-16 animate-pulse rounded-2xl bg-gray-100"})),64))]),e[26]||(e[26]=t("p",{class:"text-center text-sm text-gray-400"},"Fetching the latest feedback…",-1))])):(o(),a("div",Oe,[D.value.length?(o(),a("div",Re,[t("div",$e,[t("table",qe,[e[27]||(e[27]=t("thead",{class:"bg-gray-50 text-xs font-semibold uppercase tracking-wider text-gray-500"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-4"},"#"),t("th",{scope:"col",class:"px-6 py-4"},"User"),t("th",{scope:"col",class:"px-6 py-4"},"Company"),t("th",{scope:"col",class:"px-6 py-4"},"Department"),t("th",{scope:"col",class:"px-6 py-4"},"Feedback"),t("th",{scope:"col",class:"px-6 py-4"},"Date")])],-1)),t("tbody",Ie,[(o(!0),a(_,null,C(D.value,(l,d)=>{var h,q,I,Z;return o(),a("tr",{key:l.id,class:"transition hover:bg-blue-50/60"},[t("td",Ze,n(K.value+d+1),1),t("td",He,[t("p",Qe,n((l==null?void 0:l.name)||"--"),1),t("p",Ge,n(l==null?void 0:l.email),1)]),t("td",We,n(((h=l==null?void 0:l.company)==null?void 0:h.name)||"N/A"),1),t("td",ze,n(((q=l==null?void 0:l.department)==null?void 0:q.name)||"N/A"),1),t("td",Je,[t("p",Ke,n(((I=l==null?void 0:l.feedback)==null?void 0:I.feedback)||"No feedback submitted."),1)]),t("td",Xe,n(ne((Z=l==null?void 0:l.feedback)==null?void 0:Z.submitted_at)),1)])}),128))])])])])):te.value?(o(),a("div",Ye,e[28]||(e[28]=[t("svg",{class:"mb-4 h-14 w-14 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M7 8h10M7 12h6m3.5 8H7a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4h6l6 6v6"})],-1),t("p",{class:"text-lg font-semibold text-gray-700"},"No feedback yet",-1),t("p",{class:"text-sm text-gray-500"}," Try adjusting your search or check back again after more submissions. ",-1)]))):N("",!0),M.value>1?(o(),a("div",et,[t("div",tt," Page "+n(i.value)+" of "+n(M.value)+" • "+n(x.value)+" per page ",1),t("div",lt,[t("button",{onClick:e[7]||(e[7]=l=>$(-1)),disabled:se.value||m.value,class:"inline-flex items-center rounded-full border border-gray-200 px-3 py-1.5 text-sm font-medium text-gray-600 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60"}," Prev ",8,st),(o(!0),a(_,null,C(le.value,l=>(o(),a("button",{key:l,onClick:d=>R(l),disabled:l===i.value,class:U(["inline-flex items-center rounded-full px-3 py-1.5 text-sm font-semibold transition",l===i.value?"bg-blue-600 text-white shadow":"border border-gray-200 text-gray-600 hover:bg-gray-50"])},n(l),11,at))),128)),t("button",{onClick:e[8]||(e[8]=l=>$(1)),disabled:ae.value||m.value,class:"inline-flex items-center rounded-full border border-gray-200 px-3 py-1.5 text-sm font-medium text-gray-600 transition hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-60"}," Next ",8,ot)])])):N("",!0)]))])]))}};export{it as default};
