import{r as z,b as H,m as h,c as n,o as l,g as i,a as e,F as V,y as ee,x as L,t as d,p as b,j as f,k as y,f as k,w as m,A as te,n as se,i as F,L as ae,Q as le}from"./index-wTR-mmzf.js";import{_ as J,T as Q,a as G,b as K}from"./TaskUrgentBadge-Q4tA7yIx.js";import{_ as ie,a as W}from"./TaskAssignedUsers-BikC0dNi.js";import{d as X,b as v}from"./datetime-Efw590t9.js";import{o as ne}from"./url-CePbr-gY.js";import{T as Y}from"./TaskIsClosedBadge-Bx9bYHT7.js";import{_ as re}from"./TaskSupervisorAndEmployee-DFrvGmyE.js";const oe={class:"w-full"},de={key:0,class:"w-full"},ce={class:"border-y text-center py-2 px-1 border-gray-200"},ue={key:0,class:"text-base font-semibold text-purple-600"},ge={class:"border px-3 py-1 border-gray-200 relative"},ye={class:"flex items-center justify-between gap-2"},xe={class:"flex items-center gap-3"},fe={class:"flex items-center flex-none lg:w-full order-0 lg:order-1"},ke={class:"text-gray-400 text-xs mr-4 whitespace-nowrap"},me={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},pe={class:"text-xs flex items-center gap-1 text-sky-400 ml-2"},he=["href","onClick"],be={class:"border px-3 py-1 border-gray-200"},ve={class:"flex gap-2 justify-between items-center relative w-full"},we={class:"shrink-0"},Te=["href","onClick"],$e={class:"border px-3 py-1 border-gray-200 text-center"},Ce={key:0,class:"text-gray-500 text-sm"},_e={class:"font-semibold text-blue-800 whitespace-nowrap"},Ae={class:"border px-3 py-1 border-gray-200 text-center"},Be={key:0,class:"ml-4 text-gray-500 text-sm"},De={class:"text-blue-500 font-semibold whitespace-nowrap"},Le={class:"border px-3 py-1 border-gray-200 text-center"},Me={key:0,class:"text-gray-500 text-sm whitespace-nowrap"},Se={class:"font-semibold text-blue-800"},je={class:"border-y px-3 border-gray-200 sticky right-0 border-l bg-sky-50"},ze={class:"flex justify-end flex-wrap gap-2 py-2"},Ee={class:"flex gap-1 items-center text-sm"},Ne={key:1,class:"text-red-800 italic"},qe=["href"],Ie={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},parentTask:{type:Object},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:5},isMyTask:{type:Boolean,default:!1},taskLinkTo:{type:Function,default:null}},emits:["editClick","addClick","employeeAssignClick"],setup(t,{emit:M}){const c=t,x=z(!1),B=H(),p=h(()=>x.value?c.childrenTasks:c.childrenTasks.slice(0,c.maxItem)),w=h(()=>x.value?[]:c.childrenTasks.slice(c.maxItem));function S(){x.value=!x.value}const u=M;return(j,r)=>{var C;return l(),n("div",oe,[((C=t.childrenTasks)==null?void 0:C.length)>0?(l(),n("table",de,[r[5]||(r[5]=e("thead",null,[e("tr",null,[e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 w-[30px] sticky -top-4 z-20"}," SL "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Task "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Person "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Assign Date "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Deadline "),e("td",{class:"border text-center text-xs text-gray-400 bg-gray-50/80 sticky -top-4 z-20 px-2 whitespace-nowrap"}," Started "),e("td",{class:"border-y text-center text-xs text-gray-400 bg-gray-50/80 -top-4 z-20 sticky right-0 border-l bg-sky-50 px-2 whitespace-nowrap"}," Status ")])],-1)),e("tbody",null,[(l(!0),n(V,null,ee(p.value,(s,_)=>{var D;return l(),n("tr",{key:s.id,class:L(["group/sub-task-row",{" bg-green-400/20":s.status=="COMPLETED"," bg-white hover:bg-slate-50":s.status!=="COMPLETED"}])},[e("td",ce,[_!==void 0?(l(),n("div",ue,d(_+1)+". ",1)):i("",!0)]),e("td",ge,[e("div",ye,[e("div",null,[e("div",xe,[b(J,{titleClass:"text-sm",task:s,"sub-tasks-open":!1,isMyTask:t.isMyTask,to:t.taskLinkTo},null,8,["task","isMyTask","to"])]),e("div",fe,[e("div",ke,[r[1]||(r[1]=e("i",{class:"fas fa-clock"},null,-1)),f(" "+d(y(X)(s.created_at)),1)]),e("div",me,[s!=null&&s.is_important?(l(),k(Q,{key:0})):i("",!0),s!=null&&s.is_urgent?(l(),k(G,{key:1})):i("",!0)]),e("div",pe,[r[2]||(r[2]=e("i",{class:"fas fa-tasks"},null,-1)),f(" "+d(s==null?void 0:s.todos_count),1)])])]),!s.is_closed&&!t.hideButtons?(l(),n("a",{key:0,href:`/tasks/edit/${s.id}`,onClick:m(A=>u("editClick",s.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100"},r[3]||(r[3]=[e("i",{class:"fas fa-edit"},null,-1)]),8,he)):i("",!0)])]),e("td",be,[e("div",ve,[b(ie,{class:"flex items-center justify-center gap-x-3 gap-y-2",users:s.users||[],isTargetTask:s.is_target,maxItem:1,"route-to":A=>`/tasks?status=not-completed&view=userwise&user-ids=${A.id}`},null,8,["users","isTargetTask","route-to"]),e("div",we,[!s.is_closed&&!t.hideButtons?(l(),n("a",{key:0,href:`/tasks/${s.id}/assign-users`,onClick:m(A=>u("employeeAssignClick",s.id),["stop","prevent"]),class:"btn-3 py-1.5 px-1.5 !border-0 size-7 text-sm opacity-40 group-hover/sub-task-row:opacity-100 duration-100 flex-shrink-0"},r[4]||(r[4]=[e("i",{class:"fas fa-users-cog"},null,-1)]),8,Te)):i("",!0)])])]),e("td",$e,[s.assigned_at?(l(),n("span",Ce,[e("span",_e,d(y(v)(s.assigned_at)),1)])):i("",!0)]),e("td",Ae,[s.deadline?(l(),n("span",Be,[e("span",De,d(y(v)(s.deadline)),1)])):i("",!0)]),e("td",Le,[s.started_at?(l(),n("span",Me,[e("span",Se,d(y(v)(s.started_at)),1)])):i("",!0)]),e("td",je,[e("div",ze,[s.closed_at?(l(),k(Y,{key:0})):i("",!0),b(W,{status:s==null?void 0:s.status,progressPercent:(s==null?void 0:s.progress_percent)||0,class:"w-full"},null,8,["status","progressPercent"]),((D=s==null?void 0:s.children_tasks)==null?void 0:D.length)>0?(l(),k(K,{key:1,ref_for:!0,ref:"progress",task:s,class:"text-sm w-full"},null,8,["task"])):i("",!0)])])],2)}),128))])])):i("",!0),e("div",Ee,[t.childrenTasks.length>0?(l(),n(V,{key:0},[w.value.length>0||x.value?(l(),n("button",{key:0,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border ml-2 mt-2",onClick:m(S,["prevent","stop"])},d(x.value?"Show Less":"Show All"),1)):i("",!0),w.value.length>0?(l(),n("span",Ne,d(w.value.length)+" More sub task"+d(w.value.length>1?"s":""),1)):i("",!0)],64)):i("",!0),t.parentTask.level<2&&!t.hideButtons?(l(),n("a",{key:1,href:`/tasks/add?parent_id=${t.parentTask.id}&back-to=${encodeURIComponent(y(B).path+"?"+y(ne)(y(B).query)).toLowerCase()}`,class:L(["hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-indigo-300 mt-2",{"ml-2":t.childrenTasks.length===0,"ml-3":t.childrenTasks.length>0}]),onClick:r[0]||(r[0]=m(s=>u("addClick",t.parentTask.id),["stop","prevent"]))},r[6]||(r[6]=[e("i",{class:"fas fa-plus"},null,-1),f(" Add Sub Task ")]),10,qe)):i("",!0)])])}}},Oe={class:"flex w-full text-gray-800 bg-white"},Re={key:0,class:"border-l border-gray-200 last:border-l-0"},Pe={class:"items-start group"},Ue={class:"flex items-start justify-between w-full gap-4 mb-2"},Ve={class:"flex gap-2 flex-grow items-center"},Fe={key:0,class:"text-xl font-semibold text-blue-500"},He={class:"justify-end items-center gap-2 ml-auto flex flex-wrap flex-shrink-0 sticky right-4"},Je={key:0},Qe={class:"flex items-center justify-between gap-16 w-full"},Ge={class:"flex-shrink-0"},Ke={class:"flex items-center"},We={key:0,class:"flex gap-4 items-center mr-3"},Xe={key:1,class:"text-gray-500 text-sm"},Ye={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ze={class:"text-xs text-gray-400 whitespace-nowrap"},et={class:"children-task-table ml-0 col-span-full"},tt={class:"flex gap-3 items-center px-3 flex-wrap gap-y-8"},st={class:"text-right text-sm flex items-center gap-4 mt-2 opacity-80"},at={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900 whitespace-nowrap"},lt={key:1,class:"text-sm"},it={class:"text-blue-500 font-semibold whitespace-nowrap"},nt={key:2,class:"text-sm"},rt={class:"font-semibold text-blue-800 whitespace-nowrap"},ot={key:3,class:"text-sm"},dt={class:"font-semibold text-blue-500 whitespace-nowrap"},ct={key:4,class:"text-sm"},ut={class:"font-semibold text-green-500 whitespace-nowrap"},gt={class:"flex items-center justify-center w-full md:w-auto sm:ml-auto"},yt={key:0,class:"flex gap-2 ml-4 items-center text-xs"},xt=["href"],ft=["href"],Tt={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(t,{emit:M}){const c=t,x=H(),B=z(null),p=M;function w(o){p("editClick",o)}function S(o){p("employeeAssignClick",o)}const u=z([]),j=localStorage.getItem("sub_task_opened_list");if(j)try{u.value=JSON.parse(j)}catch{u.value=[]}const r=h(()=>v(c.task.assigned_at)),C=h(()=>v(c.task.deadline)),s=h(()=>v(c.task.started_at)),_=h(()=>v(c.task.completed_at)),D=h({get:()=>u.value.includes(c.task.id),set:o=>{const a=u.value.includes(c.task.id);o&&!a?u.value.push(c.task.id):!o&&a&&(u.value=u.value.filter(T=>T!==c.task.id))}});te(u,o=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(o))},{deep:!0});async function A(){var o,a,T;if(confirm("Are you sure?"))try{await le.post(`/tasks/${(o=c.task)==null?void 0:o.id}/convert-to-requirement`)}catch($){alert((T=(a=$==null?void 0:$.response)==null?void 0:a.data)==null?void 0:T.message)}}return(o,a)=>{var $,E,N,q,I,O,R,P,U;const T=se("RouterLink");return l(),n("div",Oe,[t.treeLevel>0?(l(),n("div",Re,a[4]||(a[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):i("",!0),e("div",{class:L(["flex-grow rounded pb-3 overflow-y-auto",{"border-2":t.index,"border-blue-500":t.index%2===0,"border-pink-300":t.index%2===1,"bg-blue-100/30  ":t.task.closed_at,"bg-green-100  ":(($=t.task)==null?void 0:$.progress_percent)===100,"bg-white hover:bg-gray-50":((E=t.task)==null?void 0:E.progress_percent)<100&&!t.task.closed_at}])},[e("div",Pe,[e("div",{class:L(["task-details py-3 shadow-slate-100 flex flex-wrap z-30 pl-3",{"shadow-sm":t.treeLevel>0}])},[e("div",Ue,[e("div",Ve,[t.index!==void 0?(l(),n("div",Fe,d(t.index+1)+". ",1)):i("",!0),b(J,{task:t.task,"sub-tasks-open":D.value,"is-my-task":t.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",He,[t.task.closed_at?(l(),k(Y,{key:0})):i("",!0),b(W,{status:(N=t.task)==null?void 0:N.status,progressPercent:((q=t.task)==null?void 0:q.progress_percent)||0,class:"w-[150px] text-center !border-2"},null,8,["status","progressPercent"]),((O=(I=t.task)==null?void 0:I.children_tasks)==null?void 0:O.length)>0?(l(),k(K,{key:1,ref_key:"progress",ref:B,task:t.task,class:"text-sm w-[150px] text-center"},null,8,["task"])):i("",!0)])]),Object.keys(y(x).query).includes("make-task-convertible")?(l(),n("div",Je,[e("button",{class:"btn-2",onClick:m(A,["prevent"])}," Migrate To Requirement ")])):i("",!0),e("div",Qe,[e("div",Ge,[e("div",Ke,[t.showDraggableHandle||t.task.serial?(l(),n("div",We,[t.showDraggableHandle?(l(),n("button",{key:0,onMousedown:a[0]||(a[0]=m((...g)=>o.handleDragging&&o.handleDragging(...g),["stop"])),class:"handle"},a[5]||(a[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):i("",!0),t.task.serial?(l(),n("span",Xe," #"+d(t.task.serial),1)):i("",!0)])):i("",!0),e("div",Ye,[e("div",Ze,[a[6]||(a[6]=e("i",{class:"fas fa-clock"},null,-1)),f(" "+d(y(X)(t.task.created_at)),1)]),(R=t.task)!=null&&R.is_important?(l(),k(Q,{key:0,class:"flex-none"})):i("",!0),(P=t.task)!=null&&P.is_urgent?(l(),k(G,{key:1,class:"flex-none"})):i("",!0)])])]),t.hideAssignedUsers?i("",!0):(l(),k(re,{key:0,task:t.task,"tree-level":t.treeLevel,class:"flex-nowrap grow shrink","employee-route-to":g=>({query:{...y(x).query,view:"userwise","company-id":g.company_id,"user-ids":g.id}})},null,8,["task","tree-level","employee-route-to"]))])],2),e("div",et,[b(Ie,{childrenTasks:t.task.children_tasks,parentTask:t.task,isMyTask:t.isMyTask,"hide-buttons":t.hideButtons,"hide-assigned-users":t.hideAssignedUsers,"parent-tree-level":t.treeLevel,onEditClick:w,onAddClick:a[1]||(a[1]=g=>p("addClick",g)),onEmployeeAssignClick:S},{"tree-item-end":F(({task:g,level:Z})=>[ae(o.$slots,"item-end",{level:Z,task:g})]),_:3},8,["childrenTasks","parentTask","isMyTask","hide-buttons","hide-assigned-users","parent-tree-level"])])]),e("div",tt,[e("div",st,[t.task.is_target?(l(),n("div",at,a[7]||(a[7]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),f(" TARGET TASK ")]))):i("",!0),C.value?(l(),n("span",lt,[a[8]||(a[8]=e("span",{class:"italic text-gray-500"},"Deadline: ",-1)),e("span",it,d(C.value),1)])):i("",!0),r.value?(l(),n("span",nt,[a[9]||(a[9]=e("span",{class:"italic text-gray-500"},"Assign: ",-1)),e("span",rt,d(r.value),1)])):i("",!0),s.value?(l(),n("span",ot,[a[10]||(a[10]=e("span",{class:"italic text-gray-500"},"Started: ",-1)),e("span",dt,d(s.value),1)])):i("",!0),_.value?(l(),n("span",ct,[a[12]||(a[12]=e("span",{class:"italic text-gray-500"},"Completed: ",-1)),e("span",ut,[f(d(_.value)+" ",1),a[11]||(a[11]=e("i",{class:"fas fa-check-circle"},null,-1))])])):i("",!0)]),e("div",gt,[t.hideButtons?i("",!0):(l(),n("div",yt,[t.task.is_closed?i("",!0):(l(),n("a",{key:0,href:`/tasks/edit/${t.task.id}`,onClick:a[2]||(a[2]=m(g=>p("editClick",t.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs whitespace-nowrap"},a[13]||(a[13]=[e("i",{class:"fas fa-edit"},null,-1),f(" Edit ")]),8,xt)),t.task.is_closed?i("",!0):(l(),n("a",{key:1,href:`/tasks/${t.task.id}/assign-users`,onClick:a[3]||(a[3]=m(g=>p("employeeAssignClick",t.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2 whitespace-nowrap"},a[14]||(a[14]=[e("i",{class:"fas fa-users-cog"},null,-1),f(" Manage ")]),8,ft)),b(T,{to:{name:"TaskReports",params:{id:(U=t.task)==null?void 0:U.id},query:{"is-my-task":t.isMyTask},hash:"#task-reports"},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2 whitespace-nowrap"},{default:F(()=>a[15]||(a[15]=[e("i",{class:"far fa-file-alt"},null,-1),f(" Reports ")])),_:1,__:[15]},8,["to"])]))])])],2)])}}};export{Tt as _};
