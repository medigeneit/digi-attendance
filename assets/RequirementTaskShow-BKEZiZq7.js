import{d as mt,m as q,c as d,o,n as p,a as t,g as u,q as N,t as k,k as l,f as y,j as _,i as D,w as b,F as C,b as pt,u as ft,r as I,z as st,e as kt,x as B,A as at,y as V,I as yt}from"./index-CX-quJz4.js";import{L as ot}from"./LoaderView-Dd0RVms-.js";import{O as z}from"./OverlyModal-D8c2qu7c.js";import{_ as gt}from"./DescriptionView-Dg3jf2WB.js";import{_ as vt}from"./TaskAssignedUsers-BLmQ1l-U.js";import{g as xt,_ as ht,a as _t,b as bt,c as Dt}from"./TaskStatusManager-DemFLs2A.js";import{_ as wt}from"./TaskStatus-M-4qqOAD.js";import{_ as Ct}from"./TaskSupervisorAndEmployee-Csoqj7nB.js";import{b as Tt,d as $t}from"./datetime-DcVwRp76.js";import{_ as Et}from"./DepartmentChip-BSyeSAi8.js";import{_ as Lt}from"./UserChip-C2Plww9P.js";import{_ as Mt,a as Rt}from"./TodoCreateEditShow-De61mHRV.js";import{s as lt}from"./dom-BKn8Ftnz.js";import{u as St}from"./useTaskStore-bJ5qiIyB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./task-CGU6EUws.js";import"./url-CePbr-gY.js";import"./useTodoStore-IJb-T9tM.js";const Ut={class:""},Ot={key:0,class:"mt-1 flex items-center gap-2"},Pt={key:0,class:"line-clamp-2 text-gray-500 whitespace-nowrap mr-2"},jt={class:"md:ml-auto w-full md:w-auto flex items-center justify-center gap-2"},At={key:0,class:"flex items-center gap-1 text-red-600"},Bt={__name:"TodoDateItemCard",props:{todoDate:{type:Object,required:!0},hideDepartment:{type:Boolean,default:!1},hideUser:{type:Boolean,default:!1},userRole:{type:String,default:"employee"}},emits:["clickTodo","clickEdit","clickDelete","clickChangeStatus","clickDelete"],setup(i,{emit:s}){const c=mt(),g=s;return(w,r)=>{var v,x,O,P,j,E,A;const T=q("RouterLink");return o(),d("div",{class:N(["px-4 py-4 md:py-2 cursor-pointer flex flex-wrap items-center gap-y-2 gap-x-4 text-sm",{"bg-green-100":i.todoDate.status=="COMPLETED","hover:bg-gray-50":i.todoDate.status!="COMPLETED"}]),onClick:r[4]||(r[4]=b(h=>g("clickTodo",i.todoDate),["prevent"]))},[p(Mt,{todoDate:i.todoDate},null,8,["todoDate"]),t("div",Ut,[t("div",{class:N(["line-clamp-1",{"text-green-800":i.todoDate.status=="COMPLETED","text-blue-800":i.todoDate.status!="COMPLETED"}])},k(i.todoDate.id)+" - "+k(l(Tt)(i.todoDate.date)),3),i.todoDate.user?(o(),d("div",Ot,[i.hideUser?u("",!0):(o(),y(Lt,{key:0,user:i.todoDate.user,"avatar-size":"xsmall"},null,8,["user"])),i.hideDepartment?u("",!0):(o(),y(Et,{key:1,department:(x=(v=i.todoDate)==null?void 0:v.user)==null?void 0:x.department},null,8,["department"]))])):u("",!0)]),(O=i.todoDate.todo)!=null&&O.todo_type&&((P=i.todoDate.todo)!=null&&P.todo_type_id)?(o(),d("div",Pt,[_(k((j=i.todoDate.todo)==null?void 0:j.todo_type)+" ",1),p(T,{class:"text-blue-600 font-semibold underline hover:text-sky-400",onClick:b(h=>null,["stop"]),to:{name:i.userRole=="employee"?"MyTaskShow":"TaskShow",params:{id:(E=i.todoDate.todo)==null?void 0:E.todo_type_id}}},{default:D(()=>{var h;return[r[5]||(r[5]=t("i",{class:"fas fa-link"},null,-1)),_(" "+k((h=i.todoDate.todo)==null?void 0:h.todo_type_id),1)]}),_:1,__:[5]},8,["to"])])):u("",!0),t("div",jt,[i.todoDate.status=="WORKING"?(o(),d("div",At,r[6]||(r[6]=[t("span",{class:"fas fa-circle animate-pulse text-xs"},null,-1),t("span",{class:"text-xs"},"Working",-1)]))):u("",!0),i.todoDate.user_id===((A=l(c).user)==null?void 0:A.id)?(o(),d(C,{key:1},[i.todoDate.status==="WORKING"?(o(),d("button",{key:0,title:"Mark as Completed",class:"btn-icon bg-transparent text-green-400 border-green-400 border hover:bg-green-400 hover:text-white",onClick:r[0]||(r[0]=b(()=>g("clickChangeStatus",i.todoDate,"COMPLETED"),["prevent","stop"]))},r[7]||(r[7]=[t("i",{class:"fas fa-check"},null,-1)]))):u("",!0),i.todoDate.status==="PENDING"?(o(),d("button",{key:1,title:"Start Working",class:"btn-icon bg-transparent text-red-400 border-red-400 border hover:bg-red-400 hover:text-white",onClick:r[1]||(r[1]=b(()=>g("clickChangeStatus",i.todoDate,"WORKING"),["prevent","stop"]))},r[8]||(r[8]=[t("i",{class:"fas fa-play ml-[4px]"},null,-1)]))):u("",!0),t("button",{class:"btn-icon bg-sky-400 text-white hover:bg-sky-600 hover:text-white",onClick:r[2]||(r[2]=b(h=>{var $;return g("clickEdit",($=i.todoDate)==null?void 0:$.todo)},["prevent","stop"]))},r[9]||(r[9]=[t("i",{class:"fas fa-pen"},null,-1)])),t("button",{class:"btn-icon bg-red-400 text-white hover:bg-red-600 hover:text-white",onClick:r[3]||(r[3]=b(()=>g("clickDelete",i.todoDate),["prevent","stop"]))},r[10]||(r[10]=[t("i",{class:"fas fa-trash-alt"},null,-1)]))],64)):u("",!0)])],2)}}},Nt={class:"container mx-auto p-6"},It={key:3,class:"max-w-8xl min-h-64 mx-auto bg-white shadow-lg rounded-lg p-6 relative"},Vt={key:0,class:"text-sm mb-2 border-b","aria-label":"Breadcrumb"},zt={class:"flex items-center gap-2"},qt={key:0,"aria-hidden":"true",class:"text-gray-400 text-base"},Wt=["title"],Gt={key:1,class:"text-gray-900 font-medium line-clamp-1","aria-current":"page"},Ft={class:"grid grid-cols-4"},Kt={class:"mb-4 flex col-span-full"},Ht={class:"font-medium text-xl flex items-center gap-2"},Jt={class:"mt-2 col-span-full flex items-center"},Qt={class:"text-gray-400 text-xs"},Xt={class:"flex items-center gap-0.5"},Yt={class:"text-sky-400 text-sm font-semibold"},Zt={class:"text-right col-span-full md:col-span-1 ml-auto flex items-start justify-center gap-4 !text-lg"},te={class:"col-span-full mb-4"},ee=["innerHTML"],se={key:0,class:"mt-4 col-span-full mb-6"},ae={class:"mt-2 py-2 flex flex-col lg:flex-row gap-y-4 justify-center items-center gap-2 col-span-full"},oe={class:"flex items-center gap-4 flex-wrap justify-center"},le=["disabled"],ne={class:"mt-4"},ie={class:"mb-3 flex justify-between items-end"},re={class:"px-4 py-1 bg-sky-400 text-white rounded-t-md flex items-center"},de=["onClick"],ue={key:2},ce={key:1,class:"text-center py-4 text-red-500"},Me={__name:"RequirementTaskShow",setup(i){const s=St(),c=pt(),g=ft(),w=I(""),r=I({}),T=st({open:!1,task:null});kt(async()=>{w.value="loading",await x(c.params.id),w.value="",c.hash=="#sub-tasks"&&setTimeout(()=>lt(c.hash,66),0)});const v=st({user:null,type:""});async function x(a){await s.fetchTask(a,{with_todos:"true"})}const O=B(()=>xt(s.task.users,s.task.task_reports||[]));async function P(){await x(c.params.id),v.user=null,v.type=""}const j=a=>{g.push({name:"TaskEdit",params:{id:a}})},E=B(()=>{var a,e;return s.task?((a=s.task)==null?void 0:a.parent_id)==0?{name:h.value?"MyTaskList":"TaskList"}:{params:{id:(e=s.task)==null?void 0:e.parent_id},query:{"is-my-task":h.value}}:null});function A(){T.open=!1,console.log({STATE:"Deleted",backLink:E.value}),g.push(E.value)}const h=B(()=>c.name=="MyTaskShow"||!!c.query["is-my-task"]),$=(a,e=!1)=>({id:a==null?void 0:a.id,title:a==null?void 0:a.title,status:a==null?void 0:a.status,is_current_page:e}),W=B(()=>{var e,L,M,R,S,U;const a=[];return(e=s==null?void 0:s.task)!=null&&e.parent&&(a.push($((L=s.task)==null?void 0:L.parent)),(R=(M=s==null?void 0:s.task)==null?void 0:M.parent)!=null&&R.parent&&a.push($((U=(S=s.task)==null?void 0:S.parent)==null?void 0:U.parent))),[...a.reverse(),$(s.task,!0)]});at(()=>c.params.id,async a=>{w.value="changing",await x(a),w.value=""}),at(()=>c.hash,async function(){setTimeout(()=>lt(c.hash,66),0)});const m=I({action:null});function nt(){m.value={...m.value,action:""},x(c.params.id)}function it(){m.value={...m.value,action:""},x(c.params.id)}function G(a){m.value={...m.value,action:"edit",todo:a}}function rt(a,e){console.log({yearMonthDay:e,todoId:a}),m.value={...m.value,action:"addDate",date:e,todo_id:a,formReadonlyValues:{date:!0}}}function dt(){m.value={action:null,todo:null}}function ut(a){console.log({todo:a}),m.value={...m.value,action:"show",todo:a}}function ct(){var a;m.value={...m.value,action:"add",todoTypeId:(a=c.params)==null?void 0:a.id,todoType:"task",formReadonlyValues:{todo_type_id:!0}}}return(a,e)=>{var R,S,U,F,K,H,J,Q,X,Y,Z,tt,et;const L=q("RouterLink"),M=q("router-view");return o(),d("div",Nt,[v.user?(o(),y(z,{key:0},{default:D(()=>[p(ht,{task:l(s).task,user:v.user,type:v.type,onCloseClick:e[0]||(e[0]=n=>v.user=null),onUpdateDate:P},null,8,["task","user","type"])]),_:1})):u("",!0),T.open?(o(),y(z,{key:1},{default:D(()=>[p(_t,{onCloseClick:e[1]||(e[1]=n=>T.open=!1),task:T.task,onDelete:A},null,8,["task"])]),_:1})):u("",!0),w.value==="loading"?(o(),y(ot,{key:2})):(o(),d("div",It,[l(s).task?(o(),d(C,{key:0},[W.value.length>1?(o(),d("nav",Vt,[t("ol",zt,[(o(!0),d(C,null,V(W.value,(n,f)=>(o(),d(C,{key:n.id},[f>0?(o(),d("li",qt,"/")):u("",!0),t("li",{title:n==null?void 0:n.title,class:"text-gray-600 line-clamp-1"},[n.is_current_page?(o(),d("span",Gt,k(n==null?void 0:n.title),1)):(o(),y(L,{key:0,to:`${h.value?"/my-tasks":"/tasks"}/${n.id}`,class:N(["hover:text-gray-900 hover:underline transition",{"line-clamp-1 text-justify":f>0,"whitespace-nowrap":f===0}])},{default:D(()=>[_(k(n==null?void 0:n.title),1)]),_:2},1032,["to","class"]))],8,Wt)],64))),128))])])):u("",!0),t("section",Ft,[t("div",Kt,[t("div",null,[t("h2",Ht,[t("button",{class:"btn-icon size-6 text-sm text-sky-500",onClick:e[2]||(e[2]=n=>l(g).back())},e[8]||(e[8]=[t("i",{class:"fas fa-arrow-left"},null,-1)])),_(" "+k(l(s).task.title),1)]),t("div",Jt,[t("div",Qt,[e[9]||(e[9]=t("i",{class:"fas fa-clock"},null,-1)),_(" "+k(l($t)(l(s).task.created_at)),1)]),(R=l(s).task)!=null&&R.created_by_user?(o(),d(C,{key:0},[e[10]||(e[10]=t("span",{class:"text-sm text-gray-600 ml-4"},"By",-1)),t("div",Xt,[p(yt,{user:(S=l(s).task)==null?void 0:S.created_by_user,class:"ml-1",size:"xsmall"},null,8,["user"]),t("div",Yt,k((F=(U=l(s).task)==null?void 0:U.created_by_user)==null?void 0:F.label),1)])],64)):u("",!0)])]),t("div",Zt,[p(wt,{status:(K=l(s).task)==null?void 0:K.status,progressPercent:(H=l(s).task)==null?void 0:H.progress_percent,class:"h-6 !text-lg"},null,8,["status","progressPercent"]),l(s).task?(o(),y(vt,{key:0,task:l(s).task,ref_key:"progress",ref:r,class:"!text-lg"},null,8,["task"])):u("",!0)])]),t("div",te,[p(gt,null,{default:D(()=>{var n;return[t("p",{innerHTML:(n=l(s).task)==null?void 0:n.description,class:"text-justify"},null,8,ee)]}),_:1})]),p(Ct,{task:(J=l(s))==null?void 0:J.task,"tree-level":(X=(Q=l(s))==null?void 0:Q.task)==null?void 0:X.level,class:"justify-center border col-span-full border-dashed rounded-lg"},null,8,["task","tree-level"]),l(s).task.children_task_count>0?(o(),d("section",se,[p(bt,{"task-users":((Y=l(s).task)==null?void 0:Y.users)||[],task:l(s).task,"sub-tasks":l(s).tasks,"progress-users":O.value},{caption:D(()=>e[11]||(e[11]=[t("div",{class:"text-sm py-1 text-left uppercase font-semibold text-gray-600"}," Assigned Users ",-1)])),_:1},8,["task-users","task","sub-tasks","progress-users"])])):u("",!0),(Z=l(s))!=null&&Z.task?(o(),y(Dt,{key:1,task:((tt=l(s))==null?void 0:tt.task)||{},class:"col-span-full mt-4",onUpdateStatus:e[3]||(e[3]=()=>{var n,f;return x((f=(n=l(s))==null?void 0:n.task)==null?void 0:f.id)})},null,8,["task"])):u("",!0),t("div",ae,[t("div",oe,[t("button",{onClick:e[4]||(e[4]=b(n=>{var f;return j((f=l(s).task)==null?void 0:f.id)},["stop"])),class:"btn-2 py-0.5 disabled:opacity-30 disabled:pointer-events-none",disabled:!!l(s).task.closed_at},e[12]||(e[12]=[t("i",{class:"fas fa-edit"},null,-1),_(" Edit ")]),8,le),p(L,{to:{name:"TaskUserAssign",params:{id:(et=l(s).task)==null?void 0:et.id}},class:N(["bg-indigo-500 hover:bg-indigo-600 text-white font-semibold px-3 py-0.5 rounded-full transition whitespace-nowrap",l(s).task.closed_at?"opacity-30 pointer-events-none":""]),onClick:e[5]||(e[5]=n=>n.stopPropagation())},{default:D(()=>e[13]||(e[13]=[t("i",{class:"fas fa-users-cog"},null,-1),_(" Assign Users ")])),_:1,__:[13]},8,["to","class"])]),u("",!0)])]),e[18]||(e[18]=t("hr",null,null,-1)),t("div",ne,[t("div",ie,[e[16]||(e[16]=t("h3",{class:"font-semibold text-xl"},"Todos",-1)),t("button",{class:"btn btn-3 h-8",onClick:e[7]||(e[7]=b(()=>ct(),["prevent"]))},e[15]||(e[15]=[t("i",{class:"fas fa-plus"},null,-1),_(" Add Todo ")]))]),t("div",null,[(o(!0),d(C,null,V(l(s).task_todos,n=>(o(),d("div",{key:n.id,class:"mb-4 border rounded-md border-blue-300"},[t("div",re,[t("h4",null,k(n.title),1),t("button",{class:"ml-auto btn-2 h-7 px-3 bg-sky-500 text-white hover:bg-sky-600 hover:text-white bg-none",onClick:b(()=>G(n),["prevent","stop"])},e[17]||(e[17]=[t("i",{class:"fas fa-pen"},null,-1),_(" Edit ")]),8,de)]),(o(!0),d(C,null,V(n.dates,f=>(o(),d("div",{key:f.id},[p(Bt,{"todo-date":f,onClickTodo:()=>ut(f),class:"border-t"},null,8,["todo-date","onClickTodo"])]))),128))]))),128))])]),l(c).name==="TaskReportAdd"?(o(),y(z,{key:1,class:"*:bg-transparent"},{default:D(()=>[p(M)]),_:1})):(o(),d("section",ue,[p(M)]))],64)):(o(),d("div",ce,k(l(s).error),1)),w.value==="changing"?(o(),y(ot,{key:2,class:"absolute bg-opacity-80 inset-0 z-20"})):u("",!0)])),p(Rt,{userRole:"employee",todoModal:m.value,onCancelClick:dt,onTodoUpdate:nt,onTodoDateUpdate:it,onClickEdit:G,onClickAddTodoDate:rt},null,8,["todoModal"])])}}};export{Me as default};
