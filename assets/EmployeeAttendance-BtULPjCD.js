import{u as J,b as K,r as c,x as _,e as Q,M as Y,m as X,z as Z,c as w,o as y,a as t,f as ee,h,q as A,v as te,j as n,t as o,i as le,k as i,W as ne}from"./index-9JcvkUhe.js";import{_ as oe}from"./AttendanceTable-bgfqleTp.js";import{_ as se}from"./EmployeeFilter-DGWdNnG_.js";import{L as ae}from"./LoaderView-D5q40Qnk.js";import{u as re}from"./attendance-DI-WvATs.js";import{u as ue}from"./user-Bw_67LWw.js";import"./datetime-DLUp6MRA.js";import"./company-DyA6zMRi.js";import"./department-BXdME_WB.js";import"./SelectDropdown-w0F057Hk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-BVNxqE3t.js";const ie={class:"px-4 space-y-4"},de={class:"w-full flex flex-wrap gap-4 items-center md:w-auto"},me={key:0,class:"grid md:grid-cols-2 gap-4 text-sm"},pe={class:"card-bg p-4 gap-1"},ye={class:"grid md:grid-cols-2"},ve={class:"card-bg p-4 gap-1"},ge={class:"flex justify-between items-center"},fe={class:"grid md:grid-cols-2"},ce={key:1},we={key:3,class:"space-y-4"},Ue={__name:"EmployeeAttendance",setup(ke){const S=J(),b=K(),r=re(),D=ue(),v=l=>{if(!l)return"";if(typeof l=="string"){if(/^\d{4}-\d{2}$/.test(l))return l;const e=l.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(l),u=e.getFullYear(),m=String(e.getMonth()+1).padStart(2,"0");return`${u}-${m}`}catch{return""}},p=b.query,d=c(v(p.date)||v(r.selectedMonth)||v(new Date)),a=c({company_id:p.company_id||"",department_id:p.department_id||"all",type:p.type||"all",employee_id:p.employee_id||"",category:""}),s=c(null);let k=null;const g=(l={})=>{k&&clearTimeout(k),k=setTimeout(()=>{const e={...b.query,company_id:a.value.company_id||"",department_id:a.value.department_id||"all",type:a.value.type||"all",employee_id:a.value.employee_id||"",date:d.value||"",...l};Object.keys(e).forEach(u=>{(e[u]===""||e[u]===void 0||e[u]===null)&&delete e[u]}),S.replace({query:e}).catch(()=>{})},150)},N=async l=>{if(!l){s.value=null;return}try{await D.fetchUser(l),s.value=D.user||null}catch(e){console.error("fetchUser error:",e),s.value=null}},f=c(""),$=async()=>{const l=a.value.employee_id,e=d.value;if(!l||!e)return;const u=`${l}|${e}`;if(u!==f.value){f.value=u;try{await r.getMonthlyAttendanceByShift(l,e)}catch(m){console.error("fetchAttendance error:",m),f.value=""}}};_(()=>d.value,l=>{d.value=v(l),g({date:d.value})}),_(()=>({...a.value}),()=>{g()}),_(()=>a.value.employee_id,async(l,e)=>{l&&l!==e&&(await N(l),await $()),l||(s.value=null,f.value="")}),Q(async()=>{a.value.employee_id&&await N(a.value.employee_id),a.value.employee_id&&d.value&&await $(),await Y(),g()});const z=()=>S.go(-1),G=()=>{g()},I=X(()=>!!a.value.employee_id);return(l,e)=>{var m,M,T,q,B,U,C,E,L,j,V,W,F,H,O,P,R;const u=Z("router-link");return y(),w("div",ie,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:z},e[2]||(e[2]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[3]||(e[3]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Attendance",-1)),e[4]||(e[4]=t("div",null,null,-1))]),t("div",de,[A(se,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=x=>a.value=x),"initial-value":l.$route.query,onFilterChange:G},null,8,["modelValue","initial-value"]),t("div",null,[h(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[1]||(e[1]=x=>d.value=x),class:"input-1","aria-label":"Select month"},null,512),[[te,d.value]])])]),s.value?(y(),w("div",me,[t("div",pe,[e[14]||(e[14]=t("h2",{class:"title-md"},"Selected Employee Info",-1)),e[15]||(e[15]=t("hr",null,null,-1)),t("div",ye,[t("p",null,[e[5]||(e[5]=t("strong",null,"Name:",-1)),n(" "+o(s.value.name),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"Designation:",-1)),n(" "+o(((m=s.value.designation)==null?void 0:m.title)||"N/A"),1)]),t("p",null,[e[7]||(e[7]=t("strong",null,"Department:",-1)),n(" "+o(((M=s.value.department)==null?void 0:M.name)||"N/A"),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Company:",-1)),n(" "+o(((T=s.value.company)==null?void 0:T.name)||"N/A"),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Phone:",-1)),n(" "+o(s.value.phone),1)]),t("p",null,[e[10]||(e[10]=t("strong",null,"Email:",-1)),n(" "+o(s.value.email||"N/A"),1)]),t("p",null,[e[11]||(e[11]=t("strong",null,"Employee ID:",-1)),n(" "+o(s.value.employee_id||"N/A"),1)]),t("p",null,[e[12]||(e[12]=t("strong",null,"Joining Date:",-1)),n(" "+o(s.value.joining_date||"N/A"),1)]),t("p",null,[e[13]||(e[13]=t("strong",null,"Blood Group:",-1)),n(" "+o(s.value.blood||"N/A"),1)])])]),t("div",ve,[t("div",ge,[e[17]||(e[17]=t("h2",{class:"title-md"},"Attendance Summary",-1)),A(u,{to:{name:"MonthWiseApplicationLog",query:{...l.$route.query}},class:"btn-2",target:"_blank",rel:"noopener noreferrer"},{default:le(()=>e[16]||(e[16]=[n(" Application History ")])),_:1,__:[16]},8,["to"])]),e[25]||(e[25]=t("hr",null,null,-1)),t("div",fe,[t("p",null,[e[18]||(e[18]=t("strong",null,"Total Working Days:",-1)),n(" "+o((B=(q=i(r))==null?void 0:q.summary)==null?void 0:B.total_working_days),1)]),t("p",null,[e[19]||(e[19]=t("strong",null,"Present Days:",-1)),n(" "+o((C=(U=i(r))==null?void 0:U.summary)==null?void 0:C.total_present_days),1)]),t("p",null,[e[20]||(e[20]=t("strong",null,"Absent Days:",-1)),n(" "+o((L=(E=i(r))==null?void 0:E.summary)==null?void 0:L.total_absent_days),1)]),t("p",null,[e[21]||(e[21]=t("strong",null,"Late Days:",-1)),n(" "+o((V=(j=i(r))==null?void 0:j.summary)==null?void 0:V.actual_late_day),1)]),t("p",null,[e[22]||(e[22]=t("strong",null,"Total Weekends:",-1)),n(" "+o((F=(W=i(r))==null?void 0:W.summary)==null?void 0:F.total_weekend_days),1)]),t("p",null,[e[23]||(e[23]=t("strong",null,"Total Working Hours:",-1)),n(" "+o((O=(H=i(r))==null?void 0:H.summary)==null?void 0:O.total_working_hours),1)]),t("p",null,[e[24]||(e[24]=t("strong",null,"Total Overtime Hours:",-1)),n(" "+o((R=(P=i(r))==null?void 0:P.summary)==null?void 0:R.total_overtime_hours),1)])])])])):(y(),w("div",ce,e[26]||(e[26]=[t("p",{class:"text-gray-400 text-center text-2xl italic"}," Select an employee, please. ",-1)]))),i(r).isLoading?(y(),ee(ae,{key:2})):h((y(),w("div",we,[A(oe,{logs:i(r).monthlyLogs},null,8,["logs"])],512)),[[ne,I.value]])])}}};export{Ue as default};
