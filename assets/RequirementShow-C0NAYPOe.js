import{r as w,e as M,c as p,o as i,a as e,f as D,g as f,w as k,F as T,h as N,j as U,y as q,v as j,i as S,A as ae,t as g,d as ye,p as de,I as ge,q as ue,C as me,x as G,n as F,k as pe,b as we,u as ke,z}from"./index-DJFjkkDw.js";import{L as W}from"./LoaderView-wvGHCH07.js";import{O as B}from"./OverlyModal-BinhNwpu.js";import{R as ce}from"./RequiredIcon-CNK0juEp.js";import{f as Y}from"./requirement-DdNwRojt.js";import{a as _e,f as be,d as he,u as $e,_ as qe}from"./TaskAddForm-0qxFXxNx.js";import{u as ve}from"./department-CBNykKbL.js";import{S as fe}from"./SelectDropdown-0Cquk9JW.js";import{_ as H}from"./UserChip-agdLu8wm.js";import{u as xe}from"./user-CdXeiGTS.js";import{_ as Ce}from"./TaskUserChip-D08an7hG.js";import{u as De}from"./useTaskStore-Bl8zk4tZ.js";import{_ as oe}from"./TaskStatus-CId-ZVjw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./company-CDU-ELnN.js";import"./url-CePbr-gY.js";import"./CompanyDepartmentSelectInput-B_VoKzS5.js";import"./SectionLoading-BtJJ80U_.js";import"./TextWithHr-BMYuhRZP.js";import"./TaskUrgencyInput-BG4RvgRv.js";const Ie={class:"sticky top-0 pt-4 bg-white z-10"},Se={class:"mb-4"},Re={class:"block text-gray-600 text-sm mb-1 font-medium"},Te={class:"mb-4"},Ee={class:"mb-4"},Ve={class:"mb-4"},Ae={class:"mb-4"},Ne={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Ue={key:0,class:"mb-4 text-red-500 font-medium"},Le={key:1,class:"mb-4"},Oe={class:"flex items-center justify-between gap-4"},Fe=["disabled"],je={__name:"RequirementDetailAddForm",props:{requirementId:{type:[Number,String],required:!0}},emits:["create","closeClick","error"],setup(_,{emit:I}){const y=_,x=I,a=ve(),v=w(),n=w(""),c=w(),b=w({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),h=w([]);async function m(){var t,s;n.value="submitting";const d={...b.value};console.log({payload:d});try{const o=await _e(y.requirementId,d);x("create",o),n.value="create"}catch(o){n.value="error",c.value=((s=(t=o.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to create requirement detail",x("error",c.value)}}return M(async()=>{var t;const d=((t=(await Y(y.requirementId)).data)==null?void 0:t.requirement)||{};h.value=await a.fetchDepartmentEmployee([d.from_department_id])}),(d,t)=>(i(),p("div",{class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative",ref_key:"formContainerRef",ref:v},[e("div",Ie,[t[7]||(t[7]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Add Requirement",-1)),t[8]||(t[8]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=k(s=>x("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:k(m,["prevent"]),class:"z-0"},[n.value!=="loading"?(i(),p(T,{key:0},[e("div",Se,[e("label",Re,[t[9]||(t[9]=U("Title ")),q(ce)]),N(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>b.value.title=s),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[j,b.value.title]])]),e("div",Te,[t[10]||(t[10]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Details",-1)),N(e("textarea",{rows:"10","onUpdate:modelValue":t[2]||(t[2]=s=>b.value.description=s),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[j,b.value.description]])]),e("div",Ee,[t[12]||(t[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),q(fe,{modelValue:b.value.supervisor_id,"onUpdate:modelValue":t[3]||(t[3]=s=>b.value.supervisor_id=s),options:h.value,placeholder:"--NO SUPERVISOR--",containment:v.value,clearable:"",class:"h-10"},{"list-header":S(()=>t[11]||(t[11]=[e("div",{class:"px-3 pt-2 pb-1 shadow-md text-xs uppercase bg-gray-50 text-gray-500"}," Employees ",-1)])),option:S(({option:s})=>[q(H,{user:s||{},class:"pr-5 -mx-1"},null,8,["user"])]),"selected-option":S(({option:s})=>[s?(i(),D(H,{key:0,user:s||{},class:"pr-4"},null,8,["user"])):f("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",Ve,[t[14]||(t[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),N(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":t[4]||(t[4]=s=>b.value.priority=s)},t[13]||(t[13]=[e("option",{value:""},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ae,b.value.priority]])]),e("div",Ae,[t[15]||(t[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),N(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=s=>b.value.better_to_complete_on=s),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[j,b.value.better_to_complete_on]])])],64)):f("",!0),e("div",Ne,[c.value?(i(),p("div",Ue,g(c.value),1)):f("",!0),c.value?(i(),p("hr",Le)):f("",!0),e("div",Oe,[e("button",{type:"button",onClick:t[6]||(t[6]=k(s=>x("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:n.value=="loading"||n.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},g(n.value=="submitting"?"Saving...":"Add Requirement"),9,Fe)])])],32),n.value==="loading"||n.value==="submitting"?(i(),D(W,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):f("",!0)],512))}},Me={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},Pe={class:"mb-4"},ze={class:"font-semibold"},Be={class:"mb-4"},Ge={class:"line-clamp-2"},He={key:1,class:"min-h-40"},We={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},Ye={key:0,class:"mb-4 text-red-500 font-medium"},Je={key:1,class:"mb-4"},Ke={class:"flex items-center justify-between gap-4"},Qe=["disabled"],Xe={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(_,{emit:I}){const y=_,x=I,a=xe(),v=w(null),n=w(""),c=w(),b=w([]);async function h(){var m,d;n.value="submitting";try{const t=await he(y.requirementId,y.detailId);x("delete",t),n.value="create"}catch(t){n.value="error",c.value=((d=(m=t.response)==null?void 0:m.data)==null?void 0:d.message)||"Failed to update requirement detail: "+t,x("error",c.value)}}return M(async()=>{var m,d,t;n.value="loading";try{b.value=await a.fetchDepartmentWiseEmployees(),v.value=(m=(await be(y.requirementId,y.detailId)).data)==null?void 0:m.detail}catch(s){c.value=((t=(d=s.response)==null?void 0:d.data)==null?void 0:t.message)||"Failed to fetch requirement detail"}finally{n.value=""}}),(m,d)=>{var t,s;return i(),p("div",Me,[d[4]||(d[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:k(h,["prevent"]),class:"z-0"},[n.value!=="loading"?(i(),p(T,{key:0},[e("div",Pe,[d[1]||(d[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",ze,g((t=v.value)==null?void 0:t.title),1)]),e("div",Be,[d[2]||(d[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",Ge,g((s=v.value)==null?void 0:s.description),1)]),d[3]||(d[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(i(),p("div",He)),e("div",We,[c.value?(i(),p("div",Ye,g(c.value),1)):f("",!0),c.value?(i(),p("hr",Je)):f("",!0),e("div",Ke,[e("button",{type:"button",onClick:d[0]||(d[0]=k(o=>x("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:n.value=="loading"||n.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},g(n.value=="submitting"?"Deleting...":"Delete"),9,Qe)])])],32),n.value==="loading"||n.value==="submitting"?(i(),D(W,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):f("",!0)])}}},Ze={class:"sticky top-0 pt-4 bg-white z-10"},et={class:"mb-4"},tt={class:"block text-gray-600 text-sm mb-1 font-medium"},st={class:"mb-4"},lt={class:"mb-4"},rt={key:0,class:"relative w-full"},it={key:0,class:"absolute right-1 text-xl top-0 bottom-0 flex items-center"},nt={class:"mb-4"},ot={class:"mb-4"},at={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},dt={key:0,class:"mb-4 text-red-500 font-medium"},ut={key:1,class:"mb-4"},mt={class:"flex items-center justify-between gap-4"},pt=["disabled"],ct={__name:"RequirementDetailEditForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(_,{emit:I}){const y=_,x=I,a=w(),v=xe(),n=ve(),c=w(null),b=w(""),h=w(),m=w({title:"",description:"",priority:"",better_to_complete_on:"",supervisor_id:null}),d=w([]),t=w([]);async function s(){var r,C;b.value="submitting";const o={...m.value};try{const u=await $e(y.requirementId,y.detailId,o);x("update",u),b.value="create"}catch(u){b.value="error",h.value=((C=(r=u.response)==null?void 0:r.data)==null?void 0:C.message)||"Failed to update requirement detail",x("error",h.value)}}return M(async()=>{var o,r,C,u,l,R,V,A;b.value="loading";try{d.value=await v.fetchDepartmentWiseEmployees();const E=((o=(await Y(y.requirementId)).data)==null?void 0:o.requirement)||{};t.value=await n.fetchDepartmentEmployee([E.from_department_id]),c.value=(r=(await be(y.requirementId,y.detailId)).data)==null?void 0:r.detail,m.value={title:(C=c.value)==null?void 0:C.title,description:(u=c.value)==null?void 0:u.description,priority:(l=c.value)==null?void 0:l.priority,supervisor_id:(R=c.value)==null?void 0:R.supervisor_id};const L=new Date(c.value.better_to_complete_on);m.value.better_to_complete_on=L.toISOString().split("T")[0]}catch(E){h.value=((A=(V=E.response)==null?void 0:V.data)==null?void 0:A.message)||"Failed to fetch requirement detail"}finally{b.value=""}}),(o,r)=>{var C;return i(),p("div",{ref_key:"formContainerRef",ref:a,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Ze,[r[8]||(r[8]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Edit Requirement",-1)),r[9]||(r[9]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:r[0]||(r[0]=k(u=>x("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:k(s,["prevent"]),class:"z-0"},[b.value!=="loading"?(i(),p(T,{key:0},[e("div",et,[e("label",tt,[r[10]||(r[10]=U("Title ")),q(ce)]),N(e("input",{"onUpdate:modelValue":r[1]||(r[1]=u=>m.value.title=u),required:"",placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[j,m.value.title]])]),e("div",st,[r[11]||(r[11]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),N(e("textarea",{rows:"10","onUpdate:modelValue":r[2]||(r[2]=u=>m.value.description=u),placeholder:"Enter requirement description",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[j,m.value.description]])]),e("div",lt,[r[12]||(r[12]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Supervisor",-1)),q(fe,{modelValue:m.value.supervisor_id,"onUpdate:modelValue":r[4]||(r[4]=u=>m.value.supervisor_id=u),options:[...t.value,...t.value.find(u=>{var l,R;return u.id==((R=(l=c.value)==null?void 0:l.supervisor)==null?void 0:R.id)})?[]:[(C=c.value)==null?void 0:C.supervisor]],containment:a.value,placeholder:"--NO SUPERVISOR--",class:"h-10"},{option:S(({option:u})=>[q(H,{user:u||{}},null,8,["user"])]),"selected-option":S(({option:u})=>[u?(i(),p("div",rt,[q(H,{user:u||{}},null,8,["user"]),m.value.supervisor_id?(i(),p("div",it,[e("button",{onClick:r[3]||(r[3]=k(l=>m.value.supervisor_id=null,["prevent"])),class:"text-gray-6 font-semibold 00 hover:text-red-700"}," Ã— ")])):f("",!0)])):f("",!0)]),_:1},8,["modelValue","options","containment"])]),e("div",nt,[r[14]||(r[14]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Priority ",-1)),N(e("select",{class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500","onUpdate:modelValue":r[5]||(r[5]=u=>m.value.priority=u)},r[13]||(r[13]=[e("option",{value:null},"NORMAL",-1),e("option",null,"IMPORTANT",-1),e("option",null,"URGENT",-1)]),512),[[ae,m.value.priority]])]),e("div",ot,[r[15]||(r[15]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Better to Complete ",-1)),N(e("input",{type:"date","onUpdate:modelValue":r[6]||(r[6]=u=>m.value.better_to_complete_on=u),placeholder:"EnderRequirement detail title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[j,m.value.better_to_complete_on]])])],64)):f("",!0),e("div",at,[h.value?(i(),p("div",dt,g(h.value),1)):f("",!0),h.value?(i(),p("hr",ut)):f("",!0),e("div",mt,[e("button",{type:"button",onClick:r[7]||(r[7]=k(u=>x("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:b.value=="loading"||b.value=="submitting",type:"submit",class:"bg-blue-500 hover:bg-blue-600 text-white font-semibold px-5 py-2 rounded transition"},g(b.value=="submitting"?"Saving...":"Edit Detail"),9,pt)])])],32),b.value==="loading"||b.value==="submitting"?(i(),D(W,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):f("",!0)],512)}}},bt=["rowspan"],vt={class:"text-2xl font-medium"},ft=["rowspan"],xt={class:"text-lg font-semibold mb-2"},yt={class:"mb-5"},gt={class:"text-justify"},wt=["innerHTML"],kt={class:"flex items-end"},_t={class:"flex items-center gap-1 mb-3"},ht={class:"text-blue-400 font-semibold"},$t={class:"ml-auto flex gap-6 items-center"},qt=["rowspan"],Ct={class:"border-2 border-gray-700 p-3 text-center"},Dt=["title"],It={class:"border-2 border-gray-700 p-3"},St={class:"whitespace-nowrap text-center print:whitespace-break-spaces"},Rt={key:0},Tt={key:1,class:"text-gray-500"},Et={key:2,colspan:"2",class:"border-2 border-gray-700 p-3 text-center"},Vt={__name:"RequirementDetailTableRow",props:{detail:{type:Object},requirement:{type:Object},serial:{type:Number}},emits:["editClick","deleteClick","taskCreateClick"],setup(_,{emit:I}){const y=_,x=I,a=ye(),v=w(null),n=w(!1),c=w("line-clamp-2"),b=de(()=>{var t,s,o;return((s=(t=y.detail)==null?void 0:t.tasks)==null?void 0:s.length)>0?(o=y.detail)==null?void 0:o.tasks:[{id:0}]});function h(){var t,s,o,r;if(((t=a.user)==null?void 0:t.department_id)!==((s=y.requirement)==null?void 0:s.to_department_id))return alert(`You can't create or assign task for this requirement. 
Only ${(r=(o=y.requirement)==null?void 0:o.to_department)==null?void 0:r.name}'s user can create or assign.`);x("taskCreateClick",y.detail)}function m(){const t=v.value[0];t&&(n.value=t.scrollHeight>t.clientHeight)}function d(){c.value=c.value?"":"line-clamp-2"}return M(()=>{m(),window.addEventListener("resize",m)}),ge(()=>{window.removeEventListener("resize",m)}),ue(()=>y.detail.description,()=>setTimeout(m,10)),(t,s)=>{const o=me("RouterLink");return i(!0),p(T,null,G(b.value,(r,C)=>{var u,l,R,V,A,E;return i(),p("tr",{key:r.id,class:"group/item border text-gray-800 py-4 shadow-sm mb-4 px-4 rounded-md hover:bg-blue-50"},[C===0?(i(),p(T,{key:0},[e("td",{class:"border-2 border-gray-700 p-3 align-top",rowspan:((l=(u=_.detail)==null?void 0:u.tasks)==null?void 0:l.length)||1},[e("span",vt,g(_.serial),1)],8,bt),e("td",{class:"border-2 border-gray-700 p-3",rowspan:((V=(R=_.detail)==null?void 0:R.tasks)==null?void 0:V.length)||1},[e("div",null,[e("div",xt,[e("span",null,g(_.detail.title),1)]),s[3]||(s[3]=e("hr",{class:"mb-4 -mx-4"},null,-1)),e("div",yt,[s[2]||(s[2]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),e("div",gt,[e("p",{ref_for:!0,ref_key:"descriptionEl",ref:v,class:F(["print:line-clamp-none",c.value]),innerHTML:_.detail.description},null,10,wt),n.value?(i(),p("button",{key:0,class:"text-blue-500 group-hover/item:underline hover:text-sky-400 ml-auto text-sm print:hidden",onClick:k(d,["prevent"])},g(c.value?"Show More":"Show Less"),1)):f("",!0)])])]),e("div",kt,[e("div",null,[e("div",_t,[s[4]||(s[4]=e("span",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Supervisor:",-1)),_.detail.supervisor?(i(),D(Ce,{key:0,user:_.detail.supervisor},null,8,["user"])):f("",!0)]),e("div",null,[s[5]||(s[5]=e("span",{class:"text-gray-500 mr-2 text-xs uppercase font-semibold"},"Priority:",-1)),e("span",ht,g(_.detail.priority),1)])]),e("div",$t,[e("button",{class:"btn-2",onClick:s[0]||(s[0]=k(L=>x("editClick",_.detail),["prevent"]))},s[6]||(s[6]=[e("i",{class:"fas fa-edit"},null,-1),U("Edit ")])),e("button",{class:"btn-2-red",onClick:s[1]||(s[1]=k(L=>x("deleteClick",_.detail),["prevent"]))},s[7]||(s[7]=[e("i",{class:"fas fa-trash-alt"},null,-1),U("Delete ")]))])])],8,ft),e("td",{class:"border-2 border-gray-700 p-3 whitespace-nowrap print:whitespace-break-spaces print:px-0 text-center",rowspan:((E=(A=_.detail)==null?void 0:A.tasks)==null?void 0:E.length)||1},[e("div",null,g(new Date(_.detail.better_to_complete_on).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)],8,qt)],64)):f("",!0),r.id?(i(),p(T,{key:1},[e("td",Ct,[q(o,{to:{name:"TaskShow",params:{id:r.id}},class:"hover:underline text-gray-900 hover:text-blue-600 whitespace-nowrap block",target:"_blank"},{default:S(()=>[U(g(r.id)+" ",1),e("i",{title:r.status,class:F(["ml-1",{"fad fa-exclamation-circle text-red-600":r.status=="PENDING","fad fa-exclamation-square text-yellow-600":r.status=="IN_PROGRESS","fad fa-check-circle text-green-600":r.status=="COMPLETED"}])},null,10,Dt)]),_:2},1032,["to"])]),e("td",It,[e("div",St,[r.deadline?(i(),p("div",Rt,g(new Date(r.deadline).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",weekday:"short"})),1)):(i(),p("div",Tt,"-"))])])],64)):(i(),p("td",Et,[e("button",{onClick:k(h,["prevent"]),class:"print:hidden border-2 border-transparent group-hover/item:bg-blue-200 hover:border-blue-700 text-blue-500 hover:text-white hover:!bg-blue-500 rounded-md px-4 py-1 whitespace-nowrap"}," Create / Assign Task ")]))])}),128)}}},At={class:"text-left p-4"},Nt={class:"flex items-center gap-6 justify-center my-16"},Ut={key:0},Lt={class:"bg-blue-50 px-6 py-4 rounded text-blue-500"},Ot={class:"text-left text-base w-full font-semibold group flex items-center gap-2 mb-5 border-b border-blue-100 py-4"},Ft={class:"flex items-center w-full"},jt={class:"grow"},Mt={class:"text-center text-red-500 text-sm font-semibold mb-4"},Pt={class:"flex items-center justify-between"},zt={key:1,class:"border rounded-md"},Bt={class:"flex flex-col justify-start items-start min-h-28 max-h-[70vh] overflow-y-auto"},Gt=["onClick"],Ht={class:"flex items-center w-full"},Wt={class:"grow"},Yt={class:"line-clamp-1"},Jt={key:0,class:"text-red-400 text-xs font-normal mt-1"},Kt={__name:"TaskParentIdSelector",props:{fromDepartmentId:{type:Number},requirementDetail:{type:Object}},emits:["parentIdSelect","cancelClick","assignTask"],setup(_,{emit:I}){const y=_,x=I,a=De(),v=w(""),n=w(null);ue(()=>v.value,(m,d)=>{d||a.fetchTasks({"from-department-id":y.fromDepartmentId})},{immediate:!0});function c(m){if(v.value=="sub-task")x("parentIdSelect",m.id);else{if(m.requirement_detail_id)return alert("This task already assigned to another requirement. Can't be assigned.");n.value=m}}async function b(){await a.setTaskRequirement(n.value.id,y.requirementDetail.id),x("assignTask")}const h=de(()=>(a==null?void 0:a.tasks)||[]);return(m,d)=>{var t;return i(),p("div",At,[e("div",Nt,[e("button",{onClick:d[0]||(d[0]=k(s=>x("parentIdSelect",0,v.value),["prevent"])),class:"btn-3"}," Add as Main Task "),e("button",{class:F({"btn-3":v.value!=="sub-task","btn-2":v.value=="sub-task"}),onClick:d[1]||(d[1]=k(()=>{v.value="sub-task",n.value=null},["prevent"]))}," Add as Sub Task ",2),e("button",{class:F({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:d[2]||(d[2]=k(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value=="direct-assign"&&n.value?(i(),p("div",Ut,[e("div",Lt,[e("div",Ot,[e("i",{class:F(["fad text-xl group:hover-text-white",((t=n.value)==null?void 0:t.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",Ft,[e("div",jt,g(n.value.title),1),q(oe,{status:n.value.status,class:"ml-auto"},null,8,["status"])])]),e("div",Mt,g(pe(a).error),1),e("div",Pt,[e("button",{onClick:k(b,["prevent"]),class:"btn-2"},"Assign"),e("button",{onClick:d[3]||(d[3]=k(s=>x("cancelClick"),["prevent"])),class:"btn-3"},"Cancel")])])])):f("",!0),v.value&&!n.value?(i(),p("div",zt,[d[4]||(d[4]=e("div",{class:"py-2 px-4 font-bold text-center border-b shadow"},"Click to select task",-1)),e("div",Bt,[(i(!0),p(T,null,G(h.value,s=>(i(),p("div",{key:s.id,class:"w-full mb-2"},[e("button",{type:"button",class:"text-left text-base w-full bg-blue-50 px-2 hover:bg-blue-500 hover:text-white py-2 text-blue-500 font-semibold group flex items-center gap-2",onClick:k(()=>c(s),["prevent"])},[e("i",{class:F(["fad text-xl group:hover-text-white",(s==null?void 0:s.children_task_count)>0?"fa-folder text-blue-800/70":"fa-file-alt text-gray-400"])},null,2),e("div",Ht,[e("div",Wt,[e("div",Yt,g(s.title),1),s.requirement_detail_id&&v.value=="direct-assign"?(i(),p("div",Jt," Already assigned to a requirement ")):f("",!0)]),q(oe,{status:s.status,class:"ml-auto"},null,8,["status"])])],8,Gt)]))),128))])])):f("",!0)])}}},Qt={class:"container mx-auto p-6 print:p-0 w-full print:max-w-full"},Xt={class:"bg-white rounded shadow print:shadow-none p-4 print:p-0 relative"},Zt={class:"flex items-start"},es={class:"mb-4 text-lg print:black print:font-bold"},ts={class:"ml-auto print:hidden flex gap-2 items-center"},ss={class:"mb-4 flex items-center gap-1 print:mb-1"},ls={class:"font-bold print:text-gray-900"},rs={class:"mb-3 flex items-center gap-3 print:mb-1"},is={class:"print:text-gray-900"},ns={key:0,class:"mb-3 flex items-center gap-3 print:mb-1"},os={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},as={class:"mb-3 flex items-center gap-3 print:mb-1"},ds={class:"print:text-gray-900"},us={key:0,class:"overflow-x-auto print:overflow-visible"},ms={class:"w-full table-auto print:table-fixed"},ps={colspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap px-3 py-1 print:whitespace-normal w-[25%]"},cs={class:"whitespace-nowrap print:whitespace-break-spaces print:px-0 p-3 text-center border-2 border-gray-800"},bs={class:"text-gray-900 text-base"},vs={class:"mt-8 border rounded-md p-8 flex items-center justify-center bg-gray-50"},Us={__name:"RequirementShow",setup(_){const I=we(),y=ke(),x=w(""),a=w(null),v=z({open:!1}),n=z({detail:null,open:!1}),c=z({detail:null,open:!1});M(async()=>{await b()});async function b(){var u;x.value="loading",a.value=(u=(await Y(I.params.id)).data)==null?void 0:u.requirement,x.value=""}function h(u){console.log({detail:u}),o.modalShown=!0,o.from_department_id=a.value.from_department_id,o.to_department_id=a.value.to_department_id,o.taskDefaultValues={title:u.title,description:u.description,from_department_id:a.value.from_department_id,to_department_id:a.value.to_department_id},o.requirementDetail=u}function m(){v.open=!0}function d(u){n.open=!0,n.detail=u}function t(u){c.open=!0,c.detail=u}function s(){window.print()}const o=z({parentId:null,modalShown:!1,requirementId:0,taskDefaultValues:{},requirementDetail:null});async function r(){o.parentId=0,o.parentId=null,o.modalShown=!1,o.requirementDetail=null,x.value="loading",await b()}async function C(){o.parentId=null,o.modalShown=!1,o.requirementDetail=null}return(u,l)=>{var V,A,E,L,J,K,Q,X,Z,ee,te,se,le,re,ie;const R=me("RouterLink");return i(),p("div",Qt,[v.open?(i(),D(B,{key:0,class:"*:max-w-4xl"},{default:S(()=>[q(je,{requirementId:a.value.id,onCloseClick:l[0]||(l[0]=$=>v.open=!1),onCreate:l[1]||(l[1]=async()=>{v.open=!1,await b()})},null,8,["requirementId"])]),_:1})):f("",!0),n.open?(i(),D(B,{key:1},{default:S(()=>{var $;return[q(ct,{requirementId:a.value.id,detailId:($=n.detail)==null?void 0:$.id,onCloseClick:l[2]||(l[2]=O=>n.open=!1),onUpdate:l[3]||(l[3]=async()=>{n.open=!1,await b()})},null,8,["requirementId","detailId"])]}),_:1})):f("",!0),c.open?(i(),D(B,{key:2},{default:S(()=>{var $;return[q(Xe,{requirementId:a.value.id,detailId:($=c.detail)==null?void 0:$.id,onCloseClick:l[4]||(l[4]=O=>c.open=!1),onDelete:l[5]||(l[5]=async()=>{c.open=!1,await b()})},null,8,["requirementId","detailId"])]}),_:1})):f("",!0),o.modalShown?(i(),D(B,{key:3,class:"*:relative"},{default:S(()=>{var $,O;return[e("button",{onClick:k(C,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},l[8]||(l[8]=[e("i",{class:"fas fa-times-circle"},null,-1)])),o.parentId===null?(i(),D(Kt,{key:0,"from-department-id":($=a.value)==null?void 0:$.from_department_id,requirementDetail:o==null?void 0:o.requirementDetail,onParentIdSelect:l[6]||(l[6]=P=>o.parentId=P),onCancelClick:C,onAssignTask:r},null,8,["from-department-id","requirementDetail"])):(i(),D(qe,{key:1,parentTaskId:o.parentId,requirementDetailId:(O=o==null?void 0:o.requirementDetail)==null?void 0:O.id,requirementId:a.value.id,onClose:C,onTaskCreated:r,defaultValues:o.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["parentTaskId","requirementDetailId","requirementId","defaultValues"]))]}),_:1})):f("",!0),e("div",Xt,[e("div",Zt,[e("div",es,[l[9]||(l[9]=e("div",{class:"text-gray-800 leading-none"},"To",-1)),e("div",null,g((A=(V=a.value)==null?void 0:V.to_department)==null?void 0:A.name),1)]),e("div",ts,[(((E=a.value)==null?void 0:E.details)||[]).length>0?(i(),p("button",{key:0,class:"btn-3 font-semibold !pl-2 !pr-4",onClick:k(s,["prevent"])},l[10]||(l[10]=[e("i",{class:"fad fa-print text-xl"},null,-1),U("Print ")]))):f("",!0),e("button",{class:"btn-3",onClick:l[7]||(l[7]=k(()=>pe(y).back(),["prevent"]))},"Back"),q(R,{class:"btn-2",to:`/requirements/edit/${(L=a.value)==null?void 0:L.id}`},{default:S(()=>l[11]||(l[11]=[U("Edit")])),_:1,__:[11]},8,["to"])])]),l[24]||(l[24]=e("div",{class:"text-center text-xl font-bold mb-2 underline"},"Requirement Form",-1)),e("div",ss,[l[12]||(l[12]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",ls,g((J=a.value)==null?void 0:J.id),1)]),e("div",rs,[l[13]||(l[13]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),e("div",is,g((Q=(K=a.value)==null?void 0:K.from_department)==null?void 0:Q.name),1)]),((Z=(X=a.value)==null?void 0:X.website_tags)==null?void 0:Z.length)>0?(i(),p("div",ns,[l[14]||(l[14]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",os,[(i(!0),p(T,null,G(((ee=a.value)==null?void 0:ee.website_tags)||[],$=>(i(),p("div",{key:$.id,class:"border px-2 rounded-md bg-gray-50 shadow-sm whitespace-nowrap"},g($.name),1))),128))])])):f("",!0),e("div",as,[l[15]||(l[15]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",ds,g(new Date((te=a.value)==null?void 0:te.submission_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})),1)]),l[25]||(l[25]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[l[23]||(l[23]=e("div",{class:"flex items-end mb-3"},[e("h2",{class:"text-xl font-semibold"},"Requirements"),e("div",{class:"ml-auto print:hidden flex gap-2 text-sm"})],-1)),(((se=a.value)==null?void 0:se.details)||[]).length>0?(i(),p("div",us,[e("table",ms,[e("thead",null,[e("tr",null,[l[16]||(l[16]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-left px-4 text-gray-800 print:text-black text-xl font-semibold whitespace-nowrap w-[15%]"}," SL ",-1)),l[17]||(l[17]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base font-semibold whitespace-nowrap w-[65%]"}," Requirement Details ",-1)),l[18]||(l[18]=e("th",{rowspan:"2",class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-base px-3 font-semibold whitespace-nowrap print:whitespace-normal print:p-0 w-[15%]"}," Better To Complete ",-1)),e("th",ps," For '"+g(((le=a.value.to_department)==null?void 0:le.short_name)||((re=a.value.to_department)==null?void 0:re.name))+"' Use ",1)]),l[19]||(l[19]=e("tr",null,[e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal"}," Issue No "),e("td",{class:"border-2 border-gray-800 text-center text-gray-800 print:text-black text-sm font-semibold whitespace-nowrap p-3 print:whitespace-normal print:p-0"}," Expected Date ")],-1))]),e("tbody",null,[(i(!0),p(T,null,G(((ie=a.value)==null?void 0:ie.details)||[],($,O)=>{var P,ne;return i(),p(T,{key:$.id},[q(Vt,{requirement:a.value,detail:$,serial:O+1,onEditClick:d,onDeleteClick:t,onTaskCreateClick:h},null,8,["requirement","detail","serial"]),e("tr",null,[e("td",cs,[e("div",bs," For '"+g(((P=a.value.to_department)==null?void 0:P.short_name)||((ne=a.value.to_department)==null?void 0:ne.name))+"' Use ",1),l[20]||(l[20]=e("div",{class:"text-gray-800 text-xs"},"(Feedback)",-1))]),l[21]||(l[21]=e("td",{class:"whitespace-nowrap p-3 text-center border-2 border-gray-800",colspan:"4"},null,-1))])],64)}),128))])])])):f("",!0),e("div",vs,[e("button",{class:"btn-2 pl-2 text-base",onClick:k(m,["prevent"])},l[22]||(l[22]=[e("i",{class:"fad fa-plus-circle text-2xl mr-2"},null,-1),U("Add Requirement ")]))])]),x.value==="loading"?(i(),D(W,{key:1,class:"absolute inset-0 bg-opacity-90"})):f("",!0)])])}}};export{Us as default};
