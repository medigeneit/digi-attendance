import{d as se,b as Y,x as i,r as ae,e as oe,A as K,m as ne,c as d,o as a,a as l,g as M,f as N,F as j,n as D,i as B,t as F,k as w,h as $,B as re,S as P,v as ue,y as O,j as R,w as ie,q as J}from"./index-CqAksBNS.js";import{g as de}from"./task-YuBvlLw0.js";import{u as me}from"./company-CsM8a50S.js";import{_ as Q}from"./CompanyDepartmentSelectInput-BWcSg45C.js";import{_ as pe}from"./EmployeeDropdownInput-B1vjU1y6.js";import{_ as X,m as ce}from"./task-tree-BSa8lNqK.js";import{S as ve}from"./SelectDropdown-J3YuZeAq.js";import{_ as ye}from"./UserChip-BRd62vH2.js";import{_ as fe}from"./TaskTreeViewWithSubTable-DtvzHkFi.js";const xe={class:"mb-3 task-header"},be={class:"flex justify-between items-start"},ke={key:0,class:"ml-auto flex gap-6 items-center"},ge={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},we={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Ce={class:"relative"},Te=["title"],Ve={key:0},_e={key:1,class:"text-gray-500 whitespace-nowrap"},Ae={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Me={class:"relative"},he={class:"w-32 relative h-10"},Ue={class:"flex gap-4 items-center flex-shrink-0"},De={class:"flex gap-2"},Ee={class:"flex gap-2"},Le={class:"flex gap-2"},Se={class:"text-gray-600 w-full md:w-32 relative"},Be={class:"flex flex-col md:flex-row mb-2 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80"},$e={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},Ie={key:0,class:"text-[9px] text-green-800"},qe=["onClick"],Ne={key:1,class:"flex justify-end gap-5"},Ze={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(C,{emit:z}){const T=C,I=se(),p=Y(),V=i(k("company-id")),h=i(k("from-department-id")),_=i(k("to-department-id")),o=i(k("user-ids")),n=i(k("month")),m=i(k("status")),v=i(k("is-important")),A=i(k("is-urgent")),U=i(k("is-target")),y=i(k("search")),W=z,f=me(),E=ae([]);function k(r){return{get:()=>T.modelValue[r]||"",set:e=>{W("update:modelValue",{...T.modelValue,[r]:e||void 0})}}}const Z=i(()=>ee(o.value));async function H(){var r,e,x;if(!T.isMyTask){const b=(r=T.modelValue)==null?void 0:r["company-id"],s=_.value,c={...b?{company_id:b}:{},...s?{department_ids:[s]}:{}};E.value=((x=(e=await de({params:c}))==null?void 0:e.data)==null?void 0:x.employees)||[]}}oe(async()=>{await f.fetchCompanies({with:"departments",ignore_permission:!0}),await f.fetchMyCompanies({with:"departments"}),await H()});function ee(r){return Array.isArray(E.value)&&E.value.find(e=>e.id==r)||null}function te(){o.value=""}K(()=>_.value,H),K(()=>V.value,()=>{h.value="",_.value=""});function L(r,e,{value:x,id:b,label:s,onCancel:c}={}){if(!r)return[];const u=Array.isArray(e)?e.find(g=>(g==null?void 0:g[b])==r):null;return u?[{label:s,value:typeof x=="function"?x(u):u==null?void 0:u[x],id:u==null?void 0:u[b],onCancel:c}]:[]}const le=i(()=>{var b;const r=f.companies.reduce((s,c)=>[...s,...c.departments],[]),e=(s,{label:c,value:u,id:g,onCancel:q})=>s?[{label:c,value:u,id:g,onCancel:q}]:[],x=(s,{label:c,onCancel:u})=>{if(!s)return[];const g=new Date(s);return[{label:c,value:g.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:s,onCancel:u}]};return[...L(V.value,f.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{V.value=""}}),...L(h.value,r,{id:"id",label:"From",value:s=>s.short_name||s.name,onCancel:()=>{h.value=""}}),...L(_.value,r,{id:"id",label:"To",value:s=>s.short_name||s.name,onCancel:()=>{_.value=""}}),...L((b=Z.value)==null?void 0:b.id,E.value,{label:"Employee",value:"name",id:"id",onCancel:te}),...L(m.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{m.value=""}}),...e(v.value,{label:"",value:"Important ",id:!0,onCancel:()=>{v.value=""}}),...e(A.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{A.value=""}}),...e(U.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{U.value=""}}),...x(n.value,{label:"",onCancel:()=>{n.value=""}})]}),G=i(()=>V.value?f==null?void 0:f.companies.filter(r=>r.id==V.value):f==null?void 0:f.companies);return(r,e)=>{var b,s,c,u,g,q;const x=ne("RouterLink");return a(),d("div",null,[l("div",xe,[l("div",be,[e[12]||(e[12]=l("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),C.isMyTask?M("",!0):(a(),d("div",ke,[l("button",{onClick:e[0]||(e[0]=t=>W("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),l("div",ge,[l("div",we,[C.isMyTask?M("",!0):(a(),d(j,{key:0},[l("div",Ce,[D(ve,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),options:((b=w(f))==null?void 0:b.companies)||[],label:"name",id:"id",class:"border-2 border-gray-300 rounded h-[40px] w-full md:w-48 bg-white text-sm",clearable:""},{"selected-option":B(({option:t})=>[l("div",{class:"line-clamp-1 text-sm text-gray-900",title:t==null?void 0:t.name},[t!=null&&t.name?(a(),d("span",Ve,F(t==null?void 0:t.name),1)):(a(),d("span",_e,"--Select Company--"))],8,Te)]),_:1},8,["modelValue","options"]),e[13]||(e[13]=l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Company ",-1))]),D(Q,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=t=>h.value=t),companies:G.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300"},defaultOption:"--ALL DEPARTMENT--"},{label:B(()=>e[14]||(e[14]=[l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),w(p).name!=="MyTaskList"?(a(),N(Q,{key:0,modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t),companies:G.value||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-10 text-sm border-2 border-gray-300  "},defaultOption:"--ALL DEPARTMENT--"},{label:B(()=>e[15]||(e[15]=[l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):M("",!0),w(I).isAdminMood&&((c=(s=w(I))==null?void 0:s.user)==null?void 0:c.role)!=="employee"?(a(),d("div",Ae,[l("div",Me,[D(pe,{employees:E.value,modelValue:o.value,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value=t),class:"border-2 border-gray-300 rounded h-[40px] w-full bg-white !text-sm"},null,8,["employees","modelValue"]),e[16]||(e[16]=l("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Employee ",-1))]),e[17]||(e[17]=l("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):M("",!0)],64)),l("div",he,[e[19]||(e[19]=l("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),$(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>m.value=t),class:"h-full text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[18]||(e[18]=[l("option",{value:""},"--ALL TASKS--",-1),l("option",{value:"not-completed"},"Not Completed",-1),l("option",{value:"only-completed"},"Completed",-1)]),512),[[re,m.value]])]),l("div",Ue,[l("label",De,[$(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=t=>v.value=t)},null,512),[[P,v.value]]),e[20]||(e[20]=l("span",null,"Important",-1))]),l("label",Ee,[$(l("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=t=>A.value=t)},null,512),[[P,A.value]]),e[21]||(e[21]=l("span",null,"Urgent",-1))]),l("label",Le,[$(l("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=t=>U.value=t)},null,512),[[P,U.value]]),e[22]||(e[22]=l("span",null,"Is Target",-1))])]),l("div",Se,[e[23]||(e[23]=l("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),$(l("input",{id:"month-filter","onUpdate:modelValue":e[9]||(e[9]=t=>n.value=t),type:"month",class:"h-10 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[ue,n.value]])])]),C.isMyTask?(a(),N(X,{key:0,modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=t=>y.value=t),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):M("",!0)])]),l("div",Be,[C.isMyTask?M("",!0):(a(),N(X,{key:0,modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=t=>y.value=t),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),l("div",$e,[(a(!0),d(j,null,O(le.value,t=>(a(),d("div",{key:t.label||t.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[l("div",null,[t.label?(a(),d("span",Ie,F(t.label)+": ",1)):M("",!0),R(F(t.value),1)]),l("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:ie(t.onCancel,["prevent"])},e[24]||(e[24]=[l("i",{class:"fas fa-times-circle"},null,-1)]),8,qe)]))),128))]),C.isMyTask?M("",!0):(a(),d("div",Ne,[D(x,{class:J(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((u=w(p).query)==null?void 0:u.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...w(p).query,view:"userwise"}}},{default:B(()=>e[25]||(e[25]=[R(" User Wise List ")])),_:1,__:[25]},8,["class","to"]),D(x,{class:J(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((g=w(p).query)==null?void 0:g.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((q=w(p))==null?void 0:q.query)||{}).filter(t=>{var S;return((S=w(p))==null?void 0:S.query[t])!=="userwise"}).reduce((t,S)=>({...t,[S]:w(p).query[S]}),{})}}},{default:B(()=>e[26]||(e[26]=[R(" TaskWise List ")])),_:1,__:[26]},8,["class","to"])]))])])}}},je={class:"w-full"},ze={class:"w-full table-fixed bg-white rounded-md"},Fe={class:"border rounded-md align-top bg-blue-50"},Pe={key:0,class:"sticky top-16 py-2 px-2 z-40 bg-blue-100/70"},Re={class:"space-y-4 mt-4"},et={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null},isMyTask:{Boolean,default:!1}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(C,{emit:z}){const T=C,I=Y(),p=z,V=i(()=>T.tasks.reduce((o,n)=>(o.push(...n.users.filter(m=>!o.find(v=>v.id==m.id&&m.id))),o),[]).filter(o=>T.selectedUserId?o.id==T.selectedUserId:!0)),h=o=>{const m=T.tasks.filter(v=>v.users.some(A=>A.id===o));return ce(m,{...I.query,"user-ids":o})},_=i(()=>V.value.map(o=>{const n=h(o.id);return{...o,tasks:n}}));return(o,n)=>(a(),d("div",je,[l("table",ze,[l("tbody",null,[(a(!0),d(j,null,O(_.value,m=>{var v;return a(),d("tr",{key:m.id},[l("td",Fe,[l("div",null,[((v=m.tasks)==null?void 0:v.length)>0?(a(),d("div",Pe,[D(ye,{user:m,class:""},null,8,["user"])])):M("",!0),l("div",Re,[(a(!0),d(j,null,O(m.tasks,(A,U)=>(a(),N(fe,{key:A.id,task:A,class:"!border-0",index:U,isMyTask:C.isMyTask,onCommentButtonClick:n[0]||(n[0]=y=>p("commentButtonClick",o.item.id)),onEditClick:n[1]||(n[1]=y=>p("editClick",y)),onAddClick:n[2]||(n[2]=y=>p("addClick",y)),onEmployeeAssignClick:n[3]||(n[3]=y=>p("employeeAssignClick",y))},null,8,["task","index","isMyTask"]))),128))])])])])}),128))])])]))}};export{Ze as _,et as a};
