import{_ as ce}from"./CommentModal-Bi3iNAuA.js";import{_ as fe,a as ke}from"./TaskUserAssignForm-C-kuNS2C.js";import{L as xe}from"./LoaderView-CHFG83OG.js";import{O as Z}from"./OverlyModal-CSbJpvQG.js";import{_ as ge}from"./TaskAddForm-SsGzK7Nq.js";import{_ as be}from"./TaskEditForm-DeGLCCmP.js";import{d as de,b as ae,m as b,r as P,e as me,x as se,z as we,c as i,o as a,a as t,g as w,w as J,f as $,F as O,q as L,h as H,C as ne,n as G,t as Y,k as u,i as h,E as ee,v as Ce,j as te,p as le,u as Te,s as re}from"./index-C7GbwAhR.js";import{_ as Ae}from"./MultiselectDropdown-tLHri4VV.js";import{_ as ie,g as Ie,u as Ve}from"./task-priority-DZENH2Ce.js";import{u as Me}from"./company-DQ2SW4Gw.js";import{_ as ue}from"./CompanyDepartmentSelectInput-I4eWtaeW.js";import{_ as pe}from"./UserChip-C0UhC47q.js";import{_ as ye}from"./TaskTreeViewWithSubTable-bmmt2Z2F.js";import{m as ve}from"./task-tree-Da8PYs5l.js";import{u as Le}from"./useTaskStore-DNrLhhmi.js";import"./useCommentStore-DTdzFHCX.js";import"./datetime-DLUp6MRA.js";import"./TextWithHr-DtH00Imu.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgencyInput-C0F6_R8p.js";import"./TaskUserChip-CtJq3Tzz.js";import"./RequiredIcon-B6bLRj9A.js";import"./useRequirementStore-GikOteuW.js";import"./requirement-CmLfClyZ.js";import"./SectionLoading-16NReUk0.js";import"./tags-DuONQppf.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-k4EceWM7.js";import"./url-CePbr-gY.js";import"./TaskSupervisorAndEmployee-BPAT-yNQ.js";const qe={class:"mb-3 task-header"},_e={class:"flex justify-between items-start mb-4"},Ue={key:0,class:"ml-auto flex gap-6 items-center"},Se={key:0,class:"flex gap-2 items-center"},$e={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},he={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Ee={class:"relative w-full md:w-48 flex-grow"},De=["value"],Pe={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Oe={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},Be={class:"w-32 relative h-8"},Ne={class:"flex gap-4 items-center flex-shrink-0"},Fe={class:"flex gap-2"},je={class:"flex gap-2"},Re={class:"flex gap-2"},ze={class:"text-gray-600 w-full md:w-32 relative"},He={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},We={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},Ye={key:0,class:"text-[9px] text-green-800"},Ge=["onClick"],Ke={key:1,class:"flex justify-end gap-5"},Je={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(q,{emit:I}){const v=q,m=de(),T=ae(),C=b(x("company-id")),_=b(x("from-department-id")),V=b(x("to-department-id")),c=b(x("user-ids")),n=b(x("month")),p=b(x("status")),k=b(x("is-important")),y=b(x("is-urgent")),M=b(x("is-target")),B=b(x("search")),j=I,S=Me(),E=P([]);function x(d){return{get:()=>v.modelValue[d]||"",set:e=>{j("update:modelValue",{...v.modelValue,[d]:e||void 0})}}}const N=b(()=>K(c.value));async function R(){var d,e,o;if(!v.isMyTask){const s=(d=v.modelValue)==null?void 0:d["company-id"],f=V.value,A={...s?{company_id:s}:{},...f?{department_ids:[f]}:{}};E.value=((o=(e=await Ie({params:A}))==null?void 0:e.data)==null?void 0:o.employees)||[]}}me(async()=>{await R(),await S.fetchCompanies({with:"departments",ignore_permission:!0}),await S.fetchMyCompanies({with:"departments"})});function K(d){return Array.isArray(E.value)&&E.value.find(e=>e.id==d)||null}function Q(d){c.value=(d==null?void 0:d.id)||""}function z(){c.value=""}se(()=>V.value,R),se(()=>C.value,()=>{V.value!==""?V.value="":R()});function F(d,e,{value:o,id:s,label:f,onCancel:A}={}){if(!d)return[];const g=Array.isArray(e)?e.find(r=>(r==null?void 0:r[s])==d):null;return g?[{label:f,value:g==null?void 0:g[o],id:g==null?void 0:g[s],onCancel:A}]:[]}const X=b(()=>{var s;const d=S.companies.reduce((f,A)=>[...f,...A.departments],[]),e=(f,{label:A,value:g,id:r,onCancel:D})=>f?[{label:A,value:g,id:r,onCancel:D}]:[],o=(f,{label:A,onCancel:g})=>{if(!f)return[];const r=new Date(f);return[{label:A,value:r.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:f,onCancel:g}]};return[...F(C.value,S.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{C.value=""}}),...F(_.value,d,{label:"From",value:"short_name",id:"id",onCancel:()=>{_.value=""}}),...F(V.value,d,{label:"To",value:"short_name",id:"id",onCancel:()=>{V.value=""}}),...F((s=N.value)==null?void 0:s.id,E.value,{label:"Employee",value:"name",id:"id",onCancel:z}),...F(p.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{p.value=""}}),...e(k.value,{label:"",value:"Important ",id:!0,onCancel:()=>{k.value=""}}),...e(y.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{y.value=""}}),...e(M.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{M.value=""}}),...o(n.value,{label:"",onCancel:()=>{n.value=""}})]});return(d,e)=>{var s,f,A,g,r,D,U,oe;const o=we("RouterLink");return a(),i(O,null,[t("div",qe,[t("div",_e,[e[14]||(e[14]=t("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),q.isMyTask?w("",!0):(a(),i("div",Ue,[q.listHasRearranged?(a(),i("div",Se,[e[13]||(e[13]=t("span",{class:"text-red-500"},"Priority Changed",-1)),t("button",{class:"btn-3",onClick:e[0]||(e[0]=J(l=>j("clickPrioritySave"),["prevent"]))},"Save"),t("button",{class:"btn-3",onClick:e[1]||(e[1]=J(l=>j("clickPriorityDiscard"),["prevent"]))},"Discard")])):w("",!0),t("button",{onClick:e[2]||(e[2]=l=>j("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),t("div",$e,[t("div",he,[q.isMyTask?w("",!0):(a(),i(O,{key:0},[t("div",Ee,[e[16]||(e[16]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),H(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[e[15]||(e[15]=t("option",{value:""},"--ALL COMPANY--",-1)),(a(!0),i(O,null,G((s=u(S))==null?void 0:s.myCompanies,l=>(a(),i("option",{key:l.id,value:l.id},Y(l.name),9,De))),128))],512),[[ne,C.value]])]),L(ue,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=l=>_.value=l),companies:((f=u(S))==null?void 0:f.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:h(()=>e[17]||(e[17]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),u(T).name!=="MyTaskList"?(a(),$(ue,{key:0,modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=l=>V.value=l),companies:((A=u(S))==null?void 0:A.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:h(()=>e[18]||(e[18]=[t("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):w("",!0),u(m).isAdminMood&&((r=(g=u(m))==null?void 0:g.user)==null?void 0:r.role)!=="employee"?(a(),i("div",Pe,[L(Ae,{modelValue:N.value,onSelect:Q,onRemove:z,options:E.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:h(({option:l})=>[L(pe,{user:l,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),N.value?(a(),i("div",Oe,[t("button",{onClick:J(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):w("",!0),e[19]||(e[19]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):w("",!0)],64)),t("div",Be,[e[21]||(e[21]=t("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),H(t("select",{"onUpdate:modelValue":e[6]||(e[6]=l=>p.value=l),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},e[20]||(e[20]=[t("option",{value:""},"--ALL TASKS--",-1),t("option",{value:"not-completed"},"Not Completed",-1),t("option",{value:"only-completed"},"Completed",-1)]),512),[[ne,p.value]])]),t("div",Ne,[t("label",Fe,[H(t("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>k.value=l)},null,512),[[ee,k.value]]),e[22]||(e[22]=t("span",null,"Important",-1))]),t("label",je,[H(t("input",{type:"checkbox","onUpdate:modelValue":e[8]||(e[8]=l=>y.value=l)},null,512),[[ee,y.value]]),e[23]||(e[23]=t("span",null,"Urgent",-1))]),t("label",Re,[H(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=l=>M.value=l)},null,512),[[ee,M.value]]),e[24]||(e[24]=t("span",null,"Is Target",-1))])]),t("div",ze,[e[25]||(e[25]=t("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),H(t("input",{id:"month-filter","onUpdate:modelValue":e[10]||(e[10]=l=>n.value=l),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[Ce,n.value]])])]),q.isMyTask?(a(),$(ie,{key:0,modelValue:B.value,"onUpdate:modelValue":e[11]||(e[11]=l=>B.value=l),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):w("",!0)])]),t("div",He,[q.isMyTask?w("",!0):(a(),$(ie,{key:0,modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=l=>B.value=l),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),t("div",We,[(a(!0),i(O,null,G(X.value,l=>(a(),i("div",{key:l.label||l.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[t("div",null,[l.label?(a(),i("span",Ye,Y(l.label)+": ",1)):w("",!0),te(Y(l.value),1)]),t("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:J(l.onCancel,["prevent"])},e[26]||(e[26]=[t("i",{class:"fas fa-times-circle"},null,-1)]),8,Ge)]))),128))]),q.isMyTask?w("",!0):(a(),i("div",Ke,[L(o,{class:le(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((D=u(T).query)==null?void 0:D.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...u(T).query,view:"userwise"}}},{default:h(()=>e[27]||(e[27]=[te(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),L(o,{class:le(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((U=u(T).query)==null?void 0:U.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((oe=u(T))==null?void 0:oe.query)||{}).filter(l=>{var W;return((W=u(T))==null?void 0:W.query[l])!=="userwise"}).reduce((l,W)=>({...l,[W]:u(T).query[W]}),{})}}},{default:h(()=>e[28]||(e[28]=[te(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},Qe={class:"w-full bg-white rounded"},Xe=["rowspan"],Ze={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(q,{emit:I}){const v=q,m=ae(),T=I,C=b(()=>v.tasks.reduce((c,n)=>(c.push(...n.users.filter(p=>!c.find(k=>k.id==p.id&&p.id))),c),[]).filter(c=>v.selectedUserId?c.id==v.selectedUserId:!0)),_=c=>{const p=v.tasks.filter(k=>k.users.some(y=>y.id===c));return ve(p,{...m.query,"user-ids":c})},V=b(()=>C.value.map(c=>{const n=_(c.id);return{...c,tasks:n}}));return(c,n)=>(a(),i("div",null,[t("table",Qe,[t("tbody",null,[(a(!0),i(O,null,G(V.value,p=>(a(),i(O,{key:p.id},[(a(!0),i(O,null,G(p.tasks,(k,y)=>(a(),i("tr",{key:k.id},[y==0?(a(),i("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(p.tasks.length,1)},[L(pe,{user:p,class:"sticky top-[8rem]"},null,8,["user"])],8,Xe)):w("",!0),t("td",{class:le(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":y==0,"border-b":p.tasks.length-1===y}])},[L(ye,{task:k,class:"!border-0 my-0",index:y,onCommentButtonClick:n[0]||(n[0]=M=>T("commentButtonClick",c.item.id)),onEditClick:n[1]||(n[1]=M=>T("editClick",M)),onAddClick:n[2]||(n[2]=M=>T("addClick",M)),onEmployeeAssignClick:n[3]||(n[3]=M=>T("employeeAssignClick",M))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},et={class:"max-w-full mx-4 p-6 mt-2 relative bg-white rounded-md shadow-md"},tt={class:"mb-4"},st={class:"relative min-h-[30vh]"},lt={key:0,class:"text-center py-4 text-red-500"},at={key:1},ot={class:"flex items-stretched"},nt={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},rt=1,Pt={__name:"TaskList",setup(q){const I=Le(),v=de(),m=ae(),T=Te(),C=P(""),_=P(!1),V=P(null),c=b(()=>{var o;return((o=v==null?void 0:v.user)==null?void 0:o.role)==="employee"||!(v!=null&&v.isAdminMood)?!0:!!m.query["user-ids"]}),n=P(null),p=P(!1),k=re({parentId:0,requirementId:0}),y=re({taskId:0,isOpen:!1}),M=P(null),B=P([]),{handleItemsPriorityUpdate:j,saveTaskPriority:S,listHasRearranged:E}=Ve(()=>I.taskListTree,0);me(async()=>{C.value="loading",m.query.status?await x():T.push({query:{...m.query,status:"not-completed"}})});async function x(){let o;m.name==="MyTaskList"?o=await I.fetchMyTasks({...m.query,page:1}):o=await I.fetchTasks({...m.query,page:1},{infiniteScrolling:!1}),C.value="",B.value=o.query_log||[]}const N=o=>{p.value=!0,k.parentId=o},R=o=>{y.taskId=o,y.isOpen=!0},K=o=>{V.value=o,_.value=!0},Q=()=>{_.value=!1,V.value=null};async function z(){n.value=null,p.value=!1,k.parentId=0,C.value="loading",await x()}async function F(){p.value=!1,k.parentId=0,await x()}async function X(){C.value="loading",await S()&&await x()}se(()=>({...m.query}),async()=>{I.resetTaskList(),C.value="loading",await x()});const d=b({get(){return{...m.query}},set(o){localStorage.removeItem("sub_task_opened_list"),T.push({query:{...o}})}}),e=b(()=>{var s;const o={...m.query};return m.name=="MyTaskList"&&(o["user-ids"]=(s=v==null?void 0:v.user)==null?void 0:s.id),Array.isArray(I.tasks)?ve(I.tasks,o):[]});return(o,s)=>{var f,A,g;return a(),i("div",et,[n.value?(a(),$(Z,{key:0},{default:h(()=>[L(be,{taskId:n.value,onClose:s[0]||(s[0]=r=>n.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):w("",!0),p.value?(a(),$(Z,{key:1},{default:h(()=>[L(ge,{parentTaskId:k.parentId,requirementId:k.requirementId,onClose:F,onTaskCreated:z},null,8,["parentTaskId","requirementId"])]),_:1})):w("",!0),y.isOpen?(a(),$(Z,{key:2,class:"*:max-w-4xl"},{default:h(()=>[L(fe,{taskId:y.taskId,onCancelClick:s[1]||(s[1]=()=>{y.isOpen=!1,y.taskId=0}),onSuccess:s[2]||(s[2]=()=>{y.isOpen=!1,y.taskId=0,C.value="loading",x()})},null,8,["taskId"])]),_:1})):w("",!0),L(Je,{modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=r=>d.value=r),onClickAddTask:N,onClickPrioritySave:X,onClickPriorityDiscard:s[4]||(s[4]=()=>u(E)?M.value.resetItems:null),"list-has-rearranged":u(E),isMyTask:u(m).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((A=(f=u(m))==null?void 0:f.query)==null?void 0:A["query-log"])=="true"?(a(!0),i(O,{key:3},G(B.value,(r,D)=>(a(),i("div",{key:D,class:"text-xs text-gray-500"},[t("div",tt,Y(r.raw_query),1)]))),128)):w("",!0),t("div",st,[u(I).error?(a(),i("div",lt,Y(u(I).error),1)):u(I).tasks.length>0?(a(),i("div",at,[((g=u(m).query)==null?void 0:g.view)=="userwise"?(a(),$(Ze,{key:0,tasks:e.value,selectedUserId:u(m).query["user-ids"],onCommentButtonClick:s[5]||(s[5]=r=>K(r,o.task.id)),onEditClick:s[6]||(s[6]=r=>n.value=r),onAddClick:s[7]||(s[7]=r=>N(r)),onEmployeeAssignClick:s[8]||(s[8]=r=>R(r))},null,8,["tasks","selectedUserId"])):(a(),$(ke,{key:1,items:e.value,handle:"handle",onItemsUpdate:u(j),class:"space-y-6",ref_key:"draggableTaskList",ref:M},{item:h(({item:r,index:D})=>[t("div",ot,[L(ye,{"is-my-task":u(m).name==="MyTaskList",task:r,index:D,showDraggableHandle:!c.value,onCommentButtonClick:s[9]||(s[9]=U=>K(U,o.task.id)),onEditClick:s[10]||(s[10]=U=>n.value=U),onAddClick:s[11]||(s[11]=U=>N(U)),onEmployeeAssignClick:s[12]||(s[12]=U=>R(U)),class:"!border-0 shadow hover:shadow-md"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):C.value!=="loading"?(a(),i("div",nt," No tasks found. ")):w("",!0),C.value==="loading"?(a(),$(xe,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):w("",!0)]),L(ce,{show:_.value,"commentable-id":V.value,"commentable-type":"task","user-id":rt,"on-close":Q,onSubmitted:u(I).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Pt as default};
