import{_ as Te}from"./CommentModal-CeHidEQM.js";import{_ as $e,a as _e}from"./TaskUserAssignForm-nNbldV6N.js";import{L as Ae}from"./LoaderView-CSLKSot7.js";import{O as le}from"./OverlyModal-Cw8NkKgk.js";import{_ as Ie}from"./TaskAddForm-CjzAxclI.js";import{_ as Se}from"./TaskEditForm-D5TL1bfk.js";import{r as E,m as g,c as n,o as s,a as e,h as Y,v as me,g as r,w as F,d as ce,b as oe,e as pe,x as se,z as fe,f as V,F as P,q as T,C as re,n as Q,t as A,k as y,i as B,K as ae,j as D,p as G,H as Le,u as Ve,s as ie}from"./index-DCl4ypSB.js";import{_ as Me}from"./MultiselectDropdown-B4ZsamJ2.js";import{g as De,u as qe,m as Ee}from"./task-tree-hHAPW4Y1.js";import{u as Ue}from"./company-Ck5ue3ZB.js";import{_ as de}from"./CompanyDepartmentSelectInput-D1qqDUSu.js";import{_ as ye}from"./UserChip-DN-8V7Dt.js";import{_ as ke,a as Be,b as ve,c as ge,T as xe,d as be,e as Pe}from"./TaskUrgentBadge-C-D9CinP.js";import{b as he,a as te}from"./datetime-BlGg5F0U.js";import{o as Oe}from"./url-CePbr-gY.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as je}from"./useTaskStore-BOzShdI4.js";import"./useCommentStore-CgQcD9qb.js";import"./TextWithHr-DyyU1jUh.js";import"./TaskUrgencyInput-D_LRfidD.js";import"./TaskUserChip-C29aQWqS.js";import"./RequiredIcon-_8K_wesV.js";import"./useRequirementStore-BP67CDGK.js";import"./requirement-6CbNXIR2.js";import"./SectionLoading-eaO9YJdX.js";import"./tags-B7VjK9oP.js";const Re={class:"text-gray-600 relative"},Fe={class:"absolute right-2 top-[50%] translate-y-[-50%] flex gap-1"},ue={__name:"SearchInput",props:{modelValue:String},emits:["update:modelValue"],setup(l,{emit:C}){const m=l,c=E(),$=C,f=k=>{$("update:modelValue",k||void 0)};let S=0;const p=g({get(){return m.modelValue},set(k){clearTimeout(S),S=setTimeout(f,500,k)}});return(k,a)=>(s(),n("div",Re,[a[3]||(a[3]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Search",-1)),Y(e("input",{ref_key:"searchInput",ref:c,id:"search","onUpdate:modelValue":a[0]||(a[0]=b=>p.value=b),type:"text",class:"!pr-7 w-full rounded-md px-2 py-1 border-2 border-gray-400 placeholder:text-sm focus:outline-gray-400",placeholder:"Search by main task title"},null,512),[[me,p.value]]),e("div",Fe,[p.value?(s(),n("i",{key:0,class:"fas fa-times opacity-35 hover:opacity-60 cursor-pointer",onClick:a[1]||(a[1]=F(()=>{f(""),c.value.focus()},["prevent"]))})):r("",!0),a[2]||(a[2]=e("i",{class:"fas fa-search opacity-80"},null,-1))])]))}},He={class:"mb-3 task-header"},ze={class:"flex justify-between items-start mb-4"},We={key:0,class:"ml-auto flex gap-6 items-center"},Ke={key:0,class:"flex gap-2 items-center"},Ge={class:"flex flex-wrap items-center justify-center gap-2 mt-3"},Je={class:"flex flex-wrap gap-x-4 gap-y-3 justify-between"},Ye={class:"relative w-full md:w-48 flex-grow"},Qe=["value"],Xe={key:1,class:"relative w-full md:w-56 lg:flex-grow"},Ze={key:0,class:"absolute right-8 text-xl top-0 bottom-0 flex items-center"},et={class:"w-32 relative h-8"},tt={class:"flex gap-4 items-center flex-shrink-0"},st={class:"flex gap-2"},lt={class:"flex gap-2"},at={class:"flex gap-2"},ot={class:"text-gray-600 w-full md:w-32 relative"},nt={class:"flex flex-col md:flex-row mb-2 md:mb-4 items-end mt-6 gap-6 sticky top-[4.1rem] z-40 bg-white/80 py-2"},rt={class:"flex items-center gap-3 flex-grow flex-wrap justify-center"},it={key:0,class:"text-[9px] text-green-800"},dt=["onClick"],ut={key:1,class:"flex justify-end gap-5"},mt={__name:"TaskHeader",props:{modelValue:{type:Object,default:()=>({})},listHasRearranged:{type:Boolean,default:!1},isMyTask:{type:Boolean,default:!1}},emits:["update:modelValue","clickPrioritySave","clickPriorityDiscard","clickAddTask"],setup(l,{emit:C}){const m=l,c=ce(),$=oe(),f=g(o("company-id")),S=g(o("from-department-id")),p=g(o("to-department-id")),k=g(o("user-ids")),a=g(o("month")),b=g(o("status")),_=g(o("is-important")),w=g(o("is-urgent")),O=g(o("is-target")),N=g(o("search")),W=C,q=Ue(),v=E([]);function o(h){return{get:()=>m.modelValue[h]||"",set:t=>{W("update:modelValue",{...m.modelValue,[h]:t||void 0})}}}const U=g(()=>J(k.value));async function H(){var h,t,i;if(!m.isMyTask){const d=(h=m.modelValue)==null?void 0:h["company-id"],I=p.value,M={...d?{company_id:d}:{},...I?{department_ids:[I]}:{}};v.value=((i=(t=await De({params:M}))==null?void 0:t.data)==null?void 0:i.employees)||[]}}pe(async()=>{await H(),await q.fetchCompanies({with:"departments",ignore_permission:!0}),await q.fetchMyCompanies({with:"departments"})});function J(h){return Array.isArray(v.value)&&v.value.find(t=>t.id==h)||null}function X(h){k.value=(h==null?void 0:h.id)||""}function z(){k.value=""}se(()=>p.value,H),se(()=>f.value,()=>{p.value!==""?p.value="":H()});function j(h,t,{value:i,id:d,label:I,onCancel:M}={}){if(!h)return[];const L=Array.isArray(t)?t.find(x=>(x==null?void 0:x[d])==h):null;return L?[{label:I,value:L==null?void 0:L[i],id:L==null?void 0:L[d],onCancel:M}]:[]}const Z=g(()=>{var d;const h=q.companies.reduce((I,M)=>[...I,...M.departments],[]),t=(I,{label:M,value:L,id:x,onCancel:K})=>I?[{label:M,value:L,id:x,onCancel:K}]:[],i=(I,{label:M,onCancel:L})=>{if(!I)return[];const x=new Date(I);return[{label:M,value:x.toLocaleDateString("en-US",{month:"long",year:"numeric"}),id:I,onCancel:L}]};return[...j(f.value,q.companies,{label:"Company",value:"short_name",id:"id",onCancel:()=>{f.value=""}}),...j(S.value,h,{label:"From",value:"short_name",id:"id",onCancel:()=>{S.value=""}}),...j(p.value,h,{label:"To",value:"short_name",id:"id",onCancel:()=>{p.value=""}}),...j((d=U.value)==null?void 0:d.id,v.value,{label:"Employee",value:"name",id:"id",onCancel:z}),...j(b.value,[{id:"only-completed",name:"Completed Only"},{id:"not-completed",name:"Not Completed"}],{label:"",value:"name",id:"id",onCancel:()=>{b.value=""}}),...t(_.value,{label:"",value:"Important ",id:!0,onCancel:()=>{_.value=""}}),...t(w.value,{label:"",value:"Urgent ",id:!0,onCancel:()=>{w.value=""}}),...t(O.value,{label:"",value:"Targeted Task",id:!0,onCancel:()=>{O.value=""}}),...i(a.value,{label:"",onCancel:()=>{a.value=""}})]});return(h,t)=>{var d,I,M,L,x,K,R,ne;const i=fe("RouterLink");return s(),n(P,null,[e("div",He,[e("div",ze,[t[14]||(t[14]=e("h2",{class:"text-2xl font-bold text-gray-800 leading-none h-10"},"Task List",-1)),l.isMyTask?r("",!0):(s(),n("div",We,[l.listHasRearranged?(s(),n("div",Ke,[t[13]||(t[13]=e("span",{class:"text-red-500"},"Priority Changed",-1)),e("button",{class:"btn-3",onClick:t[0]||(t[0]=F(u=>W("clickPrioritySave"),["prevent"]))},"Save"),e("button",{class:"btn-3",onClick:t[1]||(t[1]=F(u=>W("clickPriorityDiscard"),["prevent"]))},"Discard")])):r("",!0),e("button",{onClick:t[2]||(t[2]=u=>W("clickAddTask")),class:"btn-1"},"Add Main Task / Project")]))]),e("div",Ge,[e("div",Je,[l.isMyTask?r("",!0):(s(),n(P,{key:0},[e("div",Ye,[t[16]||(t[16]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Company ",-1)),Y(e("select",{"onUpdate:modelValue":t[3]||(t[3]=u=>f.value=u),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},[t[15]||(t[15]=e("option",{value:""},"--ALL COMPANY--",-1)),(s(!0),n(P,null,Q((d=y(q))==null?void 0:d.myCompanies,u=>(s(),n("option",{key:u.id,value:u.id},A(u.name),9,Qe))),128))],512),[[re,f.value]])]),T(de,{modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=u=>S.value=u),companies:((I=y(q))==null?void 0:I.companies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400"},defaultOption:"--ALL DEPARTMENT--"},{label:B(()=>t[17]||(t[17]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task From Department ",-1)])),_:1},8,["modelValue","companies"]),y($).name!=="MyTaskList"?(s(),V(de,{key:0,modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=u=>p.value=u),companies:((M=y(q))==null?void 0:M.myCompanies)||[],class:"relative w-full md:w-40 flex-grow",className:{select:"h-8 text-xs px-2 text-gray-600  border-2 border-gray-400  "},defaultOption:"--ALL DEPARTMENT--"},{label:B(()=>t[18]||(t[18]=[e("div",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 leading-none z-30"}," Task To Department ",-1)])),_:1},8,["modelValue","companies"])):r("",!0),y(c).isAdminMood&&((x=(L=y(c))==null?void 0:L.user)==null?void 0:x.role)!=="employee"?(s(),n("div",Xe,[T(Me,{modelValue:U.value,onSelect:X,onRemove:z,options:v.value,multiple:!1,label:"name","label-prefix":"id",placeholder:"--ALL EMPLOYEES--",class:"text-gray-600 w-full relative text-xs"},{option:B(({option:u})=>[T(ye,{user:u,class:"w-full line-clamp-1"},null,8,["user"])]),_:1},8,["modelValue","options"]),U.value?(s(),n("div",Ze,[e("button",{onClick:F(z,["prevent"]),class:"mt-0.5 text-gray-500 hover:text-red-700"}," Ã— ")])):r("",!0),t[19]||(t[19]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500 z-50"}," Employee ",-1))])):r("",!0)],64)),e("div",et,[t[21]||(t[21]=e("label",{class:"absolute text-xs left-3 -top-1.5 bg-slate-100 text-blue-500"},"Status",-1)),Y(e("select",{"onUpdate:modelValue":t[6]||(t[6]=u=>b.value=u),class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full"},t[20]||(t[20]=[e("option",{value:""},"--ALL TASKS--",-1),e("option",{value:"not-completed"},"Not Completed",-1),e("option",{value:"only-completed"},"Completed",-1)]),512),[[re,b.value]])]),e("div",tt,[e("label",st,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=u=>_.value=u)},null,512),[[ae,_.value]]),t[22]||(t[22]=e("span",null,"Important",-1))]),e("label",lt,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=u=>w.value=u)},null,512),[[ae,w.value]]),t[23]||(t[23]=e("span",null,"Urgent",-1))]),e("label",at,[Y(e("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=u=>O.value=u)},null,512),[[ae,O.value]]),t[24]||(t[24]=e("span",null,"Is Target",-1))])]),e("div",ot,[t[25]||(t[25]=e("label",{class:"absolute text-xs left-2.5 -top-1.5 bg-slate-100 text-blue-500"},"Month",-1)),Y(e("input",{id:"month-filter","onUpdate:modelValue":t[10]||(t[10]=u=>a.value=u),type:"month",class:"h-8 text-xs px-2 text-gray-600 border-2 border-gray-400 rounded-md w-full",placeholder:"All month"},null,512),[[me,a.value]])])]),l.isMyTask?(s(),V(ue,{key:0,modelValue:N.value,"onUpdate:modelValue":t[11]||(t[11]=u=>N.value=u),class:"w-full md:w-64 lg:w-64 md:ml-auto"},null,8,["modelValue"])):r("",!0)])]),e("div",nt,[l.isMyTask?r("",!0):(s(),V(ue,{key:0,modelValue:N.value,"onUpdate:modelValue":t[12]||(t[12]=u=>N.value=u),class:"w-full md:w-64 md:ml-auto"},null,8,["modelValue"])),e("div",rt,[(s(!0),n(P,null,Q(Z.value,u=>(s(),n("div",{key:u.label||u.value,class:"flex-shrink-0 text-xs bg-gray-50 border border-gray-300 rounded-md px-2 flex gap-1"},[e("div",null,[u.label?(s(),n("span",it,A(u.label)+": ",1)):r("",!0),D(A(u.value),1)]),e("button",{type:"button",class:"text-gray-400 hover:text-red-400",onClick:F(u.onCancel,["prevent"])},t[26]||(t[26]=[e("i",{class:"fas fa-times-circle"},null,-1)]),8,dt)]))),128))]),l.isMyTask?r("",!0):(s(),n("div",ut,[T(i,{class:G(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((K=y($).query)==null?void 0:K.view)==="userwise"?"bg-blue-500 text-white":""]),to:{query:{...y($).query,view:"userwise"}}},{default:B(()=>t[27]||(t[27]=[D(" User Wise List ")])),_:1,__:[27]},8,["class","to"]),T(i,{class:G(["text-xs sm:text-sm btn-3 py-0.5 flex-shrink-0",((R=y($).query)==null?void 0:R.view)!=="userwise"?"bg-blue-500 text-white":""]),to:{query:{...Object.keys(((ne=y($))==null?void 0:ne.query)||{}).filter(u=>{var ee;return((ee=y($))==null?void 0:ee.query[u])!=="userwise"}).reduce((u,ee)=>({...u,[ee]:y($).query[ee]}),{})}}},{default:B(()=>t[28]||(t[28]=[D(" TaskWise List ")])),_:1,__:[28]},8,["class","to"])]))])],64)}}},ct={},pt={class:"border rounded-full px-2 bg-blue-500/60 text-white flex items-center text-sm"};function ft(l,C){return s(),n("div",pt,C[0]||(C[0]=[e("i",{class:"fas fa-lock mr-2 text-sm"},null,-1),D("CLOSED ")]))}const we=Ne(ct,[["render",ft]]),yt={class:"mt-3 -mx-3"},kt={class:"w-full"},vt={class:"border-y pr-2 pl-8 py-4 border-gray-300"},gt={class:"mb-1 flex items-center gap-3"},xt={key:0,class:"text-base font-semibold text-purple-600"},bt={class:"flex items-center flex-none lg:w-full order-0 lg:order-1 mb-2"},ht={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},wt={class:"text-gray-400 text-xs"},Ct={class:"border-y px-2 py-4 border-gray-300"},Tt={class:"flex"},$t={class:"border-y py-4 pl-2 pr-4 border-gray-300"},_t={class:"flex justify-end gap-2"},At={key:0},It={colspan:"10",class:"py-2 px-8"},St={class:"text-sm"},Lt={key:0,class:"text-red-800 italic"},Vt={__name:"TaskTreeChildrenTable",props:{childrenTasks:{type:Array,required:!0,default:()=>[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number},maxItem:{Number,default:2}},emits:["editClick","addClick","employeeAssignClick"],setup(l,{emit:C}){const m=l,c=E(!1),$=g(()=>c.value?m.childrenTasks:m.childrenTasks.slice(0,m.maxItem)),f=g(()=>c.value?[]:m.childrenTasks.slice(m.maxItem));function S(){c.value=!c.value}return(p,k)=>(s(),n("div",yt,[e("table",kt,[e("tbody",null,[(s(!0),n(P,null,Q($.value,(a,b)=>(s(),n("tr",{key:a.id,class:G(["",{" bg-lime-400/20":a.status=="COMPLETED"," bg-slate-100 hover:bg-slate-200/60":a.status!=="COMPLETED"}])},[e("td",vt,[e("div",gt,[b!==void 0?(s(),n("div",xt,A(b+1)+". ",1)):r("",!0),T(ke,{titleClass:"text-sm",task:a,"sub-tasks-open":!1,"is-my-task":p.isMyTask},null,8,["task","is-my-task"])]),e("div",bt,[e("div",ht,[a!=null&&a.is_important?(s(),V(xe,{key:0})):r("",!0),a!=null&&a.is_urgent?(s(),V(be,{key:1})):r("",!0)])]),e("div",wt,[k[0]||(k[0]=e("i",{class:"fas fa-clock"},null,-1)),D(" "+A(y(he)(a.created_at)),1)])]),e("td",Ct,[e("div",Tt,[T(Be,{class:"flex items-center justify-center flex-wrap gap-x-3 gap-y-2",users:a.users||[],isTargetTask:a.is_target,maxItem:1},null,8,["users","isTargetTask"])])]),e("td",$t,[e("div",_t,[a.closed_at?(s(),V(we,{key:0})):r("",!0),T(ve,{status:a==null?void 0:a.status,progressPercent:(a==null?void 0:a.progress_percent)||0},null,8,["status","progressPercent"]),T(ge,{ref_for:!0,ref:"progress",task:a,class:"text-sm"},null,8,["task"])])])],2))),128)),l.childrenTasks.length>0?(s(),n("tr",At,[e("td",It,[e("div",St,[f.value.length>0?(s(),n("span",Lt,A(f.value.length)+" More sub task"+A(f.value.length>1?"s":""),1)):r("",!0),f.value.length>0||c.value?(s(),n("button",{key:1,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent ml-2",onClick:F(S,["prevent","stop"])},A(c.value?"Hide":"Show")+" All ",1)):r("",!0)])])])):r("",!0)])])]))}},Mt={class:"flex w-full text-gray-800"},Dt={key:0,class:"border-l border-gray-200 last:border-l-0"},qt={class:"items-start grid grid-cols-4 gap-4 group"},Et={class:"col-span-full md:col-span-full border-b -mx-3 px-3 pt-3 shadow-md shadow-slate-100 flex flex-wrap bg-white z-30"},Ut={class:"flex items-start gap-2 w-full"},Bt={class:"flex gap-2"},Pt={key:0,class:"text-xl font-semibold text-blue-500"},Ot={class:"flex items-center w-full mb-2"},Nt={key:0,class:"flex gap-4 items-center mr-3"},jt={key:1,class:"text-gray-500 text-sm"},Rt={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Ft={key:0,class:"text-white bg-blue-700 text-[12px] uppercase px-[5px] py-[1px] rounded-full border border-green-200 opacity-80"},Ht={class:"mb-4 text-xs text-gray-400 whitespace-nowrap"},zt={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Wt={class:"text-gray-400 text-xs col-span-full flex justify-between"},Kt={class:"ml-auto flex flex-wrap gap-2 mb-2 items-start"},Gt={class:"text-xs text-gray-400 flex gap-3 sm:order-0"},Jt=["href"],Yt={class:"mt-4 col-span-full"},Qt={class:"flex gap-3 items-end"},Xt={class:"text-right text-sm flex gap-4 mt-4 opacity-80"},Zt={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},es={key:1,class:"text-gray-500 text-sm"},ts={class:"font-semibold text-blue-800"},ss={key:2,class:"ml-4 text-gray-500 text-sm"},ls={class:"text-blue-500 font-semibold"},as={key:3,class:"text-gray-500 text-sm"},os={class:"font-semibold text-blue-800"},ns={key:4,class:"text-gray-500 text-sm"},rs={class:"font-semibold text-blue-800"},is={class:"flex items-center sm:ml-auto order-0 sm:order-1"},ds={key:0,class:"flex gap-2 ml-4 items-center text-xs"},us=["href"],ms=["href"],Ce={__name:"TaskTreeViewWithSubTable",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},hideAssignedUsers:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},isMyTask:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick","employeeAssignClick"],setup(l,{emit:C}){const m=l,c=oe(),$=E(null),f=C;function S(v){f("addClick",v)}function p(v){f("editClick",v)}function k(v){f("employeeAssignClick",v)}const a=E([]),b=localStorage.getItem("sub_task_opened_list");if(b)try{a.value=JSON.parse(b)}catch{a.value=[]}const _=g(()=>te(m.task.assigned_at||m.task.created_at)),w=g(()=>te(m.task.deadline)),O=g(()=>te(m.task.started_at)),N=g(()=>te(m.task.completed_at)),W=g({get:()=>a.value.includes(m.task.id),set:v=>{const o=a.value.includes(m.task.id);v&&!o?a.value.push(m.task.id):!v&&o&&(a.value=a.value.filter(U=>U!==m.task.id))}});se(a,v=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(v))},{deep:!0});const q=g(()=>{var v,o;return((o=(v=m.task)==null?void 0:v.children_tasks)==null?void 0:o.length)>0});return(v,o)=>{var H,J,X,z,j,Z,h,t;const U=fe("RouterLink");return s(),n("div",Mt,[l.treeLevel>0?(s(),n("div",Dt,o[4]||(o[4]=[e("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):r("",!0),e("div",{class:G(["flex-grow border-2 rounded pb-3 px-3",{"bg-blue-100/30  ":l.task.closed_at,"bg-green-100  ":((H=$.value)==null?void 0:H.completedPercentage)===100,"bg-white hover:bg-gray-50":((J=$.value)==null?void 0:J.completedPercentage)<100&&!l.task.closed_at,"shadow-sm":l.treeLevel>0,"border-blue-500":l.index%2===0,"border-pink-300":l.index%2===1}])},[e("div",qt,[e("div",Et,[e("div",Ut,[e("div",null,[e("div",Bt,[l.index!==void 0?(s(),n("div",Pt,A(l.index+1)+". ",1)):r("",!0),T(ke,{task:l.task,"sub-tasks-open":W.value,"is-my-task":l.isMyTask,class:"whitespace-nowrap"},null,8,["task","sub-tasks-open","is-my-task"])]),e("div",Ot,[l.showDraggableHandle||l.task.serial?(s(),n("div",Nt,[l.showDraggableHandle?(s(),n("button",{key:0,onMousedown:o[0]||(o[0]=F((...i)=>v.handleDragging&&v.handleDragging(...i),["stop"])),class:"handle"},o[5]||(o[5]=[e("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):r("",!0),l.task.serial?(s(),n("span",jt," #"+A(l.task.serial),1)):r("",!0)])):r("",!0),e("div",Rt,[l.treeLevel===0?(s(),n("div",Ft," Main ")):r("",!0),(X=l.task)!=null&&X.is_important?(s(),V(xe,{key:1,class:"flex-none"})):r("",!0),(z=l.task)!=null&&z.is_urgent?(s(),V(be,{key:2,class:"flex-none"})):r("",!0)])]),e("div",Ht,[o[6]||(o[6]=e("i",{class:"fas fa-clock"},null,-1)),D(" "+A(y(he)(l.task.created_at)),1)])]),l.hideAssignedUsers?r("",!0):(s(),V(Pe,{key:0,task:l.task,"tree-level":l.treeLevel,class:"my-2 w-full","employee-route-to":i=>({query:{...y(c).query,view:"userwise","company-id":i.company_id,"user-ids":i.id}})},null,8,["task","tree-level","employee-route-to"])),e("div",zt,[l.task.closed_at?(s(),V(we,{key:0})):r("",!0),T(ve,{status:(j=l.task)==null?void 0:j.status,progressPercent:((Z=l.task)==null?void 0:Z.progress_percent)||0},null,8,["status","progressPercent"]),T(ge,{ref_key:"progress",ref:$,task:l.task,class:"text-sm"},null,8,["task"])])])]),e("div",Wt,[e("div",Kt,[(s(!0),n(P,null,Q(l.task.website_tags||[],i=>(s(),n("div",{class:"border bg-gray-50 text-xs px-2 rounded-lg shadow-sm text-gray-700 bg-gradient-to-b to-slate-50 from-blue-100",key:i.id},A(i.name),1))),128))])]),e("div",{class:G(["ml-0 col-span-full",{"mt-4":q.value}])},[e("div",{class:G({"ml-6":q.value})},[e("div",Gt,[e("h2",{class:G([{"text-blue-600 font-semibold  inline-block  ":q.value},"flex items-center gap-1 group"])},[e("span",null," Sub Tasks ("+A((h=l.task.children_tasks)==null?void 0:h.length)+") ",1)],2),!l.task.closed_at&&!l.hideButtons?(s(),n(P,{key:0},[l.treeLevel<2?(s(),n("a",{key:0,href:`/tasks/add?parent_id=${m.task.id}&back-to=${encodeURIComponent(y(c).path+"?"+y(Oe)(y(c).query)).toLowerCase()}`,class:"hover:bg-blue-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:o[1]||(o[1]=F(i=>f("addClick",m.task.id),["stop","prevent"]))},o[7]||(o[7]=[e("i",{class:"fas fa-plus"},null,-1),D(" Add Sub Task ")]),8,Jt)):r("",!0)],64)):r("",!0)])],2),T(Vt,{childrenTasks:l.task.children_tasks,"hide-buttons":l.hideButtons,"hide-assigned-users":l.hideAssignedUsers,"parent-tree-level":l.treeLevel,onEditClick:p,onAddClick:S,onEmployeeAssignClick:k},{"tree-item-end":B(({task:i,level:d})=>[Le(v.$slots,"item-end",{level:d,task:i})]),_:3},8,["childrenTasks","hide-buttons","hide-assigned-users","parent-tree-level"])],2)]),e("div",Yt,[e("div",Qt,[e("div",Xt,[l.task.is_target?(s(),n("div",Zt,o[8]||(o[8]=[e("i",{class:"fad fa-bullseye-arrow mr-1"},null,-1),D(" TARGET TASK ")]))):r("",!0),_.value?(s(),n("span",es,[o[9]||(o[9]=D(" Assign: ")),e("span",ts,A(_.value),1)])):r("",!0),w.value?(s(),n("span",ss,[o[10]||(o[10]=D(" Deadline: ")),e("span",ls,A(w.value),1)])):r("",!0),O.value?(s(),n("span",as,[o[11]||(o[11]=D(" Started: ")),e("span",os,A(O.value),1)])):r("",!0),N.value?(s(),n("span",ns,[o[12]||(o[12]=D(" Completed: ")),e("span",rs,A(N.value),1)])):r("",!0)]),e("div",is,[l.hideButtons?r("",!0):(s(),n("div",ds,[l.task.is_closed?r("",!0):(s(),n("a",{key:0,href:`/tasks/edit/${l.task.id}`,onClick:o[2]||(o[2]=F(i=>f("editClick",l.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},o[13]||(o[13]=[e("i",{class:"fas fa-edit"},null,-1),D(" Edit ")]),8,us)),l.task.is_closed?r("",!0):(s(),n("a",{key:1,href:`/tasks/${l.task.id}/assign-users`,onClick:o[3]||(o[3]=F(i=>f("employeeAssignClick",l.task.id),["stop","prevent"])),class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},o[14]||(o[14]=[e("i",{class:"fas fa-users-cog"},null,-1),D(" Manage Employee & Supervisor ")]),8,ms)),T(U,{to:{name:"TaskReports",params:{id:(t=l.task)==null?void 0:t.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:B(()=>o[15]||(o[15]=[e("i",{class:"far fa-file-alt"},null,-1),D(" Reports ")])),_:1,__:[15]},8,["to"])]))])])])],2)])}}},cs={class:"w-full bg-white rounded"},ps=["rowspan"],fs={__name:"UserWiseList",props:{tasks:Array,selectedUserId:{type:String,default:null}},emits:["commentButtonClick","editClick","addClick","updatePriority","employeeAssignClick"],setup(l,{emit:C}){const m=l,c=C,$=g(()=>m.tasks.reduce((p,k)=>(p.push(...k.users.filter(a=>!p.find(b=>b.id==a.id&&a.id))),p),[]).filter(p=>m.selectedUserId?p.id==m.selectedUserId:!0)),f=p=>m.tasks.filter(b=>b.users.some(_=>_.id===p)),S=g(()=>$.value.map(p=>{const k=f(p.id);return{...p,tasks:k}}));return(p,k)=>(s(),n("div",null,[e("table",cs,[e("tbody",null,[(s(!0),n(P,null,Q(S.value,a=>(s(),n(P,{key:a.id},[(s(!0),n(P,null,Q(a.tasks,(b,_)=>(s(),n("tr",{key:b.id},[_==0?(s(),n("td",{key:0,class:"border p-4 align-top border-green-300 bg-blue-50",rowspan:Math.max(a.tasks.length,1)},[T(ye,{user:a,class:"sticky top-[80px]"},null,8,["user"])],8,ps)):r("",!0),e("td",{class:G(["py-4 px-4 border-x border-green-300 bg-blue-50",{"border-t":_==0,"border-b":a.tasks.length-1===_}])},[T(Ce,{task:b,class:"!border-0 my-0",index:_,onCommentButtonClick:k[0]||(k[0]=w=>c("commentButtonClick",p.item.id)),onEditClick:k[1]||(k[1]=w=>c("editClick",w)),onAddClick:k[2]||(k[2]=w=>c("addClick",w)),onEmployeeAssignClick:k[3]||(k[3]=w=>c("employeeAssignClick",w))},null,8,["task","index"])],2)]))),128))],64))),128))])])]))}},ys={class:"max-w-full mx-4 p-6 mt-2 relative bg-white rounded-md shadow-md"},ks={class:"mb-4"},vs={class:"relative min-h-[30vh]"},gs={key:0,class:"text-center py-4 text-red-500"},xs={key:1},bs={class:"flex items-stretched"},hs={key:2,class:"text-center py-4 text-gray-500 border h-[30vh] flex items-center justify-center text-xl rounded bg-gray-50"},ws=1,Js={__name:"TaskList",setup(l){const C=je(),m=ce(),c=oe(),$=Ve(),f=E(""),S=E(!1),p=E(null),k=g(()=>{var i;return((i=m==null?void 0:m.user)==null?void 0:i.role)==="employee"||!(m!=null&&m.isAdminMood)?!0:!!c.query["user-ids"]}),a=E(null),b=E(!1),_=ie({parentId:0,requirementId:0}),w=ie({taskId:0,isOpen:!1}),O=E(null),N=E([]),{handleItemsPriorityUpdate:W,saveTaskPriority:q,listHasRearranged:v}=qe(()=>C.taskListTree,0);pe(async()=>{f.value="loading",c.query.status?await o():$.push({query:{...c.query,status:"not-completed"}})});async function o(){let i;c.name==="MyTaskList"?i=await C.fetchMyTasks({...c.query,page:1}):i=await C.fetchTasks({...c.query,page:1},{infiniteScrolling:!1}),f.value="",N.value=i.query_log||[]}const U=i=>{b.value=!0,_.parentId=i},H=i=>{w.taskId=i,w.isOpen=!0},J=i=>{p.value=i,S.value=!0},X=()=>{S.value=!1,p.value=null};async function z(){a.value=null,b.value=!1,_.parentId=0,f.value="loading",await o()}async function j(){b.value=!1,_.parentId=0,await o()}async function Z(){f.value="loading",await q()&&await o()}se(()=>({...c.query}),async()=>{C.resetTaskList(),f.value="loading",await o()});const h=g({get(){return{...c.query}},set(i){localStorage.removeItem("sub_task_opened_list"),$.push({query:{...i}})}}),t=g(()=>Array.isArray(C.tasks)?Ee(C.tasks,c.query):[]);return(i,d)=>{var I,M,L;return s(),n("div",ys,[a.value?(s(),V(le,{key:0},{default:B(()=>[T(Se,{taskId:a.value,onClose:d[0]||(d[0]=x=>a.value=null),onUpdated:z},null,8,["taskId"])]),_:1})):r("",!0),b.value?(s(),V(le,{key:1},{default:B(()=>[T(Ie,{parentTaskId:_.parentId,requirementId:_.requirementId,onClose:j,onTaskCreated:z},null,8,["parentTaskId","requirementId"])]),_:1})):r("",!0),w.isOpen?(s(),V(le,{key:2,class:"*:max-w-4xl"},{default:B(()=>[T($e,{taskId:w.taskId,onCancelClick:d[1]||(d[1]=()=>{w.isOpen=!1,w.taskId=0}),onSuccess:d[2]||(d[2]=()=>{w.isOpen=!1,w.taskId=0,f.value="loading",o()})},null,8,["taskId"])]),_:1})):r("",!0),T(mt,{modelValue:h.value,"onUpdate:modelValue":d[3]||(d[3]=x=>h.value=x),onClickAddTask:U,onClickPrioritySave:Z,onClickPriorityDiscard:d[4]||(d[4]=()=>y(v)?O.value.resetItems:null),"list-has-rearranged":y(v),isMyTask:y(c).name==="MyTaskList",class:"mb-6"},null,8,["modelValue","list-has-rearranged","isMyTask"]),((M=(I=y(c))==null?void 0:I.query)==null?void 0:M["query-log"])=="true"?(s(!0),n(P,{key:3},Q(N.value,(x,K)=>(s(),n("div",{key:K,class:"text-xs text-gray-500"},[e("div",ks,A(x.raw_query),1)]))),128)):r("",!0),e("div",vs,[y(C).error?(s(),n("div",gs,A(y(C).error),1)):y(C).tasks.length>0?(s(),n("div",xs,[((L=y(c).query)==null?void 0:L.view)=="userwise"?(s(),V(fs,{key:0,tasks:t.value,selectedUserId:y(c).query["user-ids"],onCommentButtonClick:d[5]||(d[5]=x=>J(x,i.task.id)),onEditClick:d[6]||(d[6]=x=>a.value=x),onAddClick:d[7]||(d[7]=x=>U(x)),onEmployeeAssignClick:d[8]||(d[8]=x=>H(x))},null,8,["tasks","selectedUserId"])):(s(),V(_e,{key:1,items:t.value,handle:"handle",onItemsUpdate:y(W),class:"space-y-4",ref_key:"draggableTaskList",ref:O},{item:B(({item:x,index:K})=>[e("div",bs,[T(Ce,{"is-my-task":y(c).name==="MyTaskList",task:x,index:K,showDraggableHandle:!k.value,onCommentButtonClick:d[9]||(d[9]=R=>J(R,i.task.id)),onEditClick:d[10]||(d[10]=R=>a.value=R),onAddClick:d[11]||(d[11]=R=>U(R)),onEmployeeAssignClick:d[12]||(d[12]=R=>H(R)),class:"!border-0"},null,8,["is-my-task","task","index","showDraggableHandle"])])]),_:1},8,["items","onItemsUpdate"]))])):f.value!=="loading"?(s(),n("div",hs," No tasks found. ")):r("",!0),f.value==="loading"?(s(),V(Ae,{key:3,class:"absolute inset-0 flex items-center z-50 bg-opacity-60"})):r("",!0)]),T(Te,{show:S.value,"commentable-id":p.value,"commentable-type":"task","user-id":ws,"on-close":X,onSubmitted:y(C).fetchTasks},null,8,["show","commentable-id","onSubmitted"])])}}};export{Js as default};
