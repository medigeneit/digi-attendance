import{o as r,c as d,F as A,x as R,k as P,r as D,y as q,A as I,p as M,a as t,e as f,m as v,n as y,l as x,t as c,q as m,z as U}from"./index-DFR998CW.js";const F={class:"mt-3"},J={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick"],setup(s,{emit:C}){const a=C;return(_,u)=>(r(),d("div",F,[(r(!0),d(A,null,R(s.childrenTasks,g=>(r(),P(ke,{key:g.id,task:g,class:"mb-3","hide-buttons":s.hideButtons,"tree-level":s.parentTreeLevel+1,onEditClick:h=>a("editClick",g.id)},null,8,["task","hide-buttons","tree-level","onEditClick"]))),128))]))}},G={class:"flex w-full"},H={key:0,class:"border-l border-gray-200 last:border-l-0"},K={class:"items-start grid grid-cols-3"},Q={class:""},W={key:0,class:"text-sm text-gray-500 mt-2"},X={class:"flex items-center gap-2 text-xs text-gray-500 mt-2 opacity-80 text-left"},Y={key:0,class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"},Z={key:1,class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"},ee={class:"flex items-start flex-wrap gap-3"},te={class:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-medium text-gray-600"},se={class:"text-xs text-gray-700 mr-2"},le={class:"flex justify-end items-center gap-2"},ne={class:"px-2 py-0.5 text-xs rounded-full bg-blue-100 text-blue-800 border border-blue-200"},ae={class:"text-sm"},re={class:"mt-4"},ie={class:"flex items-center"},oe={key:0,class:"fas fa-caret-down text-gray-400 group-hover:text-sky-400"},de={key:1,class:"fas fa-caret-right text-gray-400 group-hover:text-sky-400"},ue={key:0,class:"flex gap-2 ml-auto items-center text-xs"},ce={class:"ml-0"},ke={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0}},emits:["commentButtonClick","editClick"],setup(s,{emit:C}){const a=s,_=C,u=D([]),g=localStorage.getItem("sub_task_opened_list");if(g)try{u.value=JSON.parse(g)}catch{u.value=[]}const h=q({get:()=>u.value.includes(a.task.id),set:l=>{const e=u.value.includes(a.task.id);l&&!e?u.value.push(a.task.id):!l&&e&&(u.value=u.value.filter(n=>n!==a.task.id))}});I(u,l=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(l))},{deep:!0});const $=q(()=>{var l,e,n,i;return{"hover:underline hover:text-sky-400 cursor-pointer":((e=(l=a.task)==null?void 0:l.children_tasks)==null?void 0:e.length)>0,"cursor-default pointer-none":((i=(n=a.task)==null?void 0:n.children_tasks)==null?void 0:i.length)===0}}),j=l=>l.split(" ").map(e=>e[0]).join("").toUpperCase(),T=()=>{const l=b();let e,n,i;return l===100?(e="bg-green-50",n="bg-green-200",i="text-green-600 "):l<100&&(e="bg-red-50",n="bg-red-200",i="text-red-600 "),{container:e,bar:n,text:i}};function z(){a.task.children_tasks.length>0&&(h.value=!h.value)}function L(){if(a.task.children_tasks.length===0)return a.task.status==="COMPLETED"?1:0;const l=e=>{let n=0;for(let i=0;i<e.length;i++){const k=e[i];if(k.children_tasks.length===0)k.status==="COMPLETED"&&(n+=1);else{const p=k.children_tasks.length;l(k.children_tasks)===p&&(n+=1)}}return n};return l(a.task.children_tasks)}function b(){return a.task.children_tasks.length===0?a.task.status==="COMPLETED"?100:0:L()/a.task.children_tasks.length*100}return(l,e)=>{var i,k,p,w,B,E,S,N,O;const n=M("RouterLink");return r(),d("div",G,[s.treeLevel>0?(r(),d("div",H,e[3]||(e[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):f("",!0),t("div",{class:m(["flex-grow border rounded py-3 group px-3",{"bg-green-50 ":b()===100,"bg-gray-50":b()<100,"shadow-sm":s.treeLevel>0}])},[t("div",K,[t("div",Q,[v(n,{to:{name:"TaskShow",params:{id:s.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:y(()=>[x(c(s.task.title),1)]),_:1},8,["to"]),(i=s.task)!=null&&i.requirement?(r(),d("p",W," Requirement: "+c((p=(k=s.task)==null?void 0:k.requirement)==null?void 0:p.title),1)):f("",!0),t("div",X,[(w=s.task)!=null&&w.is_important?(r(),d("span",Y,"IMPORTANT")):f("",!0),(B=s.task)!=null&&B.is_urgent?(r(),d("span",Z,"URGENT")):f("",!0)])]),t("div",ee,[(r(!0),d(A,null,R(s.task.users,(o,V)=>(r(),d("div",{class:"flex items-center gap-2 border rounded-full px-1 py-0.5 bg-slate-100 shadow-sm",key:V},[t("div",te,c(j(o==null?void 0:o.name)),1),t("span",se,c(o.id)+" - "+c(o==null?void 0:o.name),1)]))),128))]),t("div",le,[t("span",ne,c(s.task.status),1),t("div",ae,[t("div",{class:m(["rounded-full border py-0.5 text-xs relative overflow-hidden h-6",T().container]),style:{width:"180px"}},[t("div",{class:m(["z-10 absolute top-0 bottom-0",T().bar]),style:U(`width: ${b()}%`)},null,6),t("span",{class:m(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",T().text])},[t("span",null,[t("span",null,c(L()),1),e[4]||(e[4]=x(" / ")),t("span",null,c(s.task.children_tasks.length||1),1)])],2)],2)])])]),t("div",re,[t("div",ie,[t("div",{class:"flex gap-3 group items-center",onClick:z},[h.value?(r(),d("i",oe)):(r(),d("i",de)),t("span",{class:m([$.value,"text-xs text-gray-500"])}," Sub Tasks ("+c((E=s.task.children_tasks)==null?void 0:E.length)+") ",3)]),s.hideButtons?f("",!0):(r(),d("div",ue,[t("button",{onClick:e[0]||(e[0]=o=>l.$emit("editClick",s.task.id)),class:"btn-2 py-0.5 text-xs"},e[5]||(e[5]=[t("i",{class:"fas fa-edit"},null,-1),x(" Edit ")])),v(n,{to:{name:"TaskReports",params:{id:(S=s.task)==null?void 0:S.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:y(()=>e[6]||(e[6]=[t("i",{class:"far fa-file-alt"},null,-1),x(" Reports ")])),_:1},8,["to"]),v(n,{to:{name:"TaskUserAssign",params:{id:(N=s.task)==null?void 0:N.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:y(()=>e[7]||(e[7]=[t("i",{class:"fas fa-user-plus"},null,-1),x(" Assign Users ")])),_:1},8,["to"]),v(n,{to:{name:"TaskAdd",query:{parent_id:(O=s.task)==null?void 0:O.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2",onClick:e[1]||(e[1]=o=>o.stopPropagation())},{default:y(()=>e[8]||(e[8]=[t("i",{class:"fas fa-plus"},null,-1),x(" Add Sub Task ")])),_:1},8,["to"])]))]),t("div",ce,[h.value?(r(),P(J,{key:0,childrenTasks:s.task.children_tasks,"hide-buttons":s.hideButtons,"parent-tree-level":s.treeLevel,onEditClick:e[2]||(e[2]=o=>_("editClick",o))},null,8,["childrenTasks","hide-buttons","parent-tree-level"])):f("",!0)])])],2)])}}};export{ke as _};
