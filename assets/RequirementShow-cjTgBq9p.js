import{x as E,r as k,h as ae,q as ze,c as l,o as n,a as e,j as u,F as V,e as Q,s as L,d as w,M as de,t as x,i as j,w as I,G as J,m as F,l as S,p as Be,b as N,k as Ue,v as Ee,C as Fe,g as Ve,Q as Ge,y as Me,A as Pe,f as We,u as Qe}from"./index-DavNGHz_.js";import{u as Ye}from"./useCommentStore-C_up6dIE.js";import{_ as He}from"./TextEditor-BAXLpD0w.js";import{L as oe}from"./LoaderView-vJZPoQPM.js";import{O as P}from"./OverlyModal-C75RfuUp.js";import{_ as Ke}from"./ShareComponent-BuhZJ9YB.js";import{_ as Ne}from"./DepartmentChip-CwvUwgSq.js";import{_ as X}from"./DescriptionView-kd1kuqBj.js";import{i as Je,f as Le,a as Xe,_ as Ze,b as et}from"./TaskTableRow-DVE5Fn3V.js";import{b as tt,r as st,c as rt,f as me,d as nt,s as at}from"./requirement-DFGl8QH4.js";import{_ as lt}from"./AttachmentPreview-DVIe9a7h.js";import{_ as ne}from"./UserChip-DQzXkHhQ.js";import{o as ot}from"./url-CePbr-gY.js";import{u as it}from"./user-vRsZOci4.js";import{_ as qn,a as dt}from"./TaskUserAssignForm-DXk1PhZb.js";import{u as ut}from"./useTaskStore-gNRbk2mc.js";import{_ as mt}from"./TaskSelectionInput-BSBHtwaj.js";import{_ as ct}from"./TaskAddForm-BePYiOjt.js";import{_ as pt}from"./TaskEditForm-Bm32XV6x.js";import{T as le}from"./TextWithHr-C8anvG0T.js";import{d as ue,b as vt}from"./datetime-BEfC2TVK.js";import{c as bt}from"./dom-Bic1TNqD.js";import{_ as ft}from"./ApproveAndReject-CMy7X9Pe.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./TaskUrgentBadge-BTGbSIav.js";import"./TaskTitle-XXLaoKAS.js";import"./TaskAssignedUsers-DJEM-4VY.js";import"./TaskIsClosedBadge-BUc38Mlg.js";import"./TaskUrgencyInput-Cn8vXcgU.js";import"./DraggableList.vue_vue_type_script_setup_true_lang-aGT0-j08.js";import"./SelectDropdown-3ckBply0.js";import"./RequiredIcon-CplW4RYG.js";import"./company-BMGapQNm.js";import"./CompanyDepartmentSelectInput-BXhigw6S.js";import"./SectionLoading-CvGXAhnG.js";import"./tags-4NJs6sB0.js";import"./MultiselectDropdown-Csr8q-4G.js";import"./MultiselectDropdown.vue_vue_type_style_index_0_lang-BAGOe0tV.js";const xt={class:"space-y-4"},yt={class:"space-y-4"},gt={key:0,class:"text-sm text-gray-500"},_t={key:1,class:"text-sm text-gray-500"},kt={key:0,class:"shrink-0"},ht={class:"text-sm font-semibold text-gray-800"},wt={class:"text-xs text-gray-400"},qt=["innerHTML"],$t=["onClick"],Ct={key:1,class:"shrink-0"},Tt={class:"bg-white rounded-xl shadow-sm border p-4 space-y-3"},St={class:"flex items-center gap-2"},Rt={class:"text-sm font-semibold text-gray-700"},jt={class:"flex items-center justify-end gap-2"},It=["disabled"],At={key:0,class:"text-xs text-red-600"},Dt={__name:"CommentBox",props:{commentableType:{type:String,required:!0},commentableId:{type:[Number,String],required:!0},currentUser:{type:Object,required:!0}},setup(y){const q=y,a=Ye(),m=E(()=>a.comments),f=E(()=>a.loading),v=E(()=>a.error),o=k(""),p=k(!1),s=async()=>{await a.fetchComments({commentable_type:q.commentableType,commentable_id:q.commentableId})},R=async()=>{if(!(!o.value||!o.value.trim())){p.value=!0;try{await a.createComment({commentable_type:q.commentableType,commentable_id:Number(q.commentableId),user_id:q.currentUser.id,message:o.value}),o.value=""}finally{p.value=!1}}},i=async b=>{await a.deleteComment(b)};ae(s),ze(()=>[q.commentableType,q.commentableId],()=>s());const t=b=>b?new Date(b).toLocaleString():"",d=b=>(b==null?void 0:b.user_id)===q.currentUser.id,c=b=>(b==null?void 0:b.user_id)===q.currentUser.id;return(b,g)=>{var C;return n(),l("div",xt,[e("div",yt,[f.value?(n(),l("div",gt,"Loading comments...")):m.value.length?u("",!0):(n(),l("div",_t,"No comments yet.")),(n(!0),l(V,null,Q(m.value,h=>{var $;return n(),l("div",{key:h.id,class:L(["flex gap-3",c(h)?"justify-end":"justify-start"])},[c(h)?u("",!0):(n(),l("div",kt,[w(de,{user:h.user},null,8,["user"])])),e("div",{class:L(["group relative min-w-[50%] max-w-[90%] rounded-md px-4 py-3 shadow-sm border",c(h)?"bg-indigo-50 border-indigo-100":"bg-white border-gray-100"])},[e("div",{class:L(["flex items-center gap-2 mb-1",c(h)?"justify-end":"justify-start"])},[e("p",ht,x(c(h)?"You":(($=h.user)==null?void 0:$.name)||"Unknown"),1),g[1]||(g[1]=e("span",{class:"text-xs text-gray-400"},"•",-1)),e("p",wt,x(t(h.created_at)),1)],2),e("div",{class:"prose prose-sm max-w-none text-gray-700 leading-relaxed",innerHTML:h.message},null,8,qt),d(h)?(n(),l("div",{key:0,class:L(["mt-2 flex",c(h)?"justify-end":"justify-start"])},[e("button",{class:"text-[11px] text-gray-400 hover:text-red-600 transition opacity-0 group-hover:opacity-100",onClick:A=>i(h.id)}," Delete ",8,$t)],2)):u("",!0)],2),c(h)?(n(),l("div",Ct,[w(de,{user:h.user||y.currentUser},null,8,["user"])])):u("",!0)],2)}),128))]),e("div",Tt,[e("div",St,[w(de,{user:y.currentUser},null,8,["user"]),e("div",Rt,x(((C=y.currentUser)==null?void 0:C.name)||"You"),1)]),w(He,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=h=>o.value=h)},null,8,["modelValue"]),e("div",jt,[e("button",{class:"px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm disabled:opacity-60",disabled:p.value||!o.value.trim(),onClick:R},x(p.value?"Posting...":"Post Comment"),9,It)]),v.value?(n(),l("p",At,x(v.value),1)):u("",!0)])])}}},Nt={class:"flex items-center border-b w-full pb-2"},Lt={class:""},Ot={class:"mt-4 border h-40 flex items-center flex-col justify-center rounded border-dashed bg-red-50 text-center"},Bt={key:1,class:"text-red-500 text-center mt-2"},Ut={class:"flex items-center justify-between mt-4"},Et={__name:"RequirementAttachmentForm",props:{requirementId:[String,Number],default:()=>null},emits:["uploaded","error","clickBack"],setup(y,{emit:q}){const a=y,m=k({attachments:[]}),f=k(""),v=k(""),o=q;function p(i){m.value.attachments=[...m.value.attachments,...Array.from(i.target.files)]}function s(i){m.value.attachments.splice(i,1)}async function R(){var t,d,c,b;f.value="submitting";const i=new FormData;for(const g in m.value)g==="attachments"?m.value.attachments.forEach(C=>i.append("attachments[]",C)):i.append(g,m.value[g]);try{const g=await tt(a.requirementId,i);m.value.attachments=[],o("uploaded",g),f.value="uploaded"}catch(g){o("error",(d=(t=g.response)==null?void 0:t.data)==null?void 0:d.message),v.value=(b=(c=g.response)==null?void 0:c.data)==null?void 0:b.message,f.value="error"}}return(i,t)=>{var d;return n(),l("form",{class:"p-4 flex flex-col relative",onSubmit:I(R,["prevent"])},[f.value=="submitting"?(n(),j(oe,{key:0,class:"absolute inset-0 bg-opacity-80 flex items-center justify-center"})):u("",!0),e("div",Nt,[t[3]||(t[3]=e("h3",null,"Requirement Attachment",-1)),e("button",{class:"btn-icon ml-auto",onClick:t[0]||(t[0]=I(()=>{o("clickBack")},["prevent"]))},t[2]||(t[2]=[e("span",{class:"fas fa-times"},null,-1)]))]),e("div",Lt,[e("label",Ot,[t[4]||(t[4]=e("div",{class:"block text-gray-600 font-medium text-sm md:text-xl mb-4"}," Click to Select files or Drop Here ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,application/pdf",name:"attachments",class:"border rounded-r-md text-gray-600 bg-gray-50",onChange:p},null,32)])]),w(lt,{files:((d=m.value)==null?void 0:d.attachments)||[],onRemove:s,class:"border p-1 rounded overflow-y-auto flex-grow"},null,8,["files"]),t[6]||(t[6]=e("hr",{class:"mt-4"},null,-1)),v.value?(n(),l("div",Bt,x(v.value),1)):u("",!0),e("div",Ut,[e("button",{class:"btn-3",onClick:t[1]||(t[1]=I(c=>o("clickBack"),["prevent"]))},"Cancel"),t[5]||(t[5]=e("button",{class:"btn-2"},"Save",-1))])],32)}}},Ft={class:"card-bg p-4 pt-2"},Vt={class:"grid grid-cols-2 lg:grid-cols-4 gap-3 w-full"},Mt=["onClick"],Pt=["src"],Ht=["href"],zt={key:2,class:"text-xs text-gray-500 text-center"},Gt={__name:"RequirementAttachments",props:{requirement:{type:Array,default:()=>[]}},setup(y){const q=y,a=E(()=>{var v;return((v=q.requirement)==null?void 0:v.attachments)||[]}),m=J({show:!1}),f=J({show:!1,selectedFile:""});return(v,o)=>(n(),l("div",Ft,[e("div",null,[o[6]||(o[6]=e("h4",{class:"text-gray-900 font-semibold mb-3 border-b font-e"},"Attachments",-1)),e("div",Vt,[a.value&&a.value.length?(n(!0),l(V,{key:0},Q(a.value,(p,s)=>(n(),l("div",{key:s,class:"border p-1 rounded aspect-square flex items-center justify-center bg-gray-50 relative",tabindex:"0",onClick:I(()=>{f.show=!0,f.selectedFile=p},["prevent"])},[F(Je)(p)?(n(),l("img",{key:0,src:F(Le)(p),alt:"attachment",class:"object-cover w-full h-full rounded"},null,8,Pt)):F(Xe)(p)?(n(),l("a",{key:1,href:F(Le)(p),target:"_blank",class:"text-xs text-blue-600 text-center break-words hover:underline"},o[4]||(o[4]=[e("i",{class:"fas fa-file-pdf fa-2x mb-1 text-amber-700"},null,-1),e("div",{class:"whitespace-nowrap text-xs mt-1"},"Open PDF",-1)]),8,Ht)):(n(),l("span",zt,"Unknown"))],8,Mt))),128)):u("",!0),e("button",{title:"Add Attachments",onClick:o[0]||(o[0]=I(p=>m.show=!m.show,["prevent"])),class:"border rounded aspect-square flex items-center justify-center bg-sky-50 hover:bg-sky-100 relative group/btn"},o[5]||(o[5]=[e("i",{class:"fas fa-plus-circle text-2xl text-blue-300 group-hover/btn:text-blue-500"},null,-1)]))])]),m.show?(n(),j(P,{key:0},{default:S(()=>[w(Et,{onClickBack:o[1]||(o[1]=p=>m.show=!1),onUploaded:o[2]||(o[2]=p=>m.show=!1),requirementId:y.requirement.id,class:"max-h-[70vh]"},null,8,["requirementId"])]),_:1})):u("",!0),f.show?(n(),j(P,{key:1,class:"*:max-w-4xl *:min-h-[60vh]"},{default:S(()=>[w(Ze,{attachments:a.value,selected:f.selectedFile,onClickClose:o[3]||(o[3]=p=>f.show=!1)},null,8,["attachments","selected"])]),_:1})):u("",!0)]))}},Wt={key:0,class:"mb-4 flex flex-col gap-2 items-center justify-center bg-gray-50 bg-opacity-70 hover:bg-opacity-90 p-6 border border-gray-100 rounded-md"},Qt={class:"text-sm flex flex-col xl:flex-row items-center mt-2 xl:mt-0 gap-x-2 text-red-400 font-semibold whitespace-nowrap"},Yt={class:"mt-[2px]"},Kt={key:0,class:"text-gray-800 flex items-center gap-2"},Jt={key:1,class:"text-gray-800 w-full my-2 text-center"},Xt={class:"text-gray-800 border w-full rounded-md border-dashed py-2 px-3 border-gray-400 text-sm bg-white"},Zt=["innerHTML"],es={class:"flex gap-4 items-center justify-center mt-2"},ts={__name:"RequirementCloseInfo",props:{requirement:{type:Object,default:()=>{}}},emits:["reOpenClick"],setup(y,{emit:q}){const a=q;return(m,f)=>{var v;return(v=y.requirement)!=null&&v.closed_at?(n(),l("div",Wt,[f[4]||(f[4]=e("div",{class:"text-red-400 font-bold text-xl"},"Requirement Closed",-1)),e("div",Qt,[f[1]||(f[1]=e("span",{class:"flex items-center gap-2 text-gray-600"},[e("span",{class:"fad fa-lock"}),e("span",{class:"mt-[2px]"},"CLOSED AT")],-1)),e("span",Yt,x(new Date(y.requirement.closed_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})),1)]),y.requirement.closed_by_user?(n(),l("div",Kt,[f[2]||(f[2]=e("span",{class:"text-sm"},"Closed by",-1)),w(ne,{user:y.requirement.closed_by_user,"avatar-size":"xsmall"},null,8,["user"])])):u("",!0),y.requirement.closing_note?(n(),l("div",Jt,[f[3]||(f[3]=e("div",{class:"text-x"},"Closing Note",-1)),e("div",Xt,[e("p",{innerHTML:y.requirement.closing_note},null,8,Zt)])])):u("",!0),e("div",es,[e("button",{class:"btn-2 h-8",onClick:f[0]||(f[0]=I(o=>a("reOpenClick"),["prevent"]))},"Re Open")])])):u("",!0)}}},ss={class:"border-b -mx-4 px-4 -mt-4 py-2 text-xl bg-gray-50"},rs={class:"my-6"},ns={class:"text-center font-semibold text-blue-800 mb-4"},as={class:"text-center my-1"},ls={class:"border px-2 rounded-md bg-gray-50 border-blue-300 text-blue-400 inline-flex items-center gap-1"},os={class:"mt-4"},is=["placeholder","required"],ds={class:"flex"},us={class:"text-red-600 text-center mt-2 text-sm"},ms={class:"flex justify-between mt-3"},cs={class:"btn-2"},ps={__name:"RequirementClosingForm",props:{loading:{type:Boolean,default:!1},requirement:{type:Object,default:()=>{}}},emits:["clickCancel","updateStatus","error","update:loading"],setup(y,{emit:q}){const a=y,m=q,f=E({get:()=>a.loading,set:()=>m("update:loading")}),v=k(""),o=k(""),p=k(255),s=E(()=>p.value-v.value.length);async function R(){var i,t,d;f.value=!0;try{(i=a.requirement)!=null&&i.closed_at?await st(a.requirement.id,v.value):await rt(a.requirement.id,v.value),m("updateStatus")}catch(c){o.value=(d=(t=c.response)==null?void 0:t.data)==null?void 0:d.message,m("error")}finally{f.value=!1}}return(i,t)=>{var c,b,g,C,h;const d=Be("LoaderView");return n(),l("form",{class:"p-4 rounded relative border",onSubmit:I(R,["prevent"])},[f.value?(n(),j(d,{key:0,class:"absolute inset-0 flex items-center justify-center bg-opacity-90"},{default:S(()=>t[3]||(t[3]=[N(" Submitting! ")])),_:1,__:[3]})):u("",!0),e("h3",ss,x((c=y.requirement)!=null&&c.closed_at?"Re Open Requirement":"Requirement Closing"),1),e("div",rs,[e("div",ns,x((b=y.requirement)==null?void 0:b.title),1),t[6]||(t[6]=e("div",{class:"text-center my-1 text-lg"},"Are you sure?",-1)),e("div",as,[t[4]||(t[4]=N(" Want to ")),e("span",ls,x((g=y.requirement)!=null&&g.closed_at?"Re-Open":"Close"),1),t[5]||(t[5]=N(" the requirement? "))]),e("div",os,[Ue(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=$=>v.value=$),rows:"4",placeholder:`Write about why are you ${(C=y.requirement)!=null&&C.closed_at?"Re-Opening":"Closing"} the requirement?`,class:"w-full border rounded-lg p-2 text-gray-700 border-gray-400 placeholder:text-gray-400",required:i.currentAction==="reject",onInput:t[1]||(t[1]=$=>v.value.length>p.value?v.value=v.value.slice(0,p.value):null)},null,40,is),[[Ee,v.value]]),e("div",ds,[e("div",{class:L(["ml-auto inline-block text-sm text-gray-500",v.value.length>=p.value?"text-red-500":""])}," left "+x(s.value)+"/"+x(p.value)+" words ",3)])])]),t[7]||(t[7]=e("hr",{class:"mt-3 -mx-4"},null,-1)),e("div",null,[e("div",us,x(o.value),1),e("div",ms,[e("button",{class:"btn-3",onClick:t[2]||(t[2]=I($=>m("clickCancel"),["prevent"]))},"Cancel"),e("button",cs,x((h=y.requirement)!=null&&h.closed_at?"Re-Open":"Close"),1)])])],32)}}};async function vs(y,q,{params:a={}}={}){return Fe.get(`/requirements/${y}/details/${q}`,{params:a})}async function bs(y,q,{params:a={}}={}){const m=ot(a);return Fe.delete(`/requirements/${y}/details/${q}${m?"?"+m:""}`)}const fs={class:"max-h-[90vh] overflow-auto w-full mx-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},xs={class:"mb-4"},ys={class:"font-semibold"},gs={class:"mb-4"},_s={class:"line-clamp-2"},ks={key:1,class:"min-h-40"},hs={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},ws={key:0,class:"mb-4 text-red-500 font-medium"},qs={key:1,class:"mb-4"},$s={class:"flex items-center justify-between gap-4"},Cs=["disabled"],Ts={__name:"RequirementDetailDeleteForm",props:{requirementId:{type:[Number,String],required:!0},detailId:{type:[Number,String],required:!0}},emits:["delete","closeClick","error"],setup(y,{emit:q}){const a=y,m=q,f=it(),v=k(null),o=k(""),p=k(),s=k([]);async function R(){var i,t;o.value="submitting";try{const d=await bs(a.requirementId,a.detailId);m("delete",d),o.value="create"}catch(d){o.value="error",p.value=((t=(i=d.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to update requirement detail: "+d,m("error",p.value)}}return ae(async()=>{var i,t,d;o.value="loading";try{s.value=await f.fetchDepartmentWiseEmployees(),v.value=(i=(await vs(a.requirementId,a.detailId)).data)==null?void 0:i.detail}catch(c){p.value=((d=(t=c.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to fetch requirement detail"}finally{o.value=""}}),(i,t)=>{var d,c;return n(),l("div",fs,[t[4]||(t[4]=e("div",{class:"sticky top-0 -mx-6 px-6 z-10 bg-gray-50"},[e("h2",{class:"text-xl font-semibold text-gray-800 py-2"},"Delete Requirement Details"),e("hr",{class:"mb-4 -mx-6"})],-1)),e("form",{onSubmit:I(R,["prevent"]),class:"z-0"},[o.value!=="loading"?(n(),l(V,{key:0},[e("div",xs,[t[1]||(t[1]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Title",-1)),e("div",ys,x((d=v.value)==null?void 0:d.title),1)]),e("div",gs,[t[2]||(t[2]=e("div",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Description",-1)),e("div",_s,x((c=v.value)==null?void 0:c.description),1)]),t[3]||(t[3]=e("div",{class:"my-8 text-center text-xl text-red-600"},"Are you sure want to delete?",-1))],64)):(n(),l("div",ks)),e("div",hs,[p.value?(n(),l("div",ws,x(p.value),1)):u("",!0),p.value?(n(),l("hr",qs)):u("",!0),e("div",$s,[e("button",{type:"button",onClick:t[0]||(t[0]=I(b=>m("closeClick"),["prevent"])),class:"bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-5 py-2 rounded transition"}," Cancel "),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"bg-red-700 hover:bg-red-500 text-white font-semibold px-5 py-2 rounded transition"},x(o.value=="submitting"?"Deleting...":"Delete"),9,Cs)])])],32),o.value==="loading"||o.value==="submitting"?(n(),j(oe,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):u("",!0)])}}};const Ss={class:"sticky top-0 pt-4 bg-white z-10"},Rs={class:"mb-4"},js={class:"mb-4"},Is={class:"sticky bottom-0 bg-white py-4 border-t -mx-6 px-6"},As={key:0,class:"mb-4 text-red-500 font-medium"},Ds={key:1,class:"mb-4"},Ns={class:"flex items-center justify-between gap-4"},Ls=["disabled"],Os={__name:"RequirementFeedbackEditForm",props:{requirementId:{type:[Number,String],required:!0},requirementId:{type:[Number,String],required:!0}},emits:["update","closeClick","error"],setup(y,{emit:q}){const a=y,m=q,f=k(),v=k(null),o=k(""),p=k(),s=k({feedback:""});async function R(){var i,t;o.value="submitting";try{const d=await nt(a.requirementId,s.value.feedback);m("update",d),o.value="create"}catch(d){o.value="error",p.value=((t=(i=d.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to update requirement requirement",m("error",p.value)}}return ae(async()=>{var i,t,d,c;o.value="loading";try{await me(a.requirementId),v.value=(i=(await me(a.requirementId)).data)==null?void 0:i.requirement,s.value={feedback:(t=v.value)==null?void 0:t.feedback}}catch(b){p.value=((c=(d=b.response)==null?void 0:d.data)==null?void 0:c.message)||"Failed to fetch requirement requirement"}finally{o.value=""}}),(i,t)=>{var d;return n(),l("div",{ref_key:"formContainerRef",ref:f,class:"max-h-[90vh] w-full mx-auto overflow-auto bg-white shadow-lg rounded-lg p-6 pb-0 pt-0 relative"},[e("div",Ss,[t[3]||(t[3]=e("h2",{class:"text-2xl font-semibold text-gray-800"},"Requirement Feedback",-1)),t[4]||(t[4]=e("hr",{class:"mb-4"},null,-1)),e("div",{class:"text-purple-600/80 mb-4 text-xs border-b border-dashed",onClick:t[0]||(t[0]=I(c=>m("ok"),["prevent"]))}," Fields that must be filled in will be marked with an asterisk. ")]),e("form",{onSubmit:I(R,["prevent"]),class:"z-0"},[o.value!=="loading"?(n(),l(V,{key:0},[e("div",Rs,[t[5]||(t[5]=e("label",{class:"block text-gray-600 text-sm font-medium"},"Title ",-1)),w(X,{"line-clamp":"1",className:{paragraph:"whitespace-pre-wrap text-justify ",button:"mt-0"}},{default:S(()=>{var c;return[N(x((c=v.value)==null?void 0:c.title),1)]}),_:1})]),e("div",js,[t[6]||(t[6]=e("label",{class:"block text-gray-600 text-sm mb-1 font-medium"},"Feedback",-1)),w(He,{modelValue:s.value.feedback,"onUpdate:modelValue":t[1]||(t[1]=c=>s.value.feedback=c)},null,8,["modelValue"])])],64)):u("",!0),e("div",Is,[p.value?(n(),l("div",As,x(p.value),1)):u("",!0),p.value?(n(),l("hr",Ds)):u("",!0),e("div",Ns,[e("button",{type:"button",onClick:t[2]||(t[2]=I(c=>m("closeClick"),["prevent"])),class:"btn-3"},"Cancel"),e("button",{disabled:o.value=="loading"||o.value=="submitting",type:"submit",class:"btn-2"},x(o.value=="submitting"?"Saving...":(d=v.value)!=null&&d.feedback?"Update Feedback":"Add Feedback"),9,Ls)])])],32),o.value==="loading"||o.value==="submitting"?(n(),j(oe,{key:0,class:"z-20 absolute inset-0 flex items-center justify-center bg-opacity-30"})):u("",!0)],512)}}},Bs={class:"flex justify-center items-center"},Us={class:"modal-card"},Es=["required"],Fs={class:"flex"},Vs={class:"flex justify-between gap-2 mt-4"},Ms=["disabled"],Ps=["disabled"],Hs={__name:"RequirementSubmissionHandler",props:{requirementId:{type:[String,Number],required:!0}},emits:["loading","success","error"],setup(y,{emit:q}){const a=y,m=q,f=k(255),v=E(()=>f.value-i.value.length),o=Ge(),p=k(null),s=k(null),R=k(null),i=k(""),t=k(!1),d=E(()=>R.value!==null);function c($){R.value=$,i.value="",h()}function b(){R.value=null,i.value=""}async function g(){var $,A;if(R.value==="reject"&&!i.value)return o.error("Rejection Reason is required!");if(typeof a.onSubmit=="function")return a.onSubmit({note:i.value,action:R.value});m("loading",!0),t.value=!0;try{await at(a.requirementId,{note:i.value}),m("success"),b()}catch(D){return m("error",D),o.error(((A=($=D==null?void 0:D.response)==null?void 0:$.data)==null?void 0:A.message)||"Submission failed!")}finally{m("loading",!1),t.value=!1}}function C($){var A,D;d.value&&($.key==="ArrowLeft"?(A=s.value)==null||A.focus():$.key==="ArrowRight"&&((D=p.value)==null||D.focus()))}function h(){Pe(()=>{var $;($=p.value)==null||$.focus()})}return ae(()=>{window.addEventListener("keydown",C)}),Me(()=>{window.removeEventListener("keydown",C)}),($,A)=>(n(),l("div",null,[e("div",Bs,[e("button",{onClick:A[0]||(A[0]=D=>c("accept"))},A[3]||(A[3]=[e("span",{class:"btn-2"},[e("span",{class:"fas fa-paper-plane"}),e("span",{class:"hidden md:inline"},"Submit Requirement")],-1)]))]),d.value?(n(),l("div",{key:0,class:"fixed inset-0 z-50 flex justify-center items-center bg-black/50",onClick:I(b,["self"])},[e("div",Us,[A[4]||(A[4]=e("h3",{class:"title-lg"},"Requirement Submission",-1)),e("div",null,[Ue(e("textarea",{"onUpdate:modelValue":A[1]||(A[1]=D=>i.value=D),rows:"4",placeholder:"Note...",class:"w-full border rounded-lg p-2 text-gray-700",required:R.value==="reject",onInput:A[2]||(A[2]=D=>i.value.length>f.value?i.value=i.value.slice(0,f.value):null)},null,40,Es),[[Ee,i.value]]),e("div",Fs,[e("div",{class:L(["ml-auto inline-block text-sm text-gray-500",i.value.length>=f.value?"text-red-500":""])}," left "+x(v.value)+"/"+x(f.value)+" words ",3)])]),e("div",Vs,[e("button",{ref_key:"cancelBtnRef",ref:s,class:"btn-3 focus:ring-2 ring-offset-2 disabled:opacity-30",onClick:b,disabled:t.value}," Cancel ",8,Ms),e("button",{ref_key:"confirmBtnRef",ref:p,class:L(["focus:ring-2 ring-offset-2 disabled:opacity-30",R.value==="reject"?"btn-2-red":"btn-2-green"]),onClick:g,disabled:t.value}," Confirm Submission ",10,Ps)])])])):u("",!0)]))}},zs={class:"flex items-center gap-6 justify-center my-16"},Gs={key:0,class:"border rounded-md"},Ws={__name:"RequirementTaskCreateOrAssign",props:{fromDepartmentId:{type:Number},requirement:{type:Object}},emits:["addNewTaskClick","cancelClick","assignTask"],setup(y,{emit:q}){const a=y,m=q,f=ut(),v=k(""),o=k(null),p=k(""),s=k(!1);async function R(){await f.setTaskRequirement(p.value,a.requirement.id),m("assignTask")}return(i,t)=>(n(),l("div",{class:L(["text-left p-4",[v.value&&!o.value?"min-h-[400px]":""]])},[e("div",zs,[e("button",{onClick:t[0]||(t[0]=I(d=>m("addNewTaskClick"),["prevent"])),class:"btn-3"},"Add New Task"),t[5]||(t[5]=e("span",null,"or",-1)),e("button",{class:L({"btn-3":v.value!=="direct-assign","btn-2":v.value=="direct-assign"}),onClick:t[1]||(t[1]=I(()=>v.value="direct-assign",["prevent"]))}," Assign Task ",2)]),v.value&&!o.value?(n(),l("div",Gs,[e("form",{onSubmit:I(R,["prevent"]),class:"p-4 flex items-end"},[w(mt,{class:"flex-grow mr-4 h-12",taskId:p.value,"onUpdate:taskId":t[2]||(t[2]=d=>p.value=d),show:s.value,"onUpdate:show":t[3]||(t[3]=d=>s.value=d),isOnlyMyTask:!1,taskQueryParams:{"from-department-id":y.fromDepartmentId},filterTasks:d=>!d.requirement_id,onAddNewTaskClick:t[4]||(t[4]=d=>m("addNewTaskClick")),showAddBtnIfNotFound:!0},null,8,["taskId","show","taskQueryParams","filterTasks"]),t[6]||(t[6]=e("div",{class:"flex justify-center"},[e("button",{class:"btn-2 h-12 rounded-md"},"Save")],-1))],32)])):u("",!0)],2))}},Qs={class:"flex flex-col items-center gax-x-1 justify-end"},Ys={key:0},Ks={key:1},Js={class:"text-sm text-gray-600 whitespace-normal w-64"},Xs={class:"text-gray-900 font-semibold text-sm md:text-base"},Zs={class:"ml-2"},er={key:0,class:"text-red-700 text-sm"},tr={key:1,class:"text-green-600 ml-2"},sr={key:2,class:"ml-2 text-yellow-700"},Oe={__name:"RequirementApprovalItem",props:{requirement:{type:Object,required:!0},approvalType:{type:String,required:!0}},emits:["updateApproval"],setup(y,{emit:q}){const a=y,m=q,f=Ve(),v=E(()=>{var i,t,d,c,b;return{from_in_charge:!!((i=a.requirement)!=null&&i.status&&((t=a.requirement)!=null&&t.submission_date)),from_coordinator:!!((d=a.requirement)!=null&&d.from_coordinator),to_in_charge:!!((c=a.requirement)!=null&&c.to_incharge),to_coordinator:!!((b=a.requirement)!=null&&b.to_coordinator)}}),o=E(()=>{var i,t,d,c,b,g,C,h;return{from_in_charge:(t=(i=a.requirement)==null?void 0:i.from_department)==null?void 0:t.in_charge,from_coordinator:(c=(d=a.requirement)==null?void 0:d.from_department)==null?void 0:c.coordinator,to_in_charge:(g=(b=a.requirement)==null?void 0:b.to_department)==null?void 0:g.in_charge,to_coordinator:(h=(C=a.requirement)==null?void 0:C.to_department)==null?void 0:h.coordinator}}),p=E(()=>{var c;const i=Object.keys(v.value),t=i.indexOf(a.approvalType);let d=!0;for(let b=t-1;b>=0;b--){const g=i[b];d=d&&(o.value[g]?(c=v.value)==null?void 0:c[g]:!0)}return d}),s=E(()=>{var g,C,h,$,A,D,ie,T,Y,K,H,O,r,W,z,G;let i=null,t=null,d="",c="";a.approvalType==="from_in_charge"&&(i=(g=a.requirement)==null?void 0:g.from_department,t=(h=(C=a.requirement)==null?void 0:C.from_department)==null?void 0:h.in_charge,d="In Charge",c=($=a.requirement)==null?void 0:$.from_incharge_note),a.approvalType==="from_coordinator"&&(i=(A=a.requirement)==null?void 0:A.from_department,t=(D=a.requirement)==null?void 0:D.from_coordinator,d="Coordinator",c=(ie=a.requirement)==null?void 0:ie.from_coordinator_note),a.approvalType==="to_in_charge"&&(i=(T=a.requirement)==null?void 0:T.to_department,t=(Y=a.requirement)==null?void 0:Y.to_in_charge,d="In Charge",c=(K=a.requirement)==null?void 0:K.to_incharge_note),a.approvalType==="to_coordinator"&&(i=(H=a.requirement)==null?void 0:H.to_department,t=(O=a.requirement)==null?void 0:O.to_coordinator,d="Coordinator",c=(r=a.requirement)==null?void 0:r.to_coordinator_note);const b=(W=o.value)==null?void 0:W[a.approvalType];return{department:i,department_user:b,approved:(z=v.value)==null?void 0:z[a.approvalType],approval_user:t,is_rejected:((G=a.requirement)==null?void 0:G.rejected_by_user_id)==(b==null?void 0:b.id),userType:d,approval_note:c}});function R(){m("updateApproval")}return(i,t)=>{var d,c,b,g,C,h;return n(),l("div",Qs,[s.value.department_user?(n(),l("div",Ys,[w(ne,{user:s.value.department_user,"avatar-size":"xsmall"},null,8,["user"])])):(n(),l("div",Ks,t[0]||(t[0]=[e("span",{class:"italic text-xs text-gray-400"},"N/A",-1)]))),e("div",Js,[s.value.is_rejected?(n(),j(X,{key:0,"line-clamp":1,class:"text-center mt-2 text-red-600"},{default:S(()=>[N(x(y.requirement.rejection_reason),1)]),_:1})):(n(),j(X,{key:1,"line-clamp":1,class:"text-center mt-2"},{default:S(()=>[N(x(s.value.approval_note),1)]),_:1}))]),e("div",null,[!s.value.is_rejected&&!s.value.approved&&p.value&&((d=F(f).user)==null?void 0:d.id)==((b=(c=s.value)==null?void 0:c.department_user)==null?void 0:b.id)?(n(),j(ft,{key:0,class:"ml-auto z-[5000000]",notificationType:"pending-requirements",applicationId:(g=a.requirement)==null?void 0:g.id,onSuccess:R,variant:1},null,8,["applicationId"])):u("",!0)]),t[2]||(t[2]=e("hr",{class:"my-2 border-gray-600 w-40 md:w-48 lg:w-64"},null,-1)),e("div",Xs,[e("span",null,x(((C=s.value.department)==null?void 0:C.short_name)||((h=s.value.department)==null?void 0:h.name)),1),e("span",Zs,x(s.value.userType),1),s.value.department_user?(n(),l(V,{key:0},[s.value.is_rejected?(n(),l("span",er," (Rejected)")):s.value.approved?(n(),l("span",tr,"(✔)")):(n(),l("span",sr,t[1]||(t[1]=[e("i",{class:"fad fa-spinner"},null,-1)])))],64)):u("",!0)])])}}},rr={class:"container mx-auto print:p-0 w-full print:max-w-full"},nr={class:"border-b px-4 py-2 bg-gray-50 flex items-center justify-between rounded-t-md"},ar={key:0},lr={class:"border table-auto w-full"},or={class:"border-y px-4 py-1"},ir={class:"border-y px-4 py-1"},dr={class:"border-y px-4 py-1 text-center"},ur={class:"border-y px-4 py-1 text-center"},mr={class:"print:shadow-none print:p-0 relative min-h-[50vh] mx-4"},cr={key:0,class:"grid grid-cols-12 gap-x-4 gap-y-3"},pr={class:"col-span-full md:col-span-8 xl:col-span-8 2xl:col-span-9 row-span-10 bg-white shadow rounded-lg p-6"},vr={class:"text-center text-xl font-bold mb-2 flex items-center"},br={class:"mb-8"},fr={class:"text-lg font-semibold mb-2"},xr={class:"flex gap-4 items-center text-gray-500"},yr={class:"text-sm"},gr={key:0,class:"flex items-center gap-1"},_r={key:0,class:"mb-5"},kr=["innerHTML"],hr={class:"mb-8"},wr={class:"font-semibold text-lg px-2"},qr={class:"w-full border rounded-lg border-gray-300 overflow-y-auto"},$r={class:"w-full border-collapse"},Cr={key:0},Tr={class:"mb-8"},Sr={class:"mb-8"},Rr={class:"font-semibold text-lg px-2"},jr={key:0},Ir=["innerHTML"],Ar={key:1,class:"text-center my-2 text-gray-400"};const Dr={key:1,class:"mt-8 border rounded-md p-8 flex items-start justify-between bg-gray-50 print:hidden"},Nr={class:"flex flex-col items-end"},Lr={key:2,class:"mt-6 mb-8 break-before-avoid-page"},Or={class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 items-stretch"},Br={key:0,class:"whitespace-nowrap border-gray-200 grid grid-cols-1 lg:grid-cols-2 gap-2 items-stretch"},Ur={class:"bg-white shadow rounded-lg space-y-4 p-4"},Er={class:"border col-span-3 p-3 rounded-md"},Fr={class:"flex items-center gap-2 mb-4"},Vr={class:"flex items-center gap-x-3 gap-y-2 flex-wrap"},Mr={class:"flex items-center gap-2 mb-4"},Pr={class:"mb-4 flex items-center justify-between gap-1 print:mb-1"},Hr={class:"font-bold print:text-gray-900"},zr={key:0,class:"mb-3 flex items-start gap-3 print:mb-1"},Gr={class:"flex items-center gap-2 print:text-gray-900 flex-wrap"},Wr={key:1,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},Qr={class:"print:text-gray-900 text-sm text-right"},Yr={key:2,class:"mb-3 flex items-center justify-between gap-3 print:mb-1"},Kr={class:"print:text-gray-900 text-sm text-right"},Jr={class:"flex justify-between items-center mb-4"},Xr={class:"mb-6"},Zr={class:"flex justify-between items-center"},en={key:1,class:"text-red-600"},tn={key:0,class:"mb-2"},sn={class:"flex justify-end text-sky-500"},rn={key:1,class:"text-right w-full mb-4"},nn={key:2,class:"mb-6"},an={class:"flex justify-between items-center"},ln={key:3,class:"text-center mb-4 text-red-700 mt-8 text-sm"},on={key:5,class:"print:hidden flex gap-2 items-center justify-between w-full text-sm"},Qn={__name:"RequirementShow",setup(y){const q=We(),a=Qe(),m=k(""),f=Ve(),v=k(),o=k(!1),p=k(),s=k(null),R=J({detail:null,open:!1}),i=J({detail:null,open:!1}),t=J({detail:null,open:!1}),d=k(!1),c=()=>d.value=!0,b=()=>d.value=!1,g=k(),C=k({isOpen:!1,taskId:null});ae(async()=>{await $(),window.addEventListener("beforeprint",c),window.addEventListener("afterprint",b),window.addEventListener("resize",h),await Pe(),bt(v.value,()=>{})});function h(){}Me(()=>{window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",b),window.removeEventListener("resize",h)});async function $(){var O;m.value="loading",s.value=(O=(await me(q.params.id)).data)==null?void 0:O.requirement,m.value=""}function A(){var O,r,W,z,G,Z,ee,te,se;if(f.user.role!=="super_admin"&&((O=f.user)==null?void 0:O.id)!==((W=(r=s.value)==null?void 0:r.to_department)==null?void 0:W.incharge_id))return alert(`You can't create or assign task for this requirement. 
Only ${(G=(z=s.value)==null?void 0:z.to_department)==null?void 0:G.name}'s In charge can create or assign.`);console.log({requirement:s}),T.modalShown=!0,T.from_department_id=s.value.from_department_id,T.to_department_id=s.value.to_department_id,T.taskDefaultValues={title:"",description:"",from_department_id:s.value.from_department_id,to_department_id:s.value.to_department_id,is_important:((Z=s.value)==null?void 0:Z.priority)=="IMPORTANT",is_urgent:((ee=s.value)==null?void 0:ee.priority)=="URGENT",supervisor_ids:(te=s.value)!=null&&te.supervisor_id?[(se=s.value)==null?void 0:se.supervisor_id]:[]},T.requirement=s.value}function D(O){R.open=!0,R.detail=O}function ie(O){t.open=!0,t.detail=O}const T=J({modalShown:!1,requirementId:0,taskDefaultValues:{},requirement:null,creating:!1});async function Y(){g.value=null,T.modalShown=!1,await $()}async function K(){T.modalShown=!1,T.requirement=null,T.creating=!1}const H=k({open:!1});return(O,r)=>{var z,G,Z,ee,te,se,ce,pe,ve,be,fe,xe,ye,ge,_e,ke,he,we,qe,$e,Ce,Te,Se,Re,je,Ie,Ae,De;const W=Be("RouterLink");return n(),l("div",rr,[i.open?(n(),j(P,{key:0},{default:S(()=>{var _;return[w(Os,{requirementId:s.value.id,detailId:(_=i.requirement.value)==null?void 0:_.id,onCloseClick:r[0]||(r[0]=U=>i.open=!1),onUpdate:r[1]||(r[1]=async()=>{i.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):u("",!0),t.open?(n(),j(P,{key:1},{default:S(()=>{var _;return[w(Ts,{requirementId:s.value.id,detailId:(_=t.requirement.value)==null?void 0:_.id,onCloseClick:r[2]||(r[2]=U=>t.open=!1),onDelete:r[3]||(r[3]=async()=>{t.open=!1,await $()})},null,8,["requirementId","detailId"])]}),_:1})):u("",!0),T.modalShown?(n(),j(P,{key:2,class:"*:relative"},{default:S(()=>{var _,U;return[e("button",{onClick:I(K,["prevent"]),class:"absolute right-3 top-2 text-xl text-red-500 hover:text-red-400"},r[20]||(r[20]=[e("i",{class:"fas fa-times-circle"},null,-1)])),T!=null&&T.creating?u("",!0):(n(),j(Ws,{key:0,"from-department-id":(_=s.value)==null?void 0:_.from_department_id,requirement:T==null?void 0:T.requirement,onCancelClick:K,onAddNewTaskClick:r[4]||(r[4]=()=>{T.modalShown=!0,T.creating=!0}),onAssignTask:Y},null,8,["from-department-id","requirement"])),T!=null&&T.creating?(n(),j(ct,{key:1,requirementDetailId:(U=T==null?void 0:T.requirement.value)==null?void 0:U.id,requirementId:s.value.id,onClose:K,onTaskCreated:Y,defaultValues:T.taskDefaultValues,readonlyFields:{from_department_id:!0,to_department_id:!0}},null,8,["requirementDetailId","requirementId","defaultValues"])):u("",!0)]}),_:1})):u("",!0),g.value?(n(),j(P,{key:3},{default:S(()=>[w(pt,{taskId:g.value,onClose:r[5]||(r[5]=_=>g.value=null),onUpdated:Y},null,8,["taskId"])]),_:1})):u("",!0),C.value.isOpen?(n(),j(P,{key:4,class:"*:max-w-4xl"},{default:S(()=>[w(dt,{taskId:C.value.taskId,onCancelClick:r[6]||(r[6]=()=>{C.value.isOpen=!1,C.value.taskId=0}),onSuccess:r[7]||(r[7]=()=>{C.value.isOpen=!1,C.value.taskId=0,m.value="loading",$()})},null,8,["taskId"])]),_:1})):u("",!0),H.value.open?(n(),j(P,{key:5},{default:S(()=>[w(ps,{requirement:s.value,onClickCancel:r[8]||(r[8]=_=>H.value.open=!1),onUpdateStatus:r[9]||(r[9]=()=>{$(),H.value.open=!1})},null,8,["requirement"])]),_:1})):u("",!0),o.value?(n(),j(P,{key:6},{default:S(()=>{var _,U,M,re;return[e("div",nr,[r[22]||(r[22]=e("h3",{class:"text-xl font-semibold"},"Closing History",-1)),e("button",{class:"btn-icon",onClick:r[10]||(r[10]=I(B=>o.value=!1,["prevent"]))},r[21]||(r[21]=[e("i",{class:"fas fa-times"},null,-1)]))]),(_=s.value)!=null&&_.closing_history&&((M=(U=s.value)==null?void 0:U.closing_history)!=null&&M.length)?(n(),l("div",ar,[e("table",lr,[r[23]||(r[23]=e("thead",null,[e("tr",null,[e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Closed AT"),e("th",{class:"border-y py-1 text-sm px-4 text-left"},"Note"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Status"),e("th",{class:"border-y py-1 text-sm px-4 text-center"},"Close/Open")])],-1)),e("tbody",null,[(n(!0),l(V,null,Q(((re=s.value)==null?void 0:re.closing_history)||[],B=>(n(),l("tr",{key:B.at},[e("td",or,x(B.at?F(ue)(B.at):""),1),e("td",ir,x(B==null?void 0:B.closing_note),1),e("td",dr,x(B==null?void 0:B.status),1),e("td",ur,x(B==null?void 0:B.type),1)]))),128))])])])):u("",!0)]}),_:1})):u("",!0),e("div",mr,[s.value?(n(),l("div",cr,[e("div",pr,[e("div",vr,[e("button",{class:"btn-3 h-8 px-4",onClick:r[11]||(r[11]=I(()=>F(a).back(),["prevent"]))},"Back"),r[24]||(r[24]=e("div",{class:"text-2xl ml-4"},"Requirement Form",-1))]),r[39]||(r[39]=e("hr",{class:"mb-4"},null,-1)),e("div",null,[e("div",br,[e("div",null,[e("div",fr,[w(X,{"line-clamp":"3",class:"mb-2"},{default:S(()=>[N(x(s.value.title),1)]),btnText:S(({lineClampClass:_})=>[N(x(_?"More":"Less"),1)]),_:1}),e("div",xr,[e("div",yr,[r[25]||(r[25]=e("span",{class:"fas fa-calendar text-sm text-gray-400"},null,-1)),N(" "+x(F(ue)(s.value.created_at)),1)]),s.value.created_by?(n(),l("div",gr,[r[26]||(r[26]=e("span",{class:"text-gray-400 text-sm"},"By",-1)),w(ne,{"avatar-size":"xsmall",user:s.value.created_by,class:"border-sky-300"},null,8,["user"])])):u("",!0)])]),s.value.description?(n(),l("div",_r,[r[27]||(r[27]=e("div",{class:"text-gray-400 mr-2 text-xs uppercase font-semibold"},"Description",-1)),w(X,{"line-clamp":4,"class-name":{button:"group-hover/item:underline"},class:"text-sm"},{default:S(()=>[e("p",{innerHTML:s.value.description,class:"text-justify"},null,8,kr)]),_:1})])):u("",!0)])]),e("div",hr,[w(le,{class:"mb-4"},{default:S(()=>[e("h2",wr,[r[28]||(r[28]=e("span",null,"Task List ",-1)),s.value.status=="approved"?(n(),l("span",{key:0,class:L(["whitespace-nowrap mt-4",[{"text-green-700 font-semibold":s.value.tasks_count>0&&s.value.completed_tasks_count==s.value.tasks_count,"text-red-700 font-semibold":s.value.tasks_count==0||s.value.completed_tasks_count!=s.value.tasks_count}]])}," ("+x(s.value.completed_tasks_count)+"/"+x(s.value.tasks_count)+" task(s) done) ",3)):u("",!0)])]),_:1}),e("div",qr,[e("table",$r,[r[30]||(r[30]=e("thead",null,[e("tr",null,[e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"SL"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Task"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Assigns"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400"},"Deadline"),e("th",{class:"border-x px-1 font-medium text-xs text-gray-400 sticky right-0 bg-gray-50"}," Status ")])],-1)),e("tbody",null,[m.value!="loading"&&((G=(z=s.value)==null?void 0:z.tasks)==null?void 0:G.length)===0?(n(),l("tr",Cr,r[29]||(r[29]=[e("td",{class:"py-4 px-3 border-t text-center text-gray-400 text-sm",colspan:"10"}," No Task ",-1)]))):(n(!0),l(V,{key:1},Q(((Z=s.value)==null?void 0:Z.tasks)||[],(_,U)=>(n(),j(et,{key:_.id,task:_,indexing:U+1,class:"*:py-3 *:border-b-0",onEditClick:r[12]||(r[12]=M=>g.value=M),onEmployeeAssignClick:r[13]||(r[13]=M=>{C.value.isOpen=!0,C.value.taskId=M})},null,8,["task","indexing"]))),128))])])])]),e("div",Tr,[w(le,{class:"mb-4"},{default:S(()=>r[31]||(r[31]=[e("h2",{class:"font-semibold text-lg px-2"},"Comments",-1)])),_:1,__:[31]}),w(Dt,{"commentable-type":"requirement","commentable-id":s.value.id,"current-user":F(f).user},null,8,["commentable-id","current-user"])]),e("div",Sr,[w(le,{class:"mb-4"},{default:S(()=>{var _,U,M,re;return[e("h2",Rr," '"+x(((U=(_=s.value)==null?void 0:_.to_department)==null?void 0:U.short_name)||((re=(M=s.value)==null?void 0:M.to_department)==null?void 0:re.name))+"' Feedback ",1)]}),_:1}),e("div",{class:L(["px-3 border border-dashed rounded-lg border-sky-600",[(ee=s.value)!=null&&ee.feedback?"py-3":"py-8"]]),colspan:"5"},[m.value!="loading"&&((te=s.value)!=null&&te.status)?(n(),l("div",jr,[String(((se=s.value)==null?void 0:se.feedback)||"").trim().length>0?(n(),j(X,{key:0,lineClamp:"2",className:{button:"  underline"},class:"mb-4 print:mb-0"},{default:S(()=>{var _;return[e("p",{class:"text-sm text-justify",innerHTML:(_=s.value)==null?void 0:_.feedback},null,8,Ir)]}),_:1})):(n(),l("div",Ar,"No Feedback")),e("div",{class:L([((ce=s.value)!=null&&ce.feedback,"w-full flex justify-center")])},[s.value.closed_at?u("",!0):(n(),l("button",{key:0,class:"btn-3 print:hidden",onClick:r[14]||(r[14]=I(()=>{i.open=!0,i.requirement=s.value},["prevent"]))},x(s.value.feedback?"Update Feedback":"Add feedback"),1))],2)])):u("",!0)],2)]),(s.value,u("",!0)),m.value!="loading"&&!((pe=s.value)!=null&&pe.status)?(n(),l("div",Dr,[e("div",Nr,[w(Hs,{"requirement-id":(ve=s.value)==null?void 0:ve.id,onSuccess:$},{heading:S(()=>r[35]||(r[35]=[N(" Requirement Submission ")])),acceptButtonLabel:S(()=>r[36]||(r[36]=[e("span",{class:"btn-2 pl-2 text-base"},[e("i",{class:"fad fa-paper-plane text-lg mr-2"}),N("Submit Requirement ")],-1)])),submitButtonLabel:S(()=>r[37]||(r[37]=[N(" Submit Requirement ")])),_:1},8,["requirement-id"])])])):u("",!0),(be=s.value)!=null&&be.status?(n(),l("div",Lr,[w(le,null,{default:S(()=>r[38]||(r[38]=[e("h2",{class:"font-semibold text-lg px-2"},"Approvals",-1)])),_:1,__:[38]}),e("div",Or,[(n(),l(V,null,Q(["from_in_charge","from_coordinator"],_=>w(Oe,{class:"pt-12",key:_,requirement:s.value,"approval-type":_,onUpdateApproval:r[15]||(r[15]=()=>$())},null,8,["requirement","approval-type"])),64))]),((fe=s.value)==null?void 0:fe.from_department_id)!==((xe=s.value)==null?void 0:xe.to_department_id)?(n(),l("div",Br,[(n(),l(V,null,Q(["to_in_charge","to_coordinator"],_=>w(Oe,{class:"pt-12",key:_,requirement:s.value,"approval-type":_,onUpdateApproval:r[16]||(r[16]=()=>$())},null,8,["requirement","approval-type"])),64))])):u("",!0)])):u("",!0)])]),e("div",{class:"col-span-full md:col-span-4 xl:col-span-4 2xl:col-span-3 sticky top-[74px] break-before-avoid-page",ref_key:"sidebarTop",ref:v},[e("div",Ur,[e("div",Er,[e("div",null,[e("div",Fr,[r[40]||(r[40]=e("div",{class:"text-gray-500 text-sm"},"From",-1)),w(Ne,{department:(ye=s.value)==null?void 0:ye.from_department,"short-name":!0},null,8,["department"])]),r[41]||(r[41]=e("div",{class:"text-gray-600 text-sm mb-2 border-b border-dashed"},"Supervisor",-1)),e("div",Vr,[(ge=s.value)!=null&&ge.supervisor?(n(),j(ne,{key:0,user:(_e=s.value)==null?void 0:_e.supervisor},null,8,["user"])):u("",!0)])]),r[43]||(r[43]=e("hr",{class:"my-4"},null,-1)),e("div",null,[e("div",Mr,[r[42]||(r[42]=e("div",{class:"text-gray-500 text-sm"},"To",-1)),w(Ne,{department:(ke=s.value)==null?void 0:ke.to_department,"short-name":!0},null,8,["department"])])])]),e("div",Pr,[r[44]||(r[44]=e("div",{class:"text-gray-500 text-sm"},"Requirement ID:",-1)),e("div",Hr,x((he=s.value)==null?void 0:he.id),1)]),((qe=(we=s.value)==null?void 0:we.website_tags)==null?void 0:qe.length)>0?(n(),l("div",zr,[r[45]||(r[45]=e("div",{class:"text-gray-500 text-sm"},"Website",-1)),e("div",Gr,[(n(!0),l(V,null,Q((($e=s.value)==null?void 0:$e.website_tags)||[],_=>(n(),l("div",{key:_.id,class:"border px-1 rounded-md bg-sky-100 border-sky-400 text-sky-700 whitespace-nowrap text-xs"},x(_.name),1))),128))])])):u("",!0),(Ce=s.value)!=null&&Ce.submission_date?(n(),l("div",Wr,[r[46]||(r[46]=e("div",{class:"text-gray-500 text-sm"},"Submission Date",-1)),e("div",Qr,x(F(ue)((Te=s.value)==null?void 0:Te.submission_date)),1)])):u("",!0),(Se=s.value)!=null&&Se.better_to_complete_on?(n(),l("div",Yr,[r[47]||(r[47]=e("div",{class:"text-gray-500 text-sm"},"Better To Complete",-1)),e("div",Kr,x(F(vt)((Re=s.value)==null?void 0:Re.better_to_complete_on,{weekDay:"long"})),1)])):u("",!0),e("div",null,[e("div",Jr,[r[48]||(r[48]=e("span",{class:"text-gray-500 text-sm"},"Priority:",-1)),e("div",null,[e("span",{class:L(["font-semibold text-sm",{"text-yellow-600 ":s.value.priority=="IMPORTANT","text-red-700 ":s.value.priority=="URGENT"}])},x(s.value.priority||"NORMAL"),3)])]),e("div",Xr,[e("div",Zr,[r[49]||(r[49]=e("span",{class:"text-gray-500 text-sm"},"Status:",-1)),s.value.status?(n(),l("span",{key:0,class:L(["border rounded-lg px-2 text-sm py-0.5",{"bg-red-300 text-red-700 border-red-400":s.value.status!="approved","bg-green-300 text-green-700 border-green-400":s.value.status=="approved"}])},x(String(s.value.status).toUpperCase()),3)):(n(),l("span",en,"..."))])]),s.value.closed_at?u("",!0):(n(),l("div",tn,[e("div",sn,[e("button",{class:"btn-1 border border-sky-800",onClick:r[17]||(r[17]=I(_=>H.value.open=!0,["prevent"]))}," Close Requirement ")])])),((Ie=(je=s.value)==null?void 0:je.closing_history)==null?void 0:Ie.length)>1?(n(),l("div",rn,[e("button",{onClick:r[18]||(r[18]=_=>o.value=!o.value),class:"text-sm text-sky-400 hover:underline"}," Show Closing History ")])):u("",!0),s.value.rejected_by?(n(),l("div",nn,[e("div",an,[r[50]||(r[50]=e("span",{class:"text-gray-500 text-sm"},"Rejected By:",-1)),w(ne,{user:s.value.rejected_by},null,8,["user"])])])):u("",!0),s.value.rejection_reason?(n(),l("div",ln,[r[51]||(r[51]=e("p",{class:"text-gray-600 mb-1 italic"},"Reason",-1)),e("p",null,x(s.value.rejection_reason),1)])):u("",!0),r[54]||(r[54]=e("hr",{class:"mb-3"},null,-1)),(Ae=s.value)!=null&&Ae.closed_at?(n(),j(ts,{key:4,requirement:s.value,onReOpenClick:r[19]||(r[19]=_=>H.value.open=!0)},null,8,["requirement"])):(n(),l("div",on,[s.value.status=="approved"?(n(),l("button",{key:0,class:"btn-3 font-semibold h-8 !pl-2 !pr-4",onClick:I(A,["prevent"])},r[52]||(r[52]=[e("i",{class:"fas fa-plus text-sm"},null,-1),N(" Add/Assign Task ")]))):u("",!0),w(W,{class:"btn-2 h-8",to:`/requirements/edit/${(De=s.value)==null?void 0:De.id}`},{default:S(()=>r[53]||(r[53]=[N(" Edit ")])),_:1,__:[53]},8,["to"])]))])]),w(Gt,{requirement:s.value,class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3"},null,8,["requirement"]),w(Ke,{class:"mt-4 md:col-span-4 xl:col-span-4 2xl:col-span-3",ref_key:"shareComponent",ref:p},null,512)],512)])):u("",!0),m.value==="loading"?(n(),j(oe,{key:1,class:"absolute inset-0 bg-opacity-90"})):u("",!0)])])}}};export{Qn as default};
