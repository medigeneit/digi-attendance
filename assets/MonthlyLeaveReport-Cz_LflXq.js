import{_ as Le,u as $e,f as Me,D as Re,r as g,x as V,q as R,y as Ue,c as p,o as c,a,i as Ne,t as i,k as A,d as z,m as Pe,F as q,e as F,s as T,l as de,b as pe,Q as De,n as r,H as Ee,P as Ve}from"./index-gX_N_SR5.js";import{_ as Ae}from"./EmployeeFilter-BsKfnu40.js";import{_ as qe}from"./FlexibleDatePicker-B4K_aX6C.js";import{L as Fe}from"./LoaderView-ByWIPa_A.js";import{u as je,E as we,a as Be}from"./jspdf.plugin.autotable-DMTk2-tx.js";import{S as Ye}from"./sweetalert2.esm.all-5zhdP7Ax.js";import"./company-qYmWMrQg.js";import"./department-BlPMW7G2.js";import"./EmployeeDropdownInput-BHlmH6yZ.js";import"./SelectDropdown-D6vHkehT.js";import"./UserChip-ExWKJX7X.js";import"./user-BoaPVa18.js";const We={class:"w-full min-w-0 space-y-3 px-3 md:px-4"},ze={class:"flex flex-wrap items-center justify-between gap-2"},Te={class:"min-w-0 flex-1 text-center"},He={class:"text-[11px] text-slate-500 truncate"},Je={class:"flex items-center gap-2"},Ke=["disabled"],Oe=["disabled"],Ie={class:"rounded-2xl border border-slate-200 bg-white shadow-sm overflow-hidden"},Qe={class:"p-3"},Ge={class:"border-t border-slate-400 bg-slate-50 px-3 py-2"},Ze={class:"month-strip"},Xe=["onClick","title"],et={class:"truncate"},tt={class:"mt-2 flex flex-wrap items-center justify-between gap-2"},at={class:"flex items-center gap-2"},st={class:"inline-flex items-center gap-2 rounded-xl border border-slate-400 bg-white px-3 py-2 text-[11px] font-semibold text-slate-700"},lt={key:0,class:"text-[11px] rounded-full bg-amber-100 text-amber-700 px-3 py-1"},nt={class:"flex items-center gap-2"},ot={key:0,class:"rounded-2xl border border-slate-300 bg-white shadow-sm p-6 text-center"},it={key:1,class:"rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-rose-700"},rt={key:2,class:"rounded-2xl border border-slate-400 bg-white shadow-sm overflow-hidden"},dt={class:"flex flex-wrap items-center justify-between gap-2 border-b border-slate-400 bg-white px-4 py-3"},pt={class:"min-w-0"},ct={class:"text-sm font-semibold text-slate-900 truncate"},ut={class:"text-slate-500 font-medium"},mt={class:"text-[11px] text-slate-500 truncate"},vt={class:"text-[11px] text-slate-500"},bt={class:"table-scroll"},yt={class:"text-[10px] uppercase tracking-wide text-slate-500"},_t={class:"bg-slate-100"},xt=["title"],ft={class:"font-bold text-slate-700"},gt={class:"text-[9px] text-slate-500 -mt-[2px]"},ht={class:"divide-y divide-slate-400"},kt={class:"sticky-col sticky-col--sl px-3 py-2 font-bold bg-white"},St={class:"sticky-col sticky-col--emp px-3 py-2 bg-white"},Ct={class:"font-semibold text-slate-800 leading-5 truncate max-w-[240px]"},Lt={class:"text-[10px] text-slate-500 leading-4 line-clamp-2 max-w-[240px]"},$t={key:0},Mt=["colspan"],Rt={key:0,class:"flex items-center justify-between gap-2 border-t border-slate-300 px-4 py-3"},Ut={class:"text-[11px] text-slate-500"},Nt={class:"flex items-center gap-2"},Pt=["disabled"],Dt=["disabled"],Et=56,Vt=260,At={__name:"MonthlyLeaveReport",setup(qt){const H=$e(),m=Me(),J=je(),{isLoading:ce,error:K,selectedYear:O,pagination:b,companyReports:h,filters:ue}=Re(J),I=new Date,Q=I.getFullYear(),G=I.getMonth()+1,x=(t,e="—")=>t==null||t===""?e:t,Z=t=>{const e=Number(t);return!e||e<2e3||e>2100?String(Q):String(e)},me=t=>{const e=Number(t);return!e||e<1||e>12?G:e},v=g(Z(m.query.year||O.value)),f=g(me(m.query.month||G)),j=g({year:Number(v.value)}),n=g({company_id:m.query.company_id||"",department_id:m.query.department_id||"all",line_type:m.query.line_type||"all",employee_id:m.query.employee_id||""}),C=g(m.query.strict_user?m.query.strict_user==="1":!1),L=g(Number(m.query.per_page||25)),y=g(Number(m.query.page||1)),w=V(()=>!!n.value.company_id&&!!v.value&&!!f.value),X=["January","February","March","April","May","June","July","August","September","October","November","December"],ve=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],B=V(()=>X[f.value-1]||"—"),Y=()=>{Ye.fire({icon:"warning",title:"Missing Selection!",text:"Please select Company, Year and Month first!",confirmButtonText:"OK"})},U=()=>{H.replace({query:{...m.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",year:v.value,month:String(f.value),strict_user:C.value?"1":"0",per_page:String(L.value),page:String(y.value)}})},be=()=>{const t={company_id:n.value.company_id,department_id:n.value.department_id,line_type:n.value.line_type,year:Number(v.value),month:Number(f.value),strict_user:C.value?1:0,per_page:L.value,page:y.value};return n.value.employee_id&&(t.user_id=n.value.employee_id),t},u=g([]),N=async()=>{if(!w.value)return;const t=await J.fetchMonthlyLeaveReport(be());u.value=Array.isArray(t==null?void 0:t.days)?t.days:[]};R(j,t=>{if(!(t!=null&&t.year))return;const e=Z(t.year);v.value!==e&&(v.value=e)},{deep:!0}),R(v,async t=>{O.value=t,y.value=1,U(),await N()},{immediate:!0}),R(f,async()=>{y.value=1,U(),await N()},{immediate:!0}),R(()=>[C.value,L.value,y.value],async()=>{U(),await N()}),R(()=>[n.value.company_id,n.value.department_id,n.value.line_type,n.value.employee_id],async()=>{y.value=1,U(),await N()});const W=t=>{if(!t)return"";const e=String(t);if(e.includes("/")){const[l,o]=e.split("/");return`${l}/${o}`}if(e.includes("-")){const[,l,o]=e.split("-");return`${o}/${l}`}return e},P=t=>{var e,l,o,d,_;return{name:x((e=t==null?void 0:t.user)==null?void 0:e.name,"Unknown"),meta:`${x((l=t==null?void 0:t.user)==null?void 0:l.department,"")}${(o=t==null?void 0:t.user)!=null&&o.department&&((d=t==null?void 0:t.user)!=null&&d.designation)?" • ":""}${x((_=t==null?void 0:t.user)==null?void 0:_.designation,"")}`}},ye=t=>{const e=String(t??"0").trim(),l=e.toUpperCase();return l==="WEEKEND"?"WK":l==="HOLIDAY"?"HD":e===""?"0":e},$=(t,e)=>{var o;const l=e==null?void 0:e.date;return ye(((o=t==null?void 0:t.cells)==null?void 0:o[l])??"0")},_e=t=>{const l=String(t??"").trim().toUpperCase().match(/^([A-Z]+)\((A|P|R)\)$/);return l?{type:l[1],status:l[2]}:null},xe=t=>{const e=String(t||"0").trim().toUpperCase();if(e==="0")return"badge badge--zero";if(e==="WK")return"badge badge--wk";if(e==="HD")return"badge badge--hd";const l=_e(e);return l?l.status==="A"?"badge badge--appr":l.status==="P"?"badge badge--pend":l.status==="R"?"badge badge--rej":"badge badge--lv":(["CL","ML","SL","WPL"].includes(e),"badge badge--lv")},fe=t=>String(t||"0").trim().toUpperCase()==="0"?"text-slate-300":"text-slate-800 font-semibold",ge=t=>{f.value=t},D=V(()=>w.value&&(h.value||[]).length>0&&(u.value||[]).length>0),ee=V(()=>{const t=v.value||String(Q),e=String(f.value).padStart(2,"0");return`monthly_leave_report_${x(n.value.company_id,"company")}_${t}-${e}`}),te=t=>`"${String(t??"").replace(/"/g,'""')}"`,he=(t,e)=>{const l=URL.createObjectURL(t),o=document.createElement("a");o.href=l,o.download=e,document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(l)},ke=()=>{if(!D.value)return Y();const t=["SL","Employee",...u.value.map(o=>W(o.label||o.date))],e=(h.value||[]).map(o=>{const d=P(o),_=[(o==null?void 0:o.sl)??"",d.name],k=u.value.map(E=>$(o,E));return[..._,...k].map(te).join(",")}),l=[t.map(te).join(","),...e].join(`
`);he(new Blob([l],{type:"text/csv;charset=utf-8;"}),`${ee.value}.csv`)},Se=()=>{if(!D.value)return Y();const t=new we({unit:"pt",format:"a4",orientation:"landscape"}),e=t.internal.pageSize.getWidth();t.setFontSize(14),t.text("Monthly Leave Application Report",40,40),t.setFontSize(10),t.text(`Company ID: ${x(n.value.company_id,"")}`,40,60),t.text(`Month: ${B.value} • Year: ${v.value}`,40,76),t.text(`Department: ${x(n.value.department_id,"all")} • Line Type: ${x(n.value.line_type,"all")}`,40,92),n.value.employee_id&&t.text(`User filter: ${x(n.value.employee_id,"")}`,e-40,76,{align:"right"});const l=[["SL","Employee",...u.value.map(d=>W(d.label||d.date))]],o=(h.value||[]).map(d=>{const _=P(d);return[(d==null?void 0:d.sl)??"",`${_.name}
${_.meta}`,...u.value.map(k=>$(d,k))]});Be(t,{startY:115,head:l,body:o,styles:{fontSize:7,cellPadding:3,valign:"middle"},headStyles:{fillColor:[241,245,249]},alternateRowStyles:{fillColor:[250,250,250]},margin:{left:30,right:30}}),t.save(`${ee.value}.pdf`)},Ce=()=>H.go(-1),ae=t=>{t.key};return window.addEventListener("keydown",ae),Ue(()=>window.removeEventListener("keydown",ae)),(t,e)=>{var l,o,d,_,k,E,se,le,ne,oe,ie;return c(),p("div",We,[a("div",ze,[a("button",{class:"btn-3",onClick:Ce},e[9]||(e[9]=[a("i",{class:"far fa-arrow-left"},null,-1),a("span",{class:"hidden sm:inline ml-2"},"Back",-1)])),a("div",Te,[e[10]||(e[10]=a("h1",{class:"text-base md:text-lg font-bold text-slate-800 leading-6 truncate"},"Monthly Leave Report",-1)),a("p",He," Company: "+i(x(n.value.company_id,"—"))+" • "+i(B.value)+" "+i(v.value),1)]),a("div",Je,[a("button",{type:"button",class:"btn-3",disabled:!D.value,title:"Export CSV",onClick:ke},e[11]||(e[11]=[a("i",{class:"far fa-file-csv"},null,-1),a("span",{class:"hidden md:inline ml-2"},"CSV",-1)]),8,Ke),a("button",{type:"button",class:"btn-3",disabled:!D.value,title:"Download PDF",onClick:Se},e[12]||(e[12]=[a("i",{class:"far fa-file-pdf"},null,-1),a("span",{class:"hidden md:inline ml-2"},"PDF",-1)]),8,Oe),w.value?A("",!0):(c(),p("button",{key:0,type:"button",class:"btn-3",title:"Missing Selection",onClick:Y},e[13]||(e[13]=[a("i",{class:"far fa-circle-exclamation"},null,-1)])))])]),a("div",Ie,[a("div",Qe,[z(Ae,{company_id:n.value.company_id,"onUpdate:company_id":e[1]||(e[1]=s=>n.value.company_id=s),department_id:n.value.department_id,"onUpdate:department_id":e[2]||(e[2]=s=>n.value.department_id=s),employee_id:n.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=s=>n.value.employee_id=s),line_type:n.value.line_type,"onUpdate:line_type":e[4]||(e[4]=s=>n.value.line_type=s),"with-type":!0,"initial-value":t.$route.query,onFilterChange:()=>{}},{default:Pe(()=>[z(qe,{modelValue:j.value,"onUpdate:modelValue":e[0]||(e[0]=s=>j.value=s),"show-year":!0,"show-month":!1,"show-date":!1,label:"Year"},null,8,["modelValue"])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"])]),a("div",Ge,[a("div",Ze,[(c(),p(q,null,F(X,(s,S)=>a("button",{key:s,class:T(["month-pill",f.value===S+1?"month-pill--active":""]),onClick:M=>ge(S+1),title:s},[a("span",et,i(ve[S]),1)],10,Xe)),64))]),a("div",tt,[a("div",at,[a("label",st,[de(a("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=s=>C.value=s),class:"accent-slate-700"},null,512),[[De,C.value]]),e[14]||(e[14]=pe(" Strict user "))]),(l=r(ue))!=null&&l.fallback_company_only?(c(),p("span",lt," Fallback: Company users ")):A("",!0)]),a("div",nt,[e[16]||(e[16]=a("span",{class:"text-[11px] font-semibold text-slate-600"},"Per Page",-1)),de(a("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>L.value=s),class:"rounded-xl border border-slate-300 bg-white px-3 py-2 text-[11px]"},e[15]||(e[15]=[a("option",{value:10},"10",-1),a("option",{value:25},"25",-1),a("option",{value:50},"50",-1),a("option",{value:100},"100",-1),a("option",{value:200},"200",-1)]),512),[[Ee,L.value]])])])])]),r(ce)?(c(),p("div",ot,[z(Fe)])):r(K)?(c(),p("div",it,i(r(K)),1)):(c(),p("div",rt,[a("div",dt,[a("div",pt,[a("p",ct,[pe(i(B.value)+" ",1),a("span",ut,i(v.value),1)]),a("p",mt," Dates: "+i(((d=(o=u.value)==null?void 0:o[0])==null?void 0:d.label)||"—")+" → "+i(((k=(_=u.value)==null?void 0:_[u.value.length-1])==null?void 0:k.label)||"—"),1)]),a("p",vt," Page "+i(((E=r(b))==null?void 0:E.current_page)??1)+" / "+i(((se=r(b))==null?void 0:se.last_page)??1)+" • Total "+i(((le=r(b))==null?void 0:le.total)??(((ne=r(h))==null?void 0:ne.length)||0)),1)]),a("div",bt,[a("table",{class:"min-w-max w-full text-[11px] text-slate-700",style:Ve({"--slw":Et+"px","--empw":Vt+"px"})},[a("thead",yt,[a("tr",_t,[e[17]||(e[17]=a("th",{class:"sticky-col sticky-col--sl bg-slate-100 px-3 py-2 text-left"},"SL",-1)),e[18]||(e[18]=a("th",{class:"sticky-col sticky-col--emp bg-slate-100 px-3 py-2 text-left"},"Employee/User",-1)),(c(!0),p(q,null,F(u.value,s=>(c(),p("th",{key:s.date,class:"px-2 py-2 text-center border-l border-slate-400 whitespace-nowrap",title:s.date},[a("div",ft,i(W(s.label||s.date)),1),a("div",gt,i(s.dow||""),1)],8,xt))),128))])]),a("tbody",ht,[(c(!0),p(q,null,F(r(h),s=>{var S;return c(),p("tr",{key:(S=s==null?void 0:s.user)==null?void 0:S.id,class:"hover:bg-sky-50"},[a("td",kt,i((s==null?void 0:s.sl)??""),1),a("td",St,[a("div",Ct,i(P(s).name),1),a("div",Lt,i(P(s).meta),1)]),(c(!0),p(q,null,F(u.value,M=>{var re;return c(),p("td",{key:((re=s==null?void 0:s.user)==null?void 0:re.id)+"_"+M.date,class:T(["px-2 py-2 text-center border-l border-slate-400 tabular-nums",fe($(s,M))])},[a("span",{class:T(xe($(s,M)))},i($(s,M)),3)],2)}),128))])}),128)),(oe=r(h))!=null&&oe.length?A("",!0):(c(),p("tr",$t,[a("td",{colspan:2+(((ie=u.value)==null?void 0:ie.length)||0),class:"px-4 py-10 text-center text-slate-500"}," No data found for selected filters. ",8,Mt)]))])],4)]),r(b)?(c(),p("div",Rt,[a("p",Ut," Page "+i(r(b).current_page)+" of "+i(r(b).last_page)+" • Total "+i(r(b).total),1),a("div",Nt,[a("button",{class:"btn-3",disabled:r(b).current_page<=1,onClick:e[7]||(e[7]=s=>y.value=Math.max(1,y.value-1))},e[19]||(e[19]=[a("i",{class:"far fa-chevron-left"},null,-1),a("span",{class:"hidden sm:inline ml-2"},"Prev",-1)]),8,Pt),a("button",{class:"btn-3",disabled:r(b).current_page>=r(b).last_page,onClick:e[8]||(e[8]=s=>y.value=y.value+1)},e[20]||(e[20]=[a("span",{class:"hidden sm:inline mr-2"},"Next",-1),a("i",{class:"far fa-chevron-right"},null,-1)]),8,Dt)])])):A("",!0)])),e[21]||(e[21]=Ne('<div class="flex flex-wrap gap-2 text-[11px] text-slate-600" data-v-31abaec1><span class="legend" data-v-31abaec1><span class="dot dot--appr" data-v-31abaec1></span><b data-v-31abaec1>(A)</b> Approved</span><span class="legend" data-v-31abaec1><span class="dot dot--pend" data-v-31abaec1></span><b data-v-31abaec1>(P)</b> Pending</span><span class="legend" data-v-31abaec1><span class="dot dot--rej" data-v-31abaec1></span><b data-v-31abaec1>(R)</b> Rejected</span><span class="legend" data-v-31abaec1><span class="dot dot--wk" data-v-31abaec1></span><b data-v-31abaec1>WK</b> Weekend</span><span class="legend" data-v-31abaec1><span class="dot dot--hd" data-v-31abaec1></span><b data-v-31abaec1>HD</b> Holiday</span><span class="legend" data-v-31abaec1><span class="dot dot--zero" data-v-31abaec1></span><b data-v-31abaec1>0</b> Normal</span></div>',1))])}}},It=Le(At,[["__scopeId","data-v-31abaec1"]]);export{It as default};
