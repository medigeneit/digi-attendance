import{u as Z,f as I,r as b,q as S,h as ee,A as te,x as se,p as ne,c as m,o as d,a as t,d as $,j as h,i as K,k as P,l as Q,v as oe,b as c,t as p,m as a,J as le}from"./index-DgYll9c7.js";import{_ as ae}from"./AttendanceTable-CsBuNbID.js";import{_ as re}from"./EmployeeFilter-n_nLWsF7.js";import{L as ie}from"./LoaderView-CcvdC_bL.js";import{S as de}from"./SelectedEmployeeCard-Dk2JqT7V.js";import{u as ue}from"./attendance-BNM7i5bx.js";import{u as pe}from"./user-sJ7YWr5v.js";import"./datetime-BEfC2TVK.js";import"./company-BSPqPoGq.js";import"./department-ClkaFOa6.js";import"./EmployeeDropdownInput-DkNn3XOS.js";import"./SelectDropdown-DBMjwLhk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserChip-DJi64ebq.js";const me={class:"px-4 space-y-4"},ce={class:"sticky top-14 z-40 text-gray-700 bg-gradient-to-tl"},ye={class:"grid md:grid-cols-2 gap-4 text-sm mt-2"},fe={key:1,class:"card-bg p-4 gap-1"},xe={class:"flex justify-between items-center"},_e={class:"px-1 pt-1 pb-0.5 overflow-hidden"},ge={class:"-mx-1 flex items-center gap-2 overflow-x-auto px-1"},ve={key:0,class:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-0.5 text-[11px] font-medium text-emerald-700 whitespace-nowrap"},be={class:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2.5 py-0.5 text-[11px] font-medium text-amber-700 whitespace-nowrap"},he={class:"inline-flex items-center gap-1 rounded-full border border-red-200 bg-red-50 px-2.5 py-0.5 text-[11px] font-medium text-red-700 whitespace-nowrap"},we={class:"inline-flex items-center gap-1 rounded-full border border-sky-200 bg-sky-50 px-2.5 py-0.5 text-[11px] font-medium text-sky-700 whitespace-nowrap"},ke={class:"grid md:grid-cols-3 gap-2 mt-1"},ze={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Se={class:"text-sm text-zinc-900"},$e={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Me={class:"text-sm text-zinc-900"},Ae={class:"flex items-center justify-between rounded-lg border border-zinc-100 bg-zinc-50 px-3 py-2"},Ue={key:0,class:"text-sm text-zinc-900"},qe={key:1,class:"inline-block h-4 w-28 rounded bg-zinc-200 animate-pulse"},Ce={key:0},Te={key:2,class:"space-y-4"},Qe={__name:"EmployeeAttendance",setup(je){const M=Z(),A=I(),l=ue(),U=pe(),_=s=>{if(!s)return"";if(typeof s=="string"){if(/^\d{4}-\d{2}$/.test(s))return s;const e=s.match(/^(\d{4})-(\d{2})/);return e?`${e[1]}-${e[2]}`:""}try{const e=new Date(s),o=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0");return`${o}-${r}`}catch{return""}},f=A.query,u=b(_(f.date)||_(l.selectedMonth)||_(new Date)),n=b({company_id:f.company_id||"",department_id:f.department_id||"all",line_type:f.line_type||"all",employee_id:f.employee_id||""}),y=b(null);let w=null;const g=(s={})=>{w&&clearTimeout(w),w=setTimeout(()=>{const e={...A.query,company_id:n.value.company_id||"",department_id:n.value.department_id||"all",line_type:n.value.line_type||"all",employee_id:n.value.employee_id||"",date:u.value||"",...s};Object.keys(e).forEach(o=>{(e[o]===""||e[o]===void 0||e[o]===null)&&delete e[o]}),M.replace({query:e}).catch(()=>{})},150)},q=async s=>{if(!s){y.value=null;return}try{await U.fetchUser(s),y.value=U.user||null}catch(e){console.error("fetchUser error:",e),y.value=null}},v=b(""),k=async()=>{const s=n.value.employee_id,e=u.value;if(!s||!e)return;const o=`${s}|${e}`;if(o!==v.value){v.value=o;try{await l.getMonthlyAttendanceByShift(s,e)}catch(r){console.error("fetchAttendance error:",r),v.value=""}}};S(()=>u.value,s=>{u.value=_(s),g({date:u.value})}),S(()=>({...n.value}),()=>{g()}),S(()=>n.value.employee_id,async(s,e)=>{s&&s!==e&&(await q(s),await k()),s||(y.value=null,v.value="")}),ee(async()=>{n.value.employee_id&&await q(n.value.employee_id),n.value.employee_id&&u.value&&await k(),await te(),g()});const Y=()=>M.go(-1),G=()=>{g()},z=se(()=>!!n.value.employee_id),X=s=>{const e=Number(s??0);if(!Number.isFinite(e)||e<=0)return"0h";const o=Math.round(e*60),r=Math.floor(o/60),x=o%60;return x?`${r}h ${x}m`:`${r}h`};return(s,e)=>{var r,x,C,T,j,B,L,N,D,F,H,E,W,R,V,J,O;const o=ne("router-link");return d(),m("div",me,[t("div",{class:"flex items-center justify-between gap-2"},[t("button",{class:"btn-3",onClick:Y},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[6]||(e[6]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Monthly Job Card",-1)),e[7]||(e[7]=t("div",null,null,-1))]),$(re,{company_id:n.value.company_id,"onUpdate:company_id":e[1]||(e[1]=i=>n.value.company_id=i),department_id:n.value.department_id,"onUpdate:department_id":e[2]||(e[2]=i=>n.value.department_id=i),employee_id:n.value.employee_id,"onUpdate:employee_id":e[3]||(e[3]=i=>n.value.employee_id=i),line_type:n.value.line_type,"onUpdate:line_type":e[4]||(e[4]=i=>n.value.line_type=i),"with-type":!0,"initial-value":s.$route.query,onFilterChange:G,class:"w-full"},{default:Q(()=>[P(t("input",{id:"monthSelect",type:"month","onUpdate:modelValue":e[0]||(e[0]=i=>u.value=i),onChange:k,class:"input-1 py-0.5","aria-label":"Select month"},null,544),[[oe,u.value]])]),_:1},8,["company_id","department_id","employee_id","line_type","initial-value"]),t("div",ce,[t("div",ye,[z.value?(d(),K(de,{key:0,user:y.value},null,8,["user"])):h("",!0),z.value?(d(),m("div",fe,[t("div",xe,[e[9]||(e[9]=t("h2",{class:"text-sm md:text-base font-semibold text-zinc-900"},"Attendance Summary",-1)),$(o,{to:{name:"MonthWiseApplicationLog",query:{...s.$route.query}},class:"inline-flex items-center gap-1 rounded-md border border-zinc-200 bg-white px-2.5 py-1 text-[12px] font-medium text-zinc-700 hover:bg-zinc-50 active:scale-[.99]",target:"_blank",rel:"noopener noreferrer"},{default:Q(()=>e[8]||(e[8]=[t("i",{class:"far fa-clock text-[12px]"},null,-1),t("span",{class:"hidden sm:inline"},"Application History",-1),t("span",{class:"sm:hidden"},"History",-1)])),_:1,__:[8]},8,["to"])]),e[21]||(e[21]=t("div",{class:"h-px w-full bg-gradient-to-r from-indigo-500/70 via-sky-400/70 to-cyan-400/70"},null,-1)),t("div",_e,[t("div",ge,[s.presentRate!==null?(d(),m("span",ve,[e[10]||(e[10]=t("i",{class:"far fa-check-circle text-[11px]"},null,-1)),e[11]||(e[11]=c(" Present ")),t("strong",null,p(((x=(r=a(l))==null?void 0:r.summary)==null?void 0:x.total_present_days)||0)+"d",1)])):h("",!0),t("span",be,[e[12]||(e[12]=t("i",{class:"far fa-clock text-[11px]"},null,-1)),e[13]||(e[13]=c(" Late ")),t("strong",null,p((T=(C=a(l))==null?void 0:C.summary)==null?void 0:T.actual_late_day)+"d",1)]),t("span",he,[e[14]||(e[14]=t("i",{class:"far fa-user-times text-[11px]"},null,-1)),e[15]||(e[15]=c(" Absent ")),t("strong",null,p(((B=(j=a(l))==null?void 0:j.summary)==null?void 0:B.total_absent_days)||0)+"d",1)]),t("span",we,[e[16]||(e[16]=t("i",{class:"far fa-bolt text-[11px]"},null,-1)),e[17]||(e[17]=c(" Total Weekends ")),t("strong",null,p((N=(L=a(l))==null?void 0:L.summary)==null?void 0:N.total_weekend_days)+"d",1)])])]),t("div",ke,[t("div",ze,[e[18]||(e[18]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-briefcase text-[12px]"}),c(" Total Working Days ")],-1)),t("strong",Se,p(((F=(D=a(l))==null?void 0:D.summary)==null?void 0:F.total_working_days)||0),1)]),t("div",$e,[e[19]||(e[19]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-hourglass-half text-[12px]"}),c(" Working Hours ")],-1)),t("strong",Me,p((((E=(H=a(l))==null?void 0:H.summary)==null?void 0:E.total_working_hours)??"").toString().trim()||"â€”"),1)]),t("div",Ae,[e[20]||(e[20]=t("span",{class:"flex items-center gap-2 text-[12px] text-zinc-600"},[t("i",{class:"far fa-bolt text-[12px]"}),c(" Overtime Hours ")],-1)),(W=a(l))!=null&&W.loading?(d(),m("span",qe)):(d(),m("strong",Ue,p(X((V=(R=a(l))==null?void 0:R.summary)==null?void 0:V.approved_overtimes))+" of "+p((O=(J=a(l))==null?void 0:J.summary)==null?void 0:O.total_overtime_hours),1))])])])):h("",!0)])]),y.value?h("",!0):(d(),m("div",Ce,e[22]||(e[22]=[t("p",{class:"text-gray-400 text-center text-2xl italic"},"Select an employee, please.",-1)]))),a(l).isLoading?(d(),K(ie,{key:1})):P((d(),m("div",Te,[$(ae,{logs:a(l).monthlyLogs},null,8,["logs"])],512)),[[le,z.value]])])}}};export{Qe as default};
