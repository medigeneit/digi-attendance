import{u as T,D as $,r as _,h as I,x as u,p as q,c as n,o as i,a as t,d as k,m as D,b as x,l as A,v as z,G,F as f,e as C,t as r,P as K,n as H,k as b}from"./index-Duczo5ui.js";import{_ as J}from"./UserChip-Bxg-7fMV.js";import{u as O}from"./userPermissionStore-Bj66dGmA.js";import"./user-BpS45bFi.js";const Q={class:"max-w-6xl mx-auto px-4 py-6 space-y-5"},W={class:"flex items-center justify-between gap-3"},X={class:"rounded-2xl border border-slate-200 bg-white shadow-sm"},Y={class:"p-3 sm:p-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Z={class:"flex flex-col sm:flex-row gap-2 sm:items-center w-full"},ee={class:"relative w-full sm:w-96"},te=["value"],se={class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700"},le={class:"text-xs text-slate-500"},oe={class:"font-semibold text-slate-700"},ne={class:"overflow-x-auto border-t border-slate-200"},ie={class:"min-w-full text-sm"},ae={class:"divide-y divide-slate-100"},re={key:0,class:"bg-white"},de={class:"px-4 py-3 text-slate-500 whitespace-nowrap"},pe=["rowspan"],ce={class:"flex items-start gap-3"},me={class:"px-4 py-3 text-slate-700"},ue={class:"font-medium text-slate-900"},xe={class:"text-xs text-slate-500"},fe={class:"px-4 py-3"},ge={class:"flex flex-wrap gap-1.5 max-w-xl"},ye={key:0,class:"inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-semibold text-slate-700"},be=["title"],ve=["title"],he={key:1,class:"text-xs text-slate-500"},we={class:"px-4 py-3 text-right"},_e={class:"inline-flex items-center gap-2"},ke=["onClick"],Ae=["onClick"],Ce={key:0},Se={colspan:"5",class:"px-4 py-12 text-center"},Pe={class:"mx-auto max-w-sm"},Re={__name:"PermissionList",setup(Le){const v=O(),S=T(),{userPermissions:P,loading:U}=$(v),h=_(""),g=_("all"),w=_(!1),E=()=>S.back(),M=l=>S.push({name:"PermissionEdit",params:{id:l}}),R=async l=>{confirm("Delete this permission?")&&await v.deletePermission(l)};I(()=>{v.fetchUserPermissions()});const V=u(()=>(P.value||[]).reduce((e,o)=>{const s=o==null?void 0:o.user;if(!(s!=null&&s.id))return e;const a=e.find(p=>p.id===s.id);return a?(a.permissions.push(o),e):[...e,{...s,permissions:[o]}]},[])),j=u(()=>{const l=new Map;return(P.value||[]).forEach(e=>{const o=e==null?void 0:e.company;o!=null&&o.id&&l.set(String(o.id),o)}),Array.from(l.values()).sort((e,o)=>String(e.name).localeCompare(String(o.name)))}),L=l=>{const e=l==null?void 0:l.department_ids;return Array.isArray(e)?e.includes("*"):typeof e=="string"?e==="*"||e.includes("*"):!1},B=u(()=>{const l=[];return V.value.forEach(e=>{(e.permissions||[]).forEach((o,s)=>{l.push({user:e,perm:o,isFirstForUser:s===0,rowspan:(e.permissions||[]).length||1})})}),l}),y=u(()=>{let l=B.value;const e=h.value.trim().toLowerCase();return e&&(l=l.filter(o=>{var m;const s=o.user||{},a=o.perm||{},p=Array.isArray(a.departments)?a.departments.join(", "):"";return String(s.name||"").toLowerCase().includes(e)||String(s.email||"").toLowerCase().includes(e)||String(((m=a.company)==null?void 0:m.name)||"").toLowerCase().includes(e)||p.toLowerCase().includes(e)})),g.value!=="all"&&(l=l.filter(o=>{var s,a;return String(((a=(s=o.perm)==null?void 0:s.company)==null?void 0:a.id)||"")===String(g.value)})),w.value&&(l=l.filter(o=>L(o.perm))),l}),F=u(()=>{const l=new Map;let e=0;return y.value.forEach(o=>{l.set(o.perm.id,++e)}),l}),d=l=>L(l)?[{label:"All",all:!0}]:(Array.isArray(l==null?void 0:l.departments)?l.departments:[]).map(o=>({label:o,all:!1}));return(l,e)=>{const o=q("RouterLink");return i(),n("div",Q,[t("div",W,[t("button",{class:"inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50",onClick:E},e[3]||(e[3]=[t("span",{class:"text-base"},"←",-1),t("span",{class:"hidden md:inline"},"Back",-1)])),e[5]||(e[5]=t("div",{class:"text-center"},[t("p",{class:"text-xs font-semibold uppercase tracking-[0.2em] text-indigo-500"},"Access Control"),t("h1",{class:"mt-1 text-2xl font-semibold text-slate-900"},"Permissions"),t("p",{class:"mt-1 text-xs text-slate-500"},"Manage user-level access by company and department.")],-1)),k(o,{to:{name:"PermissionsAdd"},class:"inline-flex items-center gap-2 rounded-xl bg-slate-900 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-slate-800"},{default:D(()=>e[4]||(e[4]=[t("span",{class:"text-lg leading-none"},"+",-1),x(" Add New ")])),_:1,__:[4]})]),t("div",X,[t("div",Y,[t("div",Z,[t("div",ee,[e[6]||(e[6]=t("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"},"⌕",-1)),A(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),type:"text",placeholder:"Search user, email, company, department...",class:"w-full rounded-xl border border-slate-200 bg-white pl-9 pr-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/30"},null,512),[[z,h.value]])]),A(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),class:"rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500/30"},[e[7]||(e[7]=t("option",{value:"all"},"All companies",-1)),(i(!0),n(f,null,C(j.value,s=>(i(),n("option",{key:s.id,value:s.id},r(s.name),9,te))),128))],512),[[G,g.value]]),t("label",se,[A(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>w.value=s),class:"h-4 w-4 rounded border-slate-300"},null,512),[[K,w.value]]),e[8]||(e[8]=x(" Show “All departments” only "))])]),t("div",le,[e[9]||(e[9]=x(" Showing ")),t("span",oe,r(y.value.length),1),e[10]||(e[10]=x(" permissions "))])]),t("div",ne,[t("table",ie,[e[17]||(e[17]=t("thead",{class:"sticky top-0 bg-slate-50 text-xs uppercase tracking-wide text-slate-500"},[t("tr",null,[t("th",{class:"text-left px-4 py-3 w-12"},"#"),t("th",{class:"text-left px-4 py-3"},"User"),t("th",{class:"text-left px-4 py-3"},"Company"),t("th",{class:"text-left px-4 py-3"},"Departments"),t("th",{class:"text-right px-4 py-3 w-28"},"Actions")])],-1)),t("tbody",ae,[H(U)?(i(),n("tr",re,e[11]||(e[11]=[t("td",{colspan:"5",class:"px-4 py-10 text-center text-slate-500"}," Loading permissions... ",-1)]))):(i(),n(f,{key:1},[(i(!0),n(f,null,C(y.value,s=>{var a,p,m;return i(),n("tr",{key:s.perm.id,class:"hover:bg-slate-50/60"},[t("td",de,r(F.value.get(s.perm.id)),1),s.isFirstForUser?(i(),n("td",{key:0,class:"px-4 py-3 align-top",rowspan:s.rowspan},[t("div",ce,[k(J,{user:s.user},null,8,["user"])])],8,pe)):b("",!0),t("td",me,[t("div",ue,r(((a=s.perm.company)==null?void 0:a.name)||"-"),1),t("div",xe,"Company ID: "+r(((p=s.perm.company)==null?void 0:p.id)||"-"),1)]),t("td",fe,[t("div",ge,[(m=d(s.perm)[0])!=null&&m.all?(i(),n("span",ye," All departments ")):(i(),n(f,{key:1},[(i(!0),n(f,null,C(d(s.perm).slice(0,4),(c,N)=>(i(),n("span",{key:N,class:"inline-flex items-center rounded-full bg-indigo-50 px-2.5 py-1 text-xs font-semibold text-indigo-700",title:c.label},r(c.label),9,be))),128)),d(s.perm).length>4?(i(),n("span",{key:0,class:"inline-flex items-center rounded-full bg-slate-100 px-2.5 py-1 text-xs font-semibold text-slate-700",title:d(s.perm).slice(4).map(c=>c.label).join(", ")}," +"+r(d(s.perm).length-4)+" more ",9,ve)):b("",!0),d(s.perm).length?b("",!0):(i(),n("span",he,"-"))],64))])]),t("td",we,[t("div",_e,[t("button",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white hover:bg-slate-50",title:"Edit",onClick:c=>M(s.perm.id)},e[12]||(e[12]=[t("i",{class:"far fa-pencil-alt"},null,-1)]),8,ke),t("button",{class:"inline-flex h-9 w-9 items-center justify-center rounded-xl border border-slate-200 bg-white text-red-600 hover:bg-red-50",title:"Delete",onClick:c=>R(s.perm.id)},e[13]||(e[13]=[t("i",{class:"far fa-trash-alt"},null,-1)]),8,Ae)])])])}),128)),y.value.length?b("",!0):(i(),n("tr",Ce,[t("td",Se,[t("div",Pe,[e[15]||(e[15]=t("div",{class:"text-slate-900 font-semibold"},"No permissions found",-1)),e[16]||(e[16]=t("p",{class:"mt-1 text-sm text-slate-500"}," Try clearing filters or add a new permission. ",-1)),k(o,{to:{name:"PermissionsAdd"},class:"mt-4 inline-flex items-center gap-2 rounded-xl bg-slate-900 px-4 py-2.5 text-sm font-semibold text-white hover:bg-slate-800"},{default:D(()=>e[14]||(e[14]=[x(" + Add Permission ")])),_:1,__:[14]})])])]))],64))])])])])])}}};export{Re as default};
