import{u as C,r as y,p as L,N as V,b as E,c as d,a as t,l as H,m as W,j as $,w as j,d as v,v as g,t as c,e as b,F as x,x as D,A as q,h as U,n as I,o as r,k as O,O as T,g as P}from"./index-rfORStRX.js";import{u as Y}from"./leave-application-CiEU9TVR.js";import{u as z}from"./leave-type-BoL0XEWK.js";import{u as G}from"./user-BcCqthJ_.js";import{L as J}from"./LoaderView-fbH3Y_yG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"my-container max-w-3xl space-y-4"},Q={class:"flex items-center justify-between gap-2"},X={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Z={key:0,class:""},ee={class:"text-blue-600 font-medium"},te={key:1,class:"bg-gray-100 p-2 rounded-md"},ae={class:"font-semibold"},se={class:"flex flex-wrap gap-2"},le=["name","value","onUpdate:modelValue"],ne={class:"flex items-center space-x-1"},oe=["name","onUpdate:modelValue"],re=["value"],de={key:2,class:"text-red-500 text-sm"},_e={__name:"LeaveApplicationAdd",setup(ie){const h=P(),A=Y(),f=z(),S=G(),m=C(),s=y({last_working_date:"",resumption_date:"",reason:"",works_in_hand:"",handover_user_id:"",leave_days:[]}),i=y([]),w=y(!1),_=y(null),u=L(()=>{const o=s.value.last_working_date,e=s.value.resumption_date;if(!o||!e)return[];const p=new Date(o),a=new Date(e);if(a<=p)return[];const n=[];let l=new Date(p);for(l.setDate(l.getDate()+1);l<a;){const k=l.getFullYear(),N=(l.getMonth()+1).toString().padStart(2,"0"),F=l.getDate().toString().padStart(2,"0");n.push(`${k}-${N}-${F}`),l.setDate(l.getDate()+1)}return n}),M=L(()=>{const o=s.value.last_working_date,e=s.value.resumption_date;if(!o||!e)return"";const p=new Date(o);return new Date(e)<=p?"Resumption date must be after Last Working Date.":u.value.length===0?"No leave days between the selected dates.":`Total leave days: ${u.value.length}`});V(()=>{u.value.length&&f.leaveTypes.length&&i.value.length!==u.value.length&&(i.value=u.value.map(()=>f.leaveTypes[0].id))});const R=async()=>{var o;w.value=!0,_.value=null;try{const e=u.value.map((n,l)=>({date:n,leave_type_id:i.value[l]!=="weekend"?i.value[l]:null})).filter(n=>n.leave_type_id!==null),p={user_id:(o=m==null?void 0:m.user)==null?void 0:o.id,last_working_date:s.value.last_working_date,resumption_date:s.value.resumption_date,reason:s.value.reason,works_in_hand:s.value.works_in_hand,handover_user_id:s.value.handover_user_id,leave_days:e},a=await A.storeLeaveApplication(p);h.push({name:"LeaveApplicationShow",params:{id:a.id}})}catch(e){_.value=e.message||"Failed to submit leave application"}finally{w.value=!1}};E(()=>{V(()=>{var e;const o=(e=m==null?void 0:m.user)==null?void 0:e.company_id;o&&f.fetchLeaveTypes(o)}),S.fetchUsers()});const B=()=>{h.go(-1)};return(o,e)=>{const p=I("RouterLink");return r(),d("div",K,[t("div",Q,[t("button",{class:"btn-3",onClick:B},e[5]||(e[5]=[t("i",{class:"far fa-arrow-left"},null,-1),t("span",{class:"hidden md:flex"},"Back",-1)])),e[7]||(e[7]=t("h1",{class:"title-md md:title-lg flex-wrap text-center"},"Leave Application Form",-1)),t("div",null,[H(p,{to:"/my-applications",class:"btn-2"},{default:W(()=>e[6]||(e[6]=[O("Home")])),_:1})])]),w.value?(r(),$(J,{key:0})):(r(),d("form",{key:1,onSubmit:j(R,["prevent"]),class:"space-y-4 card-bg p-4 md:p-8"},[t("div",X,[t("div",null,[e[8]||(e[8]=t("label",{for:"last-working-date",class:"block text-sm font-medium"},"Last Working Date",-1)),v(t("input",{type:"date",id:"last-working-date","onUpdate:modelValue":e[0]||(e[0]=a=>s.value.last_working_date=a),class:"input-1 w-full",required:""},null,512),[[g,s.value.last_working_date]])]),t("div",null,[e[9]||(e[9]=t("label",{for:"resumption-date",class:"block text-sm font-medium"},"Resumption Date",-1)),v(t("input",{type:"date",id:"resumption-date","onUpdate:modelValue":e[1]||(e[1]=a=>s.value.resumption_date=a),class:"input-1 w-full",required:""},null,512),[[g,s.value.resumption_date]])])]),s.value.last_working_date&&s.value.resumption_date?(r(),d("div",Z,[t("p",ee,c(M.value),1)])):b("",!0),u.value.length?(r(),d("div",te,[e[11]||(e[11]=t("h2",{class:"text-lg font-semibold"},"Leave Days",-1)),t("div",null,[(r(!0),d(x,null,D(u.value,(a,n)=>(r(),d("div",{key:n,class:"flex gap-4 mb-2 bg-white p-2 rounded-md"},[t("div",ae,c(a),1),t("div",se,[(r(!0),d(x,null,D(U(f).leaveTypes,l=>(r(),d("label",{key:l.id,class:"flex items-center space-x-1"},[v(t("input",{type:"radio",name:"leaveType-"+n,value:l.id,"onUpdate:modelValue":k=>i.value[n]=k},null,8,le),[[T,i.value[n]]]),t("span",null,c(l.name),1)]))),128)),t("label",ne,[v(t("input",{type:"radio",name:"leaveType-"+n,value:"weekend","onUpdate:modelValue":l=>i.value[n]=l},null,8,oe),[[T,i.value[n]]]),e[10]||(e[10]=t("span",null,"Weekend",-1))])])]))),128))])])):b("",!0),t("div",null,[e[12]||(e[12]=t("label",{for:"reason",class:"block text-sm font-medium"},"Reason",-1)),v(t("textarea",{id:"reason","onUpdate:modelValue":e[2]||(e[2]=a=>s.value.reason=a),class:"input-1 w-full",placeholder:"Enter your reason for leave"},null,512),[[g,s.value.reason]])]),t("div",null,[e[13]||(e[13]=t("label",{for:"works-in-hand",class:"block text-sm font-medium"},"Works in Hand",-1)),v(t("textarea",{id:"works-in-hand","onUpdate:modelValue":e[3]||(e[3]=a=>s.value.works_in_hand=a),class:"input-1 w-full",placeholder:"Enter details of works in hand"},null,512),[[g,s.value.works_in_hand]])]),t("div",null,[e[15]||(e[15]=t("label",{for:"handover-user",class:"block text-sm font-medium"},"Handover User",-1)),v(t("select",{id:"handover-user","onUpdate:modelValue":e[4]||(e[4]=a=>s.value.handover_user_id=a),class:"input-1 w-full",required:""},[e[14]||(e[14]=t("option",{value:""},"Select Handover User",-1)),(r(!0),d(x,null,D(U(S).users,a=>(r(),d("option",{key:a.id,value:a.id},c(a==null?void 0:a.name),9,re))),128))],512),[[q,s.value.handover_user_id]])]),_.value?(r(),d("div",de,c(_.value),1)):b("",!0),e[16]||(e[16]=t("div",{class:"flex justify-end"},[t("button",{type:"submit",class:"btn-2"},"Submit")],-1))],32))])}}};export{_e as default};
