import{c as n,o as s,F as S,x as N,m as _,p as w,I as V,G as W,q as x,f as m,y as h,a as t,z as X,n as y,t as g,T as Z,l as p,B as z,k as H,b as ee,r as F,A as te,w as $,h as se}from"./index-6S7cHxvf.js";import{_ as G}from"./UserChip-CHtI344L.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"mt-3"},ae={__name:"TaskTreeChildren",props:{childrenTasks:{type:Array,required:!0,default:[]},hideButtons:{type:Boolean,default:!1},parentTreeLevel:{type:Number}},emits:["editClick","addClick"],setup(e,{emit:l}){const a=l;return(u,i)=>(s(),n("div",re,[(s(!0),n(S,null,N(e.childrenTasks,(d,k)=>(s(),_(Qe,{key:d.id,index:k,task:d,class:"mb-3","hide-buttons":e.hideButtons,"tree-level":e.parentTreeLevel+1,onEditClick:i[0]||(i[0]=f=>a("editClick",f)),onAddClick:i[1]||(i[1]=f=>a("addClick",f))},{"item-end":w(({task:f,level:o})=>[V(u.$slots,"treeItemEnd",{task:f,level:o})]),_:2},1032,["index","task","hide-buttons","tree-level"]))),128))]))}},le=W({__name:"SubTaskProgress",props:{task:{}},setup(e,{expose:l}){const a=e,u=x(function(){return a.task.completed_count}),i=x(()=>a.task.children_task_count===0?a.task.status==="COMPLETED"?100:0:u.value/a.task.children_task_count*100),d=x(()=>{const k=i.value;let f,o,b;return k===100?(f="bg-green-50",o="bg-green-200",b="text-green-600 "):k<100&&(f="bg-red-50",o="bg-red-200",b="text-red-600 "),{container:f,bar:o,text:b}});return l({completedPercentage:i.value,completedSubTaskCount:u.value}),(k,f)=>(s(),n("div",null,[k.task.children_task_count>0?(s(),n("div",{key:0,class:h(["rounded-full border py-0.5 relative overflow-hidden h-6",d.value.container]),style:{width:"180px"}},[t("div",{class:h(["z-10 absolute top-0 bottom-0",d.value.bar]),style:X(`width: ${i.value}%`)},null,6),t("span",{class:h(["z-20 absolute inset-0 gap-1 text-center h-full flex justify-center items-center",d.value.text])},[t("span",null,[t("span",null,g(u.value),1),f[0]||(f[0]=y(" / ")),t("span",null,g(k.task.children_task_count),1)])],2)],2)):m("",!0)]))}}),ne={__name:"TaskStatus",props:{status:{type:String,required:!0}},setup(e){const l=e,a=x(()=>{switch(l.status){case"COMPLETED":return"text-white bg-green-500  border-green-200 font-semibold";case"PENDING":return"text-red-500 bg-red-200  border-red-200";case"IN_PROGRESS":return"text-yellow-600 bg-yellow-200  border-yellow-200"}return"bg-blue-100 text-blue-800 border-blue-200"}),u=x(()=>{switch(l.status){case"COMPLETED":return"fas fa-check-circle"}return"fas fa-exclamation-circle"});return(i,d)=>(s(),n("div",{class:h(["px-2 py-0.5 text-xs rounded-full border flex items-center gap-1",a.value])},[t("i",{class:h(u.value)},null,2),y(" "+g(e.status),1)],2))}},J=e=>{if(!e)return"";try{const l=new Date(e);if(isNaN(l))return"";const a=String(l.getDate()).padStart(2,"0"),i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][l.getMonth()],d=l.getFullYear();return`${a}-${i}-${d}`}catch{return""}},oe={class:"relative"},ie={key:0,class:"text-gray-500 text-xs"},de={key:2,class:"text-sm text-gray-500 group/users"},ue={class:"cursor-pointer hover:underline text-blue-600"},ce={class:"hidden absolute group-hover/users:block right-0 p-3 bg-white rounded shadow-lg"},fe={__name:"TaskAssignedUsers",props:{users:{type:Array,required:!0,default:()=>[]},maxItems:{type:Number,default:2},routeTo:{type:Function,default:()=>null},isTargetTask:{Boolean,default:!1}},setup(e){const l=e,a=x(()=>l.users.slice(0,2)),u=x(()=>l.users.slice(2));function i(k){if(typeof l.routeTo=="function")return l.routeTo(k)}const d=x(()=>typeof l.routeTo=="function"?Z:"div");return(k,f)=>(s(),n("div",oe,[l.users.length===0?(s(),n("div",ie,"Not Assigned To Anyone")):(s(!0),n(S,{key:1},N(a.value,(o,b)=>(s(),_(z(d.value),{key:b,to:i(o)},{default:w(()=>[p(G,{class:h(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm",{"!bg-yellow-400":e.isTargetTask}]),user:o},null,8,["class","user"])]),_:2},1032,["to"]))),128)),u.value.length>0?(s(),n("div",de,[t("div",ue," + "+g(u.value.length)+" more users ",1),t("div",ce,[(s(!0),n(S,null,N(u.value,(o,b)=>(s(),_(z(d.value),{key:b,to:i(o),class:"w-full block mb-2"},{default:w(()=>[p(G,{class:h(["flex items-center gap-2 border rounded-full border-gray-300 shadow-sm w-full",{"!bg-yellow-400":e.isTargetTask}]),user:o},null,8,["class","user"])]),_:2},1032,["to"]))),128))])])):m("",!0)]))}},me={},ke={class:"text-xs px-2 py-0.5 rounded-full border bg-yellow-800 text-white"};function ge(e,l){return s(),n("span",ke,"IMPORTANT")}const xe=K(me,[["render",ge]]),he={__name:"TaskTitleRouterLink",props:{task:Object},setup(e){return(l,a)=>{const u=H("RouterLink");return s(),_(u,{to:{name:"TaskShow",params:{id:e.task.id}},class:"font-medium text-gray-700 cursor-pointer hover:text-sky-700"},{default:w(()=>[t("div",null,g(e.task.title),1)]),_:1},8,["to"])}}},be={},ve={class:"text-xs px-2 py-0.5 rounded-full border bg-red-500 text-white"};function pe(e,l){return s(),n("span",ve,"URGENT")}const ye=K(be,[["render",pe]]),_e={class:"flex w-full"},we={key:0,class:"border-l border-gray-200 last:border-l-0"},Te={class:"items-start grid grid-cols-4 gap-4 group"},Ce={class:"col-span-full md:col-span-full pb-3 border-b -mx-3 px-3 flex flex-wrap"},$e={class:"flex items-center gap-2 w-full lg:w-auto mb-3 lg:mb-0 whitespace-break-spaces"},Se={key:0,class:"text-xl font-semibold text-sky-500"},Ne={key:1,class:"text-sm text-gray-500 mt-2"},Le={class:"justify-end items-center gap-2 ml-auto flex order-1 lg:order-0"},Ae={class:"flex items-center gap-6 flex-none lg:w-full order-0 lg:order-1"},Be={class:"flex gap-4 items-center"},De={class:"text-gray-500 text-sm"},Ee={class:"text-red-500 text-sm"},Re={class:"flex items-center gap-2 text-xs text-gray-500 opacity-80 text-left"},Oe={class:"col-span-full flex items-center my-2 lg:my-0 justify-center flex-wrap gap-3"},Pe={class:"ml-auto text-right text-sm flex items-center justify-center sm:justify-start gap-4"},qe={key:0,class:"bg-yellow-200 px-2 py-0.5 rounded-lg text-yellow-900"},Ie={key:1,class:"text-gray-500"},Me={class:"font-semibold text-green-800"},je={key:2,class:"ml-4 text-gray-500"},Ue={class:"text-red-500 font-semibold"},ze={class:"mt-4 col-span-full"},Fe={class:"flex flex-col sm:flex-row gap-3 items-center mt-4 w-full"},Ge={class:"text-xs text-gray-500 flex gap-3 order-1 sm:order-0"},Je=["href"],Ve={class:"flex items-center sm:ml-auto order-0 sm:order-1"},He={key:0,class:"flex gap-2 ml-4 items-center text-xs"},Ke=["href"],Ye={class:"ml-0"},Qe={__name:"TaskTreeView",props:{task:{type:Object,required:!0},hideButtons:{type:Boolean,default:!1},treeLevel:{type:Number,default:0},showDraggableHandle:{Boolean,default:!1},index:{type:Number}},emits:["commentButtonClick","editClick","addClick"],setup(e,{emit:l}){const a=e,u=ee(),i=F(null),d=l;function k(c){d("addClick",c)}function f(c){d("editClick",c)}const o=F([]),b=localStorage.getItem("sub_task_opened_list");if(b)try{o.value=JSON.parse(b)}catch{o.value=[]}const L=x(()=>J(a.task.started_at)),A=x(()=>J(a.task.deadline)),T=x({get:()=>o.value.includes(a.task.id),set:c=>{const r=o.value.includes(a.task.id);c&&!r?o.value.push(a.task.id):!c&&r&&(o.value=o.value.filter(C=>C!==a.task.id))}});te(o,c=>{localStorage.setItem("sub_task_opened_list",JSON.stringify(c))},{deep:!0});const B=x(()=>{var c,r;return((r=(c=a.task)==null?void 0:c.children_tasks)==null?void 0:r.length)>0});function Y(){a.task.children_tasks.length>0&&(T.value=!T.value)}return(c,r)=>{var D,E,R,O,P,q,I,M,j,U;const C=H("RouterLink");return s(),n("div",_e,[e.treeLevel>0?(s(),n("div",we,r[3]||(r[3]=[t("div",{class:"border-l border-b w-4 rounded-bl-full border-gray-200 h-4/6 ml-[-1px] mt-[-30px]"},null,-1)]))):m("",!0),t("div",{class:h(["flex-grow border rounded py-3 px-3",{"bg-green-100  ":((D=i.value)==null?void 0:D.completedPercentage)===100,"bg-white hover:bg-gray-50":((E=i.value)==null?void 0:E.completedPercentage)<100,"shadow-sm":e.treeLevel>0}])},[t("div",Te,[t("div",Ce,[t("div",$e,[e.index!==void 0?(s(),n("div",Se,g(e.index+1)+". ",1)):m("",!0),p(he,{task:e.task},null,8,["task"]),(R=e.task)!=null&&R.requirement?(s(),n("p",Ne," Requirement: "+g((P=(O=e.task)==null?void 0:O.requirement)==null?void 0:P.title),1)):m("",!0)]),t("div",Le,[p(ne,{status:e.task.status},null,8,["status"]),p(le,{task:e.task,ref_key:"progress",ref:i,class:"text-sm"},null,8,["task"])]),t("div",Ae,[t("div",Be,[e.showDraggableHandle?(s(),n("button",{key:0,onMousedown:r[0]||(r[0]=$((...v)=>c.handleDragging&&c.handleDragging(...v),["stop"])),class:"handle"},r[4]||(r[4]=[t("i",{class:"fas fa-arrows-alt text-gray-500 cursor-grab"},null,-1)]),32)):m("",!0),t("span",De," #"+g(e.task.id),1),t("div",Ee,g(e.treeLevel),1)]),t("div",Re,[(q=e.task)!=null&&q.is_important?(s(),_(xe,{key:0})):m("",!0),(I=e.task)!=null&&I.is_urgent?(s(),_(ye,{key:1})):m("",!0)])])]),t("div",Oe,[p(fe,{class:"flex items-center justify-center flex-wrap gap-3",users:e.task.users||[],isTargetTask:e.task.is_target,routeTo:v=>({query:{...se(u).query,view:"userwise","company-id":v.company_id,"user-ids":v.id}})},null,8,["users","isTargetTask","routeTo"]),p(C,{to:{name:"TaskUserAssign",params:{id:(M=e.task)==null?void 0:M.id}},title:"Add/Remove User",class:"border-gray-400 bg-gray-50 text-gray-500 hover:bg-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border"},{default:w(()=>r[5]||(r[5]=[t("i",{class:"fas fa-users-cog"},null,-1)])),_:1,__:[5]},8,["to"])])]),t("div",Pe,[e.task.is_target?(s(),n("div",qe," TARGET TASK ")):m("",!0),L.value?(s(),n("span",Ie,[r[6]||(r[6]=y(" Started: ")),t("span",Me,g(L.value),1)])):m("",!0),A.value?(s(),n("span",je,[r[7]||(r[7]=y(" Deadline: ")),t("span",Ue,g(A.value),1)])):m("",!0)]),t("div",ze,[t("div",Fe,[t("div",Ge,[t("button",{class:h([{"text-yellow-600 font-semibold  inline-block  ":B.value},"flex items-center gap-1 group"]),onClick:Y},[t("i",{class:h([T.value?"fa-caret-down":"fa-caret-right","fas w-3 text-left text-xl"])},null,2),t("span",{class:h(B.value?"group-hover:underline":"")}," Sub Tasks ("+g((j=e.task.children_tasks)==null?void 0:j.length)+") ",3)],2),e.treeLevel<2?(s(),n("a",{key:0,href:`/tasks/add?parent_id=${a.task.id}`,class:"hover:bg-indigo-600 hover:text-white text-indigo-600 font-semibold px-3 py-0.5 rounded-full transition border border-transparent",onClick:r[1]||(r[1]=$(v=>d("addClick",a.task.id),["stop","prevent"]))},r[8]||(r[8]=[t("i",{class:"fas fa-plus"},null,-1),y(" Add Sub Task ")]),8,Je)):m("",!0)]),t("div",Ve,[e.hideButtons?m("",!0):(s(),n("div",He,[t("a",{href:`/tasks/edit/${e.task.id}`,onClick:r[2]||(r[2]=$(v=>d("editClick",e.task.id),["stop","prevent"])),class:"btn-2 py-0.5 text-xs"},r[9]||(r[9]=[t("i",{class:"fas fa-edit"},null,-1),y(" Edit ")]),8,Ke),p(C,{to:{name:"TaskReports",params:{id:(U=e.task)==null?void 0:U.id}},class:"border-indigo-500 hover:bg-indigo-600 text-indigo-600 hover:text-white font-semibold px-3 py-0.5 rounded-full transition border-2"},{default:w(()=>r[10]||(r[10]=[t("i",{class:"far fa-file-alt"},null,-1),y(" Reports ")])),_:1,__:[10]},8,["to"])]))])]),t("div",Ye,[T.value?(s(),_(ae,{key:0,childrenTasks:e.task.children_tasks,"hide-buttons":e.hideButtons,"parent-tree-level":e.treeLevel,onEditClick:f,onAddClick:k},{"tree-item-end":w(({task:v,level:Q})=>[V(c.$slots,"item-end",{level:Q,task:v})]),_:3},8,["childrenTasks","hide-buttons","parent-tree-level"])):m("",!0)])])],2)])}}};export{Qe as _,ne as a,le as b,J as g};
