import{O as q}from"./OverlyModal-DBVdK6PT.js";import{c as T,o as m,L as K,a as e,g as x,t as h,w as U,m as O,r as k,e as A,J as W,A as Q,K as tt,p as $,f as I,k as c,i as _,j as D,h as P,v as H,d as et,F as ot}from"./index-D_dgf00N.js";import{g as L,b as dt}from"./datetime-Efw590t9.js";import{u as J}from"./useTodoStore-T8NNx6xu.js";import{L as G}from"./LoaderView-DiJFUYMF.js";import{u as lt}from"./useTaskStore-CTqDR4tf.js";import{_ as at}from"./TaskSelectionInput-DN2KXIvO.js";import{u as X,f as st,d as nt,a as it}from"./useTodoDateStore-Ch0ZKKtn.js";import{_ as ut}from"./UserChip-D7ju7Id3.js";import{a as rt}from"./TodoItemCard-z2A6Q947.js";const mt={class:"bg-white border-t px-4 py-4 sticky bottom-0 rounded-b-md"},yt={key:0,class:"mb-4 text-red-500 font-medium"},pt={key:0,class:"mb-4 text-blue-500 font-medium"},ft={class:"flex justify-between items-center gap-4"},ct=["disabled"],Y={__name:"FormHandler",props:{isSubmitting:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["submit","clickCancel"],setup(a,{emit:C}){const n=C;return(l,v)=>(m(),T("form",{onSubmit:v[1]||(v[1]=U(g=>n("submit"),["prevent"]))},[K(l.$slots,"default"),e("div",mt,[K(l.$slots,"error",{},()=>[a.error?(m(),T("div",yt,h(a.error),1)):x("",!0)]),a.isSubmitting?(m(),T("div",pt,"Saving changes...")):x("",!0),K(l.$slots,"footer",{},()=>[e("div",ft,[e("button",{type:"button",onClick:v[0]||(v[0]=g=>n("clickCancel")),class:"btn-3"},"Cancel"),e("button",{disabled:a.isSubmitting||a.isLoading,type:"submit",class:"btn-2"},h(a.isSubmitting?"Saving...":"Save"),9,ct)])])])],32))}},Z={__name:"TodoTypeInput",props:{todoType:{type:String,default:"task"},todoTypeId:{type:[String,Number],default:null},show:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["update:todoType","update:todoTypeId","update:show"],setup(a,{emit:C}){const n=a,l=C,v=O({get:()=>n.todoTypeId,set:u=>l("update:todoTypeId",u)}),g=O({get:()=>n.show,set:u=>l("update:show",u)}),s=k(null),y=k({});function o(){if(!(s!=null&&s.value))return;const u=s.value.getBoundingClientRect(),d=window.innerHeight,t=300,w=d-u.bottom<t;y.value={position:"fixed",top:w?u.top-t+"px":u.bottom+"px",left:u.left+"px",width:u.width+"px",zIndex:5e3}}A(async()=>{await W(),window.addEventListener("resize",o),document.addEventListener("scroll",o)});const f=lt();return Q(()=>g.value,async u=>{u&&await f.fetchAllMyTasks()}),tt(()=>{window.removeEventListener("resize",o),document.removeEventListener("scroll",o)}),(u,d)=>(m(),T("div",null,[$(at,{show:g.value,"onUpdate:show":d[0]||(d[0]=t=>g.value=t),taskId:v.value,"onUpdate:taskId":d[1]||(d[1]=t=>v.value=t)},null,8,["show","taskId"])]))}},vt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},bt={class:"mb-4"},gt={class:"mb-4"},kt=["readonly"],wt={class:"mb-4"},xt={__name:"TodoAddForm",props:{date:{type:String,default:L(new Date)},userRole:{type:String,default:"employee"},todoType:{type:String,default:"task"},todoTypeId:{type:String,default:null},readonlyValues:{type:Object,default:()=>({date:!1,todo_type_id:!1})}},emits:["update","cancelClick"],setup(a,{emit:C}){const n=a,l=k(),v=k(!1),g=k(),s=J(),y=C,o=k({title:"",date:n.date||"",todo_type:"task",todo_type_id:""});async function f(){var u;try{l.value="submitting",(u=o.value)!=null&&u.todo_type_id||(o.value={title:o.value.title,date:o.value.date}),await s.createTodo(o.value,{returnWith:n.userRole!=="employee"?"user,department,company":""}),y("update")}finally{l.value=""}}return Q(()=>({date:n.date,todo_type:n.todoType,todo_type_id:n.todoTypeId}),u=>{o.value=u},{immediate:!0}),A(async()=>{var u;await W(),(u=g.value)==null||u.focus()}),(u,d)=>(m(),T("div",{onClick:d[6]||(d[6]=t=>v.value=!1)},[c(s).loading?(m(),I(G,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:_(()=>d[7]||(d[7]=[D(" Loading... ")])),_:1,__:[7]})):x("",!0),$(Y,{onSubmit:f,onClickCancel:d[5]||(d[5]=t=>y("cancelClick")),isSubmitting:l.value=="submitting",error:c(s).error,class:"rounded-md relative"},{default:_(()=>{var t,b;return[d[11]||(d[11]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Add Todo")],-1)),e("div",vt,[e("div",bt,[d[8]||(d[8]=e("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Title",-1)),P(e("input",{ref_key:"titleRef",ref:g,"onUpdate:modelValue":d[0]||(d[0]=w=>o.value.title=w),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[H,o.value.title]])]),e("div",gt,[d[9]||(d[9]=e("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Date",-1)),P(e("input",{readonly:(t=a.readonlyValues)==null?void 0:t.date,"onUpdate:modelValue":d[1]||(d[1]=w=>o.value.date=w),type:"date",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,8,kt),[[H,o.value.date]])]),e("div",wt,[d[10]||(d[10]=e("label",{class:"block text-gray-700 font-medium mb-1 text-sm"},"Task ID (optional)",-1)),$(Z,{show:v.value,"onUpdate:show":d[2]||(d[2]=w=>v.value=w),todoType:o.value.todo_type,"onUpdate:todoType":d[3]||(d[3]=w=>o.value.todo_type=w),todoTypeId:o.value.todo_type_id,"onUpdate:todoTypeId":d[4]||(d[4]=w=>o.value.todo_type_id=w),readonly:(b=a.readonlyValues)==null?void 0:b.todo_type_id},null,8,["show","todoType","todoTypeId","readonly"])])])]}),_:1,__:[11]},8,["isSubmitting","error"])]))}},Tt={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},St={class:"mb-4 text-md"},Ct={class:"font-semibold"},Dt={class:"mb-2"},_t={__name:"TodoDateAddForm",props:{date:{type:[String,Number],default:L(new Date)},todoId:{type:[String,Number],required:!0},userRole:{type:String,default:"employee"}},emits:["update","cancelClick"],setup(a,{emit:C}){const n=a,l=k(),v=k(!1),g=k(),s=J(),y=X(),o=C,f=k({date:n.date||"",todo_id:n.todoId});async function u(){try{l.value="submitting",await y.createTodoDate(f.value),o("update")}finally{l.value=""}}return A(async()=>{var d;await W(),await s.fetchTodo(n.todoId),(d=g.value)==null||d.focus()}),(d,t)=>(m(),T("div",{onClick:t[2]||(t[2]=b=>v.value=!1)},[c(s).loading?(m(),I(G,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:_(()=>t[3]||(t[3]=[D(" Loading... ")])),_:1,__:[3]})):x("",!0),$(Y,{onSubmit:u,onClickCancel:t[1]||(t[1]=b=>o("cancelClick")),isSubmitting:l.value=="submitting",error:c(y).error,class:"rounded-md relative"},{default:_(()=>{var b;return[t[6]||(t[6]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Carry Todo To Date")],-1)),e("div",Tt,[e("div",St,[t[4]||(t[4]=D(" TODO: ")),e("span",Ct,h((b=c(s).todo)==null?void 0:b.title),1)]),e("div",Dt,[t[5]||(t[5]=e("span",{class:"font-semibold"}," Date ",-1)),P(e("input",{"onUpdate:modelValue":t[0]||(t[0]=w=>f.value.date=w),type:"date",multiple:"",required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500"},null,512),[[H,f.value.date]])])])]}),_:1,__:[6]},8,["isSubmitting","error"])]))}},$t={key:0,class:"mb-4 text-red-500 font-medium"},ht={key:1,class:"mb-4 text-red-500 font-medium"},It={class:"p-4 min-h-[10vh] max-h-[50vh] overflow-y-auto"},Rt={class:"mb-4"},Et={class:"mb-4"},Mt={__name:"TodoEditForm",props:{date:{type:String,default:L(new Date)},todo:{type:Object,default:()=>({})}},emits:["update","cancelClick"],setup(a,{emit:C}){var R;const n=a,l=k(),v=k(!1),g=k(),s=J(),y=C,o=k({title:"",todo_type:"task",todo_type_id:""}),f=k({id:null,repeat_type:"daily",start_date:((R=n.todo)==null?void 0:R.date)||n.date||L(new Date),end_date:null,weekly_day:null,monthly_mode:null,monthly_value:null,monthly_week:null,yearly_month:null,yearly_day:null}),u=k(!1),d=k({});async function t(){var p,i,r;await s.fetchTodo((p=n.todo)==null?void 0:p.id),o.value.title=(i=s.todo)==null?void 0:i.title,o.value.todo_type_id=(r=s.todo)==null?void 0:r.todoable_id}const b=k(null);async function w(){var p,i;try{const{data:r}=await st(n.todo.id),S=r==null?void 0:r.setting;S?(u.value=!0,b.value=S.id,f.value={repeat_type:S.repeat_type??"daily",start_date:S.start_date??f.value.start_date,end_date:S.end_date??null,weekly_day:S.weekly_day??null,monthly_mode:S.monthly_mode??null,monthly_value:S.monthly_value??null,monthly_week:S.monthly_week??null,yearly_month:S.yearly_month??null,yearly_day:S.yearly_day??null}):f.value.id=null}catch(r){E.value=(i=(p=r==null?void 0:r.response)==null?void 0:p.data)==null?void 0:i.message,console.error("Load setting failed:",(r==null?void 0:r.message)||r)}}async function j(){await s.updateTodo(n.todo.id,{title:o.value.title,todo_type:o.value.todo_type,todo_type_id:o.value.todo_type_id})}async function B(){var p,i;if(!u.value)b.value&&await nt(n.todo.id,b.value);else{const r=(p=d.value)!=null&&p.buildPayload?d.value.buildPayload():{...f.value};r.start_date||(r.start_date=((i=n.todo)==null?void 0:i.date)||n.date||L(new Date)),await it(n.todo.id,r)}}const F=p=>{var i,r;return((r=(i=p==null?void 0:p.response)==null?void 0:i.data)==null?void 0:r.message)||(p==null?void 0:p.message)||"Something went wrong"};async function N(){const[p,i]=await Promise.allSettled([j(),B()]),r=p.status==="fulfilled",S=i.status==="fulfilled";S||(E.value=F(i.reason)),r&&S&&y("update")}const M=k(!1),E=k(!1);async function z(){var p;await t(),M.value=!0,await w(),M.value=!1,await W(),(p=g.value)==null||p.focus()}const V=O(()=>s.loading||M.value);return A(()=>{z()}),(p,i)=>(m(),T("div",{class:"relative",onClick:i[5]||(i[5]=r=>v.value=!1)},[V.value?(m(),I(G,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:_(()=>i[6]||(i[6]=[D(" Loading... ")])),_:1,__:[6]})):x("",!0),$(Y,{onSubmit:N,onClickCancel:i[4]||(i[4]=r=>y("cancelClick")),isSubmitting:l.value=="submitting",isLoading:V.value,id:"todoEditForm"},{error:_(()=>[e("div",null,[c(s).error?(m(),T("div",$t,h(c(s).error),1)):x("",!0),E.value?(m(),T("div",ht,h(E.value),1)):x("",!0)])]),default:_(()=>[i[10]||(i[10]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Edit Todo")],-1)),e("div",It,[i[9]||(i[9]=e("div",{class:"text-xs text-red-800 mb-6"},[e("strong",null,"Tips:"),D(" If you change the todo, it will change to all the concurrent dates ")],-1)),e("div",Rt,[i[7]||(i[7]=e("label",{class:"block text-gray-500 font-medium text-sm"},"Title",-1)),P(e("input",{ref_key:"titleRef",ref:g,"onUpdate:modelValue":i[0]||(i[0]=r=>o.value.title=r),required:"",placeholder:"Enter todo title",class:"w-full px-4 py-2 border rounded-md focus:ring-2 focus:ring-blue-500 shadow-sm"},null,512),[[H,o.value.title]])]),e("div",Et,[i[8]||(i[8]=e("label",{class:"block text-gray-500 font-medium text-sm"},"Task ID (optional)",-1)),$(Z,{show:v.value,"onUpdate:show":i[1]||(i[1]=r=>v.value=r),todoType:o.value.todo_type,"onUpdate:todoType":i[2]||(i[2]=r=>o.value.todo_type=r),todoTypeId:o.value.todo_type_id,"onUpdate:todoTypeId":i[3]||(i[3]=r=>o.value.todo_type_id=r)},null,8,["show","todoType","todoTypeId"])])])]),_:1,__:[10]},8,["isSubmitting","isLoading"])]))}},Ut={class:"relative"},Vt={class:"min-h-[10vh] max-h-[50vh] overflow-y-auto p-4"},Lt={class:"mb-4"},Ot={class:"mb-4 flex justify-between items-end"},At={key:0,class:"mt-1 flex items-center gap-2 mb-4"},jt={class:"border border-sky-400 rounded-full text-sky-500 font-semibold bg-sky-50 px-1 py-0.5 text-xs inline-block"},Bt={class:"flex items-center justify-between gap-4"},Ft={key:0,class:"flex items-center gap-2"},Nt={class:"flex justify-between items-center gap-4 py-4 px-4 border-t"},zt={key:0,class:"ml-auto flex items-center gap-2"},qt={__name:"TodoShow",props:{todoDate:{type:Object,default:()=>{}}},emits:["cancelClick","clickEdit","update","clickAddTodoDate"],setup(a,{emit:C}){const n=a,l=X(),v=et(),g=C;async function s(){var d;console.log({todo_date:"dd"}),await l.fetchTodoDate((d=n.todoDate)==null?void 0:d.id)}const y=O(()=>{var d,t;return(d=l.todo_date)!=null&&d.date?new Date((t=l.todo_date)==null?void 0:t.date):null}),o=O(()=>{var d,t,b;return((t=(d=l.todo_date)==null?void 0:d.user)==null?void 0:t.id)===((b=v.user)==null?void 0:b.id)});async function f(d){var t;confirm(`Are your sure want to delete todo
'${(t=l.todo_date)==null?void 0:t.title}'`)&&(await l.deleteTodoDate(d.id),g("update"))}async function u(d,t){var b;confirm(`Are your sure want to compete todo
'${(b=l.todo_date)==null?void 0:b.title}'`)&&(await l.updateStatus(d.id,t),g("update"))}return A(async()=>{await s()}),(d,t)=>{var b,w,j,B,F,N,M,E,z;return m(),T("div",Ut,[c(l).loading?(m(),I(G,{key:0,class:"absolute inset-0 bg-opacity-80 text-center py-4 text-gray-500 z-10 flex items-center justify-center"},{default:_(()=>t[6]||(t[6]=[D(" Loading... ")])),_:1,__:[6]})):x("",!0),e("div",null,[t[13]||(t[13]=e("div",{class:"border-b py-2 px-4"},[e("h2",{class:"text-xl font-semibold"},"Show Todo")],-1)),e("div",Vt,[e("div",Lt,[t[7]||(t[7]=e("div",{class:"font-semibold text-xs text-gray-500"},"Date",-1)),e("span",null,h(c(dt)(y.value,{weekDay:"long"})),1)]),e("div",Ot,[e("div",null,[t[8]||(t[8]=e("div",{class:"text-xs text-gray-500"},"Todo",-1)),D(" "+h((b=c(l).todo_date)==null?void 0:b.title),1)]),e("button",{class:"btn-2 bg-sky-400 text-white hover:bg-sky-600 hover:text-white bg-none",onClick:t[0]||(t[0]=U(V=>{var R;return g("clickEdit",(R=c(l).todo_date)==null?void 0:R.todo)},["prevent","stop"]))},t[9]||(t[9]=[e("i",{class:"fas fa-pen"},null,-1),D(" Edit Todo ")]))]),(w=a.todoDate)!=null&&w.user?(m(),T("div",At,[$(ut,{user:a.todoDate.user,"avatar-size":"xsmall"},null,8,["user"]),e("div",jt,h((B=(j=a.todoDate.user)==null?void 0:j.department)==null?void 0:B.name),1)])):x("",!0),e("div",null,[t[12]||(t[12]=e("div",{class:"text-xs text-gray-500"},"Status",-1)),e("div",Bt,[e("div",null,[(F=c(l))!=null&&F.todo_date?(m(),I(rt,{key:0,todoDate:(N=c(l))==null?void 0:N.todo_date},null,8,["todoDate"])):x("",!0),D(" "+h((M=c(l).todo_date)==null?void 0:M.status),1)]),o.value&&!c(l).loading?(m(),T("div",Ft,[((E=c(l).todo_date)==null?void 0:E.status)==="PENDING"?(m(),T("button",{key:0,class:"btn-2 from-yellow-700 to-yellow-500 text-white hover:bg-green-600 hover:text-white",onClick:t[1]||(t[1]=U(()=>u(c(l).todo_date,"WORKING"),["prevent","stop"]))},t[10]||(t[10]=[e("i",{class:"fas fa-exclamation-circle"},null,-1),D(" Change to Working ")]))):x("",!0),((z=c(l).todo_date)==null?void 0:z.status)==="WORKING"?(m(),T("button",{key:1,class:"btn-2 from-green-700 to-green-300 text-white hover:bg-green-600 hover:text-white",onClick:t[2]||(t[2]=U(()=>u(c(l).todo_date,"COMPLETED"),["prevent","stop"]))},t[11]||(t[11]=[e("i",{class:"fas fa-check"},null,-1),D(" Make Complete ")]))):x("",!0)])):x("",!0)])])])]),e("div",Nt,[e("button",{type:"button",onClick:t[3]||(t[3]=V=>g("cancelClick")),class:"btn-3"},"Cancel"),o.value&&!c(l).loading?(m(),T("div",zt,[e("button",{class:"btn-2 bg-green-600 text-white hover:bg-green-700 hover:text-white bg-none",onClick:t[4]||(t[4]=U(V=>{var R,p;return g("clickAddTodoDate",(R=c(l).todo_date)==null?void 0:R.todo_id,(p=c(l).todo_date)==null?void 0:p.date)},["prevent","stop"]))},t[14]||(t[14]=[e("i",{class:"fas fa-plus"},null,-1),D(" Add To another date ")])),e("button",{class:"btn-2-red",onClick:t[5]||(t[5]=U(()=>f(c(l).todo_date),["prevent","stop"]))},t[15]||(t[15]=[e("i",{class:"fas fa-trash-alt"},null,-1),D(" Delete ")]))])):x("",!0)])])}}},te={__name:"TodoCreateEditShow",props:{todoModal:{type:Object,required:!0},userRole:{type:String,required:"employee"}},emits:["cancelClick","todoUpdate","todoDateUpdate","clickEdit","clickDelete","clickChangeStatus","clickAddTodoDate"],setup(a,{emit:C}){const n=C;function l(){n("todoUpdate")}function v(){n("todoDateUpdate")}return(g,s)=>(m(),T(ot,null,[a.todoModal.action=="add"?(m(),I(q,{key:0},{default:_(()=>{var y,o,f,u;return[$(xt,{onCancelClick:s[0]||(s[0]=d=>n("cancelClick")),onUpdate:l,date:(y=a.todoModal)==null?void 0:y.date,todoType:(o=a.todoModal)==null?void 0:o.todoType,todoTypeId:(f=a.todoModal)==null?void 0:f.todoTypeId,readonlyValues:((u=a.todoModal)==null?void 0:u.formReadonlyValues)||{},userRole:a.userRole},null,8,["date","todoType","todoTypeId","readonlyValues","userRole"])]}),_:1})):x("",!0),a.todoModal.action=="addDate"?(m(),I(q,{key:1},{default:_(()=>{var y,o,f;return[$(_t,{onCancelClick:s[1]||(s[1]=u=>n("cancelClick")),onUpdate:v,date:(y=a.todoModal)==null?void 0:y.date,todoId:(o=a.todoModal)==null?void 0:o.todo_id,userRole:a.userRole,readonlyValues:((f=a.todoModal)==null?void 0:f.formReadonlyValues)||{}},null,8,["date","todoId","userRole","readonlyValues"])]}),_:1})):x("",!0),a.todoModal.action=="edit"?(m(),I(q,{key:2},{default:_(()=>{var y,o;return[$(Mt,{onCancelClick:s[2]||(s[2]=f=>n("cancelClick")),onUpdate:l,todo:(y=a.todoModal)==null?void 0:y.todo,userRole:a.userRole,readonlyValues:((o=a.todoModal)==null?void 0:o.formReadonlyValues)||{}},null,8,["todo","userRole","readonlyValues"])]}),_:1})):x("",!0),a.todoModal.action=="show"?(m(),I(q,{key:3},{default:_(()=>{var y;return[$(qt,{onCancelClick:s[3]||(s[3]=o=>n("cancelClick")),onUpdate:v,onClickEdit:s[4]||(s[4]=o=>n("clickEdit",o)),onClickAddTodoDate:s[5]||(s[5]=(...o)=>n("clickAddTodoDate",...o)),onClickDelete:s[6]||(s[6]=o=>n("clickDelete",o)),onClickChangeStatus:s[7]||(s[7]=(o,f)=>n("clickChangeStatus",o,f)),todoDate:(y=a.todoModal)==null?void 0:y.todo,userRole:a.userRole},null,8,["todoDate","userRole"])]}),_:1})):x("",!0)],64))}};export{te as _};
